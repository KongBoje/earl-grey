#!/usr/bin/env iojs

fs = require("fs");
var r = require("../bootstrap/run");
var n = parseFloat(process.argv[2] || 0);

function rmrf(path) {
    if(fs.existsSync(path)) {
        fs.readdirSync(path).forEach(function(file, index) {
            var curPath = path + "/" + file;
            if(fs.lstatSync(curPath).isDirectory()) {
                rmrf(curPath);
            } else {
                fs.unlinkSync(curPath);
            }
        });
        fs.rmdirSync(path);
    }
}

var i = 0;
var name = i == n ? "lib" : "temp_bootstrap_" + i;
console.log("Making", name)
r.run(["compile", "-vo", name, "src"]);
while (i < n) {
    r = require("../" + name + "/run");
    i++;
    name = i == n ? "lib" : "temp_bootstrap_" + i;
    console.log("Making", name)
    r.run(["compile", "-vo", name, "src"]);
}

for (var i = 0; i < n; i++) {
    name = "temp_bootstrap_" + i;
    console.log("rm " + name);
    rmrf(name);
}

console.log("done")
