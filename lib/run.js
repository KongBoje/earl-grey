var $11159=function(type$11161){var f$11164;(f$11164=type$11161["::check"]);;if((f$11164===(void 0))){return function(value$11169){return (value$11169 instanceof type$11161);};}else{return function(value$11172){return f$11164.call(type$11161,value$11172);};}};
var $11174=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $11175=function(temp$11176$11178){var ph$11182;(ph$11182=temp$11176$11178);;var m$11180$11187;(m$11180$11187=ph$11182);;var bridge$11181$11192;var x$11196;(bridge$11181$11192=m$11180$11187);if((((typeof(bridge$11181$11192)==="string")&&((x$11196=bridge$11181$11192),true))||((typeof(bridge$11181$11192)==="number")&&((x$11196=bridge$11181$11192),true)))){return ["value",x$11196];}else{var other$11203;(other$11203=m$11180$11187);return other$11203["::serialize_ast"]();}};
var send$11022;(send$11022=function(obj$11027,temp$11025$11028){var ph$11032;var msg$11033;var t0$11035;(t0$11035=temp$11025$11028);(msg$11033=t0$11035);(ph$11032=t0$11035);;var m$11030$11039;(m$11030$11039=ph$11032);;var bridge$11031$11044;(bridge$11031$11044=m$11030$11039);if(((typeof(bridge$11031$11044)==="string")||(typeof(bridge$11031$11044)==="number"))){return obj$11027[msg$11033];}else{var other$11052;(other$11052=m$11030$11039);return obj$11027["::send"](msg$11033);}});;(Array[":::project"]=function(temp$11055$11057){var ph$11060;var value$11061;var t0$11063;(t0$11063=temp$11055$11057);(value$11061=t0$11063);(ph$11060=t0$11063);;var m$11059$11067;(m$11059$11067=ph$11060);;if($11159(Array)(m$11059$11067)){return [true,value$11061];}else{m$11059$11067;return [true,[value$11061]];}});(Array.prototype["::check"]=function(value$11081){if((value$11081 instanceof Array)){var i$11086;(i$11086=0);;$11084:for(;(i$11086<this.length);(i$11086++)){if(($11174(this,i$11086)!==$11174(value$11081,i$11086))){return false;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value$11095){if((value$11095 instanceof Array)){var i$11100;(i$11100=0);;$11098:for(;(i$11100<this.length);(i$11100++)){if(($11174(this,i$11100)!==$11174(value$11095,i$11100))){return [true,[value$11095]];}}return [true,value$11095.slice(this.length)];}else{return [true,[value$11095]];}});(Array.prototype[":::deconstruct"]=function(value$11109){return [true,value$11109.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($11175));});(RegExp.prototype["::check"]=function(value$11114){return value$11114.match(this);});(RegExp.prototype[":::project"]=function(value$11117){var m$11119$11121;(m$11119$11121=value$11117.match(this));;var m$11129;if((m$11119$11121===null)){(m$11129=m$11119$11121);return [false,null];}else{var m$11134;(m$11134=m$11119$11121);return [true,m$11134];}});(RegExp.prototype[":::deconstruct"]=function(value$11137){var m$11139$11141;(m$11139$11141=value$11137.match(this));;var m$11149;if((m$11139$11141===null)){(m$11149=m$11139$11141);return [false,null];}else{var m$11154;(m$11154=m$11139$11141);return [true,m$11154];}});(Function.prototype["::send"]=function(args$11157){return this.apply(this,args$11157);});
var $11820=function(dest$11822,values$11823){var k$11828;(k$11828=null);$11826:for(k$11828 in values$11823){if(values$11823.hasOwnProperty(k$11828)){(dest$11822[k$11828]=values$11823[k$11828]);}}return dest$11822;};
var $11832=function(type$11834){return function(value$11837){var f$11840;(f$11840=type$11834[":::project"]);;if((f$11840===(void 0))){var f$11845;(f$11845=type$11834["::project"]);;if((f$11845===(void 0))){return [true,type$11834(value$11837)];}else{var rval$11850;(rval$11850=false);;try{(rval$11850=[true,f$11845(value$11837)]);}catch(excv$11856){var e$11862;(e$11862=excv$11856);(rval$11850=[false,null]);}return rval$11850;}}else{return f$11840.call(type$11834,value$11837);}};};var eg$11210;var $11207$11211;var __lt____gt__$11212;var Node$11213;var $11208$11214;var enumerate$11215;var items$11216;var $11209$11217;var Source$11218;var display_error$11219;var fs$11220;var path$11221;var vm$11222;var usage$11223;var walk$11224;var copy$11225;var gen$11226;var gen2$11227;var run$11228;var _run$11229;(eg$11210=require("./earl-grey"));;($11207$11211=require("./pp"));;(__lt____gt__$11212=$11207$11211["<>"]);;(Node$11213=$11207$11211.Node);;($11208$11214=require("./util"));;(enumerate$11215=$11208$11214.enumerate);;(items$11216=$11208$11214.items);;($11209$11217=require("./location"));;(Source$11218=$11209$11217.Source);;(display_error$11219=$11209$11217.display_error);;(fs$11220=require("fs"));;(path$11221=require("path"));;(vm$11222=require("vm"));;(usage$11223="\nusage:\n\nearl translate <file> [outfile]\n  Translate a source file, output to outfile. Without outfile\n  specified, print to standard out.\n\nearl translate <directory> <outdir>\n  Translate all the .eg files in the specified directory.\n\nearl run [file] [arguments...]\n  Run the specified file as a script.\n");;(walk$11224=function(dir$11275,partial$11276,f$11277){var i$11302;var len$11297;var temp$11292;var acc$11287;var stats$11280;(stats$11280=fs$11220.statSync(dir$11275));;if(stats$11280.isDirectory()){f$11277("dir",partial$11276);(acc$11287=[]);;(temp$11292=fs$11220.readdirSync(dir$11275));;(len$11297=temp$11292.length);;(i$11302=0);;$11285:for(;(i$11302<len$11297);(i$11302++)){var newdir$11321;var newpartial$11322;var file$11318;var m$11310;(m$11310=temp$11292[i$11302]);;(file$11318=m$11310);acc$11287.push((((newdir$11321=path$11221.join(dir$11275,file$11318))),((newpartial$11322=path$11221.join(partial$11276,file$11318))),walk$11224(newdir$11321,newpartial$11322,f$11277)));}return acc$11287;}else{return f$11277("file",partial$11276);}});;(copy$11225=function(src$11333,dest$11334){var data$11337;(data$11337=fs$11220.readFileSync(src$11333,"binary"));;return fs$11220.writeFileSync(dest$11334,data$11337,"binary");});;(gen$11226=function(text$11345,file$11346){var g$11349;(g$11349=eg$11210.Generator());;return g$11349.generate(Source$11218(text$11345,path$11221.resolve(file$11346)));});;(gen2$11227=function(text$11357,file$11358){var g$11361;(g$11361=eg$11210["Generator2"]());;return g$11361.generate(Source$11218(text$11357,path$11221.resolve(file$11358)));});;(run$11228=function(cmd$11369){var rval$11372;(rval$11372=false);;try{(rval$11372=_run$11229(cmd$11369));}catch(excv$11378){var e$11384;(e$11384=excv$11378);(rval$11372=(display_error$11219(e$11384),process.exit(1)));}return rval$11372;});;(_run$11229=function(temp$11390$11392){var t0$11423;var bridge$11397$11431;var t0$11426;var bridge$11396$11427;var accum$11444;var repl$11435;var settings$11436;var run$11437;var data$11510;var data$11658;var data$11667;var otherwise$11664;var $11523$11539;var m$11522$11533;var out$11524;var stats$11525;var i$11693;var len$11688;var temp$11683;var acc$11678;var tokens$11805;var walkloc$11718;var other$11816;var data$11811;var s$11714;var s$11673;var file$11516;var args$11517;var file$11505;var $11399$11416;var $11400$11417;var $11401$11418;var bridge$11395$11412;var t0$11413;var bridge$11398$11414;var m$11394$11407;var ph$11402;(ph$11402=temp$11390$11392);;(m$11394$11407=ph$11402);;(bridge$11395$11412=m$11394$11407);if((((bridge$11395$11412 instanceof Array)&&((t0$11423=bridge$11395$11412.length),(t0$11423===0)))||((bridge$11395$11412 instanceof Array)&&((t0$11426=bridge$11395$11412.length),((t0$11426===1)&&((bridge$11396$11427=bridge$11395$11412[0]),(((bridge$11397$11431=bridge$11396$11427),((bridge$11397$11431==="i")||(bridge$11397$11431==="in")))||(bridge$11396$11427==="interactive")))))))){(repl$11435=require("repl"));;(settings$11436=$11820(({"prompt":"<> ","ignoreUndefined":true}),((accum$11444=({})),((accum$11444["eval"]=function(input$11448,context$11449,filename$11450,callback$11451){var rval$11482;var execute$11462;var handle$11463;var g$11454;var result$11455;(g$11454=eg$11210["Generator2"]());;(result$11455=(((execute$11462=function(){var text$11469;(text$11469=g$11454.generate(Source$11218(input$11448.slice(1,(-1)),"<interactive>")));;return vm$11222.runInThisContext(text$11469,"stdin");})),((handle$11463=function(e$11477){display_error$11219(e$11477);return (void 0);})),(((rval$11482=false)),(function(){try{(rval$11482=execute$11462());}catch(excv$11488){var e$11494;(e$11494=excv$11488);(rval$11482=handle$11463(e$11494));}}(),rval$11482))));;return callback$11451(null,result$11455);}),accum$11444))));;(run$11437=repl$11435.start(settings$11436));;return run$11437.on("exit",function(){return run$11437.outputStream.write("\n");});}else{if((($11399$11416=(m$11394$11407 instanceof Array))&&((t0$11413=m$11394$11407.length),((t0$11413===2)&&(m$11394$11407[0]==="run"))))){(file$11505=m$11394$11407[1]);(data$11510=fs$11220.readFileSync(file$11505,"utf8"));;return eval(gen2$11227(data$11510,file$11505));}else{if(($11399$11416&&((t0$11413>=2)&&((bridge$11398$11414=m$11394$11407[0]),((bridge$11398$11414==="tr")||(bridge$11398$11414==="translate")))))){(file$11516=m$11394$11407[1]);(args$11517=Array.prototype.slice.call(m$11394$11407,2));(out$11524=args$11517[0]);;(stats$11525=fs$11220.statSync(file$11516));;(m$11522$11533=null);;m$11522$11533;if(stats$11525.isDirectory()){return walk$11224(file$11516,"/",function(){var rval$11586;var from$11577;var to$11578;var t0$11621;var t1$11622;var x$11615;var name$11616;var from$11617;var to$11618;var data$11619;var from$11641;var to$11642;var f$11638;var results$11610;var t0$11606;var ph$11547$11602;var d$11573;var $11548$11568;var $11549$11569;var $11550$11570;var t0$11565;var t1$11566;var ph$11546$11561;var t0$11557;var m$11545$11552;(m$11545$11552=arguments);;(t0$11557=m$11545$11552.length);if((t0$11557>=0)){(ph$11546$11561=Array.prototype.slice.call(m$11545$11552,0));(t0$11565=ph$11546$11561);(t1$11566=t0$11565.length);if((($11550$11570=(t1$11566===2))&&(t0$11565[0]==="dir"))){(d$11573=t0$11565[1]);(from$11577=path$11221.join(file$11516,d$11573));;(to$11578=path$11221.join(out$11524,d$11573));;(rval$11586=false);;try{(rval$11586=fs$11220.mkdirSync(to$11578));}catch(excv$11592){var e$11598;(e$11598=excv$11592);(rval$11586="ignore error");}return rval$11586;}else{if(($11550$11570&&(t0$11565[0]==="file"))){(ph$11547$11602=t0$11565[1]);(t0$11606=$11832(RegExp("(?:^((?:.*))\\.eg$)",""))(ph$11547$11602));if((t0$11606[0]&&((results$11610=t0$11606[1]),results$11610))){(t0$11621=results$11610);if(((t0$11621 instanceof Array)&&((t1$11622=t0$11621.length),(t1$11622===2)))){(x$11615=t0$11621[0]);(name$11616=t0$11621[1]);;}else{throw Error("Mismatch");}(from$11617=path$11221.join(file$11516,x$11615));;(to$11618=path$11221.join(out$11524,(name$11616+".js")));;(data$11619=fs$11220.readFileSync(from$11617,"utf8"));;return fs$11220.writeFileSync(to$11618,(gen2$11227(data$11619,from$11617)+"\n"));}else{(f$11638=ph$11547$11602);(from$11641=path$11221.join(file$11516,f$11638));;(to$11642=path$11221.join(out$11524,f$11638));;return copy$11225(from$11641,to$11642);}}else{throw Error("mismatch!!");}}}else{throw Error("mismatch!!");}});}else{if(out$11524){(data$11658=fs$11220.readFileSync(file$11516,"utf8"));;return fs$11220.writeFileSync(out$11524,(gen2$11227(data$11658,file$11516)+"\n"));}else{(otherwise$11664=m$11522$11533);(data$11667=fs$11220.readFileSync(file$11516,"utf8"));;return console.log(gen2$11227(data$11667,file$11516));}}}else{if(($11399$11416&&(($11401$11418=(t0$11413===2))&&(m$11394$11407[0]==="tok")))){(s$11673=m$11394$11407[1]);(acc$11678=[]);;(temp$11683=eg$11210.tokenize(Source$11218(s$11673,null)));;(len$11688=temp$11683.length);;(i$11693=0);;$11676:for(;(i$11693<len$11688);(i$11693++)){var token$11709;var m$11701;(m$11701=temp$11683[i$11693]);;(token$11709=m$11701);acc$11678.push((__lt____gt__$11212(null,token$11709),__lt____gt__$11212(null,token$11709.location.ref()),__lt____gt__$11212(null,token$11709.location.highlight())));}return acc$11678;}else{if(($11401$11418&&(m$11394$11407[0]==="pa"))){(s$11714=m$11394$11407[1]);(walkloc$11718=function(temp$11721$11723){var t0$11732;var i$11783;var len$11778;var temp$11773;var acc$11768;var type$11761;var args$11762;var x$11755;var x$11748;var $11726$11743;var $11727$11744;var $11728$11745;var t0$11741;var m$11725$11736;var ph$11729;var node$11730;(t0$11732=temp$11721$11723);(node$11730=t0$11732);(ph$11729=t0$11732);;(m$11725$11736=ph$11729);;if((($11726$11743=(m$11725$11736 instanceof Array))&&((t0$11741=m$11725$11736.length),(($11728$11745=(t0$11741===2))&&(m$11725$11736[0]==="symbol"))))){(x$11748=m$11725$11736[1]);__lt____gt__$11212(null,node$11730);return __lt____gt__$11212(null,(node$11730.location&&node$11730.location.highlight()));}else{if(($11728$11745&&(m$11725$11736[0]==="value"))){(x$11755=m$11725$11736[1]);__lt____gt__$11212(null,node$11730);return __lt____gt__$11212(null,(node$11730.location&&node$11730.location.highlight()));}else{if(($11726$11743&&(t0$11741>=1))){(type$11761=m$11725$11736[0]);(args$11762=Array.prototype.slice.call(m$11725$11736,1));__lt____gt__$11212(null,node$11730);__lt____gt__$11212(null,(node$11730.location&&node$11730.location.highlight()));(acc$11768=[]);;(temp$11773=args$11762);;(len$11778=temp$11773.length);;(i$11783=0);;$11766:for(;(i$11783<len$11778);(i$11783++)){var arg$11799;var m$11791;(m$11791=temp$11773[i$11783]);;(arg$11799=m$11791);acc$11768.push(walkloc$11718(arg$11799));}return acc$11768;}else{throw Error("mismatch!!");}}}});;return walkloc$11718((((tokens$11805=eg$11210.tokenize(Source$11218(s$11714,null)))),eg$11210.parse(tokens$11805)));}else{if(($11401$11418&&(m$11394$11407[0]==="runs"))){(data$11811=m$11394$11407[1]);return console.log(eval(gen2$11227(data$11811,"<command>")));}else{(other$11816=m$11394$11407);return console.log(usage$11223);}}}}}}});;(exports["run"]=run$11228);
