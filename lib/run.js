require("earlgrey-runtime");
var $17723=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});var eg$15672;var $15650$15673;var __lt____gt__$15674;var $15651$15675;var Source$15676;var format_error$15677;var highlight_locations$15678;var fs$15679;var path$15680;var usage$15681;var display_error$15682;var usage_error$15683;var extract_options$15684;var walk$15685;var copy$15686;var gen$15687;var interactive$15688;var compile_path$15689;var run$15690;var _run$15691;(eg$15672=require("./earl-grey"));($15650$15673=require("./pp"));(__lt____gt__$15674=$15650$15673["<>"]);($15651$15675=require("./location"));(Source$15676=$15651$15675.Source);(format_error$15677=$15651$15675.format_error);(highlight_locations$15678=$15651$15675.highlight_locations);(fs$15679=require("fs"));(path$15680=require("path"));(usage$15681="Usage: earl [global options] command [options] [arguments...]\n\nearl run [options] [file] [arguments...]\n  Run the specified file as a script. The arguments are available in\n  process.argv.slice{2} of the script.\n  Options:\n    -e  --eval <code>  Run the provided code instead of reading from a file.\n    -p  --print        Print the result of the evaluation to standard out.\n    -i  --interactive  Start an interactive interpreter after execution\n                       in the global environment of the script.\n\nearl compile [options] [file... | dir]\n  Compile the specified source files into .js files. The files will be\n  placed next to the originals.\n  If a directory is given, all .eg files in the directory hierarchy\n  will be compiled. The -o option can be used to compile the files\n  into a different directory (all non-eg files will be copied over).\n  Options:\n    -o  --output <dir>  Output in given directory.\n    -p  --print         Print the compiled JavaScript to standard out.\n                        No files are created.\n    -e  --eval <code>   Compile the provided code instead of reading from a file.\n    -n  --noboil        Don't produce boilerplate code (useful with -p)\n\nearl\n  Start an interactive session.\n\nGlobal options:\n  -h  --help      Print this message.\n  -v  --version   Print the version\n");(display_error$15682=(function($15725$15728){var t0$15736;var $index$15803;var $length$15797;var temp$15791;var acc$15785;var pr$15859;var hls$15772;var locs$15773;var accum$15774;var args$15755;var t0$15750;var t1$15751;var $15730$15745;var ph$15733;var e$15734;(t0$15736=$15725$15728);(e$15734=t0$15736);(ph$15733=t0$15736);($15730$15745=ph$15733);if((getChecker(ErrorFactory(["syntax"]))($15730$15745)&&(___hasprop($15730$15745,"args")&&(((t0$15750=$15730$15745.args)),((t0$15750 instanceof Array)&&(((t1$15751=t0$15750.length)),(t1$15751===1))))))){(args$15755=t0$15750[0]);console.error(String(e$15734));(hls$15772=["hl1","hl2","hl3","hl4"]);(locs$15773=(((acc$15785=[])),(((temp$15791=enumerate(items(args$15755)))),((($length$15797=temp$15791.length)),((($index$15803=0)),(function(){$15780:for(;($index$15803<$length$15797);($index$15803++)){var i$15824;var key$15825;var arg$15826;var t0$15817;var t1$15818;var t2$15819;var t3$15820;var m$15812;(m$15812=temp$15791[$index$15803]);(t0$15817=m$15812);if(((t0$15817 instanceof Array)&&(((t1$15818=t0$15817.length)),((t1$15818===2)&&((i$15824=t0$15817[0]),(((t2$15819=t0$15817[1])),((t2$15819 instanceof Array)&&(((t3$15820=t2$15819.length)),((t3$15820===2)&&((key$15825=t2$15819[0]),((arg$15826=t2$15819[1]),(arg$15826&&arg$15826.location)))))))))))){acc$15785.push([arg$15826.location,$17723(hls$15772,(i$15824%4))]);}else{false;}}})()))),acc$15785));(accum$15774="\n");(pr$15859=(function($15863$15866){var l$15946;var $15909$15918;var l$15998;var $15961$15970;var t0$15903;var t1$15904;var $index$16021;var $length$16015;var temp$16009;var pre$15897;var post$15898;var $index$16069;var $length$16063;var temp$16057;var acc$16051;var other$16091;var a$16043;var n$15892;var s$15887;var $15868$15879;var ph$15873;(ph$15873=$15863$15866);($15868$15879=ph$15873);if((typeof($15868$15879)==="string")){(s$15887=$15868$15879);return (accum$15774=(accum$15774+s$15887));}else{if(getChecker(Node)($15868$15879)){(n$15892=$15868$15879);(t0$15903=((($15909$15918=n$15892)),(function(){if(getChecker(Node([".hl1"],({}),[]))($15909$15918)){return ["[1;32m","[0m"];}else{if(getChecker(Node([".hl2"],({}),[]))($15909$15918)){return ["[1;33m","[0m"];}else{if(getChecker(Node([".hl3"],({}),[]))($15909$15918)){return ["[1;36m","[0m"];}else{if(getChecker(Node([".hl4"],({}),[]))($15909$15918)){return ["[1;35m","[0m"];}else{if(getChecker(Node([".lineno"],({}),[]))($15909$15918)){(l$15946=Math.floor((Math.log(n$15892.children[0])/Math.log(10))));return [("[1m"+Array((3-l$15946)).join(" ")),":[0m "];}else{$15909$15918;return ["",""];}}}}}})()));if(((t0$15903 instanceof Array)&&(((t1$15904=t0$15903.length)),(t1$15904===2)))){(pre$15897=t0$15903[0]);(post$15898=t0$15903[1]);}else{___match_error(((($15961$15970=n$15892)),(function(){if(getChecker(Node([".hl1"],({}),[]))($15961$15970)){return ["[1;32m","[0m"];}else{if(getChecker(Node([".hl2"],({}),[]))($15961$15970)){return ["[1;33m","[0m"];}else{if(getChecker(Node([".hl3"],({}),[]))($15961$15970)){return ["[1;36m","[0m"];}else{if(getChecker(Node([".hl4"],({}),[]))($15961$15970)){return ["[1;35m","[0m"];}else{if(getChecker(Node([".lineno"],({}),[]))($15961$15970)){(l$15998=Math.floor((Math.log(n$15892.children[0])/Math.log(10))));return [("[1m"+Array((3-l$15998)).join(" ")),":[0m "];}else{$15961$15970;return ["",""];}}}}}})()),"/home/olivier/git/eg/src/run.eg",1961,2429);}if(getChecker(Node([".sourcepos"],({}),[]))(n$15892)){(pre$15897=(pre$15897+" "));}(accum$15774=(accum$15774+pre$15897));(temp$16009=n$15892.children);($length$16015=temp$16009.length);($index$16021=0);$15899:for(;($index$16021<$length$16015);($index$16021++)){var child$16038;var m$16030;(m$16030=temp$16009[$index$16021]);(child$16038=m$16030);pr$15859(child$16038);}(accum$15774=(accum$15774+post$15898));if((getChecker(Node(["div"],({}),[]))(n$15892)&&nequal($17723(accum$15774,(accum$15774.length-1)),"\n"))){return (accum$15774=(accum$15774+"\n"));}}else{if(getChecker(Array)($15868$15879)){(a$16043=$15868$15879);(acc$16051=[]);(temp$16057=a$16043);($length$16063=temp$16057.length);($index$16069=0);$16046:for(;($index$16069<$length$16063);($index$16069++)){var child$16086;var m$16078;(m$16078=temp$16057[$index$16069]);(child$16086=m$16078);acc$16051.push(pr$15859(child$16086));}return acc$16051;}else{(other$16091=$15868$15879);return (accum$15774=(accum$15774+String(other$16091)));}}}}));pr$15859(highlight_locations$15678(locs$15773,0));return console.error(accum$15774);}else{$15730$15745;return console.error((e$15734.stack||String(e$15734)));}}));(usage_error$15683=(function(message$16102){console.error(usage$15681);console.error(message$16102);return process.exit(1);}));(extract_options$15684=(function($16109$16112,opttable$16113,optmessage$16114){var t0$16118;var results$16130;var associate$16131;var process_option$16132;var argv$16116;(t0$16118=getProjector(clone)($16109$16112));if(t0$16118[0]){(argv$16116=t0$16118[1]);}else{___match_error($16109$16112);}(results$16130=({}));(associate$16131=null);(process_option$16132=(function(original$16143,opt$16144,last$16145){var name$16199;var name$16189;var name$16175;var $16152$16165;var $16153$16166;var $16154$16167;var $16155$16168;var t0$16163;var $16147$16158;($16147$16158=$17723(opttable$16113,opt$16144));if(($16147$16158===(void 0))){return usage_error$15683(((("Unrecognized "+optmessage$16114)+": ")+original$16143));}else{if((($16152$16165=($16147$16158 instanceof Array))&&(((t0$16163=$16147$16158.length)),(($16154$16167=(t0$16163===2))&&($16147$16158[0]==="flag"))))){(name$16175=$16147$16158[1]);(results$16130[name$16175]=true);}else{if(($16154$16167&&(($16155$16168=($16147$16158[0]==="value"))&&((name$16189=$16147$16158[1]),last$16145)))){(associate$16131=name$16189);}else{if($16155$16168){(name$16199=$16147$16158[1]);(results$16130[name$16199]=true);}else{___match_error($16147$16158);}}}}}));$16209:while(argv$16116.length){var $index$16326;var $length$16320;var temp$16314;var acc$16308;var other$16368;var other$16354;var opts$16285;var opt$16266;var opt$16237;var value$16238;var t0$16231;var t1$16232;var t2$16233;var $16214$16226;var arg$16220;(arg$16220=argv$16116.shift());($16214$16226=arg$16220);(t0$16231=getProjector(RegExp("^--([a-zA-Z_\\-]+)=(.*)",""))($16214$16226));if((t0$16231[0]&&(((t1$16232=t0$16231[1])),(((t2$16233=t1$16232.length)),(t2$16233===3))))){t1$16232[0];(opt$16237=t1$16232[1]);(value$16238=t1$16232[2]);process_option$16132(arg$16220,opt$16237,true);(results$16130[associate$16131]=value$16238);(associate$16131=null);}else{(t0$16231=getProjector(RegExp("^--([a-zA-Z_\\-]+)",""))($16214$16226));if((t0$16231[0]&&(((t1$16232=t0$16231[1])),(((t2$16233=t1$16232.length)),(t2$16233===2))))){t1$16232[0];(opt$16266=t1$16232[1]);process_option$16132(arg$16220,opt$16266,true);}else{(t0$16231=getProjector(RegExp("^-([a-zA-Z_]+)",""))($16214$16226));if((t0$16231[0]&&(((t1$16232=t0$16231[1])),(((t2$16233=t1$16232.length)),(t2$16233===2))))){t1$16232[0];(opts$16285=t1$16232[1]);(acc$16308=[]);(temp$16314=opts$16285);($length$16320=temp$16314.length);($index$16326=0);$16302:for(;($index$16326<$length$16320);($index$16326++)){var ch$16349;var ch$16343;var m$16335;(m$16335=temp$16314[$index$16326]);(ch$16343=m$16335);if(($index$16326===($length$16320-1))){acc$16308.push(process_option$16132(arg$16220,ch$16343,true));}else{(ch$16349=m$16335);acc$16308.push(process_option$16132(arg$16220,ch$16349));}}acc$16308;}else{(other$16354=$16214$16226);if(associate$16131){(results$16130[associate$16131]=other$16354);(associate$16131=null);}else{(other$16368=$16214$16226);argv$16116.unshift(other$16368);break $16209;}}}}}return [results$16130,argv$16116];}));(walk$15685=(function(dir$16376,partial$16377,f$16378){var $index$16410;var $length$16404;var temp$16398;var acc$16392;var stats$16382;(stats$16382=fs$15679.statSync(dir$16376));if(stats$16382.isDirectory()){f$16378("dir",partial$16377);(acc$16392=[]);(temp$16398=fs$15679.readdirSync(dir$16376));($length$16404=temp$16398.length);($index$16410=0);$16387:for(;($index$16410<$length$16404);($index$16410++)){var newdir$16433;var newpartial$16434;var file$16427;var m$16419;(m$16419=temp$16398[$index$16410]);(file$16427=m$16419);acc$16392.push((((newdir$16433=path$15680.join(dir$16376,file$16427))),((newpartial$16434=path$15680.join(partial$16377,file$16427))),walk$15685(newdir$16433,newpartial$16434,f$16378)));}return acc$16392;}else{return f$16378("file",partial$16377);}}));(copy$15686=(function(src$16446,dest$16447){var data$16451;(data$16451=fs$15679.readFileSync(src$16446,"binary"));return fs$15679.writeFileSync(dest$16447,data$16451,"binary");}));(gen$15687=(function(){var g$16484;var text$16473;var file$16474;var noboil$16475;var t0$16469;var $16460$16464;($16460$16464=arguments);(t0$16469=$16460$16464.length);if(((t0$16469>=2)&&(t0$16469<=3))){(text$16473=$16460$16464[0]);(file$16474=$16460$16464[1]);(noboil$16475=(function(){if((2>=t0$16469)){return false;}else{return $16460$16464[2];}})());(g$16484=eg$15672.Generator());return g$16484.generate(Source$15676(text$16473,path$15680.resolve(file$16474)),(!noboil$16475));}else{___match_error($16460$16464);}}));(interactive$15688=(function(g$16495,e$16496){var accum$16516;var repl$16503;var settings$16504;var runner$16505;(repl$16503=require("repl"));(g$16495["interactive"]=true);(settings$16504=__amp____colon__(({"prompt":"<> ","ignoreUndefined":true}),((accum$16516=({})),((accum$16516["eval"]=(function(input$16521,context$16522,filename$16523,callback$16524){var rval$16560;var execute$16534;var handle$16535;var result$16528;(result$16528=(((execute$16534=(function(){var text$16545;(text$16545=g$16495.generate(Source$15676(input$16521.slice(1,-1),"<interactive>")));return e$16496(text$16545);}))),((handle$16535=(function(e$16554){display_error$15682(e$16554);return (void 0);}))),(((rval$16560=false)),((function(){try{(rval$16560=execute$16534());}catch(excv$16571){var e$16577;(e$16577=excv$16571);(rval$16560=handle$16535(e$16577));}})(),rval$16560))));return callback$16524(null,result$16528);})),accum$16516))));(runner$16505=repl$16503.start(settings$16504));return runner$16505.on("exit",(function(){return runner$16505.outputStream.write("\n");}));}));(compile_path$15689=(function(p$16596,opts$16597){var out$16624;var $16828$16831;var beaut$16832;var name$16886;var name$16867;var t0$16861;var t1$16862;var t2$16863;var $16851$16856;var noext$16848;var $16805$16822;var $16801$16816;var data$16806;var code$16807;var $16604$16617;var $16601$16611;var stats$16605;(stats$16605=fs$15679.statSync(p$16596));($16601$16611=null);$16601$16611;if(stats$16605.isDirectory()){if(opts$16597.print){usage_error$15683("Cannot use --print when compiling a directory");}(out$16624=(opts$16597.output||p$16596));return walk$15685(p$16596,"/",(function(){var rval$16697;var to$16689;var from$16683;var t0$16749;var t1$16750;var x$16743;var name$16744;var from$16745;var to$16746;var data$16747;var from$16783;var to$16784;var f$16778;var results$16730;var t0$16726;var $16636$16722;var d$16670;var $16640$16665;var $16641$16666;var $16642$16667;var t0$16662;var t1$16663;var $16633$16654;var t0$16650;var $16631$16645;($16631$16645=arguments);(t0$16650=$16631$16645.length);if((t0$16650>=0)){($16633$16654=Array.prototype.slice.call($16631$16645,0));(t0$16662=$16633$16654);(t1$16663=t0$16662.length);if((($16642$16667=(t1$16663===2))&&(t0$16662[0]==="dir"))){(d$16670=t0$16662[1]);(from$16683=path$15680.join(p$16596,d$16670));if(opts$16597.output){(to$16689=path$15680.join(out$16624,d$16670));(rval$16697=false);try{(rval$16697=fs$15679.mkdirSync(to$16689));}catch(excv$16708){var e$16714;(e$16714=excv$16708);(rval$16697="ignore error");}return rval$16697;}}else{if(($16642$16667&&(t0$16662[0]==="file"))){($16636$16722=t0$16662[1]);(t0$16726=getProjector(RegExp("(?:^((?:.*))\\.eg$)",""))($16636$16722));if((t0$16726[0]&&((results$16730=t0$16726[1]),results$16730))){(t0$16749=results$16730);if(((t0$16749 instanceof Array)&&(((t1$16750=t0$16749.length)),(t1$16750===2)))){(x$16743=t0$16749[0]);(name$16744=t0$16749[1]);}else{___match_error(results$16730,"/home/olivier/git/eg/src/run.eg",5911,5918);}(from$16745=path$15680.join(p$16596,x$16743));(to$16746=path$15680.join(out$16624,(name$16744+".js")));(data$16747=fs$15679.readFileSync(from$16745,"utf8"));return fs$15679.writeFileSync(to$16746,(gen$15687(data$16747,from$16745,opts$16597.noboil)+"\n"));}else{$16636$16722;if((!opts$16597.output)){return null;}else{(f$16778=$16636$16722);(from$16783=path$15680.join(p$16596,f$16778));(to$16784=path$15680.join(out$16624,f$16778));return copy$15686(from$16783,to$16784);}}}else{___match_error($16633$16654,"/home/olivier/git/eg/src/run.eg",5578,5583);}}}else{___match_error($16631$16645);}}));}else{(data$16806=fs$15679.readFileSync(p$16596,"utf8"));(code$16807=gen$15687(data$16806,p$16596,opts$16597.noboil));($16801$16816=null);$16801$16816;if(opts$16597.print){($16828$16831=require("js-beautify"));(beaut$16832=$16828$16831.js);return console.log(beaut$16832(code$16807));}else{if(opts$16597.output){return fs$15679.writeFileSync(opts$16597.output,(code$16807+"\n"));}else{(noext$16848=((($16851$16856=p$16596)),(((t0$16861=getProjector(RegExp("^(.*).eg$",""))($16851$16856))),(function(){if((t0$16861[0]&&(((t1$16862=t0$16861[1])),(((t2$16863=t1$16862.length)),(t2$16863===2))))){t1$16862[0];(name$16867=t1$16862[1]);return name$16867;}else{(name$16886=$16851$16856);return name$16886;}})())));return fs$15679.writeFileSync((noext$16848+".js"),(code$16807+"\n"));}}}}));(run$15690=(function(argv$16894){var t0$16903;var t1$16904;var rval$16919;var opts$16898;var cmd$16899;(t0$16903=extract_options$15684(argv$16894,({"h":["flag","help"],"help":["flag","help"],"v":["flag","version"],"version":["flag","version"]}),"global option"));if(((t0$16903 instanceof Array)&&(((t1$16904=t0$16903.length)),(t1$16904===2)))){(opts$16898=t0$16903[0]);(cmd$16899=t0$16903[1]);}else{___match_error(extract_options$15684(argv$16894,({"h":["flag","help"],"help":["flag","help"],"v":["flag","version"],"version":["flag","version"]}),"global option"),"/home/olivier/git/eg/src/run.eg",7032,7218);}(rval$16919=false);try{(rval$16919=_run$15691(cmd$16899,opts$16898));}catch(excv$16930){var e$16936;(e$16936=excv$16930);(rval$16919=(display_error$15682(e$16936),process.exit(1)));}return rval$16919;}));(_run$15691=(function($16947$16950,opts$16951){var t0$17002;var t0$17009;var t0$17043;var t1$17044;var data$17098;var file$17089;var $17068$17078;var t0$17076;var $17064$17071;var data$17146;var file$17137;var $17116$17126;var t0$17124;var $17112$17119;var t0$17058;var t1$17059;var o$17033;var rest$17034;var file$17035;var wd$17036;var data$17037;var args$17038;var e$17039;var g$17040;var result$17041;var t0$17184;var t1$17185;var $17218$17231;var $17215$17225;var code$17219;var $index$17290;var $length$17284;var temp$17278;var acc$17272;var paths$17259;var p$17250;var $17179$17207;var $17180$17208;var t0$17205;var $17173$17200;var o$17181;var rest$17182;var data$17518;var $17527$17531;var beaut$17532;var data$17533;var otherwise$17524;var $17330$17347;var $17326$17341;var out$17331;var stats$17332;var $index$17571;var $length$17565;var temp$17559;var acc$17553;var tokens$17709;var walkloc$17599;var stuff$17715;var s$17594;var s$17545;var file$17314;var args$17315;var rawargs$17168;var rawargs$17018;var $16965$16983;var $16966$16984;var $16967$16985;var bridge$16957$16979;var t0$16980;var bridge$16961$16981;var $16953$16974;var ph$16968;(ph$16968=$16947$16950);($16953$16974=ph$16968);$16953$16974;if(opts$16951.help){return console.log(usage$15681);}else{if(opts$16951.version){return console.log("Earl Grey version",eg$15672.version);}else{(bridge$16957$16979=$16953$16974);if((((bridge$16957$16979 instanceof Array)&&(((t0$17002=bridge$16957$16979.length)),(t0$17002===0)))||((bridge$16957$16979 instanceof Array)&&(((t0$17009=bridge$16957$16979.length)),((t0$17009===1)&&(bridge$16957$16979[0]==="run")))))){return _run$15691(["run","-i"],opts$16951);}else{if((($16965$16983=($16953$16974 instanceof Array))&&(((t0$16980=$16953$16974.length)),(($16967$16985=(t0$16980>=1))&&($16953$16974[0]==="run"))))){(rawargs$17018=Array.prototype.slice.call($16953$16974,1));(t0$17043=extract_options$15684(rawargs$17018,({"e":["value","evaluate"],"eval":["value","evaluate"],"p":["flag","print"],"print":["flag","print"],"i":["flag","interactive"],"interactive":["flag","interactive"]}),"option for run"));if(((t0$17043 instanceof Array)&&(((t1$17044=t0$17043.length)),(t1$17044===2)))){(o$17033=t0$17043[0]);(rest$17034=t0$17043[1]);}else{___match_error(extract_options$15684(rawargs$17018,({"e":["value","evaluate"],"eval":["value","evaluate"],"p":["flag","print"],"print":["flag","print"],"i":["flag","interactive"],"interactive":["flag","interactive"]}),"option for run"),"/home/olivier/git/eg/src/run.eg",7563,7610);}(t0$17058=(function(){if(o$17033.evaluate){return ["<repl>",process.cwd(),o$17033.evaluate,rest$17034];}else{($17064$17071=rest$17034.shift());if((($17068$17078=($17064$17071===(void 0)))&&o$17033.interactive)){return ["<repl>",process.cwd(),"",rest$17034];}else{if($17068$17078){return usage_error$15683("No filename specified.");}else{(t0$17076=getProjector(path$15680.resolve)($17064$17071));if(t0$17076[0]){(file$17089=t0$17076[1]);(data$17098=fs$15679.readFileSync(file$17089,"utf8"));return [file$17089,file$17089,data$17098,rest$17034];}else{___match_error($17064$17071);}}}}})());if(((t0$17058 instanceof Array)&&(((t1$17059=t0$17058.length)),(t1$17059===4)))){(file$17035=t0$17058[0]);(wd$17036=t0$17058[1]);(data$17037=t0$17058[2]);(args$17038=t0$17058[3]);}else{___match_error((function(){if(o$17033.evaluate){return ["<repl>",process.cwd(),o$17033.evaluate,rest$17034];}else{($17112$17119=rest$17034.shift());if((($17116$17126=($17112$17119===(void 0)))&&o$17033.interactive)){return ["<repl>",process.cwd(),"",rest$17034];}else{if($17116$17126){return usage_error$15683("No filename specified.");}else{(t0$17124=getProjector(path$15680.resolve)($17112$17119));if(t0$17124[0]){(file$17137=t0$17124[1]);(data$17146=fs$15679.readFileSync(file$17137,"utf8"));return [file$17137,file$17137,data$17146,rest$17034];}else{___match_error($17112$17119);}}}}})(),"/home/olivier/git/eg/src/run.eg",7868,8371);}(process["argv"]=["earl-run",file$17035].concat(rest$17034));(e$17039=eg$15672.evaluator(({"filename":file$17035,"showname":file$17035,"cwd":file$17035})));(g$17040=eg$15672.Generator(o$17033.interactive));(result$17041=e$17039(g$17040.generate(Source$15676(data$17037,file$17035))));if(o$17033.print){console.log(result$17041);}if(o$17033.interactive){return interactive$15688(g$17040,e$17039);}}else{if(($16967$16985&&($16953$16974[0]==="compile"))){(rawargs$17168=Array.prototype.slice.call($16953$16974,1));(t0$17184=extract_options$15684(rawargs$17168,({"o":["value","output"],"output":["value","output"],"p":["flag","print"],"print":["flag","print"],"e":["value","evaluate"],"eval":["value","evaluate"],"n":["flag","noboil"],"noboil":["flag","noboil"]}),"option for compile"));if(((t0$17184 instanceof Array)&&(((t1$17185=t0$17184.length)),(t1$17185===2)))){(o$17181=t0$17184[0]);(rest$17182=t0$17184[1]);}else{___match_error(extract_options$15684(rawargs$17168,({"o":["value","output"],"output":["value","output"],"p":["flag","print"],"print":["flag","print"],"e":["value","evaluate"],"eval":["value","evaluate"],"n":["flag","noboil"],"noboil":["flag","noboil"]}),"option for compile"),"/home/olivier/git/eg/src/run.eg",8763,8814);}($17173$17200=rest$17182);$17173$17200;if(o$17181.evaluate){(code$17219=gen$15687(o$17181.evaluate,"<cli>",o$17181.noboil));($17215$17225=null);$17215$17225;if(o$17181.output){return fs$15679.writeFileSync(o$17181.output,(code$17219+"\n"));}else{return console.log(code$17219);}}else{if((($17179$17207=($17173$17200 instanceof Array))&&(((t0$17205=$17173$17200.length)),(t0$17205===0)))){return usage_error$15683("Must provide at least one file or directory to compile.");}else{if(($17179$17207&&(t0$17205===1))){(p$17250=$17173$17200[0]);return compile_path$15689(p$17250,o$17181);}else{$17173$17200;if(o$17181.output){return usage_error$15683("The -o option cannot be used if more than one file or directory is compiled.");}else{if((($17173$17200 instanceof Array)&&(((t0$17205=$17173$17200.length)),(t0$17205>=0)))){(paths$17259=Array.prototype.slice.call($17173$17200,0));(acc$17272=[]);(temp$17278=paths$17259);($length$17284=temp$17278.length);($index$17290=0);$17267:for(;($index$17290<$length$17284);($index$17290++)){var p$17307;var m$17299;(m$17299=temp$17278[$index$17290]);(p$17307=m$17299);acc$17272.push(compile_path$15689(p$17307,o$17181));}return acc$17272;}else{___match_error($17173$17200);}}}}}}else{if(($16965$16983&&((t0$16980>=2)&&(((bridge$16961$16981=$16953$16974[0])),((bridge$16961$16981==="tr")||(bridge$16961$16981==="translate")))))){(file$17314=$16953$16974[1]);(args$17315=Array.prototype.slice.call($16953$16974,2));(out$17331=args$17315[0]);(stats$17332=fs$15679.statSync(file$17314));($17326$17341=null);$17326$17341;if(stats$17332.isDirectory()){return walk$15685(file$17314,"/",(function(){var rval$17418;var from$17406;var to$17407;var t0$17470;var t1$17471;var x$17464;var name$17465;var from$17466;var to$17467;var data$17468;var from$17500;var to$17501;var f$17495;var results$17451;var t0$17447;var $17359$17443;var d$17392;var $17362$17387;var $17363$17388;var $17364$17389;var t0$17384;var t1$17385;var $17356$17376;var t0$17372;var $17354$17367;($17354$17367=arguments);(t0$17372=$17354$17367.length);if((t0$17372>=0)){($17356$17376=Array.prototype.slice.call($17354$17367,0));(t0$17384=$17356$17376);(t1$17385=t0$17384.length);if((($17364$17389=(t1$17385===2))&&(t0$17384[0]==="dir"))){(d$17392=t0$17384[1]);(from$17406=path$15680.join(file$17314,d$17392));(to$17407=path$15680.join(out$17331,d$17392));(rval$17418=false);try{(rval$17418=fs$15679.mkdirSync(to$17407));}catch(excv$17429){var e$17435;(e$17435=excv$17429);(rval$17418="ignore error");}return rval$17418;}else{if(($17364$17389&&(t0$17384[0]==="file"))){($17359$17443=t0$17384[1]);(t0$17447=getProjector(RegExp("(?:^((?:.*))\\.eg$)",""))($17359$17443));if((t0$17447[0]&&((results$17451=t0$17447[1]),results$17451))){(t0$17470=results$17451);if(((t0$17470 instanceof Array)&&(((t1$17471=t0$17470.length)),(t1$17471===2)))){(x$17464=t0$17470[0]);(name$17465=t0$17470[1]);}else{___match_error(results$17451,"/home/olivier/git/eg/src/run.eg",10256,10263);}(from$17466=path$15680.join(file$17314,x$17464));(to$17467=path$15680.join(out$17331,(name$17465+".js")));(data$17468=fs$15679.readFileSync(from$17466,"utf8"));return fs$15679.writeFileSync(to$17467,(gen$15687(data$17468,from$17466)+"\n"));}else{(f$17495=$17359$17443);(from$17500=path$15680.join(file$17314,f$17495));(to$17501=path$15680.join(out$17331,f$17495));return copy$15686(from$17500,to$17501);}}else{___match_error($17356$17376,"/home/olivier/git/eg/src/run.eg",9936,9941);}}}else{___match_error($17354$17367);}}));}else{if(out$17331){(data$17518=fs$15679.readFileSync(file$17314,"utf8"));return fs$15679.writeFileSync(out$17331,(gen$15687(data$17518,file$17314)+"\n"));}else{(otherwise$17524=$17326$17341);($17527$17531=require("js-beautify"));(beaut$17532=$17527$17531.js);(data$17533=fs$15679.readFileSync(file$17314,"utf8"));return console.log(beaut$17532(gen$15687(data$17533,file$17314)));}}}else{if(($16965$16983&&(($16967$16985=(t0$16980===2))&&($16953$16974[0]==="tok")))){(s$17545=$16953$16974[1]);(acc$17553=[]);(temp$17559=eg$15672.tokenize(Source$15676(s$17545,null)));($length$17565=temp$17559.length);($index$17571=0);$17548:for(;($index$17571<$length$17565);($index$17571++)){var token$17588;var m$17580;(m$17580=temp$17559[$index$17571]);(token$17588=m$17580);acc$17553.push((__lt____gt__$15674(null,token$17588),__lt____gt__$15674(null,token$17588.location.ref()),__lt____gt__$15674(null,token$17588.location.highlight())));}return acc$17553;}else{if(($16967$16985&&($16953$16974[0]==="pa"))){(s$17594=$16953$16974[1]);(walkloc$17599=(function($17603$17606){var t0$17618;var $index$17684;var $length$17678;var temp$17672;var acc$17666;var type$17656;var args$17657;var x$17650;var x$17639;var $17612$17634;var $17613$17635;var $17614$17636;var t0$17632;var $17608$17627;var ph$17615;var node$17616;(t0$17618=$17603$17606);(node$17616=t0$17618);(ph$17615=t0$17618);($17608$17627=ph$17615);if((($17612$17634=($17608$17627 instanceof Array))&&(((t0$17632=$17608$17627.length)),(($17614$17636=(t0$17632===2))&&($17608$17627[0]==="symbol"))))){(x$17639=$17608$17627[1]);__lt____gt__$15674(null,node$17616);return __lt____gt__$15674(null,(node$17616.location&&node$17616.location.highlight()));}else{if(($17614$17636&&($17608$17627[0]==="value"))){(x$17650=$17608$17627[1]);__lt____gt__$15674(null,node$17616);return __lt____gt__$15674(null,(node$17616.location&&node$17616.location.highlight()));}else{if(($17612$17634&&(t0$17632>=1))){(type$17656=$17608$17627[0]);(args$17657=Array.prototype.slice.call($17608$17627,1));__lt____gt__$15674(null,node$17616);__lt____gt__$15674(null,(node$17616.location&&node$17616.location.highlight()));(acc$17666=[]);(temp$17672=args$17657);($length$17678=temp$17672.length);($index$17684=0);$17661:for(;($index$17684<$length$17678);($index$17684++)){var arg$17701;var m$17693;(m$17693=temp$17672[$index$17684]);(arg$17701=m$17693);acc$17666.push(walkloc$17599(arg$17701));}return acc$17666;}else{___match_error($17608$17627);}}}}));return walkloc$17599((((tokens$17709=eg$15672.tokenize(Source$15676(s$17594,null)))),eg$15672.parse(tokens$17709)));}else{(stuff$17715=$16953$16974);return usage_error$15683(("Invalid use. Did you mean: earl run "+stuff$17715.join(" ")));}}}}}}}}}));(exports["run"]=run$15690);
