var $14939=function(type$14941){var f$14944;(f$14944=type$14941["::check"]);;if((f$14944===(void 0))){return function(value$14949){return (value$14949 instanceof type$14941);};}else{return function(value$14952){return f$14944.call(type$14941,value$14952);};}};
var $14954=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $14955=function($14956$14958){var ph$14962;(ph$14962=$14956$14958);;var $14960$14967;($14960$14967=ph$14962);;var bridge$14961$14972;var x$14976;(bridge$14961$14972=$14960$14967);if((((typeof(bridge$14961$14972)==="string")&&((x$14976=bridge$14961$14972),true))||((typeof(bridge$14961$14972)==="number")&&((x$14976=bridge$14961$14972),true)))){return ["value",x$14976];}else{var other$14983;(other$14983=$14960$14967);return other$14983["::serialize_ast"]();}};
var send$14779;(send$14779=function(obj$14784,$14782$14785){var ph$14789;var msg$14790;var t0$14792;(t0$14792=$14782$14785);(msg$14790=t0$14792);(ph$14789=t0$14792);;var $14787$14796;($14787$14796=ph$14789);;var bridge$14788$14801;(bridge$14788$14801=$14787$14796);if(((typeof(bridge$14788$14801)==="string")||(typeof(bridge$14788$14801)==="number"))){return obj$14784[msg$14790];}else{var other$14809;(other$14809=$14787$14796);return obj$14784["::send"](msg$14790);}});;(Array[":::project"]=function($14812$14814){var ph$14817;var value$14818;var t0$14820;(t0$14820=$14812$14814);(value$14818=t0$14820);(ph$14817=t0$14820);;var $14816$14824;($14816$14824=ph$14817);;if($14939(Array)($14816$14824)){return [true,value$14818];}else{$14816$14824;return [true,[value$14818]];}});(Array.prototype["::check"]=function(value$14838){if((value$14838 instanceof Array)){var i$14843;(i$14843=0);;$14841:for(;(i$14843<this.length);(i$14843++)){if(($14954(this,i$14843)!==$14954(value$14838,i$14843))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return this.slice(0);});(Array.prototype[":::project"]=function(value$14854){if((value$14854 instanceof Array)){var i$14859;(i$14859=0);;$14857:for(;(i$14859<this.length);(i$14859++)){if(($14954(this,i$14859)!==$14954(value$14854,i$14859))){return [true,[value$14854]];}}return [true,value$14854.slice(this.length)];}else{return [true,[value$14854]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($14955));});(RegExp.prototype["::check"]=function($14869$14871){var ph$14874;(ph$14874=$14869$14871);;var $14873$14879;($14873$14879=ph$14874);;var value$14887;if((typeof($14873$14879)==="string")){(value$14887=$14873$14879);if(value$14887.match(this)){return true;}else{return false;}}else{var other$14892;(other$14892=$14873$14879);return false;}});(RegExp.prototype[":::project"]=function($14894$14896){var ph$14899;(ph$14899=$14894$14896);;var $14898$14904;($14898$14904=ph$14899);;var value$14912;if((typeof($14898$14904)==="string")){(value$14912=$14898$14904);var $14915$14917;($14915$14917=value$14912.match(this));;var m$14925;if(($14915$14917===null)){(m$14925=$14915$14917);return [false,null];}else{var m$14930;(m$14930=$14915$14917);return [true,m$14930];}}else{var other$14934;(other$14934=$14898$14904);return [false,null];}});(Function.prototype["::send"]=function(args$14937){return this.apply(this,args$14937);});
var $15614=function(dest$15616,values$15617){var k$15622;(k$15622=null);$15620:for(k$15622 in values$15617){if(values$15617.hasOwnProperty(k$15622)){(dest$15616[k$15622]=values$15617[k$15622]);}}return dest$15616;};
var $15626=function(type$15628){return function(value$15631){var f$15634;(f$15634=type$15628[":::project"]);;if((f$15634===(void 0))){var f$15639;(f$15639=type$15628["::project"]);;if((f$15639===(void 0))){return [true,type$15628(value$15631)];}else{var rval$15644;(rval$15644=false);;try{(rval$15644=[true,f$15639(value$15631)]);}catch(excv$15650){var e$15656;(e$15656=excv$15650);(rval$15644=[false,null]);}return rval$15644;}}else{return f$15634.call(type$15628,value$15631);}};};
var $15840=function(arr$15842){var results$15846;var l$15847;(results$15846=[]);;(l$15847=arr$15842.length);;var i$15855;(i$15855=0);;$15845:for(;(i$15855<l$15847);(i$15855++)){results$15846.push([i$15855,$14954(arr$15842,i$15855)]);}return results$15846;};
var $15671=function(){var $15672$15674;($15672$15674=function(tags$15678){var it$0$15681;(it$0$15681=function(){if((!$14939($15672$15674)(this))){return Object.create($15672$15674.prototype);}else{return this;}}());;(it$0$15681["tags"]=tags$15678);return it$0$15681;});;($15672$15674.prototype["create"]=function(){var $15690$15692;($15690$15692=arguments);;var t0$15697;var message$15701;var args$15702;(t0$15697=$15690$15692.length);if((t0$15697>=0)){(message$15701=function(){if((0>=t0$15697)){return "";}else{return $15690$15692[0];}}());(args$15702=Array.prototype.slice.call($15690$15692,1));var it$0$15706;(it$0$15706=this);;var self$15711;(self$15711=this);;var e$15716;(e$15716=Error(message$15701));;(e$15716["::tags"]=it$0$15706.tags);(e$15716["args"]=args$15702);var temp$15724;(temp$15724=$15840(args$15702));;var $length$15729;($length$15729=temp$15724.length);;var $index$15734;($index$15734=0);;$15717:for(;($index$15734<$length$15729);($index$15734++)){var m$15742;(m$15742=temp$15724[$index$15734]);;var t0$15747;var t1$15748;var i$15752;var arg$15753;(t0$15747=m$15742);if(((t0$15747 instanceof Array)&&((t1$15748=t0$15747.length),(t1$15748===2)))){(i$15752=t0$15747[0]);(arg$15753=t0$15747[1]);(e$15716[i$15752]=arg$15753);}else{$15658(m$15742);;}}(e$15716["length"]=args$15702.length);(e$15716["name"]=["E"].concat(it$0$15706.tags).join("."));return e$15716;}else{$15658($15690$15692);}});($15672$15674.prototype["::check"]=function(e$15764){var it$0$15767;(it$0$15767=this);;var self$15772;(self$15772=this);;var tags$15777;if(((!e$15764)||(!$14939(Error)(e$15764)))){return false;}(tags$15777=(e$15764["::tags"]||[]));;var temp$15786;(temp$15786=it$0$15767.tags);;var $length$15791;($length$15791=temp$15786.length);;var $index$15796;($index$15796=0);;$15778:for(;($index$15796<$length$15791);($index$15796++)){var m$15804;(m$15804=temp$15786[$index$15796]);;var tag$15812;(tag$15812=m$15804);if((tags$15777.indexOf(tag$15812)===-1)){return false;}else{false;;}}return true;});($15672$15674.prototype["::deconstruct"]=function(e$15820){var it$0$15823;(it$0$15823=this);;var self$15828;(self$15828=this);;return e$15820.args;});$15614($15672$15674,$15614(function(){var accum$15833;(accum$15833=({}));(accum$15833["::name"]="$15672");return accum$15833;}(),function(){var accum$15837;(accum$15837=({}));(accum$15837["::egclass"]=true);return accum$15837;}()));return $15672$15674;}();
var $15658=function(value$15660,url$15661,start$15662,end$15663){var err$15666;(err$15666=$15671(["match"]).create("Could not find a match for value",({"value":value$15660})));;if(url$15661){(err$15666["location"]=["location",url$15661,start$15662,end$15663]);}throw err$15666;};var eg$14990;var $14987$14991;var __lt____gt__$14992;var Node$14993;var $14988$14994;var enumerate$14995;var items$14996;var $14989$14997;var Source$14998;var display_error$14999;var fs$15000;var path$15001;var vm$15002;var usage$15003;var walk$15004;var copy$15005;var gen$15006;var run$15007;var _run$15008;(eg$14990=require("./earl-grey"));;($14987$14991=require("./pp"));;(__lt____gt__$14992=$14987$14991["<>"]);;(Node$14993=$14987$14991.Node);;($14988$14994=require("./util"));;(enumerate$14995=$14988$14994.enumerate);;(items$14996=$14988$14994.items);;($14989$14997=require("./location"));;(Source$14998=$14989$14997.Source);;(display_error$14999=$14989$14997.display_error);;(fs$15000=require("fs"));;(path$15001=require("path"));;(vm$15002=require("vm"));;(usage$15003="\nusage:\n\nearl translate <file> [outfile]\n  Translate a source file, output to outfile. Without outfile\n  specified, print to standard out.\n\nearl translate <directory> <outdir>\n  Translate all the .eg files in the specified directory.\n\nearl run [file] [arguments...]\n  Run the specified file as a script.\n");;(walk$15004=function(dir$15054,partial$15055,f$15056){var $index$15082;var $length$15077;var temp$15072;var acc$15067;var stats$15059;(stats$15059=fs$15000.statSync(dir$15054));;if(stats$15059.isDirectory()){f$15056("dir",partial$15055);(acc$15067=[]);;(temp$15072=fs$15000.readdirSync(dir$15054));;($length$15077=temp$15072.length);;($index$15082=0);;$15064:for(;($index$15082<$length$15077);($index$15082++)){var newdir$15101;var newpartial$15102;var file$15098;var m$15090;(m$15090=temp$15072[$index$15082]);;(file$15098=m$15090);acc$15067.push((((newdir$15101=path$15001.join(dir$15054,file$15098))),((newpartial$15102=path$15001.join(partial$15055,file$15098))),walk$15004(newdir$15101,newpartial$15102,f$15056)));}return acc$15067;}else{return f$15056("file",partial$15055);}});;(copy$15005=function(src$15113,dest$15114){var data$15117;(data$15117=fs$15000.readFileSync(src$15113,"binary"));;return fs$15000.writeFileSync(dest$15114,data$15117,"binary");});;(gen$15006=function(text$15125,file$15126){var g$15129;(g$15129=eg$14990.Generator());;return g$15129.generate(Source$14998(text$15125,path$15001.resolve(file$15126)));});;(run$15007=function(cmd$15137){var rval$15140;(rval$15140=false);;try{(rval$15140=_run$15008(cmd$15137));}catch(excv$15146){var e$15152;(e$15152=excv$15146);(rval$15140=(display_error$14999(e$15152),process.exit(1)));}return rval$15140;});;(_run$15008=function($15158$15160){var t0$15191;var bridge$15165$15199;var t0$15194;var bridge$15164$15195;var accum$15216;var repl$15203;var g$15204;var settings$15205;var run$15206;var data$15278;var data$15426;var $15435$15436;var beaut$15437;var data$15438;var otherwise$15432;var $15291$15307;var $15290$15301;var out$15292;var stats$15293;var $index$15471;var $length$15466;var temp$15461;var acc$15456;var tokens$15584;var walkloc$15496;var code$15594;var code$15604;var other$15610;var data$15600;var data$15590;var s$15492;var s$15450;var file$15284;var args$15285;var file$15273;var $15167$15184;var $15168$15185;var $15169$15186;var bridge$15163$15180;var t0$15181;var bridge$15166$15182;var $15162$15175;var ph$15170;(ph$15170=$15158$15160);;($15162$15175=ph$15170);;(bridge$15163$15180=$15162$15175);if((((bridge$15163$15180 instanceof Array)&&((t0$15191=bridge$15163$15180.length),(t0$15191===0)))||((bridge$15163$15180 instanceof Array)&&((t0$15194=bridge$15163$15180.length),((t0$15194===1)&&((bridge$15164$15195=bridge$15163$15180[0]),(((bridge$15165$15199=bridge$15164$15195),((bridge$15165$15199==="i")||(bridge$15165$15199==="in")))||(bridge$15164$15195==="interactive")))))))){(repl$15203=require("repl"));;(g$15204=eg$14990.Generator());;(settings$15205=$15614(({"prompt":"<> ","ignoreUndefined":true}),((accum$15216=({})),((accum$15216["eval"]=function(input$15220,context$15221,filename$15222,callback$15223){var rval$15250;var execute$15230;var handle$15231;var result$15226;(result$15226=(((execute$15230=function(){var text$15237;(text$15237=g$15204.generate(Source$14998(input$15220.slice(1,-1),"<interactive>")));;return vm$15002.runInThisContext(text$15237,"stdin");})),((handle$15231=function(e$15245){display_error$14999(e$15245);return (void 0);})),(((rval$15250=false)),(function(){try{(rval$15250=execute$15230());}catch(excv$15256){var e$15262;(e$15262=excv$15256);(rval$15250=handle$15231(e$15262));}}(),rval$15250))));;return callback$15223(null,result$15226);}),accum$15216))));;(run$15206=repl$15203.start(settings$15205));;return run$15206.on("exit",function(){return run$15206.outputStream.write("\n");});}else{if((($15167$15184=($15162$15175 instanceof Array))&&((t0$15181=$15162$15175.length),((t0$15181===2)&&($15162$15175[0]==="run"))))){(file$15273=$15162$15175[1]);(data$15278=fs$15000.readFileSync(file$15273,"utf8"));;return eval(gen$15006(data$15278,file$15273));}else{if(($15167$15184&&((t0$15181>=2)&&((bridge$15166$15182=$15162$15175[0]),((bridge$15166$15182==="tr")||(bridge$15166$15182==="translate")))))){(file$15284=$15162$15175[1]);(args$15285=Array.prototype.slice.call($15162$15175,2));(out$15292=args$15285[0]);;(stats$15293=fs$15000.statSync(file$15284));;($15290$15301=null);;$15290$15301;if(stats$15293.isDirectory()){return walk$15004(file$15284,"/",function(){var rval$15354;var from$15345;var to$15346;var t0$15389;var t1$15390;var x$15383;var name$15384;var from$15385;var to$15386;var data$15387;var from$15409;var to$15410;var f$15406;var results$15378;var t0$15374;var $15315$15370;var d$15341;var $15316$15336;var $15317$15337;var $15318$15338;var t0$15333;var t1$15334;var $15314$15329;var t0$15325;var $15313$15320;($15313$15320=arguments);;(t0$15325=$15313$15320.length);if((t0$15325>=0)){($15314$15329=Array.prototype.slice.call($15313$15320,0));(t0$15333=$15314$15329);(t1$15334=t0$15333.length);if((($15318$15338=(t1$15334===2))&&(t0$15333[0]==="dir"))){(d$15341=t0$15333[1]);(from$15345=path$15001.join(file$15284,d$15341));;(to$15346=path$15001.join(out$15292,d$15341));;(rval$15354=false);;try{(rval$15354=fs$15000.mkdirSync(to$15346));}catch(excv$15360){var e$15366;(e$15366=excv$15360);(rval$15354="ignore error");}return rval$15354;}else{if(($15318$15338&&(t0$15333[0]==="file"))){($15315$15370=t0$15333[1]);(t0$15374=$15626(RegExp("(?:^((?:.*))\\.eg$)",""))($15315$15370));if((t0$15374[0]&&((results$15378=t0$15374[1]),results$15378))){(t0$15389=results$15378);if(((t0$15389 instanceof Array)&&((t1$15390=t0$15389.length),(t1$15390===2)))){(x$15383=t0$15389[0]);(name$15384=t0$15389[1]);;}else{$15658(results$15378,"/home/olivier/git/earl-grey/src/run.eg",2517,2524);}(from$15385=path$15001.join(file$15284,x$15383));;(to$15386=path$15001.join(out$15292,(name$15384+".js")));;(data$15387=fs$15000.readFileSync(from$15385,"utf8"));;return fs$15000.writeFileSync(to$15386,(gen$15006(data$15387,from$15385)+"\n"));}else{(f$15406=$15315$15370);(from$15409=path$15001.join(file$15284,f$15406));;(to$15410=path$15001.join(out$15292,f$15406));;return copy$15005(from$15409,to$15410);}}else{$15658($15314$15329,"/home/olivier/git/earl-grey/src/run.eg",2197,2202);}}}else{$15658($15313$15320);}});}else{if(out$15292){(data$15426=fs$15000.readFileSync(file$15284,"utf8"));;return fs$15000.writeFileSync(out$15292,(gen$15006(data$15426,file$15284)+"\n"));}else{(otherwise$15432=$15290$15301);($15435$15436=require("js-beautify"));;(beaut$15437=$15435$15436.js);;(data$15438=fs$15000.readFileSync(file$15284,"utf8"));;return console.log(beaut$15437(gen$15006(data$15438,file$15284)));}}}else{if(($15167$15184&&(($15169$15186=(t0$15181===2))&&($15162$15175[0]==="tok")))){(s$15450=$15162$15175[1]);(acc$15456=[]);;(temp$15461=eg$14990.tokenize(Source$14998(s$15450,null)));;($length$15466=temp$15461.length);;($index$15471=0);;$15453:for(;($index$15471<$length$15466);($index$15471++)){var token$15487;var m$15479;(m$15479=temp$15461[$index$15471]);;(token$15487=m$15479);acc$15456.push((__lt____gt__$14992(null,token$15487),__lt____gt__$14992(null,token$15487.location.ref()),__lt____gt__$14992(null,token$15487.location.highlight())));}return acc$15456;}else{if(($15169$15186&&($15162$15175[0]==="pa"))){(s$15492=$15162$15175[1]);(walkloc$15496=function($15499$15501){var t0$15510;var $index$15562;var $length$15557;var temp$15552;var acc$15547;var type$15539;var args$15540;var x$15533;var x$15526;var $15504$15521;var $15505$15522;var $15506$15523;var t0$15519;var $15503$15514;var ph$15507;var node$15508;(t0$15510=$15499$15501);(node$15508=t0$15510);(ph$15507=t0$15510);;($15503$15514=ph$15507);;if((($15504$15521=($15503$15514 instanceof Array))&&((t0$15519=$15503$15514.length),(($15506$15523=(t0$15519===2))&&($15503$15514[0]==="symbol"))))){(x$15526=$15503$15514[1]);__lt____gt__$14992(null,node$15508);return __lt____gt__$14992(null,(node$15508.location&&node$15508.location.highlight()));}else{if(($15506$15523&&($15503$15514[0]==="value"))){(x$15533=$15503$15514[1]);__lt____gt__$14992(null,node$15508);return __lt____gt__$14992(null,(node$15508.location&&node$15508.location.highlight()));}else{if(($15504$15521&&(t0$15519>=1))){(type$15539=$15503$15514[0]);(args$15540=Array.prototype.slice.call($15503$15514,1));__lt____gt__$14992(null,node$15508);__lt____gt__$14992(null,(node$15508.location&&node$15508.location.highlight()));(acc$15547=[]);;(temp$15552=args$15540);;($length$15557=temp$15552.length);;($index$15562=0);;$15544:for(;($index$15562<$length$15557);($index$15562++)){var arg$15578;var m$15570;(m$15570=temp$15552[$index$15562]);;(arg$15578=m$15570);acc$15547.push(walkloc$15496(arg$15578));}return acc$15547;}else{$15658($15503$15514);}}}});;return walkloc$15496((((tokens$15584=eg$14990.tokenize(Source$14998(s$15492,null)))),eg$14990.parse(tokens$15584)));}else{if(($15169$15186&&($15162$15175[0]==="runs"))){(data$15590=$15162$15175[1]);(code$15594=gen$15006(data$15590,"<command>"));;return __lt____gt__$14992(null,eval(code$15594));}else{if(($15169$15186&&($15162$15175[0]==="trs"))){(data$15600=$15162$15175[1]);(code$15604=gen$15006(data$15600,"<command>"));;return __lt____gt__$14992(null,code$15604);}else{(other$15610=$15162$15175);return console.log(usage$15003);}}}}}}}});;(exports["run"]=run$15007);
