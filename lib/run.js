var $22390=function(type$22393){var f$22397;(f$22397=type$22393["::check"]);if((f$22397===(void 0))){return function(value$22403){return (value$22403 instanceof type$22393);};}else{return function(value$22407){return f$22397.call(type$22393,value$22407);};}};
var $22409=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $22410=function(dest$22413,values$22414){var k$22419;(k$22419=null);$22417:for(k$22419 in values$22414){if(values$22414.hasOwnProperty(k$22419)){(dest$22413[k$22419]=values$22414[k$22419]);}}return dest$22413;};
var $22427=function($22429$22432){var ph$22438;(ph$22438=$22429$22432);var $22434$22444;($22434$22444=ph$22438);var bridge$22436$22449;var x$22453;(bridge$22436$22449=$22434$22444);if((((typeof(bridge$22436$22449)==="string")&&((x$22453=bridge$22436$22449),true))||((typeof(bridge$22436$22449)==="number")&&((x$22453=bridge$22436$22449),true)))){return ["value",x$22453];}else{var other$22464;(other$22464=$22434$22444);return other$22464["::serialize_ast"]();}};
var send$22164;(send$22164=function(obj$22171,$22168$22172){var ph$22178;var msg$22179;var t0$22181;(t0$22181=$22168$22172);(msg$22179=t0$22181);(ph$22178=t0$22181);var $22174$22190;($22174$22190=ph$22178);var bridge$22176$22195;(bridge$22176$22195=$22174$22190);if(((typeof(bridge$22176$22195)==="string")||(typeof(bridge$22176$22195)==="number"))){return obj$22171[msg$22179];}else{var other$22207;(other$22207=$22174$22190);return obj$22171["::send"](msg$22179);}});(Array[":::project"]=function($22213$22216){var ph$22221;var value$22222;var t0$22224;(t0$22224=$22213$22216);(value$22222=t0$22224);(ph$22221=t0$22224);var $22218$22233;($22218$22233=ph$22221);if($22390(Array)($22218$22233)){return [true,value$22222];}else{$22218$22233;return [true,[value$22222]];}});(Array.prototype["::check"]=function(value$22251){if((value$22251 instanceof Array)){var i$22257;(i$22257=0);$22254:for(;(i$22257<this.length);(i$22257++)){if(($22409(this,i$22257)!==$22409(value$22251,i$22257))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $22410(this.slice(0),this);});(Array.prototype[":::project"]=function(value$22276){if((value$22276 instanceof Array)){var i$22282;(i$22282=0);$22279:for(;(i$22282<this.length);(i$22282++)){if(($22409(this,i$22282)!==$22409(value$22276,i$22282))){return [true,[value$22276]];}}return [true,value$22276.slice(this.length)];}else{return [true,[value$22276]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($22427));});(RegExp.prototype["::check"]=function($22300$22303){var ph$22308;(ph$22308=$22300$22303);var $22305$22314;($22305$22314=ph$22308);var value$22322;if((typeof($22305$22314)==="string")){(value$22322=$22305$22314);if(value$22322.match(this)){return true;}else{return false;}}else{var other$22327;(other$22327=$22305$22314);return false;}});(RegExp.prototype[":::project"]=function($22333$22336){var ph$22341;(ph$22341=$22333$22336);var $22338$22347;($22338$22347=ph$22341);var value$22355;if((typeof($22338$22347)==="string")){(value$22355=$22338$22347);var $22358$22363;($22358$22363=value$22355.match(this));var m$22371;if(($22358$22363===null)){(m$22371=$22358$22363);return [false,null];}else{var m$22376;(m$22376=$22358$22363);return [true,m$22376];}}else{var other$22380;(other$22380=$22338$22347);return [false,null];}});(Function.prototype["::send"]=function(args$22387){return this.apply(this,args$22387);});
var $24217=function(type$24220){return function(value$24224){var f$24228;(f$24228=type$24220[":::project"]);if((f$24228===(void 0))){(f$24228=type$24220["::project"]);if((f$24228===(void 0))){return [true,type$24220(value$24224)];}else{var rval$24241;(rval$24241=false);try{(rval$24241=[true,f$24228(value$24224)]);}catch(excv$24252){var e$24258;(e$24258=excv$24252);(rval$24241=[false,null]);}return rval$24241;}}else{return f$24228.call(type$24220,value$24224);}};};
var $24348=function($24350$24353,key$24354){var ph$24362;(ph$24362=$24350$24353);var $24356$24368;($24356$24368=ph$24362);var bridge$24358$24373;(bridge$24358$24373=$24356$24368);if(((bridge$24358$24373===null)||(bridge$24358$24373===(void 0)))){return false;}else{var x$24385;if((typeof($24356$24368)==="string")){(x$24385=$24356$24368);return (key$24354 in String.prototype);}else{var x$24390;if((typeof($24356$24368)==="number")){(x$24390=$24356$24368);return (key$24354 in Number.prototype);}else{var x$24395;(x$24395=$24356$24368);return (key$24354 in x$24395);}}}};
var $24630=function(arr$24633){var results$24639;var l$24640;(results$24639=[]);(l$24640=arr$24633.length);var i$24649;(i$24649=0);$24638:for(;(i$24649<l$24640);(i$24649++)){results$24639.push([i$24649,$22409(arr$24633,i$24649)]);}return results$24639;};
var $24656=function(value$24659,url$24660,start$24661,end$24662){var err$24666;(err$24666=$24397(["match"]).create("Could not find a match for value",({"value":value$24659})));if(url$24660){(err$24666["location"]=["location",url$24660,start$24661,end$24662]);}throw err$24666;};
var $24397=function(){var $24398$24404;($24398$24404=function(tags$24409){var it$0$24412;(it$0$24412=function(){if((!$22390($24398$24404)(this))){return Object.create($24398$24404.prototype);}else{return this;}}());(it$0$24412["tags"]=tags$24409);return it$0$24412;});($24398$24404.prototype["create"]=function(){var it$0$24432;var self$24433;(it$0$24432=this);(self$24433=this);var $24430$24442;($24430$24442=arguments);var t0$24447;var message$24451;var args$24452;(t0$24447=$24430$24442.length);if((t0$24447>=0)){(message$24451=function(){if((0>=t0$24447)){return "";}else{return $24430$24442[0];}}());(args$24452=Array.prototype.slice.call($24430$24442,1));var e$24465;(e$24465=Error(message$24451));(e$24465["::tags"]=it$0$24432.tags);(e$24465["args"]=args$24452);var temp$24481;(temp$24481=$24630(args$24452));var $length$24487;($length$24487=temp$24481.length);var $index$24493;($index$24493=0);$24466:for(;($index$24493<$length$24487);($index$24493++)){var m$24502;(m$24502=temp$24481[$index$24493]);var t0$24507;var t1$24508;var i$24512;var arg$24513;(t0$24507=m$24502);if(((t0$24507 instanceof Array)&&(((t1$24508=t0$24507.length)),(t1$24508===2)))){(i$24512=t0$24507[0]);(arg$24513=t0$24507[1]);(e$24465[i$24512]=arg$24513);}else{$24656(m$24502);}}(e$24465["length"]=args$24452.length);(e$24465["name"]=["E"].concat(it$0$24432.tags).join("."));return e$24465;}else{$24656($24430$24442);}});($24398$24404.prototype["::check"]=function(e$24543){var it$0$24547;var self$24548;(it$0$24547=this);(self$24548=this);var tags$24558;if(((!e$24543)||(!$22390(Error)(e$24543)))){return false;}(tags$24558=(e$24543["::tags"]||[]));var temp$24569;(temp$24569=it$0$24547.tags);var $length$24575;($length$24575=temp$24569.length);var $index$24581;($index$24581=0);$24559:for(;($index$24581<$length$24575);($index$24581++)){var m$24590;(m$24590=temp$24569[$index$24581]);var tag$24598;(tag$24598=m$24590);if((tags$24558.indexOf(tag$24598)===-1)){return false;}else{false;}}return true;});($24398$24404.prototype["::deconstruct"]=function(e$24607){var it$0$24611;var self$24612;(it$0$24611=this);(self$24612=this);return e$24607.args;});$22410($24398$24404,$22410(function(){var accum$24623;(accum$24623=({}));(accum$24623["::name"]="$24398");return accum$24623;}(),function(){var accum$24627;(accum$24627=({}));(accum$24627["::egclass"]=true);return accum$24627;}()));return $24398$24404;}();
var $24264=function($24266$24269){var ph$24279;var x$24280;var t0$24282;(t0$24282=$24266$24269);(x$24280=t0$24282);(ph$24279=t0$24282);var $24271$24291;($24271$24291=ph$24279);var bridge$24273$24296;(bridge$24273$24296=$24271$24291);if((function(){var bridge$24274$24306;(bridge$24274$24306=bridge$24273$24296);return (function(){var bridge$24275$24313;(bridge$24275$24313=bridge$24274$24306);return ((bridge$24275$24313===(void 0))||(bridge$24275$24313===null));}()||(typeof(bridge$24274$24306)==="string"));}()||(typeof(bridge$24273$24296)==="number"))){return x$24280;}else{if($24348($24271$24291,"::clone")){$24271$24291["::clone"];return x$24280["::clone"]();}else{$24271$24291;if((Object.getPrototypeOf(x$24280)===Object.prototype)){var dest$24331;(dest$24331=({}));var k$24336;(k$24336=null);$24330:for(k$24336 in x$24280){if(Object.prototype.hasOwnProperty.call(x$24280,k$24336)){(dest$24331[k$24336]=x$24280[k$24336]);}}return dest$24331;}else{var other$24346;(other$24346=$24271$24291);throw $24397(["clone"]).create("Object cannot be cloned",({"obj":x$24280}));}}}};var eg$22492;var $22469$22493;var __lt____gt__$22494;var $22470$22495;var Source$22496;var display_error$22497;var fs$22498;var path$22499;var vm$22500;var module$22501;var usage$22502;var usage_error$22503;var extract_options$22504;var walk$22505;var copy$22506;var gen$22507;var evaluator$22508;var interactive$22509;var compile_path$22510;var run$22511;var _run$22512;(eg$22492=require("./earl-grey"));($22469$22493=require("./pp"));(__lt____gt__$22494=$22469$22493["<>"]);($22470$22495=require("./location"));(Source$22496=$22470$22495.Source);(display_error$22497=$22470$22495.display_error);(fs$22498=require("fs"));(path$22499=require("path"));(vm$22500=require("vm"));(module$22501=require("module"));(usage$22502="Usage: earl [global options] command [options] [arguments...]\n\nearl run [options] [file] [arguments...]\n  Run the specified file as a script. The arguments are available in\n  process.argv.slice{2} of the script.\n  Options:\n    -e  --eval <code>  Run the provided code instead of reading from a file.\n    -p  --print        Print the result of the evaluation to standard out.\n    -i  --interactive  Start an interactive interpreter after execution\n                       in the global environment of the script.\n\nearl compile [options] [file... | dir]\n  Compile the specified source files into .js files. The files will be\n  placed next to the originals.\n  If a directory is given, all .eg files in the directory hierarchy\n  will be compiled. The -o option can be used to compile the files\n  into a different directory (all non-eg files will be copied over).\n  Options:\n    -o  --output <dir>  Output in given directory.\n    -p  --print         Print the compiled JavaScript to standard out.\n                        No files are created.\n    -e  --eval <code>   Compile the provided code instead of reading from a file.\n    -n  --noboil        Don't produce boilerplate code (useful with -p)\n\nearl\n  Start an interactive session.\n\nGlobal options:\n  -h  --help      Print this message.\n  -v  --version   Print the version\n");(usage_error$22503=function(message$22550){console.error(usage$22502);console.error(message$22550);return process.exit(1);});(extract_options$22504=function($22557$22560,opttable$22561,optmessage$22562){var t0$22566;var results$22578;var associate$22579;var process_option$22580;var argv$22564;(t0$22566=$24217($24264)($22557$22560));if(t0$22566[0]){(argv$22564=t0$22566[1]);}else{$24656($22557$22560);}(results$22578=({}));(associate$22579=null);(process_option$22580=function(original$22591,opt$22592,last$22593){var name$22647;var name$22637;var name$22623;var $22600$22613;var $22601$22614;var $22602$22615;var $22603$22616;var t0$22611;var $22595$22606;($22595$22606=$22409(opttable$22561,opt$22592));if(($22595$22606===(void 0))){return usage_error$22503(((("Unrecognized "+optmessage$22562)+": ")+original$22591));}else{if((($22600$22613=($22595$22606 instanceof Array))&&(((t0$22611=$22595$22606.length)),(($22602$22615=(t0$22611===2))&&($22595$22606[0]==="flag"))))){(name$22623=$22595$22606[1]);(results$22578[name$22623]=true);}else{if(($22602$22615&&(($22603$22616=($22595$22606[0]==="value"))&&((name$22637=$22595$22606[1]),last$22593)))){(associate$22579=name$22637);}else{if($22603$22616){(name$22647=$22595$22606[1]);(results$22578[name$22647]=true);}else{$24656($22595$22606);}}}}});$22657:while(argv$22564.length){var $index$22774;var $length$22768;var temp$22762;var acc$22756;var other$22816;var other$22802;var opts$22733;var opt$22714;var opt$22685;var value$22686;var t0$22679;var t1$22680;var t2$22681;var $22662$22674;var arg$22668;(arg$22668=argv$22564.shift());($22662$22674=arg$22668);(t0$22679=$24217(RegExp("^--([a-zA-Z_\\-]+)=(.*)",""))($22662$22674));if((t0$22679[0]&&(((t1$22680=t0$22679[1])),(((t2$22681=t1$22680.length)),(t2$22681===3))))){t1$22680[0];(opt$22685=t1$22680[1]);(value$22686=t1$22680[2]);process_option$22580(arg$22668,opt$22685,true);(results$22578[associate$22579]=value$22686);(associate$22579=null);}else{(t0$22679=$24217(RegExp("^--([a-zA-Z_\\-]+)",""))($22662$22674));if((t0$22679[0]&&(((t1$22680=t0$22679[1])),(((t2$22681=t1$22680.length)),(t2$22681===2))))){t1$22680[0];(opt$22714=t1$22680[1]);process_option$22580(arg$22668,opt$22714,true);}else{(t0$22679=$24217(RegExp("^-([a-zA-Z_]+)",""))($22662$22674));if((t0$22679[0]&&(((t1$22680=t0$22679[1])),(((t2$22681=t1$22680.length)),(t2$22681===2))))){t1$22680[0];(opts$22733=t1$22680[1]);(acc$22756=[]);(temp$22762=opts$22733);($length$22768=temp$22762.length);($index$22774=0);$22750:for(;($index$22774<$length$22768);($index$22774++)){var ch$22797;var ch$22791;var m$22783;(m$22783=temp$22762[$index$22774]);(ch$22791=m$22783);if(($index$22774===($length$22768-1))){acc$22756.push(process_option$22580(arg$22668,ch$22791,true));}else{(ch$22797=m$22783);acc$22756.push(process_option$22580(arg$22668,ch$22797));}}acc$22756;}else{(other$22802=$22662$22674);if(associate$22579){(results$22578[associate$22579]=other$22802);(associate$22579=null);}else{(other$22816=$22662$22674);argv$22564.unshift(other$22816);break $22657;}}}}}return [results$22578,argv$22564];});(walk$22505=function(dir$22824,partial$22825,f$22826){var $index$22858;var $length$22852;var temp$22846;var acc$22840;var stats$22830;(stats$22830=fs$22498.statSync(dir$22824));if(stats$22830.isDirectory()){f$22826("dir",partial$22825);(acc$22840=[]);(temp$22846=fs$22498.readdirSync(dir$22824));($length$22852=temp$22846.length);($index$22858=0);$22835:for(;($index$22858<$length$22852);($index$22858++)){var newdir$22881;var newpartial$22882;var file$22875;var m$22867;(m$22867=temp$22846[$index$22858]);(file$22875=m$22867);acc$22840.push((((newdir$22881=path$22499.join(dir$22824,file$22875))),((newpartial$22882=path$22499.join(partial$22825,file$22875))),walk$22505(newdir$22881,newpartial$22882,f$22826)));}return acc$22840;}else{return f$22826("file",partial$22825);}});(copy$22506=function(src$22894,dest$22895){var data$22899;(data$22899=fs$22498.readFileSync(src$22894,"binary"));return fs$22498.writeFileSync(dest$22895,data$22899,"binary");});(gen$22507=function(){var g$22932;var text$22921;var file$22922;var noboil$22923;var t0$22917;var $22908$22912;($22908$22912=arguments);(t0$22917=$22908$22912.length);if(((t0$22917>=2)&&(t0$22917<=3))){(text$22921=$22908$22912[0]);(file$22922=$22908$22912[1]);(noboil$22923=function(){if((2>=t0$22917)){return false;}else{return $22908$22912[2];}}());(g$22932=eg$22492.Generator());return g$22932.generate(Source$22496(text$22921,path$22499.resolve(file$22922)),(!noboil$22923));}else{$24656($22908$22912);}});(evaluator$22508=function(options$22943){var accum$22968;var paths$22950;var e_module$22951;var e_require$22952;(paths$22950=module$22501._nodeModulePaths(options$22943.cwd));(e_module$22951=(new module$22501(options$22943.showname)));$22410(e_module$22951,({"filename":options$22943.filename,"paths":paths$22950}));(e_require$22952=function(path$22963){return module$22501._load(path$22963,e_module$22951,true);});$22410(e_require$22952,$22410(({"main":e_module$22951}),$22410(((accum$22968=({})),((accum$22968["resolve"]=function(path$22973){return module$22501._resolveFileName(path$22973,e_module$22951);}),accum$22968)),({"paths":paths$22950,"cache":require.cache}))));$22410(global,({"__filename":options$22943.filename,"__dirname":path$22499.dirname(options$22943.filename),"module":e_module$22951,"require":e_require$22952}));return function(code$22976){var script$22980;(script$22980=vm$22500.createScript(code$22976,options$22943.showname));return script$22980.runInThisContext();};});(interactive$22509=function(g$22989,e$22990){var accum$23010;var repl$22997;var settings$22998;var runner$22999;(repl$22997=require("repl"));(g$22989["interactive"]=true);(settings$22998=$22410(({"prompt":"<> ","ignoreUndefined":true}),((accum$23010=({})),((accum$23010["eval"]=function(input$23015,context$23016,filename$23017,callback$23018){var rval$23054;var execute$23028;var handle$23029;var result$23022;(result$23022=(((execute$23028=function(){var text$23039;(text$23039=g$22989.generate(Source$22496(input$23015.slice(1,-1),"<interactive>")));return e$22990(text$23039);})),((handle$23029=function(e$23048){display_error$22497(e$23048);return (void 0);})),(((rval$23054=false)),(function(){try{(rval$23054=execute$23028());}catch(excv$23065){var e$23071;(e$23071=excv$23065);(rval$23054=handle$23029(e$23071));}}(),rval$23054))));return callback$23018(null,result$23022);}),accum$23010))));(runner$22999=repl$22997.start(settings$22998));return runner$22999.on("exit",function(){return runner$22999.outputStream.write("\n");});});(compile_path$22510=function(p$23090,opts$23091){var out$23118;var $23322$23325;var beaut$23326;var name$23380;var name$23361;var t0$23355;var t1$23356;var t2$23357;var $23345$23350;var noext$23342;var $23299$23316;var $23295$23310;var data$23300;var code$23301;var $23098$23111;var $23095$23105;var stats$23099;(stats$23099=fs$22498.statSync(p$23090));($23095$23105=null);$23095$23105;if(stats$23099.isDirectory()){if(opts$23091.print){usage_error$22503("Cannot use --print when compiling a directory");}(out$23118=(opts$23091.output||p$23090));return walk$22505(p$23090,"/",function(){var rval$23191;var to$23183;var from$23177;var t0$23243;var t1$23244;var x$23237;var name$23238;var from$23239;var to$23240;var data$23241;var from$23277;var to$23278;var f$23272;var results$23224;var t0$23220;var $23130$23216;var d$23164;var $23134$23159;var $23135$23160;var $23136$23161;var t0$23156;var t1$23157;var $23127$23148;var t0$23144;var $23125$23139;($23125$23139=arguments);(t0$23144=$23125$23139.length);if((t0$23144>=0)){($23127$23148=Array.prototype.slice.call($23125$23139,0));(t0$23156=$23127$23148);(t1$23157=t0$23156.length);if((($23136$23161=(t1$23157===2))&&(t0$23156[0]==="dir"))){(d$23164=t0$23156[1]);(from$23177=path$22499.join(p$23090,d$23164));if(opts$23091.output){(to$23183=path$22499.join(out$23118,d$23164));(rval$23191=false);try{(rval$23191=fs$22498.mkdirSync(to$23183));}catch(excv$23202){var e$23208;(e$23208=excv$23202);(rval$23191="ignore error");}return rval$23191;}}else{if(($23136$23161&&(t0$23156[0]==="file"))){($23130$23216=t0$23156[1]);(t0$23220=$24217(RegExp("(?:^((?:.*))\\.eg$)",""))($23130$23216));if((t0$23220[0]&&((results$23224=t0$23220[1]),results$23224))){(t0$23243=results$23224);if(((t0$23243 instanceof Array)&&(((t1$23244=t0$23243.length)),(t1$23244===2)))){(x$23237=t0$23243[0]);(name$23238=t0$23243[1]);}else{$24656(results$23224,"/home/olivier/git/earl-grey/src/run.eg",5206,5213);}(from$23239=path$22499.join(p$23090,x$23237));(to$23240=path$22499.join(out$23118,(name$23238+".js")));(data$23241=fs$22498.readFileSync(from$23239,"utf8"));return fs$22498.writeFileSync(to$23240,(gen$22507(data$23241,from$23239,opts$23091.noboil)+"\n"));}else{$23130$23216;if((!opts$23091.output)){return null;}else{(f$23272=$23130$23216);(from$23277=path$22499.join(p$23090,f$23272));(to$23278=path$22499.join(out$23118,f$23272));return copy$22506(from$23277,to$23278);}}}else{$24656($23127$23148,"/home/olivier/git/earl-grey/src/run.eg",4873,4878);}}}else{$24656($23125$23139);}});}else{(data$23300=fs$22498.readFileSync(p$23090,"utf8"));(code$23301=gen$22507(data$23300,p$23090,opts$23091.noboil));($23295$23310=null);$23295$23310;if(opts$23091.print){($23322$23325=require("js-beautify"));(beaut$23326=$23322$23325.js);return console.log(beaut$23326(code$23301));}else{if(opts$23091.output){return fs$22498.writeFileSync(opts$23091.output,(code$23301+"\n"));}else{(noext$23342=((($23345$23350=p$23090)),(((t0$23355=$24217(RegExp("^(.*).eg$",""))($23345$23350))),function(){if((t0$23355[0]&&(((t1$23356=t0$23355[1])),(((t2$23357=t1$23356.length)),(t2$23357===2))))){t1$23356[0];(name$23361=t1$23356[1]);return name$23361;}else{(name$23380=$23345$23350);return name$23380;}}())));return fs$22498.writeFileSync((noext$23342+".js"),(code$23301+"\n"));}}}});(run$22511=function(argv$23388){var t0$23397;var t1$23398;var rval$23413;var opts$23392;var cmd$23393;(t0$23397=extract_options$22504(argv$23388,({"h":["flag","help"],"help":["flag","help"],"v":["flag","version"],"version":["flag","version"]}),"global option"));if(((t0$23397 instanceof Array)&&(((t1$23398=t0$23397.length)),(t1$23398===2)))){(opts$23392=t0$23397[0]);(cmd$23393=t0$23397[1]);}else{$24656(extract_options$22504(argv$23388,({"h":["flag","help"],"help":["flag","help"],"v":["flag","version"],"version":["flag","version"]}),"global option"),"/home/olivier/git/earl-grey/src/run.eg",6320,6513);}(rval$23413=false);try{(rval$23413=_run$22512(cmd$23393,opts$23392));}catch(excv$23424){var e$23430;(e$23430=excv$23424);(rval$23413=(display_error$22497(e$23430),process.exit(1)));}return rval$23413;});(_run$22512=function($23441$23444,opts$23445){var t0$23496;var t0$23503;var t0$23537;var t1$23538;var data$23592;var file$23583;var $23562$23572;var t0$23570;var $23558$23565;var data$23640;var file$23631;var $23610$23620;var t0$23618;var $23606$23613;var t0$23552;var t1$23553;var o$23527;var rest$23528;var file$23529;var wd$23530;var data$23531;var args$23532;var e$23533;var g$23534;var result$23535;var t0$23678;var t1$23679;var $23712$23725;var $23709$23719;var code$23713;var $index$23784;var $length$23778;var temp$23772;var acc$23766;var paths$23753;var p$23744;var $23673$23701;var $23674$23702;var t0$23699;var $23667$23694;var o$23675;var rest$23676;var data$24012;var $24021$24025;var beaut$24026;var data$24027;var otherwise$24018;var $23824$23841;var $23820$23835;var out$23825;var stats$23826;var $index$24065;var $length$24059;var temp$24053;var acc$24047;var tokens$24203;var walkloc$24093;var stuff$24209;var s$24088;var s$24039;var file$23808;var args$23809;var rawargs$23662;var rawargs$23512;var $23459$23477;var $23460$23478;var $23461$23479;var bridge$23451$23473;var t0$23474;var bridge$23455$23475;var $23447$23468;var ph$23462;(ph$23462=$23441$23444);($23447$23468=ph$23462);$23447$23468;if(opts$23445.help){return console.log(usage$22502);}else{if(opts$23445.version){return console.log("Earl Grey version",eg$22492.version);}else{(bridge$23451$23473=$23447$23468);if((((bridge$23451$23473 instanceof Array)&&(((t0$23496=bridge$23451$23473.length)),(t0$23496===0)))||((bridge$23451$23473 instanceof Array)&&(((t0$23503=bridge$23451$23473.length)),((t0$23503===1)&&(bridge$23451$23473[0]==="run")))))){return _run$22512(["run","-i"],opts$23445);}else{if((($23459$23477=($23447$23468 instanceof Array))&&(((t0$23474=$23447$23468.length)),(($23461$23479=(t0$23474>=1))&&($23447$23468[0]==="run"))))){(rawargs$23512=Array.prototype.slice.call($23447$23468,1));(t0$23537=extract_options$22504(rawargs$23512,({"e":["value","evaluate"],"eval":["value","evaluate"],"p":["flag","print"],"print":["flag","print"],"i":["flag","interactive"],"interactive":["flag","interactive"]}),"option for run"));if(((t0$23537 instanceof Array)&&(((t1$23538=t0$23537.length)),(t1$23538===2)))){(o$23527=t0$23537[0]);(rest$23528=t0$23537[1]);}else{$24656(extract_options$22504(rawargs$23512,({"e":["value","evaluate"],"eval":["value","evaluate"],"p":["flag","print"],"print":["flag","print"],"i":["flag","interactive"],"interactive":["flag","interactive"]}),"option for run"),"/home/olivier/git/earl-grey/src/run.eg",6858,6906);}(t0$23552=function(){if(o$23527.evaluate){return ["<repl>",process.cwd(),o$23527.evaluate,rest$23528];}else{($23558$23565=rest$23528.shift());if((($23562$23572=($23558$23565===(void 0)))&&o$23527.interactive)){return ["<repl>",process.cwd(),"",rest$23528];}else{if($23562$23572){return usage_error$22503("No filename specified.");}else{(t0$23570=$24217(path$22499.resolve)($23558$23565));if(t0$23570[0]){(file$23583=t0$23570[1]);(data$23592=fs$22498.readFileSync(file$23583,"utf8"));return [file$23583,file$23583,data$23592,rest$23528];}else{$24656($23558$23565);}}}}}());if(((t0$23552 instanceof Array)&&(((t1$23553=t0$23552.length)),(t1$23553===4)))){(file$23529=t0$23552[0]);(wd$23530=t0$23552[1]);(data$23531=t0$23552[2]);(args$23532=t0$23552[3]);}else{$24656(function(){if(o$23527.evaluate){return ["<repl>",process.cwd(),o$23527.evaluate,rest$23528];}else{($23606$23613=rest$23528.shift());if((($23610$23620=($23606$23613===(void 0)))&&o$23527.interactive)){return ["<repl>",process.cwd(),"",rest$23528];}else{if($23610$23620){return usage_error$22503("No filename specified.");}else{(t0$23618=$24217(path$22499.resolve)($23606$23613));if(t0$23618[0]){(file$23631=t0$23618[1]);(data$23640=fs$22498.readFileSync(file$23631,"utf8"));return [file$23631,file$23631,data$23640,rest$23528];}else{$24656($23606$23613);}}}}}(),"/home/olivier/git/earl-grey/src/run.eg",7153,7666);}(process["argv"]=["earl-run",file$23529].concat(rest$23528));(e$23533=evaluator$22508(({"filename":file$23529,"showname":file$23529,"cwd":file$23529})));(g$23534=eg$22492.Generator(o$23527.interactive));(result$23535=e$23533(g$23534.generate(Source$22496(data$23531,file$23529))));if(o$23527.print){console.log(result$23535);}if(o$23527.interactive){return interactive$22509(g$23534,e$23533);}}else{if(($23461$23479&&($23447$23468[0]==="compile"))){(rawargs$23662=Array.prototype.slice.call($23447$23468,1));(t0$23678=extract_options$22504(rawargs$23662,({"o":["value","output"],"output":["value","output"],"p":["flag","print"],"print":["flag","print"],"e":["value","evaluate"],"eval":["value","evaluate"],"n":["flag","noboil"],"noboil":["flag","noboil"]}),"option for compile"));if(((t0$23678 instanceof Array)&&(((t1$23679=t0$23678.length)),(t1$23679===2)))){(o$23675=t0$23678[0]);(rest$23676=t0$23678[1]);}else{$24656(extract_options$22504(rawargs$23662,({"o":["value","output"],"output":["value","output"],"p":["flag","print"],"print":["flag","print"],"e":["value","evaluate"],"eval":["value","evaluate"],"n":["flag","noboil"],"noboil":["flag","noboil"]}),"option for compile"),"/home/olivier/git/earl-grey/src/run.eg",8055,8107);}($23667$23694=rest$23676);$23667$23694;if(o$23675.evaluate){(code$23713=gen$22507(o$23675.evaluate,"<cli>",o$23675.noboil));($23709$23719=null);$23709$23719;if(o$23675.output){return fs$22498.writeFileSync(o$23675.output,(code$23713+"\n"));}else{return console.log(code$23713);}}else{if((($23673$23701=($23667$23694 instanceof Array))&&(((t0$23699=$23667$23694.length)),(t0$23699===0)))){return usage_error$22503("Must provide at least one file or directory to compile.");}else{if(($23673$23701&&(t0$23699===1))){(p$23744=$23667$23694[0]);return compile_path$22510(p$23744,o$23675);}else{$23667$23694;if(o$23675.output){return usage_error$22503("The -o option cannot be used if more than one file or directory is compiled.");}else{if((($23667$23694 instanceof Array)&&(((t0$23699=$23667$23694.length)),(t0$23699>=0)))){(paths$23753=Array.prototype.slice.call($23667$23694,0));(acc$23766=[]);(temp$23772=paths$23753);($length$23778=temp$23772.length);($index$23784=0);$23761:for(;($index$23784<$length$23778);($index$23784++)){var p$23801;var m$23793;(m$23793=temp$23772[$index$23784]);(p$23801=m$23793);acc$23766.push(compile_path$22510(p$23801,o$23675));}return acc$23766;}else{$24656($23667$23694);}}}}}}else{if(($23459$23477&&((t0$23474>=2)&&(((bridge$23455$23475=$23447$23468[0])),((bridge$23455$23475==="tr")||(bridge$23455$23475==="translate")))))){(file$23808=$23447$23468[1]);(args$23809=Array.prototype.slice.call($23447$23468,2));(out$23825=args$23809[0]);(stats$23826=fs$22498.statSync(file$23808));($23820$23835=null);$23820$23835;if(stats$23826.isDirectory()){return walk$22505(file$23808,"/",function(){var rval$23912;var from$23900;var to$23901;var t0$23964;var t1$23965;var x$23958;var name$23959;var from$23960;var to$23961;var data$23962;var from$23994;var to$23995;var f$23989;var results$23945;var t0$23941;var $23853$23937;var d$23886;var $23856$23881;var $23857$23882;var $23858$23883;var t0$23878;var t1$23879;var $23850$23870;var t0$23866;var $23848$23861;($23848$23861=arguments);(t0$23866=$23848$23861.length);if((t0$23866>=0)){($23850$23870=Array.prototype.slice.call($23848$23861,0));(t0$23878=$23850$23870);(t1$23879=t0$23878.length);if((($23858$23883=(t1$23879===2))&&(t0$23878[0]==="dir"))){(d$23886=t0$23878[1]);(from$23900=path$22499.join(file$23808,d$23886));(to$23901=path$22499.join(out$23825,d$23886));(rval$23912=false);try{(rval$23912=fs$22498.mkdirSync(to$23901));}catch(excv$23923){var e$23929;(e$23929=excv$23923);(rval$23912="ignore error");}return rval$23912;}else{if(($23858$23883&&(t0$23878[0]==="file"))){($23853$23937=t0$23878[1]);(t0$23941=$24217(RegExp("(?:^((?:.*))\\.eg$)",""))($23853$23937));if((t0$23941[0]&&((results$23945=t0$23941[1]),results$23945))){(t0$23964=results$23945);if(((t0$23964 instanceof Array)&&(((t1$23965=t0$23964.length)),(t1$23965===2)))){(x$23958=t0$23964[0]);(name$23959=t0$23964[1]);}else{$24656(results$23945,"/home/olivier/git/earl-grey/src/run.eg",9548,9555);}(from$23960=path$22499.join(file$23808,x$23958));(to$23961=path$22499.join(out$23825,(name$23959+".js")));(data$23962=fs$22498.readFileSync(from$23960,"utf8"));return fs$22498.writeFileSync(to$23961,(gen$22507(data$23962,from$23960)+"\n"));}else{(f$23989=$23853$23937);(from$23994=path$22499.join(file$23808,f$23989));(to$23995=path$22499.join(out$23825,f$23989));return copy$22506(from$23994,to$23995);}}else{$24656($23850$23870,"/home/olivier/git/earl-grey/src/run.eg",9228,9233);}}}else{$24656($23848$23861);}});}else{if(out$23825){(data$24012=fs$22498.readFileSync(file$23808,"utf8"));return fs$22498.writeFileSync(out$23825,(gen$22507(data$24012,file$23808)+"\n"));}else{(otherwise$24018=$23820$23835);($24021$24025=require("js-beautify"));(beaut$24026=$24021$24025.js);(data$24027=fs$22498.readFileSync(file$23808,"utf8"));return console.log(beaut$24026(gen$22507(data$24027,file$23808)));}}}else{if(($23459$23477&&(($23461$23479=(t0$23474===2))&&($23447$23468[0]==="tok")))){(s$24039=$23447$23468[1]);(acc$24047=[]);(temp$24053=eg$22492.tokenize(Source$22496(s$24039,null)));($length$24059=temp$24053.length);($index$24065=0);$24042:for(;($index$24065<$length$24059);($index$24065++)){var token$24082;var m$24074;(m$24074=temp$24053[$index$24065]);(token$24082=m$24074);acc$24047.push((__lt____gt__$22494(null,token$24082),__lt____gt__$22494(null,token$24082.location.ref()),__lt____gt__$22494(null,token$24082.location.highlight())));}return acc$24047;}else{if(($23461$23479&&($23447$23468[0]==="pa"))){(s$24088=$23447$23468[1]);(walkloc$24093=function($24097$24100){var t0$24112;var $index$24178;var $length$24172;var temp$24166;var acc$24160;var type$24150;var args$24151;var x$24144;var x$24133;var $24106$24128;var $24107$24129;var $24108$24130;var t0$24126;var $24102$24121;var ph$24109;var node$24110;(t0$24112=$24097$24100);(node$24110=t0$24112);(ph$24109=t0$24112);($24102$24121=ph$24109);if((($24106$24128=($24102$24121 instanceof Array))&&(((t0$24126=$24102$24121.length)),(($24108$24130=(t0$24126===2))&&($24102$24121[0]==="symbol"))))){(x$24133=$24102$24121[1]);__lt____gt__$22494(null,node$24110);return __lt____gt__$22494(null,(node$24110.location&&node$24110.location.highlight()));}else{if(($24108$24130&&($24102$24121[0]==="value"))){(x$24144=$24102$24121[1]);__lt____gt__$22494(null,node$24110);return __lt____gt__$22494(null,(node$24110.location&&node$24110.location.highlight()));}else{if(($24106$24128&&(t0$24126>=1))){(type$24150=$24102$24121[0]);(args$24151=Array.prototype.slice.call($24102$24121,1));__lt____gt__$22494(null,node$24110);__lt____gt__$22494(null,(node$24110.location&&node$24110.location.highlight()));(acc$24160=[]);(temp$24166=args$24151);($length$24172=temp$24166.length);($index$24178=0);$24155:for(;($index$24178<$length$24172);($index$24178++)){var arg$24195;var m$24187;(m$24187=temp$24166[$index$24178]);(arg$24195=m$24187);acc$24160.push(walkloc$24093(arg$24195));}return acc$24160;}else{$24656($24102$24121);}}}});return walkloc$24093((((tokens$24203=eg$22492.tokenize(Source$22496(s$24088,null)))),eg$22492.parse(tokens$24203)));}else{(stuff$24209=$23447$23468);return usage_error$22503(("Invalid use. Did you mean: earl run "+stuff$24209.join(" ")));}}}}}}}}});(exports["run"]=run$22511);
