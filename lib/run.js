var $22300=function(type$22303){var f$22307;(f$22307=type$22303["::check"]);if((f$22307===(void 0))){return function(value$22313){return (value$22313 instanceof type$22303);};}else{return function(value$22317){return f$22307.call(type$22303,value$22317);};}};
var $22319=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $22320=function(dest$22323,values$22324){var k$22329;(k$22329=null);$22327:for(k$22329 in values$22324){if(values$22324.hasOwnProperty(k$22329)){(dest$22323[k$22329]=values$22324[k$22329]);}}return dest$22323;};
var $22337=function($22339$22342){var ph$22348;(ph$22348=$22339$22342);var $22344$22354;($22344$22354=ph$22348);var bridge$22346$22359;var x$22363;(bridge$22346$22359=$22344$22354);if((((typeof(bridge$22346$22359)==="string")&&((x$22363=bridge$22346$22359),true))||((typeof(bridge$22346$22359)==="number")&&((x$22363=bridge$22346$22359),true)))){return ["value",x$22363];}else{var other$22374;(other$22374=$22344$22354);return other$22374["::serialize_ast"]();}};
var send$22074;(send$22074=function(obj$22081,$22078$22082){var ph$22088;var msg$22089;var t0$22091;(t0$22091=$22078$22082);(msg$22089=t0$22091);(ph$22088=t0$22091);var $22084$22100;($22084$22100=ph$22088);var bridge$22086$22105;(bridge$22086$22105=$22084$22100);if(((typeof(bridge$22086$22105)==="string")||(typeof(bridge$22086$22105)==="number"))){return obj$22081[msg$22089];}else{var other$22117;(other$22117=$22084$22100);return obj$22081["::send"](msg$22089);}});(Array[":::project"]=function($22123$22126){var ph$22131;var value$22132;var t0$22134;(t0$22134=$22123$22126);(value$22132=t0$22134);(ph$22131=t0$22134);var $22128$22143;($22128$22143=ph$22131);if($22300(Array)($22128$22143)){return [true,value$22132];}else{$22128$22143;return [true,[value$22132]];}});(Array.prototype["::check"]=function(value$22161){if((value$22161 instanceof Array)){var i$22167;(i$22167=0);$22164:for(;(i$22167<this.length);(i$22167++)){if(($22319(this,i$22167)!==$22319(value$22161,i$22167))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $22320(this.slice(0),this);});(Array.prototype[":::project"]=function(value$22186){if((value$22186 instanceof Array)){var i$22192;(i$22192=0);$22189:for(;(i$22192<this.length);(i$22192++)){if(($22319(this,i$22192)!==$22319(value$22186,i$22192))){return [true,[value$22186]];}}return [true,value$22186.slice(this.length)];}else{return [true,[value$22186]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($22337));});(RegExp.prototype["::check"]=function($22210$22213){var ph$22218;(ph$22218=$22210$22213);var $22215$22224;($22215$22224=ph$22218);var value$22232;if((typeof($22215$22224)==="string")){(value$22232=$22215$22224);if(value$22232.match(this)){return true;}else{return false;}}else{var other$22237;(other$22237=$22215$22224);return false;}});(RegExp.prototype[":::project"]=function($22243$22246){var ph$22251;(ph$22251=$22243$22246);var $22248$22257;($22248$22257=ph$22251);var value$22265;if((typeof($22248$22257)==="string")){(value$22265=$22248$22257);var $22268$22273;($22268$22273=value$22265.match(this));var m$22281;if(($22268$22273===null)){(m$22281=$22268$22273);return [false,null];}else{var m$22286;(m$22286=$22268$22273);return [true,m$22286];}}else{var other$22290;(other$22290=$22248$22257);return [false,null];}});(Function.prototype["::send"]=function(args$22297){return this.apply(this,args$22297);});
var $24127=function(type$24130){return function(value$24134){var f$24138;(f$24138=type$24130[":::project"]);if((f$24138===(void 0))){(f$24138=type$24130["::project"]);if((f$24138===(void 0))){return [true,type$24130(value$24134)];}else{var rval$24151;(rval$24151=false);try{(rval$24151=[true,f$24138(value$24134)]);}catch(excv$24162){var e$24168;(e$24168=excv$24162);(rval$24151=[false,null]);}return rval$24151;}}else{return f$24138.call(type$24130,value$24134);}};};
var $24258=function($24260$24263,key$24264){var ph$24272;(ph$24272=$24260$24263);var $24266$24278;($24266$24278=ph$24272);var bridge$24268$24283;(bridge$24268$24283=$24266$24278);if(((bridge$24268$24283===null)||(bridge$24268$24283===(void 0)))){return false;}else{var x$24295;if((typeof($24266$24278)==="string")){(x$24295=$24266$24278);return (key$24264 in String.prototype);}else{var x$24300;if((typeof($24266$24278)==="number")){(x$24300=$24266$24278);return (key$24264 in Number.prototype);}else{var x$24305;(x$24305=$24266$24278);return (key$24264 in x$24305);}}}};
var $24540=function(arr$24543){var results$24549;var l$24550;(results$24549=[]);(l$24550=arr$24543.length);var i$24559;(i$24559=0);$24548:for(;(i$24559<l$24550);(i$24559++)){results$24549.push([i$24559,$22319(arr$24543,i$24559)]);}return results$24549;};
var $24566=function(value$24569,url$24570,start$24571,end$24572){var err$24576;(err$24576=$24307(["match"]).create("Could not find a match for value",({"value":value$24569})));if(url$24570){(err$24576["location"]=["location",url$24570,start$24571,end$24572]);}throw err$24576;};
var $24307=function(){var $24308$24314;($24308$24314=function(tags$24319){var it$0$24322;(it$0$24322=function(){if((!$22300($24308$24314)(this))){return Object.create($24308$24314.prototype);}else{return this;}}());(it$0$24322["tags"]=tags$24319);return it$0$24322;});($24308$24314.prototype["create"]=function(){var it$0$24342;var self$24343;(it$0$24342=this);(self$24343=this);var $24340$24352;($24340$24352=arguments);var t0$24357;var message$24361;var args$24362;(t0$24357=$24340$24352.length);if((t0$24357>=0)){(message$24361=function(){if((0>=t0$24357)){return "";}else{return $24340$24352[0];}}());(args$24362=Array.prototype.slice.call($24340$24352,1));var e$24375;(e$24375=Error(message$24361));(e$24375["::tags"]=it$0$24342.tags);(e$24375["args"]=args$24362);var temp$24391;(temp$24391=$24540(args$24362));var $length$24397;($length$24397=temp$24391.length);var $index$24403;($index$24403=0);$24376:for(;($index$24403<$length$24397);($index$24403++)){var m$24412;(m$24412=temp$24391[$index$24403]);var t0$24417;var t1$24418;var i$24422;var arg$24423;(t0$24417=m$24412);if(((t0$24417 instanceof Array)&&(((t1$24418=t0$24417.length)),(t1$24418===2)))){(i$24422=t0$24417[0]);(arg$24423=t0$24417[1]);(e$24375[i$24422]=arg$24423);}else{$24566(m$24412);}}(e$24375["length"]=args$24362.length);(e$24375["name"]=["E"].concat(it$0$24342.tags).join("."));return e$24375;}else{$24566($24340$24352);}});($24308$24314.prototype["::check"]=function(e$24453){var it$0$24457;var self$24458;(it$0$24457=this);(self$24458=this);var tags$24468;if(((!e$24453)||(!$22300(Error)(e$24453)))){return false;}(tags$24468=(e$24453["::tags"]||[]));var temp$24479;(temp$24479=it$0$24457.tags);var $length$24485;($length$24485=temp$24479.length);var $index$24491;($index$24491=0);$24469:for(;($index$24491<$length$24485);($index$24491++)){var m$24500;(m$24500=temp$24479[$index$24491]);var tag$24508;(tag$24508=m$24500);if((tags$24468.indexOf(tag$24508)===-1)){return false;}else{false;}}return true;});($24308$24314.prototype["::deconstruct"]=function(e$24517){var it$0$24521;var self$24522;(it$0$24521=this);(self$24522=this);return e$24517.args;});$22320($24308$24314,$22320(function(){var accum$24533;(accum$24533=({}));(accum$24533["::name"]="$24308");return accum$24533;}(),function(){var accum$24537;(accum$24537=({}));(accum$24537["::egclass"]=true);return accum$24537;}()));return $24308$24314;}();
var $24174=function($24176$24179){var ph$24189;var x$24190;var t0$24192;(t0$24192=$24176$24179);(x$24190=t0$24192);(ph$24189=t0$24192);var $24181$24201;($24181$24201=ph$24189);var bridge$24183$24206;(bridge$24183$24206=$24181$24201);if((function(){var bridge$24184$24216;(bridge$24184$24216=bridge$24183$24206);return (function(){var bridge$24185$24223;(bridge$24185$24223=bridge$24184$24216);return ((bridge$24185$24223===(void 0))||(bridge$24185$24223===null));}()||(typeof(bridge$24184$24216)==="string"));}()||(typeof(bridge$24183$24206)==="number"))){return x$24190;}else{if($24258($24181$24201,"::clone")){$24181$24201["::clone"];return x$24190["::clone"]();}else{$24181$24201;if((Object.getPrototypeOf(x$24190)===Object.prototype)){var dest$24241;(dest$24241=({}));var k$24246;(k$24246=null);$24240:for(k$24246 in x$24190){if(Object.prototype.hasOwnProperty.call(x$24190,k$24246)){(dest$24241[k$24246]=x$24190[k$24246]);}}return dest$24241;}else{var other$24256;(other$24256=$24181$24201);throw $24307(["clone"]).create("Object cannot be cloned",({"obj":x$24190}));}}}};var eg$22402;var $22379$22403;var __lt____gt__$22404;var $22380$22405;var Source$22406;var display_error$22407;var fs$22408;var path$22409;var vm$22410;var module$22411;var usage$22412;var usage_error$22413;var extract_options$22414;var walk$22415;var copy$22416;var gen$22417;var evaluator$22418;var interactive$22419;var compile_path$22420;var run$22421;var _run$22422;(eg$22402=require("./earl-grey"));($22379$22403=require("./pp"));(__lt____gt__$22404=$22379$22403["<>"]);($22380$22405=require("./location"));(Source$22406=$22380$22405.Source);(display_error$22407=$22380$22405.display_error);(fs$22408=require("fs"));(path$22409=require("path"));(vm$22410=require("vm"));(module$22411=require("module"));(usage$22412="Usage: earl [global options] command [options] [arguments...]\n\nearl run [options] [file] [arguments...]\n  Run the specified file as a script. The arguments are available in\n  process.argv.slice{2} of the script.\n  Options:\n    -e  --eval <code>  Run the provided code instead of reading from a file.\n    -p  --print        Print the result of the evaluation to standard out.\n    -i  --interactive  Start an interactive interpreter after execution\n                       in the global environment of the script.\n\nearl compile [options] [file... | dir]\n  Compile the specified source files into .js files. The files will be\n  placed next to the originals.\n  If a directory is given, all .eg files in the directory hierarchy\n  will be compiled. The -o option can be used to compile the files\n  into a different directory (all non-eg files will be copied over).\n  Options:\n    -o  --output <dir>  Output in given directory.\n    -p  --print         Print the compiled JavaScript to standard out.\n                        No files are created.\n    -e  --eval <code>   Compile the provided code instead of reading from a file.\n    -n  --noboil        Don't produce boilerplate code (useful with -p)\n\nearl\n  Start an interactive session.\n\nGlobal options:\n  -h  --help      Print this message.\n  -v  --version   Print the version\n");(usage_error$22413=function(message$22460){console.error(usage$22412);console.error(message$22460);return process.exit(1);});(extract_options$22414=function($22467$22470,opttable$22471,optmessage$22472){var t0$22476;var results$22488;var associate$22489;var process_option$22490;var argv$22474;(t0$22476=$24127($24174)($22467$22470));if(t0$22476[0]){(argv$22474=t0$22476[1]);}else{$24566($22467$22470);}(results$22488=({}));(associate$22489=null);(process_option$22490=function(original$22501,opt$22502,last$22503){var name$22557;var name$22547;var name$22533;var $22510$22523;var $22511$22524;var $22512$22525;var $22513$22526;var t0$22521;var $22505$22516;($22505$22516=$22319(opttable$22471,opt$22502));if(($22505$22516===(void 0))){return usage_error$22413(((("Unrecognized "+optmessage$22472)+": ")+original$22501));}else{if((($22510$22523=($22505$22516 instanceof Array))&&(((t0$22521=$22505$22516.length)),(($22512$22525=(t0$22521===2))&&($22505$22516[0]==="flag"))))){(name$22533=$22505$22516[1]);(results$22488[name$22533]=true);}else{if(($22512$22525&&(($22513$22526=($22505$22516[0]==="value"))&&((name$22547=$22505$22516[1]),last$22503)))){(associate$22489=name$22547);}else{if($22513$22526){(name$22557=$22505$22516[1]);(results$22488[name$22557]=true);}else{$24566($22505$22516);}}}}});$22567:while(argv$22474.length){var $index$22684;var $length$22678;var temp$22672;var acc$22666;var other$22726;var other$22712;var opts$22643;var opt$22624;var opt$22595;var value$22596;var t0$22589;var t1$22590;var t2$22591;var $22572$22584;var arg$22578;(arg$22578=argv$22474.shift());($22572$22584=arg$22578);(t0$22589=$24127(RegExp("^--([a-zA-Z_\\-]+)=(.*)",""))($22572$22584));if((t0$22589[0]&&(((t1$22590=t0$22589[1])),(((t2$22591=t1$22590.length)),(t2$22591===3))))){t1$22590[0];(opt$22595=t1$22590[1]);(value$22596=t1$22590[2]);process_option$22490(arg$22578,opt$22595,true);(results$22488[associate$22489]=value$22596);(associate$22489=null);}else{(t0$22589=$24127(RegExp("^--([a-zA-Z_\\-]+)",""))($22572$22584));if((t0$22589[0]&&(((t1$22590=t0$22589[1])),(((t2$22591=t1$22590.length)),(t2$22591===2))))){t1$22590[0];(opt$22624=t1$22590[1]);process_option$22490(arg$22578,opt$22624,true);}else{(t0$22589=$24127(RegExp("^-([a-zA-Z_]+)",""))($22572$22584));if((t0$22589[0]&&(((t1$22590=t0$22589[1])),(((t2$22591=t1$22590.length)),(t2$22591===2))))){t1$22590[0];(opts$22643=t1$22590[1]);(acc$22666=[]);(temp$22672=opts$22643);($length$22678=temp$22672.length);($index$22684=0);$22660:for(;($index$22684<$length$22678);($index$22684++)){var ch$22707;var ch$22701;var m$22693;(m$22693=temp$22672[$index$22684]);(ch$22701=m$22693);if(($index$22684===($length$22678-1))){acc$22666.push(process_option$22490(arg$22578,ch$22701,true));}else{(ch$22707=m$22693);acc$22666.push(process_option$22490(arg$22578,ch$22707));}}acc$22666;}else{(other$22712=$22572$22584);if(associate$22489){(results$22488[associate$22489]=other$22712);(associate$22489=null);}else{(other$22726=$22572$22584);argv$22474.unshift(other$22726);break $22567;}}}}}return [results$22488,argv$22474];});(walk$22415=function(dir$22734,partial$22735,f$22736){var $index$22768;var $length$22762;var temp$22756;var acc$22750;var stats$22740;(stats$22740=fs$22408.statSync(dir$22734));if(stats$22740.isDirectory()){f$22736("dir",partial$22735);(acc$22750=[]);(temp$22756=fs$22408.readdirSync(dir$22734));($length$22762=temp$22756.length);($index$22768=0);$22745:for(;($index$22768<$length$22762);($index$22768++)){var newdir$22791;var newpartial$22792;var file$22785;var m$22777;(m$22777=temp$22756[$index$22768]);(file$22785=m$22777);acc$22750.push((((newdir$22791=path$22409.join(dir$22734,file$22785))),((newpartial$22792=path$22409.join(partial$22735,file$22785))),walk$22415(newdir$22791,newpartial$22792,f$22736)));}return acc$22750;}else{return f$22736("file",partial$22735);}});(copy$22416=function(src$22804,dest$22805){var data$22809;(data$22809=fs$22408.readFileSync(src$22804,"binary"));return fs$22408.writeFileSync(dest$22805,data$22809,"binary");});(gen$22417=function(){var g$22842;var text$22831;var file$22832;var noboil$22833;var t0$22827;var $22818$22822;($22818$22822=arguments);(t0$22827=$22818$22822.length);if(((t0$22827>=2)&&(t0$22827<=3))){(text$22831=$22818$22822[0]);(file$22832=$22818$22822[1]);(noboil$22833=function(){if((2>=t0$22827)){return false;}else{return $22818$22822[2];}}());(g$22842=eg$22402.Generator());return g$22842.generate(Source$22406(text$22831,path$22409.resolve(file$22832)),(!noboil$22833));}else{$24566($22818$22822);}});(evaluator$22418=function(options$22853){var accum$22878;var paths$22860;var e_module$22861;var e_require$22862;(paths$22860=module$22411._nodeModulePaths(options$22853.cwd));(e_module$22861=(new module$22411(options$22853.showname)));$22320(e_module$22861,({"filename":options$22853.filename,"paths":paths$22860}));(e_require$22862=function(path$22873){return module$22411._load(path$22873,e_module$22861,true);});$22320(e_require$22862,$22320(({"main":e_module$22861}),$22320(((accum$22878=({})),((accum$22878["resolve"]=function(path$22883){return module$22411._resolveFileName(path$22883,e_module$22861);}),accum$22878)),({"paths":paths$22860,"cache":require.cache}))));$22320(global,({"__filename":options$22853.filename,"__dirname":path$22409.dirname(options$22853.filename),"module":e_module$22861,"require":e_require$22862}));return function(code$22886){var script$22890;(script$22890=vm$22410.createScript(code$22886,options$22853.showname));return script$22890.runInThisContext();};});(interactive$22419=function(g$22899,e$22900){var accum$22920;var repl$22907;var settings$22908;var runner$22909;(repl$22907=require("repl"));(g$22899["interactive"]=true);(settings$22908=$22320(({"prompt":"<> ","ignoreUndefined":true}),((accum$22920=({})),((accum$22920["eval"]=function(input$22925,context$22926,filename$22927,callback$22928){var rval$22964;var execute$22938;var handle$22939;var result$22932;(result$22932=(((execute$22938=function(){var text$22949;(text$22949=g$22899.generate(Source$22406(input$22925.slice(1,-1),"<interactive>")));return e$22900(text$22949);})),((handle$22939=function(e$22958){display_error$22407(e$22958);return (void 0);})),(((rval$22964=false)),(function(){try{(rval$22964=execute$22938());}catch(excv$22975){var e$22981;(e$22981=excv$22975);(rval$22964=handle$22939(e$22981));}}(),rval$22964))));return callback$22928(null,result$22932);}),accum$22920))));(runner$22909=repl$22907.start(settings$22908));return runner$22909.on("exit",function(){return runner$22909.outputStream.write("\n");});});(compile_path$22420=function(p$23000,opts$23001){var out$23028;var $23232$23235;var beaut$23236;var name$23290;var name$23271;var t0$23265;var t1$23266;var t2$23267;var $23255$23260;var noext$23252;var $23209$23226;var $23205$23220;var data$23210;var code$23211;var $23008$23021;var $23005$23015;var stats$23009;(stats$23009=fs$22408.statSync(p$23000));($23005$23015=null);$23005$23015;if(stats$23009.isDirectory()){if(opts$23001.print){usage_error$22413("Cannot use --print when compiling a directory");}(out$23028=(opts$23001.output||p$23000));return walk$22415(p$23000,"/",function(){var rval$23101;var to$23093;var from$23087;var t0$23153;var t1$23154;var x$23147;var name$23148;var from$23149;var to$23150;var data$23151;var from$23187;var to$23188;var f$23182;var results$23134;var t0$23130;var $23040$23126;var d$23074;var $23044$23069;var $23045$23070;var $23046$23071;var t0$23066;var t1$23067;var $23037$23058;var t0$23054;var $23035$23049;($23035$23049=arguments);(t0$23054=$23035$23049.length);if((t0$23054>=0)){($23037$23058=Array.prototype.slice.call($23035$23049,0));(t0$23066=$23037$23058);(t1$23067=t0$23066.length);if((($23046$23071=(t1$23067===2))&&(t0$23066[0]==="dir"))){(d$23074=t0$23066[1]);(from$23087=path$22409.join(p$23000,d$23074));if(opts$23001.output){(to$23093=path$22409.join(out$23028,d$23074));(rval$23101=false);try{(rval$23101=fs$22408.mkdirSync(to$23093));}catch(excv$23112){var e$23118;(e$23118=excv$23112);(rval$23101="ignore error");}return rval$23101;}}else{if(($23046$23071&&(t0$23066[0]==="file"))){($23040$23126=t0$23066[1]);(t0$23130=$24127(RegExp("(?:^((?:.*))\\.eg$)",""))($23040$23126));if((t0$23130[0]&&((results$23134=t0$23130[1]),results$23134))){(t0$23153=results$23134);if(((t0$23153 instanceof Array)&&(((t1$23154=t0$23153.length)),(t1$23154===2)))){(x$23147=t0$23153[0]);(name$23148=t0$23153[1]);}else{$24566(results$23134,"/home/olivier/git/earl-grey/src/run.eg",5206,5213);}(from$23149=path$22409.join(p$23000,x$23147));(to$23150=path$22409.join(out$23028,(name$23148+".js")));(data$23151=fs$22408.readFileSync(from$23149,"utf8"));return fs$22408.writeFileSync(to$23150,(gen$22417(data$23151,from$23149,opts$23001.noboil)+"\n"));}else{$23040$23126;if((!opts$23001.output)){return null;}else{(f$23182=$23040$23126);(from$23187=path$22409.join(p$23000,f$23182));(to$23188=path$22409.join(out$23028,f$23182));return copy$22416(from$23187,to$23188);}}}else{$24566($23037$23058,"/home/olivier/git/earl-grey/src/run.eg",4873,4878);}}}else{$24566($23035$23049);}});}else{(data$23210=fs$22408.readFileSync(p$23000,"utf8"));(code$23211=gen$22417(data$23210,p$23000,opts$23001.noboil));($23205$23220=null);$23205$23220;if(opts$23001.print){($23232$23235=require("js-beautify"));(beaut$23236=$23232$23235.js);return console.log(beaut$23236(code$23211));}else{if(opts$23001.output){return fs$22408.writeFileSync(opts$23001.output,(code$23211+"\n"));}else{(noext$23252=((($23255$23260=p$23000)),(((t0$23265=$24127(RegExp("^(.*).eg$",""))($23255$23260))),function(){if((t0$23265[0]&&(((t1$23266=t0$23265[1])),(((t2$23267=t1$23266.length)),(t2$23267===2))))){t1$23266[0];(name$23271=t1$23266[1]);return name$23271;}else{(name$23290=$23255$23260);return name$23290;}}())));return fs$22408.writeFileSync((noext$23252+".js"),(code$23211+"\n"));}}}});(run$22421=function(argv$23298){var t0$23307;var t1$23308;var rval$23323;var opts$23302;var cmd$23303;(t0$23307=extract_options$22414(argv$23298,({"h":["flag","help"],"help":["flag","help"],"v":["flag","version"],"version":["flag","version"]}),"global option"));if(((t0$23307 instanceof Array)&&(((t1$23308=t0$23307.length)),(t1$23308===2)))){(opts$23302=t0$23307[0]);(cmd$23303=t0$23307[1]);}else{$24566(extract_options$22414(argv$23298,({"h":["flag","help"],"help":["flag","help"],"v":["flag","version"],"version":["flag","version"]}),"global option"),"/home/olivier/git/earl-grey/src/run.eg",6320,6513);}(rval$23323=false);try{(rval$23323=_run$22422(cmd$23303,opts$23302));}catch(excv$23334){var e$23340;(e$23340=excv$23334);(rval$23323=(display_error$22407(e$23340),process.exit(1)));}return rval$23323;});(_run$22422=function($23351$23354,opts$23355){var t0$23406;var t0$23413;var t0$23447;var t1$23448;var data$23502;var file$23493;var $23472$23482;var t0$23480;var $23468$23475;var data$23550;var file$23541;var $23520$23530;var t0$23528;var $23516$23523;var t0$23462;var t1$23463;var o$23437;var rest$23438;var file$23439;var wd$23440;var data$23441;var args$23442;var e$23443;var g$23444;var result$23445;var t0$23588;var t1$23589;var $23622$23635;var $23619$23629;var code$23623;var $index$23694;var $length$23688;var temp$23682;var acc$23676;var paths$23663;var p$23654;var $23583$23611;var $23584$23612;var t0$23609;var $23577$23604;var o$23585;var rest$23586;var data$23922;var $23931$23935;var beaut$23936;var data$23937;var otherwise$23928;var $23734$23751;var $23730$23745;var out$23735;var stats$23736;var $index$23975;var $length$23969;var temp$23963;var acc$23957;var tokens$24113;var walkloc$24003;var stuff$24119;var s$23998;var s$23949;var file$23718;var args$23719;var rawargs$23572;var rawargs$23422;var $23369$23387;var $23370$23388;var $23371$23389;var bridge$23361$23383;var t0$23384;var bridge$23365$23385;var $23357$23378;var ph$23372;(ph$23372=$23351$23354);($23357$23378=ph$23372);$23357$23378;if(opts$23355.help){return console.log(usage$22412);}else{if(opts$23355.version){return console.log("Earl Grey version",eg$22402.version);}else{(bridge$23361$23383=$23357$23378);if((((bridge$23361$23383 instanceof Array)&&(((t0$23406=bridge$23361$23383.length)),(t0$23406===0)))||((bridge$23361$23383 instanceof Array)&&(((t0$23413=bridge$23361$23383.length)),((t0$23413===1)&&(bridge$23361$23383[0]==="run")))))){return _run$22422(["run","-i"],opts$23355);}else{if((($23369$23387=($23357$23378 instanceof Array))&&(((t0$23384=$23357$23378.length)),(($23371$23389=(t0$23384>=1))&&($23357$23378[0]==="run"))))){(rawargs$23422=Array.prototype.slice.call($23357$23378,1));(t0$23447=extract_options$22414(rawargs$23422,({"e":["value","evaluate"],"eval":["value","evaluate"],"p":["flag","print"],"print":["flag","print"],"i":["flag","interactive"],"interactive":["flag","interactive"]}),"option for run"));if(((t0$23447 instanceof Array)&&(((t1$23448=t0$23447.length)),(t1$23448===2)))){(o$23437=t0$23447[0]);(rest$23438=t0$23447[1]);}else{$24566(extract_options$22414(rawargs$23422,({"e":["value","evaluate"],"eval":["value","evaluate"],"p":["flag","print"],"print":["flag","print"],"i":["flag","interactive"],"interactive":["flag","interactive"]}),"option for run"),"/home/olivier/git/earl-grey/src/run.eg",6858,6906);}(t0$23462=function(){if(o$23437.evaluate){return ["<repl>",process.cwd(),o$23437.evaluate,rest$23438];}else{($23468$23475=rest$23438.shift());if((($23472$23482=($23468$23475===(void 0)))&&o$23437.interactive)){return ["<repl>",process.cwd(),"",rest$23438];}else{if($23472$23482){return usage_error$22413("No filename specified.");}else{(t0$23480=$24127(path$22409.resolve)($23468$23475));if(t0$23480[0]){(file$23493=t0$23480[1]);(data$23502=fs$22408.readFileSync(file$23493,"utf8"));return [file$23493,file$23493,data$23502,rest$23438];}else{$24566($23468$23475);}}}}}());if(((t0$23462 instanceof Array)&&(((t1$23463=t0$23462.length)),(t1$23463===4)))){(file$23439=t0$23462[0]);(wd$23440=t0$23462[1]);(data$23441=t0$23462[2]);(args$23442=t0$23462[3]);}else{$24566(function(){if(o$23437.evaluate){return ["<repl>",process.cwd(),o$23437.evaluate,rest$23438];}else{($23516$23523=rest$23438.shift());if((($23520$23530=($23516$23523===(void 0)))&&o$23437.interactive)){return ["<repl>",process.cwd(),"",rest$23438];}else{if($23520$23530){return usage_error$22413("No filename specified.");}else{(t0$23528=$24127(path$22409.resolve)($23516$23523));if(t0$23528[0]){(file$23541=t0$23528[1]);(data$23550=fs$22408.readFileSync(file$23541,"utf8"));return [file$23541,file$23541,data$23550,rest$23438];}else{$24566($23516$23523);}}}}}(),"/home/olivier/git/earl-grey/src/run.eg",7153,7666);}(process["argv"]=["earl-run",file$23439].concat(rest$23438));(e$23443=evaluator$22418(({"filename":file$23439,"showname":file$23439,"cwd":file$23439})));(g$23444=eg$22402.Generator(o$23437.interactive));(result$23445=e$23443(g$23444.generate(Source$22406(data$23441,file$23439))));if(o$23437.print){console.log(result$23445);}if(o$23437.interactive){return interactive$22419(g$23444,e$23443);}}else{if(($23371$23389&&($23357$23378[0]==="compile"))){(rawargs$23572=Array.prototype.slice.call($23357$23378,1));(t0$23588=extract_options$22414(rawargs$23572,({"o":["value","output"],"output":["value","output"],"p":["flag","print"],"print":["flag","print"],"e":["value","evaluate"],"eval":["value","evaluate"],"n":["flag","noboil"],"noboil":["flag","noboil"]}),"option for compile"));if(((t0$23588 instanceof Array)&&(((t1$23589=t0$23588.length)),(t1$23589===2)))){(o$23585=t0$23588[0]);(rest$23586=t0$23588[1]);}else{$24566(extract_options$22414(rawargs$23572,({"o":["value","output"],"output":["value","output"],"p":["flag","print"],"print":["flag","print"],"e":["value","evaluate"],"eval":["value","evaluate"],"n":["flag","noboil"],"noboil":["flag","noboil"]}),"option for compile"),"/home/olivier/git/earl-grey/src/run.eg",8055,8107);}($23577$23604=rest$23586);$23577$23604;if(o$23585.evaluate){(code$23623=gen$22417(o$23585.evaluate,"<cli>",o$23585.noboil));($23619$23629=null);$23619$23629;if(o$23585.output){return fs$22408.writeFileSync(o$23585.output,(code$23623+"\n"));}else{return console.log(code$23623);}}else{if((($23583$23611=($23577$23604 instanceof Array))&&(((t0$23609=$23577$23604.length)),(t0$23609===0)))){return usage_error$22413("Must provide at least one file or directory to compile.");}else{if(($23583$23611&&(t0$23609===1))){(p$23654=$23577$23604[0]);return compile_path$22420(p$23654,o$23585);}else{$23577$23604;if(o$23585.output){return usage_error$22413("The -o option cannot be used if more than one file or directory is compiled.");}else{if((($23577$23604 instanceof Array)&&(((t0$23609=$23577$23604.length)),(t0$23609>=0)))){(paths$23663=Array.prototype.slice.call($23577$23604,0));(acc$23676=[]);(temp$23682=paths$23663);($length$23688=temp$23682.length);($index$23694=0);$23671:for(;($index$23694<$length$23688);($index$23694++)){var p$23711;var m$23703;(m$23703=temp$23682[$index$23694]);(p$23711=m$23703);acc$23676.push(compile_path$22420(p$23711,o$23585));}return acc$23676;}else{$24566($23577$23604);}}}}}}else{if(($23369$23387&&((t0$23384>=2)&&(((bridge$23365$23385=$23357$23378[0])),((bridge$23365$23385==="tr")||(bridge$23365$23385==="translate")))))){(file$23718=$23357$23378[1]);(args$23719=Array.prototype.slice.call($23357$23378,2));(out$23735=args$23719[0]);(stats$23736=fs$22408.statSync(file$23718));($23730$23745=null);$23730$23745;if(stats$23736.isDirectory()){return walk$22415(file$23718,"/",function(){var rval$23822;var from$23810;var to$23811;var t0$23874;var t1$23875;var x$23868;var name$23869;var from$23870;var to$23871;var data$23872;var from$23904;var to$23905;var f$23899;var results$23855;var t0$23851;var $23763$23847;var d$23796;var $23766$23791;var $23767$23792;var $23768$23793;var t0$23788;var t1$23789;var $23760$23780;var t0$23776;var $23758$23771;($23758$23771=arguments);(t0$23776=$23758$23771.length);if((t0$23776>=0)){($23760$23780=Array.prototype.slice.call($23758$23771,0));(t0$23788=$23760$23780);(t1$23789=t0$23788.length);if((($23768$23793=(t1$23789===2))&&(t0$23788[0]==="dir"))){(d$23796=t0$23788[1]);(from$23810=path$22409.join(file$23718,d$23796));(to$23811=path$22409.join(out$23735,d$23796));(rval$23822=false);try{(rval$23822=fs$22408.mkdirSync(to$23811));}catch(excv$23833){var e$23839;(e$23839=excv$23833);(rval$23822="ignore error");}return rval$23822;}else{if(($23768$23793&&(t0$23788[0]==="file"))){($23763$23847=t0$23788[1]);(t0$23851=$24127(RegExp("(?:^((?:.*))\\.eg$)",""))($23763$23847));if((t0$23851[0]&&((results$23855=t0$23851[1]),results$23855))){(t0$23874=results$23855);if(((t0$23874 instanceof Array)&&(((t1$23875=t0$23874.length)),(t1$23875===2)))){(x$23868=t0$23874[0]);(name$23869=t0$23874[1]);}else{$24566(results$23855,"/home/olivier/git/earl-grey/src/run.eg",9548,9555);}(from$23870=path$22409.join(file$23718,x$23868));(to$23871=path$22409.join(out$23735,(name$23869+".js")));(data$23872=fs$22408.readFileSync(from$23870,"utf8"));return fs$22408.writeFileSync(to$23871,(gen$22417(data$23872,from$23870)+"\n"));}else{(f$23899=$23763$23847);(from$23904=path$22409.join(file$23718,f$23899));(to$23905=path$22409.join(out$23735,f$23899));return copy$22416(from$23904,to$23905);}}else{$24566($23760$23780,"/home/olivier/git/earl-grey/src/run.eg",9228,9233);}}}else{$24566($23758$23771);}});}else{if(out$23735){(data$23922=fs$22408.readFileSync(file$23718,"utf8"));return fs$22408.writeFileSync(out$23735,(gen$22417(data$23922,file$23718)+"\n"));}else{(otherwise$23928=$23730$23745);($23931$23935=require("js-beautify"));(beaut$23936=$23931$23935.js);(data$23937=fs$22408.readFileSync(file$23718,"utf8"));return console.log(beaut$23936(gen$22417(data$23937,file$23718)));}}}else{if(($23369$23387&&(($23371$23389=(t0$23384===2))&&($23357$23378[0]==="tok")))){(s$23949=$23357$23378[1]);(acc$23957=[]);(temp$23963=eg$22402.tokenize(Source$22406(s$23949,null)));($length$23969=temp$23963.length);($index$23975=0);$23952:for(;($index$23975<$length$23969);($index$23975++)){var token$23992;var m$23984;(m$23984=temp$23963[$index$23975]);(token$23992=m$23984);acc$23957.push((__lt____gt__$22404(null,token$23992),__lt____gt__$22404(null,token$23992.location.ref()),__lt____gt__$22404(null,token$23992.location.highlight())));}return acc$23957;}else{if(($23371$23389&&($23357$23378[0]==="pa"))){(s$23998=$23357$23378[1]);(walkloc$24003=function($24007$24010){var t0$24022;var $index$24088;var $length$24082;var temp$24076;var acc$24070;var type$24060;var args$24061;var x$24054;var x$24043;var $24016$24038;var $24017$24039;var $24018$24040;var t0$24036;var $24012$24031;var ph$24019;var node$24020;(t0$24022=$24007$24010);(node$24020=t0$24022);(ph$24019=t0$24022);($24012$24031=ph$24019);if((($24016$24038=($24012$24031 instanceof Array))&&(((t0$24036=$24012$24031.length)),(($24018$24040=(t0$24036===2))&&($24012$24031[0]==="symbol"))))){(x$24043=$24012$24031[1]);__lt____gt__$22404(null,node$24020);return __lt____gt__$22404(null,(node$24020.location&&node$24020.location.highlight()));}else{if(($24018$24040&&($24012$24031[0]==="value"))){(x$24054=$24012$24031[1]);__lt____gt__$22404(null,node$24020);return __lt____gt__$22404(null,(node$24020.location&&node$24020.location.highlight()));}else{if(($24016$24038&&(t0$24036>=1))){(type$24060=$24012$24031[0]);(args$24061=Array.prototype.slice.call($24012$24031,1));__lt____gt__$22404(null,node$24020);__lt____gt__$22404(null,(node$24020.location&&node$24020.location.highlight()));(acc$24070=[]);(temp$24076=args$24061);($length$24082=temp$24076.length);($index$24088=0);$24065:for(;($index$24088<$length$24082);($index$24088++)){var arg$24105;var m$24097;(m$24097=temp$24076[$index$24088]);(arg$24105=m$24097);acc$24070.push(walkloc$24003(arg$24105));}return acc$24070;}else{$24566($24012$24031);}}}});return walkloc$24003((((tokens$24113=eg$22402.tokenize(Source$22406(s$23998,null)))),eg$22402.parse(tokens$24113)));}else{(stuff$24119=$23357$23378);return usage_error$22413(("Invalid use. Did you mean: earl run "+stuff$24119.join(" ")));}}}}}}}}});(exports["run"]=run$22421);
