var $11982=function(type$11984){var f$11987;(f$11987=type$11984["::check"]);;if((f$11987===(void 0))){return function(value$11992){return (value$11992 instanceof type$11984);};}else{return function(value$11995){return f$11987.call(type$11984,value$11995);};}};
var $11997=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $11998=function($11999$12001){var ph$12005;(ph$12005=$11999$12001);;var $12003$12010;($12003$12010=ph$12005);;var bridge$12004$12015;var x$12019;(bridge$12004$12015=$12003$12010);if((((typeof(bridge$12004$12015)==="string")&&((x$12019=bridge$12004$12015),true))||((typeof(bridge$12004$12015)==="number")&&((x$12019=bridge$12004$12015),true)))){return ["value",x$12019];}else{var other$12026;(other$12026=$12003$12010);return other$12026["::serialize_ast"]();}};
var send$11866;(send$11866=function(obj$11871,$11869$11872){var ph$11876;var msg$11877;var t0$11879;(t0$11879=$11869$11872);(msg$11877=t0$11879);(ph$11876=t0$11879);;var $11874$11883;($11874$11883=ph$11876);;var bridge$11875$11888;(bridge$11875$11888=$11874$11883);if(((typeof(bridge$11875$11888)==="string")||(typeof(bridge$11875$11888)==="number"))){return obj$11871[msg$11877];}else{var other$11896;(other$11896=$11874$11883);return obj$11871["::send"](msg$11877);}});;(Array[":::project"]=function($11899$11901){var ph$11904;var value$11905;var t0$11907;(t0$11907=$11899$11901);(value$11905=t0$11907);(ph$11904=t0$11907);;var $11903$11911;($11903$11911=ph$11904);;if($11982(Array)($11903$11911)){return [true,value$11905];}else{$11903$11911;return [true,[value$11905]];}});(Array.prototype["::check"]=function(value$11925){if((value$11925 instanceof Array)){var i$11930;(i$11930=0);;$11928:for(;(i$11930<this.length);(i$11930++)){if(($11997(this,i$11930)!==$11997(value$11925,i$11930))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return this.slice(0);});(Array.prototype[":::project"]=function(value$11941){if((value$11941 instanceof Array)){var i$11946;(i$11946=0);;$11944:for(;(i$11946<this.length);(i$11946++)){if(($11997(this,i$11946)!==$11997(value$11941,i$11946))){return [true,[value$11941]];}}return [true,value$11941.slice(this.length)];}else{return [true,[value$11941]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($11998));});(RegExp.prototype["::check"]=function(value$11957){return value$11957.match(this);});(RegExp.prototype[":::project"]=function(value$11960){var $11962$11964;($11962$11964=value$11960.match(this));;var m$11972;if(($11962$11964===null)){(m$11972=$11962$11964);return [false,null];}else{var m$11977;(m$11977=$11962$11964);return [true,m$11977];}});(Function.prototype["::send"]=function(args$11980){return this.apply(this,args$11980);});
var $12647=function(dest$12649,values$12650){var k$12655;(k$12655=null);$12653:for(k$12655 in values$12650){if(values$12650.hasOwnProperty(k$12655)){(dest$12649[k$12655]=values$12650[k$12655]);}}return dest$12649;};
var $12659=function(type$12661){return function(value$12664){var f$12667;(f$12667=type$12661[":::project"]);;if((f$12667===(void 0))){var f$12672;(f$12672=type$12661["::project"]);;if((f$12672===(void 0))){return [true,type$12661(value$12664)];}else{var rval$12677;(rval$12677=false);;try{(rval$12677=[true,f$12672(value$12664)]);}catch(excv$12683){var e$12689;(e$12689=excv$12683);(rval$12677=[false,null]);}return rval$12677;}}else{return f$12667.call(type$12661,value$12664);}};};
var $12704=function(){var $12705$12707;($12705$12707=function(tags$12711){var it$0$12714;(it$0$12714=function(){if((!$11982($12705$12707)(this))){return Object.create($12705$12707.prototype);}else{return this;}}());;(it$0$12714["tags"]=tags$12711);return it$0$12714;});;($12705$12707.prototype["create"]=function(){var $12723$12725;($12723$12725=arguments);;var t0$12730;var message$12734;var args$12735;(t0$12730=$12723$12725.length);if((t0$12730>=0)){(message$12734=function(){if((0>=t0$12730)){return "";}else{return $12723$12725[0];}}());(args$12735=Array.prototype.slice.call($12723$12725,1));var it$0$12739;(it$0$12739=this);;var e$12744;(e$12744=Error(message$12734));;(e$12744["::tags"]=it$0$12739.tags);(e$12744["args"]=args$12735);(e$12744["name"]=["E"].concat(it$0$12739.tags).join("."));return e$12744;}else{$12691($12723$12725);}});($12705$12707.prototype["::check"]=function(e$12753){var it$0$12756;(it$0$12756=this);;var tags$12761;if(((!e$12753)||(!$11982(Error)(e$12753)))){return false;}(tags$12761=(e$12753["::tags"]||[]));;var temp$12770;(temp$12770=it$0$12756.tags);;var $length$12775;($length$12775=temp$12770.length);;var $index$12780;($index$12780=0);;$12762:for(;($index$12780<$length$12775);($index$12780++)){var m$12788;(m$12788=temp$12770[$index$12780]);;var tag$12796;(tag$12796=m$12788);if((tags$12761.indexOf(tag$12796)===(-1))){return false;}else{false;;}}return true;});($12705$12707.prototype["::deconstruct"]=function(e$12804){var it$0$12807;(it$0$12807=this);;return e$12804.args;});$12647($12705$12707,({}));return $12705$12707;}();
var $12691=function(value$12693,url$12694,start$12695,end$12696){var err$12699;(err$12699=$12704(["match"]).create("Could not find a match for value",({"value":value$12693})));;if(url$12694){(err$12699["location"]=["location",url$12694,start$12695,end$12696]);}throw err$12699;};var eg$12033;var $12030$12034;var __lt____gt__$12035;var Node$12036;var $12031$12037;var enumerate$12038;var items$12039;var $12032$12040;var Source$12041;var display_error$12042;var fs$12043;var path$12044;var vm$12045;var usage$12046;var walk$12047;var copy$12048;var gen$12049;var run$12050;var _run$12051;(eg$12033=require("./earl-grey"));;($12030$12034=require("./pp"));;(__lt____gt__$12035=$12030$12034["<>"]);;(Node$12036=$12030$12034.Node);;($12031$12037=require("./util"));;(enumerate$12038=$12031$12037.enumerate);;(items$12039=$12031$12037.items);;($12032$12040=require("./location"));;(Source$12041=$12032$12040.Source);;(display_error$12042=$12032$12040.display_error);;(fs$12043=require("fs"));;(path$12044=require("path"));;(vm$12045=require("vm"));;(usage$12046="\nusage:\n\nearl translate <file> [outfile]\n  Translate a source file, output to outfile. Without outfile\n  specified, print to standard out.\n\nearl translate <directory> <outdir>\n  Translate all the .eg files in the specified directory.\n\nearl run [file] [arguments...]\n  Run the specified file as a script.\n");;(walk$12047=function(dir$12097,partial$12098,f$12099){var $index$12125;var $length$12120;var temp$12115;var acc$12110;var stats$12102;(stats$12102=fs$12043.statSync(dir$12097));;if(stats$12102.isDirectory()){f$12099("dir",partial$12098);(acc$12110=[]);;(temp$12115=fs$12043.readdirSync(dir$12097));;($length$12120=temp$12115.length);;($index$12125=0);;$12107:for(;($index$12125<$length$12120);($index$12125++)){var newdir$12144;var newpartial$12145;var file$12141;var m$12133;(m$12133=temp$12115[$index$12125]);;(file$12141=m$12133);acc$12110.push((((newdir$12144=path$12044.join(dir$12097,file$12141))),((newpartial$12145=path$12044.join(partial$12098,file$12141))),walk$12047(newdir$12144,newpartial$12145,f$12099)));}return acc$12110;}else{return f$12099("file",partial$12098);}});;(copy$12048=function(src$12156,dest$12157){var data$12160;(data$12160=fs$12043.readFileSync(src$12156,"binary"));;return fs$12043.writeFileSync(dest$12157,data$12160,"binary");});;(gen$12049=function(text$12168,file$12169){var g$12172;(g$12172=eg$12033.Generator());;return g$12172.generate(Source$12041(text$12168,path$12044.resolve(file$12169)));});;(run$12050=function(cmd$12180){var rval$12183;(rval$12183=false);;try{(rval$12183=_run$12051(cmd$12180));}catch(excv$12189){var e$12195;(e$12195=excv$12189);(rval$12183=(display_error$12042(e$12195),process.exit(1)));}return rval$12183;});;(_run$12051=function($12201$12203){var t0$12234;var bridge$12208$12242;var t0$12237;var bridge$12207$12238;var accum$12259;var repl$12246;var g$12247;var settings$12248;var run$12249;var data$12321;var data$12469;var $12478$12479;var beaut$12480;var data$12481;var otherwise$12475;var $12334$12350;var $12333$12344;var out$12335;var stats$12336;var $index$12514;var $length$12509;var temp$12504;var acc$12499;var tokens$12627;var walkloc$12539;var code$12637;var other$12643;var data$12633;var s$12535;var s$12493;var file$12327;var args$12328;var file$12316;var $12210$12227;var $12211$12228;var $12212$12229;var bridge$12206$12223;var t0$12224;var bridge$12209$12225;var $12205$12218;var ph$12213;(ph$12213=$12201$12203);;($12205$12218=ph$12213);;(bridge$12206$12223=$12205$12218);if((((bridge$12206$12223 instanceof Array)&&((t0$12234=bridge$12206$12223.length),(t0$12234===0)))||((bridge$12206$12223 instanceof Array)&&((t0$12237=bridge$12206$12223.length),((t0$12237===1)&&((bridge$12207$12238=bridge$12206$12223[0]),(((bridge$12208$12242=bridge$12207$12238),((bridge$12208$12242==="i")||(bridge$12208$12242==="in")))||(bridge$12207$12238==="interactive")))))))){(repl$12246=require("repl"));;(g$12247=eg$12033.Generator());;(settings$12248=$12647(({"prompt":"<> ","ignoreUndefined":true}),((accum$12259=({})),((accum$12259["eval"]=function(input$12263,context$12264,filename$12265,callback$12266){var rval$12293;var execute$12273;var handle$12274;var result$12269;(result$12269=(((execute$12273=function(){var text$12280;(text$12280=g$12247.generate(Source$12041(input$12263.slice(1,(-1)),"<interactive>")));;return vm$12045.runInThisContext(text$12280,"stdin");})),((handle$12274=function(e$12288){display_error$12042(e$12288);return (void 0);})),(((rval$12293=false)),(function(){try{(rval$12293=execute$12273());}catch(excv$12299){var e$12305;(e$12305=excv$12299);(rval$12293=handle$12274(e$12305));}}(),rval$12293))));;return callback$12266(null,result$12269);}),accum$12259))));;(run$12249=repl$12246.start(settings$12248));;return run$12249.on("exit",function(){return run$12249.outputStream.write("\n");});}else{if((($12210$12227=($12205$12218 instanceof Array))&&((t0$12224=$12205$12218.length),((t0$12224===2)&&($12205$12218[0]==="run"))))){(file$12316=$12205$12218[1]);(data$12321=fs$12043.readFileSync(file$12316,"utf8"));;return eval(gen$12049(data$12321,file$12316));}else{if(($12210$12227&&((t0$12224>=2)&&((bridge$12209$12225=$12205$12218[0]),((bridge$12209$12225==="tr")||(bridge$12209$12225==="translate")))))){(file$12327=$12205$12218[1]);(args$12328=Array.prototype.slice.call($12205$12218,2));(out$12335=args$12328[0]);;(stats$12336=fs$12043.statSync(file$12327));;($12333$12344=null);;$12333$12344;if(stats$12336.isDirectory()){return walk$12047(file$12327,"/",function(){var rval$12397;var from$12388;var to$12389;var t0$12432;var t1$12433;var x$12426;var name$12427;var from$12428;var to$12429;var data$12430;var from$12452;var to$12453;var f$12449;var results$12421;var t0$12417;var $12358$12413;var d$12384;var $12359$12379;var $12360$12380;var $12361$12381;var t0$12376;var t1$12377;var $12357$12372;var t0$12368;var $12356$12363;($12356$12363=arguments);;(t0$12368=$12356$12363.length);if((t0$12368>=0)){($12357$12372=Array.prototype.slice.call($12356$12363,0));(t0$12376=$12357$12372);(t1$12377=t0$12376.length);if((($12361$12381=(t1$12377===2))&&(t0$12376[0]==="dir"))){(d$12384=t0$12376[1]);(from$12388=path$12044.join(file$12327,d$12384));;(to$12389=path$12044.join(out$12335,d$12384));;(rval$12397=false);;try{(rval$12397=fs$12043.mkdirSync(to$12389));}catch(excv$12403){var e$12409;(e$12409=excv$12403);(rval$12397="ignore error");}return rval$12397;}else{if(($12361$12381&&(t0$12376[0]==="file"))){($12358$12413=t0$12376[1]);(t0$12417=$12659(RegExp("(?:^((?:.*))\\.eg$)",""))($12358$12413));if((t0$12417[0]&&((results$12421=t0$12417[1]),results$12421))){(t0$12432=results$12421);if(((t0$12432 instanceof Array)&&((t1$12433=t0$12432.length),(t1$12433===2)))){(x$12426=t0$12432[0]);(name$12427=t0$12432[1]);;}else{$12691(results$12421,"/home/olivier/git/earl-grey/src/run.eg",2517,2524);}(from$12428=path$12044.join(file$12327,x$12426));;(to$12429=path$12044.join(out$12335,(name$12427+".js")));;(data$12430=fs$12043.readFileSync(from$12428,"utf8"));;return fs$12043.writeFileSync(to$12429,(gen$12049(data$12430,from$12428)+"\n"));}else{(f$12449=$12358$12413);(from$12452=path$12044.join(file$12327,f$12449));;(to$12453=path$12044.join(out$12335,f$12449));;return copy$12048(from$12452,to$12453);}}else{$12691($12357$12372,"/home/olivier/git/earl-grey/src/run.eg",2197,2202);}}}else{$12691($12356$12363);}});}else{if(out$12335){(data$12469=fs$12043.readFileSync(file$12327,"utf8"));;return fs$12043.writeFileSync(out$12335,(gen$12049(data$12469,file$12327)+"\n"));}else{(otherwise$12475=$12333$12344);($12478$12479=require("js-beautify"));;(beaut$12480=$12478$12479.js);;(data$12481=fs$12043.readFileSync(file$12327,"utf8"));;return console.log(beaut$12480(gen$12049(data$12481,file$12327)));}}}else{if(($12210$12227&&(($12212$12229=(t0$12224===2))&&($12205$12218[0]==="tok")))){(s$12493=$12205$12218[1]);(acc$12499=[]);;(temp$12504=eg$12033.tokenize(Source$12041(s$12493,null)));;($length$12509=temp$12504.length);;($index$12514=0);;$12496:for(;($index$12514<$length$12509);($index$12514++)){var token$12530;var m$12522;(m$12522=temp$12504[$index$12514]);;(token$12530=m$12522);acc$12499.push((__lt____gt__$12035(null,token$12530),__lt____gt__$12035(null,token$12530.location.ref()),__lt____gt__$12035(null,token$12530.location.highlight())));}return acc$12499;}else{if(($12212$12229&&($12205$12218[0]==="pa"))){(s$12535=$12205$12218[1]);(walkloc$12539=function($12542$12544){var t0$12553;var $index$12605;var $length$12600;var temp$12595;var acc$12590;var type$12582;var args$12583;var x$12576;var x$12569;var $12547$12564;var $12548$12565;var $12549$12566;var t0$12562;var $12546$12557;var ph$12550;var node$12551;(t0$12553=$12542$12544);(node$12551=t0$12553);(ph$12550=t0$12553);;($12546$12557=ph$12550);;if((($12547$12564=($12546$12557 instanceof Array))&&((t0$12562=$12546$12557.length),(($12549$12566=(t0$12562===2))&&($12546$12557[0]==="symbol"))))){(x$12569=$12546$12557[1]);__lt____gt__$12035(null,node$12551);return __lt____gt__$12035(null,(node$12551.location&&node$12551.location.highlight()));}else{if(($12549$12566&&($12546$12557[0]==="value"))){(x$12576=$12546$12557[1]);__lt____gt__$12035(null,node$12551);return __lt____gt__$12035(null,(node$12551.location&&node$12551.location.highlight()));}else{if(($12547$12564&&(t0$12562>=1))){(type$12582=$12546$12557[0]);(args$12583=Array.prototype.slice.call($12546$12557,1));__lt____gt__$12035(null,node$12551);__lt____gt__$12035(null,(node$12551.location&&node$12551.location.highlight()));(acc$12590=[]);;(temp$12595=args$12583);;($length$12600=temp$12595.length);;($index$12605=0);;$12587:for(;($index$12605<$length$12600);($index$12605++)){var arg$12621;var m$12613;(m$12613=temp$12595[$index$12605]);;(arg$12621=m$12613);acc$12590.push(walkloc$12539(arg$12621));}return acc$12590;}else{$12691($12546$12557);}}}});;return walkloc$12539((((tokens$12627=eg$12033.tokenize(Source$12041(s$12535,null)))),eg$12033.parse(tokens$12627)));}else{if(($12212$12229&&($12205$12218[0]==="runs"))){(data$12633=$12205$12218[1]);(code$12637=gen$12049(data$12633,"<command>"));;return __lt____gt__$12035(null,eval(code$12637));}else{(other$12643=$12205$12218);return console.log(usage$12046);}}}}}}});;(exports["run"]=run$12050);
