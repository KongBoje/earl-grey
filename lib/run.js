var τ74=function(type$12819){var f$12822;(f$12822=type$12819["::check"]);;if((f$12822===(void 0))){return function(value$12827){return (value$12827 instanceof type$12819);};}else{return function(value$12830){return f$12822.call(type$12819,value$12830);};}};
var τ75=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var τ76=function(temp$12832$12834){var ph$12838;(ph$12838=temp$12832$12834);;var m$12836$12843;(m$12836$12843=ph$12838);;var bridge$12837$12848;var x$12852;(bridge$12837$12848=m$12836$12843);if((((typeof(bridge$12837$12848)==="string")&&((x$12852=bridge$12837$12848),true))||((typeof(bridge$12837$12848)==="number")&&((x$12852=bridge$12837$12848),true)))){return ["value",x$12852];}else{var other$12859;(other$12859=m$12836$12843);return other$12859["::serialize_ast"]();}};
var send$12681;(send$12681=function(obj$12686,temp$12684$12687){var ph$12691;var msg$12692;var t0$12694;(t0$12694=temp$12684$12687);(msg$12692=t0$12694);(ph$12691=t0$12694);;var m$12689$12698;(m$12689$12698=ph$12691);;var bridge$12690$12703;(bridge$12690$12703=m$12689$12698);if(((typeof(bridge$12690$12703)==="string")||(typeof(bridge$12690$12703)==="number"))){return obj$12686[msg$12692];}else{var other$12711;(other$12711=m$12689$12698);return obj$12686["::send"](msg$12692);}});;(Array[":::project"]=function(temp$12714$12716){var ph$12719;var value$12720;var t0$12722;(t0$12722=temp$12714$12716);(value$12720=t0$12722);(ph$12719=t0$12722);;var m$12718$12726;(m$12718$12726=ph$12719);;if(τ74(Array)(m$12718$12726)){return [true,value$12720];}else{m$12718$12726;return [true,[value$12720]];}});(Array.prototype["::check"]=function(value$12740){if((value$12740 instanceof Array)){var i$12745;(i$12745=0);;$12743:for(;(i$12745<this.length);(i$12745++)){if((τ75(this,i$12745)!==τ75(value$12740,i$12745))){return false;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value$12754){if((value$12754 instanceof Array)){var i$12759;(i$12759=0);;$12757:for(;(i$12759<this.length);(i$12759++)){if((τ75(this,i$12759)!==τ75(value$12754,i$12759))){return [true,[value$12754]];}}return [true,value$12754.slice(this.length)];}else{return [true,[value$12754]];}});(Array.prototype[":::deconstruct"]=function(value$12768){return [true,value$12768.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map(τ76));});(RegExp.prototype["::check"]=function(value$12773){return value$12773.match(this);});(RegExp.prototype[":::project"]=function(value$12776){var m$12778$12780;(m$12778$12780=value$12776.match(this));;var m$12788;if((m$12778$12780===null)){(m$12788=m$12778$12780);return [false,null];}else{var m$12793;(m$12793=m$12778$12780);return [true,m$12793];}});(RegExp.prototype[":::deconstruct"]=function(value$12796){var m$12798$12800;(m$12798$12800=value$12796.match(this));;var m$12808;if((m$12798$12800===null)){(m$12808=m$12798$12800);return [false,null];}else{var m$12813;(m$12813=m$12798$12800);return [true,m$12813];}});(Function.prototype["::send"]=function(args$12816){return this.apply(this,args$12816);});
var τ77=function(dest$13694,values$13695){var k$13700;(k$13700=null);$13698:for(k$13700 in values$13695){if(values$13695.hasOwnProperty(k$13700)){(dest$13694[k$13700]=values$13695[k$13700]);}}return dest$13694;};
var τ78=function(type$13705){return function(value$13708){var f$13711;(f$13711=type$13705[":::project"]);;if((f$13711===(void 0))){var f$13716;(f$13716=type$13705["::project"]);;if((f$13716===(void 0))){return [true,type$13705(value$13708)];}else{var rval$13721;(rval$13721=false);;try{(rval$13721=[true,f$13716(value$13708)]);}catch(excv$13727){var e$13733;(e$13733=excv$13727);(rval$13721=[false,null]);}return rval$13721;}}else{return f$13711.call(type$13705,value$13708);}};};var eg$12866;var $12863$12867;var __lt____gt__$12868;var Node$12869;var $12864$12870;var enumerate$12871;var items$12872;var $12865$12873;var Source$12874;var display_error$12875;var fs$12876;var path$12877;var vm$12878;var usage$12879;var walk$12880;var copy$12881;var gen$12882;var gen2$12883;var run$12884;var _run$12885;(eg$12866=require("./earl-grey"));;($12863$12867=require("./pp"));;(__lt____gt__$12868=$12863$12867["<>"]);;(Node$12869=$12863$12867.Node);;($12864$12870=require("./util"));;(enumerate$12871=$12864$12870.enumerate);;(items$12872=$12864$12870.items);;($12865$12873=require("./location"));;(Source$12874=$12865$12873.Source);;(display_error$12875=$12865$12873.display_error);;(fs$12876=require("fs"));;(path$12877=require("path"));;(vm$12878=require("vm"));;(usage$12879="\nusage:\n\nearl translate <file> [outfile]\n  Translate a source file, output to outfile. Without outfile\n  specified, print to standard out.\n\nearl translate <directory> <outdir>\n  Translate all the .eg files in the specified directory.\n\nearl run [file] [arguments...]\n  Run the specified file as a script.\n");;(walk$12880=function(dir$12931,partial$12932,f$12933){var i$12958;var len$12953;var temp$12948;var acc$12943;var stats$12936;(stats$12936=fs$12876.statSync(dir$12931));;if(stats$12936.isDirectory()){f$12933("dir",partial$12932);(acc$12943=[]);;(temp$12948=fs$12876.readdirSync(dir$12931));;(len$12953=temp$12948.length);;(i$12958=0);;$12941:for(;(i$12958<len$12953);(i$12958++)){var newdir$12977;var newpartial$12978;var file$12974;var m$12966;(m$12966=temp$12948[i$12958]);;(file$12974=m$12966);acc$12943.push((((newdir$12977=path$12877.join(dir$12931,file$12974))),((newpartial$12978=path$12877.join(partial$12932,file$12974))),walk$12880(newdir$12977,newpartial$12978,f$12933)));}return acc$12943;}else{return f$12933("file",partial$12932);}});;(copy$12881=function(src$12989,dest$12990){var data$12993;(data$12993=fs$12876.readFileSync(src$12989,"binary"));;return fs$12876.writeFileSync(dest$12990,data$12993,"binary");});;(gen$12882=function(text$13001,file$13002){var g$13005;(g$13005=eg$12866.Generator());;return g$13005.generate(Source$12874(text$13001,path$12877.resolve(file$13002)));});;(gen2$12883=function(text$13013,file$13014){var g$13017;(g$13017=eg$12866["Generator2"]());;return g$13017.generate(Source$12874(text$13013,path$12877.resolve(file$13014)));});;(run$12884=function(cmd$13025){var rval$13028;(rval$13028=false);;try{(rval$13028=_run$12885(cmd$13025));}catch(excv$13034){var e$13040;(e$13040=excv$13034);(rval$13028=(display_error$12875(e$13040),console.log(e$13040),process.exit(1)));}return rval$13028;});;(_run$12885=function(temp$13046$13048){var t0$13081;var bridge$13053$13089;var t0$13084;var bridge$13052$13085;var accum$13102;var repl$13093;var settings$13094;var run$13095;var data$13168;var data$13309;var data$13318;var otherwise$13315;var $13181$13197;var m$13180$13191;var out$13182;var stats$13183;var data$13466;var data$13475;var otherwise$13472;var $13331$13347;var m$13330$13341;var out$13332;var stats$13333;var i$13501;var len$13496;var temp$13491;var acc$13486;var tokens$13613;var walkloc$13526;var $13623$13624;var beaut$13625;var data$13626;var code$13627;var $13646$13647;var beaut$13648;var data$13649;var code$13650;var $13669$13670;var beaut$13671;var code$13672;var other$13689;var data$13684;var s$13665;var file$13642;var file$13619;var s$13522;var s$13481;var file$13324;var args$13325;var file$13174;var args$13175;var file$13163;var $13056$13074;var $13057$13075;var $13058$13076;var bridge$13051$13069;var t0$13070;var bridge$13054$13071;var bridge$13055$13072;var m$13050$13064;var ph$13059;(ph$13059=temp$13046$13048);;(m$13050$13064=ph$13059);;(bridge$13051$13069=m$13050$13064);if((((bridge$13051$13069 instanceof Array)&&((t0$13081=bridge$13051$13069.length),(t0$13081===0)))||((bridge$13051$13069 instanceof Array)&&((t0$13084=bridge$13051$13069.length),((t0$13084===1)&&((bridge$13052$13085=bridge$13051$13069[0]),(((bridge$13053$13089=bridge$13052$13085),((bridge$13053$13089==="i")||(bridge$13053$13089==="in")))||(bridge$13052$13085==="interactive")))))))){(repl$13093=require("repl"));;(settings$13094=τ77(({"prompt":"<> ","ignoreUndefined":true}),((accum$13102=({})),((accum$13102["eval"]=function(input$13106,context$13107,filename$13108,callback$13109){var rval$13140;var execute$13120;var handle$13121;var g$13112;var result$13113;(g$13112=eg$12866.Generator());;(result$13113=(((execute$13120=function(){var text$13127;(text$13127=g$13112.generate(Source$12874(input$13106.slice(1,(-1)),"<interactive>")));;return vm$12878.runInThisContext(text$13127,"stdin");})),((handle$13121=function(e$13135){display_error$12875(e$13135);return (void 0);})),(((rval$13140=false)),(function(){try{(rval$13140=execute$13120());}catch(excv$13146){var e$13152;(e$13152=excv$13146);(rval$13140=handle$13121(e$13152));}}(),rval$13140))));;return callback$13109(null,result$13113);}),accum$13102))));;(run$13095=repl$13093.start(settings$13094));;return run$13095.on("exit",function(){return run$13095.outputStream.write("\n");});}else{if((($13056$13074=(m$13050$13064 instanceof Array))&&((t0$13070=m$13050$13064.length),((t0$13070===2)&&(m$13050$13064[0]==="run"))))){(file$13163=m$13050$13064[1]);(data$13168=fs$12876.readFileSync(file$13163,"utf8"));;return eval(gen$12882(data$13168,file$13163));}else{if(($13056$13074&&(($13058$13076=(t0$13070>=2))&&((bridge$13054$13071=m$13050$13064[0]),((bridge$13054$13071==="tr")||(bridge$13054$13071==="translate")))))){(file$13174=m$13050$13064[1]);(args$13175=Array.prototype.slice.call(m$13050$13064,2));(out$13182=args$13175[0]);;(stats$13183=fs$12876.statSync(file$13174));;(m$13180$13191=null);;m$13180$13191;if(stats$13183.isDirectory()){return walk$12880(file$13174,"/",function(){var rval$13244;var from$13235;var to$13236;var from$13275;var to$13276;var data$13277;var from$13292;var to$13293;var f$13289;var x$13269;var name$13270;var t0$13264;var t1$13265;var ph$13205$13260;var d$13231;var $13206$13226;var $13207$13227;var $13208$13228;var t0$13223;var t1$13224;var ph$13204$13219;var t0$13215;var m$13203$13210;(m$13203$13210=arguments);;(t0$13215=m$13203$13210.length);if((t0$13215>=0)){(ph$13204$13219=Array.prototype.slice.call(m$13203$13210,0));(t0$13223=ph$13204$13219);(t1$13224=t0$13223.length);if((($13208$13228=(t1$13224===2))&&(t0$13223[0]==="dir"))){(d$13231=t0$13223[1]);(from$13235=path$12877.join(file$13174,d$13231));;(to$13236=path$12877.join(out$13182,d$13231));;(rval$13244=false);;try{(rval$13244=fs$12876.mkdirSync(to$13236));}catch(excv$13250){var e$13256;(e$13256=excv$13250);(rval$13244="ignore error");}return rval$13244;}else{if(($13208$13228&&(t0$13223[0]==="file"))){(ph$13205$13260=t0$13223[1]);(t0$13264=ph$13205$13260);if((τ74(RegExp("(?:^((?:.*))\\.eg$)",""))(t0$13264)&&((t1$13265=t0$13264.length),(t1$13265===2)))){(x$13269=t0$13264[0]);(name$13270=t0$13264[1]);(from$13275=path$12877.join(file$13174,x$13269));;(to$13276=path$12877.join(out$13182,(name$13270+".js")));;(data$13277=fs$12876.readFileSync(from$13275,"utf8"));;return fs$12876.writeFileSync(to$13276,(gen$12882(data$13277,from$13275)+"\n"));}else{(f$13289=ph$13205$13260);(from$13292=path$12877.join(file$13174,f$13289));;(to$13293=path$12877.join(out$13182,f$13289));;return copy$12881(from$13292,to$13293);}}else{throw Error("mismatch!!");}}}else{throw Error("mismatch!!");}});}else{if(out$13182){(data$13309=fs$12876.readFileSync(file$13174,"utf8"));;return fs$12876.writeFileSync(out$13182,(gen$12882(data$13309,file$13174)+"\n"));}else{(otherwise$13315=m$13180$13191);(data$13318=fs$12876.readFileSync(file$13174,"utf8"));;return console.log(gen$12882(data$13318,file$13174));}}}else{if(($13058$13076&&((bridge$13055$13072=m$13050$13064[0]),((bridge$13055$13072==="tr2")||(bridge$13055$13072==="translate2"))))){(file$13324=m$13050$13064[1]);(args$13325=Array.prototype.slice.call(m$13050$13064,2));(out$13332=args$13325[0]);;(stats$13333=fs$12876.statSync(file$13324));;(m$13330$13341=null);;m$13330$13341;if(stats$13333.isDirectory()){return walk$12880(file$13324,"/",function(){var rval$13394;var from$13385;var to$13386;var t0$13429;var t1$13430;var x$13423;var name$13424;var from$13425;var to$13426;var data$13427;var from$13449;var to$13450;var f$13446;var results$13418;var t0$13414;var ph$13355$13410;var d$13381;var $13356$13376;var $13357$13377;var $13358$13378;var t0$13373;var t1$13374;var ph$13354$13369;var t0$13365;var m$13353$13360;(m$13353$13360=arguments);;(t0$13365=m$13353$13360.length);if((t0$13365>=0)){(ph$13354$13369=Array.prototype.slice.call(m$13353$13360,0));(t0$13373=ph$13354$13369);(t1$13374=t0$13373.length);if((($13358$13378=(t1$13374===2))&&(t0$13373[0]==="dir"))){(d$13381=t0$13373[1]);(from$13385=path$12877.join(file$13324,d$13381));;(to$13386=path$12877.join(out$13332,d$13381));;(rval$13394=false);;try{(rval$13394=fs$12876.mkdirSync(to$13386));}catch(excv$13400){var e$13406;(e$13406=excv$13400);(rval$13394="ignore error");}return rval$13394;}else{if(($13358$13378&&(t0$13373[0]==="file"))){(ph$13355$13410=t0$13373[1]);(t0$13414=τ78(RegExp("(?:^((?:.*))\\.eg$)",""))(ph$13355$13410));if((t0$13414[0]&&((results$13418=t0$13414[1]),results$13418))){(t0$13429=results$13418);if(((t0$13429 instanceof Array)&&((t1$13430=t0$13429.length),(t1$13430===2)))){(x$13423=t0$13429[0]);(name$13424=t0$13429[1]);;}else{throw Error("Mismatch");}(from$13425=path$12877.join(file$13324,x$13423));;(to$13426=path$12877.join(out$13332,(name$13424+".js")));;(data$13427=fs$12876.readFileSync(from$13425,"utf8"));;return fs$12876.writeFileSync(to$13426,(gen2$12883(data$13427,from$13425)+"\n"));}else{(f$13446=ph$13355$13410);(from$13449=path$12877.join(file$13324,f$13446));;(to$13450=path$12877.join(out$13332,f$13446));;return copy$12881(from$13449,to$13450);}}else{throw Error("mismatch!!");}}}else{throw Error("mismatch!!");}});}else{if(out$13332){(data$13466=fs$12876.readFileSync(file$13324,"utf8"));;return fs$12876.writeFileSync(out$13332,(gen2$12883(data$13466,file$13324)+"\n"));}else{(otherwise$13472=m$13330$13341);(data$13475=fs$12876.readFileSync(file$13324,"utf8"));;return console.log(gen2$12883(data$13475,file$13324));}}}else{if(($13056$13074&&(($13058$13076=(t0$13070===2))&&(m$13050$13064[0]==="tok")))){(s$13481=m$13050$13064[1]);(acc$13486=[]);;(temp$13491=eg$12866.tokenize(Source$12874(s$13481,null)));;(len$13496=temp$13491.length);;(i$13501=0);;$13484:for(;(i$13501<len$13496);(i$13501++)){var token$13517;var m$13509;(m$13509=temp$13491[i$13501]);;(token$13517=m$13509);acc$13486.push((__lt____gt__$12868(null,token$13517),__lt____gt__$12868(null,token$13517.location.ref()),__lt____gt__$12868(null,token$13517.location.highlight())));}return acc$13486;}else{if(($13058$13076&&(m$13050$13064[0]==="pa"))){(s$13522=m$13050$13064[1]);(walkloc$13526=function(temp$13529$13531){var t0$13540;var i$13591;var len$13586;var temp$13581;var acc$13576;var type$13569;var args$13570;var x$13563;var x$13556;var $13534$13551;var $13535$13552;var $13536$13553;var t0$13549;var m$13533$13544;var ph$13537;var node$13538;(t0$13540=temp$13529$13531);(node$13538=t0$13540);(ph$13537=t0$13540);;(m$13533$13544=ph$13537);;if((($13534$13551=(m$13533$13544 instanceof Array))&&((t0$13549=m$13533$13544.length),(($13536$13553=(t0$13549===2))&&(m$13533$13544[0]==="symbol"))))){(x$13556=m$13533$13544[1]);__lt____gt__$12868(null,node$13538);return __lt____gt__$12868(null,(node$13538.location&&node$13538.location.highlight()));}else{if(($13536$13553&&(m$13533$13544[0]==="value"))){(x$13563=m$13533$13544[1]);__lt____gt__$12868(null,node$13538);return __lt____gt__$12868(null,(node$13538.location&&node$13538.location.highlight()));}else{if(($13534$13551&&(t0$13549>=1))){(type$13569=m$13533$13544[0]);(args$13570=Array.prototype.slice.call(m$13533$13544,1));__lt____gt__$12868(null,node$13538);__lt____gt__$12868(null,(node$13538.location&&node$13538.location.highlight()));(acc$13576=[]);;(temp$13581=args$13570);;(len$13586=temp$13581.length);;(i$13591=0);;$13574:for(;(i$13591<len$13586);(i$13591++)){var arg$13607;var m$13599;(m$13599=temp$13581[i$13591]);;(arg$13607=m$13599);acc$13576.push(walkloc$13526(arg$13607));}return acc$13576;}else{throw Error("mismatch!!");}}}});;return walkloc$13526((((tokens$13613=eg$12866.tokenize(Source$12874(s$13522,null)))),eg$12866.parse(tokens$13613)));}else{if(($13058$13076&&(m$13050$13064[0]==="test"))){(file$13619=m$13050$13064[1]);($13623$13624=require("js-beautify"));;(beaut$13625=$13623$13624.js);;(data$13626=fs$12876.readFileSync(file$13619,"utf8"));;(code$13627=eg$12866["generate2"](Source$12874(data$13626,"<test>")));;return __lt____gt__$12868(null,eval(code$13627));}else{if(($13058$13076&&(m$13050$13064[0]==="inspect"))){(file$13642=m$13050$13064[1]);($13646$13647=require("js-beautify"));;(beaut$13648=$13646$13647.js);;(data$13649=fs$12876.readFileSync(file$13642,"utf8"));;(code$13650=eg$12866["generate2"](Source$12874(data$13649,"<test>")));;return console.log(beaut$13648(code$13650));}else{if(($13058$13076&&(m$13050$13064[0]==="tests"))){(s$13665=m$13050$13064[1]);($13669$13670=require("js-beautify"));;(beaut$13671=$13669$13670.js);;(code$13672=eg$12866["generate2"](Source$12874(s$13665,"<test>")));;console.log(beaut$13671(code$13672));console.log(eval(code$13672));return __lt____gt__$12868(null,eval(code$13672));}else{if(($13058$13076&&(m$13050$13064[0]==="runs"))){(data$13684=m$13050$13064[1]);return console.log(eval(gen$12882(data$13684,"<command>")));}else{(other$13689=m$13050$13064);return console.log(usage$12879);}}}}}}}}}}});;(exports["run"]=run$12884);
