var $12134=function(type$12136){var f$12139;(f$12139=type$12136["::check"]);;if((f$12139===(void 0))){return function(value$12144){return (value$12144 instanceof type$12136);};}else{return function(value$12147){return f$12139.call(type$12136,value$12147);};}};
var $12149=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $12150=function($12151$12153){var ph$12157;(ph$12157=$12151$12153);;var $12155$12162;($12155$12162=ph$12157);;var bridge$12156$12167;var x$12171;(bridge$12156$12167=$12155$12162);if((((typeof(bridge$12156$12167)==="string")&&((x$12171=bridge$12156$12167),true))||((typeof(bridge$12156$12167)==="number")&&((x$12171=bridge$12156$12167),true)))){return ["value",x$12171];}else{var other$12178;(other$12178=$12155$12162);return other$12178["::serialize_ast"]();}};
var send$11997;(send$11997=function(obj$12002,$12000$12003){var ph$12007;var msg$12008;var t0$12010;(t0$12010=$12000$12003);(msg$12008=t0$12010);(ph$12007=t0$12010);;var $12005$12014;($12005$12014=ph$12007);;var bridge$12006$12019;(bridge$12006$12019=$12005$12014);if(((typeof(bridge$12006$12019)==="string")||(typeof(bridge$12006$12019)==="number"))){return obj$12002[msg$12008];}else{var other$12027;(other$12027=$12005$12014);return obj$12002["::send"](msg$12008);}});;(Array[":::project"]=function($12030$12032){var ph$12035;var value$12036;var t0$12038;(t0$12038=$12030$12032);(value$12036=t0$12038);(ph$12035=t0$12038);;var $12034$12042;($12034$12042=ph$12035);;if($12134(Array)($12034$12042)){return [true,value$12036];}else{$12034$12042;return [true,[value$12036]];}});(Array.prototype["::check"]=function(value$12056){if((value$12056 instanceof Array)){var i$12061;(i$12061=0);;$12059:for(;(i$12061<this.length);(i$12061++)){if(($12149(this,i$12061)!==$12149(value$12056,i$12061))){return false;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value$12070){if((value$12070 instanceof Array)){var i$12075;(i$12075=0);;$12073:for(;(i$12075<this.length);(i$12075++)){if(($12149(this,i$12075)!==$12149(value$12070,i$12075))){return [true,[value$12070]];}}return [true,value$12070.slice(this.length)];}else{return [true,[value$12070]];}});(Array.prototype[":::deconstruct"]=function(value$12084){return [true,value$12084.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($12150));});(RegExp.prototype["::check"]=function(value$12089){return value$12089.match(this);});(RegExp.prototype[":::project"]=function(value$12092){var $12094$12096;($12094$12096=value$12092.match(this));;var m$12104;if(($12094$12096===null)){(m$12104=$12094$12096);return [false,null];}else{var m$12109;(m$12109=$12094$12096);return [true,m$12109];}});(RegExp.prototype[":::deconstruct"]=function(value$12112){var $12114$12116;($12114$12116=value$12112.match(this));;var m$12124;if(($12114$12116===null)){(m$12124=$12114$12116);return [false,null];}else{var m$12129;(m$12129=$12114$12116);return [true,m$12129];}});(Function.prototype["::send"]=function(args$12132){return this.apply(this,args$12132);});
var $12795=function(dest$12797,values$12798){var k$12803;(k$12803=null);$12801:for(k$12803 in values$12798){if(values$12798.hasOwnProperty(k$12803)){(dest$12797[k$12803]=values$12798[k$12803]);}}return dest$12797;};
var $12807=function(type$12809){return function(value$12812){var f$12815;(f$12815=type$12809[":::project"]);;if((f$12815===(void 0))){var f$12820;(f$12820=type$12809["::project"]);;if((f$12820===(void 0))){return [true,type$12809(value$12812)];}else{var rval$12825;(rval$12825=false);;try{(rval$12825=[true,f$12820(value$12812)]);}catch(excv$12831){var e$12837;(e$12837=excv$12831);(rval$12825=[false,null]);}return rval$12825;}}else{return f$12815.call(type$12809,value$12812);}};};
var $12852=function(){var $12853$12855;($12853$12855=function(tags$12859){var it$0$12862;(it$0$12862=function(){if((!$12134($12853$12855)(this))){return Object.create($12853$12855.prototype);}else{return this;}}());;(it$0$12862["tags"]=tags$12859);return it$0$12862;});;($12853$12855.prototype["create"]=function(){var $12871$12873;($12871$12873=arguments);;var t0$12878;var message$12882;var args$12883;(t0$12878=$12871$12873.length);if((t0$12878>=0)){(message$12882=function(){if((0>=t0$12878)){return "";}else{return $12871$12873[0];}}());(args$12883=Array.prototype.slice.call($12871$12873,1));var it$0$12887;(it$0$12887=this);;var e$12892;(e$12892=Error(message$12882));;(e$12892["::tags"]=it$0$12887.tags);(e$12892["args"]=args$12883);(e$12892["name"]=["E"].concat(it$0$12887.tags).join("."));return e$12892;}else{$12839($12871$12873);}});($12853$12855.prototype["::check"]=function(e$12901){var it$0$12904;(it$0$12904=this);;var tags$12909;if(((!e$12901)||(!$12134(Error)(e$12901)))){return false;}(tags$12909=(e$12901["::tags"]||[]));;var temp$12917;(temp$12917=it$0$12904.tags);;var len$12922;(len$12922=temp$12917.length);;var i$12927;(i$12927=0);;$12910:for(;(i$12927<len$12922);(i$12927++)){var m$12935;(m$12935=temp$12917[i$12927]);;var tag$12943;(tag$12943=m$12935);if((tags$12909.indexOf(tag$12943)===(-1))){return false;}else{false;;}}return true;});($12853$12855.prototype["::deconstruct"]=function(e$12951){var it$0$12954;(it$0$12954=this);;return e$12951.args;});$12795($12853$12855,({}));return $12853$12855;}();
var $12839=function(value$12841,url$12842,start$12843,end$12844){var err$12847;(err$12847=$12852(["match"]).create("Could not find a match for value",({"value":value$12841})));;if(url$12842){(err$12847["location"]=["location",url$12842,start$12843,end$12844]);}throw err$12847;};var eg$12184;var $12181$12185;var __lt____gt__$12186;var Node$12187;var $12182$12188;var enumerate$12189;var items$12190;var $12183$12191;var Source$12192;var display_error$12193;var fs$12194;var path$12195;var vm$12196;var usage$12197;var walk$12198;var copy$12199;var gen$12200;var run$12201;var _run$12202;(eg$12184=require("./earl-grey"));;($12181$12185=require("./pp"));;(__lt____gt__$12186=$12181$12185["<>"]);;(Node$12187=$12181$12185.Node);;($12182$12188=require("./util"));;(enumerate$12189=$12182$12188.enumerate);;(items$12190=$12182$12188.items);;($12183$12191=require("./location"));;(Source$12192=$12183$12191.Source);;(display_error$12193=$12183$12191.display_error);;(fs$12194=require("fs"));;(path$12195=require("path"));;(vm$12196=require("vm"));;(usage$12197="\nusage:\n\nearl translate <file> [outfile]\n  Translate a source file, output to outfile. Without outfile\n  specified, print to standard out.\n\nearl translate <directory> <outdir>\n  Translate all the .eg files in the specified directory.\n\nearl run [file] [arguments...]\n  Run the specified file as a script.\n");;(walk$12198=function(dir$12248,partial$12249,f$12250){var i$12275;var len$12270;var temp$12265;var acc$12260;var stats$12253;(stats$12253=fs$12194.statSync(dir$12248));;if(stats$12253.isDirectory()){f$12250("dir",partial$12249);(acc$12260=[]);;(temp$12265=fs$12194.readdirSync(dir$12248));;(len$12270=temp$12265.length);;(i$12275=0);;$12258:for(;(i$12275<len$12270);(i$12275++)){var newdir$12294;var newpartial$12295;var file$12291;var m$12283;(m$12283=temp$12265[i$12275]);;(file$12291=m$12283);acc$12260.push((((newdir$12294=path$12195.join(dir$12248,file$12291))),((newpartial$12295=path$12195.join(partial$12249,file$12291))),walk$12198(newdir$12294,newpartial$12295,f$12250)));}return acc$12260;}else{return f$12250("file",partial$12249);}});;(copy$12199=function(src$12306,dest$12307){var data$12310;(data$12310=fs$12194.readFileSync(src$12306,"binary"));;return fs$12194.writeFileSync(dest$12307,data$12310,"binary");});;(gen$12200=function(text$12318,file$12319){var g$12322;(g$12322=eg$12184.Generator());;return g$12322.generate(Source$12192(text$12318,path$12195.resolve(file$12319)));});;(run$12201=function(cmd$12330){var rval$12333;(rval$12333=false);;try{(rval$12333=_run$12202(cmd$12330));}catch(excv$12339){var e$12345;(e$12345=excv$12339);(rval$12333=(display_error$12193(e$12345),process.exit(1)));}return rval$12333;});;(_run$12202=function($12351$12353){var t0$12384;var bridge$12358$12392;var t0$12387;var bridge$12357$12388;var accum$12409;var repl$12396;var g$12397;var settings$12398;var run$12399;var data$12471;var data$12619;var $12628$12629;var beaut$12630;var data$12631;var otherwise$12625;var $12484$12500;var $12483$12494;var out$12485;var stats$12486;var i$12663;var len$12658;var temp$12653;var acc$12648;var tokens$12775;var walkloc$12688;var code$12785;var other$12791;var data$12781;var s$12684;var s$12643;var file$12477;var args$12478;var file$12466;var $12360$12377;var $12361$12378;var $12362$12379;var bridge$12356$12373;var t0$12374;var bridge$12359$12375;var $12355$12368;var ph$12363;(ph$12363=$12351$12353);;($12355$12368=ph$12363);;(bridge$12356$12373=$12355$12368);if((((bridge$12356$12373 instanceof Array)&&((t0$12384=bridge$12356$12373.length),(t0$12384===0)))||((bridge$12356$12373 instanceof Array)&&((t0$12387=bridge$12356$12373.length),((t0$12387===1)&&((bridge$12357$12388=bridge$12356$12373[0]),(((bridge$12358$12392=bridge$12357$12388),((bridge$12358$12392==="i")||(bridge$12358$12392==="in")))||(bridge$12357$12388==="interactive")))))))){(repl$12396=require("repl"));;(g$12397=eg$12184.Generator());;(settings$12398=$12795(({"prompt":"<> ","ignoreUndefined":true}),((accum$12409=({})),((accum$12409["eval"]=function(input$12413,context$12414,filename$12415,callback$12416){var rval$12443;var execute$12423;var handle$12424;var result$12419;(result$12419=(((execute$12423=function(){var text$12430;(text$12430=g$12397.generate(Source$12192(input$12413.slice(1,(-1)),"<interactive>")));;return vm$12196.runInThisContext(text$12430,"stdin");})),((handle$12424=function(e$12438){display_error$12193(e$12438);return (void 0);})),(((rval$12443=false)),(function(){try{(rval$12443=execute$12423());}catch(excv$12449){var e$12455;(e$12455=excv$12449);(rval$12443=handle$12424(e$12455));}}(),rval$12443))));;return callback$12416(null,result$12419);}),accum$12409))));;(run$12399=repl$12396.start(settings$12398));;return run$12399.on("exit",function(){return run$12399.outputStream.write("\n");});}else{if((($12360$12377=($12355$12368 instanceof Array))&&((t0$12374=$12355$12368.length),((t0$12374===2)&&($12355$12368[0]==="run"))))){(file$12466=$12355$12368[1]);(data$12471=fs$12194.readFileSync(file$12466,"utf8"));;return eval(gen$12200(data$12471,file$12466));}else{if(($12360$12377&&((t0$12374>=2)&&((bridge$12359$12375=$12355$12368[0]),((bridge$12359$12375==="tr")||(bridge$12359$12375==="translate")))))){(file$12477=$12355$12368[1]);(args$12478=Array.prototype.slice.call($12355$12368,2));(out$12485=args$12478[0]);;(stats$12486=fs$12194.statSync(file$12477));;($12483$12494=null);;$12483$12494;if(stats$12486.isDirectory()){return walk$12198(file$12477,"/",function(){var rval$12547;var from$12538;var to$12539;var t0$12582;var t1$12583;var x$12576;var name$12577;var from$12578;var to$12579;var data$12580;var from$12602;var to$12603;var f$12599;var results$12571;var t0$12567;var $12508$12563;var d$12534;var $12509$12529;var $12510$12530;var $12511$12531;var t0$12526;var t1$12527;var $12507$12522;var t0$12518;var $12506$12513;($12506$12513=arguments);;(t0$12518=$12506$12513.length);if((t0$12518>=0)){($12507$12522=Array.prototype.slice.call($12506$12513,0));(t0$12526=$12507$12522);(t1$12527=t0$12526.length);if((($12511$12531=(t1$12527===2))&&(t0$12526[0]==="dir"))){(d$12534=t0$12526[1]);(from$12538=path$12195.join(file$12477,d$12534));;(to$12539=path$12195.join(out$12485,d$12534));;(rval$12547=false);;try{(rval$12547=fs$12194.mkdirSync(to$12539));}catch(excv$12553){var e$12559;(e$12559=excv$12553);(rval$12547="ignore error");}return rval$12547;}else{if(($12511$12531&&(t0$12526[0]==="file"))){($12508$12563=t0$12526[1]);(t0$12567=$12807(RegExp("(?:^((?:.*))\\.eg$)",""))($12508$12563));if((t0$12567[0]&&((results$12571=t0$12567[1]),results$12571))){(t0$12582=results$12571);if(((t0$12582 instanceof Array)&&((t1$12583=t0$12582.length),(t1$12583===2)))){(x$12576=t0$12582[0]);(name$12577=t0$12582[1]);;}else{$12839(results$12571,"/home/olivier/git/earl-grey/src/run.eg",2517,2524);}(from$12578=path$12195.join(file$12477,x$12576));;(to$12579=path$12195.join(out$12485,(name$12577+".js")));;(data$12580=fs$12194.readFileSync(from$12578,"utf8"));;return fs$12194.writeFileSync(to$12579,(gen$12200(data$12580,from$12578)+"\n"));}else{(f$12599=$12508$12563);(from$12602=path$12195.join(file$12477,f$12599));;(to$12603=path$12195.join(out$12485,f$12599));;return copy$12199(from$12602,to$12603);}}else{$12839($12507$12522,"/home/olivier/git/earl-grey/src/run.eg",2197,2202);}}}else{$12839($12506$12513);}});}else{if(out$12485){(data$12619=fs$12194.readFileSync(file$12477,"utf8"));;return fs$12194.writeFileSync(out$12485,(gen$12200(data$12619,file$12477)+"\n"));}else{(otherwise$12625=$12483$12494);($12628$12629=require("js-beautify"));;(beaut$12630=$12628$12629.js);;(data$12631=fs$12194.readFileSync(file$12477,"utf8"));;return console.log(beaut$12630(gen$12200(data$12631,file$12477)));}}}else{if(($12360$12377&&(($12362$12379=(t0$12374===2))&&($12355$12368[0]==="tok")))){(s$12643=$12355$12368[1]);(acc$12648=[]);;(temp$12653=eg$12184.tokenize(Source$12192(s$12643,null)));;(len$12658=temp$12653.length);;(i$12663=0);;$12646:for(;(i$12663<len$12658);(i$12663++)){var token$12679;var m$12671;(m$12671=temp$12653[i$12663]);;(token$12679=m$12671);acc$12648.push((__lt____gt__$12186(null,token$12679),__lt____gt__$12186(null,token$12679.location.ref()),__lt____gt__$12186(null,token$12679.location.highlight())));}return acc$12648;}else{if(($12362$12379&&($12355$12368[0]==="pa"))){(s$12684=$12355$12368[1]);(walkloc$12688=function($12691$12693){var t0$12702;var i$12753;var len$12748;var temp$12743;var acc$12738;var type$12731;var args$12732;var x$12725;var x$12718;var $12696$12713;var $12697$12714;var $12698$12715;var t0$12711;var $12695$12706;var ph$12699;var node$12700;(t0$12702=$12691$12693);(node$12700=t0$12702);(ph$12699=t0$12702);;($12695$12706=ph$12699);;if((($12696$12713=($12695$12706 instanceof Array))&&((t0$12711=$12695$12706.length),(($12698$12715=(t0$12711===2))&&($12695$12706[0]==="symbol"))))){(x$12718=$12695$12706[1]);__lt____gt__$12186(null,node$12700);return __lt____gt__$12186(null,(node$12700.location&&node$12700.location.highlight()));}else{if(($12698$12715&&($12695$12706[0]==="value"))){(x$12725=$12695$12706[1]);__lt____gt__$12186(null,node$12700);return __lt____gt__$12186(null,(node$12700.location&&node$12700.location.highlight()));}else{if(($12696$12713&&(t0$12711>=1))){(type$12731=$12695$12706[0]);(args$12732=Array.prototype.slice.call($12695$12706,1));__lt____gt__$12186(null,node$12700);__lt____gt__$12186(null,(node$12700.location&&node$12700.location.highlight()));(acc$12738=[]);;(temp$12743=args$12732);;(len$12748=temp$12743.length);;(i$12753=0);;$12736:for(;(i$12753<len$12748);(i$12753++)){var arg$12769;var m$12761;(m$12761=temp$12743[i$12753]);;(arg$12769=m$12761);acc$12738.push(walkloc$12688(arg$12769));}return acc$12738;}else{$12839($12695$12706);}}}});;return walkloc$12688((((tokens$12775=eg$12184.tokenize(Source$12192(s$12684,null)))),eg$12184.parse(tokens$12775)));}else{if(($12362$12379&&($12355$12368[0]==="runs"))){(data$12781=$12355$12368[1]);(code$12785=gen$12200(data$12781,"<command>"));;return __lt____gt__$12186(null,eval(code$12785));}else{(other$12791=$12355$12368);return console.log(usage$12197);}}}}}}});;(exports["run"]=run$12201);
