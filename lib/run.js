var $18571=function(type$18573){var f$18576;(f$18576=type$18573["::check"]);if((f$18576===(void 0))){return function(value$18581){return (value$18581 instanceof type$18573);};}else{return function(value$18584){return f$18576.call(type$18573,value$18584);};}};
var $18586=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $18587=function(dest$18589,values$18590){var k$18595;(k$18595=null);$18593:for(k$18595 in values$18590){if(values$18590.hasOwnProperty(k$18595)){(dest$18589[k$18595]=values$18590[k$18595]);}}return dest$18589;};
var $18602=function($18603$18605){var ph$18609;(ph$18609=$18603$18605);var $18607$18614;($18607$18614=ph$18609);var bridge$18608$18619;var x$18623;(bridge$18608$18619=$18607$18614);if((((typeof(bridge$18608$18619)==="string")&&((x$18623=bridge$18608$18619),true))||((typeof(bridge$18608$18619)==="number")&&((x$18623=bridge$18608$18619),true)))){return ["value",x$18623];}else{var other$18633;(other$18633=$18607$18614);return other$18633["::serialize_ast"]();}};
var send$18378;(send$18378=function(obj$18383,$18381$18384){var ph$18388;var msg$18389;var t0$18391;(t0$18391=$18381$18384);(msg$18389=t0$18391);(ph$18388=t0$18391);var $18386$18398;($18386$18398=ph$18388);var bridge$18387$18403;(bridge$18387$18403=$18386$18398);if(((typeof(bridge$18387$18403)==="string")||(typeof(bridge$18387$18403)==="number"))){return obj$18383[msg$18389];}else{var other$18414;(other$18414=$18386$18398);return obj$18383["::send"](msg$18389);}});(Array[":::project"]=function($18419$18421){var ph$18424;var value$18425;var t0$18427;(t0$18427=$18419$18421);(value$18425=t0$18427);(ph$18424=t0$18427);var $18423$18434;($18423$18434=ph$18424);if($18571(Array)($18423$18434)){return [true,value$18425];}else{$18423$18434;return [true,[value$18425]];}});(Array.prototype["::check"]=function(value$18451){if((value$18451 instanceof Array)){var i$18456;(i$18456=0);$18454:for(;(i$18456<this.length);(i$18456++)){if(($18586(this,i$18456)!==$18586(value$18451,i$18456))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $18587(this.slice(0),this);});(Array.prototype[":::project"]=function(value$18473){if((value$18473 instanceof Array)){var i$18478;(i$18478=0);$18476:for(;(i$18478<this.length);(i$18478++)){if(($18586(this,i$18478)!==$18586(value$18473,i$18478))){return [true,[value$18473]];}}return [true,value$18473.slice(this.length)];}else{return [true,[value$18473]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($18602));});(RegExp.prototype["::check"]=function($18494$18496){var ph$18499;(ph$18499=$18494$18496);var $18498$18504;($18498$18504=ph$18499);var value$18512;if((typeof($18498$18504)==="string")){(value$18512=$18498$18504);if(value$18512.match(this)){return true;}else{return false;}}else{var other$18517;(other$18517=$18498$18504);return false;}});(RegExp.prototype[":::project"]=function($18522$18524){var ph$18527;(ph$18527=$18522$18524);var $18526$18532;($18526$18532=ph$18527);var value$18540;if((typeof($18526$18532)==="string")){(value$18540=$18526$18532);var $18543$18545;($18543$18545=value$18540.match(this));var m$18553;if(($18543$18545===null)){(m$18553=$18543$18545);return [false,null];}else{var m$18558;(m$18558=$18543$18545);return [true,m$18558];}}else{var other$18562;(other$18562=$18526$18532);return [false,null];}});(Function.prototype["::send"]=function(args$18568){return this.apply(this,args$18568);});
var $20092=function(type$20094){return function(value$20097){var f$20100;(f$20100=type$20094[":::project"]);if((f$20100===(void 0))){(f$20100=type$20094["::project"]);if((f$20100===(void 0))){return [true,type$20094(value$20097)];}else{var rval$20109;(rval$20109=false);try{(rval$20109=[true,f$20100(value$20097)]);}catch(excv$20118){var e$20124;(e$20124=excv$20118);(rval$20109=[false,null]);}return rval$20109;}}else{return f$20100.call(type$20094,value$20097);}};};
var $20200=function($20201$20203,key$20204){var ph$20208;(ph$20208=$20201$20203);var $20206$20213;($20206$20213=ph$20208);var bridge$20207$20218;(bridge$20207$20218=$20206$20213);if(((bridge$20207$20218===null)||(bridge$20207$20218===(void 0)))){return false;}else{var x$20229;if((typeof($20206$20213)==="string")){(x$20229=$20206$20213);return (key$20204 in String.prototype);}else{var x$20234;if((typeof($20206$20213)==="number")){(x$20234=$20206$20213);return (key$20204 in Number.prototype);}else{var x$20239;(x$20239=$20206$20213);return (key$20204 in x$20239);}}}};
var $20437=function(arr$20439){var results$20443;var l$20444;(results$20443=[]);(l$20444=arr$20439.length);var i$20452;(i$20452=0);$20442:for(;(i$20452<l$20444);(i$20452++)){results$20443.push([i$20452,$18586(arr$20439,i$20452)]);}return results$20443;};
var $20459=function(value$20461,url$20462,start$20463,end$20464){var err$20467;(err$20467=$20241(["match"]).create("Could not find a match for value",({"value":value$20461})));if(url$20462){(err$20467["location"]=["location",url$20462,start$20463,end$20464]);}throw err$20467;};
var $20241=function(){var $20242$20244;($20242$20244=function(tags$20248){var it$0$20251;(it$0$20251=function(){if((!$18571($20242$20244)(this))){return Object.create($20242$20244.prototype);}else{return this;}}());(it$0$20251["tags"]=tags$20248);return it$0$20251;});($20242$20244.prototype["create"]=function(){var $20263$20265;($20263$20265=arguments);var t0$20270;var message$20274;var args$20275;(t0$20270=$20263$20265.length);if((t0$20270>=0)){(message$20274=function(){if((0>=t0$20270)){return "";}else{return $20263$20265[0];}}());(args$20275=Array.prototype.slice.call($20263$20265,1));var it$0$20282;(it$0$20282=this);var self$20287;(self$20287=this);var e$20292;(e$20292=Error(message$20274));(e$20292["::tags"]=it$0$20282.tags);(e$20292["args"]=args$20275);var temp$20306;(temp$20306=$20437(args$20275));var $length$20311;($length$20311=temp$20306.length);var $index$20316;($index$20316=0);$20293:for(;($index$20316<$length$20311);($index$20316++)){var m$20324;(m$20324=temp$20306[$index$20316]);var t0$20329;var t1$20330;var i$20334;var arg$20335;(t0$20329=m$20324);if(((t0$20329 instanceof Array)&&(((t1$20330=t0$20329.length)),(t1$20330===2)))){(i$20334=t0$20329[0]);(arg$20335=t0$20329[1]);(e$20292[i$20334]=arg$20335);}else{$20459(m$20324);}}(e$20292["length"]=args$20275.length);(e$20292["name"]=["E"].concat(it$0$20282.tags).join("."));return e$20292;}else{$20459($20263$20265);}});($20242$20244.prototype["::check"]=function(e$20361){var it$0$20364;(it$0$20364=this);var self$20369;(self$20369=this);var tags$20374;if(((!e$20361)||(!$18571(Error)(e$20361)))){return false;}(tags$20374=(e$20361["::tags"]||[]));var temp$20383;(temp$20383=it$0$20364.tags);var $length$20388;($length$20388=temp$20383.length);var $index$20393;($index$20393=0);$20375:for(;($index$20393<$length$20388);($index$20393++)){var m$20401;(m$20401=temp$20383[$index$20393]);var tag$20409;(tag$20409=m$20401);if((tags$20374.indexOf(tag$20409)===-1)){return false;}else{false;}}return true;});($20242$20244.prototype["::deconstruct"]=function(e$20417){var it$0$20420;(it$0$20420=this);var self$20425;(self$20425=this);return e$20417.args;});$18587($20242$20244,$18587(function(){var accum$20430;(accum$20430=({}));(accum$20430["::name"]="$20242");return accum$20430;}(),function(){var accum$20434;(accum$20434=({}));(accum$20434["::egclass"]=true);return accum$20434;}()));return $20242$20244;}();
var $20129=function($20130$20132){var ph$20138;var x$20139;var t0$20141;(t0$20141=$20130$20132);(x$20139=t0$20141);(ph$20138=t0$20141);var $20134$20148;($20134$20148=ph$20138);var bridge$20135$20153;(bridge$20135$20153=$20134$20148);if((function(){var bridge$20136$20162;(bridge$20136$20162=bridge$20135$20153);return (function(){var bridge$20137$20168;(bridge$20137$20168=bridge$20136$20162);return ((bridge$20137$20168===(void 0))||(bridge$20137$20168===null));}()||(typeof(bridge$20136$20162)==="string"));}()||(typeof(bridge$20135$20153)==="number"))){return x$20139;}else{if($20200($20134$20148,"::clone")){$20134$20148["::clone"];return x$20139["::clone"]();}else{$20134$20148;if((Object.getPrototypeOf(x$20139)===Object.prototype)){var dest$20184;(dest$20184=({}));var k$20189;(k$20189=null);$20183:for(k$20189 in x$20139){if(Object.prototype.hasOwnProperty.call(x$20139,k$20189)){(dest$20184[k$20189]=x$20139[k$20189]);}}return dest$20184;}else{var other$20198;(other$20198=$20134$20148);throw $20241(["clone"]).create("Object cannot be cloned",({"obj":x$20139}));}}}};var eg$18640;var $18638$18641;var __lt____gt__$18642;var $18639$18643;var Source$18644;var display_error$18645;var fs$18646;var path$18647;var vm$18648;var module$18649;var usage$18650;var usage_error$18651;var extract_options$18652;var walk$18653;var copy$18654;var gen$18655;var evaluator$18656;var interactive$18657;var compile_path$18658;var run$18659;var _run$18660;(eg$18640=require("./earl-grey"));($18638$18641=require("./pp"));(__lt____gt__$18642=$18638$18641["<>"]);($18639$18643=require("./location"));(Source$18644=$18639$18643.Source);(display_error$18645=$18639$18643.display_error);(fs$18646=require("fs"));(path$18647=require("path"));(vm$18648=require("vm"));(module$18649=require("module"));(usage$18650="Usage: earl [global options] command [options] [arguments...]\n\nearl run [options] [file] [arguments...]\n  Run the specified file as a script. The arguments are available in\n  process.argv.slice{2} of the script.\n  Options:\n    -e  --eval <code>  Run the provided code instead of reading from a file.\n    -p  --print        Print the result of the evaluation to standard out.\n    -i  --interactive  Start an interactive interpreter after execution\n                       in the global environment of the script.\n\nearl compile [options] [file... | dir]\n  Compile the specified source files into .js files. The files will be\n  placed next to the originals.\n  If a directory is given, all .eg files in the directory hierarchy\n  will be compiled. The -o option can be used to compile the files\n  into a different directory (all non-eg files will be copied over).\n  Options:\n    -o  --output <dir>  Output in given directory.\n    -p  --print         Print the compiled JavaScript to standard out.\n                        No files are created.\n    -e  --eval <code>   Compile the provided code instead of reading from a file.\n    -n  --noboil        Don't produce boilerplate code (useful with -p)\n\nearl\n  Start an interactive session.\n\nGlobal options:\n  -h  --help      Print this message.\n  -v  --version   Print the version\n");(usage_error$18651=function(message$18697){console.error(usage$18650);console.error(message$18697);return process.exit(1);});(extract_options$18652=function($18703$18705,opttable$18706,optmessage$18707){var t0$18711;var results$18719;var associate$18720;var process_option$18721;var argv$18709;(t0$18711=$20092($20129)($18703$18705));if(t0$18711[0]){(argv$18709=t0$18711[1]);}else{$20459($18703$18705);}(results$18719=({}));(associate$18720=null);(process_option$18721=function(original$18731,opt$18732,last$18733){var name$18779;var name$18770;var name$18758;var $18736$18748;var $18737$18749;var $18738$18750;var $18739$18751;var t0$18746;var $18735$18741;($18735$18741=$18586(opttable$18706,opt$18732));if(($18735$18741===(void 0))){return usage_error$18651(((("Unrecognized "+optmessage$18707)+": ")+original$18731));}else{if((($18736$18748=($18735$18741 instanceof Array))&&(((t0$18746=$18735$18741.length)),(($18738$18750=(t0$18746===2))&&($18735$18741[0]==="flag"))))){(name$18758=$18735$18741[1]);(results$18719[name$18758]=true);}else{if(($18738$18750&&(($18739$18751=($18735$18741[0]==="value"))&&((name$18770=$18735$18741[1]),last$18733)))){(associate$18720=name$18770);}else{if($18739$18751){(name$18779=$18735$18741[1]);(results$18719[name$18779]=true);}else{$20459($18735$18741);}}}}});$18788:while(argv$18709.length){var $index$18881;var $length$18876;var temp$18871;var acc$18866;var other$18920;var other$18908;var opts$18849;var opt$18833;var opt$18809;var value$18810;var t0$18803;var t1$18804;var t2$18805;var $18792$18798;var arg$18793;(arg$18793=argv$18709.shift());($18792$18798=arg$18793);(t0$18803=$20092(RegExp("^--([a-zA-Z_\\-]+)=(.*)",""))($18792$18798));if((t0$18803[0]&&(((t1$18804=t0$18803[1])),(((t2$18805=t1$18804.length)),(t2$18805===3))))){t1$18804[0];(opt$18809=t1$18804[1]);(value$18810=t1$18804[2]);process_option$18721(arg$18793,opt$18809,true);(results$18719[associate$18720]=value$18810);(associate$18720=null);}else{(t0$18803=$20092(RegExp("^--([a-zA-Z_\\-]+)",""))($18792$18798));if((t0$18803[0]&&(((t1$18804=t0$18803[1])),(((t2$18805=t1$18804.length)),(t2$18805===2))))){t1$18804[0];(opt$18833=t1$18804[1]);process_option$18721(arg$18793,opt$18833,true);}else{(t0$18803=$20092(RegExp("^-([a-zA-Z_]+)",""))($18792$18798));if((t0$18803[0]&&(((t1$18804=t0$18803[1])),(((t2$18805=t1$18804.length)),(t2$18805===2))))){t1$18804[0];(opts$18849=t1$18804[1]);(acc$18866=[]);(temp$18871=opts$18849);($length$18876=temp$18871.length);($index$18881=0);$18863:for(;($index$18881<$length$18876);($index$18881++)){var ch$18903;var ch$18897;var m$18889;(m$18889=temp$18871[$index$18881]);(ch$18897=m$18889);if(($index$18881===($length$18876-1))){acc$18866.push(process_option$18721(arg$18793,ch$18897,true));}else{(ch$18903=m$18889);acc$18866.push(process_option$18721(arg$18793,ch$18903));}}acc$18866;}else{(other$18908=$18792$18798);if(associate$18720){(results$18719[associate$18720]=other$18908);(associate$18720=null);}else{(other$18920=$18792$18798);argv$18709.unshift(other$18920);break $18788;}}}}}return [results$18719,argv$18709];});(walk$18653=function(dir$18927,partial$18928,f$18929){var $index$18955;var $length$18950;var temp$18945;var acc$18940;var stats$18932;(stats$18932=fs$18646.statSync(dir$18927));if(stats$18932.isDirectory()){f$18929("dir",partial$18928);(acc$18940=[]);(temp$18945=fs$18646.readdirSync(dir$18927));($length$18950=temp$18945.length);($index$18955=0);$18937:for(;($index$18955<$length$18950);($index$18955++)){var newdir$18975;var newpartial$18976;var file$18971;var m$18963;(m$18963=temp$18945[$index$18955]);(file$18971=m$18963);acc$18940.push((((newdir$18975=path$18647.join(dir$18927,file$18971))),((newpartial$18976=path$18647.join(partial$18928,file$18971))),walk$18653(newdir$18975,newpartial$18976,f$18929)));}return acc$18940;}else{return f$18929("file",partial$18928);}});(copy$18654=function(src$18987,dest$18988){var data$18991;(data$18991=fs$18646.readFileSync(src$18987,"binary"));return fs$18646.writeFileSync(dest$18988,data$18991,"binary");});(gen$18655=function(){var g$19019;var text$19010;var file$19011;var noboil$19012;var t0$19006;var $18999$19001;($18999$19001=arguments);(t0$19006=$18999$19001.length);if(((t0$19006>=2)&&(t0$19006<=3))){(text$19010=$18999$19001[0]);(file$19011=$18999$19001[1]);(noboil$19012=function(){if((2>=t0$19006)){return false;}else{return $18999$19001[2];}}());(g$19019=eg$18640.Generator());return g$19019.generate(Source$18644(text$19010,path$18647.resolve(file$19011)),(!noboil$19012));}else{$20459($18999$19001);}});(evaluator$18656=function(options$19029){var accum$19048;var paths$19032;var e_module$19033;var e_require$19034;(paths$19032=module$18649._nodeModulePaths(options$19029.cwd));(e_module$19033=(new module$18649(options$19029.showname)));$18587(e_module$19033,({"filename":options$19029.filename,"paths":paths$19032}));(e_require$19034=function(path$19044){return module$18649._load(path$19044,e_module$19033,true);});$18587(e_require$19034,$18587(({"main":e_module$19033}),$18587(((accum$19048=({})),((accum$19048["resolve"]=function(path$19052){return module$18649._resolveFileName(path$19052,e_module$19033);}),accum$19048)),({"paths":paths$19032,"cache":require.cache}))));$18587(global,({"__filename":options$19029.filename,"__dirname":path$18647.dirname(options$19029.filename),"module":e_module$19033,"require":e_require$19034}));return function(code$19055){var script$19058;(script$19058=vm$18648.createScript(code$19055,options$19029.showname));return script$19058.runInThisContext();};});(interactive$18657=function(g$19066,e$19067){var accum$19082;var repl$19070;var settings$19071;var runner$19072;(repl$19070=require("repl"));(g$19066["interactive"]=true);(settings$19071=$18587(({"prompt":"<> ","ignoreUndefined":true}),((accum$19082=({})),((accum$19082["eval"]=function(input$19086,context$19087,filename$19088,callback$19089){var rval$19116;var execute$19096;var handle$19097;var result$19092;(result$19092=(((execute$19096=function(){var text$19103;(text$19103=g$19066.generate(Source$18644(input$19086.slice(1,-1),"<interactive>")));return e$19067(text$19103);})),((handle$19097=function(e$19111){display_error$18645(e$19111);return (void 0);})),(((rval$19116=false)),(function(){try{(rval$19116=execute$19096());}catch(excv$19125){var e$19131;(e$19131=excv$19125);(rval$19116=handle$19097(e$19131));}}(),rval$19116))));return callback$19089(null,result$19092);}),accum$19082))));(runner$19072=repl$19070.start(settings$19071));return runner$19072.on("exit",function(){return runner$19072.outputStream.write("\n");});});(compile_path$18658=function(p$19147,opts$19148){var out$19168;var $19339$19340;var beaut$19341;var name$19389;var name$19373;var t0$19367;var t1$19368;var t2$19369;var $19360$19362;var noext$19357;var else$19354;var $19317$19333;var $19316$19327;var data$19318;var code$19319;var else$19313;var $19151$19157;var stats$19152;(stats$19152=fs$18646.statSync(p$19147));($19151$19157=null);$19151$19157;if(stats$19152.isDirectory()){if(opts$19148.print){usage_error$18651("Cannot use --print when compiling a directory");}(out$19168=(opts$19148.output||p$19147));return walk$18653(p$19147,"/",function(){var rval$19225;var to$19220;var from$19215;var t0$19269;var t1$19270;var x$19263;var name$19264;var from$19265;var to$19266;var data$19267;var from$19299;var to$19300;var f$19296;var results$19255;var t0$19251;var $19176$19247;var d$19205;var $19177$19200;var $19178$19201;var $19179$19202;var t0$19197;var t1$19198;var $19175$19190;var t0$19186;var $19174$19181;($19174$19181=arguments);(t0$19186=$19174$19181.length);if((t0$19186>=0)){($19175$19190=Array.prototype.slice.call($19174$19181,0));(t0$19197=$19175$19190);(t1$19198=t0$19197.length);if((($19179$19202=(t1$19198===2))&&(t0$19197[0]==="dir"))){(d$19205=t0$19197[1]);(from$19215=path$18647.join(p$19147,d$19205));if(opts$19148.output){(to$19220=path$18647.join(out$19168,d$19205));(rval$19225=false);try{(rval$19225=fs$18646.mkdirSync(to$19220));}catch(excv$19234){var e$19240;(e$19240=excv$19234);(rval$19225="ignore error");}return rval$19225;}}else{if(($19179$19202&&(t0$19197[0]==="file"))){($19176$19247=t0$19197[1]);(t0$19251=$20092(RegExp("(?:^((?:.*))\\.eg$)",""))($19176$19247));if((t0$19251[0]&&((results$19255=t0$19251[1]),results$19255))){(t0$19269=results$19255);if(((t0$19269 instanceof Array)&&(((t1$19270=t0$19269.length)),(t1$19270===2)))){(x$19263=t0$19269[0]);(name$19264=t0$19269[1]);}else{$20459(results$19255,"/home/olivier/git/earl-grey/src/run.eg",5206,5213);}(from$19265=path$18647.join(p$19147,x$19263));(to$19266=path$18647.join(out$19168,(name$19264+".js")));(data$19267=fs$18646.readFileSync(from$19265,"utf8"));return fs$18646.writeFileSync(to$19266,(gen$18655(data$19267,from$19265,opts$19148.noboil)+"\n"));}else{$19176$19247;if((!opts$19148.output)){return null;}else{(f$19296=$19176$19247);(from$19299=path$18647.join(p$19147,f$19296));(to$19300=path$18647.join(out$19168,f$19296));return copy$18654(from$19299,to$19300);}}}else{$20459($19175$19190,"/home/olivier/git/earl-grey/src/run.eg",4873,4878);}}}else{$20459($19174$19181);}});}else{(else$19313=$19151$19157);(data$19318=fs$18646.readFileSync(p$19147,"utf8"));(code$19319=gen$18655(data$19318,p$19147,opts$19148.noboil));($19316$19327=null);$19316$19327;if(opts$19148.print){($19339$19340=require("js-beautify"));(beaut$19341=$19339$19340.js);return console.log(beaut$19341(code$19319));}else{if(opts$19148.output){return fs$18646.writeFileSync(opts$19148.output,(code$19319+"\n"));}else{(else$19354=$19316$19327);(noext$19357=((($19360$19362=p$19147)),(((t0$19367=$20092(RegExp("^(.*).eg$",""))($19360$19362))),function(){if((t0$19367[0]&&(((t1$19368=t0$19367[1])),(((t2$19369=t1$19368.length)),(t2$19369===2))))){t1$19368[0];(name$19373=t1$19368[1]);return name$19373;}else{(name$19389=$19360$19362);return name$19389;}}())));return fs$18646.writeFileSync((noext$19357+".js"),(code$19319+"\n"));}}}});(run$18659=function(argv$19396){var t0$19402;var t1$19403;var rval$19415;var opts$19399;var cmd$19400;(t0$19402=extract_options$18652(argv$19396,({"h":["flag","help"],"help":["flag","help"],"v":["flag","version"],"version":["flag","version"]}),"global option"));if(((t0$19402 instanceof Array)&&(((t1$19403=t0$19402.length)),(t1$19403===2)))){(opts$19399=t0$19402[0]);(cmd$19400=t0$19402[1]);}else{$20459(extract_options$18652(argv$19396,({"h":["flag","help"],"help":["flag","help"],"v":["flag","version"],"version":["flag","version"]}),"global option"),"/home/olivier/git/earl-grey/src/run.eg",6320,6513);}(rval$19415=false);try{(rval$19415=_run$18660(cmd$19400,opts$19399));}catch(excv$19424){var e$19430;(e$19430=excv$19424);(rval$19415=(display_error$18645(e$19430),process.exit(1)));}return rval$19415;});(_run$18660=function($19439$19441,opts$19442){var t0$19482;var t0$19488;var t0$19514;var t1$19515;var data$19560;var file$19553;var $19533$19542;var t0$19540;var $19532$19535;var data$19601;var file$19594;var $19574$19583;var t0$19581;var $19573$19576;var t0$19527;var t1$19528;var o$19504;var rest$19505;var file$19506;var wd$19507;var data$19508;var args$19509;var e$19510;var g$19511;var result$19512;var t0$19630;var t1$19631;var else$19675;var $19657$19663;var code$19658;var $index$19721;var $length$19716;var temp$19711;var acc$19706;var paths$19696;var p$19687;var $19625$19650;var $19626$19651;var t0$19648;var $19624$19643;var o$19627;var rest$19628;var data$19913;var $19922$19923;var beaut$19924;var data$19925;var otherwise$19919;var $19754$19770;var $19753$19764;var out$19755;var stats$19756;var $index$19958;var $length$19953;var temp$19948;var acc$19943;var tokens$20079;var walkloc$19984;var stuff$20085;var s$19980;var s$19937;var file$19744;var args$19745;var rawargs$19620;var rawargs$19496;var $19447$19464;var $19448$19465;var $19449$19466;var bridge$19445$19460;var t0$19461;var bridge$19446$19462;var $19444$19455;var ph$19450;(ph$19450=$19439$19441);($19444$19455=ph$19450);$19444$19455;if(opts$19442.help){return console.log(usage$18650);}else{if(opts$19442.version){return console.log("Earl Grey version",eg$18640.version);}else{(bridge$19445$19460=$19444$19455);if((((bridge$19445$19460 instanceof Array)&&(((t0$19482=bridge$19445$19460.length)),(t0$19482===0)))||((bridge$19445$19460 instanceof Array)&&(((t0$19488=bridge$19445$19460.length)),((t0$19488===1)&&(bridge$19445$19460[0]==="run")))))){return _run$18660(["run","-i"],opts$19442);}else{if((($19447$19464=($19444$19455 instanceof Array))&&(((t0$19461=$19444$19455.length)),(($19449$19466=(t0$19461>=1))&&($19444$19455[0]==="run"))))){(rawargs$19496=Array.prototype.slice.call($19444$19455,1));(t0$19514=extract_options$18652(rawargs$19496,({"e":["value","evaluate"],"eval":["value","evaluate"],"p":["flag","print"],"print":["flag","print"],"i":["flag","interactive"],"interactive":["flag","interactive"]}),"option for run"));if(((t0$19514 instanceof Array)&&(((t1$19515=t0$19514.length)),(t1$19515===2)))){(o$19504=t0$19514[0]);(rest$19505=t0$19514[1]);}else{$20459(extract_options$18652(rawargs$19496,({"e":["value","evaluate"],"eval":["value","evaluate"],"p":["flag","print"],"print":["flag","print"],"i":["flag","interactive"],"interactive":["flag","interactive"]}),"option for run"),"/home/olivier/git/earl-grey/src/run.eg",6858,6906);}(t0$19527=function(){if(o$19504.evaluate){return ["<repl>",process.cwd(),o$19504.evaluate,rest$19505];}else{($19532$19535=rest$19505.shift());if((($19533$19542=($19532$19535===(void 0)))&&o$19504.interactive)){return ["<repl>",process.cwd(),"",rest$19505];}else{if($19533$19542){return usage_error$18651("No filename specified.");}else{(t0$19540=$20092(path$18647.resolve)($19532$19535));if(t0$19540[0]){(file$19553=t0$19540[1]);(data$19560=fs$18646.readFileSync(file$19553,"utf8"));return [file$19553,file$19553,data$19560,rest$19505];}else{$20459($19532$19535);}}}}}());if(((t0$19527 instanceof Array)&&(((t1$19528=t0$19527.length)),(t1$19528===4)))){(file$19506=t0$19527[0]);(wd$19507=t0$19527[1]);(data$19508=t0$19527[2]);(args$19509=t0$19527[3]);}else{$20459(function(){if(o$19504.evaluate){return ["<repl>",process.cwd(),o$19504.evaluate,rest$19505];}else{($19573$19576=rest$19505.shift());if((($19574$19583=($19573$19576===(void 0)))&&o$19504.interactive)){return ["<repl>",process.cwd(),"",rest$19505];}else{if($19574$19583){return usage_error$18651("No filename specified.");}else{(t0$19581=$20092(path$18647.resolve)($19573$19576));if(t0$19581[0]){(file$19594=t0$19581[1]);(data$19601=fs$18646.readFileSync(file$19594,"utf8"));return [file$19594,file$19594,data$19601,rest$19505];}else{$20459($19573$19576);}}}}}(),"/home/olivier/git/earl-grey/src/run.eg",7153,7666);}(e$19510=evaluator$18656(({"filename":file$19506,"showname":file$19506,"cwd":file$19506})));(g$19511=eg$18640.Generator(o$19504.interactive));(result$19512=e$19510(g$19511.generate(Source$18644(data$19508,file$19506))));if(o$19504.print){console.log(result$19512);}if(o$19504.interactive){return interactive$18657(g$19511,e$19510);}}else{if(($19449$19466&&($19444$19455[0]==="compile"))){(rawargs$19620=Array.prototype.slice.call($19444$19455,1));(t0$19630=extract_options$18652(rawargs$19620,({"o":["value","output"],"output":["value","output"],"p":["flag","print"],"print":["flag","print"],"e":["value","evaluate"],"eval":["value","evaluate"],"n":["flag","noboil"],"noboil":["flag","noboil"]}),"option for compile"));if(((t0$19630 instanceof Array)&&(((t1$19631=t0$19630.length)),(t1$19631===2)))){(o$19627=t0$19630[0]);(rest$19628=t0$19630[1]);}else{$20459(extract_options$18652(rawargs$19620,({"o":["value","output"],"output":["value","output"],"p":["flag","print"],"print":["flag","print"],"e":["value","evaluate"],"eval":["value","evaluate"],"n":["flag","noboil"],"noboil":["flag","noboil"]}),"option for compile"),"/home/olivier/git/earl-grey/src/run.eg",8006,8058);}($19624$19643=rest$19628);$19624$19643;if(o$19627.evaluate){(code$19658=gen$18655(o$19627.evaluate,"<cli>",o$19627.noboil));($19657$19663=null);$19657$19663;if(o$19627.output){return fs$18646.writeFileSync(o$19627.output,(code$19658+"\n"));}else{(else$19675=$19657$19663);return console.log(code$19658);}}else{if((($19625$19650=($19624$19643 instanceof Array))&&(((t0$19648=$19624$19643.length)),(t0$19648===0)))){return usage_error$18651("Must provide at least one file or directory to compile.");}else{if(($19625$19650&&(t0$19648===1))){(p$19687=$19624$19643[0]);return compile_path$18658(p$19687,o$19627);}else{$19624$19643;if(o$19627.output){return usage_error$18651("The -o option cannot be used if more than one file or directory is compiled.");}else{if((($19624$19643 instanceof Array)&&(((t0$19648=$19624$19643.length)),(t0$19648>=0)))){(paths$19696=Array.prototype.slice.call($19624$19643,0));(acc$19706=[]);(temp$19711=paths$19696);($length$19716=temp$19711.length);($index$19721=0);$19703:for(;($index$19721<$length$19716);($index$19721++)){var p$19737;var m$19729;(m$19729=temp$19711[$index$19721]);(p$19737=m$19729);acc$19706.push(compile_path$18658(p$19737,o$19627));}return acc$19706;}else{$20459($19624$19643);}}}}}}else{if(($19447$19464&&((t0$19461>=2)&&(((bridge$19446$19462=$19444$19455[0])),((bridge$19446$19462==="tr")||(bridge$19446$19462==="translate")))))){(file$19744=$19444$19455[1]);(args$19745=Array.prototype.slice.call($19444$19455,2));(out$19755=args$19745[0]);(stats$19756=fs$18646.statSync(file$19744));($19753$19764=null);$19753$19764;if(stats$19756.isDirectory()){return walk$18653(file$19744,"/",function(){var rval$19826;var from$19817;var to$19818;var t0$19870;var t1$19871;var x$19864;var name$19865;var from$19866;var to$19867;var data$19868;var from$19896;var to$19897;var f$19893;var results$19856;var t0$19852;var $19778$19848;var d$19807;var $19779$19802;var $19780$19803;var $19781$19804;var t0$19799;var t1$19800;var $19777$19792;var t0$19788;var $19776$19783;($19776$19783=arguments);(t0$19788=$19776$19783.length);if((t0$19788>=0)){($19777$19792=Array.prototype.slice.call($19776$19783,0));(t0$19799=$19777$19792);(t1$19800=t0$19799.length);if((($19781$19804=(t1$19800===2))&&(t0$19799[0]==="dir"))){(d$19807=t0$19799[1]);(from$19817=path$18647.join(file$19744,d$19807));(to$19818=path$18647.join(out$19755,d$19807));(rval$19826=false);try{(rval$19826=fs$18646.mkdirSync(to$19818));}catch(excv$19835){var e$19841;(e$19841=excv$19835);(rval$19826="ignore error");}return rval$19826;}else{if(($19781$19804&&(t0$19799[0]==="file"))){($19778$19848=t0$19799[1]);(t0$19852=$20092(RegExp("(?:^((?:.*))\\.eg$)",""))($19778$19848));if((t0$19852[0]&&((results$19856=t0$19852[1]),results$19856))){(t0$19870=results$19856);if(((t0$19870 instanceof Array)&&(((t1$19871=t0$19870.length)),(t1$19871===2)))){(x$19864=t0$19870[0]);(name$19865=t0$19870[1]);}else{$20459(results$19856,"/home/olivier/git/earl-grey/src/run.eg",9499,9506);}(from$19866=path$18647.join(file$19744,x$19864));(to$19867=path$18647.join(out$19755,(name$19865+".js")));(data$19868=fs$18646.readFileSync(from$19866,"utf8"));return fs$18646.writeFileSync(to$19867,(gen$18655(data$19868,from$19866)+"\n"));}else{(f$19893=$19778$19848);(from$19896=path$18647.join(file$19744,f$19893));(to$19897=path$18647.join(out$19755,f$19893));return copy$18654(from$19896,to$19897);}}else{$20459($19777$19792,"/home/olivier/git/earl-grey/src/run.eg",9179,9184);}}}else{$20459($19776$19783);}});}else{if(out$19755){(data$19913=fs$18646.readFileSync(file$19744,"utf8"));return fs$18646.writeFileSync(out$19755,(gen$18655(data$19913,file$19744)+"\n"));}else{(otherwise$19919=$19753$19764);($19922$19923=require("js-beautify"));(beaut$19924=$19922$19923.js);(data$19925=fs$18646.readFileSync(file$19744,"utf8"));return console.log(beaut$19924(gen$18655(data$19925,file$19744)));}}}else{if(($19447$19464&&(($19449$19466=(t0$19461===2))&&($19444$19455[0]==="tok")))){(s$19937=$19444$19455[1]);(acc$19943=[]);(temp$19948=eg$18640.tokenize(Source$18644(s$19937,null)));($length$19953=temp$19948.length);($index$19958=0);$19940:for(;($index$19958<$length$19953);($index$19958++)){var token$19974;var m$19966;(m$19966=temp$19948[$index$19958]);(token$19974=m$19966);acc$19943.push((__lt____gt__$18642(null,token$19974),__lt____gt__$18642(null,token$19974.location.ref()),__lt____gt__$18642(null,token$19974.location.highlight())));}return acc$19943;}else{if(($19449$19466&&($19444$19455[0]==="pa"))){(s$19980=$19444$19455[1]);(walkloc$19984=function($19987$19989){var t0$19998;var $index$20056;var $length$20051;var temp$20046;var acc$20041;var type$20033;var args$20034;var x$20027;var x$20017;var $19992$20012;var $19993$20013;var $19994$20014;var t0$20010;var $19991$20005;var ph$19995;var node$19996;(t0$19998=$19987$19989);(node$19996=t0$19998);(ph$19995=t0$19998);($19991$20005=ph$19995);if((($19992$20012=($19991$20005 instanceof Array))&&(((t0$20010=$19991$20005.length)),(($19994$20014=(t0$20010===2))&&($19991$20005[0]==="symbol"))))){(x$20017=$19991$20005[1]);__lt____gt__$18642(null,node$19996);return __lt____gt__$18642(null,(node$19996.location&&node$19996.location.highlight()));}else{if(($19994$20014&&($19991$20005[0]==="value"))){(x$20027=$19991$20005[1]);__lt____gt__$18642(null,node$19996);return __lt____gt__$18642(null,(node$19996.location&&node$19996.location.highlight()));}else{if(($19992$20012&&(t0$20010>=1))){(type$20033=$19991$20005[0]);(args$20034=Array.prototype.slice.call($19991$20005,1));__lt____gt__$18642(null,node$19996);__lt____gt__$18642(null,(node$19996.location&&node$19996.location.highlight()));(acc$20041=[]);(temp$20046=args$20034);($length$20051=temp$20046.length);($index$20056=0);$20038:for(;($index$20056<$length$20051);($index$20056++)){var arg$20072;var m$20064;(m$20064=temp$20046[$index$20056]);(arg$20072=m$20064);acc$20041.push(walkloc$19984(arg$20072));}return acc$20041;}else{$20459($19991$20005);}}}});return walkloc$19984((((tokens$20079=eg$18640.tokenize(Source$18644(s$19980,null)))),eg$18640.parse(tokens$20079)));}else{(stuff$20085=$19444$19455);return usage_error$18651(("Invalid use. Did you mean: earl run "+stuff$20085.join(" ")));}}}}}}}}});(exports["run"]=run$18659);
