var $15054=function(type$15056){var f$15059;(f$15059=type$15056["::check"]);;if((f$15059===(void 0))){return function(value$15064){return (value$15064 instanceof type$15056);};}else{return function(value$15067){return f$15059.call(type$15056,value$15067);};}};
var $15069=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $15070=function(dest$15072,values$15073){var k$15078;(k$15078=null);$15076:for(k$15078 in values$15073){if(values$15073.hasOwnProperty(k$15078)){(dest$15072[k$15078]=values$15073[k$15078]);}}return dest$15072;};
var $15082=function($15083$15085){var ph$15089;(ph$15089=$15083$15085);;var $15087$15094;($15087$15094=ph$15089);;var bridge$15088$15099;var x$15103;(bridge$15088$15099=$15087$15094);if((((typeof(bridge$15088$15099)==="string")&&((x$15103=bridge$15088$15099),true))||((typeof(bridge$15088$15099)==="number")&&((x$15103=bridge$15088$15099),true)))){return ["value",x$15103];}else{var other$15110;(other$15110=$15087$15094);return other$15110["::serialize_ast"]();}};
var send$14894;(send$14894=function(obj$14899,$14897$14900){var ph$14904;var msg$14905;var t0$14907;(t0$14907=$14897$14900);(msg$14905=t0$14907);(ph$14904=t0$14907);;var $14902$14911;($14902$14911=ph$14904);;var bridge$14903$14916;(bridge$14903$14916=$14902$14911);if(((typeof(bridge$14903$14916)==="string")||(typeof(bridge$14903$14916)==="number"))){return obj$14899[msg$14905];}else{var other$14924;(other$14924=$14902$14911);return obj$14899["::send"](msg$14905);}});;(Array[":::project"]=function($14927$14929){var ph$14932;var value$14933;var t0$14935;(t0$14935=$14927$14929);(value$14933=t0$14935);(ph$14932=t0$14935);;var $14931$14939;($14931$14939=ph$14932);;if($15054(Array)($14931$14939)){return [true,value$14933];}else{$14931$14939;return [true,[value$14933]];}});(Array.prototype["::check"]=function(value$14953){if((value$14953 instanceof Array)){var i$14958;(i$14958=0);;$14956:for(;(i$14958<this.length);(i$14958++)){if(($15069(this,i$14958)!==$15069(value$14953,i$14958))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $15070(this.slice(0),this);});(Array.prototype[":::project"]=function(value$14969){if((value$14969 instanceof Array)){var i$14974;(i$14974=0);;$14972:for(;(i$14974<this.length);(i$14974++)){if(($15069(this,i$14974)!==$15069(value$14969,i$14974))){return [true,[value$14969]];}}return [true,value$14969.slice(this.length)];}else{return [true,[value$14969]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($15082));});(RegExp.prototype["::check"]=function($14984$14986){var ph$14989;(ph$14989=$14984$14986);;var $14988$14994;($14988$14994=ph$14989);;var value$15002;if((typeof($14988$14994)==="string")){(value$15002=$14988$14994);if(value$15002.match(this)){return true;}else{return false;}}else{var other$15007;(other$15007=$14988$14994);return false;}});(RegExp.prototype[":::project"]=function($15009$15011){var ph$15014;(ph$15014=$15009$15011);;var $15013$15019;($15013$15019=ph$15014);;var value$15027;if((typeof($15013$15019)==="string")){(value$15027=$15013$15019);var $15030$15032;($15030$15032=value$15027.match(this));;var m$15040;if(($15030$15032===null)){(m$15040=$15030$15032);return [false,null];}else{var m$15045;(m$15045=$15030$15032);return [true,m$15045];}}else{var other$15049;(other$15049=$15013$15019);return [false,null];}});(Function.prototype["::send"]=function(args$15052){return this.apply(this,args$15052);});
var $15725=function(type$15727){return function(value$15730){var f$15733;(f$15733=type$15727[":::project"]);;if((f$15733===(void 0))){(f$15733=type$15727["::project"]);if((f$15733===(void 0))){return [true,type$15727(value$15730)];}else{var rval$15739;(rval$15739=false);;try{(rval$15739=[true,f$15733(value$15730)]);}catch(excv$15745){var e$15751;(e$15751=excv$15745);(rval$15739=[false,null]);}return rval$15739;}}else{return f$15733.call(type$15727,value$15730);}};};
var $15935=function(arr$15937){var results$15941;var l$15942;(results$15941=[]);;(l$15942=arr$15937.length);;var i$15950;(i$15950=0);;$15940:for(;(i$15950<l$15942);(i$15950++)){results$15941.push([i$15950,$15069(arr$15937,i$15950)]);}return results$15941;};
var $15766=function(){var $15767$15769;($15767$15769=function(tags$15773){var it$0$15776;(it$0$15776=function(){if((!$15054($15767$15769)(this))){return Object.create($15767$15769.prototype);}else{return this;}}());;(it$0$15776["tags"]=tags$15773);return it$0$15776;});;($15767$15769.prototype["create"]=function(){var $15785$15787;($15785$15787=arguments);;var t0$15792;var message$15796;var args$15797;(t0$15792=$15785$15787.length);if((t0$15792>=0)){(message$15796=function(){if((0>=t0$15792)){return "";}else{return $15785$15787[0];}}());(args$15797=Array.prototype.slice.call($15785$15787,1));var it$0$15801;(it$0$15801=this);;var self$15806;(self$15806=this);;var e$15811;(e$15811=Error(message$15796));;(e$15811["::tags"]=it$0$15801.tags);(e$15811["args"]=args$15797);var temp$15819;(temp$15819=$15935(args$15797));;var $length$15824;($length$15824=temp$15819.length);;var $index$15829;($index$15829=0);;$15812:for(;($index$15829<$length$15824);($index$15829++)){var m$15837;(m$15837=temp$15819[$index$15829]);;var t0$15842;var t1$15843;var i$15847;var arg$15848;(t0$15842=m$15837);if(((t0$15842 instanceof Array)&&((t1$15843=t0$15842.length),(t1$15843===2)))){(i$15847=t0$15842[0]);(arg$15848=t0$15842[1]);(e$15811[i$15847]=arg$15848);}else{$15753(m$15837);;}}(e$15811["length"]=args$15797.length);(e$15811["name"]=["E"].concat(it$0$15801.tags).join("."));return e$15811;}else{$15753($15785$15787);}});($15767$15769.prototype["::check"]=function(e$15859){var it$0$15862;(it$0$15862=this);;var self$15867;(self$15867=this);;var tags$15872;if(((!e$15859)||(!$15054(Error)(e$15859)))){return false;}(tags$15872=(e$15859["::tags"]||[]));;var temp$15881;(temp$15881=it$0$15862.tags);;var $length$15886;($length$15886=temp$15881.length);;var $index$15891;($index$15891=0);;$15873:for(;($index$15891<$length$15886);($index$15891++)){var m$15899;(m$15899=temp$15881[$index$15891]);;var tag$15907;(tag$15907=m$15899);if((tags$15872.indexOf(tag$15907)===-1)){return false;}else{false;;}}return true;});($15767$15769.prototype["::deconstruct"]=function(e$15915){var it$0$15918;(it$0$15918=this);;var self$15923;(self$15923=this);;return e$15915.args;});$15070($15767$15769,$15070(function(){var accum$15928;(accum$15928=({}));(accum$15928["::name"]="$15767");return accum$15928;}(),function(){var accum$15932;(accum$15932=({}));(accum$15932["::egclass"]=true);return accum$15932;}()));return $15767$15769;}();
var $15753=function(value$15755,url$15756,start$15757,end$15758){var err$15761;(err$15761=$15766(["match"]).create("Could not find a match for value",({"value":value$15755})));;if(url$15756){(err$15761["location"]=["location",url$15756,start$15757,end$15758]);}throw err$15761;};var eg$15117;var $15115$15118;var __lt____gt__$15119;var $15116$15120;var Source$15121;var display_error$15122;var fs$15123;var path$15124;var vm$15125;var usage$15126;var walk$15127;var copy$15128;var gen$15129;var run$15130;var _run$15131;(eg$15117=require("./earl-grey"));;($15115$15118=require("./pp"));;(__lt____gt__$15119=$15115$15118["<>"]);;($15116$15120=require("./location"));;(Source$15121=$15116$15120.Source);;(display_error$15122=$15116$15120.display_error);;(fs$15123=require("fs"));;(path$15124=require("path"));;(vm$15125=require("vm"));;(usage$15126="\nusage:\n\nearl translate <file> [outfile]\n  Translate a source file, output to outfile. Without outfile\n  specified, print to standard out.\n\nearl translate <directory> <outdir>\n  Translate all the .eg files in the specified directory.\n\nearl run [file] [arguments...]\n  Run the specified file as a script.\n");;(walk$15127=function(dir$15165,partial$15166,f$15167){var $index$15193;var $length$15188;var temp$15183;var acc$15178;var stats$15170;(stats$15170=fs$15123.statSync(dir$15165));;if(stats$15170.isDirectory()){f$15167("dir",partial$15166);(acc$15178=[]);;(temp$15183=fs$15123.readdirSync(dir$15165));;($length$15188=temp$15183.length);;($index$15193=0);;$15175:for(;($index$15193<$length$15188);($index$15193++)){var newdir$15212;var newpartial$15213;var file$15209;var m$15201;(m$15201=temp$15183[$index$15193]);;(file$15209=m$15201);acc$15178.push((((newdir$15212=path$15124.join(dir$15165,file$15209))),((newpartial$15213=path$15124.join(partial$15166,file$15209))),walk$15127(newdir$15212,newpartial$15213,f$15167)));}return acc$15178;}else{return f$15167("file",partial$15166);}});;(copy$15128=function(src$15224,dest$15225){var data$15228;(data$15228=fs$15123.readFileSync(src$15224,"binary"));;return fs$15123.writeFileSync(dest$15225,data$15228,"binary");});;(gen$15129=function(text$15236,file$15237){var g$15240;(g$15240=eg$15117.Generator());;return g$15240.generate(Source$15121(text$15236,path$15124.resolve(file$15237)));});;(run$15130=function(cmd$15248){var rval$15251;(rval$15251=false);;try{(rval$15251=_run$15131(cmd$15248));}catch(excv$15257){var e$15263;(e$15263=excv$15257);(rval$15251=(display_error$15122(e$15263),process.exit(1)));}return rval$15251;});;(_run$15131=function($15269$15271){var t0$15302;var bridge$15276$15310;var t0$15305;var bridge$15275$15306;var accum$15327;var repl$15314;var g$15315;var settings$15316;var runner$15317;var data$15389;var data$15537;var $15546$15547;var beaut$15548;var data$15549;var otherwise$15543;var $15402$15418;var $15401$15412;var out$15403;var stats$15404;var $index$15582;var $length$15577;var temp$15572;var acc$15567;var tokens$15695;var walkloc$15607;var code$15705;var code$15715;var other$15721;var data$15711;var data$15701;var s$15603;var s$15561;var file$15395;var args$15396;var file$15384;var $15278$15295;var $15279$15296;var $15280$15297;var bridge$15274$15291;var t0$15292;var bridge$15277$15293;var $15273$15286;var ph$15281;(ph$15281=$15269$15271);;($15273$15286=ph$15281);;(bridge$15274$15291=$15273$15286);if((((bridge$15274$15291 instanceof Array)&&((t0$15302=bridge$15274$15291.length),(t0$15302===0)))||((bridge$15274$15291 instanceof Array)&&((t0$15305=bridge$15274$15291.length),((t0$15305===1)&&((bridge$15275$15306=bridge$15274$15291[0]),(((bridge$15276$15310=bridge$15275$15306),((bridge$15276$15310==="i")||(bridge$15276$15310==="in")))||(bridge$15275$15306==="interactive")))))))){(repl$15314=require("repl"));;(g$15315=eg$15117.Generator(true));;(settings$15316=$15070(({"prompt":"<> ","ignoreUndefined":true}),((accum$15327=({})),((accum$15327["eval"]=function(input$15331,context$15332,filename$15333,callback$15334){var rval$15361;var execute$15341;var handle$15342;var result$15337;(result$15337=(((execute$15341=function(){var text$15348;(text$15348=g$15315.generate(Source$15121(input$15331.slice(1,-1),"<interactive>")));;return vm$15125.runInThisContext(text$15348,"stdin");})),((handle$15342=function(e$15356){display_error$15122(e$15356);return (void 0);})),(((rval$15361=false)),(function(){try{(rval$15361=execute$15341());}catch(excv$15367){var e$15373;(e$15373=excv$15367);(rval$15361=handle$15342(e$15373));}}(),rval$15361))));;return callback$15334(null,result$15337);}),accum$15327))));;(runner$15317=repl$15314.start(settings$15316));;return runner$15317.on("exit",function(){return runner$15317.outputStream.write("\n");});}else{if((($15278$15295=($15273$15286 instanceof Array))&&((t0$15292=$15273$15286.length),((t0$15292===2)&&($15273$15286[0]==="run"))))){(file$15384=$15273$15286[1]);(data$15389=fs$15123.readFileSync(file$15384,"utf8"));;return eval(gen$15129(data$15389,file$15384));}else{if(($15278$15295&&((t0$15292>=2)&&((bridge$15277$15293=$15273$15286[0]),((bridge$15277$15293==="tr")||(bridge$15277$15293==="translate")))))){(file$15395=$15273$15286[1]);(args$15396=Array.prototype.slice.call($15273$15286,2));(out$15403=args$15396[0]);;(stats$15404=fs$15123.statSync(file$15395));;($15401$15412=null);;$15401$15412;if(stats$15404.isDirectory()){return walk$15127(file$15395,"/",function(){var rval$15465;var from$15456;var to$15457;var t0$15500;var t1$15501;var x$15494;var name$15495;var from$15496;var to$15497;var data$15498;var from$15520;var to$15521;var f$15517;var results$15489;var t0$15485;var $15426$15481;var d$15452;var $15427$15447;var $15428$15448;var $15429$15449;var t0$15444;var t1$15445;var $15425$15440;var t0$15436;var $15424$15431;($15424$15431=arguments);;(t0$15436=$15424$15431.length);if((t0$15436>=0)){($15425$15440=Array.prototype.slice.call($15424$15431,0));(t0$15444=$15425$15440);(t1$15445=t0$15444.length);if((($15429$15449=(t1$15445===2))&&(t0$15444[0]==="dir"))){(d$15452=t0$15444[1]);(from$15456=path$15124.join(file$15395,d$15452));;(to$15457=path$15124.join(out$15403,d$15452));;(rval$15465=false);;try{(rval$15465=fs$15123.mkdirSync(to$15457));}catch(excv$15471){var e$15477;(e$15477=excv$15471);(rval$15465="ignore error");}return rval$15465;}else{if(($15429$15449&&(t0$15444[0]==="file"))){($15426$15481=t0$15444[1]);(t0$15485=$15725(RegExp("(?:^((?:.*))\\.eg$)",""))($15426$15481));if((t0$15485[0]&&((results$15489=t0$15485[1]),results$15489))){(t0$15500=results$15489);if(((t0$15500 instanceof Array)&&((t1$15501=t0$15500.length),(t1$15501===2)))){(x$15494=t0$15500[0]);(name$15495=t0$15500[1]);;}else{$15753(results$15489,"/home/olivier/git/earl-grey/src/run.eg",2536,2543);}(from$15496=path$15124.join(file$15395,x$15494));;(to$15497=path$15124.join(out$15403,(name$15495+".js")));;(data$15498=fs$15123.readFileSync(from$15496,"utf8"));;return fs$15123.writeFileSync(to$15497,(gen$15129(data$15498,from$15496)+"\n"));}else{(f$15517=$15426$15481);(from$15520=path$15124.join(file$15395,f$15517));;(to$15521=path$15124.join(out$15403,f$15517));;return copy$15128(from$15520,to$15521);}}else{$15753($15425$15440,"/home/olivier/git/earl-grey/src/run.eg",2216,2221);}}}else{$15753($15424$15431);}});}else{if(out$15403){(data$15537=fs$15123.readFileSync(file$15395,"utf8"));;return fs$15123.writeFileSync(out$15403,(gen$15129(data$15537,file$15395)+"\n"));}else{(otherwise$15543=$15401$15412);($15546$15547=require("js-beautify"));;(beaut$15548=$15546$15547.js);;(data$15549=fs$15123.readFileSync(file$15395,"utf8"));;return console.log(beaut$15548(gen$15129(data$15549,file$15395)));}}}else{if(($15278$15295&&(($15280$15297=(t0$15292===2))&&($15273$15286[0]==="tok")))){(s$15561=$15273$15286[1]);(acc$15567=[]);;(temp$15572=eg$15117.tokenize(Source$15121(s$15561,null)));;($length$15577=temp$15572.length);;($index$15582=0);;$15564:for(;($index$15582<$length$15577);($index$15582++)){var token$15598;var m$15590;(m$15590=temp$15572[$index$15582]);;(token$15598=m$15590);acc$15567.push((__lt____gt__$15119(null,token$15598),__lt____gt__$15119(null,token$15598.location.ref()),__lt____gt__$15119(null,token$15598.location.highlight())));}return acc$15567;}else{if(($15280$15297&&($15273$15286[0]==="pa"))){(s$15603=$15273$15286[1]);(walkloc$15607=function($15610$15612){var t0$15621;var $index$15673;var $length$15668;var temp$15663;var acc$15658;var type$15650;var args$15651;var x$15644;var x$15637;var $15615$15632;var $15616$15633;var $15617$15634;var t0$15630;var $15614$15625;var ph$15618;var node$15619;(t0$15621=$15610$15612);(node$15619=t0$15621);(ph$15618=t0$15621);;($15614$15625=ph$15618);;if((($15615$15632=($15614$15625 instanceof Array))&&((t0$15630=$15614$15625.length),(($15617$15634=(t0$15630===2))&&($15614$15625[0]==="symbol"))))){(x$15637=$15614$15625[1]);__lt____gt__$15119(null,node$15619);return __lt____gt__$15119(null,(node$15619.location&&node$15619.location.highlight()));}else{if(($15617$15634&&($15614$15625[0]==="value"))){(x$15644=$15614$15625[1]);__lt____gt__$15119(null,node$15619);return __lt____gt__$15119(null,(node$15619.location&&node$15619.location.highlight()));}else{if(($15615$15632&&(t0$15630>=1))){(type$15650=$15614$15625[0]);(args$15651=Array.prototype.slice.call($15614$15625,1));__lt____gt__$15119(null,node$15619);__lt____gt__$15119(null,(node$15619.location&&node$15619.location.highlight()));(acc$15658=[]);;(temp$15663=args$15651);;($length$15668=temp$15663.length);;($index$15673=0);;$15655:for(;($index$15673<$length$15668);($index$15673++)){var arg$15689;var m$15681;(m$15681=temp$15663[$index$15673]);;(arg$15689=m$15681);acc$15658.push(walkloc$15607(arg$15689));}return acc$15658;}else{$15753($15614$15625);}}}});;return walkloc$15607((((tokens$15695=eg$15117.tokenize(Source$15121(s$15603,null)))),eg$15117.parse(tokens$15695)));}else{if(($15280$15297&&($15273$15286[0]==="runs"))){(data$15701=$15273$15286[1]);(code$15705=gen$15129(data$15701,"<command>"));;return __lt____gt__$15119(null,eval(code$15705));}else{if(($15280$15297&&($15273$15286[0]==="trs"))){(data$15711=$15273$15286[1]);(code$15715=gen$15129(data$15711,"<command>"));;return __lt____gt__$15119(null,code$15715);}else{(other$15721=$15273$15286);return console.log(usage$15126);}}}}}}}});;(exports["run"]=run$15130);
