var τ588=function(type){var τ589=type["::check"];var f;if((τ589===(void 0))){return function(value){return (value instanceof type);};}else{if(((f=τ589),true)){return function(value){return f.call(type,value);};}else{throw ["Could not find a match",τ589];}}};
var τ590=function(){var r=[];for(var i=0;(i<arguments.length);(i++)){(r=r.concat(arguments[i]));}return r;};
var τ591=function(τ592){var τ593=τ592;var x;var x;var other;if((((typeof(τ593)==="string")&&((x=τ593),true))||((typeof(τ593)==="number")&&((x=τ593),true)))){return ["value",x];}else{if(((other=τ593),true)){return other["::serialize_ast"]();}else{throw ["Could not find a match",τ593];}}};
var send=function(obj,τ581){var msg;var τ580;(msg=τ581);true;(τ580=τ581);var τ582=τ580;var other;if(((typeof(τ582)==="string")||(typeof(τ582)==="number"))){return obj[msg];}else{if(((other=τ582),true)){return obj["::send"](msg);}else{throw ["Could not find a match",τ582];}}};(Array[":::project"]=function(τ584){var value;var τ583;(value=τ584);true;(τ583=τ584);var τ585=τ583;var _;if(τ588(Array)(τ585)){return [true,value];}else{if(((_=τ585),true)){return [true,[value]];}else{throw ["Could not find a match",τ585];}}});(Array.prototype["::check"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){return false;}else{null;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){var rval=this.slice(0);rval.push(value);return [true,rval];}else{null;}}return [true,value];}else{var rval=this.slice(0);rval.push(value);return [true,rval];}});(Array.prototype[":::deconstruct"]=function(value){return [true,value.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return τ590(["array"],this.map(τ591));});(RegExp.prototype["::check"]=function(value){return value.match(this);});(RegExp.prototype[":::project"]=function(value){var τ586=value.match(this);var m;var m;if(((τ586===null)&&((m=τ586),true))){return [false,null];}else{if(((m=τ586),true)){return [true,m];}else{throw ["Could not find a match",τ586];}}});(RegExp.prototype[":::deconstruct"]=function(value){var τ587=value.match(this);var m;var m;if(((τ587===null)&&((m=τ587),true))){return [false,null];}else{if(((m=τ587),true)){return [true,m];}else{throw ["Could not find a match",τ587];}}});(Function.prototype["::send"]=function(args){return this.apply(this,args);});
var τ1086=function(dest,values){for(k in values){if(values.hasOwnProperty(k)){(dest[k]=send(values,k));}else{null;}}return dest;};
var τ1087=function(){var τ1088=function(tags){var τ1089=function(){if((!τ588(τ1088)(this))){return Object.create(τ1088.prototype);}else{return this;}}();(τ1089["tags"]=tags);return τ1089;};τ1086(τ1088);(τ1088.prototype["create"]=function(){var τ1090=Array.prototype.slice.call(arguments,0);var τp0;var message;var args;if(((τ1090 instanceof Array)&&(((τp0=τ1090.length),true)&&((τp0>=0)&&((message=function(){if((0>=τp0)){return "";}else{return τ1090[0];}}()),true,(args=τ1090.slice(1)),true))))){var τ1089=this;var e=Error(message);(e["::tags"]=τ1089.tags);(e["args"]=args);(e["name"]=["E"].concat(τ1089.tags).join("."));return e;}else{throw ["Could not find a match",τ1090];}});(τ1088.prototype["::check"]=function(e){var τ1089=this;if(((!e)||(!τ588(Error)(e)))){return false;}else{null;}var tags=(e["::tags"]||[]);var τ1091=τ1089.tags;var τ1092=τ1091.length;for(var τ1093=0;(τ1093<τ1092);(τ1093++)){var τ1094=τ1091[τ1093];var tag;var other;if(((tag=τ1094),true,(tags.indexOf(tag)===(-1)))){return false;}else{if(((other=τ1094),true)){false;}else{throw ["Could not find a match",τ1094];}}}false;return true;});(τ1088.prototype["::deconstruct"]=function(e){var τ1089=this;return e.args;});return τ1088;}();
var τ1095=function(type){return function(value){var τ1096=type[":::project"];var f;if((τ1096===(void 0))){var τ1097=type["::project"];var f;if((τ1097===(void 0))){return [true,type(value)];}else{if(((f=τ1097),true)){var τ1099;try{(τ1099=[true,f(value)]);}catch(τ1098){(τ1099=[false,null]);}return τ1099;}else{throw ["Could not find a match",τ1097];}}}else{if(((f=τ1096),true)){return f.call(type,value);}else{throw ["Could not find a match",τ1096];}}};};
var τ1100=function(from,to){var rval=[];for(var i=from;(i<=to);(i++)){rval.push(i);}return rval;};var τ594=require("./expand");var Env=τ594.Env;var nullenv=τ594.nullenv;var expand=τ594.expand;var τ595=require("./helpers");var aslist=τ595.aslist;var transform=τ595.transform;var gensym=τ595.gensym;var gensym_factory=τ595.gensym_factory;var τ596=require("./util");var enumerate=τ596.enumerate;var items=τ596.items;var uuid=function(){var τp0;var τp1;var τp2;var s;if((((τp0=gensym()),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="symbol"))&&((s=τp0[1]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",204,214]}));}return s;};var Embedded=function(code){var τ597=function(){if((!τ588(Embedded)(this))){return Object.create(Embedded.prototype);}else{return this;}}();(τ597["code"]=code);(τ597["::id"]=uuid());return τ597;};τ1086(Embedded);(Embedded.prototype["::serialize_ast"]=function(){var τ597=this;return expand(["top",stdenv],τ597.code);});Embedded;var stdenv=Env(nullenv);var τ598=items(({"+":"___plus","-":"___minus","*":"___times","/":"___div","mod":"___mod","^":"___binxor","&":"___binand","|":"___binor","&&":"___and","||":"___or","and":"___and","or":"___or","not":"___not","===":"___is","!==":"___isnt","!=":"___neq","<":"___lt",">":"___gt","<=":"___lte",">=":"___gte","<<":"___shl",">>":"___shr",">>>":"___shr2","in":"___in","instanceof":"___instanceof","--":"___minusminus"}));var τ599=τ598.length;for(var τ600=0;(τ600<τ599);(τ600++)){var τ601=τ598[τ600];var τp0;var k;var v;var other;if(((τ601 instanceof Array)&&(((τp0=τ601.length),true)&&((τp0===2)&&((k=τ601[0]),true,(v=τ601[1]),true))))){stdenv.register(k,["symbol",v]);}else{if(((other=τ601),true)){false;}else{throw ["Could not find a match",τ601];}}}false;stdenv.register("___hasprop",["value",Embedded(["send",["symbol","->"],["data",["data",["symbol","match"],["symbol","key"]],["multi",["send",["symbol","->"],["data",["send",["symbol","or"],["data",["send",["symbol","?"],["data",["symbol","null"],["void"]]],["send",["symbol","?"],["data",["symbol","undefined"],["void"]]]]],["symbol","false"]]],["send",["symbol","->"],["data",["send",["send",["symbol","?"],["data",["symbol","String"],["void"]]],["symbol","x"]],["send",["symbol","in"],["data",["symbol","key"],["send",["symbol","String"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]]]]]],["send",["symbol","->"],["data",["send",["send",["symbol","?"],["data",["symbol","Number"],["void"]]],["symbol","x"]],["send",["symbol","in"],["data",["symbol","key"],["send",["symbol","Number"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]]]]]],["send",["symbol","->"],["data",["symbol","x"],["send",["symbol","in"],["data",["symbol","key"],["symbol","x"]]]]]]]])]);stdenv.register("___projector",["value",Embedded(["send",["symbol","->"],["data",["data",["symbol","type"]],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["symbol","match"],["data",["send",["symbol","type"],["value",":::project"]],["multi",["send",["symbol","->"],["data",["send",["symbol","?"],["data",["symbol","undefined"],["void"]]],["send",["symbol","match"],["data",["send",["symbol","type"],["value","::project"]],["multi",["send",["symbol","->"],["data",["send",["symbol","?"],["data",["symbol","undefined"],["void"]]],["data",["symbol","true"],["send",["symbol","type"],["data",["symbol","value"]]]]]],["send",["symbol","->"],["data",["symbol","f"],["send",["symbol","!!"],["data",["data",["symbol","true"],["send",["symbol","f"],["data",["symbol","value"]]]],["data",["symbol","false"],["symbol","null"]]]]]]]]]]],["send",["symbol","->"],["data",["symbol","f"],["send",["send",["symbol","f"],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",["symbol","type"],["symbol","value"]]]]]]]]]]]])]);stdenv.register("___checker",["value",Embedded(["send",["symbol","->"],["data",["data",["symbol","type"]],["send",["symbol","match"],["data",["send",["symbol","type"],["value","::check"]],["multi",["send",["symbol","->"],["data",["send",["symbol","?"],["data",["symbol","undefined"],["void"]]],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["symbol","instanceof"],["data",["symbol","value"],["symbol","type"]]]]]]],["send",["symbol","->"],["data",["symbol","f"],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["send",["symbol","f"],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",["symbol","type"],["symbol","value"]]]]]]]]]]]])]);stdenv.register("___deconstructor",["value",Embedded(["send",["symbol","->"],["data",["data",["symbol","type"]],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["symbol","match"],["data",["send",["symbol","type"],["value",":::deconstruct"]],["multi",["send",["symbol","->"],["data",["send",["symbol","?"],["data",["symbol","undefined"],["void"]]],["send",["symbol","match"],["data",["send",["symbol","type"],["value","::deconstruct"]],["multi",["send",["symbol","->"],["data",["send",["symbol","?"],["data",["symbol","undefined"],["void"]]],["send",["symbol","?"],["data",["void"],["multi",["send",["symbol","=>"],["data",["send",["symbol","instanceof"],["data",["symbol","value"],["symbol","Array"]]],["data",["symbol","true"],["symbol","value"]]]],["send",["symbol","=>"],["data",["symbol","else"],["data",["symbol","false"],["symbol","null"]]]]]]]]],["send",["symbol","->"],["data",["symbol","f"],["send",["symbol","!!"],["data",["data",["symbol","true"],["send",["send",["symbol","f"],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",["symbol","type"],["symbol","value"]]]],["data",["symbol","false"],["symbol","null"]]]]]]]]]]],["send",["symbol","->"],["data",["symbol","f"],["send",["send",["symbol","f"],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",["symbol","type"],["symbol","value"]]]]]]]]]]]])]);stdenv.register("___serialize_ast",["value",Embedded(["send",["symbol","->"],["data",["data",["symbol","match"]],["multi",["send",["symbol","->"],["data",["send",["symbol","or"],["data",["send",["send",["symbol","?"],["data",["symbol","String"],["void"]]],["symbol","x"]],["send",["send",["symbol","?"],["data",["symbol","Number"],["void"]]],["symbol","x"]]]],["send",["send",["symbol","#"],["data",["void"],["symbol","value"]]],["data",["symbol","x"]]]]],["send",["symbol","->"],["data",["symbol","other"],["send",["send",["symbol","other"],["value","::serialize_ast"]],["data"]]]]]]])]);stdenv.register("ErrorFactory",["value",Embedded(["send",["symbol","class"],["data",["multi",["send",["symbol","="],["data",["send",["symbol","constructor"],["data",["symbol","tags"]]],["send",["symbol",":="],["data",["send",["symbol","@"],["data",["void"],["symbol","tags"]]],["symbol","tags"]]]]],["send",["symbol","="],["data",["send",["symbol","create"],["data",["send",["symbol","="],["data",["symbol","message"],["value",""]]],["send",["symbol","*"],["data",["void"],["symbol","args"]]]]],["multi",["send",["symbol","="],["data",["symbol","e"],["send",["symbol","Error"],["data",["symbol","message"]]]]],["send",["symbol",":="],["data",["send",["symbol","e"],["value","::tags"]],["send",["symbol","@"],["data",["void"],["symbol","tags"]]]]],["send",["symbol",":="],["data",["send",["symbol","e"],["send",["symbol","."],["data",["void"],["symbol","args"]]]],["symbol","args"]]],["send",["symbol",":="],["data",["send",["symbol","e"],["send",["symbol","."],["data",["void"],["symbol","name"]]]],["send",["send",["send",["symbol","++"],["data",["data",["send",["symbol","."],["data",["void"],["symbol","E"]]]],["send",["symbol","@"],["data",["void"],["symbol","tags"]]]]],["send",["symbol","."],["data",["void"],["symbol","join"]]]],["data",["value","."]]]]],["symbol","e"]]]],["send",["symbol","="],["data",["send",["value","::check"],["data",["symbol","e"]]],["multi",["send",["symbol","if"],["data",["send",["symbol","or"],["data",["send",["symbol","not"],["data",["void"],["symbol","e"]]],["send",["symbol","not"],["data",["void"],["send",["send",["symbol","?"],["data",["symbol","Error"],["void"]]],["symbol","e"]]]]]],["send",["symbol","return"],["symbol","false"]]]],["send",["symbol","="],["data",["symbol","tags"],["send",["symbol","or"],["data",["send",["symbol","e"],["value","::tags"]],["data"]]]]],["send",["symbol","each"],["data",["send",["symbol","@"],["data",["void"],["symbol","tags"]]],["send",["symbol","->"],["data",["send",["symbol","when"],["data",["symbol","tag"],["send",["symbol","=="],["data",["send",["send",["symbol","tags"],["send",["symbol","."],["data",["void"],["symbol","indexOf"]]]],["data",["symbol","tag"]]],["send",["symbol","-"],["data",["void"],["value",1]]]]]]],["send",["symbol","return"],["symbol","false"]]]]]],["symbol","true"]]]],["send",["symbol","="],["data",["send",["value","::deconstruct"],["data",["symbol","e"]]],["send",["symbol","e"],["send",["symbol","."],["data",["void"],["symbol","args"]]]]]]]]])]);stdenv.register("patch_array",["value",Embedded(["send",["symbol","->"],["data",["data"],["multi",["send",["symbol","="],["data",["symbol","r"],["data"]]],["send",["symbol","for"],["data",["multi",["send",["symbol","="],["data",["symbol","i"],["value",0]]],["send",["symbol","<"],["data",["symbol","i"],["send",["symbol","arguments"],["send",["symbol","."],["data",["void"],["symbol","length"]]]]]],["send",["symbol","++"],["data",["symbol","i"],["void"]]]],["send",["symbol",":="],["data",["symbol","r"],["send",["send",["symbol","r"],["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",["send",["symbol","___js_fetch"],["data",["symbol","arguments"],["symbol","i"]]]]]]]]],["symbol","r"]]]])]);stdenv.register("range",["value",Embedded(["send",["symbol","->"],["data",["data",["symbol","from"],["symbol","to"]],["multi",["send",["symbol","="],["data",["symbol","rval"],["data"]]],["send",["symbol","for"],["data",["multi",["send",["symbol","="],["data",["symbol","i"],["symbol","from"]]],["send",["symbol","<="],["data",["symbol","i"],["symbol","to"]]],["send",["symbol","++"],["data",["symbol","i"],["void"]]]],["send",["send",["symbol","rval"],["send",["symbol","."],["data",["void"],["symbol","push"]]]],["data",["symbol","i"]]]]],["symbol","rval"]]]])]);stdenv.register("&:",["value",Embedded(["send",["symbol","->"],["data",["data",["symbol","dest"],["symbol","values"]],["multi",["send",["symbol","for"],["data",["send",["symbol","in"],["data",["symbol","k"],["symbol","values"]]],["send",["symbol","if"],["data",["send",["send",["symbol","values"],["send",["symbol","."],["data",["void"],["symbol","hasOwnProperty"]]]],["data",["symbol","k"]]],["send",["symbol",":="],["data",["send",["symbol","dest"],["symbol","k"]],["send",["symbol","values"],["symbol","k"]]]]]]]],["symbol","dest"]]]])]);stdenv.register_macro("++",function(_,τ602){var τ603=τ602;var τp0;var τp1;var τp2;var τp3;var τp4;var x;var τp0;var τp1;var x;var τp2;var τp3;var τp4;var τp0;var τp1;var x;var y;var τp0;var τp1;var τ604=false;var τ605=false;var τ606=false;var τ607=false;if(((τ604=(τ603 instanceof Array))&&((τ605=((τp0=τ603.length),true))&&((τ606=(τp0===3))&&((τ607=((τp1=τ603[0]),(τp1==="data")))&&(((τp2=τ603[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&(((τp4=τp2[0]),(τp4==="void"))&&((x=τ603[2]),true)))))))))){return ["send",["symbol","___plusplus"],["data",["void"],x]];}else{if((τ607&&(((x=τ603[1]),true,(τp2=τ603[2]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&((τp4=τp2[0]),(τp4==="void"))))))){return ["send",["symbol","___plusplus"],["data",x,["void"]]];}else{if((τ607&&((x=τ603[1]),true,(y=τ603[2]),true))){return ["send",["send",x,["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",y]];}else{if((τ605&&((τp0===1)&&((τp1=τ603[0]),(τp1==="void"))))){return ["send",["symbol","->"],["data",["data",["symbol","x"],["symbol","y"]],["send",["send",["symbol","x"],["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",["symbol","y"]]]]];}else{throw ["Could not find a match",τ603];}}}}});stdenv.register_macro("..",function(_,τ608){var τ609=τ608;var τp0;var τp1;var τp2;var τp3;var τp4;var x;var τp0;var τp1;var x;var τp2;var τp3;var τp4;var τp0;var τp1;var x;var y;var τp0;var τp1;var τ610=false;var τ611=false;var τ612=false;var τ613=false;if(((τ610=(τ609 instanceof Array))&&((τ611=((τp0=τ609.length),true))&&((τ612=(τp0===3))&&((τ613=((τp1=τ609[0]),(τp1==="data")))&&(((τp2=τ609[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&(((τp4=τp2[0]),(τp4==="void"))&&((x=τ609[2]),true)))))))))){return ["send",["symbol","range"],["data",["value",1],x]];}else{if((τ613&&(((x=τ609[1]),true,(τp2=τ609[2]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&((τp4=τp2[0]),(τp4==="void"))))))){return ["send",["symbol","range"],["data",x]];}else{if((τ613&&((x=τ609[1]),true,(y=τ609[2]),true))){return ["send",["symbol","range"],["data",x,y]];}else{if((τ611&&((τp0===1)&&((τp1=τ609[0]),(τp1==="void"))))){return ["symbol","range"];}else{throw ["Could not find a match",τ609];}}}}});var make_checker=function(value,op){return function(τ614,τ615){var τp0;var context;var env;if(((τ614 instanceof Array)&&(((τp0=τ614.length),true)&&((τp0===2)&&((context=τ614[0]),true,(env=τ614[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var expr;if(((τ615 instanceof Array)&&(((τp0=τ615.length),true)&&((τp0===2)&&(((τp1=τ615[0]),(τp1==="data"))&&((expr=τ615[1]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["send",op,["data",expr,value]];};};stdenv.register_macro("**",function(τ616,τ617){var τp0;var context;var env;if(((τ616 instanceof Array)&&(((τp0=τ616.length),true)&&((τp0===2)&&((context=τ616[0]),true,(env=τ616[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var a;var b;if(((τ617 instanceof Array)&&(((τp0=τ617.length),true)&&((τp0===3)&&(((τp1=τ617[0]),(τp1==="data"))&&((a=τ617[1]),true,(b=τ617[2]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["send",["send",["symbol","Math"],["send",["symbol","."],["data",["void"],["symbol","pow"]]]],["data",a,b]];});stdenv.register_macro("//",function(τ618,τ619){var τp0;var context;var env;if(((τ618 instanceof Array)&&(((τp0=τ618.length),true)&&((τp0===2)&&((context=τ618[0]),true,(env=τ618[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var a;var b;if(((τ619 instanceof Array)&&(((τp0=τ619.length),true)&&((τp0===3)&&(((τp1=τ619[0]),(τp1==="data"))&&((a=τ619[1]),true,(b=τ619[2]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["send",["send",["symbol","Math"],["send",["symbol","."],["data",["void"],["symbol","floor"]]]],["data",["send",["symbol","/"],["data",a,b]]]];});var errf_macro=function(tags){return function(τ621,τ620){var τp0;var context;var env;if(((τ621 instanceof Array)&&(((τp0=τ621.length),true)&&((τp0===2)&&((context=τ621[0]),true,(env=τ621[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ622=τ620;var τp0;var τp1;var τp0;var τp1;var args;var other;var τ623=false;var τ624=false;if(((τ623=(τ622 instanceof Array))&&((τ624=((τp0=τ622.length),true))&&((τp0===1)&&((τp1=τ622[0]),(τp1==="void")))))){return ["send",["symbol","ErrorFactory"],["data",τ590(["data"],tags)]];}else{if((τ624&&((τp0>=1)&&(((τp1=τ622[0]),(τp1==="data"))&&((args=τ622.slice(1)),true))))){return ["send",["send",["send",["symbol","ErrorFactory"],["data",τ590(["data"],tags)]],["send",["symbol","."],["data",["void"],["symbol","create"]]]],τ590(["data"],args)];}else{if(((other=τ622),true)){return ["macro",errf_macro(tags.concat([other]))];}else{throw ["Could not find a match",τ622];}}}};};stdenv.register_macro("E",errf_macro([]));stdenv.register_macro("#",function(τ625,τ626){var τp0;var context;var env;if(((τ625 instanceof Array)&&(((τp0=τ625.length),true)&&((τp0===2)&&((context=τ625[0]),true,(env=τ625[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var tag;if(((τ626 instanceof Array)&&(((τp0=τ626.length),true)&&((τp0===3)&&(((τp1=τ626[0]),(τp1==="data"))&&(((τp2=τ626[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&(((τp4=τp2[0]),(τp4==="void"))&&(((τp5=τ626[2]),(τp5 instanceof Array))&&(((τp6=τp5.length),true)&&((τp6===2)&&(((τp7=τp5[0]),(τp7==="symbol"))&&((tag=τp5[1]),true)))))))))))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}(tag=["value",tag]);var f=function(τ628,expr){var τp0;var τ627;var env;if(((τ628 instanceof Array)&&(((τp0=τ628.length),true)&&((τp0===2)&&((τ627=τ628[0]),true,(env=τ628[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ629=τ627;var _;if((τ629==="pattern")){var checker_mac=function(){var f1=function(_,τ633){var τp0;var τp1;var expr;if(((τ633 instanceof Array)&&(((τp0=τ633.length),true)&&((τp0===2)&&(((τp1=τ633[0]),(τp1==="data"))&&((expr=τ633[1]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["send",["symbol","instanceof"],["data",expr,["symbol","Array"]]];};var f2=function(_,τ634){var τp0;var τp1;var expr;if(((τ634 instanceof Array)&&(((τp0=τ634.length),true)&&((τp0===2)&&(((τp1=τ634[0]),(τp1==="data"))&&((expr=τ634[1]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["send",["symbol","=="],["data",["send",expr,["value",0]],tag]];};return ["multi",["macro",f1],["macro",f2]];}();var τ630=expr;var τp0;var τp1;var subp;var τp0;var τp1;var other;var τ631=false;var τ632=false;if(((τ631=(τ630 instanceof Array))&&((τ632=((τp0=τ630.length),true))&&((τp0>=1)&&(((τp1=τ630[0]),(τp1==="data"))&&((subp=τ630.slice(1)),true)))))){return τ590(["data",tag],subp);}else{if((τ632&&((τp0===1)&&((τp1=τ630[0]),(τp1==="void"))))){return ["check",checker_mac,["ignore"]];}else{if(((other=τ630),true)){return ["check",checker_mac,expr];}else{throw ["Could not find a match",τ630];}}}}else{if(((_=τ629),true)){var τ635=expr;var τp0;var τp1;var τp0;var τp1;var args;var other;var τ636=false;var τ637=false;if(((τ636=(τ635 instanceof Array))&&((τ637=((τp0=τ635.length),true))&&((τp0===1)&&((τp1=τ635[0]),(τp1==="void")))))){return ["data",tag];}else{if((τ637&&((τp0>=1)&&(((τp1=τ635[0]),(τp1==="data"))&&((args=τ635.slice(1)),true))))){return τ590(["data",tag],args);}else{if(((other=τ635),true)){return ["send",["data",tag],other];}else{throw ["Could not find a match",τ635];}}}}else{throw ["Could not find a match",τ629];}}};return ["macro",f];});stdenv.register_macro("when",function(τ639,τ640){var τp0;var context;var env;if(((τ639 instanceof Array)&&(((τp0=τ639.length),true)&&((τp0===2)&&((context=τ639[0]),true,(env=τ639[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var τ638;var condition;if(((τ640 instanceof Array)&&(((τp0=τ640.length),true)&&((τp0===3)&&(((τp1=τ640[0]),(τp1==="data"))&&((τ638=τ640[1]),true,(condition=τ640[2]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ641=τ638;var τp0;var τp1;var other;if(((τ641 instanceof Array)&&(((τp0=τ641.length),true)&&((τp0===1)&&((τp1=τ641[0]),(τp1==="void")))))){return ["test",condition,["ignore"]];}else{if(((other=τ641),true)){return ["test",condition,other];}else{throw ["Could not find a match",τ641];}}});var andf=function(τ642,expr){var τp0;var context;var env;if(((τ642 instanceof Array)&&(((τp0=τ642.length),true)&&((τp0===2)&&((context=τ642[0]),true,(env=τ642[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ643=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var a;var b;var τp0;var _;var τp1;var τp2;var τp3;var other;var τ644=false;var τ645=false;var τ646=false;if(((τ644=(τ643 instanceof Array))&&((τ645=((τp0=τ643.length),true))&&((τ646=(τp0===2))&&(((τp1=τ643[0]),(τp1==="pattern"))&&(((τp2=τ643[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((a=τp2[1]),true,(b=τp2[2]),true)))))))))){return ["all",a,b];}else{if((τ646&&(((_=τ643[0]),true,(τp1=τ643[1]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===1)&&((τp3=τp1[0]),(τp3==="void"))))))){return ["symbol","___and"];}else{if(((other=τ643),true)){return ["send",["symbol","___and"],expr];}else{throw ["Could not find a match",τ643];}}}};stdenv.register_macro("&&",andf);stdenv.register_macro("and",andf);var orf=function(τ647,expr){var τp0;var context;var env;if(((τ647 instanceof Array)&&(((τp0=τ647.length),true)&&((τp0===2)&&((context=τ647[0]),true,(env=τ647[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ648=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var a;var b;var τp0;var _;var τp1;var τp2;var τp3;var other;var τ649=false;var τ650=false;var τ651=false;if(((τ649=(τ648 instanceof Array))&&((τ650=((τp0=τ648.length),true))&&((τ651=(τp0===2))&&(((τp1=τ648[0]),(τp1==="pattern"))&&(((τp2=τ648[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((a=τp2[1]),true,(b=τp2[2]),true)))))))))){return ["any",a,b];}else{if((τ651&&(((_=τ648[0]),true,(τp1=τ648[1]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===1)&&((τp3=τp1[0]),(τp3==="void"))))))){return ["symbol","___or"];}else{if(((other=τ648),true)){return ["send",["symbol","___or"],expr];}else{throw ["Could not find a match",τ648];}}}};stdenv.register_macro("||",orf);stdenv.register_macro("or",orf);var partial_pattern=function(operator){(operator=["symbol",operator]);return function(τ652,expr){var τp0;var context;var env;if(((τ652 instanceof Array)&&(((τp0=τ652.length),true)&&((τp0===2)&&((context=τ652[0]),true,(env=τ652[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ653=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var val;var τp0;var _;var τp1;var τp2;var τp3;var other;var τ654=false;var τ655=false;var τ656=false;if(((τ654=(τ653 instanceof Array))&&((τ655=((τp0=τ653.length),true))&&((τ656=(τp0===2))&&(((τp1=τ653[0]),(τp1==="pattern"))&&(((τp2=τ653[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&(((τp5=τp2[1]),(τp5 instanceof Array))&&(((τp6=τp5.length),true)&&((τp6===1)&&(((τp7=τp5[0]),(τp7==="void"))&&((val=τp2[2]),true)))))))))))))){return ["check",["macro",make_checker(val,operator)],["ignore"]];}else{if((τ656&&(((_=τ653[0]),true,(τp1=τ653[1]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===1)&&((τp3=τp1[0]),(τp3==="void"))))))){return operator;}else{if(((other=τ653),true)){return ["send",operator,expr];}else{throw ["Could not find a match",τ653];}}}};};stdenv.register_macro("==",partial_pattern("___eq"));stdenv.register_macro("!=",partial_pattern("___neq"));stdenv.register_macro("<=",partial_pattern("___lte"));stdenv.register_macro(">=",partial_pattern("___gte"));stdenv.register_macro("<",partial_pattern("___lt"));stdenv.register_macro(">",partial_pattern("___gt"));stdenv.register_macro("*",function(τ657,expr){var τp0;var context;var env;if(((τ657 instanceof Array)&&(((τp0=τ657.length),true)&&((τp0===2)&&((context=τ657[0]),true,(env=τ657[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ658=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var val;var τp0;var _;var τp1;var τp2;var τp3;var other;var τ659=false;var τ660=false;var τ661=false;if(((τ659=(τ658 instanceof Array))&&((τ660=((τp0=τ658.length),true))&&((τ661=(τp0===2))&&(((τp1=τ658[0]),(τp1==="pattern"))&&(((τp2=τ658[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&((τp4=τp2[0]),(τp4==="void")))))))))){return ["dynsplice",["ignore"]];}else{if((τ661&&(((τp1=τ658[0]),((τp1==="pattern")||(τp1==="data")))&&(((τp2=τ658[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&(((τp5=τp2[1]),(τp5 instanceof Array))&&(((τp6=τp5.length),true)&&((τp6===1)&&(((τp7=τp5[0]),(τp7==="void"))&&((val=τp2[2]),true)))))))))))){return ["dynsplice",val];}else{if((τ661&&(((_=τ658[0]),true,(τp1=τ658[1]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===1)&&((τp3=τp1[0]),(τp3==="void"))))))){return ["symbol","___times"];}else{if(((other=τ658),true)){return ["send",["symbol","___times"],expr];}else{throw ["Could not find a match",τ658];}}}}});stdenv.register_macro(".",function(τ663,τ662){var τp0;var context;var env;if(((τ663 instanceof Array)&&(((τp0=τ663.length),true)&&((τp0===2)&&((context=τ663[0]),true,(env=τ663[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ664=τ662;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var s;var other;if(((τ664 instanceof Array)&&(((τp0=τ664.length),true)&&((τp0===3)&&(((τp1=τ664[0]),(τp1==="data"))&&(((τp2=τ664[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&(((τp4=τp2[0]),(τp4==="void"))&&(((τp5=τ664[2]),(τp5 instanceof Array))&&(((τp6=τp5.length),true)&&((τp6===2)&&(((τp7=τp5[0]),(τp7==="symbol"))&&((s=τp5[1]),true)))))))))))))){return ["value",s];}else{if(((other=τ664),true)){throw τ1087(["syntax","dot"]).create("'.' macro was given an illegal argument",({"arg":other}));}else{throw ["Could not find a match",τ664];}}});stdenv.register_macro("where",function(τ666,τ665){var τp0;var context;var env;if(((τ666 instanceof Array)&&(((τp0=τ666.length),true)&&((τp0===2)&&((context=τ666[0]),true,(env=τ666[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ667=τ665;var τp0;var τp1;var a;var b;var other;if(((τ667 instanceof Array)&&(((τp0=τ667.length),true)&&((τp0===3)&&(((τp1=τ667[0]),(τp1==="data"))&&((a=τ667[1]),true,(b=τ667[2]),true)))))){return ["send",["symbol","let"],["data",b,a]];}else{if(((other=τ667),true)){throw τ1087(["syntax","where"]).create("'where' macro was given an illegal argument",({"arg":other}));}else{throw ["Could not find a match",τ667];}}});stdenv.register_macro("let",function(τ669,τ668){var τp0;var context;var env;if(((τ669 instanceof Array)&&(((τp0=τ669.length),true)&&((τp0===2)&&((context=τ669[0]),true,(env=τ669[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ670=τ668;var τp0;var τp1;var a;var b;var other;if(((τ670 instanceof Array)&&(((τp0=τ670.length),true)&&((τp0===3)&&(((τp1=τ670[0]),(τp1==="data"))&&((a=τ670[1]),true,(b=τ670[2]),true)))))){var bindings=aslist(a);var body=aslist(b);return τ590(["multi"],bindings,body);}else{if(((other=τ670),true)){throw τ1087(["syntax","let"]).create("'let' macro was given an illegal argument",({"arg":other}));}else{throw ["Could not find a match",τ670];}}});stdenv.register_macro("->",function(τ671,τ672){var τp0;var context;var env;if(((τ671 instanceof Array)&&(((τp0=τ671.length),true)&&((τp0===2)&&((context=τ671[0]),true,(env=τ671[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var args;var stmts;if(((τ672 instanceof Array)&&(((τp0=τ672.length),true)&&((τp0===3)&&(((τp1=τ672[0]),(τp1==="data"))&&((args=τ672[1]),true,(stmts=τ672[2]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var placeholder;var τp2;var τp3;var τp4;var newargs;if((((τp0=find_arrow(args)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&(((placeholder=τp0[0]),true,(τp2=τp0[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3>=1)&&(((τp4=τp2[0]),(τp4==="data"))&&((newargs=τp2.slice(1)),true))))))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",10112,10142]}));}var τp0;var τp1;var fw;var bw;var keys;var dflt;var rest;if((((τp0=lhs_parse_specs(env,newargs)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===5)&&((fw=τp0[0]),true,(bw=τp0[1]),true,(keys=τp0[2]),true,(dflt=τp0[3]),true,(rest=τp0[4]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",10165,10191]}));}if(((rest||dflt.length)||keys.length)){var body=["send",["symbol","match"],["data",["send",["send",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",["symbol","arguments"],["value",0]]],["send",["symbol","->"],["data",args,stmts]]]];return ["lambda",[],body];}else{var body=["multi"];(newargs=function(){var τ673=[];var τ674=newargs;var τ675=τ674.length;for(var τ676=0;(τ676<τ675);(τ676++)){var τ677=τ674[τ676];var τp0;var τp1;var s;var other;var other;var τ678=false;if(((τ677 instanceof Array)&&(((τp0=τ677.length),true)&&((τp0===2)&&(((τp1=τ677[0]),(τp1==="symbol"))&&((s=τ677[1]),true)))))){τ673.push(["symbol",s]);}else{if((τ678=((other=τ677),true))){τ673.push(function(){var t=gensym();body.push(["send",["symbol","="],["data",other,t]]);return t;}());}else{if(τ678){false;}else{throw ["Could not find a match",τ677];}}}}return τ673;}());body.push(function(){if(placeholder){return ["send",["symbol","|>"],["data",placeholder,stmts]];}else{return stmts;}}());return ["lambda",newargs,body];}});var build_each=function(source,patterns,τ679,τ680,lvar){var τp0;var prelude;if((((τp0=τ1095(aslist)(τ679)),τp0[0])&&((prelude=τp0[1]),true))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var tail;if((((τp0=τ1095(aslist)(τ680)),τp0[0])&&((tail=τp0[1]),true))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var temp=gensym();var len=gensym();(lvar=(lvar||gensym()));var stmts=τ590(["multi"],prelude).concat([["send",["symbol","="],["data",temp,source]],["send",["symbol","="],["data",len,["send",temp,["send",["symbol","."],["data",["void"],["symbol","length"]]]]]]]);var loop=function(){var a=["send",["symbol","="],["data",lvar,["value",0]]];var b=["send",["symbol","<"],["data",lvar,len]];var c=["send",["symbol","++"],["data",lvar,["void"]]];var body=["send",["symbol","|>"],["data",["send",["symbol","___js_fetch"],["data",temp,lvar]],patterns]];return ["js_for",a,b,c,body];}();stmts.push(loop);var stmts=stmts.concat(tail);return stmts;};stdenv.register_macro("each",function(τ682,τ683){var τp0;var τ681;var env;if(((τ682 instanceof Array)&&(((τp0=τ682.length),true)&&((τp0===2)&&((τ681=τ682[0]),true,(env=τ682[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var arr;var τp2;var τp3;var patterns;if(((τ683 instanceof Array)&&(((τp0=τ683.length),true)&&((τp0===3)&&(((τp1=τ683[0]),(τp1==="data"))&&(((arr=τ683[1]),true,(τp2=τ683[2]),(τp3=τ1095(aslist)(τp2)),τp3[0])&&((patterns=τp3[1]),true))))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ684=τ681;var other;if((τ684==="multi")){patterns.push(["send",["symbol","->"],["data",["symbol","other"],["symbol","false"]]]);return build_each(arr,τ590(["multi"],patterns),["multi"],["symbol","false"]);}else{if(((other=τ684),true)){var res=gensym();(patterns=function(){var τ685=[];var τ686=patterns;var τ687=τ686.length;for(var τ688=0;(τ688<τ687);(τ688++)){var τ689=τ686[τ688];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var patt;var expr;var other;var other;var τ690=false;if(((τ689 instanceof Array)&&(((τp0=τ689.length),true)&&((τp0===3)&&(((τp1=τ689[0]),(τp1==="send"))&&(((τp2=τ689[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="->"))&&(((τp6=τ689[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&((patt=τp6[1]),true,(expr=τp6[2]),true))))))))))))))){τ685.push(["send",["symbol","->"],["data",patt,["send",["send",res,["send",["symbol","."],["data",["void"],["symbol","push"]]]],["data",expr]]]]);}else{if((τ690=((other=τ689),true))){τ685.push(INVALID_PATTERN);}else{if(τ690){false;}else{throw ["Could not find a match",τ689];}}}}return τ685;}());patterns.push(["send",["symbol","->"],["data",["symbol","other"],["symbol","false"]]]);return build_each(arr,τ590(["multi"],patterns),["send",["symbol","="],["data",res,["data"]]],res);}else{throw ["Could not find a match",τ684];}}});stdenv.register_macro("=>",function(τ692,τ693){var τp0;var τ691;var env;if(((τ692 instanceof Array)&&(((τp0=τ692.length),true)&&((τp0===2)&&((τ691=τ692[0]),true,(env=τ692[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var binding;var value;if(((τ693 instanceof Array)&&(((τp0=τ693.length),true)&&((τp0===3)&&(((τp1=τ693[0]),(τp1==="data"))&&((binding=τ693[1]),true,(value=τ693[2]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ694=τ691;var context;if(((τ694==="data")||(τ694==="pattern"))){var τ695=binding;var τp0;var τp1;var _;if(((τ695 instanceof Array)&&(((τp0=τ695.length),true)&&((τp0===1)&&((τp1=τ695[0]),(τp1==="void")))))){return ["assoc",value];}else{if(((_=τ695),true)){return ["assoc",binding,value];}else{throw ["Could not find a match",τ695];}}}else{if(((context=τ694),true)){throw (("Illegal context for '=>' ("+context)+")");}else{throw ["Could not find a match",τ694];}}});stdenv.register_macro("as",function(τ696,τ697){var τp0;var context;var env;if(((τ696 instanceof Array)&&(((τp0=τ696.length),true)&&((τp0===2)&&((context=τ696[0]),true,(env=τ696[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var expr;var variable;if(((τ697 instanceof Array)&&(((τp0=τ697.length),true)&&((τp0===3)&&(((τp1=τ697[0]),(τp1==="data"))&&((expr=τ697[1]),true,(variable=τ697[2]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ698=context;var _;if((τ698==="pattern")){return ["constant",expr,variable];}else{if(((_=τ698),true)){return ["send",["symbol","="],["data",variable,expr]];}else{throw ["Could not find a match",τ698];}}});stdenv.register_macro("=",function(τ699,expr){var τp0;var context;var env;if(((τ699 instanceof Array)&&(((τp0=τ699.length),true)&&((τp0===2)&&((context=τ699[0]),true,(env=τ699[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ700=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var lhs;var rhs;var τp0;var τp1;var τp2;var τp3;var τp4;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var f;var args;var value;var τp0;var τp1;var τp2;var τp3;var τp4;var b;var value;var τp0;var τp1;var τp2;var τp3;var τp4;var patt;var value;var other;var τ701=false;var τ702=false;var τ703=false;var τ704=false;var τ705=false;var τ706=false;var τ707=false;var τ708=false;if(((τ701=(τ700 instanceof Array))&&((τ702=((τp0=τ700.length),true))&&((τ703=(τp0===2))&&(((τp1=τ700[0]),((τp1==="multi")||(τp1==="expr")))&&(((τp2=τ700[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((lhs=τp2[1]),true,(rhs=τp2[2]),true)))))))))){var _src=((lhs.location&&lhs.location.source)&&lhs.location.source.url);var _start=(lhs.location&&lhs.location.start);var _end=(lhs.location&&lhs.location.end);var τp0;var τp1;var τp2;var τp3;var vars;var clauses;var ph;if((((τp0=parse_lhs(env,lhs,rhs)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp3=τ1095(make_declarations)(τp2)),τp3[0])&&((vars=τp3[1]),true,(clauses=τp0[1]),true,(ph=τp0[2]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",12655,12693]}));}var r=τ590(["splice"],vars);var mkif=function(x){return ["if",x,["symbol","undefined"],["send",["symbol","throw"],["send",["symbol","&:"],["data",["send",["send",["symbol","E"],["send",["symbol","."],["data",["void"],["symbol","match"]]]],["data",["value","The value failed to match"]]],["data",["send",["symbol","="],["data",["symbol","location"],["send",["send",["symbol","#"],["data",["void"],["symbol","location"]]],["data",["value",_src],["value",_start],["value",_end]]]]]]]]]];};var τ709=clauses;var τp0;var clause;var _;if(((τ709 instanceof Array)&&(((τp0=τ709.length),true)&&((τp0===1)&&((clause=τ709[0]),true))))){var τ710=send(clause,(clause.length-1));var τp0;var τp1;var τp2;var other;if(((τ710 instanceof Array)&&(((τp0=τ710.length),true)&&((τp0===2)&&(((τp1=τ710[0]),(τp1==="value"))&&((τp2=τ710[1]),(τp2===true))))))){(r=function(){if(((vars.length===1)&&(clause.length===3))){return τ590(["declare"],clause[1].slice(1));}else{return r.concat(clause.slice(1,(-1)));}}());}else{if(((other=τ710),true)){r.push(mkif(clause));}else{throw ["Could not find a match",τ710];}}}else{if(((_=τ709),true)){var ands=make_pattern_test(clauses);r.push(mkif(ands));}else{throw ["Could not find a match",τ709];}}return r;}else{if((τ703&&((τ704=((τp1=τ700[0]),(τp1==="data")))&&((τ705=((τp2=τ700[1]),(τp2 instanceof Array)))&&((τ706=((τp3=τp2.length),true))&&((τp3===1)&&((τp4=τp2[0]),(τp4==="void")))))))){return ["assoc"];}else{if((τ706&&((τ707=(τp3===3))&&((τ708=((τp4=τp2[0]),(τp4==="data")))&&(((τp5=τp2[1]),(τp5 instanceof Array))&&(((τp6=τp5.length),true)&&((τp6===3)&&(((τp7=τp5[0]),(τp7==="send"))&&((f=τp5[1]),true,(args=τp5[2]),true,(value=τp2[2]),true))))))))){(f=function(){var τ711=f;var τp0;var τp1;var _;var τp0;var τp1;var z;var τ712=false;var τ713=false;var τ714=false;if(((τ712=(τ711 instanceof Array))&&((τ713=((τp0=τ711.length),true))&&((τ714=(τp0===2))&&(((τp1=τ711[0]),(τp1==="value"))&&((_=τ711[1]),true)))))){return f;}else{if((τ714&&(((τp1=τ711[0]),(τp1==="symbol"))&&((z=τ711[1]),true)))){return ["value",z];}else{throw ["Could not find a match",τ711];}}}());return ["assoc",f,["send",["symbol","->"],["data",args,value]]];}else{if((τ708&&((b=τp2[1]),true,(value=τp2[2]),true))){(b=function(){var τ715=b;var τp0;var τp1;var _;var τp0;var τp1;var z;var τ716=false;var τ717=false;var τ718=false;if(((τ716=(τ715 instanceof Array))&&((τ717=((τp0=τ715.length),true))&&((τ718=(τp0===2))&&(((τp1=τ715[0]),(τp1==="value"))&&((_=τ715[1]),true)))))){return b;}else{if((τ718&&(((τp1=τ715[0]),(τp1==="symbol"))&&((z=τ715[1]),true)))){return ["value",z];}else{throw ["Could not find a match",τ715];}}}());return ["assoc",b,value];}else{if((τ703&&(((τp1=τ700[0]),(τp1==="pattern"))&&(((τp2=τ700[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((patt=τp2[1]),true,(value=τp2[2]),true)))))))){return ["default",patt,value];}else{if(((other=τ700),true)){throw (("Illegal context for '=' ("+context)+")");}else{throw ["Could not find a match",τ700];}}}}}}});var make_assigner=function(op){return function(τ719,τ720){var τp0;var context;var env;if(((τ719 instanceof Array)&&(((τp0=τ719.length),true)&&((τp0===2)&&((context=τ719[0]),true,(env=τ719[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var a;var b;if(((τ720 instanceof Array)&&(((τp0=τ720.length),true)&&((τp0===3)&&(((τp1=τ720[0]),(τp1==="data"))&&((a=τ720[1]),true,(b=τ720[2]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["assign",a,["send",["symbol",op],["data",a,b]]];};};stdenv.register_macro(":=",function(τ721,τ722){var τp0;var context;var env;if(((τ721 instanceof Array)&&(((τp0=τ721.length),true)&&((τp0===2)&&((context=τ721[0]),true,(env=τ721[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var a;var b;if(((τ722 instanceof Array)&&(((τp0=τ722.length),true)&&((τp0===3)&&(((τp1=τ722[0]),(τp1==="data"))&&((a=τ722[1]),true,(b=τ722[2]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["assign",a,b];});stdenv.register_macro("+=",make_assigner("+"));stdenv.register_macro("-=",make_assigner("-"));stdenv.register_macro("*=",make_assigner("*"));stdenv.register_macro("/=",make_assigner("/"));stdenv.register_macro("<<=",make_assigner("<<"));stdenv.register_macro(">>=",make_assigner(">>"));stdenv.register_macro(">>>=",make_assigner(">>>"));stdenv.register_macro("++=",make_assigner("++"));stdenv.register_macro("?=",make_assigner("match"));stdenv.register_macro("if",function(τ724,τ723){var τp0;var context;var env;if(((τ724 instanceof Array)&&(((τp0=τ724.length),true)&&((τp0===2)&&((context=τ724[0]),true,(env=τ724[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ725=τ723;var τp0;var τp1;var test;var a;var b;var τp0;var τp1;var test;var τp2;var τp3;var τ726;var other;var τ727=false;var τ728=false;if(((τ727=(τ725 instanceof Array))&&((τ728=((τp0=τ725.length),true))&&((τp0===4)&&(((τp1=τ725[0]),(τp1==="data"))&&((test=τ725[1]),true,(a=τ725[2]),true,(b=τ725[3]),true)))))){return ["if",test,a,b];}else{if((τ728&&((τp0===3)&&(((τp1=τ725[0]),(τp1==="data"))&&(((test=τ725[1]),true,(τp2=τ725[2]),(τp3=τ1095(aslist)(τp2)),τp3[0])&&((τ726=τp3[1]),true)))))){var τ729=τ726;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var τp12;var s1;var τp13;var τp14;var τp15;var τp16;var τp17;var τp18;var τp19;var τp20;var τp21;var τp22;var τp23;var τp24;var s2;var τp0;var s1;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var τp12;var s2;var other;var τ730=false;var τ731=false;if(((τ730=(τ729 instanceof Array))&&((τ731=((τp0=τ729.length),true))&&((τp0===2)&&(((τp1=τ729[0]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((τp4=τp1[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="symbol"))&&(((τp7=τp4[1]),(τp7==="then"))&&(((τp8=τp1[2]),(τp8 instanceof Array))&&(((τp9=τp8.length),true)&&((τp9===2)&&(((τp10=τp8[0]),(τp10==="data"))&&(((τp11=τp8[1]),(τp12=τ1095(aslist)(τp11)),τp12[0])&&(((s1=τp12[1]),true,(τp13=τ729[1]),(τp13 instanceof Array))&&(((τp14=τp13.length),true)&&((τp14===3)&&(((τp15=τp13[0]),(τp15==="send"))&&(((τp16=τp13[1]),(τp16 instanceof Array))&&(((τp17=τp16.length),true)&&((τp17===2)&&(((τp18=τp16[0]),(τp18==="symbol"))&&(((τp19=τp16[1]),(τp19==="else"))&&(((τp20=τp13[2]),(τp20 instanceof Array))&&(((τp21=τp20.length),true)&&((τp21===2)&&(((τp22=τp20[0]),(τp22==="data"))&&(((τp23=τp20[1]),(τp24=τ1095(aslist)(τp23)),τp24[0])&&((s2=τp24[1]),true))))))))))))))))))))))))))))))))){return ["if",test,τ590(["multi"],s1),τ590(["multi"],s2)];}else{if((τ731&&((τp0>=1)&&(((s1=τ729.slice(0,-1)),true,(τp1=send(τ729,(τp0-1))),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((τp4=τp1[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="symbol"))&&(((τp7=τp4[1]),(τp7==="else"))&&(((τp8=τp1[2]),(τp8 instanceof Array))&&(((τp9=τp8.length),true)&&((τp9===2)&&(((τp10=τp8[0]),(τp10==="data"))&&(((τp11=τp8[1]),(τp12=τ1095(aslist)(τp11)),τp12[0])&&((s2=τp12[1]),true)))))))))))))))))){return ["if",test,τ590(["multi"],s1),τ590(["multi"],s2)];}else{if(((other=τ729),true)){return ["if",test,τ590(["multi"],other),["value",null]];}else{throw ["Could not find a match",τ729];}}}}else{if(((other=τ725),true)){return send(raise,Error("error in if"));}else{throw ["Could not find a match",τ725];}}}});stdenv.register_macro("cond",function(τ732,τ733){var τp0;var context;var env;if(((τ732 instanceof Array)&&(((τp0=τ732.length),true)&&((τp0===2)&&((context=τ732[0]),true,(env=τ732[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var clauses;if(((τ733 instanceof Array)&&(((τp0=τ733.length),true)&&((τp0===2)&&(((τp1=τ733[0]),(τp1==="data"))&&((clauses=τ733[1]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var handle=function(xs){var τ734=xs;var τp0;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var test;var body;var rest;var τ735=false;var τ736=false;if(((τ735=(τ734 instanceof Array))&&((τ736=((τp0=τ734.length),true))&&(τp0===0)))){return ["value",false];}else{if((τ736&&((τp0>=1)&&(((τp1=τ734[0]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((τp4=τp1[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="symbol"))&&(((τp7=τp4[1]),(τp7==="=>"))&&(((τp8=τp1[2]),(τp8 instanceof Array))&&(((τp9=τp8.length),true)&&((τp9===3)&&(((τp10=τp8[0]),(τp10==="data"))&&((test=τp8[1]),true,(body=τp8[2]),true,(rest=τ734.slice(1)),true))))))))))))))))){(test=function(){var τ737=test;var τp0;var τp1;var τp2;var _;if(((τ737 instanceof Array)&&(((τp0=τ737.length),true)&&((τp0===2)&&(((τp1=τ737[0]),(τp1==="symbol"))&&((τp2=τ737[1]),(τp2==="else"))))))){return ["value",true];}else{if(((_=τ737),true)){return test;}else{throw ["Could not find a match",τ737];}}}());return ["if",test,body,handle(rest)];}else{throw ["Could not find a match",τ734];}}};return handle(aslist(clauses));});stdenv.register_macro("while",function(τ738,expr){var τp0;var context;var env;if(((τ738 instanceof Array)&&(((τp0=τ738.length),true)&&((τp0===2)&&((context=τ738[0]),true,(env=τ738[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var test;var body;if(((expr instanceof Array)&&(((τp0=expr.length),true)&&((τp0===3)&&(((τp1=expr[0]),(τp1==="data"))&&((test=expr[1]),true,(body=expr[2]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",15854,15871]}));}return ["js_while",test,body];});stdenv.register_macro("for",function(τ740,τ739){var τp0;var context;var env;if(((τ740 instanceof Array)&&(((τp0=τ740.length),true)&&((τp0===2)&&((context=τ740[0]),true,(env=τ740[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ741=τ739;var τp0;var τp1;var τp2;var τp3;var τp4;var a;var b;var c;var body;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var a;var b;var body;var τ742=false;var τ743=false;var τ744=false;var τ745=false;var τ746=false;var τ747=false;if(((τ742=(τ741 instanceof Array))&&((τ743=((τp0=τ741.length),true))&&((τ744=(τp0===3))&&((τ745=((τp1=τ741[0]),(τp1==="data")))&&((τ746=((τp2=τ741[1]),(τp2 instanceof Array)))&&((τ747=((τp3=τp2.length),true))&&((τp3===4)&&(((τp4=τp2[0]),(τp4==="multi"))&&((a=τp2[1]),true,(b=τp2[2]),true,(c=τp2[3]),true,(body=τ741[2]),true)))))))))){return ["js_for",a,b,c,body];}else{if((τ747&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="send"))&&(((τp5=τp2[1]),(τp5 instanceof Array))&&(((τp6=τp5.length),true)&&((τp6===2)&&(((τp7=τp5[0]),(τp7==="symbol"))&&(((τp8=τp5[1]),(τp8==="in"))&&(((τp9=τp2[2]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===3)&&(((τp11=τp9[0]),(τp11==="data"))&&((a=τp9[1]),true,(b=τp9[2]),true,(body=τ741[2]),true)))))))))))))){return ["js_for_in",a,b,body];}else{throw ["Could not find a match",τ741];}}});stdenv.register_macro("!!",function(τ749,τ750){var τp0;var τ748;var env;if(((τ749 instanceof Array)&&(((τp0=τ749.length),true)&&((τp0===2)&&((τ748=τ749[0]),true,(env=τ749[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var expr;var matchers;if(((τ750 instanceof Array)&&(((τp0=τ750.length),true)&&((τp0===3)&&(((τp1=τ750[0]),(τp1==="data"))&&((expr=τ750[1]),true,(matchers=τ750[2]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ751=τ748;var other;if((τ751==="multi")){var excv=gensym();var m=function(){var τ752=aslist(matchers);var ms;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var _;var x;if((((ms=τ752),true,(τ752 instanceof Array))&&(((τp0=τ752.length),true)&&((τp0>=1)&&(((τp1=τ752[0]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((τp4=τp1[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="symbol"))&&(((τp7=τp4[1]),(τp7==="->"))&&((_=τp1[2]),true,τ752.slice(1),true)))))))))))))){ms.push(["send",["symbol","->"],["data",["symbol","___exc"],["send",["symbol","throw"],["symbol","___exc"]]]]);return ["send",["symbol","|>"],["data",excv,τ590(["multi"],ms)]];}else{if(((x=τ752),true)){return matchers;}else{throw ["Could not find a match",τ752];}}}();var f=["send",["symbol","->"],["data",["data",excv],m]];return ["multi",["js_try",expr,f,["void"]]];}else{if(((other=τ751),true)){var excv=gensym();var res=gensym();var m=function(){var τ753=aslist(matchers);var ms;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var _;var x;if((((ms=τ753),true,(τ753 instanceof Array))&&(((τp0=τ753.length),true)&&((τp0>=1)&&(((τp1=τ753[0]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((τp4=τp1[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="symbol"))&&(((τp7=τp4[1]),(τp7==="->"))&&((_=τp1[2]),true,τ753.slice(1),true)))))))))))))){ms.push(["send",["symbol","->"],["data",["symbol","___exc"],["send",["symbol","throw"],["symbol","___exc"]]]]);return ["send",["symbol","|>"],["data",excv,τ590(["multi"],ms)]];}else{if(((x=τ753),true)){return matchers;}else{throw ["Could not find a match",τ753];}}}();var f=["send",["symbol","->"],["data",["data",excv],["send",["symbol",":="],["data",res,m]]]];return ["multi",["declare",res,["value",undefined]],["js_try",["assign",res,expr],f,["void"]],res];}else{throw ["Could not find a match",τ751];}}});stdenv.register_macro("new",function(_,expr){return ["js_new",expr];});stdenv.register_macro("return",function(_,expr){return ["js_return",expr];});stdenv.register_macro("delete",function(_,expr){return ["js_delete",expr];});stdenv.register_macro("throw",function(_,expr){return ["js_throw",expr];});stdenv.register_macro("break",function(_,expr){return ["js_break"];});stdenv.register_macro("continue",function(_,expr){return ["js_continue"];});var rx_wrap=function(x){return (("(?:"+x)+")");};var rx_quote=function(x){return x.replace(RegExp("([.?*+\\^$\\[\\]\\(\\)\\{\\}|\\\\])","g"),"\\$1");};var rx_quote2=function(x){return x.replace(RegExp("([\\[\\]\\(\\)\\{\\}\\^])","g"),"\\$1");};var rx_build2=function(τ754){var τ755=τ754;var τp0;var τp1;var τ756;var τp0;var τp1;var x;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var s;var τp0;var τp1;var τp2;var τp3;var τp4;var τ757;var τp5;var τp6;var τp7;var a;var b;var τp0;var τp1;var args;var τp0;var τp1;var args;var otherA;var τ758=false;var τ759=false;var τ760=false;var τ761=false;var τ762=false;var τ763=false;var τ764=false;var τ765=false;if(((τ758=(τ755 instanceof Array))&&((τ759=((τp0=τ755.length),true))&&((τ760=(τp0===2))&&(((τp1=τ755[0]),(τp1==="symbol"))&&((τ756=τ755[1]),true)))))){var τ766=τ756;if((τ766==="any")){return ".";}else{if((τ766==="start")){return "^";}else{if((τ766==="end")){return "$";}else{if((τ766==="alpha")){return "\\a";}else{if((τ766==="digit")){return "\\d";}else{if((τ766==="word")){return "\\w";}else{if((τ766==="space")){return "\\s";}else{if((τ766==="boundary")){return "\\b";}else{if((τ766==="a")){return "\\a";}else{if((τ766==="d")){return "\\d";}else{if((τ766==="w")){return "\\w";}else{if((τ766==="s")){return "\\s";}else{if((τ766==="b")){return "\\b";}else{throw ["Could not find a match",τ766];}}}}}}}}}}}}}}else{if((τ760&&(((τp1=τ755[0]),(τp1==="value"))&&((x=τ755[1]),true)))){return rx_quote(x);}else{if((τ759&&((τ760=(τp0===3))&&((τ761=((τp1=τ755[0]),(τp1==="send")))&&((τ762=((τp2=τ755[1]),(τp2 instanceof Array)))&&((τ763=((τp3=τp2.length),true))&&((τ764=(τp3===2))&&((τ765=((τp4=τp2[0]),(τp4==="symbol")))&&(((τp5=τp2[1]),(τp5==="raw"))&&(((τp6=τ755[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===2)&&(((τp8=τp6[0]),(τp8==="value"))&&((s=τp6[1]),true)))))))))))))){return s;}else{if((τ765&&(((τ757=τp2[1]),true,(τp5=τ755[2]),(τp5 instanceof Array))&&(((τp6=τp5.length),true)&&((τp6===3)&&(((τp7=τp5[0]),(τp7==="data"))&&((a=τp5[1]),true,(b=τp5[2]),true))))))){var τ767=τ757;if((τ767==="||")){return rx_wrap(((rx_build2(a)+"|")+rx_build2(b)));}else{if((τ767==="or")){return rx_wrap(((rx_build2(a)+"|")+rx_build2(b)));}else{if((τ767==="*")){var τp0;var τp1;if(((a instanceof Array)&&(((τp0=a.length),true)&&((τp0===1)&&((τp1=a[0]),(τp1==="void")))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",18081,18088]}));}return rx_wrap((rx_build2(b)+"*"));}else{if((τ767==="+")){var τp0;var τp1;if(((a instanceof Array)&&(((τp0=a.length),true)&&((τp0===1)&&((τp1=a[0]),(τp1==="void")))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",18152,18159]}));}return rx_wrap((rx_build2(b)+"+"));}else{if((τ767==="?")){var τp0;var τp1;if(((a instanceof Array)&&(((τp0=a.length),true)&&((τp0===1)&&((τp1=a[0]),(τp1==="void")))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",18223,18230]}));}return rx_wrap((rx_build2(b)+"?"));}else{if((τ767==="in")){var τp0;var τp1;if(((a instanceof Array)&&(((τp0=a.length),true)&&((τp0===1)&&((τp1=a[0]),(τp1==="void")))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",18295,18302]}));}var τp0;var τp1;var v;if(((b instanceof Array)&&(((τp0=b.length),true)&&((τp0===2)&&(((τp1=b[0]),(τp1==="value"))&&((v=b[1]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",18316,18325]}));}var x=rx_quote2(v);return (("["+x)+"]");}else{if((τ767==="not")){var τp0;var τp1;if(((a instanceof Array)&&(((τp0=a.length),true)&&((τp0===1)&&((τp1=a[0]),(τp1==="void")))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",18414,18421]}));}var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var τp12;var τp13;var τp14;var v;if(((b instanceof Array)&&(((τp0=b.length),true)&&((τp0===3)&&(((τp1=b[0]),(τp1==="send"))&&(((τp2=b[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="in"))&&(((τp6=b[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===1)&&(((τp11=τp9[0]),(τp11==="void"))&&(((τp12=τp6[2]),(τp12 instanceof Array))&&(((τp13=τp12.length),true)&&((τp13===2)&&(((τp14=τp12[0]),(τp14==="value"))&&((v=τp12[1]),true))))))))))))))))))))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",18440,18487]}));}var x=rx_quote2(v);return (("[^"+x)+"]");}else{throw ["Could not find a match",τ767];}}}}}}}}else{if((τ759&&((τ760=(τp0>=1))&&(((τp1=τ755[0]),(τp1==="data"))&&((args=τ755.slice(1)),true))))){return (("("+args.map(rx_build2).join(""))+")");}else{if((τ760&&(((τp1=τ755[0]),(τp1==="multi"))&&((args=τ755.slice(1)),true)))){return (("(?:"+args.map(rx_build2).join(""))+")");}else{if(((otherA=τ755),true)){throw "OopsF";}else{throw ["Could not find a match",τ755];}}}}}}}};var mac=function(τ768,expr,flags){var τp0;var context;var env;if(((τ768 instanceof Array)&&(((τp0=τ768.length),true)&&((τp0===2)&&((context=τ768[0]),true,(env=τ768[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}(flags=(flags||""));var τ769=expr;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var τp12;var τp13;var τp14;var flag;var τp0;var τp1;var τp2;var v;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var arg;var τ770=false;var τ771=false;if(((τ770=(τ769 instanceof Array))&&((τ771=((τp0=τ769.length),true))&&((τp0===3)&&(((τp1=τ769[0]),(τp1==="send"))&&(((τp2=τ769[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="."))&&(((τp6=τ769[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===1)&&(((τp11=τp9[0]),(τp11==="void"))&&(((τp12=τp6[2]),(τp12 instanceof Array))&&(((τp13=τp12.length),true)&&((τp13===2)&&(((τp14=τp12[0]),(τp14==="symbol"))&&((flag=τp12[1]),true))))))))))))))))))))))){var m=function(ctx,x){return mac(ctx,x,(flags+flag));};return ["macro",m];}else{if((τ771&&((τp0===2)&&(((τp1=τ769[0]),(τp1==="value"))&&(((τp2=τ769[1]),(typeof(τp2)==="string"))&&((v=τp2),true)))))){return ["send",["symbol","RegExp"],["data",["value",v],["value",flags]]];}else{if((τ771&&((τp0===3)&&(((τp1=τ769[0]),(τp1==="send"))&&(((τp2=τ769[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="'"))&&(((τp6=τ769[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===1)&&(((τp11=τp9[0]),(τp11==="void"))&&((arg=τp6[2]),true)))))))))))))))))){return ["send",["symbol","RegExp"],["data",["value",rx_build2(arg)],["value",flags]]];}else{throw ["Could not find a match",τ769];}}}};stdenv.register_macro("R",mac);stdenv.register_macro("?",function(τ773,τ772){var τp0;var context;var env;if(((τ773 instanceof Array)&&(((τp0=τ773.length),true)&&((τp0===2)&&((context=τ773[0]),true,(env=τ773[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ774=τ772;var τp0;var τp1;var τp2;var τp3;var τp4;var expr;var τp0;var τp1;var expr;var τp2;var τp3;var τp4;var τ775=false;var τ776=false;var τ777=false;var τ778=false;if(((τ775=(τ774 instanceof Array))&&((τ776=((τp0=τ774.length),true))&&((τ777=(τp0===3))&&((τ778=((τp1=τ774[0]),(τp1==="data")))&&(((τp2=τ774[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&(((τp4=τp2[0]),(τp4==="void"))&&((expr=τ774[2]),true)))))))))){return ["send",["symbol","cond"],["data",expr]];}else{if((τ778&&(((expr=τ774[1]),true,(τp2=τ774[2]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&((τp4=τp2[0]),(τp4==="void"))))))){var orig_expr=expr;var checker=function(){var τ779=expr;var τp0;var τp1;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var other;var τ780=false;var τ781=false;var τ782=false;var τ783=false;if(((τ780=(τ779 instanceof Array))&&((τ781=((τp0=τ779.length),true))&&((τp0===1)&&((τp1=τ779[0]),(τp1==="void")))))){throw "can't use ? on its own";}else{if((τ781&&((τ782=(τp0===2))&&((τ783=((τp1=τ779[0]),(τp1==="symbol")))&&((τp2=τ779[1]),(τp2==="String")))))){return ["macro",function(_,τ784){var τp0;var τp1;var expr;if(((τ784 instanceof Array)&&(((τp0=τ784.length),true)&&((τp0===2)&&(((τp1=τ784[0]),(τp1==="data"))&&((expr=τ784[1]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["send",["symbol","=="],["data",["send",["symbol","typeof"],["data",expr]],["value","string"]]];}];}else{if((τ783&&((τp2=τ779[1]),(τp2==="Number")))){return ["macro",function(_,τ785){var τp0;var τp1;var expr;if(((τ785 instanceof Array)&&(((τp0=τ785.length),true)&&((τp0===2)&&(((τp1=τ785[0]),(τp1==="data"))&&((expr=τ785[1]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["send",["symbol","=="],["data",["send",["symbol","typeof"],["data",expr]],["value","number"]]];}];}else{if((τ783&&((τp2=τ779[1]),(τp2==="true")))){return ["macro",function(_,τ786){var τp0;var τp1;var expr;if(((τ786 instanceof Array)&&(((τp0=τ786.length),true)&&((τp0===2)&&(((τp1=τ786[0]),(τp1==="data"))&&((expr=τ786[1]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return expr;}];}else{if((τ783&&((τp2=τ779[1]),(τp2==="false")))){return ["macro",function(_,τ787){var τp0;var τp1;var expr;if(((τ787 instanceof Array)&&(((τp0=τ787.length),true)&&((τp0===2)&&(((τp1=τ787[0]),(τp1==="data"))&&((expr=τ787[1]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["send",["symbol","not"],["data",["void"],expr]];}];}else{if((τ783&&((τp2=τ779[1]),(τp2==="null")))){return ["macro",make_checker(["value",null],["symbol","___is"])];}else{if((τ783&&((τp2=τ779[1]),(τp2==="undefined")))){return ["macro",make_checker(["value",undefined],["symbol","___is"])];}else{if(((other=τ779),true)){return ["send",["symbol","___checker"],["data",expr]];}else{throw ["Could not find a match",τ779];}}}}}}}}}();var mac=function(τ789,expr){var τp0;var τ788;var env;if(((τ789 instanceof Array)&&(((τp0=τ789.length),true)&&((τp0===2)&&((τ788=τ789[0]),true,(env=τ789[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ790=τ788;var other;if((τ790==="pattern")){var τ791=expr;var τp0;var τp1;var subp;var τp0;var τp1;var other;var τ792=false;var τ793=false;if(((τ792=(τ791 instanceof Array))&&((τ793=((τp0=τ791.length),true))&&((τp0>=1)&&(((τp1=τ791[0]),(τp1==="data"))&&((subp=τ791.slice(1)),true)))))){var projector=["send",["symbol","___deconstructor"],["data",orig_expr]];return ["check",checker,["project",projector,τ590(["duck",0],subp)]];}else{if((τ793&&((τp0===1)&&((τp1=τ791[0]),(τp1==="void"))))){return ["check",checker,["ignore"]];}else{if(((other=τ791),true)){return ["check",checker,expr];}else{throw ["Could not find a match",τ791];}}}}else{if(((other=τ790),true)){return ["send",checker,["data",expr]];}else{throw ["Could not find a match",τ790];}}};return ["macro",mac];}else{throw ["Could not find a match",τ774];}}});stdenv.register_macro("!",function(τ794,τ795){var τp0;var context;var env;if(((τ794 instanceof Array)&&(((τp0=τ794.length),true)&&((τp0===2)&&((context=τ794[0]),true,(env=τ794[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var expr;var τp2;var τp3;var τp4;if(((τ795 instanceof Array)&&(((τp0=τ795.length),true)&&((τp0===3)&&(((τp1=τ795[0]),(τp1==="data"))&&(((expr=τ795[1]),true,(τp2=τ795[2]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&((τp4=τp2[0]),(τp4==="void")))))))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var orig_expr=expr;var projector=function(){var τ796=expr;var τp0;var τp1;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var other;var τ797=false;var τ798=false;var τ799=false;var τ800=false;if(((τ797=(τ796 instanceof Array))&&((τ798=((τp0=τ796.length),true))&&((τp0===1)&&((τp1=τ796[0]),(τp1==="void")))))){throw "can't use ! on its own";}else{if((τ798&&((τ799=(τp0===2))&&((τ800=((τp1=τ796[0]),(τp1==="symbol")))&&((τp2=τ796[1]),(τp2==="String")))))){return ["macro",function(_,τ801){var τp0;var τp1;var expr;if(((τ801 instanceof Array)&&(((τp0=τ801.length),true)&&((τp0===2)&&(((τp1=τ801[0]),(τp1==="data"))&&((expr=τ801[1]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["data",["symbol","true"],["send",["symbol","String"],["data",expr]]];}];}else{if((τ800&&((τp2=τ796[1]),(τp2==="Number")))){return ["macro",function(_,τ802){var τp0;var τp1;var expr;if(((τ802 instanceof Array)&&(((τp0=τ802.length),true)&&((τp0===2)&&(((τp1=τ802[0]),(τp1==="data"))&&((expr=τ802[1]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["data",["symbol","true"],["send",["symbol","parseFloat"],["data",expr]]];}];}else{if(((other=τ796),true)){return ["send",["symbol","___projector"],["data",expr]];}else{throw ["Could not find a match",τ796];}}}}}();var mac=function(τ804,expr){var τp0;var τ803;var env;if(((τ804 instanceof Array)&&(((τp0=τ804.length),true)&&((τp0===2)&&((τ803=τ804[0]),true,(env=τ804[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ805=τ803;var other;if((τ805==="pattern")){var τ806=expr;var τp0;var τp1;var subp;var τp0;var τp1;var other;var τ807=false;var τ808=false;if(((τ807=(τ806 instanceof Array))&&((τ808=((τp0=τ806.length),true))&&((τp0>=1)&&(((τp1=τ806[0]),(τp1==="data"))&&((subp=τ806.slice(1)),true)))))){var dctor=["send",["symbol","___deconstructor"],["data",orig_expr]];return ["project",projector,["project",dctor,τ590(["duck",0],subp)]];}else{if((τ808&&((τp0===1)&&((τp1=τ806[0]),(τp1==="void"))))){return ["project",projector,["ignore"]];}else{if(((other=τ806),true)){return ["project",projector,expr];}else{throw ["Could not find a match",τ806];}}}}else{if(((other=τ805),true)){return ["send",["send",projector,["data",expr]],["value",1]];}else{throw ["Could not find a match",τ805];}}};return ["macro",mac];});var is_symbol=function(τ809,env){var τ810=τ809;var τp0;var τp1;var s;var _;if(((τ810 instanceof Array)&&(((τp0=τ810.length),true)&&((τp0===2)&&(((τp1=τ810[0]),(τp1==="symbol"))&&((s=τ810[1]),true)))))){var τ811=env.resolve(s);var τp0;var τp1;var m;var _;if(((τ811 instanceof Array)&&(((τp0=τ811.length),true)&&((τp0===2)&&(((τp1=τ811[0]),(τp1==="macro"))&&((m=τ811[1]),true)))))){return false;}else{if(((_=τ811),true)){return true;}else{throw ["Could not find a match",τ811];}}}else{if(((_=τ810),true)){return false;}else{throw ["Could not find a match",τ810];}}};var lhs_parse_specs=function(env,specs){var fw=[];var bw=[];var keys=[];var defaults=[];var rest=undefined;(specs=specs.slice(0));while(specs.length){var x=specs.shift();var v=expand.step(["pattern",env],x);var τ812=v;var τp0;var τp1;var variable;var τp0;var τp1;var key;var τp0;var τp1;var key;var value;var τp0;var τp1;var variable;var value;var τ813;var otherwise;var τ814=false;var τ815=false;var τ816=false;if(((τ814=(τ812 instanceof Array))&&((τ815=((τp0=τ812.length),true))&&((τ816=(τp0===2))&&(((τp1=τ812[0]),(τp1==="dynsplice"))&&((variable=τ812[1]),true)))))){(rest=variable);}else{if((τ816&&(((τp1=τ812[0]),(τp1==="assoc"))&&((key=τ812[1]),true)))){keys.push([key,key]);}else{if((τ815&&((τ816=(τp0===3))&&(((τp1=τ812[0]),(τp1==="assoc"))&&((key=τ812[1]),true,(value=τ812[2]),true))))){keys.push([key,value]);}else{if((τ816&&(((τp1=τ812[0]),(τp1==="default"))&&((variable=τ812[1]),true,(value=τ812[2]),true,(τ813=τ812),true)))){var τ817=τ813;var otherwise;if(rest){throw Error("no defaults after rest arg");}else{if(((otherwise=τ817),true)){defaults.push([variable,value]);}else{throw ["Could not find a match",τ817];}}}else{if((rest===undefined)){fw.push(v);}else{if(((otherwise=τ812),true)){bw.push(v);}else{throw ["Could not find a match",τ812];}}}}}}}return [fw,bw,keys,defaults,rest];};var parse_lhs=function(env,lhs,rhs,gen){(gen=(gen||gensym_factory("p")));var vars=[];var clauses=[];var current=["multi"];var placeholder=null;var mktemp=function(){var t=gen();vars.push(t);return t;};var newclause=function(){if((current.length>1)){clauses.push(current);}else{null;}return (current=["multi"]);};var maybe_temp=function(x){if(is_symbol(x,env)){return x;}else{var temp=mktemp();current.push(["assign",temp,x]);return temp;}};var helper=function(lhs,curr){return helper_noexpand(expand.step(["pattern",env],lhs),curr);};var helper_noexpand=function(lhs,curr){var helper_keys=function(temp,keys){var τ825=[];var τ826=keys;var τ827=τ826.length;for(var τ828=0;(τ828<τ827);(τ828++)){var τ829=τ826[τ828];var τp0;var τp1;var τ832;var τ833;var k;var τ830;var τ831;var k;var v;var other;if(((τ829 instanceof Array)&&(((τp0=τ829.length),true)&&((τp0===2)&&(((τp1=τ829[0]),(((τp1 instanceof Array)&&(((τ830=τp1.length),true)&&((τ830===2)&&(((τ831=τp1[0]),(τ831==="symbol"))&&((k=τp1[1]),true)))))||((τp1 instanceof Array)&&(((τ832=τp1.length),true)&&((τ832===2)&&(((τ833=τp1[0]),(τ833==="value"))&&((k=τp1[1]),true)))))))&&((v=τ829[1]),true)))))){τ825.push((current.push(["send",["symbol","___hasprop"],["data",temp,["value",k]]]),newclause(),helper(v,["send",temp,["value",k]])));}else{if(((other=τ829),true)){false;}else{throw ["Could not find a match",τ829];}}}return τ825;};var helper_array=function(temp,specs,start){var τp0;var fw;var bw;var keys;var dflt;var rest;if(((specs instanceof Array)&&(((τp0=specs.length),true)&&((τp0===5)&&((fw=specs[0]),true,(bw=specs[1]),true,(keys=specs[2]),true,(dflt=specs[3]),true,(rest=specs[4]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",23065,23091]}));}var nfw=fw.length;var nbw=bw.length;var ndflt=dflt.length;var extract_length=true;var check_length=true;if(extract_length){var len=mktemp();current.push(["send",["symbol",":="],["data",len,["send",temp,["send",["symbol","."],["data",["void"],["symbol","length"]]]]]],["symbol","true"]);newclause();if(check_length){var lo=((nfw+nbw)+start);var hi=(lo+ndflt);if((rest===undefined)){if((lo===hi)){current.push(["send",["symbol","=="],["data",len,["value",lo]]]);}else{current.push(["send",["symbol","and"],["data",["send",["symbol",">="],["data",len,["value",lo]]],["send",["symbol","<="],["data",len,["value",hi]]]]]);}}else{current.push(["send",["symbol",">="],["data",len,["value",lo]]]);}newclause();}else{null;}}else{null;}var τ834=enumerate(fw);var τ835=τ834.length;for(var τ836=0;(τ836<τ835);(τ836++)){var τ844=τ834[τ836];var τp0;var j;var m;var other;if(((τ844 instanceof Array)&&(((τp0=τ844.length),true)&&((τp0===2)&&((j=τ844[0]),true,(m=τ844[1]),true))))){helper(m,["send",temp,["value",(j+start)]]);}else{if(((other=τ844),true)){false;}else{throw ["Could not find a match",τ844];}}}false;var τ837=enumerate(dflt);var τ838=τ837.length;for(var τ839=0;(τ839<τ838);(τ839++)){var τ845=τ837[τ839];var τp0;var j;var τp1;var τp2;var patt;var value;var other;if(((τ845 instanceof Array)&&(((τp0=τ845.length),true)&&((τp0===2)&&(((j=τ845[0]),true,(τp1=τ845[1]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===2)&&((patt=τp1[0]),true,(value=τp1[1]),true)))))))){var idx=((j+nfw)+start);helper(patt,["send",["symbol","if"],["data",["send",["symbol",">="],["data",["value",idx],len]],value,["send",temp,["value",idx]]]]);}else{if(((other=τ845),true)){false;}else{throw ["Could not find a match",τ845];}}}false;if((rest!==undefined)){var pos=((nfw+ndflt)+start);var slice=function(){if((nbw>0)){return ["data",["value",pos],["value",(-nbw)]];}else{return ["data",["value",pos]];}}();helper(rest,["send",["send",temp,["send",["symbol","."],["data",["void"],["symbol","slice"]]]],slice]);}else{null;}var τ840=[];var τ841=enumerate(bw);var τ842=τ841.length;for(var τ843=0;(τ843<τ842);(τ843++)){var τ846=τ841[τ843];var τp0;var j;var m;var other;if(((τ846 instanceof Array)&&(((τp0=τ846.length),true)&&((τp0===2)&&((j=τ846[0]),true,(m=τ846[1]),true))))){τ840.push(helper(m,["send",temp,["send",["symbol","-"],["data",len,["value",(nbw-j)]]]]));}else{if(((other=τ846),true)){false;}else{throw ["Could not find a match",τ846];}}}return τ840;};var τ818=lhs;var τp0;var τp1;var τ819;var τ820;var τp0;var τp1;var s;var τp0;var τp1;var v;var τp0;var τp1;var condition;var pattern;var τp0;var τp1;var τp0;var τp1;var c;var pattern;var τp0;var τp1;var xs;var τp0;var τp1;var xs;var τp0;var τp1;var τp2;var τp3;var τp4;var checkers;var expr;var τp0;var τp1;var checker;var expr;var τp0;var τp1;var projector;var expr;var τp0;var τp1;var fname;var spec;var τp0;var τp1;var i;var args;var τp0;var τp1;var args;var other;var τ821=false;var τ822=false;var τ823=false;var τ824=false;if(((τ818 instanceof Array)&&(((τp0=τ818.length),true)&&((τp0===1)&&((τp1=τ818[0]),(τp1==="void")))))){var x=["check",["macro",make_checker(["value",null],["symbol","___eq"])],["ignore"]];return helper_noexpand(x,curr);}else{if(((τ818==="_")||((τ818 instanceof Array)&&(((τ819=τ818.length),true)&&((τ819===1)&&((τ820=τ818[0]),(τ820==="ignore"))))))){if((!is_symbol(curr,env))){current.push(curr);return current.push(["symbol","true"]);}else{return null;}}else{if(((τ821=(τ818 instanceof Array))&&((τ822=((τp0=τ818.length),true))&&((τ823=(τp0===2))&&(((τp1=τ818[0]),(τp1==="symbol"))&&((s=τ818[1]),true)))))){vars.push(["symbol",s]);current.push(["assign",["symbol",s],curr]);return current.push(["value",true]);}else{if((τ823&&(((τp1=τ818[0]),(τp1==="value"))&&((v=τ818[1]),true)))){var x=["check",["macro",make_checker(lhs,["symbol","___eq"])],["ignore"]];return helper_noexpand(x,curr);}else{if((τ822&&((τp0===3)&&(((τp1=τ818[0]),(τp1==="test"))&&((condition=τ818[1]),true,(pattern=τ818[2]),true))))){helper(pattern,curr);current.push(condition);return newclause();}else{if((τ822&&((τp0===1)&&((τp1=τ818[0]),(τp1==="placeholder"))))){(placeholder=gensym());vars.push(placeholder);current.push(["assign",placeholder,curr]);return current.push(["value",true]);}else{if((τ822&&((τp0===3)&&(((τp1=τ818[0]),(τp1==="constant"))&&((c=τ818[1]),true,(pattern=τ818[2]),true))))){return helper(pattern,c);}else{if((τ822&&((τ823=(τp0>=1))&&(((τp1=τ818[0]),(τp1==="all"))&&((xs=τ818.slice(1)),true))))){var temp=maybe_temp(curr);var τ847=xs;var τ848=τ847.length;for(var τ849=0;(τ849<τ848);(τ849++)){var τ850=τ847[τ849];var x;var other;if(((x=τ850),true)){helper(x,temp);}else{if(((other=τ850),true)){false;}else{throw ["Could not find a match",τ850];}}}false;return false;}else{if((τ823&&(((τp1=τ818[0]),(τp1==="any"))&&((xs=τ818.slice(1)),true)))){var normalize=function(vars){return function(){var τ854=[];var τ855=vars;var τ856=τ855.length;for(var τ857=0;(τ857<τ856);(τ857++)){var τ858=τ855[τ857];var τp0;var τp1;var v;var other;if(((τ858 instanceof Array)&&(((τp0=τ858.length),true)&&((τp0===2)&&(((τp1=τ858[0]),(τp1==="symbol"))&&((v=τ858[1]),true,(v[0]!=="τ"))))))){τ854.push(v);}else{if(((other=τ858),true)){false;}else{throw ["Could not find a match",τ858];}}}return τ854;}().sort().join(",");};var temp=maybe_temp(curr);var myvars=undefined;var clauses=[];var τ851=xs;var τ852=τ851.length;for(var τ853=0;(τ853<τ852);(τ853++)){var τ859=τ851[τ853];var x;var other;if(((x=τ859),true)){var p=parse_lhs(env,x,temp,gensym);var τ860=null;var _;if((myvars===undefined)){(myvars=p[0]);}else{if((normalize(p[0])!==normalize(myvars))){throw [Error("Must have the same set of variables in both branches!",(("["+String(myvars))+"]"),(("["+String(p[0]))+"]"))];}else{if(((_=τ860),true)){(vars=vars.concat(p[0]));}else{throw ["Could not find a match",τ860];}}}clauses.push(make_pattern_test(p[1]));}else{if(((other=τ859),true)){false;}else{throw ["Could not find a match",τ859];}}}false;current.push(make_or_pattern(clauses));(vars=vars.concat(myvars));return newclause();}else{if((τ822&&((τ823=(τp0===3))&&((τ824=((τp1=τ818[0]),(τp1==="check")))&&(((τp2=τ818[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3>=1)&&(((τp4=τp2[0]),(τp4==="multi"))&&((checkers=τp2.slice(1)),true,(expr=τ818[2]),true))))))))){var temp=maybe_temp(curr);var τ861=checkers;var τ862=τ861.length;for(var τ863=0;(τ863<τ862);(τ863++)){var τ864=τ861[τ863];var checker;var other;if(((checker=τ864),true)){current.push(["send",checker,["data",temp]]);newclause();}else{if(((other=τ864),true)){false;}else{throw ["Could not find a match",τ864];}}}false;return helper(expr,temp);}else{if((τ824&&((checker=τ818[1]),true,(expr=τ818[2]),true))){var temp=maybe_temp(curr);current.push(["send",checker,["data",temp]]);newclause();return helper(expr,temp);}else{if((τ823&&(((τp1=τ818[0]),(τp1==="project"))&&((projector=τ818[1]),true,(expr=τ818[2]),true)))){var temp=maybe_temp(curr);var temp2=mktemp();current.push(["send",["symbol",":="],["data",temp2,["send",projector,["data",temp]]]],["send",temp2,["value",0]]);newclause();return helper(expr,["send",temp2,["value",1]]);}else{if((τ823&&(((τp1=τ818[0]),(τp1==="send"))&&((fname=τ818[1]),true,(spec=τ818[2]),true)))){return helper(fname,["send",["symbol","->"],["data",spec,curr]]);}else{if((τ822&&((τp0>=2)&&(((τp1=τ818[0]),(τp1==="duck"))&&((i=τ818[1]),true,(args=τ818.slice(2)),true))))){var temp=maybe_temp(curr);current.push(["value",true]);var τp0;var specs;var τp1;var fw;var bw;var keys;var dflt;var rest;if((((τp0=lhs_parse_specs(env,args)),(specs=τp0),true,(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===5)&&((fw=τp0[0]),true,(bw=τp0[1]),true,(keys=τp0[2]),true,(dflt=τp0[3]),true,(rest=τp0[4]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",28089,28125]}));}if(keys.length){helper_keys(temp,keys);}else{null;}if((((((keys.length===0)||fw.length)||bw.length)||dflt.length)||rest)){return helper_array(temp,specs,i);}else{return null;}}else{if((τ822&&((τp0>=1)&&(((τp1=τ818[0]),(τp1==="data"))&&((args=τ818.slice(1)),true))))){var temp=maybe_temp(curr);var τp0;var specs;var τp1;var fw;var bw;var keys;var dflt;var rest;if((((τp0=lhs_parse_specs(env,args)),(specs=τp0),true,(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===5)&&((fw=τp0[0]),true,(bw=τp0[1]),true,(keys=τp0[2]),true,(dflt=τp0[3]),true,(rest=τp0[4]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",28426,28462]}));}if(keys.length){helper_keys(temp,keys);}else{null;}if((((((keys.length===0)||fw.length)||bw.length)||dflt.length)||rest)){current.push(["send",["symbol","instanceof"],["data",temp,["symbol","Array"]]]);newclause();return helper_array(temp,specs,0);}else{return null;}}else{if(((other=τ818),true)){throw ["OopsG",other];}else{throw ["Could not find a match",τ818];}}}}}}}}}}}}}}}}};helper(lhs,rhs);if((current.length>1)){clauses.push(current);}else{null;}return [vars,clauses,placeholder];};var make_declarations=function(vars,val){var τ865=[];var τ866=vars;var τ867=τ866.length;for(var τ868=0;(τ868<τ867);(τ868++)){var τ869=τ866[τ868];var name;var other;if(((name=τ869),true)){τ865.push(["declare",name,["value",val]]);}else{if(((other=τ869),true)){false;}else{throw ["Could not find a match",τ869];}}}return τ865;};var make_pattern_test=function(clauses){var ands=clauses.pop();while((clauses.length>0)){(ands=["send",["symbol","and"],["data",clauses.pop(),ands]]);}return (ands||["value",true]);};var make_or_pattern=function(clauses){var ors=clauses.pop();while((clauses.length>0)){(ors=["send",["symbol","or"],["data",clauses.pop(),ors]]);}return ors;};var find_arrow=function(τ871){var expr;var τ870;(expr=τ871);true;(τ870=τ871);var τ872=τ870;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var x;var τ875;var τ876;var τ873;var τ874;var x;var x;var τp0;var τp1;var v;var τp0;var kind;var args;var τ877=false;var τ878=false;var τ879=false;var τ880=false;if(((τ877=(τ872 instanceof Array))&&((τ878=((τp0=τ872.length),true))&&((τ879=(τp0===2))&&((τ880=((τp1=τ872[0]),(τp1==="symbol")))&&((τp2=τ872[1]),(τp2==="match"))))))){var placeholder=gensym();return [placeholder,placeholder];}else{if((τ880&&((τp2=τ872[1]),(τp2==="|>")))){var placeholder=gensym();return [placeholder,placeholder];}else{if((τ880&&((τp2=τ872[1]),(τp2==="|>*")))){var placeholder=gensym();return [placeholder,["send",["symbol","*"],["data",["void"],placeholder]]];}else{if((((τ872 instanceof Array)&&(((τ873=τ872.length),true)&&((τ873===2)&&(((τ874=τ872[0]),(τ874==="symbol"))&&((x=τ872[1]),true)))))||(((x=τ872),true,(τ872 instanceof Array))&&(((τ875=τ872.length),true)&&((τ875===1)&&((τ876=τ872[0]),(τ876==="void"))))))){return [false,expr];}else{if((((x=τ872),true,(τ872 instanceof Array))&&(((τp0=τ872.length),true)&&((τp0===2)&&(((τp1=τ872[0]),(τp1==="value"))&&((v=τ872[1]),true)))))){return [false,x];}else{if(((τ872 instanceof Array)&&(((τp0=τ872.length),true)&&((τp0>=1)&&((kind=τ872[0]),true,(args=τ872.slice(1)),true))))){var placeholder=false;var new_args=function(){var τ881=[];var τ882=args;var τ883=τ882.length;for(var τ884=0;(τ884<τ883);(τ884++)){var τ885=τ882[τ884];var arg;var other;if(((arg=τ885),true)){τ881.push(function(){var τp0;var τp1;var ph;var new_arg;if((((τp0=find_arrow(arg)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((ph=τp0[0]),true,(new_arg=τp0[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",29966,29979]}));}if(ph){(placeholder=ph);}else{null;}return new_arg;}());}else{if(((other=τ885),true)){false;}else{throw ["Could not find a match",τ885];}}}return τ881;}();return [placeholder,τ590([kind],new_args)];}else{throw ["Could not find a match",τ872];}}}}}}};var same=function(){var τ887=Array.prototype.slice.call(arguments,0);var τp0;var τ888;if(((τ887 instanceof Array)&&(((τp0=τ887.length),true)&&((τp0>=0)&&((τ888=τ887.slice(0)),true))))){var τ889=τ888;var τp0;var τp1;var τp2;var τp3;var x;var τp4;var τp5;var τp6;var y;var τp0;var τp1;var τp2;var τp3;var x;var τp4;var τp5;var τp6;var y;var τp0;var τp1;var τp2;var τp3;var x;var τp4;var τp5;var τp6;var y;var τp0;var τp1;var τp2;var τp3;var f;var x;var τp4;var τp5;var τp6;var g;var y;var τp0;var τp1;var τp2;var kind1;var xs;var τp3;var τp4;var kind2;var ys;var other;var τ890=false;var τ891=false;var τ892=false;var τ893=false;var τ894=false;var τ895=false;if(((τ890=(τ889 instanceof Array))&&((τ891=((τp0=τ889.length),true))&&((τ892=(τp0===2))&&((τ893=((τp1=τ889[0]),(τp1 instanceof Array)))&&((τ894=((τp2=τp1.length),true))&&((τ895=(τp2===2))&&(((τp3=τp1[0]),(τp3==="symbol"))&&(((x=τp1[1]),true,(τp4=τ889[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="symbol"))&&((y=τp4[1]),true))))))))))))){return (x===y);}else{if((τ895&&(((τp3=τp1[0]),(τp3==="value"))&&(((x=τp1[1]),true,(τp4=τ889[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="value"))&&((y=τp4[1]),true)))))))){return (x===y);}else{if((τ895&&(((τp3=τp1[0]),(τp3==="macro"))&&(((x=τp1[1]),true,(τp4=τ889[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="macro"))&&((y=τp4[1]),true)))))))){return (x===y);}else{if((τ894&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((f=τp1[1]),true,(x=τp1[2]),true,(τp4=τ889[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===3)&&(((τp6=τp4[0]),(τp6==="send"))&&((g=τp4[1]),true,(y=τp4[2]),true))))))))){return (same(f,g)&&same(x,y));}else{if((τ894&&((τp2>=1)&&(((kind1=τp1[0]),true,(xs=τp1.slice(1)),true,(τp3=τ889[1]),(τp3 instanceof Array))&&(((τp4=τp3.length),true)&&((τp4>=1)&&((kind2=τp3[0]),true,(ys=τp3.slice(1)),true))))))){var allequal=xs.every(function(x,i){return same(x,send(ys,i));});return (((kind1===kind2)&&(xs.length===ys.length))&&allequal);}else{if(((other=τ889),true)){return false;}else{throw ["Could not find a match",τ889];}}}}}}}else{throw ["Could not find a match",τ887];}};stdenv.register_macro("|>",function(τ897,τ896){var τp0;var context;var env;if(((τ897 instanceof Array)&&(((τp0=τ897.length),true)&&((τp0===2)&&((context=τ897[0]),true,(env=τ897[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ898=τ896;var τp0;var τp1;var τp0;var τp1;var to_match;var cl;var τ899=false;var τ900=false;if(((τ899=(τ898 instanceof Array))&&((τ900=((τp0=τ898.length),true))&&((τp0===1)&&((τp1=τ898[0]),(τp1==="void")))))){return ["placeholder"];}else{if((τ900&&((τp0===3)&&(((τp1=τ898[0]),(τp1==="data"))&&((to_match=τ898[1]),true,(cl=τ898[2]),true))))){var temp=gensym();var clauses=function(){var τ901=cl;var τp0;var τp1;var cls;var other;if(((τ901 instanceof Array)&&(((τp0=τ901.length),true)&&((τp0>=1)&&(((τp1=τ901[0]),(τp1==="multi"))&&((cls=τ901.slice(1)),true)))))){return cls;}else{if(((other=τ901),true)){return [other];}else{throw ["Could not find a match",τ901];}}}();var cached_conditions=[];var stmts=["multi",["declare",temp,to_match]];(clauses=function(){var τ902=[];var τ903=clauses;var τ904=τ903.length;for(var τ905=0;(τ905<τ904);(τ905++)){var τ906=τ903[τ905];var clause;var other;if(((clause=τ906),true)){τ902.push(function(){var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var lhs;var body;if(((clause instanceof Array)&&(((τp0=clause.length),true)&&((τp0===3)&&(((τp1=clause[0]),(τp1==="send"))&&(((τp2=clause[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="->"))&&(((τp6=clause[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&((lhs=τp6[1]),true,(body=τp6[2]),true))))))))))))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",30825,30863]}));}var τp0;var τp1;var decls;var conditions;var placeholder;if((((τp0=parse_lhs(env,lhs,temp)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===3)&&((decls=τp0[0]),true,(conditions=τp0[1]),true,(placeholder=τp0[2]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",30935,30967]}));}(stmts=stmts.concat(make_declarations(decls)));var b=function(){if(placeholder){return ["send",["symbol","|>"],["data",placeholder,body]];}else{return body;}}();var f=function(x){return ["done",expand(["expr",env],x)];};return [conditions.map(f),b];}());}else{if(((other=τ906),true)){false;}else{throw ["Could not find a match",τ906];}}}return τ902;}());var shares=function(){var f=function(τ907,i){var τp0;var conditions;var body;if(((τ907 instanceof Array)&&(((τp0=τ907.length),true)&&((τp0===2)&&((conditions=τ907[0]),true,(body=τ907[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var res=0;var prev_conditions=send(clauses,i)[0];var nc=conditions.length;for(var j=0;((j<nc)&&same(send(conditions,j),send(prev_conditions,j)));(j++)){(res++);}return res;};return clauses.slice(1).map(f);}();var max=send(Math.max,shares);shares.push(0);var vars=[];(vars=vars.concat(function(){var τ908=[];var τ909=τ1100(1,max);var τ910=τ909.length;for(var τ911=0;(τ911<τ910);(τ911++)){var τ912=τ909[τ911];var _;var other;if(((_=τ912),true)){τ908.push(gensym());}else{if(((other=τ912),true)){false;}else{throw ["Could not find a match",τ912];}}}return τ908;}()));(stmts=stmts.concat(make_declarations(vars,false)));var shared_last=0;var new_clauses=clauses.map(function(τ913,i){var τp0;var conditions;var body;if(((τ913 instanceof Array)&&(((τp0=τ913.length),true)&&((τp0===2)&&((conditions=τ913[0]),true,(body=τ913[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var shared=function(){if(shared_last){return [send(vars,(shared_last-1))];}else{return [];}}();var n_to_share=Math.max(shared_last,send(shares,i));var to_share=conditions.slice(shared_last,n_to_share).map(function(x,j){return ["assign",send(vars,(shared_last+j)),x];});(shared_last=send(shares,i));var rest=conditions.slice(n_to_share);return [shared.concat(to_share).concat(rest),body];});(clauses=new_clauses);var r=["js_throw",["data",["value","Could not find a match"],temp]];while((clauses.length>0)){var τp0;var τp1;var conditions;var body;if((((τp0=clauses.pop()),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((conditions=τp0[0]),true,(body=τp0[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",32495,32513]}));}var test=make_pattern_test(conditions);(r=["if",test,body,r]);}stmts.push(r);return stmts;}else{throw ["Could not find a match",τ898];}}});var qqstruct=function(name,args){return τ590(["data",["value",name]],args);};var qq=function(τ915){var expr;var τ914;(expr=τ915);true;(τ914=τ915);var τ916=τ914;var τp0;var τp1;var s;var τp0;var τp1;var τp0;var τp1;var v;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var insert;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var insert;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var insert;var τp0;var name;var args;var τ917=false;var τ918=false;var τ919=false;var τ920=false;var τ921=false;var τ922=false;var τ923=false;var τ924=false;if(((τ917=(τ916 instanceof Array))&&((τ918=((τp0=τ916.length),true))&&((τp0===2)&&(((τp1=τ916[0]),(τp1==="symbol"))&&((s=τ916[1]),true)))))){return qqstruct("symbol",[["value",s]]);}else{if((τ918&&((τp0===1)&&((τp1=τ916[0]),(τp1==="void"))))){return qqstruct("void",[]);}else{if((τ918&&((τp0===2)&&(((τp1=τ916[0]),(τp1==="value"))&&((v=τ916[1]),true))))){return qqstruct("value",[expr]);}else{if((τ918&&((τ919=(τp0===3))&&((τ920=((τp1=τ916[0]),(τp1==="send")))&&((τ921=((τp2=τ916[1]),(τp2 instanceof Array)))&&((τ922=((τp3=τp2.length),true))&&((τ923=(τp3===2))&&((τ924=((τp4=τp2[0]),(τp4==="symbol")))&&(((τp5=τp2[1]),(τp5==="^"))&&(((τp6=τ916[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===1)&&(((τp11=τp9[0]),(τp11==="void"))&&((insert=τp6[2]),true)))))))))))))))))){return insert;}else{if((τ924&&(((τp5=τp2[1]),(τp5==="^="))&&(((τp6=τ916[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===1)&&(((τp11=τp9[0]),(τp11==="void"))&&((insert=τp6[2]),true)))))))))))){return qqstruct("value",[insert]);}else{if((τ924&&(((τp5=τp2[1]),(τp5==="^*"))&&(((τp6=τ916[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===1)&&(((τp11=τp9[0]),(τp11==="void"))&&((insert=τp6[2]),true)))))))))))){return ["send",["symbol","*"],["data",["void"],insert]];}else{if((τ918&&((τp0>=1)&&((name=τ916[0]),true,(args=τ916.slice(1)),true)))){return qqstruct(name,function(){var τ925=[];var τ926=args;var τ927=τ926.length;for(var τ928=0;(τ928<τ927);(τ928++)){var τ929=τ926[τ928];var arg;var other;if(((arg=τ929),true)){τ925.push(qq(arg));}else{if(((other=τ929),true)){false;}else{throw ["Could not find a match",τ929];}}}return τ925;}());}else{throw ["Could not find a match",τ916];}}}}}}}};stdenv.register_macro("'",function(τ930,τ931){var τp0;var context;var env;if(((τ930 instanceof Array)&&(((τp0=τ930.length),true)&&((τp0===2)&&((context=τ930[0]),true,(env=τ930[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var τp2;var τp3;var τp4;var expr;if(((τ931 instanceof Array)&&(((τp0=τ931.length),true)&&((τp0===3)&&(((τp1=τ931[0]),(τp1==="data"))&&(((τp2=τ931[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&(((τp4=τp2[0]),(τp4==="void"))&&((expr=τ931[2]),true)))))))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return qq(expr);});stdenv.register_macro("provide",function(τ932,τ933){var τp0;var context;var env;if(((τ932 instanceof Array)&&(((τp0=τ932.length),true)&&((τp0===2)&&((context=τ932[0]),true,(env=τ932[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var τp2;var τp3;var expr;if(((τ933 instanceof Array)&&(((τp0=τ933.length),true)&&((τp0===2)&&(((τp1=τ933[0]),(τp1==="data"))&&(((τp2=τ933[1]),(τp3=τ1095(aslist)(τp2)),τp3[0])&&((expr=τp3[1]),true))))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["sink",["multi"].concat(function(){var τ934=[];var τ935=expr;var τ936=τ935.length;for(var τ937=0;(τ937<τ936);(τ937++)){var τ938=τ935[τ937];var s;var τp0;var τp1;var name;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var s;var τp9;var τ941;var τ942;var name;var τ939;var τ940;var name;var other;var other;var τ943=false;if((((s=τ938),true,(τ938 instanceof Array))&&(((τp0=τ938.length),true)&&((τp0===2)&&(((τp1=τ938[0]),(τp1==="symbol"))&&((name=τ938[1]),true)))))){τ934.push(["send",["symbol",":="],["data",["send",["symbol","exports"],["value",name]],s]]);}else{if(((τ938 instanceof Array)&&(((τp0=τ938.length),true)&&((τp0===3)&&(((τp1=τ938[0]),(τp1==="send"))&&(((τp2=τ938[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="as"))&&(((τp6=τ938[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&((s=τp6[1]),true,(τp9=τp6[2]),(((τp9 instanceof Array)&&(((τ939=τp9.length),true)&&((τ939===2)&&(((τ940=τp9[0]),(τ940==="symbol"))&&((name=τp9[1]),true)))))||((τp9 instanceof Array)&&(((τ941=τp9.length),true)&&((τ941===2)&&(((τ942=τp9[0]),(τ942==="value"))&&((name=τp9[1]),true))))))))))))))))))))){τ934.push(["send",["symbol",":="],["data",["send",["symbol","exports"],["value",name]],s]]);}else{if((τ943=((other=τ938),true))){τ934.push(function(){throw τ1087(["syntax","provide"]).create("Each clause of provide must be 'sym' or 'sym as name'");}());}else{if(τ943){false;}else{throw ["Could not find a match",τ938];}}}}}return τ934;}())];});stdenv.register_macro("require",function(τ944,τ945){var τp0;var context;var env;if(((τ944 instanceof Array)&&(((τp0=τ944.length),true)&&((τp0===2)&&((context=τ944[0]),true,(env=τ944[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var expr;if(((τ945 instanceof Array)&&(((τp0=τ945.length),true)&&((τp0===2)&&(((τp1=τ945[0]),(τp1==="data"))&&((expr=τ945[1]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var stmts=[];var topfetch=function(pkg,v){stmts.push(["send",["symbol","="],["data",v,["send",["send",["symbol","___node"],["send",["symbol","."],["data",["void"],["symbol","require"]]]],["data",["value",pkg]]]]]);return v;};var produce=function(τ946,fetch){var τ947=τ946;var τp0;var τp1;var s;var τp0;var τp1;var τp2;var s;var τ950;var τ951;var subp;var τ948;var τ949;var subp;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τ954;var τ955;var pkg;var τ952;var τ953;var pkg;var s;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var pkg;var subp;var τ956=false;var τ957=false;var τ958=false;var τ959=false;var τ960=false;var τ961=false;var τ962=false;var τ963=false;if(((τ956=(τ947 instanceof Array))&&((τ957=((τp0=τ947.length),true))&&((τ958=(τp0===2))&&(((τp1=τ947[0]),(τp1==="symbol"))&&((s=τ947[1]),true)))))){return fetch(s,["symbol",s]);}else{if((τ958&&(((τp1=τ947[0]),(τp1==="value"))&&(((τp2=τ947[1]),(typeof(τp2)==="string"))&&((s=τp2),true))))){return fetch(s,gensym());}else{if((((τ947 instanceof Array)&&(((τ948=τ947.length),true)&&((τ948>=1)&&(((τ949=τ947[0]),(τ949==="multi"))&&((subp=τ947.slice(1)),true)))))||((τ947 instanceof Array)&&(((τ950=τ947.length),true)&&((τ950>=1)&&(((τ951=τ947[0]),(τ951==="data"))&&((subp=τ947.slice(1)),true))))))){var τ964=[];var τ965=subp;var τ966=τ965.length;for(var τ967=0;(τ967<τ966);(τ967++)){var τ968=τ965[τ967];var p;var other;if(((p=τ968),true)){τ964.push(produce(p,fetch));}else{if(((other=τ968),true)){false;}else{throw ["Could not find a match",τ968];}}}return τ964;}else{if(((τ956=(τ947 instanceof Array))&&((τ957=((τp0=τ947.length),true))&&((τ958=(τp0===3))&&((τ959=((τp1=τ947[0]),(τp1==="send")))&&((τ960=((τp2=τ947[1]),(τp2 instanceof Array)))&&((τ961=((τp3=τp2.length),true))&&((τ962=(τp3===2))&&((τ963=((τp4=τp2[0]),(τp4==="symbol")))&&(((τp5=τp2[1]),(τp5==="as"))&&(((τp6=τ947[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(((τp9 instanceof Array)&&(((τ952=τp9.length),true)&&((τ952===2)&&(((τ953=τp9[0]),(τ953==="value"))&&((pkg=τp9[1]),true)))))||((τp9 instanceof Array)&&(((τ954=τp9.length),true)&&((τ954===2)&&(((τ955=τp9[0]),(τ955==="symbol"))&&((pkg=τp9[1]),true)))))))&&((s=τp6[2]),true)))))))))))))))){return fetch(pkg,s);}else{if((τ963&&(((τp5=τp2[1]),(τp5==="->"))&&(((τp6=τ947[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&((pkg=τp6[1]),true,(subp=τp6[2]),true)))))))){var pkgv=produce(pkg,fetch);return produce(subp,function(pkg,v){return stmts.push(["send",["symbol","="],["data",v,["send",pkgv,["value",pkg]]]]);});}else{throw ["Could not find a match",τ947];}}}}}};produce(expr,topfetch);return τ590(["multi"],stmts);});stdenv.register_macro("%",function(τ969,τ970){var τp0;var context;var env;if(((τ969 instanceof Array)&&(((τp0=τ969.length),true)&&((τp0===2)&&((context=τ969[0]),true,(env=τ969[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var descr;var contents;if(((τ970 instanceof Array)&&(((τp0=τ970.length),true)&&((τp0===3)&&(((τp1=τ970[0]),(τp1==="data"))&&((descr=τ970[1]),true,(contents=τ970[2]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var tags=["data"];var parse=function(τ971){var τ972=τ971;var τp0;var τp1;var τp0;var τp1;var s;var τp0;var τp1;var x;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var τp12;var τ975;var τ976;var x;var τ973;var τ974;var x;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var τp12;var τ979;var τ980;var x;var τ977;var τ978;var x;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τ983;var τ984;var prop;var τ981;var τ982;var prop;var value;var τp0;var τp1;var expr;var rest;var τ987;var τ988;var args;var τ985;var τ986;var args;var τ989=false;var τ990=false;var τ991=false;var τ992=false;var τ993=false;var τ994=false;var τ995=false;var τ996=false;if(((τ989=(τ972 instanceof Array))&&((τ990=((τp0=τ972.length),true))&&((τp0===1)&&((τp1=τ972[0]),(τp1==="void")))))){return null;}else{if((τ990&&((τ991=(τp0===2))&&(((τp1=τ972[0]),(τp1==="symbol"))&&((s=τ972[1]),true))))){return tags.push(["value",("+"+s)]);}else{if((τ991&&(((τp1=τ972[0]),(τp1==="value"))&&((x=τ972[1]),true)))){return tags.push(["value",("+"+x)]);}else{if((τ990&&((τ991=(τp0===3))&&((τ992=((τp1=τ972[0]),(τp1==="send")))&&((τ993=((τp2=τ972[1]),(τp2 instanceof Array)))&&((τ994=((τp3=τp2.length),true))&&((τ995=(τp3===2))&&((τ996=((τp4=τp2[0]),(τp4==="symbol")))&&(((τp5=τp2[1]),(τp5==="."))&&(((τp6=τ972[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===1)&&(((τp11=τp9[0]),(τp11==="void"))&&((τp12=τp6[2]),(((τp12 instanceof Array)&&(((τ973=τp12.length),true)&&((τ973===2)&&(((τ974=τp12[0]),(τ974==="symbol"))&&((x=τp12[1]),true)))))||((τp12 instanceof Array)&&(((τ975=τp12.length),true)&&((τ975===2)&&(((τ976=τp12[0]),(τ976==="value"))&&((x=τp12[1]),true)))))))))))))))))))))))){return tags.push(["value",x]);}else{if((τ996&&(((τp5=τp2[1]),(τp5==="#"))&&(((τp6=τ972[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===1)&&(((τp11=τp9[0]),(τp11==="void"))&&((τp12=τp6[2]),(((τp12 instanceof Array)&&(((τ977=τp12.length),true)&&((τ977===2)&&(((τ978=τp12[0]),(τ978==="symbol"))&&((x=τp12[1]),true)))))||((τp12 instanceof Array)&&(((τ979=τp12.length),true)&&((τ979===2)&&(((τ980=τp12[0]),(τ980==="value"))&&((x=τp12[1]),true)))))))))))))))))){return tags.push(["value",("#"+x)]);}else{if((τ996&&(((τp5=τp2[1]),(τp5==="="))&&(((τp6=τ972[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(((τp9 instanceof Array)&&(((τ981=τp9.length),true)&&((τ981===2)&&(((τ982=τp9[0]),(τ982==="symbol"))&&((prop=τp9[1]),true)))))||((τp9 instanceof Array)&&(((τ983=τp9.length),true)&&((τ983===2)&&(((τ984=τp9[0]),(τ984==="value"))&&((prop=τp9[1]),true)))))))&&((value=τp6[2]),true))))))))){return tags.push(["send",["send",["symbol","#"],["data",["void"],["symbol","assoc"]]],["data",["value",prop],value]]);}else{if((τ992&&((expr=τ972[1]),true,(rest=τ972[2]),true))){parse(expr);return parse(rest);}else{if((((τ972 instanceof Array)&&(((τ985=τ972.length),true)&&((τ985>=1)&&(((τ986=τ972[0]),(τ986==="multi"))&&((args=τ972.slice(1)),true)))))||((τ972 instanceof Array)&&(((τ987=τ972.length),true)&&((τ987>=1)&&(((τ988=τ972[0]),(τ988==="data"))&&((args=τ972.slice(1)),true))))))){return args.forEach(parse);}else{throw ["Could not find a match",τ972];}}}}}}}}};parse(descr);(contents=function(){var τ997=contents;var τp0;var τp1;var τp0;var τp1;var args;var x;var τ998=false;var τ999=false;if(((τ998=(τ997 instanceof Array))&&((τ999=((τp0=τ997.length),true))&&((τp0===1)&&((τp1=τ997[0]),(τp1==="void")))))){return ["data"];}else{if((τ999&&((τp0>=1)&&(((τp1=τ997[0]),(τp1==="multi"))&&((args=τ997.slice(1)),true))))){return τ590(["data"],args);}else{if(((x=τ997),true)){return x;}else{throw ["Could not find a match",τ997];}}}}());return ["send",["symbol","Node"],["data",tags,contents]];});var var_operator=function(temp){return function(_,expr){var f=function(τ1000){var τ1001=τ1000;var τp0;var τp1;var τp0;var τp1;var τp2;var τp3;var τp4;var τ1002;var other;var τ1003=false;var τ1004=false;if(((τ1003=(τ1001 instanceof Array))&&((τ1004=((τp0=τ1001.length),true))&&((τp0===1)&&((τp1=τ1001[0]),(τp1==="void")))))){return temp;}else{if((τ1004&&((τp0===3)&&(((τp1=τ1001[0]),(τp1==="data"))&&(((τp2=τ1001[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&(((τp4=τp2[0]),(τp4==="void"))&&((τ1002=τ1001[2]),true))))))))){var τ1005=τ1002;var τp0;var τp1;var s;var τp0;var τp1;var obj;var msg;var other;var τ1006=false;var τ1007=false;if(((τ1006=(τ1005 instanceof Array))&&((τ1007=((τp0=τ1005.length),true))&&((τp0===2)&&(((τp1=τ1005[0]),(τp1==="symbol"))&&((s=τ1005[1]),true)))))){return ["send",temp,["value",s]];}else{if((τ1007&&((τp0===3)&&(((τp1=τ1005[0]),(τp1==="send"))&&((obj=τ1005[1]),true,(msg=τ1005[2]),true))))){var x=f(["data",["void"],obj]);return ["send",x,msg];}else{if(((other=τ1005),true)){return ["send",temp,other];}else{throw ["Could not find a match",τ1005];}}}}else{if(((other=τ1001),true)){return ["send",temp,other];}else{throw ["Could not find a match",τ1001];}}}};return f(expr);};};stdenv.register_macro("chain",function(τ1008,τ1009){var τp0;var context;var env;if(((τ1008 instanceof Array)&&(((τp0=τ1008.length),true)&&((τp0===2)&&((context=τ1008[0]),true,(env=τ1008[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var defn;var body;if(((τ1009 instanceof Array)&&(((τp0=τ1009.length),true)&&((τp0===3)&&(((τp1=τ1009[0]),(τp1==="data"))&&((defn=τ1009[1]),true,(body=τ1009[2]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var newenv=env.fork();var temp=gensym();var τp0;var τp1;var variable;var expr;if((((τp0=function(){var τ1010=defn;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var x;var y;var other;if(((τ1010 instanceof Array)&&(((τp0=τ1010.length),true)&&((τp0===3)&&(((τp1=τ1010[0]),(τp1==="send"))&&(((τp2=τ1010[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="as"))&&(((τp6=τ1010[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&((x=τp6[1]),true,(y=τp6[2]),true))))))))))))))){return [y,x];}else{if(((other=τ1010),true)){return [["symbol","@"],other];}else{throw ["Could not find a match",τ1010];}}}()),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((variable=τp0[0]),true,(expr=τp0[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",36721,36737]}));}var τp0;var τp1;var var_str;if(((variable instanceof Array)&&(((τp0=variable.length),true)&&((τp0===2)&&(((τp1=variable[0]),(τp1==="symbol"))&&((var_str=variable[1]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",36843,36859]}));}newenv.register_macro(var_str,var_operator(temp));var stmts=["multi"].concat(function(){var τ1011=[];var τ1012=aslist(body);var τ1013=τ1012.length;for(var τ1014=0;(τ1014<τ1013);(τ1014++)){var τ1015=τ1012[τ1014];var x;var other;if(((x=τ1015),true)){τ1011.push(["send",["symbol",":="],["data",temp,x]]);}else{if(((other=τ1015),true)){false;}else{throw ["Could not find a match",τ1015];}}}return τ1011;}());var v=["multi",["send",["symbol","="],["data",temp,expr]],stmts,temp];return ["done",expand([context,newenv],v)];});stdenv.register_macro("using",function(τ1016,τ1017){var τp0;var context;var env;if(((τ1016 instanceof Array)&&(((τp0=τ1016.length),true)&&((τp0===2)&&((context=τ1016[0]),true,(env=τ1016[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var defn;var body;if(((τ1017 instanceof Array)&&(((τp0=τ1017.length),true)&&((τp0===3)&&(((τp1=τ1017[0]),(τp1==="data"))&&((defn=τ1017[1]),true,(body=τ1017[2]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var newenv=env.fork();var temp=gensym();var τp0;var τp1;var variable;var expr;if((((τp0=function(){var τ1018=defn;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var x;var y;var other;if(((τ1018 instanceof Array)&&(((τp0=τ1018.length),true)&&((τp0===3)&&(((τp1=τ1018[0]),(τp1==="send"))&&(((τp2=τ1018[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="as"))&&(((τp6=τ1018[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&((x=τp6[1]),true,(y=τp6[2]),true))))))))))))))){return [y,x];}else{if(((other=τ1018),true)){return [["symbol","@"],other];}else{throw ["Could not find a match",τ1018];}}}()),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((variable=τp0[0]),true,(expr=τp0[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",37222,37238]}));}var τp0;var τp1;var var_str;if(((variable instanceof Array)&&(((τp0=variable.length),true)&&((τp0===2)&&(((τp1=variable[0]),(τp1==="symbol"))&&((var_str=variable[1]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",37344,37360]}));}newenv.register_macro(var_str,var_operator(temp));var v=["multi",["send",["symbol","="],["data",temp,expr]],body];return ["done",expand([context,newenv],v)];});var partition=function(xs,predicate){var t=[];var f=[];var τ1019=xs;var τ1020=τ1019.length;for(var τ1021=0;(τ1021<τ1020);(τ1021++)){var τ1022=τ1019[τ1021];var x;var x;var other;if(((x=τ1022),true,predicate(x))){t.push(x);}else{if(((x=τ1022),true)){f.push(x);}else{if(((other=τ1022),true)){false;}else{throw ["Could not find a match",τ1022];}}}}false;return [t,f];};stdenv.register_macro("class",function(τ1023,arg){var τp0;var context;var env;if(((τ1023 instanceof Array)&&(((τp0=τ1023.length),true)&&((τp0===2)&&((context=τ1023[0]),true,(env=τ1023[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var clsvar;var τp2;var τp3;var body;if((((τp0=function(){var τ1027=arg;var τp0;var τp1;var body;var τp0;var τp1;var name;var body;var τ1028=false;var τ1029=false;if(((τ1028=(τ1027 instanceof Array))&&((τ1029=((τp0=τ1027.length),true))&&((τp0===2)&&(((τp1=τ1027[0]),(τp1==="data"))&&((body=τ1027[1]),true)))))){return [gensym(),body];}else{if((τ1029&&((τp0===3)&&(((τp1=τ1027[0]),(τp1==="data"))&&((name=τ1027[1]),true,(body=τ1027[2]),true))))){return [name,body];}else{throw ["Could not find a match",τ1027];}}}()),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&(((clsvar=τp0[0]),true,(τp2=τp0[1]),(τp3=τ1095(aslist)(τp2)),τp3[0])&&((body=τp3[1]),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",37708,37730]}));}var τp0;var τp1;var ctors;var clauses;if((((τp0=partition(body,function(τ1030){var τ1031=τ1030;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var τp12;var τp13;var τp14;var τp15;var _;var _;var otherwise;if(((τ1031 instanceof Array)&&(((τp0=τ1031.length),true)&&((τp0===3)&&(((τp1=τ1031[0]),(τp1==="send"))&&(((τp2=τ1031[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="="))&&(((τp6=τ1031[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===3)&&(((τp11=τp9[0]),(τp11==="send"))&&(((τp12=τp9[1]),(τp12 instanceof Array))&&(((τp13=τp12.length),true)&&((τp13===2)&&(((τp14=τp12[0]),(τp14==="symbol"))&&(((τp15=τp12[1]),(τp15==="constructor"))&&((_=τp9[2]),true,(_=τp6[2]),true)))))))))))))))))))))))){return true;}else{if(((otherwise=τ1031),true)){return false;}else{throw ["Could not find a match",τ1031];}}})),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((ctors=τp0[0]),true,(clauses=τp0[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",37826,37842]}));}var τp0;var τp1;var ctor_args;var ctor_body;if((((τp0=function(){var τ1032=ctors;var τp0;var τp0;var τ1033;var τ1034=false;var τ1035=false;if(((τ1034=(τ1032 instanceof Array))&&((τ1035=((τp0=τ1032.length),true))&&(τp0===0)))){return [["data"],[]];}else{if((τ1035&&((τp0===1)&&((τ1033=τ1032[0]),true)))){var τ1036=τ1033;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var _;var args;var τp12;var τp13;var body;if(((τ1036 instanceof Array)&&(((τp0=τ1036.length),true)&&((τp0===3)&&(((τp1=τ1036[0]),(τp1==="send"))&&(((τp2=τ1036[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="="))&&(((τp6=τ1036[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===3)&&(((τp11=τp9[0]),(τp11==="send"))&&(((_=τp9[1]),true,(args=τp9[2]),true,(τp12=τp6[2]),(τp13=τ1095(aslist)(τp12)),τp13[0])&&((body=τp13[1]),true)))))))))))))))))))){return [args,body];}else{throw ["Could not find a match",τ1036];}}else{throw ["Could not find a match",τ1032];}}}()),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((ctor_args=τp0[0]),true,(ctor_body=τp0[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",37984,38006]}));}var selfvar=gensym();(ctor_body=function(){var prep=["send",["symbol","="],["data",selfvar,["send",["symbol","if"],["data",["send",["symbol","not"],["data",["void"],["send",["send",["symbol","?"],["data",clsvar,["void"]]],["symbol","this"]]]],["send",["send",["symbol","Object"],["send",["symbol","."],["data",["void"],["symbol","create"]]]],["data",["send",clsvar,["send",["symbol","."],["data",["void"],["symbol","prototype"]]]]]],["symbol","this"]]]]];var ret=selfvar;return τ590(["multi",prep],ctor_body,[ret]);}());var newenv=env.fork();newenv.register_macro("@",var_operator(selfvar));var defns=[];var static_defns=[];var τ1024=clauses;var τ1025=τ1024.length;for(var τ1026=0;(τ1026<τ1025);(τ1026++)){var τ1037=τ1024[τ1026];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var body;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var name;var args;var τp12;var τp13;var body;var other;var τ1038=false;var τ1039=false;var τ1040=false;var τ1041=false;var τ1042=false;var τ1043=false;var τ1044=false;var τ1045=false;if(((τ1038=(τ1037 instanceof Array))&&((τ1039=((τp0=τ1037.length),true))&&((τ1040=(τp0===3))&&((τ1041=((τp1=τ1037[0]),(τp1==="send")))&&((τ1042=((τp2=τ1037[1]),(τp2 instanceof Array)))&&((τ1043=((τp3=τp2.length),true))&&((τ1044=(τp3===2))&&((τ1045=((τp4=τp2[0]),(τp4==="symbol")))&&(((τp5=τp2[1]),(τp5==="static"))&&(((τp6=τ1037[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===2)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp10=τ1095(aslist)(τp9)),τp10[0])&&((body=τp10[1]),true)))))))))))))))){(static_defns=static_defns.concat(body));}else{if((τ1045&&(((τp5=τp2[1]),(τp5==="="))&&(((τp6=τ1037[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===3)&&(((τp11=τp9[0]),(τp11==="send"))&&(((name=τp9[1]),true,(args=τp9[2]),true,(τp12=τp6[2]),(τp13=τ1095(aslist)(τp12)),τp13[0])&&((body=τp13[1]),true))))))))))))){(name=function(){var τ1046=name;var τp0;var τp1;var _;var τp0;var τp1;var n;var τ1047=false;var τ1048=false;var τ1049=false;if(((τ1047=(τ1046 instanceof Array))&&((τ1048=((τp0=τ1046.length),true))&&((τ1049=(τp0===2))&&(((τp1=τ1046[0]),(τp1==="value"))&&((_=τ1046[1]),true)))))){return name;}else{if((τ1049&&(((τp1=τ1046[0]),(τp1==="symbol"))&&((n=τ1046[1]),true)))){return ["value",n];}else{throw ["Could not find a match",τ1046];}}}());defns.push(["send",["symbol",":="],["data",["send",["send",clsvar,["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],name],["send",["symbol","->"],["data",args,τ590(["multi",["send",["symbol","="],["data",selfvar,["symbol","this"]]]],body)]]]]);}else{if(((other=τ1037),true)){false;}else{throw ["Could not find a match",τ1037];}}}}false;return ["done",expand([context,newenv],τ590(["multi",["send",["symbol","="],["data",clsvar,["send",["symbol","->"],["data",ctor_args,ctor_body]]]],["send",["symbol","&:"],τ590(["data",clsvar],static_defns)]],defns,[clsvar]))];});stdenv.register_macro("do",function(τ1050,τ1051){var τp0;var context;var env;if(((τ1050 instanceof Array)&&(((τp0=τ1050.length),true)&&((τp0===2)&&((context=τ1050[0]),true,(env=τ1050[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var τp2;var τp3;var body;if(((τ1051 instanceof Array)&&(((τp0=τ1051.length),true)&&((τp0===2)&&(((τp1=τ1051[0]),(τp1==="data"))&&(((τp2=τ1051[1]),(τp3=τ1095(aslist)(τp2)),τp3[0])&&((body=τp3[1]),true))))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return τ590(["multi"],body);});stdenv.register_macro("then",function(τ1052,τ1053){var τp0;var context;var env;if(((τ1052 instanceof Array)&&(((τp0=τ1052.length),true)&&((τp0===2)&&((context=τ1052[0]),true,(env=τ1052[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var τp2;var τp3;var body;if(((τ1053 instanceof Array)&&(((τp0=τ1053.length),true)&&((τp0===2)&&(((τp1=τ1053[0]),(τp1==="data"))&&(((τp2=τ1053[1]),(τp3=τ1095(aslist)(τp2)),τp3[0])&&((body=τp3[1]),true))))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return τ590(["multi"],body);});var group=function(xs,classifier){var groups=[];var curr=[];var newgroup=function(){if((curr.length>0)){groups.push(curr);}else{null;}return (curr=[]);};var τ1054=xs;var τ1055=τ1054.length;for(var τ1056=0;(τ1056<τ1055);(τ1056++)){var τ1057=τ1054[τ1056];var x;var other;if(((x=τ1057),true)){if(classifier(x)){newgroup();}else{null;}curr.push(x);}else{if(((other=τ1057),true)){false;}else{throw ["Could not find a match",τ1057];}}}false;newgroup();return groups;};var blocktest_wrap=function(label,expr,accumulator){var value=gensym();return ["multi",["send",["symbol","="],["data",value,["send",["symbol","!!"],["data",["multi",["send",["symbol","|>"],["data",expr,["multi",["send",["symbol","->"],["data",["send",["send",["symbol","?"],["data",["symbol","true"],["void"]]],["symbol","x"]],["send",["send",["symbol","#"],["data",["void"],["symbol","success"]]],["data",["symbol","x"]]]]],["send",["symbol","->"],["data",["send",["send",["symbol","?"],["data",["symbol","false"],["void"]]],["symbol","x"]],["send",["send",["symbol","#"],["data",["void"],["symbol","failure"]]],["data",["symbol","x"]]]]]]]]],["send",["symbol","->"],["data",["symbol","__err"],["send",["send",["symbol","#"],["data",["void"],["symbol","error"]]],["data",["symbol","__err"]]]]]]]]],["send",["send",accumulator,["send",["symbol","."],["data",["void"],["symbol","push"]]]],["data",["send",["send",["symbol","#"],["data",["void"],["symbol","test_result"]]],["data",label,value]]]]];};var blocktest_mac=function(label,tests,acc){var ok=gensym();var stmts=[];stmts.push(["send",["symbol","="],["data",ok,["symbol","true"]]]);var τ1058=tests;var τ1059=τ1058.length;for(var τ1060=0;(τ1060<τ1059);(τ1060++)){var τ1061=τ1058[τ1060];var stmt;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var _;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var new_label;var τp9;var τp10;var new_tests;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var sources;var τp9;var τp10;var clauses;var expr;var other;var τ1062=false;var τ1063=false;var τ1064=false;var τ1065=false;var τ1066=false;var τ1067=false;var τ1068=false;var τ1069=false;if((((stmt=τ1061),true,(τ1061 instanceof Array))&&(((τp0=τ1061.length),true)&&((τp0===3)&&(((τp1=τ1061[0]),(τp1==="send"))&&(((τp2=τ1061[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="do"))&&((_=τ1061[2]),true))))))))))){stmts.push(["send",["symbol","!!"],["data",stmt,["send",["symbol","->"],["data",["symbol","__err"],["multi",["send",["send",acc,["send",["symbol","."],["data",["void"],["symbol","push"]]]],["data",["send",["send",["symbol","#"],["data",["void"],["symbol","error"]]],["data",label,["symbol","__err"]]]]],["send",["symbol",":="],["data",ok,["symbol","false"]]]]]]]]);}else{if(((τ1062=(τ1061 instanceof Array))&&((τ1063=((τp0=τ1061.length),true))&&((τ1064=(τp0===3))&&((τ1065=((τp1=τ1061[0]),(τp1==="send")))&&((τ1066=((τp2=τ1061[1]),(τp2 instanceof Array)))&&((τ1067=((τp3=τp2.length),true))&&((τ1068=(τp3===2))&&((τ1069=((τp4=τp2[0]),(τp4==="symbol")))&&(((τp5=τp2[1]),(τp5==="=>"))&&(((τp6=τ1061[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((new_label=τp6[1]),true,(τp9=τp6[2]),(τp10=τ1095(aslist)(τp9)),τp10[0])&&((new_tests=τp10[1]),true)))))))))))))))){var labv=gensym();stmts.push(["multi",["send",["symbol","="],["data",labv,["send",["symbol","++"],["data",label,["send",["send",["symbol","!"],["data",["symbol","Array"],["void"]]],new_label]]]]],τ590(["multi"],blocktest_mac(labv,new_tests,acc))]);}else{if((τ1069&&(((τp5=τp2[1]),(τp5==="each"))&&(((τp6=τ1061[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((sources=τp6[1]),true,(τp9=τp6[2]),(τp10=τ1095(aslist)(τp9)),τp10[0])&&((clauses=τp10[1]),true))))))))){var loopvar=gensym();(clauses=function(){var τ1070=[];var τ1071=clauses;var τ1072=τ1071.length;for(var τ1073=0;(τ1073<τ1072);(τ1073++)){var τ1074=τ1071[τ1073];var clause;var other;if(((clause=τ1074),true)){τ1070.push(function(){var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var lhs;var rhs;if(((clause instanceof Array)&&(((τp0=clause.length),true)&&((τp0===3)&&(((τp1=clause[0]),(τp1==="send"))&&(((τp2=clause[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="->"))&&(((τp6=clause[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&((lhs=τp6[1]),true,(rhs=τp6[2]),true))))))))))))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",40507,40544]}));}var x=blocktest_mac(["send",["symbol","++"],["data",label,["data",loopvar]]],τ1095(aslist)(rhs)[1],acc);return ["send",["symbol","->"],["data",lhs,τ590(["multi"],x)]];}());}else{if(((other=τ1074),true)){false;}else{throw ["Could not find a match",τ1074];}}}return τ1070;}());clauses.push(["send",["symbol","->"],["data",["symbol","__no"],["send",["send",acc,["send",["symbol","."],["data",["void"],["symbol","push"]]]],["data",["send",["send",["symbol","#"],["data",["void"],["symbol","error"]]],["data",label,["value","No handler for test case"],["symbol","__no"]]]]]]]);stmts.push(build_each(sources,τ590(["multi"],clauses),["multi"],["multi"],loopvar));}else{if(((expr=τ1061),true)){stmts.push(["send",["symbol","if"],["data",ok,["multi",["send",["symbol","then"],["data",blocktest_wrap(label,expr,acc)]],["send",["symbol","else"],["data",["send",["send",acc,["send",["symbol","."],["data",["void"],["symbol","push"]]]],["data",["send",["send",["symbol","#"],["data",["void"],["symbol","aborted"]]],["data",label,["send",["symbol","'"],["data",["void"],expr]]]]]]]]]]]);}else{if(((other=τ1061),true)){false;}else{throw ["Could not find a match",τ1061];}}}}}}false;stmts.push(acc);return stmts;};stdenv.register_macro("blocktest",function(τ1075,τ1076){var τp0;var context;var env;if(((τ1075 instanceof Array)&&(((τp0=τ1075.length),true)&&((τp0===2)&&((context=τ1075[0]),true,(env=τ1075[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var args;if(((τ1076 instanceof Array)&&(((τp0=τ1076.length),true)&&((τp0>=1)&&(((τp1=τ1076[0]),(τp1==="data"))&&((args=τ1076.slice(1)),true)))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var acc=gensym();var labv=gensym();var stmts=["multi",["send",["symbol","="],["data",acc,["data"]]]];var rval=function(){var τ1077=args;var τp0;var τp1;var τp2;var tests;var τp0;var labels;var τp1;var τp2;var tests;var τ1078=false;var τ1079=false;if(((τ1078=(τ1077 instanceof Array))&&((τ1079=((τp0=τ1077.length),true))&&((τp0===1)&&(((τp1=τ1077[0]),(τp2=τ1095(aslist)(τp1)),τp2[0])&&((tests=τp2[1]),true)))))){stmts.push(["send",["symbol","="],["data",labv,["data"]]]);return (stmts=stmts.concat(blocktest_mac(labv,tests,acc)));}else{if((τ1079&&((τp0===2)&&(((labels=τ1077[0]),true,(τp1=τ1077[1]),(τp2=τ1095(aslist)(τp1)),τp2[0])&&((tests=τp2[1]),true))))){stmts.push(["send",["symbol","="],["data",labv,["send",["send",["symbol","!"],["data",["symbol","Array"],["void"]]],labels]]]);return (stmts=stmts.concat(blocktest_mac(labv,tests,acc)));}else{throw ["Could not find a match",τ1077];}}}();return rval;});stdenv.register_macro("macro",function(τ1080,expr){var τp0;var context;var env;if(((τ1080 instanceof Array)&&(((τp0=τ1080.length),true)&&((τp0===2)&&((context=τ1080[0]),true,(env=τ1080[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var name;var τp6;var τp7;var sname;var args;var body;if(((expr instanceof Array)&&(((τp0=expr.length),true)&&((τp0===3)&&(((τp1=expr[0]),(τp1==="data"))&&(((τp2=expr[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="send"))&&(((τp5=τp2[1]),(name=τp5),true,(τp5 instanceof Array))&&(((τp6=τp5.length),true)&&((τp6===2)&&(((τp7=τp5[0]),(τp7==="symbol"))&&((sname=τp5[1]),true,(args=τp2[2]),true,(body=expr[2]),true)))))))))))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",41754,41803]}));}var fn=["send",["symbol","->"],["data",args,body]];var code=generate_from_ast(fn);var efn=eval((("("+code.slice(0,(-1)))+")"));env.register_macro(sname,efn);return ["value",undefined];});stdenv.register_macro("match",function(τ1082,τ1081){var τp0;var context;var env;if(((τ1082 instanceof Array)&&(((τp0=τ1082.length),true)&&((τp0===2)&&((context=τ1082[0]),true,(env=τ1082[1]),true))))){undefined;}else{throw τ1086(τ1087(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ1083=τ1081;var τp0;var τp1;var τp0;var τp1;var obj;var clauses;var τp0;var τp1;var clauses;var τ1084=false;var τ1085=false;if(((τ1084=(τ1083 instanceof Array))&&((τ1085=((τp0=τ1083.length),true))&&((τp0===1)&&((τp1=τ1083[0]),(τp1==="void")))))){return ["placeholder"];}else{if((τ1085&&((τp0===3)&&(((τp1=τ1083[0]),(τp1==="data"))&&((obj=τ1083[1]),true,(clauses=τ1083[2]),true))))){return ["send",["symbol","|>"],["data",obj,clauses]];}else{if((τ1085&&((τp0===2)&&(((τp1=τ1083[0]),(τp1==="data"))&&((clauses=τ1083[1]),true))))){return ["send",["symbol","|>"],["data",["value",null],clauses]];}else{throw ["Could not find a match",τ1083];}}}});var stdprelude=Embedded(["multi",["send",["symbol","="],["data",["send",["symbol","send"],["data",["symbol","obj"],["send",["symbol","and"],["data",["symbol","msg"],["symbol","match"]]]]],["multi",["send",["symbol","->"],["data",["send",["symbol","or"],["data",["send",["symbol","?"],["data",["symbol","String"],["void"]]],["send",["symbol","?"],["data",["symbol","Number"],["void"]]]]],["send",["symbol","___js_fetch"],["data",["symbol","obj"],["symbol","msg"]]]]],["send",["symbol","->"],["data",["symbol","other"],["send",["send",["symbol","obj"],["value","::send"]],["data",["symbol","msg"]]]]]]]],["send",["symbol",":="],["data",["send",["symbol","Array"],["value",":::project"]],["send",["symbol","->"],["data",["data",["send",["symbol","and"],["data",["symbol","value"],["symbol","match"]]]],["multi",["send",["symbol","->"],["data",["send",["symbol","?"],["data",["symbol","Array"],["void"]]],["data",["symbol","true"],["symbol","value"]]]],["send",["symbol","->"],["data",["symbol","_"],["data",["symbol","true"],["data",["symbol","value"]]]]]]]]]],["send",["symbol",":="],["data",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["value","::check"]],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["symbol","if"],["data",["send",["symbol","instanceof"],["data",["symbol","value"],["symbol","Array"]]],["multi",["send",["symbol","then"],["data",["multi",["send",["symbol","for"],["data",["multi",["send",["symbol","="],["data",["symbol","i"],["value",0]]],["send",["symbol","<"],["data",["symbol","i"],["send",["symbol","this"],["send",["symbol","."],["data",["void"],["symbol","length"]]]]]],["send",["symbol","++"],["data",["symbol","i"],["void"]]]],["send",["symbol","if"],["data",["send",["symbol","!="],["data",["send",["symbol","this"],["symbol","i"]],["send",["symbol","value"],["symbol","i"]]]],["send",["symbol","return"],["symbol","false"]]]]]],["symbol","true"]]]],["send",["symbol","else"],["data",["symbol","false"]]]]]]]]]],["send",["symbol",":="],["data",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["value",":::project"]],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["symbol","if"],["data",["send",["symbol","instanceof"],["data",["symbol","value"],["symbol","Array"]]],["multi",["send",["symbol","then"],["data",["multi",["send",["symbol","for"],["data",["multi",["send",["symbol","="],["data",["symbol","i"],["value",0]]],["send",["symbol","<"],["data",["symbol","i"],["send",["symbol","this"],["send",["symbol","."],["data",["void"],["symbol","length"]]]]]],["send",["symbol","++"],["data",["symbol","i"],["void"]]]],["send",["symbol","if"],["data",["send",["symbol","!="],["data",["send",["symbol","this"],["symbol","i"]],["send",["symbol","value"],["symbol","i"]]]],["multi",["send",["symbol","="],["data",["symbol","rval"],["send",["send",["symbol","this"],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["data",["value",0]]]]],["send",["send",["symbol","rval"],["send",["symbol","."],["data",["void"],["symbol","push"]]]],["data",["symbol","value"]]],["send",["symbol","return"],["data",["symbol","true"],["symbol","rval"]]]]]]]],["data",["symbol","true"],["symbol","value"]]]]],["send",["symbol","else"],["data",["multi",["send",["symbol","="],["data",["symbol","rval"],["send",["send",["symbol","this"],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["data",["value",0]]]]],["send",["send",["symbol","rval"],["send",["symbol","."],["data",["void"],["symbol","push"]]]],["data",["symbol","value"]]],["data",["symbol","true"],["symbol","rval"]]]]]]]]]]]],["send",["symbol",":="],["data",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["value",":::deconstruct"]],["send",["symbol","->"],["data",["data",["symbol","value"]],["data",["symbol","true"],["send",["send",["symbol","value"],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["data",["send",["symbol","this"],["send",["symbol","."],["data",["void"],["symbol","length"]]]]]]]]]]],["send",["symbol",":="],["data",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["value","::serialize_ast"]],["send",["symbol","->"],["data",["data"],["send",["send",["symbol","#"],["data",["void"],["symbol","array"]]],["data",["send",["symbol","*"],["data",["void"],["send",["send",["symbol","this"],["send",["symbol","."],["data",["void"],["symbol","map"]]]],["data",["symbol","___serialize_ast"]]]]]]]]]]],["send",["symbol",":="],["data",["send",["send",["symbol","RegExp"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["value","::check"]],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["send",["symbol","value"],["send",["symbol","."],["data",["void"],["symbol","match"]]]],["data",["symbol","this"]]]]]]],["send",["symbol",":="],["data",["send",["send",["symbol","RegExp"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["value",":::project"]],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["symbol","match"],["data",["send",["send",["symbol","value"],["send",["symbol","."],["data",["void"],["symbol","match"]]]],["data",["symbol","this"]]],["multi",["send",["symbol","->"],["data",["send",["send",["symbol","?"],["data",["symbol","null"],["void"]]],["symbol","m"]],["data",["symbol","false"],["symbol","null"]]]],["send",["symbol","->"],["data",["symbol","m"],["data",["symbol","true"],["symbol","m"]]]]]]]]]]],["send",["symbol",":="],["data",["send",["send",["symbol","RegExp"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["value",":::deconstruct"]],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["symbol","match"],["data",["send",["send",["symbol","value"],["send",["symbol","."],["data",["void"],["symbol","match"]]]],["data",["symbol","this"]]],["multi",["send",["symbol","->"],["data",["send",["send",["symbol","?"],["data",["symbol","null"],["void"]]],["symbol","m"]],["data",["symbol","false"],["symbol","null"]]]],["send",["symbol","->"],["data",["symbol","m"],["data",["symbol","true"],["symbol","m"]]]]]]]]]]],["send",["symbol",":="],["data",["send",["send",["symbol","Function"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["value","::send"]],["send",["symbol","->"],["data",["data",["symbol","args"]],["send",["send",["symbol","this"],["send",["symbol","."],["data",["void"],["symbol","apply"]]]],["data",["symbol","this"],["symbol","args"]]]]]]]]);(exports["stdenv"]=stdenv);(exports["stdprelude"]=stdprelude);
