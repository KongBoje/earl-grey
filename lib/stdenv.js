var τ593=function(type){var τ594=type["::check"];var f;if((τ594===(void 0))){return function(value){return (value instanceof type);};}else{if(((f=τ594),true)){return function(value){return f.call(type,value);};}else{throw ["Could not find a match",τ594];}}};
var τ595=function(){var r=[];for(var i=0;(i<arguments.length);(i++)){(r=r.concat(arguments[i]));}return r;};
var τ596=function(τ597){var τ598=τ597;var x;var x;var other;if((((typeof(τ598)==="string")&&((x=τ598),true))||((typeof(τ598)==="number")&&((x=τ598),true)))){return ["value",x];}else{if(((other=τ598),true)){return other["::serialize_ast"]();}else{throw ["Could not find a match",τ598];}}};
var send=function(obj,τ586){var msg;var τ585;(msg=τ586);true;(τ585=τ586);var τ587=τ585;var other;if(((typeof(τ587)==="string")||(typeof(τ587)==="number"))){return obj[msg];}else{if(((other=τ587),true)){return obj["::send"](msg);}else{throw ["Could not find a match",τ587];}}};(Array[":::project"]=function(τ589){var value;var τ588;(value=τ589);true;(τ588=τ589);var τ590=τ588;var _;if(τ593(Array)(τ590)){return [true,value];}else{if(((_=τ590),true)){return [true,[value]];}else{throw ["Could not find a match",τ590];}}});(Array.prototype["::check"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){return false;}else{null;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){var rval=this.slice(0);rval.push(value);return [true,rval];}else{null;}}return [true,value];}else{var rval=this.slice(0);rval.push(value);return [true,rval];}});(Array.prototype[":::deconstruct"]=function(value){return [true,value.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return τ595(["array"],this.map(τ596));});(RegExp.prototype["::check"]=function(value){return value.match(this);});(RegExp.prototype[":::project"]=function(value){var τ591=value.match(this);var m;var m;if(((τ591===null)&&((m=τ591),true))){return [false,null];}else{if(((m=τ591),true)){return [true,m];}else{throw ["Could not find a match",τ591];}}});(RegExp.prototype[":::deconstruct"]=function(value){var τ592=value.match(this);var m;var m;if(((τ592===null)&&((m=τ592),true))){return [false,null];}else{if(((m=τ592),true)){return [true,m];}else{throw ["Could not find a match",τ592];}}});(Function.prototype["::send"]=function(args){return this.apply(this,args);});
var τ1091=function(dest,values){for(k in values){if(values.hasOwnProperty(k)){(dest[k]=send(values,k));}else{null;}}return dest;};
var τ1092=function(){var τ1093=function(tags){var τ1094=function(){if((!τ593(τ1093)(this))){return Object.create(τ1093.prototype);}else{return this;}}();(τ1094["tags"]=tags);return τ1094;};τ1091(τ1093);(τ1093.prototype["create"]=function(){var τ1095=Array.prototype.slice.call(arguments,0);var τp0;var message;var args;if(((τ1095 instanceof Array)&&(((τp0=τ1095.length),true)&&((τp0>=0)&&((message=function(){if((0>=τp0)){return "";}else{return τ1095[0];}}()),true,(args=τ1095.slice(1)),true))))){var τ1094=this;var e=Error(message);(e["::tags"]=τ1094.tags);(e["args"]=args);(e["name"]=["E"].concat(τ1094.tags).join("."));return e;}else{throw ["Could not find a match",τ1095];}});(τ1093.prototype["::check"]=function(e){var τ1094=this;if(((!e)||(!τ593(Error)(e)))){return false;}else{null;}var tags=(e["::tags"]||[]);var τ1096=τ1094.tags;var τ1097=τ1096.length;for(var τ1098=0;(τ1098<τ1097);(τ1098++)){var τ1099=τ1096[τ1098];var tag;var other;if(((tag=τ1099),true,(tags.indexOf(tag)===(-1)))){return false;}else{if(((other=τ1099),true)){false;}else{throw ["Could not find a match",τ1099];}}}false;return true;});(τ1093.prototype["::deconstruct"]=function(e){var τ1094=this;return e.args;});return τ1093;}();
var τ1100=function(type){return function(value){var τ1101=type[":::project"];var f;if((τ1101===(void 0))){var τ1102=type["::project"];var f;if((τ1102===(void 0))){return [true,type(value)];}else{if(((f=τ1102),true)){var τ1104;try{(τ1104=[true,f(value)]);}catch(τ1103){(τ1104=[false,null]);}return τ1104;}else{throw ["Could not find a match",τ1102];}}}else{if(((f=τ1101),true)){return f.call(type,value);}else{throw ["Could not find a match",τ1101];}}};};
var τ1105=function(from,to){var rval=[];for(var i=from;(i<=to);(i++)){rval.push(i);}return rval;};var τ599=require("./expand");var Env=τ599.Env;var nullenv=τ599.nullenv;var expand=τ599.expand;var τ600=require("./helpers");var aslist=τ600.aslist;var transform=τ600.transform;var gensym=τ600.gensym;var gensym_factory=τ600.gensym_factory;var τ601=require("./util");var enumerate=τ601.enumerate;var items=τ601.items;var uuid=function(){var τp0;var τp1;var τp2;var s;if((((τp0=gensym()),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="symbol"))&&((s=τp0[1]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",204,214]}));}return s;};var Embedded=function(code){var τ602=function(){if((!τ593(Embedded)(this))){return Object.create(Embedded.prototype);}else{return this;}}();(τ602["code"]=code);(τ602["::id"]=uuid());return τ602;};τ1091(Embedded);(Embedded.prototype["::serialize_ast"]=function(){var τ602=this;return expand(["top",stdenv],τ602.code);});Embedded;var stdenv=Env(nullenv);var τ603=items(({"+":"___plus","-":"___minus","*":"___times","/":"___div","mod":"___mod","^":"___binxor","&":"___binand","|":"___binor","&&":"___and","||":"___or","and":"___and","or":"___or","not":"___not","===":"___is","!==":"___isnt","!=":"___neq","<":"___lt",">":"___gt","<=":"___lte",">=":"___gte","<<":"___shl",">>":"___shr",">>>":"___shr2","in":"___in","instanceof":"___instanceof","--":"___minusminus"}));var τ604=τ603.length;for(var τ605=0;(τ605<τ604);(τ605++)){var τ606=τ603[τ605];var τp0;var k;var v;var other;if(((τ606 instanceof Array)&&(((τp0=τ606.length),true)&&((τp0===2)&&((k=τ606[0]),true,(v=τ606[1]),true))))){stdenv.register(k,["symbol",v]);}else{if(((other=τ606),true)){false;}else{throw ["Could not find a match",τ606];}}}false;stdenv.register("___hasprop",["value",Embedded(["send",["symbol","->"],["data",["data",["symbol","match"],["symbol","key"]],["multi",["send",["symbol","->"],["data",["send",["symbol","or"],["data",["send",["symbol","?"],["data",["symbol","null"],["void"]]],["send",["symbol","?"],["data",["symbol","undefined"],["void"]]]]],["symbol","false"]]],["send",["symbol","->"],["data",["send",["send",["symbol","?"],["data",["symbol","String"],["void"]]],["symbol","x"]],["send",["symbol","in"],["data",["symbol","key"],["send",["symbol","String"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]]]]]],["send",["symbol","->"],["data",["send",["send",["symbol","?"],["data",["symbol","Number"],["void"]]],["symbol","x"]],["send",["symbol","in"],["data",["symbol","key"],["send",["symbol","Number"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]]]]]],["send",["symbol","->"],["data",["symbol","x"],["send",["symbol","in"],["data",["symbol","key"],["symbol","x"]]]]]]]])]);stdenv.register("___projector",["value",Embedded(["send",["symbol","->"],["data",["data",["symbol","type"]],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["symbol","match"],["data",["send",["symbol","type"],["value",":::project"]],["multi",["send",["symbol","->"],["data",["send",["symbol","?"],["data",["symbol","undefined"],["void"]]],["send",["symbol","match"],["data",["send",["symbol","type"],["value","::project"]],["multi",["send",["symbol","->"],["data",["send",["symbol","?"],["data",["symbol","undefined"],["void"]]],["data",["symbol","true"],["send",["symbol","type"],["data",["symbol","value"]]]]]],["send",["symbol","->"],["data",["symbol","f"],["send",["symbol","!!"],["data",["data",["symbol","true"],["send",["symbol","f"],["data",["symbol","value"]]]],["data",["symbol","false"],["symbol","null"]]]]]]]]]]],["send",["symbol","->"],["data",["symbol","f"],["send",["send",["symbol","f"],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",["symbol","type"],["symbol","value"]]]]]]]]]]]])]);stdenv.register("___checker",["value",Embedded(["send",["symbol","->"],["data",["data",["symbol","type"]],["send",["symbol","match"],["data",["send",["symbol","type"],["value","::check"]],["multi",["send",["symbol","->"],["data",["send",["symbol","?"],["data",["symbol","undefined"],["void"]]],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["symbol","instanceof"],["data",["symbol","value"],["symbol","type"]]]]]]],["send",["symbol","->"],["data",["symbol","f"],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["send",["symbol","f"],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",["symbol","type"],["symbol","value"]]]]]]]]]]]])]);stdenv.register("___deconstructor",["value",Embedded(["send",["symbol","->"],["data",["data",["symbol","type"]],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["symbol","match"],["data",["send",["symbol","type"],["value",":::deconstruct"]],["multi",["send",["symbol","->"],["data",["send",["symbol","?"],["data",["symbol","undefined"],["void"]]],["send",["symbol","match"],["data",["send",["symbol","type"],["value","::deconstruct"]],["multi",["send",["symbol","->"],["data",["send",["symbol","?"],["data",["symbol","undefined"],["void"]]],["send",["symbol","?"],["data",["void"],["multi",["send",["symbol","=>"],["data",["send",["symbol","instanceof"],["data",["symbol","value"],["symbol","Array"]]],["data",["symbol","true"],["symbol","value"]]]],["send",["symbol","=>"],["data",["symbol","else"],["data",["symbol","false"],["symbol","null"]]]]]]]]],["send",["symbol","->"],["data",["symbol","f"],["send",["symbol","!!"],["data",["data",["symbol","true"],["send",["send",["symbol","f"],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",["symbol","type"],["symbol","value"]]]],["data",["symbol","false"],["symbol","null"]]]]]]]]]]],["send",["symbol","->"],["data",["symbol","f"],["send",["send",["symbol","f"],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",["symbol","type"],["symbol","value"]]]]]]]]]]]])]);stdenv.register("___serialize_ast",["value",Embedded(["send",["symbol","->"],["data",["data",["symbol","match"]],["multi",["send",["symbol","->"],["data",["send",["symbol","or"],["data",["send",["send",["symbol","?"],["data",["symbol","String"],["void"]]],["symbol","x"]],["send",["send",["symbol","?"],["data",["symbol","Number"],["void"]]],["symbol","x"]]]],["send",["send",["symbol","#"],["data",["void"],["symbol","value"]]],["data",["symbol","x"]]]]],["send",["symbol","->"],["data",["symbol","other"],["send",["send",["symbol","other"],["value","::serialize_ast"]],["data"]]]]]]])]);stdenv.register("ErrorFactory",["value",Embedded(["send",["symbol","class"],["data",["multi",["send",["symbol","="],["data",["send",["symbol","constructor"],["data",["symbol","tags"]]],["send",["symbol",":="],["data",["send",["symbol","@"],["data",["void"],["symbol","tags"]]],["symbol","tags"]]]]],["send",["symbol","="],["data",["send",["symbol","create"],["data",["send",["symbol","="],["data",["symbol","message"],["value",""]]],["send",["symbol","*"],["data",["void"],["symbol","args"]]]]],["multi",["send",["symbol","="],["data",["symbol","e"],["send",["symbol","Error"],["data",["symbol","message"]]]]],["send",["symbol",":="],["data",["send",["symbol","e"],["value","::tags"]],["send",["symbol","@"],["data",["void"],["symbol","tags"]]]]],["send",["symbol",":="],["data",["send",["symbol","e"],["send",["symbol","."],["data",["void"],["symbol","args"]]]],["symbol","args"]]],["send",["symbol",":="],["data",["send",["symbol","e"],["send",["symbol","."],["data",["void"],["symbol","name"]]]],["send",["send",["send",["symbol","++"],["data",["data",["send",["symbol","."],["data",["void"],["symbol","E"]]]],["send",["symbol","@"],["data",["void"],["symbol","tags"]]]]],["send",["symbol","."],["data",["void"],["symbol","join"]]]],["data",["value","."]]]]],["symbol","e"]]]],["send",["symbol","="],["data",["send",["value","::check"],["data",["symbol","e"]]],["multi",["send",["symbol","if"],["data",["send",["symbol","or"],["data",["send",["symbol","not"],["data",["void"],["symbol","e"]]],["send",["symbol","not"],["data",["void"],["send",["send",["symbol","?"],["data",["symbol","Error"],["void"]]],["symbol","e"]]]]]],["send",["symbol","return"],["symbol","false"]]]],["send",["symbol","="],["data",["symbol","tags"],["send",["symbol","or"],["data",["send",["symbol","e"],["value","::tags"]],["data"]]]]],["send",["symbol","each"],["data",["send",["symbol","@"],["data",["void"],["symbol","tags"]]],["send",["symbol","->"],["data",["send",["symbol","when"],["data",["symbol","tag"],["send",["symbol","=="],["data",["send",["send",["symbol","tags"],["send",["symbol","."],["data",["void"],["symbol","indexOf"]]]],["data",["symbol","tag"]]],["send",["symbol","-"],["data",["void"],["value",1]]]]]]],["send",["symbol","return"],["symbol","false"]]]]]],["symbol","true"]]]],["send",["symbol","="],["data",["send",["value","::deconstruct"],["data",["symbol","e"]]],["send",["symbol","e"],["send",["symbol","."],["data",["void"],["symbol","args"]]]]]]]]])]);stdenv.register("patch_array",["value",Embedded(["send",["symbol","->"],["data",["data"],["multi",["send",["symbol","="],["data",["symbol","r"],["data"]]],["send",["symbol","for"],["data",["multi",["send",["symbol","="],["data",["symbol","i"],["value",0]]],["send",["symbol","<"],["data",["symbol","i"],["send",["symbol","arguments"],["send",["symbol","."],["data",["void"],["symbol","length"]]]]]],["send",["symbol","++"],["data",["symbol","i"],["void"]]]],["send",["symbol",":="],["data",["symbol","r"],["send",["send",["symbol","r"],["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",["send",["symbol","___js_fetch"],["data",["symbol","arguments"],["symbol","i"]]]]]]]]],["symbol","r"]]]])]);stdenv.register("range",["value",Embedded(["send",["symbol","->"],["data",["data",["symbol","from"],["symbol","to"]],["multi",["send",["symbol","="],["data",["symbol","rval"],["data"]]],["send",["symbol","for"],["data",["multi",["send",["symbol","="],["data",["symbol","i"],["symbol","from"]]],["send",["symbol","<="],["data",["symbol","i"],["symbol","to"]]],["send",["symbol","++"],["data",["symbol","i"],["void"]]]],["send",["send",["symbol","rval"],["send",["symbol","."],["data",["void"],["symbol","push"]]]],["data",["symbol","i"]]]]],["symbol","rval"]]]])]);stdenv.register("&:",["value",Embedded(["send",["symbol","->"],["data",["data",["symbol","dest"],["symbol","values"]],["multi",["send",["symbol","for"],["data",["send",["symbol","in"],["data",["symbol","k"],["symbol","values"]]],["send",["symbol","if"],["data",["send",["send",["symbol","values"],["send",["symbol","."],["data",["void"],["symbol","hasOwnProperty"]]]],["data",["symbol","k"]]],["send",["symbol",":="],["data",["send",["symbol","dest"],["symbol","k"]],["send",["symbol","values"],["symbol","k"]]]]]]]],["symbol","dest"]]]])]);stdenv.register_macro("++",function(_,τ607){var τ608=τ607;var τp0;var τp1;var τp2;var τp3;var τp4;var x;var τp0;var τp1;var x;var τp2;var τp3;var τp4;var τp0;var τp1;var x;var y;var τp0;var τp1;var τ609=false;var τ610=false;var τ611=false;var τ612=false;if(((τ609=(τ608 instanceof Array))&&((τ610=((τp0=τ608.length),true))&&((τ611=(τp0===3))&&((τ612=((τp1=τ608[0]),(τp1==="data")))&&(((τp2=τ608[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&(((τp4=τp2[0]),(τp4==="void"))&&((x=τ608[2]),true)))))))))){return ["send",["symbol","___plusplus"],["data",["void"],x]];}else{if((τ612&&(((x=τ608[1]),true,(τp2=τ608[2]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&((τp4=τp2[0]),(τp4==="void"))))))){return ["send",["symbol","___plusplus"],["data",x,["void"]]];}else{if((τ612&&((x=τ608[1]),true,(y=τ608[2]),true))){return ["send",["send",x,["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",y]];}else{if((τ610&&((τp0===1)&&((τp1=τ608[0]),(τp1==="void"))))){return ["send",["symbol","->"],["data",["data",["symbol","x"],["symbol","y"]],["send",["send",["symbol","x"],["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",["symbol","y"]]]]];}else{throw ["Could not find a match",τ608];}}}}});stdenv.register_macro("..",function(_,τ613){var τ614=τ613;var τp0;var τp1;var τp2;var τp3;var τp4;var x;var τp0;var τp1;var x;var τp2;var τp3;var τp4;var τp0;var τp1;var x;var y;var τp0;var τp1;var τ615=false;var τ616=false;var τ617=false;var τ618=false;if(((τ615=(τ614 instanceof Array))&&((τ616=((τp0=τ614.length),true))&&((τ617=(τp0===3))&&((τ618=((τp1=τ614[0]),(τp1==="data")))&&(((τp2=τ614[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&(((τp4=τp2[0]),(τp4==="void"))&&((x=τ614[2]),true)))))))))){return ["send",["symbol","range"],["data",["value",1],x]];}else{if((τ618&&(((x=τ614[1]),true,(τp2=τ614[2]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&((τp4=τp2[0]),(τp4==="void"))))))){return ["send",["symbol","range"],["data",x]];}else{if((τ618&&((x=τ614[1]),true,(y=τ614[2]),true))){return ["send",["symbol","range"],["data",x,y]];}else{if((τ616&&((τp0===1)&&((τp1=τ614[0]),(τp1==="void"))))){return ["symbol","range"];}else{throw ["Could not find a match",τ614];}}}}});var make_checker=function(value,op){return function(τ619,τ620){var τp0;var context;var env;if(((τ619 instanceof Array)&&(((τp0=τ619.length),true)&&((τp0===2)&&((context=τ619[0]),true,(env=τ619[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var expr;if(((τ620 instanceof Array)&&(((τp0=τ620.length),true)&&((τp0===2)&&(((τp1=τ620[0]),(τp1==="data"))&&((expr=τ620[1]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["send",op,["data",expr,value]];};};stdenv.register_macro("**",function(τ621,τ622){var τp0;var context;var env;if(((τ621 instanceof Array)&&(((τp0=τ621.length),true)&&((τp0===2)&&((context=τ621[0]),true,(env=τ621[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var a;var b;if(((τ622 instanceof Array)&&(((τp0=τ622.length),true)&&((τp0===3)&&(((τp1=τ622[0]),(τp1==="data"))&&((a=τ622[1]),true,(b=τ622[2]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["send",["send",["symbol","Math"],["send",["symbol","."],["data",["void"],["symbol","pow"]]]],["data",a,b]];});stdenv.register_macro("//",function(τ623,τ624){var τp0;var context;var env;if(((τ623 instanceof Array)&&(((τp0=τ623.length),true)&&((τp0===2)&&((context=τ623[0]),true,(env=τ623[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var a;var b;if(((τ624 instanceof Array)&&(((τp0=τ624.length),true)&&((τp0===3)&&(((τp1=τ624[0]),(τp1==="data"))&&((a=τ624[1]),true,(b=τ624[2]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["send",["send",["symbol","Math"],["send",["symbol","."],["data",["void"],["symbol","floor"]]]],["data",["send",["symbol","/"],["data",a,b]]]];});var errf_macro=function(tags){return function(τ626,τ625){var τp0;var context;var env;if(((τ626 instanceof Array)&&(((τp0=τ626.length),true)&&((τp0===2)&&((context=τ626[0]),true,(env=τ626[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ627=τ625;var τp0;var τp1;var τp0;var τp1;var args;var other;var τ628=false;var τ629=false;if(((τ628=(τ627 instanceof Array))&&((τ629=((τp0=τ627.length),true))&&((τp0===1)&&((τp1=τ627[0]),(τp1==="void")))))){return ["send",["symbol","ErrorFactory"],["data",τ595(["data"],tags)]];}else{if((τ629&&((τp0>=1)&&(((τp1=τ627[0]),(τp1==="data"))&&((args=τ627.slice(1)),true))))){return ["send",["send",["send",["symbol","ErrorFactory"],["data",τ595(["data"],tags)]],["send",["symbol","."],["data",["void"],["symbol","create"]]]],τ595(["data"],args)];}else{if(((other=τ627),true)){return ["macro",errf_macro(tags.concat([other]))];}else{throw ["Could not find a match",τ627];}}}};};stdenv.register_macro("E",errf_macro([]));stdenv.register_macro("#",function(τ630,τ631){var τp0;var context;var env;if(((τ630 instanceof Array)&&(((τp0=τ630.length),true)&&((τp0===2)&&((context=τ630[0]),true,(env=τ630[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var tag;if(((τ631 instanceof Array)&&(((τp0=τ631.length),true)&&((τp0===3)&&(((τp1=τ631[0]),(τp1==="data"))&&(((τp2=τ631[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&(((τp4=τp2[0]),(τp4==="void"))&&(((τp5=τ631[2]),(τp5 instanceof Array))&&(((τp6=τp5.length),true)&&((τp6===2)&&(((τp7=τp5[0]),(τp7==="symbol"))&&((tag=τp5[1]),true)))))))))))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}(tag=["value",tag]);var f=function(τ633,expr){var τp0;var τ632;var env;if(((τ633 instanceof Array)&&(((τp0=τ633.length),true)&&((τp0===2)&&((τ632=τ633[0]),true,(env=τ633[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ634=τ632;var _;if((τ634==="pattern")){var checker_mac=function(){var f1=function(_,τ638){var τp0;var τp1;var expr;if(((τ638 instanceof Array)&&(((τp0=τ638.length),true)&&((τp0===2)&&(((τp1=τ638[0]),(τp1==="data"))&&((expr=τ638[1]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["send",["symbol","instanceof"],["data",expr,["symbol","Array"]]];};var f2=function(_,τ639){var τp0;var τp1;var expr;if(((τ639 instanceof Array)&&(((τp0=τ639.length),true)&&((τp0===2)&&(((τp1=τ639[0]),(τp1==="data"))&&((expr=τ639[1]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["send",["symbol","=="],["data",["send",expr,["value",0]],tag]];};return ["multi",["macro",f1],["macro",f2]];}();var τ635=expr;var τp0;var τp1;var subp;var τp0;var τp1;var other;var τ636=false;var τ637=false;if(((τ636=(τ635 instanceof Array))&&((τ637=((τp0=τ635.length),true))&&((τp0>=1)&&(((τp1=τ635[0]),(τp1==="data"))&&((subp=τ635.slice(1)),true)))))){return τ595(["data",tag],subp);}else{if((τ637&&((τp0===1)&&((τp1=τ635[0]),(τp1==="void"))))){return ["check",checker_mac,["ignore"]];}else{if(((other=τ635),true)){return ["check",checker_mac,expr];}else{throw ["Could not find a match",τ635];}}}}else{if(((_=τ634),true)){var τ640=expr;var τp0;var τp1;var τp0;var τp1;var args;var other;var τ641=false;var τ642=false;if(((τ641=(τ640 instanceof Array))&&((τ642=((τp0=τ640.length),true))&&((τp0===1)&&((τp1=τ640[0]),(τp1==="void")))))){return ["data",tag];}else{if((τ642&&((τp0>=1)&&(((τp1=τ640[0]),(τp1==="data"))&&((args=τ640.slice(1)),true))))){return τ595(["data",tag],args);}else{if(((other=τ640),true)){return ["send",["data",tag],other];}else{throw ["Could not find a match",τ640];}}}}else{throw ["Could not find a match",τ634];}}};return ["macro",f];});stdenv.register_macro("when",function(τ644,τ645){var τp0;var context;var env;if(((τ644 instanceof Array)&&(((τp0=τ644.length),true)&&((τp0===2)&&((context=τ644[0]),true,(env=τ644[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var τ643;var condition;if(((τ645 instanceof Array)&&(((τp0=τ645.length),true)&&((τp0===3)&&(((τp1=τ645[0]),(τp1==="data"))&&((τ643=τ645[1]),true,(condition=τ645[2]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ646=τ643;var τp0;var τp1;var other;if(((τ646 instanceof Array)&&(((τp0=τ646.length),true)&&((τp0===1)&&((τp1=τ646[0]),(τp1==="void")))))){return ["test",condition,["ignore"]];}else{if(((other=τ646),true)){return ["test",condition,other];}else{throw ["Could not find a match",τ646];}}});var andf=function(τ647,expr){var τp0;var context;var env;if(((τ647 instanceof Array)&&(((τp0=τ647.length),true)&&((τp0===2)&&((context=τ647[0]),true,(env=τ647[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ648=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var a;var b;var τp0;var _;var τp1;var τp2;var τp3;var other;var τ649=false;var τ650=false;var τ651=false;if(((τ649=(τ648 instanceof Array))&&((τ650=((τp0=τ648.length),true))&&((τ651=(τp0===2))&&(((τp1=τ648[0]),(τp1==="pattern"))&&(((τp2=τ648[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((a=τp2[1]),true,(b=τp2[2]),true)))))))))){return ["all",a,b];}else{if((τ651&&(((_=τ648[0]),true,(τp1=τ648[1]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===1)&&((τp3=τp1[0]),(τp3==="void"))))))){return ["symbol","___and"];}else{if(((other=τ648),true)){return ["send",["symbol","___and"],expr];}else{throw ["Could not find a match",τ648];}}}};stdenv.register_macro("&&",andf);stdenv.register_macro("and",andf);var orf=function(τ652,expr){var τp0;var context;var env;if(((τ652 instanceof Array)&&(((τp0=τ652.length),true)&&((τp0===2)&&((context=τ652[0]),true,(env=τ652[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ653=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var a;var b;var τp0;var _;var τp1;var τp2;var τp3;var other;var τ654=false;var τ655=false;var τ656=false;if(((τ654=(τ653 instanceof Array))&&((τ655=((τp0=τ653.length),true))&&((τ656=(τp0===2))&&(((τp1=τ653[0]),(τp1==="pattern"))&&(((τp2=τ653[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((a=τp2[1]),true,(b=τp2[2]),true)))))))))){return ["any",a,b];}else{if((τ656&&(((_=τ653[0]),true,(τp1=τ653[1]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===1)&&((τp3=τp1[0]),(τp3==="void"))))))){return ["symbol","___or"];}else{if(((other=τ653),true)){return ["send",["symbol","___or"],expr];}else{throw ["Could not find a match",τ653];}}}};stdenv.register_macro("||",orf);stdenv.register_macro("or",orf);var partial_pattern=function(operator){(operator=["symbol",operator]);return function(τ657,expr){var τp0;var context;var env;if(((τ657 instanceof Array)&&(((τp0=τ657.length),true)&&((τp0===2)&&((context=τ657[0]),true,(env=τ657[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ658=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var val;var τp0;var _;var τp1;var τp2;var τp3;var other;var τ659=false;var τ660=false;var τ661=false;if(((τ659=(τ658 instanceof Array))&&((τ660=((τp0=τ658.length),true))&&((τ661=(τp0===2))&&(((τp1=τ658[0]),(τp1==="pattern"))&&(((τp2=τ658[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&(((τp5=τp2[1]),(τp5 instanceof Array))&&(((τp6=τp5.length),true)&&((τp6===1)&&(((τp7=τp5[0]),(τp7==="void"))&&((val=τp2[2]),true)))))))))))))){return ["check",["macro",make_checker(val,operator)],["ignore"]];}else{if((τ661&&(((_=τ658[0]),true,(τp1=τ658[1]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===1)&&((τp3=τp1[0]),(τp3==="void"))))))){return operator;}else{if(((other=τ658),true)){return ["send",operator,expr];}else{throw ["Could not find a match",τ658];}}}};};stdenv.register_macro("==",partial_pattern("___eq"));stdenv.register_macro("!=",partial_pattern("___neq"));stdenv.register_macro("<=",partial_pattern("___lte"));stdenv.register_macro(">=",partial_pattern("___gte"));stdenv.register_macro("<",partial_pattern("___lt"));stdenv.register_macro(">",partial_pattern("___gt"));stdenv.register_macro("*",function(τ662,expr){var τp0;var context;var env;if(((τ662 instanceof Array)&&(((τp0=τ662.length),true)&&((τp0===2)&&((context=τ662[0]),true,(env=τ662[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ663=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var val;var τp0;var _;var τp1;var τp2;var τp3;var other;var τ664=false;var τ665=false;var τ666=false;if(((τ664=(τ663 instanceof Array))&&((τ665=((τp0=τ663.length),true))&&((τ666=(τp0===2))&&(((τp1=τ663[0]),(τp1==="pattern"))&&(((τp2=τ663[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&((τp4=τp2[0]),(τp4==="void")))))))))){return ["dynsplice",["ignore"]];}else{if((τ666&&(((τp1=τ663[0]),((τp1==="pattern")||(τp1==="data")))&&(((τp2=τ663[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&(((τp5=τp2[1]),(τp5 instanceof Array))&&(((τp6=τp5.length),true)&&((τp6===1)&&(((τp7=τp5[0]),(τp7==="void"))&&((val=τp2[2]),true)))))))))))){return ["dynsplice",val];}else{if((τ666&&(((_=τ663[0]),true,(τp1=τ663[1]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===1)&&((τp3=τp1[0]),(τp3==="void"))))))){return ["symbol","___times"];}else{if(((other=τ663),true)){return ["send",["symbol","___times"],expr];}else{throw ["Could not find a match",τ663];}}}}});stdenv.register_macro(".",function(τ668,τ667){var τp0;var context;var env;if(((τ668 instanceof Array)&&(((τp0=τ668.length),true)&&((τp0===2)&&((context=τ668[0]),true,(env=τ668[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ669=τ667;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var s;var other;if(((τ669 instanceof Array)&&(((τp0=τ669.length),true)&&((τp0===3)&&(((τp1=τ669[0]),(τp1==="data"))&&(((τp2=τ669[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&(((τp4=τp2[0]),(τp4==="void"))&&(((τp5=τ669[2]),(τp5 instanceof Array))&&(((τp6=τp5.length),true)&&((τp6===2)&&(((τp7=τp5[0]),(τp7==="symbol"))&&((s=τp5[1]),true)))))))))))))){return ["value",s];}else{if(((other=τ669),true)){throw τ1092(["syntax","dot"]).create("'.' macro was given an illegal argument",({"arg":other}));}else{throw ["Could not find a match",τ669];}}});stdenv.register_macro("where",function(τ671,τ670){var τp0;var context;var env;if(((τ671 instanceof Array)&&(((τp0=τ671.length),true)&&((τp0===2)&&((context=τ671[0]),true,(env=τ671[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ672=τ670;var τp0;var τp1;var a;var b;var other;if(((τ672 instanceof Array)&&(((τp0=τ672.length),true)&&((τp0===3)&&(((τp1=τ672[0]),(τp1==="data"))&&((a=τ672[1]),true,(b=τ672[2]),true)))))){return ["send",["symbol","let"],["data",b,a]];}else{if(((other=τ672),true)){throw τ1092(["syntax","where"]).create("'where' macro was given an illegal argument",({"arg":other}));}else{throw ["Could not find a match",τ672];}}});stdenv.register_macro("let",function(τ674,τ673){var τp0;var context;var env;if(((τ674 instanceof Array)&&(((τp0=τ674.length),true)&&((τp0===2)&&((context=τ674[0]),true,(env=τ674[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ675=τ673;var τp0;var τp1;var a;var b;var other;if(((τ675 instanceof Array)&&(((τp0=τ675.length),true)&&((τp0===3)&&(((τp1=τ675[0]),(τp1==="data"))&&((a=τ675[1]),true,(b=τ675[2]),true)))))){var bindings=aslist(a);var body=aslist(b);return τ595(["multi"],bindings,body);}else{if(((other=τ675),true)){throw τ1092(["syntax","let"]).create("'let' macro was given an illegal argument",({"arg":other}));}else{throw ["Could not find a match",τ675];}}});stdenv.register_macro("->",function(τ676,τ677){var τp0;var context;var env;if(((τ676 instanceof Array)&&(((τp0=τ676.length),true)&&((τp0===2)&&((context=τ676[0]),true,(env=τ676[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var args;var stmts;if(((τ677 instanceof Array)&&(((τp0=τ677.length),true)&&((τp0===3)&&(((τp1=τ677[0]),(τp1==="data"))&&((args=τ677[1]),true,(stmts=τ677[2]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var placeholder;var τp2;var τp3;var τp4;var newargs;if((((τp0=find_arrow(args)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&(((placeholder=τp0[0]),true,(τp2=τp0[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3>=1)&&(((τp4=τp2[0]),(τp4==="data"))&&((newargs=τp2.slice(1)),true))))))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",10112,10142]}));}var τp0;var τp1;var fw;var bw;var keys;var dflt;var rest;if((((τp0=lhs_parse_specs(env,newargs)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===5)&&((fw=τp0[0]),true,(bw=τp0[1]),true,(keys=τp0[2]),true,(dflt=τp0[3]),true,(rest=τp0[4]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",10165,10191]}));}if(((rest||dflt.length)||keys.length)){var body=["send",["symbol","match"],["data",["send",["send",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",["symbol","arguments"],["value",0]]],["send",["symbol","->"],["data",args,stmts]]]];return ["lambda",[],body];}else{var body=["multi"];(newargs=function(){var τ678=[];var τ679=newargs;var τ680=τ679.length;for(var τ681=0;(τ681<τ680);(τ681++)){var τ682=τ679[τ681];var τp0;var τp1;var s;var other;var other;var τ683=false;if(((τ682 instanceof Array)&&(((τp0=τ682.length),true)&&((τp0===2)&&(((τp1=τ682[0]),(τp1==="symbol"))&&((s=τ682[1]),true)))))){τ678.push(["symbol",s]);}else{if((τ683=((other=τ682),true))){τ678.push(function(){var t=gensym();body.push(["send",["symbol","="],["data",other,t]]);return t;}());}else{if(τ683){false;}else{throw ["Could not find a match",τ682];}}}}return τ678;}());body.push(function(){if(placeholder){return ["send",["symbol","|>"],["data",placeholder,stmts]];}else{return stmts;}}());return ["lambda",newargs,body];}});var build_each=function(source,patterns,τ684,τ685,lvar){var τp0;var prelude;if((((τp0=τ1100(aslist)(τ684)),τp0[0])&&((prelude=τp0[1]),true))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var tail;if((((τp0=τ1100(aslist)(τ685)),τp0[0])&&((tail=τp0[1]),true))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var temp=gensym();var len=gensym();(lvar=(lvar||gensym()));var stmts=τ595(["multi"],prelude).concat([["send",["symbol","="],["data",temp,source]],["send",["symbol","="],["data",len,["send",temp,["send",["symbol","."],["data",["void"],["symbol","length"]]]]]]]);var loop=function(){var a=["send",["symbol","="],["data",lvar,["value",0]]];var b=["send",["symbol","<"],["data",lvar,len]];var c=["send",["symbol","++"],["data",lvar,["void"]]];var body=["send",["symbol","|>"],["data",["send",["symbol","___js_fetch"],["data",temp,lvar]],patterns]];return ["js_for",a,b,c,body];}();stmts.push(loop);var stmts=stmts.concat(tail);return stmts;};stdenv.register_macro("each",function(τ687,τ688){var τp0;var τ686;var env;if(((τ687 instanceof Array)&&(((τp0=τ687.length),true)&&((τp0===2)&&((τ686=τ687[0]),true,(env=τ687[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var arr;var τp2;var τp3;var patterns;if(((τ688 instanceof Array)&&(((τp0=τ688.length),true)&&((τp0===3)&&(((τp1=τ688[0]),(τp1==="data"))&&(((arr=τ688[1]),true,(τp2=τ688[2]),(τp3=τ1100(aslist)(τp2)),τp3[0])&&((patterns=τp3[1]),true))))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ689=τ686;var other;if((τ689==="multi")){patterns.push(["send",["symbol","->"],["data",["symbol","other"],["symbol","false"]]]);return build_each(arr,τ595(["multi"],patterns),["multi"],["symbol","false"]);}else{if(((other=τ689),true)){var res=gensym();(patterns=function(){var τ690=[];var τ691=patterns;var τ692=τ691.length;for(var τ693=0;(τ693<τ692);(τ693++)){var τ694=τ691[τ693];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var patt;var expr;var other;var other;var τ695=false;if(((τ694 instanceof Array)&&(((τp0=τ694.length),true)&&((τp0===3)&&(((τp1=τ694[0]),(τp1==="send"))&&(((τp2=τ694[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="->"))&&(((τp6=τ694[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&((patt=τp6[1]),true,(expr=τp6[2]),true))))))))))))))){τ690.push(["send",["symbol","->"],["data",patt,["send",["send",res,["send",["symbol","."],["data",["void"],["symbol","push"]]]],["data",expr]]]]);}else{if((τ695=((other=τ694),true))){τ690.push(INVALID_PATTERN);}else{if(τ695){false;}else{throw ["Could not find a match",τ694];}}}}return τ690;}());patterns.push(["send",["symbol","->"],["data",["symbol","other"],["symbol","false"]]]);return build_each(arr,τ595(["multi"],patterns),["send",["symbol","="],["data",res,["data"]]],res);}else{throw ["Could not find a match",τ689];}}});stdenv.register_macro("=>",function(τ697,τ698){var τp0;var τ696;var env;if(((τ697 instanceof Array)&&(((τp0=τ697.length),true)&&((τp0===2)&&((τ696=τ697[0]),true,(env=τ697[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var binding;var value;if(((τ698 instanceof Array)&&(((τp0=τ698.length),true)&&((τp0===3)&&(((τp1=τ698[0]),(τp1==="data"))&&((binding=τ698[1]),true,(value=τ698[2]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ699=τ696;var context;if(((τ699==="data")||(τ699==="pattern"))){var τ700=binding;var τp0;var τp1;var _;if(((τ700 instanceof Array)&&(((τp0=τ700.length),true)&&((τp0===1)&&((τp1=τ700[0]),(τp1==="void")))))){return ["assoc",value];}else{if(((_=τ700),true)){return ["assoc",binding,value];}else{throw ["Could not find a match",τ700];}}}else{if(((context=τ699),true)){throw (("Illegal context for '=>' ("+context)+")");}else{throw ["Could not find a match",τ699];}}});stdenv.register_macro("as",function(τ701,τ702){var τp0;var context;var env;if(((τ701 instanceof Array)&&(((τp0=τ701.length),true)&&((τp0===2)&&((context=τ701[0]),true,(env=τ701[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var expr;var variable;if(((τ702 instanceof Array)&&(((τp0=τ702.length),true)&&((τp0===3)&&(((τp1=τ702[0]),(τp1==="data"))&&((expr=τ702[1]),true,(variable=τ702[2]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ703=context;var _;if((τ703==="pattern")){return ["constant",expr,variable];}else{if(((_=τ703),true)){return ["send",["symbol","="],["data",variable,expr]];}else{throw ["Could not find a match",τ703];}}});stdenv.register_macro("=",function(τ704,expr){var τp0;var context;var env;if(((τ704 instanceof Array)&&(((τp0=τ704.length),true)&&((τp0===2)&&((context=τ704[0]),true,(env=τ704[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ705=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var lhs;var rhs;var τp0;var τp1;var τp2;var τp3;var τp4;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var f;var args;var value;var τp0;var τp1;var τp2;var τp3;var τp4;var b;var value;var τp0;var τp1;var τp2;var τp3;var τp4;var patt;var value;var other;var τ706=false;var τ707=false;var τ708=false;var τ709=false;var τ710=false;var τ711=false;var τ712=false;var τ713=false;if(((τ706=(τ705 instanceof Array))&&((τ707=((τp0=τ705.length),true))&&((τ708=(τp0===2))&&(((τp1=τ705[0]),((τp1==="multi")||(τp1==="expr")))&&(((τp2=τ705[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((lhs=τp2[1]),true,(rhs=τp2[2]),true)))))))))){var _src=((lhs.location&&lhs.location.source)&&lhs.location.source.url);var _start=(lhs.location&&lhs.location.start);var _end=(lhs.location&&lhs.location.end);var τp0;var τp1;var τp2;var τp3;var vars;var clauses;var ph;if((((τp0=parse_lhs(env,lhs,rhs)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp3=τ1100(make_declarations)(τp2)),τp3[0])&&((vars=τp3[1]),true,(clauses=τp0[1]),true,(ph=τp0[2]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",12655,12693]}));}var r=τ595(["splice"],vars);var mkif=function(x){return ["if",x,["symbol","undefined"],["send",["symbol","throw"],["send",["symbol","&:"],["data",["send",["send",["symbol","E"],["send",["symbol","."],["data",["void"],["symbol","match"]]]],["data",["value","The value failed to match"]]],["data",["send",["symbol","="],["data",["symbol","location"],["send",["send",["symbol","#"],["data",["void"],["symbol","location"]]],["data",["value",_src],["value",_start],["value",_end]]]]]]]]]];};var τ714=clauses;var τp0;var clause;var _;if(((τ714 instanceof Array)&&(((τp0=τ714.length),true)&&((τp0===1)&&((clause=τ714[0]),true))))){var τ715=send(clause,(clause.length-1));var τp0;var τp1;var τp2;var other;if(((τ715 instanceof Array)&&(((τp0=τ715.length),true)&&((τp0===2)&&(((τp1=τ715[0]),(τp1==="value"))&&((τp2=τ715[1]),(τp2===true))))))){(r=function(){if(((vars.length===1)&&(clause.length===3))){return τ595(["declare"],clause[1].slice(1));}else{return r.concat(clause.slice(1,(-1)));}}());}else{if(((other=τ715),true)){r.push(mkif(clause));}else{throw ["Could not find a match",τ715];}}}else{if(((_=τ714),true)){var ands=make_pattern_test(clauses);r.push(mkif(ands));}else{throw ["Could not find a match",τ714];}}return r;}else{if((τ708&&((τ709=((τp1=τ705[0]),(τp1==="data")))&&((τ710=((τp2=τ705[1]),(τp2 instanceof Array)))&&((τ711=((τp3=τp2.length),true))&&((τp3===1)&&((τp4=τp2[0]),(τp4==="void")))))))){return ["assoc"];}else{if((τ711&&((τ712=(τp3===3))&&((τ713=((τp4=τp2[0]),(τp4==="data")))&&(((τp5=τp2[1]),(τp5 instanceof Array))&&(((τp6=τp5.length),true)&&((τp6===3)&&(((τp7=τp5[0]),(τp7==="send"))&&((f=τp5[1]),true,(args=τp5[2]),true,(value=τp2[2]),true))))))))){(f=function(){var τ716=f;var τp0;var τp1;var _;var τp0;var τp1;var z;var τ717=false;var τ718=false;var τ719=false;if(((τ717=(τ716 instanceof Array))&&((τ718=((τp0=τ716.length),true))&&((τ719=(τp0===2))&&(((τp1=τ716[0]),(τp1==="value"))&&((_=τ716[1]),true)))))){return f;}else{if((τ719&&(((τp1=τ716[0]),(τp1==="symbol"))&&((z=τ716[1]),true)))){return ["value",z];}else{throw ["Could not find a match",τ716];}}}());return ["assoc",f,["send",["symbol","->"],["data",args,value]]];}else{if((τ713&&((b=τp2[1]),true,(value=τp2[2]),true))){(b=function(){var τ720=b;var τp0;var τp1;var _;var τp0;var τp1;var z;var τ721=false;var τ722=false;var τ723=false;if(((τ721=(τ720 instanceof Array))&&((τ722=((τp0=τ720.length),true))&&((τ723=(τp0===2))&&(((τp1=τ720[0]),(τp1==="value"))&&((_=τ720[1]),true)))))){return b;}else{if((τ723&&(((τp1=τ720[0]),(τp1==="symbol"))&&((z=τ720[1]),true)))){return ["value",z];}else{throw ["Could not find a match",τ720];}}}());return ["assoc",b,value];}else{if((τ708&&(((τp1=τ705[0]),(τp1==="pattern"))&&(((τp2=τ705[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((patt=τp2[1]),true,(value=τp2[2]),true)))))))){return ["default",patt,value];}else{if(((other=τ705),true)){throw (("Illegal context for '=' ("+context)+")");}else{throw ["Could not find a match",τ705];}}}}}}});var make_assigner=function(op){return function(τ724,τ725){var τp0;var context;var env;if(((τ724 instanceof Array)&&(((τp0=τ724.length),true)&&((τp0===2)&&((context=τ724[0]),true,(env=τ724[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var a;var b;if(((τ725 instanceof Array)&&(((τp0=τ725.length),true)&&((τp0===3)&&(((τp1=τ725[0]),(τp1==="data"))&&((a=τ725[1]),true,(b=τ725[2]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["assign",a,["send",["symbol",op],["data",a,b]]];};};stdenv.register_macro(":=",function(τ726,τ727){var τp0;var context;var env;if(((τ726 instanceof Array)&&(((τp0=τ726.length),true)&&((τp0===2)&&((context=τ726[0]),true,(env=τ726[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var a;var b;if(((τ727 instanceof Array)&&(((τp0=τ727.length),true)&&((τp0===3)&&(((τp1=τ727[0]),(τp1==="data"))&&((a=τ727[1]),true,(b=τ727[2]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["assign",a,b];});stdenv.register_macro("+=",make_assigner("+"));stdenv.register_macro("-=",make_assigner("-"));stdenv.register_macro("*=",make_assigner("*"));stdenv.register_macro("/=",make_assigner("/"));stdenv.register_macro("<<=",make_assigner("<<"));stdenv.register_macro(">>=",make_assigner(">>"));stdenv.register_macro(">>>=",make_assigner(">>>"));stdenv.register_macro("++=",make_assigner("++"));stdenv.register_macro("?=",make_assigner("match"));stdenv.register_macro("if",function(τ729,τ728){var τp0;var context;var env;if(((τ729 instanceof Array)&&(((τp0=τ729.length),true)&&((τp0===2)&&((context=τ729[0]),true,(env=τ729[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ730=τ728;var τp0;var τp1;var test;var a;var b;var τp0;var τp1;var test;var τp2;var τp3;var τ731;var other;var τ732=false;var τ733=false;if(((τ732=(τ730 instanceof Array))&&((τ733=((τp0=τ730.length),true))&&((τp0===4)&&(((τp1=τ730[0]),(τp1==="data"))&&((test=τ730[1]),true,(a=τ730[2]),true,(b=τ730[3]),true)))))){return ["if",test,a,b];}else{if((τ733&&((τp0===3)&&(((τp1=τ730[0]),(τp1==="data"))&&(((test=τ730[1]),true,(τp2=τ730[2]),(τp3=τ1100(aslist)(τp2)),τp3[0])&&((τ731=τp3[1]),true)))))){var τ734=τ731;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var τp12;var s1;var τp13;var τp14;var τp15;var τp16;var τp17;var τp18;var τp19;var τp20;var τp21;var τp22;var τp23;var τp24;var s2;var τp0;var s1;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var τp12;var s2;var other;var τ735=false;var τ736=false;if(((τ735=(τ734 instanceof Array))&&((τ736=((τp0=τ734.length),true))&&((τp0===2)&&(((τp1=τ734[0]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((τp4=τp1[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="symbol"))&&(((τp7=τp4[1]),(τp7==="then"))&&(((τp8=τp1[2]),(τp8 instanceof Array))&&(((τp9=τp8.length),true)&&((τp9===2)&&(((τp10=τp8[0]),(τp10==="data"))&&(((τp11=τp8[1]),(τp12=τ1100(aslist)(τp11)),τp12[0])&&(((s1=τp12[1]),true,(τp13=τ734[1]),(τp13 instanceof Array))&&(((τp14=τp13.length),true)&&((τp14===3)&&(((τp15=τp13[0]),(τp15==="send"))&&(((τp16=τp13[1]),(τp16 instanceof Array))&&(((τp17=τp16.length),true)&&((τp17===2)&&(((τp18=τp16[0]),(τp18==="symbol"))&&(((τp19=τp16[1]),(τp19==="else"))&&(((τp20=τp13[2]),(τp20 instanceof Array))&&(((τp21=τp20.length),true)&&((τp21===2)&&(((τp22=τp20[0]),(τp22==="data"))&&(((τp23=τp20[1]),(τp24=τ1100(aslist)(τp23)),τp24[0])&&((s2=τp24[1]),true))))))))))))))))))))))))))))))))){return ["if",test,τ595(["multi"],s1),τ595(["multi"],s2)];}else{if((τ736&&((τp0>=1)&&(((s1=τ734.slice(0,-1)),true,(τp1=send(τ734,(τp0-1))),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((τp4=τp1[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="symbol"))&&(((τp7=τp4[1]),(τp7==="else"))&&(((τp8=τp1[2]),(τp8 instanceof Array))&&(((τp9=τp8.length),true)&&((τp9===2)&&(((τp10=τp8[0]),(τp10==="data"))&&(((τp11=τp8[1]),(τp12=τ1100(aslist)(τp11)),τp12[0])&&((s2=τp12[1]),true)))))))))))))))))){return ["if",test,τ595(["multi"],s1),τ595(["multi"],s2)];}else{if(((other=τ734),true)){return ["if",test,τ595(["multi"],other),["value",null]];}else{throw ["Could not find a match",τ734];}}}}else{if(((other=τ730),true)){throw Error("error in if");}else{throw ["Could not find a match",τ730];}}}});stdenv.register_macro("cond",function(τ737,τ738){var τp0;var context;var env;if(((τ737 instanceof Array)&&(((τp0=τ737.length),true)&&((τp0===2)&&((context=τ737[0]),true,(env=τ737[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var clauses;if(((τ738 instanceof Array)&&(((τp0=τ738.length),true)&&((τp0===2)&&(((τp1=τ738[0]),(τp1==="data"))&&((clauses=τ738[1]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var handle=function(xs){var τ739=xs;var τp0;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var test;var body;var rest;var τ740=false;var τ741=false;if(((τ740=(τ739 instanceof Array))&&((τ741=((τp0=τ739.length),true))&&(τp0===0)))){return ["value",false];}else{if((τ741&&((τp0>=1)&&(((τp1=τ739[0]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((τp4=τp1[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="symbol"))&&(((τp7=τp4[1]),(τp7==="=>"))&&(((τp8=τp1[2]),(τp8 instanceof Array))&&(((τp9=τp8.length),true)&&((τp9===3)&&(((τp10=τp8[0]),(τp10==="data"))&&((test=τp8[1]),true,(body=τp8[2]),true,(rest=τ739.slice(1)),true))))))))))))))))){(test=function(){var τ742=test;var τp0;var τp1;var τp2;var _;if(((τ742 instanceof Array)&&(((τp0=τ742.length),true)&&((τp0===2)&&(((τp1=τ742[0]),(τp1==="symbol"))&&((τp2=τ742[1]),(τp2==="else"))))))){return ["value",true];}else{if(((_=τ742),true)){return test;}else{throw ["Could not find a match",τ742];}}}());return ["if",test,body,handle(rest)];}else{throw ["Could not find a match",τ739];}}};return handle(aslist(clauses));});stdenv.register_macro("while",function(τ743,expr){var τp0;var context;var env;if(((τ743 instanceof Array)&&(((τp0=τ743.length),true)&&((τp0===2)&&((context=τ743[0]),true,(env=τ743[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var test;var body;if(((expr instanceof Array)&&(((τp0=expr.length),true)&&((τp0===3)&&(((τp1=expr[0]),(τp1==="data"))&&((test=expr[1]),true,(body=expr[2]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",15584,15601]}));}return ["js_while",test,body];});stdenv.register_macro("for",function(τ745,τ744){var τp0;var context;var env;if(((τ745 instanceof Array)&&(((τp0=τ745.length),true)&&((τp0===2)&&((context=τ745[0]),true,(env=τ745[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ746=τ744;var τp0;var τp1;var τp2;var τp3;var τp4;var a;var b;var c;var body;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var a;var b;var body;var τ747=false;var τ748=false;var τ749=false;var τ750=false;var τ751=false;var τ752=false;if(((τ747=(τ746 instanceof Array))&&((τ748=((τp0=τ746.length),true))&&((τ749=(τp0===3))&&((τ750=((τp1=τ746[0]),(τp1==="data")))&&((τ751=((τp2=τ746[1]),(τp2 instanceof Array)))&&((τ752=((τp3=τp2.length),true))&&((τp3===4)&&(((τp4=τp2[0]),(τp4==="multi"))&&((a=τp2[1]),true,(b=τp2[2]),true,(c=τp2[3]),true,(body=τ746[2]),true)))))))))){return ["js_for",a,b,c,body];}else{if((τ752&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="send"))&&(((τp5=τp2[1]),(τp5 instanceof Array))&&(((τp6=τp5.length),true)&&((τp6===2)&&(((τp7=τp5[0]),(τp7==="symbol"))&&(((τp8=τp5[1]),(τp8==="in"))&&(((τp9=τp2[2]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===3)&&(((τp11=τp9[0]),(τp11==="data"))&&((a=τp9[1]),true,(b=τp9[2]),true,(body=τ746[2]),true)))))))))))))){return ["js_for_in",a,b,body];}else{throw ["Could not find a match",τ746];}}});stdenv.register_macro("!!",function(τ754,τ755){var τp0;var τ753;var env;if(((τ754 instanceof Array)&&(((τp0=τ754.length),true)&&((τp0===2)&&((τ753=τ754[0]),true,(env=τ754[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var expr;var matchers;if(((τ755 instanceof Array)&&(((τp0=τ755.length),true)&&((τp0===3)&&(((τp1=τ755[0]),(τp1==="data"))&&((expr=τ755[1]),true,(matchers=τ755[2]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ756=τ753;var other;if((τ756==="multi")){var excv=gensym();var m=function(){var τ757=aslist(matchers);var ms;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var _;var x;if((((ms=τ757),true,(τ757 instanceof Array))&&(((τp0=τ757.length),true)&&((τp0>=1)&&(((τp1=τ757[0]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((τp4=τp1[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="symbol"))&&(((τp7=τp4[1]),(τp7==="->"))&&((_=τp1[2]),true,τ757.slice(1),true)))))))))))))){ms.push(["send",["symbol","->"],["data",["symbol","___exc"],["send",["symbol","throw"],["symbol","___exc"]]]]);return ["send",["symbol","|>"],["data",excv,τ595(["multi"],ms)]];}else{if(((x=τ757),true)){return matchers;}else{throw ["Could not find a match",τ757];}}}();var f=["send",["symbol","->"],["data",["data",excv],m]];return ["multi",["js_try",expr,f,["void"]]];}else{if(((other=τ756),true)){var excv=gensym();var res=gensym();var m=function(){var τ758=aslist(matchers);var ms;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var _;var x;if((((ms=τ758),true,(τ758 instanceof Array))&&(((τp0=τ758.length),true)&&((τp0>=1)&&(((τp1=τ758[0]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((τp4=τp1[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="symbol"))&&(((τp7=τp4[1]),(τp7==="->"))&&((_=τp1[2]),true,τ758.slice(1),true)))))))))))))){ms.push(["send",["symbol","->"],["data",["symbol","___exc"],["send",["symbol","throw"],["symbol","___exc"]]]]);return ["send",["symbol","|>"],["data",excv,τ595(["multi"],ms)]];}else{if(((x=τ758),true)){return matchers;}else{throw ["Could not find a match",τ758];}}}();var f=["send",["symbol","->"],["data",["data",excv],["send",["symbol",":="],["data",res,m]]]];return ["multi",["declare",res,["value",undefined]],["js_try",["assign",res,expr],f,["void"]],res];}else{throw ["Could not find a match",τ756];}}});stdenv.register_macro("new",function(_,expr){return ["js_new",expr];});stdenv.register_macro("return",function(_,expr){return ["js_return",expr];});stdenv.register_macro("delete",function(_,expr){return ["js_delete",expr];});stdenv.register_macro("throw",function(_,expr){return ["js_throw",expr];});stdenv.register_macro("break",function(_,expr){return ["js_break"];});stdenv.register_macro("continue",function(_,expr){return ["js_continue"];});var rx_wrap=function(x){return (("(?:"+x)+")");};var rx_quote=function(x){return x.replace(RegExp("([.?*+\\^$\\[\\]\\(\\)\\{\\}|\\\\])","g"),"\\$1");};var rx_quote2=function(x){return x.replace(RegExp("([\\[\\]\\(\\)\\{\\}\\^])","g"),"\\$1");};var rx_build2=function(τ759){var τ760=τ759;var τp0;var τp1;var τ761;var τp0;var τp1;var x;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var s;var τp0;var τp1;var τp2;var τp3;var τp4;var τ762;var τp5;var τp6;var τp7;var a;var b;var τp0;var τp1;var args;var τp0;var τp1;var args;var otherA;var τ763=false;var τ764=false;var τ765=false;var τ766=false;var τ767=false;var τ768=false;var τ769=false;var τ770=false;if(((τ763=(τ760 instanceof Array))&&((τ764=((τp0=τ760.length),true))&&((τ765=(τp0===2))&&(((τp1=τ760[0]),(τp1==="symbol"))&&((τ761=τ760[1]),true)))))){var τ771=τ761;if((τ771==="any")){return ".";}else{if((τ771==="start")){return "^";}else{if((τ771==="end")){return "$";}else{if((τ771==="alpha")){return "\\a";}else{if((τ771==="digit")){return "\\d";}else{if((τ771==="word")){return "\\w";}else{if((τ771==="space")){return "\\s";}else{if((τ771==="boundary")){return "\\b";}else{if((τ771==="a")){return "\\a";}else{if((τ771==="d")){return "\\d";}else{if((τ771==="w")){return "\\w";}else{if((τ771==="s")){return "\\s";}else{if((τ771==="b")){return "\\b";}else{throw ["Could not find a match",τ771];}}}}}}}}}}}}}}else{if((τ765&&(((τp1=τ760[0]),(τp1==="value"))&&((x=τ760[1]),true)))){return rx_quote(x);}else{if((τ764&&((τ765=(τp0===3))&&((τ766=((τp1=τ760[0]),(τp1==="send")))&&((τ767=((τp2=τ760[1]),(τp2 instanceof Array)))&&((τ768=((τp3=τp2.length),true))&&((τ769=(τp3===2))&&((τ770=((τp4=τp2[0]),(τp4==="symbol")))&&(((τp5=τp2[1]),(τp5==="raw"))&&(((τp6=τ760[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===2)&&(((τp8=τp6[0]),(τp8==="value"))&&((s=τp6[1]),true)))))))))))))){return s;}else{if((τ770&&(((τ762=τp2[1]),true,(τp5=τ760[2]),(τp5 instanceof Array))&&(((τp6=τp5.length),true)&&((τp6===3)&&(((τp7=τp5[0]),(τp7==="data"))&&((a=τp5[1]),true,(b=τp5[2]),true))))))){var τ772=τ762;if((τ772==="||")){return rx_wrap(((rx_build2(a)+"|")+rx_build2(b)));}else{if((τ772==="or")){return rx_wrap(((rx_build2(a)+"|")+rx_build2(b)));}else{if((τ772==="*")){var τp0;var τp1;if(((a instanceof Array)&&(((τp0=a.length),true)&&((τp0===1)&&((τp1=a[0]),(τp1==="void")))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",17811,17818]}));}return rx_wrap((rx_build2(b)+"*"));}else{if((τ772==="+")){var τp0;var τp1;if(((a instanceof Array)&&(((τp0=a.length),true)&&((τp0===1)&&((τp1=a[0]),(τp1==="void")))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",17882,17889]}));}return rx_wrap((rx_build2(b)+"+"));}else{if((τ772==="?")){var τp0;var τp1;if(((a instanceof Array)&&(((τp0=a.length),true)&&((τp0===1)&&((τp1=a[0]),(τp1==="void")))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",17953,17960]}));}return rx_wrap((rx_build2(b)+"?"));}else{if((τ772==="in")){var τp0;var τp1;if(((a instanceof Array)&&(((τp0=a.length),true)&&((τp0===1)&&((τp1=a[0]),(τp1==="void")))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",18025,18032]}));}var τp0;var τp1;var v;if(((b instanceof Array)&&(((τp0=b.length),true)&&((τp0===2)&&(((τp1=b[0]),(τp1==="value"))&&((v=b[1]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",18046,18055]}));}var x=rx_quote2(v);return (("["+x)+"]");}else{if((τ772==="not")){var τp0;var τp1;if(((a instanceof Array)&&(((τp0=a.length),true)&&((τp0===1)&&((τp1=a[0]),(τp1==="void")))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",18144,18151]}));}var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var τp12;var τp13;var τp14;var v;if(((b instanceof Array)&&(((τp0=b.length),true)&&((τp0===3)&&(((τp1=b[0]),(τp1==="send"))&&(((τp2=b[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="in"))&&(((τp6=b[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===1)&&(((τp11=τp9[0]),(τp11==="void"))&&(((τp12=τp6[2]),(τp12 instanceof Array))&&(((τp13=τp12.length),true)&&((τp13===2)&&(((τp14=τp12[0]),(τp14==="value"))&&((v=τp12[1]),true))))))))))))))))))))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",18170,18217]}));}var x=rx_quote2(v);return (("[^"+x)+"]");}else{throw ["Could not find a match",τ772];}}}}}}}}else{if((τ764&&((τ765=(τp0>=1))&&(((τp1=τ760[0]),(τp1==="data"))&&((args=τ760.slice(1)),true))))){return (("("+args.map(rx_build2).join(""))+")");}else{if((τ765&&(((τp1=τ760[0]),(τp1==="multi"))&&((args=τ760.slice(1)),true)))){return (("(?:"+args.map(rx_build2).join(""))+")");}else{if(((otherA=τ760),true)){throw "OopsF";}else{throw ["Could not find a match",τ760];}}}}}}}};var mac=function(τ773,expr,flags){var τp0;var context;var env;if(((τ773 instanceof Array)&&(((τp0=τ773.length),true)&&((τp0===2)&&((context=τ773[0]),true,(env=τ773[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}(flags=(flags||""));var τ774=expr;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var τp12;var τp13;var τp14;var flag;var τp0;var τp1;var τp2;var v;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var arg;var τ775=false;var τ776=false;if(((τ775=(τ774 instanceof Array))&&((τ776=((τp0=τ774.length),true))&&((τp0===3)&&(((τp1=τ774[0]),(τp1==="send"))&&(((τp2=τ774[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="."))&&(((τp6=τ774[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===1)&&(((τp11=τp9[0]),(τp11==="void"))&&(((τp12=τp6[2]),(τp12 instanceof Array))&&(((τp13=τp12.length),true)&&((τp13===2)&&(((τp14=τp12[0]),(τp14==="symbol"))&&((flag=τp12[1]),true))))))))))))))))))))))){var m=function(ctx,x){return mac(ctx,x,(flags+flag));};return ["macro",m];}else{if((τ776&&((τp0===2)&&(((τp1=τ774[0]),(τp1==="value"))&&(((τp2=τ774[1]),(typeof(τp2)==="string"))&&((v=τp2),true)))))){return ["send",["symbol","RegExp"],["data",["value",v],["value",flags]]];}else{if((τ776&&((τp0===3)&&(((τp1=τ774[0]),(τp1==="send"))&&(((τp2=τ774[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="'"))&&(((τp6=τ774[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===1)&&(((τp11=τp9[0]),(τp11==="void"))&&((arg=τp6[2]),true)))))))))))))))))){return ["send",["symbol","RegExp"],["data",["value",rx_build2(arg)],["value",flags]]];}else{throw ["Could not find a match",τ774];}}}};stdenv.register_macro("R",mac);stdenv.register_macro("?",function(τ778,τ777){var τp0;var context;var env;if(((τ778 instanceof Array)&&(((τp0=τ778.length),true)&&((τp0===2)&&((context=τ778[0]),true,(env=τ778[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ779=τ777;var τp0;var τp1;var τp2;var τp3;var τp4;var expr;var τp0;var τp1;var expr;var τp2;var τp3;var τp4;var τ780=false;var τ781=false;var τ782=false;var τ783=false;if(((τ780=(τ779 instanceof Array))&&((τ781=((τp0=τ779.length),true))&&((τ782=(τp0===3))&&((τ783=((τp1=τ779[0]),(τp1==="data")))&&(((τp2=τ779[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&(((τp4=τp2[0]),(τp4==="void"))&&((expr=τ779[2]),true)))))))))){return ["send",["symbol","cond"],["data",expr]];}else{if((τ783&&(((expr=τ779[1]),true,(τp2=τ779[2]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&((τp4=τp2[0]),(τp4==="void"))))))){var orig_expr=expr;var checker=function(){var τ784=expr;var τp0;var τp1;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var other;var τ785=false;var τ786=false;var τ787=false;var τ788=false;if(((τ785=(τ784 instanceof Array))&&((τ786=((τp0=τ784.length),true))&&((τp0===1)&&((τp1=τ784[0]),(τp1==="void")))))){throw "can't use ? on its own";}else{if((τ786&&((τ787=(τp0===2))&&((τ788=((τp1=τ784[0]),(τp1==="symbol")))&&((τp2=τ784[1]),(τp2==="String")))))){return ["macro",function(_,τ789){var τp0;var τp1;var expr;if(((τ789 instanceof Array)&&(((τp0=τ789.length),true)&&((τp0===2)&&(((τp1=τ789[0]),(τp1==="data"))&&((expr=τ789[1]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["send",["symbol","=="],["data",["send",["symbol","typeof"],["data",expr]],["value","string"]]];}];}else{if((τ788&&((τp2=τ784[1]),(τp2==="Number")))){return ["macro",function(_,τ790){var τp0;var τp1;var expr;if(((τ790 instanceof Array)&&(((τp0=τ790.length),true)&&((τp0===2)&&(((τp1=τ790[0]),(τp1==="data"))&&((expr=τ790[1]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["send",["symbol","=="],["data",["send",["symbol","typeof"],["data",expr]],["value","number"]]];}];}else{if((τ788&&((τp2=τ784[1]),(τp2==="true")))){return ["macro",function(_,τ791){var τp0;var τp1;var expr;if(((τ791 instanceof Array)&&(((τp0=τ791.length),true)&&((τp0===2)&&(((τp1=τ791[0]),(τp1==="data"))&&((expr=τ791[1]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return expr;}];}else{if((τ788&&((τp2=τ784[1]),(τp2==="false")))){return ["macro",function(_,τ792){var τp0;var τp1;var expr;if(((τ792 instanceof Array)&&(((τp0=τ792.length),true)&&((τp0===2)&&(((τp1=τ792[0]),(τp1==="data"))&&((expr=τ792[1]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["send",["symbol","not"],["data",["void"],expr]];}];}else{if((τ788&&((τp2=τ784[1]),(τp2==="null")))){return ["macro",make_checker(["value",null],["symbol","___is"])];}else{if((τ788&&((τp2=τ784[1]),(τp2==="undefined")))){return ["macro",make_checker(["value",undefined],["symbol","___is"])];}else{if(((other=τ784),true)){return ["send",["symbol","___checker"],["data",expr]];}else{throw ["Could not find a match",τ784];}}}}}}}}}();var mac=function(τ794,expr){var τp0;var τ793;var env;if(((τ794 instanceof Array)&&(((τp0=τ794.length),true)&&((τp0===2)&&((τ793=τ794[0]),true,(env=τ794[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ795=τ793;var other;if((τ795==="pattern")){var τ796=expr;var τp0;var τp1;var subp;var τp0;var τp1;var other;var τ797=false;var τ798=false;if(((τ797=(τ796 instanceof Array))&&((τ798=((τp0=τ796.length),true))&&((τp0>=1)&&(((τp1=τ796[0]),(τp1==="data"))&&((subp=τ796.slice(1)),true)))))){var projector=["send",["symbol","___deconstructor"],["data",orig_expr]];return ["check",checker,["project",projector,τ595(["duck",0],subp)]];}else{if((τ798&&((τp0===1)&&((τp1=τ796[0]),(τp1==="void"))))){return ["check",checker,["ignore"]];}else{if(((other=τ796),true)){return ["check",checker,expr];}else{throw ["Could not find a match",τ796];}}}}else{if(((other=τ795),true)){return ["send",checker,["data",expr]];}else{throw ["Could not find a match",τ795];}}};return ["macro",mac];}else{throw ["Could not find a match",τ779];}}});stdenv.register_macro("!",function(τ799,τ800){var τp0;var context;var env;if(((τ799 instanceof Array)&&(((τp0=τ799.length),true)&&((τp0===2)&&((context=τ799[0]),true,(env=τ799[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var expr;var τp2;var τp3;var τp4;if(((τ800 instanceof Array)&&(((τp0=τ800.length),true)&&((τp0===3)&&(((τp1=τ800[0]),(τp1==="data"))&&(((expr=τ800[1]),true,(τp2=τ800[2]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&((τp4=τp2[0]),(τp4==="void")))))))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var orig_expr=expr;var projector=function(){var τ801=expr;var τp0;var τp1;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var other;var τ802=false;var τ803=false;var τ804=false;var τ805=false;if(((τ802=(τ801 instanceof Array))&&((τ803=((τp0=τ801.length),true))&&((τp0===1)&&((τp1=τ801[0]),(τp1==="void")))))){throw "can't use ! on its own";}else{if((τ803&&((τ804=(τp0===2))&&((τ805=((τp1=τ801[0]),(τp1==="symbol")))&&((τp2=τ801[1]),(τp2==="String")))))){return ["macro",function(_,τ806){var τp0;var τp1;var expr;if(((τ806 instanceof Array)&&(((τp0=τ806.length),true)&&((τp0===2)&&(((τp1=τ806[0]),(τp1==="data"))&&((expr=τ806[1]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["data",["symbol","true"],["send",["symbol","String"],["data",expr]]];}];}else{if((τ805&&((τp2=τ801[1]),(τp2==="Number")))){return ["macro",function(_,τ807){var τp0;var τp1;var expr;if(((τ807 instanceof Array)&&(((τp0=τ807.length),true)&&((τp0===2)&&(((τp1=τ807[0]),(τp1==="data"))&&((expr=τ807[1]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["data",["symbol","true"],["send",["symbol","parseFloat"],["data",expr]]];}];}else{if(((other=τ801),true)){return ["send",["symbol","___projector"],["data",expr]];}else{throw ["Could not find a match",τ801];}}}}}();var mac=function(τ809,expr){var τp0;var τ808;var env;if(((τ809 instanceof Array)&&(((τp0=τ809.length),true)&&((τp0===2)&&((τ808=τ809[0]),true,(env=τ809[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ810=τ808;var other;if((τ810==="pattern")){var τ811=expr;var τp0;var τp1;var subp;var τp0;var τp1;var other;var τ812=false;var τ813=false;if(((τ812=(τ811 instanceof Array))&&((τ813=((τp0=τ811.length),true))&&((τp0>=1)&&(((τp1=τ811[0]),(τp1==="data"))&&((subp=τ811.slice(1)),true)))))){var dctor=["send",["symbol","___deconstructor"],["data",orig_expr]];return ["project",projector,["project",dctor,τ595(["duck",0],subp)]];}else{if((τ813&&((τp0===1)&&((τp1=τ811[0]),(τp1==="void"))))){return ["project",projector,["ignore"]];}else{if(((other=τ811),true)){return ["project",projector,expr];}else{throw ["Could not find a match",τ811];}}}}else{if(((other=τ810),true)){return ["send",["send",projector,["data",expr]],["value",1]];}else{throw ["Could not find a match",τ810];}}};return ["macro",mac];});var is_symbol=function(τ814,env){var τ815=τ814;var τp0;var τp1;var s;var _;if(((τ815 instanceof Array)&&(((τp0=τ815.length),true)&&((τp0===2)&&(((τp1=τ815[0]),(τp1==="symbol"))&&((s=τ815[1]),true)))))){var τ816=env.resolve(s);var τp0;var τp1;var m;var _;if(((τ816 instanceof Array)&&(((τp0=τ816.length),true)&&((τp0===2)&&(((τp1=τ816[0]),(τp1==="macro"))&&((m=τ816[1]),true)))))){return false;}else{if(((_=τ816),true)){return true;}else{throw ["Could not find a match",τ816];}}}else{if(((_=τ815),true)){return false;}else{throw ["Could not find a match",τ815];}}};var lhs_parse_specs=function(env,specs){var fw=[];var bw=[];var keys=[];var defaults=[];var rest=undefined;(specs=specs.slice(0));while(specs.length){var x=specs.shift();var v=expand.step(["pattern",env],x);var τ817=v;var τp0;var τp1;var variable;var τp0;var τp1;var key;var τp0;var τp1;var key;var value;var τp0;var τp1;var variable;var value;var τ818;var otherwise;var τ819=false;var τ820=false;var τ821=false;if(((τ819=(τ817 instanceof Array))&&((τ820=((τp0=τ817.length),true))&&((τ821=(τp0===2))&&(((τp1=τ817[0]),(τp1==="dynsplice"))&&((variable=τ817[1]),true)))))){(rest=variable);}else{if((τ821&&(((τp1=τ817[0]),(τp1==="assoc"))&&((key=τ817[1]),true)))){keys.push([key,key]);}else{if((τ820&&((τ821=(τp0===3))&&(((τp1=τ817[0]),(τp1==="assoc"))&&((key=τ817[1]),true,(value=τ817[2]),true))))){keys.push([key,value]);}else{if((τ821&&(((τp1=τ817[0]),(τp1==="default"))&&((variable=τ817[1]),true,(value=τ817[2]),true,(τ818=τ817),true)))){var τ822=τ818;var otherwise;if(rest){throw Error("no defaults after rest arg");}else{if(((otherwise=τ822),true)){defaults.push([variable,value]);}else{throw ["Could not find a match",τ822];}}}else{if((rest===undefined)){fw.push(v);}else{if(((otherwise=τ817),true)){bw.push(v);}else{throw ["Could not find a match",τ817];}}}}}}}return [fw,bw,keys,defaults,rest];};var parse_lhs=function(env,lhs,rhs,gen){(gen=(gen||gensym_factory("p")));var vars=[];var clauses=[];var current=["multi"];var placeholder=null;var mktemp=function(){var t=gen();vars.push(t);return t;};var newclause=function(){if((current.length>1)){clauses.push(current);}else{null;}return (current=["multi"]);};var maybe_temp=function(x){if(is_symbol(x,env)){return x;}else{var temp=mktemp();current.push(["assign",temp,x]);return temp;}};var helper=function(lhs,curr){return helper_noexpand(expand.step(["pattern",env],lhs),curr);};var helper_noexpand=function(lhs,curr){var helper_keys=function(temp,keys){var τ830=[];var τ831=keys;var τ832=τ831.length;for(var τ833=0;(τ833<τ832);(τ833++)){var τ834=τ831[τ833];var τp0;var τp1;var τ837;var τ838;var k;var τ835;var τ836;var k;var v;var other;if(((τ834 instanceof Array)&&(((τp0=τ834.length),true)&&((τp0===2)&&(((τp1=τ834[0]),(((τp1 instanceof Array)&&(((τ835=τp1.length),true)&&((τ835===2)&&(((τ836=τp1[0]),(τ836==="symbol"))&&((k=τp1[1]),true)))))||((τp1 instanceof Array)&&(((τ837=τp1.length),true)&&((τ837===2)&&(((τ838=τp1[0]),(τ838==="value"))&&((k=τp1[1]),true)))))))&&((v=τ834[1]),true)))))){τ830.push((current.push(["send",["symbol","___hasprop"],["data",temp,["value",k]]]),newclause(),helper(v,["send",temp,["value",k]])));}else{if(((other=τ834),true)){false;}else{throw ["Could not find a match",τ834];}}}return τ830;};var helper_array=function(temp,specs,start){var τp0;var fw;var bw;var keys;var dflt;var rest;if(((specs instanceof Array)&&(((τp0=specs.length),true)&&((τp0===5)&&((fw=specs[0]),true,(bw=specs[1]),true,(keys=specs[2]),true,(dflt=specs[3]),true,(rest=specs[4]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",22795,22821]}));}var nfw=fw.length;var nbw=bw.length;var ndflt=dflt.length;var extract_length=true;var check_length=true;if(extract_length){var len=mktemp();current.push(["send",["symbol",":="],["data",len,["send",temp,["send",["symbol","."],["data",["void"],["symbol","length"]]]]]],["symbol","true"]);newclause();if(check_length){var lo=((nfw+nbw)+start);var hi=(lo+ndflt);if((rest===undefined)){if((lo===hi)){current.push(["send",["symbol","=="],["data",len,["value",lo]]]);}else{current.push(["send",["symbol","and"],["data",["send",["symbol",">="],["data",len,["value",lo]]],["send",["symbol","<="],["data",len,["value",hi]]]]]);}}else{current.push(["send",["symbol",">="],["data",len,["value",lo]]]);}newclause();}else{null;}}else{null;}var τ839=enumerate(fw);var τ840=τ839.length;for(var τ841=0;(τ841<τ840);(τ841++)){var τ849=τ839[τ841];var τp0;var j;var m;var other;if(((τ849 instanceof Array)&&(((τp0=τ849.length),true)&&((τp0===2)&&((j=τ849[0]),true,(m=τ849[1]),true))))){helper(m,["send",temp,["value",(j+start)]]);}else{if(((other=τ849),true)){false;}else{throw ["Could not find a match",τ849];}}}false;var τ842=enumerate(dflt);var τ843=τ842.length;for(var τ844=0;(τ844<τ843);(τ844++)){var τ850=τ842[τ844];var τp0;var j;var τp1;var τp2;var patt;var value;var other;if(((τ850 instanceof Array)&&(((τp0=τ850.length),true)&&((τp0===2)&&(((j=τ850[0]),true,(τp1=τ850[1]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===2)&&((patt=τp1[0]),true,(value=τp1[1]),true)))))))){var idx=((j+nfw)+start);helper(patt,["send",["symbol","if"],["data",["send",["symbol",">="],["data",["value",idx],len]],value,["send",temp,["value",idx]]]]);}else{if(((other=τ850),true)){false;}else{throw ["Could not find a match",τ850];}}}false;if((rest!==undefined)){var pos=((nfw+ndflt)+start);var slice=function(){if((nbw>0)){return ["data",["value",pos],["value",(-nbw)]];}else{return ["data",["value",pos]];}}();helper(rest,["send",["send",temp,["send",["symbol","."],["data",["void"],["symbol","slice"]]]],slice]);}else{null;}var τ845=[];var τ846=enumerate(bw);var τ847=τ846.length;for(var τ848=0;(τ848<τ847);(τ848++)){var τ851=τ846[τ848];var τp0;var j;var m;var other;if(((τ851 instanceof Array)&&(((τp0=τ851.length),true)&&((τp0===2)&&((j=τ851[0]),true,(m=τ851[1]),true))))){τ845.push(helper(m,["send",temp,["send",["symbol","-"],["data",len,["value",(nbw-j)]]]]));}else{if(((other=τ851),true)){false;}else{throw ["Could not find a match",τ851];}}}return τ845;};var τ823=lhs;var τp0;var τp1;var τ824;var τ825;var τp0;var τp1;var s;var τp0;var τp1;var v;var τp0;var τp1;var condition;var pattern;var τp0;var τp1;var τp0;var τp1;var c;var pattern;var τp0;var τp1;var xs;var τp0;var τp1;var xs;var τp0;var τp1;var τp2;var τp3;var τp4;var checkers;var expr;var τp0;var τp1;var checker;var expr;var τp0;var τp1;var projector;var expr;var τp0;var τp1;var fname;var spec;var τp0;var τp1;var i;var args;var τp0;var τp1;var args;var other;var τ826=false;var τ827=false;var τ828=false;var τ829=false;if(((τ823 instanceof Array)&&(((τp0=τ823.length),true)&&((τp0===1)&&((τp1=τ823[0]),(τp1==="void")))))){var x=["check",["macro",make_checker(["value",null],["symbol","___eq"])],["ignore"]];return helper_noexpand(x,curr);}else{if(((τ823==="_")||((τ823 instanceof Array)&&(((τ824=τ823.length),true)&&((τ824===1)&&((τ825=τ823[0]),(τ825==="ignore"))))))){if((!is_symbol(curr,env))){current.push(curr);return current.push(["symbol","true"]);}else{return null;}}else{if(((τ826=(τ823 instanceof Array))&&((τ827=((τp0=τ823.length),true))&&((τ828=(τp0===2))&&(((τp1=τ823[0]),(τp1==="symbol"))&&((s=τ823[1]),true)))))){vars.push(["symbol",s]);current.push(["assign",["symbol",s],curr]);return current.push(["value",true]);}else{if((τ828&&(((τp1=τ823[0]),(τp1==="value"))&&((v=τ823[1]),true)))){var x=["check",["macro",make_checker(lhs,["symbol","___eq"])],["ignore"]];return helper_noexpand(x,curr);}else{if((τ827&&((τp0===3)&&(((τp1=τ823[0]),(τp1==="test"))&&((condition=τ823[1]),true,(pattern=τ823[2]),true))))){helper(pattern,curr);current.push(condition);return newclause();}else{if((τ827&&((τp0===1)&&((τp1=τ823[0]),(τp1==="placeholder"))))){(placeholder=gensym());vars.push(placeholder);current.push(["assign",placeholder,curr]);return current.push(["value",true]);}else{if((τ827&&((τp0===3)&&(((τp1=τ823[0]),(τp1==="constant"))&&((c=τ823[1]),true,(pattern=τ823[2]),true))))){return helper(pattern,c);}else{if((τ827&&((τ828=(τp0>=1))&&(((τp1=τ823[0]),(τp1==="all"))&&((xs=τ823.slice(1)),true))))){var temp=maybe_temp(curr);var τ852=xs;var τ853=τ852.length;for(var τ854=0;(τ854<τ853);(τ854++)){var τ855=τ852[τ854];var x;var other;if(((x=τ855),true)){helper(x,temp);}else{if(((other=τ855),true)){false;}else{throw ["Could not find a match",τ855];}}}false;return false;}else{if((τ828&&(((τp1=τ823[0]),(τp1==="any"))&&((xs=τ823.slice(1)),true)))){var normalize=function(vars){return function(){var τ859=[];var τ860=vars;var τ861=τ860.length;for(var τ862=0;(τ862<τ861);(τ862++)){var τ863=τ860[τ862];var τp0;var τp1;var v;var other;if(((τ863 instanceof Array)&&(((τp0=τ863.length),true)&&((τp0===2)&&(((τp1=τ863[0]),(τp1==="symbol"))&&((v=τ863[1]),true,(v[0]!=="τ"))))))){τ859.push(v);}else{if(((other=τ863),true)){false;}else{throw ["Could not find a match",τ863];}}}return τ859;}().sort().join(",");};var temp=maybe_temp(curr);var myvars=undefined;var clauses=[];var τ856=xs;var τ857=τ856.length;for(var τ858=0;(τ858<τ857);(τ858++)){var τ864=τ856[τ858];var x;var other;if(((x=τ864),true)){var p=parse_lhs(env,x,temp,gensym);var τ865=null;var _;if((myvars===undefined)){(myvars=p[0]);}else{if((normalize(p[0])!==normalize(myvars))){throw [Error("Must have the same set of variables in both branches!",(("["+String(myvars))+"]"),(("["+String(p[0]))+"]"))];}else{if(((_=τ865),true)){(vars=vars.concat(p[0]));}else{throw ["Could not find a match",τ865];}}}clauses.push(make_pattern_test(p[1]));}else{if(((other=τ864),true)){false;}else{throw ["Could not find a match",τ864];}}}false;current.push(make_or_pattern(clauses));(vars=vars.concat(myvars));return newclause();}else{if((τ827&&((τ828=(τp0===3))&&((τ829=((τp1=τ823[0]),(τp1==="check")))&&(((τp2=τ823[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3>=1)&&(((τp4=τp2[0]),(τp4==="multi"))&&((checkers=τp2.slice(1)),true,(expr=τ823[2]),true))))))))){var temp=maybe_temp(curr);var τ866=checkers;var τ867=τ866.length;for(var τ868=0;(τ868<τ867);(τ868++)){var τ869=τ866[τ868];var checker;var other;if(((checker=τ869),true)){current.push(["send",checker,["data",temp]]);newclause();}else{if(((other=τ869),true)){false;}else{throw ["Could not find a match",τ869];}}}false;return helper(expr,temp);}else{if((τ829&&((checker=τ823[1]),true,(expr=τ823[2]),true))){var temp=maybe_temp(curr);current.push(["send",checker,["data",temp]]);newclause();return helper(expr,temp);}else{if((τ828&&(((τp1=τ823[0]),(τp1==="project"))&&((projector=τ823[1]),true,(expr=τ823[2]),true)))){var temp=maybe_temp(curr);var temp2=mktemp();current.push(["send",["symbol",":="],["data",temp2,["send",projector,["data",temp]]]],["send",temp2,["value",0]]);newclause();return helper(expr,["send",temp2,["value",1]]);}else{if((τ828&&(((τp1=τ823[0]),(τp1==="send"))&&((fname=τ823[1]),true,(spec=τ823[2]),true)))){return helper(fname,["send",["symbol","->"],["data",spec,curr]]);}else{if((τ827&&((τp0>=2)&&(((τp1=τ823[0]),(τp1==="duck"))&&((i=τ823[1]),true,(args=τ823.slice(2)),true))))){var temp=maybe_temp(curr);current.push(["value",true]);var τp0;var specs;var τp1;var fw;var bw;var keys;var dflt;var rest;if((((τp0=lhs_parse_specs(env,args)),(specs=τp0),true,(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===5)&&((fw=τp0[0]),true,(bw=τp0[1]),true,(keys=τp0[2]),true,(dflt=τp0[3]),true,(rest=τp0[4]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",27819,27855]}));}if(keys.length){helper_keys(temp,keys);}else{null;}if((((((keys.length===0)||fw.length)||bw.length)||dflt.length)||rest)){return helper_array(temp,specs,i);}else{return null;}}else{if((τ827&&((τp0>=1)&&(((τp1=τ823[0]),(τp1==="data"))&&((args=τ823.slice(1)),true))))){var temp=maybe_temp(curr);var τp0;var specs;var τp1;var fw;var bw;var keys;var dflt;var rest;if((((τp0=lhs_parse_specs(env,args)),(specs=τp0),true,(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===5)&&((fw=τp0[0]),true,(bw=τp0[1]),true,(keys=τp0[2]),true,(dflt=τp0[3]),true,(rest=τp0[4]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",28156,28192]}));}if(keys.length){helper_keys(temp,keys);}else{null;}if((((((keys.length===0)||fw.length)||bw.length)||dflt.length)||rest)){current.push(["send",["symbol","instanceof"],["data",temp,["symbol","Array"]]]);newclause();return helper_array(temp,specs,0);}else{return null;}}else{if(((other=τ823),true)){throw ["OopsG",other];}else{throw ["Could not find a match",τ823];}}}}}}}}}}}}}}}}};helper(lhs,rhs);if((current.length>1)){clauses.push(current);}else{null;}return [vars,clauses,placeholder];};var make_declarations=function(vars,val){var τ870=[];var τ871=vars;var τ872=τ871.length;for(var τ873=0;(τ873<τ872);(τ873++)){var τ874=τ871[τ873];var name;var other;if(((name=τ874),true)){τ870.push(["declare",name,["value",val]]);}else{if(((other=τ874),true)){false;}else{throw ["Could not find a match",τ874];}}}return τ870;};var make_pattern_test=function(clauses){var ands=clauses.pop();while((clauses.length>0)){(ands=["send",["symbol","and"],["data",clauses.pop(),ands]]);}return (ands||["value",true]);};var make_or_pattern=function(clauses){var ors=clauses.pop();while((clauses.length>0)){(ors=["send",["symbol","or"],["data",clauses.pop(),ors]]);}return ors;};var find_arrow=function(τ876){var expr;var τ875;(expr=τ876);true;(τ875=τ876);var τ877=τ875;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var x;var τ880;var τ881;var τ878;var τ879;var x;var x;var τp0;var τp1;var v;var τp0;var kind;var args;var τ882=false;var τ883=false;var τ884=false;var τ885=false;if(((τ882=(τ877 instanceof Array))&&((τ883=((τp0=τ877.length),true))&&((τ884=(τp0===2))&&((τ885=((τp1=τ877[0]),(τp1==="symbol")))&&((τp2=τ877[1]),(τp2==="match"))))))){var placeholder=gensym();return [placeholder,placeholder];}else{if((τ885&&((τp2=τ877[1]),(τp2==="|>")))){var placeholder=gensym();return [placeholder,placeholder];}else{if((τ885&&((τp2=τ877[1]),(τp2==="|>*")))){var placeholder=gensym();return [placeholder,["send",["symbol","*"],["data",["void"],placeholder]]];}else{if((((τ877 instanceof Array)&&(((τ878=τ877.length),true)&&((τ878===2)&&(((τ879=τ877[0]),(τ879==="symbol"))&&((x=τ877[1]),true)))))||(((x=τ877),true,(τ877 instanceof Array))&&(((τ880=τ877.length),true)&&((τ880===1)&&((τ881=τ877[0]),(τ881==="void"))))))){return [false,expr];}else{if((((x=τ877),true,(τ877 instanceof Array))&&(((τp0=τ877.length),true)&&((τp0===2)&&(((τp1=τ877[0]),(τp1==="value"))&&((v=τ877[1]),true)))))){return [false,x];}else{if(((τ877 instanceof Array)&&(((τp0=τ877.length),true)&&((τp0>=1)&&((kind=τ877[0]),true,(args=τ877.slice(1)),true))))){var placeholder=false;var new_args=function(){var τ886=[];var τ887=args;var τ888=τ887.length;for(var τ889=0;(τ889<τ888);(τ889++)){var τ890=τ887[τ889];var arg;var other;if(((arg=τ890),true)){τ886.push(function(){var τp0;var τp1;var ph;var new_arg;if((((τp0=find_arrow(arg)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((ph=τp0[0]),true,(new_arg=τp0[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",29696,29709]}));}if(ph){(placeholder=ph);}else{null;}return new_arg;}());}else{if(((other=τ890),true)){false;}else{throw ["Could not find a match",τ890];}}}return τ886;}();return [placeholder,τ595([kind],new_args)];}else{throw ["Could not find a match",τ877];}}}}}}};var same=function(){var τ892=Array.prototype.slice.call(arguments,0);var τp0;var τ893;if(((τ892 instanceof Array)&&(((τp0=τ892.length),true)&&((τp0>=0)&&((τ893=τ892.slice(0)),true))))){var τ894=τ893;var τp0;var τp1;var τp2;var τp3;var x;var τp4;var τp5;var τp6;var y;var τp0;var τp1;var τp2;var τp3;var x;var τp4;var τp5;var τp6;var y;var τp0;var τp1;var τp2;var τp3;var x;var τp4;var τp5;var τp6;var y;var τp0;var τp1;var τp2;var τp3;var f;var x;var τp4;var τp5;var τp6;var g;var y;var τp0;var τp1;var τp2;var kind1;var xs;var τp3;var τp4;var kind2;var ys;var other;var τ895=false;var τ896=false;var τ897=false;var τ898=false;var τ899=false;var τ900=false;if(((τ895=(τ894 instanceof Array))&&((τ896=((τp0=τ894.length),true))&&((τ897=(τp0===2))&&((τ898=((τp1=τ894[0]),(τp1 instanceof Array)))&&((τ899=((τp2=τp1.length),true))&&((τ900=(τp2===2))&&(((τp3=τp1[0]),(τp3==="symbol"))&&(((x=τp1[1]),true,(τp4=τ894[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="symbol"))&&((y=τp4[1]),true))))))))))))){return (x===y);}else{if((τ900&&(((τp3=τp1[0]),(τp3==="value"))&&(((x=τp1[1]),true,(τp4=τ894[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="value"))&&((y=τp4[1]),true)))))))){return (x===y);}else{if((τ900&&(((τp3=τp1[0]),(τp3==="macro"))&&(((x=τp1[1]),true,(τp4=τ894[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="macro"))&&((y=τp4[1]),true)))))))){return (x===y);}else{if((τ899&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((f=τp1[1]),true,(x=τp1[2]),true,(τp4=τ894[1]),(τp4 instanceof Array))&&(((τp5=τp4.length),true)&&((τp5===3)&&(((τp6=τp4[0]),(τp6==="send"))&&((g=τp4[1]),true,(y=τp4[2]),true))))))))){return (same(f,g)&&same(x,y));}else{if((τ899&&((τp2>=1)&&(((kind1=τp1[0]),true,(xs=τp1.slice(1)),true,(τp3=τ894[1]),(τp3 instanceof Array))&&(((τp4=τp3.length),true)&&((τp4>=1)&&((kind2=τp3[0]),true,(ys=τp3.slice(1)),true))))))){var allequal=xs.every(function(x,i){return same(x,send(ys,i));});return (((kind1===kind2)&&(xs.length===ys.length))&&allequal);}else{if(((other=τ894),true)){return false;}else{throw ["Could not find a match",τ894];}}}}}}}else{throw ["Could not find a match",τ892];}};stdenv.register_macro("|>",function(τ902,τ901){var τp0;var context;var env;if(((τ902 instanceof Array)&&(((τp0=τ902.length),true)&&((τp0===2)&&((context=τ902[0]),true,(env=τ902[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ903=τ901;var τp0;var τp1;var τp0;var τp1;var to_match;var cl;var τ904=false;var τ905=false;if(((τ904=(τ903 instanceof Array))&&((τ905=((τp0=τ903.length),true))&&((τp0===1)&&((τp1=τ903[0]),(τp1==="void")))))){return ["placeholder"];}else{if((τ905&&((τp0===3)&&(((τp1=τ903[0]),(τp1==="data"))&&((to_match=τ903[1]),true,(cl=τ903[2]),true))))){var temp=gensym();var clauses=function(){var τ906=cl;var τp0;var τp1;var cls;var other;if(((τ906 instanceof Array)&&(((τp0=τ906.length),true)&&((τp0>=1)&&(((τp1=τ906[0]),(τp1==="multi"))&&((cls=τ906.slice(1)),true)))))){return cls;}else{if(((other=τ906),true)){return [other];}else{throw ["Could not find a match",τ906];}}}();var cached_conditions=[];var stmts=["multi",["declare",temp,to_match]];(clauses=function(){var τ907=[];var τ908=clauses;var τ909=τ908.length;for(var τ910=0;(τ910<τ909);(τ910++)){var τ911=τ908[τ910];var clause;var other;if(((clause=τ911),true)){τ907.push(function(){var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var lhs;var body;if(((clause instanceof Array)&&(((τp0=clause.length),true)&&((τp0===3)&&(((τp1=clause[0]),(τp1==="send"))&&(((τp2=clause[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="->"))&&(((τp6=clause[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&((lhs=τp6[1]),true,(body=τp6[2]),true))))))))))))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",30555,30593]}));}var τp0;var τp1;var decls;var conditions;var placeholder;if((((τp0=parse_lhs(env,lhs,temp)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===3)&&((decls=τp0[0]),true,(conditions=τp0[1]),true,(placeholder=τp0[2]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",30665,30697]}));}(stmts=stmts.concat(make_declarations(decls)));var b=function(){if(placeholder){return ["send",["symbol","|>"],["data",placeholder,body]];}else{return body;}}();var f=function(x){return ["done",expand(["expr",env],x)];};return [conditions.map(f),b];}());}else{if(((other=τ911),true)){false;}else{throw ["Could not find a match",τ911];}}}return τ907;}());var shares=function(){var f=function(τ912,i){var τp0;var conditions;var body;if(((τ912 instanceof Array)&&(((τp0=τ912.length),true)&&((τp0===2)&&((conditions=τ912[0]),true,(body=τ912[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var res=0;var prev_conditions=send(clauses,i)[0];var nc=conditions.length;for(var j=0;((j<nc)&&same(send(conditions,j),send(prev_conditions,j)));(j++)){(res++);}return res;};return clauses.slice(1).map(f);}();var max=send(Math.max,shares);shares.push(0);var vars=[];(vars=vars.concat(function(){var τ913=[];var τ914=τ1105(1,max);var τ915=τ914.length;for(var τ916=0;(τ916<τ915);(τ916++)){var τ917=τ914[τ916];var _;var other;if(((_=τ917),true)){τ913.push(gensym());}else{if(((other=τ917),true)){false;}else{throw ["Could not find a match",τ917];}}}return τ913;}()));(stmts=stmts.concat(make_declarations(vars,false)));var shared_last=0;var new_clauses=clauses.map(function(τ918,i){var τp0;var conditions;var body;if(((τ918 instanceof Array)&&(((τp0=τ918.length),true)&&((τp0===2)&&((conditions=τ918[0]),true,(body=τ918[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var shared=function(){if(shared_last){return [send(vars,(shared_last-1))];}else{return [];}}();var n_to_share=Math.max(shared_last,send(shares,i));var to_share=conditions.slice(shared_last,n_to_share).map(function(x,j){return ["assign",send(vars,(shared_last+j)),x];});(shared_last=send(shares,i));var rest=conditions.slice(n_to_share);return [shared.concat(to_share).concat(rest),body];});(clauses=new_clauses);var r=["js_throw",["data",["value","Could not find a match"],temp]];while((clauses.length>0)){var τp0;var τp1;var conditions;var body;if((((τp0=clauses.pop()),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((conditions=τp0[0]),true,(body=τp0[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",32225,32243]}));}var test=make_pattern_test(conditions);(r=["if",test,body,r]);}stmts.push(r);return stmts;}else{throw ["Could not find a match",τ903];}}});var qqstruct=function(name,args){return τ595(["data",["value",name]],args);};var qq=function(τ920){var expr;var τ919;(expr=τ920);true;(τ919=τ920);var τ921=τ919;var τp0;var τp1;var s;var τp0;var τp1;var τp0;var τp1;var v;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var insert;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var insert;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var insert;var τp0;var name;var args;var τ922=false;var τ923=false;var τ924=false;var τ925=false;var τ926=false;var τ927=false;var τ928=false;var τ929=false;if(((τ922=(τ921 instanceof Array))&&((τ923=((τp0=τ921.length),true))&&((τp0===2)&&(((τp1=τ921[0]),(τp1==="symbol"))&&((s=τ921[1]),true)))))){return qqstruct("symbol",[["value",s]]);}else{if((τ923&&((τp0===1)&&((τp1=τ921[0]),(τp1==="void"))))){return qqstruct("void",[]);}else{if((τ923&&((τp0===2)&&(((τp1=τ921[0]),(τp1==="value"))&&((v=τ921[1]),true))))){return qqstruct("value",[expr]);}else{if((τ923&&((τ924=(τp0===3))&&((τ925=((τp1=τ921[0]),(τp1==="send")))&&((τ926=((τp2=τ921[1]),(τp2 instanceof Array)))&&((τ927=((τp3=τp2.length),true))&&((τ928=(τp3===2))&&((τ929=((τp4=τp2[0]),(τp4==="symbol")))&&(((τp5=τp2[1]),(τp5==="^"))&&(((τp6=τ921[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===1)&&(((τp11=τp9[0]),(τp11==="void"))&&((insert=τp6[2]),true)))))))))))))))))){return insert;}else{if((τ929&&(((τp5=τp2[1]),(τp5==="^="))&&(((τp6=τ921[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===1)&&(((τp11=τp9[0]),(τp11==="void"))&&((insert=τp6[2]),true)))))))))))){return qqstruct("value",[insert]);}else{if((τ929&&(((τp5=τp2[1]),(τp5==="^*"))&&(((τp6=τ921[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===1)&&(((τp11=τp9[0]),(τp11==="void"))&&((insert=τp6[2]),true)))))))))))){return ["send",["symbol","*"],["data",["void"],insert]];}else{if((τ923&&((τp0>=1)&&((name=τ921[0]),true,(args=τ921.slice(1)),true)))){return qqstruct(name,function(){var τ930=[];var τ931=args;var τ932=τ931.length;for(var τ933=0;(τ933<τ932);(τ933++)){var τ934=τ931[τ933];var arg;var other;if(((arg=τ934),true)){τ930.push(qq(arg));}else{if(((other=τ934),true)){false;}else{throw ["Could not find a match",τ934];}}}return τ930;}());}else{throw ["Could not find a match",τ921];}}}}}}}};stdenv.register_macro("'",function(τ935,τ936){var τp0;var context;var env;if(((τ935 instanceof Array)&&(((τp0=τ935.length),true)&&((τp0===2)&&((context=τ935[0]),true,(env=τ935[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var τp2;var τp3;var τp4;var expr;if(((τ936 instanceof Array)&&(((τp0=τ936.length),true)&&((τp0===3)&&(((τp1=τ936[0]),(τp1==="data"))&&(((τp2=τ936[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&(((τp4=τp2[0]),(τp4==="void"))&&((expr=τ936[2]),true)))))))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return qq(expr);});stdenv.register_macro("provide",function(τ937,τ938){var τp0;var context;var env;if(((τ937 instanceof Array)&&(((τp0=τ937.length),true)&&((τp0===2)&&((context=τ937[0]),true,(env=τ937[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var τp2;var τp3;var expr;if(((τ938 instanceof Array)&&(((τp0=τ938.length),true)&&((τp0===2)&&(((τp1=τ938[0]),(τp1==="data"))&&(((τp2=τ938[1]),(τp3=τ1100(aslist)(τp2)),τp3[0])&&((expr=τp3[1]),true))))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return ["sink",["multi"].concat(function(){var τ939=[];var τ940=expr;var τ941=τ940.length;for(var τ942=0;(τ942<τ941);(τ942++)){var τ943=τ940[τ942];var s;var τp0;var τp1;var name;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var s;var τp9;var τ946;var τ947;var name;var τ944;var τ945;var name;var other;var other;var τ948=false;if((((s=τ943),true,(τ943 instanceof Array))&&(((τp0=τ943.length),true)&&((τp0===2)&&(((τp1=τ943[0]),(τp1==="symbol"))&&((name=τ943[1]),true)))))){τ939.push(["send",["symbol",":="],["data",["send",["symbol","exports"],["value",name]],s]]);}else{if(((τ943 instanceof Array)&&(((τp0=τ943.length),true)&&((τp0===3)&&(((τp1=τ943[0]),(τp1==="send"))&&(((τp2=τ943[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="as"))&&(((τp6=τ943[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&((s=τp6[1]),true,(τp9=τp6[2]),(((τp9 instanceof Array)&&(((τ944=τp9.length),true)&&((τ944===2)&&(((τ945=τp9[0]),(τ945==="symbol"))&&((name=τp9[1]),true)))))||((τp9 instanceof Array)&&(((τ946=τp9.length),true)&&((τ946===2)&&(((τ947=τp9[0]),(τ947==="value"))&&((name=τp9[1]),true))))))))))))))))))))){τ939.push(["send",["symbol",":="],["data",["send",["symbol","exports"],["value",name]],s]]);}else{if((τ948=((other=τ943),true))){τ939.push(function(){throw τ1092(["syntax","provide"]).create("Each clause of provide must be 'sym' or 'sym as name'");}());}else{if(τ948){false;}else{throw ["Could not find a match",τ943];}}}}}return τ939;}())];});stdenv.register_macro("require",function(τ949,τ950){var τp0;var context;var env;if(((τ949 instanceof Array)&&(((τp0=τ949.length),true)&&((τp0===2)&&((context=τ949[0]),true,(env=τ949[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var expr;if(((τ950 instanceof Array)&&(((τp0=τ950.length),true)&&((τp0===2)&&(((τp1=τ950[0]),(τp1==="data"))&&((expr=τ950[1]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var stmts=[];var topfetch=function(pkg,v){stmts.push(["send",["symbol","="],["data",v,["send",["send",["symbol","___node"],["send",["symbol","."],["data",["void"],["symbol","require"]]]],["data",["value",pkg]]]]]);return v;};var produce=function(τ951,fetch){var τ952=τ951;var τp0;var τp1;var s;var τp0;var τp1;var τp2;var s;var τ955;var τ956;var subp;var τ953;var τ954;var subp;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τ959;var τ960;var pkg;var τ957;var τ958;var pkg;var s;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var pkg;var subp;var τ961=false;var τ962=false;var τ963=false;var τ964=false;var τ965=false;var τ966=false;var τ967=false;var τ968=false;if(((τ961=(τ952 instanceof Array))&&((τ962=((τp0=τ952.length),true))&&((τ963=(τp0===2))&&(((τp1=τ952[0]),(τp1==="symbol"))&&((s=τ952[1]),true)))))){return fetch(s,["symbol",s]);}else{if((τ963&&(((τp1=τ952[0]),(τp1==="value"))&&(((τp2=τ952[1]),(typeof(τp2)==="string"))&&((s=τp2),true))))){return fetch(s,gensym());}else{if((((τ952 instanceof Array)&&(((τ953=τ952.length),true)&&((τ953>=1)&&(((τ954=τ952[0]),(τ954==="multi"))&&((subp=τ952.slice(1)),true)))))||((τ952 instanceof Array)&&(((τ955=τ952.length),true)&&((τ955>=1)&&(((τ956=τ952[0]),(τ956==="data"))&&((subp=τ952.slice(1)),true))))))){var τ969=[];var τ970=subp;var τ971=τ970.length;for(var τ972=0;(τ972<τ971);(τ972++)){var τ973=τ970[τ972];var p;var other;if(((p=τ973),true)){τ969.push(produce(p,fetch));}else{if(((other=τ973),true)){false;}else{throw ["Could not find a match",τ973];}}}return τ969;}else{if(((τ961=(τ952 instanceof Array))&&((τ962=((τp0=τ952.length),true))&&((τ963=(τp0===3))&&((τ964=((τp1=τ952[0]),(τp1==="send")))&&((τ965=((τp2=τ952[1]),(τp2 instanceof Array)))&&((τ966=((τp3=τp2.length),true))&&((τ967=(τp3===2))&&((τ968=((τp4=τp2[0]),(τp4==="symbol")))&&(((τp5=τp2[1]),(τp5==="as"))&&(((τp6=τ952[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(((τp9 instanceof Array)&&(((τ957=τp9.length),true)&&((τ957===2)&&(((τ958=τp9[0]),(τ958==="value"))&&((pkg=τp9[1]),true)))))||((τp9 instanceof Array)&&(((τ959=τp9.length),true)&&((τ959===2)&&(((τ960=τp9[0]),(τ960==="symbol"))&&((pkg=τp9[1]),true)))))))&&((s=τp6[2]),true)))))))))))))))){return fetch(pkg,s);}else{if((τ968&&(((τp5=τp2[1]),(τp5==="->"))&&(((τp6=τ952[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&((pkg=τp6[1]),true,(subp=τp6[2]),true)))))))){var pkgv=produce(pkg,fetch);return produce(subp,function(pkg,v){return stmts.push(["send",["symbol","="],["data",v,["send",pkgv,["value",pkg]]]]);});}else{throw ["Could not find a match",τ952];}}}}}};produce(expr,topfetch);return τ595(["multi"],stmts);});stdenv.register_macro("%",function(τ974,τ975){var τp0;var context;var env;if(((τ974 instanceof Array)&&(((τp0=τ974.length),true)&&((τp0===2)&&((context=τ974[0]),true,(env=τ974[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var descr;var contents;if(((τ975 instanceof Array)&&(((τp0=τ975.length),true)&&((τp0===3)&&(((τp1=τ975[0]),(τp1==="data"))&&((descr=τ975[1]),true,(contents=τ975[2]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var tags=["data"];var parse=function(τ976){var τ977=τ976;var τp0;var τp1;var τp0;var τp1;var s;var τp0;var τp1;var x;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var τp12;var τ980;var τ981;var x;var τ978;var τ979;var x;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var τp12;var τ984;var τ985;var x;var τ982;var τ983;var x;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τ988;var τ989;var prop;var τ986;var τ987;var prop;var value;var τp0;var τp1;var expr;var rest;var τ992;var τ993;var args;var τ990;var τ991;var args;var τ994=false;var τ995=false;var τ996=false;var τ997=false;var τ998=false;var τ999=false;var τ1000=false;var τ1001=false;if(((τ994=(τ977 instanceof Array))&&((τ995=((τp0=τ977.length),true))&&((τp0===1)&&((τp1=τ977[0]),(τp1==="void")))))){return null;}else{if((τ995&&((τ996=(τp0===2))&&(((τp1=τ977[0]),(τp1==="symbol"))&&((s=τ977[1]),true))))){return tags.push(["value",("+"+s)]);}else{if((τ996&&(((τp1=τ977[0]),(τp1==="value"))&&((x=τ977[1]),true)))){return tags.push(["value",("+"+x)]);}else{if((τ995&&((τ996=(τp0===3))&&((τ997=((τp1=τ977[0]),(τp1==="send")))&&((τ998=((τp2=τ977[1]),(τp2 instanceof Array)))&&((τ999=((τp3=τp2.length),true))&&((τ1000=(τp3===2))&&((τ1001=((τp4=τp2[0]),(τp4==="symbol")))&&(((τp5=τp2[1]),(τp5==="."))&&(((τp6=τ977[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===1)&&(((τp11=τp9[0]),(τp11==="void"))&&((τp12=τp6[2]),(((τp12 instanceof Array)&&(((τ978=τp12.length),true)&&((τ978===2)&&(((τ979=τp12[0]),(τ979==="symbol"))&&((x=τp12[1]),true)))))||((τp12 instanceof Array)&&(((τ980=τp12.length),true)&&((τ980===2)&&(((τ981=τp12[0]),(τ981==="value"))&&((x=τp12[1]),true)))))))))))))))))))))))){return tags.push(["value",x]);}else{if((τ1001&&(((τp5=τp2[1]),(τp5==="#"))&&(((τp6=τ977[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===1)&&(((τp11=τp9[0]),(τp11==="void"))&&((τp12=τp6[2]),(((τp12 instanceof Array)&&(((τ982=τp12.length),true)&&((τ982===2)&&(((τ983=τp12[0]),(τ983==="symbol"))&&((x=τp12[1]),true)))))||((τp12 instanceof Array)&&(((τ984=τp12.length),true)&&((τ984===2)&&(((τ985=τp12[0]),(τ985==="value"))&&((x=τp12[1]),true)))))))))))))))))){return tags.push(["value",("#"+x)]);}else{if((τ1001&&(((τp5=τp2[1]),(τp5==="="))&&(((τp6=τ977[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(((τp9 instanceof Array)&&(((τ986=τp9.length),true)&&((τ986===2)&&(((τ987=τp9[0]),(τ987==="symbol"))&&((prop=τp9[1]),true)))))||((τp9 instanceof Array)&&(((τ988=τp9.length),true)&&((τ988===2)&&(((τ989=τp9[0]),(τ989==="value"))&&((prop=τp9[1]),true)))))))&&((value=τp6[2]),true))))))))){return tags.push(["send",["send",["symbol","#"],["data",["void"],["symbol","assoc"]]],["data",["value",prop],value]]);}else{if((τ997&&((expr=τ977[1]),true,(rest=τ977[2]),true))){parse(expr);return parse(rest);}else{if((((τ977 instanceof Array)&&(((τ990=τ977.length),true)&&((τ990>=1)&&(((τ991=τ977[0]),(τ991==="multi"))&&((args=τ977.slice(1)),true)))))||((τ977 instanceof Array)&&(((τ992=τ977.length),true)&&((τ992>=1)&&(((τ993=τ977[0]),(τ993==="data"))&&((args=τ977.slice(1)),true))))))){return args.forEach(parse);}else{throw ["Could not find a match",τ977];}}}}}}}}};parse(descr);(contents=function(){var τ1002=contents;var τp0;var τp1;var τp0;var τp1;var args;var x;var τ1003=false;var τ1004=false;if(((τ1003=(τ1002 instanceof Array))&&((τ1004=((τp0=τ1002.length),true))&&((τp0===1)&&((τp1=τ1002[0]),(τp1==="void")))))){return ["data"];}else{if((τ1004&&((τp0>=1)&&(((τp1=τ1002[0]),(τp1==="multi"))&&((args=τ1002.slice(1)),true))))){return τ595(["data"],args);}else{if(((x=τ1002),true)){return x;}else{throw ["Could not find a match",τ1002];}}}}());return ["send",["symbol","Node"],["data",tags,contents]];});var var_operator=function(temp){return function(_,expr){var f=function(τ1005){var τ1006=τ1005;var τp0;var τp1;var τp0;var τp1;var τp2;var τp3;var τp4;var τ1007;var other;var τ1008=false;var τ1009=false;if(((τ1008=(τ1006 instanceof Array))&&((τ1009=((τp0=τ1006.length),true))&&((τp0===1)&&((τp1=τ1006[0]),(τp1==="void")))))){return temp;}else{if((τ1009&&((τp0===3)&&(((τp1=τ1006[0]),(τp1==="data"))&&(((τp2=τ1006[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===1)&&(((τp4=τp2[0]),(τp4==="void"))&&((τ1007=τ1006[2]),true))))))))){var τ1010=τ1007;var τp0;var τp1;var s;var τp0;var τp1;var obj;var msg;var other;var τ1011=false;var τ1012=false;if(((τ1011=(τ1010 instanceof Array))&&((τ1012=((τp0=τ1010.length),true))&&((τp0===2)&&(((τp1=τ1010[0]),(τp1==="symbol"))&&((s=τ1010[1]),true)))))){return ["send",temp,["value",s]];}else{if((τ1012&&((τp0===3)&&(((τp1=τ1010[0]),(τp1==="send"))&&((obj=τ1010[1]),true,(msg=τ1010[2]),true))))){var x=f(["data",["void"],obj]);return ["send",x,msg];}else{if(((other=τ1010),true)){return ["send",temp,other];}else{throw ["Could not find a match",τ1010];}}}}else{if(((other=τ1006),true)){return ["send",temp,other];}else{throw ["Could not find a match",τ1006];}}}};return f(expr);};};stdenv.register_macro("chain",function(τ1013,τ1014){var τp0;var context;var env;if(((τ1013 instanceof Array)&&(((τp0=τ1013.length),true)&&((τp0===2)&&((context=τ1013[0]),true,(env=τ1013[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var defn;var body;if(((τ1014 instanceof Array)&&(((τp0=τ1014.length),true)&&((τp0===3)&&(((τp1=τ1014[0]),(τp1==="data"))&&((defn=τ1014[1]),true,(body=τ1014[2]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var newenv=env.fork();var temp=gensym();var τp0;var τp1;var variable;var expr;if((((τp0=function(){var τ1015=defn;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var x;var y;var other;if(((τ1015 instanceof Array)&&(((τp0=τ1015.length),true)&&((τp0===3)&&(((τp1=τ1015[0]),(τp1==="send"))&&(((τp2=τ1015[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="as"))&&(((τp6=τ1015[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&((x=τp6[1]),true,(y=τp6[2]),true))))))))))))))){return [y,x];}else{if(((other=τ1015),true)){return [["symbol","@"],other];}else{throw ["Could not find a match",τ1015];}}}()),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((variable=τp0[0]),true,(expr=τp0[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",36451,36467]}));}var τp0;var τp1;var var_str;if(((variable instanceof Array)&&(((τp0=variable.length),true)&&((τp0===2)&&(((τp1=variable[0]),(τp1==="symbol"))&&((var_str=variable[1]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",36573,36589]}));}newenv.register_macro(var_str,var_operator(temp));var stmts=["multi"].concat(function(){var τ1016=[];var τ1017=aslist(body);var τ1018=τ1017.length;for(var τ1019=0;(τ1019<τ1018);(τ1019++)){var τ1020=τ1017[τ1019];var x;var other;if(((x=τ1020),true)){τ1016.push(["send",["symbol",":="],["data",temp,x]]);}else{if(((other=τ1020),true)){false;}else{throw ["Could not find a match",τ1020];}}}return τ1016;}());var v=["multi",["send",["symbol","="],["data",temp,expr]],stmts,temp];return ["done",expand([context,newenv],v)];});stdenv.register_macro("using",function(τ1021,τ1022){var τp0;var context;var env;if(((τ1021 instanceof Array)&&(((τp0=τ1021.length),true)&&((τp0===2)&&((context=τ1021[0]),true,(env=τ1021[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var defn;var body;if(((τ1022 instanceof Array)&&(((τp0=τ1022.length),true)&&((τp0===3)&&(((τp1=τ1022[0]),(τp1==="data"))&&((defn=τ1022[1]),true,(body=τ1022[2]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var newenv=env.fork();var temp=gensym();var τp0;var τp1;var variable;var expr;if((((τp0=function(){var τ1023=defn;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var x;var y;var other;if(((τ1023 instanceof Array)&&(((τp0=τ1023.length),true)&&((τp0===3)&&(((τp1=τ1023[0]),(τp1==="send"))&&(((τp2=τ1023[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="as"))&&(((τp6=τ1023[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&((x=τp6[1]),true,(y=τp6[2]),true))))))))))))))){return [y,x];}else{if(((other=τ1023),true)){return [["symbol","@"],other];}else{throw ["Could not find a match",τ1023];}}}()),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((variable=τp0[0]),true,(expr=τp0[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",36952,36968]}));}var τp0;var τp1;var var_str;if(((variable instanceof Array)&&(((τp0=variable.length),true)&&((τp0===2)&&(((τp1=variable[0]),(τp1==="symbol"))&&((var_str=variable[1]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",37074,37090]}));}newenv.register_macro(var_str,var_operator(temp));var v=["multi",["send",["symbol","="],["data",temp,expr]],body];return ["done",expand([context,newenv],v)];});var partition=function(xs,predicate){var t=[];var f=[];var τ1024=xs;var τ1025=τ1024.length;for(var τ1026=0;(τ1026<τ1025);(τ1026++)){var τ1027=τ1024[τ1026];var x;var x;var other;if(((x=τ1027),true,predicate(x))){t.push(x);}else{if(((x=τ1027),true)){f.push(x);}else{if(((other=τ1027),true)){false;}else{throw ["Could not find a match",τ1027];}}}}false;return [t,f];};stdenv.register_macro("class",function(τ1028,arg){var τp0;var context;var env;if(((τ1028 instanceof Array)&&(((τp0=τ1028.length),true)&&((τp0===2)&&((context=τ1028[0]),true,(env=τ1028[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var clsvar;var τp2;var τp3;var body;if((((τp0=function(){var τ1032=arg;var τp0;var τp1;var body;var τp0;var τp1;var name;var body;var τ1033=false;var τ1034=false;if(((τ1033=(τ1032 instanceof Array))&&((τ1034=((τp0=τ1032.length),true))&&((τp0===2)&&(((τp1=τ1032[0]),(τp1==="data"))&&((body=τ1032[1]),true)))))){return [gensym(),body];}else{if((τ1034&&((τp0===3)&&(((τp1=τ1032[0]),(τp1==="data"))&&((name=τ1032[1]),true,(body=τ1032[2]),true))))){return [name,body];}else{throw ["Could not find a match",τ1032];}}}()),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&(((clsvar=τp0[0]),true,(τp2=τp0[1]),(τp3=τ1100(aslist)(τp2)),τp3[0])&&((body=τp3[1]),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",37438,37460]}));}var τp0;var τp1;var ctors;var clauses;if((((τp0=partition(body,function(τ1035){var τ1036=τ1035;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var τp12;var τp13;var τp14;var τp15;var _;var _;var otherwise;if(((τ1036 instanceof Array)&&(((τp0=τ1036.length),true)&&((τp0===3)&&(((τp1=τ1036[0]),(τp1==="send"))&&(((τp2=τ1036[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="="))&&(((τp6=τ1036[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===3)&&(((τp11=τp9[0]),(τp11==="send"))&&(((τp12=τp9[1]),(τp12 instanceof Array))&&(((τp13=τp12.length),true)&&((τp13===2)&&(((τp14=τp12[0]),(τp14==="symbol"))&&(((τp15=τp12[1]),(τp15==="constructor"))&&((_=τp9[2]),true,(_=τp6[2]),true)))))))))))))))))))))))){return true;}else{if(((otherwise=τ1036),true)){return false;}else{throw ["Could not find a match",τ1036];}}})),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((ctors=τp0[0]),true,(clauses=τp0[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",37556,37572]}));}var τp0;var τp1;var ctor_args;var ctor_body;if((((τp0=function(){var τ1037=ctors;var τp0;var τp0;var τ1038;var τ1039=false;var τ1040=false;if(((τ1039=(τ1037 instanceof Array))&&((τ1040=((τp0=τ1037.length),true))&&(τp0===0)))){return [["data"],[]];}else{if((τ1040&&((τp0===1)&&((τ1038=τ1037[0]),true)))){var τ1041=τ1038;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var _;var args;var τp12;var τp13;var body;if(((τ1041 instanceof Array)&&(((τp0=τ1041.length),true)&&((τp0===3)&&(((τp1=τ1041[0]),(τp1==="send"))&&(((τp2=τ1041[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="="))&&(((τp6=τ1041[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===3)&&(((τp11=τp9[0]),(τp11==="send"))&&(((_=τp9[1]),true,(args=τp9[2]),true,(τp12=τp6[2]),(τp13=τ1100(aslist)(τp12)),τp13[0])&&((body=τp13[1]),true)))))))))))))))))))){return [args,body];}else{throw ["Could not find a match",τ1041];}}else{throw ["Could not find a match",τ1037];}}}()),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((ctor_args=τp0[0]),true,(ctor_body=τp0[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",37714,37736]}));}var selfvar=gensym();(ctor_body=function(){var prep=["send",["symbol","="],["data",selfvar,["send",["symbol","if"],["data",["send",["symbol","not"],["data",["void"],["send",["send",["symbol","?"],["data",clsvar,["void"]]],["symbol","this"]]]],["send",["send",["symbol","Object"],["send",["symbol","."],["data",["void"],["symbol","create"]]]],["data",["send",clsvar,["send",["symbol","."],["data",["void"],["symbol","prototype"]]]]]],["symbol","this"]]]]];var ret=selfvar;return τ595(["multi",prep],ctor_body,[ret]);}());var newenv=env.fork();newenv.register_macro("@",var_operator(selfvar));var defns=[];var static_defns=[];var τ1029=clauses;var τ1030=τ1029.length;for(var τ1031=0;(τ1031<τ1030);(τ1031++)){var τ1042=τ1029[τ1031];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var body;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var τp10;var τp11;var name;var args;var τp12;var τp13;var body;var other;var τ1043=false;var τ1044=false;var τ1045=false;var τ1046=false;var τ1047=false;var τ1048=false;var τ1049=false;var τ1050=false;if(((τ1043=(τ1042 instanceof Array))&&((τ1044=((τp0=τ1042.length),true))&&((τ1045=(τp0===3))&&((τ1046=((τp1=τ1042[0]),(τp1==="send")))&&((τ1047=((τp2=τ1042[1]),(τp2 instanceof Array)))&&((τ1048=((τp3=τp2.length),true))&&((τ1049=(τp3===2))&&((τ1050=((τp4=τp2[0]),(τp4==="symbol")))&&(((τp5=τp2[1]),(τp5==="static"))&&(((τp6=τ1042[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===2)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp10=τ1100(aslist)(τp9)),τp10[0])&&((body=τp10[1]),true)))))))))))))))){(static_defns=static_defns.concat(body));}else{if((τ1050&&(((τp5=τp2[1]),(τp5==="="))&&(((τp6=τ1042[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((τp9=τp6[1]),(τp9 instanceof Array))&&(((τp10=τp9.length),true)&&((τp10===3)&&(((τp11=τp9[0]),(τp11==="send"))&&(((name=τp9[1]),true,(args=τp9[2]),true,(τp12=τp6[2]),(τp13=τ1100(aslist)(τp12)),τp13[0])&&((body=τp13[1]),true))))))))))))){(name=function(){var τ1051=name;var τp0;var τp1;var _;var τp0;var τp1;var n;var τ1052=false;var τ1053=false;var τ1054=false;if(((τ1052=(τ1051 instanceof Array))&&((τ1053=((τp0=τ1051.length),true))&&((τ1054=(τp0===2))&&(((τp1=τ1051[0]),(τp1==="value"))&&((_=τ1051[1]),true)))))){return name;}else{if((τ1054&&(((τp1=τ1051[0]),(τp1==="symbol"))&&((n=τ1051[1]),true)))){return ["value",n];}else{throw ["Could not find a match",τ1051];}}}());defns.push(["send",["symbol",":="],["data",["send",["send",clsvar,["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],name],["send",["symbol","->"],["data",args,τ595(["multi",["send",["symbol","="],["data",selfvar,["symbol","this"]]]],body)]]]]);}else{if(((other=τ1042),true)){false;}else{throw ["Could not find a match",τ1042];}}}}false;return ["done",expand([context,newenv],τ595(["multi",["send",["symbol","="],["data",clsvar,["send",["symbol","->"],["data",ctor_args,ctor_body]]]],["send",["symbol","&:"],τ595(["data",clsvar],static_defns)]],defns,[clsvar]))];});stdenv.register_macro("do",function(τ1055,τ1056){var τp0;var context;var env;if(((τ1055 instanceof Array)&&(((τp0=τ1055.length),true)&&((τp0===2)&&((context=τ1055[0]),true,(env=τ1055[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var τp2;var τp3;var body;if(((τ1056 instanceof Array)&&(((τp0=τ1056.length),true)&&((τp0===2)&&(((τp1=τ1056[0]),(τp1==="data"))&&(((τp2=τ1056[1]),(τp3=τ1100(aslist)(τp2)),τp3[0])&&((body=τp3[1]),true))))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return τ595(["multi"],body);});stdenv.register_macro("then",function(τ1057,τ1058){var τp0;var context;var env;if(((τ1057 instanceof Array)&&(((τp0=τ1057.length),true)&&((τp0===2)&&((context=τ1057[0]),true,(env=τ1057[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var τp2;var τp3;var body;if(((τ1058 instanceof Array)&&(((τp0=τ1058.length),true)&&((τp0===2)&&(((τp1=τ1058[0]),(τp1==="data"))&&(((τp2=τ1058[1]),(τp3=τ1100(aslist)(τp2)),τp3[0])&&((body=τp3[1]),true))))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return τ595(["multi"],body);});var group=function(xs,classifier){var groups=[];var curr=[];var newgroup=function(){if((curr.length>0)){groups.push(curr);}else{null;}return (curr=[]);};var τ1059=xs;var τ1060=τ1059.length;for(var τ1061=0;(τ1061<τ1060);(τ1061++)){var τ1062=τ1059[τ1061];var x;var other;if(((x=τ1062),true)){if(classifier(x)){newgroup();}else{null;}curr.push(x);}else{if(((other=τ1062),true)){false;}else{throw ["Could not find a match",τ1062];}}}false;newgroup();return groups;};var blocktest_wrap=function(label,expr,accumulator){var value=gensym();return ["multi",["send",["symbol","="],["data",value,["send",["symbol","!!"],["data",["multi",["send",["symbol","|>"],["data",expr,["multi",["send",["symbol","->"],["data",["send",["send",["symbol","?"],["data",["symbol","true"],["void"]]],["symbol","x"]],["send",["send",["symbol","#"],["data",["void"],["symbol","success"]]],["data",["symbol","x"]]]]],["send",["symbol","->"],["data",["send",["send",["symbol","?"],["data",["symbol","false"],["void"]]],["symbol","x"]],["send",["send",["symbol","#"],["data",["void"],["symbol","failure"]]],["data",["symbol","x"]]]]]]]]],["send",["symbol","->"],["data",["symbol","__err"],["send",["send",["symbol","#"],["data",["void"],["symbol","error"]]],["data",["symbol","__err"]]]]]]]]],["send",["send",accumulator,["send",["symbol","."],["data",["void"],["symbol","push"]]]],["data",["send",["send",["symbol","#"],["data",["void"],["symbol","test_result"]]],["data",label,value]]]]];};var blocktest_mac=function(label,tests,acc){var ok=gensym();var stmts=[];stmts.push(["send",["symbol","="],["data",ok,["symbol","true"]]]);var τ1063=tests;var τ1064=τ1063.length;for(var τ1065=0;(τ1065<τ1064);(τ1065++)){var τ1066=τ1063[τ1065];var stmt;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var _;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var new_label;var τp9;var τp10;var new_tests;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var sources;var τp9;var τp10;var clauses;var expr;var other;var τ1067=false;var τ1068=false;var τ1069=false;var τ1070=false;var τ1071=false;var τ1072=false;var τ1073=false;var τ1074=false;if((((stmt=τ1066),true,(τ1066 instanceof Array))&&(((τp0=τ1066.length),true)&&((τp0===3)&&(((τp1=τ1066[0]),(τp1==="send"))&&(((τp2=τ1066[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="do"))&&((_=τ1066[2]),true))))))))))){stmts.push(["send",["symbol","!!"],["data",stmt,["send",["symbol","->"],["data",["symbol","__err"],["multi",["send",["send",acc,["send",["symbol","."],["data",["void"],["symbol","push"]]]],["data",["send",["send",["symbol","#"],["data",["void"],["symbol","error"]]],["data",label,["symbol","__err"]]]]],["send",["symbol",":="],["data",ok,["symbol","false"]]]]]]]]);}else{if(((τ1067=(τ1066 instanceof Array))&&((τ1068=((τp0=τ1066.length),true))&&((τ1069=(τp0===3))&&((τ1070=((τp1=τ1066[0]),(τp1==="send")))&&((τ1071=((τp2=τ1066[1]),(τp2 instanceof Array)))&&((τ1072=((τp3=τp2.length),true))&&((τ1073=(τp3===2))&&((τ1074=((τp4=τp2[0]),(τp4==="symbol")))&&(((τp5=τp2[1]),(τp5==="=>"))&&(((τp6=τ1066[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((new_label=τp6[1]),true,(τp9=τp6[2]),(τp10=τ1100(aslist)(τp9)),τp10[0])&&((new_tests=τp10[1]),true)))))))))))))))){var labv=gensym();stmts.push(["multi",["send",["symbol","="],["data",labv,["send",["symbol","++"],["data",label,["send",["send",["symbol","!"],["data",["symbol","Array"],["void"]]],new_label]]]]],τ595(["multi"],blocktest_mac(labv,new_tests,acc))]);}else{if((τ1074&&(((τp5=τp2[1]),(τp5==="each"))&&(((τp6=τ1066[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(((sources=τp6[1]),true,(τp9=τp6[2]),(τp10=τ1100(aslist)(τp9)),τp10[0])&&((clauses=τp10[1]),true))))))))){var loopvar=gensym();(clauses=function(){var τ1075=[];var τ1076=clauses;var τ1077=τ1076.length;for(var τ1078=0;(τ1078<τ1077);(τ1078++)){var τ1079=τ1076[τ1078];var clause;var other;if(((clause=τ1079),true)){τ1075.push(function(){var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var lhs;var rhs;if(((clause instanceof Array)&&(((τp0=clause.length),true)&&((τp0===3)&&(((τp1=clause[0]),(τp1==="send"))&&(((τp2=clause[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="symbol"))&&(((τp5=τp2[1]),(τp5==="->"))&&(((τp6=clause[2]),(τp6 instanceof Array))&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&((lhs=τp6[1]),true,(rhs=τp6[2]),true))))))))))))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",40237,40274]}));}var x=blocktest_mac(["send",["symbol","++"],["data",label,["data",loopvar]]],τ1100(aslist)(rhs)[1],acc);return ["send",["symbol","->"],["data",lhs,τ595(["multi"],x)]];}());}else{if(((other=τ1079),true)){false;}else{throw ["Could not find a match",τ1079];}}}return τ1075;}());clauses.push(["send",["symbol","->"],["data",["symbol","__no"],["send",["send",acc,["send",["symbol","."],["data",["void"],["symbol","push"]]]],["data",["send",["send",["symbol","#"],["data",["void"],["symbol","error"]]],["data",label,["value","No handler for test case"],["symbol","__no"]]]]]]]);stmts.push(build_each(sources,τ595(["multi"],clauses),["multi"],["multi"],loopvar));}else{if(((expr=τ1066),true)){stmts.push(["send",["symbol","if"],["data",ok,["multi",["send",["symbol","then"],["data",blocktest_wrap(label,expr,acc)]],["send",["symbol","else"],["data",["send",["send",acc,["send",["symbol","."],["data",["void"],["symbol","push"]]]],["data",["send",["send",["symbol","#"],["data",["void"],["symbol","aborted"]]],["data",label,["send",["symbol","'"],["data",["void"],expr]]]]]]]]]]]);}else{if(((other=τ1066),true)){false;}else{throw ["Could not find a match",τ1066];}}}}}}false;stmts.push(acc);return stmts;};stdenv.register_macro("blocktest",function(τ1080,τ1081){var τp0;var context;var env;if(((τ1080 instanceof Array)&&(((τp0=τ1080.length),true)&&((τp0===2)&&((context=τ1080[0]),true,(env=τ1080[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var args;if(((τ1081 instanceof Array)&&(((τp0=τ1081.length),true)&&((τp0>=1)&&(((τp1=τ1081[0]),(τp1==="data"))&&((args=τ1081.slice(1)),true)))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var acc=gensym();var labv=gensym();var stmts=["multi",["send",["symbol","="],["data",acc,["data"]]]];var rval=function(){var τ1082=args;var τp0;var τp1;var τp2;var tests;var τp0;var labels;var τp1;var τp2;var tests;var τ1083=false;var τ1084=false;if(((τ1083=(τ1082 instanceof Array))&&((τ1084=((τp0=τ1082.length),true))&&((τp0===1)&&(((τp1=τ1082[0]),(τp2=τ1100(aslist)(τp1)),τp2[0])&&((tests=τp2[1]),true)))))){stmts.push(["send",["symbol","="],["data",labv,["data"]]]);return (stmts=stmts.concat(blocktest_mac(labv,tests,acc)));}else{if((τ1084&&((τp0===2)&&(((labels=τ1082[0]),true,(τp1=τ1082[1]),(τp2=τ1100(aslist)(τp1)),τp2[0])&&((tests=τp2[1]),true))))){stmts.push(["send",["symbol","="],["data",labv,["send",["send",["symbol","!"],["data",["symbol","Array"],["void"]]],labels]]]);return (stmts=stmts.concat(blocktest_mac(labv,tests,acc)));}else{throw ["Could not find a match",τ1082];}}}();return rval;});stdenv.register_macro("macro",function(τ1085,expr){var τp0;var context;var env;if(((τ1085 instanceof Array)&&(((τp0=τ1085.length),true)&&((τp0===2)&&((context=τ1085[0]),true,(env=τ1085[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var name;var τp6;var τp7;var sname;var args;var body;if(((expr instanceof Array)&&(((τp0=expr.length),true)&&((τp0===3)&&(((τp1=expr[0]),(τp1==="data"))&&(((τp2=expr[1]),(τp2 instanceof Array))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="send"))&&(((τp5=τp2[1]),(name=τp5),true,(τp5 instanceof Array))&&(((τp6=τp5.length),true)&&((τp6===2)&&(((τp7=τp5[0]),(τp7==="symbol"))&&((sname=τp5[1]),true,(args=τp2[2]),true,(body=expr[2]),true)))))))))))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/stdenv.eg",41484,41533]}));}var fn=["send",["symbol","->"],["data",args,body]];var code=generate_from_ast(fn);var efn=eval((("("+code.slice(0,(-1)))+")"));env.register_macro(sname,efn);return ["value",undefined];});stdenv.register_macro("match",function(τ1087,τ1086){var τp0;var context;var env;if(((τ1087 instanceof Array)&&(((τp0=τ1087.length),true)&&((τp0===2)&&((context=τ1087[0]),true,(env=τ1087[1]),true))))){undefined;}else{throw τ1091(τ1092(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ1088=τ1086;var τp0;var τp1;var τp0;var τp1;var obj;var clauses;var τp0;var τp1;var clauses;var τ1089=false;var τ1090=false;if(((τ1089=(τ1088 instanceof Array))&&((τ1090=((τp0=τ1088.length),true))&&((τp0===1)&&((τp1=τ1088[0]),(τp1==="void")))))){return ["placeholder"];}else{if((τ1090&&((τp0===3)&&(((τp1=τ1088[0]),(τp1==="data"))&&((obj=τ1088[1]),true,(clauses=τ1088[2]),true))))){return ["send",["symbol","|>"],["data",obj,clauses]];}else{if((τ1090&&((τp0===2)&&(((τp1=τ1088[0]),(τp1==="data"))&&((clauses=τ1088[1]),true))))){return ["send",["symbol","|>"],["data",["value",null],clauses]];}else{throw ["Could not find a match",τ1088];}}}});var stdprelude=Embedded(["multi",["send",["symbol","="],["data",["send",["symbol","send"],["data",["symbol","obj"],["send",["symbol","and"],["data",["symbol","msg"],["symbol","match"]]]]],["multi",["send",["symbol","->"],["data",["send",["symbol","or"],["data",["send",["symbol","?"],["data",["symbol","String"],["void"]]],["send",["symbol","?"],["data",["symbol","Number"],["void"]]]]],["send",["symbol","___js_fetch"],["data",["symbol","obj"],["symbol","msg"]]]]],["send",["symbol","->"],["data",["symbol","other"],["send",["send",["symbol","obj"],["value","::send"]],["data",["symbol","msg"]]]]]]]],["send",["symbol",":="],["data",["send",["symbol","Array"],["value",":::project"]],["send",["symbol","->"],["data",["data",["send",["symbol","and"],["data",["symbol","value"],["symbol","match"]]]],["multi",["send",["symbol","->"],["data",["send",["symbol","?"],["data",["symbol","Array"],["void"]]],["data",["symbol","true"],["symbol","value"]]]],["send",["symbol","->"],["data",["symbol","_"],["data",["symbol","true"],["data",["symbol","value"]]]]]]]]]],["send",["symbol",":="],["data",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["value","::check"]],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["symbol","if"],["data",["send",["symbol","instanceof"],["data",["symbol","value"],["symbol","Array"]]],["multi",["send",["symbol","then"],["data",["multi",["send",["symbol","for"],["data",["multi",["send",["symbol","="],["data",["symbol","i"],["value",0]]],["send",["symbol","<"],["data",["symbol","i"],["send",["symbol","this"],["send",["symbol","."],["data",["void"],["symbol","length"]]]]]],["send",["symbol","++"],["data",["symbol","i"],["void"]]]],["send",["symbol","if"],["data",["send",["symbol","!="],["data",["send",["symbol","this"],["symbol","i"]],["send",["symbol","value"],["symbol","i"]]]],["send",["symbol","return"],["symbol","false"]]]]]],["symbol","true"]]]],["send",["symbol","else"],["data",["symbol","false"]]]]]]]]]],["send",["symbol",":="],["data",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["value",":::project"]],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["symbol","if"],["data",["send",["symbol","instanceof"],["data",["symbol","value"],["symbol","Array"]]],["multi",["send",["symbol","then"],["data",["multi",["send",["symbol","for"],["data",["multi",["send",["symbol","="],["data",["symbol","i"],["value",0]]],["send",["symbol","<"],["data",["symbol","i"],["send",["symbol","this"],["send",["symbol","."],["data",["void"],["symbol","length"]]]]]],["send",["symbol","++"],["data",["symbol","i"],["void"]]]],["send",["symbol","if"],["data",["send",["symbol","!="],["data",["send",["symbol","this"],["symbol","i"]],["send",["symbol","value"],["symbol","i"]]]],["multi",["send",["symbol","="],["data",["symbol","rval"],["send",["send",["symbol","this"],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["data",["value",0]]]]],["send",["send",["symbol","rval"],["send",["symbol","."],["data",["void"],["symbol","push"]]]],["data",["symbol","value"]]],["send",["symbol","return"],["data",["symbol","true"],["symbol","rval"]]]]]]]],["data",["symbol","true"],["symbol","value"]]]]],["send",["symbol","else"],["data",["multi",["send",["symbol","="],["data",["symbol","rval"],["send",["send",["symbol","this"],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["data",["value",0]]]]],["send",["send",["symbol","rval"],["send",["symbol","."],["data",["void"],["symbol","push"]]]],["data",["symbol","value"]]],["data",["symbol","true"],["symbol","rval"]]]]]]]]]]]],["send",["symbol",":="],["data",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["value",":::deconstruct"]],["send",["symbol","->"],["data",["data",["symbol","value"]],["data",["symbol","true"],["send",["send",["symbol","value"],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["data",["send",["symbol","this"],["send",["symbol","."],["data",["void"],["symbol","length"]]]]]]]]]]],["send",["symbol",":="],["data",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["value","::serialize_ast"]],["send",["symbol","->"],["data",["data"],["send",["send",["symbol","#"],["data",["void"],["symbol","array"]]],["data",["send",["symbol","*"],["data",["void"],["send",["send",["symbol","this"],["send",["symbol","."],["data",["void"],["symbol","map"]]]],["data",["symbol","___serialize_ast"]]]]]]]]]]],["send",["symbol",":="],["data",["send",["send",["symbol","RegExp"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["value","::check"]],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["send",["symbol","value"],["send",["symbol","."],["data",["void"],["symbol","match"]]]],["data",["symbol","this"]]]]]]],["send",["symbol",":="],["data",["send",["send",["symbol","RegExp"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["value",":::project"]],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["symbol","match"],["data",["send",["send",["symbol","value"],["send",["symbol","."],["data",["void"],["symbol","match"]]]],["data",["symbol","this"]]],["multi",["send",["symbol","->"],["data",["send",["send",["symbol","?"],["data",["symbol","null"],["void"]]],["symbol","m"]],["data",["symbol","false"],["symbol","null"]]]],["send",["symbol","->"],["data",["symbol","m"],["data",["symbol","true"],["symbol","m"]]]]]]]]]]],["send",["symbol",":="],["data",["send",["send",["symbol","RegExp"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["value",":::deconstruct"]],["send",["symbol","->"],["data",["data",["symbol","value"]],["send",["symbol","match"],["data",["send",["send",["symbol","value"],["send",["symbol","."],["data",["void"],["symbol","match"]]]],["data",["symbol","this"]]],["multi",["send",["symbol","->"],["data",["send",["send",["symbol","?"],["data",["symbol","null"],["void"]]],["symbol","m"]],["data",["symbol","false"],["symbol","null"]]]],["send",["symbol","->"],["data",["symbol","m"],["data",["symbol","true"],["symbol","m"]]]]]]]]]]],["send",["symbol",":="],["data",["send",["send",["symbol","Function"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["value","::send"]],["send",["symbol","->"],["data",["data",["symbol","args"]],["send",["send",["symbol","this"],["send",["symbol","."],["data",["void"],["symbol","apply"]]]],["data",["symbol","this"],["symbol","args"]]]]]]]]);(exports["stdenv"]=stdenv);(exports["stdprelude"]=stdprelude);
