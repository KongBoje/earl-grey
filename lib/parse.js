var send=function(obj,msg){var __t111=msg;var other;if(((typeof(__t111)==="string")||(typeof(__t111)==="number"))){return obj[msg];}else{if(((other=__t111),true)){return obj["::send"](msg);}else{throw ["Could not find a match",__t111];}}};(Function.prototype["::send"]=function(args){return this.apply(this,args);});var augment=function(dest,values){for(k in values){(dest[k]=send(values,k));}return dest;};var patch_array=function(){var r=[];for(var i=0;(i<arguments.length);(i++)){(r=r.concat(arguments[i]));}return r;};var range=function(from,to){var rval=[];for(var i=from;(i<=to);(i++)){rval.push(i);}return rval;};var StructFactory=function(name){var make=function(){var r=Array.prototype.slice.call(arguments,0);(r["#"]=name);return r;};(make[":::project"]=function(value){if(((value instanceof Array)&&(value["#"]===name))){return [true,value];}else{if(true){return [true,make(value)];}else{return false;}}});(make["::check"]=function(value){if(((value instanceof Array)&&(value["#"]===name))){return true;}else{if(true){return false;}else{return false;}}});(make[":::deconstruct"]=function(value){if(((value instanceof Array)&&(value["#"]===name))){return [true,value.slice(0)];}else{if(true){return [false,false];}else{return false;}}});return make;};var Struct=function(name){var r=Array.prototype.slice.call(arguments,1);(r["#"]=name);return r;};(Struct["::check"]=function(value){if((value instanceof Array)){return (value["#"]!==undefined);}else{if(true){return false;}else{return false;}}});(Struct[":::deconstruct"]=function(value){if(((value instanceof Array)&&(value["#"]!==undefined))){return [true,[value["#"]].concat(value.slice(0))];}else{if(true){return [false,null];}else{return false;}}});var pr_terminus=function(node){var r=HTML(node,"span");var pre=(String.fromCharCode(27)+"[?0;7y+h <div class=\"ug\">");var post=("</div>"+String.fromCharCode(7));return console.log(((pre+r)+post));};var pr=function(__t112,r){var __t113=__t112;var n;var x;if((___checker(Node)(__t113)&&((n=__t113),true))){return pr_terminus(n);}else{if(((x=__t113),true)){return pr_terminus((r||repr)(x));}else{throw ["Could not find a match",__t113];}}};var repr=function(__t115,__t116){var x;var __t114;(x=__t115);true;(__t114=__t115);var recur;var recur;if(((___checker(Function)(__t116)&&((recur=__t116),true))||((recur=repr),true))){(void 0);}else{throw "a condition failed";}var __t117=__t114;var __tp0;var __tp1;var __tp2;var tag;var entries;var entries;var other;if((__t117===true)){return Node(["special","true"],"true");}else{if((__t117===false)){return Node(["special","false"],"false");}else{if((__t117===null)){return Node(["special","nil"],"null");}else{if((__t117===(void 0))){return Node(["special","nil"],"undefined");}else{if((typeof(__t117)==="number")){return Node(["num"],String(x));}else{if((typeof(__t117)==="string")){return Node(["str"],x);}else{if((___checker(Struct)(__t117)&&(((__tp0=___deconstructor(Struct)(__t117)),__tp0[0])&&(((__tp1=__tp0[1]),true,(__tp2=__tp1.length),true)&&((__tp2>=1)&&((tag=__tp1[0]),true,(entries=__tp1.slice(1)),true)))))){return Node(["struct"],[Node(["sym"],tag),Node(["sequence"],function(){var __t118=[];var __t119=entries;var __t120=__t119.length;for(var __t121=0;(__t121<__t120);(__t121++)){var __t122=__t119[__t121];var x;var other;if(((x=__t122),true)){__t118.push(recur(x,repr));}else{if(((other=__t122),true)){false;}else{throw ["Could not find a match",__t122];}}}return __t118;}())]);}else{if((___checker(Array)(__t117)&&((entries=__t117),true))){return Node(["sequence"],function(){var __t123=[];var __t124=entries;var __t125=__t124.length;for(var __t126=0;(__t126<__t125);(__t126++)){var __t127=__t124[__t126];var x;var other;if(((x=__t127),true)){__t123.push(recur(x,repr));}else{if(((other=__t127),true)){false;}else{throw ["Could not find a match",__t127];}}}return __t123;}());}else{if(x["::repr"]){return x["::repr"](recur);}else{if((Object.getPrototypeOf(x)===Object.prototype)){return Node(["table"],function(){var __t128=[];var __t129=items(x);var __t130=__t129.length;for(var __t131=0;(__t131<__t130);(__t131++)){var __t132=__t129[__t131];var __tp0;var k;var v;var other;if(((__t132 instanceof Array)&&((__t132["#"]===undefined)&&(((__tp0=__t132.length),true)&&((__tp0===2)&&((k=__t132[0]),true,(v=__t132[1]),true)))))){__t128.push(Node(["pairing"],[recur(k,repr),recur(v,repr)]));}else{if(((other=__t132),true)){false;}else{throw ["Could not find a match",__t132];}}}return __t128;}());}else{if(((other=__t117),true)){return Node(["unknown"],other.toString());}else{throw ["Could not find a match",__t117];}}}}}}}}}}}};var ___checker=function(type){var __t133=type["::check"];var f;if((__t133===(void 0))){return function(value){return (value instanceof type);};}else{if(((f=__t133),true)){return function(value){return f.call(type,value);};}else{throw ["Could not find a match",__t133];}}};var checker=___checker;var ___projector=function(type){return function(value){var __t134=type[":::project"];var f;if((__t134===(void 0))){var __t135=type["::project"];var f;if((__t135===(void 0))){return [true,type(value)];}else{if(((f=__t135),true)){var __t137;try{(__t137=[true,f(value)]);}catch(__t136){(__t137=[false,null]);}return __t137;}else{throw ["Could not find a match",__t135];}}}else{if(((f=__t134),true)){return f.call(type,value);}else{throw ["Could not find a match",__t134];}}};};var projector=___projector;var ___deconstructor=function(type){return function(value){var __t138=type[":::deconstruct"];var f;if((__t138===(void 0))){var __t139=type["::deconstruct"];var f;if((__t139===(void 0))){if((value instanceof Array)){return [true,value];}else{if(true){return [false,null];}else{return false;}}}else{if(((f=__t139),true)){var __t141;try{(__t141=[true,f.call(type,value)]);}catch(__t140){(__t141=[false,null]);}return __t141;}else{throw ["Could not find a match",__t139];}}}else{if(((f=__t138),true)){return f.call(type,value);}else{throw ["Could not find a match",__t138];}}};};var deconstructor=___deconstructor;(Array[":::project"]=function(value){var __t142=value;var _;if(___checker(Array)(__t142)){return [true,value];}else{if(((_=__t142),true)){return [true,[value]];}else{throw ["Could not find a match",__t142];}}});(RegExp.prototype["::check"]=function(value){return value.match(this);});(RegExp.prototype[":::project"]=function(value){var __t143=value.match(this);var m;var m;if(((__t143===null)&&((m=__t143),true))){return [false,null];}else{if(((m=__t143),true)){return [true,m];}else{throw ["Could not find a match",__t143];}}});(RegExp.prototype[":::deconstruct"]=function(value){var __t144=value.match(this);var m;var m;if(((__t144===null)&&((m=__t144),true))){return [false,null];}else{if(((m=__t144),true)){return [true,m];}else{throw ["Could not find a match",__t144];}}});var Node=function(__t99,__t100){var __tp0;var classes;if((((__tp0=___projector(Array)(__t99)),__tp0[0])&&((classes=__tp0[1]),true))){(void 0);}else{throw "a condition failed";}var __tp0;var children;if((((__tp0=___projector(Array)(__t100)),__tp0[0])&&((children=__tp0[1]),true))){(void 0);}else{throw "a condition failed";}var __t98=function(){if((!___checker(Node)(this))){return Object.create(Node.prototype);}else{return this;}}();(__t98["classes"]=classes.sort());(__t98["children"]=children);return __t98;};augment(Node,({"::check":function(x){return ((x&&x.classes)&&x.children);},"::deconstruct":function(x){return [x.classes,x.children];}}));(Node.prototype["::check"]=function(n){var __t98=this;var __t101=__t98.classes;var __t102=__t101.length;for(var __t103=0;(__t103<__t102);(__t103++)){var __t104=__t101[__t103];var c;var other;if(((c=__t104),true,(n.classes.indexOf(c)===(-1)))){return false;}else{if(((other=__t104),true)){false;}else{throw ["Could not find a match",__t104];}}}false;return true;});Node;var escape_html=function(__t145){var __tp0;var s;if((((__tp0=[true,String(__t145)]),__tp0[0])&&((s=__tp0[1]),true))){(void 0);}else{throw "a condition failed";}var repl=({"&":"&amp;","<":"&lt;",">":"&gt;"});return s.replace(RegExp("[&<>]","g"),function(x){return send(repl,x);});};var quotify=function(__t146){var __tp0;var s;if((((__tp0=[true,String(__t146)]),__tp0[0])&&((s=__tp0[1]),true))){(void 0);}else{throw "a condition failed";}return s.replace(RegExp("[\"\\\\]","g"),function(x){return ("\\"+x);});};var HTML=function(__t147,default_tag){var __t148=__t147;var s;var children;var __tp0;var __tp1;var __tp2;var tags;var children;var other;if(((typeof(__t148)==="string")&&((s=__t148),true))){return escape_html(s);}else{if((___checker(Array)(__t148)&&((children=__t148),true))){return function(){var __t149=[];var __t150=children;var __t151=__t150.length;for(var __t152=0;(__t152<__t151);(__t152++)){var __t153=__t150[__t152];var child;var other;if(((child=__t153),true)){__t149.push(HTML(child,default_tag));}else{if(((other=__t153),true)){false;}else{throw ["Could not find a match",__t153];}}}return __t149;}().join("");}else{if((___checker(Node)(__t148)&&(((__tp0=___deconstructor(Node)(__t148)),__tp0[0])&&(((__tp1=__tp0[1]),true,(__tp2=__tp1.length),true)&&((__tp2===2)&&((tags=__tp1[0]),true,(children=__tp1[1]),true)))))){var tag=(default_tag||"span");var classes=[];var id=null;var kv=[];var sub=[];var __t154=tags;var __t155=__t154.length;for(var __t156=0;(__t156<__t155);(__t156++)){var __t158=__t154[__t156];var __tp0;var __tp1;var __tp2;var k;var v;var __tp0;var __tp1;var __tp2;var k;var __tp0;var __tp1;var __tp2;var _;var m;var __tp0;var __tp1;var __tp2;var _;var m;var s;var other;var __t159=false;var __t160=false;var __t161=false;if(((__t159=(__t158["#"]==="assoc"))&&((__t160=((__tp0=[true,__t158]),__tp0[0]))&&((__t161=((__tp1=__tp0[1]),true,(__tp2=__tp1.length),true))&&((__tp2===2)&&((k=__tp1[0]),true,(v=__tp1[1]),true)))))){kv.push([k,v]);}else{if((__t161&&((__tp2===1)&&((k=__tp1[0]),true)))){kv.push([k,undefined]);}else{if((___checker(RegExp("(?:^\\+((?:.*)))",""))(__t158)&&(((__tp0=___deconstructor(RegExp("(?:^\\+((?:.*)))",""))(__t158)),__tp0[0])&&(((__tp1=__tp0[1]),true,(__tp2=__tp1.length),true)&&((__tp2===2)&&((_=__tp1[0]),true,(m=__tp1[1]),true)))))){(tag=m);}else{if((___checker(RegExp("(?:^#((?:.*)))",""))(__t158)&&(((__tp0=___deconstructor(RegExp("(?:^#((?:.*)))",""))(__t158)),__tp0[0])&&(((__tp1=__tp0[1]),true,(__tp2=__tp1.length),true)&&((__tp2===2)&&((_=__tp1[0]),true,(m=__tp1[1]),true)))))){(id=m);}else{if(((typeof(__t158)==="string")&&((s=__t158),true))){classes.push(s);}else{if(((other=__t158),true)){false;}else{throw ["Could not find a match",__t158];}}}}}}}false;var accum=function(){if((tag==="raw")){return [];}else{return ["<",tag];}}();if(id){(accum=accum.concat(" id=\"",id,"\""));}else{false;}if(classes.length){(accum=accum.concat(" class=\"",quotify(classes.join(" ")),"\""));}else{false;}if(kv){var __t162=[];var __t163=kv;var __t164=__t163.length;for(var __t165=0;(__t165<__t164);(__t165++)){var __t166=__t163[__t165];var __tp0;var k;var v;var other;if(((__t166 instanceof Array)&&((__t166["#"]===undefined)&&(((__tp0=__t166.length),true)&&((__tp0===2)&&((k=__t166[0]),true,(v=__t166[1]),true)))))){__t162.push((accum=accum.concat(function(){if((v!==null)){return [" ",k,"=\"",quotify(v),"\""];}else{return [" ",k];}}())));}else{if(((other=__t166),true)){false;}else{throw ["Could not find a match",__t166];}}}__t162;}else{false;}(children=function(){var __t167=tag;var other;if((__t167==="raw")){var __t168=[];var __t169=children;var __t170=__t169.length;for(var __t171=0;(__t171<__t170);(__t171++)){var __t172=__t169[__t171];var s;var c;var other;if(((typeof(__t172)==="string")&&((s=__t172),true))){__t168.push(s);}else{if(((c=__t172),true)){__t168.push(HTML(c,default_tag));}else{if(((other=__t172),true)){false;}else{throw ["Could not find a match",__t172];}}}}return __t168;}else{if(((other=__t167),true)){var __t173=[];var __t174=children;var __t175=__t174.length;for(var __t176=0;(__t176<__t175);(__t176++)){var __t177=__t174[__t176];var c;var other;if(((c=__t177),true)){__t173.push(HTML(c,default_tag));}else{if(((other=__t177),true)){false;}else{throw ["Could not find a match",__t177];}}}return __t173;}else{throw ["Could not find a match",__t167];}}}());var __t157=tag;var other;if((__t157==="raw")){return accum.concat(children).join("");}else{if(((other=__t157),true)){var x=patch_array([">"],children,["</",tag,">"]);return accum.concat(x).join("");}else{throw ["Could not find a match",__t157];}}}else{if(((other=__t148),true)){return HTML([true,String(other)][1],default_tag);}else{throw ["Could not find a match",__t148];}}}}};var ErrorFactory=function(tags){var __t105=function(){if((!___checker(ErrorFactory)(this))){return Object.create(ErrorFactory.prototype);}else{return this;}}();(__t105["tags"]=tags);return __t105;};augment(ErrorFactory,[]);(ErrorFactory.prototype["create"]=function(){var __t106=Array.prototype.slice.call(arguments,0);var __tp0;var message;var args;if(((__t106 instanceof Array)&&((__t106["#"]===undefined)&&(((__tp0=__t106.length),true)&&((__tp0>=0)&&((message=function(){if((0>=__tp0)){return "";}else{return __t106[0];}}()),true,(args=__t106.slice(1)),true)))))){var __t105=this;var e=Error(message);(e["::tags"]=__t105.tags);(e["args"]=args);(e["name"]=["E"].concat(__t105.tags).join("."));return e;}else{throw ["Could not find a match",__t106];}});(ErrorFactory.prototype["::check"]=function(e){var __t105=this;if(((!e)||(!___checker(Error)(e)))){return false;}else{null;}var tags=(e["::tags"]||[]);var __t107=__t105.tags;var __t108=__t107.length;for(var __t109=0;(__t109<__t108);(__t109++)){var __t110=__t107[__t109];var tag;var other;if(((tag=__t110),true,(tags.indexOf(tag)===(-1)))){return false;}else{if(((other=__t110),true)){false;}else{throw ["Could not find a match",__t110];}}}false;return true;});(ErrorFactory.prototype["::deconstruct"]=function(e){var __t105=this;return e.args;});ErrorFactory;
var __t268=require("./helpers");var aslist=__t268.aslist;var transform=__t268.transform;var __t269=require("./location");var __lt____lt____colon__=__t269["<<:"];var __plus____plus____colon__=__t269["++:"];var MAX=(1/0);var order_map=({"IFX":({"wide":({",":[[15,1],[15,1]],"with":[[15,999],[15,10]],"each":[[15,11],[15,10]],"where":[[15,11],[15,10]],"!!":[[15,11],[15,10]],"|>":[[15,11],[15,10]],"->":[[15,11],[15,10]],"=>":[[15,11],[15,10]],"=":[[15,11],[15,10]],":=":[[15,11],[15,10]],"+=":[[15,11],[15,10]],"-=":[[15,11],[15,10]],"*=":[[15,11],[15,10]],"/=":[[15,11],[15,10]],"<<=":[[15,11],[15,10]],">>=":[[15,11],[15,10]],">>>=":[[15,11],[15,10]],"++=":[[15,11],[15,10]],"?=":[[15,11],[15,10]],"%":[[15,11],[15,10]],"when":[[15,100],[15,101]],"||":[[15,110],[15,111]],"&&":[[15,120],[15,121]],"or":[[15,110],[15,111]],"and":[[15,120],[15,121]],"not":[[15,130],[15,131]],"==":[[15,200],[15,201]],"!=":[[15,200],[15,201]],">=":[[15,200],[15,201]],"<=":[[15,200],[15,201]],">":[[15,200],[15,201]],"<":[[15,200],[15,201]],"^.":[[15,400],[15,401]],"|.":[[15,410],[15,411]],"&.":[[15,420],[15,421]],"<<":[[1,500],[1,501]],">>":[[1,500],[1,501]],">>>":[[1,500],[1,501]],"+":[[1,550],[1,551]],"-":[[1,550],[1,551]],"*":[[1,560],[1,561]],"/":[[1,560],[1,561]],"mod":[[1,560],[1,561]],"**":[[1,571],[1,570]],"DEFAULT":[[8,900],[4,901]],"WHITE":[[15,1002],[15,1001]],":":[[15,1001],[15,2]]}),"short":({"DEFAULT":[[15,1800],[15,1801]],"WHITE":[[15,2000],[15,2001]],",":[[15,1],[15,1]],":":[[15,1001],[15,2]]})}),"PFX":({"wide":({"DEFAULT":[[15,MAX],[15,900]],"when":[[15,MAX],[15,101]],"not":[[15,MAX],[15,131]],".":[[15,MAX],[15,3000]],"#":[[15,MAX],[15,3000]],"~":[[15,MAX],[15,3000]],"@":[[15,MAX],[15,3000]],"<>":[[15,MAX],[15,5]],"(":[[15,MAX],[15,1]],"[":[[15,MAX],[15,1]],"{":[[15,MAX],[15,1]]}),"short":({"DEFAULT":[[15,MAX],[15,1901]],".":[[15,MAX],[15,3000]],"#":[[15,MAX],[15,3000]],"~":[[15,MAX],[15,3000]],"@":[[15,MAX],[15,3000]],"(":[[15,MAX],[15,1]],"[":[[15,MAX],[15,1]],"{":[[15,MAX],[15,1]]})}),"SFX":({"wide":({"DEFAULT":[[15,901],[15,MAX]],")":[[15,1],[15,MAX]],"]":[[15,1],[15,MAX]],"}":[[15,1],[15,MAX]]}),"short":({"DEFAULT":[[15,1900],[15,MAX]],")":[[15,1],[15,MAX]],"]":[[15,1],[15,MAX]],"}":[[15,1],[15,MAX]]})})});var DONE=(-1);var NONE=0;var LEFT=1;var RIGHT=2;var BOTH=3;var oparse=function(next,order,finalize){var between=finalize(next());var right_op=next();var stack=[];var left_op=null;var current=null;while(true){var o=function(){if(((!left_op)&&(!right_op))){return DONE;}else{return ((((!left_op)&&RIGHT)||((!right_op)&&LEFT))||order(left_op,right_op));}}();var __t270=o;var other;if((__t270===DONE)){return between;}else{if((__t270===LEFT)){current.push(between);(between=finalize(current));var v=stack.pop();(left_op=v[0]);(current=v[1]);}else{if((__t270===RIGHT)){stack.push([left_op,current]);(left_op=right_op);(current=[[right_op],between]);(between=finalize(next()));(right_op=next());}else{if((__t270===BOTH)){current[0].push(right_op);current.push(between);(left_op=right_op);(between=finalize(next()));(right_op=next());}else{if(((other=__t270),true)){throw ErrorFactory(["should_never_happen"]).create("undefined priority",({"left":left_op,"right":right_op}));}else{throw ["Could not find a match",__t270];}}}}}}};var consult=function(__t271){var __tp0;var fixity;var width;var op;if(((__t271 instanceof Array)&&((__t271["#"]===undefined)&&(((__tp0=__t271.length),true)&&((__tp0===3)&&((fixity=__t271[0]),true,(width=__t271[1]),true,(op=__t271[2]),true)))))){(void 0);}else{throw "a condition failed";}var map=send(send(order_map,fixity),width);return (send(map,op)||map.DEFAULT);};var order=function(o1,o2){var __tp0;var __tp1;var code1;var ord1;if((((__tp0=consult(o1)[1]),(__tp0 instanceof Array))&&((__tp0["#"]===undefined)&&(((__tp1=__tp0.length),true)&&((__tp1===2)&&((code1=__tp0[0]),true,(ord1=__tp0[1]),true)))))){(void 0);}else{throw "a condition failed";}var __tp0;var __tp1;var code2;var ord2;if((((__tp0=consult(o2)[0]),(__tp0 instanceof Array))&&((__tp0["#"]===undefined)&&(((__tp1=__tp0.length),true)&&((__tp1===2)&&((code2=__tp0[0]),true,(ord2=__tp0[1]),true)))))){(void 0);}else{throw "a condition failed";}var __t272=null;if(((code1&code2)===0)){throw ErrorFactory(["syntax","order"]).create("Cannot mix operators in the given order",({"left":o1,"right":o2}));}else{if((ord1>ord2)){return LEFT;}else{if((ord1<ord2)){return RIGHT;}else{if((ord1===ord2)){return BOTH;}else{throw ["Could not find a match",__t272];}}}}};var finalize=function(__t274){var token;var __t273;(token=__t274);true;(__t273=__t274);var __t275=__t273;var __tp0;var __tp1;var value;var __tp0;var __tp1;var value;var __tp0;var __tp1;var value;var __tp0;var __tp1;var __tp0;var ops;var args;var other;var __t276=false;var __t277=false;var __t278=false;var __t279=false;if(((__t276=(__t275 instanceof Array))&&((__t277=(__t275["#"]===undefined))&&((__t278=((__tp0=__t275.length),true))&&((__t279=(__tp0===2))&&(((__tp1=__t275[0]),(__tp1==="ID"))&&((value=__t275[1]),true))))))){return __lt____lt____colon__(["symbol",value],token);}else{if((__t279&&(((__tp1=__t275[0]),(__tp1==="NUM"))&&((value=__t275[1]),true)))){return __lt____lt____colon__(["value",value],token);}else{if((__t279&&(((__tp1=__t275[0]),(__tp1==="STR"))&&((value=__t275[1]),true)))){return __lt____lt____colon__(["value",value],token);}else{if((__t278&&((__tp0===1)&&((__tp1=__t275[0]),(__tp1==="VOID"))))){return __lt____lt____colon__(["void"],token);}else{if((__t278&&((__tp0>=1)&&((ops=__t275[0]),true,(args=__t275.slice(1)),true)))){var sumloc=ops[0].location;var __t280=ops.slice(1);var __t281=__t280.length;for(var __t282=0;(__t282<__t281);(__t282++)){var __t296=__t280[__t282];var op;var other;if(((op=__t296),true)){(sumloc=__plus____plus____colon__(sumloc,op));}else{if(((other=__t296),true)){false;}else{throw ["Could not find a match",__t296];}}}false;var __t283=args;var __t284=__t283.length;for(var __t285=0;(__t285<__t284);(__t285++)){var __t297=__t283[__t285];var arg;var other;if(((arg=__t297),true)){(sumloc=__plus____plus____colon__(sumloc,arg));}else{if(((other=__t297),true)){false;}else{throw ["Could not find a match",__t297];}}}false;var orig_ops=ops;(ops=function(){var __t298=[];var __t299=ops;var __t300=__t299.length;for(var __t301=0;(__t301<__t300);(__t301++)){var __t302=__t299[__t301];var o;var other;if(((o=__t302),true)){__t298.push(o[2]);}else{if(((other=__t302),true)){false;}else{throw ["Could not find a match",__t302];}}}return __t298;}());var op=ops[0];var __t286=[ops,args];var __tp0;var __tp1;var __tp2;var __tp3;var __tp4;var __tp5;var __tp6;var f;var arg;var body;var __tp0;var __tp1;var __tp2;var __tp3;var __tp4;var __tp5;var f;var body;var __tp0;var __tp1;var __tp2;var __tp3;var __tp4;var __tp5;var target;var __tp6;var _b;var __tp7;var body;var __tp0;var __tp1;var __tp2;var __tp3;var _;var _;var __tp0;var __tp1;var __tp2;var __tp3;var _;var _;var __tp0;var __tp1;var __tp2;var __tp3;var _;var __tp0;var __tp1;var __tp2;var _;var __t287;var other;var __t288=false;var __t289=false;var __t290=false;var __t291=false;var __t292=false;var __t293=false;var __t294=false;var __t295=false;if(((__t288=(__t286 instanceof Array))&&((__t289=(__t286["#"]===undefined))&&((__t290=((__tp0=__t286.length),true))&&((__t291=(__tp0===2))&&((__t292=((__tp1=__t286[0]),(__tp1 instanceof Array)))&&((__t293=(__tp1["#"]===undefined))&&((__t294=((__tp2=__tp1.length),true))&&((__tp2===2)&&(((__tp3=__tp1[0]),(__tp3==="WHITE"))&&(((__tp4=__tp1[1]),(__tp4===":"))&&(((__tp5=__t286[1]),(__tp5 instanceof Array))&&((__tp5["#"]===undefined)&&(((__tp6=__tp5.length),true)&&((__tp6===3)&&((f=__tp5[0]),true,(arg=__tp5[1]),true,(body=__tp5[2]),true)))))))))))))))){return __lt____lt____colon__(["send",f,__lt____lt____colon__(["data",arg,body],__plus____plus____colon__(arg,body))],sumloc);}else{if((__t294&&((__t295=(__tp2===1))&&(((__tp3=__tp1[0]),(__tp3===":"))&&(((__tp4=__t286[1]),(__tp4 instanceof Array))&&((__tp4["#"]===undefined)&&(((__tp5=__tp4.length),true)&&((__tp5===2)&&((f=__tp4[0]),true,(body=__tp4[1]),true))))))))){return __lt____lt____colon__(["send",f,__lt____lt____colon__(["data",body],body)],sumloc);}else{if((__t295&&(((__tp3=__tp1[0]),(__tp3==="with"))&&(((__tp4=__t286[1]),(__tp4 instanceof Array))&&((__tp4["#"]===undefined)&&(((__tp5=__tp4.length),true)&&((__tp5===2)&&(((target=__tp4[0]),true,(__tp6=__tp4[1]),(_b=__tp6),true,(__tp7=___projector(aslist)(__tp6)),__tp7[0])&&((body=__tp7[1]),true))))))))){var inserted=false;var result=transform(target,function(__t304){var expr;var __t303;(expr=__t304);true;(__t303=__t304);var __t305=__t303;var __tp0;var __tp1;var __tp2;var x;var __tp0;var __tp1;var f;var __tp2;var __tp3;var __tp4;var a;var b;var __tp0;var __tp1;var args;if(((__t305 instanceof Array)&&((__t305["#"]===undefined)&&(((__tp0=__t305.length),true)&&((__tp0===2)&&(((__tp1=__t305[0]),(__tp1==="symbol"))&&((__tp2=__t305[1]),(__tp2==="...")))))))){(inserted=true);return __lt____lt____colon__(patch_array(["multi"],body),_b);}else{if((((x=__t305),true,x.fromop)&&((__t305 instanceof Array)&&((__t305["#"]===undefined)&&(((__tp0=__t305.length),true)&&((__tp0===3)&&(((__tp1=__t305[0]),(__tp1==="send"))&&(((f=__t305[1]),true,(__tp2=__t305[2]),(__tp2 instanceof Array))&&((__tp2["#"]===undefined)&&(((__tp3=__tp2.length),true)&&((__tp3===3)&&(((__tp4=__tp2[0]),(__tp4==="data"))&&((a=__tp2[1]),true,(b=__tp2[2]),true))))))))))))){return ["send",this(f),__lt____lt____colon__(["data",this(a),this(b)],__plus____plus____colon__(a,b))];}else{if(((__t305 instanceof Array)&&((__t305["#"]===undefined)&&(((__tp0=__t305.length),true)&&((__tp0>=1)&&(((__tp1=__t305[0]),(__tp1==="data"))&&((args=__t305.slice(1)),true))))))){(tr=this);var res=["data"].concat(patch_array.apply(null,function(){var __t306=[];var __t307=args;var __t308=__t307.length;for(var __t309=0;(__t309<__t308);(__t309++)){var __t310=__t307[__t309];var __tp0;var __tp1;var __tp2;var other;var other;var __t311=false;if(((__t310 instanceof Array)&&((__t310["#"]===undefined)&&(((__tp0=__t310.length),true)&&((__tp0===2)&&(((__tp1=__t310[0]),(__tp1==="symbol"))&&((__tp2=__t310[1]),(__tp2==="...")))))))){__t306.push(((inserted=true),body));}else{if((__t311=((other=__t310),true))){__t306.push([__lt____lt____colon__(tr(other),other)]);}else{if(__t311){false;}else{throw ["Could not find a match",__t310];}}}}return __t306;}()));return __lt____lt____colon__(res,expr);}else{throw ["Could not find a match",__t305];}}}});if((!inserted)){var __t312=target;var __tp0;var __tp1;var __tp0;var __tp1;var f;var __tp2;var orig_args;var __tp3;var __tp4;var args;var __tp0;var __tp1;var args;var other;var __t313=false;var __t314=false;var __t315=false;if(((__t312 instanceof Array)&&((__t312["#"]===undefined)&&(((__tp0=__t312.length),true)&&((__tp0===1)&&((__tp1=__t312[0]),(__tp1==="void"))))))){return __lt____lt____colon__(patch_array(["data"],body),sumloc);}else{if(target.fromop){return __lt____lt____colon__(["send",target,__lt____lt____colon__(patch_array(["data"],body),_b)],sumloc);}else{if(((__t313=(__t312 instanceof Array))&&((__t314=(__t312["#"]===undefined))&&((__t315=((__tp0=__t312.length),true))&&((__tp0===3)&&(((__tp1=__t312[0]),(__tp1==="send"))&&(((f=__t312[1]),true,(__tp2=__t312[2]),(orig_args=__tp2),true,(__tp2 instanceof Array))&&((__tp2["#"]===undefined)&&(((__tp3=__tp2.length),true)&&((__tp3>=1)&&(((__tp4=__tp2[0]),(__tp4==="data"))&&((args=__tp2.slice(1)),true)))))))))))){return __lt____lt____colon__(["send",f,__lt____lt____colon__(patch_array(["data"],args,body),__plus____plus____colon__(orig_args,_b))],sumloc);}else{if((__t315&&((__tp0>=1)&&(((__tp1=__t312[0]),(__tp1==="data"))&&((args=__t312.slice(1)),true))))){return __lt____lt____colon__(target.concat(body),sumloc);}else{if(((other=__t312),true)){return __lt____lt____colon__(["send",target,__lt____lt____colon__(patch_array(["data"],body),_b)],sumloc);}else{throw ["Could not find a match",__t312];}}}}}}else{return __lt____lt____colon__(result,sumloc);}}else{if((__t294&&((__t295=(__tp2>=1))&&(((__tp3=__tp1[0]),((__tp3==="[")||(__tp3===",")))&&((_=__tp1.slice(1)),true,(_=__t286[1]),true))))){if((op==="[")){(args=args.slice(1,(-1)));}else{null;}(args=function(){var f=function(__t316){var __t317=__t316;var __tp0;var __tp1;var other;if(((__t317 instanceof Array)&&((__t317["#"]===undefined)&&(((__tp0=__t317.length),true)&&((__tp0===1)&&((__tp1=__t317[0]),(__tp1==="void"))))))){return false;}else{if(((other=__t317),true)){return true;}else{throw ["Could not find a match",__t317];}}};return args.filter(f);}());var result=function(){var __t318=args;var __tp0;var __tp0;var x;var other;var __t319=false;var __t320=false;var __t321=false;if(((__t319=(__t318 instanceof Array))&&((__t320=(__t318["#"]===undefined))&&((__t321=((__tp0=__t318.length),true))&&(__tp0===0))))){return ["value",undefined];}else{if((__t321&&((__tp0===1)&&((x=__t318[0]),true)))){return x;}else{if(((other=__t318),true)){return patch_array(["multi"],args);}else{throw ["Could not find a match",__t318];}}}}();return __lt____lt____colon__(result,sumloc);}else{if((__t295&&(((__tp3=__tp1[0]),(__tp3==="{"))&&((_=__tp1.slice(1)),true,(_=__t286[1]),true)))){var f=function(__t322){var __t323=__t322;var __tp0;var __tp1;var other;if(((__t323 instanceof Array)&&((__t323["#"]===undefined)&&(((__tp0=__t323.length),true)&&((__tp0===1)&&((__tp1=__t323[0]),(__tp1==="void"))))))){return false;}else{if(((other=__t323),true)){return true;}else{throw ["Could not find a match",__t323];}}};return __lt____lt____colon__(patch_array(["data"],args.slice(1,(-1)).filter(f)),sumloc);}else{if((__t294&&((__t295=(__tp2===1))&&(((__tp3=__tp1[0]),(__tp3==="WHITE"))&&((_=__t286[1]),true))))){return __lt____lt____colon__(patch_array(["send"],args),sumloc);}else{if((__t295&&((_=__tp1[0]),true,(__t287=__t286[1]),true))){var __t324=__t287;var __tp0;var __tp1;var __tp2;var __tp3;var __tp4;var __tp5;var __tp6;var __tp0;var a;var b;var __t325=false;var __t326=false;var __t327=false;var __t328=false;if(((__t325=(__t324 instanceof Array))&&((__t326=(__t324["#"]===undefined))&&((__t327=((__tp0=__t324.length),true))&&((__t328=(__tp0===2))&&(((__tp1=__t324[0]),(__tp1 instanceof Array))&&((__tp1["#"]===undefined)&&(((__tp2=__tp1.length),true)&&((__tp2===1)&&(((__tp3=__tp1[0]),(__tp3==="void"))&&(((__tp4=__t324[1]),(__tp4 instanceof Array))&&((__tp4["#"]===undefined)&&(((__tp5=__tp4.length),true)&&((__tp5===1)&&((__tp6=__tp4[0]),(__tp6==="void")))))))))))))))){return __lt____lt____colon__(["symbol",op],orig_ops[0]);}else{if((__t328&&((a=__t324[0]),true,(b=__t324[1]),true))){var oloc=orig_ops[0].location;var abloc=__plus____plus____colon__(a,b);var oabloc=__plus____plus____colon__(orig_ops[0],abloc);var rval=__lt____lt____colon__(["send",__lt____lt____colon__(["symbol",op],oloc),__lt____lt____colon__(["data",a,b],abloc)],__plus____plus____colon__(oloc,abloc));(rval["fromop"]=true);return rval;}else{throw ["Could not find a match",__t324];}}}else{if(((other=__t286),true)){throw ErrorFactory(["should_never_happen"]).create("unknown node",({"node":token}));}else{throw ["Could not find a match",__t286];}}}}}}}}}else{if(((other=__t275),true)){throw ErrorFactory(["should_never_happen"]).create("unknown node (B)",({"node":token}));}else{throw ["Could not find a match",__t275];}}}}}}};var parse=function(tokens){var next=function(){return tokens.shift();};return oparse(next,order,finalize);};(exports["parse"]=parse);
