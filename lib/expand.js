var $980=function(type$982){var f$985;(f$985=type$982["::check"]);;if((f$985===(void 0))){return function(value$990){return (value$990 instanceof type$982);};}else{return function(value$993){return f$985.call(type$982,value$993);};}};
var $995=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $996=function(dest$998,values$999){var k$1004;(k$1004=null);$1002:for(k$1004 in values$999){if(values$999.hasOwnProperty(k$1004)){(dest$998[k$1004]=values$999[k$1004]);}}return dest$998;};
var $1008=function($1009$1011){var ph$1015;(ph$1015=$1009$1011);;var $1013$1020;($1013$1020=ph$1015);;var bridge$1014$1025;var x$1029;(bridge$1014$1025=$1013$1020);if((((typeof(bridge$1014$1025)==="string")&&((x$1029=bridge$1014$1025),true))||((typeof(bridge$1014$1025)==="number")&&((x$1029=bridge$1014$1025),true)))){return ["value",x$1029];}else{var other$1036;(other$1036=$1013$1020);return other$1036["::serialize_ast"]();}};
var send$820;(send$820=function(obj$825,$823$826){var ph$830;var msg$831;var t0$833;(t0$833=$823$826);(msg$831=t0$833);(ph$830=t0$833);;var $828$837;($828$837=ph$830);;var bridge$829$842;(bridge$829$842=$828$837);if(((typeof(bridge$829$842)==="string")||(typeof(bridge$829$842)==="number"))){return obj$825[msg$831];}else{var other$850;(other$850=$828$837);return obj$825["::send"](msg$831);}});;(Array[":::project"]=function($853$855){var ph$858;var value$859;var t0$861;(t0$861=$853$855);(value$859=t0$861);(ph$858=t0$861);;var $857$865;($857$865=ph$858);;if($980(Array)($857$865)){return [true,value$859];}else{$857$865;return [true,[value$859]];}});(Array.prototype["::check"]=function(value$879){if((value$879 instanceof Array)){var i$884;(i$884=0);;$882:for(;(i$884<this.length);(i$884++)){if(($995(this,i$884)!==$995(value$879,i$884))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $996(this.slice(0),this);});(Array.prototype[":::project"]=function(value$895){if((value$895 instanceof Array)){var i$900;(i$900=0);;$898:for(;(i$900<this.length);(i$900++)){if(($995(this,i$900)!==$995(value$895,i$900))){return [true,[value$895]];}}return [true,value$895.slice(this.length)];}else{return [true,[value$895]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($1008));});(RegExp.prototype["::check"]=function($910$912){var ph$915;(ph$915=$910$912);;var $914$920;($914$920=ph$915);;var value$928;if((typeof($914$920)==="string")){(value$928=$914$920);if(value$928.match(this)){return true;}else{return false;}}else{var other$933;(other$933=$914$920);return false;}});(RegExp.prototype[":::project"]=function($935$937){var ph$940;(ph$940=$935$937);;var $939$945;($939$945=ph$940);;var value$953;if((typeof($939$945)==="string")){(value$953=$939$945);var $956$958;($956$958=value$953.match(this));;var m$966;if(($956$958===null)){(m$966=$956$958);return [false,null];}else{var m$971;(m$971=$956$958);return [true,m$971];}}else{var other$975;(other$975=$939$945);return [false,null];}});(Function.prototype["::send"]=function(args$978){return this.apply(this,args$978);});
var $3254=function(arr$3256){var results$3260;var l$3261;(results$3260=[]);;(l$3261=arr$3256.length);;var i$3269;(i$3269=0);;$3259:for(;(i$3269<l$3261);(i$3269++)){results$3260.push([i$3269,$995(arr$3256,i$3269)]);}return results$3260;};
var $3085=function(){var $3086$3088;($3086$3088=function(tags$3092){var it$0$3095;(it$0$3095=function(){if((!$980($3086$3088)(this))){return Object.create($3086$3088.prototype);}else{return this;}}());;(it$0$3095["tags"]=tags$3092);return it$0$3095;});;($3086$3088.prototype["create"]=function(){var $3104$3106;($3104$3106=arguments);;var t0$3111;var message$3115;var args$3116;(t0$3111=$3104$3106.length);if((t0$3111>=0)){(message$3115=function(){if((0>=t0$3111)){return "";}else{return $3104$3106[0];}}());(args$3116=Array.prototype.slice.call($3104$3106,1));var it$0$3120;(it$0$3120=this);;var self$3125;(self$3125=this);;var e$3130;(e$3130=Error(message$3115));;(e$3130["::tags"]=it$0$3120.tags);(e$3130["args"]=args$3116);var temp$3138;(temp$3138=$3254(args$3116));;var $length$3143;($length$3143=temp$3138.length);;var $index$3148;($index$3148=0);;$3131:for(;($index$3148<$length$3143);($index$3148++)){var m$3156;(m$3156=temp$3138[$index$3148]);;var t0$3161;var t1$3162;var i$3166;var arg$3167;(t0$3161=m$3156);if(((t0$3161 instanceof Array)&&((t1$3162=t0$3161.length),(t1$3162===2)))){(i$3166=t0$3161[0]);(arg$3167=t0$3161[1]);(e$3130[i$3166]=arg$3167);}else{$3072(m$3156);;}}(e$3130["length"]=args$3116.length);(e$3130["name"]=["E"].concat(it$0$3120.tags).join("."));return e$3130;}else{$3072($3104$3106);}});($3086$3088.prototype["::check"]=function(e$3178){var it$0$3181;(it$0$3181=this);;var self$3186;(self$3186=this);;var tags$3191;if(((!e$3178)||(!$980(Error)(e$3178)))){return false;}(tags$3191=(e$3178["::tags"]||[]));;var temp$3200;(temp$3200=it$0$3181.tags);;var $length$3205;($length$3205=temp$3200.length);;var $index$3210;($index$3210=0);;$3192:for(;($index$3210<$length$3205);($index$3210++)){var m$3218;(m$3218=temp$3200[$index$3210]);;var tag$3226;(tag$3226=m$3218);if((tags$3191.indexOf(tag$3226)===-1)){return false;}else{false;;}}return true;});($3086$3088.prototype["::deconstruct"]=function(e$3234){var it$0$3237;(it$0$3237=this);;var self$3242;(self$3242=this);;return e$3234.args;});$996($3086$3088,$996(function(){var accum$3247;(accum$3247=({}));(accum$3247["::name"]="$3086");return accum$3247;}(),function(){var accum$3251;(accum$3251=({}));(accum$3251["::egclass"]=true);return accum$3251;}()));return $3086$3088;}();
var $3072=function(value$3074,url$3075,start$3076,end$3077){var err$3080;(err$3080=$3085(["match"]).create("Could not find a match for value",({"value":value$3074})));;if(url$3075){(err$3080["location"]=["location",url$3075,start$3076,end$3077]);}throw err$3080;};
var $3276=function($3277$3279,key$3280){var ph$3284;(ph$3284=$3277$3279);;var $3282$3289;($3282$3289=ph$3284);;var bridge$3283$3294;(bridge$3283$3294=$3282$3289);if(((bridge$3283$3294===null)||(bridge$3283$3294===(void 0)))){return false;}else{var x$3302;if((typeof($3282$3289)==="string")){(x$3302=$3282$3289);return (key$3280 in String.prototype);}else{var x$3307;if((typeof($3282$3289)==="number")){(x$3307=$3282$3289);return (key$3280 in Number.prototype);}else{var x$3312;(x$3312=$3282$3289);return (key$3280 in x$3312);}}}};
var $3314=function(obj$3316){var results$3320;(results$3320=[]);;var k$3325;(k$3325=null);$3319:for(k$3325 in obj$3316){if(Object.prototype.hasOwnProperty.call(obj$3316,k$3325)){results$3320.push([k$3325,$995(obj$3316,k$3325)]);}}return results$3320;};
var $3329=function(type$3331){return function(value$3334){var f$3337;(f$3337=type$3331[":::project"]);;if((f$3337===(void 0))){(f$3337=type$3331["::project"]);if((f$3337===(void 0))){return [true,type$3331(value$3334)];}else{var rval$3343;(rval$3343=false);;try{(rval$3343=[true,f$3337(value$3334)]);}catch(excv$3349){var e$3355;(e$3355=excv$3349);(rval$3343=[false,null]);}return rval$3343;}}else{return f$3337.call(type$3331,value$3334);}};};var accum$1263;var accum$1267;var accum$1556;var accum$1560;var accum$2953;var accum$2957;var $1040$1044;var __lt____gt__$1045;var $1041$1046;var __lt____lt____colon__$1047;var util$1048;var classify$1049;var neighbours$1050;var GenSym$1051;var gensym$1052;var uuid$1053;var $1043$1054;var PatternParser$1055;var PatternProcessor$1056;var Scope$1057;var Env$1058;var track_location$1059;var Expander$1060;var mac1$1061;var __chk_ncache$1062;var __chk_scache$1063;var checker_db$1064;($1040$1044=require("./pp"));;(__lt____gt__$1045=$1040$1044["<>"]);;($1041$1046=require("./location"));;(__lt____lt____colon__$1047=$1041$1046["<<:"]);;(util$1048=require("./util"));;(classify$1049=util$1048.classify);;(neighbours$1050=util$1048.neighbours);;(GenSym$1051=util$1048.GenSym);;(gensym$1052=util$1048.gensym);;(uuid$1053=util$1048.uuid);;($1043$1054=require("./pattern"));;(PatternParser$1055=$1043$1054.PatternParser);;(PatternProcessor$1056=$1043$1054.PatternProcessor);;(Scope$1057=function(){var it$0$1124;var parent$1118;var name$1119;var expander$1120;var t0$1114;var $1107$1109;($1107$1109=arguments);;(t0$1114=$1107$1109.length);if(((t0$1114>=0)&&(t0$1114<=3))){(parent$1118=function(){if((0>=t0$1114)){return null;}else{return $1107$1109[0];}}());(name$1119=function(){if((1>=t0$1114)){return null;}else{return $1107$1109[1];}}());(expander$1120=function(){if((2>=t0$1114)){return null;}else{return $1107$1109[2];}}());(it$0$1124=function(){if((!$980(Scope$1057)(this))){return Object.create(Scope$1057.prototype);}else{return this;}}());;(it$0$1124["name"]=(name$1119||gensym$1052("scope")));(it$0$1124["parent"]=parent$1118);(it$0$1124["options"]=({}));(it$0$1124["expander"]=(expander$1120||parent$1118.expander));return it$0$1124;}else{$3072($1107$1109);}});;(Scope$1057.prototype["getopt"]=function(opt$1136){var otherwise$1168;var $1145$1157;var $1144$1151;var self$1146;var it$0$1139;(it$0$1139=this);;(self$1146=this);;($1144$1151=null);;$1144$1151;if(Object.prototype.hasOwnProperty.call(it$0$1139.options,opt$1136)){return $995(it$0$1139.options,opt$1136);}else{if((it$0$1139.parent===null)){return (void 0);}else{(otherwise$1168=$1144$1151);return it$0$1139.parent.getopt(opt$1136);}}});(Scope$1057.prototype["setopt"]=function(opt$1173,value$1174){var self$1182;var it$0$1177;(it$0$1177=this);;(self$1182=this);;return (it$0$1177.options[opt$1173]=value$1174);});(Scope$1057.prototype["gensym"]=function(){var self$1196;var it$0$1191;(it$0$1191=this);;(self$1196=this);;return it$0$1191.expander.gensym();});(Scope$1057.prototype["step"]=function(context$1203,expr$1204){var self$1212;var it$0$1207;(it$0$1207=this);;(self$1212=this);;return it$0$1207.expander.step(context$1203,it$0$1207,expr$1204);});(Scope$1057.prototype["step_all"]=function(context$1219,exprs$1220){var self$1228;var it$0$1223;(it$0$1223=this);;(self$1228=this);;return it$0$1223.expander.step_all(context$1219,it$0$1223,exprs$1220);});(Scope$1057.prototype["expand"]=function(context$1235,expr$1236){var self$1244;var it$0$1239;(it$0$1239=this);;(self$1244=this);;return it$0$1239.expander.expand(context$1235,it$0$1239,expr$1236);});(Scope$1057.prototype["toString"]=function(){var self$1258;var it$0$1253;(it$0$1253=this);;(self$1258=this);;return (("Scope{"+it$0$1253.name)+"}");});$996(Scope$1057,$996(((accum$1263=({})),((accum$1263["::name"]="Scope"),accum$1263)),((accum$1267=({})),((accum$1267["::egclass"]=true),accum$1267))));Scope$1057;(Env$1058=function(){var it$0$1275;(it$0$1275=function(){if((!$980(Env$1058)(this))){return Object.create(Env$1058.prototype);}else{return this;}}());;(it$0$1275["scopes"]=({}));return it$0$1275;});;(Env$1058.prototype["resolve"]=function(scope$1284,name$1285){var scope_data$1298;var self$1293;var it$0$1288;(it$0$1288=this);;(self$1293=this);;if((scope$1284===null)){return (void 0);}(scope_data$1298=$995(it$0$1288.scopes,scope$1284.name));;if((scope_data$1298&&Object.prototype.hasOwnProperty.call(scope_data$1298,name$1285))){return $995(scope_data$1298,name$1285);}else{return it$0$1288.resolve(scope$1284.parent,name$1285);}});(Env$1058.prototype["bind"]=function(scope$1306,name$1307,value$1308){var self$1316;var it$0$1311;(it$0$1311=this);;(self$1316=this);;if((!$995(it$0$1311.scopes,scope$1306.name))){(it$0$1311.scopes[scope$1306.name]=({}));}return ($995(it$0$1311.scopes,scope$1306.name)[name$1307]=value$1308);});(Env$1058.prototype["convert"]=function(expr$1325){var x$1369;var x$1374;var bridge$1337$1366;var x$1379;var bridge$1336$1363;var x$1384;var bridge$1335$1360;var x$1389;var $index$1416;var $length$1411;var temp$1406;var other$1436;var type$1396;var args$1397;var e$1353;var bridge$1334$1348;var t0$1349;var $1333$1343;var self$1338;var it$0$1328;(it$0$1328=this);;(self$1338=this);;($1333$1343=expr$1325);;if($3276($1333$1343,"env")){(e$1353=$1333$1343.env);return expr$1325;}else{(bridge$1334$1348=$1333$1343);if((((bridge$1335$1360=bridge$1334$1348),(((bridge$1336$1363=bridge$1335$1360),(((bridge$1337$1366=bridge$1336$1363),((((x$1369=bridge$1337$1366)),((x$1369 instanceof Array)&&(x$1369[0]==="symbol")))||(((x$1374=bridge$1337$1366)),((x$1374 instanceof Array)&&(x$1374[0]==="value")))))||(((x$1379=bridge$1336$1363)),((x$1379 instanceof Array)&&(x$1379[0]==="variable")))))||(((x$1384=bridge$1335$1360)),((x$1384 instanceof Array)&&(x$1384[0]==="macro")))))||(((x$1389=bridge$1334$1348)),((x$1389 instanceof Array)&&(x$1389[0]==="void"))))){return $996(expr$1325,({"env":it$0$1328}));}else{if((($1333$1343 instanceof Array)&&((t0$1349=$1333$1343.length),(t0$1349>=1)))){(type$1396=$1333$1343[0]);(args$1397=Array.prototype.slice.call($1333$1343,1));(temp$1406=args$1397);;($length$1411=temp$1406.length);;($index$1416=0);;$1402:for(;($index$1416<$length$1411);($index$1416++)){var arg$1432;var m$1424;(m$1424=temp$1406[$index$1416]);;(arg$1432=m$1424);it$0$1328.convert(arg$1432);}return $996(expr$1325,({"env":it$0$1328}));}else{(other$1436=$1333$1343);return $996(expr$1325,({"env":it$0$1328}));}}}});(Env$1058.prototype["fork"]=function(){var $index$1471;var $length$1466;var temp$1461;var e$1453;var self$1448;var it$0$1443;(it$0$1443=this);;(self$1448=this);;(e$1453=Env$1058());;(temp$1461=$3314(it$0$1443.scopes));;($length$1466=temp$1461.length);;($index$1471=0);;$1454:for(;($index$1471<$length$1466);($index$1471++)){var $index$1512;var $length$1507;var temp$1502;var acc$1497;var scope$1489;var bindings$1490;var t0$1484;var t1$1485;var m$1479;(m$1479=temp$1461[$index$1471]);;(t0$1484=m$1479);if(((t0$1484 instanceof Array)&&((t1$1485=t0$1484.length),(t1$1485===2)))){(scope$1489=t0$1484[0]);(bindings$1490=t0$1484[1]);(acc$1497=[]);;(temp$1502=$3314(bindings$1490));;($length$1507=temp$1502.length);;($index$1512=0);;$1494:for(;($index$1512<$length$1507);($index$1512++)){var k$1530;var v$1531;var t0$1525;var t1$1526;var m$1520;(m$1520=temp$1502[$index$1512]);;(t0$1525=m$1520);if(((t0$1525 instanceof Array)&&((t1$1526=t0$1525.length),(t1$1526===2)))){(k$1530=t0$1525[0]);(v$1531=t0$1525[1]);acc$1497.push((function(){if((!$995(e$1453.scopes,scope$1489))){return (e$1453.scopes[scope$1489]=({}));}}(),($995(e$1453.scopes,scope$1489)[k$1530]=v$1531)));}else{$3072(m$1520,"/home/olivier/git/earl-grey/src/expand.eg",2010,2169);;}}acc$1497;}else{$3072(m$1479,"/home/olivier/git/earl-grey/src/expand.eg",1970,2169);;}}return e$1453;});(Env$1058.prototype["toString"]=function(){var self$1551;var it$0$1546;(it$0$1546=this);;(self$1551=this);;return "Env{...}";});$996(Env$1058,$996(((accum$1556=({})),((accum$1556["::name"]="Env"),accum$1556)),((accum$1560=({})),((accum$1560["::egclass"]=true),accum$1560))));Env$1058;(track_location$1059=function(f$1566){var f2$1569;(f2$1569=function(context$1573,scope$1574,expr$1575){var rval$1583;var other$1615;var v$1609;var t0$1605;var $1578$1600;var rval$1579;(rval$1579=(((rval$1583=false)),(function(){try{(rval$1583=f$1566(context$1573,scope$1574,expr$1575));}catch(excv$1589){var e$1595;(e$1595=excv$1589);(rval$1583=(__lt____lt____colon__$1047(e$1595,expr$1575),function(){throw e$1595;}()));}}(),rval$1583)));;($1578$1600=rval$1579);;if((($1578$1600 instanceof Array)&&((t0$1605=$1578$1600.length),((t0$1605===2)&&($1578$1600[0]==="bounce"))))){(v$1609=$1578$1600[1]);return f2$1569(context$1573,scope$1574,__lt____lt____colon__$1047(v$1609,expr$1575));}else{(other$1615=$1578$1600);return __lt____lt____colon__$1047(other$1615,expr$1575);}});;return f2$1569;});;(Expander$1060=function(env_factory$1622,generic_nodes$1623){var it$0$1626;(it$0$1626=function(){if((!$980(Expander$1060)(this))){return Object.create(Expander$1060.prototype);}else{return this;}}());;(it$0$1626["gensym"]=gensym$1052);(it$0$1626["mkenv"]=env_factory$1622);(it$0$1626["generic_nodes"]=generic_nodes$1623);return it$0$1626;});;(Expander$1060.prototype["run_macro"]=function(m$1636,context$1637,scope$1638,form$1639,arg$1640){var rval$1657;var rval$1653;var self$1648;var it$0$1643;(it$0$1643=this);;(self$1648=this);;(rval$1653=(((rval$1657=false)),(function(){try{(rval$1657=m$1636(context$1637,scope$1638,form$1639,arg$1640));}catch(excv$1663){var msg$1696;var msg$1791;var find$1705;var err$1706;var other$1702;var $1683$1685;var e$1680;var e$1798;var value$1673;var t0$1666;var t1$1667;var t2$1668;var t3$1669;(t0$1666=excv$1663);if(($980($3085(["match"]))(t0$1666)&&($3276(t0$1666,"args")&&((t1$1667=t0$1666.args),((t1$1667 instanceof Array)&&((t2$1668=t1$1667.length),((t2$1668===1)&&((t3$1669=t1$1667[0]),$3276(t3$1669,"value"))))))))){(value$1673=t3$1669.value);(rval$1657=(((e$1680=((($1683$1685=value$1673)),function(){if(($1683$1685===context$1637)){(msg$1696="The macro cannot be found in this context.");;return $3085(["syntax","context"]).create(msg$1696,({"context":context$1637,"form":form$1639}));}else{(other$1702=$1683$1685);(find$1705=function($1709$1711){var t0$1717;var msg$1733;var $index$1759;var $length$1754;var temp$1749;var other$1784;var type$1739;var xs$1740;var t0$1726;var $1713$1721;var ph$1714;var arg$1715;(t0$1717=$1709$1711);(arg$1715=t0$1717);(ph$1714=t0$1717);;($1713$1721=ph$1714);;if(($1713$1721===value$1673)){(msg$1733="The macro could not match its argument (or part of it).");;return $3085(["syntax","argument"]).create(msg$1733,({"context":context$1637,"argument":arg$1715,"form":form$1639}));}else{if((($1713$1721 instanceof Array)&&((t0$1726=$1713$1721.length),(t0$1726>=1)))){(type$1739=$1713$1721[0]);(xs$1740=Array.prototype.slice.call($1713$1721,1));(temp$1749=xs$1740);;($length$1754=temp$1749.length);;($index$1759=0);;$1745:for(;($index$1759<$length$1754);($index$1759++)){var x$1776;var t0$1772;var m$1767;(m$1767=temp$1749[$index$1759]);;(t0$1772=$3329(find$1705)(m$1767));if(t0$1772[0]){(x$1776=t0$1772[1]);if(x$1776){return x$1776;}}else{$3072(m$1767,"/home/olivier/git/earl-grey/src/expand.eg",3447,3532);;}}return false;}else{(other$1784=$1713$1721);return false;}}});;(err$1706=find$1705(arg$1640));;if(err$1706){return err$1706;}else{(msg$1791="The macro failed because it failed to match some value, probably one that it generated itself.");;return $3085(["syntax","failure"]).create(msg$1791,({"form":form$1639,"value":value$1673}));}}}()))),function(){throw e$1680;}()));}else{(e$1798=excv$1663);(rval$1657=function(){throw e$1798;}());}}}(),rval$1657)));;return it$0$1643.mkenv().convert(rval$1653);});(Expander$1060.prototype["step"]=function(context$1804,scope$1805,expr$1806){var helper$1819;var self$1814;var it$0$1809;(it$0$1809=this);;(self$1814=this);;(helper$1819=track_location$1059(function(context$1824,scope$1825,$1822$1826){var t0$1835;var other$1875;var env$1870;var $1860$1862;var other$1908;var t0$1899;var $1892$1894;var other$1912;var m$1888;var t0$1884;var $1856$1879;var env$1857;var other$1935;var t0$1926;var $1919$1921;var other$1960;var m$1954;var t0$1950;var $1943$1945;var other$1969;var x$1964;var f$1939;var arg$1940;var m$1916;var s$1851;var $1829$1846;var $1830$1847;var $1831$1848;var t0$1844;var $1828$1839;var ph$1832;var expr$1833;(t0$1835=$1822$1826);(expr$1833=t0$1835);(ph$1832=t0$1835);;($1828$1839=ph$1832);;if((($1829$1846=($1828$1839 instanceof Array))&&((t0$1844=$1828$1839.length),(($1831$1848=(t0$1844===2))&&($1828$1839[0]==="symbol"))))){(s$1851=$1828$1839[1]);(env$1857=((($1860$1862=expr$1833)),function(){if($3276($1860$1862,"env")){(env$1870=$1860$1862.env);return expr$1833.env;}else{(other$1875=$1860$1862);throw $3085(["syntax","no_env"]).create("No environment was found to resolve",({"symbol":expr$1833}));}}()));;($1856$1879=env$1857.resolve(scope$1825,s$1851));;if((($1856$1879 instanceof Array)&&((t0$1884=$1856$1879.length),((t0$1884===2)&&($1856$1879[0]==="macro"))))){(m$1888=$1856$1879[1]);($1892$1894=context$1824);;if((($1892$1894 instanceof Array)&&((t0$1899=$1892$1894.length),((t0$1899===2)&&(($1892$1894[0]==="expr")&&($1892$1894[1]==="head")))))){return ["macro",m$1888];}else{(other$1908=$1892$1894);return ["bounce",it$0$1809.run_macro(m$1888,context$1824,scope$1825,expr$1833,__lt____lt____colon__$1047(["void"],expr$1833))];}}else{(other$1912=$1856$1879);return expr$1833;}}else{if(($1831$1848&&($1828$1839[0]==="macro"))){(m$1916=$1828$1839[1]);($1919$1921=context$1824);;if((($1919$1921 instanceof Array)&&((t0$1926=$1919$1921.length),((t0$1926===2)&&(($1919$1921[0]==="expr")&&($1919$1921[1]==="head")))))){return expr$1833;}else{(other$1935=$1919$1921);return ["bounce",it$0$1809.run_macro(m$1916,context$1824,scope$1825,expr$1833,__lt____lt____colon__$1047(["void"],expr$1833))];}}else{if(($1829$1846&&((t0$1844===3)&&($1828$1839[0]==="send")))){(f$1939=$1828$1839[1]);(arg$1940=$1828$1839[2]);($1943$1945=helper$1819(["expr","head"],scope$1825,f$1939));;if((($1943$1945 instanceof Array)&&((t0$1950=$1943$1945.length),((t0$1950===2)&&($1943$1945[0]==="macro"))))){(m$1954=$1943$1945[1]);return ["bounce",it$0$1809.run_macro(m$1954,context$1824,scope$1825,expr$1833,arg$1940)];}else{(other$1960=$1943$1945);return expr$1833;}}else{if(($1829$1846&&((t0$1844===2)&&($1828$1839[0]==="nostep")))){(x$1964=$1828$1839[1]);return x$1964;}else{(other$1969=$1828$1839);return expr$1833;}}}}}));;return helper$1819(context$1804,scope$1805,expr$1806);});(Expander$1060.prototype["step_all"]=function(context$1976,scope$1977,$1974$1978){var t0$1982;var t1$1983;var pre$1999;var bulk$2000;var post$2001;var self$1994;var it$0$1989;var stmts$1980;(t0$1982=$1974$1978);if(((t0$1982 instanceof Array)&&((t1$1983=t0$1982.length),(t1$1983>=0)))){(stmts$1980=Array.prototype.slice.call(t0$1982,0));;}else{$3072($1974$1978);}(it$0$1989=this);;(self$1994=this);;(pre$1999=[]);;(bulk$2000=[]);;(post$2001=[]);;$2011:while(stmts$1980.length){var x$2057;var m$2052;var stmt$2047;var stmt$2042;var prepend$2036;var $2016$2031;var $2017$2032;var $2018$2033;var t0$2029;var $2015$2024;var current$2019;(current$2019=stmts$1980.shift());;($2015$2024=it$0$1989.step(context$1976,scope$1977,current$2019));;if((($2016$2031=($2015$2024 instanceof Array))&&((t0$2029=$2015$2024.length),((t0$2029>=1)&&($2015$2024[0]==="splice"))))){(prepend$2036=Array.prototype.slice.call($2015$2024,1));(stmts$1980=prepend$2036.concat(stmts$1980));}else{if(($2016$2031&&(($2018$2033=(t0$2029===2))&&($2015$2024[0]==="float")))){(stmt$2042=$2015$2024[1]);(pre$1999=pre$1999.concat(it$0$1989.step_all(context$1976,scope$1977,[stmt$2042])));}else{if(($2018$2033&&($2015$2024[0]==="sink"))){(stmt$2047=$2015$2024[1]);(post$2001=post$2001.concat(it$0$1989.step_all(context$1976,scope$1977,[stmt$2047])));}else{if(($2018$2033&&($2015$2024[0]==="multimacro"))){(m$2052=$2015$2024[1]);(stmts$1980=m$2052(context$1976,scope$1977,current$2019,stmts$1980));}else{(x$2057=$2015$2024);bulk$2000.push(x$2057);}}}}}return pre$1999.concat(bulk$2000).concat(post$2001);});(Expander$1060.prototype["expand"]=function(context$2062,scope$2063,expr$2064){var helper$2077;var self$2072;var it$0$2067;(it$0$2067=this);;(self$2072=this);;(helper$2077=track_location$1059(function(context$2081,scope$2082,expr$2083){var t0$2114;var other$2131;var $2111$2119;var env$2112;var $index$2178;var $length$2173;var temp$2168;var acc$2163;var newargs$2157;var $index$2224;var $length$2219;var temp$2214;var acc$2209;var newargs$2203;var t0$2268;var newscope$2262;var env$2263;var $index$2330;var $length$2325;var temp$2320;var acc$2315;var $index$2440;var $length$2435;var temp$2430;var acc$2425;var t0$2304;var newscope$2288;var stepscope$2289;var changes$2290;var newargs$2291;var vars$2292;var exp$2293;var $index$2708;var $length$2703;var temp$2698;var other$2782;var t0$2765;var $2758$2760;var is_obj$2619;var obj$2620;var arr$2621;var arr_parts$2622;var obj_parts$2623;var new_arr_part$2624;var new_obj_part$2625;var r$2626;var $index$2825;var $length$2820;var temp$2815;var acc$2810;var newscope$2802;var s$2885;var newscope$2894;var name$2881;var t0$2877;var $index$2929;var $length$2924;var temp$2919;var acc$2914;var other$2949;var type$2905;var args$2906;var tag$2898;var body$2899;var x$2872;var $2087$2873;var bindings$2797;var body$2798;var target$2791;var value$2792;var args$2615;var args$2284;var args$2279;var args$2274;var variable$2252;var s$2253;var value$2254;var body$2255;var args$2199;var args$2153;var f$2147;var arg$2148;var s$2106;var $2088$2101;var $2089$2102;var $2090$2103;var t0$2097;var t1$2098;var t2$2099;var $2086$2092;(expr$2083=it$0$2067.step(context$2081,scope$2082,expr$2083));($2086$2092=expr$2083);;if((($2088$2101=($2086$2092 instanceof Array))&&((t0$2097=$2086$2092.length),(($2090$2103=(t0$2097===2))&&($2086$2092[0]==="symbol"))))){(s$2106=$2086$2092[1]);(t0$2114=expr$2083);if($3276(t0$2114,"env")){(env$2112=t0$2114.env);;}else{$3072(expr$2083,"/home/olivier/git/earl-grey/src/expand.eg",7765,7769);}($2111$2119=env$2112.resolve(scope$2082,s$2106));;if(($2111$2119===(void 0))){throw $3085(["syntax","undeclared"]).create(("Undeclared variable: "+s$2106),({"node":expr$2083}));}else{(other$2131=$2111$2119);return ["bounce",other$2131];}}else{if(($2090$2103&&($2086$2092[0]==="value"))){$2086$2092[1];return expr$2083;}else{if(($2090$2103&&($2086$2092[0]==="variable"))){$2086$2092[1];return expr$2083;}else{if(($2088$2101&&((t0$2097===1)&&($2086$2092[0]==="void")))){return expr$2083;}else{if(($2088$2101&&((t0$2097===3)&&($2086$2092[0]==="send")))){(f$2147=$2086$2092[1]);(arg$2148=$2086$2092[2]);return ["send",helper$2077(["expr","head"],scope$2082,f$2147),helper$2077(["expr","tail"],scope$2082,arg$2148)];}else{if(($2088$2101&&(($2090$2103=(t0$2097>=1))&&($2086$2092[0]==="array")))){(args$2153=Array.prototype.slice.call($2086$2092,1));(newargs$2157=(((acc$2163=[])),(((temp$2168=it$0$2067.step_all(["expr","array"],scope$2082,args$2153))),((($length$2173=temp$2168.length)),((($index$2178=0)),function(){$2160:for(;($index$2178<$length$2173);($index$2178++)){var arg$2194;var m$2186;(m$2186=temp$2168[$index$2178]);;(arg$2194=m$2186);acc$2163.push(helper$2077(["expr","expr"],scope$2082,arg$2194));}}()))),acc$2163));;return ["array"].concat(newargs$2157);}else{if(($2090$2103&&($2086$2092[0]==="object"))){(args$2199=Array.prototype.slice.call($2086$2092,1));(newargs$2203=(((acc$2209=[])),(((temp$2214=it$0$2067.step_all(["expr","object"],scope$2082,args$2199))),((($length$2219=temp$2214.length)),((($index$2224=0)),function(){$2206:for(;($index$2224<$length$2219);($index$2224++)){var k$2242;var v$2243;var t0$2237;var t1$2238;var m$2232;(m$2232=temp$2214[$index$2224]);;(t0$2237=m$2232);if(((t0$2237 instanceof Array)&&((t1$2238=t0$2237.length),((t1$2238===3)&&(t0$2237[0]==="array"))))){(k$2242=t0$2237[1]);(v$2243=t0$2237[2]);acc$2209.push(["array",helper$2077(["expr","expr"],scope$2082,k$2242),helper$2077(["expr","expr"],scope$2082,v$2243)]);}else{$3072(m$2232,"/home/olivier/git/earl-grey/src/expand.eg",8608,8797);;}}}()))),acc$2209));;return ["object"].concat(newargs$2203);}else{if(($2088$2101&&((t0$2097===4)&&(($2086$2092[0]==="bind")&&((t1$2098=$2086$2092[1]),((variable$2252=t1$2098),((t1$2098 instanceof Array)&&((t2$2099=t1$2098.length),((t2$2099===2)&&(t1$2098[0]==="symbol")))))))))){(s$2253=t1$2098[1]);(value$2254=$2086$2092[2]);(body$2255=$2086$2092[3]);(newscope$2262=Scope$1057(scope$2082));;(t0$2268=variable$2252);if($3276(t0$2268,"env")){(env$2263=t0$2268.env);;}else{$3072(variable$2252,"/home/olivier/git/earl-grey/src/expand.eg",8940,8948);}env$2263.bind(newscope$2262,s$2253,value$2254);return helper$2077(context$2081,newscope$2262,body$2255);}else{if(($2088$2101&&(($2090$2103=(t0$2097>=1))&&($2086$2092[0]==="splice")))){(args$2274=Array.prototype.slice.call($2086$2092,1));return ["bounce",$996(["multi"].concat(args$2274),({"override_scope":true}))];}else{if(($2090$2103&&($2086$2092[0]==="interactive"))){(args$2279=Array.prototype.slice.call($2086$2092,1));return ["bounce",$996(["multi"].concat(args$2279),({"override_scope":true,"all_mutable":true}))];}else{if(($2090$2103&&($2086$2092[0]==="multi"))){(args$2284=Array.prototype.slice.call($2086$2092,1));(newscope$2288=function(){if(expr$2083.override_scope){return scope$2082;}else{return Scope$1057(scope$2082);}}());;(stepscope$2289=function(){if(expr$2083.nonrecursive){return scope$2082;}else{return newscope$2288;}}());;(changes$2290=false);;(t0$2304=classify$1049("newargs","vars",(((acc$2315=[])),(((temp$2320=it$0$2067.step_all(["expr","multi"],stepscope$2289,args$2284))),((($length$2325=temp$2320.length)),((($index$2330=0)),function(){$2306:for(;($index$2330<$length$2325);($index$2330++)){var t0$2375;var env$2373;var t0$2393;var env$2390;var v$2391;var other$2411;var v$2402;var value$2403;var variable$2381;var s$2382;var value$2383;var variable$2364;var s$2365;var value$2366;var opt$2356;var value$2357;var $2308$2348;var $2309$2349;var $2310$2350;var $2311$2351;var $2312$2352;var $2313$2353;var t0$2343;var t1$2344;var t2$2345;var t3$2346;var m$2338;(m$2338=temp$2320[$index$2330]);;(t0$2343=m$2338);if((($2309$2349=(t0$2343 instanceof Array))&&((t1$2344=t0$2343.length),(($2311$2351=(t1$2344===3))&&(t0$2343[0]==="option"))))){(opt$2356=t0$2343[1]);(value$2357=t0$2343[2]);acc$2315.push((newscope$2288.setopt(opt$2356,value$2357),["ignore"]));}else{if(($2311$2351&&((t0$2343[0]==="declare_raw")&&((t2$2345=t0$2343[1]),((variable$2364=t2$2345),((t2$2345 instanceof Array)&&((t3$2346=t2$2345.length),((t3$2346===2)&&(t2$2345[0]==="symbol"))))))))){(s$2365=t2$2345[1]);(value$2366=t0$2343[2]);acc$2315.push((((t0$2375=variable$2364),function(){if($3276(t0$2375,"env")){(env$2373=t0$2375.env);}else{return $3072(variable$2364,"/home/olivier/git/earl-grey/src/expand.eg",9890,9898);}}()),env$2373.bind(newscope$2288,s$2365,value$2366),(changes$2290=true),["ignore"]));}else{if(($2309$2349&&(($2311$2351=((t1$2344>=2)&&(t1$2344<=3)))&&(($2312$2352=(t0$2343[0]==="declare"))&&((t2$2345=t0$2343[1]),((variable$2381=t2$2345),((t2$2345 instanceof Array)&&((t3$2346=t2$2345.length),((t3$2346===2)&&(t2$2345[0]==="symbol")))))))))){(s$2382=t2$2345[1]);(value$2383=function(){if((2>=t1$2344)){return null;}else{return t0$2343[2];}}());acc$2315.push((((t0$2393=variable$2381),function(){if($3276(t0$2393,"env")){(env$2390=t0$2393.env);}else{return $3072(variable$2381,"/home/olivier/git/earl-grey/src/expand.eg",10135,10143);}}()),((v$2391=__lt____lt____colon__$1047(["variable",it$0$2067.gensym(s$2382)],variable$2381))),$996(v$2391,({"mutable":(expr$2083.all_mutable||variable$2381.mutable)})),env$2390.bind(newscope$2288,s$2382,v$2391),(changes$2290=true),function(){if(value$2383){return ["splice",["newargs",["assign",v$2391,value$2383]],["vars",v$2391]];}else{return ["vars",v$2391];}}()));}else{if(($2312$2352&&((v$2402=t2$2345),((t2$2345 instanceof Array)&&((t3$2346=t2$2345.length),((t3$2346===2)&&(t2$2345[0]==="variable"))))))){t2$2345[1];(value$2403=function(){if((2>=t1$2344)){return null;}else{return t0$2343[2];}}());acc$2315.push(((changes$2290=true),function(){if(value$2403){return ["splice",["newargs",["assign",v$2402,value$2403]],["vars",v$2402]];}else{return ["vars",v$2402];}}()));}else{(other$2411=m$2338);acc$2315.push(["newargs",other$2411]);}}}}}}()))),acc$2315)));if(($3276(t0$2304,"newargs")&&((newargs$2291=t0$2304.newargs),$3276(t0$2304,"vars")))){(vars$2292=t0$2304.vars);;}else{$3072(classify$1049("newargs","vars",(((acc$2425=[])),(((temp$2430=it$0$2067.step_all(["expr","multi"],stepscope$2289,args$2284))),((($length$2435=temp$2430.length)),((($index$2440=0)),function(){$2416:for(;($index$2440<$length$2435);($index$2440++)){var t0$2485;var env$2483;var t0$2503;var env$2500;var v$2501;var other$2521;var v$2512;var value$2513;var variable$2491;var s$2492;var value$2493;var variable$2474;var s$2475;var value$2476;var opt$2466;var value$2467;var $2418$2458;var $2419$2459;var $2420$2460;var $2421$2461;var $2422$2462;var $2423$2463;var t0$2453;var t1$2454;var t2$2455;var t3$2456;var m$2448;(m$2448=temp$2430[$index$2440]);;(t0$2453=m$2448);if((($2419$2459=(t0$2453 instanceof Array))&&((t1$2454=t0$2453.length),(($2421$2461=(t1$2454===3))&&(t0$2453[0]==="option"))))){(opt$2466=t0$2453[1]);(value$2467=t0$2453[2]);acc$2425.push((newscope$2288.setopt(opt$2466,value$2467),["ignore"]));}else{if(($2421$2461&&((t0$2453[0]==="declare_raw")&&((t2$2455=t0$2453[1]),((variable$2474=t2$2455),((t2$2455 instanceof Array)&&((t3$2456=t2$2455.length),((t3$2456===2)&&(t2$2455[0]==="symbol"))))))))){(s$2475=t2$2455[1]);(value$2476=t0$2453[2]);acc$2425.push((((t0$2485=variable$2474),function(){if($3276(t0$2485,"env")){(env$2483=t0$2485.env);}else{return $3072(variable$2474,"/home/olivier/git/earl-grey/src/expand.eg",9890,9898);}}()),env$2483.bind(newscope$2288,s$2475,value$2476),(changes$2290=true),["ignore"]));}else{if(($2419$2459&&(($2421$2461=((t1$2454>=2)&&(t1$2454<=3)))&&(($2422$2462=(t0$2453[0]==="declare"))&&((t2$2455=t0$2453[1]),((variable$2491=t2$2455),((t2$2455 instanceof Array)&&((t3$2456=t2$2455.length),((t3$2456===2)&&(t2$2455[0]==="symbol")))))))))){(s$2492=t2$2455[1]);(value$2493=function(){if((2>=t1$2454)){return null;}else{return t0$2453[2];}}());acc$2425.push((((t0$2503=variable$2491),function(){if($3276(t0$2503,"env")){(env$2500=t0$2503.env);}else{return $3072(variable$2491,"/home/olivier/git/earl-grey/src/expand.eg",10135,10143);}}()),((v$2501=__lt____lt____colon__$1047(["variable",it$0$2067.gensym(s$2492)],variable$2491))),$996(v$2501,({"mutable":(expr$2083.all_mutable||variable$2491.mutable)})),env$2500.bind(newscope$2288,s$2492,v$2501),(changes$2290=true),function(){if(value$2493){return ["splice",["newargs",["assign",v$2501,value$2493]],["vars",v$2501]];}else{return ["vars",v$2501];}}()));}else{if(($2422$2462&&((v$2512=t2$2455),((t2$2455 instanceof Array)&&((t3$2456=t2$2455.length),((t3$2456===2)&&(t2$2455[0]==="variable"))))))){t2$2455[1];(value$2513=function(){if((2>=t1$2454)){return null;}else{return t0$2453[2];}}());acc$2425.push(((changes$2290=true),function(){if(value$2513){return ["splice",["newargs",["assign",v$2512,value$2513]],["vars",v$2512]];}else{return ["vars",v$2512];}}()));}else{(other$2521=m$2448);acc$2425.push(["newargs",other$2521]);}}}}}}()))),acc$2425)),"/home/olivier/git/earl-grey/src/expand.eg",9562,11161);}(exp$2293=function(s$2526){var $index$2552;var $length$2547;var temp$2542;var acc$2537;var $index$2594;var $length$2589;var temp$2584;var acc$2579;var stepped$2529;(stepped$2529=(((acc$2537=[])),(((temp$2542=$3254(newargs$2291))),((($length$2547=temp$2542.length)),((($index$2552=0)),function(){$2534:for(;($index$2552<$length$2547);($index$2552++)){var i$2570;var arg$2571;var t0$2565;var t1$2566;var m$2560;(m$2560=temp$2542[$index$2552]);;(t0$2565=m$2560);if(((t0$2565 instanceof Array)&&((t1$2566=t0$2565.length),(t1$2566===2)))){(i$2570=t0$2565[0]);(arg$2571=t0$2565[1]);acc$2537.push(it$0$2067.step(["expr",function(){if((i$2570===(newargs$2291.length-1))){return "expr";}else{return "ignore";}}()],s$2526,arg$2571));}else{$3072(m$2560,"/home/olivier/git/earl-grey/src/expand.eg",11383,11560);;}}}()))),acc$2537));;(acc$2579=[]);;(temp$2584=stepped$2529);;($length$2589=temp$2584.length);;($index$2594=0);;$2530:for(;($index$2594<$length$2589);($index$2594++)){var arg$2610;var m$2602;(m$2602=temp$2584[$index$2594]);;(arg$2610=m$2602);acc$2579.push(helper$2077(["expr","expr"],s$2526,arg$2610));}return acc$2579;});;if(changes$2290){return ["scope",vars$2292,["multi"].concat(exp$2293(newscope$2288))];}else{return ["multi"].concat(exp$2293(scope$2082));}}else{if(($2090$2103&&($2086$2092[0]==="data"))){(args$2615=Array.prototype.slice.call($2086$2092,1));(is_obj$2619=false);;(obj$2620=["object"]);;(arr$2621=["array"]);;(arr_parts$2622=[]);;(obj_parts$2623=[]);;(new_arr_part$2624=function(){var other$2668;var t0$2659;var $2652$2654;($2652$2654=arr$2621);;if((($2652$2654 instanceof Array)&&((t0$2659=$2652$2654.length),((t0$2659===1)&&($2652$2654[0]==="array"))))){return false;}else{(other$2668=$2652$2654);arr_parts$2622.push(arr$2621);return (arr$2621=["array"]);}});;(new_obj_part$2625=function(){var other$2692;var t0$2683;var $2676$2678;($2676$2678=obj$2620);;if((($2676$2678 instanceof Array)&&((t0$2683=$2676$2678.length),((t0$2683===1)&&($2676$2678[0]==="object"))))){return false;}else{(other$2692=$2676$2678);obj_parts$2623.push(obj$2620);return (obj$2620=["object"]);}});;(temp$2698=it$0$2067.step_all(["expr","data"],scope$2082,args$2615));;($length$2703=temp$2698.length);;($index$2708=0);;$2627:for(;($index$2708<$length$2703);($index$2708++)){var other$2754;var expr$2748;var expr$2742;var k$2735;var v$2736;var $2629$2724;var $2630$2725;var $2631$2726;var $2632$2727;var t0$2721;var t1$2722;var m$2716;(m$2716=temp$2698[$index$2708]);;(t0$2721=m$2716);if((($2630$2725=(t0$2721 instanceof Array))&&((t1$2722=t0$2721.length),((t1$2722===1)&&(t0$2721[0]==="assoc"))))){(is_obj$2619=true);}else{if(($2630$2725&&((t1$2722===3)&&(t0$2721[0]==="assoc")))){(k$2735=t0$2721[1]);(v$2736=t0$2721[2]);(is_obj$2619=true);obj$2620.push(["array",k$2735,v$2736]);}else{if(($2630$2725&&(($2632$2727=(t1$2722===2))&&(t0$2721[0]==="dynsplice")))){(expr$2742=t0$2721[1]);new_arr_part$2624();arr_parts$2622.push(expr$2742);}else{if(($2632$2727&&(t0$2721[0]==="objsplice"))){(expr$2748=t0$2721[1]);(is_obj$2619=true);new_obj_part$2625();obj_parts$2623.push(expr$2748);}else{(other$2754=m$2716);arr$2621.push(other$2754);}}}}}new_arr_part$2624();new_obj_part$2625();(r$2626=((($2758$2760=arr_parts$2622)),function(){if((($2758$2760 instanceof Array)&&((t0$2765=$2758$2760.length),((t0$2765===0)&&is_obj$2619)))){return util$1048.construct(obj_parts$2623,function(x$2773,rest$2774){return ["send",["symbol","&:"],["data",x$2773,rest$2774]];},["object"]);}else{$2758$2760;if(is_obj$2619){throw $3085(["syntax","array","object"]).create("Cannot mix array and object notations.");}else{(other$2782=$2758$2760);return util$1048.construct(arr_parts$2622.reverse(),function(x$2785,rest$2786){return ["send",["send",rest$2786,["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",x$2785]];},["array"]);}}}()));;return helper$2077(context$2081,scope$2082,it$0$2067.mkenv().convert(r$2626));}else{if(($2088$2101&&(($2090$2103=(t0$2097===3))&&($2086$2092[0]==="assign")))){(target$2791=$2086$2092[1]);(value$2792=$2086$2092[2]);return ["assign",helper$2077(["expr","expr"],scope$2082,target$2791),helper$2077(["expr","expr"],scope$2082,value$2792)];}else{if(($2090$2103&&($2086$2092[0]==="lambda"))){(bindings$2797=$2086$2092[1]);(body$2798=$2086$2092[2]);(newscope$2802=Scope$1057(scope$2082));;return ["lambda",(((acc$2810=[])),(((temp$2815=bindings$2797)),((($length$2820=temp$2815.length)),((($index$2825=0)),function(){$2806:for(;($index$2825<$length$2820);($index$2825++)){var v$2851;var x$2861;var other$2868;var v$2858;var b$2844;var env$2845;var $2808$2841;var t0$2838;var t1$2839;var m$2833;(m$2833=temp$2815[$index$2825]);;(t0$2838=m$2833);if(((t0$2838 instanceof Array)&&((t1$2839=t0$2838.length),((t1$2839===2)&&((t0$2838[0]==="symbol")&&((b$2844=t0$2838[1]),$3276(t0$2838,"env"))))))){(env$2845=t0$2838.env);acc$2810.push((((v$2851=["variable",it$0$2067.gensym(b$2844)])),(env$2845.bind(newscope$2802,b$2844,v$2851),v$2851)));}else{if((((x$2861=t0$2838)),((x$2861 instanceof Array)&&(x$2861[0]==="variable")))){(v$2858=t0$2838);acc$2810.push(v$2858);}else{(other$2868=m$2833);acc$2810.push(function(){throw $3085(["syntax","lambda","binding"]).create("Not a valid binding.",({"node":other$2868}));}());}}}}()))),acc$2810),helper$2077(["expr","expr"],newscope$2802,body$2798)];}else{if(($2090$2103&&($2086$2092[0]==="use"))){($2087$2873=$2086$2092[1]);(x$2872=$2086$2092[2]);(t0$2877=$2087$2873);if((typeof(t0$2877)==="string")){(name$2881=t0$2877);(s$2885=scope$2082);;$2889:while(s$2885){if((s$2885.name.slice(0,(name$2881.length+1))===(name$2881+"/"))){break $2889;}else{(s$2885=s$2885.parent);}}if(s$2885){return helper$2077(context$2081,s$2885,x$2872);}else{throw $3085(["syntax","noscope"]).create(("Could not find a scope tagged: "+name$2881));}}else{(newscope$2894=$2087$2873);return helper$2077(context$2081,newscope$2894,x$2872);}}else{if(($2090$2103&&(($2086$2092[0]==="tagscope")&&((t1$2098=$2086$2092[1]),(typeof(t1$2098)==="string"))))){(tag$2898=t1$2098);(body$2899=$2086$2092[2]);return helper$2077(context$2081,Scope$1057(scope$2082,it$0$2067.gensym((tag$2898+"/"))),body$2899);}else{if(($2088$2101&&((t0$2097>=1)&&((type$2905=$2086$2092[0]),((args$2906=Array.prototype.slice.call($2086$2092,1)),(it$0$2067.generic_nodes.indexOf(type$2905)!==-1)))))){return [type$2905].concat((((acc$2914=[])),(((temp$2919=args$2906)),((($length$2924=temp$2919.length)),((($index$2929=0)),function(){$2911:for(;($index$2929<$length$2924);($index$2929++)){var arg$2945;var m$2937;(m$2937=temp$2919[$index$2929]);;(arg$2945=m$2937);acc$2914.push(helper$2077(["expr","expr"],scope$2082,arg$2945));}}()))),acc$2914));}else{(other$2949=$2086$2092);throw $3085(["syntax","illegal_node"]).create("An illegal node was found.",({"node":other$2949,"context":context$2081}));}}}}}}}}}}}}}}}}}}));;return helper$2077(context$2062,scope$2063,expr$2064);});$996(Expander$1060,$996(((accum$2953=({})),((accum$2953["::name"]="Expander"),accum$2953)),((accum$2957=({})),((accum$2957["::egclass"]=true),accum$2957))));Expander$1060;(mac1$1061=function(f$2963){return ["macro",function(context$2967,scope$2968,form$2969,$2965$2970){var t0$2974;var t1$2975;var expr$2972;(t0$2974=$2965$2970);if(((t0$2974 instanceof Array)&&((t1$2975=t0$2974.length),((t1$2975===2)&&(t0$2974[0]==="data"))))){(expr$2972=t0$2974[1]);;}else{$3072($2965$2970);}return f$2963(expr$2972);}];});;(__chk_ncache$1062=({}));;(__chk_scache$1063=({}));;(checker_db$1064=function($2989$2991){var v$3027;var v$3040;var s$3036;var n$3023;var $2993$2999;var ph$2994;(ph$2994=$2989$2991);;($2993$2999=ph$2994);;if(($2993$2999===null)){return checker_db$1064.null;}else{if(($2993$2999===(void 0))){return checker_db$1064.undefined;}else{if(($2993$2999===true)){return checker_db$1064.true;}else{if(($2993$2999===false)){return checker_db$1064.false;}else{if((typeof($2993$2999)==="number")){(n$3023=$2993$2999);if($995(__chk_ncache$1062,n$3023)){return $995(__chk_ncache$1062,n$3023);}else{(v$3027=mac1$1061(function(x$3031){return ["send",["symbol","==="],["data",x$3031,["value",n$3023]]];}));;(__chk_ncache$1062[n$3023]=v$3027);return v$3027;}}else{if((typeof($2993$2999)==="string")){(s$3036=$2993$2999);if(Object.prototype.hasOwnProperty.call(__chk_scache$1063,s$3036)){return $995(__chk_scache$1063,s$3036);}else{(v$3040=mac1$1061(function(x$3044){return ["send",["symbol","==="],["data",x$3044,["value",s$3036]]];}));;(__chk_scache$1063[s$3036]=v$3040);return v$3040;}}else{$3072($2993$2999);}}}}}}});;$996(checker_db$1064,({"String":mac1$1061(function(x$3051){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$3051]],["value","string"]]];}),"Number":mac1$1061(function(x$3054){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$3054]],["value","number"]]];}),"Array":mac1$1061(function(x$3057){return ["send",["symbol","instanceof"],["data",x$3057,["symbol","Array"]]];}),"true":mac1$1061(function(x$3060){return x$3060;}),"false":mac1$1061(function(x$3063){return ["send",["symbol","not"],["data",["void"],x$3063]];}),"null":mac1$1061(function(x$3066){return ["send",["symbol","==="],["data",x$3066,["value",null]]];}),"undefined":mac1$1061(function(x$3069){return ["send",["symbol","==="],["data",x$3069,["value",(void 0)]]];})}));(exports["Env"]=Env$1058);(exports["Scope"]=Scope$1057);(exports["track_location"]=track_location$1059);(exports["Expander"]=Expander$1060);(exports["GenSym"]=GenSym$1051);(exports["gensym"]=gensym$1052);(exports["mac1"]=mac1$1061);(exports["checker_db"]=checker_db$1064);
