var $1893=(function(type$1896){var f$1900;(f$1900=type$1896["::check"]);if((f$1900===(void 0))){return (function(value$1906){return (value$1906 instanceof type$1896);});}else{return (function(value$1910){return f$1900.call(type$1896,value$1910);});}});
var $1912=(function(dest$1915,values$1916){var k$1921;(k$1921=null);$1919:for(k$1921 in values$1916){if(values$1916.hasOwnProperty(k$1921)){(dest$1915[k$1921]=values$1916[k$1921]);}}return dest$1915;});
var $1929=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $1930=(function($1932$1935){var ph$1941;(ph$1941=$1932$1935);var $1937$1947;($1937$1947=ph$1941);var bridge$1939$1952;var x$1956;(bridge$1939$1952=$1937$1947);if((((typeof(bridge$1939$1952)==="string")&&((x$1956=bridge$1939$1952),true))||((typeof(bridge$1939$1952)==="number")&&((x$1956=bridge$1939$1952),true)))){return ["value",x$1956];}else{var other$1967;(other$1967=$1937$1947);return other$1967["::serialize_ast"]();}});
var $1969=(function(obj$1972){var results$1977;(results$1977=[]);var k$1982;(k$1982=null);$1976:for(k$1982 in obj$1972){if(Object.prototype.hasOwnProperty.call(obj$1972,k$1982)){results$1977.push([k$1982,$1929(obj$1972,k$1982)]);}}return results$1977;});
var $2238=(function(arr$2241){var results$2247;var l$2248;(results$2247=[]);(l$2248=arr$2241.length);var i$2257;(i$2257=0);$2246:for(;(i$2257<l$2248);(i$2257++)){results$2247.push([i$2257,$1929(arr$2241,i$2257)]);}return results$2247;});
var $2005=(function(){var $2006$2012;($2006$2012=(function(tags$2017){var it$0$2020;(it$0$2020=(function(){if((!$1893($2006$2012)(this))){return Object.create($2006$2012.prototype);}else{return this;}})());(it$0$2020["tags"]=tags$2017);return it$0$2020;}));($2006$2012.prototype["create"]=(function(){var it$0$2040;var self$2041;(it$0$2040=this);(self$2041=this);var $2038$2050;($2038$2050=arguments);var t0$2055;var message$2059;var args$2060;(t0$2055=$2038$2050.length);if((t0$2055>=0)){(message$2059=(function(){if((0>=t0$2055)){return "";}else{return $2038$2050[0];}})());(args$2060=Array.prototype.slice.call($2038$2050,1));var e$2073;(e$2073=Error(message$2059));(e$2073["::tags"]=it$0$2040.tags);(e$2073["args"]=args$2060);var temp$2089;(temp$2089=$2238(args$2060));var $length$2095;($length$2095=temp$2089.length);var $index$2101;($index$2101=0);$2074:for(;($index$2101<$length$2095);($index$2101++)){var m$2110;(m$2110=temp$2089[$index$2101]);var t0$2115;var t1$2116;var i$2120;var arg$2121;(t0$2115=m$2110);if(((t0$2115 instanceof Array)&&(((t1$2116=t0$2115.length)),(t1$2116===2)))){(i$2120=t0$2115[0]);(arg$2121=t0$2115[1]);(e$2073[i$2120]=arg$2121);}else{$1986(m$2110);}}(e$2073["length"]=args$2060.length);(e$2073["name"]=["E"].concat(it$0$2040.tags).join("."));return e$2073;}else{$1986($2038$2050);}}));($2006$2012.prototype["::check"]=(function(e$2151){var it$0$2155;var self$2156;(it$0$2155=this);(self$2156=this);var tags$2166;if(((!e$2151)||(!$1893(Error)(e$2151)))){return false;}(tags$2166=(e$2151["::tags"]||[]));var temp$2177;(temp$2177=it$0$2155.tags);var $length$2183;($length$2183=temp$2177.length);var $index$2189;($index$2189=0);$2167:for(;($index$2189<$length$2183);($index$2189++)){var m$2198;(m$2198=temp$2177[$index$2189]);var tag$2206;(tag$2206=m$2198);if((tags$2166.indexOf(tag$2206)===-1)){return false;}else{false;}}return true;}));($2006$2012.prototype["::deconstruct"]=(function(e$2215){var it$0$2219;var self$2220;(it$0$2219=this);(self$2220=this);return e$2215.args;}));$1912($2006$2012,$1912((function(){var accum$2231;(accum$2231=({}));(accum$2231["::name"]="$2006");return accum$2231;})(),(function(){var accum$2235;(accum$2235=({}));(accum$2235["::egclass"]=true);return accum$2235;})()));return $2006$2012;})();
var $1986=(function(value$1989,url$1990,start$1991,end$1992){var err$1996;(err$1996=$2005(["match"]).create("Could not find a match for value",({"value":value$1989})));if(url$1990){(err$1996["location"]=["location",url$1990,start$1991,end$1992]);}throw err$1996;});
var send$1538;var __array_methods$1539;var __re_methods$1540;(send$1538=(function(obj$1553,$1550$1554){var ph$1560;var msg$1561;var t0$1563;(t0$1563=$1550$1554);(msg$1561=t0$1563);(ph$1560=t0$1563);var $1556$1572;($1556$1572=ph$1560);var bridge$1558$1577;(bridge$1558$1577=$1556$1572);if(((typeof(bridge$1558$1577)==="string")||(typeof(bridge$1558$1577)==="number"))){return obj$1553[msg$1561];}else{var other$1589;(other$1589=$1556$1572);return obj$1553["::send"](msg$1561);}}));(Array[":::project"]=(function($1595$1598){var ph$1603;var value$1604;var t0$1606;(t0$1606=$1595$1598);(value$1604=t0$1606);(ph$1603=t0$1606);var $1600$1615;($1600$1615=ph$1603);if($1893(Array)($1600$1615)){return [true,value$1604];}else{$1600$1615;return [true,[value$1604]];}}));(__array_methods$1539=$1912((function(){var accum$1636;(accum$1636=({}));(accum$1636["::check"]=(function(value$1641){if((value$1641 instanceof Array)){var i$1647;(i$1647=0);$1644:for(;(i$1647<this.length);(i$1647++)){if(($1929(this,i$1647)!==$1929(value$1641,i$1647))){return false;}}return true;}else{return false;}}));return accum$1636;})(),$1912((function(){var accum$1656;(accum$1656=({}));(accum$1656["::clone"]=(function(){return $1912(this.slice(0),this);}));return accum$1656;})(),$1912((function(){var accum$1663;(accum$1663=({}));(accum$1663[":::project"]=(function(value$1668){if((value$1668 instanceof Array)){var i$1674;(i$1674=0);$1671:for(;(i$1674<this.length);(i$1674++)){if(($1929(this,i$1674)!==$1929(value$1668,i$1674))){return [true,this.concat([value$1668])];}}return [true,value$1668];}else{return [true,this.concat([value$1668])];}}));return accum$1663;})(),(function(){var accum$1683;(accum$1683=({}));(accum$1683["::serialize_ast"]=(function(){return ["array"].concat(this.map($1930));}));return accum$1683;})()))));var temp$1693;(temp$1693=$1969(__array_methods$1539));var $length$1699;($length$1699=temp$1693.length);var $index$1705;($index$1705=0);$1541:for(;($index$1705<$length$1699);($index$1705++)){var m$1714;(m$1714=temp$1693[$index$1705]);var t0$1719;var t1$1720;var k$1724;var v$1725;(t0$1719=m$1714);if(((t0$1719 instanceof Array)&&(((t1$1720=t0$1719.length)),(t1$1720===2)))){(k$1724=t0$1719[0]);(v$1725=t0$1719[1]);if((!$1929(Array.prototype,k$1724))){Object.defineProperty(Array.prototype,k$1724,({"enumerable":false,"value":v$1725}));}}else{$1986(m$1714);}}(__re_methods$1540=$1912((function(){var accum$1745;(accum$1745=({}));(accum$1745["::check"]=(function($1749$1752){var ph$1757;(ph$1757=$1749$1752);var $1754$1763;($1754$1763=ph$1757);var value$1771;if((typeof($1754$1763)==="string")){(value$1771=$1754$1763);if(value$1771.match(this)){return true;}else{return false;}}else{var other$1776;(other$1776=$1754$1763);return false;}}));return accum$1745;})(),(function(){var accum$1779;(accum$1779=({}));(accum$1779[":::project"]=(function($1783$1786){var ph$1791;(ph$1791=$1783$1786);var $1788$1797;($1788$1797=ph$1791);var value$1805;if((typeof($1788$1797)==="string")){(value$1805=$1788$1797);var $1808$1813;($1808$1813=value$1805.match(this));var m$1821;if(($1808$1813===null)){(m$1821=$1808$1813);return [false,null];}else{var m$1826;(m$1826=$1808$1813);return [true,m$1826];}}else{var other$1830;(other$1830=$1788$1797);return [false,null];}}));return accum$1779;})()));var temp$1836;(temp$1836=$1969(__re_methods$1540));var $length$1842;($length$1842=temp$1836.length);var $index$1848;($index$1848=0);$1544:for(;($index$1848<$length$1842);($index$1848++)){var m$1857;(m$1857=temp$1836[$index$1848]);var t0$1862;var t1$1863;var k$1867;var v$1868;(t0$1862=m$1857);if(((t0$1862 instanceof Array)&&(((t1$1863=t0$1862.length)),(t1$1863===2)))){(k$1867=t0$1862[0]);(v$1868=t0$1862[1]);if((!$1929(RegExp.prototype,k$1867))){Object.defineProperty(RegExp.prototype,k$1867,({"enumerable":false,"value":v$1868}));}}else{$1986(m$1857);}}if((!Function.prototype["::send"])){Object.defineProperty(Function.prototype,"::send",$1912(({"enumerable":false}),(function(){var accum$1886;(accum$1886=({}));(accum$1886["value"]=(function(args$1891){return this.apply(this,args$1891);}));return accum$1886;})()));}
var $5371=(function($5373$5376,key$5377){var ph$5385;(ph$5385=$5373$5376);var $5379$5391;($5379$5391=ph$5385);var bridge$5381$5396;(bridge$5381$5396=$5379$5391);if(((bridge$5381$5396===null)||(bridge$5381$5396===(void 0)))){return false;}else{var x$5408;if((typeof($5379$5391)==="string")){(x$5408=$5379$5391);return (key$5377 in String.prototype);}else{var x$5413;if((typeof($5379$5391)==="number")){(x$5413=$5379$5391);return (key$5377 in Number.prototype);}else{var x$5418;(x$5418=$5379$5391);return (key$5377 in x$5418);}}}});
var $5420=(function(type$5423){return (function(value$5427){var f$5431;(f$5431=type$5423[":::project"]);if((f$5431===(void 0))){(f$5431=type$5423["::project"]);if((f$5431===(void 0))){return [true,type$5423(value$5427)];}else{var rval$5444;(rval$5444=false);try{(rval$5444=[true,f$5431(value$5427)]);}catch(excv$5455){var e$5461;(e$5461=excv$5455);(rval$5444=[false,null]);}return rval$5444;}}else{return f$5431.call(type$5423,value$5427);}});});
var $5467=(function(pairs$5470){var rval$5474;(rval$5474=({}));var temp$5484;(temp$5484=pairs$5470);var $length$5490;($length$5490=temp$5484.length);var $index$5496;($index$5496=0);$5475:for(;($index$5496<$length$5490);($index$5496++)){var m$5505;(m$5505=temp$5484[$index$5496]);var t0$5510;var t1$5511;var k$5515;var v$5516;(t0$5510=m$5505);if(((t0$5510 instanceof Array)&&(((t1$5511=t0$5510.length)),(t1$5511===2)))){(k$5515=t0$5510[0]);(v$5516=t0$5510[1]);(rval$5474[k$5515]=v$5516);}else{$1986(m$5505);}}return rval$5474;});var accum$2554;var accum$2558;var accum$2982;var accum$2986;var accum$5181;var accum$5185;var $2266$2307;var __lt____gt__$2308;var $2267$2309;var __lt____lt____colon__$2310;var util$2311;var classify$2312;var neighbours$2313;var GenSym$2314;var gensym$2315;var $2269$2316;var PatternParser$2317;var PatternProcessor$2318;var Scope$2319;var Env$2320;var track_location$2321;var Expander$2322;var mac1$2323;var __chk_ncache$2324;var __chk_scache$2325;var checker_db$2326;($2266$2307=require("./pp"));(__lt____gt__$2308=$2266$2307["<>"]);($2267$2309=require("./location"));(__lt____lt____colon__$2310=$2267$2309["<<:"]);(util$2311=require("./util"));(classify$2312=util$2311.classify);(neighbours$2313=util$2311.neighbours);(GenSym$2314=util$2311.GenSym);(gensym$2315=util$2311.gensym);($2269$2316=require("./pattern"));(PatternParser$2317=$2269$2316.PatternParser);(PatternProcessor$2318=$2269$2316.PatternProcessor);(Scope$2319=(function(){var t0$2383;var $2374$2378;var it$0$2369;(it$0$2369=(function(){if((!$1893(Scope$2319)(this))){return Object.create(Scope$2319.prototype);}else{return this;}})());($2374$2378=arguments);(t0$2383=$2374$2378.length);if(((t0$2383>=0)&&(t0$2383<=3))){(it$0$2369["parent"]=(function(){if((0>=t0$2383)){return null;}else{return $2374$2378[0];}})());(it$0$2369["name"]=(function(){if((1>=t0$2383)){return gensym$2315("scope");}else{return $2374$2378[1];}})());(it$0$2369["expander"]=(function(){if((2>=t0$2383)){return it$0$2369.parent.expander;}else{return $2374$2378[2];}})());(it$0$2369["options"]=({}));}else{$1986($2374$2378);}return it$0$2369;}));(Scope$2319.prototype["getopt"]=(function(opt$2404){var otherwise$2441;var $2421$2430;var $2417$2424;var it$0$2408;var self$2409;(it$0$2408=this);(self$2409=this);($2417$2424=null);$2417$2424;if(Object.prototype.hasOwnProperty.call(it$0$2408.options,opt$2404)){return $1929(it$0$2408.options,opt$2404);}else{if((it$0$2408.parent===null)){return (void 0);}else{(otherwise$2441=$2417$2424);return it$0$2408.parent.getopt(opt$2404);}}}));(Scope$2319.prototype["setopt"]=(function(opt$2447,value$2448){var it$0$2452;var self$2453;(it$0$2452=this);(self$2453=this);(it$0$2452.options[opt$2447]=value$2448);}));(Scope$2319.prototype["gensym"]=(function(){var it$0$2472;var self$2473;(it$0$2472=this);(self$2473=this);return it$0$2472.expander.gensym();}));(Scope$2319.prototype["step"]=(function(context$2485,expr$2486){var it$0$2490;var self$2491;(it$0$2490=this);(self$2491=this);return it$0$2490.expander.step(context$2485,it$0$2490,expr$2486);}));(Scope$2319.prototype["step_all"]=(function(context$2503,exprs$2504){var it$0$2508;var self$2509;(it$0$2508=this);(self$2509=this);return it$0$2508.expander.step_all(context$2503,it$0$2508,exprs$2504);}));(Scope$2319.prototype["expand"]=(function(context$2521,expr$2522){var it$0$2526;var self$2527;(it$0$2526=this);(self$2527=this);return it$0$2526.expander.expand(context$2521,it$0$2526,expr$2522);}));(Scope$2319.prototype["toString"]=(function(){var it$0$2542;var self$2543;(it$0$2542=this);(self$2543=this);return (("Scope{"+it$0$2542.name)+"}");}));$1912(Scope$2319,$1912(((accum$2554=({})),((accum$2554["::name"]="Scope"),accum$2554)),((accum$2558=({})),((accum$2558["::egclass"]=true),accum$2558))));Scope$2319;(Env$2320=(function(){var it$0$2567;(it$0$2567=(function(){if((!$1893(Env$2320)(this))){return Object.create(Env$2320.prototype);}else{return this;}})());(it$0$2567["scopes"]=({}));return it$0$2567;}));(Env$2320.prototype["list_bindings"]=(function(origin$2582){var values$2598;var scope$2599;var it$0$2586;var self$2587;(it$0$2586=this);(self$2587=this);(values$2598=({}));(scope$2599=origin$2582);$2606:while(scope$2599){$1912(values$2598,$1929(it$0$2586.scopes,scope$2599.name));(scope$2599=scope$2599.parent);}return values$2598;}));(Env$2320.prototype["resolve"]=(function(scope$2618,name$2619){var scope_data$2634;var it$0$2623;var self$2624;(it$0$2623=this);(self$2624=this);if((scope$2618===null)){return (void 0);}(scope_data$2634=$1929(it$0$2623.scopes,scope$2618.name));if((scope_data$2634&&Object.prototype.hasOwnProperty.call(scope_data$2634,name$2619))){return $1929(scope_data$2634,name$2619);}else{return it$0$2623.resolve(scope$2618.parent,name$2619);}}));(Env$2320.prototype["bind"]=(function(scope$2643,name$2644,value$2645){var it$0$2649;var self$2650;(it$0$2649=this);(self$2650=this);if((!$1929(it$0$2649.scopes,scope$2643.name))){(it$0$2649.scopes[scope$2643.name]=({}));}($1929(it$0$2649.scopes,scope$2643.name)[name$2644]=value$2645);}));(Env$2320.prototype["mark"]=(function(expr$2672){var x$2739;var x$2745;var bridge$2691$2731;var x$2751;var bridge$2690$2724;var x$2757;var bridge$2689$2717;var x$2763;var $index$2798;var $length$2792;var temp$2786;var other$2819;var type$2770;var args$2771;var e$2706;var bridge$2688$2701;var t0$2702;var $2685$2696;var it$0$2676;var self$2677;(it$0$2676=this);(self$2677=this);($2685$2696=expr$2672);if($5371($2685$2696,"env")){(e$2706=$2685$2696.env);return expr$2672;}else{(bridge$2688$2701=$2685$2696);if(((((bridge$2689$2717=bridge$2688$2701)),((((bridge$2690$2724=bridge$2689$2717)),((((bridge$2691$2731=bridge$2690$2724)),((((x$2739=bridge$2691$2731)),((x$2739 instanceof Array)&&(x$2739[0]==="symbol")))||(((x$2745=bridge$2691$2731)),((x$2745 instanceof Array)&&(x$2745[0]==="value")))))||(((x$2751=bridge$2690$2724)),((x$2751 instanceof Array)&&(x$2751[0]==="variable")))))||(((x$2757=bridge$2689$2717)),((x$2757 instanceof Array)&&(x$2757[0]==="macro")))))||(((x$2763=bridge$2688$2701)),((x$2763 instanceof Array)&&(x$2763[0]==="void"))))){return $1912(expr$2672,({"env":it$0$2676}));}else{if((($2685$2696 instanceof Array)&&(((t0$2702=$2685$2696.length)),(t0$2702>=1)))){(type$2770=$2685$2696[0]);(args$2771=Array.prototype.slice.call($2685$2696,1));(temp$2786=args$2771);($length$2792=temp$2786.length);($index$2798=0);$2780:for(;($index$2798<$length$2792);($index$2798++)){var arg$2815;var m$2807;(m$2807=temp$2786[$index$2798]);(arg$2815=m$2807);it$0$2676.mark(arg$2815);}return $1912(expr$2672,({"env":it$0$2676}));}else{(other$2819=$2685$2696);return $1912(expr$2672,({"env":it$0$2676}));}}}}));(Env$2320.prototype["fork"]=(function(){var $index$2861;var $length$2855;var temp$2849;var e$2839;var it$0$2828;var self$2829;(it$0$2828=this);(self$2829=this);(e$2839=Env$2320());(temp$2849=$1969(it$0$2828.scopes));($length$2855=temp$2849.length);($index$2861=0);$2840:for(;($index$2861<$length$2855);($index$2861++)){var $index$2916;var $length$2910;var temp$2904;var acc$2898;var scope$2880;var bindings$2881;var t0$2875;var t1$2876;var m$2870;(m$2870=temp$2849[$index$2861]);(t0$2875=m$2870);if(((t0$2875 instanceof Array)&&(((t1$2876=t0$2875.length)),(t1$2876===2)))){(scope$2880=t0$2875[0]);(bindings$2881=t0$2875[1]);(acc$2898=[]);(temp$2904=$1969(bindings$2881));($length$2910=temp$2904.length);($index$2916=0);$2893:for(;($index$2916<$length$2910);($index$2916++)){var k$2935;var v$2936;var t0$2930;var t1$2931;var m$2925;(m$2925=temp$2904[$index$2916]);(t0$2930=m$2925);if(((t0$2930 instanceof Array)&&(((t1$2931=t0$2930.length)),(t1$2931===2)))){(k$2935=t0$2930[0]);(v$2936=t0$2930[1]);acc$2898.push(((function(){if((!$1929(e$2839.scopes,scope$2880))){(e$2839.scopes[scope$2880]=({}));}})(),(($1929(e$2839.scopes,scope$2880)[k$2935]=v$2936))));}else{$1986(m$2925,"/home/olivier/git/earl-grey/src/expand.eg",2279,2426);}}acc$2898;}else{$1986(m$2870,"/home/olivier/git/earl-grey/src/expand.eg",2229,2426);}}return e$2839;}));(Env$2320.prototype["toString"]=(function(){var it$0$2970;var self$2971;(it$0$2970=this);(self$2971=this);return "Env{...}";}));$1912(Env$2320,$1912(((accum$2982=({})),((accum$2982["::name"]="Env"),accum$2982)),((accum$2986=({})),((accum$2986["::egclass"]=true),accum$2986))));Env$2320;(track_location$2321=(function(f$2993){var f2$2997;(f2$2997=(function(context$3002,scope$3003,expr$3004){var rval$3018;var other$3064;var v$3054;var t0$3050;var $3008$3045;var rval$3011;(rval$3011=(((rval$3018=false)),((function(){try{(rval$3018=f$2993(context$3002,scope$3003,expr$3004));}catch(excv$3029){var e$3035;(e$3035=excv$3029);(rval$3018=(__lt____lt____colon__$2310(e$3035,expr$3004),function(){throw e$3035;}()));}})(),rval$3018)));($3008$3045=rval$3011);if((($3008$3045 instanceof Array)&&(((t0$3050=$3008$3045.length)),((t0$3050===2)&&($3008$3045[0]==="bounce"))))){(v$3054=$3008$3045[1]);return f2$2997(context$3002,scope$3003,__lt____lt____colon__$2310(v$3054,expr$3004));}else{(other$3064=$3008$3045);return __lt____lt____colon__$2310(other$3064,expr$3004);}}));return f2$2997;}));(Expander$2322=(function(env_factory$3072,generic_nodes$3073){var it$0$3076;(it$0$3076=(function(){if((!$1893(Expander$2322)(this))){return Object.create(Expander$2322.prototype);}else{return this;}})());(it$0$3076["gensym"]=gensym$2315);(it$0$3076["mkenv"]=env_factory$3072);(it$0$3076["generic_nodes"]=generic_nodes$3073);return it$0$3076;}));(Expander$2322.prototype["run_macro"]=(function(m$3100,context$3101,scope$3102,form$3103,arg$3104){var rval$3127;var rval$3119;var it$0$3108;var self$3109;(it$0$3108=this);(self$3109=this);(rval$3119=(((rval$3127=false)),((function(){try{(rval$3127=m$3100(context$3101,scope$3102,form$3103,arg$3104));}catch(excv$3138){var msg$3195;var msg$3317;var find$3206;var err$3207;var other$3201;var $3178$3183;var e$3175;var e$3325;var value$3148;var t0$3141;var t1$3142;var t2$3143;var t3$3144;(t0$3141=excv$3138);if(($1893($2005(["match"]))(t0$3141)&&($5371(t0$3141,"args")&&(((t1$3142=t0$3141.args)),((t1$3142 instanceof Array)&&(((t2$3143=t1$3142.length)),((t2$3143===1)&&(((t3$3144=t1$3142[0])),$5371(t3$3144,"value"))))))))){(value$3148=t3$3144.value);(rval$3127=(((e$3175=((($3178$3183=value$3148)),(function(){if(($3178$3183===context$3101)){(msg$3195="The macro cannot be found in this context.");return $2005(["syntax","context"]).create(msg$3195,({"context":context$3101,"form":form$3103}));}else{(other$3201=$3178$3183);(find$3206=(function($3211$3214){var t0$3223;var msg$3245;var $index$3279;var $length$3273;var temp$3267;var other$3309;var type$3251;var xs$3252;var t0$3237;var $3216$3232;var ph$3220;var arg$3221;(t0$3223=$3211$3214);(arg$3221=t0$3223);(ph$3220=t0$3223);($3216$3232=ph$3220);if(($3216$3232===value$3148)){(msg$3245="The macro expected something different.");return $2005(["syntax","argument"]).create(msg$3245,({"context":context$3101,"argument":arg$3221,"form":form$3103}));}else{if((($3216$3232 instanceof Array)&&(((t0$3237=$3216$3232.length)),(t0$3237>=1)))){(type$3251=$3216$3232[0]);(xs$3252=Array.prototype.slice.call($3216$3232,1));(temp$3267=xs$3252);($length$3273=temp$3267.length);($index$3279=0);$3261:for(;($index$3279<$length$3273);($index$3279++)){var x$3297;var t0$3293;var m$3288;(m$3288=temp$3267[$index$3279]);(t0$3293=$5420(find$3206)(m$3288));if(t0$3293[0]){(x$3297=t0$3293[1]);if(x$3297){return x$3297;}}else{$1986(m$3288,"/home/olivier/git/earl-grey/src/expand.eg",3685,3770);}}return false;}else{(other$3309=$3216$3232);return false;}}}));(err$3207=find$3206(arg$3104));if(err$3207){return err$3207;}else{(msg$3317="The macro expected something different (could not locate error in the source).");return $2005(["syntax","failure"]).create(msg$3317,({"form":form$3103,"value":value$3148}));}}})()))),function(){throw e$3175;}()));}else{(e$3325=excv$3138);(rval$3127=function(){throw e$3325;}());}}})(),rval$3127)));return it$0$3108.mkenv().mark(rval$3119);}));(Expander$2322.prototype["step"]=(function(context$3336,scope$3337,expr$3338){var helper$3353;var it$0$3342;var self$3343;(it$0$3342=this);(self$3343=this);(helper$3353=track_location$2321((function(context$3360,scope$3361,$3357$3362){var t0$3376;var other$3431;var env$3426;var $3413$3418;var other$3476;var t0$3463;var $3453$3458;var other$3480;var m$3445;var t0$3441;var $3407$3436;var env$3410;var other$3510;var t0$3497;var $3487$3492;var other$3542;var m$3532;var t0$3528;var $3518$3523;var other$3551;var x$3546;var f$3514;var arg$3515;var m$3484;var s$3397;var $3370$3392;var $3371$3393;var $3372$3394;var t0$3390;var $3364$3385;var ph$3373;var expr$3374;(t0$3376=$3357$3362);(expr$3374=t0$3376);(ph$3373=t0$3376);($3364$3385=ph$3373);if((($3370$3392=($3364$3385 instanceof Array))&&(((t0$3390=$3364$3385.length)),(($3372$3394=(t0$3390===2))&&($3364$3385[0]==="symbol"))))){(s$3397=$3364$3385[1]);(env$3410=((($3413$3418=expr$3374)),(function(){if($5371($3413$3418,"env")){(env$3426=$3413$3418.env);return expr$3374.env;}else{(other$3431=$3413$3418);throw $2005(["syntax","no_env"]).create("No environment was found to resolve",({"symbol":expr$3374}));}})()));($3407$3436=env$3410.resolve(scope$3361,s$3397));if((($3407$3436 instanceof Array)&&(((t0$3441=$3407$3436.length)),((t0$3441===2)&&($3407$3436[0]==="macro"))))){(m$3445=$3407$3436[1]);($3453$3458=context$3360);if((($3453$3458 instanceof Array)&&(((t0$3463=$3453$3458.length)),((t0$3463===2)&&(($3453$3458[0]==="expr")&&($3453$3458[1]==="head")))))){return ["macro",m$3445];}else{(other$3476=$3453$3458);return ["bounce",it$0$3342.run_macro(m$3445,context$3360,scope$3361,expr$3374,__lt____lt____colon__$2310(["void"],expr$3374))];}}else{(other$3480=$3407$3436);return expr$3374;}}else{if(($3372$3394&&($3364$3385[0]==="macro"))){(m$3484=$3364$3385[1]);($3487$3492=context$3360);if((($3487$3492 instanceof Array)&&(((t0$3497=$3487$3492.length)),((t0$3497===2)&&(($3487$3492[0]==="expr")&&($3487$3492[1]==="head")))))){return expr$3374;}else{(other$3510=$3487$3492);return ["bounce",it$0$3342.run_macro(m$3484,context$3360,scope$3361,expr$3374,__lt____lt____colon__$2310(["void"],expr$3374))];}}else{if(($3370$3392&&((t0$3390===3)&&($3364$3385[0]==="send")))){(f$3514=$3364$3385[1]);(arg$3515=$3364$3385[2]);($3518$3523=helper$3353(["expr","head"],scope$3361,f$3514));if((($3518$3523 instanceof Array)&&(((t0$3528=$3518$3523.length)),((t0$3528===2)&&($3518$3523[0]==="macro"))))){(m$3532=$3518$3523[1]);return ["bounce",it$0$3342.run_macro(m$3532,context$3360,scope$3361,expr$3374,arg$3515)];}else{(other$3542=$3518$3523);return expr$3374;}}else{if(($3370$3392&&((t0$3390===2)&&($3364$3385[0]==="nostep")))){(x$3546=$3364$3385[1]);return x$3546;}else{(other$3551=$3364$3385);return expr$3374;}}}}})));return helper$3353(context$3336,scope$3337,expr$3338);}));(Expander$2322.prototype["step_all"]=(function(context$3560,scope$3561,$3557$3562){var t0$3577;var t1$3578;var pre$3595;var bulk$3596;var post$3597;var stmts$3575;var it$0$3566;var self$3567;(it$0$3566=this);(self$3567=this);(t0$3577=$3557$3562);if(((t0$3577 instanceof Array)&&(((t1$3578=t0$3577.length)),(t1$3578>=0)))){(stmts$3575=Array.prototype.slice.call(t0$3577,0));}else{$1986($3557$3562);}(pre$3595=[]);(bulk$3596=[]);(post$3597=[]);$3607:while(stmts$3575.length){var $index$3698;var $length$3692;var temp$3686;var acc$3680;var e$3669;var x$3721;var m$3663;var stmt$3658;var stmt$3653;var prepend$3639;var $3618$3634;var $3619$3635;var $3620$3636;var t0$3632;var $3612$3627;var current$3621;(current$3621=stmts$3575.shift());($3612$3627=it$0$3566.step(context$3560,scope$3561,current$3621));if((($3618$3634=($3612$3627 instanceof Array))&&(((t0$3632=$3612$3627.length)),((t0$3632>=1)&&($3612$3627[0]==="splice"))))){(prepend$3639=Array.prototype.slice.call($3612$3627,1));(stmts$3575=prepend$3639.concat(stmts$3575));}else{if(($3618$3634&&(($3620$3636=(t0$3632===2))&&($3612$3627[0]==="float")))){(stmt$3653=$3612$3627[1]);(pre$3595=pre$3595.concat(it$0$3566.step_all(context$3560,scope$3561,[stmt$3653])));}else{if(($3620$3636&&($3612$3627[0]==="sink"))){(stmt$3658=$3612$3627[1]);(post$3597=post$3597.concat(it$0$3566.step_all(context$3560,scope$3561,[stmt$3658])));}else{if(($3620$3636&&($3612$3627[0]==="restmacro"))){(m$3663=$3612$3627[1]);(e$3669=it$0$3566.mkenv());(stmts$3575=(((acc$3680=[])),(((temp$3686=m$3663(stmts$3575))),((($length$3692=temp$3686.length)),((($index$3698=0)),(function(){$3675:for(;($index$3698<$length$3692);($index$3698++)){var stmt$3715;var m$3707;(m$3707=temp$3686[$index$3698]);(stmt$3715=m$3707);acc$3680.push(e$3669.mark(stmt$3715));}})()))),acc$3680));}else{(x$3721=$3612$3627);bulk$3596.push(x$3721);}}}}}return pre$3595.concat(bulk$3596).concat(post$3597);}));(Expander$2322.prototype["expand"]=(function(context$3727,scope$3728,expr$3729){var helper$3744;var it$0$3733;var self$3734;(it$0$3733=this);(self$3734=this);(helper$3744=track_location$2321((function(context$3749,scope$3750,expr$3751){var t0$3816;var other$3838;var $3811$3826;var env$3814;var $index$3891;var $length$3885;var temp$3879;var acc$3873;var newargs$3865;var $index$3945;var $length$3939;var temp$3933;var acc$3927;var newargs$3919;var t0$4009;var newscope$4003;var env$4004;var $index$4093;var $length$4087;var temp$4081;var acc$4075;var $index$4305;var $length$4299;var temp$4293;var acc$4287;var t0$4054;var newscope$4038;var stepscope$4039;var changes$4040;var newargs$4041;var vars$4042;var exp$4043;var $index$4728;var $length$4722;var temp$4716;var other$4832;var t0$4810;var $4799$4805;var is_obj$4607;var obj$4608;var arr$4609;var arr_parts$4610;var obj_parts$4611;var new_arr_part$4612;var new_obj_part$4613;var r$4614;var x$4870;var msg$4877;var otherwise$4893;var m$4883;var t0$4863;var $4848$4858;var t$4852;var $index$4937;var $length$4931;var temp$4925;var acc$4919;var newscope$4907;var s$5016;var newscope$5029;var name$5007;var t0$5003;var $index$5073;var $length$5067;var temp$5061;var acc$5055;var $index$5129;var $length$5123;var temp$5117;var acc$5111;var tokens$5102;var msg$5103;var other$5175;var c$5170;var ops$5095;var args$5096;var type$5044;var args$5045;var tag$5033;var body$5034;var x$4998;var $3771$4999;var bindings$4901;var body$4902;var target$4842;var value$4843;var args$4595;var args$4029;var args$4024;var args$4019;var variable$3983;var s$3984;var value$3985;var body$3986;var args$3914;var args$3860;var f$3854;var arg$3855;var s$3801;var $3779$3796;var $3780$3797;var $3781$3798;var t0$3792;var t1$3793;var t2$3794;var $3755$3787;(expr$3751=it$0$3733.step(context$3749,scope$3750,expr$3751));($3755$3787=expr$3751);if((($3779$3796=($3755$3787 instanceof Array))&&(((t0$3792=$3755$3787.length)),(($3781$3798=(t0$3792===2))&&($3755$3787[0]==="symbol"))))){(s$3801=$3755$3787[1]);(t0$3816=expr$3751);if($5371(t0$3816,"env")){(env$3814=t0$3816.env);}else{$1986(expr$3751,"/home/olivier/git/earl-grey/src/expand.eg",8047,8051);}($3811$3826=env$3814.resolve(scope$3750,s$3801));if(($3811$3826===(void 0))){throw $2005(["syntax","undeclared"]).create(("Undeclared variable: "+s$3801),({"node":expr$3751}));}else{(other$3838=$3811$3826);return ["bounce",other$3838];}}else{if(($3781$3798&&($3755$3787[0]==="value"))){$3755$3787[1];return expr$3751;}else{if(($3781$3798&&($3755$3787[0]==="variable"))){$3755$3787[1];return expr$3751;}else{if(($3779$3796&&((t0$3792===1)&&($3755$3787[0]==="void")))){return expr$3751;}else{if(($3779$3796&&((t0$3792===3)&&($3755$3787[0]==="send")))){(f$3854=$3755$3787[1]);(arg$3855=$3755$3787[2]);return ["send",helper$3744(["expr","head"],scope$3750,f$3854),helper$3744(["expr","tail"],scope$3750,arg$3855)];}else{if(($3779$3796&&(($3781$3798=(t0$3792>=1))&&($3755$3787[0]==="array")))){(args$3860=Array.prototype.slice.call($3755$3787,1));(newargs$3865=(((acc$3873=[])),(((temp$3879=it$0$3733.step_all(["expr","array"],scope$3750,args$3860))),((($length$3885=temp$3879.length)),((($index$3891=0)),(function(){$3868:for(;($index$3891<$length$3885);($index$3891++)){var arg$3908;var m$3900;(m$3900=temp$3879[$index$3891]);(arg$3908=m$3900);acc$3873.push(helper$3744(["expr","expr"],scope$3750,arg$3908));}})()))),acc$3873));return ["array"].concat(newargs$3865);}else{if(($3781$3798&&($3755$3787[0]==="object"))){(args$3914=Array.prototype.slice.call($3755$3787,1));(newargs$3919=(((acc$3927=[])),(((temp$3933=it$0$3733.step_all(["expr","object"],scope$3750,args$3914))),((($length$3939=temp$3933.length)),((($index$3945=0)),(function(){$3922:for(;($index$3945<$length$3939);($index$3945++)){var k$3964;var v$3965;var t0$3959;var t1$3960;var m$3954;(m$3954=temp$3933[$index$3945]);(t0$3959=m$3954);if(((t0$3959 instanceof Array)&&(((t1$3960=t0$3959.length)),((t1$3960===3)&&(t0$3959[0]==="array"))))){(k$3964=t0$3959[1]);(v$3965=t0$3959[2]);acc$3927.push(["array",helper$3744(["expr","expr"],scope$3750,k$3964),helper$3744(["expr","expr"],scope$3750,v$3965)]);}else{$1986(m$3954,"/home/olivier/git/earl-grey/src/expand.eg",8890,9079);}}})()))),acc$3927));return ["object"].concat(newargs$3919);}else{if(($3779$3796&&((t0$3792===4)&&(($3755$3787[0]==="bind")&&(((t1$3793=$3755$3787[1])),((variable$3983=t1$3793),((t1$3793 instanceof Array)&&(((t2$3794=t1$3793.length)),((t2$3794===2)&&(t1$3793[0]==="symbol")))))))))){(s$3984=t1$3793[1]);(value$3985=$3755$3787[2]);(body$3986=$3755$3787[3]);(newscope$4003=Scope$2319(scope$3750));(t0$4009=variable$3983);if($5371(t0$4009,"env")){(env$4004=t0$4009.env);}else{$1986(variable$3983,"/home/olivier/git/earl-grey/src/expand.eg",9222,9230);}env$4004.bind(newscope$4003,s$3984,value$3985);return helper$3744(context$3749,newscope$4003,body$3986);}else{if(($3779$3796&&(($3781$3798=(t0$3792>=1))&&($3755$3787[0]==="splice")))){(args$4019=Array.prototype.slice.call($3755$3787,1));return ["bounce",$1912(["multi"].concat(args$4019),({"override_scope":true}))];}else{if(($3781$3798&&($3755$3787[0]==="interactive"))){(args$4024=Array.prototype.slice.call($3755$3787,1));return ["bounce",$1912(["multi"].concat(args$4024),({"override_scope":true,"all_mutable":true}))];}else{if(($3781$3798&&($3755$3787[0]==="multi"))){(args$4029=Array.prototype.slice.call($3755$3787,1));(newscope$4038=(function(){if(expr$3751.override_scope){return scope$3750;}else{return Scope$2319(scope$3750);}})());(stepscope$4039=(function(){if(expr$3751.nonrecursive){return scope$3750;}else{return newscope$4038;}})());(changes$4040=false);(t0$4054=classify$2312("newargs","vars",(((acc$4075=[])),(((temp$4081=it$0$3733.step_all(["expr","multi"],stepscope$4039,args$4029))),((($length$4087=temp$4081.length)),((($index$4093=0)),(function(){$4059:for(;($index$4093<$length$4087);($index$4093++)){var t0$4159;var env$4157;var t0$4193;var v$4204;var env$4191;var t0$4251;var env$4249;var other$4264;var s$4231;var variable$4232;var v$4213;var value$4214;var variable$4172;var s$4173;var value$4174;var variable$4137;var s$4138;var value$4139;var opt$4120;var value$4121;var $4067$4112;var $4068$4113;var $4069$4114;var $4070$4115;var $4071$4116;var $4072$4117;var t0$4107;var t1$4108;var t2$4109;var t3$4110;var m$4102;(m$4102=temp$4081[$index$4093]);(t0$4107=m$4102);if((($4068$4113=(t0$4107 instanceof Array))&&(((t1$4108=t0$4107.length)),(($4070$4115=(t1$4108===3))&&(t0$4107[0]==="option"))))){(opt$4120=t0$4107[1]);(value$4121=t0$4107[2]);acc$4075.push((newscope$4038.setopt(opt$4120,value$4121),["ignore"]));}else{if(($4070$4115&&((t0$4107[0]==="declare_raw")&&(((t2$4109=t0$4107[1])),((variable$4137=t2$4109),((t2$4109 instanceof Array)&&(((t3$4110=t2$4109.length)),((t3$4110===2)&&(t2$4109[0]==="symbol"))))))))){(s$4138=t2$4109[1]);(value$4139=t0$4107[2]);acc$4075.push(((((t0$4159=variable$4137)),(function(){if($5371(t0$4159,"env")){(env$4157=t0$4159.env);}else{return $1986(variable$4137,"/home/olivier/git/earl-grey/src/expand.eg",10176,10184);}})()),env$4157.bind(newscope$4038,s$4138,value$4139),((changes$4040=true)),["ignore"]));}else{if(($4068$4113&&(($4070$4115=((t1$4108>=2)&&(t1$4108<=3)))&&(($4071$4116=(t0$4107[0]==="declare"))&&(((t2$4109=t0$4107[1])),((variable$4172=t2$4109),((t2$4109 instanceof Array)&&(((t3$4110=t2$4109.length)),((t3$4110===2)&&(t2$4109[0]==="symbol")))))))))){(s$4173=t2$4109[1]);(value$4174=(function(){if((2>=t1$4108)){return null;}else{return t0$4107[2];}})());acc$4075.push(((((t0$4193=variable$4172)),(function(){if($5371(t0$4193,"env")){(env$4191=t0$4193.env);}else{return $1986(variable$4172,"/home/olivier/git/earl-grey/src/expand.eg",10424,10432);}})()),(function(){if((variable$4172.use_previous&&env$4191.resolve(newscope$4038,s$4173))){return ["splice"];}else{(v$4204=__lt____lt____colon__$2310(["variable",it$0$3733.gensym(s$4173)],variable$4172));$1912(v$4204,({"mutable":(expr$3751.all_mutable||variable$4172.mutable)}));env$4191.bind(newscope$4038,s$4173,v$4204);(changes$4040=true);if(value$4174){return ["splice",["newargs",["assign",v$4204,value$4174]],["vars",v$4204]];}else{return ["vars",v$4204];}}})()));}else{if(($4071$4116&&((v$4213=t2$4109),((t2$4109 instanceof Array)&&(((t3$4110=t2$4109.length)),((t3$4110===2)&&(t2$4109[0]==="variable"))))))){t2$4109[1];(value$4214=(function(){if((2>=t1$4108)){return null;}else{return t0$4107[2];}})());acc$4075.push((((changes$4040=true)),(function(){if(value$4214){return ["splice",["newargs",["assign",v$4213,value$4214]],["vars",v$4213]];}else{return ["vars",v$4213];}})()));}else{if(($4068$4113&&((t1$4108===2)&&((t0$4107[0]==="undeclare")&&(((t2$4109=t0$4107[1])),((t2$4109 instanceof Array)&&(((t3$4110=t2$4109.length)),((t3$4110===2)&&(t2$4109[0]==="symbol"))))))))){(s$4231=t2$4109[1]);(variable$4232=t2$4109);acc$4075.push(((((t0$4251=variable$4232)),(function(){if($5371(t0$4251,"env")){(env$4249=t0$4251.env);}else{return $1986(variable$4232,"/home/olivier/git/earl-grey/src/expand.eg",11696,11704);}})()),env$4249.bind(newscope$4038,s$4231,(void 0)),((changes$4040=true)),["ignore"]));}else{(other$4264=m$4102);acc$4075.push(["newargs",other$4264]);}}}}}}})()))),acc$4075)));if(($5371(t0$4054,"newargs")&&((newargs$4041=t0$4054.newargs),$5371(t0$4054,"vars")))){(vars$4042=t0$4054.vars);}else{$1986(classify$2312("newargs","vars",(((acc$4287=[])),(((temp$4293=it$0$3733.step_all(["expr","multi"],stepscope$4039,args$4029))),((($length$4299=temp$4293.length)),((($index$4305=0)),(function(){$4271:for(;($index$4305<$length$4299);($index$4305++)){var t0$4371;var env$4369;var t0$4405;var v$4416;var env$4403;var t0$4463;var env$4461;var other$4476;var s$4443;var variable$4444;var v$4425;var value$4426;var variable$4384;var s$4385;var value$4386;var variable$4349;var s$4350;var value$4351;var opt$4332;var value$4333;var $4279$4324;var $4280$4325;var $4281$4326;var $4282$4327;var $4283$4328;var $4284$4329;var t0$4319;var t1$4320;var t2$4321;var t3$4322;var m$4314;(m$4314=temp$4293[$index$4305]);(t0$4319=m$4314);if((($4280$4325=(t0$4319 instanceof Array))&&(((t1$4320=t0$4319.length)),(($4282$4327=(t1$4320===3))&&(t0$4319[0]==="option"))))){(opt$4332=t0$4319[1]);(value$4333=t0$4319[2]);acc$4287.push((newscope$4038.setopt(opt$4332,value$4333),["ignore"]));}else{if(($4282$4327&&((t0$4319[0]==="declare_raw")&&(((t2$4321=t0$4319[1])),((variable$4349=t2$4321),((t2$4321 instanceof Array)&&(((t3$4322=t2$4321.length)),((t3$4322===2)&&(t2$4321[0]==="symbol"))))))))){(s$4350=t2$4321[1]);(value$4351=t0$4319[2]);acc$4287.push(((((t0$4371=variable$4349)),(function(){if($5371(t0$4371,"env")){(env$4369=t0$4371.env);}else{return $1986(variable$4349,"/home/olivier/git/earl-grey/src/expand.eg",10176,10184);}})()),env$4369.bind(newscope$4038,s$4350,value$4351),((changes$4040=true)),["ignore"]));}else{if(($4280$4325&&(($4282$4327=((t1$4320>=2)&&(t1$4320<=3)))&&(($4283$4328=(t0$4319[0]==="declare"))&&(((t2$4321=t0$4319[1])),((variable$4384=t2$4321),((t2$4321 instanceof Array)&&(((t3$4322=t2$4321.length)),((t3$4322===2)&&(t2$4321[0]==="symbol")))))))))){(s$4385=t2$4321[1]);(value$4386=(function(){if((2>=t1$4320)){return null;}else{return t0$4319[2];}})());acc$4287.push(((((t0$4405=variable$4384)),(function(){if($5371(t0$4405,"env")){(env$4403=t0$4405.env);}else{return $1986(variable$4384,"/home/olivier/git/earl-grey/src/expand.eg",10424,10432);}})()),(function(){if((variable$4384.use_previous&&env$4403.resolve(newscope$4038,s$4385))){return ["splice"];}else{(v$4416=__lt____lt____colon__$2310(["variable",it$0$3733.gensym(s$4385)],variable$4384));$1912(v$4416,({"mutable":(expr$3751.all_mutable||variable$4384.mutable)}));env$4403.bind(newscope$4038,s$4385,v$4416);(changes$4040=true);if(value$4386){return ["splice",["newargs",["assign",v$4416,value$4386]],["vars",v$4416]];}else{return ["vars",v$4416];}}})()));}else{if(($4283$4328&&((v$4425=t2$4321),((t2$4321 instanceof Array)&&(((t3$4322=t2$4321.length)),((t3$4322===2)&&(t2$4321[0]==="variable"))))))){t2$4321[1];(value$4426=(function(){if((2>=t1$4320)){return null;}else{return t0$4319[2];}})());acc$4287.push((((changes$4040=true)),(function(){if(value$4426){return ["splice",["newargs",["assign",v$4425,value$4426]],["vars",v$4425]];}else{return ["vars",v$4425];}})()));}else{if(($4280$4325&&((t1$4320===2)&&((t0$4319[0]==="undeclare")&&(((t2$4321=t0$4319[1])),((t2$4321 instanceof Array)&&(((t3$4322=t2$4321.length)),((t3$4322===2)&&(t2$4321[0]==="symbol"))))))))){(s$4443=t2$4321[1]);(variable$4444=t2$4321);acc$4287.push(((((t0$4463=variable$4444)),(function(){if($5371(t0$4463,"env")){(env$4461=t0$4463.env);}else{return $1986(variable$4444,"/home/olivier/git/earl-grey/src/expand.eg",11696,11704);}})()),env$4461.bind(newscope$4038,s$4443,(void 0)),((changes$4040=true)),["ignore"]));}else{(other$4476=m$4314);acc$4287.push(["newargs",other$4476]);}}}}}}})()))),acc$4287)),"/home/olivier/git/earl-grey/src/expand.eg",9848,11926);}(exp$4043=(function(s$4483){var $index$4516;var $length$4510;var temp$4504;var acc$4498;var $index$4572;var $length$4566;var temp$4560;var acc$4554;var stepped$4487;(stepped$4487=(((acc$4498=[])),(((temp$4504=$2238(newargs$4041))),((($length$4510=temp$4504.length)),((($index$4516=0)),(function(){$4493:for(;($index$4516<$length$4510);($index$4516++)){var i$4535;var arg$4536;var t0$4530;var t1$4531;var m$4525;(m$4525=temp$4504[$index$4516]);(t0$4530=m$4525);if(((t0$4530 instanceof Array)&&(((t1$4531=t0$4530.length)),(t1$4531===2)))){(i$4535=t0$4530[0]);(arg$4536=t0$4530[1]);acc$4498.push(it$0$3733.step(["expr",(function(){if((i$4535===(newargs$4041.length-1))){return "expr";}else{return "ignore";}})()],s$4483,arg$4536));}else{$1986(m$4525,"/home/olivier/git/earl-grey/src/expand.eg",12148,12325);}}})()))),acc$4498));(acc$4554=[]);(temp$4560=stepped$4487);($length$4566=temp$4560.length);($index$4572=0);$4488:for(;($index$4572<$length$4566);($index$4572++)){var arg$4589;var m$4581;(m$4581=temp$4560[$index$4572]);(arg$4589=m$4581);acc$4554.push(helper$3744(["expr","expr"],s$4483,arg$4589));}return acc$4554;}));if(changes$4040){return ["scope",vars$4042,["multi"].concat(exp$4043(newscope$4038))];}else{return ["multi"].concat(exp$4043(scope$3750));}}else{if(($3781$3798&&($3755$3787[0]==="data"))){(args$4595=Array.prototype.slice.call($3755$3787,1));(is_obj$4607=false);(obj$4608=["object"]);(arr$4609=["array"]);(arr_parts$4610=[]);(obj_parts$4611=[]);(new_arr_part$4612=(function(){var other$4669;var t0$4656;var $4646$4651;($4646$4651=arr$4609);if((($4646$4651 instanceof Array)&&(((t0$4656=$4646$4651.length)),((t0$4656===1)&&($4646$4651[0]==="array"))))){return false;}else{(other$4669=$4646$4651);arr_parts$4610.push(arr$4609);(arr$4609=["array"]);}}));(new_obj_part$4613=(function(){var other$4705;var t0$4692;var $4682$4687;($4682$4687=obj$4608);if((($4682$4687 instanceof Array)&&(((t0$4692=$4682$4687.length)),((t0$4692===1)&&($4682$4687[0]==="object"))))){return false;}else{(other$4705=$4682$4687);obj_parts$4611.push(obj$4608);(obj$4608=["object"]);}}));(temp$4716=it$0$3733.step_all(["expr","data"],scope$3750,args$4595));($length$4722=temp$4716.length);($index$4728=0);$4615:for(;($index$4728<$length$4722);($index$4728++)){var other$4795;var expr$4785;var expr$4779;var k$4768;var v$4769;var $4622$4745;var $4623$4746;var $4624$4747;var $4625$4748;var t0$4742;var t1$4743;var m$4737;(m$4737=temp$4716[$index$4728]);(t0$4742=m$4737);if((($4623$4746=(t0$4742 instanceof Array))&&(((t1$4743=t0$4742.length)),((t1$4743===1)&&(t0$4742[0]==="assoc"))))){(is_obj$4607=true);}else{if(($4623$4746&&((t1$4743===3)&&(t0$4742[0]==="assoc")))){(k$4768=t0$4742[1]);(v$4769=t0$4742[2]);(is_obj$4607=true);obj$4608.push(["array",k$4768,v$4769]);}else{if(($4623$4746&&(($4625$4748=(t1$4743===2))&&(t0$4742[0]==="dynsplice")))){(expr$4779=t0$4742[1]);new_arr_part$4612();arr_parts$4610.push(expr$4779);}else{if(($4625$4748&&(t0$4742[0]==="objsplice"))){(expr$4785=t0$4742[1]);(is_obj$4607=true);new_obj_part$4613();obj_parts$4611.push(expr$4785);}else{(other$4795=m$4737);arr$4609.push(other$4795);}}}}}new_arr_part$4612();new_obj_part$4613();(r$4614=((($4799$4805=arr_parts$4610)),(function(){if((($4799$4805 instanceof Array)&&(((t0$4810=$4799$4805.length)),((t0$4810===0)&&is_obj$4607)))){return util$2311.construct(obj_parts$4611,(function(x$4823,rest$4824){return ["send",["symbol","&:"],["data",x$4823,rest$4824]];}),["object"]);}else{$4799$4805;if(is_obj$4607){throw $2005(["syntax","array","object"]).create("Cannot mix array and object notations.");}else{(other$4832=$4799$4805);return util$2311.construct(arr_parts$4610.reverse(),(function(x$4836,rest$4837){return ["send",["send",rest$4837,["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",x$4836]];}),["array"]);}}})()));return helper$3744(context$3749,scope$3750,it$0$3733.mkenv().mark(r$4614));}else{if(($3779$3796&&(($3781$3798=(t0$3792===3))&&($3755$3787[0]==="assign")))){(target$4842=$3755$3787[1]);(value$4843=$3755$3787[2]);(t$4852=helper$3744(["expr","expr"],scope$3750,target$4842));($4848$4858=t$4852);if(((((x$4870=$4848$4858)),((x$4870 instanceof Array)&&(x$4870[0]==="variable")))&&(((!t$4852.mutable)&&t$4852.assigned)&&(t$4852.assigned.group_id!==target$4842.group_id)))){(msg$4877=["Variable was declared as read-only. Declare it as","mutable at the origin with `var` (if you have access","to the declaration) or declare a new variable with","`let` or `var` or remove the original binding with","`delete`"].join(" "));throw $2005(["syntax"]).create(msg$4877,({"variable":target$4842,"loc":t$4852.assigned}));}else{if((($4848$4858 instanceof Array)&&(((t0$4863=$4848$4858.length)),((t0$4863===2)&&($4848$4858[0]==="macro"))))){(m$4883=$4848$4858[1]);["bounce",m$4883(["assign"],scope$3750,expr$3751,value$4843)];}else{(otherwise$4893=$4848$4858);(t$4852["assigned"]=target$4842);}}return ["assign",t$4852,helper$3744(["expr","expr"],scope$3750,value$4843)];}else{if(($3781$3798&&($3755$3787[0]==="lambda"))){(bindings$4901=$3755$3787[1]);(body$4902=$3755$3787[2]);(newscope$4907=Scope$2319(scope$3750));return ["lambda",(((acc$4919=[])),(((temp$4925=bindings$4901)),((($length$4931=temp$4925.length)),((($index$4937=0)),(function(){$4911:for(;($index$4937<$length$4931);($index$4937++)){var v$4974;var x$4985;var other$4993;var v$4981;var b$4957;var env$4958;var $4916$4954;var t0$4951;var t1$4952;var m$4946;(m$4946=temp$4925[$index$4937]);(t0$4951=m$4946);if(((t0$4951 instanceof Array)&&(((t1$4952=t0$4951.length)),((t1$4952===2)&&((t0$4951[0]==="symbol")&&((b$4957=t0$4951[1]),$5371(t0$4951,"env"))))))){(env$4958=t0$4951.env);acc$4919.push((((v$4974=["variable",it$0$3733.gensym(b$4957)])),(env$4958.bind(newscope$4907,b$4957,v$4974),v$4974)));}else{if((((x$4985=t0$4951)),((x$4985 instanceof Array)&&(x$4985[0]==="variable")))){(v$4981=t0$4951);acc$4919.push(v$4981);}else{(other$4993=m$4946);acc$4919.push(function(){throw $2005(["syntax","lambda","binding"]).create("Not a valid binding.",({"node":other$4993}));}());}}}})()))),acc$4919),helper$3744(["expr","expr"],newscope$4907,body$4902)];}else{if(($3781$3798&&($3755$3787[0]==="use"))){($3771$4999=$3755$3787[1]);(x$4998=$3755$3787[2]);(t0$5003=$3771$4999);if((typeof(t0$5003)==="string")){(name$5007=t0$5003);(s$5016=scope$3750);$5020:while(s$5016){if((s$5016.name.slice(0,(name$5007.length+1))===(name$5007+"/"))){break $5020;}else{(s$5016=s$5016.parent);}}if(s$5016){return helper$3744(context$3749,s$5016,x$4998);}else{throw $2005(["syntax","noscope"]).create(("Could not find a scope tagged: "+name$5007));}}else{(newscope$5029=$3771$4999);return helper$3744(context$3749,newscope$5029,x$4998);}}else{if(($3781$3798&&(($3755$3787[0]==="tagscope")&&(((t1$3793=$3755$3787[1])),(typeof(t1$3793)==="string"))))){(tag$5033=t1$3793);(body$5034=$3755$3787[2]);return helper$3744(context$3749,Scope$2319(scope$3750,it$0$3733.gensym((tag$5033+"/"))),body$5034);}else{if(($3779$3796&&((t0$3792>=1)&&((type$5044=$3755$3787[0]),((args$5045=Array.prototype.slice.call($3755$3787,1)),(it$0$3733.generic_nodes.indexOf(type$5044)!==-1)))))){return [type$5044].concat((((acc$5055=[])),(((temp$5061=args$5045)),((($length$5067=temp$5061.length)),((($index$5073=0)),(function(){$5050:for(;($index$5073<$length$5067);($index$5073++)){var arg$5090;var m$5082;(m$5082=temp$5061[$index$5073]);(arg$5090=m$5082);acc$5055.push(helper$3744(["expr","expr"],scope$3750,arg$5090));}})()))),acc$5055));}else{if(($3779$3796&&((t0$3792>=2)&&($3755$3787[0]==="mismix")))){(ops$5095=$3755$3787[1]);(args$5096=Array.prototype.slice.call($3755$3787,2));(tokens$5102=$5467((((acc$5111=[])),(((temp$5117=$2238(ops$5095))),((($length$5123=temp$5117.length)),((($index$5129=0)),(function(){$5106:for(;($index$5129<$length$5123);($index$5129++)){var i$5148;var op$5149;var t0$5143;var t1$5144;var m$5138;(m$5138=temp$5117[$index$5129]);(t0$5143=m$5138);if(((t0$5143 instanceof Array)&&(((t1$5144=t0$5143.length)),(t1$5144===2)))){(i$5148=t0$5143[0]);(op$5149=t0$5143[1]);acc$5111.push([("token"+String((i$5148+1))),op$5149]);}else{$1986(m$5138,"/home/olivier/git/earl-grey/src/expand.eg",17284,17384);}}})()))),acc$5111)));(msg$5103="These operators or brackets cannot be mixed together.");throw $2005(["syntax","mismatch"]).create(msg$5103,tokens$5102);}else{if(($3779$3796&&((t0$3792===2)&&($3755$3787[0]==="char")))){(c$5170=$3755$3787[1]);throw $2005(["syntax","illegal_character"]).create("An illegal character was found.",({"node":expr$3751}));}else{(other$5175=$3755$3787);throw $2005(["syntax","illegal_node"]).create("An illegal node was found.",({"node":other$5175,"context":context$3749}));}}}}}}}}}}}}}}}}}}}})));return helper$3744(context$3727,scope$3728,expr$3729);}));$1912(Expander$2322,$1912(((accum$5181=({})),((accum$5181["::name"]="Expander"),accum$5181)),((accum$5185=({})),((accum$5185["::egclass"]=true),accum$5185))));Expander$2322;(mac1$2323=(function(f$5192){return ["macro",(function(context$5198,scope$5199,form$5200,$5195$5201){var t0$5205;var t1$5206;var expr$5203;(t0$5205=$5195$5201);if(((t0$5205 instanceof Array)&&(((t1$5206=t0$5205.length)),((t1$5206===2)&&(t0$5205[0]==="data"))))){(expr$5203=t0$5205[1]);}else{$1986($5195$5201);}return f$5192(expr$5203);})];}));(__chk_ncache$2324=({}));(__chk_scache$2325=({}));(checker_db$2326=(function($5229$5232){var v$5277;var v$5296;var s$5290;var n$5271;var $5234$5247;var ph$5241;(ph$5241=$5229$5232);($5234$5247=ph$5241);if(($5234$5247===null)){return checker_db$2326.null;}else{if(($5234$5247===(void 0))){return checker_db$2326.undefined;}else{if(($5234$5247===true)){return checker_db$2326.true;}else{if(($5234$5247===false)){return checker_db$2326.false;}else{if((typeof($5234$5247)==="number")){(n$5271=$5234$5247);if($1929(__chk_ncache$2324,n$5271)){return $1929(__chk_ncache$2324,n$5271);}else{(v$5277=mac1$2323((function(x$5282){return ["send",["symbol","==="],["data",x$5282,["value",n$5271]]];})));(__chk_ncache$2324[n$5271]=v$5277);return v$5277;}}else{if((typeof($5234$5247)==="string")){(s$5290=$5234$5247);if(Object.prototype.hasOwnProperty.call(__chk_scache$2325,s$5290)){return $1929(__chk_scache$2325,s$5290);}else{(v$5296=mac1$2323((function(x$5301){return ["send",["symbol","==="],["data",x$5301,["value",s$5290]]];})));(__chk_scache$2325[s$5290]=v$5296);return v$5296;}}else{$1986($5234$5247);}}}}}}}));$1912(checker_db$2326,({"String":mac1$2323((function(x$5312){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$5312]],["value","string"]]];})),"Number":mac1$2323((function(x$5316){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$5316]],["value","number"]]];})),"Array":mac1$2323((function(x$5320){return ["send",["symbol","instanceof"],["data",x$5320,["symbol","Array"]]];})),"true":mac1$2323((function(x$5324){return x$5324;})),"false":mac1$2323((function(x$5328){return ["send",["symbol","not"],["data",["void"],x$5328]];})),"null":mac1$2323((function(x$5332){return ["send",["symbol","==="],["data",x$5332,["value",null]]];})),"undefined":mac1$2323((function(x$5336){return ["send",["symbol","==="],["data",x$5336,["value",(void 0)]]];}))}));(exports["Env"]=Env$2320);(exports["Scope"]=Scope$2319);(exports["track_location"]=track_location$2321);(exports["Expander"]=Expander$2322);(exports["GenSym"]=GenSym$2314);(exports["gensym"]=gensym$2315);(exports["mac1"]=mac1$2323);(exports["checker_db"]=checker_db$2326);
