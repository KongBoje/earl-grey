var $953=function(type$955){var f$958;(f$958=type$955["::check"]);;if((f$958===(void 0))){return function(value$963){return (value$963 instanceof type$955);};}else{return function(value$966){return f$958.call(type$955,value$966);};}};
var $968=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $969=function($970$972){var ph$976;(ph$976=$970$972);;var $974$981;($974$981=ph$976);;var bridge$975$986;var x$990;(bridge$975$986=$974$981);if((((typeof(bridge$975$986)==="string")&&((x$990=bridge$975$986),true))||((typeof(bridge$975$986)==="number")&&((x$990=bridge$975$986),true)))){return ["value",x$990];}else{var other$997;(other$997=$974$981);return other$997["::serialize_ast"]();}};
var send$793;(send$793=function(obj$798,$796$799){var ph$803;var msg$804;var t0$806;(t0$806=$796$799);(msg$804=t0$806);(ph$803=t0$806);;var $801$810;($801$810=ph$803);;var bridge$802$815;(bridge$802$815=$801$810);if(((typeof(bridge$802$815)==="string")||(typeof(bridge$802$815)==="number"))){return obj$798[msg$804];}else{var other$823;(other$823=$801$810);return obj$798["::send"](msg$804);}});;(Array[":::project"]=function($826$828){var ph$831;var value$832;var t0$834;(t0$834=$826$828);(value$832=t0$834);(ph$831=t0$834);;var $830$838;($830$838=ph$831);;if($953(Array)($830$838)){return [true,value$832];}else{$830$838;return [true,[value$832]];}});(Array.prototype["::check"]=function(value$852){if((value$852 instanceof Array)){var i$857;(i$857=0);;$855:for(;(i$857<this.length);(i$857++)){if(($968(this,i$857)!==$968(value$852,i$857))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return this.slice(0);});(Array.prototype[":::project"]=function(value$868){if((value$868 instanceof Array)){var i$873;(i$873=0);;$871:for(;(i$873<this.length);(i$873++)){if(($968(this,i$873)!==$968(value$868,i$873))){return [true,[value$868]];}}return [true,value$868.slice(this.length)];}else{return [true,[value$868]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($969));});(RegExp.prototype["::check"]=function($883$885){var ph$888;(ph$888=$883$885);;var $887$893;($887$893=ph$888);;var value$901;if((typeof($887$893)==="string")){(value$901=$887$893);if(value$901.match(this)){return true;}else{return false;}}else{var other$906;(other$906=$887$893);return false;}});(RegExp.prototype[":::project"]=function($908$910){var ph$913;(ph$913=$908$910);;var $912$918;($912$918=ph$913);;var value$926;if((typeof($912$918)==="string")){(value$926=$912$918);var $929$931;($929$931=value$926.match(this));;var m$939;if(($929$931===null)){(m$939=$929$931);return [false,null];}else{var m$944;(m$944=$929$931);return [true,m$944];}}else{var other$948;(other$948=$912$918);return [false,null];}});(Function.prototype["::send"]=function(args$951){return this.apply(this,args$951);});
var $3225=function(arr$3227){var results$3231;var l$3232;(results$3231=[]);;(l$3232=arr$3227.length);;var i$3240;(i$3240=0);;$3230:for(;(i$3240<l$3232);(i$3240++)){results$3231.push([i$3240,$968(arr$3227,i$3240)]);}return results$3231;};
var $3247=function(dest$3249,values$3250){var k$3255;(k$3255=null);$3253:for(k$3255 in values$3250){if(values$3250.hasOwnProperty(k$3255)){(dest$3249[k$3255]=values$3250[k$3255]);}}return dest$3249;};
var $3056=function(){var $3057$3059;($3057$3059=function(tags$3063){var it$0$3066;(it$0$3066=function(){if((!$953($3057$3059)(this))){return Object.create($3057$3059.prototype);}else{return this;}}());;(it$0$3066["tags"]=tags$3063);return it$0$3066;});;($3057$3059.prototype["create"]=function(){var $3075$3077;($3075$3077=arguments);;var t0$3082;var message$3086;var args$3087;(t0$3082=$3075$3077.length);if((t0$3082>=0)){(message$3086=function(){if((0>=t0$3082)){return "";}else{return $3075$3077[0];}}());(args$3087=Array.prototype.slice.call($3075$3077,1));var it$0$3091;(it$0$3091=this);;var self$3096;(self$3096=this);;var e$3101;(e$3101=Error(message$3086));;(e$3101["::tags"]=it$0$3091.tags);(e$3101["args"]=args$3087);var temp$3109;(temp$3109=$3225(args$3087));;var $length$3114;($length$3114=temp$3109.length);;var $index$3119;($index$3119=0);;$3102:for(;($index$3119<$length$3114);($index$3119++)){var m$3127;(m$3127=temp$3109[$index$3119]);;var t0$3132;var t1$3133;var i$3137;var arg$3138;(t0$3132=m$3127);if(((t0$3132 instanceof Array)&&((t1$3133=t0$3132.length),(t1$3133===2)))){(i$3137=t0$3132[0]);(arg$3138=t0$3132[1]);(e$3101[i$3137]=arg$3138);}else{$3043(m$3127);;}}(e$3101["length"]=args$3087.length);(e$3101["name"]=["E"].concat(it$0$3091.tags).join("."));return e$3101;}else{$3043($3075$3077);}});($3057$3059.prototype["::check"]=function(e$3149){var it$0$3152;(it$0$3152=this);;var self$3157;(self$3157=this);;var tags$3162;if(((!e$3149)||(!$953(Error)(e$3149)))){return false;}(tags$3162=(e$3149["::tags"]||[]));;var temp$3171;(temp$3171=it$0$3152.tags);;var $length$3176;($length$3176=temp$3171.length);;var $index$3181;($index$3181=0);;$3163:for(;($index$3181<$length$3176);($index$3181++)){var m$3189;(m$3189=temp$3171[$index$3181]);;var tag$3197;(tag$3197=m$3189);if((tags$3162.indexOf(tag$3197)===-1)){return false;}else{false;;}}return true;});($3057$3059.prototype["::deconstruct"]=function(e$3205){var it$0$3208;(it$0$3208=this);;var self$3213;(self$3213=this);;return e$3205.args;});$3247($3057$3059,$3247(function(){var accum$3218;(accum$3218=({}));(accum$3218["::name"]="$3057");return accum$3218;}(),function(){var accum$3222;(accum$3222=({}));(accum$3222["::egclass"]=true);return accum$3222;}()));return $3057$3059;}();
var $3043=function(value$3045,url$3046,start$3047,end$3048){var err$3051;(err$3051=$3056(["match"]).create("Could not find a match for value",({"value":value$3045})));;if(url$3046){(err$3051["location"]=["location",url$3046,start$3047,end$3048]);}throw err$3051;};
var $3259=function($3260$3262,key$3263){var ph$3267;(ph$3267=$3260$3262);;var $3265$3272;($3265$3272=ph$3267);;var bridge$3266$3277;(bridge$3266$3277=$3265$3272);if(((bridge$3266$3277===null)||(bridge$3266$3277===(void 0)))){return false;}else{var x$3285;if((typeof($3265$3272)==="string")){(x$3285=$3265$3272);return (key$3263 in String.prototype);}else{var x$3290;if((typeof($3265$3272)==="number")){(x$3290=$3265$3272);return (key$3263 in Number.prototype);}else{var x$3295;(x$3295=$3265$3272);return (key$3263 in x$3295);}}}};
var $3297=function(type$3299){return function(value$3302){var f$3305;(f$3305=type$3299[":::project"]);;if((f$3305===(void 0))){var f$3310;(f$3310=type$3299["::project"]);;if((f$3310===(void 0))){return [true,type$3299(value$3302)];}else{var rval$3315;(rval$3315=false);;try{(rval$3315=[true,f$3310(value$3302)]);}catch(excv$3321){var e$3327;(e$3327=excv$3321);(rval$3315=[false,null]);}return rval$3315;}}else{return f$3305.call(type$3299,value$3302);}};};var accum$1239;var accum$1243;var accum$1532;var accum$1536;var accum$2924;var accum$2928;var $1000$1004;var __lt____gt__$1005;var $1001$1006;var __lt____lt____colon__$1007;var util$1008;var classify$1009;var items$1010;var iterkeys$1011;var enumerate$1012;var neighbours$1013;var zip$1014;var GenSym$1015;var gensym$1016;var uuid$1017;var $1003$1018;var PatternParser$1019;var PatternProcessor$1020;var Scope$1021;var Env$1022;var track_location$1023;var Expander$1024;var mac1$1025;var __chk_ncache$1026;var __chk_scache$1027;var checker_db$1028;($1000$1004=require("./pp"));;(__lt____gt__$1005=$1000$1004["<>"]);;($1001$1006=require("./location"));;(__lt____lt____colon__$1007=$1001$1006["<<:"]);;(util$1008=require("./util"));;(classify$1009=util$1008.classify);;(items$1010=util$1008.items);;(iterkeys$1011=util$1008.keys);;(enumerate$1012=util$1008.enumerate);;(neighbours$1013=util$1008.neighbours);;(zip$1014=util$1008.zip);;(GenSym$1015=util$1008.GenSym);;(gensym$1016=util$1008.gensym);;(uuid$1017=util$1008.uuid);;($1003$1018=require("./pattern"));;(PatternParser$1019=$1003$1018.PatternParser);;(PatternProcessor$1020=$1003$1018.PatternProcessor);;(Scope$1021=function(){var it$0$1100;var parent$1094;var name$1095;var expander$1096;var t0$1090;var $1083$1085;($1083$1085=arguments);;(t0$1090=$1083$1085.length);if(((t0$1090>=0)&&(t0$1090<=3))){(parent$1094=function(){if((0>=t0$1090)){return null;}else{return $1083$1085[0];}}());(name$1095=function(){if((1>=t0$1090)){return null;}else{return $1083$1085[1];}}());(expander$1096=function(){if((2>=t0$1090)){return null;}else{return $1083$1085[2];}}());(it$0$1100=function(){if((!$953(Scope$1021)(this))){return Object.create(Scope$1021.prototype);}else{return this;}}());;(it$0$1100["name"]=(name$1095||gensym$1016("scope")));(it$0$1100["parent"]=parent$1094);(it$0$1100["options"]=({}));(it$0$1100["expander"]=(expander$1096||parent$1094.expander));return it$0$1100;}else{$3043($1083$1085);}});;(Scope$1021.prototype["getopt"]=function(opt$1112){var otherwise$1144;var $1121$1133;var $1120$1127;var self$1122;var it$0$1115;(it$0$1115=this);;(self$1122=this);;($1120$1127=null);;$1120$1127;if(Object.prototype.hasOwnProperty.call(it$0$1115.options,opt$1112)){return $968(it$0$1115.options,opt$1112);}else{if((it$0$1115.parent===null)){return (void 0);}else{(otherwise$1144=$1120$1127);return it$0$1115.parent.getopt(opt$1112);}}});(Scope$1021.prototype["setopt"]=function(opt$1149,value$1150){var self$1158;var it$0$1153;(it$0$1153=this);;(self$1158=this);;return (it$0$1153.options[opt$1149]=value$1150);});(Scope$1021.prototype["gensym"]=function(){var self$1172;var it$0$1167;(it$0$1167=this);;(self$1172=this);;return it$0$1167.expander.gensym();});(Scope$1021.prototype["step"]=function(context$1179,expr$1180){var self$1188;var it$0$1183;(it$0$1183=this);;(self$1188=this);;return it$0$1183.expander.step(context$1179,it$0$1183,expr$1180);});(Scope$1021.prototype["step_all"]=function(context$1195,exprs$1196){var self$1204;var it$0$1199;(it$0$1199=this);;(self$1204=this);;return it$0$1199.expander.step_all(context$1195,it$0$1199,exprs$1196);});(Scope$1021.prototype["expand"]=function(context$1211,expr$1212){var self$1220;var it$0$1215;(it$0$1215=this);;(self$1220=this);;return it$0$1215.expander.expand(context$1211,it$0$1215,expr$1212);});(Scope$1021.prototype["toString"]=function(){var self$1234;var it$0$1229;(it$0$1229=this);;(self$1234=this);;return (("Scope{"+it$0$1229.name)+"}");});$3247(Scope$1021,$3247(((accum$1239=({})),((accum$1239["::name"]="Scope"),accum$1239)),((accum$1243=({})),((accum$1243["::egclass"]=true),accum$1243))));Scope$1021;(Env$1022=function(){var it$0$1251;(it$0$1251=function(){if((!$953(Env$1022)(this))){return Object.create(Env$1022.prototype);}else{return this;}}());;(it$0$1251["scopes"]=({}));return it$0$1251;});;(Env$1022.prototype["resolve"]=function(scope$1260,name$1261){var scope_data$1274;var self$1269;var it$0$1264;(it$0$1264=this);;(self$1269=this);;if((scope$1260===null)){return (void 0);}(scope_data$1274=$968(it$0$1264.scopes,scope$1260.name));;if((scope_data$1274&&Object.prototype.hasOwnProperty.call(scope_data$1274,name$1261))){return $968(scope_data$1274,name$1261);}else{return it$0$1264.resolve(scope$1260.parent,name$1261);}});(Env$1022.prototype["bind"]=function(scope$1282,name$1283,value$1284){var self$1292;var it$0$1287;(it$0$1287=this);;(self$1292=this);;if((!$968(it$0$1287.scopes,scope$1282.name))){(it$0$1287.scopes[scope$1282.name]=({}));}return ($968(it$0$1287.scopes,scope$1282.name)[name$1283]=value$1284);});(Env$1022.prototype["convert"]=function(expr$1301){var x$1345;var x$1350;var bridge$1313$1342;var x$1355;var bridge$1312$1339;var x$1360;var bridge$1311$1336;var x$1365;var $index$1392;var $length$1387;var temp$1382;var other$1412;var type$1372;var args$1373;var e$1329;var bridge$1310$1324;var t0$1325;var $1309$1319;var self$1314;var it$0$1304;(it$0$1304=this);;(self$1314=this);;($1309$1319=expr$1301);;if($3259($1309$1319,"env")){(e$1329=$1309$1319.env);return expr$1301;}else{(bridge$1310$1324=$1309$1319);if((((bridge$1311$1336=bridge$1310$1324),(((bridge$1312$1339=bridge$1311$1336),(((bridge$1313$1342=bridge$1312$1339),((((x$1345=bridge$1313$1342)),((x$1345 instanceof Array)&&(x$1345[0]==="symbol")))||(((x$1350=bridge$1313$1342)),((x$1350 instanceof Array)&&(x$1350[0]==="value")))))||(((x$1355=bridge$1312$1339)),((x$1355 instanceof Array)&&(x$1355[0]==="variable")))))||(((x$1360=bridge$1311$1336)),((x$1360 instanceof Array)&&(x$1360[0]==="macro")))))||(((x$1365=bridge$1310$1324)),((x$1365 instanceof Array)&&(x$1365[0]==="void"))))){return $3247(expr$1301,({"env":it$0$1304}));}else{if((($1309$1319 instanceof Array)&&((t0$1325=$1309$1319.length),(t0$1325>=1)))){(type$1372=$1309$1319[0]);(args$1373=Array.prototype.slice.call($1309$1319,1));(temp$1382=args$1373);;($length$1387=temp$1382.length);;($index$1392=0);;$1378:for(;($index$1392<$length$1387);($index$1392++)){var arg$1408;var m$1400;(m$1400=temp$1382[$index$1392]);;(arg$1408=m$1400);it$0$1304.convert(arg$1408);}return $3247(expr$1301,({"env":it$0$1304}));}else{(other$1412=$1309$1319);return $3247(expr$1301,({"env":it$0$1304}));}}}});(Env$1022.prototype["fork"]=function(){var $index$1447;var $length$1442;var temp$1437;var e$1429;var self$1424;var it$0$1419;(it$0$1419=this);;(self$1424=this);;(e$1429=Env$1022());;(temp$1437=items$1010(it$0$1419.scopes));;($length$1442=temp$1437.length);;($index$1447=0);;$1430:for(;($index$1447<$length$1442);($index$1447++)){var $index$1488;var $length$1483;var temp$1478;var acc$1473;var scope$1465;var bindings$1466;var t0$1460;var t1$1461;var m$1455;(m$1455=temp$1437[$index$1447]);;(t0$1460=m$1455);if(((t0$1460 instanceof Array)&&((t1$1461=t0$1460.length),(t1$1461===2)))){(scope$1465=t0$1460[0]);(bindings$1466=t0$1460[1]);(acc$1473=[]);;(temp$1478=items$1010(bindings$1466));;($length$1483=temp$1478.length);;($index$1488=0);;$1470:for(;($index$1488<$length$1483);($index$1488++)){var k$1506;var v$1507;var t0$1501;var t1$1502;var m$1496;(m$1496=temp$1478[$index$1488]);;(t0$1501=m$1496);if(((t0$1501 instanceof Array)&&((t1$1502=t0$1501.length),(t1$1502===2)))){(k$1506=t0$1501[0]);(v$1507=t0$1501[1]);acc$1473.push((function(){if((!$968(e$1429.scopes,scope$1465))){return (e$1429.scopes[scope$1465]=({}));}}(),($968(e$1429.scopes,scope$1465)[k$1506]=v$1507)));}else{$3043(m$1496,"/home/olivier/git/earl-grey/src/expand.eg",2004,2163);;}}acc$1473;}else{$3043(m$1455,"/home/olivier/git/earl-grey/src/expand.eg",1964,2163);;}}return e$1429;});(Env$1022.prototype["toString"]=function(){var self$1527;var it$0$1522;(it$0$1522=this);;(self$1527=this);;return "Env{...}";});$3247(Env$1022,$3247(((accum$1532=({})),((accum$1532["::name"]="Env"),accum$1532)),((accum$1536=({})),((accum$1536["::egclass"]=true),accum$1536))));Env$1022;(track_location$1023=function(f$1542){var f2$1545;(f2$1545=function(context$1549,scope$1550,expr$1551){var rval$1559;var other$1591;var v$1585;var t0$1581;var $1554$1576;var rval$1555;(rval$1555=(((rval$1559=false)),(function(){try{(rval$1559=f$1542(context$1549,scope$1550,expr$1551));}catch(excv$1565){var e$1571;(e$1571=excv$1565);(rval$1559=(__lt____lt____colon__$1007(e$1571,expr$1551),function(){throw e$1571;}()));}}(),rval$1559)));;($1554$1576=rval$1555);;if((($1554$1576 instanceof Array)&&((t0$1581=$1554$1576.length),((t0$1581===2)&&($1554$1576[0]==="bounce"))))){(v$1585=$1554$1576[1]);return f2$1545(context$1549,scope$1550,__lt____lt____colon__$1007(v$1585,expr$1551));}else{(other$1591=$1554$1576);return __lt____lt____colon__$1007(other$1591,expr$1551);}});;return f2$1545;});;(Expander$1024=function(env_factory$1598,generic_nodes$1599){var it$0$1602;(it$0$1602=function(){if((!$953(Expander$1024)(this))){return Object.create(Expander$1024.prototype);}else{return this;}}());;(it$0$1602["gensym"]=gensym$1016);(it$0$1602["mkenv"]=env_factory$1598);(it$0$1602["generic_nodes"]=generic_nodes$1599);return it$0$1602;});;(Expander$1024.prototype["run_macro"]=function(m$1612,context$1613,scope$1614,form$1615,arg$1616){var rval$1633;var rval$1629;var self$1624;var it$0$1619;(it$0$1619=this);;(self$1624=this);;(rval$1629=(((rval$1633=false)),(function(){try{(rval$1633=m$1612(context$1613,scope$1614,form$1615,arg$1616));}catch(excv$1639){var msg$1672;var msg$1767;var find$1681;var err$1682;var other$1678;var $1659$1661;var e$1656;var e$1774;var value$1649;var t0$1642;var t1$1643;var t2$1644;var t3$1645;(t0$1642=excv$1639);if(($953($3056(["match"]))(t0$1642)&&($3259(t0$1642,"args")&&((t1$1643=t0$1642.args),((t1$1643 instanceof Array)&&((t2$1644=t1$1643.length),((t2$1644===1)&&((t3$1645=t1$1643[0]),$3259(t3$1645,"value"))))))))){(value$1649=t3$1645.value);(rval$1633=(((e$1656=((($1659$1661=value$1649)),function(){if(($1659$1661===context$1613)){(msg$1672="The macro cannot be found in this context.");;return $3056(["syntax","context"]).create(msg$1672,({"context":context$1613,"form":form$1615}));}else{(other$1678=$1659$1661);(find$1681=function($1685$1687){var t0$1693;var msg$1709;var $index$1735;var $length$1730;var temp$1725;var other$1760;var type$1715;var xs$1716;var t0$1702;var $1689$1697;var ph$1690;var arg$1691;(t0$1693=$1685$1687);(arg$1691=t0$1693);(ph$1690=t0$1693);;($1689$1697=ph$1690);;if(($1689$1697===value$1649)){(msg$1709="The macro could not match its argument (or part of it).");;return $3056(["syntax","argument"]).create(msg$1709,({"context":context$1613,"argument":arg$1691,"form":form$1615}));}else{if((($1689$1697 instanceof Array)&&((t0$1702=$1689$1697.length),(t0$1702>=1)))){(type$1715=$1689$1697[0]);(xs$1716=Array.prototype.slice.call($1689$1697,1));(temp$1725=xs$1716);;($length$1730=temp$1725.length);;($index$1735=0);;$1721:for(;($index$1735<$length$1730);($index$1735++)){var x$1752;var t0$1748;var m$1743;(m$1743=temp$1725[$index$1735]);;(t0$1748=$3297(find$1681)(m$1743));if(t0$1748[0]){(x$1752=t0$1748[1]);if(x$1752){return x$1752;}}else{$3043(m$1743,"/home/olivier/git/earl-grey/src/expand.eg",3441,3526);;}}return false;}else{(other$1760=$1689$1697);return false;}}});;(err$1682=find$1681(arg$1616));;if(err$1682){return err$1682;}else{(msg$1767="The macro failed because it failed to match some value, probably one that it generated itself.");;return $3056(["syntax","failure"]).create(msg$1767,({"form":form$1615,"value":value$1649}));}}}()))),function(){throw e$1656;}()));}else{(e$1774=excv$1639);(rval$1633=function(){throw e$1774;}());}}}(),rval$1633)));;return it$0$1619.mkenv().convert(rval$1629);});(Expander$1024.prototype["step"]=function(context$1780,scope$1781,expr$1782){var helper$1795;var self$1790;var it$0$1785;(it$0$1785=this);;(self$1790=this);;(helper$1795=track_location$1023(function(context$1800,scope$1801,$1798$1802){var t0$1811;var other$1851;var env$1846;var $1836$1838;var other$1884;var t0$1875;var $1868$1870;var other$1888;var m$1864;var t0$1860;var $1832$1855;var env$1833;var other$1911;var t0$1902;var $1895$1897;var other$1936;var m$1930;var t0$1926;var $1919$1921;var other$1945;var x$1940;var f$1915;var arg$1916;var m$1892;var s$1827;var $1805$1822;var $1806$1823;var $1807$1824;var t0$1820;var $1804$1815;var ph$1808;var expr$1809;(t0$1811=$1798$1802);(expr$1809=t0$1811);(ph$1808=t0$1811);;($1804$1815=ph$1808);;if((($1805$1822=($1804$1815 instanceof Array))&&((t0$1820=$1804$1815.length),(($1807$1824=(t0$1820===2))&&($1804$1815[0]==="symbol"))))){(s$1827=$1804$1815[1]);(env$1833=((($1836$1838=expr$1809)),function(){if($3259($1836$1838,"env")){(env$1846=$1836$1838.env);return expr$1809.env;}else{(other$1851=$1836$1838);throw $3056(["syntax","no_env"]).create("No environment was found to resolve",({"symbol":expr$1809}));}}()));;($1832$1855=env$1833.resolve(scope$1801,s$1827));;if((($1832$1855 instanceof Array)&&((t0$1860=$1832$1855.length),((t0$1860===2)&&($1832$1855[0]==="macro"))))){(m$1864=$1832$1855[1]);($1868$1870=context$1800);;if((($1868$1870 instanceof Array)&&((t0$1875=$1868$1870.length),((t0$1875===2)&&(($1868$1870[0]==="expr")&&($1868$1870[1]==="head")))))){return ["macro",m$1864];}else{(other$1884=$1868$1870);return ["bounce",it$0$1785.run_macro(m$1864,context$1800,scope$1801,expr$1809,__lt____lt____colon__$1007(["void"],expr$1809))];}}else{(other$1888=$1832$1855);return expr$1809;}}else{if(($1807$1824&&($1804$1815[0]==="macro"))){(m$1892=$1804$1815[1]);($1895$1897=context$1800);;if((($1895$1897 instanceof Array)&&((t0$1902=$1895$1897.length),((t0$1902===2)&&(($1895$1897[0]==="expr")&&($1895$1897[1]==="head")))))){return expr$1809;}else{(other$1911=$1895$1897);return ["bounce",it$0$1785.run_macro(m$1892,context$1800,scope$1801,expr$1809,__lt____lt____colon__$1007(["void"],expr$1809))];}}else{if(($1805$1822&&((t0$1820===3)&&($1804$1815[0]==="send")))){(f$1915=$1804$1815[1]);(arg$1916=$1804$1815[2]);($1919$1921=helper$1795(["expr","head"],scope$1801,f$1915));;if((($1919$1921 instanceof Array)&&((t0$1926=$1919$1921.length),((t0$1926===2)&&($1919$1921[0]==="macro"))))){(m$1930=$1919$1921[1]);return ["bounce",it$0$1785.run_macro(m$1930,context$1800,scope$1801,expr$1809,arg$1916)];}else{(other$1936=$1919$1921);return expr$1809;}}else{if(($1805$1822&&((t0$1820===2)&&($1804$1815[0]==="nostep")))){(x$1940=$1804$1815[1]);return x$1940;}else{(other$1945=$1804$1815);return expr$1809;}}}}}));;return helper$1795(context$1780,scope$1781,expr$1782);});(Expander$1024.prototype["step_all"]=function(context$1952,scope$1953,$1950$1954){var t0$1958;var t1$1959;var pre$1975;var bulk$1976;var post$1977;var self$1970;var it$0$1965;var stmts$1956;(t0$1958=$1950$1954);if(((t0$1958 instanceof Array)&&((t1$1959=t0$1958.length),(t1$1959>=0)))){(stmts$1956=Array.prototype.slice.call(t0$1958,0));;}else{$3043($1950$1954);}(it$0$1965=this);;(self$1970=this);;(pre$1975=[]);;(bulk$1976=[]);;(post$1977=[]);;$1987:while(stmts$1956.length){var x$2033;var m$2028;var stmt$2023;var stmt$2018;var prepend$2012;var $1992$2007;var $1993$2008;var $1994$2009;var t0$2005;var $1991$2000;var current$1995;(current$1995=stmts$1956.shift());;($1991$2000=it$0$1965.step(context$1952,scope$1953,current$1995));;if((($1992$2007=($1991$2000 instanceof Array))&&((t0$2005=$1991$2000.length),((t0$2005>=1)&&($1991$2000[0]==="splice"))))){(prepend$2012=Array.prototype.slice.call($1991$2000,1));(stmts$1956=prepend$2012.concat(stmts$1956));}else{if(($1992$2007&&(($1994$2009=(t0$2005===2))&&($1991$2000[0]==="float")))){(stmt$2018=$1991$2000[1]);(pre$1975=pre$1975.concat(it$0$1965.step_all(context$1952,scope$1953,[stmt$2018])));}else{if(($1994$2009&&($1991$2000[0]==="sink"))){(stmt$2023=$1991$2000[1]);(post$1977=post$1977.concat(it$0$1965.step_all(context$1952,scope$1953,[stmt$2023])));}else{if(($1994$2009&&($1991$2000[0]==="multimacro"))){(m$2028=$1991$2000[1]);(stmts$1956=m$2028(context$1952,scope$1953,current$1995,stmts$1956));}else{(x$2033=$1991$2000);bulk$1976.push(x$2033);}}}}}return pre$1975.concat(bulk$1976).concat(post$1977);});(Expander$1024.prototype["expand"]=function(context$2038,scope$2039,expr$2040){var helper$2053;var self$2048;var it$0$2043;(it$0$2043=this);;(self$2048=this);;(helper$2053=track_location$1023(function(context$2057,scope$2058,expr$2059){var t0$2090;var other$2107;var $2087$2095;var env$2088;var $index$2154;var $length$2149;var temp$2144;var acc$2139;var newargs$2133;var $index$2200;var $length$2195;var temp$2190;var acc$2185;var newargs$2179;var t0$2244;var newscope$2238;var env$2239;var $index$2301;var $length$2296;var temp$2291;var acc$2286;var $index$2411;var $length$2406;var temp$2401;var acc$2396;var t0$2275;var newscope$2259;var stepscope$2260;var changes$2261;var newargs$2262;var vars$2263;var exp$2264;var $index$2679;var $length$2674;var temp$2669;var other$2753;var t0$2736;var $2729$2731;var is_obj$2590;var obj$2591;var arr$2592;var arr_parts$2593;var obj_parts$2594;var new_arr_part$2595;var new_obj_part$2596;var r$2597;var $index$2796;var $length$2791;var temp$2786;var acc$2781;var newscope$2773;var s$2856;var newscope$2865;var name$2852;var t0$2848;var $index$2900;var $length$2895;var temp$2890;var acc$2885;var other$2920;var type$2876;var args$2877;var tag$2869;var body$2870;var x$2843;var $2063$2844;var bindings$2768;var body$2769;var target$2762;var value$2763;var args$2586;var args$2255;var args$2250;var variable$2228;var s$2229;var value$2230;var body$2231;var args$2175;var args$2129;var f$2123;var arg$2124;var s$2082;var $2064$2077;var $2065$2078;var $2066$2079;var t0$2073;var t1$2074;var t2$2075;var $2062$2068;(expr$2059=it$0$2043.step(context$2057,scope$2058,expr$2059));($2062$2068=expr$2059);;if((($2064$2077=($2062$2068 instanceof Array))&&((t0$2073=$2062$2068.length),(($2066$2079=(t0$2073===2))&&($2062$2068[0]==="symbol"))))){(s$2082=$2062$2068[1]);(t0$2090=expr$2059);if($3259(t0$2090,"env")){(env$2088=t0$2090.env);;}else{$3043(expr$2059,"/home/olivier/git/earl-grey/src/expand.eg",7759,7763);}($2087$2095=env$2088.resolve(scope$2058,s$2082));;if(($2087$2095===(void 0))){throw $3056(["syntax","undeclared"]).create(("Undeclared variable: "+s$2082),({"node":expr$2059}));}else{(other$2107=$2087$2095);return ["bounce",other$2107];}}else{if(($2066$2079&&($2062$2068[0]==="value"))){$2062$2068[1];return expr$2059;}else{if(($2066$2079&&($2062$2068[0]==="variable"))){$2062$2068[1];return expr$2059;}else{if(($2064$2077&&((t0$2073===1)&&($2062$2068[0]==="void")))){return expr$2059;}else{if(($2064$2077&&((t0$2073===3)&&($2062$2068[0]==="send")))){(f$2123=$2062$2068[1]);(arg$2124=$2062$2068[2]);return ["send",helper$2053(["expr","head"],scope$2058,f$2123),helper$2053(["expr","tail"],scope$2058,arg$2124)];}else{if(($2064$2077&&(($2066$2079=(t0$2073>=1))&&($2062$2068[0]==="array")))){(args$2129=Array.prototype.slice.call($2062$2068,1));(newargs$2133=(((acc$2139=[])),(((temp$2144=it$0$2043.step_all(["expr","array"],scope$2058,args$2129))),((($length$2149=temp$2144.length)),((($index$2154=0)),function(){$2136:for(;($index$2154<$length$2149);($index$2154++)){var arg$2170;var m$2162;(m$2162=temp$2144[$index$2154]);;(arg$2170=m$2162);acc$2139.push(helper$2053(["expr","expr"],scope$2058,arg$2170));}}()))),acc$2139));;return ["array"].concat(newargs$2133);}else{if(($2066$2079&&($2062$2068[0]==="object"))){(args$2175=Array.prototype.slice.call($2062$2068,1));(newargs$2179=(((acc$2185=[])),(((temp$2190=it$0$2043.step_all(["expr","object"],scope$2058,args$2175))),((($length$2195=temp$2190.length)),((($index$2200=0)),function(){$2182:for(;($index$2200<$length$2195);($index$2200++)){var k$2218;var v$2219;var t0$2213;var t1$2214;var m$2208;(m$2208=temp$2190[$index$2200]);;(t0$2213=m$2208);if(((t0$2213 instanceof Array)&&((t1$2214=t0$2213.length),((t1$2214===3)&&(t0$2213[0]==="array"))))){(k$2218=t0$2213[1]);(v$2219=t0$2213[2]);acc$2185.push(["array",helper$2053(["expr","expr"],scope$2058,k$2218),helper$2053(["expr","expr"],scope$2058,v$2219)]);}else{$3043(m$2208,"/home/olivier/git/earl-grey/src/expand.eg",8602,8791);;}}}()))),acc$2185));;return ["object"].concat(newargs$2179);}else{if(($2064$2077&&((t0$2073===4)&&(($2062$2068[0]==="bind")&&((t1$2074=$2062$2068[1]),((variable$2228=t1$2074),((t1$2074 instanceof Array)&&((t2$2075=t1$2074.length),((t2$2075===2)&&(t1$2074[0]==="symbol")))))))))){(s$2229=t1$2074[1]);(value$2230=$2062$2068[2]);(body$2231=$2062$2068[3]);(newscope$2238=Scope$1021(scope$2058));;(t0$2244=variable$2228);if($3259(t0$2244,"env")){(env$2239=t0$2244.env);;}else{$3043(variable$2228,"/home/olivier/git/earl-grey/src/expand.eg",8934,8942);}env$2239.bind(newscope$2238,s$2229,value$2230);return helper$2053(context$2057,newscope$2238,body$2231);}else{if(($2064$2077&&(($2066$2079=(t0$2073>=1))&&($2062$2068[0]==="splice")))){(args$2250=Array.prototype.slice.call($2062$2068,1));return ["bounce",$3247(["multi"].concat(args$2250),({"override_scope":true}))];}else{if(($2066$2079&&($2062$2068[0]==="multi"))){(args$2255=Array.prototype.slice.call($2062$2068,1));(newscope$2259=function(){if(expr$2059.override_scope){return scope$2058;}else{return Scope$1021(scope$2058);}}());;(stepscope$2260=function(){if(expr$2059.nonrecursive){return scope$2058;}else{return newscope$2259;}}());;(changes$2261=false);;(t0$2275=classify$1009("newargs","vars",(((acc$2286=[])),(((temp$2291=it$0$2043.step_all(["expr","multi"],stepscope$2260,args$2255))),((($length$2296=temp$2291.length)),((($index$2301=0)),function(){$2277:for(;($index$2301<$length$2296);($index$2301++)){var t0$2346;var env$2344;var t0$2364;var env$2361;var v$2362;var other$2382;var v$2373;var value$2374;var variable$2352;var s$2353;var value$2354;var variable$2335;var s$2336;var value$2337;var opt$2327;var value$2328;var $2279$2319;var $2280$2320;var $2281$2321;var $2282$2322;var $2283$2323;var $2284$2324;var t0$2314;var t1$2315;var t2$2316;var t3$2317;var m$2309;(m$2309=temp$2291[$index$2301]);;(t0$2314=m$2309);if((($2280$2320=(t0$2314 instanceof Array))&&((t1$2315=t0$2314.length),(($2282$2322=(t1$2315===3))&&(t0$2314[0]==="option"))))){(opt$2327=t0$2314[1]);(value$2328=t0$2314[2]);acc$2286.push((newscope$2259.setopt(opt$2327,value$2328),["ignore"]));}else{if(($2282$2322&&((t0$2314[0]==="declare_raw")&&((t2$2316=t0$2314[1]),((variable$2335=t2$2316),((t2$2316 instanceof Array)&&((t3$2317=t2$2316.length),((t3$2317===2)&&(t2$2316[0]==="symbol"))))))))){(s$2336=t2$2316[1]);(value$2337=t0$2314[2]);acc$2286.push((((t0$2346=variable$2335),function(){if($3259(t0$2346,"env")){(env$2344=t0$2346.env);}else{return $3043(variable$2335,"/home/olivier/git/earl-grey/src/expand.eg",9738,9746);}}()),env$2344.bind(newscope$2259,s$2336,value$2337),(changes$2261=true),["ignore"]));}else{if(($2280$2320&&(($2282$2322=((t1$2315>=2)&&(t1$2315<=3)))&&(($2283$2323=(t0$2314[0]==="declare"))&&((t2$2316=t0$2314[1]),((variable$2352=t2$2316),((t2$2316 instanceof Array)&&((t3$2317=t2$2316.length),((t3$2317===2)&&(t2$2316[0]==="symbol")))))))))){(s$2353=t2$2316[1]);(value$2354=function(){if((2>=t1$2315)){return null;}else{return t0$2314[2];}}());acc$2286.push((((t0$2364=variable$2352),function(){if($3259(t0$2364,"env")){(env$2361=t0$2364.env);}else{return $3043(variable$2352,"/home/olivier/git/earl-grey/src/expand.eg",9983,9991);}}()),((v$2362=__lt____lt____colon__$1007(["variable",it$0$2043.gensym(s$2353)],variable$2352))),env$2361.bind(newscope$2259,s$2353,v$2362),(changes$2261=true),function(){if(value$2354){return ["splice",["newargs",["assign",v$2362,value$2354]],["vars",v$2362]];}else{return ["vars",v$2362];}}()));}else{if(($2283$2323&&((v$2373=t2$2316),((t2$2316 instanceof Array)&&((t3$2317=t2$2316.length),((t3$2317===2)&&(t2$2316[0]==="variable"))))))){t2$2316[1];(value$2374=function(){if((2>=t1$2315)){return null;}else{return t0$2314[2];}}());acc$2286.push(((changes$2261=true),function(){if(value$2374){return ["splice",["newargs",["assign",v$2373,value$2374]],["vars",v$2373]];}else{return ["vars",v$2373];}}()));}else{(other$2382=m$2309);acc$2286.push(["newargs",other$2382]);}}}}}}()))),acc$2286)));if(($3259(t0$2275,"newargs")&&((newargs$2262=t0$2275.newargs),$3259(t0$2275,"vars")))){(vars$2263=t0$2275.vars);;}else{$3043(classify$1009("newargs","vars",(((acc$2396=[])),(((temp$2401=it$0$2043.step_all(["expr","multi"],stepscope$2260,args$2255))),((($length$2406=temp$2401.length)),((($index$2411=0)),function(){$2387:for(;($index$2411<$length$2406);($index$2411++)){var t0$2456;var env$2454;var t0$2474;var env$2471;var v$2472;var other$2492;var v$2483;var value$2484;var variable$2462;var s$2463;var value$2464;var variable$2445;var s$2446;var value$2447;var opt$2437;var value$2438;var $2389$2429;var $2390$2430;var $2391$2431;var $2392$2432;var $2393$2433;var $2394$2434;var t0$2424;var t1$2425;var t2$2426;var t3$2427;var m$2419;(m$2419=temp$2401[$index$2411]);;(t0$2424=m$2419);if((($2390$2430=(t0$2424 instanceof Array))&&((t1$2425=t0$2424.length),(($2392$2432=(t1$2425===3))&&(t0$2424[0]==="option"))))){(opt$2437=t0$2424[1]);(value$2438=t0$2424[2]);acc$2396.push((newscope$2259.setopt(opt$2437,value$2438),["ignore"]));}else{if(($2392$2432&&((t0$2424[0]==="declare_raw")&&((t2$2426=t0$2424[1]),((variable$2445=t2$2426),((t2$2426 instanceof Array)&&((t3$2427=t2$2426.length),((t3$2427===2)&&(t2$2426[0]==="symbol"))))))))){(s$2446=t2$2426[1]);(value$2447=t0$2424[2]);acc$2396.push((((t0$2456=variable$2445),function(){if($3259(t0$2456,"env")){(env$2454=t0$2456.env);}else{return $3043(variable$2445,"/home/olivier/git/earl-grey/src/expand.eg",9738,9746);}}()),env$2454.bind(newscope$2259,s$2446,value$2447),(changes$2261=true),["ignore"]));}else{if(($2390$2430&&(($2392$2432=((t1$2425>=2)&&(t1$2425<=3)))&&(($2393$2433=(t0$2424[0]==="declare"))&&((t2$2426=t0$2424[1]),((variable$2462=t2$2426),((t2$2426 instanceof Array)&&((t3$2427=t2$2426.length),((t3$2427===2)&&(t2$2426[0]==="symbol")))))))))){(s$2463=t2$2426[1]);(value$2464=function(){if((2>=t1$2425)){return null;}else{return t0$2424[2];}}());acc$2396.push((((t0$2474=variable$2462),function(){if($3259(t0$2474,"env")){(env$2471=t0$2474.env);}else{return $3043(variable$2462,"/home/olivier/git/earl-grey/src/expand.eg",9983,9991);}}()),((v$2472=__lt____lt____colon__$1007(["variable",it$0$2043.gensym(s$2463)],variable$2462))),env$2471.bind(newscope$2259,s$2463,v$2472),(changes$2261=true),function(){if(value$2464){return ["splice",["newargs",["assign",v$2472,value$2464]],["vars",v$2472]];}else{return ["vars",v$2472];}}()));}else{if(($2393$2433&&((v$2483=t2$2426),((t2$2426 instanceof Array)&&((t3$2427=t2$2426.length),((t3$2427===2)&&(t2$2426[0]==="variable"))))))){t2$2426[1];(value$2484=function(){if((2>=t1$2425)){return null;}else{return t0$2424[2];}}());acc$2396.push(((changes$2261=true),function(){if(value$2484){return ["splice",["newargs",["assign",v$2483,value$2484]],["vars",v$2483]];}else{return ["vars",v$2483];}}()));}else{(other$2492=m$2419);acc$2396.push(["newargs",other$2492]);}}}}}}()))),acc$2396)),"/home/olivier/git/earl-grey/src/expand.eg",9410,10931);}(exp$2264=function(s$2497){var $index$2523;var $length$2518;var temp$2513;var acc$2508;var $index$2565;var $length$2560;var temp$2555;var acc$2550;var stepped$2500;(stepped$2500=(((acc$2508=[])),(((temp$2513=enumerate$1012(newargs$2262))),((($length$2518=temp$2513.length)),((($index$2523=0)),function(){$2505:for(;($index$2523<$length$2518);($index$2523++)){var i$2541;var arg$2542;var t0$2536;var t1$2537;var m$2531;(m$2531=temp$2513[$index$2523]);;(t0$2536=m$2531);if(((t0$2536 instanceof Array)&&((t1$2537=t0$2536.length),(t1$2537===2)))){(i$2541=t0$2536[0]);(arg$2542=t0$2536[1]);acc$2508.push(it$0$2043.step(["expr",function(){if((i$2541===(newargs$2262.length-1))){return "expr";}else{return "ignore";}}()],s$2497,arg$2542));}else{$3043(m$2531,"/home/olivier/git/earl-grey/src/expand.eg",11153,11330);;}}}()))),acc$2508));;(acc$2550=[]);;(temp$2555=stepped$2500);;($length$2560=temp$2555.length);;($index$2565=0);;$2501:for(;($index$2565<$length$2560);($index$2565++)){var arg$2581;var m$2573;(m$2573=temp$2555[$index$2565]);;(arg$2581=m$2573);acc$2550.push(helper$2053(["expr","expr"],s$2497,arg$2581));}return acc$2550;});;if(changes$2261){return ["scope",vars$2263,["multi"].concat(exp$2264(newscope$2259))];}else{return ["multi"].concat(exp$2264(scope$2058));}}else{if(($2066$2079&&($2062$2068[0]==="data"))){(args$2586=Array.prototype.slice.call($2062$2068,1));(is_obj$2590=false);;(obj$2591=["object"]);;(arr$2592=["array"]);;(arr_parts$2593=[]);;(obj_parts$2594=[]);;(new_arr_part$2595=function(){var other$2639;var t0$2630;var $2623$2625;($2623$2625=arr$2592);;if((($2623$2625 instanceof Array)&&((t0$2630=$2623$2625.length),((t0$2630===1)&&($2623$2625[0]==="array"))))){return false;}else{(other$2639=$2623$2625);arr_parts$2593.push(arr$2592);return (arr$2592=["array"]);}});;(new_obj_part$2596=function(){var other$2663;var t0$2654;var $2647$2649;($2647$2649=obj$2591);;if((($2647$2649 instanceof Array)&&((t0$2654=$2647$2649.length),((t0$2654===1)&&($2647$2649[0]==="object"))))){return false;}else{(other$2663=$2647$2649);obj_parts$2594.push(obj$2591);return (obj$2591=["object"]);}});;(temp$2669=it$0$2043.step_all(["expr","data"],scope$2058,args$2586));;($length$2674=temp$2669.length);;($index$2679=0);;$2598:for(;($index$2679<$length$2674);($index$2679++)){var other$2725;var expr$2719;var expr$2713;var k$2706;var v$2707;var $2600$2695;var $2601$2696;var $2602$2697;var $2603$2698;var t0$2692;var t1$2693;var m$2687;(m$2687=temp$2669[$index$2679]);;(t0$2692=m$2687);if((($2601$2696=(t0$2692 instanceof Array))&&((t1$2693=t0$2692.length),((t1$2693===1)&&(t0$2692[0]==="assoc"))))){(is_obj$2590=true);}else{if(($2601$2696&&((t1$2693===3)&&(t0$2692[0]==="assoc")))){(k$2706=t0$2692[1]);(v$2707=t0$2692[2]);(is_obj$2590=true);obj$2591.push(["array",k$2706,v$2707]);}else{if(($2601$2696&&(($2603$2698=(t1$2693===2))&&(t0$2692[0]==="dynsplice")))){(expr$2713=t0$2692[1]);new_arr_part$2595();arr_parts$2593.push(expr$2713);}else{if(($2603$2698&&(t0$2692[0]==="objsplice"))){(expr$2719=t0$2692[1]);(is_obj$2590=true);new_obj_part$2596();obj_parts$2594.push(expr$2719);}else{(other$2725=m$2687);arr$2592.push(other$2725);}}}}}new_arr_part$2595();new_obj_part$2596();(r$2597=((($2729$2731=arr_parts$2593)),function(){if((($2729$2731 instanceof Array)&&((t0$2736=$2729$2731.length),((t0$2736===0)&&is_obj$2590)))){return util$1008.construct(obj_parts$2594,function(x$2744,rest$2745){return ["send",["symbol","&:"],["data",x$2744,rest$2745]];},["object"]);}else{$2729$2731;if(is_obj$2590){throw $3056(["syntax","array","object"]).create("Cannot mix array and object notations.");}else{(other$2753=$2729$2731);return util$1008.construct(arr_parts$2593.reverse(),function(x$2756,rest$2757){return ["send",["send",rest$2757,["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",x$2756]];},["array"]);}}}()));;return helper$2053(context$2057,scope$2058,it$0$2043.mkenv().convert(r$2597));}else{if(($2064$2077&&(($2066$2079=(t0$2073===3))&&($2062$2068[0]==="assign")))){(target$2762=$2062$2068[1]);(value$2763=$2062$2068[2]);return ["assign",helper$2053(["expr","expr"],scope$2058,target$2762),helper$2053(["expr","expr"],scope$2058,value$2763)];}else{if(($2066$2079&&($2062$2068[0]==="lambda"))){(bindings$2768=$2062$2068[1]);(body$2769=$2062$2068[2]);(newscope$2773=Scope$1021(scope$2058));;return ["lambda",(((acc$2781=[])),(((temp$2786=bindings$2768)),((($length$2791=temp$2786.length)),((($index$2796=0)),function(){$2777:for(;($index$2796<$length$2791);($index$2796++)){var v$2822;var x$2832;var other$2839;var v$2829;var b$2815;var env$2816;var $2779$2812;var t0$2809;var t1$2810;var m$2804;(m$2804=temp$2786[$index$2796]);;(t0$2809=m$2804);if(((t0$2809 instanceof Array)&&((t1$2810=t0$2809.length),((t1$2810===2)&&((t0$2809[0]==="symbol")&&((b$2815=t0$2809[1]),$3259(t0$2809,"env"))))))){(env$2816=t0$2809.env);acc$2781.push((((v$2822=["variable",it$0$2043.gensym(b$2815)])),(env$2816.bind(newscope$2773,b$2815,v$2822),v$2822)));}else{if((((x$2832=t0$2809)),((x$2832 instanceof Array)&&(x$2832[0]==="variable")))){(v$2829=t0$2809);acc$2781.push(v$2829);}else{(other$2839=m$2804);acc$2781.push(function(){throw $3056(["syntax","lambda","binding"]).create("Not a valid binding.",({"node":other$2839}));}());}}}}()))),acc$2781),helper$2053(["expr","expr"],newscope$2773,body$2769)];}else{if(($2066$2079&&($2062$2068[0]==="use"))){($2063$2844=$2062$2068[1]);(x$2843=$2062$2068[2]);(t0$2848=$2063$2844);if((typeof(t0$2848)==="string")){(name$2852=t0$2848);(s$2856=scope$2058);;$2860:while(s$2856){if((s$2856.name.slice(0,(name$2852.length+1))===(name$2852+"/"))){break $2860;}else{(s$2856=s$2856.parent);}}if(s$2856){return helper$2053(context$2057,s$2856,x$2843);}else{throw $3056(["syntax","noscope"]).create(("Could not find a scope tagged: "+name$2852));}}else{(newscope$2865=$2063$2844);return helper$2053(context$2057,newscope$2865,x$2843);}}else{if(($2066$2079&&(($2062$2068[0]==="tagscope")&&((t1$2074=$2062$2068[1]),(typeof(t1$2074)==="string"))))){(tag$2869=t1$2074);(body$2870=$2062$2068[2]);return helper$2053(context$2057,Scope$1021(scope$2058,it$0$2043.gensym((tag$2869+"/"))),body$2870);}else{if(($2064$2077&&((t0$2073>=1)&&((type$2876=$2062$2068[0]),((args$2877=Array.prototype.slice.call($2062$2068,1)),(it$0$2043.generic_nodes.indexOf(type$2876)!==-1)))))){return [type$2876].concat((((acc$2885=[])),(((temp$2890=args$2877)),((($length$2895=temp$2890.length)),((($index$2900=0)),function(){$2882:for(;($index$2900<$length$2895);($index$2900++)){var arg$2916;var m$2908;(m$2908=temp$2890[$index$2900]);;(arg$2916=m$2908);acc$2885.push(helper$2053(["expr","expr"],scope$2058,arg$2916));}}()))),acc$2885));}else{(other$2920=$2062$2068);throw $3056(["syntax","illegal_node"]).create("An illegal node was found.",({"node":other$2920,"context":context$2057}));}}}}}}}}}}}}}}}}}));;return helper$2053(context$2038,scope$2039,expr$2040);});$3247(Expander$1024,$3247(((accum$2924=({})),((accum$2924["::name"]="Expander"),accum$2924)),((accum$2928=({})),((accum$2928["::egclass"]=true),accum$2928))));Expander$1024;(mac1$1025=function(f$2934){return ["macro",function(context$2938,scope$2939,form$2940,$2936$2941){var t0$2945;var t1$2946;var expr$2943;(t0$2945=$2936$2941);if(((t0$2945 instanceof Array)&&((t1$2946=t0$2945.length),((t1$2946===2)&&(t0$2945[0]==="data"))))){(expr$2943=t0$2945[1]);;}else{$3043($2936$2941);}return f$2934(expr$2943);}];});;(__chk_ncache$1026=({}));;(__chk_scache$1027=({}));;(checker_db$1028=function($2960$2962){var v$2998;var v$3011;var s$3007;var n$2994;var $2964$2970;var ph$2965;(ph$2965=$2960$2962);;($2964$2970=ph$2965);;if(($2964$2970===null)){return checker_db$1028.null;}else{if(($2964$2970===(void 0))){return checker_db$1028.undefined;}else{if(($2964$2970===true)){return checker_db$1028.true;}else{if(($2964$2970===false)){return checker_db$1028.false;}else{if((typeof($2964$2970)==="number")){(n$2994=$2964$2970);if($968(__chk_ncache$1026,n$2994)){return $968(__chk_ncache$1026,n$2994);}else{(v$2998=mac1$1025(function(x$3002){return ["send",["symbol","==="],["data",x$3002,["value",n$2994]]];}));;(__chk_ncache$1026[n$2994]=v$2998);return v$2998;}}else{if((typeof($2964$2970)==="string")){(s$3007=$2964$2970);if(Object.prototype.hasOwnProperty.call(__chk_scache$1027,s$3007)){return $968(__chk_scache$1027,s$3007);}else{(v$3011=mac1$1025(function(x$3015){return ["send",["symbol","==="],["data",x$3015,["value",s$3007]]];}));;(__chk_scache$1027[s$3007]=v$3011);return v$3011;}}else{$3043($2964$2970);}}}}}}});;$3247(checker_db$1028,({"String":mac1$1025(function(x$3022){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$3022]],["value","string"]]];}),"Number":mac1$1025(function(x$3025){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$3025]],["value","number"]]];}),"Array":mac1$1025(function(x$3028){return ["send",["symbol","instanceof"],["data",x$3028,["symbol","Array"]]];}),"true":mac1$1025(function(x$3031){return x$3031;}),"false":mac1$1025(function(x$3034){return ["send",["symbol","not"],["data",["void"],x$3034]];}),"null":mac1$1025(function(x$3037){return ["send",["symbol","==="],["data",x$3037,["value",null]]];}),"undefined":mac1$1025(function(x$3040){return ["send",["symbol","==="],["data",x$3040,["value",(void 0)]]];})}));(exports["Env"]=Env$1022);(exports["Scope"]=Scope$1021);(exports["track_location"]=track_location$1023);(exports["Expander"]=Expander$1024);(exports["GenSym"]=GenSym$1015);(exports["gensym"]=gensym$1016);(exports["mac1"]=mac1$1025);(exports["checker_db"]=checker_db$1028);
