var $1479=function(type$1482){var f$1486;(f$1486=type$1482["::check"]);if((f$1486===(void 0))){return function(value$1492){return (value$1492 instanceof type$1482);};}else{return function(value$1496){return f$1486.call(type$1482,value$1496);};}};
var $1498=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $1499=function(dest$1502,values$1503){var k$1508;(k$1508=null);$1506:for(k$1508 in values$1503){if(values$1503.hasOwnProperty(k$1508)){(dest$1502[k$1508]=values$1503[k$1508]);}}return dest$1502;};
var $1516=function($1518$1521){var ph$1527;(ph$1527=$1518$1521);var $1523$1533;($1523$1533=ph$1527);var bridge$1525$1538;var x$1542;(bridge$1525$1538=$1523$1533);if((((typeof(bridge$1525$1538)==="string")&&((x$1542=bridge$1525$1538),true))||((typeof(bridge$1525$1538)==="number")&&((x$1542=bridge$1525$1538),true)))){return ["value",x$1542];}else{var other$1553;(other$1553=$1523$1533);return other$1553["::serialize_ast"]();}};
var send$1253;(send$1253=function(obj$1260,$1257$1261){var ph$1267;var msg$1268;var t0$1270;(t0$1270=$1257$1261);(msg$1268=t0$1270);(ph$1267=t0$1270);var $1263$1279;($1263$1279=ph$1267);var bridge$1265$1284;(bridge$1265$1284=$1263$1279);if(((typeof(bridge$1265$1284)==="string")||(typeof(bridge$1265$1284)==="number"))){return obj$1260[msg$1268];}else{var other$1296;(other$1296=$1263$1279);return obj$1260["::send"](msg$1268);}});(Array[":::project"]=function($1302$1305){var ph$1310;var value$1311;var t0$1313;(t0$1313=$1302$1305);(value$1311=t0$1313);(ph$1310=t0$1313);var $1307$1322;($1307$1322=ph$1310);if($1479(Array)($1307$1322)){return [true,value$1311];}else{$1307$1322;return [true,[value$1311]];}});(Array.prototype["::check"]=function(value$1340){if((value$1340 instanceof Array)){var i$1346;(i$1346=0);$1343:for(;(i$1346<this.length);(i$1346++)){if(($1498(this,i$1346)!==$1498(value$1340,i$1346))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $1499(this.slice(0),this);});(Array.prototype[":::project"]=function(value$1365){if((value$1365 instanceof Array)){var i$1371;(i$1371=0);$1368:for(;(i$1371<this.length);(i$1371++)){if(($1498(this,i$1371)!==$1498(value$1365,i$1371))){return [true,[value$1365]];}}return [true,value$1365.slice(this.length)];}else{return [true,[value$1365]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($1516));});(RegExp.prototype["::check"]=function($1389$1392){var ph$1397;(ph$1397=$1389$1392);var $1394$1403;($1394$1403=ph$1397);var value$1411;if((typeof($1394$1403)==="string")){(value$1411=$1394$1403);if(value$1411.match(this)){return true;}else{return false;}}else{var other$1416;(other$1416=$1394$1403);return false;}});(RegExp.prototype[":::project"]=function($1422$1425){var ph$1430;(ph$1430=$1422$1425);var $1427$1436;($1427$1436=ph$1430);var value$1444;if((typeof($1427$1436)==="string")){(value$1444=$1427$1436);var $1447$1452;($1447$1452=value$1444.match(this));var m$1460;if(($1447$1452===null)){(m$1460=$1447$1452);return [false,null];}else{var m$1465;(m$1465=$1447$1452);return [true,m$1465];}}else{var other$1469;(other$1469=$1427$1436);return [false,null];}});(Function.prototype["::send"]=function(args$1476){return this.apply(this,args$1476);});
var $4767=function(arr$4770){var results$4776;var l$4777;(results$4776=[]);(l$4777=arr$4770.length);var i$4786;(i$4786=0);$4775:for(;(i$4786<l$4777);(i$4786++)){results$4776.push([i$4786,$1498(arr$4770,i$4786)]);}return results$4776;};
var $4534=function(){var $4535$4541;($4535$4541=function(tags$4546){var it$0$4549;(it$0$4549=function(){if((!$1479($4535$4541)(this))){return Object.create($4535$4541.prototype);}else{return this;}}());(it$0$4549["tags"]=tags$4546);return it$0$4549;});($4535$4541.prototype["create"]=function(){var it$0$4569;var self$4570;(it$0$4569=this);(self$4570=this);var $4567$4579;($4567$4579=arguments);var t0$4584;var message$4588;var args$4589;(t0$4584=$4567$4579.length);if((t0$4584>=0)){(message$4588=function(){if((0>=t0$4584)){return "";}else{return $4567$4579[0];}}());(args$4589=Array.prototype.slice.call($4567$4579,1));var e$4602;(e$4602=Error(message$4588));(e$4602["::tags"]=it$0$4569.tags);(e$4602["args"]=args$4589);var temp$4618;(temp$4618=$4767(args$4589));var $length$4624;($length$4624=temp$4618.length);var $index$4630;($index$4630=0);$4603:for(;($index$4630<$length$4624);($index$4630++)){var m$4639;(m$4639=temp$4618[$index$4630]);var t0$4644;var t1$4645;var i$4649;var arg$4650;(t0$4644=m$4639);if(((t0$4644 instanceof Array)&&(((t1$4645=t0$4644.length)),(t1$4645===2)))){(i$4649=t0$4644[0]);(arg$4650=t0$4644[1]);(e$4602[i$4649]=arg$4650);}else{$4515(m$4639);}}(e$4602["length"]=args$4589.length);(e$4602["name"]=["E"].concat(it$0$4569.tags).join("."));return e$4602;}else{$4515($4567$4579);}});($4535$4541.prototype["::check"]=function(e$4680){var it$0$4684;var self$4685;(it$0$4684=this);(self$4685=this);var tags$4695;if(((!e$4680)||(!$1479(Error)(e$4680)))){return false;}(tags$4695=(e$4680["::tags"]||[]));var temp$4706;(temp$4706=it$0$4684.tags);var $length$4712;($length$4712=temp$4706.length);var $index$4718;($index$4718=0);$4696:for(;($index$4718<$length$4712);($index$4718++)){var m$4727;(m$4727=temp$4706[$index$4718]);var tag$4735;(tag$4735=m$4727);if((tags$4695.indexOf(tag$4735)===-1)){return false;}else{false;}}return true;});($4535$4541.prototype["::deconstruct"]=function(e$4744){var it$0$4748;var self$4749;(it$0$4748=this);(self$4749=this);return e$4744.args;});$1499($4535$4541,$1499(function(){var accum$4760;(accum$4760=({}));(accum$4760["::name"]="$4535");return accum$4760;}(),function(){var accum$4764;(accum$4764=({}));(accum$4764["::egclass"]=true);return accum$4764;}()));return $4535$4541;}();
var $4515=function(value$4518,url$4519,start$4520,end$4521){var err$4525;(err$4525=$4534(["match"]).create("Could not find a match for value",({"value":value$4518})));if(url$4519){(err$4525["location"]=["location",url$4519,start$4520,end$4521]);}throw err$4525;};
var $4793=function($4795$4798,key$4799){var ph$4807;(ph$4807=$4795$4798);var $4801$4813;($4801$4813=ph$4807);var bridge$4803$4818;(bridge$4803$4818=$4801$4813);if(((bridge$4803$4818===null)||(bridge$4803$4818===(void 0)))){return false;}else{var x$4830;if((typeof($4801$4813)==="string")){(x$4830=$4801$4813);return (key$4799 in String.prototype);}else{var x$4835;if((typeof($4801$4813)==="number")){(x$4835=$4801$4813);return (key$4799 in Number.prototype);}else{var x$4840;(x$4840=$4801$4813);return (key$4799 in x$4840);}}}};
var $4842=function(obj$4845){var results$4850;(results$4850=[]);var k$4855;(k$4855=null);$4849:for(k$4855 in obj$4845){if(Object.prototype.hasOwnProperty.call(obj$4845,k$4855)){results$4850.push([k$4855,$1498(obj$4845,k$4855)]);}}return results$4850;};
var $4859=function(type$4862){return function(value$4866){var f$4870;(f$4870=type$4862[":::project"]);if((f$4870===(void 0))){(f$4870=type$4862["::project"]);if((f$4870===(void 0))){return [true,type$4862(value$4866)];}else{var rval$4883;(rval$4883=false);try{(rval$4883=[true,f$4870(value$4866)]);}catch(excv$4894){var e$4900;(e$4900=excv$4894);(rval$4883=[false,null]);}return rval$4883;}}else{return f$4870.call(type$4862,value$4866);}};};var accum$1860;var accum$1864;var accum$2252;var accum$2256;var accum$4325;var accum$4329;var $1557$1597;var __lt____gt__$1598;var $1558$1599;var __lt____lt____colon__$1600;var util$1601;var classify$1602;var neighbours$1603;var GenSym$1604;var gensym$1605;var $1560$1606;var PatternParser$1607;var PatternProcessor$1608;var Scope$1609;var Env$1610;var track_location$1611;var Expander$1612;var mac1$1613;var __chk_ncache$1614;var __chk_scache$1615;var checker_db$1616;($1557$1597=require("./pp"));(__lt____gt__$1598=$1557$1597["<>"]);($1558$1599=require("./location"));(__lt____lt____colon__$1600=$1558$1599["<<:"]);(util$1601=require("./util"));(classify$1602=util$1601.classify);(neighbours$1603=util$1601.neighbours);(GenSym$1604=util$1601.GenSym);(gensym$1605=util$1601.gensym);($1560$1606=require("./pattern"));(PatternParser$1607=$1560$1606.PatternParser);(PatternProcessor$1608=$1560$1606.PatternProcessor);(Scope$1609=function(){var parent$1677;var name$1678;var expander$1679;var t0$1673;var $1664$1668;var it$0$1659;(it$0$1659=function(){if((!$1479(Scope$1609)(this))){return Object.create(Scope$1609.prototype);}else{return this;}}());($1664$1668=arguments);(t0$1673=$1664$1668.length);if(((t0$1673>=0)&&(t0$1673<=3))){(parent$1677=function(){if((0>=t0$1673)){return null;}else{return $1664$1668[0];}}());(name$1678=function(){if((1>=t0$1673)){return null;}else{return $1664$1668[1];}}());(expander$1679=function(){if((2>=t0$1673)){return null;}else{return $1664$1668[2];}}());(it$0$1659["name"]=(name$1678||gensym$1605("scope")));(it$0$1659["parent"]=parent$1677);(it$0$1659["options"]=({}));(it$0$1659["expander"]=(expander$1679||parent$1677.expander));}else{$4515($1664$1668);}return it$0$1659;});(Scope$1609.prototype["getopt"]=function(opt$1710){var otherwise$1747;var $1727$1736;var $1723$1730;var it$0$1714;var self$1715;(it$0$1714=this);(self$1715=this);($1723$1730=null);$1723$1730;if(Object.prototype.hasOwnProperty.call(it$0$1714.options,opt$1710)){return $1498(it$0$1714.options,opt$1710);}else{if((it$0$1714.parent===null)){return (void 0);}else{(otherwise$1747=$1723$1730);return it$0$1714.parent.getopt(opt$1710);}}});(Scope$1609.prototype["setopt"]=function(opt$1753,value$1754){var it$0$1758;var self$1759;(it$0$1758=this);(self$1759=this);(it$0$1758.options[opt$1753]=value$1754);});(Scope$1609.prototype["gensym"]=function(){var it$0$1778;var self$1779;(it$0$1778=this);(self$1779=this);return it$0$1778.expander.gensym();});(Scope$1609.prototype["step"]=function(context$1791,expr$1792){var it$0$1796;var self$1797;(it$0$1796=this);(self$1797=this);return it$0$1796.expander.step(context$1791,it$0$1796,expr$1792);});(Scope$1609.prototype["step_all"]=function(context$1809,exprs$1810){var it$0$1814;var self$1815;(it$0$1814=this);(self$1815=this);return it$0$1814.expander.step_all(context$1809,it$0$1814,exprs$1810);});(Scope$1609.prototype["expand"]=function(context$1827,expr$1828){var it$0$1832;var self$1833;(it$0$1832=this);(self$1833=this);return it$0$1832.expander.expand(context$1827,it$0$1832,expr$1828);});(Scope$1609.prototype["toString"]=function(){var it$0$1848;var self$1849;(it$0$1848=this);(self$1849=this);return (("Scope{"+it$0$1848.name)+"}");});$1499(Scope$1609,$1499(((accum$1860=({})),((accum$1860["::name"]="Scope"),accum$1860)),((accum$1864=({})),((accum$1864["::egclass"]=true),accum$1864))));Scope$1609;(Env$1610=function(){var it$0$1873;(it$0$1873=function(){if((!$1479(Env$1610)(this))){return Object.create(Env$1610.prototype);}else{return this;}}());(it$0$1873["scopes"]=({}));return it$0$1873;});(Env$1610.prototype["resolve"]=function(scope$1888,name$1889){var scope_data$1904;var it$0$1893;var self$1894;(it$0$1893=this);(self$1894=this);if((scope$1888===null)){return (void 0);}(scope_data$1904=$1498(it$0$1893.scopes,scope$1888.name));if((scope_data$1904&&Object.prototype.hasOwnProperty.call(scope_data$1904,name$1889))){return $1498(scope_data$1904,name$1889);}else{return it$0$1893.resolve(scope$1888.parent,name$1889);}});(Env$1610.prototype["bind"]=function(scope$1913,name$1914,value$1915){var it$0$1919;var self$1920;(it$0$1919=this);(self$1920=this);if((!$1498(it$0$1919.scopes,scope$1913.name))){(it$0$1919.scopes[scope$1913.name]=({}));}($1498(it$0$1919.scopes,scope$1913.name)[name$1914]=value$1915);});(Env$1610.prototype["convert"]=function(expr$1942){var x$2009;var x$2015;var bridge$1961$2001;var x$2021;var bridge$1960$1994;var x$2027;var bridge$1959$1987;var x$2033;var $index$2068;var $length$2062;var temp$2056;var other$2089;var type$2040;var args$2041;var e$1976;var bridge$1958$1971;var t0$1972;var $1955$1966;var it$0$1946;var self$1947;(it$0$1946=this);(self$1947=this);($1955$1966=expr$1942);if($4793($1955$1966,"env")){(e$1976=$1955$1966.env);return expr$1942;}else{(bridge$1958$1971=$1955$1966);if(((((bridge$1959$1987=bridge$1958$1971)),((((bridge$1960$1994=bridge$1959$1987)),((((bridge$1961$2001=bridge$1960$1994)),((((x$2009=bridge$1961$2001)),((x$2009 instanceof Array)&&(x$2009[0]==="symbol")))||(((x$2015=bridge$1961$2001)),((x$2015 instanceof Array)&&(x$2015[0]==="value")))))||(((x$2021=bridge$1960$1994)),((x$2021 instanceof Array)&&(x$2021[0]==="variable")))))||(((x$2027=bridge$1959$1987)),((x$2027 instanceof Array)&&(x$2027[0]==="macro")))))||(((x$2033=bridge$1958$1971)),((x$2033 instanceof Array)&&(x$2033[0]==="void"))))){return $1499(expr$1942,({"env":it$0$1946}));}else{if((($1955$1966 instanceof Array)&&(((t0$1972=$1955$1966.length)),(t0$1972>=1)))){(type$2040=$1955$1966[0]);(args$2041=Array.prototype.slice.call($1955$1966,1));(temp$2056=args$2041);($length$2062=temp$2056.length);($index$2068=0);$2050:for(;($index$2068<$length$2062);($index$2068++)){var arg$2085;var m$2077;(m$2077=temp$2056[$index$2068]);(arg$2085=m$2077);it$0$1946.convert(arg$2085);}return $1499(expr$1942,({"env":it$0$1946}));}else{(other$2089=$1955$1966);return $1499(expr$1942,({"env":it$0$1946}));}}}});(Env$1610.prototype["fork"]=function(){var $index$2131;var $length$2125;var temp$2119;var e$2109;var it$0$2098;var self$2099;(it$0$2098=this);(self$2099=this);(e$2109=Env$1610());(temp$2119=$4842(it$0$2098.scopes));($length$2125=temp$2119.length);($index$2131=0);$2110:for(;($index$2131<$length$2125);($index$2131++)){var $index$2186;var $length$2180;var temp$2174;var acc$2168;var scope$2150;var bindings$2151;var t0$2145;var t1$2146;var m$2140;(m$2140=temp$2119[$index$2131]);(t0$2145=m$2140);if(((t0$2145 instanceof Array)&&(((t1$2146=t0$2145.length)),(t1$2146===2)))){(scope$2150=t0$2145[0]);(bindings$2151=t0$2145[1]);(acc$2168=[]);(temp$2174=$4842(bindings$2151));($length$2180=temp$2174.length);($index$2186=0);$2163:for(;($index$2186<$length$2180);($index$2186++)){var k$2205;var v$2206;var t0$2200;var t1$2201;var m$2195;(m$2195=temp$2174[$index$2186]);(t0$2200=m$2195);if(((t0$2200 instanceof Array)&&(((t1$2201=t0$2200.length)),(t1$2201===2)))){(k$2205=t0$2200[0]);(v$2206=t0$2200[1]);acc$2168.push((function(){if((!$1498(e$2109.scopes,scope$2150))){(e$2109.scopes[scope$2150]=({}));}}(),(($1498(e$2109.scopes,scope$2150)[k$2205]=v$2206))));}else{$4515(m$2195,"/home/olivier/git/earl-grey/src/expand.eg",1949,2106);}}acc$2168;}else{$4515(m$2140,"/home/olivier/git/earl-grey/src/expand.eg",1909,2106);}}return e$2109;});(Env$1610.prototype["toString"]=function(){var it$0$2240;var self$2241;(it$0$2240=this);(self$2241=this);return "Env{...}";});$1499(Env$1610,$1499(((accum$2252=({})),((accum$2252["::name"]="Env"),accum$2252)),((accum$2256=({})),((accum$2256["::egclass"]=true),accum$2256))));Env$1610;(track_location$1611=function(f$2263){var f2$2267;(f2$2267=function(context$2272,scope$2273,expr$2274){var rval$2288;var other$2334;var v$2324;var t0$2320;var $2278$2315;var rval$2281;(rval$2281=(((rval$2288=false)),(function(){try{(rval$2288=f$2263(context$2272,scope$2273,expr$2274));}catch(excv$2299){var e$2305;(e$2305=excv$2299);(rval$2288=(__lt____lt____colon__$1600(e$2305,expr$2274),function(){throw e$2305;}()));}}(),rval$2288)));($2278$2315=rval$2281);if((($2278$2315 instanceof Array)&&(((t0$2320=$2278$2315.length)),((t0$2320===2)&&($2278$2315[0]==="bounce"))))){(v$2324=$2278$2315[1]);return f2$2267(context$2272,scope$2273,__lt____lt____colon__$1600(v$2324,expr$2274));}else{(other$2334=$2278$2315);return __lt____lt____colon__$1600(other$2334,expr$2274);}});return f2$2267;});(Expander$1612=function(env_factory$2342,generic_nodes$2343){var it$0$2346;(it$0$2346=function(){if((!$1479(Expander$1612)(this))){return Object.create(Expander$1612.prototype);}else{return this;}}());(it$0$2346["gensym"]=gensym$1605);(it$0$2346["mkenv"]=env_factory$2342);(it$0$2346["generic_nodes"]=generic_nodes$2343);return it$0$2346;});(Expander$1612.prototype["run_macro"]=function(m$2370,context$2371,scope$2372,form$2373,arg$2374){var rval$2397;var rval$2389;var it$0$2378;var self$2379;(it$0$2378=this);(self$2379=this);(rval$2389=(((rval$2397=false)),(function(){try{(rval$2397=m$2370(context$2371,scope$2372,form$2373,arg$2374));}catch(excv$2408){var msg$2465;var msg$2587;var find$2476;var err$2477;var other$2471;var $2448$2453;var e$2445;var e$2595;var value$2418;var t0$2411;var t1$2412;var t2$2413;var t3$2414;(t0$2411=excv$2408);if(($1479($4534(["match"]))(t0$2411)&&($4793(t0$2411,"args")&&(((t1$2412=t0$2411.args)),((t1$2412 instanceof Array)&&(((t2$2413=t1$2412.length)),((t2$2413===1)&&(((t3$2414=t1$2412[0])),$4793(t3$2414,"value"))))))))){(value$2418=t3$2414.value);(rval$2397=(((e$2445=((($2448$2453=value$2418)),function(){if(($2448$2453===context$2371)){(msg$2465="The macro cannot be found in this context.");return $4534(["syntax","context"]).create(msg$2465,({"context":context$2371,"form":form$2373}));}else{(other$2471=$2448$2453);(find$2476=function($2481$2484){var t0$2493;var msg$2515;var $index$2549;var $length$2543;var temp$2537;var other$2579;var type$2521;var xs$2522;var t0$2507;var $2486$2502;var ph$2490;var arg$2491;(t0$2493=$2481$2484);(arg$2491=t0$2493);(ph$2490=t0$2493);($2486$2502=ph$2490);if(($2486$2502===value$2418)){(msg$2515="The macro expected something different.");return $4534(["syntax","argument"]).create(msg$2515,({"context":context$2371,"argument":arg$2491,"form":form$2373}));}else{if((($2486$2502 instanceof Array)&&(((t0$2507=$2486$2502.length)),(t0$2507>=1)))){(type$2521=$2486$2502[0]);(xs$2522=Array.prototype.slice.call($2486$2502,1));(temp$2537=xs$2522);($length$2543=temp$2537.length);($index$2549=0);$2531:for(;($index$2549<$length$2543);($index$2549++)){var x$2567;var t0$2563;var m$2558;(m$2558=temp$2537[$index$2549]);(t0$2563=$4859(find$2476)(m$2558));if(t0$2563[0]){(x$2567=t0$2563[1]);if(x$2567){return x$2567;}}else{$4515(m$2558,"/home/olivier/git/earl-grey/src/expand.eg",3365,3450);}}return false;}else{(other$2579=$2486$2502);return false;}}});(err$2477=find$2476(arg$2374));if(err$2477){return err$2477;}else{(msg$2587="The macro expected something different (could not locate error in the source).");return $4534(["syntax","failure"]).create(msg$2587,({"form":form$2373,"value":value$2418}));}}}()))),function(){throw e$2445;}()));}else{(e$2595=excv$2408);(rval$2397=function(){throw e$2595;}());}}}(),rval$2397)));return it$0$2378.mkenv().convert(rval$2389);});(Expander$1612.prototype["step"]=function(context$2606,scope$2607,expr$2608){var helper$2623;var it$0$2612;var self$2613;(it$0$2612=this);(self$2613=this);(helper$2623=track_location$1611(function(context$2630,scope$2631,$2627$2632){var t0$2646;var other$2701;var env$2696;var $2683$2688;var other$2746;var t0$2733;var $2723$2728;var other$2750;var m$2715;var t0$2711;var $2677$2706;var env$2680;var other$2780;var t0$2767;var $2757$2762;var other$2812;var m$2802;var t0$2798;var $2788$2793;var other$2821;var x$2816;var f$2784;var arg$2785;var m$2754;var s$2667;var $2640$2662;var $2641$2663;var $2642$2664;var t0$2660;var $2634$2655;var ph$2643;var expr$2644;(t0$2646=$2627$2632);(expr$2644=t0$2646);(ph$2643=t0$2646);($2634$2655=ph$2643);if((($2640$2662=($2634$2655 instanceof Array))&&(((t0$2660=$2634$2655.length)),(($2642$2664=(t0$2660===2))&&($2634$2655[0]==="symbol"))))){(s$2667=$2634$2655[1]);(env$2680=((($2683$2688=expr$2644)),function(){if($4793($2683$2688,"env")){(env$2696=$2683$2688.env);return expr$2644.env;}else{(other$2701=$2683$2688);throw $4534(["syntax","no_env"]).create("No environment was found to resolve",({"symbol":expr$2644}));}}()));($2677$2706=env$2680.resolve(scope$2631,s$2667));if((($2677$2706 instanceof Array)&&(((t0$2711=$2677$2706.length)),((t0$2711===2)&&($2677$2706[0]==="macro"))))){(m$2715=$2677$2706[1]);($2723$2728=context$2630);if((($2723$2728 instanceof Array)&&(((t0$2733=$2723$2728.length)),((t0$2733===2)&&(($2723$2728[0]==="expr")&&($2723$2728[1]==="head")))))){return ["macro",m$2715];}else{(other$2746=$2723$2728);return ["bounce",it$0$2612.run_macro(m$2715,context$2630,scope$2631,expr$2644,__lt____lt____colon__$1600(["void"],expr$2644))];}}else{(other$2750=$2677$2706);return expr$2644;}}else{if(($2642$2664&&($2634$2655[0]==="macro"))){(m$2754=$2634$2655[1]);($2757$2762=context$2630);if((($2757$2762 instanceof Array)&&(((t0$2767=$2757$2762.length)),((t0$2767===2)&&(($2757$2762[0]==="expr")&&($2757$2762[1]==="head")))))){return expr$2644;}else{(other$2780=$2757$2762);return ["bounce",it$0$2612.run_macro(m$2754,context$2630,scope$2631,expr$2644,__lt____lt____colon__$1600(["void"],expr$2644))];}}else{if(($2640$2662&&((t0$2660===3)&&($2634$2655[0]==="send")))){(f$2784=$2634$2655[1]);(arg$2785=$2634$2655[2]);($2788$2793=helper$2623(["expr","head"],scope$2631,f$2784));if((($2788$2793 instanceof Array)&&(((t0$2798=$2788$2793.length)),((t0$2798===2)&&($2788$2793[0]==="macro"))))){(m$2802=$2788$2793[1]);return ["bounce",it$0$2612.run_macro(m$2802,context$2630,scope$2631,expr$2644,arg$2785)];}else{(other$2812=$2788$2793);return expr$2644;}}else{if(($2640$2662&&((t0$2660===2)&&($2634$2655[0]==="nostep")))){(x$2816=$2634$2655[1]);return x$2816;}else{(other$2821=$2634$2655);return expr$2644;}}}}}));return helper$2623(context$2606,scope$2607,expr$2608);});(Expander$1612.prototype["step_all"]=function(context$2830,scope$2831,$2827$2832){var t0$2847;var t1$2848;var pre$2865;var bulk$2866;var post$2867;var stmts$2845;var it$0$2836;var self$2837;(it$0$2836=this);(self$2837=this);(t0$2847=$2827$2832);if(((t0$2847 instanceof Array)&&(((t1$2848=t0$2847.length)),(t1$2848>=0)))){(stmts$2845=Array.prototype.slice.call(t0$2847,0));}else{$4515($2827$2832);}(pre$2865=[]);(bulk$2866=[]);(post$2867=[]);$2877:while(stmts$2845.length){var x$2942;var m$2933;var stmt$2928;var stmt$2923;var prepend$2909;var $2888$2904;var $2889$2905;var $2890$2906;var t0$2902;var $2882$2897;var current$2891;(current$2891=stmts$2845.shift());($2882$2897=it$0$2836.step(context$2830,scope$2831,current$2891));if((($2888$2904=($2882$2897 instanceof Array))&&(((t0$2902=$2882$2897.length)),((t0$2902>=1)&&($2882$2897[0]==="splice"))))){(prepend$2909=Array.prototype.slice.call($2882$2897,1));(stmts$2845=prepend$2909.concat(stmts$2845));}else{if(($2888$2904&&(($2890$2906=(t0$2902===2))&&($2882$2897[0]==="float")))){(stmt$2923=$2882$2897[1]);(pre$2865=pre$2865.concat(it$0$2836.step_all(context$2830,scope$2831,[stmt$2923])));}else{if(($2890$2906&&($2882$2897[0]==="sink"))){(stmt$2928=$2882$2897[1]);(post$2867=post$2867.concat(it$0$2836.step_all(context$2830,scope$2831,[stmt$2928])));}else{if(($2890$2906&&($2882$2897[0]==="multimacro"))){(m$2933=$2882$2897[1]);(stmts$2845=m$2933(context$2830,scope$2831,current$2891,stmts$2845));}else{(x$2942=$2882$2897);bulk$2866.push(x$2942);}}}}}return pre$2865.concat(bulk$2866).concat(post$2867);});(Expander$1612.prototype["expand"]=function(context$2948,scope$2949,expr$2950){var helper$2965;var it$0$2954;var self$2955;(it$0$2954=this);(self$2955=this);(helper$2965=track_location$1611(function(context$2970,scope$2971,expr$2972){var t0$3035;var other$3057;var $3030$3045;var env$3033;var $index$3110;var $length$3104;var temp$3098;var acc$3092;var newargs$3084;var $index$3164;var $length$3158;var temp$3152;var acc$3146;var newargs$3138;var t0$3228;var newscope$3222;var env$3223;var $index$3312;var $length$3306;var temp$3300;var acc$3294;var $index$3524;var $length$3518;var temp$3512;var acc$3506;var t0$3273;var newscope$3257;var stepscope$3258;var changes$3259;var newargs$3260;var vars$3261;var exp$3262;var $index$3947;var $length$3941;var temp$3935;var other$4051;var t0$4029;var $4018$4024;var is_obj$3826;var obj$3827;var arr$3828;var arr_parts$3829;var obj_parts$3830;var new_arr_part$3831;var new_obj_part$3832;var r$3833;var x$4088;var msg$4095;var x$4104;var msg$4111;var otherwise$4117;var $4067$4077;var t$4071;var $index$4161;var $length$4155;var temp$4149;var acc$4143;var newscope$4131;var s$4240;var newscope$4253;var name$4231;var t0$4227;var $index$4297;var $length$4291;var temp$4285;var acc$4279;var other$4319;var type$4268;var args$4269;var tag$4257;var body$4258;var x$4222;var $2992$4223;var bindings$4125;var body$4126;var target$4061;var value$4062;var args$3814;var args$3248;var args$3243;var args$3238;var variable$3202;var s$3203;var value$3204;var body$3205;var args$3133;var args$3079;var f$3073;var arg$3074;var s$3020;var $2998$3015;var $2999$3016;var $3000$3017;var t0$3011;var t1$3012;var t2$3013;var $2976$3006;(expr$2972=it$0$2954.step(context$2970,scope$2971,expr$2972));($2976$3006=expr$2972);if((($2998$3015=($2976$3006 instanceof Array))&&(((t0$3011=$2976$3006.length)),(($3000$3017=(t0$3011===2))&&($2976$3006[0]==="symbol"))))){(s$3020=$2976$3006[1]);(t0$3035=expr$2972);if($4793(t0$3035,"env")){(env$3033=t0$3035.env);}else{$4515(expr$2972,"/home/olivier/git/earl-grey/src/expand.eg",7685,7689);}($3030$3045=env$3033.resolve(scope$2971,s$3020));if(($3030$3045===(void 0))){throw $4534(["syntax","undeclared"]).create(("Undeclared variable: "+s$3020),({"node":expr$2972}));}else{(other$3057=$3030$3045);return ["bounce",other$3057];}}else{if(($3000$3017&&($2976$3006[0]==="value"))){$2976$3006[1];return expr$2972;}else{if(($3000$3017&&($2976$3006[0]==="variable"))){$2976$3006[1];return expr$2972;}else{if(($2998$3015&&((t0$3011===1)&&($2976$3006[0]==="void")))){return expr$2972;}else{if(($2998$3015&&((t0$3011===3)&&($2976$3006[0]==="send")))){(f$3073=$2976$3006[1]);(arg$3074=$2976$3006[2]);return ["send",helper$2965(["expr","head"],scope$2971,f$3073),helper$2965(["expr","tail"],scope$2971,arg$3074)];}else{if(($2998$3015&&(($3000$3017=(t0$3011>=1))&&($2976$3006[0]==="array")))){(args$3079=Array.prototype.slice.call($2976$3006,1));(newargs$3084=(((acc$3092=[])),(((temp$3098=it$0$2954.step_all(["expr","array"],scope$2971,args$3079))),((($length$3104=temp$3098.length)),((($index$3110=0)),function(){$3087:for(;($index$3110<$length$3104);($index$3110++)){var arg$3127;var m$3119;(m$3119=temp$3098[$index$3110]);(arg$3127=m$3119);acc$3092.push(helper$2965(["expr","expr"],scope$2971,arg$3127));}}()))),acc$3092));return ["array"].concat(newargs$3084);}else{if(($3000$3017&&($2976$3006[0]==="object"))){(args$3133=Array.prototype.slice.call($2976$3006,1));(newargs$3138=(((acc$3146=[])),(((temp$3152=it$0$2954.step_all(["expr","object"],scope$2971,args$3133))),((($length$3158=temp$3152.length)),((($index$3164=0)),function(){$3141:for(;($index$3164<$length$3158);($index$3164++)){var k$3183;var v$3184;var t0$3178;var t1$3179;var m$3173;(m$3173=temp$3152[$index$3164]);(t0$3178=m$3173);if(((t0$3178 instanceof Array)&&(((t1$3179=t0$3178.length)),((t1$3179===3)&&(t0$3178[0]==="array"))))){(k$3183=t0$3178[1]);(v$3184=t0$3178[2]);acc$3146.push(["array",helper$2965(["expr","expr"],scope$2971,k$3183),helper$2965(["expr","expr"],scope$2971,v$3184)]);}else{$4515(m$3173,"/home/olivier/git/earl-grey/src/expand.eg",8528,8717);}}}()))),acc$3146));return ["object"].concat(newargs$3138);}else{if(($2998$3015&&((t0$3011===4)&&(($2976$3006[0]==="bind")&&(((t1$3012=$2976$3006[1])),((variable$3202=t1$3012),((t1$3012 instanceof Array)&&(((t2$3013=t1$3012.length)),((t2$3013===2)&&(t1$3012[0]==="symbol")))))))))){(s$3203=t1$3012[1]);(value$3204=$2976$3006[2]);(body$3205=$2976$3006[3]);(newscope$3222=Scope$1609(scope$2971));(t0$3228=variable$3202);if($4793(t0$3228,"env")){(env$3223=t0$3228.env);}else{$4515(variable$3202,"/home/olivier/git/earl-grey/src/expand.eg",8860,8868);}env$3223.bind(newscope$3222,s$3203,value$3204);return helper$2965(context$2970,newscope$3222,body$3205);}else{if(($2998$3015&&(($3000$3017=(t0$3011>=1))&&($2976$3006[0]==="splice")))){(args$3238=Array.prototype.slice.call($2976$3006,1));return ["bounce",$1499(["multi"].concat(args$3238),({"override_scope":true}))];}else{if(($3000$3017&&($2976$3006[0]==="interactive"))){(args$3243=Array.prototype.slice.call($2976$3006,1));return ["bounce",$1499(["multi"].concat(args$3243),({"override_scope":true,"all_mutable":true}))];}else{if(($3000$3017&&($2976$3006[0]==="multi"))){(args$3248=Array.prototype.slice.call($2976$3006,1));(newscope$3257=function(){if(expr$2972.override_scope){return scope$2971;}else{return Scope$1609(scope$2971);}}());(stepscope$3258=function(){if(expr$2972.nonrecursive){return scope$2971;}else{return newscope$3257;}}());(changes$3259=false);(t0$3273=classify$1602("newargs","vars",(((acc$3294=[])),(((temp$3300=it$0$2954.step_all(["expr","multi"],stepscope$3258,args$3248))),((($length$3306=temp$3300.length)),((($index$3312=0)),function(){$3278:for(;($index$3312<$length$3306);($index$3312++)){var t0$3378;var env$3376;var t0$3412;var v$3423;var env$3410;var t0$3470;var env$3468;var other$3483;var s$3450;var variable$3451;var v$3432;var value$3433;var variable$3391;var s$3392;var value$3393;var variable$3356;var s$3357;var value$3358;var opt$3339;var value$3340;var $3286$3331;var $3287$3332;var $3288$3333;var $3289$3334;var $3290$3335;var $3291$3336;var t0$3326;var t1$3327;var t2$3328;var t3$3329;var m$3321;(m$3321=temp$3300[$index$3312]);(t0$3326=m$3321);if((($3287$3332=(t0$3326 instanceof Array))&&(((t1$3327=t0$3326.length)),(($3289$3334=(t1$3327===3))&&(t0$3326[0]==="option"))))){(opt$3339=t0$3326[1]);(value$3340=t0$3326[2]);acc$3294.push((newscope$3257.setopt(opt$3339,value$3340),["ignore"]));}else{if(($3289$3334&&((t0$3326[0]==="declare_raw")&&(((t2$3328=t0$3326[1])),((variable$3356=t2$3328),((t2$3328 instanceof Array)&&(((t3$3329=t2$3328.length)),((t3$3329===2)&&(t2$3328[0]==="symbol"))))))))){(s$3357=t2$3328[1]);(value$3358=t0$3326[2]);acc$3294.push(((((t0$3378=variable$3356)),function(){if($4793(t0$3378,"env")){(env$3376=t0$3378.env);}else{return $4515(variable$3356,"/home/olivier/git/earl-grey/src/expand.eg",9814,9822);}}()),env$3376.bind(newscope$3257,s$3357,value$3358),((changes$3259=true)),["ignore"]));}else{if(($3287$3332&&(($3289$3334=((t1$3327>=2)&&(t1$3327<=3)))&&(($3290$3335=(t0$3326[0]==="declare"))&&(((t2$3328=t0$3326[1])),((variable$3391=t2$3328),((t2$3328 instanceof Array)&&(((t3$3329=t2$3328.length)),((t3$3329===2)&&(t2$3328[0]==="symbol")))))))))){(s$3392=t2$3328[1]);(value$3393=function(){if((2>=t1$3327)){return null;}else{return t0$3326[2];}}());acc$3294.push(((((t0$3412=variable$3391)),function(){if($4793(t0$3412,"env")){(env$3410=t0$3412.env);}else{return $4515(variable$3391,"/home/olivier/git/earl-grey/src/expand.eg",10062,10070);}}()),function(){if((variable$3391.use_previous&&env$3410.resolve(newscope$3257,s$3392))){return ["splice"];}else{(v$3423=__lt____lt____colon__$1600(["variable",it$0$2954.gensym(s$3392)],variable$3391));$1499(v$3423,({"mutable":(expr$2972.all_mutable||variable$3391.mutable)}));env$3410.bind(newscope$3257,s$3392,v$3423);(changes$3259=true);if(value$3393){return ["splice",["newargs",["assign",v$3423,value$3393]],["vars",v$3423]];}else{return ["vars",v$3423];}}}()));}else{if(($3290$3335&&((v$3432=t2$3328),((t2$3328 instanceof Array)&&(((t3$3329=t2$3328.length)),((t3$3329===2)&&(t2$3328[0]==="variable"))))))){t2$3328[1];(value$3433=function(){if((2>=t1$3327)){return null;}else{return t0$3326[2];}}());acc$3294.push((((changes$3259=true)),function(){if(value$3433){return ["splice",["newargs",["assign",v$3432,value$3433]],["vars",v$3432]];}else{return ["vars",v$3432];}}()));}else{if(($3287$3332&&((t1$3327===2)&&((t0$3326[0]==="undeclare")&&(((t2$3328=t0$3326[1])),((t2$3328 instanceof Array)&&(((t3$3329=t2$3328.length)),((t3$3329===2)&&(t2$3328[0]==="symbol"))))))))){(s$3450=t2$3328[1]);(variable$3451=t2$3328);acc$3294.push(((((t0$3470=variable$3451)),function(){if($4793(t0$3470,"env")){(env$3468=t0$3470.env);}else{return $4515(variable$3451,"/home/olivier/git/earl-grey/src/expand.eg",11334,11342);}}()),env$3468.bind(newscope$3257,s$3450,(void 0)),((changes$3259=true)),["ignore"]));}else{(other$3483=m$3321);acc$3294.push(["newargs",other$3483]);}}}}}}}()))),acc$3294)));if(($4793(t0$3273,"newargs")&&((newargs$3260=t0$3273.newargs),$4793(t0$3273,"vars")))){(vars$3261=t0$3273.vars);}else{$4515(classify$1602("newargs","vars",(((acc$3506=[])),(((temp$3512=it$0$2954.step_all(["expr","multi"],stepscope$3258,args$3248))),((($length$3518=temp$3512.length)),((($index$3524=0)),function(){$3490:for(;($index$3524<$length$3518);($index$3524++)){var t0$3590;var env$3588;var t0$3624;var v$3635;var env$3622;var t0$3682;var env$3680;var other$3695;var s$3662;var variable$3663;var v$3644;var value$3645;var variable$3603;var s$3604;var value$3605;var variable$3568;var s$3569;var value$3570;var opt$3551;var value$3552;var $3498$3543;var $3499$3544;var $3500$3545;var $3501$3546;var $3502$3547;var $3503$3548;var t0$3538;var t1$3539;var t2$3540;var t3$3541;var m$3533;(m$3533=temp$3512[$index$3524]);(t0$3538=m$3533);if((($3499$3544=(t0$3538 instanceof Array))&&(((t1$3539=t0$3538.length)),(($3501$3546=(t1$3539===3))&&(t0$3538[0]==="option"))))){(opt$3551=t0$3538[1]);(value$3552=t0$3538[2]);acc$3506.push((newscope$3257.setopt(opt$3551,value$3552),["ignore"]));}else{if(($3501$3546&&((t0$3538[0]==="declare_raw")&&(((t2$3540=t0$3538[1])),((variable$3568=t2$3540),((t2$3540 instanceof Array)&&(((t3$3541=t2$3540.length)),((t3$3541===2)&&(t2$3540[0]==="symbol"))))))))){(s$3569=t2$3540[1]);(value$3570=t0$3538[2]);acc$3506.push(((((t0$3590=variable$3568)),function(){if($4793(t0$3590,"env")){(env$3588=t0$3590.env);}else{return $4515(variable$3568,"/home/olivier/git/earl-grey/src/expand.eg",9814,9822);}}()),env$3588.bind(newscope$3257,s$3569,value$3570),((changes$3259=true)),["ignore"]));}else{if(($3499$3544&&(($3501$3546=((t1$3539>=2)&&(t1$3539<=3)))&&(($3502$3547=(t0$3538[0]==="declare"))&&(((t2$3540=t0$3538[1])),((variable$3603=t2$3540),((t2$3540 instanceof Array)&&(((t3$3541=t2$3540.length)),((t3$3541===2)&&(t2$3540[0]==="symbol")))))))))){(s$3604=t2$3540[1]);(value$3605=function(){if((2>=t1$3539)){return null;}else{return t0$3538[2];}}());acc$3506.push(((((t0$3624=variable$3603)),function(){if($4793(t0$3624,"env")){(env$3622=t0$3624.env);}else{return $4515(variable$3603,"/home/olivier/git/earl-grey/src/expand.eg",10062,10070);}}()),function(){if((variable$3603.use_previous&&env$3622.resolve(newscope$3257,s$3604))){return ["splice"];}else{(v$3635=__lt____lt____colon__$1600(["variable",it$0$2954.gensym(s$3604)],variable$3603));$1499(v$3635,({"mutable":(expr$2972.all_mutable||variable$3603.mutable)}));env$3622.bind(newscope$3257,s$3604,v$3635);(changes$3259=true);if(value$3605){return ["splice",["newargs",["assign",v$3635,value$3605]],["vars",v$3635]];}else{return ["vars",v$3635];}}}()));}else{if(($3502$3547&&((v$3644=t2$3540),((t2$3540 instanceof Array)&&(((t3$3541=t2$3540.length)),((t3$3541===2)&&(t2$3540[0]==="variable"))))))){t2$3540[1];(value$3645=function(){if((2>=t1$3539)){return null;}else{return t0$3538[2];}}());acc$3506.push((((changes$3259=true)),function(){if(value$3645){return ["splice",["newargs",["assign",v$3644,value$3645]],["vars",v$3644]];}else{return ["vars",v$3644];}}()));}else{if(($3499$3544&&((t1$3539===2)&&((t0$3538[0]==="undeclare")&&(((t2$3540=t0$3538[1])),((t2$3540 instanceof Array)&&(((t3$3541=t2$3540.length)),((t3$3541===2)&&(t2$3540[0]==="symbol"))))))))){(s$3662=t2$3540[1]);(variable$3663=t2$3540);acc$3506.push(((((t0$3682=variable$3663)),function(){if($4793(t0$3682,"env")){(env$3680=t0$3682.env);}else{return $4515(variable$3663,"/home/olivier/git/earl-grey/src/expand.eg",11334,11342);}}()),env$3680.bind(newscope$3257,s$3662,(void 0)),((changes$3259=true)),["ignore"]));}else{(other$3695=m$3533);acc$3506.push(["newargs",other$3695]);}}}}}}}()))),acc$3506)),"/home/olivier/git/earl-grey/src/expand.eg",9486,11564);}(exp$3262=function(s$3702){var $index$3735;var $length$3729;var temp$3723;var acc$3717;var $index$3791;var $length$3785;var temp$3779;var acc$3773;var stepped$3706;(stepped$3706=(((acc$3717=[])),(((temp$3723=$4767(newargs$3260))),((($length$3729=temp$3723.length)),((($index$3735=0)),function(){$3712:for(;($index$3735<$length$3729);($index$3735++)){var i$3754;var arg$3755;var t0$3749;var t1$3750;var m$3744;(m$3744=temp$3723[$index$3735]);(t0$3749=m$3744);if(((t0$3749 instanceof Array)&&(((t1$3750=t0$3749.length)),(t1$3750===2)))){(i$3754=t0$3749[0]);(arg$3755=t0$3749[1]);acc$3717.push(it$0$2954.step(["expr",function(){if((i$3754===(newargs$3260.length-1))){return "expr";}else{return "ignore";}}()],s$3702,arg$3755));}else{$4515(m$3744,"/home/olivier/git/earl-grey/src/expand.eg",11786,11963);}}}()))),acc$3717));(acc$3773=[]);(temp$3779=stepped$3706);($length$3785=temp$3779.length);($index$3791=0);$3707:for(;($index$3791<$length$3785);($index$3791++)){var arg$3808;var m$3800;(m$3800=temp$3779[$index$3791]);(arg$3808=m$3800);acc$3773.push(helper$2965(["expr","expr"],s$3702,arg$3808));}return acc$3773;});if(changes$3259){return ["scope",vars$3261,["multi"].concat(exp$3262(newscope$3257))];}else{return ["multi"].concat(exp$3262(scope$2971));}}else{if(($3000$3017&&($2976$3006[0]==="data"))){(args$3814=Array.prototype.slice.call($2976$3006,1));(is_obj$3826=false);(obj$3827=["object"]);(arr$3828=["array"]);(arr_parts$3829=[]);(obj_parts$3830=[]);(new_arr_part$3831=function(){var other$3888;var t0$3875;var $3865$3870;($3865$3870=arr$3828);if((($3865$3870 instanceof Array)&&(((t0$3875=$3865$3870.length)),((t0$3875===1)&&($3865$3870[0]==="array"))))){return false;}else{(other$3888=$3865$3870);arr_parts$3829.push(arr$3828);(arr$3828=["array"]);}});(new_obj_part$3832=function(){var other$3924;var t0$3911;var $3901$3906;($3901$3906=obj$3827);if((($3901$3906 instanceof Array)&&(((t0$3911=$3901$3906.length)),((t0$3911===1)&&($3901$3906[0]==="object"))))){return false;}else{(other$3924=$3901$3906);obj_parts$3830.push(obj$3827);(obj$3827=["object"]);}});(temp$3935=it$0$2954.step_all(["expr","data"],scope$2971,args$3814));($length$3941=temp$3935.length);($index$3947=0);$3834:for(;($index$3947<$length$3941);($index$3947++)){var other$4014;var expr$4004;var expr$3998;var k$3987;var v$3988;var $3841$3964;var $3842$3965;var $3843$3966;var $3844$3967;var t0$3961;var t1$3962;var m$3956;(m$3956=temp$3935[$index$3947]);(t0$3961=m$3956);if((($3842$3965=(t0$3961 instanceof Array))&&(((t1$3962=t0$3961.length)),((t1$3962===1)&&(t0$3961[0]==="assoc"))))){(is_obj$3826=true);}else{if(($3842$3965&&((t1$3962===3)&&(t0$3961[0]==="assoc")))){(k$3987=t0$3961[1]);(v$3988=t0$3961[2]);(is_obj$3826=true);obj$3827.push(["array",k$3987,v$3988]);}else{if(($3842$3965&&(($3844$3967=(t1$3962===2))&&(t0$3961[0]==="dynsplice")))){(expr$3998=t0$3961[1]);new_arr_part$3831();arr_parts$3829.push(expr$3998);}else{if(($3844$3967&&(t0$3961[0]==="objsplice"))){(expr$4004=t0$3961[1]);(is_obj$3826=true);new_obj_part$3832();obj_parts$3830.push(expr$4004);}else{(other$4014=m$3956);arr$3828.push(other$4014);}}}}}new_arr_part$3831();new_obj_part$3832();(r$3833=((($4018$4024=arr_parts$3829)),function(){if((($4018$4024 instanceof Array)&&(((t0$4029=$4018$4024.length)),((t0$4029===0)&&is_obj$3826)))){return util$1601.construct(obj_parts$3830,function(x$4042,rest$4043){return ["send",["symbol","&:"],["data",x$4042,rest$4043]];},["object"]);}else{$4018$4024;if(is_obj$3826){throw $4534(["syntax","array","object"]).create("Cannot mix array and object notations.");}else{(other$4051=$4018$4024);return util$1601.construct(arr_parts$3829.reverse(),function(x$4055,rest$4056){return ["send",["send",rest$4056,["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",x$4055]];},["array"]);}}}()));return helper$2965(context$2970,scope$2971,it$0$2954.mkenv().convert(r$3833));}else{if(($2998$3015&&(($3000$3017=(t0$3011===3))&&($2976$3006[0]==="assign")))){(target$4061=$2976$3006[1]);(value$4062=$2976$3006[2]);(t$4071=helper$2965(["expr","expr"],scope$2971,target$4061));($4067$4077=t$4071);if(((((x$4088=$4067$4077)),((x$4088 instanceof Array)&&(x$4088[0]==="variable")))&&(((!t$4071.mutable)&&t$4071.assigned)&&(t$4071.assigned.group_id!==target$4061.group_id)))){(msg$4095=["Variable was declared as read-only. Declare it as","mutable at the origin with `var` (if you have access","to the declaration) or declare a new variable with","`let` or `var` or remove the original binding with","`delete`"].join(" "));throw $4534(["syntax"]).create(msg$4095,({"variable":target$4061,"loc":t$4071.assigned}));}else{if((((x$4104=$4067$4077)),((x$4104 instanceof Array)&&(x$4104[0]==="macro")))){(msg$4111=["This variable is a macro and cannot be assigned to.","Use `let` to redeclare it or `delete` to undeclare it"].join(" "));throw $4534(["syntax"]).create(msg$4111,({"variable":target$4061}));}else{(otherwise$4117=$4067$4077);(t$4071["assigned"]=target$4061);}}return ["assign",t$4071,helper$2965(["expr","expr"],scope$2971,value$4062)];}else{if(($3000$3017&&($2976$3006[0]==="lambda"))){(bindings$4125=$2976$3006[1]);(body$4126=$2976$3006[2]);(newscope$4131=Scope$1609(scope$2971));return ["lambda",(((acc$4143=[])),(((temp$4149=bindings$4125)),((($length$4155=temp$4149.length)),((($index$4161=0)),function(){$4135:for(;($index$4161<$length$4155);($index$4161++)){var v$4198;var x$4209;var other$4217;var v$4205;var b$4181;var env$4182;var $4140$4178;var t0$4175;var t1$4176;var m$4170;(m$4170=temp$4149[$index$4161]);(t0$4175=m$4170);if(((t0$4175 instanceof Array)&&(((t1$4176=t0$4175.length)),((t1$4176===2)&&((t0$4175[0]==="symbol")&&((b$4181=t0$4175[1]),$4793(t0$4175,"env"))))))){(env$4182=t0$4175.env);acc$4143.push((((v$4198=["variable",it$0$2954.gensym(b$4181)])),(env$4182.bind(newscope$4131,b$4181,v$4198),v$4198)));}else{if((((x$4209=t0$4175)),((x$4209 instanceof Array)&&(x$4209[0]==="variable")))){(v$4205=t0$4175);acc$4143.push(v$4205);}else{(other$4217=m$4170);acc$4143.push(function(){throw $4534(["syntax","lambda","binding"]).create("Not a valid binding.",({"node":other$4217}));}());}}}}()))),acc$4143),helper$2965(["expr","expr"],newscope$4131,body$4126)];}else{if(($3000$3017&&($2976$3006[0]==="use"))){($2992$4223=$2976$3006[1]);(x$4222=$2976$3006[2]);(t0$4227=$2992$4223);if((typeof(t0$4227)==="string")){(name$4231=t0$4227);(s$4240=scope$2971);$4244:while(s$4240){if((s$4240.name.slice(0,(name$4231.length+1))===(name$4231+"/"))){break $4244;}else{(s$4240=s$4240.parent);}}if(s$4240){return helper$2965(context$2970,s$4240,x$4222);}else{throw $4534(["syntax","noscope"]).create(("Could not find a scope tagged: "+name$4231));}}else{(newscope$4253=$2992$4223);return helper$2965(context$2970,newscope$4253,x$4222);}}else{if(($3000$3017&&(($2976$3006[0]==="tagscope")&&(((t1$3012=$2976$3006[1])),(typeof(t1$3012)==="string"))))){(tag$4257=t1$3012);(body$4258=$2976$3006[2]);return helper$2965(context$2970,Scope$1609(scope$2971,it$0$2954.gensym((tag$4257+"/"))),body$4258);}else{if(($2998$3015&&((t0$3011>=1)&&((type$4268=$2976$3006[0]),((args$4269=Array.prototype.slice.call($2976$3006,1)),(it$0$2954.generic_nodes.indexOf(type$4268)!==-1)))))){return [type$4268].concat((((acc$4279=[])),(((temp$4285=args$4269)),((($length$4291=temp$4285.length)),((($index$4297=0)),function(){$4274:for(;($index$4297<$length$4291);($index$4297++)){var arg$4314;var m$4306;(m$4306=temp$4285[$index$4297]);(arg$4314=m$4306);acc$4279.push(helper$2965(["expr","expr"],scope$2971,arg$4314));}}()))),acc$4279));}else{(other$4319=$2976$3006);throw $4534(["syntax","illegal_node"]).create("An illegal node was found.",({"node":other$4319,"context":context$2970}));}}}}}}}}}}}}}}}}}}));return helper$2965(context$2948,scope$2949,expr$2950);});$1499(Expander$1612,$1499(((accum$4325=({})),((accum$4325["::name"]="Expander"),accum$4325)),((accum$4329=({})),((accum$4329["::egclass"]=true),accum$4329))));Expander$1612;(mac1$1613=function(f$4336){return ["macro",function(context$4342,scope$4343,form$4344,$4339$4345){var t0$4349;var t1$4350;var expr$4347;(t0$4349=$4339$4345);if(((t0$4349 instanceof Array)&&(((t1$4350=t0$4349.length)),((t1$4350===2)&&(t0$4349[0]==="data"))))){(expr$4347=t0$4349[1]);}else{$4515($4339$4345);}return f$4336(expr$4347);}];});(__chk_ncache$1614=({}));(__chk_scache$1615=({}));(checker_db$1616=function($4373$4376){var v$4421;var v$4440;var s$4434;var n$4415;var $4378$4391;var ph$4385;(ph$4385=$4373$4376);($4378$4391=ph$4385);if(($4378$4391===null)){return checker_db$1616.null;}else{if(($4378$4391===(void 0))){return checker_db$1616.undefined;}else{if(($4378$4391===true)){return checker_db$1616.true;}else{if(($4378$4391===false)){return checker_db$1616.false;}else{if((typeof($4378$4391)==="number")){(n$4415=$4378$4391);if($1498(__chk_ncache$1614,n$4415)){return $1498(__chk_ncache$1614,n$4415);}else{(v$4421=mac1$1613(function(x$4426){return ["send",["symbol","==="],["data",x$4426,["value",n$4415]]];}));(__chk_ncache$1614[n$4415]=v$4421);return v$4421;}}else{if((typeof($4378$4391)==="string")){(s$4434=$4378$4391);if(Object.prototype.hasOwnProperty.call(__chk_scache$1615,s$4434)){return $1498(__chk_scache$1615,s$4434);}else{(v$4440=mac1$1613(function(x$4445){return ["send",["symbol","==="],["data",x$4445,["value",s$4434]]];}));(__chk_scache$1615[s$4434]=v$4440);return v$4440;}}else{$4515($4378$4391);}}}}}}});$1499(checker_db$1616,({"String":mac1$1613(function(x$4456){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$4456]],["value","string"]]];}),"Number":mac1$1613(function(x$4460){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$4460]],["value","number"]]];}),"Array":mac1$1613(function(x$4464){return ["send",["symbol","instanceof"],["data",x$4464,["symbol","Array"]]];}),"true":mac1$1613(function(x$4468){return x$4468;}),"false":mac1$1613(function(x$4472){return ["send",["symbol","not"],["data",["void"],x$4472]];}),"null":mac1$1613(function(x$4476){return ["send",["symbol","==="],["data",x$4476,["value",null]]];}),"undefined":mac1$1613(function(x$4480){return ["send",["symbol","==="],["data",x$4480,["value",(void 0)]]];})}));(exports["Env"]=Env$1610);(exports["Scope"]=Scope$1609);(exports["track_location"]=track_location$1611);(exports["Expander"]=Expander$1612);(exports["GenSym"]=GenSym$1604);(exports["gensym"]=gensym$1605);(exports["mac1"]=mac1$1613);(exports["checker_db"]=checker_db$1616);
