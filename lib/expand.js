var $1910=(function(type$1913){var f$1917;(f$1917=type$1913["::check"]);if((f$1917===(void 0))){return (function(value$1923){return (value$1923 instanceof type$1913);});}else{return (function(value$1927){return f$1917.call(type$1913,value$1927);});}});
var $1929=(function(dest$1932,values$1933){var k$1938;(k$1938=null);$1936:for(k$1938 in values$1933){if(values$1933.hasOwnProperty(k$1938)){(dest$1932[k$1938]=values$1933[k$1938]);}}return dest$1932;});
var $1946=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $1947=(function($1949$1952){var ph$1958;(ph$1958=$1949$1952);var $1954$1964;($1954$1964=ph$1958);var bridge$1956$1969;var x$1973;(bridge$1956$1969=$1954$1964);if((((typeof(bridge$1956$1969)==="string")&&((x$1973=bridge$1956$1969),true))||((typeof(bridge$1956$1969)==="number")&&((x$1973=bridge$1956$1969),true)))){return ["value",x$1973];}else{var other$1984;(other$1984=$1954$1964);return other$1984["::serialize_ast"]();}});
var $1986=(function(obj$1989){var results$1994;(results$1994=[]);var k$1999;(k$1999=null);$1993:for(k$1999 in obj$1989){if(Object.prototype.hasOwnProperty.call(obj$1989,k$1999)){results$1994.push([k$1999,$1946(obj$1989,k$1999)]);}}return results$1994;});
var $2255=(function(arr$2258){var results$2264;var l$2265;(results$2264=[]);(l$2265=arr$2258.length);var i$2274;(i$2274=0);$2263:for(;(i$2274<l$2265);(i$2274++)){results$2264.push([i$2274,$1946(arr$2258,i$2274)]);}return results$2264;});
var $2022=(function(){var $2023$2029;($2023$2029=(function(tags$2034){var it$0$2037;(it$0$2037=(function(){if((!$1910($2023$2029)(this))){return Object.create($2023$2029.prototype);}else{return this;}})());(it$0$2037["tags"]=tags$2034);return it$0$2037;}));($2023$2029.prototype["create"]=(function(){var it$0$2057;var self$2058;(it$0$2057=this);(self$2058=this);var $2055$2067;($2055$2067=arguments);var t0$2072;var message$2076;var args$2077;(t0$2072=$2055$2067.length);if((t0$2072>=0)){(message$2076=(function(){if((0>=t0$2072)){return "";}else{return $2055$2067[0];}})());(args$2077=Array.prototype.slice.call($2055$2067,1));var e$2090;(e$2090=Error(message$2076));(e$2090["::tags"]=it$0$2057.tags);(e$2090["args"]=args$2077);var temp$2106;(temp$2106=$2255(args$2077));var $length$2112;($length$2112=temp$2106.length);var $index$2118;($index$2118=0);$2091:for(;($index$2118<$length$2112);($index$2118++)){var m$2127;(m$2127=temp$2106[$index$2118]);var t0$2132;var t1$2133;var i$2137;var arg$2138;(t0$2132=m$2127);if(((t0$2132 instanceof Array)&&(((t1$2133=t0$2132.length)),(t1$2133===2)))){(i$2137=t0$2132[0]);(arg$2138=t0$2132[1]);(e$2090[i$2137]=arg$2138);}else{$2003(m$2127);}}(e$2090["length"]=args$2077.length);(e$2090["name"]=["E"].concat(it$0$2057.tags).join("."));return e$2090;}else{$2003($2055$2067);}}));($2023$2029.prototype["::check"]=(function(e$2168){var it$0$2172;var self$2173;(it$0$2172=this);(self$2173=this);var tags$2183;if(((!e$2168)||(!$1910(Error)(e$2168)))){return false;}(tags$2183=(e$2168["::tags"]||[]));var temp$2194;(temp$2194=it$0$2172.tags);var $length$2200;($length$2200=temp$2194.length);var $index$2206;($index$2206=0);$2184:for(;($index$2206<$length$2200);($index$2206++)){var m$2215;(m$2215=temp$2194[$index$2206]);var tag$2223;(tag$2223=m$2215);if((tags$2183.indexOf(tag$2223)===-1)){return false;}else{false;}}return true;}));($2023$2029.prototype["::deconstruct"]=(function(e$2232){var it$0$2236;var self$2237;(it$0$2236=this);(self$2237=this);return e$2232.args;}));$1929($2023$2029,$1929((function(){var accum$2248;(accum$2248=({}));(accum$2248["::name"]="$2023");return accum$2248;})(),(function(){var accum$2252;(accum$2252=({}));(accum$2252["::egclass"]=true);return accum$2252;})()));return $2023$2029;})();
var $2003=(function(value$2006,url$2007,start$2008,end$2009){var err$2013;(err$2013=$2022(["match"]).create("Could not find a match for value",({"value":value$2006})));if(url$2007){(err$2013["location"]=["location",url$2007,start$2008,end$2009]);}throw err$2013;});
var send$1555;var __array_methods$1556;var __re_methods$1557;(send$1555=(function(obj$1570,$1567$1571){var ph$1577;var msg$1578;var t0$1580;(t0$1580=$1567$1571);(msg$1578=t0$1580);(ph$1577=t0$1580);var $1573$1589;($1573$1589=ph$1577);var bridge$1575$1594;(bridge$1575$1594=$1573$1589);if(((typeof(bridge$1575$1594)==="string")||(typeof(bridge$1575$1594)==="number"))){return obj$1570[msg$1578];}else{var other$1606;(other$1606=$1573$1589);return obj$1570["::send"](msg$1578);}}));(Array[":::project"]=(function($1612$1615){var ph$1620;var value$1621;var t0$1623;(t0$1623=$1612$1615);(value$1621=t0$1623);(ph$1620=t0$1623);var $1617$1632;($1617$1632=ph$1620);if($1910(Array)($1617$1632)){return [true,value$1621];}else{$1617$1632;return [true,[value$1621]];}}));(__array_methods$1556=$1929((function(){var accum$1653;(accum$1653=({}));(accum$1653["::check"]=(function(value$1658){if((value$1658 instanceof Array)){var i$1664;(i$1664=0);$1661:for(;(i$1664<this.length);(i$1664++)){if(($1946(this,i$1664)!==$1946(value$1658,i$1664))){return false;}}return true;}else{return false;}}));return accum$1653;})(),$1929((function(){var accum$1673;(accum$1673=({}));(accum$1673["::clone"]=(function(){return $1929(this.slice(0),this);}));return accum$1673;})(),$1929((function(){var accum$1680;(accum$1680=({}));(accum$1680[":::project"]=(function(value$1685){if((value$1685 instanceof Array)){var i$1691;(i$1691=0);$1688:for(;(i$1691<this.length);(i$1691++)){if(($1946(this,i$1691)!==$1946(value$1685,i$1691))){return [true,this.concat([value$1685])];}}return [true,value$1685];}else{return [true,this.concat([value$1685])];}}));return accum$1680;})(),(function(){var accum$1700;(accum$1700=({}));(accum$1700["::serialize_ast"]=(function(){return ["array"].concat(this.map($1947));}));return accum$1700;})()))));var temp$1710;(temp$1710=$1986(__array_methods$1556));var $length$1716;($length$1716=temp$1710.length);var $index$1722;($index$1722=0);$1558:for(;($index$1722<$length$1716);($index$1722++)){var m$1731;(m$1731=temp$1710[$index$1722]);var t0$1736;var t1$1737;var k$1741;var v$1742;(t0$1736=m$1731);if(((t0$1736 instanceof Array)&&(((t1$1737=t0$1736.length)),(t1$1737===2)))){(k$1741=t0$1736[0]);(v$1742=t0$1736[1]);if((!$1946(Array.prototype,k$1741))){Object.defineProperty(Array.prototype,k$1741,({"enumerable":false,"value":v$1742}));}}else{$2003(m$1731);}}(__re_methods$1557=$1929((function(){var accum$1762;(accum$1762=({}));(accum$1762["::check"]=(function($1766$1769){var ph$1774;(ph$1774=$1766$1769);var $1771$1780;($1771$1780=ph$1774);var value$1788;if((typeof($1771$1780)==="string")){(value$1788=$1771$1780);if(value$1788.match(this)){return true;}else{return false;}}else{var other$1793;(other$1793=$1771$1780);return false;}}));return accum$1762;})(),(function(){var accum$1796;(accum$1796=({}));(accum$1796[":::project"]=(function($1800$1803){var ph$1808;(ph$1808=$1800$1803);var $1805$1814;($1805$1814=ph$1808);var value$1822;if((typeof($1805$1814)==="string")){(value$1822=$1805$1814);var $1825$1830;($1825$1830=value$1822.match(this));var m$1838;if(($1825$1830===null)){(m$1838=$1825$1830);return [false,null];}else{var m$1843;(m$1843=$1825$1830);return [true,m$1843];}}else{var other$1847;(other$1847=$1805$1814);return [false,null];}}));return accum$1796;})()));var temp$1853;(temp$1853=$1986(__re_methods$1557));var $length$1859;($length$1859=temp$1853.length);var $index$1865;($index$1865=0);$1561:for(;($index$1865<$length$1859);($index$1865++)){var m$1874;(m$1874=temp$1853[$index$1865]);var t0$1879;var t1$1880;var k$1884;var v$1885;(t0$1879=m$1874);if(((t0$1879 instanceof Array)&&(((t1$1880=t0$1879.length)),(t1$1880===2)))){(k$1884=t0$1879[0]);(v$1885=t0$1879[1]);if((!$1946(RegExp.prototype,k$1884))){Object.defineProperty(RegExp.prototype,k$1884,({"enumerable":false,"value":v$1885}));}}else{$2003(m$1874);}}if((!Function.prototype["::send"])){Object.defineProperty(Function.prototype,"::send",$1929(({"enumerable":false}),(function(){var accum$1903;(accum$1903=({}));(accum$1903["value"]=(function(args$1908){return this.apply(this,args$1908);}));return accum$1903;})()));}
var $5388=(function($5390$5393,key$5394){var ph$5402;(ph$5402=$5390$5393);var $5396$5408;($5396$5408=ph$5402);var bridge$5398$5413;(bridge$5398$5413=$5396$5408);if(((bridge$5398$5413===null)||(bridge$5398$5413===(void 0)))){return false;}else{var x$5425;if((typeof($5396$5408)==="string")){(x$5425=$5396$5408);return (key$5394 in String.prototype);}else{var x$5430;if((typeof($5396$5408)==="number")){(x$5430=$5396$5408);return (key$5394 in Number.prototype);}else{var x$5435;(x$5435=$5396$5408);return (key$5394 in x$5435);}}}});
var $5437=(function(type$5440){return (function(value$5444){var f$5448;(f$5448=type$5440[":::project"]);if((f$5448===(void 0))){(f$5448=type$5440["::project"]);if((f$5448===(void 0))){return [true,type$5440(value$5444)];}else{var rval$5461;(rval$5461=false);try{(rval$5461=[true,f$5448(value$5444)]);}catch(excv$5472){var e$5478;(e$5478=excv$5472);(rval$5461=[false,null]);}return rval$5461;}}else{return f$5448.call(type$5440,value$5444);}});});
var $5484=(function(pairs$5487){var rval$5491;(rval$5491=({}));var temp$5501;(temp$5501=pairs$5487);var $length$5507;($length$5507=temp$5501.length);var $index$5513;($index$5513=0);$5492:for(;($index$5513<$length$5507);($index$5513++)){var m$5522;(m$5522=temp$5501[$index$5513]);var t0$5527;var t1$5528;var k$5532;var v$5533;(t0$5527=m$5522);if(((t0$5527 instanceof Array)&&(((t1$5528=t0$5527.length)),(t1$5528===2)))){(k$5532=t0$5527[0]);(v$5533=t0$5527[1]);(rval$5491[k$5532]=v$5533);}else{$2003(m$5522);}}return rval$5491;});var accum$2571;var accum$2575;var accum$2999;var accum$3003;var accum$5198;var accum$5202;var $2283$2324;var __lt____gt__$2325;var $2284$2326;var __lt____lt____colon__$2327;var util$2328;var classify$2329;var neighbours$2330;var GenSym$2331;var gensym$2332;var $2286$2333;var PatternParser$2334;var PatternProcessor$2335;var Scope$2336;var Env$2337;var track_location$2338;var Expander$2339;var mac1$2340;var __chk_ncache$2341;var __chk_scache$2342;var checker_db$2343;($2283$2324=require("./pp"));(__lt____gt__$2325=$2283$2324["<>"]);($2284$2326=require("./location"));(__lt____lt____colon__$2327=$2284$2326["<<:"]);(util$2328=require("./util"));(classify$2329=util$2328.classify);(neighbours$2330=util$2328.neighbours);(GenSym$2331=util$2328.GenSym);(gensym$2332=util$2328.gensym);($2286$2333=require("./pattern"));(PatternParser$2334=$2286$2333.PatternParser);(PatternProcessor$2335=$2286$2333.PatternProcessor);(Scope$2336=(function(){var t0$2400;var $2391$2395;var it$0$2386;(it$0$2386=(function(){if((!$1910(Scope$2336)(this))){return Object.create(Scope$2336.prototype);}else{return this;}})());($2391$2395=arguments);(t0$2400=$2391$2395.length);if(((t0$2400>=0)&&(t0$2400<=3))){(it$0$2386["parent"]=(function(){if((0>=t0$2400)){return null;}else{return $2391$2395[0];}})());(it$0$2386["name"]=(function(){if((1>=t0$2400)){return gensym$2332("scope");}else{return $2391$2395[1];}})());(it$0$2386["expander"]=(function(){if((2>=t0$2400)){return it$0$2386.parent.expander;}else{return $2391$2395[2];}})());(it$0$2386["options"]=({}));}else{$2003($2391$2395);}return it$0$2386;}));(Scope$2336.prototype["getopt"]=(function(opt$2421){var otherwise$2458;var $2438$2447;var $2434$2441;var it$0$2425;var self$2426;(it$0$2425=this);(self$2426=this);($2434$2441=null);$2434$2441;if(Object.prototype.hasOwnProperty.call(it$0$2425.options,opt$2421)){return $1946(it$0$2425.options,opt$2421);}else{if((it$0$2425.parent===null)){return (void 0);}else{(otherwise$2458=$2434$2441);return it$0$2425.parent.getopt(opt$2421);}}}));(Scope$2336.prototype["setopt"]=(function(opt$2464,value$2465){var it$0$2469;var self$2470;(it$0$2469=this);(self$2470=this);(it$0$2469.options[opt$2464]=value$2465);}));(Scope$2336.prototype["gensym"]=(function(){var it$0$2489;var self$2490;(it$0$2489=this);(self$2490=this);return it$0$2489.expander.gensym();}));(Scope$2336.prototype["step"]=(function(context$2502,expr$2503){var it$0$2507;var self$2508;(it$0$2507=this);(self$2508=this);return it$0$2507.expander.step(context$2502,it$0$2507,expr$2503);}));(Scope$2336.prototype["step_all"]=(function(context$2520,exprs$2521){var it$0$2525;var self$2526;(it$0$2525=this);(self$2526=this);return it$0$2525.expander.step_all(context$2520,it$0$2525,exprs$2521);}));(Scope$2336.prototype["expand"]=(function(context$2538,expr$2539){var it$0$2543;var self$2544;(it$0$2543=this);(self$2544=this);return it$0$2543.expander.expand(context$2538,it$0$2543,expr$2539);}));(Scope$2336.prototype["toString"]=(function(){var it$0$2559;var self$2560;(it$0$2559=this);(self$2560=this);return (("Scope{"+it$0$2559.name)+"}");}));$1929(Scope$2336,$1929(((accum$2571=({})),((accum$2571["::name"]="Scope"),accum$2571)),((accum$2575=({})),((accum$2575["::egclass"]=true),accum$2575))));Scope$2336;(Env$2337=(function(){var it$0$2584;(it$0$2584=(function(){if((!$1910(Env$2337)(this))){return Object.create(Env$2337.prototype);}else{return this;}})());(it$0$2584["scopes"]=({}));return it$0$2584;}));(Env$2337.prototype["list_bindings"]=(function(origin$2599){var values$2615;var scope$2616;var it$0$2603;var self$2604;(it$0$2603=this);(self$2604=this);(values$2615=({}));(scope$2616=origin$2599);$2623:while(scope$2616){$1929(values$2615,$1946(it$0$2603.scopes,scope$2616.name));(scope$2616=scope$2616.parent);}return values$2615;}));(Env$2337.prototype["resolve"]=(function(scope$2635,name$2636){var scope_data$2651;var it$0$2640;var self$2641;(it$0$2640=this);(self$2641=this);if((scope$2635===null)){return (void 0);}(scope_data$2651=$1946(it$0$2640.scopes,scope$2635.name));if((scope_data$2651&&Object.prototype.hasOwnProperty.call(scope_data$2651,name$2636))){return $1946(scope_data$2651,name$2636);}else{return it$0$2640.resolve(scope$2635.parent,name$2636);}}));(Env$2337.prototype["bind"]=(function(scope$2660,name$2661,value$2662){var it$0$2666;var self$2667;(it$0$2666=this);(self$2667=this);if((!$1946(it$0$2666.scopes,scope$2660.name))){(it$0$2666.scopes[scope$2660.name]=({}));}($1946(it$0$2666.scopes,scope$2660.name)[name$2661]=value$2662);}));(Env$2337.prototype["mark"]=(function(expr$2689){var x$2756;var x$2762;var bridge$2708$2748;var x$2768;var bridge$2707$2741;var x$2774;var bridge$2706$2734;var x$2780;var $index$2815;var $length$2809;var temp$2803;var other$2836;var type$2787;var args$2788;var e$2723;var bridge$2705$2718;var t0$2719;var $2702$2713;var it$0$2693;var self$2694;(it$0$2693=this);(self$2694=this);($2702$2713=expr$2689);if($5388($2702$2713,"env")){(e$2723=$2702$2713.env);return expr$2689;}else{(bridge$2705$2718=$2702$2713);if(((((bridge$2706$2734=bridge$2705$2718)),((((bridge$2707$2741=bridge$2706$2734)),((((bridge$2708$2748=bridge$2707$2741)),((((x$2756=bridge$2708$2748)),((x$2756 instanceof Array)&&(x$2756[0]==="symbol")))||(((x$2762=bridge$2708$2748)),((x$2762 instanceof Array)&&(x$2762[0]==="value")))))||(((x$2768=bridge$2707$2741)),((x$2768 instanceof Array)&&(x$2768[0]==="variable")))))||(((x$2774=bridge$2706$2734)),((x$2774 instanceof Array)&&(x$2774[0]==="macro")))))||(((x$2780=bridge$2705$2718)),((x$2780 instanceof Array)&&(x$2780[0]==="void"))))){return $1929(expr$2689,({"env":it$0$2693}));}else{if((($2702$2713 instanceof Array)&&(((t0$2719=$2702$2713.length)),(t0$2719>=1)))){(type$2787=$2702$2713[0]);(args$2788=Array.prototype.slice.call($2702$2713,1));(temp$2803=args$2788);($length$2809=temp$2803.length);($index$2815=0);$2797:for(;($index$2815<$length$2809);($index$2815++)){var arg$2832;var m$2824;(m$2824=temp$2803[$index$2815]);(arg$2832=m$2824);it$0$2693.mark(arg$2832);}return $1929(expr$2689,({"env":it$0$2693}));}else{(other$2836=$2702$2713);return $1929(expr$2689,({"env":it$0$2693}));}}}}));(Env$2337.prototype["fork"]=(function(){var $index$2878;var $length$2872;var temp$2866;var e$2856;var it$0$2845;var self$2846;(it$0$2845=this);(self$2846=this);(e$2856=Env$2337());(temp$2866=$1986(it$0$2845.scopes));($length$2872=temp$2866.length);($index$2878=0);$2857:for(;($index$2878<$length$2872);($index$2878++)){var $index$2933;var $length$2927;var temp$2921;var acc$2915;var scope$2897;var bindings$2898;var t0$2892;var t1$2893;var m$2887;(m$2887=temp$2866[$index$2878]);(t0$2892=m$2887);if(((t0$2892 instanceof Array)&&(((t1$2893=t0$2892.length)),(t1$2893===2)))){(scope$2897=t0$2892[0]);(bindings$2898=t0$2892[1]);(acc$2915=[]);(temp$2921=$1986(bindings$2898));($length$2927=temp$2921.length);($index$2933=0);$2910:for(;($index$2933<$length$2927);($index$2933++)){var k$2952;var v$2953;var t0$2947;var t1$2948;var m$2942;(m$2942=temp$2921[$index$2933]);(t0$2947=m$2942);if(((t0$2947 instanceof Array)&&(((t1$2948=t0$2947.length)),(t1$2948===2)))){(k$2952=t0$2947[0]);(v$2953=t0$2947[1]);acc$2915.push(((function(){if((!$1946(e$2856.scopes,scope$2897))){(e$2856.scopes[scope$2897]=({}));}})(),(($1946(e$2856.scopes,scope$2897)[k$2952]=v$2953))));}else{$2003(m$2942,"/home/olivier/git/earl-grey/src/expand.eg",2279,2426);}}acc$2915;}else{$2003(m$2887,"/home/olivier/git/earl-grey/src/expand.eg",2229,2426);}}return e$2856;}));(Env$2337.prototype["toString"]=(function(){var it$0$2987;var self$2988;(it$0$2987=this);(self$2988=this);return "Env{...}";}));$1929(Env$2337,$1929(((accum$2999=({})),((accum$2999["::name"]="Env"),accum$2999)),((accum$3003=({})),((accum$3003["::egclass"]=true),accum$3003))));Env$2337;(track_location$2338=(function(f$3010){var f2$3014;(f2$3014=(function(context$3019,scope$3020,expr$3021){var rval$3035;var other$3081;var v$3071;var t0$3067;var $3025$3062;var rval$3028;(rval$3028=(((rval$3035=false)),((function(){try{(rval$3035=f$3010(context$3019,scope$3020,expr$3021));}catch(excv$3046){var e$3052;(e$3052=excv$3046);(rval$3035=(__lt____lt____colon__$2327(e$3052,expr$3021),function(){throw e$3052;}()));}})(),rval$3035)));($3025$3062=rval$3028);if((($3025$3062 instanceof Array)&&(((t0$3067=$3025$3062.length)),((t0$3067===2)&&($3025$3062[0]==="bounce"))))){(v$3071=$3025$3062[1]);return f2$3014(context$3019,scope$3020,__lt____lt____colon__$2327(v$3071,expr$3021));}else{(other$3081=$3025$3062);return __lt____lt____colon__$2327(other$3081,expr$3021);}}));return f2$3014;}));(Expander$2339=(function(env_factory$3089,generic_nodes$3090){var it$0$3093;(it$0$3093=(function(){if((!$1910(Expander$2339)(this))){return Object.create(Expander$2339.prototype);}else{return this;}})());(it$0$3093["gensym"]=gensym$2332);(it$0$3093["mkenv"]=env_factory$3089);(it$0$3093["generic_nodes"]=generic_nodes$3090);return it$0$3093;}));(Expander$2339.prototype["run_macro"]=(function(m$3117,context$3118,scope$3119,form$3120,arg$3121){var rval$3144;var rval$3136;var it$0$3125;var self$3126;(it$0$3125=this);(self$3126=this);(rval$3136=(((rval$3144=false)),((function(){try{(rval$3144=m$3117(context$3118,scope$3119,form$3120,arg$3121));}catch(excv$3155){var msg$3212;var msg$3334;var find$3223;var err$3224;var other$3218;var $3195$3200;var e$3192;var e$3342;var value$3165;var t0$3158;var t1$3159;var t2$3160;var t3$3161;(t0$3158=excv$3155);if(($1910($2022(["match"]))(t0$3158)&&($5388(t0$3158,"args")&&(((t1$3159=t0$3158.args)),((t1$3159 instanceof Array)&&(((t2$3160=t1$3159.length)),((t2$3160===1)&&(((t3$3161=t1$3159[0])),$5388(t3$3161,"value"))))))))){(value$3165=t3$3161.value);(rval$3144=(((e$3192=((($3195$3200=value$3165)),(function(){if(($3195$3200===context$3118)){(msg$3212="The macro cannot be found in this context.");return $2022(["syntax","context"]).create(msg$3212,({"context":context$3118,"form":form$3120}));}else{(other$3218=$3195$3200);(find$3223=(function($3228$3231){var t0$3240;var msg$3262;var $index$3296;var $length$3290;var temp$3284;var other$3326;var type$3268;var xs$3269;var t0$3254;var $3233$3249;var ph$3237;var arg$3238;(t0$3240=$3228$3231);(arg$3238=t0$3240);(ph$3237=t0$3240);($3233$3249=ph$3237);if(($3233$3249===value$3165)){(msg$3262="The macro expected something different.");return $2022(["syntax","argument"]).create(msg$3262,({"context":context$3118,"argument":arg$3238,"form":form$3120}));}else{if((($3233$3249 instanceof Array)&&(((t0$3254=$3233$3249.length)),(t0$3254>=1)))){(type$3268=$3233$3249[0]);(xs$3269=Array.prototype.slice.call($3233$3249,1));(temp$3284=xs$3269);($length$3290=temp$3284.length);($index$3296=0);$3278:for(;($index$3296<$length$3290);($index$3296++)){var x$3314;var t0$3310;var m$3305;(m$3305=temp$3284[$index$3296]);(t0$3310=$5437(find$3223)(m$3305));if(t0$3310[0]){(x$3314=t0$3310[1]);if(x$3314){return x$3314;}}else{$2003(m$3305,"/home/olivier/git/earl-grey/src/expand.eg",3685,3770);}}return false;}else{(other$3326=$3233$3249);return false;}}}));(err$3224=find$3223(arg$3121));if(err$3224){return err$3224;}else{(msg$3334="The macro expected something different (could not locate error in the source).");return $2022(["syntax","failure"]).create(msg$3334,({"form":form$3120,"value":value$3165}));}}})()))),function(){throw e$3192;}()));}else{(e$3342=excv$3155);(rval$3144=function(){throw e$3342;}());}}})(),rval$3144)));return it$0$3125.mkenv().mark(rval$3136);}));(Expander$2339.prototype["step"]=(function(context$3353,scope$3354,expr$3355){var helper$3370;var it$0$3359;var self$3360;(it$0$3359=this);(self$3360=this);(helper$3370=track_location$2338((function(context$3377,scope$3378,$3374$3379){var t0$3393;var other$3448;var env$3443;var $3430$3435;var other$3493;var t0$3480;var $3470$3475;var other$3497;var m$3462;var t0$3458;var $3424$3453;var env$3427;var other$3527;var t0$3514;var $3504$3509;var other$3559;var m$3549;var t0$3545;var $3535$3540;var other$3568;var x$3563;var f$3531;var arg$3532;var m$3501;var s$3414;var $3387$3409;var $3388$3410;var $3389$3411;var t0$3407;var $3381$3402;var ph$3390;var expr$3391;(t0$3393=$3374$3379);(expr$3391=t0$3393);(ph$3390=t0$3393);($3381$3402=ph$3390);if((($3387$3409=($3381$3402 instanceof Array))&&(((t0$3407=$3381$3402.length)),(($3389$3411=(t0$3407===2))&&($3381$3402[0]==="symbol"))))){(s$3414=$3381$3402[1]);(env$3427=((($3430$3435=expr$3391)),(function(){if($5388($3430$3435,"env")){(env$3443=$3430$3435.env);return expr$3391.env;}else{(other$3448=$3430$3435);throw $2022(["syntax","no_env"]).create("No environment was found to resolve",({"symbol":expr$3391}));}})()));($3424$3453=env$3427.resolve(scope$3378,s$3414));if((($3424$3453 instanceof Array)&&(((t0$3458=$3424$3453.length)),((t0$3458===2)&&($3424$3453[0]==="macro"))))){(m$3462=$3424$3453[1]);($3470$3475=context$3377);if((($3470$3475 instanceof Array)&&(((t0$3480=$3470$3475.length)),((t0$3480===2)&&(($3470$3475[0]==="expr")&&($3470$3475[1]==="head")))))){return ["macro",m$3462];}else{(other$3493=$3470$3475);return ["bounce",it$0$3359.run_macro(m$3462,context$3377,scope$3378,expr$3391,__lt____lt____colon__$2327(["void"],expr$3391))];}}else{(other$3497=$3424$3453);return expr$3391;}}else{if(($3389$3411&&($3381$3402[0]==="macro"))){(m$3501=$3381$3402[1]);($3504$3509=context$3377);if((($3504$3509 instanceof Array)&&(((t0$3514=$3504$3509.length)),((t0$3514===2)&&(($3504$3509[0]==="expr")&&($3504$3509[1]==="head")))))){return expr$3391;}else{(other$3527=$3504$3509);return ["bounce",it$0$3359.run_macro(m$3501,context$3377,scope$3378,expr$3391,__lt____lt____colon__$2327(["void"],expr$3391))];}}else{if(($3387$3409&&((t0$3407===3)&&($3381$3402[0]==="send")))){(f$3531=$3381$3402[1]);(arg$3532=$3381$3402[2]);($3535$3540=helper$3370(["expr","head"],scope$3378,f$3531));if((($3535$3540 instanceof Array)&&(((t0$3545=$3535$3540.length)),((t0$3545===2)&&($3535$3540[0]==="macro"))))){(m$3549=$3535$3540[1]);return ["bounce",it$0$3359.run_macro(m$3549,context$3377,scope$3378,expr$3391,arg$3532)];}else{(other$3559=$3535$3540);return expr$3391;}}else{if(($3387$3409&&((t0$3407===2)&&($3381$3402[0]==="nostep")))){(x$3563=$3381$3402[1]);return x$3563;}else{(other$3568=$3381$3402);return expr$3391;}}}}})));return helper$3370(context$3353,scope$3354,expr$3355);}));(Expander$2339.prototype["step_all"]=(function(context$3577,scope$3578,$3574$3579){var t0$3594;var t1$3595;var pre$3612;var bulk$3613;var post$3614;var stmts$3592;var it$0$3583;var self$3584;(it$0$3583=this);(self$3584=this);(t0$3594=$3574$3579);if(((t0$3594 instanceof Array)&&(((t1$3595=t0$3594.length)),(t1$3595>=0)))){(stmts$3592=Array.prototype.slice.call(t0$3594,0));}else{$2003($3574$3579);}(pre$3612=[]);(bulk$3613=[]);(post$3614=[]);$3624:while(stmts$3592.length){var $index$3715;var $length$3709;var temp$3703;var acc$3697;var e$3686;var x$3738;var m$3680;var stmt$3675;var stmt$3670;var prepend$3656;var $3635$3651;var $3636$3652;var $3637$3653;var t0$3649;var $3629$3644;var current$3638;(current$3638=stmts$3592.shift());($3629$3644=it$0$3583.step(context$3577,scope$3578,current$3638));if((($3635$3651=($3629$3644 instanceof Array))&&(((t0$3649=$3629$3644.length)),((t0$3649>=1)&&($3629$3644[0]==="splice"))))){(prepend$3656=Array.prototype.slice.call($3629$3644,1));(stmts$3592=prepend$3656.concat(stmts$3592));}else{if(($3635$3651&&(($3637$3653=(t0$3649===2))&&($3629$3644[0]==="float")))){(stmt$3670=$3629$3644[1]);(pre$3612=pre$3612.concat(it$0$3583.step_all(context$3577,scope$3578,[stmt$3670])));}else{if(($3637$3653&&($3629$3644[0]==="sink"))){(stmt$3675=$3629$3644[1]);(post$3614=post$3614.concat(it$0$3583.step_all(context$3577,scope$3578,[stmt$3675])));}else{if(($3637$3653&&($3629$3644[0]==="restmacro"))){(m$3680=$3629$3644[1]);(e$3686=it$0$3583.mkenv());(stmts$3592=(((acc$3697=[])),(((temp$3703=m$3680(stmts$3592))),((($length$3709=temp$3703.length)),((($index$3715=0)),(function(){$3692:for(;($index$3715<$length$3709);($index$3715++)){var stmt$3732;var m$3724;(m$3724=temp$3703[$index$3715]);(stmt$3732=m$3724);acc$3697.push(e$3686.mark(stmt$3732));}})()))),acc$3697));}else{(x$3738=$3629$3644);bulk$3613.push(x$3738);}}}}}return pre$3612.concat(bulk$3613).concat(post$3614);}));(Expander$2339.prototype["expand"]=(function(context$3744,scope$3745,expr$3746){var helper$3761;var it$0$3750;var self$3751;(it$0$3750=this);(self$3751=this);(helper$3761=track_location$2338((function(context$3766,scope$3767,expr$3768){var t0$3833;var other$3855;var $3828$3843;var env$3831;var $index$3908;var $length$3902;var temp$3896;var acc$3890;var newargs$3882;var $index$3962;var $length$3956;var temp$3950;var acc$3944;var newargs$3936;var t0$4026;var newscope$4020;var env$4021;var $index$4110;var $length$4104;var temp$4098;var acc$4092;var $index$4322;var $length$4316;var temp$4310;var acc$4304;var t0$4071;var newscope$4055;var stepscope$4056;var changes$4057;var newargs$4058;var vars$4059;var exp$4060;var $index$4745;var $length$4739;var temp$4733;var other$4849;var t0$4827;var $4816$4822;var is_obj$4624;var obj$4625;var arr$4626;var arr_parts$4627;var obj_parts$4628;var new_arr_part$4629;var new_obj_part$4630;var r$4631;var x$4887;var msg$4894;var otherwise$4910;var m$4900;var t0$4880;var $4865$4875;var t$4869;var $index$4954;var $length$4948;var temp$4942;var acc$4936;var newscope$4924;var s$5033;var newscope$5046;var name$5024;var t0$5020;var $index$5090;var $length$5084;var temp$5078;var acc$5072;var $index$5146;var $length$5140;var temp$5134;var acc$5128;var tokens$5119;var msg$5120;var other$5192;var c$5187;var ops$5112;var args$5113;var type$5061;var args$5062;var tag$5050;var body$5051;var x$5015;var $3788$5016;var bindings$4918;var body$4919;var target$4859;var value$4860;var args$4612;var args$4046;var args$4041;var args$4036;var variable$4000;var s$4001;var value$4002;var body$4003;var args$3931;var args$3877;var f$3871;var arg$3872;var s$3818;var $3796$3813;var $3797$3814;var $3798$3815;var t0$3809;var t1$3810;var t2$3811;var $3772$3804;(expr$3768=it$0$3750.step(context$3766,scope$3767,expr$3768));($3772$3804=expr$3768);if((($3796$3813=($3772$3804 instanceof Array))&&(((t0$3809=$3772$3804.length)),(($3798$3815=(t0$3809===2))&&($3772$3804[0]==="symbol"))))){(s$3818=$3772$3804[1]);(t0$3833=expr$3768);if($5388(t0$3833,"env")){(env$3831=t0$3833.env);}else{$2003(expr$3768,"/home/olivier/git/earl-grey/src/expand.eg",8047,8051);}($3828$3843=env$3831.resolve(scope$3767,s$3818));if(($3828$3843===(void 0))){throw $2022(["syntax","undeclared"]).create(("Undeclared variable: "+s$3818),({"node":expr$3768}));}else{(other$3855=$3828$3843);return ["bounce",other$3855];}}else{if(($3798$3815&&($3772$3804[0]==="value"))){$3772$3804[1];return expr$3768;}else{if(($3798$3815&&($3772$3804[0]==="variable"))){$3772$3804[1];return expr$3768;}else{if(($3796$3813&&((t0$3809===1)&&($3772$3804[0]==="void")))){return expr$3768;}else{if(($3796$3813&&((t0$3809===3)&&($3772$3804[0]==="send")))){(f$3871=$3772$3804[1]);(arg$3872=$3772$3804[2]);return ["send",helper$3761(["expr","head"],scope$3767,f$3871),helper$3761(["expr","tail"],scope$3767,arg$3872)];}else{if(($3796$3813&&(($3798$3815=(t0$3809>=1))&&($3772$3804[0]==="array")))){(args$3877=Array.prototype.slice.call($3772$3804,1));(newargs$3882=(((acc$3890=[])),(((temp$3896=it$0$3750.step_all(["expr","array"],scope$3767,args$3877))),((($length$3902=temp$3896.length)),((($index$3908=0)),(function(){$3885:for(;($index$3908<$length$3902);($index$3908++)){var arg$3925;var m$3917;(m$3917=temp$3896[$index$3908]);(arg$3925=m$3917);acc$3890.push(helper$3761(["expr","expr"],scope$3767,arg$3925));}})()))),acc$3890));return ["array"].concat(newargs$3882);}else{if(($3798$3815&&($3772$3804[0]==="object"))){(args$3931=Array.prototype.slice.call($3772$3804,1));(newargs$3936=(((acc$3944=[])),(((temp$3950=it$0$3750.step_all(["expr","object"],scope$3767,args$3931))),((($length$3956=temp$3950.length)),((($index$3962=0)),(function(){$3939:for(;($index$3962<$length$3956);($index$3962++)){var k$3981;var v$3982;var t0$3976;var t1$3977;var m$3971;(m$3971=temp$3950[$index$3962]);(t0$3976=m$3971);if(((t0$3976 instanceof Array)&&(((t1$3977=t0$3976.length)),((t1$3977===3)&&(t0$3976[0]==="array"))))){(k$3981=t0$3976[1]);(v$3982=t0$3976[2]);acc$3944.push(["array",helper$3761(["expr","expr"],scope$3767,k$3981),helper$3761(["expr","expr"],scope$3767,v$3982)]);}else{$2003(m$3971,"/home/olivier/git/earl-grey/src/expand.eg",8890,9079);}}})()))),acc$3944));return ["object"].concat(newargs$3936);}else{if(($3796$3813&&((t0$3809===4)&&(($3772$3804[0]==="bind")&&(((t1$3810=$3772$3804[1])),((variable$4000=t1$3810),((t1$3810 instanceof Array)&&(((t2$3811=t1$3810.length)),((t2$3811===2)&&(t1$3810[0]==="symbol")))))))))){(s$4001=t1$3810[1]);(value$4002=$3772$3804[2]);(body$4003=$3772$3804[3]);(newscope$4020=Scope$2336(scope$3767));(t0$4026=variable$4000);if($5388(t0$4026,"env")){(env$4021=t0$4026.env);}else{$2003(variable$4000,"/home/olivier/git/earl-grey/src/expand.eg",9222,9230);}env$4021.bind(newscope$4020,s$4001,value$4002);return helper$3761(context$3766,newscope$4020,body$4003);}else{if(($3796$3813&&(($3798$3815=(t0$3809>=1))&&($3772$3804[0]==="splice")))){(args$4036=Array.prototype.slice.call($3772$3804,1));return ["bounce",$1929(["multi"].concat(args$4036),({"override_scope":true}))];}else{if(($3798$3815&&($3772$3804[0]==="interactive"))){(args$4041=Array.prototype.slice.call($3772$3804,1));return ["bounce",$1929(["multi"].concat(args$4041),({"override_scope":true,"all_mutable":true}))];}else{if(($3798$3815&&($3772$3804[0]==="multi"))){(args$4046=Array.prototype.slice.call($3772$3804,1));(newscope$4055=(function(){if(expr$3768.override_scope){return scope$3767;}else{return Scope$2336(scope$3767);}})());(stepscope$4056=(function(){if(expr$3768.nonrecursive){return scope$3767;}else{return newscope$4055;}})());(changes$4057=false);(t0$4071=classify$2329("newargs","vars",(((acc$4092=[])),(((temp$4098=it$0$3750.step_all(["expr","multi"],stepscope$4056,args$4046))),((($length$4104=temp$4098.length)),((($index$4110=0)),(function(){$4076:for(;($index$4110<$length$4104);($index$4110++)){var t0$4176;var env$4174;var t0$4210;var v$4221;var env$4208;var t0$4268;var env$4266;var other$4281;var s$4248;var variable$4249;var v$4230;var value$4231;var variable$4189;var s$4190;var value$4191;var variable$4154;var s$4155;var value$4156;var opt$4137;var value$4138;var $4084$4129;var $4085$4130;var $4086$4131;var $4087$4132;var $4088$4133;var $4089$4134;var t0$4124;var t1$4125;var t2$4126;var t3$4127;var m$4119;(m$4119=temp$4098[$index$4110]);(t0$4124=m$4119);if((($4085$4130=(t0$4124 instanceof Array))&&(((t1$4125=t0$4124.length)),(($4087$4132=(t1$4125===3))&&(t0$4124[0]==="option"))))){(opt$4137=t0$4124[1]);(value$4138=t0$4124[2]);acc$4092.push((newscope$4055.setopt(opt$4137,value$4138),["ignore"]));}else{if(($4087$4132&&((t0$4124[0]==="declare_raw")&&(((t2$4126=t0$4124[1])),((variable$4154=t2$4126),((t2$4126 instanceof Array)&&(((t3$4127=t2$4126.length)),((t3$4127===2)&&(t2$4126[0]==="symbol"))))))))){(s$4155=t2$4126[1]);(value$4156=t0$4124[2]);acc$4092.push(((((t0$4176=variable$4154)),(function(){if($5388(t0$4176,"env")){(env$4174=t0$4176.env);}else{return $2003(variable$4154,"/home/olivier/git/earl-grey/src/expand.eg",10176,10184);}})()),env$4174.bind(newscope$4055,s$4155,value$4156),((changes$4057=true)),["ignore"]));}else{if(($4085$4130&&(($4087$4132=((t1$4125>=2)&&(t1$4125<=3)))&&(($4088$4133=(t0$4124[0]==="declare"))&&(((t2$4126=t0$4124[1])),((variable$4189=t2$4126),((t2$4126 instanceof Array)&&(((t3$4127=t2$4126.length)),((t3$4127===2)&&(t2$4126[0]==="symbol")))))))))){(s$4190=t2$4126[1]);(value$4191=(function(){if((2>=t1$4125)){return null;}else{return t0$4124[2];}})());acc$4092.push(((((t0$4210=variable$4189)),(function(){if($5388(t0$4210,"env")){(env$4208=t0$4210.env);}else{return $2003(variable$4189,"/home/olivier/git/earl-grey/src/expand.eg",10424,10432);}})()),(function(){if((variable$4189.use_previous&&env$4208.resolve(newscope$4055,s$4190))){return ["splice"];}else{(v$4221=__lt____lt____colon__$2327(["variable",it$0$3750.gensym(s$4190)],variable$4189));$1929(v$4221,({"mutable":(expr$3768.all_mutable||variable$4189.mutable)}));env$4208.bind(newscope$4055,s$4190,v$4221);(changes$4057=true);if(value$4191){return ["splice",["newargs",["assign",v$4221,value$4191]],["vars",v$4221]];}else{return ["vars",v$4221];}}})()));}else{if(($4088$4133&&((v$4230=t2$4126),((t2$4126 instanceof Array)&&(((t3$4127=t2$4126.length)),((t3$4127===2)&&(t2$4126[0]==="variable"))))))){t2$4126[1];(value$4231=(function(){if((2>=t1$4125)){return null;}else{return t0$4124[2];}})());acc$4092.push((((changes$4057=true)),(function(){if(value$4231){return ["splice",["newargs",["assign",v$4230,value$4231]],["vars",v$4230]];}else{return ["vars",v$4230];}})()));}else{if(($4085$4130&&((t1$4125===2)&&((t0$4124[0]==="undeclare")&&(((t2$4126=t0$4124[1])),((t2$4126 instanceof Array)&&(((t3$4127=t2$4126.length)),((t3$4127===2)&&(t2$4126[0]==="symbol"))))))))){(s$4248=t2$4126[1]);(variable$4249=t2$4126);acc$4092.push(((((t0$4268=variable$4249)),(function(){if($5388(t0$4268,"env")){(env$4266=t0$4268.env);}else{return $2003(variable$4249,"/home/olivier/git/earl-grey/src/expand.eg",11696,11704);}})()),env$4266.bind(newscope$4055,s$4248,(void 0)),((changes$4057=true)),["ignore"]));}else{(other$4281=m$4119);acc$4092.push(["newargs",other$4281]);}}}}}}})()))),acc$4092)));if(($5388(t0$4071,"newargs")&&((newargs$4058=t0$4071.newargs),$5388(t0$4071,"vars")))){(vars$4059=t0$4071.vars);}else{$2003(classify$2329("newargs","vars",(((acc$4304=[])),(((temp$4310=it$0$3750.step_all(["expr","multi"],stepscope$4056,args$4046))),((($length$4316=temp$4310.length)),((($index$4322=0)),(function(){$4288:for(;($index$4322<$length$4316);($index$4322++)){var t0$4388;var env$4386;var t0$4422;var v$4433;var env$4420;var t0$4480;var env$4478;var other$4493;var s$4460;var variable$4461;var v$4442;var value$4443;var variable$4401;var s$4402;var value$4403;var variable$4366;var s$4367;var value$4368;var opt$4349;var value$4350;var $4296$4341;var $4297$4342;var $4298$4343;var $4299$4344;var $4300$4345;var $4301$4346;var t0$4336;var t1$4337;var t2$4338;var t3$4339;var m$4331;(m$4331=temp$4310[$index$4322]);(t0$4336=m$4331);if((($4297$4342=(t0$4336 instanceof Array))&&(((t1$4337=t0$4336.length)),(($4299$4344=(t1$4337===3))&&(t0$4336[0]==="option"))))){(opt$4349=t0$4336[1]);(value$4350=t0$4336[2]);acc$4304.push((newscope$4055.setopt(opt$4349,value$4350),["ignore"]));}else{if(($4299$4344&&((t0$4336[0]==="declare_raw")&&(((t2$4338=t0$4336[1])),((variable$4366=t2$4338),((t2$4338 instanceof Array)&&(((t3$4339=t2$4338.length)),((t3$4339===2)&&(t2$4338[0]==="symbol"))))))))){(s$4367=t2$4338[1]);(value$4368=t0$4336[2]);acc$4304.push(((((t0$4388=variable$4366)),(function(){if($5388(t0$4388,"env")){(env$4386=t0$4388.env);}else{return $2003(variable$4366,"/home/olivier/git/earl-grey/src/expand.eg",10176,10184);}})()),env$4386.bind(newscope$4055,s$4367,value$4368),((changes$4057=true)),["ignore"]));}else{if(($4297$4342&&(($4299$4344=((t1$4337>=2)&&(t1$4337<=3)))&&(($4300$4345=(t0$4336[0]==="declare"))&&(((t2$4338=t0$4336[1])),((variable$4401=t2$4338),((t2$4338 instanceof Array)&&(((t3$4339=t2$4338.length)),((t3$4339===2)&&(t2$4338[0]==="symbol")))))))))){(s$4402=t2$4338[1]);(value$4403=(function(){if((2>=t1$4337)){return null;}else{return t0$4336[2];}})());acc$4304.push(((((t0$4422=variable$4401)),(function(){if($5388(t0$4422,"env")){(env$4420=t0$4422.env);}else{return $2003(variable$4401,"/home/olivier/git/earl-grey/src/expand.eg",10424,10432);}})()),(function(){if((variable$4401.use_previous&&env$4420.resolve(newscope$4055,s$4402))){return ["splice"];}else{(v$4433=__lt____lt____colon__$2327(["variable",it$0$3750.gensym(s$4402)],variable$4401));$1929(v$4433,({"mutable":(expr$3768.all_mutable||variable$4401.mutable)}));env$4420.bind(newscope$4055,s$4402,v$4433);(changes$4057=true);if(value$4403){return ["splice",["newargs",["assign",v$4433,value$4403]],["vars",v$4433]];}else{return ["vars",v$4433];}}})()));}else{if(($4300$4345&&((v$4442=t2$4338),((t2$4338 instanceof Array)&&(((t3$4339=t2$4338.length)),((t3$4339===2)&&(t2$4338[0]==="variable"))))))){t2$4338[1];(value$4443=(function(){if((2>=t1$4337)){return null;}else{return t0$4336[2];}})());acc$4304.push((((changes$4057=true)),(function(){if(value$4443){return ["splice",["newargs",["assign",v$4442,value$4443]],["vars",v$4442]];}else{return ["vars",v$4442];}})()));}else{if(($4297$4342&&((t1$4337===2)&&((t0$4336[0]==="undeclare")&&(((t2$4338=t0$4336[1])),((t2$4338 instanceof Array)&&(((t3$4339=t2$4338.length)),((t3$4339===2)&&(t2$4338[0]==="symbol"))))))))){(s$4460=t2$4338[1]);(variable$4461=t2$4338);acc$4304.push(((((t0$4480=variable$4461)),(function(){if($5388(t0$4480,"env")){(env$4478=t0$4480.env);}else{return $2003(variable$4461,"/home/olivier/git/earl-grey/src/expand.eg",11696,11704);}})()),env$4478.bind(newscope$4055,s$4460,(void 0)),((changes$4057=true)),["ignore"]));}else{(other$4493=m$4331);acc$4304.push(["newargs",other$4493]);}}}}}}})()))),acc$4304)),"/home/olivier/git/earl-grey/src/expand.eg",9848,11926);}(exp$4060=(function(s$4500){var $index$4533;var $length$4527;var temp$4521;var acc$4515;var $index$4589;var $length$4583;var temp$4577;var acc$4571;var stepped$4504;(stepped$4504=(((acc$4515=[])),(((temp$4521=$2255(newargs$4058))),((($length$4527=temp$4521.length)),((($index$4533=0)),(function(){$4510:for(;($index$4533<$length$4527);($index$4533++)){var i$4552;var arg$4553;var t0$4547;var t1$4548;var m$4542;(m$4542=temp$4521[$index$4533]);(t0$4547=m$4542);if(((t0$4547 instanceof Array)&&(((t1$4548=t0$4547.length)),(t1$4548===2)))){(i$4552=t0$4547[0]);(arg$4553=t0$4547[1]);acc$4515.push(it$0$3750.step(["expr",(function(){if((i$4552===(newargs$4058.length-1))){return "expr";}else{return "ignore";}})()],s$4500,arg$4553));}else{$2003(m$4542,"/home/olivier/git/earl-grey/src/expand.eg",12148,12325);}}})()))),acc$4515));(acc$4571=[]);(temp$4577=stepped$4504);($length$4583=temp$4577.length);($index$4589=0);$4505:for(;($index$4589<$length$4583);($index$4589++)){var arg$4606;var m$4598;(m$4598=temp$4577[$index$4589]);(arg$4606=m$4598);acc$4571.push(helper$3761(["expr","expr"],s$4500,arg$4606));}return acc$4571;}));if(changes$4057){return ["scope",vars$4059,["multi"].concat(exp$4060(newscope$4055))];}else{return ["multi"].concat(exp$4060(scope$3767));}}else{if(($3798$3815&&($3772$3804[0]==="data"))){(args$4612=Array.prototype.slice.call($3772$3804,1));(is_obj$4624=false);(obj$4625=["object"]);(arr$4626=["array"]);(arr_parts$4627=[]);(obj_parts$4628=[]);(new_arr_part$4629=(function(){var other$4686;var t0$4673;var $4663$4668;($4663$4668=arr$4626);if((($4663$4668 instanceof Array)&&(((t0$4673=$4663$4668.length)),((t0$4673===1)&&($4663$4668[0]==="array"))))){return false;}else{(other$4686=$4663$4668);arr_parts$4627.push(arr$4626);(arr$4626=["array"]);}}));(new_obj_part$4630=(function(){var other$4722;var t0$4709;var $4699$4704;($4699$4704=obj$4625);if((($4699$4704 instanceof Array)&&(((t0$4709=$4699$4704.length)),((t0$4709===1)&&($4699$4704[0]==="object"))))){return false;}else{(other$4722=$4699$4704);obj_parts$4628.push(obj$4625);(obj$4625=["object"]);}}));(temp$4733=it$0$3750.step_all(["expr","data"],scope$3767,args$4612));($length$4739=temp$4733.length);($index$4745=0);$4632:for(;($index$4745<$length$4739);($index$4745++)){var other$4812;var expr$4802;var expr$4796;var k$4785;var v$4786;var $4639$4762;var $4640$4763;var $4641$4764;var $4642$4765;var t0$4759;var t1$4760;var m$4754;(m$4754=temp$4733[$index$4745]);(t0$4759=m$4754);if((($4640$4763=(t0$4759 instanceof Array))&&(((t1$4760=t0$4759.length)),((t1$4760===1)&&(t0$4759[0]==="assoc"))))){(is_obj$4624=true);}else{if(($4640$4763&&((t1$4760===3)&&(t0$4759[0]==="assoc")))){(k$4785=t0$4759[1]);(v$4786=t0$4759[2]);(is_obj$4624=true);obj$4625.push(["array",k$4785,v$4786]);}else{if(($4640$4763&&(($4642$4765=(t1$4760===2))&&(t0$4759[0]==="dynsplice")))){(expr$4796=t0$4759[1]);new_arr_part$4629();arr_parts$4627.push(expr$4796);}else{if(($4642$4765&&(t0$4759[0]==="objsplice"))){(expr$4802=t0$4759[1]);(is_obj$4624=true);new_obj_part$4630();obj_parts$4628.push(expr$4802);}else{(other$4812=m$4754);arr$4626.push(other$4812);}}}}}new_arr_part$4629();new_obj_part$4630();(r$4631=((($4816$4822=arr_parts$4627)),(function(){if((($4816$4822 instanceof Array)&&(((t0$4827=$4816$4822.length)),((t0$4827===0)&&is_obj$4624)))){return util$2328.construct(obj_parts$4628,(function(x$4840,rest$4841){return ["send",["symbol","&:"],["data",x$4840,rest$4841]];}),["object"]);}else{$4816$4822;if(is_obj$4624){throw $2022(["syntax","array","object"]).create("Cannot mix array and object notations.");}else{(other$4849=$4816$4822);return util$2328.construct(arr_parts$4627.reverse(),(function(x$4853,rest$4854){return ["send",["send",rest$4854,["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",x$4853]];}),["array"]);}}})()));return helper$3761(context$3766,scope$3767,it$0$3750.mkenv().mark(r$4631));}else{if(($3796$3813&&(($3798$3815=(t0$3809===3))&&($3772$3804[0]==="assign")))){(target$4859=$3772$3804[1]);(value$4860=$3772$3804[2]);(t$4869=helper$3761(["expr","expr"],scope$3767,target$4859));($4865$4875=t$4869);if(((((x$4887=$4865$4875)),((x$4887 instanceof Array)&&(x$4887[0]==="variable")))&&(((!t$4869.mutable)&&t$4869.assigned)&&(t$4869.assigned.group_id!==target$4859.group_id)))){(msg$4894=["Variable was declared as read-only. Declare it as","mutable at the origin with `var` (if you have access","to the declaration) or declare a new variable with","`let` or `var` or remove the original binding with","`delete`"].join(" "));throw $2022(["syntax"]).create(msg$4894,({"variable":target$4859,"loc":t$4869.assigned}));}else{if((($4865$4875 instanceof Array)&&(((t0$4880=$4865$4875.length)),((t0$4880===2)&&($4865$4875[0]==="macro"))))){(m$4900=$4865$4875[1]);["bounce",m$4900(["assign"],scope$3767,expr$3768,value$4860)];}else{(otherwise$4910=$4865$4875);(t$4869["assigned"]=target$4859);}}return ["assign",t$4869,helper$3761(["expr","expr"],scope$3767,value$4860)];}else{if(($3798$3815&&($3772$3804[0]==="lambda"))){(bindings$4918=$3772$3804[1]);(body$4919=$3772$3804[2]);(newscope$4924=Scope$2336(scope$3767));return ["lambda",(((acc$4936=[])),(((temp$4942=bindings$4918)),((($length$4948=temp$4942.length)),((($index$4954=0)),(function(){$4928:for(;($index$4954<$length$4948);($index$4954++)){var v$4991;var x$5002;var other$5010;var v$4998;var b$4974;var env$4975;var $4933$4971;var t0$4968;var t1$4969;var m$4963;(m$4963=temp$4942[$index$4954]);(t0$4968=m$4963);if(((t0$4968 instanceof Array)&&(((t1$4969=t0$4968.length)),((t1$4969===2)&&((t0$4968[0]==="symbol")&&((b$4974=t0$4968[1]),$5388(t0$4968,"env"))))))){(env$4975=t0$4968.env);acc$4936.push((((v$4991=["variable",it$0$3750.gensym(b$4974)])),(env$4975.bind(newscope$4924,b$4974,v$4991),v$4991)));}else{if((((x$5002=t0$4968)),((x$5002 instanceof Array)&&(x$5002[0]==="variable")))){(v$4998=t0$4968);acc$4936.push(v$4998);}else{(other$5010=m$4963);acc$4936.push(function(){throw $2022(["syntax","lambda","binding"]).create("Not a valid binding.",({"node":other$5010}));}());}}}})()))),acc$4936),helper$3761(["expr","expr"],newscope$4924,body$4919)];}else{if(($3798$3815&&($3772$3804[0]==="use"))){($3788$5016=$3772$3804[1]);(x$5015=$3772$3804[2]);(t0$5020=$3788$5016);if((typeof(t0$5020)==="string")){(name$5024=t0$5020);(s$5033=scope$3767);$5037:while(s$5033){if((s$5033.name.slice(0,(name$5024.length+1))===(name$5024+"/"))){break $5037;}else{(s$5033=s$5033.parent);}}if(s$5033){return helper$3761(context$3766,s$5033,x$5015);}else{throw $2022(["syntax","noscope"]).create(("Could not find a scope tagged: "+name$5024));}}else{(newscope$5046=$3788$5016);return helper$3761(context$3766,newscope$5046,x$5015);}}else{if(($3798$3815&&(($3772$3804[0]==="tagscope")&&(((t1$3810=$3772$3804[1])),(typeof(t1$3810)==="string"))))){(tag$5050=t1$3810);(body$5051=$3772$3804[2]);return helper$3761(context$3766,Scope$2336(scope$3767,it$0$3750.gensym((tag$5050+"/"))),body$5051);}else{if(($3796$3813&&((t0$3809>=1)&&((type$5061=$3772$3804[0]),((args$5062=Array.prototype.slice.call($3772$3804,1)),(it$0$3750.generic_nodes.indexOf(type$5061)!==-1)))))){return [type$5061].concat((((acc$5072=[])),(((temp$5078=args$5062)),((($length$5084=temp$5078.length)),((($index$5090=0)),(function(){$5067:for(;($index$5090<$length$5084);($index$5090++)){var arg$5107;var m$5099;(m$5099=temp$5078[$index$5090]);(arg$5107=m$5099);acc$5072.push(helper$3761(["expr","expr"],scope$3767,arg$5107));}})()))),acc$5072));}else{if(($3796$3813&&((t0$3809>=2)&&($3772$3804[0]==="mismix")))){(ops$5112=$3772$3804[1]);(args$5113=Array.prototype.slice.call($3772$3804,2));(tokens$5119=$5484((((acc$5128=[])),(((temp$5134=$2255(ops$5112))),((($length$5140=temp$5134.length)),((($index$5146=0)),(function(){$5123:for(;($index$5146<$length$5140);($index$5146++)){var i$5165;var op$5166;var t0$5160;var t1$5161;var m$5155;(m$5155=temp$5134[$index$5146]);(t0$5160=m$5155);if(((t0$5160 instanceof Array)&&(((t1$5161=t0$5160.length)),(t1$5161===2)))){(i$5165=t0$5160[0]);(op$5166=t0$5160[1]);acc$5128.push([("token"+String((i$5165+1))),op$5166]);}else{$2003(m$5155,"/home/olivier/git/earl-grey/src/expand.eg",17284,17384);}}})()))),acc$5128)));(msg$5120="These operators or brackets cannot be mixed together.");throw $2022(["syntax","mismatch"]).create(msg$5120,tokens$5119);}else{if(($3796$3813&&((t0$3809===2)&&($3772$3804[0]==="char")))){(c$5187=$3772$3804[1]);throw $2022(["syntax","illegal_character"]).create("An illegal character was found.",({"node":expr$3768}));}else{(other$5192=$3772$3804);throw $2022(["syntax","illegal_node"]).create("An illegal node was found.",({"node":other$5192,"context":context$3766}));}}}}}}}}}}}}}}}}}}}})));return helper$3761(context$3744,scope$3745,expr$3746);}));$1929(Expander$2339,$1929(((accum$5198=({})),((accum$5198["::name"]="Expander"),accum$5198)),((accum$5202=({})),((accum$5202["::egclass"]=true),accum$5202))));Expander$2339;(mac1$2340=(function(f$5209){return ["macro",(function(context$5215,scope$5216,form$5217,$5212$5218){var t0$5222;var t1$5223;var expr$5220;(t0$5222=$5212$5218);if(((t0$5222 instanceof Array)&&(((t1$5223=t0$5222.length)),((t1$5223===2)&&(t0$5222[0]==="data"))))){(expr$5220=t0$5222[1]);}else{$2003($5212$5218);}return f$5209(expr$5220);})];}));(__chk_ncache$2341=({}));(__chk_scache$2342=({}));(checker_db$2343=(function($5246$5249){var v$5294;var v$5313;var s$5307;var n$5288;var $5251$5264;var ph$5258;(ph$5258=$5246$5249);($5251$5264=ph$5258);if(($5251$5264===null)){return checker_db$2343.null;}else{if(($5251$5264===(void 0))){return checker_db$2343.undefined;}else{if(($5251$5264===true)){return checker_db$2343.true;}else{if(($5251$5264===false)){return checker_db$2343.false;}else{if((typeof($5251$5264)==="number")){(n$5288=$5251$5264);if($1946(__chk_ncache$2341,n$5288)){return $1946(__chk_ncache$2341,n$5288);}else{(v$5294=mac1$2340((function(x$5299){return ["send",["symbol","==="],["data",x$5299,["value",n$5288]]];})));(__chk_ncache$2341[n$5288]=v$5294);return v$5294;}}else{if((typeof($5251$5264)==="string")){(s$5307=$5251$5264);if(Object.prototype.hasOwnProperty.call(__chk_scache$2342,s$5307)){return $1946(__chk_scache$2342,s$5307);}else{(v$5313=mac1$2340((function(x$5318){return ["send",["symbol","==="],["data",x$5318,["value",s$5307]]];})));(__chk_scache$2342[s$5307]=v$5313);return v$5313;}}else{$2003($5251$5264);}}}}}}}));$1929(checker_db$2343,({"String":mac1$2340((function(x$5329){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$5329]],["value","string"]]];})),"Number":mac1$2340((function(x$5333){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$5333]],["value","number"]]];})),"Array":mac1$2340((function(x$5337){return ["send",["symbol","instanceof"],["data",x$5337,["symbol","Array"]]];})),"true":mac1$2340((function(x$5341){return x$5341;})),"false":mac1$2340((function(x$5345){return ["send",["symbol","not"],["data",["void"],x$5345]];})),"null":mac1$2340((function(x$5349){return ["send",["symbol","==="],["data",x$5349,["value",null]]];})),"undefined":mac1$2340((function(x$5353){return ["send",["symbol","==="],["data",x$5353,["value",(void 0)]]];}))}));(exports["Env"]=Env$2337);(exports["Scope"]=Scope$2336);(exports["track_location"]=track_location$2338);(exports["Expander"]=Expander$2339);(exports["GenSym"]=GenSym$2331);(exports["gensym"]=gensym$2332);(exports["mac1"]=mac1$2340);(exports["checker_db"]=checker_db$2343);
