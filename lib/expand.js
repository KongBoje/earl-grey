var $1910=(function(type$1913){var f$1917;(f$1917=type$1913["::check"]);if((f$1917===(void 0))){return (function(value$1923){return (value$1923 instanceof type$1913);});}else{return (function(value$1927){return f$1917.call(type$1913,value$1927);});}});
var $1929=(function(dest$1932,values$1933){var k$1938;(k$1938=null);$1936:for(k$1938 in values$1933){if(values$1933.hasOwnProperty(k$1938)){(dest$1932[k$1938]=values$1933[k$1938]);}}return dest$1932;});
var $1946=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $1947=(function($1949$1952){var ph$1958;(ph$1958=$1949$1952);var $1954$1964;($1954$1964=ph$1958);var bridge$1956$1969;var x$1973;(bridge$1956$1969=$1954$1964);if((((typeof(bridge$1956$1969)==="string")&&((x$1973=bridge$1956$1969),true))||((typeof(bridge$1956$1969)==="number")&&((x$1973=bridge$1956$1969),true)))){return ["value",x$1973];}else{var other$1984;(other$1984=$1954$1964);return other$1984["::serialize_ast"]();}});
var $1986=(function(obj$1989){var results$1994;(results$1994=[]);var k$1999;(k$1999=null);$1993:for(k$1999 in obj$1989){if(Object.prototype.hasOwnProperty.call(obj$1989,k$1999)){results$1994.push([k$1999,$1946(obj$1989,k$1999)]);}}return results$1994;});
var $2255=(function(arr$2258){var results$2264;var l$2265;(results$2264=[]);(l$2265=arr$2258.length);var i$2274;(i$2274=0);$2263:for(;(i$2274<l$2265);(i$2274++)){results$2264.push([i$2274,$1946(arr$2258,i$2274)]);}return results$2264;});
var $2022=(function(){var $2023$2029;($2023$2029=(function(tags$2034){var it$0$2037;(it$0$2037=(function(){if((!$1910($2023$2029)(this))){return Object.create($2023$2029.prototype);}else{return this;}})());(it$0$2037["tags"]=tags$2034);return it$0$2037;}));($2023$2029.prototype["create"]=(function(){var it$0$2057;var self$2058;(it$0$2057=this);(self$2058=this);var $2055$2067;($2055$2067=arguments);var t0$2072;var message$2076;var args$2077;(t0$2072=$2055$2067.length);if((t0$2072>=0)){(message$2076=(function(){if((0>=t0$2072)){return "";}else{return $2055$2067[0];}})());(args$2077=Array.prototype.slice.call($2055$2067,1));var e$2090;(e$2090=Error(message$2076));(e$2090["::tags"]=it$0$2057.tags);(e$2090["args"]=args$2077);var temp$2106;(temp$2106=$2255(args$2077));var $length$2112;($length$2112=temp$2106.length);var $index$2118;($index$2118=0);$2091:for(;($index$2118<$length$2112);($index$2118++)){var m$2127;(m$2127=temp$2106[$index$2118]);var t0$2132;var t1$2133;var i$2137;var arg$2138;(t0$2132=m$2127);if(((t0$2132 instanceof Array)&&(((t1$2133=t0$2132.length)),(t1$2133===2)))){(i$2137=t0$2132[0]);(arg$2138=t0$2132[1]);(e$2090[i$2137]=arg$2138);}else{$2003(m$2127);}}(e$2090["length"]=args$2077.length);(e$2090["name"]=["E"].concat(it$0$2057.tags).join("."));return e$2090;}else{$2003($2055$2067);}}));($2023$2029.prototype["::check"]=(function(e$2168){var it$0$2172;var self$2173;(it$0$2172=this);(self$2173=this);var tags$2183;if(((!e$2168)||(!$1910(Error)(e$2168)))){return false;}(tags$2183=(e$2168["::tags"]||[]));var temp$2194;(temp$2194=it$0$2172.tags);var $length$2200;($length$2200=temp$2194.length);var $index$2206;($index$2206=0);$2184:for(;($index$2206<$length$2200);($index$2206++)){var m$2215;(m$2215=temp$2194[$index$2206]);var tag$2223;(tag$2223=m$2215);if((tags$2183.indexOf(tag$2223)===-1)){return false;}else{false;}}return true;}));($2023$2029.prototype["::deconstruct"]=(function(e$2232){var it$0$2236;var self$2237;(it$0$2236=this);(self$2237=this);return e$2232.args;}));$1929($2023$2029,$1929((function(){var accum$2248;(accum$2248=({}));(accum$2248["::name"]="$2023");return accum$2248;})(),(function(){var accum$2252;(accum$2252=({}));(accum$2252["::egclass"]=true);return accum$2252;})()));return $2023$2029;})();
var $2003=(function(value$2006,url$2007,start$2008,end$2009){var err$2013;(err$2013=$2022(["match"]).create("Could not find a match for value",({"value":value$2006})));if(url$2007){(err$2013["location"]=["location",url$2007,start$2008,end$2009]);}throw err$2013;});
var send$1555;var __array_methods$1556;var __re_methods$1557;(send$1555=(function(obj$1570,$1567$1571){var ph$1577;var msg$1578;var t0$1580;(t0$1580=$1567$1571);(msg$1578=t0$1580);(ph$1577=t0$1580);var $1573$1589;($1573$1589=ph$1577);var bridge$1575$1594;(bridge$1575$1594=$1573$1589);if(((typeof(bridge$1575$1594)==="string")||(typeof(bridge$1575$1594)==="number"))){return obj$1570[msg$1578];}else{var other$1606;(other$1606=$1573$1589);return obj$1570["::send"](msg$1578);}}));(Array[":::project"]=(function($1612$1615){var ph$1620;var value$1621;var t0$1623;(t0$1623=$1612$1615);(value$1621=t0$1623);(ph$1620=t0$1623);var $1617$1632;($1617$1632=ph$1620);if($1910(Array)($1617$1632)){return [true,value$1621];}else{$1617$1632;return [true,[value$1621]];}}));(__array_methods$1556=$1929((function(){var accum$1653;(accum$1653=({}));(accum$1653["::check"]=(function(value$1658){if((value$1658 instanceof Array)){var i$1664;(i$1664=0);$1661:for(;(i$1664<this.length);(i$1664++)){if(($1946(this,i$1664)!==$1946(value$1658,i$1664))){return false;}}return true;}else{return false;}}));return accum$1653;})(),$1929((function(){var accum$1673;(accum$1673=({}));(accum$1673["::clone"]=(function(){return $1929(this.slice(0),this);}));return accum$1673;})(),$1929((function(){var accum$1680;(accum$1680=({}));(accum$1680[":::project"]=(function(value$1685){if((value$1685 instanceof Array)){var i$1691;(i$1691=0);$1688:for(;(i$1691<this.length);(i$1691++)){if(($1946(this,i$1691)!==$1946(value$1685,i$1691))){return [true,this.concat([value$1685])];}}return [true,value$1685];}else{return [true,this.concat([value$1685])];}}));return accum$1680;})(),(function(){var accum$1700;(accum$1700=({}));(accum$1700["::serialize_ast"]=(function(){return ["array"].concat(this.map($1947));}));return accum$1700;})()))));var temp$1710;(temp$1710=$1986(__array_methods$1556));var $length$1716;($length$1716=temp$1710.length);var $index$1722;($index$1722=0);$1558:for(;($index$1722<$length$1716);($index$1722++)){var m$1731;(m$1731=temp$1710[$index$1722]);var t0$1736;var t1$1737;var k$1741;var v$1742;(t0$1736=m$1731);if(((t0$1736 instanceof Array)&&(((t1$1737=t0$1736.length)),(t1$1737===2)))){(k$1741=t0$1736[0]);(v$1742=t0$1736[1]);if((!$1946(Array.prototype,k$1741))){Object.defineProperty(Array.prototype,k$1741,({"enumerable":false,"value":v$1742}));}}else{$2003(m$1731);}}(__re_methods$1557=$1929((function(){var accum$1762;(accum$1762=({}));(accum$1762["::check"]=(function($1766$1769){var ph$1774;(ph$1774=$1766$1769);var $1771$1780;($1771$1780=ph$1774);var value$1788;if((typeof($1771$1780)==="string")){(value$1788=$1771$1780);if(value$1788.match(this)){return true;}else{return false;}}else{var other$1793;(other$1793=$1771$1780);return false;}}));return accum$1762;})(),(function(){var accum$1796;(accum$1796=({}));(accum$1796[":::project"]=(function($1800$1803){var ph$1808;(ph$1808=$1800$1803);var $1805$1814;($1805$1814=ph$1808);var value$1822;if((typeof($1805$1814)==="string")){(value$1822=$1805$1814);var $1825$1830;($1825$1830=value$1822.match(this));var m$1838;if(($1825$1830===null)){(m$1838=$1825$1830);return [false,null];}else{var m$1843;(m$1843=$1825$1830);return [true,m$1843];}}else{var other$1847;(other$1847=$1805$1814);return [false,null];}}));return accum$1796;})()));var temp$1853;(temp$1853=$1986(__re_methods$1557));var $length$1859;($length$1859=temp$1853.length);var $index$1865;($index$1865=0);$1561:for(;($index$1865<$length$1859);($index$1865++)){var m$1874;(m$1874=temp$1853[$index$1865]);var t0$1879;var t1$1880;var k$1884;var v$1885;(t0$1879=m$1874);if(((t0$1879 instanceof Array)&&(((t1$1880=t0$1879.length)),(t1$1880===2)))){(k$1884=t0$1879[0]);(v$1885=t0$1879[1]);if((!$1946(RegExp.prototype,k$1884))){Object.defineProperty(RegExp.prototype,k$1884,({"enumerable":false,"value":v$1885}));}}else{$2003(m$1874);}}if((!Function.prototype["::send"])){Object.defineProperty(Function.prototype,"::send",$1929(({"enumerable":false}),(function(){var accum$1903;(accum$1903=({}));(accum$1903["value"]=(function(args$1908){return this.apply(this,args$1908);}));return accum$1903;})()));}
var $5387=(function($5389$5392){var ph$5400;(ph$5400=$5389$5392);var $5394$5406;($5394$5406=ph$5400);var t0$5411;var $5398$5413;var $5399$5414;if((($5398$5413=($5394$5406 instanceof Array))&&(((t0$5411=$5394$5406.length)),(t0$5411===0)))){return [];}else{var x$5426;if(($5398$5413&&(t0$5411===1))){(x$5426=$5394$5406[0]);return [];}else{var x$5431;var y$5432;var rest$5433;if(($5398$5413&&(t0$5411>=2))){(x$5431=$5394$5406[0]);(y$5432=$5394$5406[1]);(rest$5433=Array.prototype.slice.call($5394$5406,2));return [[x$5431,y$5432]].concat($5387([y$5432].concat(rest$5433)));}else{$2003($5394$5406);}}}});
var $5438=(function($5440$5443,key$5444){var ph$5452;(ph$5452=$5440$5443);var $5446$5458;($5446$5458=ph$5452);var bridge$5448$5463;(bridge$5448$5463=$5446$5458);if(((bridge$5448$5463===null)||(bridge$5448$5463===(void 0)))){return false;}else{var x$5475;if((typeof($5446$5458)==="string")){(x$5475=$5446$5458);return (key$5444 in String.prototype);}else{var x$5480;if((typeof($5446$5458)==="number")){(x$5480=$5446$5458);return (key$5444 in Number.prototype);}else{var x$5485;(x$5485=$5446$5458);return (key$5444 in x$5485);}}}});
var $5487=(function(type$5490){return (function(value$5494){var f$5498;(f$5498=type$5490[":::project"]);if((f$5498===(void 0))){(f$5498=type$5490["::project"]);if((f$5498===(void 0))){return [true,type$5490(value$5494)];}else{var rval$5511;(rval$5511=false);try{(rval$5511=[true,f$5498(value$5494)]);}catch(excv$5522){var e$5528;(e$5528=excv$5522);(rval$5511=[false,null]);}return rval$5511;}}else{return f$5498.call(type$5490,value$5494);}});});
var $5534=(function(pairs$5537){var rval$5541;(rval$5541=({}));var temp$5551;(temp$5551=pairs$5537);var $length$5557;($length$5557=temp$5551.length);var $index$5563;($index$5563=0);$5542:for(;($index$5563<$length$5557);($index$5563++)){var m$5572;(m$5572=temp$5551[$index$5563]);var t0$5577;var t1$5578;var k$5582;var v$5583;(t0$5577=m$5572);if(((t0$5577 instanceof Array)&&(((t1$5578=t0$5577.length)),(t1$5578===2)))){(k$5582=t0$5577[0]);(v$5583=t0$5577[1]);(rval$5541[k$5582]=v$5583);}else{$2003(m$5572);}}return rval$5541;});var accum$2570;var accum$2574;var accum$2998;var accum$3002;var accum$5197;var accum$5201;var $2283$2324;var __lt____gt__$2325;var $2284$2326;var __lt____lt____colon__$2327;var util$2328;var classify$2329;var GenSym$2330;var gensym$2331;var $2286$2332;var PatternParser$2333;var PatternProcessor$2334;var Scope$2335;var Env$2336;var track_location$2337;var Expander$2338;var mac1$2339;var __chk_ncache$2340;var __chk_scache$2341;var checker_db$2342;($2283$2324=require("./pp"));(__lt____gt__$2325=$2283$2324["<>"]);($2284$2326=require("./location"));(__lt____lt____colon__$2327=$2284$2326["<<:"]);(util$2328=require("./util"));(classify$2329=util$2328.classify);($5387=util$2328.neighbours);(GenSym$2330=util$2328.GenSym);(gensym$2331=util$2328.gensym);($2286$2332=require("./pattern"));(PatternParser$2333=$2286$2332.PatternParser);(PatternProcessor$2334=$2286$2332.PatternProcessor);(Scope$2335=(function(){var t0$2399;var $2390$2394;var it$0$2385;(it$0$2385=(function(){if((!$1910(Scope$2335)(this))){return Object.create(Scope$2335.prototype);}else{return this;}})());($2390$2394=arguments);(t0$2399=$2390$2394.length);if(((t0$2399>=0)&&(t0$2399<=3))){(it$0$2385["parent"]=(function(){if((0>=t0$2399)){return null;}else{return $2390$2394[0];}})());(it$0$2385["name"]=(function(){if((1>=t0$2399)){return gensym$2331("scope");}else{return $2390$2394[1];}})());(it$0$2385["expander"]=(function(){if((2>=t0$2399)){return it$0$2385.parent.expander;}else{return $2390$2394[2];}})());(it$0$2385["options"]=({}));}else{$2003($2390$2394);}return it$0$2385;}));(Scope$2335.prototype["getopt"]=(function(opt$2420){var otherwise$2457;var $2437$2446;var $2433$2440;var it$0$2424;var self$2425;(it$0$2424=this);(self$2425=this);($2433$2440=null);$2433$2440;if(Object.prototype.hasOwnProperty.call(it$0$2424.options,opt$2420)){return $1946(it$0$2424.options,opt$2420);}else{if((it$0$2424.parent===null)){return (void 0);}else{(otherwise$2457=$2433$2440);return it$0$2424.parent.getopt(opt$2420);}}}));(Scope$2335.prototype["setopt"]=(function(opt$2463,value$2464){var it$0$2468;var self$2469;(it$0$2468=this);(self$2469=this);(it$0$2468.options[opt$2463]=value$2464);}));(Scope$2335.prototype["gensym"]=(function(){var it$0$2488;var self$2489;(it$0$2488=this);(self$2489=this);return it$0$2488.expander.gensym();}));(Scope$2335.prototype["step"]=(function(context$2501,expr$2502){var it$0$2506;var self$2507;(it$0$2506=this);(self$2507=this);return it$0$2506.expander.step(context$2501,it$0$2506,expr$2502);}));(Scope$2335.prototype["step_all"]=(function(context$2519,exprs$2520){var it$0$2524;var self$2525;(it$0$2524=this);(self$2525=this);return it$0$2524.expander.step_all(context$2519,it$0$2524,exprs$2520);}));(Scope$2335.prototype["expand"]=(function(context$2537,expr$2538){var it$0$2542;var self$2543;(it$0$2542=this);(self$2543=this);return it$0$2542.expander.expand(context$2537,it$0$2542,expr$2538);}));(Scope$2335.prototype["toString"]=(function(){var it$0$2558;var self$2559;(it$0$2558=this);(self$2559=this);return (("Scope{"+it$0$2558.name)+"}");}));$1929(Scope$2335,$1929(((accum$2570=({})),((accum$2570["::name"]="Scope"),accum$2570)),((accum$2574=({})),((accum$2574["::egclass"]=true),accum$2574))));Scope$2335;(Env$2336=(function(){var it$0$2583;(it$0$2583=(function(){if((!$1910(Env$2336)(this))){return Object.create(Env$2336.prototype);}else{return this;}})());(it$0$2583["scopes"]=({}));return it$0$2583;}));(Env$2336.prototype["list_bindings"]=(function(origin$2598){var values$2614;var scope$2615;var it$0$2602;var self$2603;(it$0$2602=this);(self$2603=this);(values$2614=({}));(scope$2615=origin$2598);$2622:while(scope$2615){$1929(values$2614,$1946(it$0$2602.scopes,scope$2615.name));(scope$2615=scope$2615.parent);}return values$2614;}));(Env$2336.prototype["resolve"]=(function(scope$2634,name$2635){var scope_data$2650;var it$0$2639;var self$2640;(it$0$2639=this);(self$2640=this);if((scope$2634===null)){return (void 0);}(scope_data$2650=$1946(it$0$2639.scopes,scope$2634.name));if((scope_data$2650&&Object.prototype.hasOwnProperty.call(scope_data$2650,name$2635))){return $1946(scope_data$2650,name$2635);}else{return it$0$2639.resolve(scope$2634.parent,name$2635);}}));(Env$2336.prototype["bind"]=(function(scope$2659,name$2660,value$2661){var it$0$2665;var self$2666;(it$0$2665=this);(self$2666=this);if((!$1946(it$0$2665.scopes,scope$2659.name))){(it$0$2665.scopes[scope$2659.name]=({}));}($1946(it$0$2665.scopes,scope$2659.name)[name$2660]=value$2661);}));(Env$2336.prototype["mark"]=(function(expr$2688){var x$2755;var x$2761;var bridge$2707$2747;var x$2767;var bridge$2706$2740;var x$2773;var bridge$2705$2733;var x$2779;var $index$2814;var $length$2808;var temp$2802;var other$2835;var type$2786;var args$2787;var e$2722;var bridge$2704$2717;var t0$2718;var $2701$2712;var it$0$2692;var self$2693;(it$0$2692=this);(self$2693=this);($2701$2712=expr$2688);if($5438($2701$2712,"env")){(e$2722=$2701$2712.env);return expr$2688;}else{(bridge$2704$2717=$2701$2712);if(((((bridge$2705$2733=bridge$2704$2717)),((((bridge$2706$2740=bridge$2705$2733)),((((bridge$2707$2747=bridge$2706$2740)),((((x$2755=bridge$2707$2747)),((x$2755 instanceof Array)&&(x$2755[0]==="symbol")))||(((x$2761=bridge$2707$2747)),((x$2761 instanceof Array)&&(x$2761[0]==="value")))))||(((x$2767=bridge$2706$2740)),((x$2767 instanceof Array)&&(x$2767[0]==="variable")))))||(((x$2773=bridge$2705$2733)),((x$2773 instanceof Array)&&(x$2773[0]==="macro")))))||(((x$2779=bridge$2704$2717)),((x$2779 instanceof Array)&&(x$2779[0]==="void"))))){return $1929(expr$2688,({"env":it$0$2692}));}else{if((($2701$2712 instanceof Array)&&(((t0$2718=$2701$2712.length)),(t0$2718>=1)))){(type$2786=$2701$2712[0]);(args$2787=Array.prototype.slice.call($2701$2712,1));(temp$2802=args$2787);($length$2808=temp$2802.length);($index$2814=0);$2796:for(;($index$2814<$length$2808);($index$2814++)){var arg$2831;var m$2823;(m$2823=temp$2802[$index$2814]);(arg$2831=m$2823);it$0$2692.mark(arg$2831);}return $1929(expr$2688,({"env":it$0$2692}));}else{(other$2835=$2701$2712);return $1929(expr$2688,({"env":it$0$2692}));}}}}));(Env$2336.prototype["fork"]=(function(){var $index$2877;var $length$2871;var temp$2865;var e$2855;var it$0$2844;var self$2845;(it$0$2844=this);(self$2845=this);(e$2855=Env$2336());(temp$2865=$1986(it$0$2844.scopes));($length$2871=temp$2865.length);($index$2877=0);$2856:for(;($index$2877<$length$2871);($index$2877++)){var $index$2932;var $length$2926;var temp$2920;var acc$2914;var scope$2896;var bindings$2897;var t0$2891;var t1$2892;var m$2886;(m$2886=temp$2865[$index$2877]);(t0$2891=m$2886);if(((t0$2891 instanceof Array)&&(((t1$2892=t0$2891.length)),(t1$2892===2)))){(scope$2896=t0$2891[0]);(bindings$2897=t0$2891[1]);(acc$2914=[]);(temp$2920=$1986(bindings$2897));($length$2926=temp$2920.length);($index$2932=0);$2909:for(;($index$2932<$length$2926);($index$2932++)){var k$2951;var v$2952;var t0$2946;var t1$2947;var m$2941;(m$2941=temp$2920[$index$2932]);(t0$2946=m$2941);if(((t0$2946 instanceof Array)&&(((t1$2947=t0$2946.length)),(t1$2947===2)))){(k$2951=t0$2946[0]);(v$2952=t0$2946[1]);acc$2914.push(((function(){if((!$1946(e$2855.scopes,scope$2896))){(e$2855.scopes[scope$2896]=({}));}})(),(($1946(e$2855.scopes,scope$2896)[k$2951]=v$2952))));}else{$2003(m$2941,"/home/olivier/git/earl-grey/src/expand.eg",2279,2426);}}acc$2914;}else{$2003(m$2886,"/home/olivier/git/earl-grey/src/expand.eg",2229,2426);}}return e$2855;}));(Env$2336.prototype["toString"]=(function(){var it$0$2986;var self$2987;(it$0$2986=this);(self$2987=this);return "Env{...}";}));$1929(Env$2336,$1929(((accum$2998=({})),((accum$2998["::name"]="Env"),accum$2998)),((accum$3002=({})),((accum$3002["::egclass"]=true),accum$3002))));Env$2336;(track_location$2337=(function(f$3009){var f2$3013;(f2$3013=(function(context$3018,scope$3019,expr$3020){var rval$3034;var other$3080;var v$3070;var t0$3066;var $3024$3061;var rval$3027;(rval$3027=(((rval$3034=false)),((function(){try{(rval$3034=f$3009(context$3018,scope$3019,expr$3020));}catch(excv$3045){var e$3051;(e$3051=excv$3045);(rval$3034=(__lt____lt____colon__$2327(e$3051,expr$3020),function(){throw e$3051;}()));}})(),rval$3034)));($3024$3061=rval$3027);if((($3024$3061 instanceof Array)&&(((t0$3066=$3024$3061.length)),((t0$3066===2)&&($3024$3061[0]==="bounce"))))){(v$3070=$3024$3061[1]);return f2$3013(context$3018,scope$3019,__lt____lt____colon__$2327(v$3070,expr$3020));}else{(other$3080=$3024$3061);return __lt____lt____colon__$2327(other$3080,expr$3020);}}));return f2$3013;}));(Expander$2338=(function(env_factory$3088,generic_nodes$3089){var it$0$3092;(it$0$3092=(function(){if((!$1910(Expander$2338)(this))){return Object.create(Expander$2338.prototype);}else{return this;}})());(it$0$3092["gensym"]=gensym$2331);(it$0$3092["mkenv"]=env_factory$3088);(it$0$3092["generic_nodes"]=generic_nodes$3089);return it$0$3092;}));(Expander$2338.prototype["run_macro"]=(function(m$3116,context$3117,scope$3118,form$3119,arg$3120){var rval$3143;var rval$3135;var it$0$3124;var self$3125;(it$0$3124=this);(self$3125=this);(rval$3135=(((rval$3143=false)),((function(){try{(rval$3143=m$3116(context$3117,scope$3118,form$3119,arg$3120));}catch(excv$3154){var msg$3211;var msg$3333;var find$3222;var err$3223;var other$3217;var $3194$3199;var e$3191;var e$3341;var value$3164;var t0$3157;var t1$3158;var t2$3159;var t3$3160;(t0$3157=excv$3154);if(($1910($2022(["match"]))(t0$3157)&&($5438(t0$3157,"args")&&(((t1$3158=t0$3157.args)),((t1$3158 instanceof Array)&&(((t2$3159=t1$3158.length)),((t2$3159===1)&&(((t3$3160=t1$3158[0])),$5438(t3$3160,"value"))))))))){(value$3164=t3$3160.value);(rval$3143=(((e$3191=((($3194$3199=value$3164)),(function(){if(($3194$3199===context$3117)){(msg$3211="The macro cannot be found in this context.");return $2022(["syntax","context"]).create(msg$3211,({"context":context$3117,"form":form$3119}));}else{(other$3217=$3194$3199);(find$3222=(function($3227$3230){var t0$3239;var msg$3261;var $index$3295;var $length$3289;var temp$3283;var other$3325;var type$3267;var xs$3268;var t0$3253;var $3232$3248;var ph$3236;var arg$3237;(t0$3239=$3227$3230);(arg$3237=t0$3239);(ph$3236=t0$3239);($3232$3248=ph$3236);if(($3232$3248===value$3164)){(msg$3261="The macro expected something different.");return $2022(["syntax","argument"]).create(msg$3261,({"context":context$3117,"argument":arg$3237,"form":form$3119}));}else{if((($3232$3248 instanceof Array)&&(((t0$3253=$3232$3248.length)),(t0$3253>=1)))){(type$3267=$3232$3248[0]);(xs$3268=Array.prototype.slice.call($3232$3248,1));(temp$3283=xs$3268);($length$3289=temp$3283.length);($index$3295=0);$3277:for(;($index$3295<$length$3289);($index$3295++)){var x$3313;var t0$3309;var m$3304;(m$3304=temp$3283[$index$3295]);(t0$3309=$5487(find$3222)(m$3304));if(t0$3309[0]){(x$3313=t0$3309[1]);if(x$3313){return x$3313;}}else{$2003(m$3304,"/home/olivier/git/earl-grey/src/expand.eg",3685,3770);}}return false;}else{(other$3325=$3232$3248);return false;}}}));(err$3223=find$3222(arg$3120));if(err$3223){return err$3223;}else{(msg$3333="The macro expected something different (could not locate error in the source).");return $2022(["syntax","failure"]).create(msg$3333,({"form":form$3119,"value":value$3164}));}}})()))),function(){throw e$3191;}()));}else{(e$3341=excv$3154);(rval$3143=function(){throw e$3341;}());}}})(),rval$3143)));return it$0$3124.mkenv().mark(rval$3135);}));(Expander$2338.prototype["step"]=(function(context$3352,scope$3353,expr$3354){var helper$3369;var it$0$3358;var self$3359;(it$0$3358=this);(self$3359=this);(helper$3369=track_location$2337((function(context$3376,scope$3377,$3373$3378){var t0$3392;var other$3447;var env$3442;var $3429$3434;var other$3492;var t0$3479;var $3469$3474;var other$3496;var m$3461;var t0$3457;var $3423$3452;var env$3426;var other$3526;var t0$3513;var $3503$3508;var other$3558;var m$3548;var t0$3544;var $3534$3539;var other$3567;var x$3562;var f$3530;var arg$3531;var m$3500;var s$3413;var $3386$3408;var $3387$3409;var $3388$3410;var t0$3406;var $3380$3401;var ph$3389;var expr$3390;(t0$3392=$3373$3378);(expr$3390=t0$3392);(ph$3389=t0$3392);($3380$3401=ph$3389);if((($3386$3408=($3380$3401 instanceof Array))&&(((t0$3406=$3380$3401.length)),(($3388$3410=(t0$3406===2))&&($3380$3401[0]==="symbol"))))){(s$3413=$3380$3401[1]);(env$3426=((($3429$3434=expr$3390)),(function(){if($5438($3429$3434,"env")){(env$3442=$3429$3434.env);return expr$3390.env;}else{(other$3447=$3429$3434);throw $2022(["syntax","no_env"]).create("No environment was found to resolve",({"symbol":expr$3390}));}})()));($3423$3452=env$3426.resolve(scope$3377,s$3413));if((($3423$3452 instanceof Array)&&(((t0$3457=$3423$3452.length)),((t0$3457===2)&&($3423$3452[0]==="macro"))))){(m$3461=$3423$3452[1]);($3469$3474=context$3376);if((($3469$3474 instanceof Array)&&(((t0$3479=$3469$3474.length)),((t0$3479===2)&&(($3469$3474[0]==="expr")&&($3469$3474[1]==="head")))))){return ["macro",m$3461];}else{(other$3492=$3469$3474);return ["bounce",it$0$3358.run_macro(m$3461,context$3376,scope$3377,expr$3390,__lt____lt____colon__$2327(["void"],expr$3390))];}}else{(other$3496=$3423$3452);return expr$3390;}}else{if(($3388$3410&&($3380$3401[0]==="macro"))){(m$3500=$3380$3401[1]);($3503$3508=context$3376);if((($3503$3508 instanceof Array)&&(((t0$3513=$3503$3508.length)),((t0$3513===2)&&(($3503$3508[0]==="expr")&&($3503$3508[1]==="head")))))){return expr$3390;}else{(other$3526=$3503$3508);return ["bounce",it$0$3358.run_macro(m$3500,context$3376,scope$3377,expr$3390,__lt____lt____colon__$2327(["void"],expr$3390))];}}else{if(($3386$3408&&((t0$3406===3)&&($3380$3401[0]==="send")))){(f$3530=$3380$3401[1]);(arg$3531=$3380$3401[2]);($3534$3539=helper$3369(["expr","head"],scope$3377,f$3530));if((($3534$3539 instanceof Array)&&(((t0$3544=$3534$3539.length)),((t0$3544===2)&&($3534$3539[0]==="macro"))))){(m$3548=$3534$3539[1]);return ["bounce",it$0$3358.run_macro(m$3548,context$3376,scope$3377,expr$3390,arg$3531)];}else{(other$3558=$3534$3539);return expr$3390;}}else{if(($3386$3408&&((t0$3406===2)&&($3380$3401[0]==="nostep")))){(x$3562=$3380$3401[1]);return x$3562;}else{(other$3567=$3380$3401);return expr$3390;}}}}})));return helper$3369(context$3352,scope$3353,expr$3354);}));(Expander$2338.prototype["step_all"]=(function(context$3576,scope$3577,$3573$3578){var t0$3593;var t1$3594;var pre$3611;var bulk$3612;var post$3613;var stmts$3591;var it$0$3582;var self$3583;(it$0$3582=this);(self$3583=this);(t0$3593=$3573$3578);if(((t0$3593 instanceof Array)&&(((t1$3594=t0$3593.length)),(t1$3594>=0)))){(stmts$3591=Array.prototype.slice.call(t0$3593,0));}else{$2003($3573$3578);}(pre$3611=[]);(bulk$3612=[]);(post$3613=[]);$3623:while(stmts$3591.length){var $index$3714;var $length$3708;var temp$3702;var acc$3696;var e$3685;var x$3737;var m$3679;var stmt$3674;var stmt$3669;var prepend$3655;var $3634$3650;var $3635$3651;var $3636$3652;var t0$3648;var $3628$3643;var current$3637;(current$3637=stmts$3591.shift());($3628$3643=it$0$3582.step(context$3576,scope$3577,current$3637));if((($3634$3650=($3628$3643 instanceof Array))&&(((t0$3648=$3628$3643.length)),((t0$3648>=1)&&($3628$3643[0]==="splice"))))){(prepend$3655=Array.prototype.slice.call($3628$3643,1));(stmts$3591=prepend$3655.concat(stmts$3591));}else{if(($3634$3650&&(($3636$3652=(t0$3648===2))&&($3628$3643[0]==="float")))){(stmt$3669=$3628$3643[1]);(pre$3611=pre$3611.concat(it$0$3582.step_all(context$3576,scope$3577,[stmt$3669])));}else{if(($3636$3652&&($3628$3643[0]==="sink"))){(stmt$3674=$3628$3643[1]);(post$3613=post$3613.concat(it$0$3582.step_all(context$3576,scope$3577,[stmt$3674])));}else{if(($3636$3652&&($3628$3643[0]==="restmacro"))){(m$3679=$3628$3643[1]);(e$3685=it$0$3582.mkenv());(stmts$3591=(((acc$3696=[])),(((temp$3702=m$3679(stmts$3591))),((($length$3708=temp$3702.length)),((($index$3714=0)),(function(){$3691:for(;($index$3714<$length$3708);($index$3714++)){var stmt$3731;var m$3723;(m$3723=temp$3702[$index$3714]);(stmt$3731=m$3723);acc$3696.push(e$3685.mark(stmt$3731));}})()))),acc$3696));}else{(x$3737=$3628$3643);bulk$3612.push(x$3737);}}}}}return pre$3611.concat(bulk$3612).concat(post$3613);}));(Expander$2338.prototype["expand"]=(function(context$3743,scope$3744,expr$3745){var helper$3760;var it$0$3749;var self$3750;(it$0$3749=this);(self$3750=this);(helper$3760=track_location$2337((function(context$3765,scope$3766,expr$3767){var t0$3832;var other$3854;var $3827$3842;var env$3830;var $index$3907;var $length$3901;var temp$3895;var acc$3889;var newargs$3881;var $index$3961;var $length$3955;var temp$3949;var acc$3943;var newargs$3935;var t0$4025;var newscope$4019;var env$4020;var $index$4109;var $length$4103;var temp$4097;var acc$4091;var $index$4321;var $length$4315;var temp$4309;var acc$4303;var t0$4070;var newscope$4054;var stepscope$4055;var changes$4056;var newargs$4057;var vars$4058;var exp$4059;var $index$4744;var $length$4738;var temp$4732;var other$4848;var t0$4826;var $4815$4821;var is_obj$4623;var obj$4624;var arr$4625;var arr_parts$4626;var obj_parts$4627;var new_arr_part$4628;var new_obj_part$4629;var r$4630;var x$4886;var msg$4893;var otherwise$4909;var m$4899;var t0$4879;var $4864$4874;var t$4868;var $index$4953;var $length$4947;var temp$4941;var acc$4935;var newscope$4923;var s$5032;var newscope$5045;var name$5023;var t0$5019;var $index$5089;var $length$5083;var temp$5077;var acc$5071;var $index$5145;var $length$5139;var temp$5133;var acc$5127;var tokens$5118;var msg$5119;var other$5191;var c$5186;var ops$5111;var args$5112;var type$5060;var args$5061;var tag$5049;var body$5050;var x$5014;var $3787$5015;var bindings$4917;var body$4918;var target$4858;var value$4859;var args$4611;var args$4045;var args$4040;var args$4035;var variable$3999;var s$4000;var value$4001;var body$4002;var args$3930;var args$3876;var f$3870;var arg$3871;var s$3817;var $3795$3812;var $3796$3813;var $3797$3814;var t0$3808;var t1$3809;var t2$3810;var $3771$3803;(expr$3767=it$0$3749.step(context$3765,scope$3766,expr$3767));($3771$3803=expr$3767);if((($3795$3812=($3771$3803 instanceof Array))&&(((t0$3808=$3771$3803.length)),(($3797$3814=(t0$3808===2))&&($3771$3803[0]==="symbol"))))){(s$3817=$3771$3803[1]);(t0$3832=expr$3767);if($5438(t0$3832,"env")){(env$3830=t0$3832.env);}else{$2003(expr$3767,"/home/olivier/git/earl-grey/src/expand.eg",8047,8051);}($3827$3842=env$3830.resolve(scope$3766,s$3817));if(($3827$3842===(void 0))){throw $2022(["syntax","undeclared"]).create(("Undeclared variable: "+s$3817),({"node":expr$3767}));}else{(other$3854=$3827$3842);return ["bounce",other$3854];}}else{if(($3797$3814&&($3771$3803[0]==="value"))){$3771$3803[1];return expr$3767;}else{if(($3797$3814&&($3771$3803[0]==="variable"))){$3771$3803[1];return expr$3767;}else{if(($3795$3812&&((t0$3808===1)&&($3771$3803[0]==="void")))){return expr$3767;}else{if(($3795$3812&&((t0$3808===3)&&($3771$3803[0]==="send")))){(f$3870=$3771$3803[1]);(arg$3871=$3771$3803[2]);return ["send",helper$3760(["expr","head"],scope$3766,f$3870),helper$3760(["expr","tail"],scope$3766,arg$3871)];}else{if(($3795$3812&&(($3797$3814=(t0$3808>=1))&&($3771$3803[0]==="array")))){(args$3876=Array.prototype.slice.call($3771$3803,1));(newargs$3881=(((acc$3889=[])),(((temp$3895=it$0$3749.step_all(["expr","array"],scope$3766,args$3876))),((($length$3901=temp$3895.length)),((($index$3907=0)),(function(){$3884:for(;($index$3907<$length$3901);($index$3907++)){var arg$3924;var m$3916;(m$3916=temp$3895[$index$3907]);(arg$3924=m$3916);acc$3889.push(helper$3760(["expr","expr"],scope$3766,arg$3924));}})()))),acc$3889));return ["array"].concat(newargs$3881);}else{if(($3797$3814&&($3771$3803[0]==="object"))){(args$3930=Array.prototype.slice.call($3771$3803,1));(newargs$3935=(((acc$3943=[])),(((temp$3949=it$0$3749.step_all(["expr","object"],scope$3766,args$3930))),((($length$3955=temp$3949.length)),((($index$3961=0)),(function(){$3938:for(;($index$3961<$length$3955);($index$3961++)){var k$3980;var v$3981;var t0$3975;var t1$3976;var m$3970;(m$3970=temp$3949[$index$3961]);(t0$3975=m$3970);if(((t0$3975 instanceof Array)&&(((t1$3976=t0$3975.length)),((t1$3976===3)&&(t0$3975[0]==="array"))))){(k$3980=t0$3975[1]);(v$3981=t0$3975[2]);acc$3943.push(["array",helper$3760(["expr","expr"],scope$3766,k$3980),helper$3760(["expr","expr"],scope$3766,v$3981)]);}else{$2003(m$3970,"/home/olivier/git/earl-grey/src/expand.eg",8890,9079);}}})()))),acc$3943));return ["object"].concat(newargs$3935);}else{if(($3795$3812&&((t0$3808===4)&&(($3771$3803[0]==="bind")&&(((t1$3809=$3771$3803[1])),((variable$3999=t1$3809),((t1$3809 instanceof Array)&&(((t2$3810=t1$3809.length)),((t2$3810===2)&&(t1$3809[0]==="symbol")))))))))){(s$4000=t1$3809[1]);(value$4001=$3771$3803[2]);(body$4002=$3771$3803[3]);(newscope$4019=Scope$2335(scope$3766));(t0$4025=variable$3999);if($5438(t0$4025,"env")){(env$4020=t0$4025.env);}else{$2003(variable$3999,"/home/olivier/git/earl-grey/src/expand.eg",9222,9230);}env$4020.bind(newscope$4019,s$4000,value$4001);return helper$3760(context$3765,newscope$4019,body$4002);}else{if(($3795$3812&&(($3797$3814=(t0$3808>=1))&&($3771$3803[0]==="splice")))){(args$4035=Array.prototype.slice.call($3771$3803,1));return ["bounce",$1929(["multi"].concat(args$4035),({"override_scope":true}))];}else{if(($3797$3814&&($3771$3803[0]==="interactive"))){(args$4040=Array.prototype.slice.call($3771$3803,1));return ["bounce",$1929(["multi"].concat(args$4040),({"override_scope":true,"all_mutable":true}))];}else{if(($3797$3814&&($3771$3803[0]==="multi"))){(args$4045=Array.prototype.slice.call($3771$3803,1));(newscope$4054=(function(){if(expr$3767.override_scope){return scope$3766;}else{return Scope$2335(scope$3766);}})());(stepscope$4055=(function(){if(expr$3767.nonrecursive){return scope$3766;}else{return newscope$4054;}})());(changes$4056=false);(t0$4070=classify$2329("newargs","vars",(((acc$4091=[])),(((temp$4097=it$0$3749.step_all(["expr","multi"],stepscope$4055,args$4045))),((($length$4103=temp$4097.length)),((($index$4109=0)),(function(){$4075:for(;($index$4109<$length$4103);($index$4109++)){var t0$4175;var env$4173;var t0$4209;var v$4220;var env$4207;var t0$4267;var env$4265;var other$4280;var s$4247;var variable$4248;var v$4229;var value$4230;var variable$4188;var s$4189;var value$4190;var variable$4153;var s$4154;var value$4155;var opt$4136;var value$4137;var $4083$4128;var $4084$4129;var $4085$4130;var $4086$4131;var $4087$4132;var $4088$4133;var t0$4123;var t1$4124;var t2$4125;var t3$4126;var m$4118;(m$4118=temp$4097[$index$4109]);(t0$4123=m$4118);if((($4084$4129=(t0$4123 instanceof Array))&&(((t1$4124=t0$4123.length)),(($4086$4131=(t1$4124===3))&&(t0$4123[0]==="option"))))){(opt$4136=t0$4123[1]);(value$4137=t0$4123[2]);acc$4091.push((newscope$4054.setopt(opt$4136,value$4137),["ignore"]));}else{if(($4086$4131&&((t0$4123[0]==="declare_raw")&&(((t2$4125=t0$4123[1])),((variable$4153=t2$4125),((t2$4125 instanceof Array)&&(((t3$4126=t2$4125.length)),((t3$4126===2)&&(t2$4125[0]==="symbol"))))))))){(s$4154=t2$4125[1]);(value$4155=t0$4123[2]);acc$4091.push(((((t0$4175=variable$4153)),(function(){if($5438(t0$4175,"env")){(env$4173=t0$4175.env);}else{return $2003(variable$4153,"/home/olivier/git/earl-grey/src/expand.eg",10176,10184);}})()),env$4173.bind(newscope$4054,s$4154,value$4155),((changes$4056=true)),["ignore"]));}else{if(($4084$4129&&(($4086$4131=((t1$4124>=2)&&(t1$4124<=3)))&&(($4087$4132=(t0$4123[0]==="declare"))&&(((t2$4125=t0$4123[1])),((variable$4188=t2$4125),((t2$4125 instanceof Array)&&(((t3$4126=t2$4125.length)),((t3$4126===2)&&(t2$4125[0]==="symbol")))))))))){(s$4189=t2$4125[1]);(value$4190=(function(){if((2>=t1$4124)){return null;}else{return t0$4123[2];}})());acc$4091.push(((((t0$4209=variable$4188)),(function(){if($5438(t0$4209,"env")){(env$4207=t0$4209.env);}else{return $2003(variable$4188,"/home/olivier/git/earl-grey/src/expand.eg",10424,10432);}})()),(function(){if((variable$4188.use_previous&&env$4207.resolve(newscope$4054,s$4189))){return ["splice"];}else{(v$4220=__lt____lt____colon__$2327(["variable",it$0$3749.gensym(s$4189)],variable$4188));$1929(v$4220,({"mutable":(expr$3767.all_mutable||variable$4188.mutable)}));env$4207.bind(newscope$4054,s$4189,v$4220);(changes$4056=true);if(value$4190){return ["splice",["newargs",["assign",v$4220,value$4190]],["vars",v$4220]];}else{return ["vars",v$4220];}}})()));}else{if(($4087$4132&&((v$4229=t2$4125),((t2$4125 instanceof Array)&&(((t3$4126=t2$4125.length)),((t3$4126===2)&&(t2$4125[0]==="variable"))))))){t2$4125[1];(value$4230=(function(){if((2>=t1$4124)){return null;}else{return t0$4123[2];}})());acc$4091.push((((changes$4056=true)),(function(){if(value$4230){return ["splice",["newargs",["assign",v$4229,value$4230]],["vars",v$4229]];}else{return ["vars",v$4229];}})()));}else{if(($4084$4129&&((t1$4124===2)&&((t0$4123[0]==="undeclare")&&(((t2$4125=t0$4123[1])),((t2$4125 instanceof Array)&&(((t3$4126=t2$4125.length)),((t3$4126===2)&&(t2$4125[0]==="symbol"))))))))){(s$4247=t2$4125[1]);(variable$4248=t2$4125);acc$4091.push(((((t0$4267=variable$4248)),(function(){if($5438(t0$4267,"env")){(env$4265=t0$4267.env);}else{return $2003(variable$4248,"/home/olivier/git/earl-grey/src/expand.eg",11696,11704);}})()),env$4265.bind(newscope$4054,s$4247,(void 0)),((changes$4056=true)),["ignore"]));}else{(other$4280=m$4118);acc$4091.push(["newargs",other$4280]);}}}}}}})()))),acc$4091)));if(($5438(t0$4070,"newargs")&&((newargs$4057=t0$4070.newargs),$5438(t0$4070,"vars")))){(vars$4058=t0$4070.vars);}else{$2003(classify$2329("newargs","vars",(((acc$4303=[])),(((temp$4309=it$0$3749.step_all(["expr","multi"],stepscope$4055,args$4045))),((($length$4315=temp$4309.length)),((($index$4321=0)),(function(){$4287:for(;($index$4321<$length$4315);($index$4321++)){var t0$4387;var env$4385;var t0$4421;var v$4432;var env$4419;var t0$4479;var env$4477;var other$4492;var s$4459;var variable$4460;var v$4441;var value$4442;var variable$4400;var s$4401;var value$4402;var variable$4365;var s$4366;var value$4367;var opt$4348;var value$4349;var $4295$4340;var $4296$4341;var $4297$4342;var $4298$4343;var $4299$4344;var $4300$4345;var t0$4335;var t1$4336;var t2$4337;var t3$4338;var m$4330;(m$4330=temp$4309[$index$4321]);(t0$4335=m$4330);if((($4296$4341=(t0$4335 instanceof Array))&&(((t1$4336=t0$4335.length)),(($4298$4343=(t1$4336===3))&&(t0$4335[0]==="option"))))){(opt$4348=t0$4335[1]);(value$4349=t0$4335[2]);acc$4303.push((newscope$4054.setopt(opt$4348,value$4349),["ignore"]));}else{if(($4298$4343&&((t0$4335[0]==="declare_raw")&&(((t2$4337=t0$4335[1])),((variable$4365=t2$4337),((t2$4337 instanceof Array)&&(((t3$4338=t2$4337.length)),((t3$4338===2)&&(t2$4337[0]==="symbol"))))))))){(s$4366=t2$4337[1]);(value$4367=t0$4335[2]);acc$4303.push(((((t0$4387=variable$4365)),(function(){if($5438(t0$4387,"env")){(env$4385=t0$4387.env);}else{return $2003(variable$4365,"/home/olivier/git/earl-grey/src/expand.eg",10176,10184);}})()),env$4385.bind(newscope$4054,s$4366,value$4367),((changes$4056=true)),["ignore"]));}else{if(($4296$4341&&(($4298$4343=((t1$4336>=2)&&(t1$4336<=3)))&&(($4299$4344=(t0$4335[0]==="declare"))&&(((t2$4337=t0$4335[1])),((variable$4400=t2$4337),((t2$4337 instanceof Array)&&(((t3$4338=t2$4337.length)),((t3$4338===2)&&(t2$4337[0]==="symbol")))))))))){(s$4401=t2$4337[1]);(value$4402=(function(){if((2>=t1$4336)){return null;}else{return t0$4335[2];}})());acc$4303.push(((((t0$4421=variable$4400)),(function(){if($5438(t0$4421,"env")){(env$4419=t0$4421.env);}else{return $2003(variable$4400,"/home/olivier/git/earl-grey/src/expand.eg",10424,10432);}})()),(function(){if((variable$4400.use_previous&&env$4419.resolve(newscope$4054,s$4401))){return ["splice"];}else{(v$4432=__lt____lt____colon__$2327(["variable",it$0$3749.gensym(s$4401)],variable$4400));$1929(v$4432,({"mutable":(expr$3767.all_mutable||variable$4400.mutable)}));env$4419.bind(newscope$4054,s$4401,v$4432);(changes$4056=true);if(value$4402){return ["splice",["newargs",["assign",v$4432,value$4402]],["vars",v$4432]];}else{return ["vars",v$4432];}}})()));}else{if(($4299$4344&&((v$4441=t2$4337),((t2$4337 instanceof Array)&&(((t3$4338=t2$4337.length)),((t3$4338===2)&&(t2$4337[0]==="variable"))))))){t2$4337[1];(value$4442=(function(){if((2>=t1$4336)){return null;}else{return t0$4335[2];}})());acc$4303.push((((changes$4056=true)),(function(){if(value$4442){return ["splice",["newargs",["assign",v$4441,value$4442]],["vars",v$4441]];}else{return ["vars",v$4441];}})()));}else{if(($4296$4341&&((t1$4336===2)&&((t0$4335[0]==="undeclare")&&(((t2$4337=t0$4335[1])),((t2$4337 instanceof Array)&&(((t3$4338=t2$4337.length)),((t3$4338===2)&&(t2$4337[0]==="symbol"))))))))){(s$4459=t2$4337[1]);(variable$4460=t2$4337);acc$4303.push(((((t0$4479=variable$4460)),(function(){if($5438(t0$4479,"env")){(env$4477=t0$4479.env);}else{return $2003(variable$4460,"/home/olivier/git/earl-grey/src/expand.eg",11696,11704);}})()),env$4477.bind(newscope$4054,s$4459,(void 0)),((changes$4056=true)),["ignore"]));}else{(other$4492=m$4330);acc$4303.push(["newargs",other$4492]);}}}}}}})()))),acc$4303)),"/home/olivier/git/earl-grey/src/expand.eg",9848,11926);}(exp$4059=(function(s$4499){var $index$4532;var $length$4526;var temp$4520;var acc$4514;var $index$4588;var $length$4582;var temp$4576;var acc$4570;var stepped$4503;(stepped$4503=(((acc$4514=[])),(((temp$4520=$2255(newargs$4057))),((($length$4526=temp$4520.length)),((($index$4532=0)),(function(){$4509:for(;($index$4532<$length$4526);($index$4532++)){var i$4551;var arg$4552;var t0$4546;var t1$4547;var m$4541;(m$4541=temp$4520[$index$4532]);(t0$4546=m$4541);if(((t0$4546 instanceof Array)&&(((t1$4547=t0$4546.length)),(t1$4547===2)))){(i$4551=t0$4546[0]);(arg$4552=t0$4546[1]);acc$4514.push(it$0$3749.step(["expr",(function(){if((i$4551===(newargs$4057.length-1))){return "expr";}else{return "ignore";}})()],s$4499,arg$4552));}else{$2003(m$4541,"/home/olivier/git/earl-grey/src/expand.eg",12148,12325);}}})()))),acc$4514));(acc$4570=[]);(temp$4576=stepped$4503);($length$4582=temp$4576.length);($index$4588=0);$4504:for(;($index$4588<$length$4582);($index$4588++)){var arg$4605;var m$4597;(m$4597=temp$4576[$index$4588]);(arg$4605=m$4597);acc$4570.push(helper$3760(["expr","expr"],s$4499,arg$4605));}return acc$4570;}));if(changes$4056){return ["scope",vars$4058,["multi"].concat(exp$4059(newscope$4054))];}else{return ["multi"].concat(exp$4059(scope$3766));}}else{if(($3797$3814&&($3771$3803[0]==="data"))){(args$4611=Array.prototype.slice.call($3771$3803,1));(is_obj$4623=false);(obj$4624=["object"]);(arr$4625=["array"]);(arr_parts$4626=[]);(obj_parts$4627=[]);(new_arr_part$4628=(function(){var other$4685;var t0$4672;var $4662$4667;($4662$4667=arr$4625);if((($4662$4667 instanceof Array)&&(((t0$4672=$4662$4667.length)),((t0$4672===1)&&($4662$4667[0]==="array"))))){return false;}else{(other$4685=$4662$4667);arr_parts$4626.push(arr$4625);(arr$4625=["array"]);}}));(new_obj_part$4629=(function(){var other$4721;var t0$4708;var $4698$4703;($4698$4703=obj$4624);if((($4698$4703 instanceof Array)&&(((t0$4708=$4698$4703.length)),((t0$4708===1)&&($4698$4703[0]==="object"))))){return false;}else{(other$4721=$4698$4703);obj_parts$4627.push(obj$4624);(obj$4624=["object"]);}}));(temp$4732=it$0$3749.step_all(["expr","data"],scope$3766,args$4611));($length$4738=temp$4732.length);($index$4744=0);$4631:for(;($index$4744<$length$4738);($index$4744++)){var other$4811;var expr$4801;var expr$4795;var k$4784;var v$4785;var $4638$4761;var $4639$4762;var $4640$4763;var $4641$4764;var t0$4758;var t1$4759;var m$4753;(m$4753=temp$4732[$index$4744]);(t0$4758=m$4753);if((($4639$4762=(t0$4758 instanceof Array))&&(((t1$4759=t0$4758.length)),((t1$4759===1)&&(t0$4758[0]==="assoc"))))){(is_obj$4623=true);}else{if(($4639$4762&&((t1$4759===3)&&(t0$4758[0]==="assoc")))){(k$4784=t0$4758[1]);(v$4785=t0$4758[2]);(is_obj$4623=true);obj$4624.push(["array",k$4784,v$4785]);}else{if(($4639$4762&&(($4641$4764=(t1$4759===2))&&(t0$4758[0]==="dynsplice")))){(expr$4795=t0$4758[1]);new_arr_part$4628();arr_parts$4626.push(expr$4795);}else{if(($4641$4764&&(t0$4758[0]==="objsplice"))){(expr$4801=t0$4758[1]);(is_obj$4623=true);new_obj_part$4629();obj_parts$4627.push(expr$4801);}else{(other$4811=m$4753);arr$4625.push(other$4811);}}}}}new_arr_part$4628();new_obj_part$4629();(r$4630=((($4815$4821=arr_parts$4626)),(function(){if((($4815$4821 instanceof Array)&&(((t0$4826=$4815$4821.length)),((t0$4826===0)&&is_obj$4623)))){return util$2328.construct(obj_parts$4627,(function(x$4839,rest$4840){return ["send",["symbol","&:"],["data",x$4839,rest$4840]];}),["object"]);}else{$4815$4821;if(is_obj$4623){throw $2022(["syntax","array","object"]).create("Cannot mix array and object notations.");}else{(other$4848=$4815$4821);return util$2328.construct(arr_parts$4626.reverse(),(function(x$4852,rest$4853){return ["send",["send",rest$4853,["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",x$4852]];}),["array"]);}}})()));return helper$3760(context$3765,scope$3766,it$0$3749.mkenv().mark(r$4630));}else{if(($3795$3812&&(($3797$3814=(t0$3808===3))&&($3771$3803[0]==="assign")))){(target$4858=$3771$3803[1]);(value$4859=$3771$3803[2]);(t$4868=helper$3760(["expr","expr"],scope$3766,target$4858));($4864$4874=t$4868);if(((((x$4886=$4864$4874)),((x$4886 instanceof Array)&&(x$4886[0]==="variable")))&&(((!t$4868.mutable)&&t$4868.assigned)&&(t$4868.assigned.group_id!==target$4858.group_id)))){(msg$4893=["Variable was declared as read-only. Declare it as","mutable at the origin with `var` (if you have access","to the declaration) or declare a new variable with","`let` or `var` or remove the original binding with","`delete`"].join(" "));throw $2022(["syntax"]).create(msg$4893,({"variable":target$4858,"loc":t$4868.assigned}));}else{if((($4864$4874 instanceof Array)&&(((t0$4879=$4864$4874.length)),((t0$4879===2)&&($4864$4874[0]==="macro"))))){(m$4899=$4864$4874[1]);["bounce",m$4899(["assign"],scope$3766,expr$3767,value$4859)];}else{(otherwise$4909=$4864$4874);(t$4868["assigned"]=target$4858);}}return ["assign",t$4868,helper$3760(["expr","expr"],scope$3766,value$4859)];}else{if(($3797$3814&&($3771$3803[0]==="lambda"))){(bindings$4917=$3771$3803[1]);(body$4918=$3771$3803[2]);(newscope$4923=Scope$2335(scope$3766));return ["lambda",(((acc$4935=[])),(((temp$4941=bindings$4917)),((($length$4947=temp$4941.length)),((($index$4953=0)),(function(){$4927:for(;($index$4953<$length$4947);($index$4953++)){var v$4990;var x$5001;var other$5009;var v$4997;var b$4973;var env$4974;var $4932$4970;var t0$4967;var t1$4968;var m$4962;(m$4962=temp$4941[$index$4953]);(t0$4967=m$4962);if(((t0$4967 instanceof Array)&&(((t1$4968=t0$4967.length)),((t1$4968===2)&&((t0$4967[0]==="symbol")&&((b$4973=t0$4967[1]),$5438(t0$4967,"env"))))))){(env$4974=t0$4967.env);acc$4935.push((((v$4990=["variable",it$0$3749.gensym(b$4973)])),(env$4974.bind(newscope$4923,b$4973,v$4990),v$4990)));}else{if((((x$5001=t0$4967)),((x$5001 instanceof Array)&&(x$5001[0]==="variable")))){(v$4997=t0$4967);acc$4935.push(v$4997);}else{(other$5009=m$4962);acc$4935.push(function(){throw $2022(["syntax","lambda","binding"]).create("Not a valid binding.",({"node":other$5009}));}());}}}})()))),acc$4935),helper$3760(["expr","expr"],newscope$4923,body$4918)];}else{if(($3797$3814&&($3771$3803[0]==="use"))){($3787$5015=$3771$3803[1]);(x$5014=$3771$3803[2]);(t0$5019=$3787$5015);if((typeof(t0$5019)==="string")){(name$5023=t0$5019);(s$5032=scope$3766);$5036:while(s$5032){if((s$5032.name.slice(0,(name$5023.length+1))===(name$5023+"/"))){break $5036;}else{(s$5032=s$5032.parent);}}if(s$5032){return helper$3760(context$3765,s$5032,x$5014);}else{throw $2022(["syntax","noscope"]).create(("Could not find a scope tagged: "+name$5023));}}else{(newscope$5045=$3787$5015);return helper$3760(context$3765,newscope$5045,x$5014);}}else{if(($3797$3814&&(($3771$3803[0]==="tagscope")&&(((t1$3809=$3771$3803[1])),(typeof(t1$3809)==="string"))))){(tag$5049=t1$3809);(body$5050=$3771$3803[2]);return helper$3760(context$3765,Scope$2335(scope$3766,it$0$3749.gensym((tag$5049+"/"))),body$5050);}else{if(($3795$3812&&((t0$3808>=1)&&((type$5060=$3771$3803[0]),((args$5061=Array.prototype.slice.call($3771$3803,1)),(it$0$3749.generic_nodes.indexOf(type$5060)!==-1)))))){return [type$5060].concat((((acc$5071=[])),(((temp$5077=args$5061)),((($length$5083=temp$5077.length)),((($index$5089=0)),(function(){$5066:for(;($index$5089<$length$5083);($index$5089++)){var arg$5106;var m$5098;(m$5098=temp$5077[$index$5089]);(arg$5106=m$5098);acc$5071.push(helper$3760(["expr","expr"],scope$3766,arg$5106));}})()))),acc$5071));}else{if(($3795$3812&&((t0$3808>=2)&&($3771$3803[0]==="mismix")))){(ops$5111=$3771$3803[1]);(args$5112=Array.prototype.slice.call($3771$3803,2));(tokens$5118=$5534((((acc$5127=[])),(((temp$5133=$2255(ops$5111))),((($length$5139=temp$5133.length)),((($index$5145=0)),(function(){$5122:for(;($index$5145<$length$5139);($index$5145++)){var i$5164;var op$5165;var t0$5159;var t1$5160;var m$5154;(m$5154=temp$5133[$index$5145]);(t0$5159=m$5154);if(((t0$5159 instanceof Array)&&(((t1$5160=t0$5159.length)),(t1$5160===2)))){(i$5164=t0$5159[0]);(op$5165=t0$5159[1]);acc$5127.push([("token"+String((i$5164+1))),op$5165]);}else{$2003(m$5154,"/home/olivier/git/earl-grey/src/expand.eg",17284,17384);}}})()))),acc$5127)));(msg$5119="These operators or brackets cannot be mixed together.");throw $2022(["syntax","mismatch"]).create(msg$5119,tokens$5118);}else{if(($3795$3812&&((t0$3808===2)&&($3771$3803[0]==="char")))){(c$5186=$3771$3803[1]);throw $2022(["syntax","illegal_character"]).create("An illegal character was found.",({"node":expr$3767}));}else{(other$5191=$3771$3803);throw $2022(["syntax","illegal_node"]).create("An illegal node was found.",({"node":other$5191,"context":context$3765}));}}}}}}}}}}}}}}}}}}}})));return helper$3760(context$3743,scope$3744,expr$3745);}));$1929(Expander$2338,$1929(((accum$5197=({})),((accum$5197["::name"]="Expander"),accum$5197)),((accum$5201=({})),((accum$5201["::egclass"]=true),accum$5201))));Expander$2338;(mac1$2339=(function(f$5208){return ["macro",(function(context$5214,scope$5215,form$5216,$5211$5217){var t0$5221;var t1$5222;var expr$5219;(t0$5221=$5211$5217);if(((t0$5221 instanceof Array)&&(((t1$5222=t0$5221.length)),((t1$5222===2)&&(t0$5221[0]==="data"))))){(expr$5219=t0$5221[1]);}else{$2003($5211$5217);}return f$5208(expr$5219);})];}));(__chk_ncache$2340=({}));(__chk_scache$2341=({}));(checker_db$2342=(function($5245$5248){var v$5293;var v$5312;var s$5306;var n$5287;var $5250$5263;var ph$5257;(ph$5257=$5245$5248);($5250$5263=ph$5257);if(($5250$5263===null)){return checker_db$2342.null;}else{if(($5250$5263===(void 0))){return checker_db$2342.undefined;}else{if(($5250$5263===true)){return checker_db$2342.true;}else{if(($5250$5263===false)){return checker_db$2342.false;}else{if((typeof($5250$5263)==="number")){(n$5287=$5250$5263);if($1946(__chk_ncache$2340,n$5287)){return $1946(__chk_ncache$2340,n$5287);}else{(v$5293=mac1$2339((function(x$5298){return ["send",["symbol","==="],["data",x$5298,["value",n$5287]]];})));(__chk_ncache$2340[n$5287]=v$5293);return v$5293;}}else{if((typeof($5250$5263)==="string")){(s$5306=$5250$5263);if(Object.prototype.hasOwnProperty.call(__chk_scache$2341,s$5306)){return $1946(__chk_scache$2341,s$5306);}else{(v$5312=mac1$2339((function(x$5317){return ["send",["symbol","==="],["data",x$5317,["value",s$5306]]];})));(__chk_scache$2341[s$5306]=v$5312);return v$5312;}}else{$2003($5250$5263);}}}}}}}));$1929(checker_db$2342,({"String":mac1$2339((function(x$5328){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$5328]],["value","string"]]];})),"Number":mac1$2339((function(x$5332){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$5332]],["value","number"]]];})),"Array":mac1$2339((function(x$5336){return ["send",["symbol","instanceof"],["data",x$5336,["symbol","Array"]]];})),"true":mac1$2339((function(x$5340){return x$5340;})),"false":mac1$2339((function(x$5344){return ["send",["symbol","not"],["data",["void"],x$5344]];})),"null":mac1$2339((function(x$5348){return ["send",["symbol","==="],["data",x$5348,["value",null]]];})),"undefined":mac1$2339((function(x$5352){return ["send",["symbol","==="],["data",x$5352,["value",(void 0)]]];}))}));(exports["Env"]=Env$2336);(exports["Scope"]=Scope$2335);(exports["track_location"]=track_location$2337);(exports["Expander"]=Expander$2338);(exports["GenSym"]=GenSym$2330);(exports["gensym"]=gensym$2331);(exports["mac1"]=mac1$2339);(exports["checker_db"]=checker_db$2342);
