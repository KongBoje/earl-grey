var $1488=function(type$1491){var f$1495;(f$1495=type$1491["::check"]);if((f$1495===(void 0))){return function(value$1501){return (value$1501 instanceof type$1491);};}else{return function(value$1505){return f$1495.call(type$1491,value$1505);};}};
var $1507=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $1508=function(dest$1511,values$1512){var k$1517;(k$1517=null);$1515:for(k$1517 in values$1512){if(values$1512.hasOwnProperty(k$1517)){(dest$1511[k$1517]=values$1512[k$1517]);}}return dest$1511;};
var $1525=function($1527$1530){var ph$1536;(ph$1536=$1527$1530);var $1532$1542;($1532$1542=ph$1536);var bridge$1534$1547;var x$1551;(bridge$1534$1547=$1532$1542);if((((typeof(bridge$1534$1547)==="string")&&((x$1551=bridge$1534$1547),true))||((typeof(bridge$1534$1547)==="number")&&((x$1551=bridge$1534$1547),true)))){return ["value",x$1551];}else{var other$1562;(other$1562=$1532$1542);return other$1562["::serialize_ast"]();}};
var send$1262;(send$1262=function(obj$1269,$1266$1270){var ph$1276;var msg$1277;var t0$1279;(t0$1279=$1266$1270);(msg$1277=t0$1279);(ph$1276=t0$1279);var $1272$1288;($1272$1288=ph$1276);var bridge$1274$1293;(bridge$1274$1293=$1272$1288);if(((typeof(bridge$1274$1293)==="string")||(typeof(bridge$1274$1293)==="number"))){return obj$1269[msg$1277];}else{var other$1305;(other$1305=$1272$1288);return obj$1269["::send"](msg$1277);}});(Array[":::project"]=function($1311$1314){var ph$1319;var value$1320;var t0$1322;(t0$1322=$1311$1314);(value$1320=t0$1322);(ph$1319=t0$1322);var $1316$1331;($1316$1331=ph$1319);if($1488(Array)($1316$1331)){return [true,value$1320];}else{$1316$1331;return [true,[value$1320]];}});(Array.prototype["::check"]=function(value$1349){if((value$1349 instanceof Array)){var i$1355;(i$1355=0);$1352:for(;(i$1355<this.length);(i$1355++)){if(($1507(this,i$1355)!==$1507(value$1349,i$1355))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $1508(this.slice(0),this);});(Array.prototype[":::project"]=function(value$1374){if((value$1374 instanceof Array)){var i$1380;(i$1380=0);$1377:for(;(i$1380<this.length);(i$1380++)){if(($1507(this,i$1380)!==$1507(value$1374,i$1380))){return [true,[value$1374]];}}return [true,value$1374.slice(this.length)];}else{return [true,[value$1374]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($1525));});(RegExp.prototype["::check"]=function($1398$1401){var ph$1406;(ph$1406=$1398$1401);var $1403$1412;($1403$1412=ph$1406);var value$1420;if((typeof($1403$1412)==="string")){(value$1420=$1403$1412);if(value$1420.match(this)){return true;}else{return false;}}else{var other$1425;(other$1425=$1403$1412);return false;}});(RegExp.prototype[":::project"]=function($1431$1434){var ph$1439;(ph$1439=$1431$1434);var $1436$1445;($1436$1445=ph$1439);var value$1453;if((typeof($1436$1445)==="string")){(value$1453=$1436$1445);var $1456$1461;($1456$1461=value$1453.match(this));var m$1469;if(($1456$1461===null)){(m$1469=$1456$1461);return [false,null];}else{var m$1474;(m$1474=$1456$1461);return [true,m$1474];}}else{var other$1478;(other$1478=$1436$1445);return [false,null];}});(Function.prototype["::send"]=function(args$1485){return this.apply(this,args$1485);});
var $4841=function(arr$4844){var results$4850;var l$4851;(results$4850=[]);(l$4851=arr$4844.length);var i$4860;(i$4860=0);$4849:for(;(i$4860<l$4851);(i$4860++)){results$4850.push([i$4860,$1507(arr$4844,i$4860)]);}return results$4850;};
var $4608=function(){var $4609$4615;($4609$4615=function(tags$4620){var it$0$4623;(it$0$4623=function(){if((!$1488($4609$4615)(this))){return Object.create($4609$4615.prototype);}else{return this;}}());(it$0$4623["tags"]=tags$4620);return it$0$4623;});($4609$4615.prototype["create"]=function(){var it$0$4643;var self$4644;(it$0$4643=this);(self$4644=this);var $4641$4653;($4641$4653=arguments);var t0$4658;var message$4662;var args$4663;(t0$4658=$4641$4653.length);if((t0$4658>=0)){(message$4662=function(){if((0>=t0$4658)){return "";}else{return $4641$4653[0];}}());(args$4663=Array.prototype.slice.call($4641$4653,1));var e$4676;(e$4676=Error(message$4662));(e$4676["::tags"]=it$0$4643.tags);(e$4676["args"]=args$4663);var temp$4692;(temp$4692=$4841(args$4663));var $length$4698;($length$4698=temp$4692.length);var $index$4704;($index$4704=0);$4677:for(;($index$4704<$length$4698);($index$4704++)){var m$4713;(m$4713=temp$4692[$index$4704]);var t0$4718;var t1$4719;var i$4723;var arg$4724;(t0$4718=m$4713);if(((t0$4718 instanceof Array)&&(((t1$4719=t0$4718.length)),(t1$4719===2)))){(i$4723=t0$4718[0]);(arg$4724=t0$4718[1]);(e$4676[i$4723]=arg$4724);}else{$4589(m$4713);}}(e$4676["length"]=args$4663.length);(e$4676["name"]=["E"].concat(it$0$4643.tags).join("."));return e$4676;}else{$4589($4641$4653);}});($4609$4615.prototype["::check"]=function(e$4754){var it$0$4758;var self$4759;(it$0$4758=this);(self$4759=this);var tags$4769;if(((!e$4754)||(!$1488(Error)(e$4754)))){return false;}(tags$4769=(e$4754["::tags"]||[]));var temp$4780;(temp$4780=it$0$4758.tags);var $length$4786;($length$4786=temp$4780.length);var $index$4792;($index$4792=0);$4770:for(;($index$4792<$length$4786);($index$4792++)){var m$4801;(m$4801=temp$4780[$index$4792]);var tag$4809;(tag$4809=m$4801);if((tags$4769.indexOf(tag$4809)===-1)){return false;}else{false;}}return true;});($4609$4615.prototype["::deconstruct"]=function(e$4818){var it$0$4822;var self$4823;(it$0$4822=this);(self$4823=this);return e$4818.args;});$1508($4609$4615,$1508(function(){var accum$4834;(accum$4834=({}));(accum$4834["::name"]="$4609");return accum$4834;}(),function(){var accum$4838;(accum$4838=({}));(accum$4838["::egclass"]=true);return accum$4838;}()));return $4609$4615;}();
var $4589=function(value$4592,url$4593,start$4594,end$4595){var err$4599;(err$4599=$4608(["match"]).create("Could not find a match for value",({"value":value$4592})));if(url$4593){(err$4599["location"]=["location",url$4593,start$4594,end$4595]);}throw err$4599;};
var $4867=function($4869$4872,key$4873){var ph$4881;(ph$4881=$4869$4872);var $4875$4887;($4875$4887=ph$4881);var bridge$4877$4892;(bridge$4877$4892=$4875$4887);if(((bridge$4877$4892===null)||(bridge$4877$4892===(void 0)))){return false;}else{var x$4904;if((typeof($4875$4887)==="string")){(x$4904=$4875$4887);return (key$4873 in String.prototype);}else{var x$4909;if((typeof($4875$4887)==="number")){(x$4909=$4875$4887);return (key$4873 in Number.prototype);}else{var x$4914;(x$4914=$4875$4887);return (key$4873 in x$4914);}}}};
var $4916=function(obj$4919){var results$4924;(results$4924=[]);var k$4929;(k$4929=null);$4923:for(k$4929 in obj$4919){if(Object.prototype.hasOwnProperty.call(obj$4919,k$4929)){results$4924.push([k$4929,$1507(obj$4919,k$4929)]);}}return results$4924;};
var $4933=function(type$4936){return function(value$4940){var f$4944;(f$4944=type$4936[":::project"]);if((f$4944===(void 0))){(f$4944=type$4936["::project"]);if((f$4944===(void 0))){return [true,type$4936(value$4940)];}else{var rval$4957;(rval$4957=false);try{(rval$4957=[true,f$4944(value$4940)]);}catch(excv$4968){var e$4974;(e$4974=excv$4968);(rval$4957=[false,null]);}return rval$4957;}}else{return f$4944.call(type$4936,value$4940);}};};var accum$1854;var accum$1858;var accum$2282;var accum$2286;var accum$4399;var accum$4403;var $1566$1607;var __lt____gt__$1608;var $1567$1609;var __lt____lt____colon__$1610;var util$1611;var classify$1612;var neighbours$1613;var GenSym$1614;var gensym$1615;var $1569$1616;var PatternParser$1617;var PatternProcessor$1618;var Scope$1619;var Env$1620;var track_location$1621;var Expander$1622;var mac1$1623;var __chk_ncache$1624;var __chk_scache$1625;var checker_db$1626;($1566$1607=require("./pp"));(__lt____gt__$1608=$1566$1607["<>"]);($1567$1609=require("./location"));(__lt____lt____colon__$1610=$1567$1609["<<:"]);(util$1611=require("./util"));(classify$1612=util$1611.classify);(neighbours$1613=util$1611.neighbours);(GenSym$1614=util$1611.GenSym);(gensym$1615=util$1611.gensym);($1569$1616=require("./pattern"));(PatternParser$1617=$1569$1616.PatternParser);(PatternProcessor$1618=$1569$1616.PatternProcessor);(Scope$1619=function(){var t0$1683;var $1674$1678;var it$0$1669;(it$0$1669=function(){if((!$1488(Scope$1619)(this))){return Object.create(Scope$1619.prototype);}else{return this;}}());($1674$1678=arguments);(t0$1683=$1674$1678.length);if(((t0$1683>=0)&&(t0$1683<=3))){(it$0$1669["parent"]=function(){if((0>=t0$1683)){return null;}else{return $1674$1678[0];}}());(it$0$1669["name"]=function(){if((1>=t0$1683)){return gensym$1615("scope");}else{return $1674$1678[1];}}());(it$0$1669["expander"]=function(){if((2>=t0$1683)){return it$0$1669.parent.expander;}else{return $1674$1678[2];}}());(it$0$1669["options"]=({}));}else{$4589($1674$1678);}return it$0$1669;});(Scope$1619.prototype["getopt"]=function(opt$1704){var otherwise$1741;var $1721$1730;var $1717$1724;var it$0$1708;var self$1709;(it$0$1708=this);(self$1709=this);($1717$1724=null);$1717$1724;if(Object.prototype.hasOwnProperty.call(it$0$1708.options,opt$1704)){return $1507(it$0$1708.options,opt$1704);}else{if((it$0$1708.parent===null)){return (void 0);}else{(otherwise$1741=$1717$1724);return it$0$1708.parent.getopt(opt$1704);}}});(Scope$1619.prototype["setopt"]=function(opt$1747,value$1748){var it$0$1752;var self$1753;(it$0$1752=this);(self$1753=this);(it$0$1752.options[opt$1747]=value$1748);});(Scope$1619.prototype["gensym"]=function(){var it$0$1772;var self$1773;(it$0$1772=this);(self$1773=this);return it$0$1772.expander.gensym();});(Scope$1619.prototype["step"]=function(context$1785,expr$1786){var it$0$1790;var self$1791;(it$0$1790=this);(self$1791=this);return it$0$1790.expander.step(context$1785,it$0$1790,expr$1786);});(Scope$1619.prototype["step_all"]=function(context$1803,exprs$1804){var it$0$1808;var self$1809;(it$0$1808=this);(self$1809=this);return it$0$1808.expander.step_all(context$1803,it$0$1808,exprs$1804);});(Scope$1619.prototype["expand"]=function(context$1821,expr$1822){var it$0$1826;var self$1827;(it$0$1826=this);(self$1827=this);return it$0$1826.expander.expand(context$1821,it$0$1826,expr$1822);});(Scope$1619.prototype["toString"]=function(){var it$0$1842;var self$1843;(it$0$1842=this);(self$1843=this);return (("Scope{"+it$0$1842.name)+"}");});$1508(Scope$1619,$1508(((accum$1854=({})),((accum$1854["::name"]="Scope"),accum$1854)),((accum$1858=({})),((accum$1858["::egclass"]=true),accum$1858))));Scope$1619;(Env$1620=function(){var it$0$1867;(it$0$1867=function(){if((!$1488(Env$1620)(this))){return Object.create(Env$1620.prototype);}else{return this;}}());(it$0$1867["scopes"]=({}));return it$0$1867;});(Env$1620.prototype["list_bindings"]=function(origin$1882){var values$1898;var scope$1899;var it$0$1886;var self$1887;(it$0$1886=this);(self$1887=this);(values$1898=({}));(scope$1899=origin$1882);$1906:while(scope$1899){$1508(values$1898,$1507(it$0$1886.scopes,scope$1899.name));(scope$1899=scope$1899.parent);}return values$1898;});(Env$1620.prototype["resolve"]=function(scope$1918,name$1919){var scope_data$1934;var it$0$1923;var self$1924;(it$0$1923=this);(self$1924=this);if((scope$1918===null)){return (void 0);}(scope_data$1934=$1507(it$0$1923.scopes,scope$1918.name));if((scope_data$1934&&Object.prototype.hasOwnProperty.call(scope_data$1934,name$1919))){return $1507(scope_data$1934,name$1919);}else{return it$0$1923.resolve(scope$1918.parent,name$1919);}});(Env$1620.prototype["bind"]=function(scope$1943,name$1944,value$1945){var it$0$1949;var self$1950;(it$0$1949=this);(self$1950=this);if((!$1507(it$0$1949.scopes,scope$1943.name))){(it$0$1949.scopes[scope$1943.name]=({}));}($1507(it$0$1949.scopes,scope$1943.name)[name$1944]=value$1945);});(Env$1620.prototype["mark"]=function(expr$1972){var x$2039;var x$2045;var bridge$1991$2031;var x$2051;var bridge$1990$2024;var x$2057;var bridge$1989$2017;var x$2063;var $index$2098;var $length$2092;var temp$2086;var other$2119;var type$2070;var args$2071;var e$2006;var bridge$1988$2001;var t0$2002;var $1985$1996;var it$0$1976;var self$1977;(it$0$1976=this);(self$1977=this);($1985$1996=expr$1972);if($4867($1985$1996,"env")){(e$2006=$1985$1996.env);return expr$1972;}else{(bridge$1988$2001=$1985$1996);if(((((bridge$1989$2017=bridge$1988$2001)),((((bridge$1990$2024=bridge$1989$2017)),((((bridge$1991$2031=bridge$1990$2024)),((((x$2039=bridge$1991$2031)),((x$2039 instanceof Array)&&(x$2039[0]==="symbol")))||(((x$2045=bridge$1991$2031)),((x$2045 instanceof Array)&&(x$2045[0]==="value")))))||(((x$2051=bridge$1990$2024)),((x$2051 instanceof Array)&&(x$2051[0]==="variable")))))||(((x$2057=bridge$1989$2017)),((x$2057 instanceof Array)&&(x$2057[0]==="macro")))))||(((x$2063=bridge$1988$2001)),((x$2063 instanceof Array)&&(x$2063[0]==="void"))))){return $1508(expr$1972,({"env":it$0$1976}));}else{if((($1985$1996 instanceof Array)&&(((t0$2002=$1985$1996.length)),(t0$2002>=1)))){(type$2070=$1985$1996[0]);(args$2071=Array.prototype.slice.call($1985$1996,1));(temp$2086=args$2071);($length$2092=temp$2086.length);($index$2098=0);$2080:for(;($index$2098<$length$2092);($index$2098++)){var arg$2115;var m$2107;(m$2107=temp$2086[$index$2098]);(arg$2115=m$2107);it$0$1976.mark(arg$2115);}return $1508(expr$1972,({"env":it$0$1976}));}else{(other$2119=$1985$1996);return $1508(expr$1972,({"env":it$0$1976}));}}}});(Env$1620.prototype["fork"]=function(){var $index$2161;var $length$2155;var temp$2149;var e$2139;var it$0$2128;var self$2129;(it$0$2128=this);(self$2129=this);(e$2139=Env$1620());(temp$2149=$4916(it$0$2128.scopes));($length$2155=temp$2149.length);($index$2161=0);$2140:for(;($index$2161<$length$2155);($index$2161++)){var $index$2216;var $length$2210;var temp$2204;var acc$2198;var scope$2180;var bindings$2181;var t0$2175;var t1$2176;var m$2170;(m$2170=temp$2149[$index$2161]);(t0$2175=m$2170);if(((t0$2175 instanceof Array)&&(((t1$2176=t0$2175.length)),(t1$2176===2)))){(scope$2180=t0$2175[0]);(bindings$2181=t0$2175[1]);(acc$2198=[]);(temp$2204=$4916(bindings$2181));($length$2210=temp$2204.length);($index$2216=0);$2193:for(;($index$2216<$length$2210);($index$2216++)){var k$2235;var v$2236;var t0$2230;var t1$2231;var m$2225;(m$2225=temp$2204[$index$2216]);(t0$2230=m$2225);if(((t0$2230 instanceof Array)&&(((t1$2231=t0$2230.length)),(t1$2231===2)))){(k$2235=t0$2230[0]);(v$2236=t0$2230[1]);acc$2198.push((function(){if((!$1507(e$2139.scopes,scope$2180))){(e$2139.scopes[scope$2180]=({}));}}(),(($1507(e$2139.scopes,scope$2180)[k$2235]=v$2236))));}else{$4589(m$2225,"/home/olivier/git/earl-grey/src/expand.eg",2269,2426);}}acc$2198;}else{$4589(m$2170,"/home/olivier/git/earl-grey/src/expand.eg",2229,2426);}}return e$2139;});(Env$1620.prototype["toString"]=function(){var it$0$2270;var self$2271;(it$0$2270=this);(self$2271=this);return "Env{...}";});$1508(Env$1620,$1508(((accum$2282=({})),((accum$2282["::name"]="Env"),accum$2282)),((accum$2286=({})),((accum$2286["::egclass"]=true),accum$2286))));Env$1620;(track_location$1621=function(f$2293){var f2$2297;(f2$2297=function(context$2302,scope$2303,expr$2304){var rval$2318;var other$2364;var v$2354;var t0$2350;var $2308$2345;var rval$2311;(rval$2311=(((rval$2318=false)),(function(){try{(rval$2318=f$2293(context$2302,scope$2303,expr$2304));}catch(excv$2329){var e$2335;(e$2335=excv$2329);(rval$2318=(__lt____lt____colon__$1610(e$2335,expr$2304),function(){throw e$2335;}()));}}(),rval$2318)));($2308$2345=rval$2311);if((($2308$2345 instanceof Array)&&(((t0$2350=$2308$2345.length)),((t0$2350===2)&&($2308$2345[0]==="bounce"))))){(v$2354=$2308$2345[1]);return f2$2297(context$2302,scope$2303,__lt____lt____colon__$1610(v$2354,expr$2304));}else{(other$2364=$2308$2345);return __lt____lt____colon__$1610(other$2364,expr$2304);}});return f2$2297;});(Expander$1622=function(env_factory$2372,generic_nodes$2373){var it$0$2376;(it$0$2376=function(){if((!$1488(Expander$1622)(this))){return Object.create(Expander$1622.prototype);}else{return this;}}());(it$0$2376["gensym"]=gensym$1615);(it$0$2376["mkenv"]=env_factory$2372);(it$0$2376["generic_nodes"]=generic_nodes$2373);return it$0$2376;});(Expander$1622.prototype["run_macro"]=function(m$2400,context$2401,scope$2402,form$2403,arg$2404){var rval$2427;var rval$2419;var it$0$2408;var self$2409;(it$0$2408=this);(self$2409=this);(rval$2419=(((rval$2427=false)),(function(){try{(rval$2427=m$2400(context$2401,scope$2402,form$2403,arg$2404));}catch(excv$2438){var msg$2495;var msg$2617;var find$2506;var err$2507;var other$2501;var $2478$2483;var e$2475;var e$2625;var value$2448;var t0$2441;var t1$2442;var t2$2443;var t3$2444;(t0$2441=excv$2438);if(($1488($4608(["match"]))(t0$2441)&&($4867(t0$2441,"args")&&(((t1$2442=t0$2441.args)),((t1$2442 instanceof Array)&&(((t2$2443=t1$2442.length)),((t2$2443===1)&&(((t3$2444=t1$2442[0])),$4867(t3$2444,"value"))))))))){(value$2448=t3$2444.value);(rval$2427=(((e$2475=((($2478$2483=value$2448)),function(){if(($2478$2483===context$2401)){(msg$2495="The macro cannot be found in this context.");return $4608(["syntax","context"]).create(msg$2495,({"context":context$2401,"form":form$2403}));}else{(other$2501=$2478$2483);(find$2506=function($2511$2514){var t0$2523;var msg$2545;var $index$2579;var $length$2573;var temp$2567;var other$2609;var type$2551;var xs$2552;var t0$2537;var $2516$2532;var ph$2520;var arg$2521;(t0$2523=$2511$2514);(arg$2521=t0$2523);(ph$2520=t0$2523);($2516$2532=ph$2520);if(($2516$2532===value$2448)){(msg$2545="The macro expected something different.");return $4608(["syntax","argument"]).create(msg$2545,({"context":context$2401,"argument":arg$2521,"form":form$2403}));}else{if((($2516$2532 instanceof Array)&&(((t0$2537=$2516$2532.length)),(t0$2537>=1)))){(type$2551=$2516$2532[0]);(xs$2552=Array.prototype.slice.call($2516$2532,1));(temp$2567=xs$2552);($length$2573=temp$2567.length);($index$2579=0);$2561:for(;($index$2579<$length$2573);($index$2579++)){var x$2597;var t0$2593;var m$2588;(m$2588=temp$2567[$index$2579]);(t0$2593=$4933(find$2506)(m$2588));if(t0$2593[0]){(x$2597=t0$2593[1]);if(x$2597){return x$2597;}}else{$4589(m$2588,"/home/olivier/git/earl-grey/src/expand.eg",3685,3770);}}return false;}else{(other$2609=$2516$2532);return false;}}});(err$2507=find$2506(arg$2404));if(err$2507){return err$2507;}else{(msg$2617="The macro expected something different (could not locate error in the source).");return $4608(["syntax","failure"]).create(msg$2617,({"form":form$2403,"value":value$2448}));}}}()))),function(){throw e$2475;}()));}else{(e$2625=excv$2438);(rval$2427=function(){throw e$2625;}());}}}(),rval$2427)));return it$0$2408.mkenv().mark(rval$2419);});(Expander$1622.prototype["step"]=function(context$2636,scope$2637,expr$2638){var helper$2653;var it$0$2642;var self$2643;(it$0$2642=this);(self$2643=this);(helper$2653=track_location$1621(function(context$2660,scope$2661,$2657$2662){var t0$2676;var other$2731;var env$2726;var $2713$2718;var other$2776;var t0$2763;var $2753$2758;var other$2780;var m$2745;var t0$2741;var $2707$2736;var env$2710;var other$2810;var t0$2797;var $2787$2792;var other$2842;var m$2832;var t0$2828;var $2818$2823;var other$2851;var x$2846;var f$2814;var arg$2815;var m$2784;var s$2697;var $2670$2692;var $2671$2693;var $2672$2694;var t0$2690;var $2664$2685;var ph$2673;var expr$2674;(t0$2676=$2657$2662);(expr$2674=t0$2676);(ph$2673=t0$2676);($2664$2685=ph$2673);if((($2670$2692=($2664$2685 instanceof Array))&&(((t0$2690=$2664$2685.length)),(($2672$2694=(t0$2690===2))&&($2664$2685[0]==="symbol"))))){(s$2697=$2664$2685[1]);(env$2710=((($2713$2718=expr$2674)),function(){if($4867($2713$2718,"env")){(env$2726=$2713$2718.env);return expr$2674.env;}else{(other$2731=$2713$2718);throw $4608(["syntax","no_env"]).create("No environment was found to resolve",({"symbol":expr$2674}));}}()));($2707$2736=env$2710.resolve(scope$2661,s$2697));if((($2707$2736 instanceof Array)&&(((t0$2741=$2707$2736.length)),((t0$2741===2)&&($2707$2736[0]==="macro"))))){(m$2745=$2707$2736[1]);($2753$2758=context$2660);if((($2753$2758 instanceof Array)&&(((t0$2763=$2753$2758.length)),((t0$2763===2)&&(($2753$2758[0]==="expr")&&($2753$2758[1]==="head")))))){return ["macro",m$2745];}else{(other$2776=$2753$2758);return ["bounce",it$0$2642.run_macro(m$2745,context$2660,scope$2661,expr$2674,__lt____lt____colon__$1610(["void"],expr$2674))];}}else{(other$2780=$2707$2736);return expr$2674;}}else{if(($2672$2694&&($2664$2685[0]==="macro"))){(m$2784=$2664$2685[1]);($2787$2792=context$2660);if((($2787$2792 instanceof Array)&&(((t0$2797=$2787$2792.length)),((t0$2797===2)&&(($2787$2792[0]==="expr")&&($2787$2792[1]==="head")))))){return expr$2674;}else{(other$2810=$2787$2792);return ["bounce",it$0$2642.run_macro(m$2784,context$2660,scope$2661,expr$2674,__lt____lt____colon__$1610(["void"],expr$2674))];}}else{if(($2670$2692&&((t0$2690===3)&&($2664$2685[0]==="send")))){(f$2814=$2664$2685[1]);(arg$2815=$2664$2685[2]);($2818$2823=helper$2653(["expr","head"],scope$2661,f$2814));if((($2818$2823 instanceof Array)&&(((t0$2828=$2818$2823.length)),((t0$2828===2)&&($2818$2823[0]==="macro"))))){(m$2832=$2818$2823[1]);return ["bounce",it$0$2642.run_macro(m$2832,context$2660,scope$2661,expr$2674,arg$2815)];}else{(other$2842=$2818$2823);return expr$2674;}}else{if(($2670$2692&&((t0$2690===2)&&($2664$2685[0]==="nostep")))){(x$2846=$2664$2685[1]);return x$2846;}else{(other$2851=$2664$2685);return expr$2674;}}}}}));return helper$2653(context$2636,scope$2637,expr$2638);});(Expander$1622.prototype["step_all"]=function(context$2860,scope$2861,$2857$2862){var t0$2877;var t1$2878;var pre$2895;var bulk$2896;var post$2897;var stmts$2875;var it$0$2866;var self$2867;(it$0$2866=this);(self$2867=this);(t0$2877=$2857$2862);if(((t0$2877 instanceof Array)&&(((t1$2878=t0$2877.length)),(t1$2878>=0)))){(stmts$2875=Array.prototype.slice.call(t0$2877,0));}else{$4589($2857$2862);}(pre$2895=[]);(bulk$2896=[]);(post$2897=[]);$2907:while(stmts$2875.length){var $index$2998;var $length$2992;var temp$2986;var acc$2980;var e$2969;var x$3021;var m$2963;var stmt$2958;var stmt$2953;var prepend$2939;var $2918$2934;var $2919$2935;var $2920$2936;var t0$2932;var $2912$2927;var current$2921;(current$2921=stmts$2875.shift());($2912$2927=it$0$2866.step(context$2860,scope$2861,current$2921));if((($2918$2934=($2912$2927 instanceof Array))&&(((t0$2932=$2912$2927.length)),((t0$2932>=1)&&($2912$2927[0]==="splice"))))){(prepend$2939=Array.prototype.slice.call($2912$2927,1));(stmts$2875=prepend$2939.concat(stmts$2875));}else{if(($2918$2934&&(($2920$2936=(t0$2932===2))&&($2912$2927[0]==="float")))){(stmt$2953=$2912$2927[1]);(pre$2895=pre$2895.concat(it$0$2866.step_all(context$2860,scope$2861,[stmt$2953])));}else{if(($2920$2936&&($2912$2927[0]==="sink"))){(stmt$2958=$2912$2927[1]);(post$2897=post$2897.concat(it$0$2866.step_all(context$2860,scope$2861,[stmt$2958])));}else{if(($2920$2936&&($2912$2927[0]==="restmacro"))){(m$2963=$2912$2927[1]);(e$2969=it$0$2866.mkenv());(stmts$2875=(((acc$2980=[])),(((temp$2986=m$2963(stmts$2875))),((($length$2992=temp$2986.length)),((($index$2998=0)),function(){$2975:for(;($index$2998<$length$2992);($index$2998++)){var stmt$3015;var m$3007;(m$3007=temp$2986[$index$2998]);(stmt$3015=m$3007);acc$2980.push(e$2969.mark(stmt$3015));}}()))),acc$2980));}else{(x$3021=$2912$2927);bulk$2896.push(x$3021);}}}}}return pre$2895.concat(bulk$2896).concat(post$2897);});(Expander$1622.prototype["expand"]=function(context$3027,scope$3028,expr$3029){var helper$3044;var it$0$3033;var self$3034;(it$0$3033=this);(self$3034=this);(helper$3044=track_location$1621(function(context$3049,scope$3050,expr$3051){var t0$3114;var other$3136;var $3109$3124;var env$3112;var $index$3189;var $length$3183;var temp$3177;var acc$3171;var newargs$3163;var $index$3243;var $length$3237;var temp$3231;var acc$3225;var newargs$3217;var t0$3307;var newscope$3301;var env$3302;var $index$3391;var $length$3385;var temp$3379;var acc$3373;var $index$3603;var $length$3597;var temp$3591;var acc$3585;var t0$3352;var newscope$3336;var stepscope$3337;var changes$3338;var newargs$3339;var vars$3340;var exp$3341;var $index$4026;var $length$4020;var temp$4014;var other$4130;var t0$4108;var $4097$4103;var is_obj$3905;var obj$3906;var arr$3907;var arr_parts$3908;var obj_parts$3909;var new_arr_part$3910;var new_obj_part$3911;var r$3912;var x$4168;var msg$4175;var otherwise$4191;var m$4181;var t0$4161;var $4146$4156;var t$4150;var $index$4235;var $length$4229;var temp$4223;var acc$4217;var newscope$4205;var s$4314;var newscope$4327;var name$4305;var t0$4301;var $index$4371;var $length$4365;var temp$4359;var acc$4353;var other$4393;var type$4342;var args$4343;var tag$4331;var body$4332;var x$4296;var $3071$4297;var bindings$4199;var body$4200;var target$4140;var value$4141;var args$3893;var args$3327;var args$3322;var args$3317;var variable$3281;var s$3282;var value$3283;var body$3284;var args$3212;var args$3158;var f$3152;var arg$3153;var s$3099;var $3077$3094;var $3078$3095;var $3079$3096;var t0$3090;var t1$3091;var t2$3092;var $3055$3085;(expr$3051=it$0$3033.step(context$3049,scope$3050,expr$3051));($3055$3085=expr$3051);if((($3077$3094=($3055$3085 instanceof Array))&&(((t0$3090=$3055$3085.length)),(($3079$3096=(t0$3090===2))&&($3055$3085[0]==="symbol"))))){(s$3099=$3055$3085[1]);(t0$3114=expr$3051);if($4867(t0$3114,"env")){(env$3112=t0$3114.env);}else{$4589(expr$3051,"/home/olivier/git/earl-grey/src/expand.eg",8047,8051);}($3109$3124=env$3112.resolve(scope$3050,s$3099));if(($3109$3124===(void 0))){throw $4608(["syntax","undeclared"]).create(("Undeclared variable: "+s$3099),({"node":expr$3051}));}else{(other$3136=$3109$3124);return ["bounce",other$3136];}}else{if(($3079$3096&&($3055$3085[0]==="value"))){$3055$3085[1];return expr$3051;}else{if(($3079$3096&&($3055$3085[0]==="variable"))){$3055$3085[1];return expr$3051;}else{if(($3077$3094&&((t0$3090===1)&&($3055$3085[0]==="void")))){return expr$3051;}else{if(($3077$3094&&((t0$3090===3)&&($3055$3085[0]==="send")))){(f$3152=$3055$3085[1]);(arg$3153=$3055$3085[2]);return ["send",helper$3044(["expr","head"],scope$3050,f$3152),helper$3044(["expr","tail"],scope$3050,arg$3153)];}else{if(($3077$3094&&(($3079$3096=(t0$3090>=1))&&($3055$3085[0]==="array")))){(args$3158=Array.prototype.slice.call($3055$3085,1));(newargs$3163=(((acc$3171=[])),(((temp$3177=it$0$3033.step_all(["expr","array"],scope$3050,args$3158))),((($length$3183=temp$3177.length)),((($index$3189=0)),function(){$3166:for(;($index$3189<$length$3183);($index$3189++)){var arg$3206;var m$3198;(m$3198=temp$3177[$index$3189]);(arg$3206=m$3198);acc$3171.push(helper$3044(["expr","expr"],scope$3050,arg$3206));}}()))),acc$3171));return ["array"].concat(newargs$3163);}else{if(($3079$3096&&($3055$3085[0]==="object"))){(args$3212=Array.prototype.slice.call($3055$3085,1));(newargs$3217=(((acc$3225=[])),(((temp$3231=it$0$3033.step_all(["expr","object"],scope$3050,args$3212))),((($length$3237=temp$3231.length)),((($index$3243=0)),function(){$3220:for(;($index$3243<$length$3237);($index$3243++)){var k$3262;var v$3263;var t0$3257;var t1$3258;var m$3252;(m$3252=temp$3231[$index$3243]);(t0$3257=m$3252);if(((t0$3257 instanceof Array)&&(((t1$3258=t0$3257.length)),((t1$3258===3)&&(t0$3257[0]==="array"))))){(k$3262=t0$3257[1]);(v$3263=t0$3257[2]);acc$3225.push(["array",helper$3044(["expr","expr"],scope$3050,k$3262),helper$3044(["expr","expr"],scope$3050,v$3263)]);}else{$4589(m$3252,"/home/olivier/git/earl-grey/src/expand.eg",8890,9079);}}}()))),acc$3225));return ["object"].concat(newargs$3217);}else{if(($3077$3094&&((t0$3090===4)&&(($3055$3085[0]==="bind")&&(((t1$3091=$3055$3085[1])),((variable$3281=t1$3091),((t1$3091 instanceof Array)&&(((t2$3092=t1$3091.length)),((t2$3092===2)&&(t1$3091[0]==="symbol")))))))))){(s$3282=t1$3091[1]);(value$3283=$3055$3085[2]);(body$3284=$3055$3085[3]);(newscope$3301=Scope$1619(scope$3050));(t0$3307=variable$3281);if($4867(t0$3307,"env")){(env$3302=t0$3307.env);}else{$4589(variable$3281,"/home/olivier/git/earl-grey/src/expand.eg",9222,9230);}env$3302.bind(newscope$3301,s$3282,value$3283);return helper$3044(context$3049,newscope$3301,body$3284);}else{if(($3077$3094&&(($3079$3096=(t0$3090>=1))&&($3055$3085[0]==="splice")))){(args$3317=Array.prototype.slice.call($3055$3085,1));return ["bounce",$1508(["multi"].concat(args$3317),({"override_scope":true}))];}else{if(($3079$3096&&($3055$3085[0]==="interactive"))){(args$3322=Array.prototype.slice.call($3055$3085,1));return ["bounce",$1508(["multi"].concat(args$3322),({"override_scope":true,"all_mutable":true}))];}else{if(($3079$3096&&($3055$3085[0]==="multi"))){(args$3327=Array.prototype.slice.call($3055$3085,1));(newscope$3336=function(){if(expr$3051.override_scope){return scope$3050;}else{return Scope$1619(scope$3050);}}());(stepscope$3337=function(){if(expr$3051.nonrecursive){return scope$3050;}else{return newscope$3336;}}());(changes$3338=false);(t0$3352=classify$1612("newargs","vars",(((acc$3373=[])),(((temp$3379=it$0$3033.step_all(["expr","multi"],stepscope$3337,args$3327))),((($length$3385=temp$3379.length)),((($index$3391=0)),function(){$3357:for(;($index$3391<$length$3385);($index$3391++)){var t0$3457;var env$3455;var t0$3491;var v$3502;var env$3489;var t0$3549;var env$3547;var other$3562;var s$3529;var variable$3530;var v$3511;var value$3512;var variable$3470;var s$3471;var value$3472;var variable$3435;var s$3436;var value$3437;var opt$3418;var value$3419;var $3365$3410;var $3366$3411;var $3367$3412;var $3368$3413;var $3369$3414;var $3370$3415;var t0$3405;var t1$3406;var t2$3407;var t3$3408;var m$3400;(m$3400=temp$3379[$index$3391]);(t0$3405=m$3400);if((($3366$3411=(t0$3405 instanceof Array))&&(((t1$3406=t0$3405.length)),(($3368$3413=(t1$3406===3))&&(t0$3405[0]==="option"))))){(opt$3418=t0$3405[1]);(value$3419=t0$3405[2]);acc$3373.push((newscope$3336.setopt(opt$3418,value$3419),["ignore"]));}else{if(($3368$3413&&((t0$3405[0]==="declare_raw")&&(((t2$3407=t0$3405[1])),((variable$3435=t2$3407),((t2$3407 instanceof Array)&&(((t3$3408=t2$3407.length)),((t3$3408===2)&&(t2$3407[0]==="symbol"))))))))){(s$3436=t2$3407[1]);(value$3437=t0$3405[2]);acc$3373.push(((((t0$3457=variable$3435)),function(){if($4867(t0$3457,"env")){(env$3455=t0$3457.env);}else{return $4589(variable$3435,"/home/olivier/git/earl-grey/src/expand.eg",10176,10184);}}()),env$3455.bind(newscope$3336,s$3436,value$3437),((changes$3338=true)),["ignore"]));}else{if(($3366$3411&&(($3368$3413=((t1$3406>=2)&&(t1$3406<=3)))&&(($3369$3414=(t0$3405[0]==="declare"))&&(((t2$3407=t0$3405[1])),((variable$3470=t2$3407),((t2$3407 instanceof Array)&&(((t3$3408=t2$3407.length)),((t3$3408===2)&&(t2$3407[0]==="symbol")))))))))){(s$3471=t2$3407[1]);(value$3472=function(){if((2>=t1$3406)){return null;}else{return t0$3405[2];}}());acc$3373.push(((((t0$3491=variable$3470)),function(){if($4867(t0$3491,"env")){(env$3489=t0$3491.env);}else{return $4589(variable$3470,"/home/olivier/git/earl-grey/src/expand.eg",10424,10432);}}()),function(){if((variable$3470.use_previous&&env$3489.resolve(newscope$3336,s$3471))){return ["splice"];}else{(v$3502=__lt____lt____colon__$1610(["variable",it$0$3033.gensym(s$3471)],variable$3470));$1508(v$3502,({"mutable":(expr$3051.all_mutable||variable$3470.mutable)}));env$3489.bind(newscope$3336,s$3471,v$3502);(changes$3338=true);if(value$3472){return ["splice",["newargs",["assign",v$3502,value$3472]],["vars",v$3502]];}else{return ["vars",v$3502];}}}()));}else{if(($3369$3414&&((v$3511=t2$3407),((t2$3407 instanceof Array)&&(((t3$3408=t2$3407.length)),((t3$3408===2)&&(t2$3407[0]==="variable"))))))){t2$3407[1];(value$3512=function(){if((2>=t1$3406)){return null;}else{return t0$3405[2];}}());acc$3373.push((((changes$3338=true)),function(){if(value$3512){return ["splice",["newargs",["assign",v$3511,value$3512]],["vars",v$3511]];}else{return ["vars",v$3511];}}()));}else{if(($3366$3411&&((t1$3406===2)&&((t0$3405[0]==="undeclare")&&(((t2$3407=t0$3405[1])),((t2$3407 instanceof Array)&&(((t3$3408=t2$3407.length)),((t3$3408===2)&&(t2$3407[0]==="symbol"))))))))){(s$3529=t2$3407[1]);(variable$3530=t2$3407);acc$3373.push(((((t0$3549=variable$3530)),function(){if($4867(t0$3549,"env")){(env$3547=t0$3549.env);}else{return $4589(variable$3530,"/home/olivier/git/earl-grey/src/expand.eg",11696,11704);}}()),env$3547.bind(newscope$3336,s$3529,(void 0)),((changes$3338=true)),["ignore"]));}else{(other$3562=m$3400);acc$3373.push(["newargs",other$3562]);}}}}}}}()))),acc$3373)));if(($4867(t0$3352,"newargs")&&((newargs$3339=t0$3352.newargs),$4867(t0$3352,"vars")))){(vars$3340=t0$3352.vars);}else{$4589(classify$1612("newargs","vars",(((acc$3585=[])),(((temp$3591=it$0$3033.step_all(["expr","multi"],stepscope$3337,args$3327))),((($length$3597=temp$3591.length)),((($index$3603=0)),function(){$3569:for(;($index$3603<$length$3597);($index$3603++)){var t0$3669;var env$3667;var t0$3703;var v$3714;var env$3701;var t0$3761;var env$3759;var other$3774;var s$3741;var variable$3742;var v$3723;var value$3724;var variable$3682;var s$3683;var value$3684;var variable$3647;var s$3648;var value$3649;var opt$3630;var value$3631;var $3577$3622;var $3578$3623;var $3579$3624;var $3580$3625;var $3581$3626;var $3582$3627;var t0$3617;var t1$3618;var t2$3619;var t3$3620;var m$3612;(m$3612=temp$3591[$index$3603]);(t0$3617=m$3612);if((($3578$3623=(t0$3617 instanceof Array))&&(((t1$3618=t0$3617.length)),(($3580$3625=(t1$3618===3))&&(t0$3617[0]==="option"))))){(opt$3630=t0$3617[1]);(value$3631=t0$3617[2]);acc$3585.push((newscope$3336.setopt(opt$3630,value$3631),["ignore"]));}else{if(($3580$3625&&((t0$3617[0]==="declare_raw")&&(((t2$3619=t0$3617[1])),((variable$3647=t2$3619),((t2$3619 instanceof Array)&&(((t3$3620=t2$3619.length)),((t3$3620===2)&&(t2$3619[0]==="symbol"))))))))){(s$3648=t2$3619[1]);(value$3649=t0$3617[2]);acc$3585.push(((((t0$3669=variable$3647)),function(){if($4867(t0$3669,"env")){(env$3667=t0$3669.env);}else{return $4589(variable$3647,"/home/olivier/git/earl-grey/src/expand.eg",10176,10184);}}()),env$3667.bind(newscope$3336,s$3648,value$3649),((changes$3338=true)),["ignore"]));}else{if(($3578$3623&&(($3580$3625=((t1$3618>=2)&&(t1$3618<=3)))&&(($3581$3626=(t0$3617[0]==="declare"))&&(((t2$3619=t0$3617[1])),((variable$3682=t2$3619),((t2$3619 instanceof Array)&&(((t3$3620=t2$3619.length)),((t3$3620===2)&&(t2$3619[0]==="symbol")))))))))){(s$3683=t2$3619[1]);(value$3684=function(){if((2>=t1$3618)){return null;}else{return t0$3617[2];}}());acc$3585.push(((((t0$3703=variable$3682)),function(){if($4867(t0$3703,"env")){(env$3701=t0$3703.env);}else{return $4589(variable$3682,"/home/olivier/git/earl-grey/src/expand.eg",10424,10432);}}()),function(){if((variable$3682.use_previous&&env$3701.resolve(newscope$3336,s$3683))){return ["splice"];}else{(v$3714=__lt____lt____colon__$1610(["variable",it$0$3033.gensym(s$3683)],variable$3682));$1508(v$3714,({"mutable":(expr$3051.all_mutable||variable$3682.mutable)}));env$3701.bind(newscope$3336,s$3683,v$3714);(changes$3338=true);if(value$3684){return ["splice",["newargs",["assign",v$3714,value$3684]],["vars",v$3714]];}else{return ["vars",v$3714];}}}()));}else{if(($3581$3626&&((v$3723=t2$3619),((t2$3619 instanceof Array)&&(((t3$3620=t2$3619.length)),((t3$3620===2)&&(t2$3619[0]==="variable"))))))){t2$3619[1];(value$3724=function(){if((2>=t1$3618)){return null;}else{return t0$3617[2];}}());acc$3585.push((((changes$3338=true)),function(){if(value$3724){return ["splice",["newargs",["assign",v$3723,value$3724]],["vars",v$3723]];}else{return ["vars",v$3723];}}()));}else{if(($3578$3623&&((t1$3618===2)&&((t0$3617[0]==="undeclare")&&(((t2$3619=t0$3617[1])),((t2$3619 instanceof Array)&&(((t3$3620=t2$3619.length)),((t3$3620===2)&&(t2$3619[0]==="symbol"))))))))){(s$3741=t2$3619[1]);(variable$3742=t2$3619);acc$3585.push(((((t0$3761=variable$3742)),function(){if($4867(t0$3761,"env")){(env$3759=t0$3761.env);}else{return $4589(variable$3742,"/home/olivier/git/earl-grey/src/expand.eg",11696,11704);}}()),env$3759.bind(newscope$3336,s$3741,(void 0)),((changes$3338=true)),["ignore"]));}else{(other$3774=m$3612);acc$3585.push(["newargs",other$3774]);}}}}}}}()))),acc$3585)),"/home/olivier/git/earl-grey/src/expand.eg",9848,11926);}(exp$3341=function(s$3781){var $index$3814;var $length$3808;var temp$3802;var acc$3796;var $index$3870;var $length$3864;var temp$3858;var acc$3852;var stepped$3785;(stepped$3785=(((acc$3796=[])),(((temp$3802=$4841(newargs$3339))),((($length$3808=temp$3802.length)),((($index$3814=0)),function(){$3791:for(;($index$3814<$length$3808);($index$3814++)){var i$3833;var arg$3834;var t0$3828;var t1$3829;var m$3823;(m$3823=temp$3802[$index$3814]);(t0$3828=m$3823);if(((t0$3828 instanceof Array)&&(((t1$3829=t0$3828.length)),(t1$3829===2)))){(i$3833=t0$3828[0]);(arg$3834=t0$3828[1]);acc$3796.push(it$0$3033.step(["expr",function(){if((i$3833===(newargs$3339.length-1))){return "expr";}else{return "ignore";}}()],s$3781,arg$3834));}else{$4589(m$3823,"/home/olivier/git/earl-grey/src/expand.eg",12148,12325);}}}()))),acc$3796));(acc$3852=[]);(temp$3858=stepped$3785);($length$3864=temp$3858.length);($index$3870=0);$3786:for(;($index$3870<$length$3864);($index$3870++)){var arg$3887;var m$3879;(m$3879=temp$3858[$index$3870]);(arg$3887=m$3879);acc$3852.push(helper$3044(["expr","expr"],s$3781,arg$3887));}return acc$3852;});if(changes$3338){return ["scope",vars$3340,["multi"].concat(exp$3341(newscope$3336))];}else{return ["multi"].concat(exp$3341(scope$3050));}}else{if(($3079$3096&&($3055$3085[0]==="data"))){(args$3893=Array.prototype.slice.call($3055$3085,1));(is_obj$3905=false);(obj$3906=["object"]);(arr$3907=["array"]);(arr_parts$3908=[]);(obj_parts$3909=[]);(new_arr_part$3910=function(){var other$3967;var t0$3954;var $3944$3949;($3944$3949=arr$3907);if((($3944$3949 instanceof Array)&&(((t0$3954=$3944$3949.length)),((t0$3954===1)&&($3944$3949[0]==="array"))))){return false;}else{(other$3967=$3944$3949);arr_parts$3908.push(arr$3907);(arr$3907=["array"]);}});(new_obj_part$3911=function(){var other$4003;var t0$3990;var $3980$3985;($3980$3985=obj$3906);if((($3980$3985 instanceof Array)&&(((t0$3990=$3980$3985.length)),((t0$3990===1)&&($3980$3985[0]==="object"))))){return false;}else{(other$4003=$3980$3985);obj_parts$3909.push(obj$3906);(obj$3906=["object"]);}});(temp$4014=it$0$3033.step_all(["expr","data"],scope$3050,args$3893));($length$4020=temp$4014.length);($index$4026=0);$3913:for(;($index$4026<$length$4020);($index$4026++)){var other$4093;var expr$4083;var expr$4077;var k$4066;var v$4067;var $3920$4043;var $3921$4044;var $3922$4045;var $3923$4046;var t0$4040;var t1$4041;var m$4035;(m$4035=temp$4014[$index$4026]);(t0$4040=m$4035);if((($3921$4044=(t0$4040 instanceof Array))&&(((t1$4041=t0$4040.length)),((t1$4041===1)&&(t0$4040[0]==="assoc"))))){(is_obj$3905=true);}else{if(($3921$4044&&((t1$4041===3)&&(t0$4040[0]==="assoc")))){(k$4066=t0$4040[1]);(v$4067=t0$4040[2]);(is_obj$3905=true);obj$3906.push(["array",k$4066,v$4067]);}else{if(($3921$4044&&(($3923$4046=(t1$4041===2))&&(t0$4040[0]==="dynsplice")))){(expr$4077=t0$4040[1]);new_arr_part$3910();arr_parts$3908.push(expr$4077);}else{if(($3923$4046&&(t0$4040[0]==="objsplice"))){(expr$4083=t0$4040[1]);(is_obj$3905=true);new_obj_part$3911();obj_parts$3909.push(expr$4083);}else{(other$4093=m$4035);arr$3907.push(other$4093);}}}}}new_arr_part$3910();new_obj_part$3911();(r$3912=((($4097$4103=arr_parts$3908)),function(){if((($4097$4103 instanceof Array)&&(((t0$4108=$4097$4103.length)),((t0$4108===0)&&is_obj$3905)))){return util$1611.construct(obj_parts$3909,function(x$4121,rest$4122){return ["send",["symbol","&:"],["data",x$4121,rest$4122]];},["object"]);}else{$4097$4103;if(is_obj$3905){throw $4608(["syntax","array","object"]).create("Cannot mix array and object notations.");}else{(other$4130=$4097$4103);return util$1611.construct(arr_parts$3908.reverse(),function(x$4134,rest$4135){return ["send",["send",rest$4135,["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",x$4134]];},["array"]);}}}()));return helper$3044(context$3049,scope$3050,it$0$3033.mkenv().mark(r$3912));}else{if(($3077$3094&&(($3079$3096=(t0$3090===3))&&($3055$3085[0]==="assign")))){(target$4140=$3055$3085[1]);(value$4141=$3055$3085[2]);(t$4150=helper$3044(["expr","expr"],scope$3050,target$4140));($4146$4156=t$4150);if(((((x$4168=$4146$4156)),((x$4168 instanceof Array)&&(x$4168[0]==="variable")))&&(((!t$4150.mutable)&&t$4150.assigned)&&(t$4150.assigned.group_id!==target$4140.group_id)))){(msg$4175=["Variable was declared as read-only. Declare it as","mutable at the origin with `var` (if you have access","to the declaration) or declare a new variable with","`let` or `var` or remove the original binding with","`delete`"].join(" "));throw $4608(["syntax"]).create(msg$4175,({"variable":target$4140,"loc":t$4150.assigned}));}else{if((($4146$4156 instanceof Array)&&(((t0$4161=$4146$4156.length)),((t0$4161===2)&&($4146$4156[0]==="macro"))))){(m$4181=$4146$4156[1]);["bounce",m$4181(["assign"],scope$3050,expr$3051,value$4141)];}else{(otherwise$4191=$4146$4156);(t$4150["assigned"]=target$4140);}}return ["assign",t$4150,helper$3044(["expr","expr"],scope$3050,value$4141)];}else{if(($3079$3096&&($3055$3085[0]==="lambda"))){(bindings$4199=$3055$3085[1]);(body$4200=$3055$3085[2]);(newscope$4205=Scope$1619(scope$3050));return ["lambda",(((acc$4217=[])),(((temp$4223=bindings$4199)),((($length$4229=temp$4223.length)),((($index$4235=0)),function(){$4209:for(;($index$4235<$length$4229);($index$4235++)){var v$4272;var x$4283;var other$4291;var v$4279;var b$4255;var env$4256;var $4214$4252;var t0$4249;var t1$4250;var m$4244;(m$4244=temp$4223[$index$4235]);(t0$4249=m$4244);if(((t0$4249 instanceof Array)&&(((t1$4250=t0$4249.length)),((t1$4250===2)&&((t0$4249[0]==="symbol")&&((b$4255=t0$4249[1]),$4867(t0$4249,"env"))))))){(env$4256=t0$4249.env);acc$4217.push((((v$4272=["variable",it$0$3033.gensym(b$4255)])),(env$4256.bind(newscope$4205,b$4255,v$4272),v$4272)));}else{if((((x$4283=t0$4249)),((x$4283 instanceof Array)&&(x$4283[0]==="variable")))){(v$4279=t0$4249);acc$4217.push(v$4279);}else{(other$4291=m$4244);acc$4217.push(function(){throw $4608(["syntax","lambda","binding"]).create("Not a valid binding.",({"node":other$4291}));}());}}}}()))),acc$4217),helper$3044(["expr","expr"],newscope$4205,body$4200)];}else{if(($3079$3096&&($3055$3085[0]==="use"))){($3071$4297=$3055$3085[1]);(x$4296=$3055$3085[2]);(t0$4301=$3071$4297);if((typeof(t0$4301)==="string")){(name$4305=t0$4301);(s$4314=scope$3050);$4318:while(s$4314){if((s$4314.name.slice(0,(name$4305.length+1))===(name$4305+"/"))){break $4318;}else{(s$4314=s$4314.parent);}}if(s$4314){return helper$3044(context$3049,s$4314,x$4296);}else{throw $4608(["syntax","noscope"]).create(("Could not find a scope tagged: "+name$4305));}}else{(newscope$4327=$3071$4297);return helper$3044(context$3049,newscope$4327,x$4296);}}else{if(($3079$3096&&(($3055$3085[0]==="tagscope")&&(((t1$3091=$3055$3085[1])),(typeof(t1$3091)==="string"))))){(tag$4331=t1$3091);(body$4332=$3055$3085[2]);return helper$3044(context$3049,Scope$1619(scope$3050,it$0$3033.gensym((tag$4331+"/"))),body$4332);}else{if(($3077$3094&&((t0$3090>=1)&&((type$4342=$3055$3085[0]),((args$4343=Array.prototype.slice.call($3055$3085,1)),(it$0$3033.generic_nodes.indexOf(type$4342)!==-1)))))){return [type$4342].concat((((acc$4353=[])),(((temp$4359=args$4343)),((($length$4365=temp$4359.length)),((($index$4371=0)),function(){$4348:for(;($index$4371<$length$4365);($index$4371++)){var arg$4388;var m$4380;(m$4380=temp$4359[$index$4371]);(arg$4388=m$4380);acc$4353.push(helper$3044(["expr","expr"],scope$3050,arg$4388));}}()))),acc$4353));}else{(other$4393=$3055$3085);throw $4608(["syntax","illegal_node"]).create("An illegal node was found.",({"node":other$4393,"context":context$3049}));}}}}}}}}}}}}}}}}}}));return helper$3044(context$3027,scope$3028,expr$3029);});$1508(Expander$1622,$1508(((accum$4399=({})),((accum$4399["::name"]="Expander"),accum$4399)),((accum$4403=({})),((accum$4403["::egclass"]=true),accum$4403))));Expander$1622;(mac1$1623=function(f$4410){return ["macro",function(context$4416,scope$4417,form$4418,$4413$4419){var t0$4423;var t1$4424;var expr$4421;(t0$4423=$4413$4419);if(((t0$4423 instanceof Array)&&(((t1$4424=t0$4423.length)),((t1$4424===2)&&(t0$4423[0]==="data"))))){(expr$4421=t0$4423[1]);}else{$4589($4413$4419);}return f$4410(expr$4421);}];});(__chk_ncache$1624=({}));(__chk_scache$1625=({}));(checker_db$1626=function($4447$4450){var v$4495;var v$4514;var s$4508;var n$4489;var $4452$4465;var ph$4459;(ph$4459=$4447$4450);($4452$4465=ph$4459);if(($4452$4465===null)){return checker_db$1626.null;}else{if(($4452$4465===(void 0))){return checker_db$1626.undefined;}else{if(($4452$4465===true)){return checker_db$1626.true;}else{if(($4452$4465===false)){return checker_db$1626.false;}else{if((typeof($4452$4465)==="number")){(n$4489=$4452$4465);if($1507(__chk_ncache$1624,n$4489)){return $1507(__chk_ncache$1624,n$4489);}else{(v$4495=mac1$1623(function(x$4500){return ["send",["symbol","==="],["data",x$4500,["value",n$4489]]];}));(__chk_ncache$1624[n$4489]=v$4495);return v$4495;}}else{if((typeof($4452$4465)==="string")){(s$4508=$4452$4465);if(Object.prototype.hasOwnProperty.call(__chk_scache$1625,s$4508)){return $1507(__chk_scache$1625,s$4508);}else{(v$4514=mac1$1623(function(x$4519){return ["send",["symbol","==="],["data",x$4519,["value",s$4508]]];}));(__chk_scache$1625[s$4508]=v$4514);return v$4514;}}else{$4589($4452$4465);}}}}}}});$1508(checker_db$1626,({"String":mac1$1623(function(x$4530){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$4530]],["value","string"]]];}),"Number":mac1$1623(function(x$4534){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$4534]],["value","number"]]];}),"Array":mac1$1623(function(x$4538){return ["send",["symbol","instanceof"],["data",x$4538,["symbol","Array"]]];}),"true":mac1$1623(function(x$4542){return x$4542;}),"false":mac1$1623(function(x$4546){return ["send",["symbol","not"],["data",["void"],x$4546]];}),"null":mac1$1623(function(x$4550){return ["send",["symbol","==="],["data",x$4550,["value",null]]];}),"undefined":mac1$1623(function(x$4554){return ["send",["symbol","==="],["data",x$4554,["value",(void 0)]]];})}));(exports["Env"]=Env$1620);(exports["Scope"]=Scope$1619);(exports["track_location"]=track_location$1621);(exports["Expander"]=Expander$1622);(exports["GenSym"]=GenSym$1614);(exports["gensym"]=gensym$1615);(exports["mac1"]=mac1$1623);(exports["checker_db"]=checker_db$1626);
