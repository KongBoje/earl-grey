var $450=function(type$452){var f$455;(f$455=type$452["::check"]);;if((f$455===(void 0))){return function(value$460){return (value$460 instanceof type$452);};}else{return function(value$463){return f$455.call(type$452,value$463);};}};
var $465=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $466=function(temp$467$469){var ph$473;(ph$473=temp$467$469);;var m$471$478;(m$471$478=ph$473);;var bridge$472$483;var x$487;(bridge$472$483=m$471$478);if((((typeof(bridge$472$483)==="string")&&((x$487=bridge$472$483),true))||((typeof(bridge$472$483)==="number")&&((x$487=bridge$472$483),true)))){return ["value",x$487];}else{var other$494;(other$494=m$471$478);return other$494["::serialize_ast"]();}};
var send$313;(send$313=function(obj$318,temp$316$319){var ph$323;var msg$324;var t0$326;(t0$326=temp$316$319);(msg$324=t0$326);(ph$323=t0$326);;var m$321$330;(m$321$330=ph$323);;var bridge$322$335;(bridge$322$335=m$321$330);if(((typeof(bridge$322$335)==="string")||(typeof(bridge$322$335)==="number"))){return obj$318[msg$324];}else{var other$343;(other$343=m$321$330);return obj$318["::send"](msg$324);}});;(Array[":::project"]=function(temp$346$348){var ph$351;var value$352;var t0$354;(t0$354=temp$346$348);(value$352=t0$354);(ph$351=t0$354);;var m$350$358;(m$350$358=ph$351);;if($450(Array)(m$350$358)){return [true,value$352];}else{m$350$358;return [true,[value$352]];}});(Array.prototype["::check"]=function(value$372){if((value$372 instanceof Array)){var i$377;(i$377=0);;$375:for(;(i$377<this.length);(i$377++)){if(($465(this,i$377)!==$465(value$372,i$377))){return false;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value$386){if((value$386 instanceof Array)){var i$391;(i$391=0);;$389:for(;(i$391<this.length);(i$391++)){if(($465(this,i$391)!==$465(value$386,i$391))){return [true,[value$386]];}}return [true,value$386.slice(this.length)];}else{return [true,[value$386]];}});(Array.prototype[":::deconstruct"]=function(value$400){return [true,value$400.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($466));});(RegExp.prototype["::check"]=function(value$405){return value$405.match(this);});(RegExp.prototype[":::project"]=function(value$408){var m$410$412;(m$410$412=value$408.match(this));;var m$420;if((m$410$412===null)){(m$420=m$410$412);return [false,null];}else{var m$425;(m$425=m$410$412);return [true,m$425];}});(RegExp.prototype[":::deconstruct"]=function(value$428){var m$430$432;(m$430$432=value$428.match(this));;var m$440;if((m$430$432===null)){(m$440=m$430$432);return [false,null];}else{var m$445;(m$445=m$430$432);return [true,m$445];}});(Function.prototype["::send"]=function(args$448){return this.apply(this,args$448);});
var $2069=function(dest$2071,values$2072){var k$2077;(k$2077=null);$2075:for(k$2077 in values$2072){if(values$2072.hasOwnProperty(k$2077)){(dest$2071[k$2077]=values$2072[k$2077]);}}return dest$2071;};
var $2081=function(temp$2082$2084,key$2085){var ph$2089;(ph$2089=temp$2082$2084);;var m$2087$2094;(m$2087$2094=ph$2089);;var bridge$2088$2099;(bridge$2088$2099=m$2087$2094);if(((bridge$2088$2099===null)||(bridge$2088$2099===(void 0)))){return false;}else{var x$2107;if((typeof(m$2087$2094)==="string")){(x$2107=m$2087$2094);return (key$2085 in String.prototype);}else{var x$2112;if((typeof(m$2087$2094)==="number")){(x$2112=m$2087$2094);return (key$2085 in Number.prototype);}else{var x$2117;(x$2117=m$2087$2094);return (key$2085 in x$2117);}}}};
var $2119=function(){var $2120$2122;($2120$2122=function(tags$2126){var it$0$2129;(it$0$2129=function(){if((!$450($2120$2122)(this))){return Object.create($2120$2122.prototype);}else{return this;}}());;(it$0$2129["tags"]=tags$2126);return it$0$2129;});;($2120$2122.prototype["create"]=function(){var m$2138$2140;(m$2138$2140=arguments);;var t0$2145;var message$2149;var args$2150;(t0$2145=m$2138$2140.length);if((t0$2145>=0)){(message$2149=function(){if((0>=t0$2145)){return "";}else{return m$2138$2140[0];}}());(args$2150=Array.prototype.slice.call(m$2138$2140,1));var it$0$2154;(it$0$2154=this);;var e$2159;(e$2159=Error(message$2149));;(e$2159["::tags"]=it$0$2154.tags);(e$2159["args"]=args$2150);(e$2159["name"]=["E"].concat(it$0$2154.tags).join("."));return e$2159;}else{throw Error("mismatch!!");}});($2120$2122.prototype["::check"]=function(e$2168){var it$0$2171;(it$0$2171=this);;var tags$2176;if(((!e$2168)||(!$450(Error)(e$2168)))){return false;}(tags$2176=(e$2168["::tags"]||[]));;var temp$2184;(temp$2184=it$0$2171.tags);;var len$2189;(len$2189=temp$2184.length);;var i$2194;(i$2194=0);;$2181:for(;(i$2194<len$2189);(i$2194++)){var m$2202;(m$2202=temp$2184[i$2194]);;var tag$2210;(tag$2210=m$2202);if((tags$2176.indexOf(tag$2210)===(-1))){return false;}else{false;;}}return true;});($2120$2122.prototype["::deconstruct"]=function(e$2218){var it$0$2221;(it$0$2221=this);;return e$2218.args;});$2069($2120$2122,({}));return $2120$2122;}();var $498$501;var __lt____gt__$502;var $499$503;var __lt____lt____colon__$504;var util$505;var classify$506;var items$507;var iterkeys$508;var enumerate$509;var neighbours$510;var zip$511;var GenSym$512;var gensym$513;var uuid$514;var $500$515;var PatternParser$516;var PatternProcessor$517;var Scope$518;var Env$519;var bind_ast$520;var track_location$521;var Expander$522;var mac1$523;var __chk_ncache$524;var __chk_scache$525;var checker$526;($498$501=require("./pp"));;(__lt____gt__$502=$498$501["<>"]);;($499$503=require("./location"));;(__lt____lt____colon__$504=$499$503["<<:"]);;(util$505=require("./util"));;(classify$506=util$505.classify);;(items$507=util$505.items);;(iterkeys$508=util$505.keys);;(enumerate$509=util$505.enumerate);;(neighbours$510=util$505.neighbours);;(zip$511=util$505.zip);;(GenSym$512=util$505.GenSym);;(gensym$513=util$505.gensym);;(uuid$514=util$505.uuid);;($500$515=require("./pattern"));;(PatternParser$516=$500$515.PatternParser);;(PatternProcessor$517=$500$515.PatternProcessor);;(Scope$518=function(){var it$0$597;var parent$592;var name$593;var t0$588;var m$581$583;(m$581$583=arguments);;(t0$588=m$581$583.length);if(((t0$588>=0)&&(t0$588<=2))){(parent$592=function(){if((0>=t0$588)){return null;}else{return m$581$583[0];}}());(name$593=function(){if((1>=t0$588)){return null;}else{return m$581$583[1];}}());(it$0$597=function(){if((!$450(Scope$518)(this))){return Object.create(Scope$518.prototype);}else{return this;}}());;(it$0$597["name"]=(name$593||gensym$513("scope")));(it$0$597["parent"]=parent$592);(it$0$597["options"]=({}));return it$0$597;}else{throw Error("mismatch!!");}});;(Scope$518.prototype["getopt"]=function(opt$609){var otherwise$636;var $613$625;var m$612$619;var it$0$614;(it$0$614=this);;(m$612$619=null);;m$612$619;if((opt$609 in it$0$614.options)){return $465(it$0$614.options,opt$609);}else{if((it$0$614.parent===null)){return (void 0);}else{(otherwise$636=m$612$619);return it$0$614.parent.getopt(opt$609);}}});(Scope$518.prototype["setopt"]=function(opt$641,value$642){var it$0$645;(it$0$645=this);;return (it$0$645.options[opt$641]=value$642);});(Scope$518.prototype["toString"]=function(){var it$0$654;(it$0$654=this);;return (("Scope{"+it$0$654.name)+"}");});$2069(Scope$518,({}));Scope$518;(Env$519=function(){var it$0$663;(it$0$663=function(){if((!$450(Env$519)(this))){return Object.create(Env$519.prototype);}else{return this;}}());;(it$0$663["scopes"]=({}));return it$0$663;});;(Env$519.prototype["resolve"]=function(scope$672,name$673){var scope_data$681;var it$0$676;(it$0$676=this);;if((scope$672===null)){return (void 0);}(scope_data$681=$465(it$0$676.scopes,scope$672.name));;if((scope_data$681&&Object.prototype.hasOwnProperty.call(scope_data$681,name$673))){return $465(scope_data$681,name$673);}else{return it$0$676.resolve(scope$672.parent,name$673);}});(Env$519.prototype["bind"]=function(scope$689,name$690,value$691){var it$0$694;(it$0$694=this);;if((!$465(it$0$694.scopes,scope$689.name))){(it$0$694.scopes[scope$689.name]=({}));}return ($465(it$0$694.scopes,scope$689.name)[name$690]=value$691);});(Env$519.prototype["fork"]=function(){var i$727;var len$722;var temp$717;var e$710;var it$0$705;(it$0$705=this);;(e$710=Env$519());;(temp$717=items$507(it$0$705.scopes));;(len$722=temp$717.length);;(i$727=0);;$714:for(;(i$727<len$722);(i$727++)){var i$767;var len$762;var temp$757;var acc$752;var scope$745;var bindings$746;var t0$740;var t1$741;var m$735;(m$735=temp$717[i$727]);;(t0$740=m$735);if(((t0$740 instanceof Array)&&((t1$741=t0$740.length),(t1$741===2)))){(scope$745=t0$740[0]);(bindings$746=t0$740[1]);(acc$752=[]);;(temp$757=items$507(bindings$746));;(len$762=temp$757.length);;(i$767=0);;$750:for(;(i$767<len$762);(i$767++)){var k$785;var v$786;var t0$780;var t1$781;var m$775;(m$775=temp$757[i$767]);;(t0$780=m$775);if(((t0$780 instanceof Array)&&((t1$781=t0$780.length),(t1$781===2)))){(k$785=t0$780[0]);(v$786=t0$780[1]);acc$752.push((function(){if((!$465(e$710.scopes,scope$745))){return (e$710.scopes[scope$745]=({}));}}(),($465(e$710.scopes,scope$745)[k$785]=v$786)));}else{false;;}}acc$752;}else{false;;}}return e$710;});(Env$519.prototype["toString"]=function(){var it$0$801;(it$0$801=this);;return "Env{...}";});$2069(Env$519,({}));Env$519;(bind_ast$520=function(temp$807$809,env$810){var t0$820;var x$850;var x$855;var bridge$816$847;var x$860;var bridge$815$844;var x$865;var bridge$814$841;var x$870;var i$896;var len$891;var temp$886;var other$916;var type$877;var args$878;var e$834;var bridge$813$829;var t0$830;var m$812$824;var ph$817;var expr$818;(t0$820=temp$807$809);(expr$818=t0$820);(ph$817=t0$820);;(m$812$824=ph$817);;if($2081(m$812$824,"env")){(e$834=m$812$824.env);return expr$818;}else{(bridge$813$829=m$812$824);if((((bridge$814$841=bridge$813$829),(((bridge$815$844=bridge$814$841),(((bridge$816$847=bridge$815$844),((((x$850=bridge$816$847)),((x$850 instanceof Array)&&(x$850[0]==="symbol")))||(((x$855=bridge$816$847)),((x$855 instanceof Array)&&(x$855[0]==="value")))))||(((x$860=bridge$815$844)),((x$860 instanceof Array)&&(x$860[0]==="variable")))))||(((x$865=bridge$814$841)),((x$865 instanceof Array)&&(x$865[0]==="macro")))))||(((x$870=bridge$813$829)),((x$870 instanceof Array)&&(x$870[0]==="void"))))){return $2069(expr$818,({"env":env$810}));}else{if(((m$812$824 instanceof Array)&&((t0$830=m$812$824.length),(t0$830>=1)))){(type$877=m$812$824[0]);(args$878=Array.prototype.slice.call(m$812$824,1));(temp$886=args$878);;(len$891=temp$886.length);;(i$896=0);;$883:for(;(i$896<len$891);(i$896++)){var arg$912;var m$904;(m$904=temp$886[i$896]);;(arg$912=m$904);bind_ast$520(arg$912,env$810);}return $2069(expr$818,({"env":env$810}));}else{(other$916=m$812$824);return $2069(expr$818,({"env":env$810}));}}}});;(track_location$521=function(f$922){var f2$925;(f2$925=function(context$929,scope$930,expr$931){var rval$939;var other$971;var v$965;var t0$961;var m$934$956;var rval$935;(rval$935=(((rval$939=false)),(function(){try{(rval$939=f$922(context$929,scope$930,expr$931));}catch(excv$945){var e$951;(e$951=excv$945);(rval$939=(__lt____lt____colon__$504(e$951,expr$931),function(){throw e$951;}()));}}(),rval$939)));;(m$934$956=rval$935);;if(((m$934$956 instanceof Array)&&((t0$961=m$934$956.length),((t0$961===2)&&(m$934$956[0]==="bounce"))))){(v$965=m$934$956[1]);return f2$925(context$929,scope$930,__lt____lt____colon__$504(v$965,expr$931));}else{(other$971=m$934$956);return __lt____lt____colon__$504(other$971,expr$931);}});;return f2$925;});;(Expander$522=function(env_factory$978,generic_nodes$979){var it$0$982;(it$0$982=function(){if((!$450(Expander$522)(this))){return Object.create(Expander$522.prototype);}else{return this;}}());;(it$0$982["gensym"]=gensym$513);(it$0$982["mkenv"]=env_factory$978);(it$0$982["generic_nodes"]=generic_nodes$979);return it$0$982;});;(Expander$522.prototype["run_macro"]=function(m$992,context$993,scope$994,form$995,arg$996){var rval$1004;var it$0$999;(it$0$999=this);;(rval$1004=m$992(context$993,scope$994,form$995,arg$996));;bind_ast$520(rval$1004,it$0$999.mkenv());return rval$1004;});(Expander$522.prototype["step"]=function(context$1011,scope$1012,expr$1013){var helper$1021;var it$0$1016;(it$0$1016=this);;(helper$1021=track_location$521(function(context$1026,scope$1027,temp$1024$1028){var t0$1037;var other$1077;var env$1072;var m$1062$1064;var other$1110;var t0$1101;var m$1094$1096;var other$1114;var m$1090;var t0$1086;var m$1058$1081;var env$1059;var other$1137;var t0$1128;var m$1121$1123;var other$1162;var m$1156;var t0$1152;var m$1145$1147;var other$1171;var x$1166;var f$1141;var arg$1142;var m$1118;var s$1053;var $1031$1048;var $1032$1049;var $1033$1050;var t0$1046;var m$1030$1041;var ph$1034;var expr$1035;(t0$1037=temp$1024$1028);(expr$1035=t0$1037);(ph$1034=t0$1037);;(m$1030$1041=ph$1034);;if((($1031$1048=(m$1030$1041 instanceof Array))&&((t0$1046=m$1030$1041.length),(($1033$1050=(t0$1046===2))&&(m$1030$1041[0]==="symbol"))))){(s$1053=m$1030$1041[1]);(env$1059=(((m$1062$1064=expr$1035)),function(){if($2081(m$1062$1064,"env")){(env$1072=m$1062$1064.env);return expr$1035.env;}else{(other$1077=m$1062$1064);throw $2119(["syntax","no_env"]).create("No environment was found to resolve",({"symbol":expr$1035}));}}()));;(m$1058$1081=env$1059.resolve(scope$1027,s$1053));;if(((m$1058$1081 instanceof Array)&&((t0$1086=m$1058$1081.length),((t0$1086===2)&&(m$1058$1081[0]==="macro"))))){(m$1090=m$1058$1081[1]);(m$1094$1096=context$1026);;if(((m$1094$1096 instanceof Array)&&((t0$1101=m$1094$1096.length),((t0$1101===2)&&((m$1094$1096[0]==="expr")&&(m$1094$1096[1]==="head")))))){return ["macro",m$1090];}else{(other$1110=m$1094$1096);return ["bounce",it$0$1016.run_macro(m$1090,context$1026,scope$1027,expr$1035,["void"])];}}else{(other$1114=m$1058$1081);return expr$1035;}}else{if(($1033$1050&&(m$1030$1041[0]==="macro"))){(m$1118=m$1030$1041[1]);(m$1121$1123=context$1026);;if(((m$1121$1123 instanceof Array)&&((t0$1128=m$1121$1123.length),((t0$1128===2)&&((m$1121$1123[0]==="expr")&&(m$1121$1123[1]==="head")))))){return expr$1035;}else{(other$1137=m$1121$1123);return ["bounce",it$0$1016.run_macro(m$1118,context$1026,scope$1027,expr$1035,["void"])];}}else{if(($1031$1048&&((t0$1046===3)&&(m$1030$1041[0]==="send")))){(f$1141=m$1030$1041[1]);(arg$1142=m$1030$1041[2]);(m$1145$1147=helper$1021(["expr","head"],scope$1027,f$1141));;if(((m$1145$1147 instanceof Array)&&((t0$1152=m$1145$1147.length),((t0$1152===2)&&(m$1145$1147[0]==="macro"))))){(m$1156=m$1145$1147[1]);return ["bounce",it$0$1016.run_macro(m$1156,context$1026,scope$1027,expr$1035,arg$1142)];}else{(other$1162=m$1145$1147);return expr$1035;}}else{if(($1031$1048&&((t0$1046===2)&&(m$1030$1041[0]==="nostep")))){(x$1166=m$1030$1041[1]);return x$1166;}else{(other$1171=m$1030$1041);return expr$1035;}}}}}));;return helper$1021(context$1011,scope$1012,expr$1013);});(Expander$522.prototype["step_all"]=function(context$1178,scope$1179,temp$1176$1180){var t0$1184;var t1$1185;var pre$1197;var bulk$1198;var post$1199;var it$0$1191;var stmts$1182;(t0$1184=temp$1176$1180);if(((t0$1184 instanceof Array)&&((t1$1185=t0$1184.length),(t1$1185>=0)))){(stmts$1182=Array.prototype.slice.call(t0$1184,0));;}else{throw Error("Mismatch");}(it$0$1191=this);;(pre$1197=[]);;(bulk$1198=[]);;(post$1199=[]);;$1196:while(stmts$1182.length){var x$1254;var m$1249;var stmt$1244;var stmt$1239;var prepend$1233;var $1213$1228;var $1214$1229;var $1215$1230;var t0$1226;var m$1212$1221;var current$1216;(current$1216=stmts$1182.shift());;(m$1212$1221=it$0$1191.step(context$1178,scope$1179,current$1216));;if((($1213$1228=(m$1212$1221 instanceof Array))&&((t0$1226=m$1212$1221.length),((t0$1226>=1)&&(m$1212$1221[0]==="splice"))))){(prepend$1233=Array.prototype.slice.call(m$1212$1221,1));(stmts$1182=prepend$1233.concat(stmts$1182));}else{if(($1213$1228&&(($1215$1230=(t0$1226===2))&&(m$1212$1221[0]==="float")))){(stmt$1239=m$1212$1221[1]);(pre$1197=pre$1197.concat(it$0$1191.step_all(context$1178,scope$1179,[stmt$1239])));}else{if(($1215$1230&&(m$1212$1221[0]==="sink"))){(stmt$1244=m$1212$1221[1]);(post$1199=post$1199.concat(it$0$1191.step_all(context$1178,scope$1179,[stmt$1244])));}else{if(($1215$1230&&(m$1212$1221[0]==="multimacro"))){(m$1249=m$1212$1221[1]);(stmts$1182=m$1249(context$1178,scope$1179,current$1216,stmts$1182));}else{(x$1254=m$1212$1221);bulk$1198.push(x$1254);}}}}}return pre$1197.concat(bulk$1198).concat(post$1199);});(Expander$522.prototype["expand"]=function(context$1259,scope$1260,expr$1261){var helper$1269;var it$0$1264;(it$0$1264=this);;(helper$1269=track_location$521(function(context$1273,scope$1274,expr$1275){var t0$1306;var other$1323;var m$1303$1311;var env$1304;var i$1369;var len$1364;var temp$1359;var acc$1354;var newargs$1349;var i$1414;var len$1409;var temp$1404;var acc$1399;var newargs$1394;var t0$1458;var newscope$1452;var env$1453;var i$1505;var len$1500;var temp$1495;var acc$1490;var t0$1480;var newscope$1468;var stepscope$1469;var newargs$1470;var vars$1471;var exp$1472;var i$1715;var len$1710;var temp$1705;var other$1789;var t0$1772;var m$1765$1767;var is_obj$1627;var obj$1628;var arr$1629;var arr_parts$1630;var obj_parts$1631;var new_arr_part$1632;var new_obj_part$1633;var r$1634;var i$1831;var len$1826;var temp$1821;var acc$1816;var newscope$1809;var s$1892;var newscope$1900;var name$1887;var t0$1883;var i$1934;var len$1929;var temp$1924;var acc$1919;var other$1954;var type$1911;var args$1912;var tag$1904;var body$1905;var x$1878;var ph$1279$1879;var bindings$1804;var body$1805;var target$1798;var value$1799;var args$1623;var args$1464;var variable$1442;var s$1443;var value$1444;var body$1445;var args$1390;var args$1345;var f$1339;var arg$1340;var s$1298;var $1280$1293;var $1281$1294;var $1282$1295;var t0$1289;var t1$1290;var t2$1291;var m$1278$1284;(expr$1275=it$0$1264.step(context$1273,scope$1274,expr$1275));(m$1278$1284=expr$1275);;if((($1280$1293=(m$1278$1284 instanceof Array))&&((t0$1289=m$1278$1284.length),(($1282$1295=(t0$1289===2))&&(m$1278$1284[0]==="symbol"))))){(s$1298=m$1278$1284[1]);(t0$1306=expr$1275);if($2081(t0$1306,"env")){(env$1304=t0$1306.env);;}else{throw Error("Mismatch");}(m$1303$1311=env$1304.resolve(scope$1274,s$1298));;if((m$1303$1311===(void 0))){throw $2119(["syntax","undeclared"]).create(("Undeclared variable: "+s$1298),({"node":expr$1275}));}else{(other$1323=m$1303$1311);return ["bounce",other$1323];}}else{if(($1282$1295&&(m$1278$1284[0]==="value"))){m$1278$1284[1];return expr$1275;}else{if(($1282$1295&&(m$1278$1284[0]==="variable"))){m$1278$1284[1];return expr$1275;}else{if(($1280$1293&&((t0$1289===1)&&(m$1278$1284[0]==="void")))){return expr$1275;}else{if(($1280$1293&&((t0$1289===3)&&(m$1278$1284[0]==="send")))){(f$1339=m$1278$1284[1]);(arg$1340=m$1278$1284[2]);return ["send",helper$1269(["expr","head"],scope$1274,f$1339),helper$1269(["expr","tail"],scope$1274,arg$1340)];}else{if(($1280$1293&&(($1282$1295=(t0$1289>=1))&&(m$1278$1284[0]==="array")))){(args$1345=Array.prototype.slice.call(m$1278$1284,1));(newargs$1349=(((acc$1354=[])),(((temp$1359=it$0$1264.step_all(["expr","array"],scope$1274,args$1345))),(((len$1364=temp$1359.length)),(((i$1369=0)),function(){$1352:for(;(i$1369<len$1364);(i$1369++)){var arg$1385;var m$1377;(m$1377=temp$1359[i$1369]);;(arg$1385=m$1377);acc$1354.push(helper$1269(["expr","expr"],scope$1274,arg$1385));}}()))),acc$1354));;return ["array"].concat(newargs$1349);}else{if(($1282$1295&&(m$1278$1284[0]==="object"))){(args$1390=Array.prototype.slice.call(m$1278$1284,1));(newargs$1394=(((acc$1399=[])),(((temp$1404=it$0$1264.step_all(["expr","object"],scope$1274,args$1390))),(((len$1409=temp$1404.length)),(((i$1414=0)),function(){$1397:for(;(i$1414<len$1409);(i$1414++)){var k$1432;var v$1433;var t0$1427;var t1$1428;var m$1422;(m$1422=temp$1404[i$1414]);;(t0$1427=m$1422);if(((t0$1427 instanceof Array)&&((t1$1428=t0$1427.length),((t1$1428===3)&&(t0$1427[0]==="array"))))){(k$1432=t0$1427[1]);(v$1433=t0$1427[2]);acc$1399.push(["array",helper$1269(["expr","expr"],scope$1274,k$1432),helper$1269(["expr","expr"],scope$1274,v$1433)]);}else{false;;}}}()))),acc$1399));;return ["object"].concat(newargs$1394);}else{if(($1280$1293&&((t0$1289===4)&&((m$1278$1284[0]==="bind")&&((t1$1290=m$1278$1284[1]),((variable$1442=t1$1290),((t1$1290 instanceof Array)&&((t2$1291=t1$1290.length),((t2$1291===2)&&(t1$1290[0]==="symbol")))))))))){(s$1443=t1$1290[1]);(value$1444=m$1278$1284[2]);(body$1445=m$1278$1284[3]);(newscope$1452=Scope$518(scope$1274));;(t0$1458=variable$1442);if($2081(t0$1458,"env")){(env$1453=t0$1458.env);;}else{throw Error("Mismatch");}env$1453.bind(newscope$1452,s$1443,value$1444);return helper$1269(context$1273,newscope$1452,body$1445);}else{if(($1280$1293&&(($1282$1295=(t0$1289>=1))&&(m$1278$1284[0]==="multi")))){(args$1464=Array.prototype.slice.call(m$1278$1284,1));(newscope$1468=Scope$518(scope$1274));;(stepscope$1469=function(){if(expr$1275.nonrecursive){return scope$1274;}else{return newscope$1468;}}());;(t0$1480=classify$506("newargs","vars",(((acc$1490=[])),(((temp$1495=it$0$1264.step_all(["expr","multi"],stepscope$1469,args$1464))),(((len$1500=temp$1495.length)),(((i$1505=0)),function(){$1482:for(;(i$1505<len$1500);(i$1505++)){var t0$1551;var env$1548;var v$1549;var other$1568;var v$1560;var value$1561;var variable$1539;var s$1540;var value$1541;var opt$1531;var value$1532;var $1483$1523;var $1484$1524;var $1485$1525;var $1486$1526;var $1487$1527;var $1488$1528;var t0$1518;var t1$1519;var t2$1520;var t3$1521;var m$1513;(m$1513=temp$1495[i$1505]);;(t0$1518=m$1513);if((($1484$1524=(t0$1518 instanceof Array))&&((t1$1519=t0$1518.length),((t1$1519===3)&&(t0$1518[0]==="option"))))){(opt$1531=t0$1518[1]);(value$1532=t0$1518[2]);acc$1490.push((newscope$1468.setopt(opt$1531,value$1532),["ignore"]));}else{if(($1484$1524&&(($1486$1526=((t1$1519>=2)&&(t1$1519<=3)))&&(($1487$1527=(t0$1518[0]==="declare"))&&((t2$1520=t0$1518[1]),((variable$1539=t2$1520),((t2$1520 instanceof Array)&&((t3$1521=t2$1520.length),((t3$1521===2)&&(t2$1520[0]==="symbol")))))))))){(s$1540=t2$1520[1]);(value$1541=function(){if((2>=t1$1519)){return null;}else{return t0$1518[2];}}());acc$1490.push((((t0$1551=variable$1539),function(){if($2081(t0$1551,"env")){(env$1548=t0$1551.env);}else{throw Error("Mismatch");}}()),((v$1549=__lt____lt____colon__$504(["variable",it$0$1264.gensym(s$1540)],variable$1539))),env$1548.bind(newscope$1468,s$1540,v$1549),function(){if(value$1541){return ["splice",["newargs",["assign",v$1549,value$1541]],["vars",v$1549]];}else{return ["vars",v$1549];}}()));}else{if(($1487$1527&&((v$1560=t2$1520),((t2$1520 instanceof Array)&&((t3$1521=t2$1520.length),((t3$1521===2)&&(t2$1520[0]==="variable"))))))){t2$1520[1];(value$1561=function(){if((2>=t1$1519)){return null;}else{return t0$1518[2];}}());acc$1490.push(function(){if(value$1561){return ["splice",["newargs",["assign",v$1560,value$1561]],["vars",v$1560]];}else{return ["vars",v$1560];}}());}else{(other$1568=m$1513);acc$1490.push(["newargs",other$1568]);}}}}}()))),acc$1490)));if(($2081(t0$1480,"newargs")&&((newargs$1470=t0$1480.newargs),$2081(t0$1480,"vars")))){(vars$1471=t0$1480.vars);;}else{throw Error("Mismatch");}(exp$1472=function(s$1576){var i$1595;var len$1590;var temp$1585;var acc$1580;(acc$1580=[]);;(temp$1585=enumerate$509(newargs$1470));;(len$1590=temp$1585.length);;(i$1595=0);;$1578:for(;(i$1595<len$1590);(i$1595++)){var i$1613;var arg$1614;var t0$1608;var t1$1609;var m$1603;(m$1603=temp$1585[i$1595]);;(t0$1608=m$1603);if(((t0$1608 instanceof Array)&&((t1$1609=t0$1608.length),(t1$1609===2)))){(i$1613=t0$1608[0]);(arg$1614=t0$1608[1]);acc$1580.push(helper$1269(["expr",function(){if((i$1613===(newargs$1470.length-1))){return "expr";}else{return "ignore";}}()],s$1576,arg$1614));}else{false;;}}return acc$1580;});;if(vars$1471.length){return ["scope",vars$1471,["multi"].concat(exp$1472(newscope$1468))];}else{return ["multi"].concat(exp$1472(scope$1274));}}else{if(($1282$1295&&(m$1278$1284[0]==="data"))){(args$1623=Array.prototype.slice.call(m$1278$1284,1));(is_obj$1627=false);;(obj$1628=["object"]);;(arr$1629=["array"]);;(arr_parts$1630=[]);;(obj_parts$1631=[]);;(new_arr_part$1632=function(){var other$1670;var t0$1661;var m$1654$1656;(m$1654$1656=arr$1629);;if(((m$1654$1656 instanceof Array)&&((t0$1661=m$1654$1656.length),((t0$1661===1)&&(m$1654$1656[0]==="array"))))){return false;}else{(other$1670=m$1654$1656);arr_parts$1630.push(arr$1629);return (arr$1629=["array"]);}});;(new_obj_part$1633=function(){var other$1694;var t0$1685;var m$1678$1680;(m$1678$1680=obj$1628);;if(((m$1678$1680 instanceof Array)&&((t0$1685=m$1678$1680.length),((t0$1685===1)&&(m$1678$1680[0]==="object"))))){return false;}else{(other$1694=m$1678$1680);obj_parts$1631.push(obj$1628);return (obj$1628=["object"]);}});;(temp$1705=it$0$1264.step_all(["expr","data"],scope$1274,args$1623));;(len$1710=temp$1705.length);;(i$1715=0);;$1698:for(;(i$1715<len$1710);(i$1715++)){var other$1761;var expr$1755;var expr$1749;var k$1742;var v$1743;var $1699$1731;var $1700$1732;var $1701$1733;var $1702$1734;var t0$1728;var t1$1729;var m$1723;(m$1723=temp$1705[i$1715]);;(t0$1728=m$1723);if((($1700$1732=(t0$1728 instanceof Array))&&((t1$1729=t0$1728.length),((t1$1729===1)&&(t0$1728[0]==="assoc"))))){(is_obj$1627=true);}else{if(($1700$1732&&((t1$1729===3)&&(t0$1728[0]==="assoc")))){(k$1742=t0$1728[1]);(v$1743=t0$1728[2]);(is_obj$1627=true);obj$1628.push(["array",k$1742,v$1743]);}else{if(($1700$1732&&(($1702$1734=(t1$1729===2))&&(t0$1728[0]==="dynsplice")))){(expr$1749=t0$1728[1]);new_arr_part$1632();arr_parts$1630.push(expr$1749);}else{if(($1702$1734&&(t0$1728[0]==="objsplice"))){(expr$1755=t0$1728[1]);(is_obj$1627=true);new_obj_part$1633();obj_parts$1631.push(expr$1755);}else{(other$1761=m$1723);arr$1629.push(other$1761);}}}}}new_arr_part$1632();new_obj_part$1633();(r$1634=(((m$1765$1767=arr_parts$1630)),function(){if(((m$1765$1767 instanceof Array)&&((t0$1772=m$1765$1767.length),((t0$1772===0)&&is_obj$1627)))){return util$505.construct(obj_parts$1631,function(x$1780,rest$1781){return ["send",["symbol","&:"],["data",x$1780,rest$1781]];},["object"]);}else{m$1765$1767;if(is_obj$1627){throw $2119(["syntax","array","object"]).create("Cannot mix array and object notations.");}else{(other$1789=m$1765$1767);return util$505.construct(arr_parts$1630.reverse(),function(x$1792,rest$1793){return ["send",["send",rest$1793,["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",x$1792]];},["array"]);}}}()));;return helper$1269(context$1273,scope$1274,bind_ast$520(r$1634,it$0$1264.mkenv()));}else{if(($1280$1293&&(($1282$1295=(t0$1289===3))&&(m$1278$1284[0]==="assign")))){(target$1798=m$1278$1284[1]);(value$1799=m$1278$1284[2]);return ["assign",helper$1269(["expr"],scope$1274,target$1798),helper$1269(["expr"],scope$1274,value$1799)];}else{if(($1282$1295&&(m$1278$1284[0]==="lambda"))){(bindings$1804=m$1278$1284[1]);(body$1805=m$1278$1284[2]);(newscope$1809=Scope$518(scope$1274));;return ["lambda",(((acc$1816=[])),(((temp$1821=bindings$1804)),(((len$1826=temp$1821.length)),(((i$1831=0)),function(){$1813:for(;(i$1831<len$1826);(i$1831++)){var v$1857;var x$1867;var other$1874;var v$1864;var b$1850;var env$1851;var $1814$1847;var t0$1844;var t1$1845;var m$1839;(m$1839=temp$1821[i$1831]);;(t0$1844=m$1839);if(((t0$1844 instanceof Array)&&((t1$1845=t0$1844.length),((t1$1845===2)&&((t0$1844[0]==="symbol")&&((b$1850=t0$1844[1]),$2081(t0$1844,"env"))))))){(env$1851=t0$1844.env);acc$1816.push((((v$1857=["variable",it$0$1264.gensym(b$1850)])),(env$1851.bind(newscope$1809,b$1850,v$1857),v$1857)));}else{if((((x$1867=t0$1844)),((x$1867 instanceof Array)&&(x$1867[0]==="variable")))){(v$1864=t0$1844);acc$1816.push(v$1864);}else{(other$1874=m$1839);acc$1816.push(function(){throw $2119(["syntax","lambda","binding"]).create("Not a valid binding.",({"node":other$1874}));}());}}}}()))),acc$1816),helper$1269(["expr","expr"],newscope$1809,body$1805)];}else{if(($1282$1295&&(m$1278$1284[0]==="use"))){(ph$1279$1879=m$1278$1284[1]);(x$1878=m$1278$1284[2]);(t0$1883=ph$1279$1879);if((typeof(t0$1883)==="string")){(name$1887=t0$1883);(s$1892=scope$1274);;$1891:while(s$1892){if((s$1892.name.slice(0,(name$1887.length+1))===(name$1887+"/"))){break $1891;}else{(s$1892=s$1892.parent);}}if(s$1892){return helper$1269(context$1273,s$1892,x$1878);}else{throw $2119(["syntax","noscope"]).create(("Could not find a scope tagged: "+name$1887));}}else{(newscope$1900=ph$1279$1879);return helper$1269(context$1273,newscope$1900,x$1878);}}else{if(($1282$1295&&((m$1278$1284[0]==="tagscope")&&((t1$1290=m$1278$1284[1]),(typeof(t1$1290)==="string"))))){(tag$1904=t1$1290);(body$1905=m$1278$1284[2]);return helper$1269(context$1273,Scope$518(scope$1274,it$0$1264.gensym((tag$1904+"/"))),body$1905);}else{if(($1280$1293&&((t0$1289>=1)&&((type$1911=m$1278$1284[0]),((args$1912=Array.prototype.slice.call(m$1278$1284,1)),(it$0$1264.generic_nodes.indexOf(type$1911)!==(-1))))))){return [type$1911].concat((((acc$1919=[])),(((temp$1924=args$1912)),(((len$1929=temp$1924.length)),(((i$1934=0)),function(){$1917:for(;(i$1934<len$1929);(i$1934++)){var arg$1950;var m$1942;(m$1942=temp$1924[i$1934]);;(arg$1950=m$1942);acc$1919.push(helper$1269(["expr","expr"],scope$1274,arg$1950));}}()))),acc$1919));}else{(other$1954=m$1278$1284);throw $2119(["syntax","illegal_node"]).create("An illegal node was found.",({"node":other$1954,"context":context$1273}));}}}}}}}}}}}}}}}}));;return helper$1269(context$1259,scope$1260,expr$1261);});$2069(Expander$522,({}));Expander$522;(mac1$523=function(f$1960){return ["macro",function(context$1964,scope$1965,form$1966,temp$1962$1967){var t0$1971;var t1$1972;var expr$1969;(t0$1971=temp$1962$1967);if(((t0$1971 instanceof Array)&&((t1$1972=t0$1971.length),((t1$1972===2)&&(t0$1971[0]==="data"))))){(expr$1969=t0$1971[1]);;}else{throw Error("Mismatch");}return f$1960(expr$1969);}];});;(__chk_ncache$524=({}));;(__chk_scache$525=({}));;(checker$526=function(temp$1986$1988){var v$2024;var v$2037;var s$2033;var n$2020;var m$1990$1996;var ph$1991;(ph$1991=temp$1986$1988);;(m$1990$1996=ph$1991);;if((m$1990$1996===null)){return checker$526.null;}else{if((m$1990$1996===(void 0))){return checker$526.undefined;}else{if((m$1990$1996===true)){return checker$526.true;}else{if((m$1990$1996===false)){return checker$526.false;}else{if((typeof(m$1990$1996)==="number")){(n$2020=m$1990$1996);if($465(__chk_ncache$524,n$2020)){return $465(__chk_ncache$524,n$2020);}else{(v$2024=mac1$523(function(x$2028){return ["send",["symbol","=="],["data",x$2028,["value",n$2020]]];}));;(__chk_ncache$524[n$2020]=v$2024);return v$2024;}}else{if((typeof(m$1990$1996)==="string")){(s$2033=m$1990$1996);if(Object.prototype.hasOwnProperty.call(__chk_scache$525,s$2033)){return $465(__chk_scache$525,s$2033);}else{(v$2037=mac1$523(function(x$2041){return ["send",["symbol","=="],["data",x$2041,["value",s$2033]]];}));;(__chk_scache$525[s$2033]=v$2037);return v$2037;}}else{throw Error("mismatch!!");}}}}}}});;$2069(checker$526,({"String":mac1$523(function(x$2048){return ["send",["symbol","=="],["data",["send",["symbol","typeof"],["data",x$2048]],["value","string"]]];}),"Number":mac1$523(function(x$2051){return ["send",["symbol","=="],["data",["send",["symbol","typeof"],["data",x$2051]],["value","number"]]];}),"Array":mac1$523(function(x$2054){return ["send",["symbol","instanceof"],["data",x$2054,["symbol","Array"]]];}),"true":mac1$523(function(x$2057){return x$2057;}),"false":mac1$523(function(x$2060){return ["send",["symbol","not"],["data",["void"],x$2060]];}),"null":mac1$523(function(x$2063){return ["send",["symbol","=="],["data",x$2063,["value",null]]];}),"undefined":mac1$523(function(x$2066){return ["send",["symbol","=="],["data",x$2066,["value",(void 0)]]];})}));(exports["Env"]=Env$519);(exports["Scope"]=Scope$518);(exports["track_location"]=track_location$521);(exports["Expander"]=Expander$522);(exports["GenSym"]=GenSym$512);(exports["gensym"]=gensym$513);(exports["bind_ast"]=bind_ast$520);(exports["mac1"]=mac1$523);(exports["checker"]=checker$526);
