var $1249=function(type$1251){var f$1254;(f$1254=type$1251["::check"]);if((f$1254===(void 0))){return function(value$1259){return (value$1259 instanceof type$1251);};}else{return function(value$1262){return f$1254.call(type$1251,value$1262);};}};
var $1264=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $1265=function(dest$1267,values$1268){var k$1273;(k$1273=null);$1271:for(k$1273 in values$1268){if(values$1268.hasOwnProperty(k$1273)){(dest$1267[k$1273]=values$1268[k$1273]);}}return dest$1267;};
var $1280=function($1281$1283){var ph$1287;(ph$1287=$1281$1283);var $1285$1292;($1285$1292=ph$1287);var bridge$1286$1297;var x$1301;(bridge$1286$1297=$1285$1292);if((((typeof(bridge$1286$1297)==="string")&&((x$1301=bridge$1286$1297),true))||((typeof(bridge$1286$1297)==="number")&&((x$1301=bridge$1286$1297),true)))){return ["value",x$1301];}else{var other$1311;(other$1311=$1285$1292);return other$1311["::serialize_ast"]();}};
var send$1056;(send$1056=function(obj$1061,$1059$1062){var ph$1066;var msg$1067;var t0$1069;(t0$1069=$1059$1062);(msg$1067=t0$1069);(ph$1066=t0$1069);var $1064$1076;($1064$1076=ph$1066);var bridge$1065$1081;(bridge$1065$1081=$1064$1076);if(((typeof(bridge$1065$1081)==="string")||(typeof(bridge$1065$1081)==="number"))){return obj$1061[msg$1067];}else{var other$1092;(other$1092=$1064$1076);return obj$1061["::send"](msg$1067);}});(Array[":::project"]=function($1097$1099){var ph$1102;var value$1103;var t0$1105;(t0$1105=$1097$1099);(value$1103=t0$1105);(ph$1102=t0$1105);var $1101$1112;($1101$1112=ph$1102);if($1249(Array)($1101$1112)){return [true,value$1103];}else{$1101$1112;return [true,[value$1103]];}});(Array.prototype["::check"]=function(value$1129){if((value$1129 instanceof Array)){var i$1134;(i$1134=0);$1132:for(;(i$1134<this.length);(i$1134++)){if(($1264(this,i$1134)!==$1264(value$1129,i$1134))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $1265(this.slice(0),this);});(Array.prototype[":::project"]=function(value$1151){if((value$1151 instanceof Array)){var i$1156;(i$1156=0);$1154:for(;(i$1156<this.length);(i$1156++)){if(($1264(this,i$1156)!==$1264(value$1151,i$1156))){return [true,[value$1151]];}}return [true,value$1151.slice(this.length)];}else{return [true,[value$1151]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($1280));});(RegExp.prototype["::check"]=function($1172$1174){var ph$1177;(ph$1177=$1172$1174);var $1176$1182;($1176$1182=ph$1177);var value$1190;if((typeof($1176$1182)==="string")){(value$1190=$1176$1182);if(value$1190.match(this)){return true;}else{return false;}}else{var other$1195;(other$1195=$1176$1182);return false;}});(RegExp.prototype[":::project"]=function($1200$1202){var ph$1205;(ph$1205=$1200$1202);var $1204$1210;($1204$1210=ph$1205);var value$1218;if((typeof($1204$1210)==="string")){(value$1218=$1204$1210);var $1221$1223;($1221$1223=value$1218.match(this));var m$1231;if(($1221$1223===null)){(m$1231=$1221$1223);return [false,null];}else{var m$1236;(m$1236=$1221$1223);return [true,m$1236];}}else{var other$1240;(other$1240=$1204$1210);return [false,null];}});(Function.prototype["::send"]=function(args$1246){return this.apply(this,args$1246);});
var $3905=function(arr$3907){var results$3911;var l$3912;(results$3911=[]);(l$3912=arr$3907.length);var i$3920;(i$3920=0);$3910:for(;(i$3920<l$3912);(i$3920++)){results$3911.push([i$3920,$1264(arr$3907,i$3920)]);}return results$3911;};
var $3709=function(){var $3710$3712;($3710$3712=function(tags$3716){var it$0$3719;(it$0$3719=function(){if((!$1249($3710$3712)(this))){return Object.create($3710$3712.prototype);}else{return this;}}());(it$0$3719["tags"]=tags$3716);return it$0$3719;});($3710$3712.prototype["create"]=function(){var $3731$3733;($3731$3733=arguments);var t0$3738;var message$3742;var args$3743;(t0$3738=$3731$3733.length);if((t0$3738>=0)){(message$3742=function(){if((0>=t0$3738)){return "";}else{return $3731$3733[0];}}());(args$3743=Array.prototype.slice.call($3731$3733,1));var it$0$3750;(it$0$3750=this);var self$3755;(self$3755=this);var e$3760;(e$3760=Error(message$3742));(e$3760["::tags"]=it$0$3750.tags);(e$3760["args"]=args$3743);var temp$3774;(temp$3774=$3905(args$3743));var $length$3779;($length$3779=temp$3774.length);var $index$3784;($index$3784=0);$3761:for(;($index$3784<$length$3779);($index$3784++)){var m$3792;(m$3792=temp$3774[$index$3784]);var t0$3797;var t1$3798;var i$3802;var arg$3803;(t0$3797=m$3792);if(((t0$3797 instanceof Array)&&(((t1$3798=t0$3797.length)),(t1$3798===2)))){(i$3802=t0$3797[0]);(arg$3803=t0$3797[1]);(e$3760[i$3802]=arg$3803);}else{$3693(m$3792);}}(e$3760["length"]=args$3743.length);(e$3760["name"]=["E"].concat(it$0$3750.tags).join("."));return e$3760;}else{$3693($3731$3733);}});($3710$3712.prototype["::check"]=function(e$3829){var it$0$3832;(it$0$3832=this);var self$3837;(self$3837=this);var tags$3842;if(((!e$3829)||(!$1249(Error)(e$3829)))){return false;}(tags$3842=(e$3829["::tags"]||[]));var temp$3851;(temp$3851=it$0$3832.tags);var $length$3856;($length$3856=temp$3851.length);var $index$3861;($index$3861=0);$3843:for(;($index$3861<$length$3856);($index$3861++)){var m$3869;(m$3869=temp$3851[$index$3861]);var tag$3877;(tag$3877=m$3869);if((tags$3842.indexOf(tag$3877)===-1)){return false;}else{false;}}return true;});($3710$3712.prototype["::deconstruct"]=function(e$3885){var it$0$3888;(it$0$3888=this);var self$3893;(self$3893=this);return e$3885.args;});$1265($3710$3712,$1265(function(){var accum$3898;(accum$3898=({}));(accum$3898["::name"]="$3710");return accum$3898;}(),function(){var accum$3902;(accum$3902=({}));(accum$3902["::egclass"]=true);return accum$3902;}()));return $3710$3712;}();
var $3693=function(value$3695,url$3696,start$3697,end$3698){var err$3701;(err$3701=$3709(["match"]).create("Could not find a match for value",({"value":value$3695})));if(url$3696){(err$3701["location"]=["location",url$3696,start$3697,end$3698]);}throw err$3701;};
var $3927=function($3928$3930,key$3931){var ph$3935;(ph$3935=$3928$3930);var $3933$3940;($3933$3940=ph$3935);var bridge$3934$3945;(bridge$3934$3945=$3933$3940);if(((bridge$3934$3945===null)||(bridge$3934$3945===(void 0)))){return false;}else{var x$3956;if((typeof($3933$3940)==="string")){(x$3956=$3933$3940);return (key$3931 in String.prototype);}else{var x$3961;if((typeof($3933$3940)==="number")){(x$3961=$3933$3940);return (key$3931 in Number.prototype);}else{var x$3966;(x$3966=$3933$3940);return (key$3931 in x$3966);}}}};
var $3968=function(obj$3970){var results$3974;(results$3974=[]);var k$3979;(k$3979=null);$3973:for(k$3979 in obj$3970){if(Object.prototype.hasOwnProperty.call(obj$3970,k$3979)){results$3974.push([k$3979,$1264(obj$3970,k$3979)]);}}return results$3974;};
var $3983=function(type$3985){return function(value$3988){var f$3991;(f$3991=type$3985[":::project"]);if((f$3991===(void 0))){(f$3991=type$3985["::project"]);if((f$3991===(void 0))){return [true,type$3985(value$3988)];}else{var rval$4000;(rval$4000=false);try{(rval$4000=[true,f$3991(value$3988)]);}catch(excv$4009){var e$4015;(e$4015=excv$4009);(rval$4000=[false,null]);}return rval$4000;}}else{return f$3991.call(type$3985,value$3988);}};};var accum$1556;var accum$1560;var accum$1892;var accum$1896;var accum$3538;var accum$3542;var $1315$1319;var __lt____gt__$1320;var $1316$1321;var __lt____lt____colon__$1322;var util$1323;var classify$1324;var neighbours$1325;var GenSym$1326;var gensym$1327;var uuid$1328;var $1318$1329;var PatternParser$1330;var PatternProcessor$1331;var Scope$1332;var Env$1333;var track_location$1334;var Expander$1335;var mac1$1336;var __chk_ncache$1337;var __chk_scache$1338;var checker_db$1339;($1315$1319=require("./pp"));(__lt____gt__$1320=$1315$1319["<>"]);($1316$1321=require("./location"));(__lt____lt____colon__$1322=$1316$1321["<<:"]);(util$1323=require("./util"));(classify$1324=util$1323.classify);(neighbours$1325=util$1323.neighbours);(GenSym$1326=util$1323.GenSym);(gensym$1327=util$1323.gensym);(uuid$1328=util$1323.uuid);($1318$1329=require("./pattern"));(PatternParser$1330=$1318$1329.PatternParser);(PatternProcessor$1331=$1318$1329.PatternProcessor);(Scope$1332=function(){var it$0$1402;var parent$1393;var name$1394;var expander$1395;var t0$1389;var $1382$1384;($1382$1384=arguments);(t0$1389=$1382$1384.length);if(((t0$1389>=0)&&(t0$1389<=3))){(parent$1393=function(){if((0>=t0$1389)){return null;}else{return $1382$1384[0];}}());(name$1394=function(){if((1>=t0$1389)){return null;}else{return $1382$1384[1];}}());(expander$1395=function(){if((2>=t0$1389)){return null;}else{return $1382$1384[2];}}());(it$0$1402=function(){if((!$1249(Scope$1332)(this))){return Object.create(Scope$1332.prototype);}else{return this;}}());(it$0$1402["name"]=(name$1394||gensym$1327("scope")));(it$0$1402["parent"]=parent$1393);(it$0$1402["options"]=({}));(it$0$1402["expander"]=(expander$1395||parent$1393.expander));return it$0$1402;}else{$3693($1382$1384);}});(Scope$1332.prototype["getopt"]=function(opt$1426){var otherwise$1458;var $1435$1447;var $1434$1441;var self$1436;var it$0$1429;(it$0$1429=this);(self$1436=this);($1434$1441=null);$1434$1441;if(Object.prototype.hasOwnProperty.call(it$0$1429.options,opt$1426)){return $1264(it$0$1429.options,opt$1426);}else{if((it$0$1429.parent===null)){return (void 0);}else{(otherwise$1458=$1434$1441);return it$0$1429.parent.getopt(opt$1426);}}});(Scope$1332.prototype["setopt"]=function(opt$1463,value$1464){var self$1472;var it$0$1467;(it$0$1467=this);(self$1472=this);(it$0$1467.options[opt$1463]=value$1464);});(Scope$1332.prototype["gensym"]=function(){var self$1489;var it$0$1484;(it$0$1484=this);(self$1489=this);return it$0$1484.expander.gensym();});(Scope$1332.prototype["step"]=function(context$1496,expr$1497){var self$1505;var it$0$1500;(it$0$1500=this);(self$1505=this);return it$0$1500.expander.step(context$1496,it$0$1500,expr$1497);});(Scope$1332.prototype["step_all"]=function(context$1512,exprs$1513){var self$1521;var it$0$1516;(it$0$1516=this);(self$1521=this);return it$0$1516.expander.step_all(context$1512,it$0$1516,exprs$1513);});(Scope$1332.prototype["expand"]=function(context$1528,expr$1529){var self$1537;var it$0$1532;(it$0$1532=this);(self$1537=this);return it$0$1532.expander.expand(context$1528,it$0$1532,expr$1529);});(Scope$1332.prototype["toString"]=function(){var self$1551;var it$0$1546;(it$0$1546=this);(self$1551=this);return (("Scope{"+it$0$1546.name)+"}");});$1265(Scope$1332,$1265(((accum$1556=({})),((accum$1556["::name"]="Scope"),accum$1556)),((accum$1560=({})),((accum$1560["::egclass"]=true),accum$1560))));Scope$1332;(Env$1333=function(){var it$0$1568;(it$0$1568=function(){if((!$1249(Env$1333)(this))){return Object.create(Env$1333.prototype);}else{return this;}}());(it$0$1568["scopes"]=({}));return it$0$1568;});(Env$1333.prototype["resolve"]=function(scope$1580,name$1581){var scope_data$1594;var self$1589;var it$0$1584;(it$0$1584=this);(self$1589=this);if((scope$1580===null)){return (void 0);}(scope_data$1594=$1264(it$0$1584.scopes,scope$1580.name));if((scope_data$1594&&Object.prototype.hasOwnProperty.call(scope_data$1594,name$1581))){return $1264(scope_data$1594,name$1581);}else{return it$0$1584.resolve(scope$1580.parent,name$1581);}});(Env$1333.prototype["bind"]=function(scope$1602,name$1603,value$1604){var self$1612;var it$0$1607;(it$0$1607=this);(self$1612=this);if((!$1264(it$0$1607.scopes,scope$1602.name))){(it$0$1607.scopes[scope$1602.name]=({}));}($1264(it$0$1607.scopes,scope$1602.name)[name$1603]=value$1604);});(Env$1333.prototype["convert"]=function(expr$1627){var x$1683;var x$1688;var bridge$1639$1677;var x$1693;var bridge$1638$1671;var x$1698;var bridge$1637$1665;var x$1703;var $index$1733;var $length$1728;var temp$1723;var other$1753;var type$1710;var args$1711;var e$1655;var bridge$1636$1650;var t0$1651;var $1635$1645;var self$1640;var it$0$1630;(it$0$1630=this);(self$1640=this);($1635$1645=expr$1627);if($3927($1635$1645,"env")){(e$1655=$1635$1645.env);return expr$1627;}else{(bridge$1636$1650=$1635$1645);if(((((bridge$1637$1665=bridge$1636$1650)),((((bridge$1638$1671=bridge$1637$1665)),((((bridge$1639$1677=bridge$1638$1671)),((((x$1683=bridge$1639$1677)),((x$1683 instanceof Array)&&(x$1683[0]==="symbol")))||(((x$1688=bridge$1639$1677)),((x$1688 instanceof Array)&&(x$1688[0]==="value")))))||(((x$1693=bridge$1638$1671)),((x$1693 instanceof Array)&&(x$1693[0]==="variable")))))||(((x$1698=bridge$1637$1665)),((x$1698 instanceof Array)&&(x$1698[0]==="macro")))))||(((x$1703=bridge$1636$1650)),((x$1703 instanceof Array)&&(x$1703[0]==="void"))))){return $1265(expr$1627,({"env":it$0$1630}));}else{if((($1635$1645 instanceof Array)&&(((t0$1651=$1635$1645.length)),(t0$1651>=1)))){(type$1710=$1635$1645[0]);(args$1711=Array.prototype.slice.call($1635$1645,1));(temp$1723=args$1711);($length$1728=temp$1723.length);($index$1733=0);$1719:for(;($index$1733<$length$1728);($index$1733++)){var arg$1749;var m$1741;(m$1741=temp$1723[$index$1733]);(arg$1749=m$1741);it$0$1630.convert(arg$1749);}return $1265(expr$1627,({"env":it$0$1630}));}else{(other$1753=$1635$1645);return $1265(expr$1627,({"env":it$0$1630}));}}}});(Env$1333.prototype["fork"]=function(){var $index$1788;var $length$1783;var temp$1778;var e$1770;var self$1765;var it$0$1760;(it$0$1760=this);(self$1765=this);(e$1770=Env$1333());(temp$1778=$3968(it$0$1760.scopes));($length$1783=temp$1778.length);($index$1788=0);$1771:for(;($index$1788<$length$1783);($index$1788++)){var $index$1835;var $length$1830;var temp$1825;var acc$1820;var scope$1806;var bindings$1807;var t0$1801;var t1$1802;var m$1796;(m$1796=temp$1778[$index$1788]);(t0$1801=m$1796);if(((t0$1801 instanceof Array)&&(((t1$1802=t0$1801.length)),(t1$1802===2)))){(scope$1806=t0$1801[0]);(bindings$1807=t0$1801[1]);(acc$1820=[]);(temp$1825=$3968(bindings$1807));($length$1830=temp$1825.length);($index$1835=0);$1817:for(;($index$1835<$length$1830);($index$1835++)){var k$1853;var v$1854;var t0$1848;var t1$1849;var m$1843;(m$1843=temp$1825[$index$1835]);(t0$1848=m$1843);if(((t0$1848 instanceof Array)&&(((t1$1849=t0$1848.length)),(t1$1849===2)))){(k$1853=t0$1848[0]);(v$1854=t0$1848[1]);acc$1820.push((function(){if((!$1264(e$1770.scopes,scope$1806))){(e$1770.scopes[scope$1806]=({}));}}(),(($1264(e$1770.scopes,scope$1806)[k$1853]=v$1854))));}else{$3693(m$1843,"/home/olivier/git/earl-grey/src/expand.eg",1955,2112);}}acc$1820;}else{$3693(m$1796,"/home/olivier/git/earl-grey/src/expand.eg",1915,2112);}}return e$1770;});(Env$1333.prototype["toString"]=function(){var self$1887;var it$0$1882;(it$0$1882=this);(self$1887=this);return "Env{...}";});$1265(Env$1333,$1265(((accum$1892=({})),((accum$1892["::name"]="Env"),accum$1892)),((accum$1896=({})),((accum$1896["::egclass"]=true),accum$1896))));Env$1333;(track_location$1334=function(f$1902){var f2$1905;(f2$1905=function(context$1909,scope$1910,expr$1911){var rval$1919;var other$1960;var v$1951;var t0$1947;var $1914$1942;var rval$1915;(rval$1915=(((rval$1919=false)),(function(){try{(rval$1919=f$1902(context$1909,scope$1910,expr$1911));}catch(excv$1928){var e$1934;(e$1934=excv$1928);(rval$1919=(__lt____lt____colon__$1322(e$1934,expr$1911),function(){throw e$1934;}()));}}(),rval$1919)));($1914$1942=rval$1915);if((($1914$1942 instanceof Array)&&(((t0$1947=$1914$1942.length)),((t0$1947===2)&&($1914$1942[0]==="bounce"))))){(v$1951=$1914$1942[1]);return f2$1905(context$1909,scope$1910,__lt____lt____colon__$1322(v$1951,expr$1911));}else{(other$1960=$1914$1942);return __lt____lt____colon__$1322(other$1960,expr$1911);}});return f2$1905;});(Expander$1335=function(env_factory$1967,generic_nodes$1968){var it$0$1971;(it$0$1971=function(){if((!$1249(Expander$1335)(this))){return Object.create(Expander$1335.prototype);}else{return this;}}());(it$0$1971["gensym"]=gensym$1327);(it$0$1971["mkenv"]=env_factory$1967);(it$0$1971["generic_nodes"]=generic_nodes$1968);return it$0$1971;});(Expander$1335.prototype["run_macro"]=function(m$1990,context$1991,scope$1992,form$1993,arg$1994){var rval$2011;var rval$2007;var self$2002;var it$0$1997;(it$0$1997=this);(self$2002=this);(rval$2007=(((rval$2011=false)),(function(){try{(rval$2011=m$1990(context$1991,scope$1992,form$1993,arg$1994));}catch(excv$2020){var msg$2067;var msg$2171;var find$2076;var err$2077;var other$2073;var $2054$2056;var e$2051;var e$2179;var value$2030;var t0$2023;var t1$2024;var t2$2025;var t3$2026;(t0$2023=excv$2020);if(($1249($3709(["match"]))(t0$2023)&&($3927(t0$2023,"args")&&(((t1$2024=t0$2023.args)),((t1$2024 instanceof Array)&&(((t2$2025=t1$2024.length)),((t2$2025===1)&&(((t3$2026=t1$2024[0])),$3927(t3$2026,"value"))))))))){(value$2030=t3$2026.value);(rval$2011=(((e$2051=((($2054$2056=value$2030)),function(){if(($2054$2056===context$1991)){(msg$2067="The macro cannot be found in this context.");return $3709(["syntax","context"]).create(msg$2067,({"context":context$1991,"form":form$1993}));}else{(other$2073=$2054$2056);(find$2076=function($2080$2082){var t0$2088;var msg$2107;var $index$2136;var $length$2131;var temp$2126;var other$2164;var type$2113;var xs$2114;var t0$2100;var $2084$2095;var ph$2085;var arg$2086;(t0$2088=$2080$2082);(arg$2086=t0$2088);(ph$2085=t0$2088);($2084$2095=ph$2085);if(($2084$2095===value$2030)){(msg$2107="The macro expected something different.");return $3709(["syntax","argument"]).create(msg$2107,({"context":context$1991,"argument":arg$2086,"form":form$1993}));}else{if((($2084$2095 instanceof Array)&&(((t0$2100=$2084$2095.length)),(t0$2100>=1)))){(type$2113=$2084$2095[0]);(xs$2114=Array.prototype.slice.call($2084$2095,1));(temp$2126=xs$2114);($length$2131=temp$2126.length);($index$2136=0);$2122:for(;($index$2136<$length$2131);($index$2136++)){var x$2153;var t0$2149;var m$2144;(m$2144=temp$2126[$index$2136]);(t0$2149=$3983(find$2076)(m$2144));if(t0$2149[0]){(x$2153=t0$2149[1]);if(x$2153){return x$2153;}}else{$3693(m$2144,"/home/olivier/git/earl-grey/src/expand.eg",3371,3456);}}return false;}else{(other$2164=$2084$2095);return false;}}});(err$2077=find$2076(arg$1994));if(err$2077){return err$2077;}else{(msg$2171="The macro expected something different (could not locate error in the source).");return $3709(["syntax","failure"]).create(msg$2171,({"form":form$1993,"value":value$2030}));}}}()))),function(){throw e$2051;}()));}else{(e$2179=excv$2020);(rval$2011=function(){throw e$2179;}());}}}(),rval$2011)));return it$0$1997.mkenv().convert(rval$2007);});(Expander$1335.prototype["step"]=function(context$2188,scope$2189,expr$2190){var helper$2203;var self$2198;var it$0$2193;(it$0$2193=this);(self$2198=this);(helper$2203=track_location$1334(function(context$2208,scope$2209,$2206$2210){var t0$2219;var other$2265;var env$2260;var $2250$2252;var other$2304;var t0$2292;var $2285$2287;var other$2308;var m$2278;var t0$2274;var $2246$2269;var env$2247;var other$2334;var t0$2322;var $2315$2317;var other$2362;var m$2353;var t0$2349;var $2342$2344;var other$2371;var x$2366;var f$2338;var arg$2339;var m$2312;var s$2238;var $2213$2233;var $2214$2234;var $2215$2235;var t0$2231;var $2212$2226;var ph$2216;var expr$2217;(t0$2219=$2206$2210);(expr$2217=t0$2219);(ph$2216=t0$2219);($2212$2226=ph$2216);if((($2213$2233=($2212$2226 instanceof Array))&&(((t0$2231=$2212$2226.length)),(($2215$2235=(t0$2231===2))&&($2212$2226[0]==="symbol"))))){(s$2238=$2212$2226[1]);(env$2247=((($2250$2252=expr$2217)),function(){if($3927($2250$2252,"env")){(env$2260=$2250$2252.env);return expr$2217.env;}else{(other$2265=$2250$2252);throw $3709(["syntax","no_env"]).create("No environment was found to resolve",({"symbol":expr$2217}));}}()));($2246$2269=env$2247.resolve(scope$2209,s$2238));if((($2246$2269 instanceof Array)&&(((t0$2274=$2246$2269.length)),((t0$2274===2)&&($2246$2269[0]==="macro"))))){(m$2278=$2246$2269[1]);($2285$2287=context$2208);if((($2285$2287 instanceof Array)&&(((t0$2292=$2285$2287.length)),((t0$2292===2)&&(($2285$2287[0]==="expr")&&($2285$2287[1]==="head")))))){return ["macro",m$2278];}else{(other$2304=$2285$2287);return ["bounce",it$0$2193.run_macro(m$2278,context$2208,scope$2209,expr$2217,__lt____lt____colon__$1322(["void"],expr$2217))];}}else{(other$2308=$2246$2269);return expr$2217;}}else{if(($2215$2235&&($2212$2226[0]==="macro"))){(m$2312=$2212$2226[1]);($2315$2317=context$2208);if((($2315$2317 instanceof Array)&&(((t0$2322=$2315$2317.length)),((t0$2322===2)&&(($2315$2317[0]==="expr")&&($2315$2317[1]==="head")))))){return expr$2217;}else{(other$2334=$2315$2317);return ["bounce",it$0$2193.run_macro(m$2312,context$2208,scope$2209,expr$2217,__lt____lt____colon__$1322(["void"],expr$2217))];}}else{if(($2213$2233&&((t0$2231===3)&&($2212$2226[0]==="send")))){(f$2338=$2212$2226[1]);(arg$2339=$2212$2226[2]);($2342$2344=helper$2203(["expr","head"],scope$2209,f$2338));if((($2342$2344 instanceof Array)&&(((t0$2349=$2342$2344.length)),((t0$2349===2)&&($2342$2344[0]==="macro"))))){(m$2353=$2342$2344[1]);return ["bounce",it$0$2193.run_macro(m$2353,context$2208,scope$2209,expr$2217,arg$2339)];}else{(other$2362=$2342$2344);return expr$2217;}}else{if(($2213$2233&&((t0$2231===2)&&($2212$2226[0]==="nostep")))){(x$2366=$2212$2226[1]);return x$2366;}else{(other$2371=$2212$2226);return expr$2217;}}}}}));return helper$2203(context$2188,scope$2189,expr$2190);});(Expander$1335.prototype["step_all"]=function(context$2378,scope$2379,$2376$2380){var t0$2384;var t1$2385;var pre$2407;var bulk$2408;var post$2409;var self$2402;var it$0$2397;var stmts$2382;(t0$2384=$2376$2380);if(((t0$2384 instanceof Array)&&(((t1$2385=t0$2384.length)),(t1$2385>=0)))){(stmts$2382=Array.prototype.slice.call(t0$2384,0));}else{$3693($2376$2380);}(it$0$2397=this);(self$2402=this);(pre$2407=[]);(bulk$2408=[]);(post$2409=[]);$2419:while(stmts$2382.length){var x$2474;var m$2466;var stmt$2461;var stmt$2456;var prepend$2444;var $2424$2439;var $2425$2440;var $2426$2441;var t0$2437;var $2423$2432;var current$2427;(current$2427=stmts$2382.shift());($2423$2432=it$0$2397.step(context$2378,scope$2379,current$2427));if((($2424$2439=($2423$2432 instanceof Array))&&(((t0$2437=$2423$2432.length)),((t0$2437>=1)&&($2423$2432[0]==="splice"))))){(prepend$2444=Array.prototype.slice.call($2423$2432,1));(stmts$2382=prepend$2444.concat(stmts$2382));}else{if(($2424$2439&&(($2426$2441=(t0$2437===2))&&($2423$2432[0]==="float")))){(stmt$2456=$2423$2432[1]);(pre$2407=pre$2407.concat(it$0$2397.step_all(context$2378,scope$2379,[stmt$2456])));}else{if(($2426$2441&&($2423$2432[0]==="sink"))){(stmt$2461=$2423$2432[1]);(post$2409=post$2409.concat(it$0$2397.step_all(context$2378,scope$2379,[stmt$2461])));}else{if(($2426$2441&&($2423$2432[0]==="multimacro"))){(m$2466=$2423$2432[1]);(stmts$2382=m$2466(context$2378,scope$2379,current$2427,stmts$2382));}else{(x$2474=$2423$2432);bulk$2408.push(x$2474);}}}}}return pre$2407.concat(bulk$2408).concat(post$2409);});(Expander$1335.prototype["expand"]=function(context$2479,scope$2480,expr$2481){var helper$2494;var self$2489;var it$0$2484;(it$0$2484=this);(self$2489=this);(helper$2494=track_location$1334(function(context$2498,scope$2499,expr$2500){var t0$2537;var other$2557;var $2534$2545;var env$2535;var $index$2604;var $length$2599;var temp$2594;var acc$2589;var newargs$2583;var $index$2651;var $length$2646;var temp$2641;var acc$2636;var newargs$2630;var t0$2708;var newscope$2702;var env$2703;var $index$2775;var $length$2770;var temp$2765;var acc$2760;var $index$2927;var $length$2922;var temp$2917;var acc$2912;var t0$2747;var newscope$2731;var stepscope$2732;var changes$2733;var newargs$2734;var vars$2735;var exp$2736;var $index$3256;var $length$3251;var temp$3246;var other$3348;var t0$3328;var $3321$3323;var is_obj$3155;var obj$3156;var arr$3157;var arr_parts$3158;var obj_parts$3159;var new_arr_part$3160;var new_obj_part$3161;var r$3162;var $index$3391;var $length$3386;var temp$3381;var acc$3376;var newscope$3368;var s$3463;var newscope$3475;var name$3456;var t0$3452;var $index$3513;var $length$3508;var temp$3503;var acc$3498;var other$3534;var type$3489;var args$3490;var tag$3479;var body$3480;var x$3447;var $2504$3448;var bindings$3363;var body$3364;var target$3357;var value$3358;var args$3151;var args$2727;var args$2722;var args$2717;var variable$2686;var s$2687;var value$2688;var body$2689;var args$2626;var args$2579;var f$2573;var arg$2574;var s$2526;var $2505$2521;var $2506$2522;var $2507$2523;var t0$2517;var t1$2518;var t2$2519;var $2503$2512;(expr$2500=it$0$2484.step(context$2498,scope$2499,expr$2500));($2503$2512=expr$2500);if((($2505$2521=($2503$2512 instanceof Array))&&(((t0$2517=$2503$2512.length)),(($2507$2523=(t0$2517===2))&&($2503$2512[0]==="symbol"))))){(s$2526=$2503$2512[1]);(t0$2537=expr$2500);if($3927(t0$2537,"env")){(env$2535=t0$2537.env);}else{$3693(expr$2500,"/home/olivier/git/earl-grey/src/expand.eg",7679,7683);}($2534$2545=env$2535.resolve(scope$2499,s$2526));if(($2534$2545===(void 0))){throw $3709(["syntax","undeclared"]).create(("Undeclared variable: "+s$2526),({"node":expr$2500}));}else{(other$2557=$2534$2545);return ["bounce",other$2557];}}else{if(($2507$2523&&($2503$2512[0]==="value"))){$2503$2512[1];return expr$2500;}else{if(($2507$2523&&($2503$2512[0]==="variable"))){$2503$2512[1];return expr$2500;}else{if(($2505$2521&&((t0$2517===1)&&($2503$2512[0]==="void")))){return expr$2500;}else{if(($2505$2521&&((t0$2517===3)&&($2503$2512[0]==="send")))){(f$2573=$2503$2512[1]);(arg$2574=$2503$2512[2]);return ["send",helper$2494(["expr","head"],scope$2499,f$2573),helper$2494(["expr","tail"],scope$2499,arg$2574)];}else{if(($2505$2521&&(($2507$2523=(t0$2517>=1))&&($2503$2512[0]==="array")))){(args$2579=Array.prototype.slice.call($2503$2512,1));(newargs$2583=(((acc$2589=[])),(((temp$2594=it$0$2484.step_all(["expr","array"],scope$2499,args$2579))),((($length$2599=temp$2594.length)),((($index$2604=0)),function(){$2586:for(;($index$2604<$length$2599);($index$2604++)){var arg$2620;var m$2612;(m$2612=temp$2594[$index$2604]);(arg$2620=m$2612);acc$2589.push(helper$2494(["expr","expr"],scope$2499,arg$2620));}}()))),acc$2589));return ["array"].concat(newargs$2583);}else{if(($2507$2523&&($2503$2512[0]==="object"))){(args$2626=Array.prototype.slice.call($2503$2512,1));(newargs$2630=(((acc$2636=[])),(((temp$2641=it$0$2484.step_all(["expr","object"],scope$2499,args$2626))),((($length$2646=temp$2641.length)),((($index$2651=0)),function(){$2633:for(;($index$2651<$length$2646);($index$2651++)){var k$2669;var v$2670;var t0$2664;var t1$2665;var m$2659;(m$2659=temp$2641[$index$2651]);(t0$2664=m$2659);if(((t0$2664 instanceof Array)&&(((t1$2665=t0$2664.length)),((t1$2665===3)&&(t0$2664[0]==="array"))))){(k$2669=t0$2664[1]);(v$2670=t0$2664[2]);acc$2636.push(["array",helper$2494(["expr","expr"],scope$2499,k$2669),helper$2494(["expr","expr"],scope$2499,v$2670)]);}else{$3693(m$2659,"/home/olivier/git/earl-grey/src/expand.eg",8522,8711);}}}()))),acc$2636));return ["object"].concat(newargs$2630);}else{if(($2505$2521&&((t0$2517===4)&&(($2503$2512[0]==="bind")&&(((t1$2518=$2503$2512[1])),((variable$2686=t1$2518),((t1$2518 instanceof Array)&&(((t2$2519=t1$2518.length)),((t2$2519===2)&&(t1$2518[0]==="symbol")))))))))){(s$2687=t1$2518[1]);(value$2688=$2503$2512[2]);(body$2689=$2503$2512[3]);(newscope$2702=Scope$1332(scope$2499));(t0$2708=variable$2686);if($3927(t0$2708,"env")){(env$2703=t0$2708.env);}else{$3693(variable$2686,"/home/olivier/git/earl-grey/src/expand.eg",8854,8862);}env$2703.bind(newscope$2702,s$2687,value$2688);return helper$2494(context$2498,newscope$2702,body$2689);}else{if(($2505$2521&&(($2507$2523=(t0$2517>=1))&&($2503$2512[0]==="splice")))){(args$2717=Array.prototype.slice.call($2503$2512,1));return ["bounce",$1265(["multi"].concat(args$2717),({"override_scope":true}))];}else{if(($2507$2523&&($2503$2512[0]==="interactive"))){(args$2722=Array.prototype.slice.call($2503$2512,1));return ["bounce",$1265(["multi"].concat(args$2722),({"override_scope":true,"all_mutable":true}))];}else{if(($2507$2523&&($2503$2512[0]==="multi"))){(args$2727=Array.prototype.slice.call($2503$2512,1));(newscope$2731=function(){if(expr$2500.override_scope){return scope$2499;}else{return Scope$1332(scope$2499);}}());(stepscope$2732=function(){if(expr$2500.nonrecursive){return scope$2499;}else{return newscope$2731;}}());(changes$2733=false);(t0$2747=classify$1324("newargs","vars",(((acc$2760=[])),(((temp$2765=it$0$2484.step_all(["expr","multi"],stepscope$2732,args$2727))),((($length$2770=temp$2765.length)),((($index$2775=0)),function(){$2751:for(;($index$2775<$length$2770);($index$2775++)){var t0$2834;var env$2832;var t0$2865;var env$2862;var v$2863;var other$2896;var v$2880;var value$2881;var variable$2846;var s$2847;var value$2848;var variable$2816;var s$2817;var value$2818;var opt$2801;var value$2802;var $2753$2793;var $2754$2794;var $2755$2795;var $2756$2796;var $2757$2797;var $2758$2798;var t0$2788;var t1$2789;var t2$2790;var t3$2791;var m$2783;(m$2783=temp$2765[$index$2775]);(t0$2788=m$2783);if((($2754$2794=(t0$2788 instanceof Array))&&(((t1$2789=t0$2788.length)),(($2756$2796=(t1$2789===3))&&(t0$2788[0]==="option"))))){(opt$2801=t0$2788[1]);(value$2802=t0$2788[2]);acc$2760.push((newscope$2731.setopt(opt$2801,value$2802),["ignore"]));}else{if(($2756$2796&&((t0$2788[0]==="declare_raw")&&(((t2$2790=t0$2788[1])),((variable$2816=t2$2790),((t2$2790 instanceof Array)&&(((t3$2791=t2$2790.length)),((t3$2791===2)&&(t2$2790[0]==="symbol"))))))))){(s$2817=t2$2790[1]);(value$2818=t0$2788[2]);acc$2760.push(((((t0$2834=variable$2816)),function(){if($3927(t0$2834,"env")){(env$2832=t0$2834.env);}else{return $3693(variable$2816,"/home/olivier/git/earl-grey/src/expand.eg",9808,9816);}}()),env$2832.bind(newscope$2731,s$2817,value$2818),((changes$2733=true)),["ignore"]));}else{if(($2754$2794&&(($2756$2796=((t1$2789>=2)&&(t1$2789<=3)))&&(($2757$2797=(t0$2788[0]==="declare"))&&(((t2$2790=t0$2788[1])),((variable$2846=t2$2790),((t2$2790 instanceof Array)&&(((t3$2791=t2$2790.length)),((t3$2791===2)&&(t2$2790[0]==="symbol")))))))))){(s$2847=t2$2790[1]);(value$2848=function(){if((2>=t1$2789)){return null;}else{return t0$2788[2];}}());acc$2760.push(((((t0$2865=variable$2846)),function(){if($3927(t0$2865,"env")){(env$2862=t0$2865.env);}else{return $3693(variable$2846,"/home/olivier/git/earl-grey/src/expand.eg",10056,10064);}}()),((v$2863=__lt____lt____colon__$1322(["variable",it$0$2484.gensym(s$2847)],variable$2846))),$1265(v$2863,({"mutable":(expr$2500.all_mutable||variable$2846.mutable)})),env$2862.bind(newscope$2731,s$2847,v$2863),((changes$2733=true)),function(){if(value$2848){return ["splice",["newargs",["assign",v$2863,value$2848]],["vars",v$2863]];}else{return ["vars",v$2863];}}()));}else{if(($2757$2797&&((v$2880=t2$2790),((t2$2790 instanceof Array)&&(((t3$2791=t2$2790.length)),((t3$2791===2)&&(t2$2790[0]==="variable"))))))){t2$2790[1];(value$2881=function(){if((2>=t1$2789)){return null;}else{return t0$2788[2];}}());acc$2760.push((((changes$2733=true)),function(){if(value$2881){return ["splice",["newargs",["assign",v$2880,value$2881]],["vars",v$2880]];}else{return ["vars",v$2880];}}()));}else{(other$2896=m$2783);acc$2760.push(["newargs",other$2896]);}}}}}}()))),acc$2760)));if(($3927(t0$2747,"newargs")&&((newargs$2734=t0$2747.newargs),$3927(t0$2747,"vars")))){(vars$2735=t0$2747.vars);}else{$3693(classify$1324("newargs","vars",(((acc$2912=[])),(((temp$2917=it$0$2484.step_all(["expr","multi"],stepscope$2732,args$2727))),((($length$2922=temp$2917.length)),((($index$2927=0)),function(){$2903:for(;($index$2927<$length$2922);($index$2927++)){var t0$2986;var env$2984;var t0$3017;var env$3014;var v$3015;var other$3048;var v$3032;var value$3033;var variable$2998;var s$2999;var value$3000;var variable$2968;var s$2969;var value$2970;var opt$2953;var value$2954;var $2905$2945;var $2906$2946;var $2907$2947;var $2908$2948;var $2909$2949;var $2910$2950;var t0$2940;var t1$2941;var t2$2942;var t3$2943;var m$2935;(m$2935=temp$2917[$index$2927]);(t0$2940=m$2935);if((($2906$2946=(t0$2940 instanceof Array))&&(((t1$2941=t0$2940.length)),(($2908$2948=(t1$2941===3))&&(t0$2940[0]==="option"))))){(opt$2953=t0$2940[1]);(value$2954=t0$2940[2]);acc$2912.push((newscope$2731.setopt(opt$2953,value$2954),["ignore"]));}else{if(($2908$2948&&((t0$2940[0]==="declare_raw")&&(((t2$2942=t0$2940[1])),((variable$2968=t2$2942),((t2$2942 instanceof Array)&&(((t3$2943=t2$2942.length)),((t3$2943===2)&&(t2$2942[0]==="symbol"))))))))){(s$2969=t2$2942[1]);(value$2970=t0$2940[2]);acc$2912.push(((((t0$2986=variable$2968)),function(){if($3927(t0$2986,"env")){(env$2984=t0$2986.env);}else{return $3693(variable$2968,"/home/olivier/git/earl-grey/src/expand.eg",9808,9816);}}()),env$2984.bind(newscope$2731,s$2969,value$2970),((changes$2733=true)),["ignore"]));}else{if(($2906$2946&&(($2908$2948=((t1$2941>=2)&&(t1$2941<=3)))&&(($2909$2949=(t0$2940[0]==="declare"))&&(((t2$2942=t0$2940[1])),((variable$2998=t2$2942),((t2$2942 instanceof Array)&&(((t3$2943=t2$2942.length)),((t3$2943===2)&&(t2$2942[0]==="symbol")))))))))){(s$2999=t2$2942[1]);(value$3000=function(){if((2>=t1$2941)){return null;}else{return t0$2940[2];}}());acc$2912.push(((((t0$3017=variable$2998)),function(){if($3927(t0$3017,"env")){(env$3014=t0$3017.env);}else{return $3693(variable$2998,"/home/olivier/git/earl-grey/src/expand.eg",10056,10064);}}()),((v$3015=__lt____lt____colon__$1322(["variable",it$0$2484.gensym(s$2999)],variable$2998))),$1265(v$3015,({"mutable":(expr$2500.all_mutable||variable$2998.mutable)})),env$3014.bind(newscope$2731,s$2999,v$3015),((changes$2733=true)),function(){if(value$3000){return ["splice",["newargs",["assign",v$3015,value$3000]],["vars",v$3015]];}else{return ["vars",v$3015];}}()));}else{if(($2909$2949&&((v$3032=t2$2942),((t2$2942 instanceof Array)&&(((t3$2943=t2$2942.length)),((t3$2943===2)&&(t2$2942[0]==="variable"))))))){t2$2942[1];(value$3033=function(){if((2>=t1$2941)){return null;}else{return t0$2940[2];}}());acc$2912.push((((changes$2733=true)),function(){if(value$3033){return ["splice",["newargs",["assign",v$3032,value$3033]],["vars",v$3032]];}else{return ["vars",v$3032];}}()));}else{(other$3048=m$2935);acc$2912.push(["newargs",other$3048]);}}}}}}()))),acc$2912)),"/home/olivier/git/earl-grey/src/expand.eg",9480,11088);}(exp$2736=function(s$3054){var $index$3080;var $length$3075;var temp$3070;var acc$3065;var $index$3129;var $length$3124;var temp$3119;var acc$3114;var stepped$3057;(stepped$3057=(((acc$3065=[])),(((temp$3070=$3905(newargs$2734))),((($length$3075=temp$3070.length)),((($index$3080=0)),function(){$3062:for(;($index$3080<$length$3075);($index$3080++)){var i$3098;var arg$3099;var t0$3093;var t1$3094;var m$3088;(m$3088=temp$3070[$index$3080]);(t0$3093=m$3088);if(((t0$3093 instanceof Array)&&(((t1$3094=t0$3093.length)),(t1$3094===2)))){(i$3098=t0$3093[0]);(arg$3099=t0$3093[1]);acc$3065.push(it$0$2484.step(["expr",function(){if((i$3098===(newargs$2734.length-1))){return "expr";}else{return "ignore";}}()],s$3054,arg$3099));}else{$3693(m$3088,"/home/olivier/git/earl-grey/src/expand.eg",11310,11487);}}}()))),acc$3065));(acc$3114=[]);(temp$3119=stepped$3057);($length$3124=temp$3119.length);($index$3129=0);$3058:for(;($index$3129<$length$3124);($index$3129++)){var arg$3145;var m$3137;(m$3137=temp$3119[$index$3129]);(arg$3145=m$3137);acc$3114.push(helper$2494(["expr","expr"],s$3054,arg$3145));}return acc$3114;});if(changes$2733){return ["scope",vars$2735,["multi"].concat(exp$2736(newscope$2731))];}else{return ["multi"].concat(exp$2736(scope$2499));}}else{if(($2507$2523&&($2503$2512[0]==="data"))){(args$3151=Array.prototype.slice.call($2503$2512,1));(is_obj$3155=false);(obj$3156=["object"]);(arr$3157=["array"]);(arr_parts$3158=[]);(obj_parts$3159=[]);(new_arr_part$3160=function(){var other$3207;var t0$3195;var $3188$3190;($3188$3190=arr$3157);if((($3188$3190 instanceof Array)&&(((t0$3195=$3188$3190.length)),((t0$3195===1)&&($3188$3190[0]==="array"))))){return false;}else{(other$3207=$3188$3190);arr_parts$3158.push(arr$3157);(arr$3157=["array"]);}});(new_obj_part$3161=function(){var other$3237;var t0$3225;var $3218$3220;($3218$3220=obj$3156);if((($3218$3220 instanceof Array)&&(((t0$3225=$3218$3220.length)),((t0$3225===1)&&($3218$3220[0]==="object"))))){return false;}else{(other$3237=$3218$3220);obj_parts$3159.push(obj$3156);(obj$3156=["object"]);}});(temp$3246=it$0$2484.step_all(["expr","data"],scope$2499,args$3151));($length$3251=temp$3246.length);($index$3256=0);$3163:for(;($index$3256<$length$3251);($index$3256++)){var other$3317;var expr$3308;var expr$3302;var k$3292;var v$3293;var $3165$3272;var $3166$3273;var $3167$3274;var $3168$3275;var t0$3269;var t1$3270;var m$3264;(m$3264=temp$3246[$index$3256]);(t0$3269=m$3264);if((($3166$3273=(t0$3269 instanceof Array))&&(((t1$3270=t0$3269.length)),((t1$3270===1)&&(t0$3269[0]==="assoc"))))){(is_obj$3155=true);}else{if(($3166$3273&&((t1$3270===3)&&(t0$3269[0]==="assoc")))){(k$3292=t0$3269[1]);(v$3293=t0$3269[2]);(is_obj$3155=true);obj$3156.push(["array",k$3292,v$3293]);}else{if(($3166$3273&&(($3168$3275=(t1$3270===2))&&(t0$3269[0]==="dynsplice")))){(expr$3302=t0$3269[1]);new_arr_part$3160();arr_parts$3158.push(expr$3302);}else{if(($3168$3275&&(t0$3269[0]==="objsplice"))){(expr$3308=t0$3269[1]);(is_obj$3155=true);new_obj_part$3161();obj_parts$3159.push(expr$3308);}else{(other$3317=m$3264);arr$3157.push(other$3317);}}}}}new_arr_part$3160();new_obj_part$3161();(r$3162=((($3321$3323=arr_parts$3158)),function(){if((($3321$3323 instanceof Array)&&(((t0$3328=$3321$3323.length)),((t0$3328===0)&&is_obj$3155)))){return util$1323.construct(obj_parts$3159,function(x$3339,rest$3340){return ["send",["symbol","&:"],["data",x$3339,rest$3340]];},["object"]);}else{$3321$3323;if(is_obj$3155){throw $3709(["syntax","array","object"]).create("Cannot mix array and object notations.");}else{(other$3348=$3321$3323);return util$1323.construct(arr_parts$3158.reverse(),function(x$3351,rest$3352){return ["send",["send",rest$3352,["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",x$3351]];},["array"]);}}}()));return helper$2494(context$2498,scope$2499,it$0$2484.mkenv().convert(r$3162));}else{if(($2505$2521&&(($2507$2523=(t0$2517===3))&&($2503$2512[0]==="assign")))){(target$3357=$2503$2512[1]);(value$3358=$2503$2512[2]);return ["assign",helper$2494(["expr","expr"],scope$2499,target$3357),helper$2494(["expr","expr"],scope$2499,value$3358)];}else{if(($2507$2523&&($2503$2512[0]==="lambda"))){(bindings$3363=$2503$2512[1]);(body$3364=$2503$2512[2]);(newscope$3368=Scope$1332(scope$2499));return ["lambda",(((acc$3376=[])),(((temp$3381=bindings$3363)),((($length$3386=temp$3381.length)),((($index$3391=0)),function(){$3372:for(;($index$3391<$length$3386);($index$3391++)){var v$3424;var x$3434;var other$3442;var v$3431;var b$3410;var env$3411;var $3374$3407;var t0$3404;var t1$3405;var m$3399;(m$3399=temp$3381[$index$3391]);(t0$3404=m$3399);if(((t0$3404 instanceof Array)&&(((t1$3405=t0$3404.length)),((t1$3405===2)&&((t0$3404[0]==="symbol")&&((b$3410=t0$3404[1]),$3927(t0$3404,"env"))))))){(env$3411=t0$3404.env);acc$3376.push((((v$3424=["variable",it$0$2484.gensym(b$3410)])),(env$3411.bind(newscope$3368,b$3410,v$3424),v$3424)));}else{if((((x$3434=t0$3404)),((x$3434 instanceof Array)&&(x$3434[0]==="variable")))){(v$3431=t0$3404);acc$3376.push(v$3431);}else{(other$3442=m$3399);acc$3376.push(function(){throw $3709(["syntax","lambda","binding"]).create("Not a valid binding.",({"node":other$3442}));}());}}}}()))),acc$3376),helper$2494(["expr","expr"],newscope$3368,body$3364)];}else{if(($2507$2523&&($2503$2512[0]==="use"))){($2504$3448=$2503$2512[1]);(x$3447=$2503$2512[2]);(t0$3452=$2504$3448);if((typeof(t0$3452)==="string")){(name$3456=t0$3452);(s$3463=scope$2499);$3467:while(s$3463){if((s$3463.name.slice(0,(name$3456.length+1))===(name$3456+"/"))){break $3467;}else{(s$3463=s$3463.parent);}}if(s$3463){return helper$2494(context$2498,s$3463,x$3447);}else{throw $3709(["syntax","noscope"]).create(("Could not find a scope tagged: "+name$3456));}}else{(newscope$3475=$2504$3448);return helper$2494(context$2498,newscope$3475,x$3447);}}else{if(($2507$2523&&(($2503$2512[0]==="tagscope")&&(((t1$2518=$2503$2512[1])),(typeof(t1$2518)==="string"))))){(tag$3479=t1$2518);(body$3480=$2503$2512[2]);return helper$2494(context$2498,Scope$1332(scope$2499,it$0$2484.gensym((tag$3479+"/"))),body$3480);}else{if(($2505$2521&&((t0$2517>=1)&&((type$3489=$2503$2512[0]),((args$3490=Array.prototype.slice.call($2503$2512,1)),(it$0$2484.generic_nodes.indexOf(type$3489)!==-1)))))){return [type$3489].concat((((acc$3498=[])),(((temp$3503=args$3490)),((($length$3508=temp$3503.length)),((($index$3513=0)),function(){$3495:for(;($index$3513<$length$3508);($index$3513++)){var arg$3529;var m$3521;(m$3521=temp$3503[$index$3513]);(arg$3529=m$3521);acc$3498.push(helper$2494(["expr","expr"],scope$2499,arg$3529));}}()))),acc$3498));}else{(other$3534=$2503$2512);throw $3709(["syntax","illegal_node"]).create("An illegal node was found.",({"node":other$3534,"context":context$2498}));}}}}}}}}}}}}}}}}}}));return helper$2494(context$2479,scope$2480,expr$2481);});$1265(Expander$1335,$1265(((accum$3538=({})),((accum$3538["::name"]="Expander"),accum$3538)),((accum$3542=({})),((accum$3542["::egclass"]=true),accum$3542))));Expander$1335;(mac1$1336=function(f$3548){return ["macro",function(context$3552,scope$3553,form$3554,$3550$3555){var t0$3559;var t1$3560;var expr$3557;(t0$3559=$3550$3555);if(((t0$3559 instanceof Array)&&(((t1$3560=t0$3559.length)),((t1$3560===2)&&(t0$3559[0]==="data"))))){(expr$3557=t0$3559[1]);}else{$3693($3550$3555);}return f$3548(expr$3557);}];});(__chk_ncache$1337=({}));(__chk_scache$1338=({}));(checker_db$1339=function($3580$3582){var v$3618;var v$3634;var s$3630;var n$3614;var $3584$3590;var ph$3585;(ph$3585=$3580$3582);($3584$3590=ph$3585);if(($3584$3590===null)){return checker_db$1339.null;}else{if(($3584$3590===(void 0))){return checker_db$1339.undefined;}else{if(($3584$3590===true)){return checker_db$1339.true;}else{if(($3584$3590===false)){return checker_db$1339.false;}else{if((typeof($3584$3590)==="number")){(n$3614=$3584$3590);if($1264(__chk_ncache$1337,n$3614)){return $1264(__chk_ncache$1337,n$3614);}else{(v$3618=mac1$1336(function(x$3622){return ["send",["symbol","==="],["data",x$3622,["value",n$3614]]];}));(__chk_ncache$1337[n$3614]=v$3618);return v$3618;}}else{if((typeof($3584$3590)==="string")){(s$3630=$3584$3590);if(Object.prototype.hasOwnProperty.call(__chk_scache$1338,s$3630)){return $1264(__chk_scache$1338,s$3630);}else{(v$3634=mac1$1336(function(x$3638){return ["send",["symbol","==="],["data",x$3638,["value",s$3630]]];}));(__chk_scache$1338[s$3630]=v$3634);return v$3634;}}else{$3693($3584$3590);}}}}}}});$1265(checker_db$1339,({"String":mac1$1336(function(x$3648){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$3648]],["value","string"]]];}),"Number":mac1$1336(function(x$3651){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$3651]],["value","number"]]];}),"Array":mac1$1336(function(x$3654){return ["send",["symbol","instanceof"],["data",x$3654,["symbol","Array"]]];}),"true":mac1$1336(function(x$3657){return x$3657;}),"false":mac1$1336(function(x$3660){return ["send",["symbol","not"],["data",["void"],x$3660]];}),"null":mac1$1336(function(x$3663){return ["send",["symbol","==="],["data",x$3663,["value",null]]];}),"undefined":mac1$1336(function(x$3666){return ["send",["symbol","==="],["data",x$3666,["value",(void 0)]]];})}));(exports["Env"]=Env$1333);(exports["Scope"]=Scope$1332);(exports["track_location"]=track_location$1334);(exports["Expander"]=Expander$1335);(exports["GenSym"]=GenSym$1326);(exports["gensym"]=gensym$1327);(exports["mac1"]=mac1$1336);(exports["checker_db"]=checker_db$1339);
