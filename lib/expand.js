var τ15=function(type$541){var f$544;(f$544=type$541["::check"]);;if((f$544===(void 0))){return function(value$549){return (value$549 instanceof type$541);};}else{return function(value$552){return f$544.call(type$541,value$552);};}};
var τ16=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var τ17=function(temp$554$556){var ph$560;(ph$560=temp$554$556);;var m$558$565;(m$558$565=ph$560);;var bridge$559$570;var x$574;(bridge$559$570=m$558$565);if((((typeof(bridge$559$570)==="string")&&((x$574=bridge$559$570),true))||((typeof(bridge$559$570)==="number")&&((x$574=bridge$559$570),true)))){return ["value",x$574];}else{var other$581;(other$581=m$558$565);return other$581["::serialize_ast"]();}};
var send$403;(send$403=function(obj$408,temp$406$409){var ph$413;var msg$414;var t0$416;(t0$416=temp$406$409);(msg$414=t0$416);(ph$413=t0$416);;var m$411$420;(m$411$420=ph$413);;var bridge$412$425;(bridge$412$425=m$411$420);if(((typeof(bridge$412$425)==="string")||(typeof(bridge$412$425)==="number"))){return obj$408[msg$414];}else{var other$433;(other$433=m$411$420);return obj$408["::send"](msg$414);}});;(Array[":::project"]=function(temp$436$438){var ph$441;var value$442;var t0$444;(t0$444=temp$436$438);(value$442=t0$444);(ph$441=t0$444);;var m$440$448;(m$440$448=ph$441);;if(τ15(Array)(m$440$448)){return [true,value$442];}else{m$440$448;return [true,[value$442]];}});(Array.prototype["::check"]=function(value$462){if((value$462 instanceof Array)){var i$467;(i$467=0);;$465:for(;(i$467<this.length);(i$467++)){if((τ16(this,i$467)!==τ16(value$462,i$467))){return false;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value$476){if((value$476 instanceof Array)){var i$481;(i$481=0);;$479:for(;(i$481<this.length);(i$481++)){if((τ16(this,i$481)!==τ16(value$476,i$481))){return [true,[value$476]];}}return [true,value$476.slice(this.length)];}else{return [true,[value$476]];}});(Array.prototype[":::deconstruct"]=function(value$490){return [true,value$490.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map(τ17));});(RegExp.prototype["::check"]=function(value$495){return value$495.match(this);});(RegExp.prototype[":::project"]=function(value$498){var m$500$502;(m$500$502=value$498.match(this));;var m$510;if((m$500$502===null)){(m$510=m$500$502);return [false,null];}else{var m$515;(m$515=m$500$502);return [true,m$515];}});(RegExp.prototype[":::deconstruct"]=function(value$518){var m$520$522;(m$520$522=value$518.match(this));;var m$530;if((m$520$522===null)){(m$530=m$520$522);return [false,null];}else{var m$535;(m$535=m$520$522);return [true,m$535];}});(Function.prototype["::send"]=function(args$538){return this.apply(this,args$538);});
var τ19=function(dest$1443,values$1444){var k$1449;(k$1449=null);$1447:for(k$1449 in values$1444){if(values$1444.hasOwnProperty(k$1449)){(dest$1443[k$1449]=values$1444[k$1449]);}}return dest$1443;};
var τ18=function(){var $1337$1339;($1337$1339=function(tags$1343){var it$0$1346;(it$0$1346=function(){if((!τ15($1337$1339)(this))){return Object.create($1337$1339.prototype);}else{return this;}}());;(it$0$1346["tags"]=tags$1343);return it$0$1346;});;($1337$1339.prototype["create"]=function(){var m$1355$1357;(m$1355$1357=arguments);;var t0$1362;var message$1366;var args$1367;(t0$1362=m$1355$1357.length);if((t0$1362>=0)){(message$1366=function(){if((0>=t0$1362)){return "";}else{return m$1355$1357[0];}}());(args$1367=Array.prototype.slice.call(m$1355$1357,1));var it$0$1371;(it$0$1371=this);;var e$1376;(e$1376=Error(message$1366));;(e$1376["::tags"]=it$0$1371.tags);(e$1376["args"]=args$1367);(e$1376["name"]=["E"].concat(it$0$1371.tags).join("."));return e$1376;}else{throw Error("mismatch!!");}});($1337$1339.prototype["::check"]=function(e$1385){var it$0$1388;(it$0$1388=this);;var tags$1393;if(((!e$1385)||(!τ15(Error)(e$1385)))){return false;}(tags$1393=(e$1385["::tags"]||[]));;var temp$1401;(temp$1401=it$0$1388.tags);;var len$1406;(len$1406=temp$1401.length);;var i$1411;(i$1411=0);;$1398:for(;(i$1411<len$1406);(i$1411++)){var m$1419;(m$1419=temp$1401[i$1411]);;var tag$1427;(tag$1427=m$1419);if((tags$1393.indexOf(tag$1427)===(-1))){return false;}else{false;;}}return true;});($1337$1339.prototype["::deconstruct"]=function(e$1435){var it$0$1438;(it$0$1438=this);;return e$1435.args;});τ19($1337$1339,({}));return $1337$1339;}();var accum$628;var Env$585;var nullenv$586;var js_contexts$587;var expand$588;(Env$585=function(parent$592){var store$595;var self$596;(store$595=Object());;(self$596=function(expr$603){return ["bind_env",self$596,expr$603];});;(self$596["resolve"]=function(name$607){var attempt$610;(attempt$610=τ16(store$595,name$607));;if(attempt$610){return attempt$610;}else{return self$596.parent.resolve(name$607);}});(self$596["register"]=function(name$615,value$616){return (store$595[name$615]=value$616);});(self$596["register_macro"]=function(name$619,m$620){return (store$595[name$619]=["macro",m$620]);});(self$596["fork"]=function(){return Env$585(self$596);});(self$596["parent"]=parent$592);(self$596["store"]=store$595);return self$596;});;(nullenv$586=((accum$628=({})),((accum$628["resolve"]=function(x$632){return (void 0);}),accum$628)));;(js_contexts$587=({"js_for":["multi","multi","multi","multi"]}));;(expand$588=function(temp$640$642,expr$643){var t0$648;var t1$649;var i$759;var len$754;var temp$749;var acc$744;var arr$717;var i$840;var len$835;var temp$830;var acc$825;var arr$784;var patch$1000;var other$997;var arr$986;var things$987;var $959$972;var $960$973;var $961$974;var t0$968;var t1$969;var t2$970;var m$958$963;var is_obj$872;var obj$873;var arr$874;var parts$875;var newpart$876;var r$877;var i$1029;var len$1024;var temp$1019;var acc$1014;var bridge$666$1092;var bridge$665$1089;var bridge$664$1086;var bridge$663$1083;var bridge$662$1080;var bridge$661$1077;var bridge$660$1074;var bridge$659$1071;var bridge$658$1068;var f$1101;var ctxs$1096;var other$1116;var expr$1111;var type$1061;var args$1062;var lhs$1055;var rhs$1056;var binding$1049;var value$1050;var bindings$1008;var body$1009;var args$867;var args$779;var type$708;var args$709;var v$703;var f$696;var arg$697;var s$686;var $667$681;var $668$682;var $669$683;var t0$676;var t1$677;var bridge$656$678;var bridge$657$679;var m$655$671;var context$645;var env$646;(t0$648=temp$640$642);if(((t0$648 instanceof Array)&&((t1$649=t0$648.length),(t1$649===2)))){(context$645=t0$648[0]);(env$646=t0$648[1]);;}else{throw Error("Mismatch");}(expr$643=expand$588.step([context$645,env$646],expr$643));(m$655$671=expr$643);;if((($667$681=(m$655$671 instanceof Array))&&((t0$676=m$655$671.length),((t0$676===2)&&(m$655$671[0]==="symbol"))))){(s$686=m$655$671[1]);return expr$643;}else{if(($667$681&&((t0$676===1)&&(m$655$671[0]==="void")))){return ["void"];}else{if(($667$681&&((t0$676===3)&&(m$655$671[0]==="send")))){(f$696=m$655$671[1]);(arg$697=m$655$671[2]);(f$696=expand$588(["head",env$646],f$696));return ["send",f$696,expand$588(["tail",env$646],arg$697)];}else{if(($667$681&&((t0$676===2)&&(m$655$671[0]==="value")))){(v$703=m$655$671[1]);return expr$643;}else{if(($667$681&&(($669$683=(t0$676>=1))&&((t1$677=m$655$671[0]),((type$708=t1$677),((bridge$656$678=t1$677),((bridge$656$678==="array")||(bridge$656$678==="object")))))))){(args$709=Array.prototype.slice.call(m$655$671,1));(arr$717=[]);;$716:while((args$709.length>0)){var other$740;var stmts$734;var t0$730;var m$723$725;(m$723$725=expand$588.step([type$708,env$646],args$709.shift()));;if(((m$723$725 instanceof Array)&&((t0$730=m$723$725.length),((t0$730>=1)&&(m$723$725[0]==="splice"))))){(stmts$734=Array.prototype.slice.call(m$723$725,1));(args$709=stmts$734.concat(args$709));}else{(other$740=m$723$725);arr$717.push(other$740);}}return [type$708].concat((((acc$744=[])),(((temp$749=arr$717)),(((len$754=temp$749.length)),(((i$759=0)),function(){$742:for(;(i$759<len$754);(i$759++)){var x$775;var m$767;(m$767=temp$749[i$759]);;(x$775=m$767);acc$744.push(expand$588([type$708,env$646],x$775));}}()))),acc$744));}else{if(($669$683&&(m$655$671[0]==="multi"))){(args$779=Array.prototype.slice.call(m$655$671,1));(arr$784=[]);;$783:while((args$779.length>0)){var other$821;var stmt$816;var stmts$810;var $792$806;var $793$807;var t0$804;var m$791$799;var type$794;(type$794=function(){if((args$779.length===1)){return "expr";}else{return "multi";}}());;(m$791$799=expand$588.step([type$794,env$646],args$779.shift()));;if((($792$806=(m$791$799 instanceof Array))&&((t0$804=m$791$799.length),((t0$804>=1)&&(m$791$799[0]==="splice"))))){(stmts$810=Array.prototype.slice.call(m$791$799,1));(args$779=stmts$810.concat(args$779));}else{if(($792$806&&((t0$804===2)&&(m$791$799[0]==="sink")))){(stmt$816=m$791$799[1]);args$779.push(stmt$816);}else{(other$821=m$791$799);arr$784.push([other$821,type$794]);}}}return ["multi"].concat((((acc$825=[])),(((temp$830=arr$784)),(((len$835=temp$830.length)),(((i$840=0)),function(){$823:for(;(i$840<len$835);(i$840++)){var x$858;var type$859;var t0$853;var t1$854;var m$848;(m$848=temp$830[i$840]);;(t0$853=m$848);if(((t0$853 instanceof Array)&&((t1$854=t0$853.length),(t1$854===2)))){(x$858=t0$853[0]);(type$859=t0$853[1]);acc$825.push(expand$588([type$859,env$646],x$858));}else{false;;}}}()))),acc$825));}else{if(($669$683&&(m$655$671[0]==="data"))){(args$867=Array.prototype.slice.call(m$655$671,1));(is_obj$872=false);;(obj$873=["object"]);;(arr$874=["array"]);;(parts$875=[]);;(newpart$876=function(){var other$910;var t0$901;var m$894$896;(m$894$896=arr$874);;if(((m$894$896 instanceof Array)&&((t0$901=m$894$896.length),((t0$901===1)&&(m$894$896[0]==="array"))))){return false;}else{(other$910=m$894$896);parts$875.push(arr$874);return (arr$874=["array"]);}});;$871:while((args$867.length>0)){var other$954;var expr$948;var exprs$943;var k$936;var v$937;var $917$927;var $918$928;var t0$925;var m$916$920;(m$916$920=expand$588.step(["data",env$646],args$867.shift()));;if((($917$927=(m$916$920 instanceof Array))&&((t0$925=m$916$920.length),((t0$925===1)&&(m$916$920[0]==="assoc"))))){(is_obj$872=true);}else{if(($917$927&&((t0$925===3)&&(m$916$920[0]==="assoc")))){(k$936=m$916$920[1]);(v$937=m$916$920[2]);(is_obj$872=true);obj$873.push(["array",k$936,v$937]);}else{if(($917$927&&((t0$925>=1)&&(m$916$920[0]==="splice")))){(exprs$943=Array.prototype.slice.call(m$916$920,1));(args$867=exprs$943.concat(args$867));}else{if(($917$927&&((t0$925===2)&&(m$916$920[0]==="dynsplice")))){(expr$948=m$916$920[1]);newpart$876();parts$875.push(expr$948);}else{(other$954=m$916$920);arr$874.push(other$954);}}}}}newpart$876();(r$877=(((m$958$963=parts$875)),function(){if((($959$972=(m$958$963 instanceof Array))&&((t0$968=m$958$963.length),(($961$974=(t0$968===0))&&is_obj$872)))){return obj$873;}else{if($961$974){return ["array"];}else{if(($959$972&&((t0$968===1)&&((t1$969=m$958$963[0]),((arr$986=t1$969),((t1$969 instanceof Array)&&((t2$970=t1$969.length),((t2$970>=1)&&(t1$969[0]==="array"))))))))){(things$987=Array.prototype.slice.call(t1$969,1));if(is_obj$872){arr$986.push(obj$873);}return arr$986;}else{(other$997=m$958$963);if(is_obj$872){parts$875.push(["array",obj$873]);}(patch$1000=["symbol","patch_array"]);;return ["send",patch$1000,["array"].concat(parts$875)];}}}}()));;return expand$588([context$645,env$646],r$877);}else{if(($667$681&&(($669$683=(t0$676===3))&&(m$655$671[0]==="lambda")))){(bindings$1008=m$655$671[1]);(body$1009=m$655$671[2]);return ["lambda",(((acc$1014=[])),(((temp$1019=bindings$1008)),(((len$1024=temp$1019.length)),(((i$1029=0)),function(){$1012:for(;(i$1029<len$1024);(i$1029++)){var x$1045;var m$1037;(m$1037=temp$1019[i$1029]);;(x$1045=m$1037);acc$1014.push(expand$588(["decl",env$646],x$1045));}}()))),acc$1014),expand$588(["expr",env$646],body$1009)];}else{if(($669$683&&(m$655$671[0]==="declare"))){(binding$1049=m$655$671[1]);(value$1050=m$655$671[2]);return ["declare",expand$588(["decl",env$646],binding$1049),expand$588(["expr",env$646],value$1050)];}else{if(($669$683&&(m$655$671[0]==="assign"))){(lhs$1055=m$655$671[1]);(rhs$1056=m$655$671[2]);return ["assign",expand$588(["decl",env$646],lhs$1055),expand$588(["expr",env$646],rhs$1056)];}else{if(($667$681&&((t0$676>=1)&&((t1$677=m$655$671[0]),((type$1061=t1$677),((bridge$657$679=t1$677),(((bridge$658$1068=bridge$657$679),(((bridge$659$1071=bridge$658$1068),(((bridge$660$1074=bridge$659$1071),(((bridge$661$1077=bridge$660$1074),(((bridge$662$1080=bridge$661$1077),(((bridge$663$1083=bridge$662$1080),(((bridge$664$1086=bridge$663$1083),(((bridge$665$1089=bridge$664$1086),(((bridge$666$1092=bridge$665$1089),((bridge$666$1092==="js_while")||(bridge$666$1092==="js_for")))||(bridge$665$1089==="js_for_in")))||(bridge$664$1086==="js_break")))||(bridge$663$1083==="js_continue")))||(bridge$662$1080==="js_return")))||(bridge$661$1077==="js_delete")))||(bridge$660$1074==="js_throw")))||(bridge$659$1071==="js_try")))||(bridge$658$1068==="js_new")))||(bridge$657$679==="if")))))))){(args$1062=Array.prototype.slice.call(m$655$671,1));(ctxs$1096=(τ16(js_contexts$587,type$1061)||[]));;(f$1101=function(x$1105,i$1106){return expand$588([(τ16(ctxs$1096,i$1106)||"expr"),env$646],x$1105);});;return [type$1061].concat(args$1062.map(f$1101));}else{if(($667$681&&((t0$676===2)&&(m$655$671[0]==="done")))){(expr$1111=m$655$671[1]);return expr$1111;}else{(other$1116=m$655$671);throw τ18(["syntax","illegal_node"]).create("An illegal node was found in expand",({"node":other$1116}));}}}}}}}}}}}}});;(expand$588["step"]=function(temp$1119$1122,temp$1120$1123){var t0$1135;var t1$1136;var t0$1142;var other$1215;var m$1210;var m$1202;var $1165$1187;var $1166$1188;var $1167$1189;var $1168$1190;var $1169$1191;var $1170$1192;var $1171$1193;var $1172$1194;var t0$1183;var t1$1184;var t2$1185;var m$1164$1178;var v$1173;var other$1255;var m$1249;var t0$1245;var m$1238$1240;var other$1265;var type$1259;var args$1260;var f$1234;var arg$1235;var m$1229;var m$1223;var s$1159;var $1126$1153;var $1127$1154;var $1128$1155;var $1129$1156;var t0$1151;var m$1125$1146;var ph$1130;var context$1131;var env$1132;var expr$1133;(t0$1135=temp$1119$1122);if(((t0$1135 instanceof Array)&&((t1$1136=t0$1135.length),(t1$1136===2)))){(context$1131=t0$1135[0]);(env$1132=t0$1135[1]);;}else{throw Error("Mismatch");}(t0$1142=temp$1120$1123);(expr$1133=t0$1142);(ph$1130=t0$1142);;(m$1125$1146=ph$1130);;if((($1126$1153=(m$1125$1146 instanceof Array))&&((t0$1151=m$1125$1146.length),((t0$1151===2)&&(m$1125$1146[0]==="symbol"))))){(s$1159=m$1125$1146[1]);(v$1173=env$1132.resolve(s$1159));;(m$1164$1178=[v$1173,context$1131]);;if((($1165$1187=(m$1164$1178 instanceof Array))&&((t0$1183=m$1164$1178.length),(($1167$1189=(t0$1183===2))&&(m$1164$1178[0]===(void 0)))))){m$1164$1178[1];return ["symbol",s$1159];}else{if(($1167$1189&&((t1$1184=m$1164$1178[0]),(($1169$1191=(t1$1184 instanceof Array))&&((t2$1185=t1$1184.length),(($1171$1193=(t2$1185===2))&&(($1172$1194=(t1$1184[0]==="macro"))&&((m$1202=t1$1184[1]),(m$1164$1178[1]==="head"))))))))){return v$1173;}else{if($1172$1194){(m$1210=t1$1184[1]);m$1164$1178[1];return expand$588.step([context$1131,env$1132],m$1210([context$1131,env$1132],["void"]));}else{(other$1215=m$1164$1178);return v$1173;}}}}else{if(($1126$1153&&((t0$1151===1)&&(m$1125$1146[0]==="void")))){return ["void"];}else{if(($1126$1153&&(($1128$1155=(t0$1151===2))&&(($1129$1156=(m$1125$1146[0]==="macro"))&&((m$1223=m$1125$1146[1]),(context$1131==="head")))))){return expr$1133;}else{if($1129$1156){(m$1229=m$1125$1146[1]);return expand$588.step([context$1131,env$1132],m$1229([context$1131,env$1132],["void"]));}else{if(($1126$1153&&((t0$1151===3)&&(m$1125$1146[0]==="send")))){(f$1234=m$1125$1146[1]);(arg$1235=m$1125$1146[2]);(m$1238$1240=expand$588.step(["head",env$1132],f$1234));;if(((m$1238$1240 instanceof Array)&&((t0$1245=m$1238$1240.length),((t0$1245===2)&&(m$1238$1240[0]==="macro"))))){(m$1249=m$1238$1240[1]);return expand$588.step([context$1131,env$1132],m$1249([context$1131,env$1132],arg$1235));}else{(other$1255=m$1238$1240);return expr$1133;}}else{if(($1126$1153&&(t0$1151>=1))){(type$1259=m$1125$1146[0]);(args$1260=Array.prototype.slice.call(m$1125$1146,1));return expr$1133;}else{(other$1265=m$1125$1146);throw τ18(["syntax","illegal_node"]).create("An illegal node was found in expand.step",({"node":other$1265}));}}}}}}});(expand$588["step_all"]=function(context$1269,temp$1267$1270){var t0$1274;var t1$1275;var pre$1282;var bulk$1283;var post$1284;var stmts$1272;(t0$1274=temp$1267$1270);if(((t0$1274 instanceof Array)&&((t1$1275=t0$1274.length),(t1$1275>=0)))){(stmts$1272=Array.prototype.slice.call(t0$1274,0));;}else{throw Error("Mismatch");}(pre$1282=[]);;(bulk$1283=[]);;(post$1284=[]);;$1281:while(stmts$1272.length){var x$1334;var m$1329;var stmt$1324;var stmt$1319;var prepend$1313;var $1297$1308;var $1298$1309;var $1299$1310;var t0$1306;var m$1296$1301;(m$1296$1301=expand$588.step(context$1269,stmts$1272.shift()));;if((($1297$1308=(m$1296$1301 instanceof Array))&&((t0$1306=m$1296$1301.length),((t0$1306>=1)&&(m$1296$1301[0]==="splice"))))){(prepend$1313=Array.prototype.slice.call(m$1296$1301,1));(stmts$1272=prepend$1313.concat(stmts$1272));}else{if(($1297$1308&&(($1299$1310=(t0$1306===2))&&(m$1296$1301[0]==="float")))){(stmt$1319=m$1296$1301[1]);(pre$1282=pre$1282.concat(expand$588.step_all(context$1269,[stmt$1319])));}else{if(($1299$1310&&(m$1296$1301[0]==="sink"))){(stmt$1324=m$1296$1301[1]);(post$1284=post$1284.concat(expand$588.step_all(context$1269,[stmt$1324])));}else{if(($1299$1310&&(m$1296$1301[0]==="multimacro"))){(m$1329=m$1296$1301[1]);(stmts$1272=m$1329(context$1269,stmts$1272));}else{(x$1334=m$1296$1301);bulk$1283.push(x$1334);}}}}}return pre$1282.concat(bulk$1283).concat(post$1284);});(exports["expand"]=expand$588);(exports["Env"]=Env$585);(exports["nullenv"]=nullenv$586);
