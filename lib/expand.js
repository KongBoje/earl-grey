var $1634=(function(type$1637){var f$1641;(f$1641=type$1637["::check"]);if((f$1641===(void 0))){return (function(value$1647){return (value$1647 instanceof type$1637);});}else{return (function(value$1651){return f$1641.call(type$1637,value$1651);});}});
var $1653=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $1654=(function(dest$1657,values$1658){var k$1663;(k$1663=null);$1661:for(k$1663 in values$1658){if(values$1658.hasOwnProperty(k$1663)){(dest$1657[k$1663]=values$1658[k$1663]);}}return dest$1657;});
var $1671=(function($1673$1676){var ph$1682;(ph$1682=$1673$1676);var $1678$1688;($1678$1688=ph$1682);var bridge$1680$1693;var x$1697;(bridge$1680$1693=$1678$1688);if((((typeof(bridge$1680$1693)==="string")&&((x$1697=bridge$1680$1693),true))||((typeof(bridge$1680$1693)==="number")&&((x$1697=bridge$1680$1693),true)))){return ["value",x$1697];}else{var other$1708;(other$1708=$1678$1688);return other$1708["::serialize_ast"]();}});
var send$1408;(send$1408=(function(obj$1415,$1412$1416){var ph$1422;var msg$1423;var t0$1425;(t0$1425=$1412$1416);(msg$1423=t0$1425);(ph$1422=t0$1425);var $1418$1434;($1418$1434=ph$1422);var bridge$1420$1439;(bridge$1420$1439=$1418$1434);if(((typeof(bridge$1420$1439)==="string")||(typeof(bridge$1420$1439)==="number"))){return obj$1415[msg$1423];}else{var other$1451;(other$1451=$1418$1434);return obj$1415["::send"](msg$1423);}}));(Array[":::project"]=(function($1457$1460){var ph$1465;var value$1466;var t0$1468;(t0$1468=$1457$1460);(value$1466=t0$1468);(ph$1465=t0$1468);var $1462$1477;($1462$1477=ph$1465);if($1634(Array)($1462$1477)){return [true,value$1466];}else{$1462$1477;return [true,[value$1466]];}}));(Array.prototype["::check"]=(function(value$1495){if((value$1495 instanceof Array)){var i$1501;(i$1501=0);$1498:for(;(i$1501<this.length);(i$1501++)){if(($1653(this,i$1501)!==$1653(value$1495,i$1501))){return false;}}return true;}else{return false;}}));(Array.prototype["::clone"]=(function(){return $1654(this.slice(0),this);}));(Array.prototype[":::project"]=(function(value$1520){if((value$1520 instanceof Array)){var i$1526;(i$1526=0);$1523:for(;(i$1526<this.length);(i$1526++)){if(($1653(this,i$1526)!==$1653(value$1520,i$1526))){return [true,[value$1520]];}}return [true,value$1520.slice(this.length)];}else{return [true,[value$1520]];}}));(Array.prototype["::serialize_ast"]=(function(){return ["array"].concat(this.map($1671));}));(RegExp.prototype["::check"]=(function($1544$1547){var ph$1552;(ph$1552=$1544$1547);var $1549$1558;($1549$1558=ph$1552);var value$1566;if((typeof($1549$1558)==="string")){(value$1566=$1549$1558);if(value$1566.match(this)){return true;}else{return false;}}else{var other$1571;(other$1571=$1549$1558);return false;}}));(RegExp.prototype[":::project"]=(function($1577$1580){var ph$1585;(ph$1585=$1577$1580);var $1582$1591;($1582$1591=ph$1585);var value$1599;if((typeof($1582$1591)==="string")){(value$1599=$1582$1591);var $1602$1607;($1602$1607=value$1599.match(this));var m$1615;if(($1602$1607===null)){(m$1615=$1602$1607);return [false,null];}else{var m$1620;(m$1620=$1602$1607);return [true,m$1620];}}else{var other$1624;(other$1624=$1582$1591);return [false,null];}}));(Function.prototype["::send"]=(function(args$1631){return this.apply(this,args$1631);}));
var $4987=(function(arr$4990){var results$4996;var l$4997;(results$4996=[]);(l$4997=arr$4990.length);var i$5006;(i$5006=0);$4995:for(;(i$5006<l$4997);(i$5006++)){results$4996.push([i$5006,$1653(arr$4990,i$5006)]);}return results$4996;});
var $4754=(function(){var $4755$4761;($4755$4761=(function(tags$4766){var it$0$4769;(it$0$4769=(function(){if((!$1634($4755$4761)(this))){return Object.create($4755$4761.prototype);}else{return this;}})());(it$0$4769["tags"]=tags$4766);return it$0$4769;}));($4755$4761.prototype["create"]=(function(){var it$0$4789;var self$4790;(it$0$4789=this);(self$4790=this);var $4787$4799;($4787$4799=arguments);var t0$4804;var message$4808;var args$4809;(t0$4804=$4787$4799.length);if((t0$4804>=0)){(message$4808=(function(){if((0>=t0$4804)){return "";}else{return $4787$4799[0];}})());(args$4809=Array.prototype.slice.call($4787$4799,1));var e$4822;(e$4822=Error(message$4808));(e$4822["::tags"]=it$0$4789.tags);(e$4822["args"]=args$4809);var temp$4838;(temp$4838=$4987(args$4809));var $length$4844;($length$4844=temp$4838.length);var $index$4850;($index$4850=0);$4823:for(;($index$4850<$length$4844);($index$4850++)){var m$4859;(m$4859=temp$4838[$index$4850]);var t0$4864;var t1$4865;var i$4869;var arg$4870;(t0$4864=m$4859);if(((t0$4864 instanceof Array)&&(((t1$4865=t0$4864.length)),(t1$4865===2)))){(i$4869=t0$4864[0]);(arg$4870=t0$4864[1]);(e$4822[i$4869]=arg$4870);}else{$4735(m$4859);}}(e$4822["length"]=args$4809.length);(e$4822["name"]=["E"].concat(it$0$4789.tags).join("."));return e$4822;}else{$4735($4787$4799);}}));($4755$4761.prototype["::check"]=(function(e$4900){var it$0$4904;var self$4905;(it$0$4904=this);(self$4905=this);var tags$4915;if(((!e$4900)||(!$1634(Error)(e$4900)))){return false;}(tags$4915=(e$4900["::tags"]||[]));var temp$4926;(temp$4926=it$0$4904.tags);var $length$4932;($length$4932=temp$4926.length);var $index$4938;($index$4938=0);$4916:for(;($index$4938<$length$4932);($index$4938++)){var m$4947;(m$4947=temp$4926[$index$4938]);var tag$4955;(tag$4955=m$4947);if((tags$4915.indexOf(tag$4955)===-1)){return false;}else{false;}}return true;}));($4755$4761.prototype["::deconstruct"]=(function(e$4964){var it$0$4968;var self$4969;(it$0$4968=this);(self$4969=this);return e$4964.args;}));$1654($4755$4761,$1654((function(){var accum$4980;(accum$4980=({}));(accum$4980["::name"]="$4755");return accum$4980;})(),(function(){var accum$4984;(accum$4984=({}));(accum$4984["::egclass"]=true);return accum$4984;})()));return $4755$4761;})();
var $4735=(function(value$4738,url$4739,start$4740,end$4741){var err$4745;(err$4745=$4754(["match"]).create("Could not find a match for value",({"value":value$4738})));if(url$4739){(err$4745["location"]=["location",url$4739,start$4740,end$4741]);}throw err$4745;});
var $5013=(function($5015$5018,key$5019){var ph$5027;(ph$5027=$5015$5018);var $5021$5033;($5021$5033=ph$5027);var bridge$5023$5038;(bridge$5023$5038=$5021$5033);if(((bridge$5023$5038===null)||(bridge$5023$5038===(void 0)))){return false;}else{var x$5050;if((typeof($5021$5033)==="string")){(x$5050=$5021$5033);return (key$5019 in String.prototype);}else{var x$5055;if((typeof($5021$5033)==="number")){(x$5055=$5021$5033);return (key$5019 in Number.prototype);}else{var x$5060;(x$5060=$5021$5033);return (key$5019 in x$5060);}}}});
var $5062=(function(obj$5065){var results$5070;(results$5070=[]);var k$5075;(k$5075=null);$5069:for(k$5075 in obj$5065){if(Object.prototype.hasOwnProperty.call(obj$5065,k$5075)){results$5070.push([k$5075,$1653(obj$5065,k$5075)]);}}return results$5070;});
var $5079=(function(type$5082){return (function(value$5086){var f$5090;(f$5090=type$5082[":::project"]);if((f$5090===(void 0))){(f$5090=type$5082["::project"]);if((f$5090===(void 0))){return [true,type$5082(value$5086)];}else{var rval$5103;(rval$5103=false);try{(rval$5103=[true,f$5090(value$5086)]);}catch(excv$5114){var e$5120;(e$5120=excv$5114);(rval$5103=[false,null]);}return rval$5103;}}else{return f$5090.call(type$5082,value$5086);}});});var accum$2000;var accum$2004;var accum$2428;var accum$2432;var accum$4545;var accum$4549;var $1712$1753;var __lt____gt__$1754;var $1713$1755;var __lt____lt____colon__$1756;var util$1757;var classify$1758;var neighbours$1759;var GenSym$1760;var gensym$1761;var $1715$1762;var PatternParser$1763;var PatternProcessor$1764;var Scope$1765;var Env$1766;var track_location$1767;var Expander$1768;var mac1$1769;var __chk_ncache$1770;var __chk_scache$1771;var checker_db$1772;($1712$1753=require("./pp"));(__lt____gt__$1754=$1712$1753["<>"]);($1713$1755=require("./location"));(__lt____lt____colon__$1756=$1713$1755["<<:"]);(util$1757=require("./util"));(classify$1758=util$1757.classify);(neighbours$1759=util$1757.neighbours);(GenSym$1760=util$1757.GenSym);(gensym$1761=util$1757.gensym);($1715$1762=require("./pattern"));(PatternParser$1763=$1715$1762.PatternParser);(PatternProcessor$1764=$1715$1762.PatternProcessor);(Scope$1765=(function(){var t0$1829;var $1820$1824;var it$0$1815;(it$0$1815=(function(){if((!$1634(Scope$1765)(this))){return Object.create(Scope$1765.prototype);}else{return this;}})());($1820$1824=arguments);(t0$1829=$1820$1824.length);if(((t0$1829>=0)&&(t0$1829<=3))){(it$0$1815["parent"]=(function(){if((0>=t0$1829)){return null;}else{return $1820$1824[0];}})());(it$0$1815["name"]=(function(){if((1>=t0$1829)){return gensym$1761("scope");}else{return $1820$1824[1];}})());(it$0$1815["expander"]=(function(){if((2>=t0$1829)){return it$0$1815.parent.expander;}else{return $1820$1824[2];}})());(it$0$1815["options"]=({}));}else{$4735($1820$1824);}return it$0$1815;}));(Scope$1765.prototype["getopt"]=(function(opt$1850){var otherwise$1887;var $1867$1876;var $1863$1870;var it$0$1854;var self$1855;(it$0$1854=this);(self$1855=this);($1863$1870=null);$1863$1870;if(Object.prototype.hasOwnProperty.call(it$0$1854.options,opt$1850)){return $1653(it$0$1854.options,opt$1850);}else{if((it$0$1854.parent===null)){return (void 0);}else{(otherwise$1887=$1863$1870);return it$0$1854.parent.getopt(opt$1850);}}}));(Scope$1765.prototype["setopt"]=(function(opt$1893,value$1894){var it$0$1898;var self$1899;(it$0$1898=this);(self$1899=this);(it$0$1898.options[opt$1893]=value$1894);}));(Scope$1765.prototype["gensym"]=(function(){var it$0$1918;var self$1919;(it$0$1918=this);(self$1919=this);return it$0$1918.expander.gensym();}));(Scope$1765.prototype["step"]=(function(context$1931,expr$1932){var it$0$1936;var self$1937;(it$0$1936=this);(self$1937=this);return it$0$1936.expander.step(context$1931,it$0$1936,expr$1932);}));(Scope$1765.prototype["step_all"]=(function(context$1949,exprs$1950){var it$0$1954;var self$1955;(it$0$1954=this);(self$1955=this);return it$0$1954.expander.step_all(context$1949,it$0$1954,exprs$1950);}));(Scope$1765.prototype["expand"]=(function(context$1967,expr$1968){var it$0$1972;var self$1973;(it$0$1972=this);(self$1973=this);return it$0$1972.expander.expand(context$1967,it$0$1972,expr$1968);}));(Scope$1765.prototype["toString"]=(function(){var it$0$1988;var self$1989;(it$0$1988=this);(self$1989=this);return (("Scope{"+it$0$1988.name)+"}");}));$1654(Scope$1765,$1654(((accum$2000=({})),((accum$2000["::name"]="Scope"),accum$2000)),((accum$2004=({})),((accum$2004["::egclass"]=true),accum$2004))));Scope$1765;(Env$1766=(function(){var it$0$2013;(it$0$2013=(function(){if((!$1634(Env$1766)(this))){return Object.create(Env$1766.prototype);}else{return this;}})());(it$0$2013["scopes"]=({}));return it$0$2013;}));(Env$1766.prototype["list_bindings"]=(function(origin$2028){var values$2044;var scope$2045;var it$0$2032;var self$2033;(it$0$2032=this);(self$2033=this);(values$2044=({}));(scope$2045=origin$2028);$2052:while(scope$2045){$1654(values$2044,$1653(it$0$2032.scopes,scope$2045.name));(scope$2045=scope$2045.parent);}return values$2044;}));(Env$1766.prototype["resolve"]=(function(scope$2064,name$2065){var scope_data$2080;var it$0$2069;var self$2070;(it$0$2069=this);(self$2070=this);if((scope$2064===null)){return (void 0);}(scope_data$2080=$1653(it$0$2069.scopes,scope$2064.name));if((scope_data$2080&&Object.prototype.hasOwnProperty.call(scope_data$2080,name$2065))){return $1653(scope_data$2080,name$2065);}else{return it$0$2069.resolve(scope$2064.parent,name$2065);}}));(Env$1766.prototype["bind"]=(function(scope$2089,name$2090,value$2091){var it$0$2095;var self$2096;(it$0$2095=this);(self$2096=this);if((!$1653(it$0$2095.scopes,scope$2089.name))){(it$0$2095.scopes[scope$2089.name]=({}));}($1653(it$0$2095.scopes,scope$2089.name)[name$2090]=value$2091);}));(Env$1766.prototype["mark"]=(function(expr$2118){var x$2185;var x$2191;var bridge$2137$2177;var x$2197;var bridge$2136$2170;var x$2203;var bridge$2135$2163;var x$2209;var $index$2244;var $length$2238;var temp$2232;var other$2265;var type$2216;var args$2217;var e$2152;var bridge$2134$2147;var t0$2148;var $2131$2142;var it$0$2122;var self$2123;(it$0$2122=this);(self$2123=this);($2131$2142=expr$2118);if($5013($2131$2142,"env")){(e$2152=$2131$2142.env);return expr$2118;}else{(bridge$2134$2147=$2131$2142);if(((((bridge$2135$2163=bridge$2134$2147)),((((bridge$2136$2170=bridge$2135$2163)),((((bridge$2137$2177=bridge$2136$2170)),((((x$2185=bridge$2137$2177)),((x$2185 instanceof Array)&&(x$2185[0]==="symbol")))||(((x$2191=bridge$2137$2177)),((x$2191 instanceof Array)&&(x$2191[0]==="value")))))||(((x$2197=bridge$2136$2170)),((x$2197 instanceof Array)&&(x$2197[0]==="variable")))))||(((x$2203=bridge$2135$2163)),((x$2203 instanceof Array)&&(x$2203[0]==="macro")))))||(((x$2209=bridge$2134$2147)),((x$2209 instanceof Array)&&(x$2209[0]==="void"))))){return $1654(expr$2118,({"env":it$0$2122}));}else{if((($2131$2142 instanceof Array)&&(((t0$2148=$2131$2142.length)),(t0$2148>=1)))){(type$2216=$2131$2142[0]);(args$2217=Array.prototype.slice.call($2131$2142,1));(temp$2232=args$2217);($length$2238=temp$2232.length);($index$2244=0);$2226:for(;($index$2244<$length$2238);($index$2244++)){var arg$2261;var m$2253;(m$2253=temp$2232[$index$2244]);(arg$2261=m$2253);it$0$2122.mark(arg$2261);}return $1654(expr$2118,({"env":it$0$2122}));}else{(other$2265=$2131$2142);return $1654(expr$2118,({"env":it$0$2122}));}}}}));(Env$1766.prototype["fork"]=(function(){var $index$2307;var $length$2301;var temp$2295;var e$2285;var it$0$2274;var self$2275;(it$0$2274=this);(self$2275=this);(e$2285=Env$1766());(temp$2295=$5062(it$0$2274.scopes));($length$2301=temp$2295.length);($index$2307=0);$2286:for(;($index$2307<$length$2301);($index$2307++)){var $index$2362;var $length$2356;var temp$2350;var acc$2344;var scope$2326;var bindings$2327;var t0$2321;var t1$2322;var m$2316;(m$2316=temp$2295[$index$2307]);(t0$2321=m$2316);if(((t0$2321 instanceof Array)&&(((t1$2322=t0$2321.length)),(t1$2322===2)))){(scope$2326=t0$2321[0]);(bindings$2327=t0$2321[1]);(acc$2344=[]);(temp$2350=$5062(bindings$2327));($length$2356=temp$2350.length);($index$2362=0);$2339:for(;($index$2362<$length$2356);($index$2362++)){var k$2381;var v$2382;var t0$2376;var t1$2377;var m$2371;(m$2371=temp$2350[$index$2362]);(t0$2376=m$2371);if(((t0$2376 instanceof Array)&&(((t1$2377=t0$2376.length)),(t1$2377===2)))){(k$2381=t0$2376[0]);(v$2382=t0$2376[1]);acc$2344.push(((function(){if((!$1653(e$2285.scopes,scope$2326))){(e$2285.scopes[scope$2326]=({}));}})(),(($1653(e$2285.scopes,scope$2326)[k$2381]=v$2382))));}else{$4735(m$2371,"/home/olivier/git/earl-grey/src/expand.eg",2269,2426);}}acc$2344;}else{$4735(m$2316,"/home/olivier/git/earl-grey/src/expand.eg",2229,2426);}}return e$2285;}));(Env$1766.prototype["toString"]=(function(){var it$0$2416;var self$2417;(it$0$2416=this);(self$2417=this);return "Env{...}";}));$1654(Env$1766,$1654(((accum$2428=({})),((accum$2428["::name"]="Env"),accum$2428)),((accum$2432=({})),((accum$2432["::egclass"]=true),accum$2432))));Env$1766;(track_location$1767=(function(f$2439){var f2$2443;(f2$2443=(function(context$2448,scope$2449,expr$2450){var rval$2464;var other$2510;var v$2500;var t0$2496;var $2454$2491;var rval$2457;(rval$2457=(((rval$2464=false)),((function(){try{(rval$2464=f$2439(context$2448,scope$2449,expr$2450));}catch(excv$2475){var e$2481;(e$2481=excv$2475);(rval$2464=(__lt____lt____colon__$1756(e$2481,expr$2450),function(){throw e$2481;}()));}})(),rval$2464)));($2454$2491=rval$2457);if((($2454$2491 instanceof Array)&&(((t0$2496=$2454$2491.length)),((t0$2496===2)&&($2454$2491[0]==="bounce"))))){(v$2500=$2454$2491[1]);return f2$2443(context$2448,scope$2449,__lt____lt____colon__$1756(v$2500,expr$2450));}else{(other$2510=$2454$2491);return __lt____lt____colon__$1756(other$2510,expr$2450);}}));return f2$2443;}));(Expander$1768=(function(env_factory$2518,generic_nodes$2519){var it$0$2522;(it$0$2522=(function(){if((!$1634(Expander$1768)(this))){return Object.create(Expander$1768.prototype);}else{return this;}})());(it$0$2522["gensym"]=gensym$1761);(it$0$2522["mkenv"]=env_factory$2518);(it$0$2522["generic_nodes"]=generic_nodes$2519);return it$0$2522;}));(Expander$1768.prototype["run_macro"]=(function(m$2546,context$2547,scope$2548,form$2549,arg$2550){var rval$2573;var rval$2565;var it$0$2554;var self$2555;(it$0$2554=this);(self$2555=this);(rval$2565=(((rval$2573=false)),((function(){try{(rval$2573=m$2546(context$2547,scope$2548,form$2549,arg$2550));}catch(excv$2584){var msg$2641;var msg$2763;var find$2652;var err$2653;var other$2647;var $2624$2629;var e$2621;var e$2771;var value$2594;var t0$2587;var t1$2588;var t2$2589;var t3$2590;(t0$2587=excv$2584);if(($1634($4754(["match"]))(t0$2587)&&($5013(t0$2587,"args")&&(((t1$2588=t0$2587.args)),((t1$2588 instanceof Array)&&(((t2$2589=t1$2588.length)),((t2$2589===1)&&(((t3$2590=t1$2588[0])),$5013(t3$2590,"value"))))))))){(value$2594=t3$2590.value);(rval$2573=(((e$2621=((($2624$2629=value$2594)),(function(){if(($2624$2629===context$2547)){(msg$2641="The macro cannot be found in this context.");return $4754(["syntax","context"]).create(msg$2641,({"context":context$2547,"form":form$2549}));}else{(other$2647=$2624$2629);(find$2652=(function($2657$2660){var t0$2669;var msg$2691;var $index$2725;var $length$2719;var temp$2713;var other$2755;var type$2697;var xs$2698;var t0$2683;var $2662$2678;var ph$2666;var arg$2667;(t0$2669=$2657$2660);(arg$2667=t0$2669);(ph$2666=t0$2669);($2662$2678=ph$2666);if(($2662$2678===value$2594)){(msg$2691="The macro expected something different.");return $4754(["syntax","argument"]).create(msg$2691,({"context":context$2547,"argument":arg$2667,"form":form$2549}));}else{if((($2662$2678 instanceof Array)&&(((t0$2683=$2662$2678.length)),(t0$2683>=1)))){(type$2697=$2662$2678[0]);(xs$2698=Array.prototype.slice.call($2662$2678,1));(temp$2713=xs$2698);($length$2719=temp$2713.length);($index$2725=0);$2707:for(;($index$2725<$length$2719);($index$2725++)){var x$2743;var t0$2739;var m$2734;(m$2734=temp$2713[$index$2725]);(t0$2739=$5079(find$2652)(m$2734));if(t0$2739[0]){(x$2743=t0$2739[1]);if(x$2743){return x$2743;}}else{$4735(m$2734,"/home/olivier/git/earl-grey/src/expand.eg",3685,3770);}}return false;}else{(other$2755=$2662$2678);return false;}}}));(err$2653=find$2652(arg$2550));if(err$2653){return err$2653;}else{(msg$2763="The macro expected something different (could not locate error in the source).");return $4754(["syntax","failure"]).create(msg$2763,({"form":form$2549,"value":value$2594}));}}})()))),function(){throw e$2621;}()));}else{(e$2771=excv$2584);(rval$2573=function(){throw e$2771;}());}}})(),rval$2573)));return it$0$2554.mkenv().mark(rval$2565);}));(Expander$1768.prototype["step"]=(function(context$2782,scope$2783,expr$2784){var helper$2799;var it$0$2788;var self$2789;(it$0$2788=this);(self$2789=this);(helper$2799=track_location$1767((function(context$2806,scope$2807,$2803$2808){var t0$2822;var other$2877;var env$2872;var $2859$2864;var other$2922;var t0$2909;var $2899$2904;var other$2926;var m$2891;var t0$2887;var $2853$2882;var env$2856;var other$2956;var t0$2943;var $2933$2938;var other$2988;var m$2978;var t0$2974;var $2964$2969;var other$2997;var x$2992;var f$2960;var arg$2961;var m$2930;var s$2843;var $2816$2838;var $2817$2839;var $2818$2840;var t0$2836;var $2810$2831;var ph$2819;var expr$2820;(t0$2822=$2803$2808);(expr$2820=t0$2822);(ph$2819=t0$2822);($2810$2831=ph$2819);if((($2816$2838=($2810$2831 instanceof Array))&&(((t0$2836=$2810$2831.length)),(($2818$2840=(t0$2836===2))&&($2810$2831[0]==="symbol"))))){(s$2843=$2810$2831[1]);(env$2856=((($2859$2864=expr$2820)),(function(){if($5013($2859$2864,"env")){(env$2872=$2859$2864.env);return expr$2820.env;}else{(other$2877=$2859$2864);throw $4754(["syntax","no_env"]).create("No environment was found to resolve",({"symbol":expr$2820}));}})()));($2853$2882=env$2856.resolve(scope$2807,s$2843));if((($2853$2882 instanceof Array)&&(((t0$2887=$2853$2882.length)),((t0$2887===2)&&($2853$2882[0]==="macro"))))){(m$2891=$2853$2882[1]);($2899$2904=context$2806);if((($2899$2904 instanceof Array)&&(((t0$2909=$2899$2904.length)),((t0$2909===2)&&(($2899$2904[0]==="expr")&&($2899$2904[1]==="head")))))){return ["macro",m$2891];}else{(other$2922=$2899$2904);return ["bounce",it$0$2788.run_macro(m$2891,context$2806,scope$2807,expr$2820,__lt____lt____colon__$1756(["void"],expr$2820))];}}else{(other$2926=$2853$2882);return expr$2820;}}else{if(($2818$2840&&($2810$2831[0]==="macro"))){(m$2930=$2810$2831[1]);($2933$2938=context$2806);if((($2933$2938 instanceof Array)&&(((t0$2943=$2933$2938.length)),((t0$2943===2)&&(($2933$2938[0]==="expr")&&($2933$2938[1]==="head")))))){return expr$2820;}else{(other$2956=$2933$2938);return ["bounce",it$0$2788.run_macro(m$2930,context$2806,scope$2807,expr$2820,__lt____lt____colon__$1756(["void"],expr$2820))];}}else{if(($2816$2838&&((t0$2836===3)&&($2810$2831[0]==="send")))){(f$2960=$2810$2831[1]);(arg$2961=$2810$2831[2]);($2964$2969=helper$2799(["expr","head"],scope$2807,f$2960));if((($2964$2969 instanceof Array)&&(((t0$2974=$2964$2969.length)),((t0$2974===2)&&($2964$2969[0]==="macro"))))){(m$2978=$2964$2969[1]);return ["bounce",it$0$2788.run_macro(m$2978,context$2806,scope$2807,expr$2820,arg$2961)];}else{(other$2988=$2964$2969);return expr$2820;}}else{if(($2816$2838&&((t0$2836===2)&&($2810$2831[0]==="nostep")))){(x$2992=$2810$2831[1]);return x$2992;}else{(other$2997=$2810$2831);return expr$2820;}}}}})));return helper$2799(context$2782,scope$2783,expr$2784);}));(Expander$1768.prototype["step_all"]=(function(context$3006,scope$3007,$3003$3008){var t0$3023;var t1$3024;var pre$3041;var bulk$3042;var post$3043;var stmts$3021;var it$0$3012;var self$3013;(it$0$3012=this);(self$3013=this);(t0$3023=$3003$3008);if(((t0$3023 instanceof Array)&&(((t1$3024=t0$3023.length)),(t1$3024>=0)))){(stmts$3021=Array.prototype.slice.call(t0$3023,0));}else{$4735($3003$3008);}(pre$3041=[]);(bulk$3042=[]);(post$3043=[]);$3053:while(stmts$3021.length){var $index$3144;var $length$3138;var temp$3132;var acc$3126;var e$3115;var x$3167;var m$3109;var stmt$3104;var stmt$3099;var prepend$3085;var $3064$3080;var $3065$3081;var $3066$3082;var t0$3078;var $3058$3073;var current$3067;(current$3067=stmts$3021.shift());($3058$3073=it$0$3012.step(context$3006,scope$3007,current$3067));if((($3064$3080=($3058$3073 instanceof Array))&&(((t0$3078=$3058$3073.length)),((t0$3078>=1)&&($3058$3073[0]==="splice"))))){(prepend$3085=Array.prototype.slice.call($3058$3073,1));(stmts$3021=prepend$3085.concat(stmts$3021));}else{if(($3064$3080&&(($3066$3082=(t0$3078===2))&&($3058$3073[0]==="float")))){(stmt$3099=$3058$3073[1]);(pre$3041=pre$3041.concat(it$0$3012.step_all(context$3006,scope$3007,[stmt$3099])));}else{if(($3066$3082&&($3058$3073[0]==="sink"))){(stmt$3104=$3058$3073[1]);(post$3043=post$3043.concat(it$0$3012.step_all(context$3006,scope$3007,[stmt$3104])));}else{if(($3066$3082&&($3058$3073[0]==="restmacro"))){(m$3109=$3058$3073[1]);(e$3115=it$0$3012.mkenv());(stmts$3021=(((acc$3126=[])),(((temp$3132=m$3109(stmts$3021))),((($length$3138=temp$3132.length)),((($index$3144=0)),(function(){$3121:for(;($index$3144<$length$3138);($index$3144++)){var stmt$3161;var m$3153;(m$3153=temp$3132[$index$3144]);(stmt$3161=m$3153);acc$3126.push(e$3115.mark(stmt$3161));}})()))),acc$3126));}else{(x$3167=$3058$3073);bulk$3042.push(x$3167);}}}}}return pre$3041.concat(bulk$3042).concat(post$3043);}));(Expander$1768.prototype["expand"]=(function(context$3173,scope$3174,expr$3175){var helper$3190;var it$0$3179;var self$3180;(it$0$3179=this);(self$3180=this);(helper$3190=track_location$1767((function(context$3195,scope$3196,expr$3197){var t0$3260;var other$3282;var $3255$3270;var env$3258;var $index$3335;var $length$3329;var temp$3323;var acc$3317;var newargs$3309;var $index$3389;var $length$3383;var temp$3377;var acc$3371;var newargs$3363;var t0$3453;var newscope$3447;var env$3448;var $index$3537;var $length$3531;var temp$3525;var acc$3519;var $index$3749;var $length$3743;var temp$3737;var acc$3731;var t0$3498;var newscope$3482;var stepscope$3483;var changes$3484;var newargs$3485;var vars$3486;var exp$3487;var $index$4172;var $length$4166;var temp$4160;var other$4276;var t0$4254;var $4243$4249;var is_obj$4051;var obj$4052;var arr$4053;var arr_parts$4054;var obj_parts$4055;var new_arr_part$4056;var new_obj_part$4057;var r$4058;var x$4314;var msg$4321;var otherwise$4337;var m$4327;var t0$4307;var $4292$4302;var t$4296;var $index$4381;var $length$4375;var temp$4369;var acc$4363;var newscope$4351;var s$4460;var newscope$4473;var name$4451;var t0$4447;var $index$4517;var $length$4511;var temp$4505;var acc$4499;var other$4539;var type$4488;var args$4489;var tag$4477;var body$4478;var x$4442;var $3217$4443;var bindings$4345;var body$4346;var target$4286;var value$4287;var args$4039;var args$3473;var args$3468;var args$3463;var variable$3427;var s$3428;var value$3429;var body$3430;var args$3358;var args$3304;var f$3298;var arg$3299;var s$3245;var $3223$3240;var $3224$3241;var $3225$3242;var t0$3236;var t1$3237;var t2$3238;var $3201$3231;(expr$3197=it$0$3179.step(context$3195,scope$3196,expr$3197));($3201$3231=expr$3197);if((($3223$3240=($3201$3231 instanceof Array))&&(((t0$3236=$3201$3231.length)),(($3225$3242=(t0$3236===2))&&($3201$3231[0]==="symbol"))))){(s$3245=$3201$3231[1]);(t0$3260=expr$3197);if($5013(t0$3260,"env")){(env$3258=t0$3260.env);}else{$4735(expr$3197,"/home/olivier/git/earl-grey/src/expand.eg",8047,8051);}($3255$3270=env$3258.resolve(scope$3196,s$3245));if(($3255$3270===(void 0))){throw $4754(["syntax","undeclared"]).create(("Undeclared variable: "+s$3245),({"node":expr$3197}));}else{(other$3282=$3255$3270);return ["bounce",other$3282];}}else{if(($3225$3242&&($3201$3231[0]==="value"))){$3201$3231[1];return expr$3197;}else{if(($3225$3242&&($3201$3231[0]==="variable"))){$3201$3231[1];return expr$3197;}else{if(($3223$3240&&((t0$3236===1)&&($3201$3231[0]==="void")))){return expr$3197;}else{if(($3223$3240&&((t0$3236===3)&&($3201$3231[0]==="send")))){(f$3298=$3201$3231[1]);(arg$3299=$3201$3231[2]);return ["send",helper$3190(["expr","head"],scope$3196,f$3298),helper$3190(["expr","tail"],scope$3196,arg$3299)];}else{if(($3223$3240&&(($3225$3242=(t0$3236>=1))&&($3201$3231[0]==="array")))){(args$3304=Array.prototype.slice.call($3201$3231,1));(newargs$3309=(((acc$3317=[])),(((temp$3323=it$0$3179.step_all(["expr","array"],scope$3196,args$3304))),((($length$3329=temp$3323.length)),((($index$3335=0)),(function(){$3312:for(;($index$3335<$length$3329);($index$3335++)){var arg$3352;var m$3344;(m$3344=temp$3323[$index$3335]);(arg$3352=m$3344);acc$3317.push(helper$3190(["expr","expr"],scope$3196,arg$3352));}})()))),acc$3317));return ["array"].concat(newargs$3309);}else{if(($3225$3242&&($3201$3231[0]==="object"))){(args$3358=Array.prototype.slice.call($3201$3231,1));(newargs$3363=(((acc$3371=[])),(((temp$3377=it$0$3179.step_all(["expr","object"],scope$3196,args$3358))),((($length$3383=temp$3377.length)),((($index$3389=0)),(function(){$3366:for(;($index$3389<$length$3383);($index$3389++)){var k$3408;var v$3409;var t0$3403;var t1$3404;var m$3398;(m$3398=temp$3377[$index$3389]);(t0$3403=m$3398);if(((t0$3403 instanceof Array)&&(((t1$3404=t0$3403.length)),((t1$3404===3)&&(t0$3403[0]==="array"))))){(k$3408=t0$3403[1]);(v$3409=t0$3403[2]);acc$3371.push(["array",helper$3190(["expr","expr"],scope$3196,k$3408),helper$3190(["expr","expr"],scope$3196,v$3409)]);}else{$4735(m$3398,"/home/olivier/git/earl-grey/src/expand.eg",8890,9079);}}})()))),acc$3371));return ["object"].concat(newargs$3363);}else{if(($3223$3240&&((t0$3236===4)&&(($3201$3231[0]==="bind")&&(((t1$3237=$3201$3231[1])),((variable$3427=t1$3237),((t1$3237 instanceof Array)&&(((t2$3238=t1$3237.length)),((t2$3238===2)&&(t1$3237[0]==="symbol")))))))))){(s$3428=t1$3237[1]);(value$3429=$3201$3231[2]);(body$3430=$3201$3231[3]);(newscope$3447=Scope$1765(scope$3196));(t0$3453=variable$3427);if($5013(t0$3453,"env")){(env$3448=t0$3453.env);}else{$4735(variable$3427,"/home/olivier/git/earl-grey/src/expand.eg",9222,9230);}env$3448.bind(newscope$3447,s$3428,value$3429);return helper$3190(context$3195,newscope$3447,body$3430);}else{if(($3223$3240&&(($3225$3242=(t0$3236>=1))&&($3201$3231[0]==="splice")))){(args$3463=Array.prototype.slice.call($3201$3231,1));return ["bounce",$1654(["multi"].concat(args$3463),({"override_scope":true}))];}else{if(($3225$3242&&($3201$3231[0]==="interactive"))){(args$3468=Array.prototype.slice.call($3201$3231,1));return ["bounce",$1654(["multi"].concat(args$3468),({"override_scope":true,"all_mutable":true}))];}else{if(($3225$3242&&($3201$3231[0]==="multi"))){(args$3473=Array.prototype.slice.call($3201$3231,1));(newscope$3482=(function(){if(expr$3197.override_scope){return scope$3196;}else{return Scope$1765(scope$3196);}})());(stepscope$3483=(function(){if(expr$3197.nonrecursive){return scope$3196;}else{return newscope$3482;}})());(changes$3484=false);(t0$3498=classify$1758("newargs","vars",(((acc$3519=[])),(((temp$3525=it$0$3179.step_all(["expr","multi"],stepscope$3483,args$3473))),((($length$3531=temp$3525.length)),((($index$3537=0)),(function(){$3503:for(;($index$3537<$length$3531);($index$3537++)){var t0$3603;var env$3601;var t0$3637;var v$3648;var env$3635;var t0$3695;var env$3693;var other$3708;var s$3675;var variable$3676;var v$3657;var value$3658;var variable$3616;var s$3617;var value$3618;var variable$3581;var s$3582;var value$3583;var opt$3564;var value$3565;var $3511$3556;var $3512$3557;var $3513$3558;var $3514$3559;var $3515$3560;var $3516$3561;var t0$3551;var t1$3552;var t2$3553;var t3$3554;var m$3546;(m$3546=temp$3525[$index$3537]);(t0$3551=m$3546);if((($3512$3557=(t0$3551 instanceof Array))&&(((t1$3552=t0$3551.length)),(($3514$3559=(t1$3552===3))&&(t0$3551[0]==="option"))))){(opt$3564=t0$3551[1]);(value$3565=t0$3551[2]);acc$3519.push((newscope$3482.setopt(opt$3564,value$3565),["ignore"]));}else{if(($3514$3559&&((t0$3551[0]==="declare_raw")&&(((t2$3553=t0$3551[1])),((variable$3581=t2$3553),((t2$3553 instanceof Array)&&(((t3$3554=t2$3553.length)),((t3$3554===2)&&(t2$3553[0]==="symbol"))))))))){(s$3582=t2$3553[1]);(value$3583=t0$3551[2]);acc$3519.push(((((t0$3603=variable$3581)),(function(){if($5013(t0$3603,"env")){(env$3601=t0$3603.env);}else{return $4735(variable$3581,"/home/olivier/git/earl-grey/src/expand.eg",10176,10184);}})()),env$3601.bind(newscope$3482,s$3582,value$3583),((changes$3484=true)),["ignore"]));}else{if(($3512$3557&&(($3514$3559=((t1$3552>=2)&&(t1$3552<=3)))&&(($3515$3560=(t0$3551[0]==="declare"))&&(((t2$3553=t0$3551[1])),((variable$3616=t2$3553),((t2$3553 instanceof Array)&&(((t3$3554=t2$3553.length)),((t3$3554===2)&&(t2$3553[0]==="symbol")))))))))){(s$3617=t2$3553[1]);(value$3618=(function(){if((2>=t1$3552)){return null;}else{return t0$3551[2];}})());acc$3519.push(((((t0$3637=variable$3616)),(function(){if($5013(t0$3637,"env")){(env$3635=t0$3637.env);}else{return $4735(variable$3616,"/home/olivier/git/earl-grey/src/expand.eg",10424,10432);}})()),(function(){if((variable$3616.use_previous&&env$3635.resolve(newscope$3482,s$3617))){return ["splice"];}else{(v$3648=__lt____lt____colon__$1756(["variable",it$0$3179.gensym(s$3617)],variable$3616));$1654(v$3648,({"mutable":(expr$3197.all_mutable||variable$3616.mutable)}));env$3635.bind(newscope$3482,s$3617,v$3648);(changes$3484=true);if(value$3618){return ["splice",["newargs",["assign",v$3648,value$3618]],["vars",v$3648]];}else{return ["vars",v$3648];}}})()));}else{if(($3515$3560&&((v$3657=t2$3553),((t2$3553 instanceof Array)&&(((t3$3554=t2$3553.length)),((t3$3554===2)&&(t2$3553[0]==="variable"))))))){t2$3553[1];(value$3658=(function(){if((2>=t1$3552)){return null;}else{return t0$3551[2];}})());acc$3519.push((((changes$3484=true)),(function(){if(value$3658){return ["splice",["newargs",["assign",v$3657,value$3658]],["vars",v$3657]];}else{return ["vars",v$3657];}})()));}else{if(($3512$3557&&((t1$3552===2)&&((t0$3551[0]==="undeclare")&&(((t2$3553=t0$3551[1])),((t2$3553 instanceof Array)&&(((t3$3554=t2$3553.length)),((t3$3554===2)&&(t2$3553[0]==="symbol"))))))))){(s$3675=t2$3553[1]);(variable$3676=t2$3553);acc$3519.push(((((t0$3695=variable$3676)),(function(){if($5013(t0$3695,"env")){(env$3693=t0$3695.env);}else{return $4735(variable$3676,"/home/olivier/git/earl-grey/src/expand.eg",11696,11704);}})()),env$3693.bind(newscope$3482,s$3675,(void 0)),((changes$3484=true)),["ignore"]));}else{(other$3708=m$3546);acc$3519.push(["newargs",other$3708]);}}}}}}})()))),acc$3519)));if(($5013(t0$3498,"newargs")&&((newargs$3485=t0$3498.newargs),$5013(t0$3498,"vars")))){(vars$3486=t0$3498.vars);}else{$4735(classify$1758("newargs","vars",(((acc$3731=[])),(((temp$3737=it$0$3179.step_all(["expr","multi"],stepscope$3483,args$3473))),((($length$3743=temp$3737.length)),((($index$3749=0)),(function(){$3715:for(;($index$3749<$length$3743);($index$3749++)){var t0$3815;var env$3813;var t0$3849;var v$3860;var env$3847;var t0$3907;var env$3905;var other$3920;var s$3887;var variable$3888;var v$3869;var value$3870;var variable$3828;var s$3829;var value$3830;var variable$3793;var s$3794;var value$3795;var opt$3776;var value$3777;var $3723$3768;var $3724$3769;var $3725$3770;var $3726$3771;var $3727$3772;var $3728$3773;var t0$3763;var t1$3764;var t2$3765;var t3$3766;var m$3758;(m$3758=temp$3737[$index$3749]);(t0$3763=m$3758);if((($3724$3769=(t0$3763 instanceof Array))&&(((t1$3764=t0$3763.length)),(($3726$3771=(t1$3764===3))&&(t0$3763[0]==="option"))))){(opt$3776=t0$3763[1]);(value$3777=t0$3763[2]);acc$3731.push((newscope$3482.setopt(opt$3776,value$3777),["ignore"]));}else{if(($3726$3771&&((t0$3763[0]==="declare_raw")&&(((t2$3765=t0$3763[1])),((variable$3793=t2$3765),((t2$3765 instanceof Array)&&(((t3$3766=t2$3765.length)),((t3$3766===2)&&(t2$3765[0]==="symbol"))))))))){(s$3794=t2$3765[1]);(value$3795=t0$3763[2]);acc$3731.push(((((t0$3815=variable$3793)),(function(){if($5013(t0$3815,"env")){(env$3813=t0$3815.env);}else{return $4735(variable$3793,"/home/olivier/git/earl-grey/src/expand.eg",10176,10184);}})()),env$3813.bind(newscope$3482,s$3794,value$3795),((changes$3484=true)),["ignore"]));}else{if(($3724$3769&&(($3726$3771=((t1$3764>=2)&&(t1$3764<=3)))&&(($3727$3772=(t0$3763[0]==="declare"))&&(((t2$3765=t0$3763[1])),((variable$3828=t2$3765),((t2$3765 instanceof Array)&&(((t3$3766=t2$3765.length)),((t3$3766===2)&&(t2$3765[0]==="symbol")))))))))){(s$3829=t2$3765[1]);(value$3830=(function(){if((2>=t1$3764)){return null;}else{return t0$3763[2];}})());acc$3731.push(((((t0$3849=variable$3828)),(function(){if($5013(t0$3849,"env")){(env$3847=t0$3849.env);}else{return $4735(variable$3828,"/home/olivier/git/earl-grey/src/expand.eg",10424,10432);}})()),(function(){if((variable$3828.use_previous&&env$3847.resolve(newscope$3482,s$3829))){return ["splice"];}else{(v$3860=__lt____lt____colon__$1756(["variable",it$0$3179.gensym(s$3829)],variable$3828));$1654(v$3860,({"mutable":(expr$3197.all_mutable||variable$3828.mutable)}));env$3847.bind(newscope$3482,s$3829,v$3860);(changes$3484=true);if(value$3830){return ["splice",["newargs",["assign",v$3860,value$3830]],["vars",v$3860]];}else{return ["vars",v$3860];}}})()));}else{if(($3727$3772&&((v$3869=t2$3765),((t2$3765 instanceof Array)&&(((t3$3766=t2$3765.length)),((t3$3766===2)&&(t2$3765[0]==="variable"))))))){t2$3765[1];(value$3870=(function(){if((2>=t1$3764)){return null;}else{return t0$3763[2];}})());acc$3731.push((((changes$3484=true)),(function(){if(value$3870){return ["splice",["newargs",["assign",v$3869,value$3870]],["vars",v$3869]];}else{return ["vars",v$3869];}})()));}else{if(($3724$3769&&((t1$3764===2)&&((t0$3763[0]==="undeclare")&&(((t2$3765=t0$3763[1])),((t2$3765 instanceof Array)&&(((t3$3766=t2$3765.length)),((t3$3766===2)&&(t2$3765[0]==="symbol"))))))))){(s$3887=t2$3765[1]);(variable$3888=t2$3765);acc$3731.push(((((t0$3907=variable$3888)),(function(){if($5013(t0$3907,"env")){(env$3905=t0$3907.env);}else{return $4735(variable$3888,"/home/olivier/git/earl-grey/src/expand.eg",11696,11704);}})()),env$3905.bind(newscope$3482,s$3887,(void 0)),((changes$3484=true)),["ignore"]));}else{(other$3920=m$3758);acc$3731.push(["newargs",other$3920]);}}}}}}})()))),acc$3731)),"/home/olivier/git/earl-grey/src/expand.eg",9848,11926);}(exp$3487=(function(s$3927){var $index$3960;var $length$3954;var temp$3948;var acc$3942;var $index$4016;var $length$4010;var temp$4004;var acc$3998;var stepped$3931;(stepped$3931=(((acc$3942=[])),(((temp$3948=$4987(newargs$3485))),((($length$3954=temp$3948.length)),((($index$3960=0)),(function(){$3937:for(;($index$3960<$length$3954);($index$3960++)){var i$3979;var arg$3980;var t0$3974;var t1$3975;var m$3969;(m$3969=temp$3948[$index$3960]);(t0$3974=m$3969);if(((t0$3974 instanceof Array)&&(((t1$3975=t0$3974.length)),(t1$3975===2)))){(i$3979=t0$3974[0]);(arg$3980=t0$3974[1]);acc$3942.push(it$0$3179.step(["expr",(function(){if((i$3979===(newargs$3485.length-1))){return "expr";}else{return "ignore";}})()],s$3927,arg$3980));}else{$4735(m$3969,"/home/olivier/git/earl-grey/src/expand.eg",12148,12325);}}})()))),acc$3942));(acc$3998=[]);(temp$4004=stepped$3931);($length$4010=temp$4004.length);($index$4016=0);$3932:for(;($index$4016<$length$4010);($index$4016++)){var arg$4033;var m$4025;(m$4025=temp$4004[$index$4016]);(arg$4033=m$4025);acc$3998.push(helper$3190(["expr","expr"],s$3927,arg$4033));}return acc$3998;}));if(changes$3484){return ["scope",vars$3486,["multi"].concat(exp$3487(newscope$3482))];}else{return ["multi"].concat(exp$3487(scope$3196));}}else{if(($3225$3242&&($3201$3231[0]==="data"))){(args$4039=Array.prototype.slice.call($3201$3231,1));(is_obj$4051=false);(obj$4052=["object"]);(arr$4053=["array"]);(arr_parts$4054=[]);(obj_parts$4055=[]);(new_arr_part$4056=(function(){var other$4113;var t0$4100;var $4090$4095;($4090$4095=arr$4053);if((($4090$4095 instanceof Array)&&(((t0$4100=$4090$4095.length)),((t0$4100===1)&&($4090$4095[0]==="array"))))){return false;}else{(other$4113=$4090$4095);arr_parts$4054.push(arr$4053);(arr$4053=["array"]);}}));(new_obj_part$4057=(function(){var other$4149;var t0$4136;var $4126$4131;($4126$4131=obj$4052);if((($4126$4131 instanceof Array)&&(((t0$4136=$4126$4131.length)),((t0$4136===1)&&($4126$4131[0]==="object"))))){return false;}else{(other$4149=$4126$4131);obj_parts$4055.push(obj$4052);(obj$4052=["object"]);}}));(temp$4160=it$0$3179.step_all(["expr","data"],scope$3196,args$4039));($length$4166=temp$4160.length);($index$4172=0);$4059:for(;($index$4172<$length$4166);($index$4172++)){var other$4239;var expr$4229;var expr$4223;var k$4212;var v$4213;var $4066$4189;var $4067$4190;var $4068$4191;var $4069$4192;var t0$4186;var t1$4187;var m$4181;(m$4181=temp$4160[$index$4172]);(t0$4186=m$4181);if((($4067$4190=(t0$4186 instanceof Array))&&(((t1$4187=t0$4186.length)),((t1$4187===1)&&(t0$4186[0]==="assoc"))))){(is_obj$4051=true);}else{if(($4067$4190&&((t1$4187===3)&&(t0$4186[0]==="assoc")))){(k$4212=t0$4186[1]);(v$4213=t0$4186[2]);(is_obj$4051=true);obj$4052.push(["array",k$4212,v$4213]);}else{if(($4067$4190&&(($4069$4192=(t1$4187===2))&&(t0$4186[0]==="dynsplice")))){(expr$4223=t0$4186[1]);new_arr_part$4056();arr_parts$4054.push(expr$4223);}else{if(($4069$4192&&(t0$4186[0]==="objsplice"))){(expr$4229=t0$4186[1]);(is_obj$4051=true);new_obj_part$4057();obj_parts$4055.push(expr$4229);}else{(other$4239=m$4181);arr$4053.push(other$4239);}}}}}new_arr_part$4056();new_obj_part$4057();(r$4058=((($4243$4249=arr_parts$4054)),(function(){if((($4243$4249 instanceof Array)&&(((t0$4254=$4243$4249.length)),((t0$4254===0)&&is_obj$4051)))){return util$1757.construct(obj_parts$4055,(function(x$4267,rest$4268){return ["send",["symbol","&:"],["data",x$4267,rest$4268]];}),["object"]);}else{$4243$4249;if(is_obj$4051){throw $4754(["syntax","array","object"]).create("Cannot mix array and object notations.");}else{(other$4276=$4243$4249);return util$1757.construct(arr_parts$4054.reverse(),(function(x$4280,rest$4281){return ["send",["send",rest$4281,["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",x$4280]];}),["array"]);}}})()));return helper$3190(context$3195,scope$3196,it$0$3179.mkenv().mark(r$4058));}else{if(($3223$3240&&(($3225$3242=(t0$3236===3))&&($3201$3231[0]==="assign")))){(target$4286=$3201$3231[1]);(value$4287=$3201$3231[2]);(t$4296=helper$3190(["expr","expr"],scope$3196,target$4286));($4292$4302=t$4296);if(((((x$4314=$4292$4302)),((x$4314 instanceof Array)&&(x$4314[0]==="variable")))&&(((!t$4296.mutable)&&t$4296.assigned)&&(t$4296.assigned.group_id!==target$4286.group_id)))){(msg$4321=["Variable was declared as read-only. Declare it as","mutable at the origin with `var` (if you have access","to the declaration) or declare a new variable with","`let` or `var` or remove the original binding with","`delete`"].join(" "));throw $4754(["syntax"]).create(msg$4321,({"variable":target$4286,"loc":t$4296.assigned}));}else{if((($4292$4302 instanceof Array)&&(((t0$4307=$4292$4302.length)),((t0$4307===2)&&($4292$4302[0]==="macro"))))){(m$4327=$4292$4302[1]);["bounce",m$4327(["assign"],scope$3196,expr$3197,value$4287)];}else{(otherwise$4337=$4292$4302);(t$4296["assigned"]=target$4286);}}return ["assign",t$4296,helper$3190(["expr","expr"],scope$3196,value$4287)];}else{if(($3225$3242&&($3201$3231[0]==="lambda"))){(bindings$4345=$3201$3231[1]);(body$4346=$3201$3231[2]);(newscope$4351=Scope$1765(scope$3196));return ["lambda",(((acc$4363=[])),(((temp$4369=bindings$4345)),((($length$4375=temp$4369.length)),((($index$4381=0)),(function(){$4355:for(;($index$4381<$length$4375);($index$4381++)){var v$4418;var x$4429;var other$4437;var v$4425;var b$4401;var env$4402;var $4360$4398;var t0$4395;var t1$4396;var m$4390;(m$4390=temp$4369[$index$4381]);(t0$4395=m$4390);if(((t0$4395 instanceof Array)&&(((t1$4396=t0$4395.length)),((t1$4396===2)&&((t0$4395[0]==="symbol")&&((b$4401=t0$4395[1]),$5013(t0$4395,"env"))))))){(env$4402=t0$4395.env);acc$4363.push((((v$4418=["variable",it$0$3179.gensym(b$4401)])),(env$4402.bind(newscope$4351,b$4401,v$4418),v$4418)));}else{if((((x$4429=t0$4395)),((x$4429 instanceof Array)&&(x$4429[0]==="variable")))){(v$4425=t0$4395);acc$4363.push(v$4425);}else{(other$4437=m$4390);acc$4363.push(function(){throw $4754(["syntax","lambda","binding"]).create("Not a valid binding.",({"node":other$4437}));}());}}}})()))),acc$4363),helper$3190(["expr","expr"],newscope$4351,body$4346)];}else{if(($3225$3242&&($3201$3231[0]==="use"))){($3217$4443=$3201$3231[1]);(x$4442=$3201$3231[2]);(t0$4447=$3217$4443);if((typeof(t0$4447)==="string")){(name$4451=t0$4447);(s$4460=scope$3196);$4464:while(s$4460){if((s$4460.name.slice(0,(name$4451.length+1))===(name$4451+"/"))){break $4464;}else{(s$4460=s$4460.parent);}}if(s$4460){return helper$3190(context$3195,s$4460,x$4442);}else{throw $4754(["syntax","noscope"]).create(("Could not find a scope tagged: "+name$4451));}}else{(newscope$4473=$3217$4443);return helper$3190(context$3195,newscope$4473,x$4442);}}else{if(($3225$3242&&(($3201$3231[0]==="tagscope")&&(((t1$3237=$3201$3231[1])),(typeof(t1$3237)==="string"))))){(tag$4477=t1$3237);(body$4478=$3201$3231[2]);return helper$3190(context$3195,Scope$1765(scope$3196,it$0$3179.gensym((tag$4477+"/"))),body$4478);}else{if(($3223$3240&&((t0$3236>=1)&&((type$4488=$3201$3231[0]),((args$4489=Array.prototype.slice.call($3201$3231,1)),(it$0$3179.generic_nodes.indexOf(type$4488)!==-1)))))){return [type$4488].concat((((acc$4499=[])),(((temp$4505=args$4489)),((($length$4511=temp$4505.length)),((($index$4517=0)),(function(){$4494:for(;($index$4517<$length$4511);($index$4517++)){var arg$4534;var m$4526;(m$4526=temp$4505[$index$4517]);(arg$4534=m$4526);acc$4499.push(helper$3190(["expr","expr"],scope$3196,arg$4534));}})()))),acc$4499));}else{(other$4539=$3201$3231);throw $4754(["syntax","illegal_node"]).create("An illegal node was found.",({"node":other$4539,"context":context$3195}));}}}}}}}}}}}}}}}}}})));return helper$3190(context$3173,scope$3174,expr$3175);}));$1654(Expander$1768,$1654(((accum$4545=({})),((accum$4545["::name"]="Expander"),accum$4545)),((accum$4549=({})),((accum$4549["::egclass"]=true),accum$4549))));Expander$1768;(mac1$1769=(function(f$4556){return ["macro",(function(context$4562,scope$4563,form$4564,$4559$4565){var t0$4569;var t1$4570;var expr$4567;(t0$4569=$4559$4565);if(((t0$4569 instanceof Array)&&(((t1$4570=t0$4569.length)),((t1$4570===2)&&(t0$4569[0]==="data"))))){(expr$4567=t0$4569[1]);}else{$4735($4559$4565);}return f$4556(expr$4567);})];}));(__chk_ncache$1770=({}));(__chk_scache$1771=({}));(checker_db$1772=(function($4593$4596){var v$4641;var v$4660;var s$4654;var n$4635;var $4598$4611;var ph$4605;(ph$4605=$4593$4596);($4598$4611=ph$4605);if(($4598$4611===null)){return checker_db$1772.null;}else{if(($4598$4611===(void 0))){return checker_db$1772.undefined;}else{if(($4598$4611===true)){return checker_db$1772.true;}else{if(($4598$4611===false)){return checker_db$1772.false;}else{if((typeof($4598$4611)==="number")){(n$4635=$4598$4611);if($1653(__chk_ncache$1770,n$4635)){return $1653(__chk_ncache$1770,n$4635);}else{(v$4641=mac1$1769((function(x$4646){return ["send",["symbol","==="],["data",x$4646,["value",n$4635]]];})));(__chk_ncache$1770[n$4635]=v$4641);return v$4641;}}else{if((typeof($4598$4611)==="string")){(s$4654=$4598$4611);if(Object.prototype.hasOwnProperty.call(__chk_scache$1771,s$4654)){return $1653(__chk_scache$1771,s$4654);}else{(v$4660=mac1$1769((function(x$4665){return ["send",["symbol","==="],["data",x$4665,["value",s$4654]]];})));(__chk_scache$1771[s$4654]=v$4660);return v$4660;}}else{$4735($4598$4611);}}}}}}}));$1654(checker_db$1772,({"String":mac1$1769((function(x$4676){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$4676]],["value","string"]]];})),"Number":mac1$1769((function(x$4680){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$4680]],["value","number"]]];})),"Array":mac1$1769((function(x$4684){return ["send",["symbol","instanceof"],["data",x$4684,["symbol","Array"]]];})),"true":mac1$1769((function(x$4688){return x$4688;})),"false":mac1$1769((function(x$4692){return ["send",["symbol","not"],["data",["void"],x$4692]];})),"null":mac1$1769((function(x$4696){return ["send",["symbol","==="],["data",x$4696,["value",null]]];})),"undefined":mac1$1769((function(x$4700){return ["send",["symbol","==="],["data",x$4700,["value",(void 0)]]];}))}));(exports["Env"]=Env$1766);(exports["Scope"]=Scope$1765);(exports["track_location"]=track_location$1767);(exports["Expander"]=Expander$1768);(exports["GenSym"]=GenSym$1760);(exports["gensym"]=gensym$1761);(exports["mac1"]=mac1$1769);(exports["checker_db"]=checker_db$1772);
