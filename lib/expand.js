var $1167=function(type$1169){var f$1172;(f$1172=type$1169["::check"]);if((f$1172===(void 0))){return function(value$1177){return (value$1177 instanceof type$1169);};}else{return function(value$1180){return f$1172.call(type$1169,value$1180);};}};
var $1182=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $1183=function(dest$1185,values$1186){var k$1191;(k$1191=null);$1189:for(k$1191 in values$1186){if(values$1186.hasOwnProperty(k$1191)){(dest$1185[k$1191]=values$1186[k$1191]);}}return dest$1185;};
var $1198=function($1199$1201){var ph$1205;(ph$1205=$1199$1201);var $1203$1210;($1203$1210=ph$1205);var bridge$1204$1215;var x$1219;(bridge$1204$1215=$1203$1210);if((((typeof(bridge$1204$1215)==="string")&&((x$1219=bridge$1204$1215),true))||((typeof(bridge$1204$1215)==="number")&&((x$1219=bridge$1204$1215),true)))){return ["value",x$1219];}else{var other$1229;(other$1229=$1203$1210);return other$1229["::serialize_ast"]();}};
var send$974;(send$974=function(obj$979,$977$980){var ph$984;var msg$985;var t0$987;(t0$987=$977$980);(msg$985=t0$987);(ph$984=t0$987);var $982$994;($982$994=ph$984);var bridge$983$999;(bridge$983$999=$982$994);if(((typeof(bridge$983$999)==="string")||(typeof(bridge$983$999)==="number"))){return obj$979[msg$985];}else{var other$1010;(other$1010=$982$994);return obj$979["::send"](msg$985);}});(Array[":::project"]=function($1015$1017){var ph$1020;var value$1021;var t0$1023;(t0$1023=$1015$1017);(value$1021=t0$1023);(ph$1020=t0$1023);var $1019$1030;($1019$1030=ph$1020);if($1167(Array)($1019$1030)){return [true,value$1021];}else{$1019$1030;return [true,[value$1021]];}});(Array.prototype["::check"]=function(value$1047){if((value$1047 instanceof Array)){var i$1052;(i$1052=0);$1050:for(;(i$1052<this.length);(i$1052++)){if(($1182(this,i$1052)!==$1182(value$1047,i$1052))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $1183(this.slice(0),this);});(Array.prototype[":::project"]=function(value$1069){if((value$1069 instanceof Array)){var i$1074;(i$1074=0);$1072:for(;(i$1074<this.length);(i$1074++)){if(($1182(this,i$1074)!==$1182(value$1069,i$1074))){return [true,[value$1069]];}}return [true,value$1069.slice(this.length)];}else{return [true,[value$1069]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($1198));});(RegExp.prototype["::check"]=function($1090$1092){var ph$1095;(ph$1095=$1090$1092);var $1094$1100;($1094$1100=ph$1095);var value$1108;if((typeof($1094$1100)==="string")){(value$1108=$1094$1100);if(value$1108.match(this)){return true;}else{return false;}}else{var other$1113;(other$1113=$1094$1100);return false;}});(RegExp.prototype[":::project"]=function($1118$1120){var ph$1123;(ph$1123=$1118$1120);var $1122$1128;($1122$1128=ph$1123);var value$1136;if((typeof($1122$1128)==="string")){(value$1136=$1122$1128);var $1139$1141;($1139$1141=value$1136.match(this));var m$1149;if(($1139$1141===null)){(m$1149=$1139$1141);return [false,null];}else{var m$1154;(m$1154=$1139$1141);return [true,m$1154];}}else{var other$1158;(other$1158=$1122$1128);return [false,null];}});(Function.prototype["::send"]=function(args$1164){return this.apply(this,args$1164);});
var $3823=function(arr$3825){var results$3829;var l$3830;(results$3829=[]);(l$3830=arr$3825.length);var i$3838;(i$3838=0);$3828:for(;(i$3838<l$3830);(i$3838++)){results$3829.push([i$3838,$1182(arr$3825,i$3838)]);}return results$3829;};
var $3627=function(){var $3628$3630;($3628$3630=function(tags$3634){var it$0$3637;(it$0$3637=function(){if((!$1167($3628$3630)(this))){return Object.create($3628$3630.prototype);}else{return this;}}());(it$0$3637["tags"]=tags$3634);return it$0$3637;});($3628$3630.prototype["create"]=function(){var $3649$3651;($3649$3651=arguments);var t0$3656;var message$3660;var args$3661;(t0$3656=$3649$3651.length);if((t0$3656>=0)){(message$3660=function(){if((0>=t0$3656)){return "";}else{return $3649$3651[0];}}());(args$3661=Array.prototype.slice.call($3649$3651,1));var it$0$3668;(it$0$3668=this);var self$3673;(self$3673=this);var e$3678;(e$3678=Error(message$3660));(e$3678["::tags"]=it$0$3668.tags);(e$3678["args"]=args$3661);var temp$3692;(temp$3692=$3823(args$3661));var $length$3697;($length$3697=temp$3692.length);var $index$3702;($index$3702=0);$3679:for(;($index$3702<$length$3697);($index$3702++)){var m$3710;(m$3710=temp$3692[$index$3702]);var t0$3715;var t1$3716;var i$3720;var arg$3721;(t0$3715=m$3710);if(((t0$3715 instanceof Array)&&(((t1$3716=t0$3715.length)),(t1$3716===2)))){(i$3720=t0$3715[0]);(arg$3721=t0$3715[1]);(e$3678[i$3720]=arg$3721);}else{$3611(m$3710);}}(e$3678["length"]=args$3661.length);(e$3678["name"]=["E"].concat(it$0$3668.tags).join("."));return e$3678;}else{$3611($3649$3651);}});($3628$3630.prototype["::check"]=function(e$3747){var it$0$3750;(it$0$3750=this);var self$3755;(self$3755=this);var tags$3760;if(((!e$3747)||(!$1167(Error)(e$3747)))){return false;}(tags$3760=(e$3747["::tags"]||[]));var temp$3769;(temp$3769=it$0$3750.tags);var $length$3774;($length$3774=temp$3769.length);var $index$3779;($index$3779=0);$3761:for(;($index$3779<$length$3774);($index$3779++)){var m$3787;(m$3787=temp$3769[$index$3779]);var tag$3795;(tag$3795=m$3787);if((tags$3760.indexOf(tag$3795)===-1)){return false;}else{false;}}return true;});($3628$3630.prototype["::deconstruct"]=function(e$3803){var it$0$3806;(it$0$3806=this);var self$3811;(self$3811=this);return e$3803.args;});$1183($3628$3630,$1183(function(){var accum$3816;(accum$3816=({}));(accum$3816["::name"]="$3628");return accum$3816;}(),function(){var accum$3820;(accum$3820=({}));(accum$3820["::egclass"]=true);return accum$3820;}()));return $3628$3630;}();
var $3611=function(value$3613,url$3614,start$3615,end$3616){var err$3619;(err$3619=$3627(["match"]).create("Could not find a match for value",({"value":value$3613})));if(url$3614){(err$3619["location"]=["location",url$3614,start$3615,end$3616]);}throw err$3619;};
var $3845=function($3846$3848,key$3849){var ph$3853;(ph$3853=$3846$3848);var $3851$3858;($3851$3858=ph$3853);var bridge$3852$3863;(bridge$3852$3863=$3851$3858);if(((bridge$3852$3863===null)||(bridge$3852$3863===(void 0)))){return false;}else{var x$3874;if((typeof($3851$3858)==="string")){(x$3874=$3851$3858);return (key$3849 in String.prototype);}else{var x$3879;if((typeof($3851$3858)==="number")){(x$3879=$3851$3858);return (key$3849 in Number.prototype);}else{var x$3884;(x$3884=$3851$3858);return (key$3849 in x$3884);}}}};
var $3886=function(obj$3888){var results$3892;(results$3892=[]);var k$3897;(k$3897=null);$3891:for(k$3897 in obj$3888){if(Object.prototype.hasOwnProperty.call(obj$3888,k$3897)){results$3892.push([k$3897,$1182(obj$3888,k$3897)]);}}return results$3892;};
var $3901=function(type$3903){return function(value$3906){var f$3909;(f$3909=type$3903[":::project"]);if((f$3909===(void 0))){(f$3909=type$3903["::project"]);if((f$3909===(void 0))){return [true,type$3903(value$3906)];}else{var rval$3918;(rval$3918=false);try{(rval$3918=[true,f$3909(value$3906)]);}catch(excv$3927){var e$3933;(e$3933=excv$3927);(rval$3918=[false,null]);}return rval$3918;}}else{return f$3909.call(type$3903,value$3906);}};};var accum$1474;var accum$1478;var accum$1810;var accum$1814;var accum$3456;var accum$3460;var $1233$1237;var __lt____gt__$1238;var $1234$1239;var __lt____lt____colon__$1240;var util$1241;var classify$1242;var neighbours$1243;var GenSym$1244;var gensym$1245;var uuid$1246;var $1236$1247;var PatternParser$1248;var PatternProcessor$1249;var Scope$1250;var Env$1251;var track_location$1252;var Expander$1253;var mac1$1254;var __chk_ncache$1255;var __chk_scache$1256;var checker_db$1257;($1233$1237=require("./pp"));(__lt____gt__$1238=$1233$1237["<>"]);($1234$1239=require("./location"));(__lt____lt____colon__$1240=$1234$1239["<<:"]);(util$1241=require("./util"));(classify$1242=util$1241.classify);(neighbours$1243=util$1241.neighbours);(GenSym$1244=util$1241.GenSym);(gensym$1245=util$1241.gensym);(uuid$1246=util$1241.uuid);($1236$1247=require("./pattern"));(PatternParser$1248=$1236$1247.PatternParser);(PatternProcessor$1249=$1236$1247.PatternProcessor);(Scope$1250=function(){var it$0$1320;var parent$1311;var name$1312;var expander$1313;var t0$1307;var $1300$1302;($1300$1302=arguments);(t0$1307=$1300$1302.length);if(((t0$1307>=0)&&(t0$1307<=3))){(parent$1311=function(){if((0>=t0$1307)){return null;}else{return $1300$1302[0];}}());(name$1312=function(){if((1>=t0$1307)){return null;}else{return $1300$1302[1];}}());(expander$1313=function(){if((2>=t0$1307)){return null;}else{return $1300$1302[2];}}());(it$0$1320=function(){if((!$1167(Scope$1250)(this))){return Object.create(Scope$1250.prototype);}else{return this;}}());(it$0$1320["name"]=(name$1312||gensym$1245("scope")));(it$0$1320["parent"]=parent$1311);(it$0$1320["options"]=({}));(it$0$1320["expander"]=(expander$1313||parent$1311.expander));return it$0$1320;}else{$3611($1300$1302);}});(Scope$1250.prototype["getopt"]=function(opt$1344){var otherwise$1376;var $1353$1365;var $1352$1359;var self$1354;var it$0$1347;(it$0$1347=this);(self$1354=this);($1352$1359=null);$1352$1359;if(Object.prototype.hasOwnProperty.call(it$0$1347.options,opt$1344)){return $1182(it$0$1347.options,opt$1344);}else{if((it$0$1347.parent===null)){return (void 0);}else{(otherwise$1376=$1352$1359);return it$0$1347.parent.getopt(opt$1344);}}});(Scope$1250.prototype["setopt"]=function(opt$1381,value$1382){var self$1390;var it$0$1385;(it$0$1385=this);(self$1390=this);(it$0$1385.options[opt$1381]=value$1382);});(Scope$1250.prototype["gensym"]=function(){var self$1407;var it$0$1402;(it$0$1402=this);(self$1407=this);return it$0$1402.expander.gensym();});(Scope$1250.prototype["step"]=function(context$1414,expr$1415){var self$1423;var it$0$1418;(it$0$1418=this);(self$1423=this);return it$0$1418.expander.step(context$1414,it$0$1418,expr$1415);});(Scope$1250.prototype["step_all"]=function(context$1430,exprs$1431){var self$1439;var it$0$1434;(it$0$1434=this);(self$1439=this);return it$0$1434.expander.step_all(context$1430,it$0$1434,exprs$1431);});(Scope$1250.prototype["expand"]=function(context$1446,expr$1447){var self$1455;var it$0$1450;(it$0$1450=this);(self$1455=this);return it$0$1450.expander.expand(context$1446,it$0$1450,expr$1447);});(Scope$1250.prototype["toString"]=function(){var self$1469;var it$0$1464;(it$0$1464=this);(self$1469=this);return (("Scope{"+it$0$1464.name)+"}");});$1183(Scope$1250,$1183(((accum$1474=({})),((accum$1474["::name"]="Scope"),accum$1474)),((accum$1478=({})),((accum$1478["::egclass"]=true),accum$1478))));Scope$1250;(Env$1251=function(){var it$0$1486;(it$0$1486=function(){if((!$1167(Env$1251)(this))){return Object.create(Env$1251.prototype);}else{return this;}}());(it$0$1486["scopes"]=({}));return it$0$1486;});(Env$1251.prototype["resolve"]=function(scope$1498,name$1499){var scope_data$1512;var self$1507;var it$0$1502;(it$0$1502=this);(self$1507=this);if((scope$1498===null)){return (void 0);}(scope_data$1512=$1182(it$0$1502.scopes,scope$1498.name));if((scope_data$1512&&Object.prototype.hasOwnProperty.call(scope_data$1512,name$1499))){return $1182(scope_data$1512,name$1499);}else{return it$0$1502.resolve(scope$1498.parent,name$1499);}});(Env$1251.prototype["bind"]=function(scope$1520,name$1521,value$1522){var self$1530;var it$0$1525;(it$0$1525=this);(self$1530=this);if((!$1182(it$0$1525.scopes,scope$1520.name))){(it$0$1525.scopes[scope$1520.name]=({}));}($1182(it$0$1525.scopes,scope$1520.name)[name$1521]=value$1522);});(Env$1251.prototype["convert"]=function(expr$1545){var x$1601;var x$1606;var bridge$1557$1595;var x$1611;var bridge$1556$1589;var x$1616;var bridge$1555$1583;var x$1621;var $index$1651;var $length$1646;var temp$1641;var other$1671;var type$1628;var args$1629;var e$1573;var bridge$1554$1568;var t0$1569;var $1553$1563;var self$1558;var it$0$1548;(it$0$1548=this);(self$1558=this);($1553$1563=expr$1545);if($3845($1553$1563,"env")){(e$1573=$1553$1563.env);return expr$1545;}else{(bridge$1554$1568=$1553$1563);if(((((bridge$1555$1583=bridge$1554$1568)),((((bridge$1556$1589=bridge$1555$1583)),((((bridge$1557$1595=bridge$1556$1589)),((((x$1601=bridge$1557$1595)),((x$1601 instanceof Array)&&(x$1601[0]==="symbol")))||(((x$1606=bridge$1557$1595)),((x$1606 instanceof Array)&&(x$1606[0]==="value")))))||(((x$1611=bridge$1556$1589)),((x$1611 instanceof Array)&&(x$1611[0]==="variable")))))||(((x$1616=bridge$1555$1583)),((x$1616 instanceof Array)&&(x$1616[0]==="macro")))))||(((x$1621=bridge$1554$1568)),((x$1621 instanceof Array)&&(x$1621[0]==="void"))))){return $1183(expr$1545,({"env":it$0$1548}));}else{if((($1553$1563 instanceof Array)&&(((t0$1569=$1553$1563.length)),(t0$1569>=1)))){(type$1628=$1553$1563[0]);(args$1629=Array.prototype.slice.call($1553$1563,1));(temp$1641=args$1629);($length$1646=temp$1641.length);($index$1651=0);$1637:for(;($index$1651<$length$1646);($index$1651++)){var arg$1667;var m$1659;(m$1659=temp$1641[$index$1651]);(arg$1667=m$1659);it$0$1548.convert(arg$1667);}return $1183(expr$1545,({"env":it$0$1548}));}else{(other$1671=$1553$1563);return $1183(expr$1545,({"env":it$0$1548}));}}}});(Env$1251.prototype["fork"]=function(){var $index$1706;var $length$1701;var temp$1696;var e$1688;var self$1683;var it$0$1678;(it$0$1678=this);(self$1683=this);(e$1688=Env$1251());(temp$1696=$3886(it$0$1678.scopes));($length$1701=temp$1696.length);($index$1706=0);$1689:for(;($index$1706<$length$1701);($index$1706++)){var $index$1753;var $length$1748;var temp$1743;var acc$1738;var scope$1724;var bindings$1725;var t0$1719;var t1$1720;var m$1714;(m$1714=temp$1696[$index$1706]);(t0$1719=m$1714);if(((t0$1719 instanceof Array)&&(((t1$1720=t0$1719.length)),(t1$1720===2)))){(scope$1724=t0$1719[0]);(bindings$1725=t0$1719[1]);(acc$1738=[]);(temp$1743=$3886(bindings$1725));($length$1748=temp$1743.length);($index$1753=0);$1735:for(;($index$1753<$length$1748);($index$1753++)){var k$1771;var v$1772;var t0$1766;var t1$1767;var m$1761;(m$1761=temp$1743[$index$1753]);(t0$1766=m$1761);if(((t0$1766 instanceof Array)&&(((t1$1767=t0$1766.length)),(t1$1767===2)))){(k$1771=t0$1766[0]);(v$1772=t0$1766[1]);acc$1738.push((function(){if((!$1182(e$1688.scopes,scope$1724))){(e$1688.scopes[scope$1724]=({}));}}(),(($1182(e$1688.scopes,scope$1724)[k$1771]=v$1772))));}else{$3611(m$1761,"/home/olivier/git/earl-grey/src/expand.eg",1955,2112);}}acc$1738;}else{$3611(m$1714,"/home/olivier/git/earl-grey/src/expand.eg",1915,2112);}}return e$1688;});(Env$1251.prototype["toString"]=function(){var self$1805;var it$0$1800;(it$0$1800=this);(self$1805=this);return "Env{...}";});$1183(Env$1251,$1183(((accum$1810=({})),((accum$1810["::name"]="Env"),accum$1810)),((accum$1814=({})),((accum$1814["::egclass"]=true),accum$1814))));Env$1251;(track_location$1252=function(f$1820){var f2$1823;(f2$1823=function(context$1827,scope$1828,expr$1829){var rval$1837;var other$1878;var v$1869;var t0$1865;var $1832$1860;var rval$1833;(rval$1833=(((rval$1837=false)),(function(){try{(rval$1837=f$1820(context$1827,scope$1828,expr$1829));}catch(excv$1846){var e$1852;(e$1852=excv$1846);(rval$1837=(__lt____lt____colon__$1240(e$1852,expr$1829),function(){throw e$1852;}()));}}(),rval$1837)));($1832$1860=rval$1833);if((($1832$1860 instanceof Array)&&(((t0$1865=$1832$1860.length)),((t0$1865===2)&&($1832$1860[0]==="bounce"))))){(v$1869=$1832$1860[1]);return f2$1823(context$1827,scope$1828,__lt____lt____colon__$1240(v$1869,expr$1829));}else{(other$1878=$1832$1860);return __lt____lt____colon__$1240(other$1878,expr$1829);}});return f2$1823;});(Expander$1253=function(env_factory$1885,generic_nodes$1886){var it$0$1889;(it$0$1889=function(){if((!$1167(Expander$1253)(this))){return Object.create(Expander$1253.prototype);}else{return this;}}());(it$0$1889["gensym"]=gensym$1245);(it$0$1889["mkenv"]=env_factory$1885);(it$0$1889["generic_nodes"]=generic_nodes$1886);return it$0$1889;});(Expander$1253.prototype["run_macro"]=function(m$1908,context$1909,scope$1910,form$1911,arg$1912){var rval$1929;var rval$1925;var self$1920;var it$0$1915;(it$0$1915=this);(self$1920=this);(rval$1925=(((rval$1929=false)),(function(){try{(rval$1929=m$1908(context$1909,scope$1910,form$1911,arg$1912));}catch(excv$1938){var msg$1985;var msg$2089;var find$1994;var err$1995;var other$1991;var $1972$1974;var e$1969;var e$2097;var value$1948;var t0$1941;var t1$1942;var t2$1943;var t3$1944;(t0$1941=excv$1938);if(($1167($3627(["match"]))(t0$1941)&&($3845(t0$1941,"args")&&(((t1$1942=t0$1941.args)),((t1$1942 instanceof Array)&&(((t2$1943=t1$1942.length)),((t2$1943===1)&&(((t3$1944=t1$1942[0])),$3845(t3$1944,"value"))))))))){(value$1948=t3$1944.value);(rval$1929=(((e$1969=((($1972$1974=value$1948)),function(){if(($1972$1974===context$1909)){(msg$1985="The macro cannot be found in this context.");return $3627(["syntax","context"]).create(msg$1985,({"context":context$1909,"form":form$1911}));}else{(other$1991=$1972$1974);(find$1994=function($1998$2000){var t0$2006;var msg$2025;var $index$2054;var $length$2049;var temp$2044;var other$2082;var type$2031;var xs$2032;var t0$2018;var $2002$2013;var ph$2003;var arg$2004;(t0$2006=$1998$2000);(arg$2004=t0$2006);(ph$2003=t0$2006);($2002$2013=ph$2003);if(($2002$2013===value$1948)){(msg$2025="The macro expected something different.");return $3627(["syntax","argument"]).create(msg$2025,({"context":context$1909,"argument":arg$2004,"form":form$1911}));}else{if((($2002$2013 instanceof Array)&&(((t0$2018=$2002$2013.length)),(t0$2018>=1)))){(type$2031=$2002$2013[0]);(xs$2032=Array.prototype.slice.call($2002$2013,1));(temp$2044=xs$2032);($length$2049=temp$2044.length);($index$2054=0);$2040:for(;($index$2054<$length$2049);($index$2054++)){var x$2071;var t0$2067;var m$2062;(m$2062=temp$2044[$index$2054]);(t0$2067=$3901(find$1994)(m$2062));if(t0$2067[0]){(x$2071=t0$2067[1]);if(x$2071){return x$2071;}}else{$3611(m$2062,"/home/olivier/git/earl-grey/src/expand.eg",3371,3456);}}return false;}else{(other$2082=$2002$2013);return false;}}});(err$1995=find$1994(arg$1912));if(err$1995){return err$1995;}else{(msg$2089="The macro expected something different (could not locate error in the source).");return $3627(["syntax","failure"]).create(msg$2089,({"form":form$1911,"value":value$1948}));}}}()))),function(){throw e$1969;}()));}else{(e$2097=excv$1938);(rval$1929=function(){throw e$2097;}());}}}(),rval$1929)));return it$0$1915.mkenv().convert(rval$1925);});(Expander$1253.prototype["step"]=function(context$2106,scope$2107,expr$2108){var helper$2121;var self$2116;var it$0$2111;(it$0$2111=this);(self$2116=this);(helper$2121=track_location$1252(function(context$2126,scope$2127,$2124$2128){var t0$2137;var other$2183;var env$2178;var $2168$2170;var other$2222;var t0$2210;var $2203$2205;var other$2226;var m$2196;var t0$2192;var $2164$2187;var env$2165;var other$2252;var t0$2240;var $2233$2235;var other$2280;var m$2271;var t0$2267;var $2260$2262;var other$2289;var x$2284;var f$2256;var arg$2257;var m$2230;var s$2156;var $2131$2151;var $2132$2152;var $2133$2153;var t0$2149;var $2130$2144;var ph$2134;var expr$2135;(t0$2137=$2124$2128);(expr$2135=t0$2137);(ph$2134=t0$2137);($2130$2144=ph$2134);if((($2131$2151=($2130$2144 instanceof Array))&&(((t0$2149=$2130$2144.length)),(($2133$2153=(t0$2149===2))&&($2130$2144[0]==="symbol"))))){(s$2156=$2130$2144[1]);(env$2165=((($2168$2170=expr$2135)),function(){if($3845($2168$2170,"env")){(env$2178=$2168$2170.env);return expr$2135.env;}else{(other$2183=$2168$2170);throw $3627(["syntax","no_env"]).create("No environment was found to resolve",({"symbol":expr$2135}));}}()));($2164$2187=env$2165.resolve(scope$2127,s$2156));if((($2164$2187 instanceof Array)&&(((t0$2192=$2164$2187.length)),((t0$2192===2)&&($2164$2187[0]==="macro"))))){(m$2196=$2164$2187[1]);($2203$2205=context$2126);if((($2203$2205 instanceof Array)&&(((t0$2210=$2203$2205.length)),((t0$2210===2)&&(($2203$2205[0]==="expr")&&($2203$2205[1]==="head")))))){return ["macro",m$2196];}else{(other$2222=$2203$2205);return ["bounce",it$0$2111.run_macro(m$2196,context$2126,scope$2127,expr$2135,__lt____lt____colon__$1240(["void"],expr$2135))];}}else{(other$2226=$2164$2187);return expr$2135;}}else{if(($2133$2153&&($2130$2144[0]==="macro"))){(m$2230=$2130$2144[1]);($2233$2235=context$2126);if((($2233$2235 instanceof Array)&&(((t0$2240=$2233$2235.length)),((t0$2240===2)&&(($2233$2235[0]==="expr")&&($2233$2235[1]==="head")))))){return expr$2135;}else{(other$2252=$2233$2235);return ["bounce",it$0$2111.run_macro(m$2230,context$2126,scope$2127,expr$2135,__lt____lt____colon__$1240(["void"],expr$2135))];}}else{if(($2131$2151&&((t0$2149===3)&&($2130$2144[0]==="send")))){(f$2256=$2130$2144[1]);(arg$2257=$2130$2144[2]);($2260$2262=helper$2121(["expr","head"],scope$2127,f$2256));if((($2260$2262 instanceof Array)&&(((t0$2267=$2260$2262.length)),((t0$2267===2)&&($2260$2262[0]==="macro"))))){(m$2271=$2260$2262[1]);return ["bounce",it$0$2111.run_macro(m$2271,context$2126,scope$2127,expr$2135,arg$2257)];}else{(other$2280=$2260$2262);return expr$2135;}}else{if(($2131$2151&&((t0$2149===2)&&($2130$2144[0]==="nostep")))){(x$2284=$2130$2144[1]);return x$2284;}else{(other$2289=$2130$2144);return expr$2135;}}}}}));return helper$2121(context$2106,scope$2107,expr$2108);});(Expander$1253.prototype["step_all"]=function(context$2296,scope$2297,$2294$2298){var t0$2302;var t1$2303;var pre$2325;var bulk$2326;var post$2327;var self$2320;var it$0$2315;var stmts$2300;(t0$2302=$2294$2298);if(((t0$2302 instanceof Array)&&(((t1$2303=t0$2302.length)),(t1$2303>=0)))){(stmts$2300=Array.prototype.slice.call(t0$2302,0));}else{$3611($2294$2298);}(it$0$2315=this);(self$2320=this);(pre$2325=[]);(bulk$2326=[]);(post$2327=[]);$2337:while(stmts$2300.length){var x$2392;var m$2384;var stmt$2379;var stmt$2374;var prepend$2362;var $2342$2357;var $2343$2358;var $2344$2359;var t0$2355;var $2341$2350;var current$2345;(current$2345=stmts$2300.shift());($2341$2350=it$0$2315.step(context$2296,scope$2297,current$2345));if((($2342$2357=($2341$2350 instanceof Array))&&(((t0$2355=$2341$2350.length)),((t0$2355>=1)&&($2341$2350[0]==="splice"))))){(prepend$2362=Array.prototype.slice.call($2341$2350,1));(stmts$2300=prepend$2362.concat(stmts$2300));}else{if(($2342$2357&&(($2344$2359=(t0$2355===2))&&($2341$2350[0]==="float")))){(stmt$2374=$2341$2350[1]);(pre$2325=pre$2325.concat(it$0$2315.step_all(context$2296,scope$2297,[stmt$2374])));}else{if(($2344$2359&&($2341$2350[0]==="sink"))){(stmt$2379=$2341$2350[1]);(post$2327=post$2327.concat(it$0$2315.step_all(context$2296,scope$2297,[stmt$2379])));}else{if(($2344$2359&&($2341$2350[0]==="multimacro"))){(m$2384=$2341$2350[1]);(stmts$2300=m$2384(context$2296,scope$2297,current$2345,stmts$2300));}else{(x$2392=$2341$2350);bulk$2326.push(x$2392);}}}}}return pre$2325.concat(bulk$2326).concat(post$2327);});(Expander$1253.prototype["expand"]=function(context$2397,scope$2398,expr$2399){var helper$2412;var self$2407;var it$0$2402;(it$0$2402=this);(self$2407=this);(helper$2412=track_location$1252(function(context$2416,scope$2417,expr$2418){var t0$2455;var other$2475;var $2452$2463;var env$2453;var $index$2522;var $length$2517;var temp$2512;var acc$2507;var newargs$2501;var $index$2569;var $length$2564;var temp$2559;var acc$2554;var newargs$2548;var t0$2626;var newscope$2620;var env$2621;var $index$2693;var $length$2688;var temp$2683;var acc$2678;var $index$2845;var $length$2840;var temp$2835;var acc$2830;var t0$2665;var newscope$2649;var stepscope$2650;var changes$2651;var newargs$2652;var vars$2653;var exp$2654;var $index$3174;var $length$3169;var temp$3164;var other$3266;var t0$3246;var $3239$3241;var is_obj$3073;var obj$3074;var arr$3075;var arr_parts$3076;var obj_parts$3077;var new_arr_part$3078;var new_obj_part$3079;var r$3080;var $index$3309;var $length$3304;var temp$3299;var acc$3294;var newscope$3286;var s$3381;var newscope$3393;var name$3374;var t0$3370;var $index$3431;var $length$3426;var temp$3421;var acc$3416;var other$3452;var type$3407;var args$3408;var tag$3397;var body$3398;var x$3365;var $2422$3366;var bindings$3281;var body$3282;var target$3275;var value$3276;var args$3069;var args$2645;var args$2640;var args$2635;var variable$2604;var s$2605;var value$2606;var body$2607;var args$2544;var args$2497;var f$2491;var arg$2492;var s$2444;var $2423$2439;var $2424$2440;var $2425$2441;var t0$2435;var t1$2436;var t2$2437;var $2421$2430;(expr$2418=it$0$2402.step(context$2416,scope$2417,expr$2418));($2421$2430=expr$2418);if((($2423$2439=($2421$2430 instanceof Array))&&(((t0$2435=$2421$2430.length)),(($2425$2441=(t0$2435===2))&&($2421$2430[0]==="symbol"))))){(s$2444=$2421$2430[1]);(t0$2455=expr$2418);if($3845(t0$2455,"env")){(env$2453=t0$2455.env);}else{$3611(expr$2418,"/home/olivier/git/earl-grey/src/expand.eg",7679,7683);}($2452$2463=env$2453.resolve(scope$2417,s$2444));if(($2452$2463===(void 0))){throw $3627(["syntax","undeclared"]).create(("Undeclared variable: "+s$2444),({"node":expr$2418}));}else{(other$2475=$2452$2463);return ["bounce",other$2475];}}else{if(($2425$2441&&($2421$2430[0]==="value"))){$2421$2430[1];return expr$2418;}else{if(($2425$2441&&($2421$2430[0]==="variable"))){$2421$2430[1];return expr$2418;}else{if(($2423$2439&&((t0$2435===1)&&($2421$2430[0]==="void")))){return expr$2418;}else{if(($2423$2439&&((t0$2435===3)&&($2421$2430[0]==="send")))){(f$2491=$2421$2430[1]);(arg$2492=$2421$2430[2]);return ["send",helper$2412(["expr","head"],scope$2417,f$2491),helper$2412(["expr","tail"],scope$2417,arg$2492)];}else{if(($2423$2439&&(($2425$2441=(t0$2435>=1))&&($2421$2430[0]==="array")))){(args$2497=Array.prototype.slice.call($2421$2430,1));(newargs$2501=(((acc$2507=[])),(((temp$2512=it$0$2402.step_all(["expr","array"],scope$2417,args$2497))),((($length$2517=temp$2512.length)),((($index$2522=0)),function(){$2504:for(;($index$2522<$length$2517);($index$2522++)){var arg$2538;var m$2530;(m$2530=temp$2512[$index$2522]);(arg$2538=m$2530);acc$2507.push(helper$2412(["expr","expr"],scope$2417,arg$2538));}}()))),acc$2507));return ["array"].concat(newargs$2501);}else{if(($2425$2441&&($2421$2430[0]==="object"))){(args$2544=Array.prototype.slice.call($2421$2430,1));(newargs$2548=(((acc$2554=[])),(((temp$2559=it$0$2402.step_all(["expr","object"],scope$2417,args$2544))),((($length$2564=temp$2559.length)),((($index$2569=0)),function(){$2551:for(;($index$2569<$length$2564);($index$2569++)){var k$2587;var v$2588;var t0$2582;var t1$2583;var m$2577;(m$2577=temp$2559[$index$2569]);(t0$2582=m$2577);if(((t0$2582 instanceof Array)&&(((t1$2583=t0$2582.length)),((t1$2583===3)&&(t0$2582[0]==="array"))))){(k$2587=t0$2582[1]);(v$2588=t0$2582[2]);acc$2554.push(["array",helper$2412(["expr","expr"],scope$2417,k$2587),helper$2412(["expr","expr"],scope$2417,v$2588)]);}else{$3611(m$2577,"/home/olivier/git/earl-grey/src/expand.eg",8522,8711);}}}()))),acc$2554));return ["object"].concat(newargs$2548);}else{if(($2423$2439&&((t0$2435===4)&&(($2421$2430[0]==="bind")&&(((t1$2436=$2421$2430[1])),((variable$2604=t1$2436),((t1$2436 instanceof Array)&&(((t2$2437=t1$2436.length)),((t2$2437===2)&&(t1$2436[0]==="symbol")))))))))){(s$2605=t1$2436[1]);(value$2606=$2421$2430[2]);(body$2607=$2421$2430[3]);(newscope$2620=Scope$1250(scope$2417));(t0$2626=variable$2604);if($3845(t0$2626,"env")){(env$2621=t0$2626.env);}else{$3611(variable$2604,"/home/olivier/git/earl-grey/src/expand.eg",8854,8862);}env$2621.bind(newscope$2620,s$2605,value$2606);return helper$2412(context$2416,newscope$2620,body$2607);}else{if(($2423$2439&&(($2425$2441=(t0$2435>=1))&&($2421$2430[0]==="splice")))){(args$2635=Array.prototype.slice.call($2421$2430,1));return ["bounce",$1183(["multi"].concat(args$2635),({"override_scope":true}))];}else{if(($2425$2441&&($2421$2430[0]==="interactive"))){(args$2640=Array.prototype.slice.call($2421$2430,1));return ["bounce",$1183(["multi"].concat(args$2640),({"override_scope":true,"all_mutable":true}))];}else{if(($2425$2441&&($2421$2430[0]==="multi"))){(args$2645=Array.prototype.slice.call($2421$2430,1));(newscope$2649=function(){if(expr$2418.override_scope){return scope$2417;}else{return Scope$1250(scope$2417);}}());(stepscope$2650=function(){if(expr$2418.nonrecursive){return scope$2417;}else{return newscope$2649;}}());(changes$2651=false);(t0$2665=classify$1242("newargs","vars",(((acc$2678=[])),(((temp$2683=it$0$2402.step_all(["expr","multi"],stepscope$2650,args$2645))),((($length$2688=temp$2683.length)),((($index$2693=0)),function(){$2669:for(;($index$2693<$length$2688);($index$2693++)){var t0$2752;var env$2750;var t0$2783;var env$2780;var v$2781;var other$2814;var v$2798;var value$2799;var variable$2764;var s$2765;var value$2766;var variable$2734;var s$2735;var value$2736;var opt$2719;var value$2720;var $2671$2711;var $2672$2712;var $2673$2713;var $2674$2714;var $2675$2715;var $2676$2716;var t0$2706;var t1$2707;var t2$2708;var t3$2709;var m$2701;(m$2701=temp$2683[$index$2693]);(t0$2706=m$2701);if((($2672$2712=(t0$2706 instanceof Array))&&(((t1$2707=t0$2706.length)),(($2674$2714=(t1$2707===3))&&(t0$2706[0]==="option"))))){(opt$2719=t0$2706[1]);(value$2720=t0$2706[2]);acc$2678.push((newscope$2649.setopt(opt$2719,value$2720),["ignore"]));}else{if(($2674$2714&&((t0$2706[0]==="declare_raw")&&(((t2$2708=t0$2706[1])),((variable$2734=t2$2708),((t2$2708 instanceof Array)&&(((t3$2709=t2$2708.length)),((t3$2709===2)&&(t2$2708[0]==="symbol"))))))))){(s$2735=t2$2708[1]);(value$2736=t0$2706[2]);acc$2678.push(((((t0$2752=variable$2734)),function(){if($3845(t0$2752,"env")){(env$2750=t0$2752.env);}else{return $3611(variable$2734,"/home/olivier/git/earl-grey/src/expand.eg",9808,9816);}}()),env$2750.bind(newscope$2649,s$2735,value$2736),((changes$2651=true)),["ignore"]));}else{if(($2672$2712&&(($2674$2714=((t1$2707>=2)&&(t1$2707<=3)))&&(($2675$2715=(t0$2706[0]==="declare"))&&(((t2$2708=t0$2706[1])),((variable$2764=t2$2708),((t2$2708 instanceof Array)&&(((t3$2709=t2$2708.length)),((t3$2709===2)&&(t2$2708[0]==="symbol")))))))))){(s$2765=t2$2708[1]);(value$2766=function(){if((2>=t1$2707)){return null;}else{return t0$2706[2];}}());acc$2678.push(((((t0$2783=variable$2764)),function(){if($3845(t0$2783,"env")){(env$2780=t0$2783.env);}else{return $3611(variable$2764,"/home/olivier/git/earl-grey/src/expand.eg",10056,10064);}}()),((v$2781=__lt____lt____colon__$1240(["variable",it$0$2402.gensym(s$2765)],variable$2764))),$1183(v$2781,({"mutable":(expr$2418.all_mutable||variable$2764.mutable)})),env$2780.bind(newscope$2649,s$2765,v$2781),((changes$2651=true)),function(){if(value$2766){return ["splice",["newargs",["assign",v$2781,value$2766]],["vars",v$2781]];}else{return ["vars",v$2781];}}()));}else{if(($2675$2715&&((v$2798=t2$2708),((t2$2708 instanceof Array)&&(((t3$2709=t2$2708.length)),((t3$2709===2)&&(t2$2708[0]==="variable"))))))){t2$2708[1];(value$2799=function(){if((2>=t1$2707)){return null;}else{return t0$2706[2];}}());acc$2678.push((((changes$2651=true)),function(){if(value$2799){return ["splice",["newargs",["assign",v$2798,value$2799]],["vars",v$2798]];}else{return ["vars",v$2798];}}()));}else{(other$2814=m$2701);acc$2678.push(["newargs",other$2814]);}}}}}}()))),acc$2678)));if(($3845(t0$2665,"newargs")&&((newargs$2652=t0$2665.newargs),$3845(t0$2665,"vars")))){(vars$2653=t0$2665.vars);}else{$3611(classify$1242("newargs","vars",(((acc$2830=[])),(((temp$2835=it$0$2402.step_all(["expr","multi"],stepscope$2650,args$2645))),((($length$2840=temp$2835.length)),((($index$2845=0)),function(){$2821:for(;($index$2845<$length$2840);($index$2845++)){var t0$2904;var env$2902;var t0$2935;var env$2932;var v$2933;var other$2966;var v$2950;var value$2951;var variable$2916;var s$2917;var value$2918;var variable$2886;var s$2887;var value$2888;var opt$2871;var value$2872;var $2823$2863;var $2824$2864;var $2825$2865;var $2826$2866;var $2827$2867;var $2828$2868;var t0$2858;var t1$2859;var t2$2860;var t3$2861;var m$2853;(m$2853=temp$2835[$index$2845]);(t0$2858=m$2853);if((($2824$2864=(t0$2858 instanceof Array))&&(((t1$2859=t0$2858.length)),(($2826$2866=(t1$2859===3))&&(t0$2858[0]==="option"))))){(opt$2871=t0$2858[1]);(value$2872=t0$2858[2]);acc$2830.push((newscope$2649.setopt(opt$2871,value$2872),["ignore"]));}else{if(($2826$2866&&((t0$2858[0]==="declare_raw")&&(((t2$2860=t0$2858[1])),((variable$2886=t2$2860),((t2$2860 instanceof Array)&&(((t3$2861=t2$2860.length)),((t3$2861===2)&&(t2$2860[0]==="symbol"))))))))){(s$2887=t2$2860[1]);(value$2888=t0$2858[2]);acc$2830.push(((((t0$2904=variable$2886)),function(){if($3845(t0$2904,"env")){(env$2902=t0$2904.env);}else{return $3611(variable$2886,"/home/olivier/git/earl-grey/src/expand.eg",9808,9816);}}()),env$2902.bind(newscope$2649,s$2887,value$2888),((changes$2651=true)),["ignore"]));}else{if(($2824$2864&&(($2826$2866=((t1$2859>=2)&&(t1$2859<=3)))&&(($2827$2867=(t0$2858[0]==="declare"))&&(((t2$2860=t0$2858[1])),((variable$2916=t2$2860),((t2$2860 instanceof Array)&&(((t3$2861=t2$2860.length)),((t3$2861===2)&&(t2$2860[0]==="symbol")))))))))){(s$2917=t2$2860[1]);(value$2918=function(){if((2>=t1$2859)){return null;}else{return t0$2858[2];}}());acc$2830.push(((((t0$2935=variable$2916)),function(){if($3845(t0$2935,"env")){(env$2932=t0$2935.env);}else{return $3611(variable$2916,"/home/olivier/git/earl-grey/src/expand.eg",10056,10064);}}()),((v$2933=__lt____lt____colon__$1240(["variable",it$0$2402.gensym(s$2917)],variable$2916))),$1183(v$2933,({"mutable":(expr$2418.all_mutable||variable$2916.mutable)})),env$2932.bind(newscope$2649,s$2917,v$2933),((changes$2651=true)),function(){if(value$2918){return ["splice",["newargs",["assign",v$2933,value$2918]],["vars",v$2933]];}else{return ["vars",v$2933];}}()));}else{if(($2827$2867&&((v$2950=t2$2860),((t2$2860 instanceof Array)&&(((t3$2861=t2$2860.length)),((t3$2861===2)&&(t2$2860[0]==="variable"))))))){t2$2860[1];(value$2951=function(){if((2>=t1$2859)){return null;}else{return t0$2858[2];}}());acc$2830.push((((changes$2651=true)),function(){if(value$2951){return ["splice",["newargs",["assign",v$2950,value$2951]],["vars",v$2950]];}else{return ["vars",v$2950];}}()));}else{(other$2966=m$2853);acc$2830.push(["newargs",other$2966]);}}}}}}()))),acc$2830)),"/home/olivier/git/earl-grey/src/expand.eg",9480,11088);}(exp$2654=function(s$2972){var $index$2998;var $length$2993;var temp$2988;var acc$2983;var $index$3047;var $length$3042;var temp$3037;var acc$3032;var stepped$2975;(stepped$2975=(((acc$2983=[])),(((temp$2988=$3823(newargs$2652))),((($length$2993=temp$2988.length)),((($index$2998=0)),function(){$2980:for(;($index$2998<$length$2993);($index$2998++)){var i$3016;var arg$3017;var t0$3011;var t1$3012;var m$3006;(m$3006=temp$2988[$index$2998]);(t0$3011=m$3006);if(((t0$3011 instanceof Array)&&(((t1$3012=t0$3011.length)),(t1$3012===2)))){(i$3016=t0$3011[0]);(arg$3017=t0$3011[1]);acc$2983.push(it$0$2402.step(["expr",function(){if((i$3016===(newargs$2652.length-1))){return "expr";}else{return "ignore";}}()],s$2972,arg$3017));}else{$3611(m$3006,"/home/olivier/git/earl-grey/src/expand.eg",11310,11487);}}}()))),acc$2983));(acc$3032=[]);(temp$3037=stepped$2975);($length$3042=temp$3037.length);($index$3047=0);$2976:for(;($index$3047<$length$3042);($index$3047++)){var arg$3063;var m$3055;(m$3055=temp$3037[$index$3047]);(arg$3063=m$3055);acc$3032.push(helper$2412(["expr","expr"],s$2972,arg$3063));}return acc$3032;});if(changes$2651){return ["scope",vars$2653,["multi"].concat(exp$2654(newscope$2649))];}else{return ["multi"].concat(exp$2654(scope$2417));}}else{if(($2425$2441&&($2421$2430[0]==="data"))){(args$3069=Array.prototype.slice.call($2421$2430,1));(is_obj$3073=false);(obj$3074=["object"]);(arr$3075=["array"]);(arr_parts$3076=[]);(obj_parts$3077=[]);(new_arr_part$3078=function(){var other$3125;var t0$3113;var $3106$3108;($3106$3108=arr$3075);if((($3106$3108 instanceof Array)&&(((t0$3113=$3106$3108.length)),((t0$3113===1)&&($3106$3108[0]==="array"))))){return false;}else{(other$3125=$3106$3108);arr_parts$3076.push(arr$3075);(arr$3075=["array"]);}});(new_obj_part$3079=function(){var other$3155;var t0$3143;var $3136$3138;($3136$3138=obj$3074);if((($3136$3138 instanceof Array)&&(((t0$3143=$3136$3138.length)),((t0$3143===1)&&($3136$3138[0]==="object"))))){return false;}else{(other$3155=$3136$3138);obj_parts$3077.push(obj$3074);(obj$3074=["object"]);}});(temp$3164=it$0$2402.step_all(["expr","data"],scope$2417,args$3069));($length$3169=temp$3164.length);($index$3174=0);$3081:for(;($index$3174<$length$3169);($index$3174++)){var other$3235;var expr$3226;var expr$3220;var k$3210;var v$3211;var $3083$3190;var $3084$3191;var $3085$3192;var $3086$3193;var t0$3187;var t1$3188;var m$3182;(m$3182=temp$3164[$index$3174]);(t0$3187=m$3182);if((($3084$3191=(t0$3187 instanceof Array))&&(((t1$3188=t0$3187.length)),((t1$3188===1)&&(t0$3187[0]==="assoc"))))){(is_obj$3073=true);}else{if(($3084$3191&&((t1$3188===3)&&(t0$3187[0]==="assoc")))){(k$3210=t0$3187[1]);(v$3211=t0$3187[2]);(is_obj$3073=true);obj$3074.push(["array",k$3210,v$3211]);}else{if(($3084$3191&&(($3086$3193=(t1$3188===2))&&(t0$3187[0]==="dynsplice")))){(expr$3220=t0$3187[1]);new_arr_part$3078();arr_parts$3076.push(expr$3220);}else{if(($3086$3193&&(t0$3187[0]==="objsplice"))){(expr$3226=t0$3187[1]);(is_obj$3073=true);new_obj_part$3079();obj_parts$3077.push(expr$3226);}else{(other$3235=m$3182);arr$3075.push(other$3235);}}}}}new_arr_part$3078();new_obj_part$3079();(r$3080=((($3239$3241=arr_parts$3076)),function(){if((($3239$3241 instanceof Array)&&(((t0$3246=$3239$3241.length)),((t0$3246===0)&&is_obj$3073)))){return util$1241.construct(obj_parts$3077,function(x$3257,rest$3258){return ["send",["symbol","&:"],["data",x$3257,rest$3258]];},["object"]);}else{$3239$3241;if(is_obj$3073){throw $3627(["syntax","array","object"]).create("Cannot mix array and object notations.");}else{(other$3266=$3239$3241);return util$1241.construct(arr_parts$3076.reverse(),function(x$3269,rest$3270){return ["send",["send",rest$3270,["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",x$3269]];},["array"]);}}}()));return helper$2412(context$2416,scope$2417,it$0$2402.mkenv().convert(r$3080));}else{if(($2423$2439&&(($2425$2441=(t0$2435===3))&&($2421$2430[0]==="assign")))){(target$3275=$2421$2430[1]);(value$3276=$2421$2430[2]);return ["assign",helper$2412(["expr","expr"],scope$2417,target$3275),helper$2412(["expr","expr"],scope$2417,value$3276)];}else{if(($2425$2441&&($2421$2430[0]==="lambda"))){(bindings$3281=$2421$2430[1]);(body$3282=$2421$2430[2]);(newscope$3286=Scope$1250(scope$2417));return ["lambda",(((acc$3294=[])),(((temp$3299=bindings$3281)),((($length$3304=temp$3299.length)),((($index$3309=0)),function(){$3290:for(;($index$3309<$length$3304);($index$3309++)){var v$3342;var x$3352;var other$3360;var v$3349;var b$3328;var env$3329;var $3292$3325;var t0$3322;var t1$3323;var m$3317;(m$3317=temp$3299[$index$3309]);(t0$3322=m$3317);if(((t0$3322 instanceof Array)&&(((t1$3323=t0$3322.length)),((t1$3323===2)&&((t0$3322[0]==="symbol")&&((b$3328=t0$3322[1]),$3845(t0$3322,"env"))))))){(env$3329=t0$3322.env);acc$3294.push((((v$3342=["variable",it$0$2402.gensym(b$3328)])),(env$3329.bind(newscope$3286,b$3328,v$3342),v$3342)));}else{if((((x$3352=t0$3322)),((x$3352 instanceof Array)&&(x$3352[0]==="variable")))){(v$3349=t0$3322);acc$3294.push(v$3349);}else{(other$3360=m$3317);acc$3294.push(function(){throw $3627(["syntax","lambda","binding"]).create("Not a valid binding.",({"node":other$3360}));}());}}}}()))),acc$3294),helper$2412(["expr","expr"],newscope$3286,body$3282)];}else{if(($2425$2441&&($2421$2430[0]==="use"))){($2422$3366=$2421$2430[1]);(x$3365=$2421$2430[2]);(t0$3370=$2422$3366);if((typeof(t0$3370)==="string")){(name$3374=t0$3370);(s$3381=scope$2417);$3385:while(s$3381){if((s$3381.name.slice(0,(name$3374.length+1))===(name$3374+"/"))){break $3385;}else{(s$3381=s$3381.parent);}}if(s$3381){return helper$2412(context$2416,s$3381,x$3365);}else{throw $3627(["syntax","noscope"]).create(("Could not find a scope tagged: "+name$3374));}}else{(newscope$3393=$2422$3366);return helper$2412(context$2416,newscope$3393,x$3365);}}else{if(($2425$2441&&(($2421$2430[0]==="tagscope")&&(((t1$2436=$2421$2430[1])),(typeof(t1$2436)==="string"))))){(tag$3397=t1$2436);(body$3398=$2421$2430[2]);return helper$2412(context$2416,Scope$1250(scope$2417,it$0$2402.gensym((tag$3397+"/"))),body$3398);}else{if(($2423$2439&&((t0$2435>=1)&&((type$3407=$2421$2430[0]),((args$3408=Array.prototype.slice.call($2421$2430,1)),(it$0$2402.generic_nodes.indexOf(type$3407)!==-1)))))){return [type$3407].concat((((acc$3416=[])),(((temp$3421=args$3408)),((($length$3426=temp$3421.length)),((($index$3431=0)),function(){$3413:for(;($index$3431<$length$3426);($index$3431++)){var arg$3447;var m$3439;(m$3439=temp$3421[$index$3431]);(arg$3447=m$3439);acc$3416.push(helper$2412(["expr","expr"],scope$2417,arg$3447));}}()))),acc$3416));}else{(other$3452=$2421$2430);throw $3627(["syntax","illegal_node"]).create("An illegal node was found.",({"node":other$3452,"context":context$2416}));}}}}}}}}}}}}}}}}}}));return helper$2412(context$2397,scope$2398,expr$2399);});$1183(Expander$1253,$1183(((accum$3456=({})),((accum$3456["::name"]="Expander"),accum$3456)),((accum$3460=({})),((accum$3460["::egclass"]=true),accum$3460))));Expander$1253;(mac1$1254=function(f$3466){return ["macro",function(context$3470,scope$3471,form$3472,$3468$3473){var t0$3477;var t1$3478;var expr$3475;(t0$3477=$3468$3473);if(((t0$3477 instanceof Array)&&(((t1$3478=t0$3477.length)),((t1$3478===2)&&(t0$3477[0]==="data"))))){(expr$3475=t0$3477[1]);}else{$3611($3468$3473);}return f$3466(expr$3475);}];});(__chk_ncache$1255=({}));(__chk_scache$1256=({}));(checker_db$1257=function($3498$3500){var v$3536;var v$3552;var s$3548;var n$3532;var $3502$3508;var ph$3503;(ph$3503=$3498$3500);($3502$3508=ph$3503);if(($3502$3508===null)){return checker_db$1257.null;}else{if(($3502$3508===(void 0))){return checker_db$1257.undefined;}else{if(($3502$3508===true)){return checker_db$1257.true;}else{if(($3502$3508===false)){return checker_db$1257.false;}else{if((typeof($3502$3508)==="number")){(n$3532=$3502$3508);if($1182(__chk_ncache$1255,n$3532)){return $1182(__chk_ncache$1255,n$3532);}else{(v$3536=mac1$1254(function(x$3540){return ["send",["symbol","==="],["data",x$3540,["value",n$3532]]];}));(__chk_ncache$1255[n$3532]=v$3536);return v$3536;}}else{if((typeof($3502$3508)==="string")){(s$3548=$3502$3508);if(Object.prototype.hasOwnProperty.call(__chk_scache$1256,s$3548)){return $1182(__chk_scache$1256,s$3548);}else{(v$3552=mac1$1254(function(x$3556){return ["send",["symbol","==="],["data",x$3556,["value",s$3548]]];}));(__chk_scache$1256[s$3548]=v$3552);return v$3552;}}else{$3611($3502$3508);}}}}}}});$1183(checker_db$1257,({"String":mac1$1254(function(x$3566){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$3566]],["value","string"]]];}),"Number":mac1$1254(function(x$3569){return ["send",["symbol","==="],["data",["send",["symbol","typeof"],["data",x$3569]],["value","number"]]];}),"Array":mac1$1254(function(x$3572){return ["send",["symbol","instanceof"],["data",x$3572,["symbol","Array"]]];}),"true":mac1$1254(function(x$3575){return x$3575;}),"false":mac1$1254(function(x$3578){return ["send",["symbol","not"],["data",["void"],x$3578]];}),"null":mac1$1254(function(x$3581){return ["send",["symbol","==="],["data",x$3581,["value",null]]];}),"undefined":mac1$1254(function(x$3584){return ["send",["symbol","==="],["data",x$3584,["value",(void 0)]]];})}));(exports["Env"]=Env$1251);(exports["Scope"]=Scope$1250);(exports["track_location"]=track_location$1252);(exports["Expander"]=Expander$1253);(exports["GenSym"]=GenSym$1244);(exports["gensym"]=gensym$1245);(exports["mac1"]=mac1$1254);(exports["checker_db"]=checker_db$1257);
