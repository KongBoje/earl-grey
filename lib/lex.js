var $4132=function(type$4134){var f$4137;(f$4137=type$4134["::check"]);if((f$4137===(void 0))){return function(value$4142){return (value$4142 instanceof type$4134);};}else{return function(value$4145){return f$4137.call(type$4134,value$4145);};}};
var $4147=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $4148=function(dest$4150,values$4151){var k$4156;(k$4156=null);$4154:for(k$4156 in values$4151){if(values$4151.hasOwnProperty(k$4156)){(dest$4150[k$4156]=values$4151[k$4156]);}}return dest$4150;};
var $4163=function($4164$4166){var ph$4170;(ph$4170=$4164$4166);var $4168$4175;($4168$4175=ph$4170);var bridge$4169$4180;var x$4184;(bridge$4169$4180=$4168$4175);if((((typeof(bridge$4169$4180)==="string")&&((x$4184=bridge$4169$4180),true))||((typeof(bridge$4169$4180)==="number")&&((x$4184=bridge$4169$4180),true)))){return ["value",x$4184];}else{var other$4194;(other$4194=$4168$4175);return other$4194["::serialize_ast"]();}};
var send$3939;(send$3939=function(obj$3944,$3942$3945){var ph$3949;var msg$3950;var t0$3952;(t0$3952=$3942$3945);(msg$3950=t0$3952);(ph$3949=t0$3952);var $3947$3959;($3947$3959=ph$3949);var bridge$3948$3964;(bridge$3948$3964=$3947$3959);if(((typeof(bridge$3948$3964)==="string")||(typeof(bridge$3948$3964)==="number"))){return obj$3944[msg$3950];}else{var other$3975;(other$3975=$3947$3959);return obj$3944["::send"](msg$3950);}});(Array[":::project"]=function($3980$3982){var ph$3985;var value$3986;var t0$3988;(t0$3988=$3980$3982);(value$3986=t0$3988);(ph$3985=t0$3988);var $3984$3995;($3984$3995=ph$3985);if($4132(Array)($3984$3995)){return [true,value$3986];}else{$3984$3995;return [true,[value$3986]];}});(Array.prototype["::check"]=function(value$4012){if((value$4012 instanceof Array)){var i$4017;(i$4017=0);$4015:for(;(i$4017<this.length);(i$4017++)){if(($4147(this,i$4017)!==$4147(value$4012,i$4017))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $4148(this.slice(0),this);});(Array.prototype[":::project"]=function(value$4034){if((value$4034 instanceof Array)){var i$4039;(i$4039=0);$4037:for(;(i$4039<this.length);(i$4039++)){if(($4147(this,i$4039)!==$4147(value$4034,i$4039))){return [true,[value$4034]];}}return [true,value$4034.slice(this.length)];}else{return [true,[value$4034]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($4163));});(RegExp.prototype["::check"]=function($4055$4057){var ph$4060;(ph$4060=$4055$4057);var $4059$4065;($4059$4065=ph$4060);var value$4073;if((typeof($4059$4065)==="string")){(value$4073=$4059$4065);if(value$4073.match(this)){return true;}else{return false;}}else{var other$4078;(other$4078=$4059$4065);return false;}});(RegExp.prototype[":::project"]=function($4083$4085){var ph$4088;(ph$4088=$4083$4085);var $4087$4093;($4087$4093=ph$4088);var value$4101;if((typeof($4087$4093)==="string")){(value$4101=$4087$4093);var $4104$4106;($4104$4106=value$4101.match(this));var m$4114;if(($4104$4106===null)){(m$4114=$4104$4106);return [false,null];}else{var m$4119;(m$4119=$4104$4106);return [true,m$4119];}}else{var other$4123;(other$4123=$4087$4093);return [false,null];}});(Function.prototype["::send"]=function(args$4129){return this.apply(this,args$4129);});
var $5810=function(arr$5812){var results$5816;var l$5817;(results$5816=[]);(l$5817=arr$5812.length);var i$5825;(i$5825=0);$5815:for(;(i$5825<l$5817);(i$5825++)){results$5816.push([i$5825,$4147(arr$5812,i$5825)]);}return results$5816;};
var $5614=function(){var $5615$5617;($5615$5617=function(tags$5621){var it$0$5624;(it$0$5624=function(){if((!$4132($5615$5617)(this))){return Object.create($5615$5617.prototype);}else{return this;}}());(it$0$5624["tags"]=tags$5621);return it$0$5624;});($5615$5617.prototype["create"]=function(){var $5636$5638;($5636$5638=arguments);var t0$5643;var message$5647;var args$5648;(t0$5643=$5636$5638.length);if((t0$5643>=0)){(message$5647=function(){if((0>=t0$5643)){return "";}else{return $5636$5638[0];}}());(args$5648=Array.prototype.slice.call($5636$5638,1));var it$0$5655;(it$0$5655=this);var self$5660;(self$5660=this);var e$5665;(e$5665=Error(message$5647));(e$5665["::tags"]=it$0$5655.tags);(e$5665["args"]=args$5648);var temp$5679;(temp$5679=$5810(args$5648));var $length$5684;($length$5684=temp$5679.length);var $index$5689;($index$5689=0);$5666:for(;($index$5689<$length$5684);($index$5689++)){var m$5697;(m$5697=temp$5679[$index$5689]);var t0$5702;var t1$5703;var i$5707;var arg$5708;(t0$5702=m$5697);if(((t0$5702 instanceof Array)&&(((t1$5703=t0$5702.length)),(t1$5703===2)))){(i$5707=t0$5702[0]);(arg$5708=t0$5702[1]);(e$5665[i$5707]=arg$5708);}else{$5598(m$5697);}}(e$5665["length"]=args$5648.length);(e$5665["name"]=["E"].concat(it$0$5655.tags).join("."));return e$5665;}else{$5598($5636$5638);}});($5615$5617.prototype["::check"]=function(e$5734){var it$0$5737;(it$0$5737=this);var self$5742;(self$5742=this);var tags$5747;if(((!e$5734)||(!$4132(Error)(e$5734)))){return false;}(tags$5747=(e$5734["::tags"]||[]));var temp$5756;(temp$5756=it$0$5737.tags);var $length$5761;($length$5761=temp$5756.length);var $index$5766;($index$5766=0);$5748:for(;($index$5766<$length$5761);($index$5766++)){var m$5774;(m$5774=temp$5756[$index$5766]);var tag$5782;(tag$5782=m$5774);if((tags$5747.indexOf(tag$5782)===-1)){return false;}else{false;}}return true;});($5615$5617.prototype["::deconstruct"]=function(e$5790){var it$0$5793;(it$0$5793=this);var self$5798;(self$5798=this);return e$5790.args;});$4148($5615$5617,$4148(function(){var accum$5803;(accum$5803=({}));(accum$5803["::name"]="$5615");return accum$5803;}(),function(){var accum$5807;(accum$5807=({}));(accum$5807["::egclass"]=true);return accum$5807;}()));return $5615$5617;}();
var $5598=function(value$5600,url$5601,start$5602,end$5603){var err$5606;(err$5606=$5614(["match"]).create("Could not find a match for value",({"value":value$5600})));if(url$5601){(err$5606["location"]=["location",url$5601,start$5602,end$5603]);}throw err$5606;};
var $5922=function($5923$5925,key$5926){var ph$5930;(ph$5930=$5923$5925);var $5928$5935;($5928$5935=ph$5930);var bridge$5929$5940;(bridge$5929$5940=$5928$5935);if(((bridge$5929$5940===null)||(bridge$5929$5940===(void 0)))){return false;}else{var x$5951;if((typeof($5928$5935)==="string")){(x$5951=$5928$5935);return (key$5926 in String.prototype);}else{var x$5956;if((typeof($5928$5935)==="number")){(x$5956=$5928$5935);return (key$5926 in Number.prototype);}else{var x$5961;(x$5961=$5928$5935);return (key$5926 in x$5961);}}}};
var $5851=function($5852$5854){var ph$5860;var x$5861;var t0$5863;(t0$5863=$5852$5854);(x$5861=t0$5863);(ph$5860=t0$5863);var $5856$5870;($5856$5870=ph$5860);var bridge$5857$5875;(bridge$5857$5875=$5856$5870);if((function(){var bridge$5858$5884;(bridge$5858$5884=bridge$5857$5875);return (function(){var bridge$5859$5890;(bridge$5859$5890=bridge$5858$5884);return ((bridge$5859$5890===(void 0))||(bridge$5859$5890===null));}()||(typeof(bridge$5858$5884)==="string"));}()||(typeof(bridge$5857$5875)==="number"))){return x$5861;}else{if($5922($5856$5870,"::clone")){$5856$5870["::clone"];return x$5861["::clone"]();}else{$5856$5870;if((Object.getPrototypeOf(x$5861)===Object.prototype)){var dest$5906;(dest$5906=({}));var k$5911;(k$5911=null);$5905:for(k$5911 in x$5861){if(Object.prototype.hasOwnProperty.call(x$5861,k$5911)){(dest$5906[k$5911]=x$5861[k$5911]);}}return dest$5906;}else{var other$5920;(other$5920=$5856$5870);throw $5614(["clone"]).create("Object cannot be cloned",({"obj":x$5861}));}}}};
var $5832=function(a$5834,b$5835){var dest$5839;(dest$5839=$5851(a$5834));var k$5844;(k$5844=null);$5838:for(k$5844 in b$5835){if(Object.prototype.hasOwnProperty.call(b$5835,k$5844)){(dest$5839[k$5844]=b$5835[k$5844]);}}return dest$5839;};var id$4228;var id_f$4229;var numr$4230;var numr_f$4231;var num$4232;var num_f$4233;var str$4234;var str_f$4235;var op$4236;var op2$4237;var op3$4238;var op4$4239;var op_f$4240;var indent$4241;var indent_f$4242;var cmnt$4243;var cmnt_f$4244;var unkn$4245;var unkn_f$4246;var $4198$4199;var Location$4200;var __lt____lt____colon__$4201;var special_ops$4202;var regexps$4203;var ws_re$4204;var eol_re$4205;var produce$4206;var indent_tracker$4207;var process_indent$4208;var disambiguate_fixity$4209;var alternate_operators$4210;var fill_locations$4211;var tokenize$4212;($4198$4199=require("./location"));(Location$4200=$4198$4199.Location);(__lt____lt____colon__$4201=$4198$4199["<<:"]);(special_ops$4202=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",".":"PFX","'":"PFX","not":"PFX"}));(regexps$4203=(((id$4228=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))",""))),((id_f$4229=function(m$4253){return ["ID",m$4253[0]];})),((numr$4230=RegExp("(?:^((?:\\d+))[rR]((?:[A-Za-z0-9_]+))(?:(?:\\.((?:[A-Za-z0-9_]+)))?))",""))),((numr_f$4231=function(m$4262){var t0$4270;var t1$4271;var frac$4287;var radix$4265;var intp$4266;var frac$4267;var value$4268;(t0$4270=m$4262);if(((t0$4270 instanceof Array)&&(((t1$4271=t0$4270.length)),(t1$4271===4)))){t0$4270[0];(radix$4265=t0$4270[1]);(intp$4266=t0$4270[2]);(frac$4267=t0$4270[3]);}else{$5598(m$4262,"/home/olivier/git/earl-grey/src/lex.eg",993,994);}(value$4268=parseInt(intp$4266.replace(RegExp("_","g"),""),radix$4265));if(frac$4267){(frac$4287=frac$4267.replace(RegExp("_","g"),""));(value$4268=(value$4268+(parseInt(frac$4267,radix$4265)/Math.pow(radix$4265,frac$4267.length))));}return ["NUM",value$4268];})),((num$4232=RegExp("(?:^((?:[0-9_]+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:[0-9_]+)))?))",""))),((num_f$4233=function(m$4301){return ["NUM",parseFloat(m$4301[0].replace(RegExp("_","g"),""))];})),((str$4234=RegExp("(?:^\"((?:(?:(?:\\\\\\\\|\\\\\")|[^\"])*))\")",""))),((str_f$4235=function(m$4310){var repl$4313;var r$4314;(repl$4313=({"\\\"":"\"","\\\\":"\\","\\n":"\n"}));(r$4314=m$4310[1].replace(RegExp("((?:(?:\\\\\"|\\\\\\\\)|\\\\n))","g"),function(m$4321){return $4147(repl$4313,m$4321);}));return ["STR",r$4314];})),((op$4236=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!@#.:']+))",""))),((op2$4237=RegExp("(?:^[\\[\\{\\}\\],])",""))),((op3$4238=RegExp("(?:^(?:(?:(?:(?:(?:(?:(?:(?:(?:with|where)|when)|and)|not)|or)|in)|mod)|each)|as)(?:(?:[+\\-*/~\\^<>=%&|?!@#.:']+)|\\b))",""))),((op4$4239=RegExp("(?:^`((?:[A-Za-z0-9_]+))`)",""))),((op_f$4240=function(m$4340,column$4341){var fixity$4367;var otherwise$4373;var $4345$4357;var $4344$4351;var op$4346;(op$4346=(m$4340[1]||m$4340[0]));($4344$4351=null);$4344$4351;if((op$4346==="|")){return ["INDENT",(column$4341-1)];}else{if((op$4346 in special_ops$4202)){(fixity$4367=$4147(special_ops$4202,op$4346));return ["OP",fixity$4367,op$4346];}else{(otherwise$4373=$4344$4351);return ["OP","?FX",op$4346];}}})),((indent$4241=RegExp("(?:^(?:(?:\n \\*;(?:[^\n]*))*)(?:(?:\n((?: *)))+))",""))),((indent_f$4242=function(m$4382){var ilen$4385;(ilen$4385=m$4382[1].length);return ["INDENT",ilen$4385];})),((cmnt$4243=RegExp("(?:^;(?:[^\n]*))",""))),((cmnt_f$4244=function(m$4396){return ["IGNORE"];})),((unkn$4245=RegExp("(?:^.)",""))),((unkn_f$4246=function(m$4405){return ["ILLEGAL",m$4405[0]];})),[[op3$4238,op_f$4240],[id$4228,id_f$4229],[numr$4230,numr_f$4231],[num$4232,num_f$4233],[str$4234,str_f$4235],[op$4236,op_f$4240],[op2$4237,op_f$4240],[op4$4239,op_f$4240],[indent$4241,indent_f$4242],[cmnt$4243,cmnt_f$4244],[unkn$4245,unkn_f$4246]]));(ws_re$4204=RegExp("(?:^(?: *)(?:(?:\n(?: *)\\\\(?: *))*))",""));(eol_re$4205=RegExp("(?:^(?: *)(?:\n|$))",""));(produce$4206=function(src$4418){var text$4421;var results$4422;var wsb$4423;var pos$4424;var column$4425;(text$4421=src$4418.text);(results$4422=[]);(wsb$4423=text$4421.match(ws_re$4204)[0].length);(text$4421=text$4421.slice(wsb$4423));(pos$4424=wsb$4423);(column$4425=0);$4444:while(text$4421){var i$4449;(i$4449=0);$4447:for(;(i$4449<regexps$4203.length);(++i$4449)){var t0$4461;var t1$4462;var splits$4493;var skip$4477;var endpos$4478;var wsa$4479;var eol$4480;var bwsb$4481;var bwsa$4482;var token$4483;var re$4457;var fn$4458;var m$4459;(t0$4461=$4147(regexps$4203,i$4449));if(((t0$4461 instanceof Array)&&(((t1$4462=t0$4461.length)),(t1$4462===2)))){(re$4457=t0$4461[0]);(fn$4458=t0$4461[1]);}else{$5598($4147(regexps$4203,i$4449),"/home/olivier/git/earl-grey/src/lex.eg",3359,3379);}(m$4459=text$4421.match(re$4457));if(m$4459){(skip$4477=m$4459[0].length);(endpos$4478=(pos$4424+skip$4477));(column$4425=(((splits$4493=m$4459[0].split("\n"))),function(){if((splits$4493.length>1)){return $4147(splits$4493,(splits$4493.length-1)).length;}else{return (column$4425+skip$4477);}}()));(text$4421=text$4421.slice(skip$4477));(wsa$4479=text$4421.match(ws_re$4204)[0].length);(eol$4480=(text$4421.match(eol_re$4205)&&true));(bwsb$4481=(wsb$4423>0));(bwsa$4482=function(){if(eol$4480){return bwsb$4481;}else{return (wsa$4479>0);}}());(token$4483=fn$4458(m$4459,column$4425));(token$4483["wsb"]=bwsb$4481);(token$4483["wsa"]=bwsa$4482);(token$4483["location"]=Location$4200(src$4418,pos$4424,endpos$4478));results$4422.push(token$4483);(text$4421=text$4421.slice(wsa$4479));(column$4425=(column$4425+wsa$4479));(wsb$4423=wsa$4479);(pos$4424=(endpos$4478+wsa$4479));break $4447;}}}return results$4422;});(indent_tracker$4207=function(){var curr$4541;var stack$4542;var stacks$4543;(curr$4541=0);(stack$4542=[]);(stacks$4543=[stack$4542]);return function($4540$4554){var t0$4567;var rval$4628;var $index$4695;var $length$4690;var temp$4685;var acc$4680;var rval$4674;var x$4724;var $index$4747;var $length$4742;var temp$4737;var acc$4732;var other$4767;var fixity$4665;var fixity$4648;var stuff$4643;var new_indent$4590;var $4557$4591;var $4560$4584;var $4561$4585;var $4562$4586;var $4563$4587;var t0$4579;var t1$4580;var bridge$4558$4581;var bridge$4559$4582;var $4556$4574;var ph$4564;var token$4565;(t0$4567=$4540$4554);(token$4565=t0$4567);(ph$4564=t0$4567);($4556$4574=ph$4564);if((($4560$4584=($4556$4574 instanceof Array))&&(((t0$4579=$4556$4574.length)),((t0$4579===2)&&($4556$4574[0]==="INDENT"))))){(t1$4580=$4556$4574[1]);(new_indent$4590=t1$4580);($4557$4591=t1$4580);$4557$4591;if((curr$4541===false)){(curr$4541=new_indent$4590);return [$5832(["OP","IFX",","],({"wsb":true,"wsa":true}))];}else{if(($4557$4591>curr$4541)){stack$4542.push(curr$4541);(curr$4541=new_indent$4590);return [$5832(["OP","PFX","["],({"wsb":true,"wsa":true}))];}else{if(($4557$4591===curr$4541)){return [$5832(["OP","IFX",","],({"wsb":true,"wsa":true}))];}else{if(($4557$4591<curr$4541)){(rval$4628=[]);$4632:while(((stack$4542.length>0)&&(new_indent$4590<curr$4541))){(curr$4541=stack$4542.pop());rval$4628.push($5832(["OP","SFX","]"],({"wsb":true,"wsa":true})));}rval$4628.push($5832(["OP","IFX",","],({"wsb":true,"wsa":true})));return rval$4628;}else{$5598($4557$4591,"/home/olivier/git/earl-grey/src/lex.eg",4736,4752);}}}}}else{if(($4560$4584&&((t0$4579>=1)&&($4556$4574[0]==="ID")))){(stuff$4643=Array.prototype.slice.call($4556$4574,1));return [token$4565];}else{if(($4560$4584&&(($4562$4586=(t0$4579===3))&&(($4563$4587=($4556$4574[0]==="OP"))&&((fixity$4648=$4556$4574[1]),(((bridge$4558$4581=$4556$4574[2])),((bridge$4558$4581==="[")||(bridge$4558$4581==="{")))))))){stack$4542.push(curr$4541);stacks$4543.push(stack$4542);(stack$4542=[]);(curr$4541=false);return [token$4565];}else{if(($4563$4587&&((fixity$4665=$4556$4574[1]),(((bridge$4559$4582=$4556$4574[2])),((bridge$4559$4582==="]")||(bridge$4559$4582==="}")))))){(rval$4674=(((acc$4680=[])),(((temp$4685=stack$4542)),((($length$4690=temp$4685.length)),((($index$4695=0)),function(){$4677:for(;($index$4695<$length$4690);($index$4695++)){var m$4703;(m$4703=temp$4685[$index$4695]);m$4703;acc$4680.push($5832(["OP","SFX","]"],({"wsb":true,"wsa":true})));}}()))),acc$4680));(stack$4542=stacks$4543.pop());(curr$4541=stack$4542.pop());rval$4674.push(token$4565);return rval$4674;}else{if((((x$4724=$4556$4574)),((x$4724 instanceof Array)&&(x$4724[0]==="EOF")))){(acc$4732=[]);(temp$4737=stack$4542);($length$4742=temp$4737.length);($index$4747=0);$4729:for(;($index$4747<$length$4742);($index$4747++)){var m$4755;(m$4755=temp$4737[$index$4747]);m$4755;acc$4732.push($5832(["OP","SFX","]"],({"wsb":true,"wsa":true})));}return acc$4732;}else{(other$4767=$4556$4574);return [token$4565];}}}}}};});(process_indent$4208=function(stream$4773){var $index$4798;var $length$4793;var temp$4788;var tracker$4776;var results$4777;(tracker$4776=indent_tracker$4207());(results$4777=[]);(temp$4788=stream$4773);($length$4793=temp$4788.length);($index$4798=0);$4778:for(;($index$4798<$length$4793);($index$4798++)){var token$4814;var m$4806;(m$4806=temp$4788[$index$4798]);(token$4814=m$4806);(results$4777=results$4777.concat(tracker$4776(token$4814)));}return results$4777.concat(tracker$4776(["EOF"]));});(disambiguate_fixity$4209=function(stream$4820){var $index$5224;var $length$5219;var temp$5214;var __lt____lt____lt____colon__$4823;var collapse_operators$4824;var buffer$4825;var pfx$4826;var collapse$4827;var results$4828;(__lt____lt____lt____colon__$4823=function(a$4836,b$4837){(a$4836["wsb"]=b$4837.wsb);(a$4836["wsa"]=b$4837.wsa);return __lt____lt____colon__$4201(a$4836,b$4837);});(collapse_operators$4824=function(){var msg$4936;var longer$4933;var token$4913;var fixity$4914;var name$4915;var t0$4907;var t1$4908;var t2$4909;var $4900$4902;var $index$4962;var $length$4957;var temp$4952;var acc$4947;var $index$5017;var $length$5012;var temp$5007;var acc$5002;var t0$5063;var t1$5064;var t2$5065;var t3$5066;var t0$5105;var t0$5111;var t0$5156;var t0$5162;var t1$5163;var t2$5164;var bridge$5140$5147;var $5139$5142;var t$5136;var results$5131;var $5055$5095;var $5056$5096;var $5057$5097;var bridge$5054$5092;var t0$5093;var $5053$5087;var first$5058;var fixity$5059;var name$5060;var rest$5061;var n$4882;var $4852$4877;var $4853$4878;var $4854$4879;var $4855$4880;var t0$4874;var t1$4875;var buffer$4866;var $4851$4867;var t0$4862;var $4850$4857;($4850$4857=arguments);(t0$4862=$4850$4857.length);if((t0$4862>=1)){(buffer$4866=$4850$4857[0]);($4851$4867=Array.prototype.slice.call($4850$4857,1));(n$4882=buffer$4866.length);$4851$4867;if((!buffer$4866.length)){return [];}else{(t0$4874=$4851$4867);(t1$4875=t0$4874.length);if((($4854$4879=(t1$4875===2))&&(($4855$4880=t0$4874[0])&&t0$4874[1]))){($4900$4902=buffer$4866);if((($4900$4902 instanceof Array)&&(((t0$4907=$4900$4902.length)),((t0$4907===1)&&(((t1$4908=$4900$4902[0])),((token$4913=t1$4908),((t1$4908 instanceof Array)&&(((t2$4909=t1$4908.length)),((t2$4909===3)&&(t1$4908[0]==="OP")))))))))){(fixity$4914=t1$4908[1]);(name$4915=t1$4908[2]);return [__lt____lt____lt____colon__$4823(["ID",name$4915],token$4913)];}else{(longer$4933=$4900$4902);(msg$4936="Too many consecutive operators were found here.");throw $5614(["syntax","nullary"]).create(msg$4936,({"operators":buffer$4866}));}}else{if($4855$4880){t0$4874[1];(acc$4947=[]);(temp$4952=buffer$4866);($length$4957=temp$4952.length);($index$4962=0);$4944:for(;($index$4962<$length$4957);($index$4962++)){var token$4980;var name$4981;var t0$4975;var t1$4976;var m$4970;(m$4970=temp$4952[$index$4962]);(t0$4975=m$4970);(token$4980=t0$4975);if(((t0$4975 instanceof Array)&&(((t1$4976=t0$4975.length)),((t1$4976===3)&&(t0$4975[0]==="OP"))))){t0$4975[1];(name$4981=t0$4975[2]);acc$4947.push(__lt____lt____lt____colon__$4823(["OP","PFX",name$4981],token$4980));}else{$5598(m$4970,"/home/olivier/git/earl-grey/src/lex.eg",7093,7187);}}return acc$4947;}else{if(($4854$4879&&(t0$4874[0],t0$4874[1]))){(acc$5002=[]);(temp$5007=buffer$4866);($length$5012=temp$5007.length);($index$5017=0);$4999:for(;($index$5017<$length$5012);($index$5017++)){var token$5035;var name$5036;var t0$5030;var t1$5031;var m$5025;(m$5025=temp$5007[$index$5017]);(t0$5030=m$5025);(token$5035=t0$5030);if(((t0$5030 instanceof Array)&&(((t1$5031=t0$5030.length)),((t1$5031===3)&&(t0$5030[0]==="OP"))))){t0$5030[1];(name$5036=t0$5030[2]);acc$5002.push(__lt____lt____lt____colon__$4823(["OP","SFX",name$5036],token$5035));}else{$5598(m$5025,"/home/olivier/git/earl-grey/src/lex.eg",7200,7294);}}return acc$5002;}else{$4851$4867;(t0$5063=buffer$4866);if(((t0$5063 instanceof Array)&&(((t1$5064=t0$5063.length)),((t1$5064>=1)&&(((t2$5065=t0$5063[0])),((first$5058=t2$5065),((t2$5065 instanceof Array)&&(((t3$5066=t2$5065.length)),((t3$5066===3)&&(t2$5065[0]==="OP")))))))))){(fixity$5059=t2$5065[1]);(name$5060=t2$5065[2]);(rest$5061=Array.prototype.slice.call(t0$5063,1));}else{$5598(buffer$4866,"/home/olivier/git/earl-grey/src/lex.eg",7347,7353);}($5053$5087=[first$5058.wsb,first$5058.wsa]);(bridge$5054$5092=$5053$5087);if((((bridge$5054$5092 instanceof Array)&&(((t0$5105=bridge$5054$5092.length)),((t0$5105===2)&&((!bridge$5054$5092[0])&&(!bridge$5054$5092[1])))))||((bridge$5054$5092 instanceof Array)&&(((t0$5111=bridge$5054$5092.length)),((t0$5111===2)&&(bridge$5054$5092[0]&&bridge$5054$5092[1])))))){return [__lt____lt____lt____colon__$4823(["OP","IFX",name$5060],first$5058)].concat(collapse_operators$4824(rest$5061,true,false));}else{if((($5055$5095=($5053$5087 instanceof Array))&&(((t0$5093=$5053$5087.length)),(($5057$5097=(t0$5093===2))&&$5053$5087[0])))){$5053$5087[1];return [__lt____lt____lt____colon__$4823(["OP","PFX",name$5060],first$5058)].concat(collapse_operators$4824(rest$5061,true,false));}else{if(($5057$5097&&($5053$5087[0],$5053$5087[1]))){(results$5131=collapse_operators$4824(rest$5061,false,false));(t$5136=((($5139$5142=results$5131)),(((bridge$5140$5147=$5139$5142)),function(){if((((bridge$5140$5147 instanceof Array)&&(((t0$5156=bridge$5140$5147.length)),(t0$5156===0)))||((bridge$5140$5147 instanceof Array)&&(((t0$5162=bridge$5140$5147.length)),((t0$5162>=1)&&(((t1$5163=bridge$5140$5147[0])),((t1$5163 instanceof Array)&&(((t2$5164=t1$5163.length)),((t2$5164>=2)&&((t1$5163[0]==="OP")&&((t1$5163[1]==="PFX")&&(Array.prototype.slice.call(t1$5163,2),(Array.prototype.slice.call(bridge$5140$5147,1),true))))))))))))){return ["OP","IFX",name$5060];}else{$5139$5142;return ["OP","SFX",name$5060];}}())));return [__lt____lt____lt____colon__$4823(t$5136,first$5058)].concat(results$5131);}else{$5598($5053$5087);}}}}}}}}else{$5598($4850$4857);}});(buffer$4825=[]);(pfx$4826=true);(collapse$4827=function(sfx$5198){var rval$5201;(rval$5201=collapse_operators$4824(buffer$4825,pfx$4826,sfx$5198));(buffer$4825=[]);return rval$5201;});(results$4828=[]);(temp$5214=stream$4820);($length$5219=temp$5214.length);($index$5224=0);$4829:for(;($index$5224<$length$5219);($index$5224++)){var other$5298;var name$5253;var $4832$5254;var t0$5248;var t1$5249;var token$5241;var $4831$5242;var t0$5237;var m$5232;(m$5232=temp$5214[$index$5224]);(t0$5237=m$5232);(token$5241=t0$5237);($4831$5242=t0$5237);(t0$5248=$4831$5242);if(((t0$5248 instanceof Array)&&(((t1$5249=t0$5248.length)),((t1$5249===3)&&(t0$5248[0]==="OP"))))){($4832$5254=t0$5248[1]);(name$5253=t0$5248[2]);if(($4832$5254==="?FX")){buffer$4825.push(token$5241);}else{if(($4832$5254==="IFX")){(results$4828=results$4828.concat(collapse$4827(true)));results$4828.push(token$5241);(pfx$4826=true);}else{if(($4832$5254==="PFX")){(results$4828=results$4828.concat(collapse$4827(false)));results$4828.push(token$5241);(pfx$4826=true);}else{if(($4832$5254==="SFX")){(results$4828=results$4828.concat(collapse$4827(true)));results$4828.push(token$5241);(pfx$4826=false);}else{$5598($4832$5254,"/home/olivier/git/earl-grey/src/lex.eg",8159,8164);}}}}}else{(other$5298=$4831$5242);(results$4828=results$4828.concat(collapse$4827(false)));results$4828.push(token$5241);(pfx$4826=false);}}return results$4828.concat(collapse$4827(true));});(alternate_operators$4210=function(stream$5308){var $index$5341;var $length$5336;var temp$5331;var W$5311;var last_op$5312;var results$5313;(W$5311=function(x$5320){if(x$5320){return "wide";}else{return "short";}});(last_op$5312=true);(results$5313=[]);(temp$5331=stream$5308);($length$5336=temp$5331.length);($index$5341=0);$5314:for(;($index$5341<$length$5336);($index$5341++)){var x$5372;var $5391$5394;var x$5431;var token$5438;var fixity$5379;var name$5380;var t0$5365;var t1$5366;var token$5358;var $5316$5359;var t0$5354;var m$5349;(m$5349=temp$5331[$index$5341]);(t0$5354=m$5349);(token$5358=t0$5354);($5316$5359=t0$5354);if((((x$5372=$5316$5359)),((x$5372 instanceof Array)&&(x$5372[0]==="IGNORE")))){null;}else{(t0$5365=$5316$5359);if(((t0$5365 instanceof Array)&&(((t1$5366=t0$5365.length)),((t1$5366===3)&&(t0$5365[0]==="OP"))))){(fixity$5379=t0$5365[1]);(name$5380=t0$5365[2]);if(last_op$5312){results$5313.push(["VOID"]);}($5391$5394=fixity$5379);if(($5391$5394==="IFX")){results$5313.push(__lt____lt____colon__$4201(["IFX",W$5311((token$5358.wsa||token$5358.wsb)),name$5380],token$5358));(last_op$5312=true);}else{if(($5391$5394==="PFX")){if((!last_op$5312)){results$5313.push(["IFX",W$5311(token$5358.wsb),"WHITE"],["VOID"]);}results$5313.push(__lt____lt____colon__$4201(["PFX",W$5311(token$5358.wsa),name$5380],token$5358));(last_op$5312=true);}else{if(($5391$5394==="SFX")){results$5313.push(__lt____lt____colon__$4201(["SFX",W$5311(token$5358.wsb),name$5380],token$5358),["VOID"]);(last_op$5312=false);}else{$5598($5391$5394);}}}}else{if((((x$5431=$5316$5359)),((x$5431 instanceof Array)&&(x$5431[0]==="ILLEGAL")))){throw $5614(["syntax","illegal"]).create("unknown character",({"chr":token$5358}));}else{(token$5438=$5316$5359);if((!last_op$5312)){results$5313.push(["IFX",W$5311(token$5438.wsb),"WHITE"]);}results$5313.push(token$5438);(last_op$5312=false);}}}}if(last_op$5312){results$5313.push(["VOID"]);}return results$5313;});(fill_locations$4211=function(source$5450,stream$5451){var $index$5530;var $length$5525;var temp$5520;var to_fill$5454;var start$5455;var fill$5456;(to_fill$5454=[]);(start$5455=0);(fill$5456=function(end$5468){var $index$5485;var $length$5480;var temp$5475;(temp$5475=to_fill$5454);($length$5480=temp$5475.length);($index$5485=0);$5471:for(;($index$5485<$length$5480);($index$5485++)){var token$5509;var token$5501;var m$5493;(m$5493=temp$5475[$index$5485]);(token$5501=m$5493);if(($index$5485===0)){(token$5501["location"]=Location$4200(source$5450,start$5455,end$5468));}else{(token$5509=m$5493);(token$5509["location"]=Location$4200(source$5450,end$5468,end$5468));}}(to_fill$5454=[]);});(temp$5520=stream$5451);($length$5525=temp$5520.length);($index$5530=0);$5457:for(;($index$5530<$length$5525);($index$5530++)){var other$5560;var location$5547;var t0$5543;var m$5538;(m$5538=temp$5520[$index$5530]);(t0$5543=m$5538);if(($5922(t0$5543,"location")&&((location$5547=t0$5543.location),location$5547))){fill$5456(location$5547.start);(start$5455=location$5547.end);}else{(other$5560=m$5538);to_fill$5454.push(other$5560);}}fill$5456(source$5450.text.length);return stream$5451;});(tokenize$4212=function(src$5566){var it$0$5589;var it$0$5584;var it$0$5579;var it$0$5574;var it$0$5569;(it$0$5569=src$5566);(it$0$5574=produce$4206(it$0$5569));(it$0$5579=process_indent$4208(it$0$5574));(it$0$5584=disambiguate_fixity$4209(it$0$5579));(it$0$5589=alternate_operators$4210(it$0$5584));return fill_locations$4211(src$5566,it$0$5589);});(exports["tokenize"]=tokenize$4212);
