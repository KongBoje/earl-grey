var $3518=function(type$3520){var f$3523;(f$3523=type$3520["::check"]);;if((f$3523===(void 0))){return function(value$3528){return (value$3528 instanceof type$3520);};}else{return function(value$3531){return f$3523.call(type$3520,value$3531);};}};
var $3533=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $3534=function(dest$3536,values$3537){var k$3542;(k$3542=null);$3540:for(k$3542 in values$3537){if(values$3537.hasOwnProperty(k$3542)){(dest$3536[k$3542]=values$3537[k$3542]);}}return dest$3536;};
var $3546=function($3547$3549){var ph$3553;(ph$3553=$3547$3549);;var $3551$3558;($3551$3558=ph$3553);;var bridge$3552$3563;var x$3567;(bridge$3552$3563=$3551$3558);if((((typeof(bridge$3552$3563)==="string")&&((x$3567=bridge$3552$3563),true))||((typeof(bridge$3552$3563)==="number")&&((x$3567=bridge$3552$3563),true)))){return ["value",x$3567];}else{var other$3574;(other$3574=$3551$3558);return other$3574["::serialize_ast"]();}};
var send$3358;(send$3358=function(obj$3363,$3361$3364){var ph$3368;var msg$3369;var t0$3371;(t0$3371=$3361$3364);(msg$3369=t0$3371);(ph$3368=t0$3371);;var $3366$3375;($3366$3375=ph$3368);;var bridge$3367$3380;(bridge$3367$3380=$3366$3375);if(((typeof(bridge$3367$3380)==="string")||(typeof(bridge$3367$3380)==="number"))){return obj$3363[msg$3369];}else{var other$3388;(other$3388=$3366$3375);return obj$3363["::send"](msg$3369);}});;(Array[":::project"]=function($3391$3393){var ph$3396;var value$3397;var t0$3399;(t0$3399=$3391$3393);(value$3397=t0$3399);(ph$3396=t0$3399);;var $3395$3403;($3395$3403=ph$3396);;if($3518(Array)($3395$3403)){return [true,value$3397];}else{$3395$3403;return [true,[value$3397]];}});(Array.prototype["::check"]=function(value$3417){if((value$3417 instanceof Array)){var i$3422;(i$3422=0);;$3420:for(;(i$3422<this.length);(i$3422++)){if(($3533(this,i$3422)!==$3533(value$3417,i$3422))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $3534(this.slice(0),this);});(Array.prototype[":::project"]=function(value$3433){if((value$3433 instanceof Array)){var i$3438;(i$3438=0);;$3436:for(;(i$3438<this.length);(i$3438++)){if(($3533(this,i$3438)!==$3533(value$3433,i$3438))){return [true,[value$3433]];}}return [true,value$3433.slice(this.length)];}else{return [true,[value$3433]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($3546));});(RegExp.prototype["::check"]=function($3448$3450){var ph$3453;(ph$3453=$3448$3450);;var $3452$3458;($3452$3458=ph$3453);;var value$3466;if((typeof($3452$3458)==="string")){(value$3466=$3452$3458);if(value$3466.match(this)){return true;}else{return false;}}else{var other$3471;(other$3471=$3452$3458);return false;}});(RegExp.prototype[":::project"]=function($3473$3475){var ph$3478;(ph$3478=$3473$3475);;var $3477$3483;($3477$3483=ph$3478);;var value$3491;if((typeof($3477$3483)==="string")){(value$3491=$3477$3483);var $3494$3496;($3494$3496=value$3491.match(this));;var m$3504;if(($3494$3496===null)){(m$3504=$3494$3496);return [false,null];}else{var m$3509;(m$3509=$3494$3496);return [true,m$3509];}}else{var other$3513;(other$3513=$3477$3483);return [false,null];}});(Function.prototype["::send"]=function(args$3516){return this.apply(this,args$3516);});
var $4935=function(arr$4937){var results$4941;var l$4942;(results$4941=[]);;(l$4942=arr$4937.length);;var i$4950;(i$4950=0);;$4940:for(;(i$4950<l$4942);(i$4950++)){results$4941.push([i$4950,$3533(arr$4937,i$4950)]);}return results$4941;};
var $4766=function(){var $4767$4769;($4767$4769=function(tags$4773){var it$0$4776;(it$0$4776=function(){if((!$3518($4767$4769)(this))){return Object.create($4767$4769.prototype);}else{return this;}}());;(it$0$4776["tags"]=tags$4773);return it$0$4776;});;($4767$4769.prototype["create"]=function(){var $4785$4787;($4785$4787=arguments);;var t0$4792;var message$4796;var args$4797;(t0$4792=$4785$4787.length);if((t0$4792>=0)){(message$4796=function(){if((0>=t0$4792)){return "";}else{return $4785$4787[0];}}());(args$4797=Array.prototype.slice.call($4785$4787,1));var it$0$4801;(it$0$4801=this);;var self$4806;(self$4806=this);;var e$4811;(e$4811=Error(message$4796));;(e$4811["::tags"]=it$0$4801.tags);(e$4811["args"]=args$4797);var temp$4819;(temp$4819=$4935(args$4797));;var $length$4824;($length$4824=temp$4819.length);;var $index$4829;($index$4829=0);;$4812:for(;($index$4829<$length$4824);($index$4829++)){var m$4837;(m$4837=temp$4819[$index$4829]);;var t0$4842;var t1$4843;var i$4847;var arg$4848;(t0$4842=m$4837);if(((t0$4842 instanceof Array)&&((t1$4843=t0$4842.length),(t1$4843===2)))){(i$4847=t0$4842[0]);(arg$4848=t0$4842[1]);(e$4811[i$4847]=arg$4848);}else{$4753(m$4837);;}}(e$4811["length"]=args$4797.length);(e$4811["name"]=["E"].concat(it$0$4801.tags).join("."));return e$4811;}else{$4753($4785$4787);}});($4767$4769.prototype["::check"]=function(e$4859){var it$0$4862;(it$0$4862=this);;var self$4867;(self$4867=this);;var tags$4872;if(((!e$4859)||(!$3518(Error)(e$4859)))){return false;}(tags$4872=(e$4859["::tags"]||[]));;var temp$4881;(temp$4881=it$0$4862.tags);;var $length$4886;($length$4886=temp$4881.length);;var $index$4891;($index$4891=0);;$4873:for(;($index$4891<$length$4886);($index$4891++)){var m$4899;(m$4899=temp$4881[$index$4891]);;var tag$4907;(tag$4907=m$4899);if((tags$4872.indexOf(tag$4907)===-1)){return false;}else{false;;}}return true;});($4767$4769.prototype["::deconstruct"]=function(e$4915){var it$0$4918;(it$0$4918=this);;var self$4923;(self$4923=this);;return e$4915.args;});$3534($4767$4769,$3534(function(){var accum$4928;(accum$4928=({}));(accum$4928["::name"]="$4767");return accum$4928;}(),function(){var accum$4932;(accum$4932=({}));(accum$4932["::egclass"]=true);return accum$4932;}()));return $4767$4769;}();
var $4753=function(value$4755,url$4756,start$4757,end$4758){var err$4761;(err$4761=$4766(["match"]).create("Could not find a match for value",({"value":value$4755})));;if(url$4756){(err$4761["location"]=["location",url$4756,start$4757,end$4758]);}throw err$4761;};
var $5029=function($5030$5032,key$5033){var ph$5037;(ph$5037=$5030$5032);;var $5035$5042;($5035$5042=ph$5037);;var bridge$5036$5047;(bridge$5036$5047=$5035$5042);if(((bridge$5036$5047===null)||(bridge$5036$5047===(void 0)))){return false;}else{var x$5055;if((typeof($5035$5042)==="string")){(x$5055=$5035$5042);return (key$5033 in String.prototype);}else{var x$5060;if((typeof($5035$5042)==="number")){(x$5060=$5035$5042);return (key$5033 in Number.prototype);}else{var x$5065;(x$5065=$5035$5042);return (key$5033 in x$5065);}}}};
var $4973=function($4974$4976){var ph$4982;var x$4983;var t0$4985;(t0$4985=$4974$4976);(x$4983=t0$4985);(ph$4982=t0$4985);;var $4978$4989;($4978$4989=ph$4982);;var bridge$4979$4994;(bridge$4979$4994=$4978$4989);if((function(){var bridge$4980$5000;(bridge$4980$5000=bridge$4979$4994);return (function(){var bridge$4981$5003;(bridge$4981$5003=bridge$4980$5000);return ((bridge$4981$5003===(void 0))||(bridge$4981$5003===null));}()||(typeof(bridge$4980$5000)==="string"));}()||(typeof(bridge$4979$4994)==="number"))){return x$4983;}else{if($5029($4978$4989,"::clone")){$4978$4989["::clone"];return x$4983["::clone"]();}else{$4978$4989;if((Object.getPrototypeOf(x$4983)===Object.prototype)){var dest$5016;(dest$5016=({}));;var k$5021;(k$5021=null);$5015:for(k$5021 in x$4983){if(Object.prototype.hasOwnProperty.call(x$4983,k$5021)){(dest$5016[k$5021]=x$4983[k$5021]);}}return dest$5016;}else{var other$5027;(other$5027=$4978$4989);throw $4766(["clone"]).create("Object cannot be cloned",({"obj":x$4983}));}}}};
var $4957=function(a$4959,b$4960){var dest$4964;(dest$4964=$4973(a$4959));;var k$4969;(k$4969=null);$4963:for(k$4969 in b$4960){if(Object.prototype.hasOwnProperty.call(b$4960,k$4969)){(dest$4964[k$4969]=b$4960[k$4969]);}}return dest$4964;};var id$3608;var id_f$3609;var numr$3610;var numr_f$3611;var num$3612;var num_f$3613;var str$3614;var str_f$3615;var op$3616;var op2$3617;var op3$3618;var op4$3619;var op_f$3620;var indent$3621;var indent_f$3622;var cmnt$3623;var cmnt_f$3624;var unkn$3625;var unkn_f$3626;var $3578$3579;var Location$3580;var __lt____lt____colon__$3581;var special_ops$3582;var regexps$3583;var ws_re$3584;var eol_re$3585;var produce$3586;var indent_tracker$3587;var process_indent$3588;var disambiguate_fixity$3589;var alternate_operators$3590;var fill_locations$3591;var tokenize$3592;($3578$3579=require("./location"));;(Location$3580=$3578$3579.Location);;(__lt____lt____colon__$3581=$3578$3579["<<:"]);;(special_ops$3582=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",".":"PFX","'":"PFX","not":"PFX"}));;(regexps$3583=(((id$3608=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))",""))),((id_f$3609=function(m$3633){return ["ID",m$3633[0]];})),((numr$3610=RegExp("(?:^((?:\\d+))[rR]((?:[A-Za-z0-9_]+))(?:(?:\\.((?:[A-Za-z0-9_]+)))?))",""))),((numr_f$3611=function(m$3642){var t0$3650;var t1$3651;var radix$3645;var intp$3646;var frac$3647;var value$3648;(t0$3650=m$3642);if(((t0$3650 instanceof Array)&&((t1$3651=t0$3650.length),(t1$3651===4)))){t0$3650[0];(radix$3645=t0$3650[1]);(intp$3646=t0$3650[2]);(frac$3647=t0$3650[3]);;}else{$4753(m$3642,"/home/olivier/git/earl-grey/src/lex.eg",993,994);}(value$3648=parseInt(intp$3646.replace(RegExp("_","g"),""),radix$3645));;if(frac$3647){(frac$3647=frac$3647.replace(RegExp("_","g"),""));(value$3648=(value$3648+(parseInt(frac$3647,radix$3645)/Math.pow(radix$3645,frac$3647.length))));}return ["ID","NUM",value$3648];})),((num$3612=RegExp("(?:^((?:[0-9_]+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:[0-9_]+)))?))",""))),((num_f$3613=function(m$3667){return ["NUM",parseFloat(m$3667[0].replace(RegExp("_","g"),""))];})),((str$3614=RegExp("(?:^\"((?:(?:(?:\\\\\\\\|\\\\\")|[^\"])*))\")",""))),((str_f$3615=function(m$3676){var repl$3679;var r$3680;(repl$3679=({"\\\"":"\"","\\\\":"\\","\\n":"\n"}));;(r$3680=m$3676[1].replace(RegExp("((?:(?:\\\\\"|\\\\\\\\)|\\\\n))","g"),function(m$3687){return $3533(repl$3679,m$3687);}));;return ["STR",r$3680];})),((op$3616=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!@#.:']+))",""))),((op2$3617=RegExp("(?:^[\\[\\{\\}\\],])",""))),((op3$3618=RegExp("(?:^(?:(?:(?:(?:(?:(?:(?:(?:(?:with|where)|when)|and)|not)|or)|in)|mod)|each)|as)(?:(?:[+\\-*/~\\^<>=%&|?!@#.:']+)|\\b))",""))),((op4$3619=RegExp("(?:^`((?:[A-Za-z0-9_]+))`)",""))),((op_f$3620=function(m$3706,column$3707){var fixity$3733;var otherwise$3739;var $3711$3723;var $3710$3717;var op$3712;(op$3712=(m$3706[1]||m$3706[0]));;($3710$3717=null);;$3710$3717;if((op$3712==="|")){return ["INDENT",(column$3707-1)];}else{if((op$3712 in special_ops$3582)){(fixity$3733=$3533(special_ops$3582,op$3712));;return ["OP",fixity$3733,op$3712];}else{(otherwise$3739=$3710$3717);return ["OP","?FX",op$3712];}}})),((indent$3621=RegExp("(?:^(?:(?:\n \\*;(?:[^\n]*))*)(?:(?:\n((?: *)))+))",""))),((indent_f$3622=function(m$3748){var ilen$3751;(ilen$3751=m$3748[1].length);;return ["INDENT",ilen$3751];})),((cmnt$3623=RegExp("(?:^;(?:[^\n]*))",""))),((cmnt_f$3624=function(m$3762){return ["IGNORE"];})),((unkn$3625=RegExp("(?:^.)",""))),((unkn_f$3626=function(m$3771){return ["ILLEGAL",m$3771[0]];})),[[op3$3618,op_f$3620],[id$3608,id_f$3609],[numr$3610,numr_f$3611],[num$3612,num_f$3613],[str$3614,str_f$3615],[op$3616,op_f$3620],[op2$3617,op_f$3620],[op4$3619,op_f$3620],[indent$3621,indent_f$3622],[cmnt$3623,cmnt_f$3624],[unkn$3625,unkn_f$3626]]));;(ws_re$3584=RegExp("(?:^(?: *)(?:(?:\n(?: *)\\\\(?: *))*))",""));;(eol_re$3585=RegExp("(?:^(?: *)(?:\n|$))",""));;(produce$3586=function(src$3784){var text$3787;var results$3788;var wsb$3789;var pos$3790;var column$3791;(text$3787=src$3784.text);;(results$3788=[]);;(wsb$3789=text$3787.match(ws_re$3584)[0].length);;(text$3787=text$3787.slice(wsb$3789));(pos$3790=wsb$3789);;(column$3791=0);;$3807:while(text$3787){var i$3812;(i$3812=0);;$3810:for(;(i$3812<regexps$3583.length);(++i$3812)){var t0$3824;var t1$3825;var splits$3848;var skip$3834;var endpos$3835;var wsa$3836;var eol$3837;var bwsb$3838;var bwsa$3839;var token$3840;var re$3820;var fn$3821;var m$3822;(t0$3824=$3533(regexps$3583,i$3812));if(((t0$3824 instanceof Array)&&((t1$3825=t0$3824.length),(t1$3825===2)))){(re$3820=t0$3824[0]);(fn$3821=t0$3824[1]);;}else{$4753($3533(regexps$3583,i$3812),"/home/olivier/git/earl-grey/src/lex.eg",3333,3353);}(m$3822=text$3787.match(re$3820));;if(m$3822){(skip$3834=m$3822[0].length);;(endpos$3835=(pos$3790+skip$3834));;(column$3791=(((splits$3848=m$3822[0].split("\n"))),function(){if((splits$3848.length>1)){return $3533(splits$3848,(splits$3848.length-1)).length;}else{return (column$3791+skip$3834);}}()));(text$3787=text$3787.slice(skip$3834));(wsa$3836=text$3787.match(ws_re$3584)[0].length);;(eol$3837=(text$3787.match(eol_re$3585)&&true));;(bwsb$3838=(wsb$3789>0));;(bwsa$3839=function(){if(eol$3837){return bwsb$3838;}else{return (wsa$3836>0);}}());;(token$3840=fn$3821(m$3822,column$3791));;(token$3840["wsb"]=bwsb$3838);(token$3840["wsa"]=bwsa$3839);(token$3840["location"]=Location$3580(src$3784,pos$3790,endpos$3835));results$3788.push(token$3840);(text$3787=text$3787.slice(wsa$3836));(column$3791=(column$3791+wsa$3836));(wsb$3789=wsa$3836);(pos$3790=(endpos$3835+wsa$3836));break $3810;}}}return results$3788;});;(indent_tracker$3587=function(){var curr$3874;var stack$3875;var stacks$3876;(curr$3874=0);;(stack$3875=[]);;(stacks$3876=[stack$3875]);;return function($3873$3887){var t0$3900;var rval$3946;var $index$3998;var $length$3993;var temp$3988;var acc$3983;var rval$3977;var x$4020;var $index$4043;var $length$4038;var temp$4033;var acc$4028;var other$4062;var fixity$3971;var fixity$3963;var stuff$3958;var new_indent$3920;var $3890$3921;var $3893$3914;var $3894$3915;var $3895$3916;var $3896$3917;var t0$3909;var t1$3910;var bridge$3891$3911;var bridge$3892$3912;var $3889$3904;var ph$3897;var token$3898;(t0$3900=$3873$3887);(token$3898=t0$3900);(ph$3897=t0$3900);;($3889$3904=ph$3897);;if((($3893$3914=($3889$3904 instanceof Array))&&((t0$3909=$3889$3904.length),((t0$3909===2)&&($3889$3904[0]==="INDENT"))))){(t1$3910=$3889$3904[1]);(new_indent$3920=t1$3910);($3890$3921=t1$3910);$3890$3921;if((curr$3874===false)){(curr$3874=new_indent$3920);return [$4957(["OP","IFX",","],({"wsb":true,"wsa":true}))];}else{if(($3890$3921>curr$3874)){$3533(stack$3875.push(curr$3874),(curr$3874=new_indent$3920));return [$4957(["OP","PFX","["],({"wsb":true,"wsa":true}))];}else{if(($3890$3921===curr$3874)){return [$4957(["OP","IFX",","],({"wsb":true,"wsa":true}))];}else{if(($3890$3921<curr$3874)){(rval$3946=[]);;$3950:while(((stack$3875.length>0)&&(new_indent$3920<curr$3874))){(curr$3874=stack$3875.pop());rval$3946.push($4957(["OP","SFX","]"],({"wsb":true,"wsa":true})));}rval$3946.push($4957(["OP","IFX",","],({"wsb":true,"wsa":true})));return rval$3946;}else{$4753($3890$3921,"/home/olivier/git/earl-grey/src/lex.eg",4686,4702);}}}}}else{if(($3893$3914&&((t0$3909>=1)&&($3889$3904[0]==="ID")))){(stuff$3958=Array.prototype.slice.call($3889$3904,1));return [token$3898];}else{if(($3893$3914&&(($3895$3916=(t0$3909===3))&&(($3896$3917=($3889$3904[0]==="OP"))&&((fixity$3963=$3889$3904[1]),((bridge$3891$3911=$3889$3904[2]),((bridge$3891$3911==="[")||(bridge$3891$3911==="{")))))))){stack$3875.push(curr$3874);stacks$3876.push(stack$3875);(stack$3875=[]);(curr$3874=false);return [token$3898];}else{if(($3896$3917&&((fixity$3971=$3889$3904[1]),((bridge$3892$3912=$3889$3904[2]),((bridge$3892$3912==="]")||(bridge$3892$3912==="}")))))){(rval$3977=(((acc$3983=[])),(((temp$3988=stack$3875)),((($length$3993=temp$3988.length)),((($index$3998=0)),function(){$3980:for(;($index$3998<$length$3993);($index$3998++)){var m$4006;(m$4006=temp$3988[$index$3998]);;m$4006;acc$3983.push($4957(["OP","SFX","]"],({"wsb":true,"wsa":true})));}}()))),acc$3983));;(stack$3875=stacks$3876.pop());(curr$3874=stack$3875.pop());rval$3977.push(token$3898);return rval$3977;}else{if((((x$4020=$3889$3904)),((x$4020 instanceof Array)&&(x$4020[0]==="EOF")))){(acc$4028=[]);;(temp$4033=stack$3875);;($length$4038=temp$4033.length);;($index$4043=0);;$4025:for(;($index$4043<$length$4038);($index$4043++)){var m$4051;(m$4051=temp$4033[$index$4043]);;m$4051;acc$4028.push($4957(["OP","SFX","]"],({"wsb":true,"wsa":true})));}return acc$4028;}else{(other$4062=$3889$3904);return [token$3898];}}}}}};});;(process_indent$3588=function(stream$4068){var $index$4093;var $length$4088;var temp$4083;var tracker$4071;var results$4072;(tracker$4071=indent_tracker$3587());;(results$4072=[]);;(temp$4083=stream$4068);;($length$4088=temp$4083.length);;($index$4093=0);;$4073:for(;($index$4093<$length$4088);($index$4093++)){var token$4109;var m$4101;(m$4101=temp$4083[$index$4093]);;(token$4109=m$4101);(results$4072=results$4072.concat(tracker$4071(token$4109)));}return results$4072.concat(tracker$4071(["EOF"]));});;(disambiguate_fixity$3589=function(stream$4115){var $index$4439;var $length$4434;var temp$4429;var __lt____lt____lt____colon__$4118;var collapse_operators$4119;var buffer$4120;var pfx$4121;var collapse$4122;var results$4123;(__lt____lt____lt____colon__$4118=function(a$4131,b$4132){(a$4131["wsb"]=b$4132.wsb);(a$4131["wsa"]=b$4132.wsa);return __lt____lt____colon__$3581(a$4131,b$4132);});;(collapse_operators$4119=function(){var msg$4207;var longer$4204;var token$4193;var fixity$4194;var name$4195;var t0$4187;var t1$4188;var t2$4189;var $4180$4182;var $index$4233;var $length$4228;var temp$4223;var acc$4218;var $index$4281;var $length$4276;var temp$4271;var acc$4266;var t0$4320;var t1$4321;var t2$4322;var t3$4323;var t0$4347;var t0$4350;var t0$4386;var t0$4389;var t1$4390;var t2$4391;var bridge$4373$4380;var $4372$4375;var t$4369;var results$4364;var $4312$4340;var $4313$4341;var $4314$4342;var bridge$4311$4337;var t0$4338;var $4310$4332;var first$4315;var fixity$4316;var name$4317;var rest$4318;var n$4168;var $4141$4163;var $4142$4164;var $4143$4165;var $4144$4166;var t0$4160;var t1$4161;var buffer$4155;var $4140$4156;var t0$4151;var $4139$4146;($4139$4146=arguments);;(t0$4151=$4139$4146.length);if((t0$4151>=1)){(buffer$4155=$4139$4146[0]);($4140$4156=Array.prototype.slice.call($4139$4146,1));(n$4168=buffer$4155.length);;$4140$4156;if((!buffer$4155.length)){return [];}else{(t0$4160=$4140$4156);(t1$4161=t0$4160.length);if((($4143$4165=(t1$4161===2))&&(($4144$4166=t0$4160[0])&&t0$4160[1]))){($4180$4182=buffer$4155);;if((($4180$4182 instanceof Array)&&((t0$4187=$4180$4182.length),((t0$4187===1)&&((t1$4188=$4180$4182[0]),((token$4193=t1$4188),((t1$4188 instanceof Array)&&((t2$4189=t1$4188.length),((t2$4189===3)&&(t1$4188[0]==="OP")))))))))){(fixity$4194=t1$4188[1]);(name$4195=t1$4188[2]);return [__lt____lt____lt____colon__$4118(["ID",name$4195],token$4193)];}else{(longer$4204=$4180$4182);(msg$4207="Too many consecutive operators were found here.");;throw $4766(["syntax","nullary"]).create(msg$4207,({"operators":buffer$4155}));}}else{if($4144$4166){t0$4160[1];(acc$4218=[]);;(temp$4223=buffer$4155);;($length$4228=temp$4223.length);;($index$4233=0);;$4215:for(;($index$4233<$length$4228);($index$4233++)){var token$4251;var name$4252;var t0$4246;var t1$4247;var m$4241;(m$4241=temp$4223[$index$4233]);;(t0$4246=m$4241);(token$4251=t0$4246);if(((t0$4246 instanceof Array)&&((t1$4247=t0$4246.length),((t1$4247===3)&&(t0$4246[0]==="OP"))))){t0$4246[1];(name$4252=t0$4246[2]);acc$4218.push(__lt____lt____lt____colon__$4118(["OP","PFX",name$4252],token$4251));}else{$4753(m$4241,"/home/olivier/git/earl-grey/src/lex.eg",7025,7119);;}}return acc$4218;}else{if(($4143$4165&&(t0$4160[0],t0$4160[1]))){(acc$4266=[]);;(temp$4271=buffer$4155);;($length$4276=temp$4271.length);;($index$4281=0);;$4263:for(;($index$4281<$length$4276);($index$4281++)){var token$4299;var name$4300;var t0$4294;var t1$4295;var m$4289;(m$4289=temp$4271[$index$4281]);;(t0$4294=m$4289);(token$4299=t0$4294);if(((t0$4294 instanceof Array)&&((t1$4295=t0$4294.length),((t1$4295===3)&&(t0$4294[0]==="OP"))))){t0$4294[1];(name$4300=t0$4294[2]);acc$4266.push(__lt____lt____lt____colon__$4118(["OP","SFX",name$4300],token$4299));}else{$4753(m$4289,"/home/olivier/git/earl-grey/src/lex.eg",7132,7226);;}}return acc$4266;}else{$4140$4156;(t0$4320=buffer$4155);if(((t0$4320 instanceof Array)&&((t1$4321=t0$4320.length),((t1$4321>=1)&&((t2$4322=t0$4320[0]),((first$4315=t2$4322),((t2$4322 instanceof Array)&&((t3$4323=t2$4322.length),((t3$4323===3)&&(t2$4322[0]==="OP")))))))))){(fixity$4316=t2$4322[1]);(name$4317=t2$4322[2]);(rest$4318=Array.prototype.slice.call(t0$4320,1));;}else{$4753(buffer$4155,"/home/olivier/git/earl-grey/src/lex.eg",7279,7285);}($4310$4332=[first$4315.wsb,first$4315.wsa]);;(bridge$4311$4337=$4310$4332);if((((bridge$4311$4337 instanceof Array)&&((t0$4347=bridge$4311$4337.length),((t0$4347===2)&&((!bridge$4311$4337[0])&&(!bridge$4311$4337[1])))))||((bridge$4311$4337 instanceof Array)&&((t0$4350=bridge$4311$4337.length),((t0$4350===2)&&(bridge$4311$4337[0]&&bridge$4311$4337[1])))))){return [__lt____lt____lt____colon__$4118(["OP","IFX",name$4317],first$4315)].concat(collapse_operators$4119(rest$4318,true,false));}else{if((($4312$4340=($4310$4332 instanceof Array))&&((t0$4338=$4310$4332.length),(($4314$4342=(t0$4338===2))&&$4310$4332[0])))){$4310$4332[1];return [__lt____lt____lt____colon__$4118(["OP","PFX",name$4317],first$4315)].concat(collapse_operators$4119(rest$4318,true,false));}else{if(($4314$4342&&($4310$4332[0],$4310$4332[1]))){(results$4364=collapse_operators$4119(rest$4318,false,false));;(t$4369=((($4372$4375=results$4364)),((bridge$4373$4380=$4372$4375),function(){if((((bridge$4373$4380 instanceof Array)&&((t0$4386=bridge$4373$4380.length),(t0$4386===0)))||((bridge$4373$4380 instanceof Array)&&((t0$4389=bridge$4373$4380.length),((t0$4389>=1)&&((t1$4390=bridge$4373$4380[0]),((t1$4390 instanceof Array)&&((t2$4391=t1$4390.length),((t2$4391>=2)&&((t1$4390[0]==="OP")&&((t1$4390[1]==="PFX")&&(Array.prototype.slice.call(t1$4390,2),(Array.prototype.slice.call(bridge$4373$4380,1),true))))))))))))){return ["OP","IFX",name$4317];}else{$4372$4375;return ["OP","SFX",name$4317];}}())));;return [__lt____lt____lt____colon__$4118(t$4369,first$4315)].concat(results$4364);}else{$4753($4310$4332);}}}}}}}}else{$4753($4139$4146);}});;(buffer$4120=[]);;(pfx$4121=true);;(collapse$4122=function(sfx$4416){var rval$4419;(rval$4419=collapse_operators$4119(buffer$4120,pfx$4121,sfx$4416));;(buffer$4120=[]);return rval$4419;});;(results$4123=[]);;(temp$4429=stream$4115);;($length$4434=temp$4429.length);;($index$4439=0);;$4124:for(;($index$4439<$length$4434);($index$4439++)){var other$4495;var name$4465;var $4127$4466;var t0$4460;var t1$4461;var token$4456;var $4126$4457;var t0$4452;var m$4447;(m$4447=temp$4429[$index$4439]);;(t0$4452=m$4447);(token$4456=t0$4452);($4126$4457=t0$4452);(t0$4460=$4126$4457);if(((t0$4460 instanceof Array)&&((t1$4461=t0$4460.length),((t1$4461===3)&&(t0$4460[0]==="OP"))))){($4127$4466=t0$4460[1]);(name$4465=t0$4460[2]);if(($4127$4466==="?FX")){buffer$4120.push(token$4456);}else{if(($4127$4466==="IFX")){(results$4123=results$4123.concat(collapse$4122(true)));results$4123.push(token$4456);(pfx$4121=true);}else{if(($4127$4466==="PFX")){(results$4123=results$4123.concat(collapse$4122(false)));results$4123.push(token$4456);(pfx$4121=true);}else{if(($4127$4466==="SFX")){(results$4123=results$4123.concat(collapse$4122(true)));results$4123.push(token$4456);(pfx$4121=false);}else{$4753($4127$4466,"/home/olivier/git/earl-grey/src/lex.eg",8080,8085);;}}}}}else{(other$4495=$4126$4457);(results$4123=results$4123.concat(collapse$4122(false)));results$4123.push(token$4456);(pfx$4121=false);}}return results$4123.concat(collapse$4122(true));});;(alternate_operators$3590=function(stream$4502){var $index$4535;var $length$4530;var temp$4525;var W$4505;var last_op$4506;var results$4507;(W$4505=function(x$4514){if(x$4514){return "wide";}else{return "short";}});;(last_op$4506=true);;(results$4507=[]);;(temp$4525=stream$4502);;($length$4530=temp$4525.length);;($index$4535=0);;$4508:for(;($index$4535<$length$4530);($index$4535++)){var x$4563;var $4576$4579;var x$4607;var token$4614;var fixity$4570;var name$4571;var t0$4556;var t1$4557;var token$4552;var $4510$4553;var t0$4548;var m$4543;(m$4543=temp$4525[$index$4535]);;(t0$4548=m$4543);(token$4552=t0$4548);($4510$4553=t0$4548);if((((x$4563=$4510$4553)),((x$4563 instanceof Array)&&(x$4563[0]==="IGNORE")))){null;}else{(t0$4556=$4510$4553);if(((t0$4556 instanceof Array)&&((t1$4557=t0$4556.length),((t1$4557===3)&&(t0$4556[0]==="OP"))))){(fixity$4570=t0$4556[1]);(name$4571=t0$4556[2]);if(last_op$4506){results$4507.push(["VOID"]);}($4576$4579=fixity$4570);;if(($4576$4579==="IFX")){results$4507.push(__lt____lt____colon__$3581(["IFX",W$4505((token$4552.wsa||token$4552.wsb)),name$4571],token$4552));(last_op$4506=true);}else{if(($4576$4579==="PFX")){if((!last_op$4506)){results$4507.push(["IFX",W$4505(token$4552.wsb),"WHITE"],["VOID"]);}results$4507.push(__lt____lt____colon__$3581(["PFX",W$4505(token$4552.wsa),name$4571],token$4552));(last_op$4506=true);}else{if(($4576$4579==="SFX")){results$4507.push(__lt____lt____colon__$3581(["SFX",W$4505(token$4552.wsb),name$4571],token$4552),["VOID"]);(last_op$4506=false);}else{$4753($4576$4579);;}}}}else{if((((x$4607=$4510$4553)),((x$4607 instanceof Array)&&(x$4607[0]==="ILLEGAL")))){throw $4766(["syntax","illegal"]).create("unknown character",({"chr":token$4552}));}else{(token$4614=$4510$4553);if((!last_op$4506)){results$4507.push(["IFX",W$4505(token$4614.wsb),"WHITE"]);}results$4507.push(token$4614);(last_op$4506=false);}}}}if(last_op$4506){results$4507.push(["VOID"]);}return results$4507;});;(fill_locations$3591=function(source$4623,stream$4624){var $index$4694;var $length$4689;var temp$4684;var to_fill$4627;var start$4628;var fill$4629;(to_fill$4627=[]);;(start$4628=0);;(fill$4629=function(end$4641){var $index$4658;var $length$4653;var temp$4648;(temp$4648=to_fill$4627);;($length$4653=temp$4648.length);;($index$4658=0);;$4644:for(;($index$4658<$length$4653);($index$4658++)){var token$4679;var token$4674;var m$4666;(m$4666=temp$4648[$index$4658]);;(token$4674=m$4666);if(($index$4658===0)){(token$4674["location"]=Location$3580(source$4623,start$4628,end$4641));}else{(token$4679=m$4666);(token$4679["location"]=Location$3580(source$4623,end$4641,end$4641));}}return (to_fill$4627=[]);});;(temp$4684=stream$4624);;($length$4689=temp$4684.length);;($index$4694=0);;$4630:for(;($index$4694<$length$4689);($index$4694++)){var other$4718;var location$4711;var t0$4707;var m$4702;(m$4702=temp$4684[$index$4694]);;(t0$4707=m$4702);if(($5029(t0$4707,"location")&&((location$4711=t0$4707.location),location$4711))){fill$4629(location$4711.start);(start$4628=location$4711.end);}else{(other$4718=m$4702);to_fill$4627.push(other$4718);}}fill$4629(source$4623.text.length);return stream$4624;});;(tokenize$3592=function(src$4724){var it$0$4747;var it$0$4742;var it$0$4737;var it$0$4732;var it$0$4727;(it$0$4727=src$4724);;(it$0$4732=produce$3586(it$0$4727));;(it$0$4737=process_indent$3588(it$0$4732));;(it$0$4742=disambiguate_fixity$3589(it$0$4737));;(it$0$4747=alternate_operators$3590(it$0$4742));;return fill_locations$3591(src$4724,it$0$4747);});;(exports["tokenize"]=tokenize$3592);
