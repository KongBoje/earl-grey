var $2363=function(type$2365){var f$2368;(f$2368=type$2365["::check"]);;if((f$2368===(void 0))){return function(value$2373){return (value$2373 instanceof type$2365);};}else{return function(value$2376){return f$2368.call(type$2365,value$2376);};}};
var $2378=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $2379=function(temp$2380$2382){var ph$2386;(ph$2386=temp$2380$2382);;var m$2384$2391;(m$2384$2391=ph$2386);;var bridge$2385$2396;var x$2400;(bridge$2385$2396=m$2384$2391);if((((typeof(bridge$2385$2396)==="string")&&((x$2400=bridge$2385$2396),true))||((typeof(bridge$2385$2396)==="number")&&((x$2400=bridge$2385$2396),true)))){return ["value",x$2400];}else{var other$2407;(other$2407=m$2384$2391);return other$2407["::serialize_ast"]();}};
var send$2226;(send$2226=function(obj$2231,temp$2229$2232){var ph$2236;var msg$2237;var t0$2239;(t0$2239=temp$2229$2232);(msg$2237=t0$2239);(ph$2236=t0$2239);;var m$2234$2243;(m$2234$2243=ph$2236);;var bridge$2235$2248;(bridge$2235$2248=m$2234$2243);if(((typeof(bridge$2235$2248)==="string")||(typeof(bridge$2235$2248)==="number"))){return obj$2231[msg$2237];}else{var other$2256;(other$2256=m$2234$2243);return obj$2231["::send"](msg$2237);}});;(Array[":::project"]=function(temp$2259$2261){var ph$2264;var value$2265;var t0$2267;(t0$2267=temp$2259$2261);(value$2265=t0$2267);(ph$2264=t0$2267);;var m$2263$2271;(m$2263$2271=ph$2264);;if($2363(Array)(m$2263$2271)){return [true,value$2265];}else{m$2263$2271;return [true,[value$2265]];}});(Array.prototype["::check"]=function(value$2285){if((value$2285 instanceof Array)){var i$2290;(i$2290=0);;$2288:for(;(i$2290<this.length);(i$2290++)){if(($2378(this,i$2290)!==$2378(value$2285,i$2290))){return false;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value$2299){if((value$2299 instanceof Array)){var i$2304;(i$2304=0);;$2302:for(;(i$2304<this.length);(i$2304++)){if(($2378(this,i$2304)!==$2378(value$2299,i$2304))){return [true,[value$2299]];}}return [true,value$2299.slice(this.length)];}else{return [true,[value$2299]];}});(Array.prototype[":::deconstruct"]=function(value$2313){return [true,value$2313.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($2379));});(RegExp.prototype["::check"]=function(value$2318){return value$2318.match(this);});(RegExp.prototype[":::project"]=function(value$2321){var m$2323$2325;(m$2323$2325=value$2321.match(this));;var m$2333;if((m$2323$2325===null)){(m$2333=m$2323$2325);return [false,null];}else{var m$2338;(m$2338=m$2323$2325);return [true,m$2338];}});(RegExp.prototype[":::deconstruct"]=function(value$2341){var m$2343$2345;(m$2343$2345=value$2341.match(this));;var m$2353;if((m$2343$2345===null)){(m$2353=m$2343$2345);return [false,null];}else{var m$2358;(m$2358=m$2343$2345);return [true,m$2358];}});(Function.prototype["::send"]=function(args$2361){return this.apply(this,args$2361);});
var $3181=function(dest$3183,values$3184){var k$3189;(k$3189=null);$3187:for(k$3189 in values$3184){if(values$3184.hasOwnProperty(k$3189)){(dest$3183[k$3189]=values$3184[k$3189]);}}return dest$3183;};
var $3075=function(){var $3076$3078;($3076$3078=function(tags$3082){var it$0$3085;(it$0$3085=function(){if((!$2363($3076$3078)(this))){return Object.create($3076$3078.prototype);}else{return this;}}());;(it$0$3085["tags"]=tags$3082);return it$0$3085;});;($3076$3078.prototype["create"]=function(){var m$3094$3096;(m$3094$3096=arguments);;var t0$3101;var message$3105;var args$3106;(t0$3101=m$3094$3096.length);if((t0$3101>=0)){(message$3105=function(){if((0>=t0$3101)){return "";}else{return m$3094$3096[0];}}());(args$3106=Array.prototype.slice.call(m$3094$3096,1));var it$0$3110;(it$0$3110=this);;var e$3115;(e$3115=Error(message$3105));;(e$3115["::tags"]=it$0$3110.tags);(e$3115["args"]=args$3106);(e$3115["name"]=["E"].concat(it$0$3110.tags).join("."));return e$3115;}else{throw Error("mismatch!!");}});($3076$3078.prototype["::check"]=function(e$3124){var it$0$3127;(it$0$3127=this);;var tags$3132;if(((!e$3124)||(!$2363(Error)(e$3124)))){return false;}(tags$3132=(e$3124["::tags"]||[]));;var temp$3140;(temp$3140=it$0$3127.tags);;var len$3145;(len$3145=temp$3140.length);;var i$3150;(i$3150=0);;$3137:for(;(i$3150<len$3145);(i$3150++)){var m$3158;(m$3158=temp$3140[i$3150]);;var tag$3166;(tag$3166=m$3158);if((tags$3132.indexOf(tag$3166)===(-1))){return false;}else{false;;}}return true;});($3076$3078.prototype["::deconstruct"]=function(e$3174){var it$0$3177;(it$0$3177=this);;return e$3174.args;});$3181($3076$3078,({}));return $3076$3078;}();var id$2437;var id_f$2438;var numr$2439;var numr_f$2440;var num$2441;var num_f$2442;var str$2443;var str_f$2444;var op$2445;var op2$2446;var op3$2447;var op4$2448;var op_f$2449;var indent$2450;var indent_f$2451;var cmnt$2452;var cmnt_f$2453;var unkn$2454;var unkn_f$2455;var $2411$2412;var Location$2413;var __lt____lt____colon__$2414;var special_ops$2415;var regexps$2416;var ws_re$2417;var eol_re$2418;var indent_tracker$2419;var process_token$2420;var tokenize$2421;($2411$2412=require("./location"));;(Location$2413=$2411$2412.Location);;(__lt____lt____colon__$2414=$2411$2412["<<:"]);;(special_ops$2415=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",":":"IFX",".":"PFX","'":"PFX"}));;(regexps$2416=(((id$2437=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))",""))),((id_f$2438=function(m$2462,wsb$2463,wsa$2464,last_op$2465){return ["ID","ID",m$2462[0]];})),((numr$2439=RegExp("(?:^((?:\\d+))[rR]((?:[A-Za-z0-9_]+))(?:(?:\\.((?:[A-Za-z0-9_]+)))?))",""))),((numr_f$2440=function(m$2474,wsb$2475,wsa$2476,last_op$2477){var t0$2485;var t1$2486;var radix$2480;var intp$2481;var frac$2482;var value$2483;(t0$2485=m$2474);if(((t0$2485 instanceof Array)&&((t1$2486=t0$2485.length),(t1$2486===4)))){t0$2485[0];(radix$2480=t0$2485[1]);(intp$2481=t0$2485[2]);(frac$2482=t0$2485[3]);;}else{throw Error("Mismatch");}(value$2483=parseInt(intp$2481.replace(RegExp("_","g"),""),radix$2480));;if(frac$2482){(frac$2482=frac$2482.replace(RegExp("_","g"),""));(value$2483=(value$2483+(parseInt(frac$2482,radix$2480)/Math.pow(radix$2480,frac$2482.length))));}return ["ID","NUM",value$2483];})),((num$2441=RegExp("(?:^((?:[0-9_]+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:[0-9_]+)))?))",""))),((num_f$2442=function(m$2502,wsb$2503,wsa$2504,last_op$2505){return ["ID","NUM",parseFloat(m$2502[0].replace(RegExp("_","g"),""))];})),((str$2443=RegExp("(?:^\"((?:(?:(?:\\\\\\\\|\\\\\")|[^\"])*))\")",""))),((str_f$2444=function(m$2514,wsb$2515,wsa$2516,last_op$2517){var repl$2520;var r$2521;(repl$2520=({"\\\"":"\"","\\\\":"\\","\\n":"\n"}));;(r$2521=m$2514[1].replace(RegExp("((?:(?:\\\\\"|\\\\\\\\)|\\\\n))","g"),function(m$2528){return $2378(repl$2520,m$2528);}));;return ["ID","STR",r$2521];})),((op$2445=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!@#.:']+))",""))),((op2$2446=RegExp("(?:^[\\[\\{\\}\\],])",""))),((op3$2447=RegExp("(?:^(?:(?:(?:(?:(?:(?:(?:(?:(?:(?:with|where)|when)|and)|not)|or)|in)|instanceof)|mod)|each)|as)\\b)",""))),((op4$2448=RegExp("(?:^`((?:[A-Za-z0-9_]+))`)",""))),((op_f$2449=function(m$2547,wsb$2548,wsa$2549,last_op$2550,column$2551){var other$2606;var m$2584$2586;var fixity$2577;var width$2578;var $2555$2567;var m$2554$2561;var op$2556;(op$2556=(m$2547[1]||m$2547[0]));;(m$2554$2561=null);;m$2554$2561;if((op$2556==="|")){return ["INDENT",(column$2551-1)];}else{if((op$2556 in special_ops$2415)){(fixity$2577=$2378(special_ops$2415,op$2556));;(width$2578=(((m$2584$2586=fixity$2577)),function(){if((m$2584$2586==="IFX")){if((wsb$2548||wsa$2549)){return "wide";}else{return "short";}}else{if((m$2584$2586==="SFX")){if(wsb$2548){return "wide";}else{return "short";}}else{if((m$2584$2586==="PFX")){if(wsa$2549){return "wide";}else{return "short";}}else{(other$2606=m$2584$2586);throw $3075(["should_never_happen"]).create("unknown fixity");}}}}()));;return ["OP",fixity$2577,width$2578,op$2556];}else{if((wsa$2549&&wsb$2548)){return ["OP",function(){if(last_op$2550){return "PFX";}else{return "IFX";}}(),"wide",op$2556];}else{if(((!wsa$2549)&&(!wsb$2548))){return ["OP",function(){if(last_op$2550){return "PFX";}else{return "IFX";}}(),"short",op$2556];}else{if((wsa$2549&&last_op$2550)){return ["OP","PFX","wide",op$2556];}else{if(wsa$2549){return ["OP","SFX","short",op$2556];}else{if(wsb$2548){return ["OP","PFX","short",op$2556];}else{return ["OP","PFX","short",op$2556];}}}}}}}})),((indent$2450=RegExp("(?:^(?:(?:\n((?: *)))+))",""))),((indent_f$2451=function(m$2639,wsb$2640,wsa$2641,last_op$2642){var ilen$2645;(ilen$2645=m$2639[1].length);;return ["INDENT",ilen$2645];})),((cmnt$2452=RegExp("(?:^;(?:[^\n]*))",""))),((cmnt_f$2453=function(m$2656,wsb$2657,wsa$2658,last_op$2659){return ["IGNORE"];})),((unkn$2454=RegExp("(?:^.)",""))),((unkn_f$2455=function(m$2668,wsb$2669,wsa$2670,last_op$2671){return ["ILLEGAL",m$2668[0]];})),[[op3$2447,op_f$2449],[id$2437,id_f$2438],[numr$2439,numr_f$2440],[num$2441,num_f$2442],[str$2443,str_f$2444],[op$2445,op_f$2449],[op2$2446,op_f$2449],[op4$2448,op_f$2449],[indent$2450,indent_f$2451],[cmnt$2452,cmnt_f$2453],[unkn$2454,unkn_f$2455]]));;(ws_re$2417=RegExp("(?:^(?: *)(?:(?:\n(?: *)\\\\(?: *))*))",""));;(eol_re$2418=RegExp("(?:^(?: *)(?:\n|$))",""));;(indent_tracker$2419=function(){var curr$2687;var stack$2688;var stacks$2689;(curr$2687=false);;(stack$2688=[]);;(stacks$2689=[stack$2688]);;return function(temp$2686$2700){var t0$2713;var rval$2760;var i$2814;var len$2809;var temp$2804;var acc$2799;var rval$2794;var other$2834;var fixity$2786;var width$2787;var fixity$2776;var width$2777;var stuff$2771;var new_indent$2733;var ph$2703$2734;var $2706$2727;var $2707$2728;var $2708$2729;var $2709$2730;var t0$2722;var t1$2723;var bridge$2704$2724;var bridge$2705$2725;var m$2702$2717;var ph$2710;var token$2711;(t0$2713=temp$2686$2700);(token$2711=t0$2713);(ph$2710=t0$2713);;(m$2702$2717=ph$2710);;if((($2706$2727=(m$2702$2717 instanceof Array))&&((t0$2722=m$2702$2717.length),((t0$2722===2)&&(m$2702$2717[0]==="INDENT"))))){(t1$2723=m$2702$2717[1]);(new_indent$2733=t1$2723);(ph$2703$2734=t1$2723);ph$2703$2734;if((curr$2687===false)){(curr$2687=new_indent$2733);return [["OP","IFX","wide",","]];}else{if((ph$2703$2734>curr$2687)){$2378(stack$2688.push(curr$2687),(curr$2687=new_indent$2733));return [["OP","PFX","wide","["]];}else{if((ph$2703$2734===curr$2687)){return [["OP","IFX","wide",","]];}else{if((ph$2703$2734<curr$2687)){(rval$2760=[]);;$2759:while(((stack$2688.length>0)&&(new_indent$2733<curr$2687))){(curr$2687=stack$2688.pop());rval$2760.push(["OP","SFX","wide","]"]);}rval$2760.push(["OP","IFX","wide",","]);return rval$2760;}else{throw Error("mismatch!!");}}}}}else{if(($2706$2727&&((t0$2722>=1)&&(m$2702$2717[0]==="ID")))){(stuff$2771=Array.prototype.slice.call(m$2702$2717,1));return [token$2711];}else{if(($2706$2727&&(($2708$2729=(t0$2722===4))&&(($2709$2730=(m$2702$2717[0]==="OP"))&&((fixity$2776=m$2702$2717[1]),((width$2777=m$2702$2717[2]),((bridge$2704$2724=m$2702$2717[3]),((bridge$2704$2724==="[")||(bridge$2704$2724==="{"))))))))){stack$2688.push(curr$2687);stacks$2689.push(stack$2688);(stack$2688=[]);(curr$2687=false);return [token$2711];}else{if(($2709$2730&&((fixity$2786=m$2702$2717[1]),((width$2787=m$2702$2717[2]),((bridge$2705$2725=m$2702$2717[3]),((bridge$2705$2725==="]")||(bridge$2705$2725==="}"))))))){(rval$2794=(((acc$2799=[])),(((temp$2804=stack$2688)),(((len$2809=temp$2804.length)),(((i$2814=0)),function(){$2797:for(;(i$2814<len$2809);(i$2814++)){var m$2822;(m$2822=temp$2804[i$2814]);;m$2822;acc$2799.push(["OP","SFX","short","]"]);}}()))),acc$2799));;(stack$2688=stacks$2689.pop());(curr$2687=stack$2688.pop());rval$2794.push(token$2711);return rval$2794;}else{(other$2834=m$2702$2717);return [token$2711];}}}}};});;(process_token$2420=function(src$2840,token$2841,last_op$2842,wsa$2843,wsb$2844,pos$2845,endpos$2846,accum$2847){var t0$2854;var t1$2855;var w$2877;var v$2888;var w$2910;var v$2911;var v$2923;var m$2886$2893;var other$2935;var m$2850$2861;var type$2851;var result$2852;(t0$2854=token$2841);if(((t0$2854 instanceof Array)&&((t1$2855=t0$2854.length),(t1$2855>=1)))){(type$2851=t0$2854[0]);(result$2852=Array.prototype.slice.call(t0$2854,1));;}else{throw Error("Mismatch");}__lt____lt____colon__$2414(result$2852,token$2841);(m$2850$2861=type$2851);;if((m$2850$2861==="IGNORE")){return last_op$2842;}else{if((m$2850$2861==="ID")){if((!last_op$2842)){(w$2877=["IFX",function(){if(wsb$2844){return "wide";}else{return "short";}}(),"WHITE"]);;(w$2877["location"]=Location$2413(src$2840,pos$2845,pos$2845));accum$2847.push(w$2877);}accum$2847.push(result$2852);return false;}else{if((m$2850$2861==="OP")){if(last_op$2842){(v$2888=["VOID"]);;(v$2888["location"]=Location$2413(src$2840,pos$2845,pos$2845));accum$2847.push(v$2888);}(m$2886$2893=result$2852[0]);;if((m$2886$2893==="IFX")){accum$2847.push(result$2852);return true;}else{if((m$2886$2893==="PFX")){if((!last_op$2842)){(w$2910=["IFX",function(){if(wsb$2844){return "wide";}else{return "short";}}(),"WHITE"]);;(w$2910["location"]=Location$2413(src$2840,pos$2845,pos$2845));(v$2911=["VOID"]);;(v$2911["location"]=Location$2413(src$2840,pos$2845,pos$2845));accum$2847.push(w$2910);accum$2847.push(v$2911);}accum$2847.push(result$2852);return true;}else{if((m$2886$2893==="SFX")){accum$2847.push(result$2852);(v$2923=["VOID"]);;(v$2923["location"]=Location$2413(src$2840,endpos$2846,endpos$2846));accum$2847.push(v$2923);return false;}else{throw Error("mismatch!!");}}}}else{if((m$2850$2861==="ILLEGAL")){throw $3075(["syntax","illegal"]).create("unknown character",({"chr":token$2841}));}else{(other$2935=m$2850$2861);throw $3075(["should_never_happen"]).create("unknown token type",({"token":token$2841}));}}}}});;(tokenize$2421=function(src$2941){var v$3069;var text$2945;var last_op$2946;var results$2947;var wsb$2948;var pos$2949;var column$2950;var indent$2951;(text$2945=src$2941.text);;(last_op$2946=true);;(results$2947=[]);;(wsb$2948=text$2945.match(ws_re$2417)[0].length);;(text$2945=text$2945.slice(wsb$2948));(pos$2949=wsb$2948);;(column$2950=0);;(indent$2951=indent_tracker$2419());;$2944:while(text$2945){var i$2977;(i$2977=0);;$2975:for(;(i$2977<regexps$2416.length);(++i$2977)){var t0$2989;var t1$2990;var splits$3014;var i$3049;var len$3044;var temp$3039;var skip$2999;var endpos$3000;var wsa$3001;var eol$3002;var bwsb$3003;var bwsa$3004;var token$3005;var tokens$3006;var re$2985;var fn$2986;var m$2987;(t0$2989=$2378(regexps$2416,i$2977));if(((t0$2989 instanceof Array)&&((t1$2990=t0$2989.length),(t1$2990===2)))){(re$2985=t0$2989[0]);(fn$2986=t0$2989[1]);;}else{throw Error("Mismatch");}(m$2987=text$2945.match(re$2985));;if(m$2987){(skip$2999=m$2987[0].length);;(endpos$3000=(pos$2949+skip$2999));;(column$2950=(((splits$3014=m$2987[0].split("\n"))),function(){if((splits$3014.length>1)){return $2378(splits$3014,(splits$3014.length-1)).length;}else{return (column$2950+skip$2999);}}()));(text$2945=text$2945.slice(skip$2999));(wsa$3001=text$2945.match(ws_re$2417)[0].length);;(eol$3002=(text$2945.match(eol_re$2418)&&true));;(bwsb$3003=(wsb$2948>0));;(bwsa$3004=function(){if(eol$3002){return bwsb$3003;}else{return (wsa$3001>0);}}());;(token$3005=fn$2986(m$2987,bwsb$3003,bwsa$3004,last_op$2946,column$2950));;(tokens$3006=indent$2951(token$3005));;(temp$3039=tokens$3006);;(len$3044=temp$3039.length);;(i$3049=0);;$3036:for(;(i$3049<len$3044);(i$3049++)){var x$3065;var m$3057;(m$3057=temp$3039[i$3049]);;(x$3065=m$3057);(x$3065["location"]=Location$2413(src$2941,pos$2949,endpos$3000));(last_op$2946=process_token$2420(src$2941,x$3065,last_op$2946,bwsa$3004,bwsb$3003,pos$2949,endpos$3000,results$2947));}(text$2945=text$2945.slice(wsa$3001));(column$2950=(column$2950+wsa$3001));(wsb$2948=wsa$3001);(pos$2949=(endpos$3000+wsa$3001));break $2975;}}}if(last_op$2946){(v$3069=["VOID"]);;(v$3069["location"]=[pos$2949,pos$2949]);results$2947.push(v$3069);}return results$2947;});;(exports["tokenize"]=tokenize$2421);
