var τ29=function(type$3819){var f$3822;(f$3822=type$3819["::check"]);;if((f$3822===(void 0))){return function(value$3827){return (value$3827 instanceof type$3819);};}else{return function(value$3830){return f$3822.call(type$3819,value$3830);};}};
var τ30=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var τ31=function(temp$3832$3834){var ph$3838;(ph$3838=temp$3832$3834);;var m$3836$3843;(m$3836$3843=ph$3838);;var bridge$3837$3848;var x$3852;(bridge$3837$3848=m$3836$3843);if((((typeof(bridge$3837$3848)==="string")&&((x$3852=bridge$3837$3848),true))||((typeof(bridge$3837$3848)==="number")&&((x$3852=bridge$3837$3848),true)))){return ["value",x$3852];}else{var other$3859;(other$3859=m$3836$3843);return other$3859["::serialize_ast"]();}};
var send$3681;(send$3681=function(obj$3686,temp$3684$3687){var ph$3691;var msg$3692;var t0$3694;(t0$3694=temp$3684$3687);(msg$3692=t0$3694);(ph$3691=t0$3694);;var m$3689$3698;(m$3689$3698=ph$3691);;var bridge$3690$3703;(bridge$3690$3703=m$3689$3698);if(((typeof(bridge$3690$3703)==="string")||(typeof(bridge$3690$3703)==="number"))){return obj$3686[msg$3692];}else{var other$3711;(other$3711=m$3689$3698);return obj$3686["::send"](msg$3692);}});;(Array[":::project"]=function(temp$3714$3716){var ph$3719;var value$3720;var t0$3722;(t0$3722=temp$3714$3716);(value$3720=t0$3722);(ph$3719=t0$3722);;var m$3718$3726;(m$3718$3726=ph$3719);;if(τ29(Array)(m$3718$3726)){return [true,value$3720];}else{m$3718$3726;return [true,[value$3720]];}});(Array.prototype["::check"]=function(value$3740){if((value$3740 instanceof Array)){var i$3745;(i$3745=0);;$3743:for(;(i$3745<this.length);(i$3745++)){if((τ30(this,i$3745)!==τ30(value$3740,i$3745))){return false;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value$3754){if((value$3754 instanceof Array)){var i$3759;(i$3759=0);;$3757:for(;(i$3759<this.length);(i$3759++)){if((τ30(this,i$3759)!==τ30(value$3754,i$3759))){return [true,[value$3754]];}}return [true,value$3754.slice(this.length)];}else{return [true,[value$3754]];}});(Array.prototype[":::deconstruct"]=function(value$3768){return [true,value$3768.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map(τ31));});(RegExp.prototype["::check"]=function(value$3773){return value$3773.match(this);});(RegExp.prototype[":::project"]=function(value$3776){var m$3778$3780;(m$3778$3780=value$3776.match(this));;var m$3788;if((m$3778$3780===null)){(m$3788=m$3778$3780);return [false,null];}else{var m$3793;(m$3793=m$3778$3780);return [true,m$3793];}});(RegExp.prototype[":::deconstruct"]=function(value$3796){var m$3798$3800;(m$3798$3800=value$3796.match(this));;var m$3808;if((m$3798$3800===null)){(m$3808=m$3798$3800);return [false,null];}else{var m$3813;(m$3813=m$3798$3800);return [true,m$3813];}});(Function.prototype["::send"]=function(args$3816){return this.apply(this,args$3816);});
var τ33=function(dest$4633,values$4634){var k$4639;(k$4639=null);$4637:for(k$4639 in values$4634){if(values$4634.hasOwnProperty(k$4639)){(dest$4633[k$4639]=values$4634[k$4639]);}}return dest$4633;};
var τ32=function(){var $4527$4529;($4527$4529=function(tags$4533){var it$0$4536;(it$0$4536=function(){if((!τ29($4527$4529)(this))){return Object.create($4527$4529.prototype);}else{return this;}}());;(it$0$4536["tags"]=tags$4533);return it$0$4536;});;($4527$4529.prototype["create"]=function(){var m$4545$4547;(m$4545$4547=arguments);;var t0$4552;var message$4556;var args$4557;(t0$4552=m$4545$4547.length);if((t0$4552>=0)){(message$4556=function(){if((0>=t0$4552)){return "";}else{return m$4545$4547[0];}}());(args$4557=Array.prototype.slice.call(m$4545$4547,1));var it$0$4561;(it$0$4561=this);;var e$4566;(e$4566=Error(message$4556));;(e$4566["::tags"]=it$0$4561.tags);(e$4566["args"]=args$4557);(e$4566["name"]=["E"].concat(it$0$4561.tags).join("."));return e$4566;}else{throw Error("mismatch!!");}});($4527$4529.prototype["::check"]=function(e$4575){var it$0$4578;(it$0$4578=this);;var tags$4583;if(((!e$4575)||(!τ29(Error)(e$4575)))){return false;}(tags$4583=(e$4575["::tags"]||[]));;var temp$4591;(temp$4591=it$0$4578.tags);;var len$4596;(len$4596=temp$4591.length);;var i$4601;(i$4601=0);;$4588:for(;(i$4601<len$4596);(i$4601++)){var m$4609;(m$4609=temp$4591[i$4601]);;var tag$4617;(tag$4617=m$4609);if((tags$4583.indexOf(tag$4617)===(-1))){return false;}else{false;;}}return true;});($4527$4529.prototype["::deconstruct"]=function(e$4625){var it$0$4628;(it$0$4628=this);;return e$4625.args;});τ33($4527$4529,({}));return $4527$4529;}();var id$3889;var id_f$3890;var numr$3891;var numr_f$3892;var num$3893;var num_f$3894;var str$3895;var str_f$3896;var op$3897;var op2$3898;var op3$3899;var op4$3900;var op_f$3901;var indent$3902;var indent_f$3903;var cmnt$3904;var cmnt_f$3905;var unkn$3906;var unkn_f$3907;var $3863$3864;var Location$3865;var __lt____lt____colon__$3866;var special_ops$3867;var regexps$3868;var ws_re$3869;var eol_re$3870;var indent_tracker$3871;var process_token$3872;var tokenize$3873;($3863$3864=require("./location"));;(Location$3865=$3863$3864.Location);;(__lt____lt____colon__$3866=$3863$3864["<<:"]);;(special_ops$3867=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",":":"IFX",".":"PFX","'":"PFX"}));;(regexps$3868=(((id$3889=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))",""))),((id_f$3890=function(m$3914,wsb$3915,wsa$3916,last_op$3917){return ["ID","ID",m$3914[0]];})),((numr$3891=RegExp("(?:^((?:\\d+))[rR]((?:[A-Za-z0-9_]+))(?:(?:\\.((?:[A-Za-z0-9_]+)))?))",""))),((numr_f$3892=function(m$3926,wsb$3927,wsa$3928,last_op$3929){var t0$3937;var t1$3938;var radix$3932;var intp$3933;var frac$3934;var value$3935;(t0$3937=m$3926);if(((t0$3937 instanceof Array)&&((t1$3938=t0$3937.length),(t1$3938===4)))){t0$3937[0];(radix$3932=t0$3937[1]);(intp$3933=t0$3937[2]);(frac$3934=t0$3937[3]);;}else{throw Error("Mismatch");}(value$3935=parseInt(intp$3933.replace(RegExp("_","g"),""),radix$3932));;if(frac$3934){(frac$3934=frac$3934.replace(RegExp("_","g"),""));(value$3935=(value$3935+(parseInt(frac$3934,radix$3932)/Math.pow(radix$3932,frac$3934.length))));}return ["ID","NUM",value$3935];})),((num$3893=RegExp("(?:^((?:[0-9_]+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:[0-9_]+)))?))",""))),((num_f$3894=function(m$3954,wsb$3955,wsa$3956,last_op$3957){return ["ID","NUM",parseFloat(m$3954[0].replace(RegExp("_","g"),""))];})),((str$3895=RegExp("(?:^\"((?:(?:(?:\\\\\\\\|\\\\\")|[^\"])*))\")",""))),((str_f$3896=function(m$3966,wsb$3967,wsa$3968,last_op$3969){var repl$3972;var r$3973;(repl$3972=({"\\\"":"\"","\\\\":"\\","\\n":"\n"}));;(r$3973=m$3966[1].replace(RegExp("((?:(?:\\\\\"|\\\\\\\\)|\\\\n))","g"),function(m$3980){return τ30(repl$3972,m$3980);}));;return ["ID","STR",r$3973];})),((op$3897=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!@#.:']+))",""))),((op2$3898=RegExp("(?:^[\\[\\{\\}\\],])",""))),((op3$3899=RegExp("(?:^(?:(?:(?:(?:(?:(?:(?:(?:(?:(?:with|where)|when)|and)|not)|or)|in)|instanceof)|mod)|each)|as)\\b)",""))),((op4$3900=RegExp("(?:^`((?:[A-Za-z0-9_]+))`)",""))),((op_f$3901=function(m$3999,wsb$4000,wsa$4001,last_op$4002,column$4003){var other$4058;var m$4036$4038;var fixity$4029;var width$4030;var $4007$4019;var m$4006$4013;var op$4008;(op$4008=(m$3999[1]||m$3999[0]));;(m$4006$4013=null);;m$4006$4013;if((op$4008==="|")){return ["INDENT",(column$4003-1)];}else{if((op$4008 in special_ops$3867)){(fixity$4029=τ30(special_ops$3867,op$4008));;(width$4030=(((m$4036$4038=fixity$4029)),function(){if((m$4036$4038==="IFX")){if((wsb$4000||wsa$4001)){return "wide";}else{return "short";}}else{if((m$4036$4038==="SFX")){if(wsb$4000){return "wide";}else{return "short";}}else{if((m$4036$4038==="PFX")){if(wsa$4001){return "wide";}else{return "short";}}else{(other$4058=m$4036$4038);throw τ32(["should_never_happen"]).create("unknown fixity");}}}}()));;return ["OP",fixity$4029,width$4030,op$4008];}else{if((wsa$4001&&wsb$4000)){return ["OP",function(){if(last_op$4002){return "PFX";}else{return "IFX";}}(),"wide",op$4008];}else{if(((!wsa$4001)&&(!wsb$4000))){return ["OP",function(){if(last_op$4002){return "PFX";}else{return "IFX";}}(),"short",op$4008];}else{if((wsa$4001&&last_op$4002)){return ["OP","PFX","wide",op$4008];}else{if(wsa$4001){return ["OP","SFX","short",op$4008];}else{if(wsb$4000){return ["OP","PFX","short",op$4008];}else{return ["OP","PFX","short",op$4008];}}}}}}}})),((indent$3902=RegExp("(?:^(?:(?:\n((?: *)))+))",""))),((indent_f$3903=function(m$4091,wsb$4092,wsa$4093,last_op$4094){var ilen$4097;(ilen$4097=m$4091[1].length);;return ["INDENT",ilen$4097];})),((cmnt$3904=RegExp("(?:^;(?:[^\n]*))",""))),((cmnt_f$3905=function(m$4108,wsb$4109,wsa$4110,last_op$4111){return ["IGNORE"];})),((unkn$3906=RegExp("(?:^.)",""))),((unkn_f$3907=function(m$4120,wsb$4121,wsa$4122,last_op$4123){return ["ILLEGAL",m$4120[0]];})),[[op3$3899,op_f$3901],[id$3889,id_f$3890],[numr$3891,numr_f$3892],[num$3893,num_f$3894],[str$3895,str_f$3896],[op$3897,op_f$3901],[op2$3898,op_f$3901],[op4$3900,op_f$3901],[indent$3902,indent_f$3903],[cmnt$3904,cmnt_f$3905],[unkn$3906,unkn_f$3907]]));;(ws_re$3869=RegExp("(?:^(?: *)(?:(?:\n(?: *)\\\\(?: *))*))",""));;(eol_re$3870=RegExp("(?:^(?: *)(?:\n|$))",""));;(indent_tracker$3871=function(){var curr$4139;var stack$4140;var stacks$4141;(curr$4139=false);;(stack$4140=[]);;(stacks$4141=[stack$4140]);;return function(temp$4138$4152){var t0$4165;var rval$4212;var i$4266;var len$4261;var temp$4256;var acc$4251;var rval$4246;var other$4286;var fixity$4238;var width$4239;var fixity$4228;var width$4229;var stuff$4223;var new_indent$4185;var ph$4155$4186;var $4158$4179;var $4159$4180;var $4160$4181;var $4161$4182;var t0$4174;var t1$4175;var bridge$4156$4176;var bridge$4157$4177;var m$4154$4169;var ph$4162;var token$4163;(t0$4165=temp$4138$4152);(token$4163=t0$4165);(ph$4162=t0$4165);;(m$4154$4169=ph$4162);;if((($4158$4179=(m$4154$4169 instanceof Array))&&((t0$4174=m$4154$4169.length),((t0$4174===2)&&(m$4154$4169[0]==="INDENT"))))){(t1$4175=m$4154$4169[1]);(new_indent$4185=t1$4175);(ph$4155$4186=t1$4175);ph$4155$4186;if((curr$4139===false)){(curr$4139=new_indent$4185);return [["OP","IFX","wide",","]];}else{if((ph$4155$4186>curr$4139)){τ30(stack$4140.push(curr$4139),(curr$4139=new_indent$4185));return [["OP","PFX","wide","["]];}else{if((ph$4155$4186===curr$4139)){return [["OP","IFX","wide",","]];}else{if((ph$4155$4186<curr$4139)){(rval$4212=[]);;$4211:while(((stack$4140.length>0)&&(new_indent$4185<curr$4139))){(curr$4139=stack$4140.pop());rval$4212.push(["OP","SFX","wide","]"]);}rval$4212.push(["OP","IFX","wide",","]);return rval$4212;}else{throw Error("mismatch!!");}}}}}else{if(($4158$4179&&((t0$4174>=1)&&(m$4154$4169[0]==="ID")))){(stuff$4223=Array.prototype.slice.call(m$4154$4169,1));return [token$4163];}else{if(($4158$4179&&(($4160$4181=(t0$4174===4))&&(($4161$4182=(m$4154$4169[0]==="OP"))&&((fixity$4228=m$4154$4169[1]),((width$4229=m$4154$4169[2]),((bridge$4156$4176=m$4154$4169[3]),((bridge$4156$4176==="[")||(bridge$4156$4176==="{"))))))))){stack$4140.push(curr$4139);stacks$4141.push(stack$4140);(stack$4140=[]);(curr$4139=false);return [token$4163];}else{if(($4161$4182&&((fixity$4238=m$4154$4169[1]),((width$4239=m$4154$4169[2]),((bridge$4157$4177=m$4154$4169[3]),((bridge$4157$4177==="]")||(bridge$4157$4177==="}"))))))){(rval$4246=(((acc$4251=[])),(((temp$4256=stack$4140)),(((len$4261=temp$4256.length)),(((i$4266=0)),function(){$4249:for(;(i$4266<len$4261);(i$4266++)){var m$4274;(m$4274=temp$4256[i$4266]);;m$4274;acc$4251.push(["OP","SFX","short","]"]);}}()))),acc$4251));;(stack$4140=stacks$4141.pop());(curr$4139=stack$4140.pop());rval$4246.push(token$4163);return rval$4246;}else{(other$4286=m$4154$4169);return [token$4163];}}}}};});;(process_token$3872=function(src$4292,token$4293,last_op$4294,wsa$4295,wsb$4296,pos$4297,endpos$4298,accum$4299){var t0$4306;var t1$4307;var w$4329;var v$4340;var w$4362;var v$4363;var v$4375;var m$4338$4345;var other$4387;var m$4302$4313;var type$4303;var result$4304;(t0$4306=token$4293);if(((t0$4306 instanceof Array)&&((t1$4307=t0$4306.length),(t1$4307>=1)))){(type$4303=t0$4306[0]);(result$4304=Array.prototype.slice.call(t0$4306,1));;}else{throw Error("Mismatch");}__lt____lt____colon__$3866(result$4304,token$4293);(m$4302$4313=type$4303);;if((m$4302$4313==="IGNORE")){return last_op$4294;}else{if((m$4302$4313==="ID")){if((!last_op$4294)){(w$4329=["IFX",function(){if(wsb$4296){return "wide";}else{return "short";}}(),"WHITE"]);;(w$4329["location"]=Location$3865(src$4292,pos$4297,pos$4297));accum$4299.push(w$4329);}accum$4299.push(result$4304);return false;}else{if((m$4302$4313==="OP")){if(last_op$4294){(v$4340=["VOID"]);;(v$4340["location"]=Location$3865(src$4292,pos$4297,pos$4297));accum$4299.push(v$4340);}(m$4338$4345=result$4304[0]);;if((m$4338$4345==="IFX")){accum$4299.push(result$4304);return true;}else{if((m$4338$4345==="PFX")){if((!last_op$4294)){(w$4362=["IFX",function(){if(wsb$4296){return "wide";}else{return "short";}}(),"WHITE"]);;(w$4362["location"]=Location$3865(src$4292,pos$4297,pos$4297));(v$4363=["VOID"]);;(v$4363["location"]=Location$3865(src$4292,pos$4297,pos$4297));accum$4299.push(w$4362);accum$4299.push(v$4363);}accum$4299.push(result$4304);return true;}else{if((m$4338$4345==="SFX")){accum$4299.push(result$4304);(v$4375=["VOID"]);;(v$4375["location"]=Location$3865(src$4292,endpos$4298,endpos$4298));accum$4299.push(v$4375);return false;}else{throw Error("mismatch!!");}}}}else{if((m$4302$4313==="ILLEGAL")){throw τ32(["syntax","illegal"]).create("unknown character",({"chr":token$4293}));}else{(other$4387=m$4302$4313);throw τ32(["should_never_happen"]).create("unknown token type",({"token":token$4293}));}}}}});;(tokenize$3873=function(src$4393){var v$4521;var text$4397;var last_op$4398;var results$4399;var wsb$4400;var pos$4401;var column$4402;var indent$4403;(text$4397=src$4393.text);;(last_op$4398=true);;(results$4399=[]);;(wsb$4400=text$4397.match(ws_re$3869)[0].length);;(text$4397=text$4397.slice(wsb$4400));(pos$4401=wsb$4400);;(column$4402=0);;(indent$4403=indent_tracker$3871());;$4396:while(text$4397){var i$4429;(i$4429=0);;$4427:for(;(i$4429<regexps$3868.length);(++i$4429)){var t0$4441;var t1$4442;var splits$4466;var i$4501;var len$4496;var temp$4491;var skip$4451;var endpos$4452;var wsa$4453;var eol$4454;var bwsb$4455;var bwsa$4456;var token$4457;var tokens$4458;var re$4437;var fn$4438;var m$4439;(t0$4441=τ30(regexps$3868,i$4429));if(((t0$4441 instanceof Array)&&((t1$4442=t0$4441.length),(t1$4442===2)))){(re$4437=t0$4441[0]);(fn$4438=t0$4441[1]);;}else{throw Error("Mismatch");}(m$4439=text$4397.match(re$4437));;if(m$4439){(skip$4451=m$4439[0].length);;(endpos$4452=(pos$4401+skip$4451));;(column$4402=(((splits$4466=m$4439[0].split("\n"))),function(){if((splits$4466.length>1)){return τ30(splits$4466,(splits$4466.length-1)).length;}else{return (column$4402+skip$4451);}}()));(text$4397=text$4397.slice(skip$4451));(wsa$4453=text$4397.match(ws_re$3869)[0].length);;(eol$4454=(text$4397.match(eol_re$3870)&&true));;(bwsb$4455=(wsb$4400>0));;(bwsa$4456=function(){if(eol$4454){return bwsb$4455;}else{return (wsa$4453>0);}}());;(token$4457=fn$4438(m$4439,bwsb$4455,bwsa$4456,last_op$4398,column$4402));;(tokens$4458=indent$4403(token$4457));;(temp$4491=tokens$4458);;(len$4496=temp$4491.length);;(i$4501=0);;$4488:for(;(i$4501<len$4496);(i$4501++)){var x$4517;var m$4509;(m$4509=temp$4491[i$4501]);;(x$4517=m$4509);(x$4517["location"]=Location$3865(src$4393,pos$4401,endpos$4452));(last_op$4398=process_token$3872(src$4393,x$4517,last_op$4398,bwsa$4456,bwsb$4455,pos$4401,endpos$4452,results$4399));}(text$4397=text$4397.slice(wsa$4453));(column$4402=(column$4402+wsa$4453));(wsb$4400=wsa$4453);(pos$4401=(endpos$4452+wsa$4453));break $4427;}}}if(last_op$4398){(v$4521=["VOID"]);;(v$4521["location"]=[pos$4401,pos$4401]);results$4399.push(v$4521);}return results$4399;});;(exports["tokenize"]=tokenize$3873);
