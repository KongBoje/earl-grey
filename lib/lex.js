var $5142=function(type$5145){var f$5149;(f$5149=type$5145["::check"]);if((f$5149===(void 0))){return function(value$5155){return (value$5155 instanceof type$5145);};}else{return function(value$5159){return f$5149.call(type$5145,value$5159);};}};
var $5161=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $5162=function(dest$5165,values$5166){var k$5171;(k$5171=null);$5169:for(k$5171 in values$5166){if(values$5166.hasOwnProperty(k$5171)){(dest$5165[k$5171]=values$5166[k$5171]);}}return dest$5165;};
var $5179=function($5181$5184){var ph$5190;(ph$5190=$5181$5184);var $5186$5196;($5186$5196=ph$5190);var bridge$5188$5201;var x$5205;(bridge$5188$5201=$5186$5196);if((((typeof(bridge$5188$5201)==="string")&&((x$5205=bridge$5188$5201),true))||((typeof(bridge$5188$5201)==="number")&&((x$5205=bridge$5188$5201),true)))){return ["value",x$5205];}else{var other$5216;(other$5216=$5186$5196);return other$5216["::serialize_ast"]();}};
var send$4916;(send$4916=function(obj$4923,$4920$4924){var ph$4930;var msg$4931;var t0$4933;(t0$4933=$4920$4924);(msg$4931=t0$4933);(ph$4930=t0$4933);var $4926$4942;($4926$4942=ph$4930);var bridge$4928$4947;(bridge$4928$4947=$4926$4942);if(((typeof(bridge$4928$4947)==="string")||(typeof(bridge$4928$4947)==="number"))){return obj$4923[msg$4931];}else{var other$4959;(other$4959=$4926$4942);return obj$4923["::send"](msg$4931);}});(Array[":::project"]=function($4965$4968){var ph$4973;var value$4974;var t0$4976;(t0$4976=$4965$4968);(value$4974=t0$4976);(ph$4973=t0$4976);var $4970$4985;($4970$4985=ph$4973);if($5142(Array)($4970$4985)){return [true,value$4974];}else{$4970$4985;return [true,[value$4974]];}});(Array.prototype["::check"]=function(value$5003){if((value$5003 instanceof Array)){var i$5009;(i$5009=0);$5006:for(;(i$5009<this.length);(i$5009++)){if(($5161(this,i$5009)!==$5161(value$5003,i$5009))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $5162(this.slice(0),this);});(Array.prototype[":::project"]=function(value$5028){if((value$5028 instanceof Array)){var i$5034;(i$5034=0);$5031:for(;(i$5034<this.length);(i$5034++)){if(($5161(this,i$5034)!==$5161(value$5028,i$5034))){return [true,[value$5028]];}}return [true,value$5028.slice(this.length)];}else{return [true,[value$5028]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($5179));});(RegExp.prototype["::check"]=function($5052$5055){var ph$5060;(ph$5060=$5052$5055);var $5057$5066;($5057$5066=ph$5060);var value$5074;if((typeof($5057$5066)==="string")){(value$5074=$5057$5066);if(value$5074.match(this)){return true;}else{return false;}}else{var other$5079;(other$5079=$5057$5066);return false;}});(RegExp.prototype[":::project"]=function($5085$5088){var ph$5093;(ph$5093=$5085$5088);var $5090$5099;($5090$5099=ph$5093);var value$5107;if((typeof($5090$5099)==="string")){(value$5107=$5090$5099);var $5110$5115;($5110$5115=value$5107.match(this));var m$5123;if(($5110$5115===null)){(m$5123=$5110$5115);return [false,null];}else{var m$5128;(m$5128=$5110$5115);return [true,m$5128];}}else{var other$5132;(other$5132=$5090$5099);return [false,null];}});(Function.prototype["::send"]=function(args$5139){return this.apply(this,args$5139);});
var $7225=function(arr$7228){var results$7234;var l$7235;(results$7234=[]);(l$7235=arr$7228.length);var i$7244;(i$7244=0);$7233:for(;(i$7244<l$7235);(i$7244++)){results$7234.push([i$7244,$5161(arr$7228,i$7244)]);}return results$7234;};
var $6992=function(){var $6993$6999;($6993$6999=function(tags$7004){var it$0$7007;(it$0$7007=function(){if((!$5142($6993$6999)(this))){return Object.create($6993$6999.prototype);}else{return this;}}());(it$0$7007["tags"]=tags$7004);return it$0$7007;});($6993$6999.prototype["create"]=function(){var it$0$7027;var self$7028;(it$0$7027=this);(self$7028=this);var $7025$7037;($7025$7037=arguments);var t0$7042;var message$7046;var args$7047;(t0$7042=$7025$7037.length);if((t0$7042>=0)){(message$7046=function(){if((0>=t0$7042)){return "";}else{return $7025$7037[0];}}());(args$7047=Array.prototype.slice.call($7025$7037,1));var e$7060;(e$7060=Error(message$7046));(e$7060["::tags"]=it$0$7027.tags);(e$7060["args"]=args$7047);var temp$7076;(temp$7076=$7225(args$7047));var $length$7082;($length$7082=temp$7076.length);var $index$7088;($index$7088=0);$7061:for(;($index$7088<$length$7082);($index$7088++)){var m$7097;(m$7097=temp$7076[$index$7088]);var t0$7102;var t1$7103;var i$7107;var arg$7108;(t0$7102=m$7097);if(((t0$7102 instanceof Array)&&(((t1$7103=t0$7102.length)),(t1$7103===2)))){(i$7107=t0$7102[0]);(arg$7108=t0$7102[1]);(e$7060[i$7107]=arg$7108);}else{$6973(m$7097);}}(e$7060["length"]=args$7047.length);(e$7060["name"]=["E"].concat(it$0$7027.tags).join("."));return e$7060;}else{$6973($7025$7037);}});($6993$6999.prototype["::check"]=function(e$7138){var it$0$7142;var self$7143;(it$0$7142=this);(self$7143=this);var tags$7153;if(((!e$7138)||(!$5142(Error)(e$7138)))){return false;}(tags$7153=(e$7138["::tags"]||[]));var temp$7164;(temp$7164=it$0$7142.tags);var $length$7170;($length$7170=temp$7164.length);var $index$7176;($index$7176=0);$7154:for(;($index$7176<$length$7170);($index$7176++)){var m$7185;(m$7185=temp$7164[$index$7176]);var tag$7193;(tag$7193=m$7185);if((tags$7153.indexOf(tag$7193)===-1)){return false;}else{false;}}return true;});($6993$6999.prototype["::deconstruct"]=function(e$7202){var it$0$7206;var self$7207;(it$0$7206=this);(self$7207=this);return e$7202.args;});$5162($6993$6999,$5162(function(){var accum$7218;(accum$7218=({}));(accum$7218["::name"]="$6993");return accum$7218;}(),function(){var accum$7222;(accum$7222=({}));(accum$7222["::egclass"]=true);return accum$7222;}()));return $6993$6999;}();
var $6973=function(value$6976,url$6977,start$6978,end$6979){var err$6983;(err$6983=$6992(["match"]).create("Could not find a match for value",({"value":value$6976})));if(url$6977){(err$6983["location"]=["location",url$6977,start$6978,end$6979]);}throw err$6983;};
var $7251=function(type$7254){return function(value$7258){var f$7262;(f$7262=type$7254[":::project"]);if((f$7262===(void 0))){(f$7262=type$7254["::project"]);if((f$7262===(void 0))){return [true,type$7254(value$7258)];}else{var rval$7275;(rval$7275=false);try{(rval$7275=[true,f$7262(value$7258)]);}catch(excv$7286){var e$7292;(e$7292=excv$7286);(rval$7275=[false,null]);}return rval$7275;}}else{return f$7262.call(type$7254,value$7258);}};};
var $7404=function($7406$7409,key$7410){var ph$7418;(ph$7418=$7406$7409);var $7412$7424;($7412$7424=ph$7418);var bridge$7414$7429;(bridge$7414$7429=$7412$7424);if(((bridge$7414$7429===null)||(bridge$7414$7429===(void 0)))){return false;}else{var x$7441;if((typeof($7412$7424)==="string")){(x$7441=$7412$7424);return (key$7410 in String.prototype);}else{var x$7446;if((typeof($7412$7424)==="number")){(x$7446=$7412$7424);return (key$7410 in Number.prototype);}else{var x$7451;(x$7451=$7412$7424);return (key$7410 in x$7451);}}}};
var $7320=function($7322$7325){var ph$7335;var x$7336;var t0$7338;(t0$7338=$7322$7325);(x$7336=t0$7338);(ph$7335=t0$7338);var $7327$7347;($7327$7347=ph$7335);var bridge$7329$7352;(bridge$7329$7352=$7327$7347);if((function(){var bridge$7330$7362;(bridge$7330$7362=bridge$7329$7352);return (function(){var bridge$7331$7369;(bridge$7331$7369=bridge$7330$7362);return ((bridge$7331$7369===(void 0))||(bridge$7331$7369===null));}()||(typeof(bridge$7330$7362)==="string"));}()||(typeof(bridge$7329$7352)==="number"))){return x$7336;}else{if($7404($7327$7347,"::clone")){$7327$7347["::clone"];return x$7336["::clone"]();}else{$7327$7347;if((Object.getPrototypeOf(x$7336)===Object.prototype)){var dest$7387;(dest$7387=({}));var k$7392;(k$7392=null);$7386:for(k$7392 in x$7336){if(Object.prototype.hasOwnProperty.call(x$7336,k$7392)){(dest$7387[k$7392]=x$7336[k$7392]);}}return dest$7387;}else{var other$7402;(other$7402=$7327$7347);throw $6992(["clone"]).create("Object cannot be cloned",({"obj":x$7336}));}}}};
var $7298=function(a$7301,b$7302){var dest$7307;(dest$7307=$7320(a$7301));var k$7312;(k$7312=null);$7306:for(k$7312 in b$7302){if(Object.prototype.hasOwnProperty.call(b$7302,k$7312)){(dest$7307[k$7312]=b$7302[k$7312]);}}return dest$7307;};var id$5283;var id_f$5284;var numr$5285;var numr_f$5286;var num$5287;var num_f$5288;var str$5289;var str_f$5290;var op$5291;var op2$5292;var op3$5293;var op4$5294;var op_f$5295;var indent$5296;var indent_f$5297;var cmnt$5298;var cmnt_f$5299;var unkn$5300;var unkn_f$5301;var $5220$5235;var Location$5236;var __lt____lt____colon__$5237;var special_ops$5238;var regexps$5239;var ws_re$5240;var eol_re$5241;var produce$5242;var indent_tracker$5243;var process_indent$5244;var disambiguate_fixity$5245;var alternate_operators$5246;var fill_locations$5247;var tokenize$5248;($5220$5235=require("./location"));(Location$5236=$5220$5235.Location);(__lt____lt____colon__$5237=$5220$5235["<<:"]);(special_ops$5238=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",".":"PFX","'":"PFX","not":"PFX"}));(regexps$5239=(((id$5283=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))",""))),((id_f$5284=function(m$5309){return ["ID",m$5309[0]];})),((numr$5285=RegExp("(?:^((?:\\d+))[rR]((?:[A-Za-z0-9_]+))(?:(?:\\.((?:[A-Za-z0-9_]+)))?))",""))),((numr_f$5286=function(m$5319){var t0$5329;var t1$5330;var frac$5350;var radix$5324;var intp$5325;var frac$5326;var value$5327;(t0$5329=m$5319);if(((t0$5329 instanceof Array)&&(((t1$5330=t0$5329.length)),(t1$5330===4)))){t0$5329[0];(radix$5324=t0$5329[1]);(intp$5325=t0$5329[2]);(frac$5326=t0$5329[3]);}else{$6973(m$5319,"/home/olivier/git/earl-grey/src/lex.eg",993,994);}(value$5327=parseInt(intp$5325.replace(RegExp("_","g"),""),radix$5324));if(frac$5326){(frac$5350=frac$5326.replace(RegExp("_","g"),""));(value$5327=(value$5327+(parseInt(frac$5326,radix$5324)/Math.pow(radix$5324,frac$5326.length))));}return ["NUM",value$5327];})),((num$5287=RegExp("(?:^((?:[0-9_]+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:[0-9_]+)))?))",""))),((num_f$5288=function(m$5365){return ["NUM",parseFloat(m$5365[0].replace(RegExp("_","g"),""))];})),((str$5289=RegExp("(?:^\"((?:(?:(?:\\\\.)|[^\"])*))\")",""))),((str_f$5290=function(m$5375){var rx$5390;var f$5391;var repl$5380;var r$5381;(repl$5380=({"b":String.fromCharCode(8),"f":String.fromCharCode(12),"n":"\n","r":String.fromCharCode(13),"t":String.fromCharCode(9)}));(r$5381=(((rx$5390=RegExp("\\\\u[0-9A-Fa-f]{4}|\\\\x[0-9A-Fa-f]{2}|\\\\.","g"))),((f$5391=function($5398$5401){var chr$5442;var digits$5423;var t0$5417;var t1$5418;var t2$5419;var $5403$5412;var ph$5406;(ph$5406=$5398$5401);($5403$5412=ph$5406);(t0$5417=$7251(RegExp("^(?:\\\\u|\\\\x)(.*)",""))($5403$5412));if((t0$5417[0]&&(((t1$5418=t0$5417[1])),(((t2$5419=t1$5418.length)),(t2$5419===2))))){t1$5418[0];(digits$5423=t1$5418[1]);return String.fromCharCode(parseInt(digits$5423,16));}else{(t0$5417=$7251(RegExp("^.(.)",""))($5403$5412));if((t0$5417[0]&&(((t1$5418=t0$5417[1])),(((t2$5419=t1$5418.length)),(t2$5419===2))))){t1$5418[0];(chr$5442=t1$5418[1]);return ($5161(repl$5380,chr$5442)||chr$5442);}else{$6973($5403$5412);}}})),m$5375[1].replace(rx$5390,f$5391)));return ["STR",r$5381];})),((op$5291=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!@#.:']+))",""))),((op2$5292=RegExp("(?:^[\\[\\{\\}\\],])",""))),((op3$5293=RegExp("(?:^(?:(?:(?:(?:(?:(?:(?:(?:(?:with|where)|when)|and)|not)|or)|in)|mod)|each)|as)(?:(?:[+\\-*/~\\^<>=%&|?!@#.:']+)|\\b))",""))),((op4$5294=RegExp("(?:^`((?:[A-Za-z0-9_$]+))`)",""))),((op_f$5295=function(m$5480,column$5481){var fixity$5513;var otherwise$5519;var $5489$5502;var $5485$5496;var op$5490;(op$5490=(m$5480[1]||m$5480[0]));($5485$5496=null);$5485$5496;if((op$5490==="|")){return ["INDENT",(column$5481-1)];}else{if((op$5490 in special_ops$5238)){(fixity$5513=$5161(special_ops$5238,op$5490));return ["OP",fixity$5513,op$5490];}else{(otherwise$5519=$5485$5496);return ["OP","?FX",op$5490];}}})),((indent$5296=RegExp("(?:^(?:(?:\n(?: *);(?:[^\n]*))*)(?:(?:\n((?: *)))+))",""))),((indent_f$5297=function(m$5529){var ilen$5533;(ilen$5533=m$5529[1].length);return ["INDENT",ilen$5533];})),((cmnt$5298=RegExp("(?:^;(?:[^\n]*))",""))),((cmnt_f$5299=function(m$5545){return ["IGNORE"];})),((unkn$5300=RegExp("(?:^.)",""))),((unkn_f$5301=function(m$5555){return ["ILLEGAL",m$5555[0]];})),[[op3$5293,op_f$5295],[id$5283,id_f$5284],[numr$5285,numr_f$5286],[num$5287,num_f$5288],[str$5289,str_f$5290],[op$5291,op_f$5295],[op2$5292,op_f$5295],[op4$5294,op_f$5295],[indent$5296,indent_f$5297],[cmnt$5298,cmnt_f$5299],[unkn$5300,unkn_f$5301]]));(ws_re$5240=RegExp("(?:^(?: *)(?:(?:\n(?: *)\\\\(?: *))*))",""));(eol_re$5241=RegExp("(?:^(?: *)(?:\n|$))",""));(produce$5242=function(src$5569){var text$5578;var results$5579;var wsb$5580;var pos$5581;var column$5582;(text$5578=src$5569.text);(results$5579=[]);(wsb$5580=text$5578.match(ws_re$5240)[0].length);(text$5578=text$5578.slice(wsb$5580));(pos$5581=wsb$5580);(column$5582=0);$5601:while(text$5578){var i$5607;(i$5607=0);$5604:for(;(i$5607<regexps$5239.length);(++i$5607)){var t0$5621;var t1$5622;var splits$5671;var skip$5654;var endpos$5655;var wsa$5656;var eol$5657;var bwsb$5658;var bwsa$5659;var token$5660;var re$5617;var fn$5618;var m$5619;(t0$5621=$5161(regexps$5239,i$5607));if(((t0$5621 instanceof Array)&&(((t1$5622=t0$5621.length)),(t1$5622===2)))){(re$5617=t0$5621[0]);(fn$5618=t0$5621[1]);}else{$6973($5161(regexps$5239,i$5607),"/home/olivier/git/earl-grey/src/lex.eg",4024,4044);}(m$5619=text$5578.match(re$5617));if(m$5619){(skip$5654=m$5619[0].length);(endpos$5655=(pos$5581+skip$5654));(column$5582=(((splits$5671=m$5619[0].split("\n"))),function(){if((splits$5671.length>1)){return $5161(splits$5671,(splits$5671.length-1)).length;}else{return (column$5582+skip$5654);}}()));(text$5578=text$5578.slice(skip$5654));(wsa$5656=text$5578.match(ws_re$5240)[0].length);(eol$5657=(text$5578.match(eol_re$5241)&&true));(bwsb$5658=(wsb$5580>0));(bwsa$5659=function(){if(eol$5657){return bwsb$5658;}else{return (wsa$5656>0);}}());(token$5660=fn$5618(m$5619,column$5582));(token$5660["wsb"]=bwsb$5658);(token$5660["wsa"]=bwsa$5659);(token$5660["location"]=Location$5236(src$5569,pos$5581,endpos$5655));results$5579.push(token$5660);(text$5578=text$5578.slice(wsa$5656));(column$5582=(column$5582+wsa$5656));(wsb$5580=wsa$5656);(pos$5581=(endpos$5655+wsa$5656));break $5604;}}}return results$5579;});(indent_tracker$5243=function(){var curr$5725;var stack$5726;var stacks$5727;(curr$5725=0);(stack$5726=[]);(stacks$5727=[stack$5726]);return function($5723$5738){var t0$5761;var rval$5829;var $index$5909;var $length$5903;var temp$5897;var acc$5891;var rval$5883;var x$5940;var $index$5968;var $length$5962;var temp$5956;var acc$5950;var other$5989;var fixity$5870;var fixity$5850;var stuff$5845;var new_indent$5786;var $5742$5787;var $5754$5780;var $5755$5781;var $5756$5782;var $5757$5783;var t0$5775;var t1$5776;var bridge$5749$5777;var bridge$5751$5778;var $5740$5770;var ph$5758;var token$5759;(t0$5761=$5723$5738);(token$5759=t0$5761);(ph$5758=t0$5761);($5740$5770=ph$5758);if((($5754$5780=($5740$5770 instanceof Array))&&(((t0$5775=$5740$5770.length)),((t0$5775===2)&&($5740$5770[0]==="INDENT"))))){(t1$5776=$5740$5770[1]);(new_indent$5786=t1$5776);($5742$5787=t1$5776);$5742$5787;if((curr$5725===false)){(curr$5725=new_indent$5786);return [$7298(["OP","IFX",","],({"wsb":true,"wsa":true}))];}else{if(($5742$5787>curr$5725)){stack$5726.push(curr$5725);(curr$5725=new_indent$5786);return [$7298(["OP","PFX","["],({"wsb":true,"wsa":true}))];}else{if(($5742$5787===curr$5725)){return [$7298(["OP","IFX",","],({"wsb":true,"wsa":true}))];}else{if(($5742$5787<curr$5725)){(rval$5829=[]);$5833:while(((stack$5726.length>0)&&(new_indent$5786<curr$5725))){(curr$5725=stack$5726.pop());rval$5829.push($7298(["OP","SFX","]"],({"wsb":true,"wsa":true})));}rval$5829.push($7298(["OP","IFX",","],({"wsb":true,"wsa":true})));return rval$5829;}else{$6973($5742$5787,"/home/olivier/git/earl-grey/src/lex.eg",5401,5417);}}}}}else{if(($5754$5780&&((t0$5775>=1)&&($5740$5770[0]==="ID")))){(stuff$5845=Array.prototype.slice.call($5740$5770,1));return [token$5759];}else{if(($5754$5780&&(($5756$5782=(t0$5775===3))&&(($5757$5783=($5740$5770[0]==="OP"))&&((fixity$5850=$5740$5770[1]),(((bridge$5749$5777=$5740$5770[2])),((bridge$5749$5777==="[")||(bridge$5749$5777==="{")))))))){stack$5726.push(curr$5725);stacks$5727.push(stack$5726);(stack$5726=[]);(curr$5725=false);return [token$5759];}else{if(($5757$5783&&((fixity$5870=$5740$5770[1]),(((bridge$5751$5778=$5740$5770[2])),((bridge$5751$5778==="]")||(bridge$5751$5778==="}")))))){(rval$5883=(((acc$5891=[])),(((temp$5897=stack$5726)),((($length$5903=temp$5897.length)),((($index$5909=0)),function(){$5886:for(;($index$5909<$length$5903);($index$5909++)){var m$5918;(m$5918=temp$5897[$index$5909]);m$5918;acc$5891.push($7298(["OP","SFX","]"],({"wsb":true,"wsa":true})));}}()))),acc$5891));(stack$5726=stacks$5727.pop());(curr$5725=stack$5726.pop());rval$5883.push(token$5759);return rval$5883;}else{if((((x$5940=$5740$5770)),((x$5940 instanceof Array)&&(x$5940[0]==="EOF")))){(acc$5950=[]);(temp$5956=stack$5726);($length$5962=temp$5956.length);($index$5968=0);$5945:for(;($index$5968<$length$5962);($index$5968++)){var m$5977;(m$5977=temp$5956[$index$5968]);m$5977;acc$5950.push($7298(["OP","SFX","]"],({"wsb":true,"wsa":true})));}return acc$5950;}else{(other$5989=$5740$5770);return [token$5759];}}}}}};});(process_indent$5244=function(stream$5996){var $index$6027;var $length$6021;var temp$6015;var tracker$6001;var results$6002;(tracker$6001=indent_tracker$5243());(results$6002=[]);(temp$6015=stream$5996);($length$6021=temp$6015.length);($index$6027=0);$6003:for(;($index$6027<$length$6021);($index$6027++)){var token$6044;var m$6036;(m$6036=temp$6015[$index$6027]);(token$6044=m$6036);(results$6002=results$6002.concat(tracker$6001(token$6044)));}return results$6002.concat(tracker$6001(["EOF"]));});(disambiguate_fixity$5245=function(stream$6051){var $index$6535;var $length$6529;var temp$6523;var __lt____lt____lt____colon__$6060;var collapse_operators$6061;var buffer$6062;var pfx$6063;var collapse$6064;var results$6065;(__lt____lt____lt____colon__$6060=function(a$6081,b$6082){(a$6081["wsb"]=b$6082.wsb);(a$6081["wsa"]=b$6082.wsa);return __lt____lt____colon__$5237(a$6081,b$6082);});(collapse_operators$6061=function(){var msg$6202;var longer$6198;var token$6175;var fixity$6176;var name$6177;var t0$6169;var t1$6170;var t2$6171;var $6159$6164;var $index$6233;var $length$6227;var temp$6221;var acc$6215;var $index$6296;var $length$6290;var temp$6284;var acc$6278;var t0$6349;var t1$6350;var t2$6351;var t3$6352;var t0$6397;var t0$6404;var t0$6457;var t0$6464;var t1$6465;var t2$6466;var bridge$6438$6447;var $6436$6442;var t$6433;var results$6427;var $6341$6386;var $6342$6387;var $6343$6388;var bridge$6338$6383;var t0$6384;var $6336$6378;var first$6344;var fixity$6345;var name$6346;var rest$6347;var n$6139;var $6106$6133;var $6107$6134;var $6108$6135;var $6109$6136;var t0$6130;var t1$6131;var buffer$6121;var $6100$6122;var t0$6117;var $6098$6112;($6098$6112=arguments);(t0$6117=$6098$6112.length);if((t0$6117>=1)){(buffer$6121=$6098$6112[0]);($6100$6122=Array.prototype.slice.call($6098$6112,1));(n$6139=buffer$6121.length);$6100$6122;if((!buffer$6121.length)){return [];}else{(t0$6130=$6100$6122);(t1$6131=t0$6130.length);if((($6108$6135=(t1$6131===2))&&(($6109$6136=t0$6130[0])&&t0$6130[1]))){($6159$6164=buffer$6121);if((($6159$6164 instanceof Array)&&(((t0$6169=$6159$6164.length)),((t0$6169===1)&&(((t1$6170=$6159$6164[0])),((token$6175=t1$6170),((t1$6170 instanceof Array)&&(((t2$6171=t1$6170.length)),((t2$6171===3)&&(t1$6170[0]==="OP")))))))))){(fixity$6176=t1$6170[1]);(name$6177=t1$6170[2]);return [__lt____lt____lt____colon__$6060(["ID",name$6177],token$6175)];}else{(longer$6198=$6159$6164);(msg$6202="Too many consecutive operators were found here.");throw $6992(["syntax","nullary"]).create(msg$6202,({"operators":buffer$6121}));}}else{if($6109$6136){t0$6130[1];(acc$6215=[]);(temp$6221=buffer$6121);($length$6227=temp$6221.length);($index$6233=0);$6210:for(;($index$6233<$length$6227);($index$6233++)){var token$6252;var name$6253;var t0$6247;var t1$6248;var m$6242;(m$6242=temp$6221[$index$6233]);(t0$6247=m$6242);(token$6252=t0$6247);if(((t0$6247 instanceof Array)&&(((t1$6248=t0$6247.length)),((t1$6248===3)&&(t0$6247[0]==="OP"))))){t0$6247[1];(name$6253=t0$6247[2]);acc$6215.push(__lt____lt____lt____colon__$6060(["OP","PFX",name$6253],token$6252));}else{$6973(m$6242,"/home/olivier/git/earl-grey/src/lex.eg",7762,7856);}}return acc$6215;}else{if(($6108$6135&&(t0$6130[0],t0$6130[1]))){(acc$6278=[]);(temp$6284=buffer$6121);($length$6290=temp$6284.length);($index$6296=0);$6273:for(;($index$6296<$length$6290);($index$6296++)){var token$6315;var name$6316;var t0$6310;var t1$6311;var m$6305;(m$6305=temp$6284[$index$6296]);(t0$6310=m$6305);(token$6315=t0$6310);if(((t0$6310 instanceof Array)&&(((t1$6311=t0$6310.length)),((t1$6311===3)&&(t0$6310[0]==="OP"))))){t0$6310[1];(name$6316=t0$6310[2]);acc$6278.push(__lt____lt____lt____colon__$6060(["OP","SFX",name$6316],token$6315));}else{$6973(m$6305,"/home/olivier/git/earl-grey/src/lex.eg",7869,7963);}}return acc$6278;}else{$6100$6122;(t0$6349=buffer$6121);if(((t0$6349 instanceof Array)&&(((t1$6350=t0$6349.length)),((t1$6350>=1)&&(((t2$6351=t0$6349[0])),((first$6344=t2$6351),((t2$6351 instanceof Array)&&(((t3$6352=t2$6351.length)),((t3$6352===3)&&(t2$6351[0]==="OP")))))))))){(fixity$6345=t2$6351[1]);(name$6346=t2$6351[2]);(rest$6347=Array.prototype.slice.call(t0$6349,1));}else{$6973(buffer$6121,"/home/olivier/git/earl-grey/src/lex.eg",8016,8022);}($6336$6378=[first$6344.wsb,first$6344.wsa]);(bridge$6338$6383=$6336$6378);if((((bridge$6338$6383 instanceof Array)&&(((t0$6397=bridge$6338$6383.length)),((t0$6397===2)&&((!bridge$6338$6383[0])&&(!bridge$6338$6383[1])))))||((bridge$6338$6383 instanceof Array)&&(((t0$6404=bridge$6338$6383.length)),((t0$6404===2)&&(bridge$6338$6383[0]&&bridge$6338$6383[1])))))){return [__lt____lt____lt____colon__$6060(["OP","IFX",name$6346],first$6344)].concat(collapse_operators$6061(rest$6347,true,false));}else{if((($6341$6386=($6336$6378 instanceof Array))&&(((t0$6384=$6336$6378.length)),(($6343$6388=(t0$6384===2))&&$6336$6378[0])))){$6336$6378[1];return [__lt____lt____lt____colon__$6060(["OP","PFX",name$6346],first$6344)].concat(collapse_operators$6061(rest$6347,true,false));}else{if(($6343$6388&&($6336$6378[0],$6336$6378[1]))){(results$6427=collapse_operators$6061(rest$6347,false,false));(t$6433=((($6436$6442=results$6427)),(((bridge$6438$6447=$6436$6442)),function(){if((((bridge$6438$6447 instanceof Array)&&(((t0$6457=bridge$6438$6447.length)),(t0$6457===0)))||((bridge$6438$6447 instanceof Array)&&(((t0$6464=bridge$6438$6447.length)),((t0$6464>=1)&&(((t1$6465=bridge$6438$6447[0])),((t1$6465 instanceof Array)&&(((t2$6466=t1$6465.length)),((t2$6466>=2)&&((t1$6465[0]==="OP")&&((t1$6465[1]==="PFX")&&(Array.prototype.slice.call(t1$6465,2),(Array.prototype.slice.call(bridge$6438$6447,1),true))))))))))))){return ["OP","IFX",name$6346];}else{$6436$6442;return ["OP","SFX",name$6346];}}())));return [__lt____lt____lt____colon__$6060(t$6433,first$6344)].concat(results$6427);}else{$6973($6336$6378);}}}}}}}}else{$6973($6098$6112);}});(buffer$6062=[]);(pfx$6063=true);(collapse$6064=function(sfx$6504){var rval$6509;(rval$6509=collapse_operators$6061(buffer$6062,pfx$6063,sfx$6504));(buffer$6062=[]);return rval$6509;});(results$6065=[]);(temp$6523=stream$6051);($length$6529=temp$6523.length);($index$6535=0);$6066:for(;($index$6535<$length$6529);($index$6535++)){var other$6616;var name$6566;var $6071$6567;var t0$6561;var t1$6562;var token$6553;var $6069$6554;var t0$6549;var m$6544;(m$6544=temp$6523[$index$6535]);(t0$6549=m$6544);(token$6553=t0$6549);($6069$6554=t0$6549);(t0$6561=$6069$6554);if(((t0$6561 instanceof Array)&&(((t1$6562=t0$6561.length)),((t1$6562===3)&&(t0$6561[0]==="OP"))))){($6071$6567=t0$6561[1]);(name$6566=t0$6561[2]);if(($6071$6567==="?FX")){buffer$6062.push(token$6553);}else{if(($6071$6567==="IFX")){(results$6065=results$6065.concat(collapse$6064(true)));results$6065.push(token$6553);(pfx$6063=true);}else{if(($6071$6567==="PFX")){(results$6065=results$6065.concat(collapse$6064(false)));results$6065.push(token$6553);(pfx$6063=true);}else{if(($6071$6567==="SFX")){(results$6065=results$6065.concat(collapse$6064(true)));results$6065.push(token$6553);(pfx$6063=false);}else{$6973($6071$6567,"/home/olivier/git/earl-grey/src/lex.eg",8832,8837);}}}}}else{(other$6616=$6069$6554);(results$6065=results$6065.concat(collapse$6064(false)));results$6065.push(token$6553);(pfx$6063=false);}}return results$6065.concat(collapse$6064(true));});(alternate_operators$5246=function(stream$6628){var $index$6673;var $length$6667;var temp$6661;var W$6634;var last_op$6635;var results$6636;(W$6634=function(x$6649){if(x$6649){return "wide";}else{return "short";}});(last_op$6635=true);(results$6636=[]);(temp$6661=stream$6628);($length$6667=temp$6661.length);($index$6673=0);$6637:for(;($index$6673<$length$6667);($index$6673++)){var x$6707;var $6728$6735;var x$6776;var token$6783;var fixity$6714;var name$6715;var t0$6699;var t1$6700;var token$6691;var $6640$6692;var t0$6687;var m$6682;(m$6682=temp$6661[$index$6673]);(t0$6687=m$6682);(token$6691=t0$6687);($6640$6692=t0$6687);if((((x$6707=$6640$6692)),((x$6707 instanceof Array)&&(x$6707[0]==="IGNORE")))){null;}else{(t0$6699=$6640$6692);if(((t0$6699 instanceof Array)&&(((t1$6700=t0$6699.length)),((t1$6700===3)&&(t0$6699[0]==="OP"))))){(fixity$6714=t0$6699[1]);(name$6715=t0$6699[2]);if(last_op$6635){results$6636.push(["VOID"]);}($6728$6735=fixity$6714);if(($6728$6735==="IFX")){results$6636.push(__lt____lt____colon__$5237(["IFX",W$6634((token$6691.wsa||token$6691.wsb)),name$6715],token$6691));(last_op$6635=true);}else{if(($6728$6735==="PFX")){if((!last_op$6635)){results$6636.push(["IFX",W$6634(token$6691.wsb),"WHITE"],["VOID"]);}results$6636.push(__lt____lt____colon__$5237(["PFX",W$6634(token$6691.wsa),name$6715],token$6691));(last_op$6635=true);}else{if(($6728$6735==="SFX")){results$6636.push(__lt____lt____colon__$5237(["SFX",W$6634(token$6691.wsb),name$6715],token$6691),["VOID"]);(last_op$6635=false);}else{$6973($6728$6735);}}}}else{if((((x$6776=$6640$6692)),((x$6776 instanceof Array)&&(x$6776[0]==="ILLEGAL")))){throw $6992(["syntax","illegal"]).create("unknown character",({"chr":token$6691}));}else{(token$6783=$6640$6692);if((!last_op$6635)){results$6636.push(["IFX",W$6634(token$6783.wsb),"WHITE"]);}results$6636.push(token$6783);(last_op$6635=false);}}}}if(last_op$6635){results$6636.push(["VOID"]);}return results$6636;});(fill_locations$5247=function(source$6797,stream$6798){var $index$6895;var $length$6889;var temp$6883;var to_fill$6804;var start$6805;var fill$6806;(to_fill$6804=[]);(start$6805=0);(fill$6806=function(end$6821){var $index$6844;var $length$6838;var temp$6832;(temp$6832=to_fill$6804);($length$6838=temp$6832.length);($index$6844=0);$6825:for(;($index$6844<$length$6838);($index$6844++)){var token$6870;var token$6861;var m$6853;(m$6853=temp$6832[$index$6844]);(token$6861=m$6853);if(($index$6844===0)){(token$6861["location"]=Location$5236(source$6797,start$6805,end$6821));}else{(token$6870=m$6853);(token$6870["location"]=Location$5236(source$6797,end$6821,end$6821));}}(to_fill$6804=[]);});(temp$6883=stream$6798);($length$6889=temp$6883.length);($index$6895=0);$6807:for(;($index$6895<$length$6889);($index$6895++)){var other$6928;var location$6913;var t0$6909;var m$6904;(m$6904=temp$6883[$index$6895]);(t0$6909=m$6904);if(($7404(t0$6909,"location")&&((location$6913=t0$6909.location),location$6913))){fill$6806(location$6913.start);(start$6805=location$6913.end);}else{(other$6928=m$6904);to_fill$6804.push(other$6928);}}fill$6806(source$6797.text.length);return stream$6798;});(tokenize$5248=function(src$6935){var it$0$6963;var it$0$6957;var it$0$6951;var it$0$6945;var it$0$6939;(it$0$6939=src$6935);(it$0$6945=produce$5242(it$0$6939));(it$0$6951=process_indent$5244(it$0$6945));(it$0$6957=disambiguate_fixity$5245(it$0$6951));(it$0$6963=alternate_operators$5246(it$0$6957));return fill_locations$5247(src$6935,it$0$6963);});(exports["tokenize"]=tokenize$5248);
