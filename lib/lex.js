var $4214=function(type$4216){var f$4219;(f$4219=type$4216["::check"]);if((f$4219===(void 0))){return function(value$4224){return (value$4224 instanceof type$4216);};}else{return function(value$4227){return f$4219.call(type$4216,value$4227);};}};
var $4229=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $4230=function(dest$4232,values$4233){var k$4238;(k$4238=null);$4236:for(k$4238 in values$4233){if(values$4233.hasOwnProperty(k$4238)){(dest$4232[k$4238]=values$4233[k$4238]);}}return dest$4232;};
var $4245=function($4246$4248){var ph$4252;(ph$4252=$4246$4248);var $4250$4257;($4250$4257=ph$4252);var bridge$4251$4262;var x$4266;(bridge$4251$4262=$4250$4257);if((((typeof(bridge$4251$4262)==="string")&&((x$4266=bridge$4251$4262),true))||((typeof(bridge$4251$4262)==="number")&&((x$4266=bridge$4251$4262),true)))){return ["value",x$4266];}else{var other$4276;(other$4276=$4250$4257);return other$4276["::serialize_ast"]();}};
var send$4021;(send$4021=function(obj$4026,$4024$4027){var ph$4031;var msg$4032;var t0$4034;(t0$4034=$4024$4027);(msg$4032=t0$4034);(ph$4031=t0$4034);var $4029$4041;($4029$4041=ph$4031);var bridge$4030$4046;(bridge$4030$4046=$4029$4041);if(((typeof(bridge$4030$4046)==="string")||(typeof(bridge$4030$4046)==="number"))){return obj$4026[msg$4032];}else{var other$4057;(other$4057=$4029$4041);return obj$4026["::send"](msg$4032);}});(Array[":::project"]=function($4062$4064){var ph$4067;var value$4068;var t0$4070;(t0$4070=$4062$4064);(value$4068=t0$4070);(ph$4067=t0$4070);var $4066$4077;($4066$4077=ph$4067);if($4214(Array)($4066$4077)){return [true,value$4068];}else{$4066$4077;return [true,[value$4068]];}});(Array.prototype["::check"]=function(value$4094){if((value$4094 instanceof Array)){var i$4099;(i$4099=0);$4097:for(;(i$4099<this.length);(i$4099++)){if(($4229(this,i$4099)!==$4229(value$4094,i$4099))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $4230(this.slice(0),this);});(Array.prototype[":::project"]=function(value$4116){if((value$4116 instanceof Array)){var i$4121;(i$4121=0);$4119:for(;(i$4121<this.length);(i$4121++)){if(($4229(this,i$4121)!==$4229(value$4116,i$4121))){return [true,[value$4116]];}}return [true,value$4116.slice(this.length)];}else{return [true,[value$4116]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($4245));});(RegExp.prototype["::check"]=function($4137$4139){var ph$4142;(ph$4142=$4137$4139);var $4141$4147;($4141$4147=ph$4142);var value$4155;if((typeof($4141$4147)==="string")){(value$4155=$4141$4147);if(value$4155.match(this)){return true;}else{return false;}}else{var other$4160;(other$4160=$4141$4147);return false;}});(RegExp.prototype[":::project"]=function($4165$4167){var ph$4170;(ph$4170=$4165$4167);var $4169$4175;($4169$4175=ph$4170);var value$4183;if((typeof($4169$4175)==="string")){(value$4183=$4169$4175);var $4186$4188;($4186$4188=value$4183.match(this));var m$4196;if(($4186$4188===null)){(m$4196=$4186$4188);return [false,null];}else{var m$4201;(m$4201=$4186$4188);return [true,m$4201];}}else{var other$4205;(other$4205=$4169$4175);return [false,null];}});(Function.prototype["::send"]=function(args$4211){return this.apply(this,args$4211);});
var $5951=function(arr$5953){var results$5957;var l$5958;(results$5957=[]);(l$5958=arr$5953.length);var i$5966;(i$5966=0);$5956:for(;(i$5966<l$5958);(i$5966++)){results$5957.push([i$5966,$4229(arr$5953,i$5966)]);}return results$5957;};
var $5755=function(){var $5756$5758;($5756$5758=function(tags$5762){var it$0$5765;(it$0$5765=function(){if((!$4214($5756$5758)(this))){return Object.create($5756$5758.prototype);}else{return this;}}());(it$0$5765["tags"]=tags$5762);return it$0$5765;});($5756$5758.prototype["create"]=function(){var $5777$5779;($5777$5779=arguments);var t0$5784;var message$5788;var args$5789;(t0$5784=$5777$5779.length);if((t0$5784>=0)){(message$5788=function(){if((0>=t0$5784)){return "";}else{return $5777$5779[0];}}());(args$5789=Array.prototype.slice.call($5777$5779,1));var it$0$5796;(it$0$5796=this);var self$5801;(self$5801=this);var e$5806;(e$5806=Error(message$5788));(e$5806["::tags"]=it$0$5796.tags);(e$5806["args"]=args$5789);var temp$5820;(temp$5820=$5951(args$5789));var $length$5825;($length$5825=temp$5820.length);var $index$5830;($index$5830=0);$5807:for(;($index$5830<$length$5825);($index$5830++)){var m$5838;(m$5838=temp$5820[$index$5830]);var t0$5843;var t1$5844;var i$5848;var arg$5849;(t0$5843=m$5838);if(((t0$5843 instanceof Array)&&(((t1$5844=t0$5843.length)),(t1$5844===2)))){(i$5848=t0$5843[0]);(arg$5849=t0$5843[1]);(e$5806[i$5848]=arg$5849);}else{$5739(m$5838);}}(e$5806["length"]=args$5789.length);(e$5806["name"]=["E"].concat(it$0$5796.tags).join("."));return e$5806;}else{$5739($5777$5779);}});($5756$5758.prototype["::check"]=function(e$5875){var it$0$5878;(it$0$5878=this);var self$5883;(self$5883=this);var tags$5888;if(((!e$5875)||(!$4214(Error)(e$5875)))){return false;}(tags$5888=(e$5875["::tags"]||[]));var temp$5897;(temp$5897=it$0$5878.tags);var $length$5902;($length$5902=temp$5897.length);var $index$5907;($index$5907=0);$5889:for(;($index$5907<$length$5902);($index$5907++)){var m$5915;(m$5915=temp$5897[$index$5907]);var tag$5923;(tag$5923=m$5915);if((tags$5888.indexOf(tag$5923)===-1)){return false;}else{false;}}return true;});($5756$5758.prototype["::deconstruct"]=function(e$5931){var it$0$5934;(it$0$5934=this);var self$5939;(self$5939=this);return e$5931.args;});$4230($5756$5758,$4230(function(){var accum$5944;(accum$5944=({}));(accum$5944["::name"]="$5756");return accum$5944;}(),function(){var accum$5948;(accum$5948=({}));(accum$5948["::egclass"]=true);return accum$5948;}()));return $5756$5758;}();
var $5739=function(value$5741,url$5742,start$5743,end$5744){var err$5747;(err$5747=$5755(["match"]).create("Could not find a match for value",({"value":value$5741})));if(url$5742){(err$5747["location"]=["location",url$5742,start$5743,end$5744]);}throw err$5747;};
var $5973=function(type$5975){return function(value$5978){var f$5981;(f$5981=type$5975[":::project"]);if((f$5981===(void 0))){(f$5981=type$5975["::project"]);if((f$5981===(void 0))){return [true,type$5975(value$5978)];}else{var rval$5990;(rval$5990=false);try{(rval$5990=[true,f$5981(value$5978)]);}catch(excv$5999){var e$6005;(e$6005=excv$5999);(rval$5990=[false,null]);}return rval$5990;}}else{return f$5981.call(type$5975,value$5978);}};};
var $6100=function($6101$6103,key$6104){var ph$6108;(ph$6108=$6101$6103);var $6106$6113;($6106$6113=ph$6108);var bridge$6107$6118;(bridge$6107$6118=$6106$6113);if(((bridge$6107$6118===null)||(bridge$6107$6118===(void 0)))){return false;}else{var x$6129;if((typeof($6106$6113)==="string")){(x$6129=$6106$6113);return (key$6104 in String.prototype);}else{var x$6134;if((typeof($6106$6113)==="number")){(x$6134=$6106$6113);return (key$6104 in Number.prototype);}else{var x$6139;(x$6139=$6106$6113);return (key$6104 in x$6139);}}}};
var $6029=function($6030$6032){var ph$6038;var x$6039;var t0$6041;(t0$6041=$6030$6032);(x$6039=t0$6041);(ph$6038=t0$6041);var $6034$6048;($6034$6048=ph$6038);var bridge$6035$6053;(bridge$6035$6053=$6034$6048);if((function(){var bridge$6036$6062;(bridge$6036$6062=bridge$6035$6053);return (function(){var bridge$6037$6068;(bridge$6037$6068=bridge$6036$6062);return ((bridge$6037$6068===(void 0))||(bridge$6037$6068===null));}()||(typeof(bridge$6036$6062)==="string"));}()||(typeof(bridge$6035$6053)==="number"))){return x$6039;}else{if($6100($6034$6048,"::clone")){$6034$6048["::clone"];return x$6039["::clone"]();}else{$6034$6048;if((Object.getPrototypeOf(x$6039)===Object.prototype)){var dest$6084;(dest$6084=({}));var k$6089;(k$6089=null);$6083:for(k$6089 in x$6039){if(Object.prototype.hasOwnProperty.call(x$6039,k$6089)){(dest$6084[k$6089]=x$6039[k$6089]);}}return dest$6084;}else{var other$6098;(other$6098=$6034$6048);throw $5755(["clone"]).create("Object cannot be cloned",({"obj":x$6039}));}}}};
var $6010=function(a$6012,b$6013){var dest$6017;(dest$6017=$6029(a$6012));var k$6022;(k$6022=null);$6016:for(k$6022 in b$6013){if(Object.prototype.hasOwnProperty.call(b$6013,k$6022)){(dest$6017[k$6022]=b$6013[k$6022]);}}return dest$6017;};var id$4310;var id_f$4311;var numr$4312;var numr_f$4313;var num$4314;var num_f$4315;var str$4316;var str_f$4317;var op$4318;var op2$4319;var op3$4320;var op4$4321;var op_f$4322;var indent$4323;var indent_f$4324;var cmnt$4325;var cmnt_f$4326;var unkn$4327;var unkn_f$4328;var $4280$4281;var Location$4282;var __lt____lt____colon__$4283;var special_ops$4284;var regexps$4285;var ws_re$4286;var eol_re$4287;var produce$4288;var indent_tracker$4289;var process_indent$4290;var disambiguate_fixity$4291;var alternate_operators$4292;var fill_locations$4293;var tokenize$4294;($4280$4281=require("./location"));(Location$4282=$4280$4281.Location);(__lt____lt____colon__$4283=$4280$4281["<<:"]);(special_ops$4284=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",".":"PFX","'":"PFX","not":"PFX"}));(regexps$4285=(((id$4310=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))",""))),((id_f$4311=function(m$4335){return ["ID",m$4335[0]];})),((numr$4312=RegExp("(?:^((?:\\d+))[rR]((?:[A-Za-z0-9_]+))(?:(?:\\.((?:[A-Za-z0-9_]+)))?))",""))),((numr_f$4313=function(m$4344){var t0$4352;var t1$4353;var frac$4369;var radix$4347;var intp$4348;var frac$4349;var value$4350;(t0$4352=m$4344);if(((t0$4352 instanceof Array)&&(((t1$4353=t0$4352.length)),(t1$4353===4)))){t0$4352[0];(radix$4347=t0$4352[1]);(intp$4348=t0$4352[2]);(frac$4349=t0$4352[3]);}else{$5739(m$4344,"/home/olivier/git/earl-grey/src/lex.eg",993,994);}(value$4350=parseInt(intp$4348.replace(RegExp("_","g"),""),radix$4347));if(frac$4349){(frac$4369=frac$4349.replace(RegExp("_","g"),""));(value$4350=(value$4350+(parseInt(frac$4349,radix$4347)/Math.pow(radix$4347,frac$4349.length))));}return ["NUM",value$4350];})),((num$4314=RegExp("(?:^((?:[0-9_]+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:[0-9_]+)))?))",""))),((num_f$4315=function(m$4383){return ["NUM",parseFloat(m$4383[0].replace(RegExp("_","g"),""))];})),((str$4316=RegExp("(?:^\"((?:(?:(?:\\\\.)|[^\"])*))\")",""))),((str_f$4317=function(m$4392){var rx$4403;var f$4404;var repl$4395;var r$4396;(repl$4395=({"b":String.fromCharCode(8),"f":String.fromCharCode(12),"n":"\n","r":String.fromCharCode(13),"t":String.fromCharCode(9)}));(r$4396=(((rx$4403=RegExp("\\\\u[0-9A-Fa-f]{4}|\\\\x[0-9A-Fa-f]{2}|\\\\.","g"))),((f$4404=function($4410$4412){var chr$4447;var digits$4431;var t0$4425;var t1$4426;var t2$4427;var $4414$4420;var ph$4415;(ph$4415=$4410$4412);($4414$4420=ph$4415);(t0$4425=$5973(RegExp("^(?:\\\\u|\\\\x)(.*)",""))($4414$4420));if((t0$4425[0]&&(((t1$4426=t0$4425[1])),(((t2$4427=t1$4426.length)),(t2$4427===2))))){t1$4426[0];(digits$4431=t1$4426[1]);return String.fromCharCode(parseInt(digits$4431,16));}else{(t0$4425=$5973(RegExp("^.(.)",""))($4414$4420));if((t0$4425[0]&&(((t1$4426=t0$4425[1])),(((t2$4427=t1$4426.length)),(t2$4427===2))))){t1$4426[0];(chr$4447=t1$4426[1]);return ($4229(repl$4395,chr$4447)||chr$4447);}else{$5739($4414$4420);}}})),m$4392[1].replace(rx$4403,f$4404)));return ["STR",r$4396];})),((op$4318=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!@#.:']+))",""))),((op2$4319=RegExp("(?:^[\\[\\{\\}\\],])",""))),((op3$4320=RegExp("(?:^(?:(?:(?:(?:(?:(?:(?:(?:(?:with|where)|when)|and)|not)|or)|in)|mod)|each)|as)(?:(?:[+\\-*/~\\^<>=%&|?!@#.:']+)|\\b))",""))),((op4$4321=RegExp("(?:^`((?:[A-Za-z0-9_]+))`)",""))),((op_f$4322=function(m$4481,column$4482){var fixity$4508;var otherwise$4514;var $4486$4498;var $4485$4492;var op$4487;(op$4487=(m$4481[1]||m$4481[0]));($4485$4492=null);$4485$4492;if((op$4487==="|")){return ["INDENT",(column$4482-1)];}else{if((op$4487 in special_ops$4284)){(fixity$4508=$4229(special_ops$4284,op$4487));return ["OP",fixity$4508,op$4487];}else{(otherwise$4514=$4485$4492);return ["OP","?FX",op$4487];}}})),((indent$4323=RegExp("(?:^(?:(?:\n(?: *);(?:[^\n]*))*)(?:(?:\n((?: *)))+))",""))),((indent_f$4324=function(m$4523){var ilen$4526;(ilen$4526=m$4523[1].length);return ["INDENT",ilen$4526];})),((cmnt$4325=RegExp("(?:^;(?:[^\n]*))",""))),((cmnt_f$4326=function(m$4537){return ["IGNORE"];})),((unkn$4327=RegExp("(?:^.)",""))),((unkn_f$4328=function(m$4546){return ["ILLEGAL",m$4546[0]];})),[[op3$4320,op_f$4322],[id$4310,id_f$4311],[numr$4312,numr_f$4313],[num$4314,num_f$4315],[str$4316,str_f$4317],[op$4318,op_f$4322],[op2$4319,op_f$4322],[op4$4321,op_f$4322],[indent$4323,indent_f$4324],[cmnt$4325,cmnt_f$4326],[unkn$4327,unkn_f$4328]]));(ws_re$4286=RegExp("(?:^(?: *)(?:(?:\n(?: *)\\\\(?: *))*))",""));(eol_re$4287=RegExp("(?:^(?: *)(?:\n|$))",""));(produce$4288=function(src$4559){var text$4562;var results$4563;var wsb$4564;var pos$4565;var column$4566;(text$4562=src$4559.text);(results$4563=[]);(wsb$4564=text$4562.match(ws_re$4286)[0].length);(text$4562=text$4562.slice(wsb$4564));(pos$4565=wsb$4564);(column$4566=0);$4585:while(text$4562){var i$4590;(i$4590=0);$4588:for(;(i$4590<regexps$4285.length);(++i$4590)){var t0$4602;var t1$4603;var splits$4634;var skip$4618;var endpos$4619;var wsa$4620;var eol$4621;var bwsb$4622;var bwsa$4623;var token$4624;var re$4598;var fn$4599;var m$4600;(t0$4602=$4229(regexps$4285,i$4590));if(((t0$4602 instanceof Array)&&(((t1$4603=t0$4602.length)),(t1$4603===2)))){(re$4598=t0$4602[0]);(fn$4599=t0$4602[1]);}else{$5739($4229(regexps$4285,i$4590),"/home/olivier/git/earl-grey/src/lex.eg",4023,4043);}(m$4600=text$4562.match(re$4598));if(m$4600){(skip$4618=m$4600[0].length);(endpos$4619=(pos$4565+skip$4618));(column$4566=(((splits$4634=m$4600[0].split("\n"))),function(){if((splits$4634.length>1)){return $4229(splits$4634,(splits$4634.length-1)).length;}else{return (column$4566+skip$4618);}}()));(text$4562=text$4562.slice(skip$4618));(wsa$4620=text$4562.match(ws_re$4286)[0].length);(eol$4621=(text$4562.match(eol_re$4287)&&true));(bwsb$4622=(wsb$4564>0));(bwsa$4623=function(){if(eol$4621){return bwsb$4622;}else{return (wsa$4620>0);}}());(token$4624=fn$4599(m$4600,column$4566));(token$4624["wsb"]=bwsb$4622);(token$4624["wsa"]=bwsa$4623);(token$4624["location"]=Location$4282(src$4559,pos$4565,endpos$4619));results$4563.push(token$4624);(text$4562=text$4562.slice(wsa$4620));(column$4566=(column$4566+wsa$4620));(wsb$4564=wsa$4620);(pos$4565=(endpos$4619+wsa$4620));break $4588;}}}return results$4563;});(indent_tracker$4289=function(){var curr$4682;var stack$4683;var stacks$4684;(curr$4682=0);(stack$4683=[]);(stacks$4684=[stack$4683]);return function($4681$4695){var t0$4708;var rval$4769;var $index$4836;var $length$4831;var temp$4826;var acc$4821;var rval$4815;var x$4865;var $index$4888;var $length$4883;var temp$4878;var acc$4873;var other$4908;var fixity$4806;var fixity$4789;var stuff$4784;var new_indent$4731;var $4698$4732;var $4701$4725;var $4702$4726;var $4703$4727;var $4704$4728;var t0$4720;var t1$4721;var bridge$4699$4722;var bridge$4700$4723;var $4697$4715;var ph$4705;var token$4706;(t0$4708=$4681$4695);(token$4706=t0$4708);(ph$4705=t0$4708);($4697$4715=ph$4705);if((($4701$4725=($4697$4715 instanceof Array))&&(((t0$4720=$4697$4715.length)),((t0$4720===2)&&($4697$4715[0]==="INDENT"))))){(t1$4721=$4697$4715[1]);(new_indent$4731=t1$4721);($4698$4732=t1$4721);$4698$4732;if((curr$4682===false)){(curr$4682=new_indent$4731);return [$6010(["OP","IFX",","],({"wsb":true,"wsa":true}))];}else{if(($4698$4732>curr$4682)){stack$4683.push(curr$4682);(curr$4682=new_indent$4731);return [$6010(["OP","PFX","["],({"wsb":true,"wsa":true}))];}else{if(($4698$4732===curr$4682)){return [$6010(["OP","IFX",","],({"wsb":true,"wsa":true}))];}else{if(($4698$4732<curr$4682)){(rval$4769=[]);$4773:while(((stack$4683.length>0)&&(new_indent$4731<curr$4682))){(curr$4682=stack$4683.pop());rval$4769.push($6010(["OP","SFX","]"],({"wsb":true,"wsa":true})));}rval$4769.push($6010(["OP","IFX",","],({"wsb":true,"wsa":true})));return rval$4769;}else{$5739($4698$4732,"/home/olivier/git/earl-grey/src/lex.eg",5400,5416);}}}}}else{if(($4701$4725&&((t0$4720>=1)&&($4697$4715[0]==="ID")))){(stuff$4784=Array.prototype.slice.call($4697$4715,1));return [token$4706];}else{if(($4701$4725&&(($4703$4727=(t0$4720===3))&&(($4704$4728=($4697$4715[0]==="OP"))&&((fixity$4789=$4697$4715[1]),(((bridge$4699$4722=$4697$4715[2])),((bridge$4699$4722==="[")||(bridge$4699$4722==="{")))))))){stack$4683.push(curr$4682);stacks$4684.push(stack$4683);(stack$4683=[]);(curr$4682=false);return [token$4706];}else{if(($4704$4728&&((fixity$4806=$4697$4715[1]),(((bridge$4700$4723=$4697$4715[2])),((bridge$4700$4723==="]")||(bridge$4700$4723==="}")))))){(rval$4815=(((acc$4821=[])),(((temp$4826=stack$4683)),((($length$4831=temp$4826.length)),((($index$4836=0)),function(){$4818:for(;($index$4836<$length$4831);($index$4836++)){var m$4844;(m$4844=temp$4826[$index$4836]);m$4844;acc$4821.push($6010(["OP","SFX","]"],({"wsb":true,"wsa":true})));}}()))),acc$4821));(stack$4683=stacks$4684.pop());(curr$4682=stack$4683.pop());rval$4815.push(token$4706);return rval$4815;}else{if((((x$4865=$4697$4715)),((x$4865 instanceof Array)&&(x$4865[0]==="EOF")))){(acc$4873=[]);(temp$4878=stack$4683);($length$4883=temp$4878.length);($index$4888=0);$4870:for(;($index$4888<$length$4883);($index$4888++)){var m$4896;(m$4896=temp$4878[$index$4888]);m$4896;acc$4873.push($6010(["OP","SFX","]"],({"wsb":true,"wsa":true})));}return acc$4873;}else{(other$4908=$4697$4715);return [token$4706];}}}}}};});(process_indent$4290=function(stream$4914){var $index$4939;var $length$4934;var temp$4929;var tracker$4917;var results$4918;(tracker$4917=indent_tracker$4289());(results$4918=[]);(temp$4929=stream$4914);($length$4934=temp$4929.length);($index$4939=0);$4919:for(;($index$4939<$length$4934);($index$4939++)){var token$4955;var m$4947;(m$4947=temp$4929[$index$4939]);(token$4955=m$4947);(results$4918=results$4918.concat(tracker$4917(token$4955)));}return results$4918.concat(tracker$4917(["EOF"]));});(disambiguate_fixity$4291=function(stream$4961){var $index$5365;var $length$5360;var temp$5355;var __lt____lt____lt____colon__$4964;var collapse_operators$4965;var buffer$4966;var pfx$4967;var collapse$4968;var results$4969;(__lt____lt____lt____colon__$4964=function(a$4977,b$4978){(a$4977["wsb"]=b$4978.wsb);(a$4977["wsa"]=b$4978.wsa);return __lt____lt____colon__$4283(a$4977,b$4978);});(collapse_operators$4965=function(){var msg$5077;var longer$5074;var token$5054;var fixity$5055;var name$5056;var t0$5048;var t1$5049;var t2$5050;var $5041$5043;var $index$5103;var $length$5098;var temp$5093;var acc$5088;var $index$5158;var $length$5153;var temp$5148;var acc$5143;var t0$5204;var t1$5205;var t2$5206;var t3$5207;var t0$5246;var t0$5252;var t0$5297;var t0$5303;var t1$5304;var t2$5305;var bridge$5281$5288;var $5280$5283;var t$5277;var results$5272;var $5196$5236;var $5197$5237;var $5198$5238;var bridge$5195$5233;var t0$5234;var $5194$5228;var first$5199;var fixity$5200;var name$5201;var rest$5202;var n$5023;var $4993$5018;var $4994$5019;var $4995$5020;var $4996$5021;var t0$5015;var t1$5016;var buffer$5007;var $4992$5008;var t0$5003;var $4991$4998;($4991$4998=arguments);(t0$5003=$4991$4998.length);if((t0$5003>=1)){(buffer$5007=$4991$4998[0]);($4992$5008=Array.prototype.slice.call($4991$4998,1));(n$5023=buffer$5007.length);$4992$5008;if((!buffer$5007.length)){return [];}else{(t0$5015=$4992$5008);(t1$5016=t0$5015.length);if((($4995$5020=(t1$5016===2))&&(($4996$5021=t0$5015[0])&&t0$5015[1]))){($5041$5043=buffer$5007);if((($5041$5043 instanceof Array)&&(((t0$5048=$5041$5043.length)),((t0$5048===1)&&(((t1$5049=$5041$5043[0])),((token$5054=t1$5049),((t1$5049 instanceof Array)&&(((t2$5050=t1$5049.length)),((t2$5050===3)&&(t1$5049[0]==="OP")))))))))){(fixity$5055=t1$5049[1]);(name$5056=t1$5049[2]);return [__lt____lt____lt____colon__$4964(["ID",name$5056],token$5054)];}else{(longer$5074=$5041$5043);(msg$5077="Too many consecutive operators were found here.");throw $5755(["syntax","nullary"]).create(msg$5077,({"operators":buffer$5007}));}}else{if($4996$5021){t0$5015[1];(acc$5088=[]);(temp$5093=buffer$5007);($length$5098=temp$5093.length);($index$5103=0);$5085:for(;($index$5103<$length$5098);($index$5103++)){var token$5121;var name$5122;var t0$5116;var t1$5117;var m$5111;(m$5111=temp$5093[$index$5103]);(t0$5116=m$5111);(token$5121=t0$5116);if(((t0$5116 instanceof Array)&&(((t1$5117=t0$5116.length)),((t1$5117===3)&&(t0$5116[0]==="OP"))))){t0$5116[1];(name$5122=t0$5116[2]);acc$5088.push(__lt____lt____lt____colon__$4964(["OP","PFX",name$5122],token$5121));}else{$5739(m$5111,"/home/olivier/git/earl-grey/src/lex.eg",7757,7851);}}return acc$5088;}else{if(($4995$5020&&(t0$5015[0],t0$5015[1]))){(acc$5143=[]);(temp$5148=buffer$5007);($length$5153=temp$5148.length);($index$5158=0);$5140:for(;($index$5158<$length$5153);($index$5158++)){var token$5176;var name$5177;var t0$5171;var t1$5172;var m$5166;(m$5166=temp$5148[$index$5158]);(t0$5171=m$5166);(token$5176=t0$5171);if(((t0$5171 instanceof Array)&&(((t1$5172=t0$5171.length)),((t1$5172===3)&&(t0$5171[0]==="OP"))))){t0$5171[1];(name$5177=t0$5171[2]);acc$5143.push(__lt____lt____lt____colon__$4964(["OP","SFX",name$5177],token$5176));}else{$5739(m$5166,"/home/olivier/git/earl-grey/src/lex.eg",7864,7958);}}return acc$5143;}else{$4992$5008;(t0$5204=buffer$5007);if(((t0$5204 instanceof Array)&&(((t1$5205=t0$5204.length)),((t1$5205>=1)&&(((t2$5206=t0$5204[0])),((first$5199=t2$5206),((t2$5206 instanceof Array)&&(((t3$5207=t2$5206.length)),((t3$5207===3)&&(t2$5206[0]==="OP")))))))))){(fixity$5200=t2$5206[1]);(name$5201=t2$5206[2]);(rest$5202=Array.prototype.slice.call(t0$5204,1));}else{$5739(buffer$5007,"/home/olivier/git/earl-grey/src/lex.eg",8011,8017);}($5194$5228=[first$5199.wsb,first$5199.wsa]);(bridge$5195$5233=$5194$5228);if((((bridge$5195$5233 instanceof Array)&&(((t0$5246=bridge$5195$5233.length)),((t0$5246===2)&&((!bridge$5195$5233[0])&&(!bridge$5195$5233[1])))))||((bridge$5195$5233 instanceof Array)&&(((t0$5252=bridge$5195$5233.length)),((t0$5252===2)&&(bridge$5195$5233[0]&&bridge$5195$5233[1])))))){return [__lt____lt____lt____colon__$4964(["OP","IFX",name$5201],first$5199)].concat(collapse_operators$4965(rest$5202,true,false));}else{if((($5196$5236=($5194$5228 instanceof Array))&&(((t0$5234=$5194$5228.length)),(($5198$5238=(t0$5234===2))&&$5194$5228[0])))){$5194$5228[1];return [__lt____lt____lt____colon__$4964(["OP","PFX",name$5201],first$5199)].concat(collapse_operators$4965(rest$5202,true,false));}else{if(($5198$5238&&($5194$5228[0],$5194$5228[1]))){(results$5272=collapse_operators$4965(rest$5202,false,false));(t$5277=((($5280$5283=results$5272)),(((bridge$5281$5288=$5280$5283)),function(){if((((bridge$5281$5288 instanceof Array)&&(((t0$5297=bridge$5281$5288.length)),(t0$5297===0)))||((bridge$5281$5288 instanceof Array)&&(((t0$5303=bridge$5281$5288.length)),((t0$5303>=1)&&(((t1$5304=bridge$5281$5288[0])),((t1$5304 instanceof Array)&&(((t2$5305=t1$5304.length)),((t2$5305>=2)&&((t1$5304[0]==="OP")&&((t1$5304[1]==="PFX")&&(Array.prototype.slice.call(t1$5304,2),(Array.prototype.slice.call(bridge$5281$5288,1),true))))))))))))){return ["OP","IFX",name$5201];}else{$5280$5283;return ["OP","SFX",name$5201];}}())));return [__lt____lt____lt____colon__$4964(t$5277,first$5199)].concat(results$5272);}else{$5739($5194$5228);}}}}}}}}else{$5739($4991$4998);}});(buffer$4966=[]);(pfx$4967=true);(collapse$4968=function(sfx$5339){var rval$5342;(rval$5342=collapse_operators$4965(buffer$4966,pfx$4967,sfx$5339));(buffer$4966=[]);return rval$5342;});(results$4969=[]);(temp$5355=stream$4961);($length$5360=temp$5355.length);($index$5365=0);$4970:for(;($index$5365<$length$5360);($index$5365++)){var other$5439;var name$5394;var $4973$5395;var t0$5389;var t1$5390;var token$5382;var $4972$5383;var t0$5378;var m$5373;(m$5373=temp$5355[$index$5365]);(t0$5378=m$5373);(token$5382=t0$5378);($4972$5383=t0$5378);(t0$5389=$4972$5383);if(((t0$5389 instanceof Array)&&(((t1$5390=t0$5389.length)),((t1$5390===3)&&(t0$5389[0]==="OP"))))){($4973$5395=t0$5389[1]);(name$5394=t0$5389[2]);if(($4973$5395==="?FX")){buffer$4966.push(token$5382);}else{if(($4973$5395==="IFX")){(results$4969=results$4969.concat(collapse$4968(true)));results$4969.push(token$5382);(pfx$4967=true);}else{if(($4973$5395==="PFX")){(results$4969=results$4969.concat(collapse$4968(false)));results$4969.push(token$5382);(pfx$4967=true);}else{if(($4973$5395==="SFX")){(results$4969=results$4969.concat(collapse$4968(true)));results$4969.push(token$5382);(pfx$4967=false);}else{$5739($4973$5395,"/home/olivier/git/earl-grey/src/lex.eg",8823,8828);}}}}}else{(other$5439=$4972$5383);(results$4969=results$4969.concat(collapse$4968(false)));results$4969.push(token$5382);(pfx$4967=false);}}return results$4969.concat(collapse$4968(true));});(alternate_operators$4292=function(stream$5449){var $index$5482;var $length$5477;var temp$5472;var W$5452;var last_op$5453;var results$5454;(W$5452=function(x$5461){if(x$5461){return "wide";}else{return "short";}});(last_op$5453=true);(results$5454=[]);(temp$5472=stream$5449);($length$5477=temp$5472.length);($index$5482=0);$5455:for(;($index$5482<$length$5477);($index$5482++)){var x$5513;var $5532$5535;var x$5572;var token$5579;var fixity$5520;var name$5521;var t0$5506;var t1$5507;var token$5499;var $5457$5500;var t0$5495;var m$5490;(m$5490=temp$5472[$index$5482]);(t0$5495=m$5490);(token$5499=t0$5495);($5457$5500=t0$5495);if((((x$5513=$5457$5500)),((x$5513 instanceof Array)&&(x$5513[0]==="IGNORE")))){null;}else{(t0$5506=$5457$5500);if(((t0$5506 instanceof Array)&&(((t1$5507=t0$5506.length)),((t1$5507===3)&&(t0$5506[0]==="OP"))))){(fixity$5520=t0$5506[1]);(name$5521=t0$5506[2]);if(last_op$5453){results$5454.push(["VOID"]);}($5532$5535=fixity$5520);if(($5532$5535==="IFX")){results$5454.push(__lt____lt____colon__$4283(["IFX",W$5452((token$5499.wsa||token$5499.wsb)),name$5521],token$5499));(last_op$5453=true);}else{if(($5532$5535==="PFX")){if((!last_op$5453)){results$5454.push(["IFX",W$5452(token$5499.wsb),"WHITE"],["VOID"]);}results$5454.push(__lt____lt____colon__$4283(["PFX",W$5452(token$5499.wsa),name$5521],token$5499));(last_op$5453=true);}else{if(($5532$5535==="SFX")){results$5454.push(__lt____lt____colon__$4283(["SFX",W$5452(token$5499.wsb),name$5521],token$5499),["VOID"]);(last_op$5453=false);}else{$5739($5532$5535);}}}}else{if((((x$5572=$5457$5500)),((x$5572 instanceof Array)&&(x$5572[0]==="ILLEGAL")))){throw $5755(["syntax","illegal"]).create("unknown character",({"chr":token$5499}));}else{(token$5579=$5457$5500);if((!last_op$5453)){results$5454.push(["IFX",W$5452(token$5579.wsb),"WHITE"]);}results$5454.push(token$5579);(last_op$5453=false);}}}}if(last_op$5453){results$5454.push(["VOID"]);}return results$5454;});(fill_locations$4293=function(source$5591,stream$5592){var $index$5671;var $length$5666;var temp$5661;var to_fill$5595;var start$5596;var fill$5597;(to_fill$5595=[]);(start$5596=0);(fill$5597=function(end$5609){var $index$5626;var $length$5621;var temp$5616;(temp$5616=to_fill$5595);($length$5621=temp$5616.length);($index$5626=0);$5612:for(;($index$5626<$length$5621);($index$5626++)){var token$5650;var token$5642;var m$5634;(m$5634=temp$5616[$index$5626]);(token$5642=m$5634);if(($index$5626===0)){(token$5642["location"]=Location$4282(source$5591,start$5596,end$5609));}else{(token$5650=m$5634);(token$5650["location"]=Location$4282(source$5591,end$5609,end$5609));}}(to_fill$5595=[]);});(temp$5661=stream$5592);($length$5666=temp$5661.length);($index$5671=0);$5598:for(;($index$5671<$length$5666);($index$5671++)){var other$5701;var location$5688;var t0$5684;var m$5679;(m$5679=temp$5661[$index$5671]);(t0$5684=m$5679);if(($6100(t0$5684,"location")&&((location$5688=t0$5684.location),location$5688))){fill$5597(location$5688.start);(start$5596=location$5688.end);}else{(other$5701=m$5679);to_fill$5595.push(other$5701);}}fill$5597(source$5591.text.length);return stream$5592;});(tokenize$4294=function(src$5707){var it$0$5730;var it$0$5725;var it$0$5720;var it$0$5715;var it$0$5710;(it$0$5710=src$5707);(it$0$5715=produce$4288(it$0$5710));(it$0$5720=process_indent$4290(it$0$5715));(it$0$5725=disambiguate_fixity$4291(it$0$5720));(it$0$5730=alternate_operators$4292(it$0$5725));return fill_locations$4293(src$5707,it$0$5730);});(exports["tokenize"]=tokenize$4294);
