var $5362=(function(type$5365){var f$5369;(f$5369=type$5365["::check"]);if((f$5369===(void 0))){return (function(value$5375){return (value$5375 instanceof type$5365);});}else{return (function(value$5379){return f$5369.call(type$5365,value$5379);});}});
var $5381=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $5382=(function(dest$5385,values$5386){var k$5391;(k$5391=null);$5389:for(k$5391 in values$5386){if(values$5386.hasOwnProperty(k$5391)){(dest$5385[k$5391]=values$5386[k$5391]);}}return dest$5385;});
var $5399=(function($5401$5404){var ph$5410;(ph$5410=$5401$5404);var $5406$5416;($5406$5416=ph$5410);var bridge$5408$5421;var x$5425;(bridge$5408$5421=$5406$5416);if((((typeof(bridge$5408$5421)==="string")&&((x$5425=bridge$5408$5421),true))||((typeof(bridge$5408$5421)==="number")&&((x$5425=bridge$5408$5421),true)))){return ["value",x$5425];}else{var other$5436;(other$5436=$5406$5416);return other$5436["::serialize_ast"]();}});
var send$5136;(send$5136=(function(obj$5143,$5140$5144){var ph$5150;var msg$5151;var t0$5153;(t0$5153=$5140$5144);(msg$5151=t0$5153);(ph$5150=t0$5153);var $5146$5162;($5146$5162=ph$5150);var bridge$5148$5167;(bridge$5148$5167=$5146$5162);if(((typeof(bridge$5148$5167)==="string")||(typeof(bridge$5148$5167)==="number"))){return obj$5143[msg$5151];}else{var other$5179;(other$5179=$5146$5162);return obj$5143["::send"](msg$5151);}}));(Array[":::project"]=(function($5185$5188){var ph$5193;var value$5194;var t0$5196;(t0$5196=$5185$5188);(value$5194=t0$5196);(ph$5193=t0$5196);var $5190$5205;($5190$5205=ph$5193);if($5362(Array)($5190$5205)){return [true,value$5194];}else{$5190$5205;return [true,[value$5194]];}}));(Array.prototype["::check"]=(function(value$5223){if((value$5223 instanceof Array)){var i$5229;(i$5229=0);$5226:for(;(i$5229<this.length);(i$5229++)){if(($5381(this,i$5229)!==$5381(value$5223,i$5229))){return false;}}return true;}else{return false;}}));(Array.prototype["::clone"]=(function(){return $5382(this.slice(0),this);}));(Array.prototype[":::project"]=(function(value$5248){if((value$5248 instanceof Array)){var i$5254;(i$5254=0);$5251:for(;(i$5254<this.length);(i$5254++)){if(($5381(this,i$5254)!==$5381(value$5248,i$5254))){return [true,[value$5248]];}}return [true,value$5248.slice(this.length)];}else{return [true,[value$5248]];}}));(Array.prototype["::serialize_ast"]=(function(){return ["array"].concat(this.map($5399));}));(RegExp.prototype["::check"]=(function($5272$5275){var ph$5280;(ph$5280=$5272$5275);var $5277$5286;($5277$5286=ph$5280);var value$5294;if((typeof($5277$5286)==="string")){(value$5294=$5277$5286);if(value$5294.match(this)){return true;}else{return false;}}else{var other$5299;(other$5299=$5277$5286);return false;}}));(RegExp.prototype[":::project"]=(function($5305$5308){var ph$5313;(ph$5313=$5305$5308);var $5310$5319;($5310$5319=ph$5313);var value$5327;if((typeof($5310$5319)==="string")){(value$5327=$5310$5319);var $5330$5335;($5330$5335=value$5327.match(this));var m$5343;if(($5330$5335===null)){(m$5343=$5330$5335);return [false,null];}else{var m$5348;(m$5348=$5330$5335);return [true,m$5348];}}else{var other$5352;(other$5352=$5310$5319);return [false,null];}}));(Function.prototype["::send"]=(function(args$5359){return this.apply(this,args$5359);}));
var $7461=(function(arr$7464){var results$7470;var l$7471;(results$7470=[]);(l$7471=arr$7464.length);var i$7480;(i$7480=0);$7469:for(;(i$7480<l$7471);(i$7480++)){results$7470.push([i$7480,$5381(arr$7464,i$7480)]);}return results$7470;});
var $7228=(function(){var $7229$7235;($7229$7235=(function(tags$7240){var it$0$7243;(it$0$7243=(function(){if((!$5362($7229$7235)(this))){return Object.create($7229$7235.prototype);}else{return this;}})());(it$0$7243["tags"]=tags$7240);return it$0$7243;}));($7229$7235.prototype["create"]=(function(){var it$0$7263;var self$7264;(it$0$7263=this);(self$7264=this);var $7261$7273;($7261$7273=arguments);var t0$7278;var message$7282;var args$7283;(t0$7278=$7261$7273.length);if((t0$7278>=0)){(message$7282=(function(){if((0>=t0$7278)){return "";}else{return $7261$7273[0];}})());(args$7283=Array.prototype.slice.call($7261$7273,1));var e$7296;(e$7296=Error(message$7282));(e$7296["::tags"]=it$0$7263.tags);(e$7296["args"]=args$7283);var temp$7312;(temp$7312=$7461(args$7283));var $length$7318;($length$7318=temp$7312.length);var $index$7324;($index$7324=0);$7297:for(;($index$7324<$length$7318);($index$7324++)){var m$7333;(m$7333=temp$7312[$index$7324]);var t0$7338;var t1$7339;var i$7343;var arg$7344;(t0$7338=m$7333);if(((t0$7338 instanceof Array)&&(((t1$7339=t0$7338.length)),(t1$7339===2)))){(i$7343=t0$7338[0]);(arg$7344=t0$7338[1]);(e$7296[i$7343]=arg$7344);}else{$7209(m$7333);}}(e$7296["length"]=args$7283.length);(e$7296["name"]=["E"].concat(it$0$7263.tags).join("."));return e$7296;}else{$7209($7261$7273);}}));($7229$7235.prototype["::check"]=(function(e$7374){var it$0$7378;var self$7379;(it$0$7378=this);(self$7379=this);var tags$7389;if(((!e$7374)||(!$5362(Error)(e$7374)))){return false;}(tags$7389=(e$7374["::tags"]||[]));var temp$7400;(temp$7400=it$0$7378.tags);var $length$7406;($length$7406=temp$7400.length);var $index$7412;($index$7412=0);$7390:for(;($index$7412<$length$7406);($index$7412++)){var m$7421;(m$7421=temp$7400[$index$7412]);var tag$7429;(tag$7429=m$7421);if((tags$7389.indexOf(tag$7429)===-1)){return false;}else{false;}}return true;}));($7229$7235.prototype["::deconstruct"]=(function(e$7438){var it$0$7442;var self$7443;(it$0$7442=this);(self$7443=this);return e$7438.args;}));$5382($7229$7235,$5382((function(){var accum$7454;(accum$7454=({}));(accum$7454["::name"]="$7229");return accum$7454;})(),(function(){var accum$7458;(accum$7458=({}));(accum$7458["::egclass"]=true);return accum$7458;})()));return $7229$7235;})();
var $7209=(function(value$7212,url$7213,start$7214,end$7215){var err$7219;(err$7219=$7228(["match"]).create("Could not find a match for value",({"value":value$7212})));if(url$7213){(err$7219["location"]=["location",url$7213,start$7214,end$7215]);}throw err$7219;});
var $7487=(function(type$7490){return (function(value$7494){var f$7498;(f$7498=type$7490[":::project"]);if((f$7498===(void 0))){(f$7498=type$7490["::project"]);if((f$7498===(void 0))){return [true,type$7490(value$7494)];}else{var rval$7511;(rval$7511=false);try{(rval$7511=[true,f$7498(value$7494)]);}catch(excv$7522){var e$7528;(e$7528=excv$7522);(rval$7511=[false,null]);}return rval$7511;}}else{return f$7498.call(type$7490,value$7494);}});});
var $7640=(function($7642$7645,key$7646){var ph$7654;(ph$7654=$7642$7645);var $7648$7660;($7648$7660=ph$7654);var bridge$7650$7665;(bridge$7650$7665=$7648$7660);if(((bridge$7650$7665===null)||(bridge$7650$7665===(void 0)))){return false;}else{var x$7677;if((typeof($7648$7660)==="string")){(x$7677=$7648$7660);return (key$7646 in String.prototype);}else{var x$7682;if((typeof($7648$7660)==="number")){(x$7682=$7648$7660);return (key$7646 in Number.prototype);}else{var x$7687;(x$7687=$7648$7660);return (key$7646 in x$7687);}}}});
var $7556=(function($7558$7561){var ph$7571;var x$7572;var t0$7574;(t0$7574=$7558$7561);(x$7572=t0$7574);(ph$7571=t0$7574);var $7563$7583;($7563$7583=ph$7571);var bridge$7565$7588;(bridge$7565$7588=$7563$7583);if(((function(){var bridge$7566$7598;(bridge$7566$7598=bridge$7565$7588);return ((function(){var bridge$7567$7605;(bridge$7567$7605=bridge$7566$7598);return ((bridge$7567$7605===(void 0))||(bridge$7567$7605===null));})()||(typeof(bridge$7566$7598)==="string"));})()||(typeof(bridge$7565$7588)==="number"))){return x$7572;}else{if($7640($7563$7583,"::clone")){$7563$7583["::clone"];return x$7572["::clone"]();}else{$7563$7583;if((Object.getPrototypeOf(x$7572)===Object.prototype)){var dest$7623;(dest$7623=({}));var k$7628;(k$7628=null);$7622:for(k$7628 in x$7572){if(Object.prototype.hasOwnProperty.call(x$7572,k$7628)){(dest$7623[k$7628]=x$7572[k$7628]);}}return dest$7623;}else{var other$7638;(other$7638=$7563$7583);throw $7228(["clone"]).create("Object cannot be cloned",({"obj":x$7572}));}}}});
var $7534=(function(a$7537,b$7538){var dest$7543;(dest$7543=$7556(a$7537));var k$7548;(k$7548=null);$7542:for(k$7548 in b$7538){if(Object.prototype.hasOwnProperty.call(b$7538,k$7548)){(dest$7543[k$7548]=b$7538[k$7548]);}}return dest$7543;});var id$5503;var id_f$5504;var numr$5505;var numr_f$5506;var num$5507;var num_f$5508;var str$5509;var str_f$5510;var op$5511;var op2$5512;var op3$5513;var op4$5514;var op_f$5515;var indent$5516;var indent_f$5517;var cmnt$5518;var cmnt_f$5519;var unkn$5520;var unkn_f$5521;var $5440$5455;var Location$5456;var __lt____lt____colon__$5457;var special_ops$5458;var regexps$5459;var ws_re$5460;var eol_re$5461;var produce$5462;var indent_tracker$5463;var process_indent$5464;var disambiguate_fixity$5465;var alternate_operators$5466;var fill_locations$5467;var tokenize$5468;($5440$5455=require("./location"));(Location$5456=$5440$5455.Location);(__lt____lt____colon__$5457=$5440$5455["<<:"]);(special_ops$5458=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",".":"PFX","'":"PFX","not":"PFX"}));(regexps$5459=(((id$5503=RegExp("(?:^(?:(?:[a-zA-Z$_](?:[a-zA-Z$_0-9]*))|\\.\\.\\.))",""))),((id_f$5504=(function(m$5529){return ["ID",m$5529[0]];}))),((numr$5505=RegExp("(?:^((?:\\d+))[rR]((?:[A-Za-z0-9_]+))(?:(?:\\.((?:[A-Za-z0-9_]+)))?))",""))),((numr_f$5506=(function(m$5539){var t0$5549;var t1$5550;var frac$5570;var radix$5544;var intp$5545;var frac$5546;var value$5547;(t0$5549=m$5539);if(((t0$5549 instanceof Array)&&(((t1$5550=t0$5549.length)),(t1$5550===4)))){t0$5549[0];(radix$5544=t0$5549[1]);(intp$5545=t0$5549[2]);(frac$5546=t0$5549[3]);}else{$7209(m$5539,"/home/olivier/git/earl-grey/src/lex.eg",1082,1083);}(value$5547=parseInt(intp$5545.replace(RegExp("_","g"),""),radix$5544));if(frac$5546){(frac$5570=frac$5546.replace(RegExp("_","g"),""));(value$5547=(value$5547+(parseInt(frac$5546,radix$5544)/Math.pow(radix$5544,frac$5546.length))));}return ["NUM",value$5547];}))),((num$5507=RegExp("(?:^((?:[0-9_]+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:[0-9_]+)))?))",""))),((num_f$5508=(function(m$5585){return ["NUM",parseFloat(m$5585[0].replace(RegExp("_","g"),""))];}))),((str$5509=RegExp("(?:^\"((?:(?:(?:\\\\.)|[^\"])*))\")",""))),((str_f$5510=(function(m$5595){var rx$5610;var f$5611;var repl$5600;var r$5601;(repl$5600=({"b":String.fromCharCode(8),"f":String.fromCharCode(12),"n":"\n","r":String.fromCharCode(13),"t":String.fromCharCode(9)}));(r$5601=(((rx$5610=RegExp("\\\\u[0-9A-Fa-f]{4}|\\\\x[0-9A-Fa-f]{2}|\\\\.","g"))),((f$5611=(function($5618$5621){var chr$5662;var digits$5643;var t0$5637;var t1$5638;var t2$5639;var $5623$5632;var ph$5626;(ph$5626=$5618$5621);($5623$5632=ph$5626);(t0$5637=$7487(RegExp("^(?:\\\\u|\\\\x)(.*)",""))($5623$5632));if((t0$5637[0]&&(((t1$5638=t0$5637[1])),(((t2$5639=t1$5638.length)),(t2$5639===2))))){t1$5638[0];(digits$5643=t1$5638[1]);return String.fromCharCode(parseInt(digits$5643,16));}else{(t0$5637=$7487(RegExp("^.(.)",""))($5623$5632));if((t0$5637[0]&&(((t1$5638=t0$5637[1])),(((t2$5639=t1$5638.length)),(t2$5639===2))))){t1$5638[0];(chr$5662=t1$5638[1]);return ($5381(repl$5600,chr$5662)||chr$5662);}else{$7209($5623$5632);}}}))),m$5595[1].replace(rx$5610,f$5611)));return ["STR",r$5601];}))),((op$5511=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!@#.:']+))",""))),((op2$5512=RegExp("(?:^[\\[\\{\\}\\],])",""))),((op3$5513=RegExp("(?:^(?:(?:(?:(?:(?:(?:(?:(?:(?:with|where)|when)|and)|not)|or)|in)|mod)|each)|as)(?:(?:[+\\-*/~\\^<>=%&|?!@#.:']+)|\\b))",""))),((op4$5514=RegExp("(?:^`((?:[A-Za-z0-9_$]+))`)",""))),((op_f$5515=(function(m$5700,column$5701){var fixity$5733;var otherwise$5739;var $5709$5722;var $5705$5716;var op$5710;(op$5710=(m$5700[1]||m$5700[0]));($5705$5716=null);$5705$5716;if((op$5710==="|")){return ["INDENT",(column$5701-1)];}else{if((op$5710 in special_ops$5458)){(fixity$5733=$5381(special_ops$5458,op$5710));return ["OP",fixity$5733,op$5710];}else{(otherwise$5739=$5705$5716);return ["OP","?FX",op$5710];}}}))),((indent$5516=RegExp("(?:^(?:(?:\n(?: *);(?:[^\n]*))*)(?:(?:\n((?: *)))+))",""))),((indent_f$5517=(function(m$5749){var ilen$5753;(ilen$5753=m$5749[1].length);return ["INDENT",ilen$5753];}))),((cmnt$5518=RegExp("(?:^;(?:[^\n]*))",""))),((cmnt_f$5519=(function(m$5765){return ["IGNORE"];}))),((unkn$5520=RegExp("(?:^.)",""))),((unkn_f$5521=(function(m$5775){return ["ILLEGAL",m$5775[0]];}))),[[op3$5513,op_f$5515],[id$5503,id_f$5504],[numr$5505,numr_f$5506],[num$5507,num_f$5508],[str$5509,str_f$5510],[op$5511,op_f$5515],[op2$5512,op_f$5515],[op4$5514,op_f$5515],[indent$5516,indent_f$5517],[cmnt$5518,cmnt_f$5519],[unkn$5520,unkn_f$5521]]));(ws_re$5460=RegExp("(?:^(?: *)(?:(?:\n(?: *)\\\\(?: *))*))",""));(eol_re$5461=RegExp("(?:^(?: *)(?:\n|$))",""));(produce$5462=(function(src$5789){var text$5798;var results$5799;var wsb$5800;var pos$5801;var column$5802;(text$5798=src$5789.text);(results$5799=[]);(wsb$5800=text$5798.match(ws_re$5460)[0].length);(text$5798=text$5798.slice(wsb$5800));(pos$5801=wsb$5800);(column$5802=0);$5821:while(text$5798){var i$5827;(i$5827=0);$5824:for(;(i$5827<regexps$5459.length);(++i$5827)){var t0$5841;var t1$5842;var splits$5891;var skip$5874;var endpos$5875;var wsa$5876;var eol$5877;var bwsb$5878;var bwsa$5879;var token$5880;var re$5837;var fn$5838;var m$5839;(t0$5841=$5381(regexps$5459,i$5827));if(((t0$5841 instanceof Array)&&(((t1$5842=t0$5841.length)),(t1$5842===2)))){(re$5837=t0$5841[0]);(fn$5838=t0$5841[1]);}else{$7209($5381(regexps$5459,i$5827),"/home/olivier/git/earl-grey/src/lex.eg",4113,4133);}(m$5839=text$5798.match(re$5837));if(m$5839){(skip$5874=m$5839[0].length);(endpos$5875=(pos$5801+skip$5874));(column$5802=(((splits$5891=m$5839[0].split("\n"))),(function(){if((splits$5891.length>1)){return $5381(splits$5891,(splits$5891.length-1)).length;}else{return (column$5802+skip$5874);}})()));(text$5798=text$5798.slice(skip$5874));(wsa$5876=text$5798.match(ws_re$5460)[0].length);(eol$5877=(text$5798.match(eol_re$5461)&&true));(bwsb$5878=(wsb$5800>0));(bwsa$5879=(function(){if(eol$5877){return bwsb$5878;}else{return (wsa$5876>0);}})());(token$5880=fn$5838(m$5839,column$5802));(token$5880["wsb"]=bwsb$5878);(token$5880["wsa"]=bwsa$5879);(token$5880["location"]=Location$5456(src$5789,pos$5801,endpos$5875));results$5799.push(token$5880);(text$5798=text$5798.slice(wsa$5876));(column$5802=(column$5802+wsa$5876));(wsb$5800=wsa$5876);(pos$5801=(endpos$5875+wsa$5876));break $5824;}}}return results$5799;}));(indent_tracker$5463=(function(){var curr$5945;var stack$5946;var stacks$5947;(curr$5945=0);(stack$5946=[]);(stacks$5947=[stack$5946]);return (function($5943$5958){var t0$5981;var rval$6049;var $index$6129;var $length$6123;var temp$6117;var acc$6111;var rval$6103;var x$6160;var $index$6188;var $length$6182;var temp$6176;var acc$6170;var other$6209;var fixity$6090;var fixity$6070;var stuff$6065;var new_indent$6006;var $5962$6007;var $5974$6000;var $5975$6001;var $5976$6002;var $5977$6003;var t0$5995;var t1$5996;var bridge$5969$5997;var bridge$5971$5998;var $5960$5990;var ph$5978;var token$5979;(t0$5981=$5943$5958);(token$5979=t0$5981);(ph$5978=t0$5981);($5960$5990=ph$5978);if((($5974$6000=($5960$5990 instanceof Array))&&(((t0$5995=$5960$5990.length)),((t0$5995===2)&&($5960$5990[0]==="INDENT"))))){(t1$5996=$5960$5990[1]);(new_indent$6006=t1$5996);($5962$6007=t1$5996);$5962$6007;if((curr$5945===false)){(curr$5945=new_indent$6006);return [$7534(["OP","IFX",","],({"wsb":true,"wsa":true}))];}else{if(($5962$6007>curr$5945)){stack$5946.push(curr$5945);(curr$5945=new_indent$6006);return [$7534(["OP","PFX","["],({"wsb":true,"wsa":true}))];}else{if(($5962$6007===curr$5945)){return [$7534(["OP","IFX",","],({"wsb":true,"wsa":true}))];}else{if(($5962$6007<curr$5945)){(rval$6049=[]);$6053:while(((stack$5946.length>0)&&(new_indent$6006<curr$5945))){(curr$5945=stack$5946.pop());rval$6049.push($7534(["OP","SFX","]"],({"wsb":true,"wsa":true})));}rval$6049.push($7534(["OP","IFX",","],({"wsb":true,"wsa":true})));return rval$6049;}else{$7209($5962$6007,"/home/olivier/git/earl-grey/src/lex.eg",5490,5506);}}}}}else{if(($5974$6000&&((t0$5995>=1)&&($5960$5990[0]==="ID")))){(stuff$6065=Array.prototype.slice.call($5960$5990,1));return [token$5979];}else{if(($5974$6000&&(($5976$6002=(t0$5995===3))&&(($5977$6003=($5960$5990[0]==="OP"))&&((fixity$6070=$5960$5990[1]),(((bridge$5969$5997=$5960$5990[2])),((bridge$5969$5997==="[")||(bridge$5969$5997==="{")))))))){stack$5946.push(curr$5945);stacks$5947.push(stack$5946);(stack$5946=[]);(curr$5945=false);return [token$5979];}else{if(($5977$6003&&((fixity$6090=$5960$5990[1]),(((bridge$5971$5998=$5960$5990[2])),((bridge$5971$5998==="]")||(bridge$5971$5998==="}")))))){(rval$6103=(((acc$6111=[])),(((temp$6117=stack$5946)),((($length$6123=temp$6117.length)),((($index$6129=0)),(function(){$6106:for(;($index$6129<$length$6123);($index$6129++)){var m$6138;(m$6138=temp$6117[$index$6129]);m$6138;acc$6111.push($7534(["OP","SFX","]"],({"wsb":true,"wsa":true})));}})()))),acc$6111));(stack$5946=stacks$5947.pop());(curr$5945=stack$5946.pop());rval$6103.push(token$5979);return rval$6103;}else{if((((x$6160=$5960$5990)),((x$6160 instanceof Array)&&(x$6160[0]==="EOF")))){(acc$6170=[]);(temp$6176=stack$5946);($length$6182=temp$6176.length);($index$6188=0);$6165:for(;($index$6188<$length$6182);($index$6188++)){var m$6197;(m$6197=temp$6176[$index$6188]);m$6197;acc$6170.push($7534(["OP","SFX","]"],({"wsb":true,"wsa":true})));}return acc$6170;}else{(other$6209=$5960$5990);return [token$5979];}}}}}});}));(process_indent$5464=(function(stream$6216){var $index$6247;var $length$6241;var temp$6235;var tracker$6221;var results$6222;(tracker$6221=indent_tracker$5463());(results$6222=[]);(temp$6235=stream$6216);($length$6241=temp$6235.length);($index$6247=0);$6223:for(;($index$6247<$length$6241);($index$6247++)){var token$6264;var m$6256;(m$6256=temp$6235[$index$6247]);(token$6264=m$6256);(results$6222=results$6222.concat(tracker$6221(token$6264)));}return results$6222.concat(tracker$6221(["EOF"]));}));(disambiguate_fixity$5465=(function(stream$6271){var $index$6755;var $length$6749;var temp$6743;var __lt____lt____lt____colon__$6280;var collapse_operators$6281;var buffer$6282;var pfx$6283;var collapse$6284;var results$6285;(__lt____lt____lt____colon__$6280=(function(a$6301,b$6302){(a$6301["wsb"]=b$6302.wsb);(a$6301["wsa"]=b$6302.wsa);return __lt____lt____colon__$5457(a$6301,b$6302);}));(collapse_operators$6281=(function(){var msg$6422;var longer$6418;var token$6395;var fixity$6396;var name$6397;var t0$6389;var t1$6390;var t2$6391;var $6379$6384;var $index$6453;var $length$6447;var temp$6441;var acc$6435;var $index$6516;var $length$6510;var temp$6504;var acc$6498;var t0$6569;var t1$6570;var t2$6571;var t3$6572;var t0$6617;var t0$6624;var t0$6677;var t0$6684;var t1$6685;var t2$6686;var bridge$6658$6667;var $6656$6662;var t$6653;var results$6647;var $6561$6606;var $6562$6607;var $6563$6608;var bridge$6558$6603;var t0$6604;var $6556$6598;var first$6564;var fixity$6565;var name$6566;var rest$6567;var n$6359;var $6326$6353;var $6327$6354;var $6328$6355;var $6329$6356;var t0$6350;var t1$6351;var buffer$6341;var $6320$6342;var t0$6337;var $6318$6332;($6318$6332=arguments);(t0$6337=$6318$6332.length);if((t0$6337>=1)){(buffer$6341=$6318$6332[0]);($6320$6342=Array.prototype.slice.call($6318$6332,1));(n$6359=buffer$6341.length);$6320$6342;if((!buffer$6341.length)){return [];}else{(t0$6350=$6320$6342);(t1$6351=t0$6350.length);if((($6328$6355=(t1$6351===2))&&(($6329$6356=t0$6350[0])&&t0$6350[1]))){($6379$6384=buffer$6341);if((($6379$6384 instanceof Array)&&(((t0$6389=$6379$6384.length)),((t0$6389===1)&&(((t1$6390=$6379$6384[0])),((token$6395=t1$6390),((t1$6390 instanceof Array)&&(((t2$6391=t1$6390.length)),((t2$6391===3)&&(t1$6390[0]==="OP")))))))))){(fixity$6396=t1$6390[1]);(name$6397=t1$6390[2]);return [__lt____lt____lt____colon__$6280(["ID",name$6397],token$6395)];}else{(longer$6418=$6379$6384);(msg$6422="Too many consecutive operators were found here.");throw $7228(["syntax","nullary"]).create(msg$6422,({"operators":buffer$6341}));}}else{if($6329$6356){t0$6350[1];(acc$6435=[]);(temp$6441=buffer$6341);($length$6447=temp$6441.length);($index$6453=0);$6430:for(;($index$6453<$length$6447);($index$6453++)){var token$6472;var name$6473;var t0$6467;var t1$6468;var m$6462;(m$6462=temp$6441[$index$6453]);(t0$6467=m$6462);(token$6472=t0$6467);if(((t0$6467 instanceof Array)&&(((t1$6468=t0$6467.length)),((t1$6468===3)&&(t0$6467[0]==="OP"))))){t0$6467[1];(name$6473=t0$6467[2]);acc$6435.push(__lt____lt____lt____colon__$6280(["OP","PFX",name$6473],token$6472));}else{$7209(m$6462,"/home/olivier/git/earl-grey/src/lex.eg",7851,7945);}}return acc$6435;}else{if(($6328$6355&&(t0$6350[0],t0$6350[1]))){(acc$6498=[]);(temp$6504=buffer$6341);($length$6510=temp$6504.length);($index$6516=0);$6493:for(;($index$6516<$length$6510);($index$6516++)){var token$6535;var name$6536;var t0$6530;var t1$6531;var m$6525;(m$6525=temp$6504[$index$6516]);(t0$6530=m$6525);(token$6535=t0$6530);if(((t0$6530 instanceof Array)&&(((t1$6531=t0$6530.length)),((t1$6531===3)&&(t0$6530[0]==="OP"))))){t0$6530[1];(name$6536=t0$6530[2]);acc$6498.push(__lt____lt____lt____colon__$6280(["OP","SFX",name$6536],token$6535));}else{$7209(m$6525,"/home/olivier/git/earl-grey/src/lex.eg",7958,8052);}}return acc$6498;}else{$6320$6342;(t0$6569=buffer$6341);if(((t0$6569 instanceof Array)&&(((t1$6570=t0$6569.length)),((t1$6570>=1)&&(((t2$6571=t0$6569[0])),((first$6564=t2$6571),((t2$6571 instanceof Array)&&(((t3$6572=t2$6571.length)),((t3$6572===3)&&(t2$6571[0]==="OP")))))))))){(fixity$6565=t2$6571[1]);(name$6566=t2$6571[2]);(rest$6567=Array.prototype.slice.call(t0$6569,1));}else{$7209(buffer$6341,"/home/olivier/git/earl-grey/src/lex.eg",8105,8111);}($6556$6598=[first$6564.wsb,first$6564.wsa]);(bridge$6558$6603=$6556$6598);if((((bridge$6558$6603 instanceof Array)&&(((t0$6617=bridge$6558$6603.length)),((t0$6617===2)&&((!bridge$6558$6603[0])&&(!bridge$6558$6603[1])))))||((bridge$6558$6603 instanceof Array)&&(((t0$6624=bridge$6558$6603.length)),((t0$6624===2)&&(bridge$6558$6603[0]&&bridge$6558$6603[1])))))){return [__lt____lt____lt____colon__$6280(["OP","IFX",name$6566],first$6564)].concat(collapse_operators$6281(rest$6567,true,false));}else{if((($6561$6606=($6556$6598 instanceof Array))&&(((t0$6604=$6556$6598.length)),(($6563$6608=(t0$6604===2))&&$6556$6598[0])))){$6556$6598[1];return [__lt____lt____lt____colon__$6280(["OP","PFX",name$6566],first$6564)].concat(collapse_operators$6281(rest$6567,true,false));}else{if(($6563$6608&&($6556$6598[0],$6556$6598[1]))){(results$6647=collapse_operators$6281(rest$6567,false,false));(t$6653=((($6656$6662=results$6647)),(((bridge$6658$6667=$6656$6662)),(function(){if((((bridge$6658$6667 instanceof Array)&&(((t0$6677=bridge$6658$6667.length)),(t0$6677===0)))||((bridge$6658$6667 instanceof Array)&&(((t0$6684=bridge$6658$6667.length)),((t0$6684>=1)&&(((t1$6685=bridge$6658$6667[0])),((t1$6685 instanceof Array)&&(((t2$6686=t1$6685.length)),((t2$6686>=2)&&((t1$6685[0]==="OP")&&((t1$6685[1]==="PFX")&&(Array.prototype.slice.call(t1$6685,2),(Array.prototype.slice.call(bridge$6658$6667,1),true))))))))))))){return ["OP","IFX",name$6566];}else{$6656$6662;return ["OP","SFX",name$6566];}})())));return [__lt____lt____lt____colon__$6280(t$6653,first$6564)].concat(results$6647);}else{$7209($6556$6598);}}}}}}}}else{$7209($6318$6332);}}));(buffer$6282=[]);(pfx$6283=true);(collapse$6284=(function(sfx$6724){var rval$6729;(rval$6729=collapse_operators$6281(buffer$6282,pfx$6283,sfx$6724));(buffer$6282=[]);return rval$6729;}));(results$6285=[]);(temp$6743=stream$6271);($length$6749=temp$6743.length);($index$6755=0);$6286:for(;($index$6755<$length$6749);($index$6755++)){var other$6836;var name$6786;var $6291$6787;var t0$6781;var t1$6782;var token$6773;var $6289$6774;var t0$6769;var m$6764;(m$6764=temp$6743[$index$6755]);(t0$6769=m$6764);(token$6773=t0$6769);($6289$6774=t0$6769);(t0$6781=$6289$6774);if(((t0$6781 instanceof Array)&&(((t1$6782=t0$6781.length)),((t1$6782===3)&&(t0$6781[0]==="OP"))))){($6291$6787=t0$6781[1]);(name$6786=t0$6781[2]);if(($6291$6787==="?FX")){buffer$6282.push(token$6773);}else{if(($6291$6787==="IFX")){(results$6285=results$6285.concat(collapse$6284(true)));results$6285.push(token$6773);(pfx$6283=true);}else{if(($6291$6787==="PFX")){(results$6285=results$6285.concat(collapse$6284(false)));results$6285.push(token$6773);(pfx$6283=true);}else{if(($6291$6787==="SFX")){(results$6285=results$6285.concat(collapse$6284(true)));results$6285.push(token$6773);(pfx$6283=false);}else{$7209($6291$6787,"/home/olivier/git/earl-grey/src/lex.eg",8921,8926);}}}}}else{(other$6836=$6289$6774);(results$6285=results$6285.concat(collapse$6284(false)));results$6285.push(token$6773);(pfx$6283=false);}}return results$6285.concat(collapse$6284(true));}));(alternate_operators$5466=(function(stream$6848){var $index$6893;var $length$6887;var temp$6881;var W$6854;var last_op$6855;var results$6856;(W$6854=(function(x$6869){if(x$6869){return "wide";}else{return "short";}}));(last_op$6855=true);(results$6856=[]);(temp$6881=stream$6848);($length$6887=temp$6881.length);($index$6893=0);$6857:for(;($index$6893<$length$6887);($index$6893++)){var x$6927;var $6948$6955;var x$6996;var token$7003;var fixity$6934;var name$6935;var t0$6919;var t1$6920;var token$6911;var $6860$6912;var t0$6907;var m$6902;(m$6902=temp$6881[$index$6893]);(t0$6907=m$6902);(token$6911=t0$6907);($6860$6912=t0$6907);if((((x$6927=$6860$6912)),((x$6927 instanceof Array)&&(x$6927[0]==="IGNORE")))){null;}else{(t0$6919=$6860$6912);if(((t0$6919 instanceof Array)&&(((t1$6920=t0$6919.length)),((t1$6920===3)&&(t0$6919[0]==="OP"))))){(fixity$6934=t0$6919[1]);(name$6935=t0$6919[2]);if(last_op$6855){results$6856.push(["VOID"]);}($6948$6955=fixity$6934);if(($6948$6955==="IFX")){results$6856.push(__lt____lt____colon__$5457(["IFX",W$6854((token$6911.wsa||token$6911.wsb)),name$6935],token$6911));(last_op$6855=true);}else{if(($6948$6955==="PFX")){if((!last_op$6855)){results$6856.push(["IFX",W$6854(token$6911.wsb),"WHITE"],["VOID"]);}results$6856.push(__lt____lt____colon__$5457(["PFX",W$6854(token$6911.wsa),name$6935],token$6911));(last_op$6855=true);}else{if(($6948$6955==="SFX")){results$6856.push(__lt____lt____colon__$5457(["SFX",W$6854(token$6911.wsb),name$6935],token$6911),["VOID"]);(last_op$6855=false);}else{$7209($6948$6955);}}}}else{if((((x$6996=$6860$6912)),((x$6996 instanceof Array)&&(x$6996[0]==="ILLEGAL")))){throw $7228(["syntax","illegal"]).create("unknown character",({"chr":token$6911}));}else{(token$7003=$6860$6912);if((!last_op$6855)){results$6856.push(["IFX",W$6854(token$7003.wsb),"WHITE"]);}results$6856.push(token$7003);(last_op$6855=false);}}}}if(last_op$6855){results$6856.push(["VOID"]);}return results$6856;}));(fill_locations$5467=(function(source$7017,stream$7018){var $index$7115;var $length$7109;var temp$7103;var to_fill$7024;var start$7025;var fill$7026;(to_fill$7024=[]);(start$7025=0);(fill$7026=(function(end$7041){var $index$7064;var $length$7058;var temp$7052;(temp$7052=to_fill$7024);($length$7058=temp$7052.length);($index$7064=0);$7045:for(;($index$7064<$length$7058);($index$7064++)){var token$7090;var token$7081;var m$7073;(m$7073=temp$7052[$index$7064]);(token$7081=m$7073);if(($index$7064===0)){(token$7081["location"]=Location$5456(source$7017,start$7025,end$7041));}else{(token$7090=m$7073);(token$7090["location"]=Location$5456(source$7017,end$7041,end$7041));}}(to_fill$7024=[]);}));(temp$7103=stream$7018);($length$7109=temp$7103.length);($index$7115=0);$7027:for(;($index$7115<$length$7109);($index$7115++)){var other$7148;var location$7133;var t0$7129;var m$7124;(m$7124=temp$7103[$index$7115]);(t0$7129=m$7124);if(($7640(t0$7129,"location")&&((location$7133=t0$7129.location),location$7133))){fill$7026(location$7133.start);(start$7025=location$7133.end);}else{(other$7148=m$7124);to_fill$7024.push(other$7148);}}fill$7026(source$7017.text.length);return stream$7018;}));(tokenize$5468=(function(src$7155){var it$0$7183;var it$0$7177;var it$0$7171;var it$0$7165;var it$0$7159;(it$0$7159=src$7155);(it$0$7165=produce$5462(it$0$7159));(it$0$7171=process_indent$5464(it$0$7165));(it$0$7177=disambiguate_fixity$5465(it$0$7171));(it$0$7183=alternate_operators$5466(it$0$7177));return fill_locations$5467(src$7155,it$0$7183);}));(exports["tokenize"]=tokenize$5468);(exports["process_indent"]=process_indent$5464);(exports["disambiguate_fixity"]=disambiguate_fixity$5465);(exports["alternate_operators"]=alternate_operators$5466);(exports["fill_locations"]=fill_locations$5467);
