var $3125=function(type$3127){var f$3130;(f$3130=type$3127["::check"]);;if((f$3130===(void 0))){return function(value$3135){return (value$3135 instanceof type$3127);};}else{return function(value$3138){return f$3130.call(type$3127,value$3138);};}};
var $3140=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $3141=function($3142$3144){var ph$3148;(ph$3148=$3142$3144);;var $3146$3153;($3146$3153=ph$3148);;var bridge$3147$3158;var x$3162;(bridge$3147$3158=$3146$3153);if((((typeof(bridge$3147$3158)==="string")&&((x$3162=bridge$3147$3158),true))||((typeof(bridge$3147$3158)==="number")&&((x$3162=bridge$3147$3158),true)))){return ["value",x$3162];}else{var other$3169;(other$3169=$3146$3153);return other$3169["::serialize_ast"]();}};
var send$2988;(send$2988=function(obj$2993,$2991$2994){var ph$2998;var msg$2999;var t0$3001;(t0$3001=$2991$2994);(msg$2999=t0$3001);(ph$2998=t0$3001);;var $2996$3005;($2996$3005=ph$2998);;var bridge$2997$3010;(bridge$2997$3010=$2996$3005);if(((typeof(bridge$2997$3010)==="string")||(typeof(bridge$2997$3010)==="number"))){return obj$2993[msg$2999];}else{var other$3018;(other$3018=$2996$3005);return obj$2993["::send"](msg$2999);}});;(Array[":::project"]=function($3021$3023){var ph$3026;var value$3027;var t0$3029;(t0$3029=$3021$3023);(value$3027=t0$3029);(ph$3026=t0$3029);;var $3025$3033;($3025$3033=ph$3026);;if($3125(Array)($3025$3033)){return [true,value$3027];}else{$3025$3033;return [true,[value$3027]];}});(Array.prototype["::check"]=function(value$3047){if((value$3047 instanceof Array)){var i$3052;(i$3052=0);;$3050:for(;(i$3052<this.length);(i$3052++)){if(($3140(this,i$3052)!==$3140(value$3047,i$3052))){return false;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value$3061){if((value$3061 instanceof Array)){var i$3066;(i$3066=0);;$3064:for(;(i$3066<this.length);(i$3066++)){if(($3140(this,i$3066)!==$3140(value$3061,i$3066))){return [true,[value$3061]];}}return [true,value$3061.slice(this.length)];}else{return [true,[value$3061]];}});(Array.prototype[":::deconstruct"]=function(value$3075){return [true,value$3075.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($3141));});(RegExp.prototype["::check"]=function(value$3080){return value$3080.match(this);});(RegExp.prototype[":::project"]=function(value$3083){var $3085$3087;($3085$3087=value$3083.match(this));;var m$3095;if(($3085$3087===null)){(m$3095=$3085$3087);return [false,null];}else{var m$3100;(m$3100=$3085$3087);return [true,m$3100];}});(RegExp.prototype[":::deconstruct"]=function(value$3103){var $3105$3107;($3105$3107=value$3103.match(this));;var m$3115;if(($3105$3107===null)){(m$3115=$3105$3107);return [false,null];}else{var m$3120;(m$3120=$3105$3107);return [true,m$3120];}});(Function.prototype["::send"]=function(args$3123){return this.apply(this,args$3123);});
var $3955=function(dest$3957,values$3958){var k$3963;(k$3963=null);$3961:for(k$3963 in values$3958){if(values$3958.hasOwnProperty(k$3963)){(dest$3957[k$3963]=values$3958[k$3963]);}}return dest$3957;};
var $3849=function(){var $3850$3852;($3850$3852=function(tags$3856){var it$0$3859;(it$0$3859=function(){if((!$3125($3850$3852)(this))){return Object.create($3850$3852.prototype);}else{return this;}}());;(it$0$3859["tags"]=tags$3856);return it$0$3859;});;($3850$3852.prototype["create"]=function(){var $3868$3870;($3868$3870=arguments);;var t0$3875;var message$3879;var args$3880;(t0$3875=$3868$3870.length);if((t0$3875>=0)){(message$3879=function(){if((0>=t0$3875)){return "";}else{return $3868$3870[0];}}());(args$3880=Array.prototype.slice.call($3868$3870,1));var it$0$3884;(it$0$3884=this);;var e$3889;(e$3889=Error(message$3879));;(e$3889["::tags"]=it$0$3884.tags);(e$3889["args"]=args$3880);(e$3889["name"]=["E"].concat(it$0$3884.tags).join("."));return e$3889;}else{$3836($3868$3870);}});($3850$3852.prototype["::check"]=function(e$3898){var it$0$3901;(it$0$3901=this);;var tags$3906;if(((!e$3898)||(!$3125(Error)(e$3898)))){return false;}(tags$3906=(e$3898["::tags"]||[]));;var temp$3914;(temp$3914=it$0$3901.tags);;var len$3919;(len$3919=temp$3914.length);;var i$3924;(i$3924=0);;$3907:for(;(i$3924<len$3919);(i$3924++)){var m$3932;(m$3932=temp$3914[i$3924]);;var tag$3940;(tag$3940=m$3932);if((tags$3906.indexOf(tag$3940)===(-1))){return false;}else{false;;}}return true;});($3850$3852.prototype["::deconstruct"]=function(e$3948){var it$0$3951;(it$0$3951=this);;return e$3948.args;});$3955($3850$3852,({}));return $3850$3852;}();
var $3836=function(value$3838,url$3839,start$3840,end$3841){var err$3844;(err$3844=$3849(["match"]).create("Could not find a match for value",({"value":value$3838})));;if(url$3839){(err$3844["location"]=["location",url$3839,start$3840,end$3841]);}throw err$3844;};var id$3198;var id_f$3199;var numr$3200;var numr_f$3201;var num$3202;var num_f$3203;var str$3204;var str_f$3205;var op$3206;var op2$3207;var op3$3208;var op4$3209;var op_f$3210;var indent$3211;var indent_f$3212;var cmnt$3213;var cmnt_f$3214;var unkn$3215;var unkn_f$3216;var $3172$3173;var Location$3174;var __lt____lt____colon__$3175;var special_ops$3176;var regexps$3177;var ws_re$3178;var eol_re$3179;var indent_tracker$3180;var process_token$3181;var tokenize$3182;($3172$3173=require("./location"));;(Location$3174=$3172$3173.Location);;(__lt____lt____colon__$3175=$3172$3173["<<:"]);;(special_ops$3176=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",":":"IFX",".":"PFX","'":"PFX"}));;(regexps$3177=(((id$3198=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))",""))),((id_f$3199=function(m$3223,wsb$3224,wsa$3225,last_op$3226){return ["ID","ID",m$3223[0]];})),((numr$3200=RegExp("(?:^((?:\\d+))[rR]((?:[A-Za-z0-9_]+))(?:(?:\\.((?:[A-Za-z0-9_]+)))?))",""))),((numr_f$3201=function(m$3235,wsb$3236,wsa$3237,last_op$3238){var t0$3246;var t1$3247;var radix$3241;var intp$3242;var frac$3243;var value$3244;(t0$3246=m$3235);if(((t0$3246 instanceof Array)&&((t1$3247=t0$3246.length),(t1$3247===4)))){t0$3246[0];(radix$3241=t0$3246[1]);(intp$3242=t0$3246[2]);(frac$3243=t0$3246[3]);;}else{$3836(m$3235,"/home/olivier/git/earl-grey/src/lex.eg",759,760);}(value$3244=parseInt(intp$3242.replace(RegExp("_","g"),""),radix$3241));;if(frac$3243){(frac$3243=frac$3243.replace(RegExp("_","g"),""));(value$3244=(value$3244+(parseInt(frac$3243,radix$3241)/Math.pow(radix$3241,frac$3243.length))));}return ["ID","NUM",value$3244];})),((num$3202=RegExp("(?:^((?:[0-9_]+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:[0-9_]+)))?))",""))),((num_f$3203=function(m$3263,wsb$3264,wsa$3265,last_op$3266){return ["ID","NUM",parseFloat(m$3263[0].replace(RegExp("_","g"),""))];})),((str$3204=RegExp("(?:^\"((?:(?:(?:\\\\\\\\|\\\\\")|[^\"])*))\")",""))),((str_f$3205=function(m$3275,wsb$3276,wsa$3277,last_op$3278){var repl$3281;var r$3282;(repl$3281=({"\\\"":"\"","\\\\":"\\","\\n":"\n"}));;(r$3282=m$3275[1].replace(RegExp("((?:(?:\\\\\"|\\\\\\\\)|\\\\n))","g"),function(m$3289){return $3140(repl$3281,m$3289);}));;return ["ID","STR",r$3282];})),((op$3206=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!@#.:']+))",""))),((op2$3207=RegExp("(?:^[\\[\\{\\}\\],])",""))),((op3$3208=RegExp("(?:^(?:(?:(?:(?:(?:(?:(?:(?:(?:(?:with|where)|when)|and)|not)|or)|in)|instanceof)|mod)|each)|as)\\b)",""))),((op4$3209=RegExp("(?:^`((?:[A-Za-z0-9_]+))`)",""))),((op_f$3210=function(m$3308,wsb$3309,wsa$3310,last_op$3311,column$3312){var other$3367;var $3345$3347;var fixity$3338;var width$3339;var $3316$3328;var $3315$3322;var op$3317;(op$3317=(m$3308[1]||m$3308[0]));;($3315$3322=null);;$3315$3322;if((op$3317==="|")){return ["INDENT",(column$3312-1)];}else{if((op$3317 in special_ops$3176)){(fixity$3338=$3140(special_ops$3176,op$3317));;(width$3339=((($3345$3347=fixity$3338)),function(){if(($3345$3347==="IFX")){if((wsb$3309||wsa$3310)){return "wide";}else{return "short";}}else{if(($3345$3347==="SFX")){if(wsb$3309){return "wide";}else{return "short";}}else{if(($3345$3347==="PFX")){if(wsa$3310){return "wide";}else{return "short";}}else{(other$3367=$3345$3347);throw $3849(["should_never_happen"]).create("unknown fixity");}}}}()));;return ["OP",fixity$3338,width$3339,op$3317];}else{if((wsa$3310&&wsb$3309)){return ["OP",function(){if(last_op$3311){return "PFX";}else{return "IFX";}}(),"wide",op$3317];}else{if(((!wsa$3310)&&(!wsb$3309))){return ["OP",function(){if(last_op$3311){return "PFX";}else{return "IFX";}}(),"short",op$3317];}else{if((wsa$3310&&last_op$3311)){return ["OP","PFX","wide",op$3317];}else{if(wsa$3310){return ["OP","SFX","short",op$3317];}else{if(wsb$3309){return ["OP","PFX","short",op$3317];}else{return ["OP","PFX","short",op$3317];}}}}}}}})),((indent$3211=RegExp("(?:^(?:(?:\n((?: *)))+))",""))),((indent_f$3212=function(m$3400,wsb$3401,wsa$3402,last_op$3403){var ilen$3406;(ilen$3406=m$3400[1].length);;return ["INDENT",ilen$3406];})),((cmnt$3213=RegExp("(?:^;(?:[^\n]*))",""))),((cmnt_f$3214=function(m$3417,wsb$3418,wsa$3419,last_op$3420){return ["IGNORE"];})),((unkn$3215=RegExp("(?:^.)",""))),((unkn_f$3216=function(m$3429,wsb$3430,wsa$3431,last_op$3432){return ["ILLEGAL",m$3429[0]];})),[[op3$3208,op_f$3210],[id$3198,id_f$3199],[numr$3200,numr_f$3201],[num$3202,num_f$3203],[str$3204,str_f$3205],[op$3206,op_f$3210],[op2$3207,op_f$3210],[op4$3209,op_f$3210],[indent$3211,indent_f$3212],[cmnt$3213,cmnt_f$3214],[unkn$3215,unkn_f$3216]]));;(ws_re$3178=RegExp("(?:^(?: *)(?:(?:\n(?: *)\\\\(?: *))*))",""));;(eol_re$3179=RegExp("(?:^(?: *)(?:\n|$))",""));;(indent_tracker$3180=function(){var curr$3448;var stack$3449;var stacks$3450;(curr$3448=false);;(stack$3449=[]);;(stacks$3450=[stack$3449]);;return function($3447$3461){var t0$3474;var rval$3520;var i$3575;var len$3570;var temp$3565;var acc$3560;var rval$3555;var other$3595;var fixity$3547;var width$3548;var fixity$3537;var width$3538;var stuff$3532;var new_indent$3494;var $3464$3495;var $3467$3488;var $3468$3489;var $3469$3490;var $3470$3491;var t0$3483;var t1$3484;var bridge$3465$3485;var bridge$3466$3486;var $3463$3478;var ph$3471;var token$3472;(t0$3474=$3447$3461);(token$3472=t0$3474);(ph$3471=t0$3474);;($3463$3478=ph$3471);;if((($3467$3488=($3463$3478 instanceof Array))&&((t0$3483=$3463$3478.length),((t0$3483===2)&&($3463$3478[0]==="INDENT"))))){(t1$3484=$3463$3478[1]);(new_indent$3494=t1$3484);($3464$3495=t1$3484);$3464$3495;if((curr$3448===false)){(curr$3448=new_indent$3494);return [["OP","IFX","wide",","]];}else{if(($3464$3495>curr$3448)){$3140(stack$3449.push(curr$3448),(curr$3448=new_indent$3494));return [["OP","PFX","wide","["]];}else{if(($3464$3495===curr$3448)){return [["OP","IFX","wide",","]];}else{if(($3464$3495<curr$3448)){(rval$3520=[]);;$3524:while(((stack$3449.length>0)&&(new_indent$3494<curr$3448))){(curr$3448=stack$3449.pop());rval$3520.push(["OP","SFX","wide","]"]);}rval$3520.push(["OP","IFX","wide",","]);return rval$3520;}else{$3836($3464$3495,"/home/olivier/git/earl-grey/src/lex.eg",3267,3283);}}}}}else{if(($3467$3488&&((t0$3483>=1)&&($3463$3478[0]==="ID")))){(stuff$3532=Array.prototype.slice.call($3463$3478,1));return [token$3472];}else{if(($3467$3488&&(($3469$3490=(t0$3483===4))&&(($3470$3491=($3463$3478[0]==="OP"))&&((fixity$3537=$3463$3478[1]),((width$3538=$3463$3478[2]),((bridge$3465$3485=$3463$3478[3]),((bridge$3465$3485==="[")||(bridge$3465$3485==="{"))))))))){stack$3449.push(curr$3448);stacks$3450.push(stack$3449);(stack$3449=[]);(curr$3448=false);return [token$3472];}else{if(($3470$3491&&((fixity$3547=$3463$3478[1]),((width$3548=$3463$3478[2]),((bridge$3466$3486=$3463$3478[3]),((bridge$3466$3486==="]")||(bridge$3466$3486==="}"))))))){(rval$3555=(((acc$3560=[])),(((temp$3565=stack$3449)),(((len$3570=temp$3565.length)),(((i$3575=0)),function(){$3558:for(;(i$3575<len$3570);(i$3575++)){var m$3583;(m$3583=temp$3565[i$3575]);;m$3583;acc$3560.push(["OP","SFX","short","]"]);}}()))),acc$3560));;(stack$3449=stacks$3450.pop());(curr$3448=stack$3449.pop());rval$3555.push(token$3472);return rval$3555;}else{(other$3595=$3463$3478);return [token$3472];}}}}};});;(process_token$3181=function(src$3601,token$3602,last_op$3603,wsa$3604,wsb$3605,pos$3606,endpos$3607,accum$3608){var t0$3615;var t1$3616;var w$3638;var v$3649;var w$3671;var v$3672;var v$3684;var $3647$3654;var other$3696;var $3611$3622;var type$3612;var result$3613;(t0$3615=token$3602);if(((t0$3615 instanceof Array)&&((t1$3616=t0$3615.length),(t1$3616>=1)))){(type$3612=t0$3615[0]);(result$3613=Array.prototype.slice.call(t0$3615,1));;}else{$3836(token$3602,"/home/olivier/git/earl-grey/src/lex.eg",4315,4320);}__lt____lt____colon__$3175(result$3613,token$3602);($3611$3622=type$3612);;if(($3611$3622==="IGNORE")){return last_op$3603;}else{if(($3611$3622==="ID")){if((!last_op$3603)){(w$3638=["IFX",function(){if(wsb$3605){return "wide";}else{return "short";}}(),"WHITE"]);;(w$3638["location"]=Location$3174(src$3601,pos$3606,pos$3606));accum$3608.push(w$3638);}accum$3608.push(result$3613);return false;}else{if(($3611$3622==="OP")){if(last_op$3603){(v$3649=["VOID"]);;(v$3649["location"]=Location$3174(src$3601,pos$3606,pos$3606));accum$3608.push(v$3649);}($3647$3654=result$3613[0]);;if(($3647$3654==="IFX")){accum$3608.push(result$3613);return true;}else{if(($3647$3654==="PFX")){if((!last_op$3603)){(w$3671=["IFX",function(){if(wsb$3605){return "wide";}else{return "short";}}(),"WHITE"]);;(w$3671["location"]=Location$3174(src$3601,pos$3606,pos$3606));(v$3672=["VOID"]);;(v$3672["location"]=Location$3174(src$3601,pos$3606,pos$3606));accum$3608.push(w$3671);accum$3608.push(v$3672);}accum$3608.push(result$3613);return true;}else{if(($3647$3654==="SFX")){accum$3608.push(result$3613);(v$3684=["VOID"]);;(v$3684["location"]=Location$3174(src$3601,endpos$3607,endpos$3607));accum$3608.push(v$3684);return false;}else{$3836($3647$3654);}}}}else{if(($3611$3622==="ILLEGAL")){throw $3849(["syntax","illegal"]).create("unknown character",({"chr":token$3602}));}else{(other$3696=$3611$3622);throw $3849(["should_never_happen"]).create("unknown token type",({"token":token$3602}));}}}}});;(tokenize$3182=function(src$3702){var v$3830;var text$3705;var last_op$3706;var results$3707;var wsb$3708;var pos$3709;var column$3710;var indent$3711;(text$3705=src$3702.text);;(last_op$3706=true);;(results$3707=[]);;(wsb$3708=text$3705.match(ws_re$3178)[0].length);;(text$3705=text$3705.slice(wsb$3708));(pos$3709=wsb$3708);;(column$3710=0);;(indent$3711=indent_tracker$3180());;$3733:while(text$3705){var i$3738;(i$3738=0);;$3736:for(;(i$3738<regexps$3177.length);(++i$3738)){var t0$3750;var t1$3751;var splits$3776;var i$3810;var len$3805;var temp$3800;var skip$3760;var endpos$3761;var wsa$3762;var eol$3763;var bwsb$3764;var bwsa$3765;var token$3766;var tokens$3767;var re$3746;var fn$3747;var m$3748;(t0$3750=$3140(regexps$3177,i$3738));if(((t0$3750 instanceof Array)&&((t1$3751=t0$3750.length),(t1$3751===2)))){(re$3746=t0$3750[0]);(fn$3747=t0$3750[1]);;}else{$3836($3140(regexps$3177,i$3738),"/home/olivier/git/earl-grey/src/lex.eg",5889,5899);}(m$3748=text$3705.match(re$3746));;if(m$3748){(skip$3760=m$3748[0].length);;(endpos$3761=(pos$3709+skip$3760));;(column$3710=(((splits$3776=m$3748[0].split("\n"))),function(){if((splits$3776.length>1)){return $3140(splits$3776,(splits$3776.length-1)).length;}else{return (column$3710+skip$3760);}}()));(text$3705=text$3705.slice(skip$3760));(wsa$3762=text$3705.match(ws_re$3178)[0].length);;(eol$3763=(text$3705.match(eol_re$3179)&&true));;(bwsb$3764=(wsb$3708>0));;(bwsa$3765=function(){if(eol$3763){return bwsb$3764;}else{return (wsa$3762>0);}}());;(token$3766=fn$3747(m$3748,bwsb$3764,bwsa$3765,last_op$3706,column$3710));;(tokens$3767=indent$3711(token$3766));;(temp$3800=tokens$3767);;(len$3805=temp$3800.length);;(i$3810=0);;$3768:for(;(i$3810<len$3805);(i$3810++)){var x$3826;var m$3818;(m$3818=temp$3800[i$3810]);;(x$3826=m$3818);(x$3826["location"]=Location$3174(src$3702,pos$3709,endpos$3761));(last_op$3706=process_token$3181(src$3702,x$3826,last_op$3706,bwsa$3765,bwsb$3764,pos$3709,endpos$3761,results$3707));}(text$3705=text$3705.slice(wsa$3762));(column$3710=(column$3710+wsa$3762));(wsb$3708=wsa$3762);(pos$3709=(endpos$3761+wsa$3762));break $3736;}}}if(last_op$3706){(v$3830=["VOID"]);;(v$3830["location"]=[pos$3709,pos$3709]);results$3707.push(v$3830);}return results$3707;});;(exports["tokenize"]=tokenize$3182);
