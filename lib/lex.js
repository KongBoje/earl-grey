var $3069=function(type$3071){var f$3074;(f$3074=type$3071["::check"]);;if((f$3074===(void 0))){return function(value$3079){return (value$3079 instanceof type$3071);};}else{return function(value$3082){return f$3074.call(type$3071,value$3082);};}};
var $3084=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $3085=function($3086$3088){var ph$3092;(ph$3092=$3086$3088);;var $3090$3097;($3090$3097=ph$3092);;var bridge$3091$3102;var x$3106;(bridge$3091$3102=$3090$3097);if((((typeof(bridge$3091$3102)==="string")&&((x$3106=bridge$3091$3102),true))||((typeof(bridge$3091$3102)==="number")&&((x$3106=bridge$3091$3102),true)))){return ["value",x$3106];}else{var other$3113;(other$3113=$3090$3097);return other$3113["::serialize_ast"]();}};
var send$2953;(send$2953=function(obj$2958,$2956$2959){var ph$2963;var msg$2964;var t0$2966;(t0$2966=$2956$2959);(msg$2964=t0$2966);(ph$2963=t0$2966);;var $2961$2970;($2961$2970=ph$2963);;var bridge$2962$2975;(bridge$2962$2975=$2961$2970);if(((typeof(bridge$2962$2975)==="string")||(typeof(bridge$2962$2975)==="number"))){return obj$2958[msg$2964];}else{var other$2983;(other$2983=$2961$2970);return obj$2958["::send"](msg$2964);}});;(Array[":::project"]=function($2986$2988){var ph$2991;var value$2992;var t0$2994;(t0$2994=$2986$2988);(value$2992=t0$2994);(ph$2991=t0$2994);;var $2990$2998;($2990$2998=ph$2991);;if($3069(Array)($2990$2998)){return [true,value$2992];}else{$2990$2998;return [true,[value$2992]];}});(Array.prototype["::check"]=function(value$3012){if((value$3012 instanceof Array)){var i$3017;(i$3017=0);;$3015:for(;(i$3017<this.length);(i$3017++)){if(($3084(this,i$3017)!==$3084(value$3012,i$3017))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return this.slice(0);});(Array.prototype[":::project"]=function(value$3028){if((value$3028 instanceof Array)){var i$3033;(i$3033=0);;$3031:for(;(i$3033<this.length);(i$3033++)){if(($3084(this,i$3033)!==$3084(value$3028,i$3033))){return [true,[value$3028]];}}return [true,value$3028.slice(this.length)];}else{return [true,[value$3028]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($3085));});(RegExp.prototype["::check"]=function(value$3044){return value$3044.match(this);});(RegExp.prototype[":::project"]=function(value$3047){var $3049$3051;($3049$3051=value$3047.match(this));;var m$3059;if(($3049$3051===null)){(m$3059=$3049$3051);return [false,null];}else{var m$3064;(m$3064=$3049$3051);return [true,m$3064];}});(Function.prototype["::send"]=function(args$3067){return this.apply(this,args$3067);});
var $3902=function(dest$3904,values$3905){var k$3910;(k$3910=null);$3908:for(k$3910 in values$3905){if(values$3905.hasOwnProperty(k$3910)){(dest$3904[k$3910]=values$3905[k$3910]);}}return dest$3904;};
var $3795=function(){var $3796$3798;($3796$3798=function(tags$3802){var it$0$3805;(it$0$3805=function(){if((!$3069($3796$3798)(this))){return Object.create($3796$3798.prototype);}else{return this;}}());;(it$0$3805["tags"]=tags$3802);return it$0$3805;});;($3796$3798.prototype["create"]=function(){var $3814$3816;($3814$3816=arguments);;var t0$3821;var message$3825;var args$3826;(t0$3821=$3814$3816.length);if((t0$3821>=0)){(message$3825=function(){if((0>=t0$3821)){return "";}else{return $3814$3816[0];}}());(args$3826=Array.prototype.slice.call($3814$3816,1));var it$0$3830;(it$0$3830=this);;var e$3835;(e$3835=Error(message$3825));;(e$3835["::tags"]=it$0$3830.tags);(e$3835["args"]=args$3826);(e$3835["name"]=["E"].concat(it$0$3830.tags).join("."));return e$3835;}else{$3782($3814$3816);}});($3796$3798.prototype["::check"]=function(e$3844){var it$0$3847;(it$0$3847=this);;var tags$3852;if(((!e$3844)||(!$3069(Error)(e$3844)))){return false;}(tags$3852=(e$3844["::tags"]||[]));;var temp$3861;(temp$3861=it$0$3847.tags);;var $length$3866;($length$3866=temp$3861.length);;var $index$3871;($index$3871=0);;$3853:for(;($index$3871<$length$3866);($index$3871++)){var m$3879;(m$3879=temp$3861[$index$3871]);;var tag$3887;(tag$3887=m$3879);if((tags$3852.indexOf(tag$3887)===(-1))){return false;}else{false;;}}return true;});($3796$3798.prototype["::deconstruct"]=function(e$3895){var it$0$3898;(it$0$3898=this);;return e$3895.args;});$3902($3796$3798,({}));return $3796$3798;}();
var $3782=function(value$3784,url$3785,start$3786,end$3787){var err$3790;(err$3790=$3795(["match"]).create("Could not find a match for value",({"value":value$3784})));;if(url$3785){(err$3790["location"]=["location",url$3785,start$3786,end$3787]);}throw err$3790;};var id$3142;var id_f$3143;var numr$3144;var numr_f$3145;var num$3146;var num_f$3147;var str$3148;var str_f$3149;var op$3150;var op2$3151;var op3$3152;var op4$3153;var op_f$3154;var indent$3155;var indent_f$3156;var cmnt$3157;var cmnt_f$3158;var unkn$3159;var unkn_f$3160;var $3116$3117;var Location$3118;var __lt____lt____colon__$3119;var special_ops$3120;var regexps$3121;var ws_re$3122;var eol_re$3123;var indent_tracker$3124;var process_token$3125;var tokenize$3126;($3116$3117=require("./location"));;(Location$3118=$3116$3117.Location);;(__lt____lt____colon__$3119=$3116$3117["<<:"]);;(special_ops$3120=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",":":"IFX",".":"PFX","'":"PFX"}));;(regexps$3121=(((id$3142=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))",""))),((id_f$3143=function(m$3167,wsb$3168,wsa$3169,last_op$3170){return ["ID","ID",m$3167[0]];})),((numr$3144=RegExp("(?:^((?:\\d+))[rR]((?:[A-Za-z0-9_]+))(?:(?:\\.((?:[A-Za-z0-9_]+)))?))",""))),((numr_f$3145=function(m$3179,wsb$3180,wsa$3181,last_op$3182){var t0$3190;var t1$3191;var radix$3185;var intp$3186;var frac$3187;var value$3188;(t0$3190=m$3179);if(((t0$3190 instanceof Array)&&((t1$3191=t0$3190.length),(t1$3191===4)))){t0$3190[0];(radix$3185=t0$3190[1]);(intp$3186=t0$3190[2]);(frac$3187=t0$3190[3]);;}else{$3782(m$3179,"/home/olivier/git/earl-grey/src/lex.eg",980,981);}(value$3188=parseInt(intp$3186.replace(RegExp("_","g"),""),radix$3185));;if(frac$3187){(frac$3187=frac$3187.replace(RegExp("_","g"),""));(value$3188=(value$3188+(parseInt(frac$3187,radix$3185)/Math.pow(radix$3185,frac$3187.length))));}return ["ID","NUM",value$3188];})),((num$3146=RegExp("(?:^((?:[0-9_]+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:[0-9_]+)))?))",""))),((num_f$3147=function(m$3207,wsb$3208,wsa$3209,last_op$3210){return ["ID","NUM",parseFloat(m$3207[0].replace(RegExp("_","g"),""))];})),((str$3148=RegExp("(?:^\"((?:(?:(?:\\\\\\\\|\\\\\")|[^\"])*))\")",""))),((str_f$3149=function(m$3219,wsb$3220,wsa$3221,last_op$3222){var repl$3225;var r$3226;(repl$3225=({"\\\"":"\"","\\\\":"\\","\\n":"\n"}));;(r$3226=m$3219[1].replace(RegExp("((?:(?:\\\\\"|\\\\\\\\)|\\\\n))","g"),function(m$3233){return $3084(repl$3225,m$3233);}));;return ["ID","STR",r$3226];})),((op$3150=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!@#.:']+))",""))),((op2$3151=RegExp("(?:^[\\[\\{\\}\\],])",""))),((op3$3152=RegExp("(?:^(?:(?:(?:(?:(?:(?:(?:(?:(?:(?:with|where)|when)|and)|not)|or)|in)|instanceof)|mod)|each)|as)(?:(?:[+\\-*/~\\^<>=%&|?!@#.:']+)|\\b))",""))),((op4$3153=RegExp("(?:^`((?:[A-Za-z0-9_]+))`)",""))),((op_f$3154=function(m$3252,wsb$3253,wsa$3254,last_op$3255,column$3256){var other$3311;var $3289$3291;var fixity$3282;var width$3283;var $3260$3272;var $3259$3266;var op$3261;(op$3261=(m$3252[1]||m$3252[0]));;($3259$3266=null);;$3259$3266;if((op$3261==="|")){return ["INDENT",(column$3256-1)];}else{if((op$3261 in special_ops$3120)){(fixity$3282=$3084(special_ops$3120,op$3261));;(width$3283=((($3289$3291=fixity$3282)),function(){if(($3289$3291==="IFX")){if((wsb$3253||wsa$3254)){return "wide";}else{return "short";}}else{if(($3289$3291==="SFX")){if(wsb$3253){return "wide";}else{return "short";}}else{if(($3289$3291==="PFX")){if(wsa$3254){return "wide";}else{return "short";}}else{(other$3311=$3289$3291);throw $3795(["syntax","should_never_happen"]).create("unknown fixity");}}}}()));;return ["OP",fixity$3282,width$3283,op$3261];}else{if((wsa$3254&&wsb$3253)){return ["OP",function(){if(last_op$3255){return "PFX";}else{return "IFX";}}(),"wide",op$3261];}else{if(((!wsa$3254)&&(!wsb$3253))){return ["OP",function(){if(last_op$3255){return "PFX";}else{return "IFX";}}(),"short",op$3261];}else{if((wsa$3254&&last_op$3255)){return ["OP","PFX","wide",op$3261];}else{if(wsa$3254){return ["OP","SFX","short",op$3261];}else{if(wsb$3253){return ["OP","PFX","short",op$3261];}else{return ["OP","PFX","short",op$3261];}}}}}}}})),((indent$3155=RegExp("(?:^(?:(?:\n((?: *)))+))",""))),((indent_f$3156=function(m$3344,wsb$3345,wsa$3346,last_op$3347){var ilen$3350;(ilen$3350=m$3344[1].length);;return ["INDENT",ilen$3350];})),((cmnt$3157=RegExp("(?:^;(?:[^\n]*))",""))),((cmnt_f$3158=function(m$3361,wsb$3362,wsa$3363,last_op$3364){return ["IGNORE"];})),((unkn$3159=RegExp("(?:^.)",""))),((unkn_f$3160=function(m$3373,wsb$3374,wsa$3375,last_op$3376){return ["ILLEGAL",m$3373[0]];})),[[op3$3152,op_f$3154],[id$3142,id_f$3143],[numr$3144,numr_f$3145],[num$3146,num_f$3147],[str$3148,str_f$3149],[op$3150,op_f$3154],[op2$3151,op_f$3154],[op4$3153,op_f$3154],[indent$3155,indent_f$3156],[cmnt$3157,cmnt_f$3158],[unkn$3159,unkn_f$3160]]));;(ws_re$3122=RegExp("(?:^(?: *)(?:(?:\n(?: *)\\\\(?: *))*))",""));;(eol_re$3123=RegExp("(?:^(?: *)(?:\n|$))",""));;(indent_tracker$3124=function(){var curr$3392;var stack$3393;var stacks$3394;(curr$3392=false);;(stack$3393=[]);;(stacks$3394=[stack$3393]);;return function($3391$3405){var t0$3418;var rval$3464;var $index$3520;var $length$3515;var temp$3510;var acc$3505;var rval$3499;var other$3540;var fixity$3491;var width$3492;var fixity$3481;var width$3482;var stuff$3476;var new_indent$3438;var $3408$3439;var $3411$3432;var $3412$3433;var $3413$3434;var $3414$3435;var t0$3427;var t1$3428;var bridge$3409$3429;var bridge$3410$3430;var $3407$3422;var ph$3415;var token$3416;(t0$3418=$3391$3405);(token$3416=t0$3418);(ph$3415=t0$3418);;($3407$3422=ph$3415);;if((($3411$3432=($3407$3422 instanceof Array))&&((t0$3427=$3407$3422.length),((t0$3427===2)&&($3407$3422[0]==="INDENT"))))){(t1$3428=$3407$3422[1]);(new_indent$3438=t1$3428);($3408$3439=t1$3428);$3408$3439;if((curr$3392===false)){(curr$3392=new_indent$3438);return [["OP","IFX","wide",","]];}else{if(($3408$3439>curr$3392)){$3084(stack$3393.push(curr$3392),(curr$3392=new_indent$3438));return [["OP","PFX","wide","["]];}else{if(($3408$3439===curr$3392)){return [["OP","IFX","wide",","]];}else{if(($3408$3439<curr$3392)){(rval$3464=[]);;$3468:while(((stack$3393.length>0)&&(new_indent$3438<curr$3392))){(curr$3392=stack$3393.pop());rval$3464.push(["OP","SFX","wide","]"]);}rval$3464.push(["OP","IFX","wide",","]);return rval$3464;}else{$3782($3408$3439,"/home/olivier/git/earl-grey/src/lex.eg",4969,4985);}}}}}else{if(($3411$3432&&((t0$3427>=1)&&($3407$3422[0]==="ID")))){(stuff$3476=Array.prototype.slice.call($3407$3422,1));return [token$3416];}else{if(($3411$3432&&(($3413$3434=(t0$3427===4))&&(($3414$3435=($3407$3422[0]==="OP"))&&((fixity$3481=$3407$3422[1]),((width$3482=$3407$3422[2]),((bridge$3409$3429=$3407$3422[3]),((bridge$3409$3429==="[")||(bridge$3409$3429==="{"))))))))){stack$3393.push(curr$3392);stacks$3394.push(stack$3393);(stack$3393=[]);(curr$3392=false);return [token$3416];}else{if(($3414$3435&&((fixity$3491=$3407$3422[1]),((width$3492=$3407$3422[2]),((bridge$3410$3430=$3407$3422[3]),((bridge$3410$3430==="]")||(bridge$3410$3430==="}"))))))){(rval$3499=(((acc$3505=[])),(((temp$3510=stack$3393)),((($length$3515=temp$3510.length)),((($index$3520=0)),function(){$3502:for(;($index$3520<$length$3515);($index$3520++)){var m$3528;(m$3528=temp$3510[$index$3520]);;m$3528;acc$3505.push(["OP","SFX","short","]"]);}}()))),acc$3505));;(stack$3393=stacks$3394.pop());(curr$3392=stack$3393.pop());rval$3499.push(token$3416);return rval$3499;}else{(other$3540=$3407$3422);return [token$3416];}}}}};});;(process_token$3125=function(src$3546,token$3547,last_op$3548,wsa$3549,wsb$3550,pos$3551,endpos$3552,accum$3553){var t0$3560;var t1$3561;var w$3583;var v$3594;var w$3616;var v$3617;var v$3629;var $3592$3599;var other$3641;var $3556$3567;var type$3557;var result$3558;(t0$3560=token$3547);if(((t0$3560 instanceof Array)&&((t1$3561=t0$3560.length),(t1$3561>=1)))){(type$3557=t0$3560[0]);(result$3558=Array.prototype.slice.call(t0$3560,1));;}else{$3782(token$3547,"/home/olivier/git/earl-grey/src/lex.eg",6493,6498);}__lt____lt____colon__$3119(result$3558,token$3547);($3556$3567=type$3557);;if(($3556$3567==="IGNORE")){return last_op$3548;}else{if(($3556$3567==="ID")){if((!last_op$3548)){(w$3583=["IFX",function(){if(wsb$3550){return "wide";}else{return "short";}}(),"WHITE"]);;(w$3583["location"]=Location$3118(src$3546,pos$3551,pos$3551));accum$3553.push(w$3583);}accum$3553.push(result$3558);return false;}else{if(($3556$3567==="OP")){if(last_op$3548){(v$3594=["VOID"]);;(v$3594["location"]=Location$3118(src$3546,pos$3551,pos$3551));accum$3553.push(v$3594);}($3592$3599=result$3558[0]);;if(($3592$3599==="IFX")){accum$3553.push(result$3558);return true;}else{if(($3592$3599==="PFX")){if((!last_op$3548)){(w$3616=["IFX",function(){if(wsb$3550){return "wide";}else{return "short";}}(),"WHITE"]);;(w$3616["location"]=Location$3118(src$3546,pos$3551,pos$3551));(v$3617=["VOID"]);;(v$3617["location"]=Location$3118(src$3546,pos$3551,pos$3551));accum$3553.push(w$3616);accum$3553.push(v$3617);}accum$3553.push(result$3558);return true;}else{if(($3592$3599==="SFX")){accum$3553.push(result$3558);(v$3629=["VOID"]);;(v$3629["location"]=Location$3118(src$3546,endpos$3552,endpos$3552));accum$3553.push(v$3629);return false;}else{$3782($3592$3599);}}}}else{if(($3556$3567==="ILLEGAL")){throw $3795(["syntax","illegal"]).create("unknown character",({"chr":token$3547}));}else{(other$3641=$3556$3567);throw $3795(["should_never_happen"]).create("unknown token type",({"token":token$3547}));}}}}});;(tokenize$3126=function(src$3647){var v$3776;var text$3650;var last_op$3651;var results$3652;var wsb$3653;var pos$3654;var column$3655;var indent$3656;(text$3650=src$3647.text);;(last_op$3651=true);;(results$3652=[]);;(wsb$3653=text$3650.match(ws_re$3122)[0].length);;(text$3650=text$3650.slice(wsb$3653));(pos$3654=wsb$3653);;(column$3655=0);;(indent$3656=indent_tracker$3124());;$3678:while(text$3650){var i$3683;(i$3683=0);;$3681:for(;(i$3683<regexps$3121.length);(++i$3683)){var t0$3695;var t1$3696;var splits$3722;var $index$3756;var $length$3751;var temp$3746;var skip$3705;var endpos$3706;var wsa$3707;var eol$3708;var bwsb$3709;var bwsa$3710;var token$3711;var tokens$3712;var re$3691;var fn$3692;var m$3693;(t0$3695=$3084(regexps$3121,i$3683));if(((t0$3695 instanceof Array)&&((t1$3696=t0$3695.length),(t1$3696===2)))){(re$3691=t0$3695[0]);(fn$3692=t0$3695[1]);;}else{$3782($3084(regexps$3121,i$3683),"/home/olivier/git/earl-grey/src/lex.eg",8067,8077);}(m$3693=text$3650.match(re$3691));;if(m$3693){(skip$3705=m$3693[0].length);;(endpos$3706=(pos$3654+skip$3705));;(column$3655=(((splits$3722=m$3693[0].split("\n"))),function(){if((splits$3722.length>1)){return $3084(splits$3722,(splits$3722.length-1)).length;}else{return (column$3655+skip$3705);}}()));(text$3650=text$3650.slice(skip$3705));(wsa$3707=text$3650.match(ws_re$3122)[0].length);;(eol$3708=(text$3650.match(eol_re$3123)&&true));;(bwsb$3709=(wsb$3653>0));;(bwsa$3710=function(){if(eol$3708){return bwsb$3709;}else{return (wsa$3707>0);}}());;(token$3711=fn$3692(m$3693,bwsb$3709,bwsa$3710,last_op$3651,column$3655));;(tokens$3712=indent$3656(token$3711));;(temp$3746=tokens$3712);;($length$3751=temp$3746.length);;($index$3756=0);;$3713:for(;($index$3756<$length$3751);($index$3756++)){var x$3772;var m$3764;(m$3764=temp$3746[$index$3756]);;(x$3772=m$3764);(x$3772["location"]=Location$3118(src$3647,pos$3654,endpos$3706));(last_op$3651=process_token$3125(src$3647,x$3772,last_op$3651,bwsa$3710,bwsb$3709,pos$3654,endpos$3706,results$3652));}(text$3650=text$3650.slice(wsa$3707));(column$3655=(column$3655+wsa$3707));(wsb$3653=wsa$3707);(pos$3654=(endpos$3706+wsa$3707));break $3681;}}}if(last_op$3651){(v$3776=["VOID"]);;(v$3776["location"]=[pos$3654,pos$3654]);results$3652.push(v$3776);}return results$3652;});;(exports["tokenize"]=tokenize$3126);
