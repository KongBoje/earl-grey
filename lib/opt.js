var $11977=(function(type$11980){var f$11984;(f$11984=type$11980["::check"]);if((f$11984===(void 0))){return (function(value$11990){return (value$11990 instanceof type$11980);});}else{return (function(value$11994){return f$11984.call(type$11980,value$11994);});}});
var $11996=(function(dest$11999,values$12000){var k$12005;(k$12005=null);$12003:for(k$12005 in values$12000){if(values$12000.hasOwnProperty(k$12005)){(dest$11999[k$12005]=values$12000[k$12005]);}}return dest$11999;});
var $12013=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $12014=(function($12016$12019){var ph$12025;(ph$12025=$12016$12019);var $12021$12031;($12021$12031=ph$12025);var bridge$12023$12036;var x$12040;(bridge$12023$12036=$12021$12031);if((((typeof(bridge$12023$12036)==="string")&&((x$12040=bridge$12023$12036),true))||((typeof(bridge$12023$12036)==="number")&&((x$12040=bridge$12023$12036),true)))){return ["value",x$12040];}else{var other$12051;(other$12051=$12021$12031);return other$12051["::serialize_ast"]();}});
var $12053=(function(obj$12056){var results$12061;(results$12061=[]);var k$12066;(k$12066=null);$12060:for(k$12066 in obj$12056){if(Object.prototype.hasOwnProperty.call(obj$12056,k$12066)){results$12061.push([k$12066,$12013(obj$12056,k$12066)]);}}return results$12061;});
var $12322=(function(arr$12325){var results$12331;var l$12332;(results$12331=[]);(l$12332=arr$12325.length);var i$12341;(i$12341=0);$12330:for(;(i$12341<l$12332);(i$12341++)){results$12331.push([i$12341,$12013(arr$12325,i$12341)]);}return results$12331;});
var $12089=(function(){var $12090$12096;($12090$12096=(function(tags$12101){var it$0$12104;(it$0$12104=(function(){if((!$11977($12090$12096)(this))){return Object.create($12090$12096.prototype);}else{return this;}})());(it$0$12104["tags"]=tags$12101);return it$0$12104;}));($12090$12096.prototype["create"]=(function(){var it$0$12124;var self$12125;(it$0$12124=this);(self$12125=this);var $12122$12134;($12122$12134=arguments);var t0$12139;var message$12143;var args$12144;(t0$12139=$12122$12134.length);if((t0$12139>=0)){(message$12143=(function(){if((0>=t0$12139)){return "";}else{return $12122$12134[0];}})());(args$12144=Array.prototype.slice.call($12122$12134,1));var e$12157;(e$12157=Error(message$12143));(e$12157["::tags"]=it$0$12124.tags);(e$12157["args"]=args$12144);var temp$12173;(temp$12173=$12322(args$12144));var $length$12179;($length$12179=temp$12173.length);var $index$12185;($index$12185=0);$12158:for(;($index$12185<$length$12179);($index$12185++)){var m$12194;(m$12194=temp$12173[$index$12185]);var t0$12199;var t1$12200;var i$12204;var arg$12205;(t0$12199=m$12194);if(((t0$12199 instanceof Array)&&(((t1$12200=t0$12199.length)),(t1$12200===2)))){(i$12204=t0$12199[0]);(arg$12205=t0$12199[1]);(e$12157[i$12204]=arg$12205);}else{$12070(m$12194);}}(e$12157["length"]=args$12144.length);(e$12157["name"]=["E"].concat(it$0$12124.tags).join("."));return e$12157;}else{$12070($12122$12134);}}));($12090$12096.prototype["::check"]=(function(e$12235){var it$0$12239;var self$12240;(it$0$12239=this);(self$12240=this);var tags$12250;if(((!e$12235)||(!$11977(Error)(e$12235)))){return false;}(tags$12250=(e$12235["::tags"]||[]));var temp$12261;(temp$12261=it$0$12239.tags);var $length$12267;($length$12267=temp$12261.length);var $index$12273;($index$12273=0);$12251:for(;($index$12273<$length$12267);($index$12273++)){var m$12282;(m$12282=temp$12261[$index$12273]);var tag$12290;(tag$12290=m$12282);if((tags$12250.indexOf(tag$12290)===-1)){return false;}else{false;}}return true;}));($12090$12096.prototype["::deconstruct"]=(function(e$12299){var it$0$12303;var self$12304;(it$0$12303=this);(self$12304=this);return e$12299.args;}));$11996($12090$12096,$11996((function(){var accum$12315;(accum$12315=({}));(accum$12315["::name"]="$12090");return accum$12315;})(),(function(){var accum$12319;(accum$12319=({}));(accum$12319["::egclass"]=true);return accum$12319;})()));return $12090$12096;})();
var $12070=(function(value$12073,url$12074,start$12075,end$12076){var err$12080;(err$12080=$12089(["match"]).create("Could not find a match for value",({"value":value$12073})));if(url$12074){(err$12080["location"]=["location",url$12074,start$12075,end$12076]);}throw err$12080;});
var send$11622;var __array_methods$11623;var __re_methods$11624;(send$11622=(function(obj$11637,$11634$11638){var ph$11644;var msg$11645;var t0$11647;(t0$11647=$11634$11638);(msg$11645=t0$11647);(ph$11644=t0$11647);var $11640$11656;($11640$11656=ph$11644);var bridge$11642$11661;(bridge$11642$11661=$11640$11656);if(((typeof(bridge$11642$11661)==="string")||(typeof(bridge$11642$11661)==="number"))){return obj$11637[msg$11645];}else{var other$11673;(other$11673=$11640$11656);return obj$11637["::send"](msg$11645);}}));(Array[":::project"]=(function($11679$11682){var ph$11687;var value$11688;var t0$11690;(t0$11690=$11679$11682);(value$11688=t0$11690);(ph$11687=t0$11690);var $11684$11699;($11684$11699=ph$11687);if($11977(Array)($11684$11699)){return [true,value$11688];}else{$11684$11699;return [true,[value$11688]];}}));(__array_methods$11623=$11996((function(){var accum$11720;(accum$11720=({}));(accum$11720["::check"]=(function(value$11725){if((value$11725 instanceof Array)){var i$11731;(i$11731=0);$11728:for(;(i$11731<this.length);(i$11731++)){if(($12013(this,i$11731)!==$12013(value$11725,i$11731))){return false;}}return true;}else{return false;}}));return accum$11720;})(),$11996((function(){var accum$11740;(accum$11740=({}));(accum$11740["::clone"]=(function(){return $11996(this.slice(0),this);}));return accum$11740;})(),$11996((function(){var accum$11747;(accum$11747=({}));(accum$11747[":::project"]=(function(value$11752){if((value$11752 instanceof Array)){var i$11758;(i$11758=0);$11755:for(;(i$11758<this.length);(i$11758++)){if(($12013(this,i$11758)!==$12013(value$11752,i$11758))){return [true,this.concat([value$11752])];}}return [true,value$11752];}else{return [true,this.concat([value$11752])];}}));return accum$11747;})(),(function(){var accum$11767;(accum$11767=({}));(accum$11767["::serialize_ast"]=(function(){return ["array"].concat(this.map($12014));}));return accum$11767;})()))));var temp$11777;(temp$11777=$12053(__array_methods$11623));var $length$11783;($length$11783=temp$11777.length);var $index$11789;($index$11789=0);$11625:for(;($index$11789<$length$11783);($index$11789++)){var m$11798;(m$11798=temp$11777[$index$11789]);var t0$11803;var t1$11804;var k$11808;var v$11809;(t0$11803=m$11798);if(((t0$11803 instanceof Array)&&(((t1$11804=t0$11803.length)),(t1$11804===2)))){(k$11808=t0$11803[0]);(v$11809=t0$11803[1]);if((!$12013(Array.prototype,k$11808))){Object.defineProperty(Array.prototype,k$11808,({"enumerable":false,"value":v$11809}));}}else{$12070(m$11798);}}(__re_methods$11624=$11996((function(){var accum$11829;(accum$11829=({}));(accum$11829["::check"]=(function($11833$11836){var ph$11841;(ph$11841=$11833$11836);var $11838$11847;($11838$11847=ph$11841);var value$11855;if((typeof($11838$11847)==="string")){(value$11855=$11838$11847);if(value$11855.match(this)){return true;}else{return false;}}else{var other$11860;(other$11860=$11838$11847);return false;}}));return accum$11829;})(),(function(){var accum$11863;(accum$11863=({}));(accum$11863[":::project"]=(function($11867$11870){var ph$11875;(ph$11875=$11867$11870);var $11872$11881;($11872$11881=ph$11875);var value$11889;if((typeof($11872$11881)==="string")){(value$11889=$11872$11881);var $11892$11897;($11892$11897=value$11889.match(this));var m$11905;if(($11892$11897===null)){(m$11905=$11892$11897);return [false,null];}else{var m$11910;(m$11910=$11892$11897);return [true,m$11910];}}else{var other$11914;(other$11914=$11872$11881);return [false,null];}}));return accum$11863;})()));var temp$11920;(temp$11920=$12053(__re_methods$11624));var $length$11926;($length$11926=temp$11920.length);var $index$11932;($index$11932=0);$11628:for(;($index$11932<$length$11926);($index$11932++)){var m$11941;(m$11941=temp$11920[$index$11932]);var t0$11946;var t1$11947;var k$11951;var v$11952;(t0$11946=m$11941);if(((t0$11946 instanceof Array)&&(((t1$11947=t0$11946.length)),(t1$11947===2)))){(k$11951=t0$11946[0]);(v$11952=t0$11946[1]);if((!$12013(RegExp.prototype,k$11951))){Object.defineProperty(RegExp.prototype,k$11951,({"enumerable":false,"value":v$11952}));}}else{$12070(m$11941);}}if((!Function.prototype["::send"])){Object.defineProperty(Function.prototype,"::send",$11996(({"enumerable":false}),(function(){var accum$11970;(accum$11970=({}));(accum$11970["value"]=(function(args$11975){return this.apply(this,args$11975);}));return accum$11970;})()));}var hoist$12354;var hoistable$12355;var not_hoistable$12356;var hoist_helper$12357;(hoist$12354=(function(expr$12362){var t0$12369;var t1$12370;var b$12366;var inner$12367;(t0$12369=hoist_helper$12357(expr$12362));if(((t0$12369 instanceof Array)&&(((t1$12370=t0$12369.length)),(t1$12370===2)))){(b$12366=t0$12369[0]);(inner$12367=t0$12369[1]);}else{$12070(hoist_helper$12357(expr$12362),"/home/olivier/git/earl-grey/src/opt.eg",50,68);}return ["scope",inner$12367,b$12366];}));(hoistable$12355=["send","array","object","multi","if","assign","js_break","js_continue","js_return","js_delete","js_throw","js_try","js_new"]);(not_hoistable$12356=["void","js_while","js_for","js_for_in","js_label"]);(hoist_helper$12357=(function($12393$12396){var t0$12413;var x$12449;var x$12455;var bridge$12401$12441;var x$12461;var t0$12482;var t1$12483;var newbody$12479;var inner$12480;var t0$12507;var t1$12508;var newbody$12504;var inner$12505;var $index$12562;var $length$12556;var temp$12550;var acc$12544;var accum$12532;var newargs$12533;var $index$12638;var $length$12632;var temp$12626;var acc$12620;var newargs$12612;var other$12705;var type$12604;var args$12605;var type$12523;var args$12524;var vars$12498;var body$12499;var vars$12468;var body$12469;var $12407$12430;var $12408$12431;var $12409$12432;var bridge$12400$12427;var t0$12428;var $12398$12422;var ph$12410;var expr$12411;(t0$12413=$12393$12396);(expr$12411=t0$12413);(ph$12410=t0$12413);($12398$12422=ph$12410);(bridge$12400$12427=$12398$12422);if(((((bridge$12401$12441=bridge$12400$12427)),((((x$12449=bridge$12401$12441)),((x$12449 instanceof Array)&&(x$12449[0]==="symbol")))||(((x$12455=bridge$12401$12441)),((x$12455 instanceof Array)&&(x$12455[0]==="value")))))||(((x$12461=bridge$12400$12427)),((x$12461 instanceof Array)&&(x$12461[0]==="variable"))))){return [expr$12411,[]];}else{if((($12407$12430=($12398$12422 instanceof Array))&&(((t0$12428=$12398$12422.length)),(($12409$12432=(t0$12428===3))&&($12398$12422[0]==="scope"))))){(vars$12468=$12398$12422[1]);(body$12469=$12398$12422[2]);(t0$12482=hoist_helper$12357(body$12469));if(((t0$12482 instanceof Array)&&(((t1$12483=t0$12482.length)),(t1$12483===2)))){(newbody$12479=t0$12482[0]);(inner$12480=t0$12482[1]);}else{$12070(hoist_helper$12357(body$12469),"/home/olivier/git/earl-grey/src/opt.eg",1463,1481);}return [newbody$12479,inner$12480.concat(vars$12468)];}else{if(($12409$12432&&($12398$12422[0]==="lambda"))){(vars$12498=$12398$12422[1]);(body$12499=$12398$12422[2]);(t0$12507=hoist_helper$12357(body$12499));if(((t0$12507 instanceof Array)&&(((t1$12508=t0$12507.length)),(t1$12508===2)))){(newbody$12504=t0$12507[0]);(inner$12505=t0$12507[1]);}else{$12070(hoist_helper$12357(body$12499),"/home/olivier/git/earl-grey/src/opt.eg",1666,1684);}return [["lambda",vars$12498,["scope",inner$12505,newbody$12504]],[]];}else{if(($12407$12430&&(($12409$12432=(t0$12428>=1))&&((type$12523=$12398$12422[0]),((args$12524=Array.prototype.slice.call($12398$12422,1)),(hoistable$12355.indexOf(type$12523)!==-1)))))){(accum$12532=[]);(newargs$12533=(((acc$12544=[])),(((temp$12550=args$12524)),((($length$12556=temp$12550.length)),((($index$12562=0)),(function(){$12539:for(;($index$12562<$length$12556);($index$12562++)){var t0$12587;var t1$12588;var b$12584;var inner$12585;var arg$12579;var m$12571;(m$12571=temp$12550[$index$12562]);(arg$12579=m$12571);acc$12544.push(((((t0$12587=hoist_helper$12357(arg$12579))),(function(){if(((t0$12587 instanceof Array)&&(((t1$12588=t0$12587.length)),(t1$12588===2)))){(b$12584=t0$12587[0]);(inner$12585=t0$12587[1]);}else{return $12070(hoist_helper$12357(arg$12579),"/home/olivier/git/earl-grey/src/opt.eg",2027,2044);}})()),(accum$12532=accum$12532.concat(inner$12585)),b$12584));}})()))),acc$12544));return [[type$12523].concat(newargs$12533),accum$12532];}else{if(($12409$12432&&((type$12604=$12398$12422[0]),((args$12605=Array.prototype.slice.call($12398$12422,1)),(not_hoistable$12356.indexOf(type$12604)!==-1))))){(newargs$12612=(((acc$12620=[])),(((temp$12626=args$12605)),((($length$12632=temp$12626.length)),((($index$12638=0)),(function(){$12615:for(;($index$12638<$length$12632);($index$12638++)){var t0$12666;var t1$12667;var other$12700;var t0$12687;var $12660$12682;var b$12663;var inner$12664;var arg$12655;var m$12647;(m$12647=temp$12626[$index$12638]);(arg$12655=m$12647);acc$12620.push(((((t0$12666=hoist_helper$12357(arg$12655))),(function(){if(((t0$12666 instanceof Array)&&(((t1$12667=t0$12666.length)),(t1$12667===2)))){(b$12663=t0$12666[0]);(inner$12664=t0$12666[1]);}else{return $12070(hoist_helper$12357(arg$12655),"/home/olivier/git/earl-grey/src/opt.eg",2370,2387);}})()),((($12660$12682=inner$12664)),(function(){if((($12660$12682 instanceof Array)&&(((t0$12687=$12660$12682.length)),(t0$12687===0)))){return b$12663;}else{(other$12700=$12660$12682);return ["scope",inner$12664,b$12663];}})())));}})()))),acc$12620));return [[type$12604].concat(newargs$12612),[]];}else{(other$12705=$12398$12422);throw $12089(["syntax","illegal"]).create("Illegal node -- this should not happen.",({"node":other$12705}));}}}}}}));(exports["hoist"]=hoist$12354);
