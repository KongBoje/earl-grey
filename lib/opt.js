var $11960=(function(type$11963){var f$11967;(f$11967=type$11963["::check"]);if((f$11967===(void 0))){return (function(value$11973){return (value$11973 instanceof type$11963);});}else{return (function(value$11977){return f$11967.call(type$11963,value$11977);});}});
var $11979=(function(dest$11982,values$11983){var k$11988;(k$11988=null);$11986:for(k$11988 in values$11983){if(values$11983.hasOwnProperty(k$11988)){(dest$11982[k$11988]=values$11983[k$11988]);}}return dest$11982;});
var $11996=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $11997=(function($11999$12002){var ph$12008;(ph$12008=$11999$12002);var $12004$12014;($12004$12014=ph$12008);var bridge$12006$12019;var x$12023;(bridge$12006$12019=$12004$12014);if((((typeof(bridge$12006$12019)==="string")&&((x$12023=bridge$12006$12019),true))||((typeof(bridge$12006$12019)==="number")&&((x$12023=bridge$12006$12019),true)))){return ["value",x$12023];}else{var other$12034;(other$12034=$12004$12014);return other$12034["::serialize_ast"]();}});
var $12036=(function(obj$12039){var results$12044;(results$12044=[]);var k$12049;(k$12049=null);$12043:for(k$12049 in obj$12039){if(Object.prototype.hasOwnProperty.call(obj$12039,k$12049)){results$12044.push([k$12049,$11996(obj$12039,k$12049)]);}}return results$12044;});
var $12305=(function(arr$12308){var results$12314;var l$12315;(results$12314=[]);(l$12315=arr$12308.length);var i$12324;(i$12324=0);$12313:for(;(i$12324<l$12315);(i$12324++)){results$12314.push([i$12324,$11996(arr$12308,i$12324)]);}return results$12314;});
var $12072=(function(){var $12073$12079;($12073$12079=(function(tags$12084){var it$0$12087;(it$0$12087=(function(){if((!$11960($12073$12079)(this))){return Object.create($12073$12079.prototype);}else{return this;}})());(it$0$12087["tags"]=tags$12084);return it$0$12087;}));($12073$12079.prototype["create"]=(function(){var it$0$12107;var self$12108;(it$0$12107=this);(self$12108=this);var $12105$12117;($12105$12117=arguments);var t0$12122;var message$12126;var args$12127;(t0$12122=$12105$12117.length);if((t0$12122>=0)){(message$12126=(function(){if((0>=t0$12122)){return "";}else{return $12105$12117[0];}})());(args$12127=Array.prototype.slice.call($12105$12117,1));var e$12140;(e$12140=Error(message$12126));(e$12140["::tags"]=it$0$12107.tags);(e$12140["args"]=args$12127);var temp$12156;(temp$12156=$12305(args$12127));var $length$12162;($length$12162=temp$12156.length);var $index$12168;($index$12168=0);$12141:for(;($index$12168<$length$12162);($index$12168++)){var m$12177;(m$12177=temp$12156[$index$12168]);var t0$12182;var t1$12183;var i$12187;var arg$12188;(t0$12182=m$12177);if(((t0$12182 instanceof Array)&&(((t1$12183=t0$12182.length)),(t1$12183===2)))){(i$12187=t0$12182[0]);(arg$12188=t0$12182[1]);(e$12140[i$12187]=arg$12188);}else{$12053(m$12177);}}(e$12140["length"]=args$12127.length);(e$12140["name"]=["E"].concat(it$0$12107.tags).join("."));return e$12140;}else{$12053($12105$12117);}}));($12073$12079.prototype["::check"]=(function(e$12218){var it$0$12222;var self$12223;(it$0$12222=this);(self$12223=this);var tags$12233;if(((!e$12218)||(!$11960(Error)(e$12218)))){return false;}(tags$12233=(e$12218["::tags"]||[]));var temp$12244;(temp$12244=it$0$12222.tags);var $length$12250;($length$12250=temp$12244.length);var $index$12256;($index$12256=0);$12234:for(;($index$12256<$length$12250);($index$12256++)){var m$12265;(m$12265=temp$12244[$index$12256]);var tag$12273;(tag$12273=m$12265);if((tags$12233.indexOf(tag$12273)===-1)){return false;}else{false;}}return true;}));($12073$12079.prototype["::deconstruct"]=(function(e$12282){var it$0$12286;var self$12287;(it$0$12286=this);(self$12287=this);return e$12282.args;}));$11979($12073$12079,$11979((function(){var accum$12298;(accum$12298=({}));(accum$12298["::name"]="$12073");return accum$12298;})(),(function(){var accum$12302;(accum$12302=({}));(accum$12302["::egclass"]=true);return accum$12302;})()));return $12073$12079;})();
var $12053=(function(value$12056,url$12057,start$12058,end$12059){var err$12063;(err$12063=$12072(["match"]).create("Could not find a match for value",({"value":value$12056})));if(url$12057){(err$12063["location"]=["location",url$12057,start$12058,end$12059]);}throw err$12063;});
var send$11605;var __array_methods$11606;var __re_methods$11607;(send$11605=(function(obj$11620,$11617$11621){var ph$11627;var msg$11628;var t0$11630;(t0$11630=$11617$11621);(msg$11628=t0$11630);(ph$11627=t0$11630);var $11623$11639;($11623$11639=ph$11627);var bridge$11625$11644;(bridge$11625$11644=$11623$11639);if(((typeof(bridge$11625$11644)==="string")||(typeof(bridge$11625$11644)==="number"))){return obj$11620[msg$11628];}else{var other$11656;(other$11656=$11623$11639);return obj$11620["::send"](msg$11628);}}));(Array[":::project"]=(function($11662$11665){var ph$11670;var value$11671;var t0$11673;(t0$11673=$11662$11665);(value$11671=t0$11673);(ph$11670=t0$11673);var $11667$11682;($11667$11682=ph$11670);if($11960(Array)($11667$11682)){return [true,value$11671];}else{$11667$11682;return [true,[value$11671]];}}));(__array_methods$11606=$11979((function(){var accum$11703;(accum$11703=({}));(accum$11703["::check"]=(function(value$11708){if((value$11708 instanceof Array)){var i$11714;(i$11714=0);$11711:for(;(i$11714<this.length);(i$11714++)){if(($11996(this,i$11714)!==$11996(value$11708,i$11714))){return false;}}return true;}else{return false;}}));return accum$11703;})(),$11979((function(){var accum$11723;(accum$11723=({}));(accum$11723["::clone"]=(function(){return $11979(this.slice(0),this);}));return accum$11723;})(),$11979((function(){var accum$11730;(accum$11730=({}));(accum$11730[":::project"]=(function(value$11735){if((value$11735 instanceof Array)){var i$11741;(i$11741=0);$11738:for(;(i$11741<this.length);(i$11741++)){if(($11996(this,i$11741)!==$11996(value$11735,i$11741))){return [true,this.concat([value$11735])];}}return [true,value$11735];}else{return [true,this.concat([value$11735])];}}));return accum$11730;})(),(function(){var accum$11750;(accum$11750=({}));(accum$11750["::serialize_ast"]=(function(){return ["array"].concat(this.map($11997));}));return accum$11750;})()))));var temp$11760;(temp$11760=$12036(__array_methods$11606));var $length$11766;($length$11766=temp$11760.length);var $index$11772;($index$11772=0);$11608:for(;($index$11772<$length$11766);($index$11772++)){var m$11781;(m$11781=temp$11760[$index$11772]);var t0$11786;var t1$11787;var k$11791;var v$11792;(t0$11786=m$11781);if(((t0$11786 instanceof Array)&&(((t1$11787=t0$11786.length)),(t1$11787===2)))){(k$11791=t0$11786[0]);(v$11792=t0$11786[1]);if((!$11996(Array.prototype,k$11791))){Object.defineProperty(Array.prototype,k$11791,({"enumerable":false,"value":v$11792}));}}else{$12053(m$11781);}}(__re_methods$11607=$11979((function(){var accum$11812;(accum$11812=({}));(accum$11812["::check"]=(function($11816$11819){var ph$11824;(ph$11824=$11816$11819);var $11821$11830;($11821$11830=ph$11824);var value$11838;if((typeof($11821$11830)==="string")){(value$11838=$11821$11830);if(value$11838.match(this)){return true;}else{return false;}}else{var other$11843;(other$11843=$11821$11830);return false;}}));return accum$11812;})(),(function(){var accum$11846;(accum$11846=({}));(accum$11846[":::project"]=(function($11850$11853){var ph$11858;(ph$11858=$11850$11853);var $11855$11864;($11855$11864=ph$11858);var value$11872;if((typeof($11855$11864)==="string")){(value$11872=$11855$11864);var $11875$11880;($11875$11880=value$11872.match(this));var m$11888;if(($11875$11880===null)){(m$11888=$11875$11880);return [false,null];}else{var m$11893;(m$11893=$11875$11880);return [true,m$11893];}}else{var other$11897;(other$11897=$11855$11864);return [false,null];}}));return accum$11846;})()));var temp$11903;(temp$11903=$12036(__re_methods$11607));var $length$11909;($length$11909=temp$11903.length);var $index$11915;($index$11915=0);$11611:for(;($index$11915<$length$11909);($index$11915++)){var m$11924;(m$11924=temp$11903[$index$11915]);var t0$11929;var t1$11930;var k$11934;var v$11935;(t0$11929=m$11924);if(((t0$11929 instanceof Array)&&(((t1$11930=t0$11929.length)),(t1$11930===2)))){(k$11934=t0$11929[0]);(v$11935=t0$11929[1]);if((!$11996(RegExp.prototype,k$11934))){Object.defineProperty(RegExp.prototype,k$11934,({"enumerable":false,"value":v$11935}));}}else{$12053(m$11924);}}if((!Function.prototype["::send"])){Object.defineProperty(Function.prototype,"::send",$11979(({"enumerable":false}),(function(){var accum$11953;(accum$11953=({}));(accum$11953["value"]=(function(args$11958){return this.apply(this,args$11958);}));return accum$11953;})()));}var hoist$12337;var hoistable$12338;var not_hoistable$12339;var hoist_helper$12340;(hoist$12337=(function(expr$12345){var t0$12352;var t1$12353;var b$12349;var inner$12350;(t0$12352=hoist_helper$12340(expr$12345));if(((t0$12352 instanceof Array)&&(((t1$12353=t0$12352.length)),(t1$12353===2)))){(b$12349=t0$12352[0]);(inner$12350=t0$12352[1]);}else{$12053(hoist_helper$12340(expr$12345),"/home/olivier/git/earl-grey/src/opt.eg",50,68);}return ["scope",inner$12350,b$12349];}));(hoistable$12338=["send","array","object","multi","if","assign","js_break","js_continue","js_return","js_delete","js_throw","js_try","js_new"]);(not_hoistable$12339=["void","js_while","js_for","js_for_in","js_label"]);(hoist_helper$12340=(function($12376$12379){var t0$12396;var x$12432;var x$12438;var bridge$12384$12424;var x$12444;var t0$12465;var t1$12466;var newbody$12462;var inner$12463;var t0$12490;var t1$12491;var newbody$12487;var inner$12488;var $index$12545;var $length$12539;var temp$12533;var acc$12527;var accum$12515;var newargs$12516;var $index$12621;var $length$12615;var temp$12609;var acc$12603;var newargs$12595;var other$12688;var type$12587;var args$12588;var type$12506;var args$12507;var vars$12481;var body$12482;var vars$12451;var body$12452;var $12390$12413;var $12391$12414;var $12392$12415;var bridge$12383$12410;var t0$12411;var $12381$12405;var ph$12393;var expr$12394;(t0$12396=$12376$12379);(expr$12394=t0$12396);(ph$12393=t0$12396);($12381$12405=ph$12393);(bridge$12383$12410=$12381$12405);if(((((bridge$12384$12424=bridge$12383$12410)),((((x$12432=bridge$12384$12424)),((x$12432 instanceof Array)&&(x$12432[0]==="symbol")))||(((x$12438=bridge$12384$12424)),((x$12438 instanceof Array)&&(x$12438[0]==="value")))))||(((x$12444=bridge$12383$12410)),((x$12444 instanceof Array)&&(x$12444[0]==="variable"))))){return [expr$12394,[]];}else{if((($12390$12413=($12381$12405 instanceof Array))&&(((t0$12411=$12381$12405.length)),(($12392$12415=(t0$12411===3))&&($12381$12405[0]==="scope"))))){(vars$12451=$12381$12405[1]);(body$12452=$12381$12405[2]);(t0$12465=hoist_helper$12340(body$12452));if(((t0$12465 instanceof Array)&&(((t1$12466=t0$12465.length)),(t1$12466===2)))){(newbody$12462=t0$12465[0]);(inner$12463=t0$12465[1]);}else{$12053(hoist_helper$12340(body$12452),"/home/olivier/git/earl-grey/src/opt.eg",1463,1481);}return [newbody$12462,inner$12463.concat(vars$12451)];}else{if(($12392$12415&&($12381$12405[0]==="lambda"))){(vars$12481=$12381$12405[1]);(body$12482=$12381$12405[2]);(t0$12490=hoist_helper$12340(body$12482));if(((t0$12490 instanceof Array)&&(((t1$12491=t0$12490.length)),(t1$12491===2)))){(newbody$12487=t0$12490[0]);(inner$12488=t0$12490[1]);}else{$12053(hoist_helper$12340(body$12482),"/home/olivier/git/earl-grey/src/opt.eg",1666,1684);}return [["lambda",vars$12481,["scope",inner$12488,newbody$12487]],[]];}else{if(($12390$12413&&(($12392$12415=(t0$12411>=1))&&((type$12506=$12381$12405[0]),((args$12507=Array.prototype.slice.call($12381$12405,1)),(hoistable$12338.indexOf(type$12506)!==-1)))))){(accum$12515=[]);(newargs$12516=(((acc$12527=[])),(((temp$12533=args$12507)),((($length$12539=temp$12533.length)),((($index$12545=0)),(function(){$12522:for(;($index$12545<$length$12539);($index$12545++)){var t0$12570;var t1$12571;var b$12567;var inner$12568;var arg$12562;var m$12554;(m$12554=temp$12533[$index$12545]);(arg$12562=m$12554);acc$12527.push(((((t0$12570=hoist_helper$12340(arg$12562))),(function(){if(((t0$12570 instanceof Array)&&(((t1$12571=t0$12570.length)),(t1$12571===2)))){(b$12567=t0$12570[0]);(inner$12568=t0$12570[1]);}else{return $12053(hoist_helper$12340(arg$12562),"/home/olivier/git/earl-grey/src/opt.eg",2027,2044);}})()),(accum$12515=accum$12515.concat(inner$12568)),b$12567));}})()))),acc$12527));return [[type$12506].concat(newargs$12516),accum$12515];}else{if(($12392$12415&&((type$12587=$12381$12405[0]),((args$12588=Array.prototype.slice.call($12381$12405,1)),(not_hoistable$12339.indexOf(type$12587)!==-1))))){(newargs$12595=(((acc$12603=[])),(((temp$12609=args$12588)),((($length$12615=temp$12609.length)),((($index$12621=0)),(function(){$12598:for(;($index$12621<$length$12615);($index$12621++)){var t0$12649;var t1$12650;var other$12683;var t0$12670;var $12643$12665;var b$12646;var inner$12647;var arg$12638;var m$12630;(m$12630=temp$12609[$index$12621]);(arg$12638=m$12630);acc$12603.push(((((t0$12649=hoist_helper$12340(arg$12638))),(function(){if(((t0$12649 instanceof Array)&&(((t1$12650=t0$12649.length)),(t1$12650===2)))){(b$12646=t0$12649[0]);(inner$12647=t0$12649[1]);}else{return $12053(hoist_helper$12340(arg$12638),"/home/olivier/git/earl-grey/src/opt.eg",2370,2387);}})()),((($12643$12665=inner$12647)),(function(){if((($12643$12665 instanceof Array)&&(((t0$12670=$12643$12665.length)),(t0$12670===0)))){return b$12646;}else{(other$12683=$12643$12665);return ["scope",inner$12647,b$12646];}})())));}})()))),acc$12603));return [[type$12587].concat(newargs$12595),[]];}else{(other$12688=$12381$12405);throw $12072(["syntax","illegal"]).create("Illegal node -- this should not happen.",({"node":other$12688}));}}}}}}));(exports["hoist"]=hoist$12337);
