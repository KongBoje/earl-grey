var $10857=function(type$10860){var f$10864;(f$10864=type$10860["::check"]);if((f$10864===(void 0))){return function(value$10870){return (value$10870 instanceof type$10860);};}else{return function(value$10874){return f$10864.call(type$10860,value$10874);};}};
var $10876=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $10877=function(dest$10880,values$10881){var k$10886;(k$10886=null);$10884:for(k$10886 in values$10881){if(values$10881.hasOwnProperty(k$10886)){(dest$10880[k$10886]=values$10881[k$10886]);}}return dest$10880;};
var $10894=function($10896$10899){var ph$10905;(ph$10905=$10896$10899);var $10901$10911;($10901$10911=ph$10905);var bridge$10903$10916;var x$10920;(bridge$10903$10916=$10901$10911);if((((typeof(bridge$10903$10916)==="string")&&((x$10920=bridge$10903$10916),true))||((typeof(bridge$10903$10916)==="number")&&((x$10920=bridge$10903$10916),true)))){return ["value",x$10920];}else{var other$10931;(other$10931=$10901$10911);return other$10931["::serialize_ast"]();}};
var send$10631;(send$10631=function(obj$10638,$10635$10639){var ph$10645;var msg$10646;var t0$10648;(t0$10648=$10635$10639);(msg$10646=t0$10648);(ph$10645=t0$10648);var $10641$10657;($10641$10657=ph$10645);var bridge$10643$10662;(bridge$10643$10662=$10641$10657);if(((typeof(bridge$10643$10662)==="string")||(typeof(bridge$10643$10662)==="number"))){return obj$10638[msg$10646];}else{var other$10674;(other$10674=$10641$10657);return obj$10638["::send"](msg$10646);}});(Array[":::project"]=function($10680$10683){var ph$10688;var value$10689;var t0$10691;(t0$10691=$10680$10683);(value$10689=t0$10691);(ph$10688=t0$10691);var $10685$10700;($10685$10700=ph$10688);if($10857(Array)($10685$10700)){return [true,value$10689];}else{$10685$10700;return [true,[value$10689]];}});(Array.prototype["::check"]=function(value$10718){if((value$10718 instanceof Array)){var i$10724;(i$10724=0);$10721:for(;(i$10724<this.length);(i$10724++)){if(($10876(this,i$10724)!==$10876(value$10718,i$10724))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $10877(this.slice(0),this);});(Array.prototype[":::project"]=function(value$10743){if((value$10743 instanceof Array)){var i$10749;(i$10749=0);$10746:for(;(i$10749<this.length);(i$10749++)){if(($10876(this,i$10749)!==$10876(value$10743,i$10749))){return [true,[value$10743]];}}return [true,value$10743.slice(this.length)];}else{return [true,[value$10743]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($10894));});(RegExp.prototype["::check"]=function($10767$10770){var ph$10775;(ph$10775=$10767$10770);var $10772$10781;($10772$10781=ph$10775);var value$10789;if((typeof($10772$10781)==="string")){(value$10789=$10772$10781);if(value$10789.match(this)){return true;}else{return false;}}else{var other$10794;(other$10794=$10772$10781);return false;}});(RegExp.prototype[":::project"]=function($10800$10803){var ph$10808;(ph$10808=$10800$10803);var $10805$10814;($10805$10814=ph$10808);var value$10822;if((typeof($10805$10814)==="string")){(value$10822=$10805$10814);var $10825$10830;($10825$10830=value$10822.match(this));var m$10838;if(($10825$10830===null)){(m$10838=$10825$10830);return [false,null];}else{var m$10843;(m$10843=$10825$10830);return [true,m$10843];}}else{var other$10847;(other$10847=$10805$10814);return [false,null];}});(Function.prototype["::send"]=function(args$10854){return this.apply(this,args$10854);});
var $11550=function(arr$11553){var results$11559;var l$11560;(results$11559=[]);(l$11560=arr$11553.length);var i$11569;(i$11569=0);$11558:for(;(i$11569<l$11560);(i$11569++)){results$11559.push([i$11569,$10876(arr$11553,i$11569)]);}return results$11559;};
var $11317=function(){var $11318$11324;($11318$11324=function(tags$11329){var it$0$11332;(it$0$11332=function(){if((!$10857($11318$11324)(this))){return Object.create($11318$11324.prototype);}else{return this;}}());(it$0$11332["tags"]=tags$11329);return it$0$11332;});($11318$11324.prototype["create"]=function(){var it$0$11352;var self$11353;(it$0$11352=this);(self$11353=this);var $11350$11362;($11350$11362=arguments);var t0$11367;var message$11371;var args$11372;(t0$11367=$11350$11362.length);if((t0$11367>=0)){(message$11371=function(){if((0>=t0$11367)){return "";}else{return $11350$11362[0];}}());(args$11372=Array.prototype.slice.call($11350$11362,1));var e$11385;(e$11385=Error(message$11371));(e$11385["::tags"]=it$0$11352.tags);(e$11385["args"]=args$11372);var temp$11401;(temp$11401=$11550(args$11372));var $length$11407;($length$11407=temp$11401.length);var $index$11413;($index$11413=0);$11386:for(;($index$11413<$length$11407);($index$11413++)){var m$11422;(m$11422=temp$11401[$index$11413]);var t0$11427;var t1$11428;var i$11432;var arg$11433;(t0$11427=m$11422);if(((t0$11427 instanceof Array)&&(((t1$11428=t0$11427.length)),(t1$11428===2)))){(i$11432=t0$11427[0]);(arg$11433=t0$11427[1]);(e$11385[i$11432]=arg$11433);}else{$11298(m$11422);}}(e$11385["length"]=args$11372.length);(e$11385["name"]=["E"].concat(it$0$11352.tags).join("."));return e$11385;}else{$11298($11350$11362);}});($11318$11324.prototype["::check"]=function(e$11463){var it$0$11467;var self$11468;(it$0$11467=this);(self$11468=this);var tags$11478;if(((!e$11463)||(!$10857(Error)(e$11463)))){return false;}(tags$11478=(e$11463["::tags"]||[]));var temp$11489;(temp$11489=it$0$11467.tags);var $length$11495;($length$11495=temp$11489.length);var $index$11501;($index$11501=0);$11479:for(;($index$11501<$length$11495);($index$11501++)){var m$11510;(m$11510=temp$11489[$index$11501]);var tag$11518;(tag$11518=m$11510);if((tags$11478.indexOf(tag$11518)===-1)){return false;}else{false;}}return true;});($11318$11324.prototype["::deconstruct"]=function(e$11527){var it$0$11531;var self$11532;(it$0$11531=this);(self$11532=this);return e$11527.args;});$10877($11318$11324,$10877(function(){var accum$11543;(accum$11543=({}));(accum$11543["::name"]="$11318");return accum$11543;}(),function(){var accum$11547;(accum$11547=({}));(accum$11547["::egclass"]=true);return accum$11547;}()));return $11318$11324;}();
var $11298=function(value$11301,url$11302,start$11303,end$11304){var err$11308;(err$11308=$11317(["match"]).create("Could not find a match for value",({"value":value$11301})));if(url$11302){(err$11308["location"]=["location",url$11302,start$11303,end$11304]);}throw err$11308;};var hoist$10939;var hoistable$10940;var not_hoistable$10941;var hoist_helper$10942;(hoist$10939=function(expr$10947){var t0$10954;var t1$10955;var b$10951;var inner$10952;(t0$10954=hoist_helper$10942(expr$10947));if(((t0$10954 instanceof Array)&&(((t1$10955=t0$10954.length)),(t1$10955===2)))){(b$10951=t0$10954[0]);(inner$10952=t0$10954[1]);}else{$11298(hoist_helper$10942(expr$10947),"/home/olivier/git/earl-grey/src/opt.eg",50,72);}return ["scope",inner$10952,b$10951];});(hoistable$10940=["send","array","object","multi","if","assign","js_break","js_continue","js_return","js_delete","js_throw","js_try","js_new"]);(not_hoistable$10941=["void","js_while","js_for","js_for_in","js_label"]);(hoist_helper$10942=function($10978$10981){var t0$10998;var x$11034;var x$11040;var bridge$10986$11026;var x$11046;var t0$11067;var t1$11068;var newbody$11064;var inner$11065;var t0$11092;var t1$11093;var newbody$11089;var inner$11090;var $index$11147;var $length$11141;var temp$11135;var acc$11129;var accum$11117;var newargs$11118;var $index$11223;var $length$11217;var temp$11211;var acc$11205;var newargs$11197;var other$11290;var type$11189;var args$11190;var type$11108;var args$11109;var vars$11083;var body$11084;var vars$11053;var body$11054;var $10992$11015;var $10993$11016;var $10994$11017;var bridge$10985$11012;var t0$11013;var $10983$11007;var ph$10995;var expr$10996;(t0$10998=$10978$10981);(expr$10996=t0$10998);(ph$10995=t0$10998);($10983$11007=ph$10995);(bridge$10985$11012=$10983$11007);if(((((bridge$10986$11026=bridge$10985$11012)),((((x$11034=bridge$10986$11026)),((x$11034 instanceof Array)&&(x$11034[0]==="symbol")))||(((x$11040=bridge$10986$11026)),((x$11040 instanceof Array)&&(x$11040[0]==="value")))))||(((x$11046=bridge$10985$11012)),((x$11046 instanceof Array)&&(x$11046[0]==="variable"))))){return [expr$10996,[]];}else{if((($10992$11015=($10983$11007 instanceof Array))&&(((t0$11013=$10983$11007.length)),(($10994$11017=(t0$11013===3))&&($10983$11007[0]==="scope"))))){(vars$11053=$10983$11007[1]);(body$11054=$10983$11007[2]);(t0$11067=hoist_helper$10942(body$11054));if(((t0$11067 instanceof Array)&&(((t1$11068=t0$11067.length)),(t1$11068===2)))){(newbody$11064=t0$11067[0]);(inner$11065=t0$11067[1]);}else{$11298(hoist_helper$10942(body$11054),"/home/olivier/git/earl-grey/src/opt.eg",1463,1488);}return [newbody$11064,inner$11065.concat(vars$11053)];}else{if(($10994$11017&&($10983$11007[0]==="lambda"))){(vars$11083=$10983$11007[1]);(body$11084=$10983$11007[2]);(t0$11092=hoist_helper$10942(body$11084));if(((t0$11092 instanceof Array)&&(((t1$11093=t0$11092.length)),(t1$11093===2)))){(newbody$11089=t0$11092[0]);(inner$11090=t0$11092[1]);}else{$11298(hoist_helper$10942(body$11084),"/home/olivier/git/earl-grey/src/opt.eg",1666,1691);}return [["lambda",vars$11083,["scope",inner$11090,newbody$11089]],[]];}else{if(($10992$11015&&(($10994$11017=(t0$11013>=1))&&((type$11108=$10983$11007[0]),((args$11109=Array.prototype.slice.call($10983$11007,1)),(hoistable$10940.indexOf(type$11108)!==-1)))))){(accum$11117=[]);(newargs$11118=(((acc$11129=[])),(((temp$11135=args$11109)),((($length$11141=temp$11135.length)),((($index$11147=0)),function(){$11124:for(;($index$11147<$length$11141);($index$11147++)){var t0$11172;var t1$11173;var b$11169;var inner$11170;var arg$11164;var m$11156;(m$11156=temp$11135[$index$11147]);(arg$11164=m$11156);acc$11129.push(((((t0$11172=hoist_helper$10942(arg$11164))),function(){if(((t0$11172 instanceof Array)&&(((t1$11173=t0$11172.length)),(t1$11173===2)))){(b$11169=t0$11172[0]);(inner$11170=t0$11172[1]);}else{return $11298(hoist_helper$10942(arg$11164),"/home/olivier/git/earl-grey/src/opt.eg",2027,2054);}}()),(accum$11117=accum$11117.concat(inner$11170)),b$11169));}}()))),acc$11129));return [[type$11108].concat(newargs$11118),accum$11117];}else{if(($10994$11017&&((type$11189=$10983$11007[0]),((args$11190=Array.prototype.slice.call($10983$11007,1)),(not_hoistable$10941.indexOf(type$11189)!==-1))))){(newargs$11197=(((acc$11205=[])),(((temp$11211=args$11190)),((($length$11217=temp$11211.length)),((($index$11223=0)),function(){$11200:for(;($index$11223<$length$11217);($index$11223++)){var t0$11251;var t1$11252;var other$11285;var t0$11272;var $11245$11267;var b$11248;var inner$11249;var arg$11240;var m$11232;(m$11232=temp$11211[$index$11223]);(arg$11240=m$11232);acc$11205.push(((((t0$11251=hoist_helper$10942(arg$11240))),function(){if(((t0$11251 instanceof Array)&&(((t1$11252=t0$11251.length)),(t1$11252===2)))){(b$11248=t0$11251[0]);(inner$11249=t0$11251[1]);}else{return $11298(hoist_helper$10942(arg$11240),"/home/olivier/git/earl-grey/src/opt.eg",2370,2397);}}()),((($11245$11267=inner$11249)),function(){if((($11245$11267 instanceof Array)&&(((t0$11272=$11245$11267.length)),(t0$11272===0)))){return b$11248;}else{(other$11285=$11245$11267);return ["scope",inner$11249,b$11248];}}())));}}()))),acc$11205));return [[type$11189].concat(newargs$11197),[]];}else{(other$11290=$10983$11007);throw $11317(["syntax","illegal"]).create("Illegal node -- this should not happen.",({"node":other$11290}));}}}}}});(exports["hoist"]=hoist$10939);
