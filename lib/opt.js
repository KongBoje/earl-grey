var $7333=function(type$7335){var f$7338;(f$7338=type$7335["::check"]);;if((f$7338===(void 0))){return function(value$7343){return (value$7343 instanceof type$7335);};}else{return function(value$7346){return f$7338.call(type$7335,value$7346);};}};
var $7348=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $7349=function($7350$7352){var ph$7356;(ph$7356=$7350$7352);;var $7354$7361;($7354$7361=ph$7356);;var bridge$7355$7366;var x$7370;(bridge$7355$7366=$7354$7361);if((((typeof(bridge$7355$7366)==="string")&&((x$7370=bridge$7355$7366),true))||((typeof(bridge$7355$7366)==="number")&&((x$7370=bridge$7355$7366),true)))){return ["value",x$7370];}else{var other$7377;(other$7377=$7354$7361);return other$7377["::serialize_ast"]();}};
var send$7173;(send$7173=function(obj$7178,$7176$7179){var ph$7183;var msg$7184;var t0$7186;(t0$7186=$7176$7179);(msg$7184=t0$7186);(ph$7183=t0$7186);;var $7181$7190;($7181$7190=ph$7183);;var bridge$7182$7195;(bridge$7182$7195=$7181$7190);if(((typeof(bridge$7182$7195)==="string")||(typeof(bridge$7182$7195)==="number"))){return obj$7178[msg$7184];}else{var other$7203;(other$7203=$7181$7190);return obj$7178["::send"](msg$7184);}});;(Array[":::project"]=function($7206$7208){var ph$7211;var value$7212;var t0$7214;(t0$7214=$7206$7208);(value$7212=t0$7214);(ph$7211=t0$7214);;var $7210$7218;($7210$7218=ph$7211);;if($7333(Array)($7210$7218)){return [true,value$7212];}else{$7210$7218;return [true,[value$7212]];}});(Array.prototype["::check"]=function(value$7232){if((value$7232 instanceof Array)){var i$7237;(i$7237=0);;$7235:for(;(i$7237<this.length);(i$7237++)){if(($7348(this,i$7237)!==$7348(value$7232,i$7237))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return this.slice(0);});(Array.prototype[":::project"]=function(value$7248){if((value$7248 instanceof Array)){var i$7253;(i$7253=0);;$7251:for(;(i$7253<this.length);(i$7253++)){if(($7348(this,i$7253)!==$7348(value$7248,i$7253))){return [true,[value$7248]];}}return [true,value$7248.slice(this.length)];}else{return [true,[value$7248]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($7349));});(RegExp.prototype["::check"]=function($7263$7265){var ph$7268;(ph$7268=$7263$7265);;var $7267$7273;($7267$7273=ph$7268);;var value$7281;if((typeof($7267$7273)==="string")){(value$7281=$7267$7273);if(value$7281.match(this)){return true;}else{return false;}}else{var other$7286;(other$7286=$7267$7273);return false;}});(RegExp.prototype[":::project"]=function($7288$7290){var ph$7293;(ph$7293=$7288$7290);;var $7292$7298;($7292$7298=ph$7293);;var value$7306;if((typeof($7292$7298)==="string")){(value$7306=$7292$7298);var $7309$7311;($7309$7311=value$7306.match(this));;var m$7319;if(($7309$7311===null)){(m$7319=$7309$7311);return [false,null];}else{var m$7324;(m$7324=$7309$7311);return [true,m$7324];}}else{var other$7328;(other$7328=$7292$7298);return [false,null];}});(Function.prototype["::send"]=function(args$7331){return this.apply(this,args$7331);});
var $7819=function(arr$7821){var results$7825;var l$7826;(results$7825=[]);;(l$7826=arr$7821.length);;var i$7834;(i$7834=0);;$7824:for(;(i$7834<l$7826);(i$7834++)){results$7825.push([i$7834,$7348(arr$7821,i$7834)]);}return results$7825;};
var $7841=function(dest$7843,values$7844){var k$7849;(k$7849=null);$7847:for(k$7849 in values$7844){if(values$7844.hasOwnProperty(k$7849)){(dest$7843[k$7849]=values$7844[k$7849]);}}return dest$7843;};
var $7650=function(){var $7651$7653;($7651$7653=function(tags$7657){var it$0$7660;(it$0$7660=function(){if((!$7333($7651$7653)(this))){return Object.create($7651$7653.prototype);}else{return this;}}());;(it$0$7660["tags"]=tags$7657);return it$0$7660;});;($7651$7653.prototype["create"]=function(){var $7669$7671;($7669$7671=arguments);;var t0$7676;var message$7680;var args$7681;(t0$7676=$7669$7671.length);if((t0$7676>=0)){(message$7680=function(){if((0>=t0$7676)){return "";}else{return $7669$7671[0];}}());(args$7681=Array.prototype.slice.call($7669$7671,1));var it$0$7685;(it$0$7685=this);;var self$7690;(self$7690=this);;var e$7695;(e$7695=Error(message$7680));;(e$7695["::tags"]=it$0$7685.tags);(e$7695["args"]=args$7681);var temp$7703;(temp$7703=$7819(args$7681));;var $length$7708;($length$7708=temp$7703.length);;var $index$7713;($index$7713=0);;$7696:for(;($index$7713<$length$7708);($index$7713++)){var m$7721;(m$7721=temp$7703[$index$7713]);;var t0$7726;var t1$7727;var i$7731;var arg$7732;(t0$7726=m$7721);if(((t0$7726 instanceof Array)&&((t1$7727=t0$7726.length),(t1$7727===2)))){(i$7731=t0$7726[0]);(arg$7732=t0$7726[1]);(e$7695[i$7731]=arg$7732);}else{$7637(m$7721);;}}(e$7695["length"]=args$7681.length);(e$7695["name"]=["E"].concat(it$0$7685.tags).join("."));return e$7695;}else{$7637($7669$7671);}});($7651$7653.prototype["::check"]=function(e$7743){var it$0$7746;(it$0$7746=this);;var self$7751;(self$7751=this);;var tags$7756;if(((!e$7743)||(!$7333(Error)(e$7743)))){return false;}(tags$7756=(e$7743["::tags"]||[]));;var temp$7765;(temp$7765=it$0$7746.tags);;var $length$7770;($length$7770=temp$7765.length);;var $index$7775;($index$7775=0);;$7757:for(;($index$7775<$length$7770);($index$7775++)){var m$7783;(m$7783=temp$7765[$index$7775]);;var tag$7791;(tag$7791=m$7783);if((tags$7756.indexOf(tag$7791)===-1)){return false;}else{false;;}}return true;});($7651$7653.prototype["::deconstruct"]=function(e$7799){var it$0$7802;(it$0$7802=this);;var self$7807;(self$7807=this);;return e$7799.args;});$7841($7651$7653,$7841(function(){var accum$7812;(accum$7812=({}));(accum$7812["::name"]="$7651");return accum$7812;}(),function(){var accum$7816;(accum$7816=({}));(accum$7816["::egclass"]=true);return accum$7816;}()));return $7651$7653;}();
var $7637=function(value$7639,url$7640,start$7641,end$7642){var err$7645;(err$7645=$7650(["match"]).create("Could not find a match for value",({"value":value$7639})));;if(url$7640){(err$7645["location"]=["location",url$7640,start$7641,end$7642]);}throw err$7645;};var hoist$7380;var hoistable$7381;var not_hoistable$7382;var hoist_helper$7383;(hoist$7380=function(expr$7387){var t0$7393;var t1$7394;var b$7390;var inner$7391;(t0$7393=hoist_helper$7383(expr$7387));if(((t0$7393 instanceof Array)&&((t1$7394=t0$7393.length),(t1$7394===2)))){(b$7390=t0$7393[0]);(inner$7391=t0$7393[1]);;}else{$7637(hoist_helper$7383(expr$7387),"/home/olivier/git/earl-grey/src/opt.eg",50,72);}return ["scope",inner$7391,b$7390];});;(hoistable$7381=["send","array","object","multi","if","assign","js_break","js_continue","js_return","js_delete","js_throw","js_try","js_new"]);;(not_hoistable$7382=["void","js_while","js_for","js_for_in","js_label"]);;(hoist_helper$7383=function($7408$7410){var t0$7421;var x$7443;var x$7448;var bridge$7414$7440;var x$7453;var t0$7469;var t1$7470;var newbody$7466;var inner$7467;var t0$7485;var t1$7486;var newbody$7482;var inner$7483;var $index$7525;var $length$7520;var temp$7515;var acc$7510;var accum$7500;var newargs$7501;var $index$7584;var $length$7579;var temp$7574;var acc$7569;var newargs$7563;var other$7633;var type$7556;var args$7557;var type$7493;var args$7494;var vars$7477;var body$7478;var vars$7460;var body$7461;var $7415$7433;var $7416$7434;var $7417$7435;var bridge$7413$7430;var t0$7431;var $7412$7425;var ph$7418;var expr$7419;(t0$7421=$7408$7410);(expr$7419=t0$7421);(ph$7418=t0$7421);;($7412$7425=ph$7418);;(bridge$7413$7430=$7412$7425);if((((bridge$7414$7440=bridge$7413$7430),((((x$7443=bridge$7414$7440)),((x$7443 instanceof Array)&&(x$7443[0]==="symbol")))||(((x$7448=bridge$7414$7440)),((x$7448 instanceof Array)&&(x$7448[0]==="value")))))||(((x$7453=bridge$7413$7430)),((x$7453 instanceof Array)&&(x$7453[0]==="variable"))))){return [expr$7419,[]];}else{if((($7415$7433=($7412$7425 instanceof Array))&&((t0$7431=$7412$7425.length),(($7417$7435=(t0$7431===3))&&($7412$7425[0]==="scope"))))){(vars$7460=$7412$7425[1]);(body$7461=$7412$7425[2]);(t0$7469=hoist_helper$7383(body$7461));if(((t0$7469 instanceof Array)&&((t1$7470=t0$7469.length),(t1$7470===2)))){(newbody$7466=t0$7469[0]);(inner$7467=t0$7469[1]);;}else{$7637(hoist_helper$7383(body$7461),"/home/olivier/git/earl-grey/src/opt.eg",447,472);}return [newbody$7466,inner$7467.concat(vars$7460)];}else{if(($7417$7435&&($7412$7425[0]==="lambda"))){(vars$7477=$7412$7425[1]);(body$7478=$7412$7425[2]);(t0$7485=hoist_helper$7383(body$7478));if(((t0$7485 instanceof Array)&&((t1$7486=t0$7485.length),(t1$7486===2)))){(newbody$7482=t0$7485[0]);(inner$7483=t0$7485[1]);;}else{$7637(hoist_helper$7383(body$7478),"/home/olivier/git/earl-grey/src/opt.eg",581,606);}return [["lambda",vars$7477,["scope",inner$7483,newbody$7482]],[]];}else{if(($7415$7433&&(($7417$7435=(t0$7431>=1))&&((type$7493=$7412$7425[0]),((args$7494=Array.prototype.slice.call($7412$7425,1)),(hoistable$7381.indexOf(type$7493)!==-1)))))){(accum$7500=[]);;(newargs$7501=(((acc$7510=[])),(((temp$7515=args$7494)),((($length$7520=temp$7515.length)),((($index$7525=0)),function(){$7507:for(;($index$7525<$length$7520);($index$7525++)){var t0$7547;var t1$7548;var b$7544;var inner$7545;var arg$7541;var m$7533;(m$7533=temp$7515[$index$7525]);;(arg$7541=m$7533);acc$7510.push((((t0$7547=hoist_helper$7383(arg$7541)),function(){if(((t0$7547 instanceof Array)&&((t1$7548=t0$7547.length),(t1$7548===2)))){(b$7544=t0$7547[0]);(inner$7545=t0$7547[1]);}else{return $7637(hoist_helper$7383(arg$7541),"/home/olivier/git/earl-grey/src/opt.eg",779,806);}}()),(accum$7500=accum$7500.concat(inner$7545)),b$7544));}}()))),acc$7510));;return [[type$7493].concat(newargs$7501),accum$7500];}else{if(($7417$7435&&((type$7556=$7412$7425[0]),((args$7557=Array.prototype.slice.call($7412$7425,1)),(not_hoistable$7382.indexOf(type$7556)!==-1))))){(newargs$7563=(((acc$7569=[])),(((temp$7574=args$7557)),((($length$7579=temp$7574.length)),((($index$7584=0)),function(){$7566:for(;($index$7584<$length$7579);($index$7584++)){var t0$7607;var t1$7608;var other$7628;var t0$7619;var $7603$7614;var b$7604;var inner$7605;var arg$7600;var m$7592;(m$7592=temp$7574[$index$7584]);;(arg$7600=m$7592);acc$7569.push((((t0$7607=hoist_helper$7383(arg$7600)),function(){if(((t0$7607 instanceof Array)&&((t1$7608=t0$7607.length),(t1$7608===2)))){(b$7604=t0$7607[0]);(inner$7605=t0$7607[1]);}else{return $7637(hoist_helper$7383(arg$7600),"/home/olivier/git/earl-grey/src/opt.eg",981,1008);}}()),((($7603$7614=inner$7605)),function(){if((($7603$7614 instanceof Array)&&((t0$7619=$7603$7614.length),(t0$7619===0)))){return b$7604;}else{(other$7628=$7603$7614);return ["scope",inner$7605,b$7604];}}())));}}()))),acc$7569));;return [[type$7556].concat(newargs$7563),[]];}else{(other$7633=$7412$7425);throw $7650(["syntax","illegal"]).create("Illegal node -- this should not happen.",({"node":other$7633}));}}}}}});;(exports["hoist"]=hoist$7380);
