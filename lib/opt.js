var $5993=function(type$5995){var f$5998;(f$5998=type$5995["::check"]);;if((f$5998===(void 0))){return function(value$6003){return (value$6003 instanceof type$5995);};}else{return function(value$6006){return f$5998.call(type$5995,value$6006);};}};
var $6008=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $6009=function($6010$6012){var ph$6016;(ph$6016=$6010$6012);;var $6014$6021;($6014$6021=ph$6016);;var bridge$6015$6026;var x$6030;(bridge$6015$6026=$6014$6021);if((((typeof(bridge$6015$6026)==="string")&&((x$6030=bridge$6015$6026),true))||((typeof(bridge$6015$6026)==="number")&&((x$6030=bridge$6015$6026),true)))){return ["value",x$6030];}else{var other$6037;(other$6037=$6014$6021);return other$6037["::serialize_ast"]();}};
var send$5877;(send$5877=function(obj$5882,$5880$5883){var ph$5887;var msg$5888;var t0$5890;(t0$5890=$5880$5883);(msg$5888=t0$5890);(ph$5887=t0$5890);;var $5885$5894;($5885$5894=ph$5887);;var bridge$5886$5899;(bridge$5886$5899=$5885$5894);if(((typeof(bridge$5886$5899)==="string")||(typeof(bridge$5886$5899)==="number"))){return obj$5882[msg$5888];}else{var other$5907;(other$5907=$5885$5894);return obj$5882["::send"](msg$5888);}});;(Array[":::project"]=function($5910$5912){var ph$5915;var value$5916;var t0$5918;(t0$5918=$5910$5912);(value$5916=t0$5918);(ph$5915=t0$5918);;var $5914$5922;($5914$5922=ph$5915);;if($5993(Array)($5914$5922)){return [true,value$5916];}else{$5914$5922;return [true,[value$5916]];}});(Array.prototype["::check"]=function(value$5936){if((value$5936 instanceof Array)){var i$5941;(i$5941=0);;$5939:for(;(i$5941<this.length);(i$5941++)){if(($6008(this,i$5941)!==$6008(value$5936,i$5941))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return this.slice(0);});(Array.prototype[":::project"]=function(value$5952){if((value$5952 instanceof Array)){var i$5957;(i$5957=0);;$5955:for(;(i$5957<this.length);(i$5957++)){if(($6008(this,i$5957)!==$6008(value$5952,i$5957))){return [true,[value$5952]];}}return [true,value$5952.slice(this.length)];}else{return [true,[value$5952]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($6009));});(RegExp.prototype["::check"]=function(value$5968){return value$5968.match(this);});(RegExp.prototype[":::project"]=function(value$5971){var $5973$5975;($5973$5975=value$5971.match(this));;var m$5983;if(($5973$5975===null)){(m$5983=$5973$5975);return [false,null];}else{var m$5988;(m$5988=$5973$5975);return [true,m$5988];}});(Function.prototype["::send"]=function(args$5991){return this.apply(this,args$5991);});
var $6417=function(dest$6419,values$6420){var k$6425;(k$6425=null);$6423:for(k$6425 in values$6420){if(values$6420.hasOwnProperty(k$6425)){(dest$6419[k$6425]=values$6420[k$6425]);}}return dest$6419;};
var $6310=function(){var $6311$6313;($6311$6313=function(tags$6317){var it$0$6320;(it$0$6320=function(){if((!$5993($6311$6313)(this))){return Object.create($6311$6313.prototype);}else{return this;}}());;(it$0$6320["tags"]=tags$6317);return it$0$6320;});;($6311$6313.prototype["create"]=function(){var $6329$6331;($6329$6331=arguments);;var t0$6336;var message$6340;var args$6341;(t0$6336=$6329$6331.length);if((t0$6336>=0)){(message$6340=function(){if((0>=t0$6336)){return "";}else{return $6329$6331[0];}}());(args$6341=Array.prototype.slice.call($6329$6331,1));var it$0$6345;(it$0$6345=this);;var e$6350;(e$6350=Error(message$6340));;(e$6350["::tags"]=it$0$6345.tags);(e$6350["args"]=args$6341);(e$6350["name"]=["E"].concat(it$0$6345.tags).join("."));return e$6350;}else{$6297($6329$6331);}});($6311$6313.prototype["::check"]=function(e$6359){var it$0$6362;(it$0$6362=this);;var tags$6367;if(((!e$6359)||(!$5993(Error)(e$6359)))){return false;}(tags$6367=(e$6359["::tags"]||[]));;var temp$6376;(temp$6376=it$0$6362.tags);;var $length$6381;($length$6381=temp$6376.length);;var $index$6386;($index$6386=0);;$6368:for(;($index$6386<$length$6381);($index$6386++)){var m$6394;(m$6394=temp$6376[$index$6386]);;var tag$6402;(tag$6402=m$6394);if((tags$6367.indexOf(tag$6402)===(-1))){return false;}else{false;;}}return true;});($6311$6313.prototype["::deconstruct"]=function(e$6410){var it$0$6413;(it$0$6413=this);;return e$6410.args;});$6417($6311$6313,({}));return $6311$6313;}();
var $6297=function(value$6299,url$6300,start$6301,end$6302){var err$6305;(err$6305=$6310(["match"]).create("Could not find a match for value",({"value":value$6299})));;if(url$6300){(err$6305["location"]=["location",url$6300,start$6301,end$6302]);}throw err$6305;};var hoist$6040;var hoistable$6041;var not_hoistable$6042;var hoist_helper$6043;(hoist$6040=function(expr$6047){var t0$6053;var t1$6054;var b$6050;var inner$6051;(t0$6053=hoist_helper$6043(expr$6047));if(((t0$6053 instanceof Array)&&((t1$6054=t0$6053.length),(t1$6054===2)))){(b$6050=t0$6053[0]);(inner$6051=t0$6053[1]);;}else{$6297(hoist_helper$6043(expr$6047),"/home/olivier/git/earl-grey/src/opt.eg",50,68);}return ["scope",inner$6051,b$6050];});;(hoistable$6041=["send","array","object","multi","if","assign","js_break","js_continue","js_return","js_delete","js_throw","js_try","js_new"]);;(not_hoistable$6042=["void","js_while","js_for","js_for_in","js_label"]);;(hoist_helper$6043=function($6068$6070){var t0$6081;var x$6103;var x$6108;var bridge$6074$6100;var x$6113;var t0$6129;var t1$6130;var newbody$6126;var inner$6127;var t0$6145;var t1$6146;var newbody$6142;var inner$6143;var $index$6185;var $length$6180;var temp$6175;var acc$6170;var accum$6160;var newargs$6161;var $index$6244;var $length$6239;var temp$6234;var acc$6229;var newargs$6223;var other$6293;var type$6216;var args$6217;var type$6153;var args$6154;var vars$6137;var body$6138;var vars$6120;var body$6121;var $6075$6093;var $6076$6094;var $6077$6095;var bridge$6073$6090;var t0$6091;var $6072$6085;var ph$6078;var expr$6079;(t0$6081=$6068$6070);(expr$6079=t0$6081);(ph$6078=t0$6081);;($6072$6085=ph$6078);;(bridge$6073$6090=$6072$6085);if((((bridge$6074$6100=bridge$6073$6090),((((x$6103=bridge$6074$6100)),((x$6103 instanceof Array)&&(x$6103[0]==="symbol")))||(((x$6108=bridge$6074$6100)),((x$6108 instanceof Array)&&(x$6108[0]==="value")))))||(((x$6113=bridge$6073$6090)),((x$6113 instanceof Array)&&(x$6113[0]==="variable"))))){return [expr$6079,[]];}else{if((($6075$6093=($6072$6085 instanceof Array))&&((t0$6091=$6072$6085.length),(($6077$6095=(t0$6091===3))&&($6072$6085[0]==="scope"))))){(vars$6120=$6072$6085[1]);(body$6121=$6072$6085[2]);(t0$6129=hoist_helper$6043(body$6121));if(((t0$6129 instanceof Array)&&((t1$6130=t0$6129.length),(t1$6130===2)))){(newbody$6126=t0$6129[0]);(inner$6127=t0$6129[1]);;}else{$6297(hoist_helper$6043(body$6121),"/home/olivier/git/earl-grey/src/opt.eg",447,465);}return [newbody$6126,inner$6127.concat(vars$6120)];}else{if(($6077$6095&&($6072$6085[0]==="lambda"))){(vars$6137=$6072$6085[1]);(body$6138=$6072$6085[2]);(t0$6145=hoist_helper$6043(body$6138));if(((t0$6145 instanceof Array)&&((t1$6146=t0$6145.length),(t1$6146===2)))){(newbody$6142=t0$6145[0]);(inner$6143=t0$6145[1]);;}else{$6297(hoist_helper$6043(body$6138),"/home/olivier/git/earl-grey/src/opt.eg",581,599);}return [["lambda",vars$6137,["scope",inner$6143,newbody$6142]],[]];}else{if(($6075$6093&&(($6077$6095=(t0$6091>=1))&&((type$6153=$6072$6085[0]),((args$6154=Array.prototype.slice.call($6072$6085,1)),(hoistable$6041.indexOf(type$6153)!==(-1))))))){(accum$6160=[]);;(newargs$6161=(((acc$6170=[])),(((temp$6175=args$6154)),((($length$6180=temp$6175.length)),((($index$6185=0)),function(){$6167:for(;($index$6185<$length$6180);($index$6185++)){var t0$6207;var t1$6208;var b$6204;var inner$6205;var arg$6201;var m$6193;(m$6193=temp$6175[$index$6185]);;(arg$6201=m$6193);acc$6170.push((((t0$6207=hoist_helper$6043(arg$6201)),function(){if(((t0$6207 instanceof Array)&&((t1$6208=t0$6207.length),(t1$6208===2)))){(b$6204=t0$6207[0]);(inner$6205=t0$6207[1]);}else{return $6297(hoist_helper$6043(arg$6201),"/home/olivier/git/earl-grey/src/opt.eg",779,796);}}()),(accum$6160=accum$6160.concat(inner$6205)),b$6204));}}()))),acc$6170));;return [[type$6153].concat(newargs$6161),accum$6160];}else{if(($6077$6095&&((type$6216=$6072$6085[0]),((args$6217=Array.prototype.slice.call($6072$6085,1)),(not_hoistable$6042.indexOf(type$6216)!==(-1)))))){(newargs$6223=(((acc$6229=[])),(((temp$6234=args$6217)),((($length$6239=temp$6234.length)),((($index$6244=0)),function(){$6226:for(;($index$6244<$length$6239);($index$6244++)){var t0$6267;var t1$6268;var other$6288;var t0$6279;var $6263$6274;var b$6264;var inner$6265;var arg$6260;var m$6252;(m$6252=temp$6234[$index$6244]);;(arg$6260=m$6252);acc$6229.push((((t0$6267=hoist_helper$6043(arg$6260)),function(){if(((t0$6267 instanceof Array)&&((t1$6268=t0$6267.length),(t1$6268===2)))){(b$6264=t0$6267[0]);(inner$6265=t0$6267[1]);}else{return $6297(hoist_helper$6043(arg$6260),"/home/olivier/git/earl-grey/src/opt.eg",981,998);}}()),((($6263$6274=inner$6265)),function(){if((($6263$6274 instanceof Array)&&((t0$6279=$6263$6274.length),(t0$6279===0)))){return b$6264;}else{(other$6288=$6263$6274);return ["scope",inner$6265,b$6264];}}())));}}()))),acc$6229));;return [[type$6216].concat(newargs$6223),[]];}else{(other$6293=$6072$6085);throw $6310(["syntax","illegal"]).create("Illegal node -- this should not happen.",({"node":other$6293}));}}}}}});;(exports["hoist"]=hoist$6040);
