var $7410=function(type$7412){var f$7415;(f$7415=type$7412["::check"]);;if((f$7415===(void 0))){return function(value$7420){return (value$7420 instanceof type$7412);};}else{return function(value$7423){return f$7415.call(type$7412,value$7423);};}};
var $7425=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $7426=function(dest$7428,values$7429){var k$7434;(k$7434=null);$7432:for(k$7434 in values$7429){if(values$7429.hasOwnProperty(k$7434)){(dest$7428[k$7434]=values$7429[k$7434]);}}return dest$7428;};
var $7438=function($7439$7441){var ph$7445;(ph$7445=$7439$7441);;var $7443$7450;($7443$7450=ph$7445);;var bridge$7444$7455;var x$7459;(bridge$7444$7455=$7443$7450);if((((typeof(bridge$7444$7455)==="string")&&((x$7459=bridge$7444$7455),true))||((typeof(bridge$7444$7455)==="number")&&((x$7459=bridge$7444$7455),true)))){return ["value",x$7459];}else{var other$7466;(other$7466=$7443$7450);return other$7466["::serialize_ast"]();}};
var send$7250;(send$7250=function(obj$7255,$7253$7256){var ph$7260;var msg$7261;var t0$7263;(t0$7263=$7253$7256);(msg$7261=t0$7263);(ph$7260=t0$7263);;var $7258$7267;($7258$7267=ph$7260);;var bridge$7259$7272;(bridge$7259$7272=$7258$7267);if(((typeof(bridge$7259$7272)==="string")||(typeof(bridge$7259$7272)==="number"))){return obj$7255[msg$7261];}else{var other$7280;(other$7280=$7258$7267);return obj$7255["::send"](msg$7261);}});;(Array[":::project"]=function($7283$7285){var ph$7288;var value$7289;var t0$7291;(t0$7291=$7283$7285);(value$7289=t0$7291);(ph$7288=t0$7291);;var $7287$7295;($7287$7295=ph$7288);;if($7410(Array)($7287$7295)){return [true,value$7289];}else{$7287$7295;return [true,[value$7289]];}});(Array.prototype["::check"]=function(value$7309){if((value$7309 instanceof Array)){var i$7314;(i$7314=0);;$7312:for(;(i$7314<this.length);(i$7314++)){if(($7425(this,i$7314)!==$7425(value$7309,i$7314))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $7426(this.slice(0),this);});(Array.prototype[":::project"]=function(value$7325){if((value$7325 instanceof Array)){var i$7330;(i$7330=0);;$7328:for(;(i$7330<this.length);(i$7330++)){if(($7425(this,i$7330)!==$7425(value$7325,i$7330))){return [true,[value$7325]];}}return [true,value$7325.slice(this.length)];}else{return [true,[value$7325]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($7438));});(RegExp.prototype["::check"]=function($7340$7342){var ph$7345;(ph$7345=$7340$7342);;var $7344$7350;($7344$7350=ph$7345);;var value$7358;if((typeof($7344$7350)==="string")){(value$7358=$7344$7350);if(value$7358.match(this)){return true;}else{return false;}}else{var other$7363;(other$7363=$7344$7350);return false;}});(RegExp.prototype[":::project"]=function($7365$7367){var ph$7370;(ph$7370=$7365$7367);;var $7369$7375;($7369$7375=ph$7370);;var value$7383;if((typeof($7369$7375)==="string")){(value$7383=$7369$7375);var $7386$7388;($7386$7388=value$7383.match(this));;var m$7396;if(($7386$7388===null)){(m$7396=$7386$7388);return [false,null];}else{var m$7401;(m$7401=$7386$7388);return [true,m$7401];}}else{var other$7405;(other$7405=$7369$7375);return [false,null];}});(Function.prototype["::send"]=function(args$7408){return this.apply(this,args$7408);});
var $7909=function(arr$7911){var results$7915;var l$7916;(results$7915=[]);;(l$7916=arr$7911.length);;var i$7924;(i$7924=0);;$7914:for(;(i$7924<l$7916);(i$7924++)){results$7915.push([i$7924,$7425(arr$7911,i$7924)]);}return results$7915;};
var $7740=function(){var $7741$7743;($7741$7743=function(tags$7747){var it$0$7750;(it$0$7750=function(){if((!$7410($7741$7743)(this))){return Object.create($7741$7743.prototype);}else{return this;}}());;(it$0$7750["tags"]=tags$7747);return it$0$7750;});;($7741$7743.prototype["create"]=function(){var $7759$7761;($7759$7761=arguments);;var t0$7766;var message$7770;var args$7771;(t0$7766=$7759$7761.length);if((t0$7766>=0)){(message$7770=function(){if((0>=t0$7766)){return "";}else{return $7759$7761[0];}}());(args$7771=Array.prototype.slice.call($7759$7761,1));var it$0$7775;(it$0$7775=this);;var self$7780;(self$7780=this);;var e$7785;(e$7785=Error(message$7770));;(e$7785["::tags"]=it$0$7775.tags);(e$7785["args"]=args$7771);var temp$7793;(temp$7793=$7909(args$7771));;var $length$7798;($length$7798=temp$7793.length);;var $index$7803;($index$7803=0);;$7786:for(;($index$7803<$length$7798);($index$7803++)){var m$7811;(m$7811=temp$7793[$index$7803]);;var t0$7816;var t1$7817;var i$7821;var arg$7822;(t0$7816=m$7811);if(((t0$7816 instanceof Array)&&((t1$7817=t0$7816.length),(t1$7817===2)))){(i$7821=t0$7816[0]);(arg$7822=t0$7816[1]);(e$7785[i$7821]=arg$7822);}else{$7727(m$7811);;}}(e$7785["length"]=args$7771.length);(e$7785["name"]=["E"].concat(it$0$7775.tags).join("."));return e$7785;}else{$7727($7759$7761);}});($7741$7743.prototype["::check"]=function(e$7833){var it$0$7836;(it$0$7836=this);;var self$7841;(self$7841=this);;var tags$7846;if(((!e$7833)||(!$7410(Error)(e$7833)))){return false;}(tags$7846=(e$7833["::tags"]||[]));;var temp$7855;(temp$7855=it$0$7836.tags);;var $length$7860;($length$7860=temp$7855.length);;var $index$7865;($index$7865=0);;$7847:for(;($index$7865<$length$7860);($index$7865++)){var m$7873;(m$7873=temp$7855[$index$7865]);;var tag$7881;(tag$7881=m$7873);if((tags$7846.indexOf(tag$7881)===-1)){return false;}else{false;;}}return true;});($7741$7743.prototype["::deconstruct"]=function(e$7889){var it$0$7892;(it$0$7892=this);;var self$7897;(self$7897=this);;return e$7889.args;});$7426($7741$7743,$7426(function(){var accum$7902;(accum$7902=({}));(accum$7902["::name"]="$7741");return accum$7902;}(),function(){var accum$7906;(accum$7906=({}));(accum$7906["::egclass"]=true);return accum$7906;}()));return $7741$7743;}();
var $7727=function(value$7729,url$7730,start$7731,end$7732){var err$7735;(err$7735=$7740(["match"]).create("Could not find a match for value",({"value":value$7729})));;if(url$7730){(err$7735["location"]=["location",url$7730,start$7731,end$7732]);}throw err$7735;};var hoist$7470;var hoistable$7471;var not_hoistable$7472;var hoist_helper$7473;(hoist$7470=function(expr$7477){var t0$7483;var t1$7484;var b$7480;var inner$7481;(t0$7483=hoist_helper$7473(expr$7477));if(((t0$7483 instanceof Array)&&((t1$7484=t0$7483.length),(t1$7484===2)))){(b$7480=t0$7483[0]);(inner$7481=t0$7483[1]);;}else{$7727(hoist_helper$7473(expr$7477),"/home/olivier/git/earl-grey/src/opt.eg",50,72);}return ["scope",inner$7481,b$7480];});;(hoistable$7471=["send","array","object","multi","if","assign","js_break","js_continue","js_return","js_delete","js_throw","js_try","js_new"]);;(not_hoistable$7472=["void","js_while","js_for","js_for_in","js_label"]);;(hoist_helper$7473=function($7498$7500){var t0$7511;var x$7533;var x$7538;var bridge$7504$7530;var x$7543;var t0$7559;var t1$7560;var newbody$7556;var inner$7557;var t0$7575;var t1$7576;var newbody$7572;var inner$7573;var $index$7615;var $length$7610;var temp$7605;var acc$7600;var accum$7590;var newargs$7591;var $index$7674;var $length$7669;var temp$7664;var acc$7659;var newargs$7653;var other$7723;var type$7646;var args$7647;var type$7583;var args$7584;var vars$7567;var body$7568;var vars$7550;var body$7551;var $7505$7523;var $7506$7524;var $7507$7525;var bridge$7503$7520;var t0$7521;var $7502$7515;var ph$7508;var expr$7509;(t0$7511=$7498$7500);(expr$7509=t0$7511);(ph$7508=t0$7511);;($7502$7515=ph$7508);;(bridge$7503$7520=$7502$7515);if((((bridge$7504$7530=bridge$7503$7520),((((x$7533=bridge$7504$7530)),((x$7533 instanceof Array)&&(x$7533[0]==="symbol")))||(((x$7538=bridge$7504$7530)),((x$7538 instanceof Array)&&(x$7538[0]==="value")))))||(((x$7543=bridge$7503$7520)),((x$7543 instanceof Array)&&(x$7543[0]==="variable"))))){return [expr$7509,[]];}else{if((($7505$7523=($7502$7515 instanceof Array))&&((t0$7521=$7502$7515.length),(($7507$7525=(t0$7521===3))&&($7502$7515[0]==="scope"))))){(vars$7550=$7502$7515[1]);(body$7551=$7502$7515[2]);(t0$7559=hoist_helper$7473(body$7551));if(((t0$7559 instanceof Array)&&((t1$7560=t0$7559.length),(t1$7560===2)))){(newbody$7556=t0$7559[0]);(inner$7557=t0$7559[1]);;}else{$7727(hoist_helper$7473(body$7551),"/home/olivier/git/earl-grey/src/opt.eg",447,472);}return [newbody$7556,inner$7557.concat(vars$7550)];}else{if(($7507$7525&&($7502$7515[0]==="lambda"))){(vars$7567=$7502$7515[1]);(body$7568=$7502$7515[2]);(t0$7575=hoist_helper$7473(body$7568));if(((t0$7575 instanceof Array)&&((t1$7576=t0$7575.length),(t1$7576===2)))){(newbody$7572=t0$7575[0]);(inner$7573=t0$7575[1]);;}else{$7727(hoist_helper$7473(body$7568),"/home/olivier/git/earl-grey/src/opt.eg",581,606);}return [["lambda",vars$7567,["scope",inner$7573,newbody$7572]],[]];}else{if(($7505$7523&&(($7507$7525=(t0$7521>=1))&&((type$7583=$7502$7515[0]),((args$7584=Array.prototype.slice.call($7502$7515,1)),(hoistable$7471.indexOf(type$7583)!==-1)))))){(accum$7590=[]);;(newargs$7591=(((acc$7600=[])),(((temp$7605=args$7584)),((($length$7610=temp$7605.length)),((($index$7615=0)),function(){$7597:for(;($index$7615<$length$7610);($index$7615++)){var t0$7637;var t1$7638;var b$7634;var inner$7635;var arg$7631;var m$7623;(m$7623=temp$7605[$index$7615]);;(arg$7631=m$7623);acc$7600.push((((t0$7637=hoist_helper$7473(arg$7631)),function(){if(((t0$7637 instanceof Array)&&((t1$7638=t0$7637.length),(t1$7638===2)))){(b$7634=t0$7637[0]);(inner$7635=t0$7637[1]);}else{return $7727(hoist_helper$7473(arg$7631),"/home/olivier/git/earl-grey/src/opt.eg",779,806);}}()),(accum$7590=accum$7590.concat(inner$7635)),b$7634));}}()))),acc$7600));;return [[type$7583].concat(newargs$7591),accum$7590];}else{if(($7507$7525&&((type$7646=$7502$7515[0]),((args$7647=Array.prototype.slice.call($7502$7515,1)),(not_hoistable$7472.indexOf(type$7646)!==-1))))){(newargs$7653=(((acc$7659=[])),(((temp$7664=args$7647)),((($length$7669=temp$7664.length)),((($index$7674=0)),function(){$7656:for(;($index$7674<$length$7669);($index$7674++)){var t0$7697;var t1$7698;var other$7718;var t0$7709;var $7693$7704;var b$7694;var inner$7695;var arg$7690;var m$7682;(m$7682=temp$7664[$index$7674]);;(arg$7690=m$7682);acc$7659.push((((t0$7697=hoist_helper$7473(arg$7690)),function(){if(((t0$7697 instanceof Array)&&((t1$7698=t0$7697.length),(t1$7698===2)))){(b$7694=t0$7697[0]);(inner$7695=t0$7697[1]);}else{return $7727(hoist_helper$7473(arg$7690),"/home/olivier/git/earl-grey/src/opt.eg",981,1008);}}()),((($7693$7704=inner$7695)),function(){if((($7693$7704 instanceof Array)&&((t0$7709=$7693$7704.length),(t0$7709===0)))){return b$7694;}else{(other$7718=$7693$7704);return ["scope",inner$7695,b$7694];}}())));}}()))),acc$7659));;return [[type$7646].concat(newargs$7653),[]];}else{(other$7723=$7502$7515);throw $7740(["syntax","illegal"]).create("Illegal node -- this should not happen.",({"node":other$7723}));}}}}}});;(exports["hoist"]=hoist$7470);
