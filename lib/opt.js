var $12052=(function(type$12055){var f$12059;(f$12059=type$12055["::check"]);if((f$12059===(void 0))){return (function(value$12065){return (value$12065 instanceof type$12055);});}else{return (function(value$12069){return f$12059.call(type$12055,value$12069);});}});
var $12071=(function(dest$12074,values$12075){var k$12080;(k$12080=null);$12078:for(k$12080 in values$12075){if(values$12075.hasOwnProperty(k$12080)){(dest$12074[k$12080]=values$12075[k$12080]);}}return dest$12074;});
var $12088=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $12089=(function($12091$12094){var ph$12100;(ph$12100=$12091$12094);var $12096$12106;($12096$12106=ph$12100);var bridge$12098$12111;var x$12115;(bridge$12098$12111=$12096$12106);if((((typeof(bridge$12098$12111)==="string")&&((x$12115=bridge$12098$12111),true))||((typeof(bridge$12098$12111)==="number")&&((x$12115=bridge$12098$12111),true)))){return ["value",x$12115];}else{var other$12126;(other$12126=$12096$12106);return other$12126["::serialize_ast"]();}});
var $12128=(function(obj$12131){var results$12136;(results$12136=[]);var k$12141;(k$12141=null);$12135:for(k$12141 in obj$12131){if(Object.prototype.hasOwnProperty.call(obj$12131,k$12141)){results$12136.push([k$12141,$12088(obj$12131,k$12141)]);}}return results$12136;});
var $12397=(function(arr$12400){var results$12406;var l$12407;(results$12406=[]);(l$12407=arr$12400.length);var i$12416;(i$12416=0);$12405:for(;(i$12416<l$12407);(i$12416++)){results$12406.push([i$12416,$12088(arr$12400,i$12416)]);}return results$12406;});
var $12164=(function(){var $12165$12171;($12165$12171=(function(tags$12176){var it$0$12179;(it$0$12179=(function(){if((!$12052($12165$12171)(this))){return Object.create($12165$12171.prototype);}else{return this;}})());(it$0$12179["tags"]=tags$12176);return it$0$12179;}));($12165$12171.prototype["create"]=(function(){var it$0$12199;var self$12200;(it$0$12199=this);(self$12200=this);var $12197$12209;($12197$12209=arguments);var t0$12214;var message$12218;var args$12219;(t0$12214=$12197$12209.length);if((t0$12214>=0)){(message$12218=(function(){if((0>=t0$12214)){return "";}else{return $12197$12209[0];}})());(args$12219=Array.prototype.slice.call($12197$12209,1));var e$12232;(e$12232=Error(message$12218));(e$12232["::tags"]=it$0$12199.tags);(e$12232["args"]=args$12219);var temp$12248;(temp$12248=$12397(args$12219));var $length$12254;($length$12254=temp$12248.length);var $index$12260;($index$12260=0);$12233:for(;($index$12260<$length$12254);($index$12260++)){var m$12269;(m$12269=temp$12248[$index$12260]);var t0$12274;var t1$12275;var i$12279;var arg$12280;(t0$12274=m$12269);if(((t0$12274 instanceof Array)&&(((t1$12275=t0$12274.length)),(t1$12275===2)))){(i$12279=t0$12274[0]);(arg$12280=t0$12274[1]);(e$12232[i$12279]=arg$12280);}else{$12145(m$12269);}}(e$12232["length"]=args$12219.length);(e$12232["name"]=["E"].concat(it$0$12199.tags).join("."));return e$12232;}else{$12145($12197$12209);}}));($12165$12171.prototype["::check"]=(function(e$12310){var it$0$12314;var self$12315;(it$0$12314=this);(self$12315=this);var tags$12325;if(((!e$12310)||(!$12052(Error)(e$12310)))){return false;}(tags$12325=(e$12310["::tags"]||[]));var temp$12336;(temp$12336=it$0$12314.tags);var $length$12342;($length$12342=temp$12336.length);var $index$12348;($index$12348=0);$12326:for(;($index$12348<$length$12342);($index$12348++)){var m$12357;(m$12357=temp$12336[$index$12348]);var tag$12365;(tag$12365=m$12357);if((tags$12325.indexOf(tag$12365)===-1)){return false;}else{false;}}return true;}));($12165$12171.prototype["::deconstruct"]=(function(e$12374){var it$0$12378;var self$12379;(it$0$12378=this);(self$12379=this);return e$12374.args;}));$12071($12165$12171,$12071((function(){var accum$12390;(accum$12390=({}));(accum$12390["::name"]="$12165");return accum$12390;})(),(function(){var accum$12394;(accum$12394=({}));(accum$12394["::egclass"]=true);return accum$12394;})()));return $12165$12171;})();
var $12145=(function(value$12148,url$12149,start$12150,end$12151){var err$12155;(err$12155=$12164(["match"]).create("Could not find a match for value",({"value":value$12148})));if(url$12149){(err$12155["location"]=["location",url$12149,start$12150,end$12151]);}throw err$12155;});
var send$11697;var __array_methods$11698;var __re_methods$11699;(send$11697=(function(obj$11712,$11709$11713){var ph$11719;var msg$11720;var t0$11722;(t0$11722=$11709$11713);(msg$11720=t0$11722);(ph$11719=t0$11722);var $11715$11731;($11715$11731=ph$11719);var bridge$11717$11736;(bridge$11717$11736=$11715$11731);if(((typeof(bridge$11717$11736)==="string")||(typeof(bridge$11717$11736)==="number"))){return obj$11712[msg$11720];}else{var other$11748;(other$11748=$11715$11731);return obj$11712["::send"](msg$11720);}}));(Array[":::project"]=(function($11754$11757){var ph$11762;var value$11763;var t0$11765;(t0$11765=$11754$11757);(value$11763=t0$11765);(ph$11762=t0$11765);var $11759$11774;($11759$11774=ph$11762);if($12052(Array)($11759$11774)){return [true,value$11763];}else{$11759$11774;return [true,[value$11763]];}}));(__array_methods$11698=$12071((function(){var accum$11795;(accum$11795=({}));(accum$11795["::check"]=(function(value$11800){if((value$11800 instanceof Array)){var i$11806;(i$11806=0);$11803:for(;(i$11806<this.length);(i$11806++)){if(($12088(this,i$11806)!==$12088(value$11800,i$11806))){return false;}}return true;}else{return false;}}));return accum$11795;})(),$12071((function(){var accum$11815;(accum$11815=({}));(accum$11815["::clone"]=(function(){return $12071(this.slice(0),this);}));return accum$11815;})(),$12071((function(){var accum$11822;(accum$11822=({}));(accum$11822[":::project"]=(function(value$11827){if((value$11827 instanceof Array)){var i$11833;(i$11833=0);$11830:for(;(i$11833<this.length);(i$11833++)){if(($12088(this,i$11833)!==$12088(value$11827,i$11833))){return [true,this.concat([value$11827])];}}return [true,value$11827];}else{return [true,this.concat([value$11827])];}}));return accum$11822;})(),(function(){var accum$11842;(accum$11842=({}));(accum$11842["::serialize_ast"]=(function(){return ["array"].concat(this.map($12089));}));return accum$11842;})()))));var temp$11852;(temp$11852=$12128(__array_methods$11698));var $length$11858;($length$11858=temp$11852.length);var $index$11864;($index$11864=0);$11700:for(;($index$11864<$length$11858);($index$11864++)){var m$11873;(m$11873=temp$11852[$index$11864]);var t0$11878;var t1$11879;var k$11883;var v$11884;(t0$11878=m$11873);if(((t0$11878 instanceof Array)&&(((t1$11879=t0$11878.length)),(t1$11879===2)))){(k$11883=t0$11878[0]);(v$11884=t0$11878[1]);if((!$12088(Array.prototype,k$11883))){Object.defineProperty(Array.prototype,k$11883,({"enumerable":false,"value":v$11884}));}}else{$12145(m$11873);}}(__re_methods$11699=$12071((function(){var accum$11904;(accum$11904=({}));(accum$11904["::check"]=(function($11908$11911){var ph$11916;(ph$11916=$11908$11911);var $11913$11922;($11913$11922=ph$11916);var value$11930;if((typeof($11913$11922)==="string")){(value$11930=$11913$11922);if(value$11930.match(this)){return true;}else{return false;}}else{var other$11935;(other$11935=$11913$11922);return false;}}));return accum$11904;})(),(function(){var accum$11938;(accum$11938=({}));(accum$11938[":::project"]=(function($11942$11945){var ph$11950;(ph$11950=$11942$11945);var $11947$11956;($11947$11956=ph$11950);var value$11964;if((typeof($11947$11956)==="string")){(value$11964=$11947$11956);var $11967$11972;($11967$11972=value$11964.match(this));var m$11980;if(($11967$11972===null)){(m$11980=$11967$11972);return [false,null];}else{var m$11985;(m$11985=$11967$11972);return [true,m$11985];}}else{var other$11989;(other$11989=$11947$11956);return [false,null];}}));return accum$11938;})()));var temp$11995;(temp$11995=$12128(__re_methods$11699));var $length$12001;($length$12001=temp$11995.length);var $index$12007;($index$12007=0);$11703:for(;($index$12007<$length$12001);($index$12007++)){var m$12016;(m$12016=temp$11995[$index$12007]);var t0$12021;var t1$12022;var k$12026;var v$12027;(t0$12021=m$12016);if(((t0$12021 instanceof Array)&&(((t1$12022=t0$12021.length)),(t1$12022===2)))){(k$12026=t0$12021[0]);(v$12027=t0$12021[1]);if((!$12088(RegExp.prototype,k$12026))){Object.defineProperty(RegExp.prototype,k$12026,({"enumerable":false,"value":v$12027}));}}else{$12145(m$12016);}}if((!Function.prototype["::send"])){Object.defineProperty(Function.prototype,"::send",$12071(({"enumerable":false}),(function(){var accum$12045;(accum$12045=({}));(accum$12045["value"]=(function(args$12050){return this.apply(this,args$12050);}));return accum$12045;})()));}var hoist$12429;var hoistable$12430;var not_hoistable$12431;var hoist_helper$12432;(hoist$12429=(function(expr$12437){var t0$12444;var t1$12445;var b$12441;var inner$12442;(t0$12444=hoist_helper$12432(expr$12437));if(((t0$12444 instanceof Array)&&(((t1$12445=t0$12444.length)),(t1$12445===2)))){(b$12441=t0$12444[0]);(inner$12442=t0$12444[1]);}else{$12145(hoist_helper$12432(expr$12437),"/home/olivier/git/earl-grey/src/opt.eg",50,68);}return ["scope",inner$12442,b$12441];}));(hoistable$12430=["send","array","object","multi","if","assign","js_break","js_continue","js_return","js_delete","js_throw","js_try","js_new"]);(not_hoistable$12431=["void","js_while","js_for","js_for_in","js_label"]);(hoist_helper$12432=(function($12468$12471){var t0$12488;var x$12524;var x$12530;var bridge$12476$12516;var x$12536;var t0$12557;var t1$12558;var newbody$12554;var inner$12555;var t0$12582;var t1$12583;var newbody$12579;var inner$12580;var $index$12637;var $length$12631;var temp$12625;var acc$12619;var accum$12607;var newargs$12608;var $index$12713;var $length$12707;var temp$12701;var acc$12695;var newargs$12687;var other$12780;var type$12679;var args$12680;var type$12598;var args$12599;var vars$12573;var body$12574;var vars$12543;var body$12544;var $12482$12505;var $12483$12506;var $12484$12507;var bridge$12475$12502;var t0$12503;var $12473$12497;var ph$12485;var expr$12486;(t0$12488=$12468$12471);(expr$12486=t0$12488);(ph$12485=t0$12488);($12473$12497=ph$12485);(bridge$12475$12502=$12473$12497);if(((((bridge$12476$12516=bridge$12475$12502)),((((x$12524=bridge$12476$12516)),((x$12524 instanceof Array)&&(x$12524[0]==="symbol")))||(((x$12530=bridge$12476$12516)),((x$12530 instanceof Array)&&(x$12530[0]==="value")))))||(((x$12536=bridge$12475$12502)),((x$12536 instanceof Array)&&(x$12536[0]==="variable"))))){return [expr$12486,[]];}else{if((($12482$12505=($12473$12497 instanceof Array))&&(((t0$12503=$12473$12497.length)),(($12484$12507=(t0$12503===3))&&($12473$12497[0]==="scope"))))){(vars$12543=$12473$12497[1]);(body$12544=$12473$12497[2]);(t0$12557=hoist_helper$12432(body$12544));if(((t0$12557 instanceof Array)&&(((t1$12558=t0$12557.length)),(t1$12558===2)))){(newbody$12554=t0$12557[0]);(inner$12555=t0$12557[1]);}else{$12145(hoist_helper$12432(body$12544),"/home/olivier/git/earl-grey/src/opt.eg",1463,1481);}return [newbody$12554,inner$12555.concat(vars$12543)];}else{if(($12484$12507&&($12473$12497[0]==="lambda"))){(vars$12573=$12473$12497[1]);(body$12574=$12473$12497[2]);(t0$12582=hoist_helper$12432(body$12574));if(((t0$12582 instanceof Array)&&(((t1$12583=t0$12582.length)),(t1$12583===2)))){(newbody$12579=t0$12582[0]);(inner$12580=t0$12582[1]);}else{$12145(hoist_helper$12432(body$12574),"/home/olivier/git/earl-grey/src/opt.eg",1666,1684);}return [["lambda",vars$12573,["scope",inner$12580,newbody$12579]],[]];}else{if(($12482$12505&&(($12484$12507=(t0$12503>=1))&&((type$12598=$12473$12497[0]),((args$12599=Array.prototype.slice.call($12473$12497,1)),(hoistable$12430.indexOf(type$12598)!==-1)))))){(accum$12607=[]);(newargs$12608=(((acc$12619=[])),(((temp$12625=args$12599)),((($length$12631=temp$12625.length)),((($index$12637=0)),(function(){$12614:for(;($index$12637<$length$12631);($index$12637++)){var t0$12662;var t1$12663;var b$12659;var inner$12660;var arg$12654;var m$12646;(m$12646=temp$12625[$index$12637]);(arg$12654=m$12646);acc$12619.push(((((t0$12662=hoist_helper$12432(arg$12654))),(function(){if(((t0$12662 instanceof Array)&&(((t1$12663=t0$12662.length)),(t1$12663===2)))){(b$12659=t0$12662[0]);(inner$12660=t0$12662[1]);}else{return $12145(hoist_helper$12432(arg$12654),"/home/olivier/git/earl-grey/src/opt.eg",2027,2044);}})()),(accum$12607=accum$12607.concat(inner$12660)),b$12659));}})()))),acc$12619));return [[type$12598].concat(newargs$12608),accum$12607];}else{if(($12484$12507&&((type$12679=$12473$12497[0]),((args$12680=Array.prototype.slice.call($12473$12497,1)),(not_hoistable$12431.indexOf(type$12679)!==-1))))){(newargs$12687=(((acc$12695=[])),(((temp$12701=args$12680)),((($length$12707=temp$12701.length)),((($index$12713=0)),(function(){$12690:for(;($index$12713<$length$12707);($index$12713++)){var t0$12741;var t1$12742;var other$12775;var t0$12762;var $12735$12757;var b$12738;var inner$12739;var arg$12730;var m$12722;(m$12722=temp$12701[$index$12713]);(arg$12730=m$12722);acc$12695.push(((((t0$12741=hoist_helper$12432(arg$12730))),(function(){if(((t0$12741 instanceof Array)&&(((t1$12742=t0$12741.length)),(t1$12742===2)))){(b$12738=t0$12741[0]);(inner$12739=t0$12741[1]);}else{return $12145(hoist_helper$12432(arg$12730),"/home/olivier/git/earl-grey/src/opt.eg",2370,2387);}})()),((($12735$12757=inner$12739)),(function(){if((($12735$12757 instanceof Array)&&(((t0$12762=$12735$12757.length)),(t0$12762===0)))){return b$12738;}else{(other$12775=$12735$12757);return ["scope",inner$12739,b$12738];}})())));}})()))),acc$12695));return [[type$12679].concat(newargs$12687),[]];}else{(other$12780=$12473$12497);throw $12164(["syntax","illegal"]).create("Illegal node -- this should not happen.",({"node":other$12780}));}}}}}}));(exports["hoist"]=hoist$12429);
