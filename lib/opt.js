var $11174=(function(type$11177){var f$11181;(f$11181=type$11177["::check"]);if((f$11181===(void 0))){return (function(value$11187){return (value$11187 instanceof type$11177);});}else{return (function(value$11191){return f$11181.call(type$11177,value$11191);});}});
var $11193=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $11194=(function(dest$11197,values$11198){var k$11203;(k$11203=null);$11201:for(k$11203 in values$11198){if(values$11198.hasOwnProperty(k$11203)){(dest$11197[k$11203]=values$11198[k$11203]);}}return dest$11197;});
var $11211=(function($11213$11216){var ph$11222;(ph$11222=$11213$11216);var $11218$11228;($11218$11228=ph$11222);var bridge$11220$11233;var x$11237;(bridge$11220$11233=$11218$11228);if((((typeof(bridge$11220$11233)==="string")&&((x$11237=bridge$11220$11233),true))||((typeof(bridge$11220$11233)==="number")&&((x$11237=bridge$11220$11233),true)))){return ["value",x$11237];}else{var other$11248;(other$11248=$11218$11228);return other$11248["::serialize_ast"]();}});
var send$10948;(send$10948=(function(obj$10955,$10952$10956){var ph$10962;var msg$10963;var t0$10965;(t0$10965=$10952$10956);(msg$10963=t0$10965);(ph$10962=t0$10965);var $10958$10974;($10958$10974=ph$10962);var bridge$10960$10979;(bridge$10960$10979=$10958$10974);if(((typeof(bridge$10960$10979)==="string")||(typeof(bridge$10960$10979)==="number"))){return obj$10955[msg$10963];}else{var other$10991;(other$10991=$10958$10974);return obj$10955["::send"](msg$10963);}}));(Array[":::project"]=(function($10997$11000){var ph$11005;var value$11006;var t0$11008;(t0$11008=$10997$11000);(value$11006=t0$11008);(ph$11005=t0$11008);var $11002$11017;($11002$11017=ph$11005);if($11174(Array)($11002$11017)){return [true,value$11006];}else{$11002$11017;return [true,[value$11006]];}}));(Array.prototype["::check"]=(function(value$11035){if((value$11035 instanceof Array)){var i$11041;(i$11041=0);$11038:for(;(i$11041<this.length);(i$11041++)){if(($11193(this,i$11041)!==$11193(value$11035,i$11041))){return false;}}return true;}else{return false;}}));(Array.prototype["::clone"]=(function(){return $11194(this.slice(0),this);}));(Array.prototype[":::project"]=(function(value$11060){if((value$11060 instanceof Array)){var i$11066;(i$11066=0);$11063:for(;(i$11066<this.length);(i$11066++)){if(($11193(this,i$11066)!==$11193(value$11060,i$11066))){return [true,[value$11060]];}}return [true,value$11060.slice(this.length)];}else{return [true,[value$11060]];}}));(Array.prototype["::serialize_ast"]=(function(){return ["array"].concat(this.map($11211));}));(RegExp.prototype["::check"]=(function($11084$11087){var ph$11092;(ph$11092=$11084$11087);var $11089$11098;($11089$11098=ph$11092);var value$11106;if((typeof($11089$11098)==="string")){(value$11106=$11089$11098);if(value$11106.match(this)){return true;}else{return false;}}else{var other$11111;(other$11111=$11089$11098);return false;}}));(RegExp.prototype[":::project"]=(function($11117$11120){var ph$11125;(ph$11125=$11117$11120);var $11122$11131;($11122$11131=ph$11125);var value$11139;if((typeof($11122$11131)==="string")){(value$11139=$11122$11131);var $11142$11147;($11142$11147=value$11139.match(this));var m$11155;if(($11142$11147===null)){(m$11155=$11142$11147);return [false,null];}else{var m$11160;(m$11160=$11142$11147);return [true,m$11160];}}else{var other$11164;(other$11164=$11122$11131);return [false,null];}}));(Function.prototype["::send"]=(function(args$11171){return this.apply(this,args$11171);}));
var $11867=(function(arr$11870){var results$11876;var l$11877;(results$11876=[]);(l$11877=arr$11870.length);var i$11886;(i$11886=0);$11875:for(;(i$11886<l$11877);(i$11886++)){results$11876.push([i$11886,$11193(arr$11870,i$11886)]);}return results$11876;});
var $11634=(function(){var $11635$11641;($11635$11641=(function(tags$11646){var it$0$11649;(it$0$11649=(function(){if((!$11174($11635$11641)(this))){return Object.create($11635$11641.prototype);}else{return this;}})());(it$0$11649["tags"]=tags$11646);return it$0$11649;}));($11635$11641.prototype["create"]=(function(){var it$0$11669;var self$11670;(it$0$11669=this);(self$11670=this);var $11667$11679;($11667$11679=arguments);var t0$11684;var message$11688;var args$11689;(t0$11684=$11667$11679.length);if((t0$11684>=0)){(message$11688=(function(){if((0>=t0$11684)){return "";}else{return $11667$11679[0];}})());(args$11689=Array.prototype.slice.call($11667$11679,1));var e$11702;(e$11702=Error(message$11688));(e$11702["::tags"]=it$0$11669.tags);(e$11702["args"]=args$11689);var temp$11718;(temp$11718=$11867(args$11689));var $length$11724;($length$11724=temp$11718.length);var $index$11730;($index$11730=0);$11703:for(;($index$11730<$length$11724);($index$11730++)){var m$11739;(m$11739=temp$11718[$index$11730]);var t0$11744;var t1$11745;var i$11749;var arg$11750;(t0$11744=m$11739);if(((t0$11744 instanceof Array)&&(((t1$11745=t0$11744.length)),(t1$11745===2)))){(i$11749=t0$11744[0]);(arg$11750=t0$11744[1]);(e$11702[i$11749]=arg$11750);}else{$11615(m$11739);}}(e$11702["length"]=args$11689.length);(e$11702["name"]=["E"].concat(it$0$11669.tags).join("."));return e$11702;}else{$11615($11667$11679);}}));($11635$11641.prototype["::check"]=(function(e$11780){var it$0$11784;var self$11785;(it$0$11784=this);(self$11785=this);var tags$11795;if(((!e$11780)||(!$11174(Error)(e$11780)))){return false;}(tags$11795=(e$11780["::tags"]||[]));var temp$11806;(temp$11806=it$0$11784.tags);var $length$11812;($length$11812=temp$11806.length);var $index$11818;($index$11818=0);$11796:for(;($index$11818<$length$11812);($index$11818++)){var m$11827;(m$11827=temp$11806[$index$11818]);var tag$11835;(tag$11835=m$11827);if((tags$11795.indexOf(tag$11835)===-1)){return false;}else{false;}}return true;}));($11635$11641.prototype["::deconstruct"]=(function(e$11844){var it$0$11848;var self$11849;(it$0$11848=this);(self$11849=this);return e$11844.args;}));$11194($11635$11641,$11194((function(){var accum$11860;(accum$11860=({}));(accum$11860["::name"]="$11635");return accum$11860;})(),(function(){var accum$11864;(accum$11864=({}));(accum$11864["::egclass"]=true);return accum$11864;})()));return $11635$11641;})();
var $11615=(function(value$11618,url$11619,start$11620,end$11621){var err$11625;(err$11625=$11634(["match"]).create("Could not find a match for value",({"value":value$11618})));if(url$11619){(err$11625["location"]=["location",url$11619,start$11620,end$11621]);}throw err$11625;});var hoist$11256;var hoistable$11257;var not_hoistable$11258;var hoist_helper$11259;(hoist$11256=(function(expr$11264){var t0$11271;var t1$11272;var b$11268;var inner$11269;(t0$11271=hoist_helper$11259(expr$11264));if(((t0$11271 instanceof Array)&&(((t1$11272=t0$11271.length)),(t1$11272===2)))){(b$11268=t0$11271[0]);(inner$11269=t0$11271[1]);}else{$11615(hoist_helper$11259(expr$11264),"/home/olivier/git/earl-grey/src/opt.eg",50,72);}return ["scope",inner$11269,b$11268];}));(hoistable$11257=["send","array","object","multi","if","assign","js_break","js_continue","js_return","js_delete","js_throw","js_try","js_new"]);(not_hoistable$11258=["void","js_while","js_for","js_for_in","js_label"]);(hoist_helper$11259=(function($11295$11298){var t0$11315;var x$11351;var x$11357;var bridge$11303$11343;var x$11363;var t0$11384;var t1$11385;var newbody$11381;var inner$11382;var t0$11409;var t1$11410;var newbody$11406;var inner$11407;var $index$11464;var $length$11458;var temp$11452;var acc$11446;var accum$11434;var newargs$11435;var $index$11540;var $length$11534;var temp$11528;var acc$11522;var newargs$11514;var other$11607;var type$11506;var args$11507;var type$11425;var args$11426;var vars$11400;var body$11401;var vars$11370;var body$11371;var $11309$11332;var $11310$11333;var $11311$11334;var bridge$11302$11329;var t0$11330;var $11300$11324;var ph$11312;var expr$11313;(t0$11315=$11295$11298);(expr$11313=t0$11315);(ph$11312=t0$11315);($11300$11324=ph$11312);(bridge$11302$11329=$11300$11324);if(((((bridge$11303$11343=bridge$11302$11329)),((((x$11351=bridge$11303$11343)),((x$11351 instanceof Array)&&(x$11351[0]==="symbol")))||(((x$11357=bridge$11303$11343)),((x$11357 instanceof Array)&&(x$11357[0]==="value")))))||(((x$11363=bridge$11302$11329)),((x$11363 instanceof Array)&&(x$11363[0]==="variable"))))){return [expr$11313,[]];}else{if((($11309$11332=($11300$11324 instanceof Array))&&(((t0$11330=$11300$11324.length)),(($11311$11334=(t0$11330===3))&&($11300$11324[0]==="scope"))))){(vars$11370=$11300$11324[1]);(body$11371=$11300$11324[2]);(t0$11384=hoist_helper$11259(body$11371));if(((t0$11384 instanceof Array)&&(((t1$11385=t0$11384.length)),(t1$11385===2)))){(newbody$11381=t0$11384[0]);(inner$11382=t0$11384[1]);}else{$11615(hoist_helper$11259(body$11371),"/home/olivier/git/earl-grey/src/opt.eg",1463,1488);}return [newbody$11381,inner$11382.concat(vars$11370)];}else{if(($11311$11334&&($11300$11324[0]==="lambda"))){(vars$11400=$11300$11324[1]);(body$11401=$11300$11324[2]);(t0$11409=hoist_helper$11259(body$11401));if(((t0$11409 instanceof Array)&&(((t1$11410=t0$11409.length)),(t1$11410===2)))){(newbody$11406=t0$11409[0]);(inner$11407=t0$11409[1]);}else{$11615(hoist_helper$11259(body$11401),"/home/olivier/git/earl-grey/src/opt.eg",1666,1691);}return [["lambda",vars$11400,["scope",inner$11407,newbody$11406]],[]];}else{if(($11309$11332&&(($11311$11334=(t0$11330>=1))&&((type$11425=$11300$11324[0]),((args$11426=Array.prototype.slice.call($11300$11324,1)),(hoistable$11257.indexOf(type$11425)!==-1)))))){(accum$11434=[]);(newargs$11435=(((acc$11446=[])),(((temp$11452=args$11426)),((($length$11458=temp$11452.length)),((($index$11464=0)),(function(){$11441:for(;($index$11464<$length$11458);($index$11464++)){var t0$11489;var t1$11490;var b$11486;var inner$11487;var arg$11481;var m$11473;(m$11473=temp$11452[$index$11464]);(arg$11481=m$11473);acc$11446.push(((((t0$11489=hoist_helper$11259(arg$11481))),(function(){if(((t0$11489 instanceof Array)&&(((t1$11490=t0$11489.length)),(t1$11490===2)))){(b$11486=t0$11489[0]);(inner$11487=t0$11489[1]);}else{return $11615(hoist_helper$11259(arg$11481),"/home/olivier/git/earl-grey/src/opt.eg",2027,2054);}})()),(accum$11434=accum$11434.concat(inner$11487)),b$11486));}})()))),acc$11446));return [[type$11425].concat(newargs$11435),accum$11434];}else{if(($11311$11334&&((type$11506=$11300$11324[0]),((args$11507=Array.prototype.slice.call($11300$11324,1)),(not_hoistable$11258.indexOf(type$11506)!==-1))))){(newargs$11514=(((acc$11522=[])),(((temp$11528=args$11507)),((($length$11534=temp$11528.length)),((($index$11540=0)),(function(){$11517:for(;($index$11540<$length$11534);($index$11540++)){var t0$11568;var t1$11569;var other$11602;var t0$11589;var $11562$11584;var b$11565;var inner$11566;var arg$11557;var m$11549;(m$11549=temp$11528[$index$11540]);(arg$11557=m$11549);acc$11522.push(((((t0$11568=hoist_helper$11259(arg$11557))),(function(){if(((t0$11568 instanceof Array)&&(((t1$11569=t0$11568.length)),(t1$11569===2)))){(b$11565=t0$11568[0]);(inner$11566=t0$11568[1]);}else{return $11615(hoist_helper$11259(arg$11557),"/home/olivier/git/earl-grey/src/opt.eg",2370,2397);}})()),((($11562$11584=inner$11566)),(function(){if((($11562$11584 instanceof Array)&&(((t0$11589=$11562$11584.length)),(t0$11589===0)))){return b$11565;}else{(other$11602=$11562$11584);return ["scope",inner$11566,b$11565];}})())));}})()))),acc$11522));return [[type$11506].concat(newargs$11514),[]];}else{(other$11607=$11300$11324);throw $11634(["syntax","illegal"]).create("Illegal node -- this should not happen.",({"node":other$11607}));}}}}}}));(exports["hoist"]=hoist$11256);
