var $12002=(function(type$12005){var f$12009;(f$12009=type$12005["::check"]);if((f$12009===(void 0))){return (function(value$12015){return (value$12015 instanceof type$12005);});}else{return (function(value$12019){return f$12009.call(type$12005,value$12019);});}});
var $12021=(function(dest$12024,values$12025){var k$12030;(k$12030=null);$12028:for(k$12030 in values$12025){if(values$12025.hasOwnProperty(k$12030)){(dest$12024[k$12030]=values$12025[k$12030]);}}return dest$12024;});
var $12038=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $12039=(function($12041$12044){var ph$12050;(ph$12050=$12041$12044);var $12046$12056;($12046$12056=ph$12050);var bridge$12048$12061;var x$12065;(bridge$12048$12061=$12046$12056);if((((typeof(bridge$12048$12061)==="string")&&((x$12065=bridge$12048$12061),true))||((typeof(bridge$12048$12061)==="number")&&((x$12065=bridge$12048$12061),true)))){return ["value",x$12065];}else{var other$12076;(other$12076=$12046$12056);return other$12076["::serialize_ast"]();}});
var $12078=(function(obj$12081){var results$12086;(results$12086=[]);var k$12091;(k$12091=null);$12085:for(k$12091 in obj$12081){if(Object.prototype.hasOwnProperty.call(obj$12081,k$12091)){results$12086.push([k$12091,$12038(obj$12081,k$12091)]);}}return results$12086;});
var $12347=(function(arr$12350){var results$12356;var l$12357;(results$12356=[]);(l$12357=arr$12350.length);var i$12366;(i$12366=0);$12355:for(;(i$12366<l$12357);(i$12366++)){results$12356.push([i$12366,$12038(arr$12350,i$12366)]);}return results$12356;});
var $12114=(function(){var $12115$12121;($12115$12121=(function(tags$12126){var it$0$12129;(it$0$12129=(function(){if((!$12002($12115$12121)(this))){return Object.create($12115$12121.prototype);}else{return this;}})());(it$0$12129["tags"]=tags$12126);return it$0$12129;}));($12115$12121.prototype["create"]=(function(){var it$0$12149;var self$12150;(it$0$12149=this);(self$12150=this);var $12147$12159;($12147$12159=arguments);var t0$12164;var message$12168;var args$12169;(t0$12164=$12147$12159.length);if((t0$12164>=0)){(message$12168=(function(){if((0>=t0$12164)){return "";}else{return $12147$12159[0];}})());(args$12169=Array.prototype.slice.call($12147$12159,1));var e$12182;(e$12182=Error(message$12168));(e$12182["::tags"]=it$0$12149.tags);(e$12182["args"]=args$12169);var temp$12198;(temp$12198=$12347(args$12169));var $length$12204;($length$12204=temp$12198.length);var $index$12210;($index$12210=0);$12183:for(;($index$12210<$length$12204);($index$12210++)){var m$12219;(m$12219=temp$12198[$index$12210]);var t0$12224;var t1$12225;var i$12229;var arg$12230;(t0$12224=m$12219);if(((t0$12224 instanceof Array)&&(((t1$12225=t0$12224.length)),(t1$12225===2)))){(i$12229=t0$12224[0]);(arg$12230=t0$12224[1]);(e$12182[i$12229]=arg$12230);}else{$12095(m$12219);}}(e$12182["length"]=args$12169.length);(e$12182["name"]=["E"].concat(it$0$12149.tags).join("."));return e$12182;}else{$12095($12147$12159);}}));($12115$12121.prototype["::check"]=(function(e$12260){var it$0$12264;var self$12265;(it$0$12264=this);(self$12265=this);var tags$12275;if(((!e$12260)||(!$12002(Error)(e$12260)))){return false;}(tags$12275=(e$12260["::tags"]||[]));var temp$12286;(temp$12286=it$0$12264.tags);var $length$12292;($length$12292=temp$12286.length);var $index$12298;($index$12298=0);$12276:for(;($index$12298<$length$12292);($index$12298++)){var m$12307;(m$12307=temp$12286[$index$12298]);var tag$12315;(tag$12315=m$12307);if((tags$12275.indexOf(tag$12315)===-1)){return false;}else{false;}}return true;}));($12115$12121.prototype["::deconstruct"]=(function(e$12324){var it$0$12328;var self$12329;(it$0$12328=this);(self$12329=this);return e$12324.args;}));$12021($12115$12121,$12021((function(){var accum$12340;(accum$12340=({}));(accum$12340["::name"]="$12115");return accum$12340;})(),(function(){var accum$12344;(accum$12344=({}));(accum$12344["::egclass"]=true);return accum$12344;})()));return $12115$12121;})();
var $12095=(function(value$12098,url$12099,start$12100,end$12101){var err$12105;(err$12105=$12114(["match"]).create("Could not find a match for value",({"value":value$12098})));if(url$12099){(err$12105["location"]=["location",url$12099,start$12100,end$12101]);}throw err$12105;});
var send$11647;var __array_methods$11648;var __re_methods$11649;(send$11647=(function(obj$11662,$11659$11663){var ph$11669;var msg$11670;var t0$11672;(t0$11672=$11659$11663);(msg$11670=t0$11672);(ph$11669=t0$11672);var $11665$11681;($11665$11681=ph$11669);var bridge$11667$11686;(bridge$11667$11686=$11665$11681);if(((typeof(bridge$11667$11686)==="string")||(typeof(bridge$11667$11686)==="number"))){return obj$11662[msg$11670];}else{var other$11698;(other$11698=$11665$11681);return obj$11662["::send"](msg$11670);}}));(Array[":::project"]=(function($11704$11707){var ph$11712;var value$11713;var t0$11715;(t0$11715=$11704$11707);(value$11713=t0$11715);(ph$11712=t0$11715);var $11709$11724;($11709$11724=ph$11712);if($12002(Array)($11709$11724)){return [true,value$11713];}else{$11709$11724;return [true,[value$11713]];}}));(__array_methods$11648=$12021((function(){var accum$11745;(accum$11745=({}));(accum$11745["::check"]=(function(value$11750){if((value$11750 instanceof Array)){var i$11756;(i$11756=0);$11753:for(;(i$11756<this.length);(i$11756++)){if(($12038(this,i$11756)!==$12038(value$11750,i$11756))){return false;}}return true;}else{return false;}}));return accum$11745;})(),$12021((function(){var accum$11765;(accum$11765=({}));(accum$11765["::clone"]=(function(){return $12021(this.slice(0),this);}));return accum$11765;})(),$12021((function(){var accum$11772;(accum$11772=({}));(accum$11772[":::project"]=(function(value$11777){if((value$11777 instanceof Array)){var i$11783;(i$11783=0);$11780:for(;(i$11783<this.length);(i$11783++)){if(($12038(this,i$11783)!==$12038(value$11777,i$11783))){return [true,this.concat([value$11777])];}}return [true,value$11777];}else{return [true,this.concat([value$11777])];}}));return accum$11772;})(),(function(){var accum$11792;(accum$11792=({}));(accum$11792["::serialize_ast"]=(function(){return ["array"].concat(this.map($12039));}));return accum$11792;})()))));var temp$11802;(temp$11802=$12078(__array_methods$11648));var $length$11808;($length$11808=temp$11802.length);var $index$11814;($index$11814=0);$11650:for(;($index$11814<$length$11808);($index$11814++)){var m$11823;(m$11823=temp$11802[$index$11814]);var t0$11828;var t1$11829;var k$11833;var v$11834;(t0$11828=m$11823);if(((t0$11828 instanceof Array)&&(((t1$11829=t0$11828.length)),(t1$11829===2)))){(k$11833=t0$11828[0]);(v$11834=t0$11828[1]);if((!$12038(Array.prototype,k$11833))){Object.defineProperty(Array.prototype,k$11833,({"enumerable":false,"value":v$11834}));}}else{$12095(m$11823);}}(__re_methods$11649=$12021((function(){var accum$11854;(accum$11854=({}));(accum$11854["::check"]=(function($11858$11861){var ph$11866;(ph$11866=$11858$11861);var $11863$11872;($11863$11872=ph$11866);var value$11880;if((typeof($11863$11872)==="string")){(value$11880=$11863$11872);if(value$11880.match(this)){return true;}else{return false;}}else{var other$11885;(other$11885=$11863$11872);return false;}}));return accum$11854;})(),(function(){var accum$11888;(accum$11888=({}));(accum$11888[":::project"]=(function($11892$11895){var ph$11900;(ph$11900=$11892$11895);var $11897$11906;($11897$11906=ph$11900);var value$11914;if((typeof($11897$11906)==="string")){(value$11914=$11897$11906);var $11917$11922;($11917$11922=value$11914.match(this));var m$11930;if(($11917$11922===null)){(m$11930=$11917$11922);return [false,null];}else{var m$11935;(m$11935=$11917$11922);return [true,m$11935];}}else{var other$11939;(other$11939=$11897$11906);return [false,null];}}));return accum$11888;})()));var temp$11945;(temp$11945=$12078(__re_methods$11649));var $length$11951;($length$11951=temp$11945.length);var $index$11957;($index$11957=0);$11653:for(;($index$11957<$length$11951);($index$11957++)){var m$11966;(m$11966=temp$11945[$index$11957]);var t0$11971;var t1$11972;var k$11976;var v$11977;(t0$11971=m$11966);if(((t0$11971 instanceof Array)&&(((t1$11972=t0$11971.length)),(t1$11972===2)))){(k$11976=t0$11971[0]);(v$11977=t0$11971[1]);if((!$12038(RegExp.prototype,k$11976))){Object.defineProperty(RegExp.prototype,k$11976,({"enumerable":false,"value":v$11977}));}}else{$12095(m$11966);}}if((!Function.prototype["::send"])){Object.defineProperty(Function.prototype,"::send",$12021(({"enumerable":false}),(function(){var accum$11995;(accum$11995=({}));(accum$11995["value"]=(function(args$12000){return this.apply(this,args$12000);}));return accum$11995;})()));}var hoist$12379;var hoistable$12380;var not_hoistable$12381;var hoist_helper$12382;(hoist$12379=(function(expr$12387){var t0$12394;var t1$12395;var b$12391;var inner$12392;(t0$12394=hoist_helper$12382(expr$12387));if(((t0$12394 instanceof Array)&&(((t1$12395=t0$12394.length)),(t1$12395===2)))){(b$12391=t0$12394[0]);(inner$12392=t0$12394[1]);}else{$12095(hoist_helper$12382(expr$12387),"/home/olivier/git/earl-grey/src/opt.eg",50,68);}return ["scope",inner$12392,b$12391];}));(hoistable$12380=["send","array","object","multi","if","assign","js_break","js_continue","js_return","js_delete","js_throw","js_try","js_new"]);(not_hoistable$12381=["void","js_while","js_for","js_for_in","js_label"]);(hoist_helper$12382=(function($12418$12421){var t0$12438;var x$12474;var x$12480;var bridge$12426$12466;var x$12486;var t0$12507;var t1$12508;var newbody$12504;var inner$12505;var t0$12532;var t1$12533;var newbody$12529;var inner$12530;var $index$12587;var $length$12581;var temp$12575;var acc$12569;var accum$12557;var newargs$12558;var $index$12663;var $length$12657;var temp$12651;var acc$12645;var newargs$12637;var other$12730;var type$12629;var args$12630;var type$12548;var args$12549;var vars$12523;var body$12524;var vars$12493;var body$12494;var $12432$12455;var $12433$12456;var $12434$12457;var bridge$12425$12452;var t0$12453;var $12423$12447;var ph$12435;var expr$12436;(t0$12438=$12418$12421);(expr$12436=t0$12438);(ph$12435=t0$12438);($12423$12447=ph$12435);(bridge$12425$12452=$12423$12447);if(((((bridge$12426$12466=bridge$12425$12452)),((((x$12474=bridge$12426$12466)),((x$12474 instanceof Array)&&(x$12474[0]==="symbol")))||(((x$12480=bridge$12426$12466)),((x$12480 instanceof Array)&&(x$12480[0]==="value")))))||(((x$12486=bridge$12425$12452)),((x$12486 instanceof Array)&&(x$12486[0]==="variable"))))){return [expr$12436,[]];}else{if((($12432$12455=($12423$12447 instanceof Array))&&(((t0$12453=$12423$12447.length)),(($12434$12457=(t0$12453===3))&&($12423$12447[0]==="scope"))))){(vars$12493=$12423$12447[1]);(body$12494=$12423$12447[2]);(t0$12507=hoist_helper$12382(body$12494));if(((t0$12507 instanceof Array)&&(((t1$12508=t0$12507.length)),(t1$12508===2)))){(newbody$12504=t0$12507[0]);(inner$12505=t0$12507[1]);}else{$12095(hoist_helper$12382(body$12494),"/home/olivier/git/earl-grey/src/opt.eg",1463,1481);}return [newbody$12504,inner$12505.concat(vars$12493)];}else{if(($12434$12457&&($12423$12447[0]==="lambda"))){(vars$12523=$12423$12447[1]);(body$12524=$12423$12447[2]);(t0$12532=hoist_helper$12382(body$12524));if(((t0$12532 instanceof Array)&&(((t1$12533=t0$12532.length)),(t1$12533===2)))){(newbody$12529=t0$12532[0]);(inner$12530=t0$12532[1]);}else{$12095(hoist_helper$12382(body$12524),"/home/olivier/git/earl-grey/src/opt.eg",1666,1684);}return [["lambda",vars$12523,["scope",inner$12530,newbody$12529]],[]];}else{if(($12432$12455&&(($12434$12457=(t0$12453>=1))&&((type$12548=$12423$12447[0]),((args$12549=Array.prototype.slice.call($12423$12447,1)),(hoistable$12380.indexOf(type$12548)!==-1)))))){(accum$12557=[]);(newargs$12558=(((acc$12569=[])),(((temp$12575=args$12549)),((($length$12581=temp$12575.length)),((($index$12587=0)),(function(){$12564:for(;($index$12587<$length$12581);($index$12587++)){var t0$12612;var t1$12613;var b$12609;var inner$12610;var arg$12604;var m$12596;(m$12596=temp$12575[$index$12587]);(arg$12604=m$12596);acc$12569.push(((((t0$12612=hoist_helper$12382(arg$12604))),(function(){if(((t0$12612 instanceof Array)&&(((t1$12613=t0$12612.length)),(t1$12613===2)))){(b$12609=t0$12612[0]);(inner$12610=t0$12612[1]);}else{return $12095(hoist_helper$12382(arg$12604),"/home/olivier/git/earl-grey/src/opt.eg",2027,2044);}})()),(accum$12557=accum$12557.concat(inner$12610)),b$12609));}})()))),acc$12569));return [[type$12548].concat(newargs$12558),accum$12557];}else{if(($12434$12457&&((type$12629=$12423$12447[0]),((args$12630=Array.prototype.slice.call($12423$12447,1)),(not_hoistable$12381.indexOf(type$12629)!==-1))))){(newargs$12637=(((acc$12645=[])),(((temp$12651=args$12630)),((($length$12657=temp$12651.length)),((($index$12663=0)),(function(){$12640:for(;($index$12663<$length$12657);($index$12663++)){var t0$12691;var t1$12692;var other$12725;var t0$12712;var $12685$12707;var b$12688;var inner$12689;var arg$12680;var m$12672;(m$12672=temp$12651[$index$12663]);(arg$12680=m$12672);acc$12645.push(((((t0$12691=hoist_helper$12382(arg$12680))),(function(){if(((t0$12691 instanceof Array)&&(((t1$12692=t0$12691.length)),(t1$12692===2)))){(b$12688=t0$12691[0]);(inner$12689=t0$12691[1]);}else{return $12095(hoist_helper$12382(arg$12680),"/home/olivier/git/earl-grey/src/opt.eg",2370,2387);}})()),((($12685$12707=inner$12689)),(function(){if((($12685$12707 instanceof Array)&&(((t0$12712=$12685$12707.length)),(t0$12712===0)))){return b$12688;}else{(other$12725=$12685$12707);return ["scope",inner$12689,b$12688];}})())));}})()))),acc$12645));return [[type$12629].concat(newargs$12637),[]];}else{(other$12730=$12423$12447);throw $12114(["syntax","illegal"]).create("Illegal node -- this should not happen.",({"node":other$12730}));}}}}}}));(exports["hoist"]=hoist$12379);
