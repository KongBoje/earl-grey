var $6074=function(type$6076){var f$6079;(f$6079=type$6076["::check"]);;if((f$6079===(void 0))){return function(value$6084){return (value$6084 instanceof type$6076);};}else{return function(value$6087){return f$6079.call(type$6076,value$6087);};}};
var $6089=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $6090=function($6091$6093){var ph$6097;(ph$6097=$6091$6093);;var $6095$6102;($6095$6102=ph$6097);;var bridge$6096$6107;var x$6111;(bridge$6096$6107=$6095$6102);if((((typeof(bridge$6096$6107)==="string")&&((x$6111=bridge$6096$6107),true))||((typeof(bridge$6096$6107)==="number")&&((x$6111=bridge$6096$6107),true)))){return ["value",x$6111];}else{var other$6118;(other$6118=$6095$6102);return other$6118["::serialize_ast"]();}};
var send$5937;(send$5937=function(obj$5942,$5940$5943){var ph$5947;var msg$5948;var t0$5950;(t0$5950=$5940$5943);(msg$5948=t0$5950);(ph$5947=t0$5950);;var $5945$5954;($5945$5954=ph$5947);;var bridge$5946$5959;(bridge$5946$5959=$5945$5954);if(((typeof(bridge$5946$5959)==="string")||(typeof(bridge$5946$5959)==="number"))){return obj$5942[msg$5948];}else{var other$5967;(other$5967=$5945$5954);return obj$5942["::send"](msg$5948);}});;(Array[":::project"]=function($5970$5972){var ph$5975;var value$5976;var t0$5978;(t0$5978=$5970$5972);(value$5976=t0$5978);(ph$5975=t0$5978);;var $5974$5982;($5974$5982=ph$5975);;if($6074(Array)($5974$5982)){return [true,value$5976];}else{$5974$5982;return [true,[value$5976]];}});(Array.prototype["::check"]=function(value$5996){if((value$5996 instanceof Array)){var i$6001;(i$6001=0);;$5999:for(;(i$6001<this.length);(i$6001++)){if(($6089(this,i$6001)!==$6089(value$5996,i$6001))){return false;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value$6010){if((value$6010 instanceof Array)){var i$6015;(i$6015=0);;$6013:for(;(i$6015<this.length);(i$6015++)){if(($6089(this,i$6015)!==$6089(value$6010,i$6015))){return [true,[value$6010]];}}return [true,value$6010.slice(this.length)];}else{return [true,[value$6010]];}});(Array.prototype[":::deconstruct"]=function(value$6024){return [true,value$6024.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($6090));});(RegExp.prototype["::check"]=function(value$6029){return value$6029.match(this);});(RegExp.prototype[":::project"]=function(value$6032){var $6034$6036;($6034$6036=value$6032.match(this));;var m$6044;if(($6034$6036===null)){(m$6044=$6034$6036);return [false,null];}else{var m$6049;(m$6049=$6034$6036);return [true,m$6049];}});(RegExp.prototype[":::deconstruct"]=function(value$6052){var $6054$6056;($6054$6056=value$6052.match(this));;var m$6064;if(($6054$6056===null)){(m$6064=$6054$6056);return [false,null];}else{var m$6069;(m$6069=$6054$6056);return [true,m$6069];}});(Function.prototype["::send"]=function(args$6072){return this.apply(this,args$6072);});
var $6495=function(dest$6497,values$6498){var k$6503;(k$6503=null);$6501:for(k$6503 in values$6498){if(values$6498.hasOwnProperty(k$6503)){(dest$6497[k$6503]=values$6498[k$6503]);}}return dest$6497;};
var $6389=function(){var $6390$6392;($6390$6392=function(tags$6396){var it$0$6399;(it$0$6399=function(){if((!$6074($6390$6392)(this))){return Object.create($6390$6392.prototype);}else{return this;}}());;(it$0$6399["tags"]=tags$6396);return it$0$6399;});;($6390$6392.prototype["create"]=function(){var $6408$6410;($6408$6410=arguments);;var t0$6415;var message$6419;var args$6420;(t0$6415=$6408$6410.length);if((t0$6415>=0)){(message$6419=function(){if((0>=t0$6415)){return "";}else{return $6408$6410[0];}}());(args$6420=Array.prototype.slice.call($6408$6410,1));var it$0$6424;(it$0$6424=this);;var e$6429;(e$6429=Error(message$6419));;(e$6429["::tags"]=it$0$6424.tags);(e$6429["args"]=args$6420);(e$6429["name"]=["E"].concat(it$0$6424.tags).join("."));return e$6429;}else{$6376($6408$6410);}});($6390$6392.prototype["::check"]=function(e$6438){var it$0$6441;(it$0$6441=this);;var tags$6446;if(((!e$6438)||(!$6074(Error)(e$6438)))){return false;}(tags$6446=(e$6438["::tags"]||[]));;var temp$6454;(temp$6454=it$0$6441.tags);;var len$6459;(len$6459=temp$6454.length);;var i$6464;(i$6464=0);;$6447:for(;(i$6464<len$6459);(i$6464++)){var m$6472;(m$6472=temp$6454[i$6464]);;var tag$6480;(tag$6480=m$6472);if((tags$6446.indexOf(tag$6480)===(-1))){return false;}else{false;;}}return true;});($6390$6392.prototype["::deconstruct"]=function(e$6488){var it$0$6491;(it$0$6491=this);;return e$6488.args;});$6495($6390$6392,({}));return $6390$6392;}();
var $6376=function(value$6378,url$6379,start$6380,end$6381){var err$6384;(err$6384=$6389(["match"]).create("Could not find a match for value",({"value":value$6378})));;if(url$6379){(err$6384["location"]=["location",url$6379,start$6380,end$6381]);}throw err$6384;};var hoist$6121;var hoistable$6122;var not_hoistable$6123;var hoist_helper$6124;(hoist$6121=function(expr$6128){var t0$6134;var t1$6135;var b$6131;var inner$6132;(t0$6134=hoist_helper$6124(expr$6128));if(((t0$6134 instanceof Array)&&((t1$6135=t0$6134.length),(t1$6135===2)))){(b$6131=t0$6134[0]);(inner$6132=t0$6134[1]);;}else{$6376(hoist_helper$6124(expr$6128),"/home/olivier/git/earl-grey/src/opt.eg",50,68);}return ["scope",inner$6132,b$6131];});;(hoistable$6122=["send","array","object","multi","if","assign","js_break","js_continue","js_return","js_delete","js_throw","js_try","js_new"]);;(not_hoistable$6123=["void","js_while","js_for","js_for_in","js_label"]);;(hoist_helper$6124=function($6149$6151){var t0$6162;var x$6184;var x$6189;var bridge$6155$6181;var x$6194;var t0$6210;var t1$6211;var newbody$6207;var inner$6208;var t0$6226;var t1$6227;var newbody$6223;var inner$6224;var i$6265;var len$6260;var temp$6255;var acc$6250;var accum$6241;var newargs$6242;var i$6323;var len$6318;var temp$6313;var acc$6308;var newargs$6303;var other$6372;var type$6296;var args$6297;var type$6234;var args$6235;var vars$6218;var body$6219;var vars$6201;var body$6202;var $6156$6174;var $6157$6175;var $6158$6176;var bridge$6154$6171;var t0$6172;var $6153$6166;var ph$6159;var expr$6160;(t0$6162=$6149$6151);(expr$6160=t0$6162);(ph$6159=t0$6162);;($6153$6166=ph$6159);;(bridge$6154$6171=$6153$6166);if((((bridge$6155$6181=bridge$6154$6171),((((x$6184=bridge$6155$6181)),((x$6184 instanceof Array)&&(x$6184[0]==="symbol")))||(((x$6189=bridge$6155$6181)),((x$6189 instanceof Array)&&(x$6189[0]==="value")))))||(((x$6194=bridge$6154$6171)),((x$6194 instanceof Array)&&(x$6194[0]==="variable"))))){return [expr$6160,[]];}else{if((($6156$6174=($6153$6166 instanceof Array))&&((t0$6172=$6153$6166.length),(($6158$6176=(t0$6172===3))&&($6153$6166[0]==="scope"))))){(vars$6201=$6153$6166[1]);(body$6202=$6153$6166[2]);(t0$6210=hoist_helper$6124(body$6202));if(((t0$6210 instanceof Array)&&((t1$6211=t0$6210.length),(t1$6211===2)))){(newbody$6207=t0$6210[0]);(inner$6208=t0$6210[1]);;}else{$6376(hoist_helper$6124(body$6202),"/home/olivier/git/earl-grey/src/opt.eg",447,465);}return [newbody$6207,inner$6208.concat(vars$6201)];}else{if(($6158$6176&&($6153$6166[0]==="lambda"))){(vars$6218=$6153$6166[1]);(body$6219=$6153$6166[2]);(t0$6226=hoist_helper$6124(body$6219));if(((t0$6226 instanceof Array)&&((t1$6227=t0$6226.length),(t1$6227===2)))){(newbody$6223=t0$6226[0]);(inner$6224=t0$6226[1]);;}else{$6376(hoist_helper$6124(body$6219),"/home/olivier/git/earl-grey/src/opt.eg",581,599);}return [["lambda",vars$6218,["scope",inner$6224,newbody$6223]],[]];}else{if(($6156$6174&&(($6158$6176=(t0$6172>=1))&&((type$6234=$6153$6166[0]),((args$6235=Array.prototype.slice.call($6153$6166,1)),(hoistable$6122.indexOf(type$6234)!==(-1))))))){(accum$6241=[]);;(newargs$6242=(((acc$6250=[])),(((temp$6255=args$6235)),(((len$6260=temp$6255.length)),(((i$6265=0)),function(){$6248:for(;(i$6265<len$6260);(i$6265++)){var t0$6287;var t1$6288;var b$6284;var inner$6285;var arg$6281;var m$6273;(m$6273=temp$6255[i$6265]);;(arg$6281=m$6273);acc$6250.push((((t0$6287=hoist_helper$6124(arg$6281)),function(){if(((t0$6287 instanceof Array)&&((t1$6288=t0$6287.length),(t1$6288===2)))){(b$6284=t0$6287[0]);(inner$6285=t0$6287[1]);}else{return $6376(hoist_helper$6124(arg$6281),"/home/olivier/git/earl-grey/src/opt.eg",778,795);}}()),(accum$6241=accum$6241.concat(inner$6285)),b$6284));}}()))),acc$6250));;return [[type$6234].concat(newargs$6242),accum$6241];}else{if(($6158$6176&&((type$6296=$6153$6166[0]),((args$6297=Array.prototype.slice.call($6153$6166,1)),(not_hoistable$6123.indexOf(type$6296)!==(-1)))))){(newargs$6303=(((acc$6308=[])),(((temp$6313=args$6297)),(((len$6318=temp$6313.length)),(((i$6323=0)),function(){$6306:for(;(i$6323<len$6318);(i$6323++)){var t0$6346;var t1$6347;var other$6367;var t0$6358;var $6342$6353;var b$6343;var inner$6344;var arg$6339;var m$6331;(m$6331=temp$6313[i$6323]);;(arg$6339=m$6331);acc$6308.push((((t0$6346=hoist_helper$6124(arg$6339)),function(){if(((t0$6346 instanceof Array)&&((t1$6347=t0$6346.length),(t1$6347===2)))){(b$6343=t0$6346[0]);(inner$6344=t0$6346[1]);}else{return $6376(hoist_helper$6124(arg$6339),"/home/olivier/git/earl-grey/src/opt.eg",979,996);}}()),((($6342$6353=inner$6344)),function(){if((($6342$6353 instanceof Array)&&((t0$6358=$6342$6353.length),(t0$6358===0)))){return b$6343;}else{(other$6367=$6342$6353);return ["scope",inner$6344,b$6343];}}())));}}()))),acc$6308));;return [[type$6296].concat(newargs$6303),[]];}else{(other$6372=$6153$6166);throw $6389(["syntax","illegal"]).create("Illegal node -- this should not happen.",({"node":other$6372}));}}}}}});;(exports["hoist"]=hoist$6121);
