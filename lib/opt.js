var $8756=function(type$8758){var f$8761;(f$8761=type$8758["::check"]);if((f$8761===(void 0))){return function(value$8766){return (value$8766 instanceof type$8758);};}else{return function(value$8769){return f$8761.call(type$8758,value$8769);};}};
var $8771=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $8772=function(dest$8774,values$8775){var k$8780;(k$8780=null);$8778:for(k$8780 in values$8775){if(values$8775.hasOwnProperty(k$8780)){(dest$8774[k$8780]=values$8775[k$8780]);}}return dest$8774;};
var $8787=function($8788$8790){var ph$8794;(ph$8794=$8788$8790);var $8792$8799;($8792$8799=ph$8794);var bridge$8793$8804;var x$8808;(bridge$8793$8804=$8792$8799);if((((typeof(bridge$8793$8804)==="string")&&((x$8808=bridge$8793$8804),true))||((typeof(bridge$8793$8804)==="number")&&((x$8808=bridge$8793$8804),true)))){return ["value",x$8808];}else{var other$8818;(other$8818=$8792$8799);return other$8818["::serialize_ast"]();}};
var send$8563;(send$8563=function(obj$8568,$8566$8569){var ph$8573;var msg$8574;var t0$8576;(t0$8576=$8566$8569);(msg$8574=t0$8576);(ph$8573=t0$8576);var $8571$8583;($8571$8583=ph$8573);var bridge$8572$8588;(bridge$8572$8588=$8571$8583);if(((typeof(bridge$8572$8588)==="string")||(typeof(bridge$8572$8588)==="number"))){return obj$8568[msg$8574];}else{var other$8599;(other$8599=$8571$8583);return obj$8568["::send"](msg$8574);}});(Array[":::project"]=function($8604$8606){var ph$8609;var value$8610;var t0$8612;(t0$8612=$8604$8606);(value$8610=t0$8612);(ph$8609=t0$8612);var $8608$8619;($8608$8619=ph$8609);if($8756(Array)($8608$8619)){return [true,value$8610];}else{$8608$8619;return [true,[value$8610]];}});(Array.prototype["::check"]=function(value$8636){if((value$8636 instanceof Array)){var i$8641;(i$8641=0);$8639:for(;(i$8641<this.length);(i$8641++)){if(($8771(this,i$8641)!==$8771(value$8636,i$8641))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $8772(this.slice(0),this);});(Array.prototype[":::project"]=function(value$8658){if((value$8658 instanceof Array)){var i$8663;(i$8663=0);$8661:for(;(i$8663<this.length);(i$8663++)){if(($8771(this,i$8663)!==$8771(value$8658,i$8663))){return [true,[value$8658]];}}return [true,value$8658.slice(this.length)];}else{return [true,[value$8658]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($8787));});(RegExp.prototype["::check"]=function($8679$8681){var ph$8684;(ph$8684=$8679$8681);var $8683$8689;($8683$8689=ph$8684);var value$8697;if((typeof($8683$8689)==="string")){(value$8697=$8683$8689);if(value$8697.match(this)){return true;}else{return false;}}else{var other$8702;(other$8702=$8683$8689);return false;}});(RegExp.prototype[":::project"]=function($8707$8709){var ph$8712;(ph$8712=$8707$8709);var $8711$8717;($8711$8717=ph$8712);var value$8725;if((typeof($8711$8717)==="string")){(value$8725=$8711$8717);var $8728$8730;($8728$8730=value$8725.match(this));var m$8738;if(($8728$8730===null)){(m$8738=$8728$8730);return [false,null];}else{var m$8743;(m$8743=$8728$8730);return [true,m$8743];}}else{var other$8747;(other$8747=$8711$8717);return [false,null];}});(Function.prototype["::send"]=function(args$8753){return this.apply(this,args$8753);});
var $9341=function(arr$9343){var results$9347;var l$9348;(results$9347=[]);(l$9348=arr$9343.length);var i$9356;(i$9356=0);$9346:for(;(i$9356<l$9348);(i$9356++)){results$9347.push([i$9356,$8771(arr$9343,i$9356)]);}return results$9347;};
var $9145=function(){var $9146$9148;($9146$9148=function(tags$9152){var it$0$9155;(it$0$9155=function(){if((!$8756($9146$9148)(this))){return Object.create($9146$9148.prototype);}else{return this;}}());(it$0$9155["tags"]=tags$9152);return it$0$9155;});($9146$9148.prototype["create"]=function(){var $9167$9169;($9167$9169=arguments);var t0$9174;var message$9178;var args$9179;(t0$9174=$9167$9169.length);if((t0$9174>=0)){(message$9178=function(){if((0>=t0$9174)){return "";}else{return $9167$9169[0];}}());(args$9179=Array.prototype.slice.call($9167$9169,1));var it$0$9186;(it$0$9186=this);var self$9191;(self$9191=this);var e$9196;(e$9196=Error(message$9178));(e$9196["::tags"]=it$0$9186.tags);(e$9196["args"]=args$9179);var temp$9210;(temp$9210=$9341(args$9179));var $length$9215;($length$9215=temp$9210.length);var $index$9220;($index$9220=0);$9197:for(;($index$9220<$length$9215);($index$9220++)){var m$9228;(m$9228=temp$9210[$index$9220]);var t0$9233;var t1$9234;var i$9238;var arg$9239;(t0$9233=m$9228);if(((t0$9233 instanceof Array)&&(((t1$9234=t0$9233.length)),(t1$9234===2)))){(i$9238=t0$9233[0]);(arg$9239=t0$9233[1]);(e$9196[i$9238]=arg$9239);}else{$9129(m$9228);}}(e$9196["length"]=args$9179.length);(e$9196["name"]=["E"].concat(it$0$9186.tags).join("."));return e$9196;}else{$9129($9167$9169);}});($9146$9148.prototype["::check"]=function(e$9265){var it$0$9268;(it$0$9268=this);var self$9273;(self$9273=this);var tags$9278;if(((!e$9265)||(!$8756(Error)(e$9265)))){return false;}(tags$9278=(e$9265["::tags"]||[]));var temp$9287;(temp$9287=it$0$9268.tags);var $length$9292;($length$9292=temp$9287.length);var $index$9297;($index$9297=0);$9279:for(;($index$9297<$length$9292);($index$9297++)){var m$9305;(m$9305=temp$9287[$index$9297]);var tag$9313;(tag$9313=m$9305);if((tags$9278.indexOf(tag$9313)===-1)){return false;}else{false;}}return true;});($9146$9148.prototype["::deconstruct"]=function(e$9321){var it$0$9324;(it$0$9324=this);var self$9329;(self$9329=this);return e$9321.args;});$8772($9146$9148,$8772(function(){var accum$9334;(accum$9334=({}));(accum$9334["::name"]="$9146");return accum$9334;}(),function(){var accum$9338;(accum$9338=({}));(accum$9338["::egclass"]=true);return accum$9338;}()));return $9146$9148;}();
var $9129=function(value$9131,url$9132,start$9133,end$9134){var err$9137;(err$9137=$9145(["match"]).create("Could not find a match for value",({"value":value$9131})));if(url$9132){(err$9137["location"]=["location",url$9132,start$9133,end$9134]);}throw err$9137;};var hoist$8822;var hoistable$8823;var not_hoistable$8824;var hoist_helper$8825;(hoist$8822=function(expr$8829){var t0$8835;var t1$8836;var b$8832;var inner$8833;(t0$8835=hoist_helper$8825(expr$8829));if(((t0$8835 instanceof Array)&&(((t1$8836=t0$8835.length)),(t1$8836===2)))){(b$8832=t0$8835[0]);(inner$8833=t0$8835[1]);}else{$9129(hoist_helper$8825(expr$8829),"/home/olivier/git/earl-grey/src/opt.eg",50,72);}return ["scope",inner$8833,b$8832];});(hoistable$8823=["send","array","object","multi","if","assign","js_break","js_continue","js_return","js_delete","js_throw","js_try","js_new"]);(not_hoistable$8824=["void","js_while","js_for","js_for_in","js_label"]);(hoist_helper$8825=function($8856$8858){var t0$8869;var x$8900;var x$8905;var bridge$8862$8894;var x$8910;var t0$8929;var t1$8930;var newbody$8926;var inner$8927;var t0$8951;var t1$8952;var newbody$8948;var inner$8949;var $index$8997;var $length$8992;var temp$8987;var acc$8982;var accum$8972;var newargs$8973;var $index$9063;var $length$9058;var temp$9053;var acc$9048;var newargs$9042;var other$9122;var type$9035;var args$9036;var type$8965;var args$8966;var vars$8943;var body$8944;var vars$8917;var body$8918;var $8863$8884;var $8864$8885;var $8865$8886;var bridge$8861$8881;var t0$8882;var $8860$8876;var ph$8866;var expr$8867;(t0$8869=$8856$8858);(expr$8867=t0$8869);(ph$8866=t0$8869);($8860$8876=ph$8866);(bridge$8861$8881=$8860$8876);if(((((bridge$8862$8894=bridge$8861$8881)),((((x$8900=bridge$8862$8894)),((x$8900 instanceof Array)&&(x$8900[0]==="symbol")))||(((x$8905=bridge$8862$8894)),((x$8905 instanceof Array)&&(x$8905[0]==="value")))))||(((x$8910=bridge$8861$8881)),((x$8910 instanceof Array)&&(x$8910[0]==="variable"))))){return [expr$8867,[]];}else{if((($8863$8884=($8860$8876 instanceof Array))&&(((t0$8882=$8860$8876.length)),(($8865$8886=(t0$8882===3))&&($8860$8876[0]==="scope"))))){(vars$8917=$8860$8876[1]);(body$8918=$8860$8876[2]);(t0$8929=hoist_helper$8825(body$8918));if(((t0$8929 instanceof Array)&&(((t1$8930=t0$8929.length)),(t1$8930===2)))){(newbody$8926=t0$8929[0]);(inner$8927=t0$8929[1]);}else{$9129(hoist_helper$8825(body$8918),"/home/olivier/git/earl-grey/src/opt.eg",447,472);}return [newbody$8926,inner$8927.concat(vars$8917)];}else{if(($8865$8886&&($8860$8876[0]==="lambda"))){(vars$8943=$8860$8876[1]);(body$8944=$8860$8876[2]);(t0$8951=hoist_helper$8825(body$8944));if(((t0$8951 instanceof Array)&&(((t1$8952=t0$8951.length)),(t1$8952===2)))){(newbody$8948=t0$8951[0]);(inner$8949=t0$8951[1]);}else{$9129(hoist_helper$8825(body$8944),"/home/olivier/git/earl-grey/src/opt.eg",581,606);}return [["lambda",vars$8943,["scope",inner$8949,newbody$8948]],[]];}else{if(($8863$8884&&(($8865$8886=(t0$8882>=1))&&((type$8965=$8860$8876[0]),((args$8966=Array.prototype.slice.call($8860$8876,1)),(hoistable$8823.indexOf(type$8965)!==-1)))))){(accum$8972=[]);(newargs$8973=(((acc$8982=[])),(((temp$8987=args$8966)),((($length$8992=temp$8987.length)),((($index$8997=0)),function(){$8979:for(;($index$8997<$length$8992);($index$8997++)){var t0$9020;var t1$9021;var b$9017;var inner$9018;var arg$9013;var m$9005;(m$9005=temp$8987[$index$8997]);(arg$9013=m$9005);acc$8982.push(((((t0$9020=hoist_helper$8825(arg$9013))),function(){if(((t0$9020 instanceof Array)&&(((t1$9021=t0$9020.length)),(t1$9021===2)))){(b$9017=t0$9020[0]);(inner$9018=t0$9020[1]);}else{return $9129(hoist_helper$8825(arg$9013),"/home/olivier/git/earl-grey/src/opt.eg",779,806);}}()),(accum$8972=accum$8972.concat(inner$9018)),b$9017));}}()))),acc$8982));return [[type$8965].concat(newargs$8973),accum$8972];}else{if(($8865$8886&&((type$9035=$8860$8876[0]),((args$9036=Array.prototype.slice.call($8860$8876,1)),(not_hoistable$8824.indexOf(type$9035)!==-1))))){(newargs$9042=(((acc$9048=[])),(((temp$9053=args$9036)),((($length$9058=temp$9053.length)),((($index$9063=0)),function(){$9045:for(;($index$9063<$length$9058);($index$9063++)){var t0$9087;var t1$9088;var other$9117;var t0$9105;var $9083$9100;var b$9084;var inner$9085;var arg$9079;var m$9071;(m$9071=temp$9053[$index$9063]);(arg$9079=m$9071);acc$9048.push(((((t0$9087=hoist_helper$8825(arg$9079))),function(){if(((t0$9087 instanceof Array)&&(((t1$9088=t0$9087.length)),(t1$9088===2)))){(b$9084=t0$9087[0]);(inner$9085=t0$9087[1]);}else{return $9129(hoist_helper$8825(arg$9079),"/home/olivier/git/earl-grey/src/opt.eg",981,1008);}}()),((($9083$9100=inner$9085)),function(){if((($9083$9100 instanceof Array)&&(((t0$9105=$9083$9100.length)),(t0$9105===0)))){return b$9084;}else{(other$9117=$9083$9100);return ["scope",inner$9085,b$9084];}}())));}}()))),acc$9048));return [[type$9035].concat(newargs$9042),[]];}else{(other$9122=$8860$8876);throw $9145(["syntax","illegal"]).create("Illegal node -- this should not happen.",({"node":other$9122}));}}}}}});(exports["hoist"]=hoist$8822);
