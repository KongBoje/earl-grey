var $10783=function(type$10786){var f$10790;(f$10790=type$10786["::check"]);if((f$10790===(void 0))){return function(value$10796){return (value$10796 instanceof type$10786);};}else{return function(value$10800){return f$10790.call(type$10786,value$10800);};}};
var $10802=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $10803=function(dest$10806,values$10807){var k$10812;(k$10812=null);$10810:for(k$10812 in values$10807){if(values$10807.hasOwnProperty(k$10812)){(dest$10806[k$10812]=values$10807[k$10812]);}}return dest$10806;};
var $10820=function($10822$10825){var ph$10831;(ph$10831=$10822$10825);var $10827$10837;($10827$10837=ph$10831);var bridge$10829$10842;var x$10846;(bridge$10829$10842=$10827$10837);if((((typeof(bridge$10829$10842)==="string")&&((x$10846=bridge$10829$10842),true))||((typeof(bridge$10829$10842)==="number")&&((x$10846=bridge$10829$10842),true)))){return ["value",x$10846];}else{var other$10857;(other$10857=$10827$10837);return other$10857["::serialize_ast"]();}};
var send$10557;(send$10557=function(obj$10564,$10561$10565){var ph$10571;var msg$10572;var t0$10574;(t0$10574=$10561$10565);(msg$10572=t0$10574);(ph$10571=t0$10574);var $10567$10583;($10567$10583=ph$10571);var bridge$10569$10588;(bridge$10569$10588=$10567$10583);if(((typeof(bridge$10569$10588)==="string")||(typeof(bridge$10569$10588)==="number"))){return obj$10564[msg$10572];}else{var other$10600;(other$10600=$10567$10583);return obj$10564["::send"](msg$10572);}});(Array[":::project"]=function($10606$10609){var ph$10614;var value$10615;var t0$10617;(t0$10617=$10606$10609);(value$10615=t0$10617);(ph$10614=t0$10617);var $10611$10626;($10611$10626=ph$10614);if($10783(Array)($10611$10626)){return [true,value$10615];}else{$10611$10626;return [true,[value$10615]];}});(Array.prototype["::check"]=function(value$10644){if((value$10644 instanceof Array)){var i$10650;(i$10650=0);$10647:for(;(i$10650<this.length);(i$10650++)){if(($10802(this,i$10650)!==$10802(value$10644,i$10650))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $10803(this.slice(0),this);});(Array.prototype[":::project"]=function(value$10669){if((value$10669 instanceof Array)){var i$10675;(i$10675=0);$10672:for(;(i$10675<this.length);(i$10675++)){if(($10802(this,i$10675)!==$10802(value$10669,i$10675))){return [true,[value$10669]];}}return [true,value$10669.slice(this.length)];}else{return [true,[value$10669]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($10820));});(RegExp.prototype["::check"]=function($10693$10696){var ph$10701;(ph$10701=$10693$10696);var $10698$10707;($10698$10707=ph$10701);var value$10715;if((typeof($10698$10707)==="string")){(value$10715=$10698$10707);if(value$10715.match(this)){return true;}else{return false;}}else{var other$10720;(other$10720=$10698$10707);return false;}});(RegExp.prototype[":::project"]=function($10726$10729){var ph$10734;(ph$10734=$10726$10729);var $10731$10740;($10731$10740=ph$10734);var value$10748;if((typeof($10731$10740)==="string")){(value$10748=$10731$10740);var $10751$10756;($10751$10756=value$10748.match(this));var m$10764;if(($10751$10756===null)){(m$10764=$10751$10756);return [false,null];}else{var m$10769;(m$10769=$10751$10756);return [true,m$10769];}}else{var other$10773;(other$10773=$10731$10740);return [false,null];}});(Function.prototype["::send"]=function(args$10780){return this.apply(this,args$10780);});
var $11476=function(arr$11479){var results$11485;var l$11486;(results$11485=[]);(l$11486=arr$11479.length);var i$11495;(i$11495=0);$11484:for(;(i$11495<l$11486);(i$11495++)){results$11485.push([i$11495,$10802(arr$11479,i$11495)]);}return results$11485;};
var $11243=function(){var $11244$11250;($11244$11250=function(tags$11255){var it$0$11258;(it$0$11258=function(){if((!$10783($11244$11250)(this))){return Object.create($11244$11250.prototype);}else{return this;}}());(it$0$11258["tags"]=tags$11255);return it$0$11258;});($11244$11250.prototype["create"]=function(){var it$0$11278;var self$11279;(it$0$11278=this);(self$11279=this);var $11276$11288;($11276$11288=arguments);var t0$11293;var message$11297;var args$11298;(t0$11293=$11276$11288.length);if((t0$11293>=0)){(message$11297=function(){if((0>=t0$11293)){return "";}else{return $11276$11288[0];}}());(args$11298=Array.prototype.slice.call($11276$11288,1));var e$11311;(e$11311=Error(message$11297));(e$11311["::tags"]=it$0$11278.tags);(e$11311["args"]=args$11298);var temp$11327;(temp$11327=$11476(args$11298));var $length$11333;($length$11333=temp$11327.length);var $index$11339;($index$11339=0);$11312:for(;($index$11339<$length$11333);($index$11339++)){var m$11348;(m$11348=temp$11327[$index$11339]);var t0$11353;var t1$11354;var i$11358;var arg$11359;(t0$11353=m$11348);if(((t0$11353 instanceof Array)&&(((t1$11354=t0$11353.length)),(t1$11354===2)))){(i$11358=t0$11353[0]);(arg$11359=t0$11353[1]);(e$11311[i$11358]=arg$11359);}else{$11224(m$11348);}}(e$11311["length"]=args$11298.length);(e$11311["name"]=["E"].concat(it$0$11278.tags).join("."));return e$11311;}else{$11224($11276$11288);}});($11244$11250.prototype["::check"]=function(e$11389){var it$0$11393;var self$11394;(it$0$11393=this);(self$11394=this);var tags$11404;if(((!e$11389)||(!$10783(Error)(e$11389)))){return false;}(tags$11404=(e$11389["::tags"]||[]));var temp$11415;(temp$11415=it$0$11393.tags);var $length$11421;($length$11421=temp$11415.length);var $index$11427;($index$11427=0);$11405:for(;($index$11427<$length$11421);($index$11427++)){var m$11436;(m$11436=temp$11415[$index$11427]);var tag$11444;(tag$11444=m$11436);if((tags$11404.indexOf(tag$11444)===-1)){return false;}else{false;}}return true;});($11244$11250.prototype["::deconstruct"]=function(e$11453){var it$0$11457;var self$11458;(it$0$11457=this);(self$11458=this);return e$11453.args;});$10803($11244$11250,$10803(function(){var accum$11469;(accum$11469=({}));(accum$11469["::name"]="$11244");return accum$11469;}(),function(){var accum$11473;(accum$11473=({}));(accum$11473["::egclass"]=true);return accum$11473;}()));return $11244$11250;}();
var $11224=function(value$11227,url$11228,start$11229,end$11230){var err$11234;(err$11234=$11243(["match"]).create("Could not find a match for value",({"value":value$11227})));if(url$11228){(err$11234["location"]=["location",url$11228,start$11229,end$11230]);}throw err$11234;};var hoist$10865;var hoistable$10866;var not_hoistable$10867;var hoist_helper$10868;(hoist$10865=function(expr$10873){var t0$10880;var t1$10881;var b$10877;var inner$10878;(t0$10880=hoist_helper$10868(expr$10873));if(((t0$10880 instanceof Array)&&(((t1$10881=t0$10880.length)),(t1$10881===2)))){(b$10877=t0$10880[0]);(inner$10878=t0$10880[1]);}else{$11224(hoist_helper$10868(expr$10873),"/home/olivier/git/earl-grey/src/opt.eg",50,72);}return ["scope",inner$10878,b$10877];});(hoistable$10866=["send","array","object","multi","if","assign","js_break","js_continue","js_return","js_delete","js_throw","js_try","js_new"]);(not_hoistable$10867=["void","js_while","js_for","js_for_in","js_label"]);(hoist_helper$10868=function($10904$10907){var t0$10924;var x$10960;var x$10966;var bridge$10912$10952;var x$10972;var t0$10993;var t1$10994;var newbody$10990;var inner$10991;var t0$11018;var t1$11019;var newbody$11015;var inner$11016;var $index$11073;var $length$11067;var temp$11061;var acc$11055;var accum$11043;var newargs$11044;var $index$11149;var $length$11143;var temp$11137;var acc$11131;var newargs$11123;var other$11216;var type$11115;var args$11116;var type$11034;var args$11035;var vars$11009;var body$11010;var vars$10979;var body$10980;var $10918$10941;var $10919$10942;var $10920$10943;var bridge$10911$10938;var t0$10939;var $10909$10933;var ph$10921;var expr$10922;(t0$10924=$10904$10907);(expr$10922=t0$10924);(ph$10921=t0$10924);($10909$10933=ph$10921);(bridge$10911$10938=$10909$10933);if(((((bridge$10912$10952=bridge$10911$10938)),((((x$10960=bridge$10912$10952)),((x$10960 instanceof Array)&&(x$10960[0]==="symbol")))||(((x$10966=bridge$10912$10952)),((x$10966 instanceof Array)&&(x$10966[0]==="value")))))||(((x$10972=bridge$10911$10938)),((x$10972 instanceof Array)&&(x$10972[0]==="variable"))))){return [expr$10922,[]];}else{if((($10918$10941=($10909$10933 instanceof Array))&&(((t0$10939=$10909$10933.length)),(($10920$10943=(t0$10939===3))&&($10909$10933[0]==="scope"))))){(vars$10979=$10909$10933[1]);(body$10980=$10909$10933[2]);(t0$10993=hoist_helper$10868(body$10980));if(((t0$10993 instanceof Array)&&(((t1$10994=t0$10993.length)),(t1$10994===2)))){(newbody$10990=t0$10993[0]);(inner$10991=t0$10993[1]);}else{$11224(hoist_helper$10868(body$10980),"/home/olivier/git/earl-grey/src/opt.eg",1463,1488);}return [newbody$10990,inner$10991.concat(vars$10979)];}else{if(($10920$10943&&($10909$10933[0]==="lambda"))){(vars$11009=$10909$10933[1]);(body$11010=$10909$10933[2]);(t0$11018=hoist_helper$10868(body$11010));if(((t0$11018 instanceof Array)&&(((t1$11019=t0$11018.length)),(t1$11019===2)))){(newbody$11015=t0$11018[0]);(inner$11016=t0$11018[1]);}else{$11224(hoist_helper$10868(body$11010),"/home/olivier/git/earl-grey/src/opt.eg",1666,1691);}return [["lambda",vars$11009,["scope",inner$11016,newbody$11015]],[]];}else{if(($10918$10941&&(($10920$10943=(t0$10939>=1))&&((type$11034=$10909$10933[0]),((args$11035=Array.prototype.slice.call($10909$10933,1)),(hoistable$10866.indexOf(type$11034)!==-1)))))){(accum$11043=[]);(newargs$11044=(((acc$11055=[])),(((temp$11061=args$11035)),((($length$11067=temp$11061.length)),((($index$11073=0)),function(){$11050:for(;($index$11073<$length$11067);($index$11073++)){var t0$11098;var t1$11099;var b$11095;var inner$11096;var arg$11090;var m$11082;(m$11082=temp$11061[$index$11073]);(arg$11090=m$11082);acc$11055.push(((((t0$11098=hoist_helper$10868(arg$11090))),function(){if(((t0$11098 instanceof Array)&&(((t1$11099=t0$11098.length)),(t1$11099===2)))){(b$11095=t0$11098[0]);(inner$11096=t0$11098[1]);}else{return $11224(hoist_helper$10868(arg$11090),"/home/olivier/git/earl-grey/src/opt.eg",2027,2054);}}()),(accum$11043=accum$11043.concat(inner$11096)),b$11095));}}()))),acc$11055));return [[type$11034].concat(newargs$11044),accum$11043];}else{if(($10920$10943&&((type$11115=$10909$10933[0]),((args$11116=Array.prototype.slice.call($10909$10933,1)),(not_hoistable$10867.indexOf(type$11115)!==-1))))){(newargs$11123=(((acc$11131=[])),(((temp$11137=args$11116)),((($length$11143=temp$11137.length)),((($index$11149=0)),function(){$11126:for(;($index$11149<$length$11143);($index$11149++)){var t0$11177;var t1$11178;var other$11211;var t0$11198;var $11171$11193;var b$11174;var inner$11175;var arg$11166;var m$11158;(m$11158=temp$11137[$index$11149]);(arg$11166=m$11158);acc$11131.push(((((t0$11177=hoist_helper$10868(arg$11166))),function(){if(((t0$11177 instanceof Array)&&(((t1$11178=t0$11177.length)),(t1$11178===2)))){(b$11174=t0$11177[0]);(inner$11175=t0$11177[1]);}else{return $11224(hoist_helper$10868(arg$11166),"/home/olivier/git/earl-grey/src/opt.eg",2370,2397);}}()),((($11171$11193=inner$11175)),function(){if((($11171$11193 instanceof Array)&&(((t0$11198=$11171$11193.length)),(t0$11198===0)))){return b$11174;}else{(other$11211=$11171$11193);return ["scope",inner$11175,b$11174];}}())));}}()))),acc$11131));return [[type$11115].concat(newargs$11123),[]];}else{(other$11216=$10909$10933);throw $11243(["syntax","illegal"]).create("Illegal node -- this should not happen.",({"node":other$11216}));}}}}}});(exports["hoist"]=hoist$10865);
