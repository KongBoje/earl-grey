var τ20=function(type$1592){var f$1595;(f$1595=type$1592["::check"]);;if((f$1595===(void 0))){return function(value$1600){return (value$1600 instanceof type$1592);};}else{return function(value$1603){return f$1595.call(type$1592,value$1603);};}};
var τ21=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var τ22=function(temp$1605$1607){var ph$1611;(ph$1611=temp$1605$1607);;var m$1609$1616;(m$1609$1616=ph$1611);;var bridge$1610$1621;var x$1625;(bridge$1610$1621=m$1609$1616);if((((typeof(bridge$1610$1621)==="string")&&((x$1625=bridge$1610$1621),true))||((typeof(bridge$1610$1621)==="number")&&((x$1625=bridge$1610$1621),true)))){return ["value",x$1625];}else{var other$1632;(other$1632=m$1609$1616);return other$1632["::serialize_ast"]();}};
var send$1454;(send$1454=function(obj$1459,temp$1457$1460){var ph$1464;var msg$1465;var t0$1467;(t0$1467=temp$1457$1460);(msg$1465=t0$1467);(ph$1464=t0$1467);;var m$1462$1471;(m$1462$1471=ph$1464);;var bridge$1463$1476;(bridge$1463$1476=m$1462$1471);if(((typeof(bridge$1463$1476)==="string")||(typeof(bridge$1463$1476)==="number"))){return obj$1459[msg$1465];}else{var other$1484;(other$1484=m$1462$1471);return obj$1459["::send"](msg$1465);}});;(Array[":::project"]=function(temp$1487$1489){var ph$1492;var value$1493;var t0$1495;(t0$1495=temp$1487$1489);(value$1493=t0$1495);(ph$1492=t0$1495);;var m$1491$1499;(m$1491$1499=ph$1492);;if(τ20(Array)(m$1491$1499)){return [true,value$1493];}else{m$1491$1499;return [true,[value$1493]];}});(Array.prototype["::check"]=function(value$1513){if((value$1513 instanceof Array)){var i$1518;(i$1518=0);;$1516:for(;(i$1518<this.length);(i$1518++)){if((τ21(this,i$1518)!==τ21(value$1513,i$1518))){return false;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value$1527){if((value$1527 instanceof Array)){var i$1532;(i$1532=0);;$1530:for(;(i$1532<this.length);(i$1532++)){if((τ21(this,i$1532)!==τ21(value$1527,i$1532))){return [true,[value$1527]];}}return [true,value$1527.slice(this.length)];}else{return [true,[value$1527]];}});(Array.prototype[":::deconstruct"]=function(value$1541){return [true,value$1541.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map(τ22));});(RegExp.prototype["::check"]=function(value$1546){return value$1546.match(this);});(RegExp.prototype[":::project"]=function(value$1549){var m$1551$1553;(m$1551$1553=value$1549.match(this));;var m$1561;if((m$1551$1553===null)){(m$1561=m$1551$1553);return [false,null];}else{var m$1566;(m$1566=m$1551$1553);return [true,m$1566];}});(RegExp.prototype[":::deconstruct"]=function(value$1569){var m$1571$1573;(m$1571$1573=value$1569.match(this));;var m$1581;if((m$1571$1573===null)){(m$1581=m$1571$1573);return [false,null];}else{var m$1586;(m$1586=m$1571$1573);return [true,m$1586];}});(Function.prototype["::send"]=function(args$1589){return this.apply(this,args$1589);});
var τ23=function(dest$3208,values$3209){var k$3214;(k$3214=null);$3212:for(k$3214 in values$3209){if(values$3209.hasOwnProperty(k$3214)){(dest$3208[k$3214]=values$3209[k$3214]);}}return dest$3208;};
var τ24=function(temp$3218$3220,key$3221){var ph$3225;(ph$3225=temp$3218$3220);;var m$3223$3230;(m$3223$3230=ph$3225);;var bridge$3224$3235;(bridge$3224$3235=m$3223$3230);if(((bridge$3224$3235===null)||(bridge$3224$3235===(void 0)))){return false;}else{var x$3243;if((typeof(m$3223$3230)==="string")){(x$3243=m$3223$3230);return (key$3221 in String.prototype);}else{var x$3248;if((typeof(m$3223$3230)==="number")){(x$3248=m$3223$3230);return (key$3221 in Number.prototype);}else{var x$3253;(x$3253=m$3223$3230);return (key$3221 in x$3253);}}}};
var τ25=function(){var $3255$3257;($3255$3257=function(tags$3261){var it$0$3264;(it$0$3264=function(){if((!τ20($3255$3257)(this))){return Object.create($3255$3257.prototype);}else{return this;}}());;(it$0$3264["tags"]=tags$3261);return it$0$3264;});;($3255$3257.prototype["create"]=function(){var m$3273$3275;(m$3273$3275=arguments);;var t0$3280;var message$3284;var args$3285;(t0$3280=m$3273$3275.length);if((t0$3280>=0)){(message$3284=function(){if((0>=t0$3280)){return "";}else{return m$3273$3275[0];}}());(args$3285=Array.prototype.slice.call(m$3273$3275,1));var it$0$3289;(it$0$3289=this);;var e$3294;(e$3294=Error(message$3284));;(e$3294["::tags"]=it$0$3289.tags);(e$3294["args"]=args$3285);(e$3294["name"]=["E"].concat(it$0$3289.tags).join("."));return e$3294;}else{throw Error("mismatch!!");}});($3255$3257.prototype["::check"]=function(e$3303){var it$0$3306;(it$0$3306=this);;var tags$3311;if(((!e$3303)||(!τ20(Error)(e$3303)))){return false;}(tags$3311=(e$3303["::tags"]||[]));;var temp$3319;(temp$3319=it$0$3306.tags);;var len$3324;(len$3324=temp$3319.length);;var i$3329;(i$3329=0);;$3316:for(;(i$3329<len$3324);(i$3329++)){var m$3337;(m$3337=temp$3319[i$3329]);;var tag$3345;(tag$3345=m$3337);if((tags$3311.indexOf(tag$3345)===(-1))){return false;}else{false;;}}return true;});($3255$3257.prototype["::deconstruct"]=function(e$3353){var it$0$3356;(it$0$3356=this);;return e$3353.args;});τ23($3255$3257,({}));return $3255$3257;}();var $1636$1639;var __lt____gt__$1640;var $1637$1641;var __lt____lt____colon__$1642;var util$1643;var classify$1644;var items$1645;var iterkeys$1646;var enumerate$1647;var neighbours$1648;var zip$1649;var GenSym$1650;var gensym$1651;var uuid$1652;var $1638$1653;var PatternParser$1654;var PatternProcessor$1655;var Scope$1656;var Env$1657;var bind_ast$1658;var track_location$1659;var Expander$1660;var mac1$1661;var __chk_ncache$1662;var __chk_scache$1663;var checker$1664;($1636$1639=require("./pp"));;(__lt____gt__$1640=$1636$1639["<>"]);;($1637$1641=require("./location"));;(__lt____lt____colon__$1642=$1637$1641["<<:"]);;(util$1643=require("./util"));;(classify$1644=util$1643.classify);;(items$1645=util$1643.items);;(iterkeys$1646=util$1643.keys);;(enumerate$1647=util$1643.enumerate);;(neighbours$1648=util$1643.neighbours);;(zip$1649=util$1643.zip);;(GenSym$1650=util$1643.GenSym);;(gensym$1651=util$1643.gensym);;(uuid$1652=util$1643.uuid);;($1638$1653=require("./pattern"));;(PatternParser$1654=$1638$1653.PatternParser);;(PatternProcessor$1655=$1638$1653.PatternProcessor);;(Scope$1656=function(){var it$0$1735;var parent$1730;var name$1731;var t0$1726;var m$1719$1721;(m$1719$1721=arguments);;(t0$1726=m$1719$1721.length);if(((t0$1726>=0)&&(t0$1726<=2))){(parent$1730=function(){if((0>=t0$1726)){return null;}else{return m$1719$1721[0];}}());(name$1731=function(){if((1>=t0$1726)){return null;}else{return m$1719$1721[1];}}());(it$0$1735=function(){if((!τ20(Scope$1656)(this))){return Object.create(Scope$1656.prototype);}else{return this;}}());;(it$0$1735["name"]=(name$1731||gensym$1651("scope")));(it$0$1735["parent"]=parent$1730);(it$0$1735["options"]=({}));return it$0$1735;}else{throw Error("mismatch!!");}});;(Scope$1656.prototype["getopt"]=function(opt$1747){var otherwise$1774;var $1751$1763;var m$1750$1757;var it$0$1752;(it$0$1752=this);;(m$1750$1757=null);;m$1750$1757;if((opt$1747 in it$0$1752.options)){return τ21(it$0$1752.options,opt$1747);}else{if((it$0$1752.parent===null)){return (void 0);}else{(otherwise$1774=m$1750$1757);return it$0$1752.parent.getopt(opt$1747);}}});(Scope$1656.prototype["setopt"]=function(opt$1779,value$1780){var it$0$1783;(it$0$1783=this);;return (it$0$1783.options[opt$1779]=value$1780);});(Scope$1656.prototype["toString"]=function(){var it$0$1792;(it$0$1792=this);;return (("Scope{"+it$0$1792.name)+"}");});τ23(Scope$1656,({}));Scope$1656;(Env$1657=function(){var it$0$1801;(it$0$1801=function(){if((!τ20(Env$1657)(this))){return Object.create(Env$1657.prototype);}else{return this;}}());;(it$0$1801["scopes"]=({}));return it$0$1801;});;(Env$1657.prototype["resolve"]=function(scope$1810,name$1811){var scope_data$1819;var it$0$1814;(it$0$1814=this);;if((scope$1810===null)){return (void 0);}(scope_data$1819=τ21(it$0$1814.scopes,scope$1810.name));;if((scope_data$1819&&Object.prototype.hasOwnProperty.call(scope_data$1819,name$1811))){return τ21(scope_data$1819,name$1811);}else{return it$0$1814.resolve(scope$1810.parent,name$1811);}});(Env$1657.prototype["bind"]=function(scope$1827,name$1828,value$1829){var it$0$1832;(it$0$1832=this);;if((!τ21(it$0$1832.scopes,scope$1827.name))){(it$0$1832.scopes[scope$1827.name]=({}));}return (τ21(it$0$1832.scopes,scope$1827.name)[name$1828]=value$1829);});(Env$1657.prototype["fork"]=function(){var i$1865;var len$1860;var temp$1855;var e$1848;var it$0$1843;(it$0$1843=this);;(e$1848=Env$1657());;(temp$1855=items$1645(it$0$1843.scopes));;(len$1860=temp$1855.length);;(i$1865=0);;$1852:for(;(i$1865<len$1860);(i$1865++)){var i$1905;var len$1900;var temp$1895;var acc$1890;var scope$1883;var bindings$1884;var t0$1878;var t1$1879;var m$1873;(m$1873=temp$1855[i$1865]);;(t0$1878=m$1873);if(((t0$1878 instanceof Array)&&((t1$1879=t0$1878.length),(t1$1879===2)))){(scope$1883=t0$1878[0]);(bindings$1884=t0$1878[1]);(acc$1890=[]);;(temp$1895=items$1645(bindings$1884));;(len$1900=temp$1895.length);;(i$1905=0);;$1888:for(;(i$1905<len$1900);(i$1905++)){var k$1923;var v$1924;var t0$1918;var t1$1919;var m$1913;(m$1913=temp$1895[i$1905]);;(t0$1918=m$1913);if(((t0$1918 instanceof Array)&&((t1$1919=t0$1918.length),(t1$1919===2)))){(k$1923=t0$1918[0]);(v$1924=t0$1918[1]);acc$1890.push((function(){if((!τ21(e$1848.scopes,scope$1883))){return (e$1848.scopes[scope$1883]=({}));}}(),(τ21(e$1848.scopes,scope$1883)[k$1923]=v$1924)));}else{false;;}}acc$1890;}else{false;;}}return e$1848;});(Env$1657.prototype["toString"]=function(){var it$0$1939;(it$0$1939=this);;return "Env{...}";});τ23(Env$1657,({}));Env$1657;(bind_ast$1658=function(temp$1945$1947,env$1948){var t0$1958;var x$1988;var x$1993;var bridge$1954$1985;var x$1998;var bridge$1953$1982;var x$2003;var bridge$1952$1979;var x$2008;var i$2034;var len$2029;var temp$2024;var other$2054;var type$2015;var args$2016;var e$1972;var bridge$1951$1967;var t0$1968;var m$1950$1962;var ph$1955;var expr$1956;(t0$1958=temp$1945$1947);(expr$1956=t0$1958);(ph$1955=t0$1958);;(m$1950$1962=ph$1955);;if(τ24(m$1950$1962,"env")){(e$1972=m$1950$1962.env);return expr$1956;}else{(bridge$1951$1967=m$1950$1962);if((((bridge$1952$1979=bridge$1951$1967),(((bridge$1953$1982=bridge$1952$1979),(((bridge$1954$1985=bridge$1953$1982),((((x$1988=bridge$1954$1985)),((x$1988 instanceof Array)&&(x$1988[0]==="symbol")))||(((x$1993=bridge$1954$1985)),((x$1993 instanceof Array)&&(x$1993[0]==="value")))))||(((x$1998=bridge$1953$1982)),((x$1998 instanceof Array)&&(x$1998[0]==="variable")))))||(((x$2003=bridge$1952$1979)),((x$2003 instanceof Array)&&(x$2003[0]==="macro")))))||(((x$2008=bridge$1951$1967)),((x$2008 instanceof Array)&&(x$2008[0]==="void"))))){return τ23(expr$1956,({"env":env$1948}));}else{if(((m$1950$1962 instanceof Array)&&((t0$1968=m$1950$1962.length),(t0$1968>=1)))){(type$2015=m$1950$1962[0]);(args$2016=Array.prototype.slice.call(m$1950$1962,1));(temp$2024=args$2016);;(len$2029=temp$2024.length);;(i$2034=0);;$2021:for(;(i$2034<len$2029);(i$2034++)){var arg$2050;var m$2042;(m$2042=temp$2024[i$2034]);;(arg$2050=m$2042);bind_ast$1658(arg$2050,env$1948);}return τ23(expr$1956,({"env":env$1948}));}else{(other$2054=m$1950$1962);return τ23(expr$1956,({"env":env$1948}));}}}});;(track_location$1659=function(f$2060){var f2$2063;(f2$2063=function(context$2067,scope$2068,expr$2069){var rval$2077;var other$2109;var v$2103;var t0$2099;var m$2072$2094;var rval$2073;(rval$2073=(((rval$2077=false)),(function(){try{(rval$2077=f$2060(context$2067,scope$2068,expr$2069));}catch(excv$2083){var e$2089;(e$2089=excv$2083);(rval$2077=(__lt____lt____colon__$1642(e$2089,expr$2069),function(){throw e$2089;}()));}}(),rval$2077)));;(m$2072$2094=rval$2073);;if(((m$2072$2094 instanceof Array)&&((t0$2099=m$2072$2094.length),((t0$2099===2)&&(m$2072$2094[0]==="bounce"))))){(v$2103=m$2072$2094[1]);return f2$2063(context$2067,scope$2068,__lt____lt____colon__$1642(v$2103,expr$2069));}else{(other$2109=m$2072$2094);return __lt____lt____colon__$1642(other$2109,expr$2069);}});;return f2$2063;});;(Expander$1660=function(env_factory$2116,generic_nodes$2117){var it$0$2120;(it$0$2120=function(){if((!τ20(Expander$1660)(this))){return Object.create(Expander$1660.prototype);}else{return this;}}());;(it$0$2120["mkenv"]=env_factory$2116);(it$0$2120["generic_nodes"]=generic_nodes$2117);return it$0$2120;});;(Expander$1660.prototype["run_macro"]=function(m$2130,context$2131,scope$2132,form$2133,arg$2134){var rval$2142;var it$0$2137;(it$0$2137=this);;(rval$2142=m$2130(context$2131,scope$2132,form$2133,arg$2134));;bind_ast$1658(rval$2142,it$0$2137.mkenv());return rval$2142;});(Expander$1660.prototype["step"]=function(context$2149,scope$2150,expr$2151){var helper$2159;var it$0$2154;(it$0$2154=this);;(helper$2159=track_location$1659(function(context$2164,scope$2165,temp$2162$2166){var t0$2175;var other$2215;var env$2210;var m$2200$2202;var other$2248;var t0$2239;var m$2232$2234;var other$2252;var m$2228;var t0$2224;var m$2196$2219;var env$2197;var other$2275;var t0$2266;var m$2259$2261;var other$2300;var m$2294;var t0$2290;var m$2283$2285;var other$2309;var x$2304;var f$2279;var arg$2280;var m$2256;var s$2191;var $2169$2186;var $2170$2187;var $2171$2188;var t0$2184;var m$2168$2179;var ph$2172;var expr$2173;(t0$2175=temp$2162$2166);(expr$2173=t0$2175);(ph$2172=t0$2175);;(m$2168$2179=ph$2172);;if((($2169$2186=(m$2168$2179 instanceof Array))&&((t0$2184=m$2168$2179.length),(($2171$2188=(t0$2184===2))&&(m$2168$2179[0]==="symbol"))))){(s$2191=m$2168$2179[1]);(env$2197=(((m$2200$2202=expr$2173)),function(){if(τ24(m$2200$2202,"env")){(env$2210=m$2200$2202.env);return expr$2173.env;}else{(other$2215=m$2200$2202);throw τ25(["syntax","no_env"]).create("No environment was found to resolve",({"symbol":expr$2173}));}}()));;(m$2196$2219=env$2197.resolve(scope$2165,s$2191));;if(((m$2196$2219 instanceof Array)&&((t0$2224=m$2196$2219.length),((t0$2224===2)&&(m$2196$2219[0]==="macro"))))){(m$2228=m$2196$2219[1]);(m$2232$2234=context$2164);;if(((m$2232$2234 instanceof Array)&&((t0$2239=m$2232$2234.length),((t0$2239===2)&&((m$2232$2234[0]==="expr")&&(m$2232$2234[1]==="head")))))){return ["macro",m$2228];}else{(other$2248=m$2232$2234);return ["bounce",it$0$2154.run_macro(m$2228,context$2164,scope$2165,expr$2173,["void"])];}}else{(other$2252=m$2196$2219);return expr$2173;}}else{if(($2171$2188&&(m$2168$2179[0]==="macro"))){(m$2256=m$2168$2179[1]);(m$2259$2261=context$2164);;if(((m$2259$2261 instanceof Array)&&((t0$2266=m$2259$2261.length),((t0$2266===2)&&((m$2259$2261[0]==="expr")&&(m$2259$2261[1]==="head")))))){return expr$2173;}else{(other$2275=m$2259$2261);return ["bounce",it$0$2154.run_macro(m$2256,context$2164,scope$2165,expr$2173,["void"])];}}else{if(($2169$2186&&((t0$2184===3)&&(m$2168$2179[0]==="send")))){(f$2279=m$2168$2179[1]);(arg$2280=m$2168$2179[2]);(m$2283$2285=helper$2159(["expr","head"],scope$2165,f$2279));;if(((m$2283$2285 instanceof Array)&&((t0$2290=m$2283$2285.length),((t0$2290===2)&&(m$2283$2285[0]==="macro"))))){(m$2294=m$2283$2285[1]);return ["bounce",it$0$2154.run_macro(m$2294,context$2164,scope$2165,expr$2173,arg$2280)];}else{(other$2300=m$2283$2285);return expr$2173;}}else{if(($2169$2186&&((t0$2184===2)&&(m$2168$2179[0]==="nostep")))){(x$2304=m$2168$2179[1]);return x$2304;}else{(other$2309=m$2168$2179);return expr$2173;}}}}}));;return helper$2159(context$2149,scope$2150,expr$2151);});(Expander$1660.prototype["step_all"]=function(context$2316,scope$2317,temp$2314$2318){var t0$2322;var t1$2323;var pre$2335;var bulk$2336;var post$2337;var it$0$2329;var stmts$2320;(t0$2322=temp$2314$2318);if(((t0$2322 instanceof Array)&&((t1$2323=t0$2322.length),(t1$2323>=0)))){(stmts$2320=Array.prototype.slice.call(t0$2322,0));;}else{throw Error("Mismatch");}(it$0$2329=this);;(pre$2335=[]);;(bulk$2336=[]);;(post$2337=[]);;$2334:while(stmts$2320.length){var x$2392;var m$2387;var stmt$2382;var stmt$2377;var prepend$2371;var $2351$2366;var $2352$2367;var $2353$2368;var t0$2364;var m$2350$2359;var current$2354;(current$2354=stmts$2320.shift());;(m$2350$2359=it$0$2329.step(context$2316,scope$2317,current$2354));;if((($2351$2366=(m$2350$2359 instanceof Array))&&((t0$2364=m$2350$2359.length),((t0$2364>=1)&&(m$2350$2359[0]==="splice"))))){(prepend$2371=Array.prototype.slice.call(m$2350$2359,1));(stmts$2320=prepend$2371.concat(stmts$2320));}else{if(($2351$2366&&(($2353$2368=(t0$2364===2))&&(m$2350$2359[0]==="float")))){(stmt$2377=m$2350$2359[1]);(pre$2335=pre$2335.concat(it$0$2329.step_all(context$2316,scope$2317,[stmt$2377])));}else{if(($2353$2368&&(m$2350$2359[0]==="sink"))){(stmt$2382=m$2350$2359[1]);(post$2337=post$2337.concat(it$0$2329.step_all(context$2316,scope$2317,[stmt$2382])));}else{if(($2353$2368&&(m$2350$2359[0]==="multimacro"))){(m$2387=m$2350$2359[1]);(stmts$2320=m$2387(context$2316,scope$2317,current$2354,stmts$2320));}else{(x$2392=m$2350$2359);bulk$2336.push(x$2392);}}}}}return pre$2335.concat(bulk$2336).concat(post$2337);});(Expander$1660.prototype["expand"]=function(context$2397,scope$2398,expr$2399){var helper$2407;var it$0$2402;(it$0$2402=this);;(helper$2407=track_location$1659(function(context$2411,scope$2412,expr$2413){var t0$2444;var other$2461;var m$2441$2449;var env$2442;var i$2507;var len$2502;var temp$2497;var acc$2492;var newargs$2487;var i$2552;var len$2547;var temp$2542;var acc$2537;var newargs$2532;var t0$2596;var newscope$2590;var env$2591;var i$2643;var len$2638;var temp$2633;var acc$2628;var t0$2618;var newscope$2606;var stepscope$2607;var newargs$2608;var vars$2609;var exp$2610;var i$2853;var len$2848;var temp$2843;var other$2927;var t0$2910;var m$2903$2905;var is_obj$2765;var obj$2766;var arr$2767;var arr_parts$2768;var obj_parts$2769;var new_arr_part$2770;var new_obj_part$2771;var r$2772;var i$2969;var len$2964;var temp$2959;var acc$2954;var newscope$2947;var s$3030;var newscope$3038;var name$3025;var t0$3021;var i$3072;var len$3067;var temp$3062;var acc$3057;var other$3092;var type$3049;var args$3050;var tag$3042;var body$3043;var x$3016;var ph$2417$3017;var bindings$2942;var body$2943;var target$2936;var value$2937;var args$2761;var args$2602;var variable$2580;var s$2581;var value$2582;var body$2583;var args$2528;var args$2483;var f$2477;var arg$2478;var s$2436;var $2418$2431;var $2419$2432;var $2420$2433;var t0$2427;var t1$2428;var t2$2429;var m$2416$2422;(expr$2413=it$0$2402.step(context$2411,scope$2412,expr$2413));(m$2416$2422=expr$2413);;if((($2418$2431=(m$2416$2422 instanceof Array))&&((t0$2427=m$2416$2422.length),(($2420$2433=(t0$2427===2))&&(m$2416$2422[0]==="symbol"))))){(s$2436=m$2416$2422[1]);(t0$2444=expr$2413);if(τ24(t0$2444,"env")){(env$2442=t0$2444.env);;}else{throw Error("Mismatch");}(m$2441$2449=env$2442.resolve(scope$2412,s$2436));;if((m$2441$2449===(void 0))){throw τ25(["syntax","undeclared"]).create(("Undeclared variable: "+s$2436),({"node":expr$2413}));}else{(other$2461=m$2441$2449);return ["bounce",other$2461];}}else{if(($2420$2433&&(m$2416$2422[0]==="value"))){m$2416$2422[1];return expr$2413;}else{if(($2420$2433&&(m$2416$2422[0]==="variable"))){m$2416$2422[1];return expr$2413;}else{if(($2418$2431&&((t0$2427===1)&&(m$2416$2422[0]==="void")))){return expr$2413;}else{if(($2418$2431&&((t0$2427===3)&&(m$2416$2422[0]==="send")))){(f$2477=m$2416$2422[1]);(arg$2478=m$2416$2422[2]);return ["send",helper$2407(["expr","head"],scope$2412,f$2477),helper$2407(["expr","tail"],scope$2412,arg$2478)];}else{if(($2418$2431&&(($2420$2433=(t0$2427>=1))&&(m$2416$2422[0]==="array")))){(args$2483=Array.prototype.slice.call(m$2416$2422,1));(newargs$2487=(((acc$2492=[])),(((temp$2497=it$0$2402.step_all(["expr","array"],scope$2412,args$2483))),(((len$2502=temp$2497.length)),(((i$2507=0)),function(){$2490:for(;(i$2507<len$2502);(i$2507++)){var arg$2523;var m$2515;(m$2515=temp$2497[i$2507]);;(arg$2523=m$2515);acc$2492.push(helper$2407(["expr","expr"],scope$2412,arg$2523));}}()))),acc$2492));;return ["array"].concat(newargs$2487);}else{if(($2420$2433&&(m$2416$2422[0]==="object"))){(args$2528=Array.prototype.slice.call(m$2416$2422,1));(newargs$2532=(((acc$2537=[])),(((temp$2542=it$0$2402.step_all(["expr","object"],scope$2412,args$2528))),(((len$2547=temp$2542.length)),(((i$2552=0)),function(){$2535:for(;(i$2552<len$2547);(i$2552++)){var k$2570;var v$2571;var t0$2565;var t1$2566;var m$2560;(m$2560=temp$2542[i$2552]);;(t0$2565=m$2560);if(((t0$2565 instanceof Array)&&((t1$2566=t0$2565.length),((t1$2566===3)&&(t0$2565[0]==="array"))))){(k$2570=t0$2565[1]);(v$2571=t0$2565[2]);acc$2537.push(["array",helper$2407(["expr","expr"],scope$2412,k$2570),helper$2407(["expr","expr"],scope$2412,v$2571)]);}else{false;;}}}()))),acc$2537));;return ["object"].concat(newargs$2532);}else{if(($2418$2431&&((t0$2427===4)&&((m$2416$2422[0]==="bind")&&((t1$2428=m$2416$2422[1]),((variable$2580=t1$2428),((t1$2428 instanceof Array)&&((t2$2429=t1$2428.length),((t2$2429===2)&&(t1$2428[0]==="symbol")))))))))){(s$2581=t1$2428[1]);(value$2582=m$2416$2422[2]);(body$2583=m$2416$2422[3]);(newscope$2590=Scope$1656(scope$2412));;(t0$2596=variable$2580);if(τ24(t0$2596,"env")){(env$2591=t0$2596.env);;}else{throw Error("Mismatch");}env$2591.bind(newscope$2590,s$2581,value$2582);return helper$2407(context$2411,newscope$2590,body$2583);}else{if(($2418$2431&&(($2420$2433=(t0$2427>=1))&&(m$2416$2422[0]==="multi")))){(args$2602=Array.prototype.slice.call(m$2416$2422,1));(newscope$2606=Scope$1656(scope$2412));;(stepscope$2607=function(){if(expr$2413.nonrecursive){return scope$2412;}else{return newscope$2606;}}());;(t0$2618=classify$1644("newargs","vars",(((acc$2628=[])),(((temp$2633=it$0$2402.step_all(["expr","multi"],stepscope$2607,args$2602))),(((len$2638=temp$2633.length)),(((i$2643=0)),function(){$2620:for(;(i$2643<len$2638);(i$2643++)){var t0$2689;var env$2686;var v$2687;var other$2706;var v$2698;var value$2699;var variable$2677;var s$2678;var value$2679;var opt$2669;var value$2670;var $2621$2661;var $2622$2662;var $2623$2663;var $2624$2664;var $2625$2665;var $2626$2666;var t0$2656;var t1$2657;var t2$2658;var t3$2659;var m$2651;(m$2651=temp$2633[i$2643]);;(t0$2656=m$2651);if((($2622$2662=(t0$2656 instanceof Array))&&((t1$2657=t0$2656.length),((t1$2657===3)&&(t0$2656[0]==="option"))))){(opt$2669=t0$2656[1]);(value$2670=t0$2656[2]);acc$2628.push((newscope$2606.setopt(opt$2669,value$2670),["ignore"]));}else{if(($2622$2662&&(($2624$2664=((t1$2657>=2)&&(t1$2657<=3)))&&(($2625$2665=(t0$2656[0]==="declare"))&&((t2$2658=t0$2656[1]),((variable$2677=t2$2658),((t2$2658 instanceof Array)&&((t3$2659=t2$2658.length),((t3$2659===2)&&(t2$2658[0]==="symbol")))))))))){(s$2678=t2$2658[1]);(value$2679=function(){if((2>=t1$2657)){return null;}else{return t0$2656[2];}}());acc$2628.push((((t0$2689=variable$2677),function(){if(τ24(t0$2689,"env")){(env$2686=t0$2689.env);}else{throw Error("Mismatch");}}()),((v$2687=__lt____lt____colon__$1642(["variable",gensym$1651(s$2678)],variable$2677))),env$2686.bind(newscope$2606,s$2678,v$2687),function(){if(value$2679){return ["splice",["newargs",["assign",v$2687,value$2679]],["vars",v$2687]];}else{return ["vars",v$2687];}}()));}else{if(($2625$2665&&((v$2698=t2$2658),((t2$2658 instanceof Array)&&((t3$2659=t2$2658.length),((t3$2659===2)&&(t2$2658[0]==="variable"))))))){t2$2658[1];(value$2699=function(){if((2>=t1$2657)){return null;}else{return t0$2656[2];}}());acc$2628.push(function(){if(value$2699){return ["splice",["newargs",["assign",v$2698,value$2699]],["vars",v$2698]];}else{return ["vars",v$2698];}}());}else{(other$2706=m$2651);acc$2628.push(["newargs",other$2706]);}}}}}()))),acc$2628)));if((τ24(t0$2618,"newargs")&&((newargs$2608=t0$2618.newargs),τ24(t0$2618,"vars")))){(vars$2609=t0$2618.vars);;}else{throw Error("Mismatch");}(exp$2610=function(s$2714){var i$2733;var len$2728;var temp$2723;var acc$2718;(acc$2718=[]);;(temp$2723=enumerate$1647(newargs$2608));;(len$2728=temp$2723.length);;(i$2733=0);;$2716:for(;(i$2733<len$2728);(i$2733++)){var i$2751;var arg$2752;var t0$2746;var t1$2747;var m$2741;(m$2741=temp$2723[i$2733]);;(t0$2746=m$2741);if(((t0$2746 instanceof Array)&&((t1$2747=t0$2746.length),(t1$2747===2)))){(i$2751=t0$2746[0]);(arg$2752=t0$2746[1]);acc$2718.push(helper$2407(["expr",function(){if((i$2751===(newargs$2608.length-1))){return "expr";}else{return "ignore";}}()],s$2714,arg$2752));}else{false;;}}return acc$2718;});;if(vars$2609.length){return ["scope",vars$2609,["multi"].concat(exp$2610(newscope$2606))];}else{return ["multi"].concat(exp$2610(scope$2412));}}else{if(($2420$2433&&(m$2416$2422[0]==="data"))){(args$2761=Array.prototype.slice.call(m$2416$2422,1));(is_obj$2765=false);;(obj$2766=["object"]);;(arr$2767=["array"]);;(arr_parts$2768=[]);;(obj_parts$2769=[]);;(new_arr_part$2770=function(){var other$2808;var t0$2799;var m$2792$2794;(m$2792$2794=arr$2767);;if(((m$2792$2794 instanceof Array)&&((t0$2799=m$2792$2794.length),((t0$2799===1)&&(m$2792$2794[0]==="array"))))){return false;}else{(other$2808=m$2792$2794);arr_parts$2768.push(arr$2767);return (arr$2767=["array"]);}});;(new_obj_part$2771=function(){var other$2832;var t0$2823;var m$2816$2818;(m$2816$2818=obj$2766);;if(((m$2816$2818 instanceof Array)&&((t0$2823=m$2816$2818.length),((t0$2823===1)&&(m$2816$2818[0]==="object"))))){return false;}else{(other$2832=m$2816$2818);obj_parts$2769.push(obj$2766);return (obj$2766=["object"]);}});;(temp$2843=it$0$2402.step_all(["expr","data"],scope$2412,args$2761));;(len$2848=temp$2843.length);;(i$2853=0);;$2836:for(;(i$2853<len$2848);(i$2853++)){var other$2899;var expr$2893;var expr$2887;var k$2880;var v$2881;var $2837$2869;var $2838$2870;var $2839$2871;var $2840$2872;var t0$2866;var t1$2867;var m$2861;(m$2861=temp$2843[i$2853]);;(t0$2866=m$2861);if((($2838$2870=(t0$2866 instanceof Array))&&((t1$2867=t0$2866.length),((t1$2867===1)&&(t0$2866[0]==="assoc"))))){(is_obj$2765=true);}else{if(($2838$2870&&((t1$2867===3)&&(t0$2866[0]==="assoc")))){(k$2880=t0$2866[1]);(v$2881=t0$2866[2]);(is_obj$2765=true);obj$2766.push(["array",k$2880,v$2881]);}else{if(($2838$2870&&(($2840$2872=(t1$2867===2))&&(t0$2866[0]==="dynsplice")))){(expr$2887=t0$2866[1]);new_arr_part$2770();arr_parts$2768.push(expr$2887);}else{if(($2840$2872&&(t0$2866[0]==="objsplice"))){(expr$2893=t0$2866[1]);(is_obj$2765=true);new_obj_part$2771();obj_parts$2769.push(expr$2893);}else{(other$2899=m$2861);arr$2767.push(other$2899);}}}}}new_arr_part$2770();new_obj_part$2771();(r$2772=(((m$2903$2905=arr_parts$2768)),function(){if(((m$2903$2905 instanceof Array)&&((t0$2910=m$2903$2905.length),((t0$2910===0)&&is_obj$2765)))){return util$1643.construct(obj_parts$2769,function(x$2918,rest$2919){return ["send",["symbol","&:"],["data",x$2918,rest$2919]];},["object"]);}else{m$2903$2905;if(is_obj$2765){throw τ25(["syntax","array","object"]).create("Cannot mix array and object notations.");}else{(other$2927=m$2903$2905);return util$1643.construct(arr_parts$2768.reverse(),function(x$2930,rest$2931){return ["send",["send",rest$2931,["send",["symbol","."],["data",["void"],["symbol","concat"]]]],["data",x$2930]];},["array"]);}}}()));;return helper$2407(context$2411,scope$2412,bind_ast$1658(r$2772,it$0$2402.mkenv()));}else{if(($2418$2431&&(($2420$2433=(t0$2427===3))&&(m$2416$2422[0]==="assign")))){(target$2936=m$2416$2422[1]);(value$2937=m$2416$2422[2]);return ["assign",helper$2407(["expr"],scope$2412,target$2936),helper$2407(["expr"],scope$2412,value$2937)];}else{if(($2420$2433&&(m$2416$2422[0]==="lambda"))){(bindings$2942=m$2416$2422[1]);(body$2943=m$2416$2422[2]);(newscope$2947=Scope$1656(scope$2412));;return ["lambda",(((acc$2954=[])),(((temp$2959=bindings$2942)),(((len$2964=temp$2959.length)),(((i$2969=0)),function(){$2951:for(;(i$2969<len$2964);(i$2969++)){var v$2995;var x$3005;var other$3012;var v$3002;var b$2988;var env$2989;var $2952$2985;var t0$2982;var t1$2983;var m$2977;(m$2977=temp$2959[i$2969]);;(t0$2982=m$2977);if(((t0$2982 instanceof Array)&&((t1$2983=t0$2982.length),((t1$2983===2)&&((t0$2982[0]==="symbol")&&((b$2988=t0$2982[1]),τ24(t0$2982,"env"))))))){(env$2989=t0$2982.env);acc$2954.push((((v$2995=["variable",gensym$1651(b$2988)])),(env$2989.bind(newscope$2947,b$2988,v$2995),v$2995)));}else{if((((x$3005=t0$2982)),((x$3005 instanceof Array)&&(x$3005[0]==="variable")))){(v$3002=t0$2982);acc$2954.push(v$3002);}else{(other$3012=m$2977);acc$2954.push(function(){throw τ25(["syntax","lambda","binding"]).create("Not a valid binding.",({"node":other$3012}));}());}}}}()))),acc$2954),helper$2407(["expr","expr"],newscope$2947,body$2943)];}else{if(($2420$2433&&(m$2416$2422[0]==="use"))){(ph$2417$3017=m$2416$2422[1]);(x$3016=m$2416$2422[2]);(t0$3021=ph$2417$3017);if((typeof(t0$3021)==="string")){(name$3025=t0$3021);(s$3030=scope$2412);;$3029:while(s$3030){if((s$3030.name.slice(0,(name$3025.length+1))===(name$3025+"/"))){break $3029;}else{(s$3030=s$3030.parent);}}if(s$3030){return helper$2407(context$2411,s$3030,x$3016);}else{throw τ25(["syntax","noscope"]).create(("Could not find a scope tagged: "+name$3025));}}else{(newscope$3038=ph$2417$3017);return helper$2407(context$2411,newscope$3038,x$3016);}}else{if(($2420$2433&&((m$2416$2422[0]==="tagscope")&&((t1$2428=m$2416$2422[1]),(typeof(t1$2428)==="string"))))){(tag$3042=t1$2428);(body$3043=m$2416$2422[2]);return helper$2407(context$2411,Scope$1656(scope$2412,gensym$1651((tag$3042+"/"))),body$3043);}else{if(($2418$2431&&((t0$2427>=1)&&((type$3049=m$2416$2422[0]),((args$3050=Array.prototype.slice.call(m$2416$2422,1)),(it$0$2402.generic_nodes.indexOf(type$3049)!==(-1))))))){return [type$3049].concat((((acc$3057=[])),(((temp$3062=args$3050)),(((len$3067=temp$3062.length)),(((i$3072=0)),function(){$3055:for(;(i$3072<len$3067);(i$3072++)){var arg$3088;var m$3080;(m$3080=temp$3062[i$3072]);;(arg$3088=m$3080);acc$3057.push(helper$2407(["expr","expr"],scope$2412,arg$3088));}}()))),acc$3057));}else{(other$3092=m$2416$2422);throw τ25(["syntax","illegal_node"]).create("An illegal node was found.",({"node":other$3092,"context":context$2411}));}}}}}}}}}}}}}}}}));;return helper$2407(context$2397,scope$2398,expr$2399);});τ23(Expander$1660,({}));Expander$1660;(mac1$1661=function(f$3098){return ["macro",function(context$3102,scope$3103,form$3104,temp$3100$3105){var t0$3109;var t1$3110;var expr$3107;(t0$3109=temp$3100$3105);if(((t0$3109 instanceof Array)&&((t1$3110=t0$3109.length),((t1$3110===2)&&(t0$3109[0]==="data"))))){(expr$3107=t0$3109[1]);;}else{throw Error("Mismatch");}return f$3098(expr$3107);}];});;(__chk_ncache$1662=({}));;(__chk_scache$1663=({}));;(checker$1664=function(temp$3124$3126){var v$3162;var v$3175;var s$3171;var n$3158;var m$3128$3134;var ph$3129;(ph$3129=temp$3124$3126);;(m$3128$3134=ph$3129);;if((m$3128$3134===null)){return checker$1664.null;}else{if((m$3128$3134===(void 0))){return checker$1664.undefined;}else{if((m$3128$3134===true)){return checker$1664.true;}else{if((m$3128$3134===false)){return checker$1664.false;}else{if((typeof(m$3128$3134)==="number")){(n$3158=m$3128$3134);if(τ21(__chk_ncache$1662,n$3158)){return τ21(__chk_ncache$1662,n$3158);}else{(v$3162=mac1$1661(function(x$3166){return ["send",["symbol","=="],["data",x$3166,["value",n$3158]]];}));;(__chk_ncache$1662[n$3158]=v$3162);return v$3162;}}else{if((typeof(m$3128$3134)==="string")){(s$3171=m$3128$3134);if(Object.prototype.hasOwnProperty.call(__chk_scache$1663,s$3171)){return τ21(__chk_scache$1663,s$3171);}else{(v$3175=mac1$1661(function(x$3179){return ["send",["symbol","=="],["data",x$3179,["value",s$3171]]];}));;(__chk_scache$1663[s$3171]=v$3175);return v$3175;}}else{throw Error("mismatch!!");}}}}}}});;τ23(checker$1664,({"String":mac1$1661(function(x$3186){return ["send",["symbol","=="],["data",["send",["symbol","typeof"],["data",x$3186]],["value","string"]]];}),"Number":mac1$1661(function(x$3189){return ["send",["symbol","=="],["data",["send",["symbol","typeof"],["data",x$3189]],["value","number"]]];}),"Array":mac1$1661(function(x$3192){return ["send",["symbol","instanceof"],["data",x$3192,["symbol","Array"]]];}),"true":mac1$1661(function(x$3195){return x$3195;}),"false":mac1$1661(function(x$3198){return ["send",["symbol","not"],["data",["void"],x$3198]];}),"null":mac1$1661(function(x$3201){return ["send",["symbol","=="],["data",x$3201,["value",null]]];}),"undefined":mac1$1661(function(x$3204){return ["send",["symbol","=="],["data",x$3204,["value",(void 0)]]];})}));(exports["Env"]=Env$1657);(exports["Scope"]=Scope$1656);(exports["track_location"]=track_location$1659);(exports["Expander"]=Expander$1660);(exports["GenSym"]=GenSym$1650);(exports["gensym"]=gensym$1651);(exports["bind_ast"]=bind_ast$1658);(exports["mac1"]=mac1$1661);(exports["checker"]=checker$1664);
