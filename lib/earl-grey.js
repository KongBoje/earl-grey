var $150=function(type$152){var f$155;(f$155=type$152["::check"]);;if((f$155===(void 0))){return function(value$160){return (value$160 instanceof type$152);};}else{return function(value$163){return f$155.call(type$152,value$163);};}};
var $165=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $166=function($167$169){var ph$173;(ph$173=$167$169);;var $171$178;($171$178=ph$173);;var bridge$172$183;var x$187;(bridge$172$183=$171$178);if((((typeof(bridge$172$183)==="string")&&((x$187=bridge$172$183),true))||((typeof(bridge$172$183)==="number")&&((x$187=bridge$172$183),true)))){return ["value",x$187];}else{var other$194;(other$194=$171$178);return other$194["::serialize_ast"]();}};
var send$13;(send$13=function(obj$18,$16$19){var ph$23;var msg$24;var t0$26;(t0$26=$16$19);(msg$24=t0$26);(ph$23=t0$26);;var $21$30;($21$30=ph$23);;var bridge$22$35;(bridge$22$35=$21$30);if(((typeof(bridge$22$35)==="string")||(typeof(bridge$22$35)==="number"))){return obj$18[msg$24];}else{var other$43;(other$43=$21$30);return obj$18["::send"](msg$24);}});;(Array[":::project"]=function($46$48){var ph$51;var value$52;var t0$54;(t0$54=$46$48);(value$52=t0$54);(ph$51=t0$54);;var $50$58;($50$58=ph$51);;if($150(Array)($50$58)){return [true,value$52];}else{$50$58;return [true,[value$52]];}});(Array.prototype["::check"]=function(value$72){if((value$72 instanceof Array)){var i$77;(i$77=0);;$75:for(;(i$77<this.length);(i$77++)){if(($165(this,i$77)!==$165(value$72,i$77))){return false;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value$86){if((value$86 instanceof Array)){var i$91;(i$91=0);;$89:for(;(i$91<this.length);(i$91++)){if(($165(this,i$91)!==$165(value$86,i$91))){return [true,[value$86]];}}return [true,value$86.slice(this.length)];}else{return [true,[value$86]];}});(Array.prototype[":::deconstruct"]=function(value$100){return [true,value$100.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($166));});(RegExp.prototype["::check"]=function(value$105){return value$105.match(this);});(RegExp.prototype[":::project"]=function(value$108){var $110$112;($110$112=value$108.match(this));;var m$120;if(($110$112===null)){(m$120=$110$112);return [false,null];}else{var m$125;(m$125=$110$112);return [true,m$125];}});(RegExp.prototype[":::deconstruct"]=function(value$128){var $130$132;($130$132=value$128.match(this));;var m$140;if(($130$132===null)){(m$140=$130$132);return [false,null];}else{var m$145;(m$145=$130$132);return [true,m$145];}});(Function.prototype["::send"]=function(args$148){return this.apply(this,args$148);});
var $605=function(dest$607,values$608){var k$613;(k$613=null);$611:for(k$613 in values$608){if(values$608.hasOwnProperty(k$613)){(dest$607[k$613]=values$608[k$613]);}}return dest$607;};
var $499=function(){var $500$502;($500$502=function(tags$506){var it$0$509;(it$0$509=function(){if((!$150($500$502)(this))){return Object.create($500$502.prototype);}else{return this;}}());;(it$0$509["tags"]=tags$506);return it$0$509;});;($500$502.prototype["create"]=function(){var $518$520;($518$520=arguments);;var t0$525;var message$529;var args$530;(t0$525=$518$520.length);if((t0$525>=0)){(message$529=function(){if((0>=t0$525)){return "";}else{return $518$520[0];}}());(args$530=Array.prototype.slice.call($518$520,1));var it$0$534;(it$0$534=this);;var e$539;(e$539=Error(message$529));;(e$539["::tags"]=it$0$534.tags);(e$539["args"]=args$530);(e$539["name"]=["E"].concat(it$0$534.tags).join("."));return e$539;}else{$486($518$520);}});($500$502.prototype["::check"]=function(e$548){var it$0$551;(it$0$551=this);;var tags$556;if(((!e$548)||(!$150(Error)(e$548)))){return false;}(tags$556=(e$548["::tags"]||[]));;var temp$564;(temp$564=it$0$551.tags);;var len$569;(len$569=temp$564.length);;var i$574;(i$574=0);;$557:for(;(i$574<len$569);(i$574++)){var m$582;(m$582=temp$564[i$574]);;var tag$590;(tag$590=m$582);if((tags$556.indexOf(tag$590)===(-1))){return false;}else{false;;}}return true;});($500$502.prototype["::deconstruct"]=function(e$598){var it$0$601;(it$0$601=this);;return e$598.args;});$605($500$502,({}));return $500$502;}();
var $486=function(value$488,url$489,start$490,end$491){var err$494;(err$494=$499(["match"]).create("Could not find a match for value",({"value":value$488})));;if(url$489){(err$494["location"]=["location",url$489,start$490,end$491]);}throw err$494;};
var $617=function($618$620,key$621){var ph$625;(ph$625=$618$620);;var $623$630;($623$630=ph$625);;var bridge$624$635;(bridge$624$635=$623$630);if(((bridge$624$635===null)||(bridge$624$635===(void 0)))){return false;}else{var x$643;if((typeof($623$630)==="string")){(x$643=$623$630);return (key$621 in String.prototype);}else{var x$648;if((typeof($623$630)==="number")){(x$648=$623$630);return (key$621 in Number.prototype);}else{var x$653;(x$653=$623$630);return (key$621 in x$653);}}}};var $197$202;var items$203;var $198$204;var Source$205;var Location$206;var highlight_locations$207;var $199$208;var tokenize$209;var $200$210;var parse$211;var $201$212;var translate$213;var Translator$214;var std$215;var exp$216;var opt$217;var generate_from_ast$218;var generate$219;var Generator$220;($197$202=require("./util"));;(items$203=$197$202.items);;($198$204=require("./location"));;(Source$205=$198$204.Source);;(Location$206=$198$204.Location);;(highlight_locations$207=$198$204.highlight_locations);;($199$208=require("./lex"));;(tokenize$209=$199$208.tokenize);;($200$210=require("./parse"));;(parse$211=$200$210.parse);;($201$212=require("./translate-js"));;(translate$213=$201$212.translate);;(Translator$214=$201$212.Translator);;(std$215=require("./stdenv"));;(exp$216=require("./expand"));;(opt$217=require("./opt"));;(generate_from_ast$218=function(ast$272){var ex$275;var tr$276;var rval$277;(ex$275=std$215.expand(["top"],std$215.topscope,std$215.bind_ast(["multi",ast$272],std$215.stdenv.fork())));;(ex$275=opt$217.hoist(ex$275));(tr$276=Translator$214());;(rval$277=tr$276.translate(ex$275,"expr"));;return [tr$276.dump_store(),rval$277];});;std$215.stdenv.bind(std$215.topscope,"macro",["macro",function(context$290,scope$291,form$292,$288$293){var t0$332;var t1$333;var prep$327;var code$328;var mac$329;var mac2$330;var name$314;var sym$315;var arguments$316;var ast$317;var t0$306;var t1$307;var t2$308;var t3$309;var t4$310;var $295$301;var ph$296;(ph$296=$288$293);;($295$301=ph$296);;if((($295$301 instanceof Array)&&((t0$306=$295$301.length),((t0$306===3)&&(($295$301[0]==="data")&&((t1$307=$295$301[1]),((t1$307 instanceof Array)&&((t2$308=t1$307.length),((t2$308===3)&&((t1$307[0]==="send")&&((t3$309=t1$307[1]),((name$314=t3$309),((t3$309 instanceof Array)&&((t4$310=t3$309.length),((t4$310===2)&&(t3$309[0]==="symbol")))))))))))))))){(sym$315=t3$309[1]);(arguments$316=t1$307[2]);(ast$317=$295$301[2]);(t0$332=generate_from_ast$218(["send",["symbol","->"],["data",arguments$316,ast$317]]));if(((t0$332 instanceof Array)&&((t1$333=t0$332.length),(t1$333===2)))){(prep$327=t0$332[0]);(code$328=t0$332[1]);;}else{$486(generate_from_ast$218(["send",["symbol","->"],["data",arguments$316,ast$317]]),"/home/olivier/git/earl-grey/src/earl-grey.eg",798,838);}(mac$329=eval((prep$327+((";("+code$328)+")"))));;(mac2$330=function(c$344,s$345,f$346,e$347){var env$350;var r$351;(env$350=scope$291.expander.mkenv());;env$350.bind(scope$291,sym$315,["macro",mac2$330]);(r$351=mac$329(c$344,s$345,f$346,e$347));;return exp$216.bind_ast(r$351,env$350);});;return ["declare",name$314,["macro",mac2$330]];}else{$486($295$301);}}]);std$215.stdenv.bind(std$215.topscope,"macros",["macro",function(context$364,scope$365,$361$366,$362$367){var t0$372;var t0$377;var t1$378;var t0$388;var t1$389;var i$415;var len$410;var temp$405;var acc$400;var prep$384;var code$385;var the_macros$386;var env$369;var body$370;(t0$372=$361$366);if($617(t0$372,"env")){(env$369=t0$372.env);;}else{$486($361$366);}(t0$377=$362$367);if(((t0$377 instanceof Array)&&((t1$378=t0$377.length),((t1$378===2)&&(t0$377[0]==="data"))))){(body$370=t0$377[1]);;}else{$486($362$367);}(t0$388=generate_from_ast$218(body$370));if(((t0$388 instanceof Array)&&((t1$389=t0$388.length),(t1$389===2)))){(prep$384=t0$388[0]);(code$385=t0$388[1]);;}else{$486(generate_from_ast$218(body$370),"/home/olivier/git/earl-grey/src/earl-grey.eg",1360,1383);}(the_macros$386=eval((((prep$384+";(")+code$385)+")")));;return ["splice"].concat((((acc$400=[])),(((temp$405=items$203(the_macros$386))),(((len$410=temp$405.length)),(((i$415=0)),function(){$398:for(;(i$415<len$410);(i$415++)){var k$433;var v$434;var t0$428;var t1$429;var m$423;(m$423=temp$405[i$415]);;(t0$428=m$423);if(((t0$428 instanceof Array)&&((t1$429=t0$428.length),(t1$429===2)))){(k$433=t0$428[0]);(v$434=t0$428[1]);acc$400.push(["declare",$605(["symbol",k$433],({"env":env$369})),["macro",v$434]]);}else{false;;}}}()))),acc$400));}]);(generate$219=function(source$443){return Generator$220().generate(source$443);});;(Generator$220=function(){var it$0$451;(it$0$451=function(){if((!$150(Generator$220)(this))){return Object.create(Generator$220.prototype);}else{return this;}}());;(it$0$451["tr"]=Translator$214(std$215.stdprelude));(it$0$451["env"]=std$215.stdenv.fork());return it$0$451;});;(Generator$220.prototype["generate"]=function(source$461){var t$469;var p$470;var ex$471;var rval$472;var it$0$464;(it$0$464=this);;(t$469=tokenize$209(source$461));;(p$470=parse$211(t$469));;(ex$471=std$215.expand(["top"],std$215.topscope,std$215.bind_ast(["splice",p$470],it$0$464.env)));;(ex$471=opt$217.hoist(ex$471));(rval$472=it$0$464.tr.translate(ex$471,"stmt"));;return (it$0$464.tr.dump_store()+rval$472);});$605(Generator$220,({}));Generator$220;(exports["Source"]=Source$205);(exports["Location"]=Location$206);(exports["highlight_locations"]=highlight_locations$207);(exports["tokenize"]=tokenize$209);(exports["parse"]=parse$211);(exports["Generator"]=Generator$220);(exports["generate"]=generate$219);
