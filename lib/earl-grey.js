var patch_array=function(){var r=[];for(var i=0;(i<arguments.length);(i++)){(r=r.concat(arguments[i]));}return r;};var StructFactory=function(name){var make=function(){var r=Array.prototype.slice.call(arguments,0);(r["#"]=name);return r;};(make["___project"]=function(value){if(((value instanceof Array)&&(value["#"]===name))){return [true,value];}else{if(true){return [true,make(value)];}else{return false;}}});(make["___check"]=function(value){if(((value instanceof Array)&&(value["#"]===name))){return true;}else{if(true){return false;}else{return false;}}});(make["___deconstruct"]=function(value){if(((value instanceof Array)&&(value["#"]===name))){return [true,value.slice(0)];}else{if(true){return [false,false];}else{return false;}}});return make;};var Struct=function(name){var r=Array.prototype.slice.call(arguments,1);(r["#"]=name);return r;};(Struct["___check"]=function(value){if((value instanceof Array)){return (value["#"]!==undefined);}else{if(true){return false;}else{return false;}}});(Struct["___deconstruct"]=function(value){if(((value instanceof Array)&&(value["#"]!==undefined))){return [value["#"]].concat(value.slice(0));}else{if(true){throw "cannot deconstruct";}else{return false;}}});var pr=function(x){var r=repr(x);var pre=(String.fromCharCode(27)+"[?0;7y+h <div class=\"ug\">");var post=("</div>"+String.fromCharCode(7));return console.log(((pre+r)+post));};var __slash____slash____slash__=function(cls,contents){var τ357=contents;var other;if((typeof(τ357)==="string")){return (((("<span class=\""+cls)+"\">")+contents)+"</span>");}else{if(((other=τ357),true)){return (((("<span class=\""+cls)+"\">")+contents.join(""))+"</span>");}else{throw ["Could not find a match",τ357];}}};var repr=function(x){var τ358=x;var entries;if((τ358===true)){return __slash____slash____slash__("special",__slash____slash____slash__("true","true"));}else{if((τ358===false)){return __slash____slash____slash__("special",__slash____slash____slash__("false","false"));}else{if((τ358===null)){return __slash____slash____slash__("special",__slash____slash____slash__("nil","null"));}else{if((τ358===(void 0))){return __slash____slash____slash__("special",__slash____slash____slash__("nil","undefined"));}else{if((typeof(τ358)==="number")){return __slash____slash____slash__("num",String(x));}else{if((typeof(τ358)==="string")){return __slash____slash____slash__("str",x);}else{if(((entries=τ358),true)){var tag=entries["#"];var τ359=tag;var other;if((τ359===(void 0))){return __slash____slash____slash__("sequence",entries.map(function(x){return repr(x);}));}else{if(((other=τ359),true)){return __slash____slash____slash__("struct",[__slash____slash____slash__("sym",tag),__slash____slash____slash__("sequence",entries.map(function(x){return repr(x);}))]);}else{throw ["Could not find a match",τ359];}}}else{throw ["Could not find a match",τ358];}}}}}}}};var send=function(obj,msg){var τ360=msg;var other;if(((typeof(τ360)==="string")||(typeof(τ360)==="number"))){return obj[msg];}else{if(((other=τ360),true)){return obj.___send(msg);}else{throw ["Could not find a match",τ360];}}};(Function.prototype["___send"]=function(args){return this.apply(this,args);});var checker=function(type){var τ361=type.___check;var f;if((τ361===(void 0))){return function(value){return (value instanceof type);};}else{if(((f=τ361),true)){return function(value){return f.call(type,value);};}else{throw ["Could not find a match",τ361];}}};var projector=function(type){return function(value){var τ362=type.___project;var f;if((τ362===(void 0))){if((value instanceof type)){return [true,value];}else{if(true){return [false,null];}else{return false;}}}else{if(((f=τ362),true)){return f.call(type,value);}else{throw ["Could not find a match",τ362];}}};};var deconstructor=function(type){return function(value){var τ363=type.___deconstruct;var f;if((τ363===(void 0))){if((value instanceof Array)){return [true,value];}else{if(true){return [false,null];}else{return false;}}}else{if(((f=τ363),true)){return f.call(this,value);}else{throw ["Could not find a match",τ363];}}};};(Array["___project"]=function(value){var τ364=value;if(checker(Array)(τ364)){return [true,value];}else{if(true){return [true,[value]];}else{throw ["Could not find a match",τ364];}}});(RegExp.prototype["___check"]=function(value){return value.match(this);});(RegExp.prototype["___project"]=function(value){var τ365=value.match(this);var m;var m;if(((τ365===null)&&((m=τ365),true))){return [false,null];}else{if(((m=τ365),true)){return [true,m];}else{throw ["Could not find a match",τ365];}}});
var special_ops=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",":":"IFX",".":"PFX","'":"PFX"});var regexps=function(){var id=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))");var id_f=function(m,wsb,wsa,last_op){return ["ID","ID",m[0]];};var numr=RegExp("(?:^((?:\\d+))[rR]((?:[A-Za-z0-9_]+))(?:(?:\\.((?:[A-Za-z0-9_]+)))?))");var numr_f=function(m,wsb,wsa,last_op){var τp0;var radix;var int;var frac;if(((m instanceof Array)&&((m["#"]===(void 0))&&(((τp0=m.length),true)&&((τp0===4)&&(m[0],true,(radix=m[1]),true,(int=m[2]),true,(frac=m[3]),true)))))){false;}else{throw "a condition failed";}(value=parseInt(int.replace(RegExp("_","g"),""),radix));if(frac){(frac=frac.replace(RegExp("_","g"),""));(value=(value+(parseInt(frac,radix)/Math.pow(radix,frac.length))));}else{false;}return ["ID","NUM",value];};var num=RegExp("(?:^((?:[0-9_]+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:[0-9_]+)))?))");var num_f=function(m,wsb,wsa,last_op){return ["ID","NUM",parseFloat(m[0].replace(RegExp("_","g"),""))];};var str=RegExp("(?:^\"((?:(?:(?:\\\\\\\\|\\\\\")|[^\"])*))\")");var str_f=function(m,wsb,wsa,last_op){var repl=({"\\\"":"\"","\\\\":"\\","\\n":"\n"});var r=m[1].replace(RegExp("((?:(?:\\\\\"|\\\\\\\\)|\\\\n))","g"),function(m){return send(repl,m);});return ["ID","STR",r];};var op=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!#.:']+))");var op2=RegExp("(?:^[\\(\\[\\{\\}\\]\\),])");var op3=RegExp("(?:^(?:(?:(?:(?:(?:(?:(?:(?:(?:(?:with|where)|when)|and)|not)|or)|in)|instanceof)|mod)|each)|as)\\b)");var op4=RegExp("(?:^`((?:[A-Za-z0-9_]+))`)");var op_f=function(m,wsb,wsa,last_op,column){var op=(m[1]||m[0]);if((op==="|")){return ["INDENT",(column-1)];}else{if((op in special_ops)){var fixity=send(special_ops,op);var width=function(){var τ0=fixity;var other;if((τ0==="IFX")){if((wsb||wsa)){return "wide";}else{return "short";}}else{if((τ0==="SFX")){if(wsb){return "wide";}else{return "short";}}else{if((τ0==="PFX")){if(wsa){return "wide";}else{return "short";}}else{if(((other=τ0),true)){throw "OopsA";}else{throw ["Could not find a match",τ0];}}}}}();return ["OP",fixity,width,op];}else{if((wsa&&wsb)){return ["OP",function(){if(last_op){return "PFX";}else{return "IFX";}}(),"wide",op];}else{if(((!wsa)&&(!wsb))){return ["OP",function(){if(last_op){return "PFX";}else{return "IFX";}}(),"short",op];}else{if((wsa&&last_op)){return ["OP","PFX","wide",op];}else{if(wsa){return ["OP","SFX","short",op];}else{if(wsb){return ["OP","PFX","short",op];}else{if(true){return ["OP","PFX","short",op];}else{return false;}}}}}}}}};var indent=RegExp("(?:^(?:(?:\n((?: *)))+))");var indent_f=function(m,wsb,wsa,last_op){var ilen=m[1].length;return ["INDENT",ilen];};var cmnt=RegExp("(?:^;(?:[^\n]*))");var cmnt_f=function(m,wsb,wsa,last_op){return ["IGNORE"];};var unkn=RegExp("(?:^.)");var unkn_f=function(m,wsb,wsa,last_op){throw ("unknown character: "+m[0]);};return [[op3,op_f],[id,id_f],[numr,numr_f],[num,num_f],[str,str_f],[op,op_f],[op2,op_f],[op4,op_f],[indent,indent_f],[cmnt,cmnt_f],[unkn,unkn_f]];}();var ws_re=RegExp("(?:^(?: *)(?:(?:\n(?: *)\\\\(?: *))*))");var eol_re=RegExp("(?:^(?: *)(?:\n|$))");var indent_tracker=function(){var curr=false;var stack=[];var stacks=[stack];return function(τ2){var token;var τ1;(token=τ2);true;(τ1=τ2);var τ3=τ1;var τp0;var τp1;var τp2;var new_indent;var τ4;var τp0;var τp1;var stuff;var τp0;var τp1;var fixity;var width;var τp2;var τp0;var τp1;var fixity;var width;var τp2;var other;var τ5;var τ6;var τ7;var τ8;var τ9;if(((τ5=(τ3 instanceof Array))&&((τ6=(τ3["#"]===(void 0)))&&((τ7=((τp0=τ3.length),true))&&((τp0===2)&&(((τp1=τ3[0]),(τp1==="INDENT"))&&((τp2=τ3[1]),(new_indent=τp2),true,(τ4=τp2),true))))))){var τ10=τ4;if((curr===false)){(curr=new_indent);return [["OP","IFX","wide",","]];}else{if((τ10>curr)){send(stack.push(curr),(curr=new_indent));return [["OP","PFX","wide","["]];}else{if((τ10===curr)){return [["OP","IFX","wide",","]];}else{if((τ10<curr)){var rval=[];while(((stack.length>0)&&(new_indent<curr))){(curr=stack.pop());rval.push(["OP","SFX","wide","]"]);}rval.push(["OP","IFX","wide",","]);return rval;}else{throw ["Could not find a match",τ10];}}}}}else{if((τ7&&((τp0>=1)&&(((τp1=τ3[0]),(τp1==="ID"))&&((stuff=τ3.slice(1)),true))))){return [token];}else{if((τ7&&((τ8=(τp0===4))&&((τ9=((τp1=τ3[0]),(τp1==="OP")))&&((fixity=τ3[1]),true,(width=τ3[2]),true,(τp2=τ3[3]),((τp2==="[")||(τp2==="{"))))))){stack.push(curr);stacks.push(stack);(stack=[]);(curr=false);return [token];}else{if((τ9&&((fixity=τ3[1]),true,(width=τ3[2]),true,(τp2=τ3[3]),((τp2==="]")||(τp2==="}"))))){var rval=function(){var τ11=[];var τ12=stack;var τ13=τ12.length;for(var τ14=0;(τ14<τ13);(τ14++)){var τ15=τ12[τ14];var other;if(true){τ11.push(["OP","SFX","short","]"]);}else{if(((other=τ15),true)){false;}else{throw ["Could not find a match",τ15];}}}return τ11;}();(stack=stacks.pop());(curr=stack.pop());rval.push(token);return rval;}else{if(((other=τ3),true)){return [token];}else{throw ["Could not find a match",τ3];}}}}}};};var process_token=function(token,last_op,wsa,wsb,pos,endpos,accum){var τp0;var type;var result;if(((token instanceof Array)&&((token["#"]===(void 0))&&(((τp0=token.length),true)&&((τp0>=1)&&((type=token[0]),true,(result=token.slice(1)),true)))))){false;}else{throw "a condition failed";}var τ16=type;var other;if((τ16==="IGNORE")){return last_op;}else{if((τ16==="ID")){if((!last_op)){var w=["IFX",function(){if(wsb){return "wide";}else{return "short";}}(),"WHITE"];(w["location"]=[pos,pos]);accum.push(w);}else{false;}accum.push(result);return false;}else{if((τ16==="OP")){if(last_op){var v=["VOID"];(v["location"]=[pos,pos]);accum.push(v);}else{false;}var τ17=result[0];if((τ17==="IFX")){accum.push(result);return true;}else{if((τ17==="PFX")){if((!last_op)){var w=["IFX",function(){if(wsb){return "wide";}else{return "short";}}(),"WHITE"];(w["location"]=[pos,pos]);var v=["VOID"];(v["location"]=[pos,pos]);accum.push(w);accum.push(v);}else{false;}accum.push(result);return true;}else{if((τ17==="SFX")){accum.push(result);var v=["VOID"];(v["location"]=[endpos,endpos]);accum.push(v);return false;}else{throw ["Could not find a match",τ17];}}}}else{if(((other=τ16),true)){throw "OopsB";}else{throw ["Could not find a match",τ16];}}}}};var tokenize=function(text){var last_op=true;var results=[];var wsb=text.match(ws_re)[0].length;(text=text.slice(wsb));(pos=wsb);(column=0);var indent=indent_tracker();while(text){for(var i=0;(i<regexps.length);(++i)){var τp0;var τp1;var re;var fn;if((((τp0=send(regexps,i)),(τp0 instanceof Array))&&((τp0["#"]===(void 0))&&(((τp1=τp0.length),true)&&((τp1===2)&&((re=τp0[0]),true,(fn=τp0[1]),true)))))){false;}else{throw "a condition failed";}var m=text.match(re);if(m){var skip=m[0].length;var endpos=(pos+skip);(column=function(){var splits=m[0].split("\n");if((splits.length>1)){return send(splits,(splits.length-1)).length;}else{if(true){return (column+skip);}else{return false;}}}());(text=text.slice(skip));var wsa=text.match(ws_re)[0].length;var eol=(text.match(eol_re)&&true);var bwsb=(wsb>0);var bwsa=function(){if(eol){return bwsb;}else{return (wsa>0);}}();var token=fn(m,bwsb,bwsa,last_op,column);var tokens=indent(token);var τ18=tokens;var τ19=τ18.length;for(var τ20=0;(τ20<τ19);(τ20++)){var τ21=τ18[τ20];var x;var other;if(((x=τ21),true)){(last_op=process_token(x,last_op,bwsa,bwsb,pos,endpos,results));}else{if(((other=τ21),true)){false;}else{throw ["Could not find a match",τ21];}}}false;(text=text.slice(wsa));(column=(column+wsa));(wsb=wsa);(pos=(endpos+wsa));break;}else{false;}}}if(last_op){var v=["VOID"];(v["location"]=[pos,pos]);results.push(v);}else{false;}return results;};var MAX=(1/0);var order_map=({"IFX":({"wide":({",":[[15,1],[15,1]],"with":[[15,999],[15,10]],"each":[[15,11],[15,10]],"where":[[15,11],[15,10]],"!!":[[15,11],[15,10]],"|>":[[15,11],[15,10]],"->":[[15,11],[15,10]],"=>":[[15,11],[15,10]],"=":[[15,11],[15,10]],":=":[[15,11],[15,10]],"+=":[[15,11],[15,10]],"-=":[[15,11],[15,10]],"*=":[[15,11],[15,10]],"/=":[[15,11],[15,10]],"<<=":[[15,11],[15,10]],">>=":[[15,11],[15,10]],">>>=":[[15,11],[15,10]],"when":[[15,100],[15,101]],"||":[[15,110],[15,111]],"&&":[[15,120],[15,121]],"or":[[15,110],[15,111]],"and":[[15,120],[15,121]],"not":[[15,130],[15,131]],"==":[[15,200],[15,201]],"!=":[[15,200],[15,201]],">=":[[15,200],[15,201]],"<=":[[15,200],[15,201]],">":[[15,200],[15,201]],"<":[[15,200],[15,201]],"^.":[[15,400],[15,401]],"|.":[[15,410],[15,411]],"&.":[[15,420],[15,421]],"<<":[[1,500],[1,501]],">>":[[1,500],[1,501]],">>>":[[1,500],[1,501]],"+":[[1,550],[1,551]],"-":[[1,550],[1,551]],"*":[[1,560],[1,561]],"/":[[1,560],[1,561]],"mod":[[1,560],[1,561]],"**":[[1,571],[1,570]],"default":[[8,900],[4,901]],"WHITE":[[15,1000],[15,1001]],":":[[15,1001],[15,2]]}),"short":({"default":[[15,1800],[15,1801]],"WHITE":[[15,2000],[15,2001]],",":[[15,1],[15,1]],":":[[15,1001],[15,2]]})}),"PFX":({"wide":({"default":[[15,MAX],[15,900]],"when":[[15,MAX],[15,101]],"not":[[15,MAX],[15,131]],".":[[15,MAX],[15,3000]],"#":[[15,MAX],[15,3000]],"<>":[[15,MAX],[15,5]],"(":[[15,MAX],[15,1]],"[":[[15,MAX],[15,1]],"{":[[15,MAX],[15,1]]}),"short":({"default":[[15,MAX],[15,1901]],".":[[15,MAX],[15,3000]],"#":[[15,MAX],[15,3000]],"(":[[15,MAX],[15,1]],"[":[[15,MAX],[15,1]],"{":[[15,MAX],[15,1]]})}),"SFX":({"wide":({"default":[[15,901],[15,MAX]],")":[[15,1],[15,MAX]],"]":[[15,1],[15,MAX]],"}":[[15,1],[15,MAX]]}),"short":({"default":[[15,1900],[15,MAX]],")":[[15,1],[15,MAX]],"]":[[15,1],[15,MAX]],"}":[[15,1],[15,MAX]]})})});var DONE=(-1);var NONE=0;var LEFT=1;var RIGHT=2;var BOTH=3;var oparse=function(next,order,finalize){var between=finalize(next());var right_op=next();var stack=[];var left_op=null;var current=null;while(true){var o=function(){if(((!left_op)&&(!right_op))){return DONE;}else{if(true){return ((((!left_op)&&RIGHT)||((!right_op)&&LEFT))||order(left_op,right_op));}else{return false;}}}();var τ22=o;var other;if((τ22===DONE)){return between;}else{if((τ22===LEFT)){current.push(between);(between=finalize(current));var v=stack.pop();(left_op=v[0]);(current=v[1]);}else{if((τ22===RIGHT)){stack.push([left_op,current]);(left_op=right_op);(current=[[right_op],between]);(between=finalize(next()));(right_op=next());}else{if((τ22===BOTH)){current[0].push(right_op);current.push(between);(left_op=right_op);(between=finalize(next()));(right_op=next());}else{if((τ22===NONE)){throw ((("Undefined priority between "+left_op)+" and ")+right_op);}else{if(((other=τ22),true)){throw "OopsC";}else{throw ["Could not find a match",τ22];}}}}}}}};var consult=function(τ23){var τp0;var fixity;var width;var op;if(((τ23 instanceof Array)&&((τ23["#"]===(void 0))&&(((τp0=τ23.length),true)&&((τp0===3)&&((fixity=τ23[0]),true,(width=τ23[1]),true,(op=τ23[2]),true)))))){false;}else{throw "a condition failed";}var map=send(send(order_map,fixity),width);return (send(map,op)||map.default);};var order=function(o1,o2){var τp0;var τp1;var code1;var ord1;if((((τp0=consult(o1)[1]),(τp0 instanceof Array))&&((τp0["#"]===(void 0))&&(((τp1=τp0.length),true)&&((τp1===2)&&((code1=τp0[0]),true,(ord1=τp0[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var code2;var ord2;if((((τp0=consult(o2)[0]),(τp0 instanceof Array))&&((τp0["#"]===(void 0))&&(((τp1=τp0.length),true)&&((τp1===2)&&((code2=τp0[0]),true,(ord2=τp0[1]),true)))))){false;}else{throw "a condition failed";}if(((code1&code2)===0)){throw ["Cannot mix",o1,o2];}else{if((ord1>ord2)){return LEFT;}else{if((ord1<ord2)){return RIGHT;}else{if((ord1===ord2)){return BOTH;}else{return false;}}}}};var finalize=function(τ24){var τ25=τ24;var τp0;var τp1;var value;var τp0;var τp1;var value;var τp0;var τp1;var value;var τp0;var τp1;var τp0;var ops;var args;var other;var τ26;var τ27;var τ28;var τ29;if(((τ26=(τ25 instanceof Array))&&((τ27=(τ25["#"]===(void 0)))&&((τ28=((τp0=τ25.length),true))&&((τ29=(τp0===2))&&(((τp1=τ25[0]),(τp1==="ID"))&&((value=τ25[1]),true))))))){return value;}else{if((τ29&&(((τp1=τ25[0]),(τp1==="NUM"))&&((value=τ25[1]),true)))){return ["value",value];}else{if((τ29&&(((τp1=τ25[0]),(τp1==="STR"))&&((value=τ25[1]),true)))){return ["value",value];}else{if((τ28&&((τp0===1)&&((τp1=τ25[0]),(τp1==="VOID"))))){return null;}else{if((τ28&&((τp0>=1)&&((ops=τ25[0]),true,(args=τ25.slice(1)),true)))){(ops=function(){var τ40=[];var τ41=ops;var τ42=τ41.length;for(var τ43=0;(τ43<τ42);(τ43++)){var τ44=τ41[τ43];var o;var other;if(((o=τ44),true)){τ40.push(o[2]);}else{if(((other=τ44),true)){false;}else{throw ["Could not find a match",τ44];}}}return τ40;}());var op=ops[0];var τ30=[ops,args];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var f;var arg;var body;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var f;var body;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var target;var body;var τp0;var τp1;var τp2;var τp3;var τp0;var τp1;var τp2;var τp3;var τp0;var τp1;var τp2;var τp3;var τp0;var τp1;var τp2;var τ31;var other;var τ32;var τ33;var τ34;var τ35;var τ36;var τ37;var τ38;var τ39;if(((τ32=(τ30 instanceof Array))&&((τ33=(τ30["#"]===(void 0)))&&((τ34=((τp0=τ30.length),true))&&((τ35=(τp0===2))&&((τ36=((τp1=τ30[0]),(τp1 instanceof Array)))&&((τ37=(τp1["#"]===(void 0)))&&((τ38=((τp2=τp1.length),true))&&((τp2===2)&&(((τp3=τp1[0]),(τp3==="WHITE"))&&(((τp4=τp1[1]),(τp4===":"))&&(((τp5=τ30[1]),(τp5 instanceof Array))&&((τp5["#"]===(void 0))&&(((τp6=τp5.length),true)&&((τp6===3)&&((f=τp5[0]),true,(arg=τp5[1]),true,(body=τp5[2]),true)))))))))))))))){return ["send",f,["data",arg,body]];}else{if((τ38&&((τ39=(τp2===1))&&(((τp3=τp1[0]),(τp3===":"))&&(((τp4=τ30[1]),(τp4 instanceof Array))&&((τp4["#"]===(void 0))&&(((τp5=τp4.length),true)&&((τp5===2)&&((f=τp4[0]),true,(body=τp4[1]),true))))))))){return ["send",f,["data",body]];}else{if((τ39&&(((τp3=τp1[0]),(τp3==="with"))&&(((τp4=τ30[1]),(τp4 instanceof Array))&&((τp4["#"]===(void 0))&&(((τp5=τp4.length),true)&&((τp5===2)&&((target=τp4[0]),true,(body=τp4[1]),true)))))))){(body=function(){var τ49=body;var τp0;var τp1;var rest;var other;if(((τ49 instanceof Array)&&((τ49["#"]===(void 0))&&(((τp0=τ49.length),true)&&((τp0>=1)&&(((τp1=τ49[0]),(τp1==="multi"))&&((rest=τ49.slice(1)),true))))))){return rest;}else{if(((other=τ49),true)){return [body];}else{throw ["Could not find a match",τ49];}}}());var τ45=target;var τp0;var τp1;var f;var τp2;var τp3;var τp4;var args;var τp0;var τp1;var args;var other;var τ46;var τ47;var τ48;if((τ45===null)){return ["data"].concat(body);}else{if(((τ46=(τ45 instanceof Array))&&((τ47=(τ45["#"]===(void 0)))&&((τ48=((τp0=τ45.length),true))&&((τp0===3)&&(((τp1=τ45[0]),(τp1==="send"))&&(((f=τ45[1]),true,(τp2=τ45[2]),(τp2 instanceof Array))&&((τp2["#"]===(void 0))&&(((τp3=τp2.length),true)&&((τp3>=1)&&(((τp4=τp2[0]),(τp4==="data"))&&((args=τp2.slice(1)),true)))))))))))){return ["send",f,["data"].concat(args).concat(body)];}else{if((τ48&&((τp0>=1)&&(((τp1=τ45[0]),(τp1==="data"))&&((args=τ45.slice(1)),true))))){return target.concat(body);}else{if(((other=τ45),true)){return ["send",target,["data"].concat(body)];}else{throw ["Could not find a match",τ45];}}}}}else{if((τ38&&((τ39=(τp2>=1))&&(((τp3=τp1[0]),((τp3==="[")||(τp3===",")))&&(τp1.slice(1),true,τ30[1],true))))){if((op==="[")){(args=args.slice(1,(-1)));}else{false;}(args=function(){var f=function(x){return (x!==null);};return args.filter(f);}());var result=function(){var τ50=args;var τp0;var τp0;var x;var other;var τ51;var τ52;var τ53;if(((τ51=(τ50 instanceof Array))&&((τ52=(τ50["#"]===(void 0)))&&((τ53=((τp0=τ50.length),true))&&(τp0===0))))){return ["value",undefined];}else{if((τ53&&((τp0===1)&&((x=τ50[0]),true)))){return x;}else{if(((other=τ50),true)){return ["multi"].concat(args);}else{throw ["Could not find a match",τ50];}}}}();return result;}else{if((τ39&&(((τp3=τp1[0]),(τp3==="{"))&&(τp1.slice(1),true,τ30[1],true)))){var f=function(x){return (x!==null);};return ["data"].concat(args.slice(1,(-1)).filter(f));}else{if((τ38&&((τ39=(τp2===1))&&(((τp3=τp1[0]),(τp3==="WHITE"))&&(τ30[1],true))))){return ["send"].concat(args);}else{if((τ39&&(τp1[0],true,(τ31=τ30[1]),true))){var τ54=τ31;var τp0;var τp1;var τp2;var τp0;var a;var b;var τ55;var τ56;var τ57;var τ58;if(((τ55=(τ54 instanceof Array))&&((τ56=(τ54["#"]===(void 0)))&&((τ57=((τp0=τ54.length),true))&&((τ58=(τp0===2))&&(((τp1=τ54[0]),(τp1===null))&&((τp2=τ54[1]),(τp2===null)))))))){return op;}else{if((τ58&&((a=τ54[0]),true,(b=τ54[1]),true))){return ["send",op,["data",a,b]];}else{throw ["Could not find a match",τ54];}}}else{if(((other=τ30),true)){throw ["Unknown node",ops,args];}else{throw ["Could not find a match",τ30];}}}}}}}}}else{if(((other=τ25),true)){throw "OopsE";}else{throw ["Could not find a match",τ25];}}}}}}};var parse=function(text){var results=tokenize(text);var next=function(){return results.shift();};return oparse(next,order,finalize);};var libf=function(f){return ["symbol",f];};var Env=function(parent){var store=Object();var self=function(expr){return ["bind_env",self,expr];};(self["resolve"]=function(name){var attempt=send(store,name);if(attempt){return attempt;}else{if(true){return self.parent.resolve(name);}else{return false;}}});(self["register"]=function(name,value){return (store[name]=value);});(self["register_macro"]=function(name,m){return (store[name]=["macro",m]);});(self["fork"]=function(){return Env(self);});(self["parent"]=parent);(self["store"]=store);return self;};var js_contexts=({"js_for":["multi","multi","multi","multi"]});var expand=function(env,context,expr){(expr=expand.step(env,context,expr));var τ59=expr;var s;var τp0;var τp1;var s;var τp0;var τp1;var f;var arg;var τp0;var τp1;var v;var τp0;var τp1;var type;var args;var τp0;var τp1;var args;var τp0;var τp1;var args;var τp0;var τp1;var bindings;var body;var τp0;var τp1;var binding;var value;var τp0;var τp1;var lhs;var rhs;var τp0;var τp1;var type;var args;var τp0;var τp1;var expr;var other;var τ60;var τ61;var τ62;var τ63;if(((typeof(τ59)==="string")&&((s=τ59),true))){return s;}else{if(((τ59 instanceof Array)&&((τ59["#"]===(void 0))&&(((τp0=τ59.length),true)&&((τp0===2)&&(((τp1=τ59[0]),(τp1==="symbol"))&&((s=τ59[1]),true))))))){return s;}else{if((τ59===null)){return null;}else{if((τ59===(void 0))){throw "undefined? why?";}else{if(((τ60=(τ59 instanceof Array))&&((τ61=(τ59["#"]===(void 0)))&&((τ62=((τp0=τ59.length),true))&&((τp0===3)&&(((τp1=τ59[0]),(τp1==="send"))&&((f=τ59[1]),true,(arg=τ59[2]),true))))))){(f=expand(env,"head",f));return ["send",f,expand(env,"tail",arg)];}else{if((τ62&&((τp0===2)&&(((τp1=τ59[0]),(τp1==="value"))&&((v=τ59[1]),true))))){return expr;}else{if((τ62&&((τ63=(τp0>=1))&&(((τp1=τ59[0]),(type=τp1),true,((τp1==="array")||(τp1==="object")))&&((args=τ59.slice(1)),true))))){var arr=[];while((args.length>0)){var τ64=expand.step(env,type,args.shift());var τp0;var τp1;var stmts;var other;if(((τ64 instanceof Array)&&((τ64["#"]===(void 0))&&(((τp0=τ64.length),true)&&((τp0>=1)&&(((τp1=τ64[0]),(τp1==="splice"))&&((stmts=τ64.slice(1)),true))))))){(args=stmts.concat(args));}else{if(((other=τ64),true)){arr.push(other);}else{throw ["Could not find a match",τ64];}}}return [type].concat(function(){var τ65=[];var τ66=arr;var τ67=τ66.length;for(var τ68=0;(τ68<τ67);(τ68++)){var τ69=τ66[τ68];var x;var other;if(((x=τ69),true)){τ65.push(expand(env,type,x));}else{if(((other=τ69),true)){false;}else{throw ["Could not find a match",τ69];}}}return τ65;}());}else{if((τ63&&(((τp1=τ59[0]),(τp1==="multi"))&&((args=τ59.slice(1)),true)))){var arr=[];while((args.length>0)){var type=function(){if((args.length===1)){return "expr";}else{return "multi";}}();var τ70=expand.step(env,type,args.shift());var τp0;var τp1;var stmts;var other;if(((τ70 instanceof Array)&&((τ70["#"]===(void 0))&&(((τp0=τ70.length),true)&&((τp0>=1)&&(((τp1=τ70[0]),(τp1==="splice"))&&((stmts=τ70.slice(1)),true))))))){(args=stmts.concat(args));}else{if(((other=τ70),true)){arr.push([other,type]);}else{throw ["Could not find a match",τ70];}}}return ["multi"].concat(function(){var τ71=[];var τ72=arr;var τ73=τ72.length;for(var τ74=0;(τ74<τ73);(τ74++)){var τ75=τ72[τ74];var τp0;var x;var type;var other;if(((τ75 instanceof Array)&&((τ75["#"]===(void 0))&&(((τp0=τ75.length),true)&&((τp0===2)&&((x=τ75[0]),true,(type=τ75[1]),true)))))){τ71.push(expand(env,type,x));}else{if(((other=τ75),true)){false;}else{throw ["Could not find a match",τ75];}}}return τ71;}());}else{if((τ63&&(((τp1=τ59[0]),(τp1==="data"))&&((args=τ59.slice(1)),true)))){var is_obj=false;var obj=["object"];var arr=["array"];var parts=[];var newpart=function(){var τ76=arr;var τp0;var τp1;var other;if(((τ76 instanceof Array)&&((τ76["#"]===(void 0))&&(((τp0=τ76.length),true)&&((τp0===1)&&((τp1=τ76[0]),(τp1==="array"))))))){return false;}else{if(((other=τ76),true)){parts.push(arr);return (arr=["array"]);}else{throw ["Could not find a match",τ76];}}};while((args.length>0)){var τ77=expand.step(env,type,args.shift());var τp0;var τp1;var τp0;var τp1;var k;var v;var τp0;var τp1;var exprs;var τp0;var τp1;var expr;var other;var τ78;var τ79;var τ80;if(((τ78=(τ77 instanceof Array))&&((τ79=(τ77["#"]===(void 0)))&&((τ80=((τp0=τ77.length),true))&&((τp0===1)&&((τp1=τ77[0]),(τp1==="assoc"))))))){(is_obj=true);}else{if((τ80&&((τp0===3)&&(((τp1=τ77[0]),(τp1==="assoc"))&&((k=τ77[1]),true,(v=τ77[2]),true))))){(is_obj=true);obj.push(["array",k,v]);}else{if((τ80&&((τp0>=1)&&(((τp1=τ77[0]),(τp1==="splice"))&&((exprs=τ77.slice(1)),true))))){(args=exprs.concat(args));}else{if((τ80&&((τp0===2)&&(((τp1=τ77[0]),(τp1==="dynsplice"))&&((expr=τ77[1]),true))))){newpart();parts.push(expr);}else{if(((other=τ77),true)){arr.push(other);}else{throw ["Could not find a match",τ77];}}}}}}newpart();var r=function(){var τ81=parts;var τp0;var τp0;var τp0;var τp1;var arr;var τp2;var τp3;var things;var other;var τ82;var τ83;var τ84;var τ85;if(((τ82=(τ81 instanceof Array))&&((τ83=(τ81["#"]===(void 0)))&&((τ84=((τp0=τ81.length),true))&&((τ85=(τp0===0))&&is_obj))))){return obj;}else{if(τ85){return ["array"];}else{if((τ84&&((τp0===1)&&(((τp1=τ81[0]),(arr=τp1),true,(τp1 instanceof Array))&&((τp1["#"]===(void 0))&&(((τp2=τp1.length),true)&&((τp2>=1)&&(((τp3=τp1[0]),(τp3==="array"))&&((things=τp1.slice(1)),true))))))))){if(is_obj){arr.push(obj);}else{false;}return arr;}else{if(((other=τ81),true)){if(is_obj){parts.push(["array",obj]);}else{false;}var patch=libf("patch_array");return ["send",patch,["array"].concat(parts)];}else{throw ["Could not find a match",τ81];}}}}}();return expand(env,context,r);}else{if((τ62&&((τ63=(τp0===3))&&(((τp1=τ59[0]),(τp1==="lambda"))&&((bindings=τ59[1]),true,(body=τ59[2]),true))))){return ["lambda",function(){var τ86=[];var τ87=bindings;var τ88=τ87.length;for(var τ89=0;(τ89<τ88);(τ89++)){var τ90=τ87[τ89];var x;var other;if(((x=τ90),true)){τ86.push(expand(env,"decl",x));}else{if(((other=τ90),true)){false;}else{throw ["Could not find a match",τ90];}}}return τ86;}(),expand(env,"expr",body)];}else{if((τ63&&(((τp1=τ59[0]),(τp1==="declare"))&&((binding=τ59[1]),true,(value=τ59[2]),true)))){return ["declare",expand(env,"decl",binding),expand(env,"expr",value)];}else{if((τ63&&(((τp1=τ59[0]),(τp1==="assign"))&&((lhs=τ59[1]),true,(rhs=τ59[2]),true)))){return ["assign",expand(env,"decl",lhs),expand(env,"expr",rhs)];}else{if((τ62&&((τp0>=1)&&(((τp1=τ59[0]),(type=τp1),true,((((((((τp1==="js_while")||(τp1==="js_for"))||(τp1==="js_break"))||(τp1==="js_continue"))||(τp1==="js_return"))||(τp1==="js_throw"))||(τp1==="js_try"))||(τp1==="if")))&&((args=τ59.slice(1)),true))))){var ctxs=(send(js_contexts,type)||[]);var f=function(x,i){return expand(env,(send(ctxs,i)||"expr"),x);};return [type].concat(args.map(f));}else{if((τ62&&((τp0===2)&&(((τp1=τ59[0]),(τp1==="done"))&&((expr=τ59[1]),true))))){return expr;}else{if(((other=τ59),true)){throw ["Oops",expr,context];}else{throw ["Could not find a match",τ59];}}}}}}}}}}}}}}}};(expand["step"]=function(env,context,τ92){var expr;var τ91;(expr=τ92);true;(τ91=τ92);var τ93=τ91;var τ94;var τ95;var s;var s;var τp0;var τp1;var m;var τp0;var τp1;var m;var τp0;var τp1;var f;var arg;var τp0;var type;var args;var other;var τ96;var τ97;var τ98;var τ99;var τ100;if((((typeof(τ93)==="string")&&((s=τ93),true))||((τ93 instanceof Array)&&((τ93["#"]===(void 0))&&(((τ94=τ93.length),true)&&((τ94===2)&&(((τ95=τ93[0]),(τ95==="symbol"))&&((s=τ93[1]),true)))))))){var v=env.resolve(s);var τ101=[v,context];var τp0;var τp1;var τp0;var τp1;var τp2;var τp3;var m;var τp4;var τp0;var τp1;var τp2;var τp3;var m;var other;var τ102;var τ103;var τ104;var τ105;var τ106;var τ107;var τ108;var τ109;var τ110;if(((τ102=(τ101 instanceof Array))&&((τ103=(τ101["#"]===(void 0)))&&((τ104=((τp0=τ101.length),true))&&((τ105=(τp0===2))&&(((τp1=τ101[0]),(τp1===(void 0)))&&(τ101[1],true))))))){return s;}else{if((τ105&&((τ106=((τp1=τ101[0]),(τp1 instanceof Array)))&&((τ107=(τp1["#"]===(void 0)))&&((τ108=((τp2=τp1.length),true))&&((τ109=(τp2===2))&&((τ110=((τp3=τp1[0]),(τp3==="macro")))&&((m=τp1[1]),true,(τp4=τ101[1]),(τp4==="head"))))))))){return v;}else{if((τ110&&((m=τp1[1]),true,τ101[1],true))){return expand.step(env,context,m(env,context,null));}else{if(((other=τ101),true)){return v;}else{throw ["Could not find a match",τ101];}}}}}else{if((τ93===null)){return null;}else{if((τ93===(void 0))){throw "undefined? why?";}else{if(((τ96=(τ93 instanceof Array))&&((τ97=(τ93["#"]===(void 0)))&&((τ98=((τp0=τ93.length),true))&&((τ99=(τp0===2))&&((τ100=((τp1=τ93[0]),(τp1==="macro")))&&((m=τ93[1]),true,(context==="head")))))))){return expr;}else{if((τ100&&((m=τ93[1]),true,true))){return expand.step(env,context,m(env,context,null));}else{if((τ98&&((τp0===3)&&(((τp1=τ93[0]),(τp1==="send"))&&((f=τ93[1]),true,(arg=τ93[2]),true))))){var τ111=expand.step(env,"head",f);var τp0;var τp1;var m;var other;if(((τ111 instanceof Array)&&((τ111["#"]===(void 0))&&(((τp0=τ111.length),true)&&((τp0===2)&&(((τp1=τ111[0]),(τp1==="macro"))&&((m=τ111[1]),true))))))){return expand.step(env,context,m(env,context,arg));}else{if(((other=τ111),true)){return expr;}else{throw ["Could not find a match",τ111];}}}else{if((τ98&&((τp0>=1)&&((type=τ93[0]),true,(args=τ93.slice(1)),true)))){return expr;}else{if(((other=τ93),true)){throw ["Oops2",expr];}else{throw ["Could not find a match",τ93];}}}}}}}}});var aslist=function(τ112){var τ113=τ112;var τp0;var τp1;var args;var other;if((τ113===null)){return [null];}else{if((τ113===(void 0))){return [undefined];}else{if(((τ113 instanceof Array)&&((τ113["#"]===(void 0))&&(((τp0=τ113.length),true)&&((τp0>=1)&&(((τp1=τ113[0]),(τp1==="multi"))&&((args=τ113.slice(1)),true))))))){return args;}else{if(((other=τ113),true)){return [other];}else{throw ["Could not find a match",τ113];}}}}};var nullenv=({"resolve":function(x){return undefined;}});var stdenv=Env(nullenv);stdenv.register("+","___plus");stdenv.register("-","___minus");stdenv.register("*","___times");stdenv.register("/","___div");stdenv.register("%","___mod");stdenv.register("^","___binxor");stdenv.register("&","___binand");stdenv.register("|","___binor");stdenv.register("~","___binnot");stdenv.register("&&","___and");stdenv.register("||","___or");stdenv.register("and","___and");stdenv.register("or","___or");stdenv.register("not","___not");stdenv.register("===","___is");stdenv.register("!==","___isnt");stdenv.register("!=","___neq");stdenv.register("<","___lt");stdenv.register(">","___gt");stdenv.register("<=","___lte");stdenv.register(">=","___gte");stdenv.register("<<","___shl");stdenv.register(">>","___shr");stdenv.register(">>>","___shr2");stdenv.register("in","___in");stdenv.register("instanceof","___instanceof");stdenv.register("++","___plusplus");stdenv.register("--","___minusminus");var make_checker=function(value,op){return function(env,context,expr){return ["send",op,["data",expr[1],value]];};};stdenv.register_macro("**",function(env,context,τ114){var τp0;var τp1;var a;var b;if(((τ114 instanceof Array)&&((τ114["#"]===(void 0))&&(((τp0=τ114.length),true)&&((τp0===3)&&(((τp1=τ114[0]),(τp1==="data"))&&((a=τ114[1]),true,(b=τ114[2]),true))))))){false;}else{throw "a condition failed";}return ["send",["send","Math",["value","pow"]],["data",a,b]];});stdenv.register_macro("//",function(env,context,τ115){var τp0;var τp1;var a;var b;if(((τ115 instanceof Array)&&((τ115["#"]===(void 0))&&(((τp0=τ115.length),true)&&((τp0===3)&&(((τp1=τ115[0]),(τp1==="data"))&&((a=τ115[1]),true,(b=τ115[2]),true))))))){false;}else{throw "a condition failed";}var div=["send","___div",["data",a,b]];return ["send",["send","Math",["value","floor"]],["data",div]];});stdenv.register_macro("<>",function(env,context,τ116){var τp0;var τp1;var τp2;var x;if(((τ116 instanceof Array)&&((τ116["#"]===(void 0))&&(((τp0=τ116.length),true)&&((τp0===3)&&(((τp1=τ116[0]),(τp1==="data"))&&(((τp2=τ116[1]),(τp2===null))&&((x=τ116[2]),true)))))))){false;}else{throw "a condition failed";}return ["send",libf("pr"),["data",x]];});stdenv.register_macro("#",function(env,context,τ117){var τp0;var τp1;var τp2;var tag;if(((τ117 instanceof Array)&&((τ117["#"]===(void 0))&&(((τp0=τ117.length),true)&&((τp0===3)&&(((τp1=τ117[0]),(τp1==="data"))&&(((τp2=τ117[1]),(τp2===null))&&((tag=τ117[2]),true)))))))){false;}else{throw "a condition failed";}(tag=["value",tag]);var f=function(env,τ118,expr){var τ119=τ118;if((τ119==="pattern")){var checker_mac=function(){var f=function(env,context,expr){return ["send","___eq",["data",["send",expr[1],["value","#"]],tag]];};return ["macro",f];}();var τ120=expr;var τp0;var τp1;var subp;var other;if(((τ120 instanceof Array)&&((τ120["#"]===(void 0))&&(((τp0=τ120.length),true)&&((τp0>=1)&&(((τp1=τ120[0]),(τp1==="data"))&&((subp=τ120.slice(1)),true))))))){var deconstructor_mac=function(){var f=function(env,context,expr){return ["data",["value",true],expr[1]];};return ["macro",f];}();return ["check",checker_mac,["project",deconstructor_mac,["duck"].concat(subp)]];}else{if(((other=τ120),true)){return ["check",checker_mac,(expr||["ignore"])];}else{throw ["Could not find a match",τ120];}}}else{if(true){var τ121=expr;var τp0;var τp1;var args;var other;if((τ121===null)){var d=["data",tag];return ["send",libf("StructFactory"),d];}else{if(((τ121 instanceof Array)&&((τ121["#"]===(void 0))&&(((τp0=τ121.length),true)&&((τp0>=1)&&(((τp1=τ121[0]),(τp1==="data"))&&((args=τ121.slice(1)),true))))))){var d=["data",tag].concat(args);return ["send",libf("Struct"),d];}else{if(((other=τ121),true)){var factory=function(){var d=["data",tag];return ["send",libf("StructFactory"),d];}();return ["send",factory,other];}else{throw ["Could not find a match",τ121];}}}}else{throw ["Could not find a match",τ119];}}};return ["macro",f];});stdenv.register_macro("when",function(env,context,τ123){var τp0;var τp1;var τ122;var condition;if(((τ123 instanceof Array)&&((τ123["#"]===(void 0))&&(((τp0=τ123.length),true)&&((τp0===3)&&(((τp1=τ123[0]),(τp1==="data"))&&((τ122=τ123[1]),true,(condition=τ123[2]),true))))))){false;}else{throw "a condition failed";}var τ124=τ122;var other;if((τ124===null)){return ["test",condition,["ignore"]];}else{if(((other=τ124),true)){return ["test",condition,other];}else{throw ["Could not find a match",τ124];}}});var andf=function(env,context,expr){var τ125=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var a;var b;var τp0;var τp1;var other;var τ126;var τ127;var τ128;var τ129;if(((τ126=(τ125 instanceof Array))&&((τ127=(τ125["#"]===(void 0)))&&((τ128=((τp0=τ125.length),true))&&((τ129=(τp0===2))&&(((τp1=τ125[0]),(τp1==="pattern"))&&(((τp2=τ125[1]),(τp2 instanceof Array))&&((τp2["#"]===(void 0))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((a=τp2[1]),true,(b=τp2[2]),true)))))))))))){return ["all",a,b];}else{if((τ129&&(τ125[0],true,(τp1=τ125[1]),(τp1===null)))){return "___and";}else{if(((other=τ125),true)){return ["send","___and",expr];}else{throw ["Could not find a match",τ125];}}}};stdenv.register_macro("&&",andf);stdenv.register_macro("and",andf);var orf=function(env,context,expr){var τ130=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var a;var b;var τp0;var τp1;var other;var τ131;var τ132;var τ133;var τ134;if(((τ131=(τ130 instanceof Array))&&((τ132=(τ130["#"]===(void 0)))&&((τ133=((τp0=τ130.length),true))&&((τ134=(τp0===2))&&(((τp1=τ130[0]),(τp1==="pattern"))&&(((τp2=τ130[1]),(τp2 instanceof Array))&&((τp2["#"]===(void 0))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((a=τp2[1]),true,(b=τp2[2]),true)))))))))))){return ["any",a,b];}else{if((τ134&&(τ130[0],true,(τp1=τ130[1]),(τp1===null)))){return "___or";}else{if(((other=τ130),true)){return ["send","___or",expr];}else{throw ["Could not find a match",τ130];}}}};stdenv.register_macro("||",orf);stdenv.register_macro("or",orf);var partial_pattern=function(operator){return function(env,context,expr){var τ135=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var val;var τp0;var τp1;var other;var τ136;var τ137;var τ138;var τ139;if(((τ136=(τ135 instanceof Array))&&((τ137=(τ135["#"]===(void 0)))&&((τ138=((τp0=τ135.length),true))&&((τ139=(τp0===2))&&(((τp1=τ135[0]),(τp1==="pattern"))&&(((τp2=τ135[1]),(τp2 instanceof Array))&&((τp2["#"]===(void 0))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&(((τp5=τp2[1]),(τp5===null))&&((val=τp2[2]),true))))))))))))){return ["check",["macro",make_checker(val,operator)],["ignore"]];}else{if((τ139&&(τ135[0],true,(τp1=τ135[1]),(τp1===null)))){return operator;}else{if(((other=τ135),true)){return ["send",operator,expr];}else{throw ["Could not find a match",τ135];}}}};};stdenv.register_macro("==",partial_pattern("___eq"));stdenv.register_macro("!=",partial_pattern("___neq"));stdenv.register_macro("<=",partial_pattern("___leq"));stdenv.register_macro(">=",partial_pattern("___geq"));stdenv.register_macro("<",partial_pattern("___lt"));stdenv.register_macro(">",partial_pattern("___gt"));stdenv.register_macro("*",function(env,context,expr){var τ140=[context,expr];var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var τp3;var τp4;var val;var τp5;var τp0;var τp1;var other;var τ141;var τ142;var τ143;var τ144;if(((τ141=(τ140 instanceof Array))&&((τ142=(τ140["#"]===(void 0)))&&((τ143=((τp0=τ140.length),true))&&((τ144=(τp0===2))&&(((τp1=τ140[0]),(τp1==="pattern"))&&((τp2=τ140[1]),(τp2===null)))))))){return ["dynsplice",["ignore"]];}else{if((τ144&&(((τp1=τ140[0]),((τp1==="pattern")||(τp1==="data")))&&(((τp2=τ140[1]),(τp2 instanceof Array))&&((τp2["#"]===(void 0))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((val=τp2[1]),true,(τp5=τp2[2]),(τp5===null)))))))))){return ["dynsplice",val];}else{if((τ144&&(τ140[0],true,(τp1=τ140[1]),(τp1===null)))){return "___times";}else{if(((other=τ140),true)){return ["send","___times",expr];}else{throw ["Could not find a match",τ140];}}}}});stdenv.register_macro(".",function(env,context,τ145){var τ146=τ145;var τp0;var τp1;var τp2;var τp3;var τ147;var τ148;var s;var s;var other;if(((τ146 instanceof Array)&&((τ146["#"]===(void 0))&&(((τp0=τ146.length),true)&&((τp0===3)&&(((τp1=τ146[0]),(τp1==="data"))&&(((τp2=τ146[1]),(τp2===null))&&((τp3=τ146[2]),(((typeof(τp3)==="string")&&((s=τp3),true))||((τp3 instanceof Array)&&((τp3["#"]===(void 0))&&(((τ147=τp3.length),true)&&((τ147===2)&&(((τ148=τp3[0]),(τ148==="symbol"))&&((s=τp3[1]),true))))))))))))))){return ["value",s];}else{if(((other=τ146),true)){throw ["invalid",other];}else{throw ["Could not find a match",τ146];}}});stdenv.register_macro("where",function(env,context,τ149){var τp0;var τp1;var a;var b;if(((τ149 instanceof Array)&&((τ149["#"]===(void 0))&&(((τp0=τ149.length),true)&&((τp0===3)&&(((τp1=τ149[0]),(τp1==="data"))&&((a=τ149[1]),true,(b=τ149[2]),true))))))){false;}else{throw "a condition failed";}return ["send","let",["data",b,a]];});stdenv.register_macro("let",function(env,context,τ150){var τp0;var τp1;var a;var b;if(((τ150 instanceof Array)&&((τ150["#"]===(void 0))&&(((τp0=τ150.length),true)&&((τp0===3)&&(((τp1=τ150[0]),(τp1==="data"))&&((a=τ150[1]),true,(b=τ150[2]),true))))))){false;}else{throw "a condition failed";}var bindings=aslist(a);var body=aslist(b);return ["multi"].concat(bindings).concat(body);});stdenv.register_macro("->",function(env,context,τ151){var τp0;var τp1;var args;var stmts;if(((τ151 instanceof Array)&&((τ151["#"]===(void 0))&&(((τp0=τ151.length),true)&&((τp0===3)&&(((τp1=τ151[0]),(τp1==="data"))&&((args=τ151[1]),true,(stmts=τ151[2]),true))))))){false;}else{throw "a condition failed";}var body=["multi"];var τp0;var τp1;var placeholder;var newargs;if((((τp0=find_arrow(args)),(τp0 instanceof Array))&&((τp0["#"]===(void 0))&&(((τp1=τp0.length),true)&&((τp1===2)&&((placeholder=τp0[0]),true,(newargs=τp0[1]),true)))))){false;}else{throw "a condition failed";}(newargs=function(){var τ152=[];var τ153=newargs.slice(1);var τ154=τ153.length;for(var τ155=0;(τ155<τ154);(τ155++)){var τ156=τ153[τ155];var s;var τp0;var τp1;var s;var other;var other;var τ157;if(((typeof(τ156)==="string")&&((s=τ156),true))){τ152.push(s);}else{if(((τ156 instanceof Array)&&((τ156["#"]===(void 0))&&(((τp0=τ156.length),true)&&((τp0===2)&&(((τp1=τ156[0]),(τp1==="symbol"))&&((s=τ156[1]),true))))))){τ152.push(s);}else{if((τ157=((other=τ156),true))){τ152.push(function(){var t=gensym();body.push(["send","=",["data",other,t]]);return t;}());}else{if(τ157){false;}else{throw ["Could not find a match",τ156];}}}}}return τ152;}());body.push(function(){if(placeholder){return ["send","|>",["data",placeholder,stmts]];}else{if(true){return stmts;}else{return false;}}}());return ["lambda",newargs,body];});stdenv.register_macro("each",function(env,τ158,τ159){var τp0;var τp1;var arr;var patterns;if(((τ159 instanceof Array)&&((τ159["#"]===(void 0))&&(((τp0=τ159.length),true)&&((τp0===3)&&(((τp1=τ159[0]),(τp1==="data"))&&((arr=τ159[1]),true,(patterns=τ159[2]),true))))))){false;}else{throw "a condition failed";}var τ160=τ158;var other;if((τ160==="multi")){var temp=gensym();var len=gensym();var stmts=["multi",["send","=",["data",temp,arr]],["send","=",["data",len,["send",temp,["send",".",["data",null,"length"]]]]]];(patterns=aslist(patterns));patterns.push(["send","->",["data","other","false"]]);var lvar=gensym();var loop=function(){var a=["send","=",["data",lvar,["value",0]]];var b=["send","<",["data",lvar,len]];var c=["send","++",["data",lvar,null]];var body=["send","|>",["data",["send","___js_fetch",["data",temp,lvar]],patch_array(["multi"],patterns)]];return ["js_for",a,b,c,body];}();stmts.push(loop);stmts.push(["value",false]);return stmts;}else{if(((other=τ160),true)){var res=gensym();var temp=gensym();var len=gensym();var stmts=["multi",["send","=",["data",res,["data"]]],["send","=",["data",temp,arr]],["send","=",["data",len,["send",temp,["send",".",["data",null,"length"]]]]]];(patterns=function(){var τ161=[];var τ162=aslist(patterns);var τ163=τ162.length;for(var τ164=0;(τ164<τ163);(τ164++)){var τ165=τ162[τ164];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var patt;var expr;var other;var other;var τ166;if(((τ165 instanceof Array)&&((τ165["#"]===(void 0))&&(((τp0=τ165.length),true)&&((τp0===3)&&(((τp1=τ165[0]),(τp1==="send"))&&(((τp2=τ165[1]),(τp2==="->"))&&(((τp3=τ165[2]),(τp3 instanceof Array))&&((τp3["#"]===(void 0))&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&((patt=τp3[1]),true,(expr=τp3[2]),true))))))))))))){τ161.push(["send","->",["data",patt,["send",["send",res,["send",".",["data",null,"push"]]],["data",expr]]]]);}else{if((τ166=((other=τ165),true))){τ161.push(INVALID_PATTERN);}else{if(τ166){false;}else{throw ["Could not find a match",τ165];}}}}return τ161;}());patterns.push(["send","->",["data","other","false"]]);var lvar=gensym();var loop=function(){var a=["send","=",["data",lvar,["value",0]]];var b=["send","<",["data",lvar,len]];var c=["send","++",["data",lvar,null]];var body=["send","|>",["data",["send","___js_fetch",["data",temp,lvar]],patch_array(["multi"],patterns)]];return ["js_for",a,b,c,body];}();stmts.push(loop);stmts.push(res);return stmts;}else{throw ["Could not find a match",τ160];}}});stdenv.register_macro("=>",function(env,context,τ167){var τp0;var τp1;var binding;var value;if(((τ167 instanceof Array)&&((τ167["#"]===(void 0))&&(((τp0=τ167.length),true)&&((τp0===3)&&(((τp1=τ167[0]),(τp1==="data"))&&((binding=τ167[1]),true,(value=τ167[2]),true))))))){false;}else{throw "a condition failed";}if((context==="data")){return ["assoc",binding,value];}else{if(true){throw (("Illegal context for '=>' ("+context)+")");}else{return false;}}});stdenv.register_macro("=",function(env,context,expr){var τ168=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var lhs;var rhs;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var f;var τp8;var τp9;var τp10;var args;var value;var τp0;var τp1;var τp2;var τp3;var τp4;var binding;var value;var other;var τ169;var τ170;var τ171;var τ172;var τ173;var τ174;var τ175;var τ176;var τ177;var τ178;if(((τ169=(τ168 instanceof Array))&&((τ170=(τ168["#"]===(void 0)))&&((τ171=((τp0=τ168.length),true))&&((τ172=(τp0===2))&&(((τp1=τ168[0]),((τp1==="multi")||(τp1==="expr")))&&(((τp2=τ168[1]),(τp2 instanceof Array))&&((τp2["#"]===(void 0))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((lhs=τp2[1]),true,(rhs=τp2[2]),true)))))))))))){var p=parse_lhs(env,lhs,rhs);var vars=make_declarations(p[0]);var r=["splice"].concat(vars);var clauses=p[1];var mkif=function(x){return ["if",x,["value",false],["js_throw",["value","a condition failed"]]];};var τ179=clauses;var τp0;var clause;if(((τ179 instanceof Array)&&((τ179["#"]===(void 0))&&(((τp0=τ179.length),true)&&((τp0===1)&&((clause=τ179[0]),true)))))){var τ180=send(clause,(clause.length-1));var τp0;var τp1;var τp2;var other;if(((τ180 instanceof Array)&&((τ180["#"]===(void 0))&&(((τp0=τ180.length),true)&&((τp0===2)&&(((τp1=τ180[0]),(τp1==="value"))&&((τp2=τ180[1]),(τp2===true)))))))){if(((vars.length===1)&&(clause.length===3))){(r=["declare"].concat(clause[1].slice(1)));}else{if(true){(r=r.concat(clause.slice(1,(-1))));}else{false;}}}else{if(((other=τ180),true)){r.push(mkif(clause));}else{throw ["Could not find a match",τ180];}}}else{if(true){var ands=make_pattern_test(clauses);r.push(mkif(ands));}else{throw ["Could not find a match",τ179];}}return r;}else{if((τ172&&((τ173=((τp1=τ168[0]),(τp1==="data")))&&((τp2=τ168[1]),(τp2===null))))){return ["assoc"];}else{if((τ173&&((τ174=((τp2=τ168[1]),(τp2 instanceof Array)))&&((τ175=(τp2["#"]===(void 0)))&&((τ176=((τp3=τp2.length),true))&&((τ177=(τp3===3))&&((τ178=((τp4=τp2[0]),(τp4==="data")))&&(((τp5=τp2[1]),(τp5 instanceof Array))&&((τp5["#"]===(void 0))&&(((τp6=τp5.length),true)&&((τp6===3)&&(((τp7=τp5[0]),(τp7==="send"))&&(((f=τp5[1]),true,(τp8=τp5[2]),(τp8 instanceof Array))&&((τp8["#"]===(void 0))&&(((τp9=τp8.length),true)&&((τp9>=1)&&(((τp10=τp8[0]),(τp10==="data"))&&((args=τp8.slice(1)),true,(value=τp2[2]),true)))))))))))))))))){return ["assoc",["value",f],["lambda",args,value]];}else{if((τ178&&((binding=τp2[1]),true,(value=τp2[2]),true))){return ["assoc",["value",binding],value];}else{if(((other=τ168),true)){throw (("Illegal context for '=' ("+context)+")");}else{throw ["Could not find a match",τ168];}}}}}});var make_assigner=function(op){return function(env,context,τ181){var τp0;var τp1;var a;var b;if(((τ181 instanceof Array)&&((τ181["#"]===(void 0))&&(((τp0=τ181.length),true)&&((τp0===3)&&(((τp1=τ181[0]),(τp1==="data"))&&((a=τ181[1]),true,(b=τ181[2]),true))))))){false;}else{throw "a condition failed";}return ["assign",a,["send",op,["data",a,b]]];};};stdenv.register_macro(":=",function(env,context,τ182){var τp0;var τp1;var a;var b;if(((τ182 instanceof Array)&&((τ182["#"]===(void 0))&&(((τp0=τ182.length),true)&&((τp0===3)&&(((τp1=τ182[0]),(τp1==="data"))&&((a=τ182[1]),true,(b=τ182[2]),true))))))){false;}else{throw "a condition failed";}return ["assign",a,b];});stdenv.register_macro("+=",make_assigner("+"));stdenv.register_macro("-=",make_assigner("-"));stdenv.register_macro("*=",make_assigner("*"));stdenv.register_macro("/=",make_assigner("/"));stdenv.register_macro("<<=",make_assigner("<<"));stdenv.register_macro(">>=",make_assigner(">>"));stdenv.register_macro(">>>=",make_assigner(">>>"));stdenv.register_macro("if",function(env,context,τ183){var τp0;var τp1;var test;var a;var b;if(((τ183 instanceof Array)&&((τ183["#"]===(void 0))&&(((τp0=τ183.length),true)&&((τp0===4)&&(((τp1=τ183[0]),(τp1==="data"))&&((test=τ183[1]),true,(a=τ183[2]),true,(b=τ183[3]),true))))))){false;}else{throw "a condition failed";}return ["if",test,a,b];});stdenv.register_macro("cond",function(env,context,τ184){var τp0;var τp1;var clauses;if(((τ184 instanceof Array)&&((τ184["#"]===(void 0))&&(((τp0=τ184.length),true)&&((τp0===2)&&(((τp1=τ184[0]),(τp1==="data"))&&((clauses=τ184[1]),true))))))){false;}else{throw "a condition failed";}var handle=function(xs){var τ185=xs;var τp0;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var test;var body;var rest;var τ186;var τ187;var τ188;if(((τ186=(τ185 instanceof Array))&&((τ187=(τ185["#"]===(void 0)))&&((τ188=((τp0=τ185.length),true))&&(τp0===0))))){return ["value",false];}else{if((τ188&&((τp0>=1)&&(((τp1=τ185[0]),(τp1 instanceof Array))&&((τp1["#"]===(void 0))&&(((τp2=τp1.length),true)&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((τp4=τp1[1]),(τp4==="=>"))&&(((τp5=τp1[2]),(τp5 instanceof Array))&&((τp5["#"]===(void 0))&&(((τp6=τp5.length),true)&&((τp6===3)&&(((τp7=τp5[0]),(τp7==="data"))&&((test=τp5[1]),true,(body=τp5[2]),true,(rest=τ185.slice(1)),true))))))))))))))){(test=function(){var τ189=test;if((τ189==="else")){return ["value",true];}else{if(true){return test;}else{throw ["Could not find a match",τ189];}}}());return ["if",test,body,handle(rest)];}else{throw ["Could not find a match",τ185];}}};return handle(aslist(clauses));});stdenv.register_macro("while",function(env,context,expr){var τp0;var τp1;var test;var body;if(((expr instanceof Array)&&((expr["#"]===(void 0))&&(((τp0=expr.length),true)&&((τp0===3)&&(((τp1=expr[0]),(τp1==="data"))&&((test=expr[1]),true,(body=expr[2]),true))))))){false;}else{throw "a condition failed";}return ["js_while",test,body];});stdenv.register_macro("for",function(env,context,expr){var τp0;var τp1;var τp2;var τp3;var τp4;var a;var b;var c;var body;if(((expr instanceof Array)&&((expr["#"]===(void 0))&&(((τp0=expr.length),true)&&((τp0===3)&&(((τp1=expr[0]),(τp1==="data"))&&(((τp2=expr[1]),(τp2 instanceof Array))&&((τp2["#"]===(void 0))&&(((τp3=τp2.length),true)&&((τp3===4)&&(((τp4=τp2[0]),(τp4==="multi"))&&((a=τp2[1]),true,(b=τp2[2]),true,(c=τp2[3]),true,(body=expr[2]),true)))))))))))){false;}else{throw "a condition failed";}return ["js_for",a,b,c,body];});stdenv.register_macro("!!",function(env,context,τ190){var τp0;var τp1;var expr;var matchers;if(((τ190 instanceof Array)&&((τ190["#"]===(void 0))&&(((τp0=τ190.length),true)&&((τp0===3)&&(((τp1=τ190[0]),(τp1==="data"))&&((expr=τ190[1]),true,(matchers=τ190[2]),true))))))){false;}else{throw "a condition failed";}var excv=gensym();var res=gensym();var m=function(){var τ191=aslist(matchers);var ms;var τp0;var τp1;var τp2;var τp3;var τp4;var x;if((((ms=τ191),true,(τ191 instanceof Array))&&((τ191["#"]===(void 0))&&(((τp0=τ191.length),true)&&((τp0>=1)&&(((τp1=τ191[0]),(τp1 instanceof Array))&&((τp1["#"]===(void 0))&&(((τp2=τp1.length),true)&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((τp4=τp1[1]),(τp4==="->"))&&(τp1[2],true,τ191.slice(1),true)))))))))))){ms.push(["send","->",["data","___exc",["send","throw","___exc"]]]);return ["send","|>",["data",excv,patch_array(["multi"],ms)]];}else{if(((x=τ191),true)){return matchers;}else{throw ["Could not find a match",τ191];}}}();var f=["send","->",["data",["data",excv],["send",":=",["data",res,m]]]];return ["multi",["declare",res,["value",undefined]],["js_try",["assign",res,expr],f,null],res];});stdenv.register_macro("return",function(env,context,expr){return ["js_return",expr];});stdenv.register_macro("throw",function(env,context,expr){return ["js_throw",expr];});stdenv.register_macro("break",function(env,context,expr){return ["js_break"];});stdenv.register_macro("continue",function(env,context,expr){return ["js_continue"];});var rx_wrap=function(x){return (("(?:"+x)+")");};var rx_quote=function(x){return x.replace(RegExp("([.?*+\\^$\\[\\]\\(\\)\\{\\}|\\\\])","g"),"\\$1");};var rx_quote2=function(x){return x.replace(RegExp("([\\[\\]\\(\\)\\{\\}\\^])","g"),"\\$1");};var rx_build=function(τ192){var τ193=τ192;var τp0;var τp1;var x;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var s;var τp0;var τp1;var τ194;var τp2;var τp3;var τp4;var a;var b;var τp0;var τp1;var args;var τp0;var τp1;var args;var otherA;var τ195;var τ196;var τ197;var τ198;var τ199;if((τ193==="any")){return ".";}else{if((τ193==="start")){return "^";}else{if((τ193==="end")){return "$";}else{if((τ193==="alpha")){return "\\a";}else{if((τ193==="digit")){return "\\d";}else{if((τ193==="word")){return "\\w";}else{if((τ193==="space")){return "\\s";}else{if((τ193==="boundary")){return "\\b";}else{if((τ193==="a")){return "\\a";}else{if((τ193==="d")){return "\\d";}else{if((τ193==="w")){return "\\w";}else{if((τ193==="s")){return "\\s";}else{if((τ193==="b")){return "\\b";}else{if(((τ195=(τ193 instanceof Array))&&((τ196=(τ193["#"]===(void 0)))&&((τ197=((τp0=τ193.length),true))&&((τp0===2)&&(((τp1=τ193[0]),(τp1==="value"))&&((x=τ193[1]),true))))))){return rx_quote(x);}else{if((τ197&&((τ198=(τp0===3))&&((τ199=((τp1=τ193[0]),(τp1==="send")))&&(((τp2=τ193[1]),(τp2==="raw"))&&(((τp3=τ193[2]),(τp3 instanceof Array))&&((τp3["#"]===(void 0))&&(((τp4=τp3.length),true)&&((τp4===2)&&(((τp5=τp3[0]),(τp5==="value"))&&((s=τp3[1]),true))))))))))){return s;}else{if((τ199&&(((τ194=τ193[1]),true,(τp2=τ193[2]),(τp2 instanceof Array))&&((τp2["#"]===(void 0))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((a=τp2[1]),true,(b=τp2[2]),true)))))))){var τ200=τ194;if((τ200==="||")){return rx_wrap(((rx_build(a)+"|")+rx_build(b)));}else{if((τ200==="or")){return rx_wrap(((rx_build(a)+"|")+rx_build(b)));}else{if((τ200==="*")){if((b===null)){false;}else{throw "a condition failed";}return rx_wrap((rx_build(a)+"*"));}else{if((τ200==="+")){if((b===null)){false;}else{throw "a condition failed";}return rx_wrap((rx_build(a)+"+"));}else{if((τ200==="?")){if((b===null)){false;}else{throw "a condition failed";}return rx_wrap((rx_build(a)+"?"));}else{if((τ200===">>")){if((a===null)){false;}else{throw "a condition failed";}var x=rx_quote2(b[1]);return (("["+x)+"]");}else{if((τ200===">>!")){if((a===null)){false;}else{throw "a condition failed";}var x=rx_quote2(b[1]);return (("[^"+x)+"]");}else{throw ["Could not find a match",τ200];}}}}}}}}else{if((τ197&&((τ198=(τp0>=1))&&(((τp1=τ193[0]),(τp1==="data"))&&((args=τ193.slice(1)),true))))){return (("("+args.map(rx_build).join(""))+")");}else{if((τ198&&(((τp1=τ193[0]),(τp1==="multi"))&&((args=τ193.slice(1)),true)))){return (("(?:"+args.map(rx_build).join(""))+")");}else{if(((otherA=τ193),true)){throw "OopsF";}else{throw ["Could not find a match",τ193];}}}}}}}}}}}}}}}}}}}};stdenv.register_macro("Rx",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)]]];});stdenv.register_macro("Rxg",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)],["value","g"]]];});stdenv.register_macro("?",function(env,context,τ201){var τ202=τ201;var τp0;var τp1;var τp2;var expr;var τp0;var τp1;var expr;var τp2;var τ203;var τ204;var τ205;var τ206;var τ207;if(((τ203=(τ202 instanceof Array))&&((τ204=(τ202["#"]===(void 0)))&&((τ205=((τp0=τ202.length),true))&&((τ206=(τp0===3))&&((τ207=((τp1=τ202[0]),(τp1==="data")))&&(((τp2=τ202[1]),(τp2===null))&&((expr=τ202[2]),true)))))))){return ["send","cond",["data",expr]];}else{if((τ207&&((expr=τ202[1]),true,(τp2=τ202[2]),(τp2===null)))){var orig_expr=expr;var checker=function(){var τ208=expr;var other;if((τ208===null)){throw "can't use ? on its own";}else{if((τ208==="String")){var f=function(env,context,τ209){var τp0;var τp1;var expr;if(((τ209 instanceof Array)&&((τ209["#"]===(void 0))&&(((τp0=τ209.length),true)&&((τp0===2)&&(((τp1=τ209[0]),(τp1==="data"))&&((expr=τ209[1]),true))))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","string"]]];};return ["macro",f];}else{if((τ208==="Number")){var f=function(env,context,τ210){var τp0;var τp1;var expr;if(((τ210 instanceof Array)&&((τ210["#"]===(void 0))&&(((τp0=τ210.length),true)&&((τp0===2)&&(((τp1=τ210[0]),(τp1==="data"))&&((expr=τ210[1]),true))))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","number"]]];};return ["macro",f];}else{if((τ208==="true")){return ["macro",function(_,_,τ211){var τp0;var τp1;var expr;if(((τ211 instanceof Array)&&((τ211["#"]===(void 0))&&(((τp0=τ211.length),true)&&((τp0===2)&&(((τp1=τ211[0]),(τp1==="data"))&&((expr=τ211[1]),true))))))){false;}else{throw "a condition failed";}return expr;}];}else{if((τ208==="false")){return ["macro",function(_,_,τ212){var τp0;var τp1;var expr;if(((τ212 instanceof Array)&&((τ212["#"]===(void 0))&&(((τp0=τ212.length),true)&&((τp0===2)&&(((τp1=τ212[0]),(τp1==="data"))&&((expr=τ212[1]),true))))))){false;}else{throw "a condition failed";}return ["send","not",["data",null,expr]];}];}else{if((τ208==="null")){return ["macro",make_checker(["value",null],"___is")];}else{if((τ208==="undefined")){return ["macro",make_checker(["value",undefined],"___is")];}else{if(((other=τ208),true)){return ["send",libf("checker"),["data",expr]];}else{throw ["Could not find a match",τ208];}}}}}}}}}();var mac=function(env,τ213,expr){var τ214=τ213;var other;if((τ214==="pattern")){var τ215=expr;var τp0;var τp1;var subp;var other;if(((τ215 instanceof Array)&&((τ215["#"]===(void 0))&&(((τp0=τ215.length),true)&&((τp0>=1)&&(((τp1=τ215[0]),(τp1==="data"))&&((subp=τ215.slice(1)),true))))))){var projector=["send",libf("deconstructor"),["data",orig_expr]];return ["check",checker,["project",projector,expr]];}else{if(((other=τ215),true)){return ["check",checker,(expr||["ignore"])];}else{throw ["Could not find a match",τ215];}}}else{if(((other=τ214),true)){return ["send",checker,["data",expr]];}else{throw ["Could not find a match",τ214];}}};return ["macro",mac];}else{throw ["Could not find a match",τ202];}}});stdenv.register_macro("!",function(env,context,τ216){var τp0;var τp1;var expr;var τp2;if(((τ216 instanceof Array)&&((τ216["#"]===(void 0))&&(((τp0=τ216.length),true)&&((τp0===3)&&(((τp1=τ216[0]),(τp1==="data"))&&((expr=τ216[1]),true,(τp2=τ216[2]),(τp2===null)))))))){false;}else{throw "a condition failed";}var projector=function(){var τ217=expr;var other;if((τ217===null)){throw "can't use ! on its own";}else{if((τ217==="String")){var f=function(env,context,τ218){var τp0;var τp1;var expr;if(((τ218 instanceof Array)&&((τ218["#"]===(void 0))&&(((τp0=τ218.length),true)&&((τp0===2)&&(((τp1=τ218[0]),(τp1==="data"))&&((expr=τ218[1]),true))))))){false;}else{throw "a condition failed";}return ["data",["value",true],["send","String",["data",expr]]];};return ["macro",f];}else{if((τ217==="Number")){var f=function(env,context,τ219){var τp0;var τp1;var expr;if(((τ219 instanceof Array)&&((τ219["#"]===(void 0))&&(((τp0=τ219.length),true)&&((τp0===2)&&(((τp1=τ219[0]),(τp1==="data"))&&((expr=τ219[1]),true))))))){false;}else{throw "a condition failed";}return ["data",["value",true],["send","parseFloat",["data",expr]]];};return ["macro",f];}else{if(((other=τ217),true)){return ["send",libf("projector"),["data",expr]];}else{throw ["Could not find a match",τ217];}}}}}();var mac=function(env,τ220,expr){var τ221=τ220;var other;if((τ221==="pattern")){return ["project",projector,(expr||["ignore"])];}else{if(((other=τ221),true)){return ["send",projector,["data",expr]];}else{throw ["Could not find a match",τ221];}}};return ["macro",mac];});var gensym_factory=function(prefix){(prefix=("τ"+prefix));var id=0;return function(){var name=(prefix+String(id));(id=(id+1));return name;};};var gensym=gensym_factory("");var is_symbol=function(τ222,env){var τ223=τ222;var τ224;var τ225;var s;var s;if((((typeof(τ223)==="string")&&((s=τ223),true))||((τ223 instanceof Array)&&((τ223["#"]===(void 0))&&(((τ224=τ223.length),true)&&((τ224===2)&&(((τ225=τ223[0]),(τ225==="symbol"))&&((s=τ223[1]),true)))))))){var τ226=env.resolve(s);var τp0;var τp1;var m;if(((τ226 instanceof Array)&&((τ226["#"]===(void 0))&&(((τp0=τ226.length),true)&&((τp0===2)&&(((τp1=τ226[0]),(τp1==="macro"))&&((m=τ226[1]),true))))))){return false;}else{if(true){return true;}else{throw ["Could not find a match",τ226];}}}else{if(true){return false;}else{throw ["Could not find a match",τ223];}}};var parse_lhs=function(env,lhs,rhs,gen){(gen=(gen||gensym_factory("p")));var vars=[];var clauses=[];var current=["multi"];var mktemp=function(){var t=gen();vars.push(t);return t;};var newclause=function(){if((current.length>1)){clauses.push(current);}else{false;}return (current=["multi"]);};var maybe_temp=function(x){if(is_symbol(x,env)){return x;}else{if(true){var temp=mktemp();(current=current.concat([["assign",temp,x]]));return temp;}else{return false;}}};var helper=function(lhs,curr){return helper_noexpand(expand.step(env,"pattern",lhs),curr);};var helper_noexpand=function(lhs,curr){var helper_data=function(temp,specs){var fw=0;var bw=0;var rest=undefined;var members=function(){var τ236=[];var τ237=specs;var τ238=τ237.length;for(var τ239=0;(τ239<τ238);(τ239++)){var τ240=τ237[τ239];var x;var other;if(((x=τ240),true)){τ236.push(function(){var v=expand.step(env,"pattern",x);var τ241=v;var τp0;var τp1;var variable;var other;if(((τ241 instanceof Array)&&((τ241["#"]===(void 0))&&(((τp0=τ241.length),true)&&((τp0===2)&&(((τp1=τ241[0]),(τp1==="dynsplice"))&&((variable=τ241[1]),true))))))){(rest=variable);}else{if((rest===undefined)){(fw=(fw+1));}else{if(((other=τ241),true)){(bw=(bw+1));}else{throw ["Could not find a match",τ241];}}}return v;}());}else{if(((other=τ240),true)){false;}else{throw ["Could not find a match",τ240];}}}return τ236;}();var cmp=function(){if((rest===undefined)){return "___eq";}else{if(true){return "___gte";}else{return false;}}}();var len=mktemp();(current=current.concat([["assign",len,["send",temp,["value","length"]]],["value",true]]));newclause();(current=current.concat([["send",cmp,["data",len,["value",(fw+bw)]]]]));newclause();for(var j=0;(j<fw);(++j)){helper_noexpand(send(members,j),["send",temp,["value",j]]);}if((rest!==undefined)){var slice=function(){if((bw>0)){return ["data",["value",fw],["value",(-bw)]];}else{if(true){return ["data",["value",fw]];}else{return false;}}}();helper_noexpand(send(members,fw)[1],["send",["send",temp,["value","slice"]],slice]);}else{false;}for(var j=0;(j<bw);(++j)){helper_noexpand(send(members,((fw+j)+1)),["send",temp,["send","___minus",["data",len,["value",(bw-j)]]]]);}};var τ227=lhs;var τ228;var τ229;var τ230;var τ231;var s;var s;var τp0;var τp1;var v;var τp0;var τp1;var condition;var pattern;var τp0;var τp1;var xs;var τp0;var τp1;var xs;var τp0;var τp1;var checker;var expr;var τp0;var τp1;var projector;var expr;var τp0;var τp1;var fname;var spec;var τp0;var τp1;var specs;var τp0;var τp1;var specs;var other;var τ232;var τ233;var τ234;var τ235;if((τ227===null)){var x=["check",["macro",make_checker(["value",null],"___eq")],["ignore"]];return helper_noexpand(x,curr);}else{if(((τ227==="_")||((τ227 instanceof Array)&&((τ227["#"]===(void 0))&&(((τ228=τ227.length),true)&&((τ228===1)&&((τ229=τ227[0]),(τ229==="ignore")))))))){if((!is_symbol(curr,env))){current.push(curr);return current.push(["value",true]);}else{return false;}}else{if((((typeof(τ227)==="string")&&((s=τ227),true))||((τ227 instanceof Array)&&((τ227["#"]===(void 0))&&(((τ230=τ227.length),true)&&((τ230===2)&&(((τ231=τ227[0]),(τ231==="symbol"))&&((s=τ227[1]),true)))))))){vars.push(s);current.push(["assign",s,curr]);return current.push(["value",true]);}else{if(((τ232=(τ227 instanceof Array))&&((τ233=(τ227["#"]===(void 0)))&&((τ234=((τp0=τ227.length),true))&&((τp0===2)&&(((τp1=τ227[0]),(τp1==="value"))&&((v=τ227[1]),true))))))){var x=["check",["macro",make_checker(lhs,"___eq")],["ignore"]];return helper_noexpand(x,curr);}else{if((τ234&&((τp0===3)&&(((τp1=τ227[0]),(τp1==="test"))&&((condition=τ227[1]),true,(pattern=τ227[2]),true))))){helper(pattern,curr);current.push(condition);return newclause();}else{if((τ234&&((τ235=(τp0>=1))&&(((τp1=τ227[0]),(τp1==="all"))&&((xs=τ227.slice(1)),true))))){var temp=maybe_temp(curr);var τ242=xs;var τ243=τ242.length;for(var τ244=0;(τ244<τ243);(τ244++)){var τ245=τ242[τ244];var x;var other;if(((x=τ245),true)){helper(x,temp);}else{if(((other=τ245),true)){false;}else{throw ["Could not find a match",τ245];}}}false;return false;}else{if((τ235&&(((τp1=τ227[0]),(τp1==="any"))&&((xs=τ227.slice(1)),true)))){var normalize=function(vars){return vars.filter(function(x){return (x[0]!=="τ");}).sort().join(",");};var temp=maybe_temp(curr);var myvars=undefined;var clauses=[];var τ246=xs;var τ247=τ246.length;for(var τ248=0;(τ248<τ247);(τ248++)){var τ249=τ246[τ248];var x;var other;if(((x=τ249),true)){var p=parse_lhs(env,x,temp,gensym);if((myvars===undefined)){(myvars=p[0]);}else{if((normalize(p[0])!==normalize(myvars))){throw [["Must have the same set of variables in both branches!",(("["+String(myvars))+"]"),(("["+String(p[0]))+"]")]];}else{if(true){(vars=vars.concat(p[0]));}else{false;}}}clauses.push(make_pattern_test(p[1]));}else{if(((other=τ249),true)){false;}else{throw ["Could not find a match",τ249];}}}false;current.push(make_or_pattern(clauses));(vars=vars.concat(myvars));return newclause();}else{if((τ234&&((τ235=(τp0===3))&&(((τp1=τ227[0]),(τp1==="check"))&&((checker=τ227[1]),true,(expr=τ227[2]),true))))){var temp=maybe_temp(curr);(current=current.concat([["send",checker,["data",temp]]]));newclause();return helper(expr,temp);}else{if((τ235&&(((τp1=τ227[0]),(τp1==="project"))&&((projector=τ227[1]),true,(expr=τ227[2]),true)))){var temp=maybe_temp(curr);var temp2=mktemp();(current=current.concat([["assign",temp2,["send",projector,["data",temp]]],["send",temp2,["value",0]]]));newclause();return helper(expr,["send",temp2,["value",1]]);}else{if((τ235&&(((τp1=τ227[0]),(τp1==="send"))&&((fname=τ227[1]),true,(spec=τ227[2]),true)))){return helper(fname,["send","->",["data",spec,curr]]);}else{if((τ234&&((τ235=(τp0>=1))&&(((τp1=τ227[0]),(τp1==="duck"))&&((specs=τ227.slice(1)),true))))){var temp=maybe_temp(curr);(current=current.concat([["value",true]]));return helper_data(temp,specs);}else{if((τ235&&(((τp1=τ227[0]),(τp1==="data"))&&((specs=τ227.slice(1)),true)))){var temp=maybe_temp(curr);(current=current.concat([["send","___instanceof",["data",temp,"Array"]]]));newclause();(current=current.concat([["send","___is",["data",["send",temp,["value","#"]],["value",undefined]]]]));newclause();return helper_data(temp,specs);}else{if(((other=τ227),true)){throw ["OopsG",other];}else{throw ["Could not find a match",τ227];}}}}}}}}}}}}}};helper(lhs,rhs);if((current.length>1)){clauses.push(current);}else{false;}return [vars,clauses];};var make_declarations=function(vars){var τ250=[];var τ251=vars;var τ252=τ251.length;for(var τ253=0;(τ253<τ252);(τ253++)){var τ254=τ251[τ253];var name;var other;if(((name=τ254),true)){τ250.push(["declare",name,["value",undefined]]);}else{if(((other=τ254),true)){false;}else{throw ["Could not find a match",τ254];}}}return τ250;};var make_pattern_test=function(clauses){var ands=clauses.pop();while((clauses.length>0)){(ands=["send","___and",["data",clauses.pop(),ands]]);}return (ands||["value",true]);};var make_or_pattern=function(clauses){var ors=clauses.pop();while((clauses.length>0)){(ors=["send","___or",["data",clauses.pop(),ors]]);}return ors;};var find_arrow=function(τ255){var τ256=τ255;var x;var x;var τp0;var τp1;var x;var x;var τp0;var τp1;var v;var τp0;var kind;var args;if((τ256==="|>")){var placeholder=gensym();return [placeholder,placeholder];}else{if((τ256==="|>*")){var placeholder=gensym();return [placeholder,["send","*",["data",placeholder,null]]];}else{if((((typeof(τ256)==="string")&&((x=τ256),true))||((τ256===null)&&((x=τ256),true)))){return [false,x];}else{if(((τ256 instanceof Array)&&((τ256["#"]===(void 0))&&(((τp0=τ256.length),true)&&((τp0===2)&&(((τp1=τ256[0]),(τp1==="symbol"))&&((x=τ256[1]),true))))))){return [false,x];}else{if((((x=τ256),true,(τ256 instanceof Array))&&((τ256["#"]===(void 0))&&(((τp0=τ256.length),true)&&((τp0===2)&&(((τp1=τ256[0]),(τp1==="value"))&&((v=τ256[1]),true))))))){return [false,x];}else{if(((τ256 instanceof Array)&&((τ256["#"]===(void 0))&&(((τp0=τ256.length),true)&&((τp0>=1)&&((kind=τ256[0]),true,(args=τ256.slice(1)),true)))))){var placeholder=false;var new_args=function(){var τ257=[];var τ258=args;var τ259=τ258.length;for(var τ260=0;(τ260<τ259);(τ260++)){var τ261=τ258[τ260];var arg;var other;if(((arg=τ261),true)){τ257.push(function(){var τp0;var τp1;var ph;var new_arg;if((((τp0=find_arrow(arg)),(τp0 instanceof Array))&&((τp0["#"]===(void 0))&&(((τp1=τp0.length),true)&&((τp1===2)&&((ph=τp0[0]),true,(new_arg=τp0[1]),true)))))){false;}else{throw "a condition failed";}if(ph){(placeholder=ph);}else{false;}return new_arg;}());}else{if(((other=τ261),true)){false;}else{throw ["Could not find a match",τ261];}}}return τ257;}();return [placeholder,[kind].concat(new_args)];}else{throw ["Could not find a match",τ256];}}}}}}};var same=function(a,b){var τ262=[a,b];var τp0;var τp1;var x;var τp2;var y;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var y;var τp0;var τp1;var τp2;var τp3;var x;var τp4;var τp5;var τp6;var y;var τp0;var τp1;var τp2;var τp3;var x;var τp4;var τp5;var τp6;var y;var τp0;var τp1;var τp2;var τp3;var f;var x;var τp4;var τp5;var τp6;var g;var y;var τp0;var τp1;var τp2;var kind1;var xs;var τp3;var τp4;var kind2;var ys;var other;var τ263;var τ264;var τ265;var τ266;var τ267;var τ268;var τ269;var τ270;if(((τ263=(τ262 instanceof Array))&&((τ264=(τ262["#"]===(void 0)))&&((τ265=((τp0=τ262.length),true))&&((τ266=(τp0===2))&&(((τp1=τ262[0]),(typeof(τp1)==="string"))&&(((x=τp1),true,(τp2=τ262[1]),(typeof(τp2)==="string"))&&((y=τp2),true)))))))){return (x===y);}else{if((τ266&&((τ267=((τp1=τ262[0]),(τp1 instanceof Array)))&&((τ268=(τp1["#"]===(void 0)))&&((τ269=((τp2=τp1.length),true))&&((τp2===1)&&(((τp3=function(){return τp1[0];}),(τp3==="symbol"))&&(((τp4=τ262[1]),(τp4 instanceof Array))&&((τp4["#"]===(void 0))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="symbol"))&&((y=τp4[1]),true))))))))))))){return (x===y);}else{if((τ269&&((τ270=(τp2===2))&&(((τp3=τp1[0]),(τp3==="value"))&&(((x=τp1[1]),true,(τp4=τ262[1]),(τp4 instanceof Array))&&((τp4["#"]===(void 0))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="value"))&&((y=τp4[1]),true)))))))))){return (x===y);}else{if((τ270&&(((τp3=τp1[0]),(τp3==="macro"))&&(((x=τp1[1]),true,(τp4=τ262[1]),(τp4 instanceof Array))&&((τp4["#"]===(void 0))&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="macro"))&&((y=τp4[1]),true))))))))){return (x===y);}else{if((τ269&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((f=τp1[1]),true,(x=τp1[2]),true,(τp4=τ262[1]),(τp4 instanceof Array))&&((τp4["#"]===(void 0))&&(((τp5=τp4.length),true)&&((τp5===3)&&(((τp6=τp4[0]),(τp6==="send"))&&((g=τp4[1]),true,(y=τp4[2]),true)))))))))){return (same(f,g)&&same(x,y));}else{if((τ269&&((τp2>=1)&&(((kind1=τp1[0]),true,(xs=τp1.slice(1)),true,(τp3=τ262[1]),(τp3 instanceof Array))&&((τp3["#"]===(void 0))&&(((τp4=τp3.length),true)&&((τp4>=1)&&((kind2=τp3[0]),true,(ys=τp3.slice(1)),true)))))))){var allequal=xs.every(function(x,i){return same(x,send(ys,i));});return (((kind1===kind2)&&(xs.length===ys.length))&&allequal);}else{if(((other=τ262),true)){return false;}else{throw ["Could not find a match",τ262];}}}}}}}};stdenv.register_macro("|>",function(env,context,τ271){var τp0;var τp1;var to_match;var cl;if(((τ271 instanceof Array)&&((τ271["#"]===(void 0))&&(((τp0=τ271.length),true)&&((τp0===3)&&(((τp1=τ271[0]),(τp1==="data"))&&((to_match=τ271[1]),true,(cl=τ271[2]),true))))))){false;}else{throw "a condition failed";}var temp=gensym();var clauses=function(){var τ272=cl;var τp0;var τp1;var cls;var other;if(((τ272 instanceof Array)&&((τ272["#"]===(void 0))&&(((τp0=τ272.length),true)&&((τp0>=1)&&(((τp1=τ272[0]),(τp1==="multi"))&&((cls=τ272.slice(1)),true))))))){return cls;}else{if(((other=τ272),true)){return [other];}else{throw ["Could not find a match",τ272];}}}();var cached_conditions=[];var stmts=["multi",["declare",temp,to_match]];(clauses=function(){var τ273=[];var τ274=clauses;var τ275=τ274.length;for(var τ276=0;(τ276<τ275);(τ276++)){var τ277=τ274[τ276];var clause;var other;if(((clause=τ277),true)){τ273.push(function(){var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var lhs;var body;if(((clause instanceof Array)&&((clause["#"]===(void 0))&&(((τp0=clause.length),true)&&((τp0===3)&&(((τp1=clause[0]),(τp1==="send"))&&(((τp2=clause[1]),(τp2==="->"))&&(((τp3=clause[2]),(τp3 instanceof Array))&&((τp3["#"]===(void 0))&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&((lhs=τp3[1]),true,(body=τp3[2]),true))))))))))))){false;}else{throw "a condition failed";}var τp0;var τp1;var placeholder;var new_lhs;if((((τp0=find_arrow(lhs)),(τp0 instanceof Array))&&((τp0["#"]===(void 0))&&(((τp1=τp0.length),true)&&((τp1===2)&&((placeholder=τp0[0]),true,(new_lhs=τp0[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var decls;var conditions;if((((τp0=parse_lhs(env,new_lhs,temp)),(τp0 instanceof Array))&&((τp0["#"]===(void 0))&&(((τp1=τp0.length),true)&&((τp1===2)&&((decls=τp0[0]),true,(conditions=τp0[1]),true)))))){false;}else{throw "a condition failed";}(stmts=stmts.concat(make_declarations(decls)));var b=function(){if(placeholder){return ["send","|>",["data",placeholder,body]];}else{if(true){return body;}else{return false;}}}();var f=function(x){return ["done",expand(env,"expr",x)];};return [conditions.map(f),b];}());}else{if(((other=τ277),true)){false;}else{throw ["Could not find a match",τ277];}}}return τ273;}());var shares=function(){var f=function(τ278,i){var τp0;var conditions;var body;if(((τ278 instanceof Array)&&((τ278["#"]===(void 0))&&(((τp0=τ278.length),true)&&((τp0===2)&&((conditions=τ278[0]),true,(body=τ278[1]),true)))))){false;}else{throw "a condition failed";}var res=0;var prev_conditions=send(clauses,i)[0];var nc=conditions.length;for(var j=0;((j<nc)&&same(send(conditions,j),send(prev_conditions,j)));(j++)){(res++);}return res;};return clauses.slice(1).map(f);}();var max=send(Math.max,shares);shares.push(0);var vars=[];for(var i=0;(i<max);(i++)){vars.push(gensym());}(stmts=stmts.concat(make_declarations(vars)));var shared_last=0;var new_clauses=clauses.map(function(τ279,i){var τp0;var conditions;var body;if(((τ279 instanceof Array)&&((τ279["#"]===(void 0))&&(((τp0=τ279.length),true)&&((τp0===2)&&((conditions=τ279[0]),true,(body=τ279[1]),true)))))){false;}else{throw "a condition failed";}var shared=function(){if(shared_last){return [send(vars,(shared_last-1))];}else{return [];}}();var n_to_share=Math.max(shared_last,send(shares,i));var to_share=conditions.slice(shared_last,n_to_share).map(function(x,j){return ["assign",send(vars,(shared_last+j)),x];});(shared_last=send(shares,i));var rest=conditions.slice(n_to_share);return [shared.concat(to_share).concat(rest),body];});(clauses=new_clauses);var r=["js_throw",["data",["value","Could not find a match"],temp]];while((clauses.length>0)){var τp0;var τp1;var conditions;var body;if((((τp0=clauses.pop()),(τp0 instanceof Array))&&((τp0["#"]===(void 0))&&(((τp1=τp0.length),true)&&((τp1===2)&&((conditions=τp0[0]),true,(body=τp0[1]),true)))))){false;}else{throw "a condition failed";}var test=make_pattern_test(conditions);(r=["if",test,body,r]);}stmts.push(r);return stmts;});var qqstruct=function(name,args){return patch_array(["data",["value",name]],args);};var qq=function(τ281){var expr;var τ280;(expr=τ281);true;(τ280=τ281);var τ282=τ280;var τ283;var τ284;var s;var s;var τp0;var τp1;var v;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var insert;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var insert;var τp0;var name;var args;var τ285;var τ286;var τ287;var τ288;var τ289;if((((typeof(τ282)==="string")&&((s=τ282),true))||((τ282 instanceof Array)&&((τ282["#"]===(void 0))&&(((τ283=τ282.length),true)&&((τ283===2)&&(((τ284=τ282[0]),(τ284==="symbol"))&&((s=τ282[1]),true)))))))){return ["value",s];}else{if((τ282===null)){return ["value",null];}else{if(((τ285=(τ282 instanceof Array))&&((τ286=(τ282["#"]===(void 0)))&&((τ287=((τp0=τ282.length),true))&&((τp0===2)&&(((τp1=τ282[0]),(τp1==="value"))&&((v=τ282[1]),true))))))){return qqstruct("value",[expr]);}else{if((τ287&&((τ288=(τp0===3))&&((τ289=((τp1=τ282[0]),(τp1==="send")))&&(((τp2=τ282[1]),(τp2==="^"))&&(((τp3=τ282[2]),(τp3 instanceof Array))&&((τp3["#"]===(void 0))&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((τp6=τp3[1]),(τp6===null))&&((insert=τp3[2]),true)))))))))))){return insert;}else{if((τ289&&(((τp2=τ282[1]),(τp2==="^="))&&(((τp3=τ282[2]),(τp3 instanceof Array))&&((τp3["#"]===(void 0))&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((τp6=τp3[1]),(τp6===null))&&((insert=τp3[2]),true)))))))))){return qqstruct("value",[insert]);}else{if((τ287&&((τp0>=1)&&((name=τ282[0]),true,(args=τ282.slice(1)),true)))){return qqstruct(name,function(){var τ290=[];var τ291=args;var τ292=τ291.length;for(var τ293=0;(τ293<τ292);(τ293++)){var τ294=τ291[τ293];var arg;var other;if(((arg=τ294),true)){τ290.push(qq(arg));}else{if(((other=τ294),true)){false;}else{throw ["Could not find a match",τ294];}}}return τ290;}());}else{throw ["Could not find a match",τ282];}}}}}}};stdenv.register_macro("'",function(env,context,τ295){var τp0;var τp1;var τp2;var expr;if(((τ295 instanceof Array)&&((τ295["#"]===(void 0))&&(((τp0=τ295.length),true)&&((τp0===3)&&(((τp1=τ295[0]),(τp1==="data"))&&(((τp2=τ295[1]),(τp2===null))&&((expr=τ295[2]),true)))))))){false;}else{throw "a condition failed";}return qq(expr);});stdenv.register_macro("req",function(env,context,τ296){var τp0;var τp1;var expr;if(((τ296 instanceof Array)&&((τ296["#"]===(void 0))&&(((τp0=τ296.length),true)&&((τp0===2)&&(((τp1=τ296[0]),(τp1==="data"))&&((expr=τ296[1]),true))))))){false;}else{throw "a condition failed";}var stmts=[];var topfetch=function(pkg,v){stmts.push(["send","=",["data",v,["send",["send","___node",["send",".",["data",null,"require"]]],["data",["value",pkg]]]]]);return v;};var produce=function(τ297,fetch){var τ298=τ297;var s;var τp0;var τp1;var τp2;var s;var τp0;var τp1;var subp;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var pkg;var τ299;var τ300;var pkg;var τp7;var s;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var pkg;var subp;var τ301;var τ302;var τ303;var τ304;var τ305;if(((typeof(τ298)==="string")&&((s=τ298),true))){return fetch(s,s);}else{if(((τ301=(τ298 instanceof Array))&&((τ302=(τ298["#"]===(void 0)))&&((τ303=((τp0=τ298.length),true))&&((τp0===2)&&(((τp1=τ298[0]),(τp1==="value"))&&(((τp2=τ298[1]),(typeof(τp2)==="string"))&&((s=τp2),true)))))))){return fetch(s,gensym());}else{if((τ303&&((τp0>=1)&&(((τp1=τ298[0]),((τp1==="multi")||(τp1==="data")))&&((subp=τ298.slice(1)),true))))){var τ306=[];var τ307=subp;var τ308=τ307.length;for(var τ309=0;(τ309<τ308);(τ309++)){var τ310=τ307[τ309];var p;var other;if(((p=τ310),true)){τ306.push(produce(p,fetch));}else{if(((other=τ310),true)){false;}else{throw ["Could not find a match",τ310];}}}return τ306;}else{if((τ303&&((τ304=(τp0===3))&&((τ305=((τp1=τ298[0]),(τp1==="send")))&&(((τp2=τ298[1]),(τp2==="as"))&&(((τp3=τ298[2]),(τp3 instanceof Array))&&((τp3["#"]===(void 0))&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((τp6=τp3[1]),(((τp6 instanceof Array)&&((τp6["#"]===(void 0))&&(((τ299=τp6.length),true)&&((τ299===2)&&(((τ300=τp6[0]),(τ300==="value"))&&((pkg=τp6[1]),true))))))||((pkg=τp6),true)))&&(((τp7=τp3[2]),(typeof(τp7)==="string"))&&((s=τp7),true))))))))))))){return fetch(pkg,s);}else{if((τ305&&(((τp2=τ298[1]),(τp2==="->"))&&(((τp3=τ298[2]),(τp3 instanceof Array))&&((τp3["#"]===(void 0))&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&((pkg=τp3[1]),true,(subp=τp3[2]),true))))))))){var pkgv=produce(pkg,fetch);return produce(subp,function(pkg,v){return stmts.push(["send","=",["data",v,["send",pkgv,["value",pkg]]]]);});}else{throw ["Could not find a match",τ298];}}}}}};produce(expr,topfetch);return patch_array(["multi"],stmts);});stdenv.register_macro("macro",function(env,context,expr){var τp0;var τp1;var τp2;var τp3;var τp4;var name;var args;var body;if(((expr instanceof Array)&&((expr["#"]===(void 0))&&(((τp0=expr.length),true)&&((τp0===3)&&(((τp1=expr[0]),(τp1==="data"))&&(((τp2=expr[1]),(τp2 instanceof Array))&&((τp2["#"]===(void 0))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="send"))&&((name=τp2[1]),true,(args=τp2[2]),true,(body=expr[2]),true)))))))))))){false;}else{throw "a condition failed";}var fn=["send","->",["data",args,body]];var code=generate_from_ast(fn);var efn=eval((("("+code.slice(0,(-1)))+")"));env.register_macro(name,efn);return ["value",undefined];});var js_op_table=({"___plus":"+","___minus":"-","___times":"*","___div":"/","___mod":"%","___binxor":"^","___binand":"&","___binor":"|","___binnot":"~","___and":"&&","___or":"||","___not":"!","___is":"===","___isnt":"!==","___eq":"===","___neq":"!==","___lt":"<","___gt":">","___lte":"<=","___gte":">=","___shl":"<<","___shr":">>","___shr2":">>>","___in":" in ","___instanceof":" instanceof ","___plusplus":"++","___minusminus":"--"});var translate=function(τ312,mode){var expr;var τ311;(expr=τ312);true;(τ311=τ312);var τ313=τ311;var τ314;var τ315;var s;var s;var τp0;var τp1;var v;var τp0;var τp1;var bindings;var body;var τp0;var τp1;var test;var pos;var neg;var τp0;var τp1;var test;var body;var τp0;var τp1;var x;var y;var z;var body;var τp0;var τp1;var attempt;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var v;var body;var τp8;var τp0;var τp1;var binding;var τp2;var τp3;var τp4;var τp5;var τp0;var τp1;var binding;var value;var τp0;var τp1;var τp2;var τp3;var τp4;var obj;var msg;var rhs;var τp0;var τp1;var lhs;var rhs;var τp0;var τp1;var args;var τp0;var τp1;var args;var τp0;var τp1;var τp0;var τp1;var τp0;var τp1;var value;var τp0;var τp1;var value;var τp0;var τp1;var args;var τp0;var τp1;var args;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var f;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var f;var msg;var τp0;var τp1;var f;var τp2;var msg;var τp3;var τp4;var s;var τp0;var τp1;var f;var τp2;var τp3;var τp4;var args;var τp0;var τp1;var f;var msg;var other;var τ316;var τ317;var τ318;var τ319;var τ320;if((((typeof(τ313)==="string")&&((s=τ313),true))||((τ313 instanceof Array)&&((τ313["#"]===(void 0))&&(((τ314=τ313.length),true)&&((τ314===2)&&(((τ315=τ313[0]),(τ315==="symbol"))&&((s=τ313[1]),true)))))))){return translate.expr(translate.mangle(s),mode);}else{if((τ313===null)){return translate.expr("null",mode);}else{if(((τ316=(τ313 instanceof Array))&&((τ317=(τ313["#"]===(void 0)))&&((τ318=((τp0=τ313.length),true))&&((τp0===2)&&(((τp1=τ313[0]),(τp1==="value"))&&((v=τ313[1]),true))))))){var r=function(){var τ321=v;var other;if((typeof(τ321)==="string")){var repl=({"\"":"\\\"","\n":"\\n","\\":"\\\\"});(v=v.replace(RegExp("((?:(?:\"|\\\\)|\n))","g"),function(m){return send(repl,m);}));return (("\""+v)+"\"");}else{if((τ321===(void 0))){return "(void 0)";}else{if(((((typeof(τ321)==="number")||(τ321===true))||(τ321===false))||(τ321===null))){return String(v);}else{if(((other=τ321),true)){return (("?!?["+v)+"]?!?");}else{throw ["Could not find a match",τ321];}}}}}();return translate.expr(r,mode);}else{if((τ318&&((τp0===3)&&(((τp1=τ313[0]),(τp1==="lambda"))&&((bindings=τ313[1]),true,(body=τ313[2]),true))))){var a=bindings.join(",");var b=translate.body(body,"return");return translate.expr((((("function("+a)+"){")+b)+"}"),mode);}else{if((τ318&&((τp0===4)&&(((τp1=τ313[0]),(τp1==="if"))&&((test=τ313[1]),true,(pos=τ313[2]),true,(neg=τ313[3]),true))))){var τ322=mode;var other;if((τ322==="expr")){return translate.body(expr,"expr");}else{if(((other=τ322),true)){var a=translate(test,"expr");var b=translate(pos,mode);var c=translate(neg,mode);return (((((("if("+a)+"){")+b)+"}else{")+c)+"}");}else{throw ["Could not find a match",τ322];}}}else{if((τ318&&((τp0===3)&&(((τp1=τ313[0]),(τp1==="js_while"))&&((test=τ313[1]),true,(body=τ313[2]),true))))){var τ323=mode;var other;if((τ323==="expr")){return translate.body(expr,"expr");}else{if(((other=τ323),true)){var a=translate(test,"expr");var b=translate(body,"stmt");return (((("while("+a)+"){")+b)+"}");}else{throw ["Could not find a match",τ323];}}}else{if((τ318&&((τp0===5)&&(((τp1=τ313[0]),(τp1==="js_for"))&&((x=τ313[1]),true,(y=τ313[2]),true,(z=τ313[3]),true,(body=τ313[4]),true))))){var τ324=mode;var other;if((τ324==="expr")){return translate.body(expr,"expr");}else{if(((other=τ324),true)){var a=translate(x,"stmt");var b=translate(y,"stmt");var c=translate(z,"expr");var d=translate(body,"stmt");return (((((("for("+a)+b)+c)+"){")+d)+"}");}else{throw ["Could not find a match",τ324];}}}else{if((τ318&&((τp0===4)&&(((τp1=τ313[0]),(τp1==="js_try"))&&(((attempt=τ313[1]),true,(τp2=τ313[2]),(τp2 instanceof Array))&&((τp2["#"]===(void 0))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="lambda"))&&(((τp5=τp2[1]),(τp5 instanceof Array))&&((τp5["#"]===(void 0))&&(((τp6=τp5.length),true)&&((τp6===1)&&(((τp7=τp5[0]),(typeof(τp7)==="string"))&&((v=τp7),true,(body=τp2[2]),true,(τp8=τ313[3]),(τp8===null)))))))))))))))){var τ325=mode;var other;if((τ325==="expr")){return translate.body(expr,"expr");}else{if(((other=τ325),true)){var a=translate(attempt,"stmt");var b=translate(body,"stmt");return (((((("try{"+a)+"}catch(")+v)+"){")+b)+"}");}else{throw ["Could not find a match",τ325];}}}else{if((τ318&&((τ319=(τp0===3))&&((τ320=((τp1=τ313[0]),(τp1==="declare")))&&(((binding=τ313[1]),true,(τp2=τ313[2]),(τp2 instanceof Array))&&((τp2["#"]===(void 0))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="value"))&&((τp5=τp2[1]),(τp5===(void 0)))))))))))){var τ326=mode;var other;if(((τ326==="expr")||(τ326==="return"))){throw "Invalid in expr ctx";}else{if(((other=τ326),true)){var a=translate(binding,"expr");return (("var "+a)+";");}else{throw ["Could not find a match",τ326];}}}else{if((τ320&&((binding=τ313[1]),true,(value=τ313[2]),true))){var τ327=mode;var other;if(((τ327==="expr")||(τ327==="return"))){throw "Invalid in expr ctx";}else{if(((other=τ327),true)){var a=translate(binding,"expr");var b=translate(value,"expr");return (((("var "+a)+"=")+b)+";");}else{throw ["Could not find a match",τ327];}}}else{if((τ319&&((τ320=((τp1=τ313[0]),(τp1==="assign")))&&(((τp2=τ313[1]),(τp2 instanceof Array))&&((τp2["#"]===(void 0))&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="send"))&&((obj=τp2[1]),true,(msg=τp2[2]),true,(rhs=τ313[2]),true))))))))){var a=translate(obj,"expr");var b=translate(msg,"expr");var c=translate(rhs,"expr");return translate.expr((((((("("+a)+"[")+b)+"]=")+c)+")"),mode);}else{if((τ320&&((lhs=τ313[1]),true,(rhs=τ313[2]),true))){var a=translate(lhs,"expr");var b=translate(rhs,"expr");return translate.expr((((("("+a)+"=")+b)+")"),mode);}else{if((τ318&&((τ319=(τp0>=1))&&(((τp1=τ313[0]),(τp1==="multi"))&&((args=τ313.slice(1)),true))))){var isdecl=function(τ328){var τ329=τ328;var τp0;var τp1;var variable;var value;var other;if(((τ329 instanceof Array)&&((τ329["#"]===(void 0))&&(((τp0=τ329.length),true)&&((τp0===3)&&(((τp1=τ329[0]),(τp1==="declare"))&&((variable=τ329[1]),true,(value=τ329[2]),true))))))){return true;}else{if(((other=τ329),true)){return false;}else{throw ["Could not find a match",τ329];}}};if((args.length===1)){return translate(args[0],mode);}else{if(((mode==="expr")&&(!args.some(isdecl)))){var xs=function(){var τ330=[];var τ331=args;var τ332=τ331.length;for(var τ333=0;(τ333<τ332);(τ333++)){var τ334=τ331[τ333];var x;var other;if(((x=τ334),true)){τ330.push(translate(x,"expr"));}else{if(((other=τ334),true)){false;}else{throw ["Could not find a match",τ334];}}}return τ330;}();return (("("+xs.join(","))+")");}else{if(true){return translate.body(expr,mode);}else{return false;}}}}else{if((τ319&&(((τp1=τ313[0]),(τp1==="splice"))&&((args=τ313.slice(1)),true)))){return translate(["multi"].concat(args),mode);}else{if((τ318&&((τ319=(τp0===1))&&((τp1=τ313[0]),(τp1==="js_break"))))){if((mode==="expr")){throw "Invalid break in ctx";}else{if(true){return "break;";}else{return false;}}}else{if((τ319&&((τp1=τ313[0]),(τp1==="js_continue")))){if((mode==="expr")){throw "Invalid continue in ctx";}else{if(true){return "continue;";}else{return false;}}}else{if((τ318&&((τ319=(τp0===2))&&(((τp1=τ313[0]),(τp1==="js_return"))&&((value=τ313[1]),true))))){if((mode==="expr")){throw "Invalid return in ctx";}else{if(true){return (("return "+translate(value,"expr"))+";");}else{return false;}}}else{if((τ319&&(((τp1=τ313[0]),(τp1==="js_throw"))&&((value=τ313[1]),true)))){if((mode==="expr")){return (("function(){throw "+translate(value,"expr"))+";}()");}else{if(true){return (("throw "+translate(value,"expr"))+";");}else{return false;}}}else{if((τ318&&((τ319=(τp0>=1))&&(((τp1=τ313[0]),(τp1==="array"))&&((args=τ313.slice(1)),true))))){var r=function(){var f=function(x){return translate(x,"expr");};return (("["+args.map(f).join(","))+"]");}();return translate.expr(r,mode);}else{if((τ319&&(((τp1=τ313[0]),(τp1==="object"))&&((args=τ313.slice(1)),true)))){var r=function(){var f=function(x){var a=translate(x[1],"expr");var b=translate(x[2],"expr");return ((a+":")+b);};return (("({"+args.map(f).join(","))+"})");}();return translate.expr(r,mode);}else{if((τ318&&((τ319=(τp0===3))&&((τ320=((τp1=τ313[0]),(τp1==="send")))&&(((τp2=τ313[1]),(τp2==="___node"))&&(((τp3=τ313[2]),(τp3 instanceof Array))&&((τp3["#"]===(void 0))&&(((τp4=τp3.length),true)&&((τp4===2)&&(((τp5=τp3[0]),(τp5==="value"))&&((f=τp3[1]),true))))))))))){return f;}else{if((τ320&&(((τp2=τ313[1]),(τp2==="___js_fetch"))&&(((τp3=τ313[2]),(τp3 instanceof Array))&&((τp3["#"]===(void 0))&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="array"))&&((f=τp3[1]),true,(msg=τp3[2]),true))))))))){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{if((τ320&&(((f=τ313[1]),true,(τp2=τ313[2]),(msg=τp2),true,(τp2 instanceof Array))&&((τp2["#"]===(void 0))&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="value"))&&((s=τp2[1]),true)))))))){if(((typeof(s)==="string")&&s.match(RegExp("(?:^(?:[a-zA-Z_$]+)$)")))){var trf=translate(f,"expr");var trmsg=translate(s,"expr");return translate.expr(((trf+".")+trmsg),mode);}else{if(true){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{return false;}}}else{if((τ320&&(((f=τ313[1]),true,(τp2=τ313[2]),(τp2 instanceof Array))&&((τp2["#"]===(void 0))&&(((τp3=τp2.length),true)&&((τp3>=1)&&(((τp4=τp2[0]),(τp4==="array"))&&((args=τp2.slice(1)),true)))))))){var op=((typeof(f)==="string")&&send(js_op_table,f));if(op){return translate.expr(translate.op(op,args[0],args[1]),mode);}else{if(true){var trf=translate(f,"expr");var trargs=function(){var τ335=[];var τ336=args;var τ337=τ336.length;for(var τ338=0;(τ338<τ337);(τ338++)){var τ339=τ336[τ338];var x;var other;if(((x=τ339),true)){τ335.push(translate(x,"expr"));}else{if(((other=τ339),true)){false;}else{throw ["Could not find a match",τ339];}}}return τ335;}();return translate.expr((((trf+"(")+trargs.join(","))+")"),mode);}else{return false;}}}else{if((τ320&&((f=τ313[1]),true,(msg=τ313[2]),true))){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((("send("+trf)+",")+trmsg)+")"),mode);}else{if(((other=τ313),true)){throw other;}else{throw ["Could not find a match",τ313];}}}}}}}}}}}}}}}}}}}}}}}}}}};(translate["mangle"]=function(name){var tr=({"+":"__plus__","-":"__minus__","*":"__asterisk__","/":"__slash__","%":"__percent__","^":"__caret__","#":"__hash__","&":"__amp__","|":"__pipe__","@":"__at__","!":"__bang__","?":"__qmark__","=":"__equal__","<":"__lt__",">":"__gt__","~":"__tilde__",".":"__dot__"});var r=[];for(var i=0;(i<name.length);(++i)){var c=send(name,i);r.push((send(tr,c)||c));}return r.join("");});(translate["body"]=function(b,mode){(orig=b);(b=aslist(b));var trst=function(stmt){return translate(stmt,"stmt");};var τ340=mode;var other;if((τ340==="expr")){var x=["send",["lambda",[],orig],["array"]];return translate(x,mode);}else{if((τ340==="return")){var stmts=b.slice(0,(-1));var ret=send(b,(b.length-1));return (stmts.map(trst).join("")+translate(ret,"return"));}else{if((τ340==="stmt")){return b.map(trst).join("");}else{if(((other=τ340),true)){throw "OopsH";}else{throw ["Could not find a match",τ340];}}}}});(translate["expr"]=function(x,τ341){var τ342=τ341;var other;if((τ342==="expr")){return x;}else{if((τ342==="stmt")){return (x+";");}else{if((τ342==="return")){return (("return "+x)+";");}else{if(((other=τ342),true)){throw "OopsI";}else{throw ["Could not find a match",τ342];}}}}});(translate["op"]=function(op,a,b){var e=function(){var τ343=[a,b];var τp0;var τp1;var τp0;var τp1;var τ344;var τ345;var τ346;var τ347;if(((τ344=(τ343 instanceof Array))&&((τ345=(τ343["#"]===(void 0)))&&((τ346=((τp0=τ343.length),true))&&((τ347=(τp0===2))&&(((τp1=τ343[0]),(τp1===null))&&(τ343[1],true))))))){return (op+translate(b,"expr"));}else{if((τ347&&(τ343[0],true,(τp1=τ343[1]),(τp1===null)))){return (translate(a,"expr")+op);}else{if(true){return ((translate(a,"expr")+op)+translate(b,"expr"));}else{throw ["Could not find a match",τ343];}}}}();return (("("+e)+")");});var generate_from_ast=function(ast){var ex=expand(stdenv,"top",["multi",ast]);return translate(ex,"stmt");};var generate=function(data,prelude){var p=parse(data);var ex=expand(stdenv,"top",["multi",p]);return ((prelude||"")+translate(ex,"stmt"));};(exports["generate"]=generate);
