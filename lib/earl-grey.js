var $237=function(type$240){var f$244;(f$244=type$240["::check"]);if((f$244===(void 0))){return function(value$250){return (value$250 instanceof type$240);};}else{return function(value$254){return f$244.call(type$240,value$254);};}};
var $256=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $257=function(dest$260,values$261){var k$266;(k$266=null);$264:for(k$266 in values$261){if(values$261.hasOwnProperty(k$266)){(dest$260[k$266]=values$261[k$266]);}}return dest$260;};
var $274=function($276$279){var ph$285;(ph$285=$276$279);var $281$291;($281$291=ph$285);var bridge$283$296;var x$300;(bridge$283$296=$281$291);if((((typeof(bridge$283$296)==="string")&&((x$300=bridge$283$296),true))||((typeof(bridge$283$296)==="number")&&((x$300=bridge$283$296),true)))){return ["value",x$300];}else{var other$311;(other$311=$281$291);return other$311["::serialize_ast"]();}};
var send$11;(send$11=function(obj$18,$15$19){var ph$25;var msg$26;var t0$28;(t0$28=$15$19);(msg$26=t0$28);(ph$25=t0$28);var $21$37;($21$37=ph$25);var bridge$23$42;(bridge$23$42=$21$37);if(((typeof(bridge$23$42)==="string")||(typeof(bridge$23$42)==="number"))){return obj$18[msg$26];}else{var other$54;(other$54=$21$37);return obj$18["::send"](msg$26);}});(Array[":::project"]=function($60$63){var ph$68;var value$69;var t0$71;(t0$71=$60$63);(value$69=t0$71);(ph$68=t0$71);var $65$80;($65$80=ph$68);if($237(Array)($65$80)){return [true,value$69];}else{$65$80;return [true,[value$69]];}});(Array.prototype["::check"]=function(value$98){if((value$98 instanceof Array)){var i$104;(i$104=0);$101:for(;(i$104<this.length);(i$104++)){if(($256(this,i$104)!==$256(value$98,i$104))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $257(this.slice(0),this);});(Array.prototype[":::project"]=function(value$123){if((value$123 instanceof Array)){var i$129;(i$129=0);$126:for(;(i$129<this.length);(i$129++)){if(($256(this,i$129)!==$256(value$123,i$129))){return [true,[value$123]];}}return [true,value$123.slice(this.length)];}else{return [true,[value$123]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($274));});(RegExp.prototype["::check"]=function($147$150){var ph$155;(ph$155=$147$150);var $152$161;($152$161=ph$155);var value$169;if((typeof($152$161)==="string")){(value$169=$152$161);if(value$169.match(this)){return true;}else{return false;}}else{var other$174;(other$174=$152$161);return false;}});(RegExp.prototype[":::project"]=function($180$183){var ph$188;(ph$188=$180$183);var $185$194;($185$194=ph$188);var value$202;if((typeof($185$194)==="string")){(value$202=$185$194);var $205$210;($205$210=value$202.match(this));var m$218;if(($205$210===null)){(m$218=$205$210);return [false,null];}else{var m$223;(m$223=$205$210);return [true,m$223];}}else{var other$227;(other$227=$185$194);return [false,null];}});(Function.prototype["::send"]=function(args$234){return this.apply(this,args$234);});
var $1113=function(arr$1116){var results$1122;var l$1123;(results$1122=[]);(l$1123=arr$1116.length);var i$1132;(i$1132=0);$1121:for(;(i$1132<l$1123);(i$1132++)){results$1122.push([i$1132,$256(arr$1116,i$1132)]);}return results$1122;};
var $880=function(){var $881$887;($881$887=function(tags$892){var it$0$895;(it$0$895=function(){if((!$237($881$887)(this))){return Object.create($881$887.prototype);}else{return this;}}());(it$0$895["tags"]=tags$892);return it$0$895;});($881$887.prototype["create"]=function(){var it$0$915;var self$916;(it$0$915=this);(self$916=this);var $913$925;($913$925=arguments);var t0$930;var message$934;var args$935;(t0$930=$913$925.length);if((t0$930>=0)){(message$934=function(){if((0>=t0$930)){return "";}else{return $913$925[0];}}());(args$935=Array.prototype.slice.call($913$925,1));var e$948;(e$948=Error(message$934));(e$948["::tags"]=it$0$915.tags);(e$948["args"]=args$935);var temp$964;(temp$964=$1113(args$935));var $length$970;($length$970=temp$964.length);var $index$976;($index$976=0);$949:for(;($index$976<$length$970);($index$976++)){var m$985;(m$985=temp$964[$index$976]);var t0$990;var t1$991;var i$995;var arg$996;(t0$990=m$985);if(((t0$990 instanceof Array)&&(((t1$991=t0$990.length)),(t1$991===2)))){(i$995=t0$990[0]);(arg$996=t0$990[1]);(e$948[i$995]=arg$996);}else{$861(m$985);}}(e$948["length"]=args$935.length);(e$948["name"]=["E"].concat(it$0$915.tags).join("."));return e$948;}else{$861($913$925);}});($881$887.prototype["::check"]=function(e$1026){var it$0$1030;var self$1031;(it$0$1030=this);(self$1031=this);var tags$1041;if(((!e$1026)||(!$237(Error)(e$1026)))){return false;}(tags$1041=(e$1026["::tags"]||[]));var temp$1052;(temp$1052=it$0$1030.tags);var $length$1058;($length$1058=temp$1052.length);var $index$1064;($index$1064=0);$1042:for(;($index$1064<$length$1058);($index$1064++)){var m$1073;(m$1073=temp$1052[$index$1064]);var tag$1081;(tag$1081=m$1073);if((tags$1041.indexOf(tag$1081)===-1)){return false;}else{false;}}return true;});($881$887.prototype["::deconstruct"]=function(e$1090){var it$0$1094;var self$1095;(it$0$1094=this);(self$1095=this);return e$1090.args;});$257($881$887,$257(function(){var accum$1106;(accum$1106=({}));(accum$1106["::name"]="$881");return accum$1106;}(),function(){var accum$1110;(accum$1110=({}));(accum$1110["::egclass"]=true);return accum$1110;}()));return $881$887;}();
var $861=function(value$864,url$865,start$866,end$867){var err$871;(err$871=$880(["match"]).create("Could not find a match for value",({"value":value$864})));if(url$865){(err$871["location"]=["location",url$865,start$866,end$867]);}throw err$871;};
var $1139=function($1141$1144,key$1145){var ph$1153;(ph$1153=$1141$1144);var $1147$1159;($1147$1159=ph$1153);var bridge$1149$1164;(bridge$1149$1164=$1147$1159);if(((bridge$1149$1164===null)||(bridge$1149$1164===(void 0)))){return false;}else{var x$1176;if((typeof($1147$1159)==="string")){(x$1176=$1147$1159);return (key$1145 in String.prototype);}else{var x$1181;if((typeof($1147$1159)==="number")){(x$1181=$1147$1159);return (key$1145 in Number.prototype);}else{var x$1186;(x$1186=$1147$1159);return (key$1145 in x$1186);}}}};
var $1188=function(obj$1191){var results$1196;(results$1196=[]);var k$1201;(k$1201=null);$1195:for(k$1201 in obj$1191){if(Object.prototype.hasOwnProperty.call(obj$1191,k$1201)){results$1196.push([k$1201,$256(obj$1191,k$1201)]);}}return results$1196;};
var $1205=function(type$1208){return function(value$1212){var f$1216;(f$1216=type$1208[":::project"]);if((f$1216===(void 0))){(f$1216=type$1208["::project"]);if((f$1216===(void 0))){return [true,type$1208(value$1212)];}else{var rval$1229;(rval$1229=false);try{(rval$1229=[true,f$1216(value$1212)]);}catch(excv$1240){var e$1246;(e$1246=excv$1240);(rval$1229=[false,null]);}return rval$1229;}}else{return f$1216.call(type$1208,value$1212);}};};var accum$821;var accum$825;var $315$341;var Source$342;var Location$343;var highlight_locations$344;var $316$345;var tokenize$346;var $317$347;var parse$348;var $318$349;var translate$350;var Translator$351;var std$352;var exp$353;var opt$354;var version$355;var generate_from_ast$356;var generate$357;var Generator$358;($315$341=require("./location"));(Source$342=$315$341.Source);(Location$343=$315$341.Location);(highlight_locations$344=$315$341.highlight_locations);($316$345=require("./lex"));(tokenize$346=$316$345.tokenize);($317$347=require("./parse"));(parse$348=$317$347.parse);($318$349=require("./translate-js"));(translate$350=$318$349.translate);(Translator$351=$318$349.Translator);(std$352=require("./stdenv"));(exp$353=require("./expand"));(opt$354=require("./opt"));(version$355="zero");(generate_from_ast$356=function(ast$408){var ex$415;var tr$416;var rval$417;(ex$415=std$352.expand(["top"],std$352.topscope,std$352.stdenv.fork().mark(["multi",ast$408])));(ex$415=opt$354.hoist(ex$415));(tr$416=Translator$351());(rval$417=tr$416.translate(ex$415,"expr"));return [tr$416.dump_store(),rval$417];});std$352.stdenv.bind(std$352.topscope,"macro",["macro",function(context$435,scope$436,form$437,$432$438){var t0$502;var t1$503;var prep$497;var code$498;var mac$499;var mac2$500;var name$461;var sym$462;var arguments$463;var ast$464;var t0$453;var t1$454;var t2$455;var t3$456;var t4$457;var $440$448;var ph$442;(ph$442=$432$438);($440$448=ph$442);if((($440$448 instanceof Array)&&(((t0$453=$440$448.length)),((t0$453===3)&&(($440$448[0]==="data")&&(((t1$454=$440$448[1])),((t1$454 instanceof Array)&&(((t2$455=t1$454.length)),((t2$455===3)&&((t1$454[0]==="send")&&(((t3$456=t1$454[1])),((name$461=t3$456),((t3$456 instanceof Array)&&(((t4$457=t3$456.length)),((t4$457===2)&&(t3$456[0]==="symbol")))))))))))))))){(sym$462=t3$456[1]);(arguments$463=t1$454[2]);(ast$464=$440$448[2]);(t0$502=generate_from_ast$356(["send",["symbol","->"],["data",arguments$463,ast$464]]));if(((t0$502 instanceof Array)&&(((t1$503=t0$502.length)),(t1$503===2)))){(prep$497=t0$502[0]);(code$498=t0$502[1]);}else{$861(generate_from_ast$356(["send",["symbol","->"],["data",arguments$463,ast$464]]),"/home/olivier/git/earl-grey/src/earl-grey.eg",805,855);}(mac$499=eval((prep$497+((";("+code$498)+")"))));(mac2$500=function(c$523,s$524,f$525,e$526){var bindings$533;var env$534;var r$535;(bindings$533=form$437.env.list_bindings(scope$436));(env$534=exp$353.Env());(env$534.scopes[std$352.topscope.name]=bindings$533);(r$535=mac$499(c$523,s$524,f$525,e$526));return env$534.mark(r$535);});return ["declare_raw",name$461,["macro",mac2$500]];}else{$861($440$448);}}]);std$352.stdenv.bind(std$352.topscope,"macros",["macro",function(context$557,scope$558,$552$559,$554$560){var t0$565;var t0$574;var t1$575;var t0$595;var t1$596;var $index$636;var $length$630;var temp$624;var acc$618;var prep$591;var code$592;var the_macros$593;var env$562;var body$563;(t0$565=$552$559);if($1139(t0$565,"env")){(env$562=t0$565.env);}else{$861($552$559);}(t0$574=$554$560);if(((t0$574 instanceof Array)&&(((t1$575=t0$574.length)),((t1$575===2)&&(t0$574[0]==="data"))))){(body$563=t0$574[1]);}else{$861($554$560);}(t0$595=generate_from_ast$356(body$563));if(((t0$595 instanceof Array)&&(((t1$596=t0$595.length)),(t1$596===2)))){(prep$591=t0$595[0]);(code$592=t0$595[1]);}else{$861(generate_from_ast$356(body$563),"/home/olivier/git/earl-grey/src/earl-grey.eg",1613,1643);}(the_macros$593=eval((((prep$591+";(")+code$592)+")")));return ["splice"].concat((((acc$618=[])),(((temp$624=$1188(the_macros$593))),((($length$630=temp$624.length)),((($index$636=0)),function(){$613:for(;($index$636<$length$630);($index$636++)){var k$655;var v$656;var t0$650;var t1$651;var m$645;(m$645=temp$624[$index$636]);(t0$650=m$645);if(((t0$650 instanceof Array)&&(((t1$651=t0$650.length)),(t1$651===2)))){(k$655=t0$650[0]);(v$656=t0$650[1]);acc$618.push(["declare_raw",$257(["symbol",k$655],({"env":env$562})),["macro",v$656]]);}else{$861(m$645,"/home/olivier/git/earl-grey/src/earl-grey.eg",1713,1820);}}}()))),acc$618));}]);(generate$357=function(source$675){return Generator$358().generate(source$675);});(Generator$358=function(){var interactive$702;var t0$698;var $689$693;var it$0$684;(it$0$684=function(){if((!$237(Generator$358)(this))){return Object.create(Generator$358.prototype);}else{return this;}}());($689$693=arguments);(t0$698=$689$693.length);if(((t0$698>=0)&&(t0$698<=1))){(interactive$702=function(){if((0>=t0$698)){return false;}else{return $689$693[0];}}());(it$0$684["tr"]=Translator$351(std$352.stdprelude));(it$0$684["env"]=std$352.stdenv.fork());(it$0$684["interactive"]=interactive$702);}else{$861($689$693);}return it$0$684;});(Generator$358.prototype["generate"]=function(){var t0$788;var t1$789;var t2$790;var args$786;var stmt$781;var t$767;var p$768;var ex$769;var rval$770;var source$753;var dump$754;var t0$749;var $732$744;var it$0$734;var self$735;(it$0$734=this);(self$735=this);($732$744=arguments);(t0$749=$732$744.length);if(((t0$749>=1)&&(t0$749<=2))){(source$753=$732$744[0]);(dump$754=function(){if((1>=t0$749)){return true;}else{return $732$744[1];}}());(t$767=tokenize$346(source$753));(p$768=parse$348(t$767));(ex$769=(((stmt$781=function(){if(it$0$734.interactive){(t0$788=$1205(["multi"])(p$768));if((t0$788[0]&&(((t1$789=t0$788[1])),(((t2$790=t1$789.length)),(t2$790>=0))))){(args$786=Array.prototype.slice.call(t1$789,0));}else{$861(p$768,"/home/olivier/git/earl-grey/src/earl-grey.eg",2599,2600);}return ["interactive"].concat(args$786);}else{return ["multi",p$768];}}())),std$352.expand(["top"],std$352.topscope,it$0$734.env.mark(stmt$781))));(ex$769=opt$354.hoist(ex$769));(rval$770=it$0$734.tr.translate(ex$769,"stmt"));if(dump$754){return (it$0$734.tr.dump_store()+rval$770);}else{return rval$770;}}else{$861($732$744);}});$257(Generator$358,$257(((accum$821=({})),((accum$821["::name"]="Generator"),accum$821)),((accum$825=({})),((accum$825["::egclass"]=true),accum$825))));Generator$358;(exports["Source"]=Source$342);(exports["Location"]=Location$343);(exports["highlight_locations"]=highlight_locations$344);(exports["tokenize"]=tokenize$346);(exports["parse"]=parse$348);(exports["Generator"]=Generator$358);(exports["generate"]=generate$357);(exports["version"]=version$355);
