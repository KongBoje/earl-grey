var τ26=function(type){var τ27=type["::check"];var f;if((τ27===(void 0))){return function(value){return (value instanceof type);};}else{if(((f=τ27),true)){return function(value){return f.call(type,value);};}else{throw τ18(["match"]).create("Could not find a match",({"value":τ27}));}}};
var τ28=function(dest,values){for(k in values){if(values.hasOwnProperty(k)){(dest[k]=send(values,k));}else{null;}}return dest;};
var τ18=function(){var τ19=function(tags){var τ20=function(){if((!τ26(τ19)(this))){return Object.create(τ19.prototype);}else{return this;}}();(τ20["tags"]=tags);return τ20;};τ28(τ19);(τ19.prototype["create"]=function(){var τ21=Array.prototype.slice.call(arguments,0);var τp0;var message;var args;if(((τ21 instanceof Array)&&(((τp0=τ21.length),true)&&((τp0>=0)&&((message=function(){if((0>=τp0)){return "";}else{return τ21[0];}}()),true,(args=τ21.slice(1)),true))))){var τ20=this;var e=Error(message);(e["::tags"]=τ20.tags);(e["args"]=args);(e["name"]=["E"].concat(τ20.tags).join("."));return e;}else{throw τ18(["match"]).create("Could not find a match",({"value":τ21}));}});(τ19.prototype["::check"]=function(e){var τ20=this;if(((!e)||(!τ26(Error)(e)))){return false;}else{null;}var tags=(e["::tags"]||[]);var τ22=τ20.tags;var τ23=τ22.length;for(var τ24=0;(τ24<τ23);(τ24++)){var τ25=τ22[τ24];var tag;var other;if(((tag=τ25),true,(tags.indexOf(tag)===(-1)))){return false;}else{if(((other=τ25),true)){false;}else{throw τ18(["match"]).create("Could not find a match",({"value":τ25}));}}}false;return true;});(τ19.prototype["::deconstruct"]=function(e){var τ20=this;return e.args;});return τ19;}();
var τ29=function(){var r=[];for(var i=0;(i<arguments.length);(i++)){(r=r.concat(arguments[i]));}return r;};
var τ30=function(τ31){var τ32=τ31;var x;var x;var other;if((((typeof(τ32)==="string")&&((x=τ32),true))||((typeof(τ32)==="number")&&((x=τ32),true)))){return ["value",x];}else{if(((other=τ32),true)){return other["::serialize_ast"]();}else{throw τ18(["match"]).create("Could not find a match",({"value":τ32}));}}};
var send=function(obj,τ11){var msg;var τ10;(msg=τ11);true;(τ10=τ11);var τ12=τ10;var other;if(((typeof(τ12)==="string")||(typeof(τ12)==="number"))){return obj[msg];}else{if(((other=τ12),true)){return obj["::send"](msg);}else{throw τ18(["match"]).create("Could not find a match",({"value":τ12}));}}};(Array[":::project"]=function(τ14){var value;var τ13;(value=τ14);true;(τ13=τ14);var τ15=τ13;var _;if(τ26(Array)(τ15)){return [true,value];}else{if(((_=τ15),true)){return [true,[value]];}else{throw τ18(["match"]).create("Could not find a match",({"value":τ15}));}}});(Array.prototype["::check"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){return false;}else{null;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){var rval=this.slice(0);rval.push(value);return [true,rval];}else{null;}}return [true,value];}else{var rval=this.slice(0);rval.push(value);return [true,rval];}});(Array.prototype[":::deconstruct"]=function(value){return [true,value.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return τ29(["array"],this.map(τ30));});(RegExp.prototype["::check"]=function(value){return value.match(this);});(RegExp.prototype[":::project"]=function(value){var τ16=value.match(this);var m;var m;if(((τ16===null)&&((m=τ16),true))){return [false,null];}else{if(((m=τ16),true)){return [true,m];}else{throw τ18(["match"]).create("Could not find a match",({"value":τ16}));}}});(RegExp.prototype[":::deconstruct"]=function(value){var τ17=value.match(this);var m;var m;if(((τ17===null)&&((m=τ17),true))){return [false,null];}else{if(((m=τ17),true)){return [true,m];}else{throw τ18(["match"]).create("Could not find a match",({"value":τ17}));}}});(Function.prototype["::send"]=function(args){return this.apply(this,args);});
var τ40=function(type){return function(value){var τ41=type[":::project"];var f;if((τ41===(void 0))){var τ42=type["::project"];var f;if((τ42===(void 0))){return [true,type(value)];}else{if(((f=τ42),true)){var τ44;try{(τ44=[true,f(value)]);}catch(τ43){(τ44=[false,null]);}return τ44;}else{throw τ18(["match"]).create("Could not find a match",({"value":τ42}));}}}else{if(((f=τ41),true)){return f.call(type,value);}else{throw τ18(["match"]).create("Could not find a match",({"value":τ41}));}}};};var τ33=require("./location");var Source=τ33.Source;var Location=τ33.Location;var highlight_locations=τ33.highlight_locations;var τ34=require("./lex");var tokenize=τ34.tokenize;var τ35=require("./parse");var parse=τ35.parse;var τ36=require("./expand");var expand=τ36.expand;var τ37=require("./stdenv");var stdenv=τ37.stdenv;var stdprelude=τ37.stdprelude;var τ38=require("./translate-js");var translate=τ38.translate;var Translator=τ38.Translator;var e2=require("./expand2");var generate_from_ast=function(ast){var ex=expand(["top",stdenv.fork()],["multi",ast]);return translate(ex,"stmt");};var generate=function(source,prelude){var t=tokenize(source);var p=parse(t);var ex=expand(["top",stdenv.fork()],["multi",p]);return ((prelude||"")+translate(ex,"stmt"));};var generate2=function(source){var t=tokenize(source);var p=parse(t);var ex=e2.expand(["top"],e2.topscope,e2.bind_ast(τ40(["multi"])(p)[1],e2.stdenv.fork()));(ex=e2.hoist(ex));var tr=Translator();var rval=tr.translate(ex,"stmt");return (tr.dump_store()+rval);};var Generator=function(){var τ39=function(){if((!τ26(Generator)(this))){return Object.create(Generator.prototype);}else{return this;}}();(τ39["tr"]=Translator(stdprelude));return τ39;};τ28(Generator);(Generator.prototype["generate"]=function(source){var τ39=this;var t=tokenize(source);var p=parse(t);var ex=expand(["top",stdenv.fork()],["multi",p]);var rval=τ39.tr.translate(ex,"stmt");return (τ39.tr.dump_store()+rval);});Generator;(exports["Source"]=Source);(exports["Location"]=Location);(exports["highlight_locations"]=highlight_locations);(exports["tokenize"]=tokenize);(exports["parse"]=parse);(exports["generate_from_ast"]=generate_from_ast);(exports["generate"]=generate);(exports["Generator"]=Generator);(exports["generate2"]=generate2);
