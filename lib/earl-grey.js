var augment=function(dest,values){for(k in values){(dest[k]=send(values,k));}return dest;};var escape_html=function(s){var repl=({"&":"&amp;","<":"&lt;",">":"&gt;"});return s.replace(RegExp("[&<>]","g"),function(x){return send(repl,x);});};var quotify=function(s){return s.replace(RegExp("[\"\\\\]","g"),function(x){return ("\\"+x);});};var create_node=function(tag,id,classes,kv,τ550){var τp0;var contents;if((((τp0=projector(Array)(τ550)),τp0[0])&&((contents=τp0[1]),true))){false;}else{throw "a condition failed";}(classes=function(){var τ551=[];var τ552=classes;var τ553=τ552.length;for(var τ554=0;(τ554<τ553);(τ554++)){var τ555=τ552[τ554];var x;var other;if((checker(RegExp("(?:.+)",""))(τ555)&&((x=τ555),true))){τ551.push(x);}else{if(((other=τ555),true)){false;}else{throw ["Could not find a match",τ555];}}}return τ551;}());var accum=["<",tag];if(id){(accum=accum.concat(" id=\"",id,"\""));}else{false;}if(classes.length){(accum=accum.concat(" class=\"",classes.join(" "),"\""));}else{false;}if(kv){var τ556=[];var τ557=kv;var τ558=τ557.length;for(var τ559=0;(τ559<τ558);(τ559++)){var τ560=τ557[τ559];var τp0;var k;var v;var other;if(((τ560 instanceof Array)&&((τ560["#"]===undefined)&&(((τp0=τ560.length),true)&&((τp0===2)&&((k=τ560[0]),true,(v=τ560[1]),true)))))){τ556.push((accum=accum.concat([" ",k,"=\"",v,"\""])));}else{if(((other=τ560),true)){false;}else{throw ["Could not find a match",τ560];}}}τ556;}else{false;}var x=patch_array([">"],contents,["</",tag,">"]);return accum.concat(x).join("");};var patch_array=function(){var r=[];for(var i=0;(i<arguments.length);(i++)){(r=r.concat(arguments[i]));}return r;};var range=function(from,to){var rval=[];for(var i=from;(i<=to);(i++)){rval.push(i);}return rval;};var StructFactory=function(name){var make=function(){var r=Array.prototype.slice.call(arguments,0);(r["#"]=name);return r;};(make[":::project"]=function(value){if(((value instanceof Array)&&(value["#"]===name))){return [true,value];}else{if(true){return [true,make(value)];}else{return false;}}});(make["::check"]=function(value){if(((value instanceof Array)&&(value["#"]===name))){return true;}else{if(true){return false;}else{return false;}}});(make[":::deconstruct"]=function(value){if(((value instanceof Array)&&(value["#"]===name))){return [true,value.slice(0)];}else{if(true){return [false,false];}else{return false;}}});(make["___check"]=make["::check"]);(make["___project"]=make[":::project"]);(make["___deconstruct"]=make[":::deconstruct"]);return make;};var Struct=function(name){var r=Array.prototype.slice.call(arguments,1);(r["#"]=name);return r;};(Struct["::check"]=function(value){if((value instanceof Array)){return (value["#"]!==undefined);}else{if(true){return false;}else{return false;}}});(Struct[":::deconstruct"]=function(value){if(((value instanceof Array)&&(value["#"]!==undefined))){return [true,[value["#"]].concat(value.slice(0))];}else{if(true){return [false,null];}else{return false;}}});(Struct["___check"]=Struct["::check"]);(Struct["___deconstruct"]=Struct[":::deconstruct"]);var pr=function(x){var r=repr(x);var pre=(String.fromCharCode(27)+"[?0;7y+h <div class=\"ug\">");var post=("</div>"+String.fromCharCode(7));return console.log(((pre+r)+post));};var repr=function(τ562){var x;var τ561;(x=τ562);true;(τ561=τ562);var τ563=τ561;var τp0;var τp1;var τp2;var tag;var entries;var entries;var other;if((τ563===true)){return create_node("span",null,["special","true"],[],"true");}else{if((τ563===false)){return create_node("span",null,["special","false"],[],"false");}else{if((τ563===null)){return create_node("span",null,["special","nil"],[],"null");}else{if((τ563===(void 0))){return create_node("span",null,["special","nil"],[],"undefined");}else{if((typeof(τ563)==="number")){return create_node("span",null,["num"],[],String(x));}else{if((typeof(τ563)==="string")){return create_node("span",null,["str"],[],x);}else{if((checker(Struct)(τ563)&&(((τp0=deconstructor(Struct)(τ563)),τp0[0])&&(((τp1=τp0[1]),(τp1 instanceof Array))&&((τp1["#"]===undefined)&&(((τp2=τp1.length),true)&&((τp2>=1)&&((tag=τp1[0]),true,(entries=τp1.slice(1)),true)))))))){return create_node("span",null,["struct"],[],[create_node("span",null,["sym"],[],tag),create_node("span",null,["sequence"],[],entries.map(repr))]);}else{if((checker(Array)(τ563)&&((entries=τ563),true))){return create_node("span",null,["sequence"],[],entries.map(repr));}else{if(((other=τ563),true)){return create_node("span",null,["unknown"],[],other.toString());}else{throw ["Could not find a match",τ563];}}}}}}}}}};var send=function(obj,msg){var τ564=msg;var other;if(((typeof(τ564)==="string")||(typeof(τ564)==="number"))){return obj[msg];}else{if(((other=τ564),true)){return obj.___send(msg);}else{throw ["Could not find a match",τ564];}}};(Function.prototype["___send"]=function(args){return this.apply(this,args);});var checker=function(type){var τ565=type["::check"];var f;if((τ565===(void 0))){return function(value){return (value instanceof type);};}else{if(((f=τ565),true)){return function(value){return f.call(type,value);};}else{throw ["Could not find a match",τ565];}}};var projector=function(type){return function(value){var τ566=type[":::project"];var f;if((τ566===(void 0))){var τ567=type["::project"];var f;if((τ567===(void 0))){return [true,type(value)];}else{if(((f=τ567),true)){var τ569;try{(τ569=[true,f(value)]);}catch(τ568){(τ569=[false,null]);}return τ569;}else{throw ["Could not find a match",τ567];}}}else{if(((f=τ566),true)){return f.call(type,value);}else{throw ["Could not find a match",τ566];}}};};var deconstructor=function(type){return function(value){var τ570=type[":::deconstruct"];var f;if((τ570===(void 0))){var τ571=type["::deconstruct"];var f;if((τ571===(void 0))){if((value instanceof Array)){return [true,value];}else{if(true){return [false,null];}else{return false;}}}else{if(((f=τ571),true)){var τ573;try{(τ573=[true,f.call(this,value)]);}catch(τ572){(τ573=[false,null]);}return τ573;}else{throw ["Could not find a match",τ571];}}}else{if(((f=τ570),true)){return f.call(this,value);}else{throw ["Could not find a match",τ570];}}};};(Array[":::project"]=function(value){var τ574=value;if(checker(Array)(τ574)){return [true,value];}else{if(true){return [true,[value]];}else{throw ["Could not find a match",τ574];}}});(Array["___project"]=Array[":::project"]);(RegExp.prototype["::check"]=function(value){return value.match(this);});(RegExp.prototype[":::project"]=function(value){var τ575=value.match(this);var m;var m;if(((τ575===null)&&((m=τ575),true))){return [false,null];}else{if(((m=τ575),true)){return [true,m];}else{throw ["Could not find a match",τ575];}}});(RegExp.prototype["___check"]=RegExp.prototype["::check"]);(RegExp.prototype["___project"]=RegExp.prototype[":::project"]);
var special_ops=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",":":"IFX",".":"PFX","'":"PFX"});var regexps=function(){var id=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))","");var id_f=function(m,wsb,wsa,last_op){return ["ID","ID",m[0]];};var numr=RegExp("(?:^((?:\\d+))[rR]((?:[A-Za-z0-9_]+))(?:(?:\\.((?:[A-Za-z0-9_]+)))?))","");var numr_f=function(m,wsb,wsa,last_op){var τp0;var radix;var int;var frac;if(((m instanceof Array)&&((m["#"]===undefined)&&(((τp0=m.length),true)&&((τp0===4)&&(m[0],true,(radix=m[1]),true,(int=m[2]),true,(frac=m[3]),true)))))){false;}else{throw "a condition failed";}(value=parseInt(int.replace(RegExp("_","g"),""),radix));if(frac){(frac=frac.replace(RegExp("_","g"),""));(value=(value+(parseInt(frac,radix)/Math.pow(radix,frac.length))));}else{false;}return ["ID","NUM",value];};var num=RegExp("(?:^((?:[0-9_]+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:[0-9_]+)))?))","");var num_f=function(m,wsb,wsa,last_op){return ["ID","NUM",parseFloat(m[0].replace(RegExp("_","g"),""))];};var str=RegExp("(?:^\"((?:(?:(?:\\\\\\\\|\\\\\")|[^\"])*))\")","");var str_f=function(m,wsb,wsa,last_op){var repl=({"\\\"":"\"","\\\\":"\\","\\n":"\n"});var r=m[1].replace(RegExp("((?:(?:\\\\\"|\\\\\\\\)|\\\\n))","g"),function(m){return send(repl,m);});return ["ID","STR",r];};var op=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!@#.:']+))","");var op2=RegExp("(?:^[\\[\\{\\}\\],])","");var op3=RegExp("(?:^(?:(?:(?:(?:(?:(?:(?:(?:(?:(?:with|where)|when)|and)|not)|or)|in)|instanceof)|mod)|each)|as)\\b)","");var op4=RegExp("(?:^`((?:[A-Za-z0-9_]+))`)","");var op_f=function(m,wsb,wsa,last_op,column){var op=(m[1]||m[0]);if((op==="|")){return ["INDENT",(column-1)];}else{if((op in special_ops)){var fixity=send(special_ops,op);var width=function(){var τ0=fixity;var other;if((τ0==="IFX")){if((wsb||wsa)){return "wide";}else{return "short";}}else{if((τ0==="SFX")){if(wsb){return "wide";}else{return "short";}}else{if((τ0==="PFX")){if(wsa){return "wide";}else{return "short";}}else{if(((other=τ0),true)){throw "OopsA";}else{throw ["Could not find a match",τ0];}}}}}();return ["OP",fixity,width,op];}else{if((wsa&&wsb)){return ["OP",function(){if(last_op){return "PFX";}else{return "IFX";}}(),"wide",op];}else{if(((!wsa)&&(!wsb))){return ["OP",function(){if(last_op){return "PFX";}else{return "IFX";}}(),"short",op];}else{if((wsa&&last_op)){return ["OP","PFX","wide",op];}else{if(wsa){return ["OP","SFX","short",op];}else{if(wsb){return ["OP","PFX","short",op];}else{if(true){return ["OP","PFX","short",op];}else{return false;}}}}}}}}};var indent=RegExp("(?:^(?:(?:\n((?: *)))+))","");var indent_f=function(m,wsb,wsa,last_op){var ilen=m[1].length;return ["INDENT",ilen];};var cmnt=RegExp("(?:^;(?:[^\n]*))","");var cmnt_f=function(m,wsb,wsa,last_op){return ["IGNORE"];};var unkn=RegExp("(?:^.)","");var unkn_f=function(m,wsb,wsa,last_op){throw ("unknown character: "+m[0]);};return [[op3,op_f],[id,id_f],[numr,numr_f],[num,num_f],[str,str_f],[op,op_f],[op2,op_f],[op4,op_f],[indent,indent_f],[cmnt,cmnt_f],[unkn,unkn_f]];}();var ws_re=RegExp("(?:^(?: *)(?:(?:\n(?: *)\\\\(?: *))*))","");var eol_re=RegExp("(?:^(?: *)(?:\n|$))","");var indent_tracker=function(){var curr=false;var stack=[];var stacks=[stack];return function(τ2){var token;var τ1;(token=τ2);true;(τ1=τ2);var τ3=τ1;var τp0;var τp1;var τp2;var new_indent;var τ4;var τp0;var τp1;var stuff;var τp0;var τp1;var fixity;var width;var τp2;var τp0;var τp1;var fixity;var width;var τp2;var other;var τ5=false;var τ6=false;var τ7=false;var τ8=false;var τ9=false;if(((τ5=(τ3 instanceof Array))&&((τ6=(τ3["#"]===undefined))&&((τ7=((τp0=τ3.length),true))&&((τp0===2)&&(((τp1=τ3[0]),(τp1==="INDENT"))&&((τp2=τ3[1]),(new_indent=τp2),true,(τ4=τp2),true))))))){var τ10=τ4;if((curr===false)){(curr=new_indent);return [["OP","IFX","wide",","]];}else{if((τ10>curr)){send(stack.push(curr),(curr=new_indent));return [["OP","PFX","wide","["]];}else{if((τ10===curr)){return [["OP","IFX","wide",","]];}else{if((τ10<curr)){var rval=[];while(((stack.length>0)&&(new_indent<curr))){(curr=stack.pop());rval.push(["OP","SFX","wide","]"]);}rval.push(["OP","IFX","wide",","]);return rval;}else{throw ["Could not find a match",τ10];}}}}}else{if((τ7&&((τp0>=1)&&(((τp1=τ3[0]),(τp1==="ID"))&&((stuff=τ3.slice(1)),true))))){return [token];}else{if((τ7&&((τ8=(τp0===4))&&((τ9=((τp1=τ3[0]),(τp1==="OP")))&&((fixity=τ3[1]),true,(width=τ3[2]),true,(τp2=τ3[3]),((τp2==="[")||(τp2==="{"))))))){stack.push(curr);stacks.push(stack);(stack=[]);(curr=false);return [token];}else{if((τ9&&((fixity=τ3[1]),true,(width=τ3[2]),true,(τp2=τ3[3]),((τp2==="]")||(τp2==="}"))))){var rval=function(){var τ11=[];var τ12=stack;var τ13=τ12.length;for(var τ14=0;(τ14<τ13);(τ14++)){var τ15=τ12[τ14];var other;if(true){τ11.push(["OP","SFX","short","]"]);}else{if(((other=τ15),true)){false;}else{throw ["Could not find a match",τ15];}}}return τ11;}();(stack=stacks.pop());(curr=stack.pop());rval.push(token);return rval;}else{if(((other=τ3),true)){return [token];}else{throw ["Could not find a match",τ3];}}}}}};};var process_token=function(token,last_op,wsa,wsb,pos,endpos,accum){var τp0;var type;var result;if(((token instanceof Array)&&((token["#"]===undefined)&&(((τp0=token.length),true)&&((τp0>=1)&&((type=token[0]),true,(result=token.slice(1)),true)))))){false;}else{throw "a condition failed";}var τ16=type;var other;if((τ16==="IGNORE")){return last_op;}else{if((τ16==="ID")){if((!last_op)){var w=["IFX",function(){if(wsb){return "wide";}else{return "short";}}(),"WHITE"];(w["location"]=[pos,pos]);accum.push(w);}else{false;}accum.push(result);return false;}else{if((τ16==="OP")){if(last_op){var v=["VOID"];(v["location"]=[pos,pos]);accum.push(v);}else{false;}var τ17=result[0];if((τ17==="IFX")){accum.push(result);return true;}else{if((τ17==="PFX")){if((!last_op)){var w=["IFX",function(){if(wsb){return "wide";}else{return "short";}}(),"WHITE"];(w["location"]=[pos,pos]);var v=["VOID"];(v["location"]=[pos,pos]);accum.push(w);accum.push(v);}else{false;}accum.push(result);return true;}else{if((τ17==="SFX")){accum.push(result);var v=["VOID"];(v["location"]=[endpos,endpos]);accum.push(v);return false;}else{throw ["Could not find a match",τ17];}}}}else{if(((other=τ16),true)){throw "OopsB";}else{throw ["Could not find a match",τ16];}}}}};var tokenize=function(text){var last_op=true;var results=[];var wsb=text.match(ws_re)[0].length;(text=text.slice(wsb));(pos=wsb);(column=0);var indent=indent_tracker();while(text){for(var i=0;(i<regexps.length);(++i)){var τp0;var τp1;var re;var fn;if((((τp0=send(regexps,i)),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((re=τp0[0]),true,(fn=τp0[1]),true)))))){false;}else{throw "a condition failed";}var m=text.match(re);if(m){var skip=m[0].length;var endpos=(pos+skip);(column=function(){var splits=m[0].split("\n");if((splits.length>1)){return send(splits,(splits.length-1)).length;}else{if(true){return (column+skip);}else{return false;}}}());(text=text.slice(skip));var wsa=text.match(ws_re)[0].length;var eol=(text.match(eol_re)&&true);var bwsb=(wsb>0);var bwsa=function(){if(eol){return bwsb;}else{return (wsa>0);}}();var token=fn(m,bwsb,bwsa,last_op,column);var tokens=indent(token);var τ18=tokens;var τ19=τ18.length;for(var τ20=0;(τ20<τ19);(τ20++)){var τ21=τ18[τ20];var x;var other;if(((x=τ21),true)){(last_op=process_token(x,last_op,bwsa,bwsb,pos,endpos,results));}else{if(((other=τ21),true)){false;}else{throw ["Could not find a match",τ21];}}}false;(text=text.slice(wsa));(column=(column+wsa));(wsb=wsa);(pos=(endpos+wsa));break;}else{false;}}}if(last_op){var v=["VOID"];(v["location"]=[pos,pos]);results.push(v);}else{false;}return results;};var MAX=(1/0);var order_map=({"IFX":({"wide":({",":[[15,1],[15,1]],"with":[[15,999],[15,10]],"each":[[15,11],[15,10]],"where":[[15,11],[15,10]],"!!":[[15,11],[15,10]],"|>":[[15,11],[15,10]],"->":[[15,11],[15,10]],"=>":[[15,11],[15,10]],"=":[[15,11],[15,10]],":=":[[15,11],[15,10]],"+=":[[15,11],[15,10]],"-=":[[15,11],[15,10]],"*=":[[15,11],[15,10]],"/=":[[15,11],[15,10]],"<<=":[[15,11],[15,10]],">>=":[[15,11],[15,10]],">>>=":[[15,11],[15,10]],"%":[[15,11],[15,10]],"when":[[15,100],[15,101]],"||":[[15,110],[15,111]],"&&":[[15,120],[15,121]],"or":[[15,110],[15,111]],"and":[[15,120],[15,121]],"not":[[15,130],[15,131]],"==":[[15,200],[15,201]],"!=":[[15,200],[15,201]],">=":[[15,200],[15,201]],"<=":[[15,200],[15,201]],">":[[15,200],[15,201]],"<":[[15,200],[15,201]],"^.":[[15,400],[15,401]],"|.":[[15,410],[15,411]],"&.":[[15,420],[15,421]],"<<":[[1,500],[1,501]],">>":[[1,500],[1,501]],">>>":[[1,500],[1,501]],"+":[[1,550],[1,551]],"-":[[1,550],[1,551]],"*":[[1,560],[1,561]],"/":[[1,560],[1,561]],"mod":[[1,560],[1,561]],"**":[[1,571],[1,570]],"default":[[8,900],[4,901]],"WHITE":[[15,1002],[15,1001]],":":[[15,1001],[15,2]]}),"short":({"default":[[15,1800],[15,1801]],"WHITE":[[15,2000],[15,2001]],",":[[15,1],[15,1]],":":[[15,1001],[15,2]]})}),"PFX":({"wide":({"default":[[15,MAX],[15,900]],"when":[[15,MAX],[15,101]],"not":[[15,MAX],[15,131]],".":[[15,MAX],[15,3000]],"#":[[15,MAX],[15,3000]],"~":[[15,MAX],[15,3000]],"@":[[15,MAX],[15,3000]],"<>":[[15,MAX],[15,5]],"(":[[15,MAX],[15,1]],"[":[[15,MAX],[15,1]],"{":[[15,MAX],[15,1]]}),"short":({"default":[[15,MAX],[15,1901]],".":[[15,MAX],[15,3000]],"#":[[15,MAX],[15,3000]],"~":[[15,MAX],[15,3000]],"@":[[15,MAX],[15,3000]],"(":[[15,MAX],[15,1]],"[":[[15,MAX],[15,1]],"{":[[15,MAX],[15,1]]})}),"SFX":({"wide":({"default":[[15,901],[15,MAX]],")":[[15,1],[15,MAX]],"]":[[15,1],[15,MAX]],"}":[[15,1],[15,MAX]]}),"short":({"default":[[15,1900],[15,MAX]],")":[[15,1],[15,MAX]],"]":[[15,1],[15,MAX]],"}":[[15,1],[15,MAX]]})})});var DONE=(-1);var NONE=0;var LEFT=1;var RIGHT=2;var BOTH=3;var oparse=function(next,order,finalize){var between=finalize(next());var right_op=next();var stack=[];var left_op=null;var current=null;while(true){var o=function(){if(((!left_op)&&(!right_op))){return DONE;}else{if(true){return ((((!left_op)&&RIGHT)||((!right_op)&&LEFT))||order(left_op,right_op));}else{return false;}}}();var τ22=o;var other;if((τ22===DONE)){return between;}else{if((τ22===LEFT)){current.push(between);(between=finalize(current));var v=stack.pop();(left_op=v[0]);(current=v[1]);}else{if((τ22===RIGHT)){stack.push([left_op,current]);(left_op=right_op);(current=[[right_op],between]);(between=finalize(next()));(right_op=next());}else{if((τ22===BOTH)){current[0].push(right_op);current.push(between);(left_op=right_op);(between=finalize(next()));(right_op=next());}else{if((τ22===NONE)){throw ((("Undefined priority between "+left_op)+" and ")+right_op);}else{if(((other=τ22),true)){throw "OopsC";}else{throw ["Could not find a match",τ22];}}}}}}}};var consult=function(τ23){var τp0;var fixity;var width;var op;if(((τ23 instanceof Array)&&((τ23["#"]===undefined)&&(((τp0=τ23.length),true)&&((τp0===3)&&((fixity=τ23[0]),true,(width=τ23[1]),true,(op=τ23[2]),true)))))){false;}else{throw "a condition failed";}var map=send(send(order_map,fixity),width);return (send(map,op)||map.default);};var order=function(o1,o2){var τp0;var τp1;var code1;var ord1;if((((τp0=consult(o1)[1]),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((code1=τp0[0]),true,(ord1=τp0[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var code2;var ord2;if((((τp0=consult(o2)[0]),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((code2=τp0[0]),true,(ord2=τp0[1]),true)))))){false;}else{throw "a condition failed";}if(((code1&code2)===0)){throw ["Cannot mix",o1,o2];}else{if((ord1>ord2)){return LEFT;}else{if((ord1<ord2)){return RIGHT;}else{if((ord1===ord2)){return BOTH;}else{return false;}}}}};var finalize=function(τ24){var τ25=τ24;var τp0;var τp1;var value;var τp0;var τp1;var value;var τp0;var τp1;var value;var τp0;var τp1;var τp0;var ops;var args;var other;var τ26=false;var τ27=false;var τ28=false;var τ29=false;if(((τ26=(τ25 instanceof Array))&&((τ27=(τ25["#"]===undefined))&&((τ28=((τp0=τ25.length),true))&&((τ29=(τp0===2))&&(((τp1=τ25[0]),(τp1==="ID"))&&((value=τ25[1]),true))))))){return value;}else{if((τ29&&(((τp1=τ25[0]),(τp1==="NUM"))&&((value=τ25[1]),true)))){return ["value",value];}else{if((τ29&&(((τp1=τ25[0]),(τp1==="STR"))&&((value=τ25[1]),true)))){return ["value",value];}else{if((τ28&&((τp0===1)&&((τp1=τ25[0]),(τp1==="VOID"))))){return null;}else{if((τ28&&((τp0>=1)&&((ops=τ25[0]),true,(args=τ25.slice(1)),true)))){(ops=function(){var τ40=[];var τ41=ops;var τ42=τ41.length;for(var τ43=0;(τ43<τ42);(τ43++)){var τ44=τ41[τ43];var o;var other;if(((o=τ44),true)){τ40.push(o[2]);}else{if(((other=τ44),true)){false;}else{throw ["Could not find a match",τ44];}}}return τ40;}());var op=ops[0];var τ30=[ops,args];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var f;var arg;var body;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var f;var body;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var target;var τp6;var τp7;var body;var τp0;var τp1;var τp2;var τp3;var τp0;var τp1;var τp2;var τp3;var τp0;var τp1;var τp2;var τp3;var τp0;var τp1;var τp2;var τ31;var other;var τ32=false;var τ33=false;var τ34=false;var τ35=false;var τ36=false;var τ37=false;var τ38=false;var τ39=false;if(((τ32=(τ30 instanceof Array))&&((τ33=(τ30["#"]===undefined))&&((τ34=((τp0=τ30.length),true))&&((τ35=(τp0===2))&&((τ36=((τp1=τ30[0]),(τp1 instanceof Array)))&&((τ37=(τp1["#"]===undefined))&&((τ38=((τp2=τp1.length),true))&&((τp2===2)&&(((τp3=τp1[0]),(τp3==="WHITE"))&&(((τp4=τp1[1]),(τp4===":"))&&(((τp5=τ30[1]),(τp5 instanceof Array))&&((τp5["#"]===undefined)&&(((τp6=τp5.length),true)&&((τp6===3)&&((f=τp5[0]),true,(arg=τp5[1]),true,(body=τp5[2]),true)))))))))))))))){return ["send",f,["data",arg,body]];}else{if((τ38&&((τ39=(τp2===1))&&(((τp3=τp1[0]),(τp3===":"))&&(((τp4=τ30[1]),(τp4 instanceof Array))&&((τp4["#"]===undefined)&&(((τp5=τp4.length),true)&&((τp5===2)&&((f=τp4[0]),true,(body=τp4[1]),true))))))))){return ["send",f,["data",body]];}else{if((τ39&&(((τp3=τp1[0]),(τp3==="with"))&&(((τp4=τ30[1]),(τp4 instanceof Array))&&((τp4["#"]===undefined)&&(((τp5=τp4.length),true)&&((τp5===2)&&(((target=τp4[0]),true,(τp6=τp4[1]),(τp7=projector(aslist)(τp6)),τp7[0])&&((body=τp7[1]),true))))))))){var inserted=false;var result=transform(target,function(τ45){var τ46=τ45;var x;var τp0;var τp1;var f;var τp2;var τp3;var τp4;var a;var b;var τp0;var τp1;var args;if((τ46==="...")){(inserted=true);return patch_array(["multi"],body);}else{if((((x=τ46),true,x.fromop)&&((τ46 instanceof Array)&&((τ46["#"]===undefined)&&(((τp0=τ46.length),true)&&((τp0===3)&&(((τp1=τ46[0]),(τp1==="send"))&&(((f=τ46[1]),true,(τp2=τ46[2]),(τp2 instanceof Array))&&((τp2["#"]===undefined)&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((a=τp2[1]),true,(b=τp2[2]),true))))))))))))){return ["send",this(f),["data",this(a),this(b)]];}else{if(((τ46 instanceof Array)&&((τ46["#"]===undefined)&&(((τp0=τ46.length),true)&&((τp0>=1)&&(((τp1=τ46[0]),(τp1==="data"))&&((args=τ46.slice(1)),true))))))){(tr=this);return ["data"].concat(patch_array.apply(null,function(){var τ47=[];var τ48=args;var τ49=τ48.length;for(var τ50=0;(τ50<τ49);(τ50++)){var τ51=τ48[τ50];var other;var other;var τ52=false;if((τ51==="...")){τ47.push(((inserted=true),body));}else{if((τ52=((other=τ51),true))){τ47.push([tr(other)]);}else{if(τ52){false;}else{throw ["Could not find a match",τ51];}}}}return τ47;}()));}else{throw ["Could not find a match",τ46];}}}});if((!inserted)){var τ53=target;var τp0;var τp1;var f;var τp2;var τp3;var τp4;var args;var τp0;var τp1;var args;var other;var τ54=false;var τ55=false;var τ56=false;if((τ53===null)){return patch_array(["data"],body);}else{if(target.fromop){return ["send",target,patch_array(["data"],body)];}else{if(((τ54=(τ53 instanceof Array))&&((τ55=(τ53["#"]===undefined))&&((τ56=((τp0=τ53.length),true))&&((τp0===3)&&(((τp1=τ53[0]),(τp1==="send"))&&(((f=τ53[1]),true,(τp2=τ53[2]),(τp2 instanceof Array))&&((τp2["#"]===undefined)&&(((τp3=τp2.length),true)&&((τp3>=1)&&(((τp4=τp2[0]),(τp4==="data"))&&((args=τp2.slice(1)),true)))))))))))){return ["send",f,patch_array(["data"],args,body)];}else{if((τ56&&((τp0>=1)&&(((τp1=τ53[0]),(τp1==="data"))&&((args=τ53.slice(1)),true))))){return target.concat(body);}else{if(((other=τ53),true)){return ["send",target,patch_array(["data"],body)];}else{throw ["Could not find a match",τ53];}}}}}}else{if(true){return result;}else{return false;}}}else{if((τ38&&((τ39=(τp2>=1))&&(((τp3=τp1[0]),((τp3==="[")||(τp3===",")))&&(τp1.slice(1),true,τ30[1],true))))){if((op==="[")){(args=args.slice(1,(-1)));}else{false;}(args=function(){var f=function(x){return (x!==null);};return args.filter(f);}());var result=function(){var τ57=args;var τp0;var τp0;var x;var other;var τ58=false;var τ59=false;var τ60=false;if(((τ58=(τ57 instanceof Array))&&((τ59=(τ57["#"]===undefined))&&((τ60=((τp0=τ57.length),true))&&(τp0===0))))){return ["value",undefined];}else{if((τ60&&((τp0===1)&&((x=τ57[0]),true)))){return x;}else{if(((other=τ57),true)){return patch_array(["multi"],args);}else{throw ["Could not find a match",τ57];}}}}();return result;}else{if((τ39&&(((τp3=τp1[0]),(τp3==="{"))&&(τp1.slice(1),true,τ30[1],true)))){var f=function(x){return (x!==null);};return patch_array(["data"],args.slice(1,(-1)).filter(f));}else{if((τ38&&((τ39=(τp2===1))&&(((τp3=τp1[0]),(τp3==="WHITE"))&&(τ30[1],true))))){return patch_array(["send"],args);}else{if((τ39&&(τp1[0],true,(τ31=τ30[1]),true))){var τ61=τ31;var τp0;var τp1;var τp2;var τp0;var a;var b;var τ62=false;var τ63=false;var τ64=false;var τ65=false;if(((τ62=(τ61 instanceof Array))&&((τ63=(τ61["#"]===undefined))&&((τ64=((τp0=τ61.length),true))&&((τ65=(τp0===2))&&(((τp1=τ61[0]),(τp1===null))&&((τp2=τ61[1]),(τp2===null)))))))){return op;}else{if((τ65&&((a=τ61[0]),true,(b=τ61[1]),true))){var rval=["send",op,["data",a,b]];(rval["fromop"]=true);return rval;}else{throw ["Could not find a match",τ61];}}}else{if(((other=τ30),true)){throw ["Unknown node",ops,args];}else{throw ["Could not find a match",τ30];}}}}}}}}}else{if(((other=τ25),true)){throw "OopsE";}else{throw ["Could not find a match",τ25];}}}}}}};var parse=function(text){var results=tokenize(text);var next=function(){return results.shift();};return oparse(next,order,finalize);};var libf=function(f){return ["symbol",f];};var Env=function(parent){var store=Object();var self=function(expr){return ["bind_env",self,expr];};(self["resolve"]=function(name){var attempt=send(store,name);if(attempt){return attempt;}else{if(true){return self.parent.resolve(name);}else{return false;}}});(self["register"]=function(name,value){return (store[name]=value);});(self["register_macro"]=function(name,m){return (store[name]=["macro",m]);});(self["fork"]=function(){return Env(self);});(self["parent"]=parent);(self["store"]=store);return self;};var js_contexts=({"js_for":["multi","multi","multi","multi"]});var expand=function(τ66,expr){var τp0;var context;var env;if(((τ66 instanceof Array)&&((τ66["#"]===undefined)&&(((τp0=τ66.length),true)&&((τp0===2)&&((context=τ66[0]),true,(env=τ66[1]),true)))))){false;}else{throw "a condition failed";}(expr=expand.step([context,env],expr));var τ67=expr;var s;var τp0;var τp1;var s;var τp0;var τp1;var f;var arg;var τp0;var τp1;var v;var τp0;var τp1;var type;var args;var τp0;var τp1;var args;var τp0;var τp1;var args;var τp0;var τp1;var bindings;var body;var τp0;var τp1;var binding;var value;var τp0;var τp1;var lhs;var rhs;var τp0;var τp1;var type;var args;var τp0;var τp1;var expr;var other;var τ68=false;var τ69=false;var τ70=false;var τ71=false;if(((typeof(τ67)==="string")&&((s=τ67),true))){return s;}else{if(((τ67 instanceof Array)&&((τ67["#"]===undefined)&&(((τp0=τ67.length),true)&&((τp0===2)&&(((τp1=τ67[0]),(τp1==="symbol"))&&((s=τ67[1]),true))))))){return s;}else{if((τ67===null)){return null;}else{if((τ67===(void 0))){throw "undefined? why?";}else{if(((τ68=(τ67 instanceof Array))&&((τ69=(τ67["#"]===undefined))&&((τ70=((τp0=τ67.length),true))&&((τp0===3)&&(((τp1=τ67[0]),(τp1==="send"))&&((f=τ67[1]),true,(arg=τ67[2]),true))))))){(f=expand(["head",env],f));return ["send",f,expand(["tail",env],arg)];}else{if((τ70&&((τp0===2)&&(((τp1=τ67[0]),(τp1==="value"))&&((v=τ67[1]),true))))){return expr;}else{if((τ70&&((τ71=(τp0>=1))&&(((τp1=τ67[0]),(type=τp1),true,((τp1==="array")||(τp1==="object")))&&((args=τ67.slice(1)),true))))){var arr=[];while((args.length>0)){var τ72=expand.step([type,env],args.shift());var τp0;var τp1;var stmts;var other;if(((τ72 instanceof Array)&&((τ72["#"]===undefined)&&(((τp0=τ72.length),true)&&((τp0>=1)&&(((τp1=τ72[0]),(τp1==="splice"))&&((stmts=τ72.slice(1)),true))))))){(args=stmts.concat(args));}else{if(((other=τ72),true)){arr.push(other);}else{throw ["Could not find a match",τ72];}}}return [type].concat(function(){var τ73=[];var τ74=arr;var τ75=τ74.length;for(var τ76=0;(τ76<τ75);(τ76++)){var τ77=τ74[τ76];var x;var other;if(((x=τ77),true)){τ73.push(expand([type,env],x));}else{if(((other=τ77),true)){false;}else{throw ["Could not find a match",τ77];}}}return τ73;}());}else{if((τ71&&(((τp1=τ67[0]),(τp1==="multi"))&&((args=τ67.slice(1)),true)))){var arr=[];while((args.length>0)){var type=function(){if((args.length===1)){return "expr";}else{return "multi";}}();var τ78=expand.step([type,env],args.shift());var τp0;var τp1;var stmts;var other;if(((τ78 instanceof Array)&&((τ78["#"]===undefined)&&(((τp0=τ78.length),true)&&((τp0>=1)&&(((τp1=τ78[0]),(τp1==="splice"))&&((stmts=τ78.slice(1)),true))))))){(args=stmts.concat(args));}else{if(((other=τ78),true)){arr.push([other,type]);}else{throw ["Could not find a match",τ78];}}}return ["multi"].concat(function(){var τ79=[];var τ80=arr;var τ81=τ80.length;for(var τ82=0;(τ82<τ81);(τ82++)){var τ83=τ80[τ82];var τp0;var x;var type;var other;if(((τ83 instanceof Array)&&((τ83["#"]===undefined)&&(((τp0=τ83.length),true)&&((τp0===2)&&((x=τ83[0]),true,(type=τ83[1]),true)))))){τ79.push(expand([type,env],x));}else{if(((other=τ83),true)){false;}else{throw ["Could not find a match",τ83];}}}return τ79;}());}else{if((τ71&&(((τp1=τ67[0]),(τp1==="data"))&&((args=τ67.slice(1)),true)))){var is_obj=false;var obj=["object"];var arr=["array"];var parts=[];var newpart=function(){var τ84=arr;var τp0;var τp1;var other;if(((τ84 instanceof Array)&&((τ84["#"]===undefined)&&(((τp0=τ84.length),true)&&((τp0===1)&&((τp1=τ84[0]),(τp1==="array"))))))){return false;}else{if(((other=τ84),true)){parts.push(arr);return (arr=["array"]);}else{throw ["Could not find a match",τ84];}}};while((args.length>0)){var τ85=expand.step([type,env],args.shift());var τp0;var τp1;var τp0;var τp1;var k;var v;var τp0;var τp1;var exprs;var τp0;var τp1;var expr;var other;var τ86=false;var τ87=false;var τ88=false;if(((τ86=(τ85 instanceof Array))&&((τ87=(τ85["#"]===undefined))&&((τ88=((τp0=τ85.length),true))&&((τp0===1)&&((τp1=τ85[0]),(τp1==="assoc"))))))){(is_obj=true);}else{if((τ88&&((τp0===3)&&(((τp1=τ85[0]),(τp1==="assoc"))&&((k=τ85[1]),true,(v=τ85[2]),true))))){(is_obj=true);obj.push(["array",k,v]);}else{if((τ88&&((τp0>=1)&&(((τp1=τ85[0]),(τp1==="splice"))&&((exprs=τ85.slice(1)),true))))){(args=exprs.concat(args));}else{if((τ88&&((τp0===2)&&(((τp1=τ85[0]),(τp1==="dynsplice"))&&((expr=τ85[1]),true))))){newpart();parts.push(expr);}else{if(((other=τ85),true)){arr.push(other);}else{throw ["Could not find a match",τ85];}}}}}}newpart();var r=function(){var τ89=parts;var τp0;var τp0;var τp0;var τp1;var arr;var τp2;var τp3;var things;var other;var τ90=false;var τ91=false;var τ92=false;var τ93=false;if(((τ90=(τ89 instanceof Array))&&((τ91=(τ89["#"]===undefined))&&((τ92=((τp0=τ89.length),true))&&((τ93=(τp0===0))&&is_obj))))){return obj;}else{if(τ93){return ["array"];}else{if((τ92&&((τp0===1)&&(((τp1=τ89[0]),(arr=τp1),true,(τp1 instanceof Array))&&((τp1["#"]===undefined)&&(((τp2=τp1.length),true)&&((τp2>=1)&&(((τp3=τp1[0]),(τp3==="array"))&&((things=τp1.slice(1)),true))))))))){if(is_obj){arr.push(obj);}else{false;}return arr;}else{if(((other=τ89),true)){if(is_obj){parts.push(["array",obj]);}else{false;}var patch=libf("patch_array");return ["send",patch,patch_array(["array"],parts)];}else{throw ["Could not find a match",τ89];}}}}}();return expand([context,env],r);}else{if((τ70&&((τ71=(τp0===3))&&(((τp1=τ67[0]),(τp1==="lambda"))&&((bindings=τ67[1]),true,(body=τ67[2]),true))))){return ["lambda",function(){var τ94=[];var τ95=bindings;var τ96=τ95.length;for(var τ97=0;(τ97<τ96);(τ97++)){var τ98=τ95[τ97];var x;var other;if(((x=τ98),true)){τ94.push(expand(["decl",env],x));}else{if(((other=τ98),true)){false;}else{throw ["Could not find a match",τ98];}}}return τ94;}(),expand(["expr",env],body)];}else{if((τ71&&(((τp1=τ67[0]),(τp1==="declare"))&&((binding=τ67[1]),true,(value=τ67[2]),true)))){return ["declare",expand(["decl",env],binding),expand(["expr",env],value)];}else{if((τ71&&(((τp1=τ67[0]),(τp1==="assign"))&&((lhs=τ67[1]),true,(rhs=τ67[2]),true)))){return ["assign",expand(["decl",env],lhs),expand(["expr",env],rhs)];}else{if((τ70&&((τp0>=1)&&(((τp1=τ67[0]),(type=τp1),true,((((((((((τp1==="js_while")||(τp1==="js_for"))||(τp1==="js_for_in"))||(τp1==="js_break"))||(τp1==="js_continue"))||(τp1==="js_return"))||(τp1==="js_throw"))||(τp1==="js_try"))||(τp1==="js_new"))||(τp1==="if")))&&((args=τ67.slice(1)),true))))){var ctxs=(send(js_contexts,type)||[]);var f=function(x,i){return expand([(send(ctxs,i)||"expr"),env],x);};return patch_array([type],args.map(f));}else{if((τ70&&((τp0===2)&&(((τp1=τ67[0]),(τp1==="done"))&&((expr=τ67[1]),true))))){return expr;}else{if(((other=τ67),true)){throw ["Oops",expr,context];}else{throw ["Could not find a match",τ67];}}}}}}}}}}}}}}}};(expand["step"]=function(τ100,τ101){var τp0;var context;var env;if(((τ100 instanceof Array)&&((τ100["#"]===undefined)&&(((τp0=τ100.length),true)&&((τp0===2)&&((context=τ100[0]),true,(env=τ100[1]),true)))))){false;}else{throw "a condition failed";}var expr;var τ99;(expr=τ101);true;(τ99=τ101);var τ102=τ99;var τ103;var τ104;var s;var s;var τp0;var τp1;var m;var τp0;var τp1;var m;var τp0;var τp1;var f;var arg;var τp0;var type;var args;var other;var τ105=false;var τ106=false;var τ107=false;var τ108=false;var τ109=false;if((((typeof(τ102)==="string")&&((s=τ102),true))||((τ102 instanceof Array)&&((τ102["#"]===undefined)&&(((τ103=τ102.length),true)&&((τ103===2)&&(((τ104=τ102[0]),(τ104==="symbol"))&&((s=τ102[1]),true)))))))){var v=env.resolve(s);var τ110=[v,context];var τp0;var τp1;var τp0;var τp1;var τp2;var τp3;var m;var τp4;var τp0;var τp1;var τp2;var τp3;var m;var other;var τ111=false;var τ112=false;var τ113=false;var τ114=false;var τ115=false;var τ116=false;var τ117=false;var τ118=false;var τ119=false;if(((τ111=(τ110 instanceof Array))&&((τ112=(τ110["#"]===undefined))&&((τ113=((τp0=τ110.length),true))&&((τ114=(τp0===2))&&(((τp1=τ110[0]),(τp1===(void 0)))&&(τ110[1],true))))))){return s;}else{if((τ114&&((τ115=((τp1=τ110[0]),(τp1 instanceof Array)))&&((τ116=(τp1["#"]===undefined))&&((τ117=((τp2=τp1.length),true))&&((τ118=(τp2===2))&&((τ119=((τp3=τp1[0]),(τp3==="macro")))&&((m=τp1[1]),true,(τp4=τ110[1]),(τp4==="head"))))))))){return v;}else{if((τ119&&((m=τp1[1]),true,τ110[1],true))){return expand.step([context,env],m([context,env],null));}else{if(((other=τ110),true)){return v;}else{throw ["Could not find a match",τ110];}}}}}else{if((τ102===null)){return null;}else{if((τ102===(void 0))){throw "undefined? why?";}else{if(((τ105=(τ102 instanceof Array))&&((τ106=(τ102["#"]===undefined))&&((τ107=((τp0=τ102.length),true))&&((τ108=(τp0===2))&&((τ109=((τp1=τ102[0]),(τp1==="macro")))&&((m=τ102[1]),true,(context==="head")))))))){return expr;}else{if((τ109&&((m=τ102[1]),true,true))){return expand.step([context,env],m([context,env],null));}else{if((τ107&&((τp0===3)&&(((τp1=τ102[0]),(τp1==="send"))&&((f=τ102[1]),true,(arg=τ102[2]),true))))){var τ120=expand.step(["head",env],f);var τp0;var τp1;var m;var other;if(((τ120 instanceof Array)&&((τ120["#"]===undefined)&&(((τp0=τ120.length),true)&&((τp0===2)&&(((τp1=τ120[0]),(τp1==="macro"))&&((m=τ120[1]),true))))))){return expand.step([context,env],m([context,env],arg));}else{if(((other=τ120),true)){return expr;}else{throw ["Could not find a match",τ120];}}}else{if((τ107&&((τp0>=1)&&((type=τ102[0]),true,(args=τ102.slice(1)),true)))){return expr;}else{if(((other=τ102),true)){throw ["Oops2",expr];}else{throw ["Could not find a match",τ102];}}}}}}}}});var aslist=function(τ121){var τ122=τ121;var τp0;var τp1;var args;var other;if((τ122===null)){return [null];}else{if((τ122===(void 0))){return [undefined];}else{if(((τ122 instanceof Array)&&((τ122["#"]===undefined)&&(((τp0=τ122.length),true)&&((τp0>=1)&&(((τp1=τ122[0]),(τp1==="multi"))&&((args=τ122.slice(1)),true))))))){return args;}else{if(((other=τ122),true)){return [other];}else{throw ["Could not find a match",τ122];}}}}};var transform=function(expr,cb){var tr=function(x){return transform(x,cb);};var τ124;try{(τ124=cb.call(tr,expr));}catch(τ123){(τ124=function(){var τ125=expr;var s;var τp0;var τp1;var v;var τp0;var name;var args;var τ126=false;var τ127=false;var τ128=false;if((τ125===null)){return null;}else{if(((typeof(τ125)==="string")&&((s=τ125),true))){return s;}else{if(((τ126=(τ125 instanceof Array))&&((τ127=(τ125["#"]===undefined))&&((τ128=((τp0=τ125.length),true))&&((τp0===2)&&(((τp1=τ125[0]),(τp1==="value"))&&((v=τ125[1]),true))))))){return expr;}else{if((τ128&&((τp0>=1)&&((name=τ125[0]),true,(args=τ125.slice(1)),true)))){return patch_array([name],args.map(tr));}else{throw ["Could not find a match",τ125];}}}}}());}return τ124;};var nullenv=({"resolve":function(x){return undefined;}});var stdenv=Env(nullenv);stdenv.register("+","___plus");stdenv.register("-","___minus");stdenv.register("*","___times");stdenv.register("/","___div");stdenv.register("mod","___mod");stdenv.register("^","___binxor");stdenv.register("&","___binand");stdenv.register("|","___binor");stdenv.register("&&","___and");stdenv.register("||","___or");stdenv.register("and","___and");stdenv.register("or","___or");stdenv.register("not","___not");stdenv.register("===","___is");stdenv.register("!==","___isnt");stdenv.register("!=","___neq");stdenv.register("<","___lt");stdenv.register(">","___gt");stdenv.register("<=","___lte");stdenv.register(">=","___gte");stdenv.register("<<","___shl");stdenv.register(">>","___shr");stdenv.register(">>>","___shr2");stdenv.register("in","___in");stdenv.register("instanceof","___instanceof");stdenv.register("--","___minusminus");stdenv.register_macro("++",function(_,τ129){var τ130=τ129;var τp0;var τp1;var τp2;var x;var τp0;var τp1;var x;var τp2;var τp0;var τp1;var x;var y;var τ131=false;var τ132=false;var τ133=false;var τ134=false;var τ135=false;if(((τ131=(τ130 instanceof Array))&&((τ132=(τ130["#"]===undefined))&&((τ133=((τp0=τ130.length),true))&&((τ134=(τp0===3))&&((τ135=((τp1=τ130[0]),(τp1==="data")))&&(((τp2=τ130[1]),(τp2===null))&&((x=τ130[2]),true)))))))){return ["send","___plusplus",["data",null,x]];}else{if((τ135&&((x=τ130[1]),true,(τp2=τ130[2]),(τp2===null)))){return ["send","___plusplus",["data",x,null]];}else{if((τ135&&((x=τ130[1]),true,(y=τ130[2]),true))){return ["send",["send",x,["send",".",["data",null,"concat"]]],["data",y]];}else{if((τ130===null)){return ["send","->",["data",["data","x","y"],["send",["send","x",["send",".",["data",null,"concat"]]],["data","y"]]]];}else{throw ["Could not find a match",τ130];}}}}});stdenv.register_macro("..",function(_,τ136){var τ137=τ136;var τp0;var τp1;var τp2;var x;var τp0;var τp1;var x;var τp2;var τp0;var τp1;var x;var y;var τ138=false;var τ139=false;var τ140=false;var τ141=false;var τ142=false;if(((τ138=(τ137 instanceof Array))&&((τ139=(τ137["#"]===undefined))&&((τ140=((τp0=τ137.length),true))&&((τ141=(τp0===3))&&((τ142=((τp1=τ137[0]),(τp1==="data")))&&(((τp2=τ137[1]),(τp2===null))&&((x=τ137[2]),true)))))))){return ["send","range",["data",["value",1],x]];}else{if((τ142&&((x=τ137[1]),true,(τp2=τ137[2]),(τp2===null)))){return ["send","range",["data",x]];}else{if((τ142&&((x=τ137[1]),true,(y=τ137[2]),true))){return ["send","range",["data",x,y]];}else{if((τ137===null)){return "range";}else{throw ["Could not find a match",τ137];}}}}});var make_checker=function(value,op){return function(τ143,expr){var τp0;var context;var env;if(((τ143 instanceof Array)&&((τ143["#"]===undefined)&&(((τp0=τ143.length),true)&&((τp0===2)&&((context=τ143[0]),true,(env=τ143[1]),true)))))){false;}else{throw "a condition failed";}return ["send",op,["data",expr[1],value]];};};stdenv.register_macro("**",function(τ144,τ145){var τp0;var context;var env;if(((τ144 instanceof Array)&&((τ144["#"]===undefined)&&(((τp0=τ144.length),true)&&((τp0===2)&&((context=τ144[0]),true,(env=τ144[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var a;var b;if(((τ145 instanceof Array)&&((τ145["#"]===undefined)&&(((τp0=τ145.length),true)&&((τp0===3)&&(((τp1=τ145[0]),(τp1==="data"))&&((a=τ145[1]),true,(b=τ145[2]),true))))))){false;}else{throw "a condition failed";}return ["send",["send","Math",["send",".",["data",null,"pow"]]],["data",a,b]];});stdenv.register_macro("//",function(τ146,τ147){var τp0;var context;var env;if(((τ146 instanceof Array)&&((τ146["#"]===undefined)&&(((τp0=τ146.length),true)&&((τp0===2)&&((context=τ146[0]),true,(env=τ146[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var a;var b;if(((τ147 instanceof Array)&&((τ147["#"]===undefined)&&(((τp0=τ147.length),true)&&((τp0===3)&&(((τp1=τ147[0]),(τp1==="data"))&&((a=τ147[1]),true,(b=τ147[2]),true))))))){false;}else{throw "a condition failed";}return ["send",["send","Math",["send",".",["data",null,"floor"]]],["data",["send","/",["data",a,b]]]];});stdenv.register_macro("<>",function(τ148,τ149){var τp0;var context;var env;if(((τ148 instanceof Array)&&((τ148["#"]===undefined)&&(((τp0=τ148.length),true)&&((τp0===2)&&((context=τ148[0]),true,(env=τ148[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var τp2;var x;if(((τ149 instanceof Array)&&((τ149["#"]===undefined)&&(((τp0=τ149.length),true)&&((τp0===3)&&(((τp1=τ149[0]),(τp1==="data"))&&(((τp2=τ149[1]),(τp2===null))&&((x=τ149[2]),true)))))))){false;}else{throw "a condition failed";}return ["send","pr",["data",x]];});stdenv.register_macro("#",function(τ150,τ151){var τp0;var context;var env;if(((τ150 instanceof Array)&&((τ150["#"]===undefined)&&(((τp0=τ150.length),true)&&((τp0===2)&&((context=τ150[0]),true,(env=τ150[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var τp2;var tag;if(((τ151 instanceof Array)&&((τ151["#"]===undefined)&&(((τp0=τ151.length),true)&&((τp0===3)&&(((τp1=τ151[0]),(τp1==="data"))&&(((τp2=τ151[1]),(τp2===null))&&((tag=τ151[2]),true)))))))){false;}else{throw "a condition failed";}(tag=["value",tag]);return ["macro",function(τ153,expr){var τp0;var τ152;var env;if(((τ153 instanceof Array)&&((τ153["#"]===undefined)&&(((τp0=τ153.length),true)&&((τp0===2)&&((τ152=τ153[0]),true,(env=τ153[1]),true)))))){false;}else{throw "a condition failed";}var τ154=τ152;if((τ154==="pattern")){var checker_mac=["macro",function(_,τ156){var τp0;var τp1;var expr;if(((τ156 instanceof Array)&&((τ156["#"]===undefined)&&(((τp0=τ156.length),true)&&((τp0===2)&&(((τp1=τ156[0]),(τp1==="data"))&&((expr=τ156[1]),true))))))){false;}else{throw "a condition failed";}return ["send","==",["data",["send",expr,["value","#"]],tag]];}];var τ155=expr;var τp0;var τp1;var subp;var other;if(((τ155 instanceof Array)&&((τ155["#"]===undefined)&&(((τp0=τ155.length),true)&&((τp0>=1)&&(((τp1=τ155[0]),(τp1==="data"))&&((subp=τ155.slice(1)),true))))))){var deconstructor_mac=["macro",function(_,expr){return ["data",["value",true],expr[1]];}];return ["check",checker_mac,["project",deconstructor_mac,patch_array(["duck",0],subp)]];}else{if(((other=τ155),true)){return ["check",checker_mac,(expr||["ignore"])];}else{throw ["Could not find a match",τ155];}}}else{if(true){var τ157=expr;var τp0;var τp1;var args;var other;if((τ157===null)){return ["send","StructFactory",["data",tag]];}else{if(((τ157 instanceof Array)&&((τ157["#"]===undefined)&&(((τp0=τ157.length),true)&&((τp0>=1)&&(((τp1=τ157[0]),(τp1==="data"))&&((args=τ157.slice(1)),true))))))){return ["send","Struct",patch_array(["data",tag],args)];}else{if(((other=τ157),true)){return ["send",["send","StructFactory",["data",tag]],other];}else{throw ["Could not find a match",τ157];}}}}else{throw ["Could not find a match",τ154];}}}];});stdenv.register_macro("~",function(τ158,τ159){var τp0;var context;var env;if(((τ158 instanceof Array)&&((τ158["#"]===undefined)&&(((τp0=τ158.length),true)&&((τp0===2)&&((context=τ158[0]),true,(env=τ158[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var τp2;var tag;if(((τ159 instanceof Array)&&((τ159["#"]===undefined)&&(((τp0=τ159.length),true)&&((τp0===3)&&(((τp1=τ159[0]),(τp1==="data"))&&(((τp2=τ159[1]),(τp2===null))&&((tag=τ159[2]),true)))))))){false;}else{throw "a condition failed";}(tag=["value",tag]);var f=function(τ161,expr){var τp0;var τ160;var env;if(((τ161 instanceof Array)&&((τ161["#"]===undefined)&&(((τp0=τ161.length),true)&&((τp0===2)&&((τ160=τ161[0]),true,(env=τ161[1]),true)))))){false;}else{throw "a condition failed";}var τ162=τ160;if((τ162==="pattern")){var checker_mac=function(){var f1=function(_,τ164){var τp0;var τp1;var expr;if(((τ164 instanceof Array)&&((τ164["#"]===undefined)&&(((τp0=τ164.length),true)&&((τp0===2)&&(((τp1=τ164[0]),(τp1==="data"))&&((expr=τ164[1]),true))))))){false;}else{throw "a condition failed";}return ["send","instanceof",["data",expr,"Array"]];};var f2=function(_,τ165){var τp0;var τp1;var expr;if(((τ165 instanceof Array)&&((τ165["#"]===undefined)&&(((τp0=τ165.length),true)&&((τp0===2)&&(((τp1=τ165[0]),(τp1==="data"))&&((expr=τ165[1]),true))))))){false;}else{throw "a condition failed";}return ["send","==",["data",["send",expr,["value",0]],tag]];};return ["multi",["macro",f1],["macro",f2]];}();var τ163=expr;var τp0;var τp1;var subp;var other;if(((τ163 instanceof Array)&&((τ163["#"]===undefined)&&(((τp0=τ163.length),true)&&((τp0>=1)&&(((τp1=τ163[0]),(τp1==="data"))&&((subp=τ163.slice(1)),true))))))){return patch_array(["data",tag],subp);}else{if(((other=τ163),true)){return ["check",checker_mac,(expr||["ignore"])];}else{throw ["Could not find a match",τ163];}}}else{if(true){var τ166=expr;var τp0;var τp1;var args;var other;if((τ166===null)){return ["data",tag];}else{if(((τ166 instanceof Array)&&((τ166["#"]===undefined)&&(((τp0=τ166.length),true)&&((τp0>=1)&&(((τp1=τ166[0]),(τp1==="data"))&&((args=τ166.slice(1)),true))))))){return patch_array(["data",tag],args);}else{if(((other=τ166),true)){return ["send",["data",tag],other];}else{throw ["Could not find a match",τ166];}}}}else{throw ["Could not find a match",τ162];}}};return ["macro",f];});stdenv.register_macro("when",function(τ168,τ169){var τp0;var context;var env;if(((τ168 instanceof Array)&&((τ168["#"]===undefined)&&(((τp0=τ168.length),true)&&((τp0===2)&&((context=τ168[0]),true,(env=τ168[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var τ167;var condition;if(((τ169 instanceof Array)&&((τ169["#"]===undefined)&&(((τp0=τ169.length),true)&&((τp0===3)&&(((τp1=τ169[0]),(τp1==="data"))&&((τ167=τ169[1]),true,(condition=τ169[2]),true))))))){false;}else{throw "a condition failed";}var τ170=τ167;var other;if((τ170===null)){return ["test",condition,["ignore"]];}else{if(((other=τ170),true)){return ["test",condition,other];}else{throw ["Could not find a match",τ170];}}});var andf=function(τ171,expr){var τp0;var context;var env;if(((τ171 instanceof Array)&&((τ171["#"]===undefined)&&(((τp0=τ171.length),true)&&((τp0===2)&&((context=τ171[0]),true,(env=τ171[1]),true)))))){false;}else{throw "a condition failed";}var τ172=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var a;var b;var τp0;var τp1;var other;var τ173=false;var τ174=false;var τ175=false;var τ176=false;if(((τ173=(τ172 instanceof Array))&&((τ174=(τ172["#"]===undefined))&&((τ175=((τp0=τ172.length),true))&&((τ176=(τp0===2))&&(((τp1=τ172[0]),(τp1==="pattern"))&&(((τp2=τ172[1]),(τp2 instanceof Array))&&((τp2["#"]===undefined)&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((a=τp2[1]),true,(b=τp2[2]),true)))))))))))){return ["all",a,b];}else{if((τ176&&(τ172[0],true,(τp1=τ172[1]),(τp1===null)))){return "___and";}else{if(((other=τ172),true)){return ["send","___and",expr];}else{throw ["Could not find a match",τ172];}}}};stdenv.register_macro("&&",andf);stdenv.register_macro("and",andf);var orf=function(τ177,expr){var τp0;var context;var env;if(((τ177 instanceof Array)&&((τ177["#"]===undefined)&&(((τp0=τ177.length),true)&&((τp0===2)&&((context=τ177[0]),true,(env=τ177[1]),true)))))){false;}else{throw "a condition failed";}var τ178=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var a;var b;var τp0;var τp1;var other;var τ179=false;var τ180=false;var τ181=false;var τ182=false;if(((τ179=(τ178 instanceof Array))&&((τ180=(τ178["#"]===undefined))&&((τ181=((τp0=τ178.length),true))&&((τ182=(τp0===2))&&(((τp1=τ178[0]),(τp1==="pattern"))&&(((τp2=τ178[1]),(τp2 instanceof Array))&&((τp2["#"]===undefined)&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((a=τp2[1]),true,(b=τp2[2]),true)))))))))))){return ["any",a,b];}else{if((τ182&&(τ178[0],true,(τp1=τ178[1]),(τp1===null)))){return "___or";}else{if(((other=τ178),true)){return ["send","___or",expr];}else{throw ["Could not find a match",τ178];}}}};stdenv.register_macro("||",orf);stdenv.register_macro("or",orf);var partial_pattern=function(operator){return function(τ183,expr){var τp0;var context;var env;if(((τ183 instanceof Array)&&((τ183["#"]===undefined)&&(((τp0=τ183.length),true)&&((τp0===2)&&((context=τ183[0]),true,(env=τ183[1]),true)))))){false;}else{throw "a condition failed";}var τ184=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var val;var τp0;var τp1;var other;var τ185=false;var τ186=false;var τ187=false;var τ188=false;if(((τ185=(τ184 instanceof Array))&&((τ186=(τ184["#"]===undefined))&&((τ187=((τp0=τ184.length),true))&&((τ188=(τp0===2))&&(((τp1=τ184[0]),(τp1==="pattern"))&&(((τp2=τ184[1]),(τp2 instanceof Array))&&((τp2["#"]===undefined)&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&(((τp5=τp2[1]),(τp5===null))&&((val=τp2[2]),true))))))))))))){return ["check",["macro",make_checker(val,operator)],["ignore"]];}else{if((τ188&&(τ184[0],true,(τp1=τ184[1]),(τp1===null)))){return operator;}else{if(((other=τ184),true)){return ["send",operator,expr];}else{throw ["Could not find a match",τ184];}}}};};stdenv.register_macro("==",partial_pattern("___eq"));stdenv.register_macro("!=",partial_pattern("___neq"));stdenv.register_macro("<=",partial_pattern("___lte"));stdenv.register_macro(">=",partial_pattern("___gte"));stdenv.register_macro("<",partial_pattern("___lt"));stdenv.register_macro(">",partial_pattern("___gt"));stdenv.register_macro("*",function(τ189,expr){var τp0;var context;var env;if(((τ189 instanceof Array)&&((τ189["#"]===undefined)&&(((τp0=τ189.length),true)&&((τp0===2)&&((context=τ189[0]),true,(env=τ189[1]),true)))))){false;}else{throw "a condition failed";}var τ190=[context,expr];var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var val;var τp0;var τp1;var other;var τ191=false;var τ192=false;var τ193=false;var τ194=false;if(((τ191=(τ190 instanceof Array))&&((τ192=(τ190["#"]===undefined))&&((τ193=((τp0=τ190.length),true))&&((τ194=(τp0===2))&&(((τp1=τ190[0]),(τp1==="pattern"))&&((τp2=τ190[1]),(τp2===null)))))))){return ["dynsplice",["ignore"]];}else{if((τ194&&(((τp1=τ190[0]),((τp1==="pattern")||(τp1==="data")))&&(((τp2=τ190[1]),(τp2 instanceof Array))&&((τp2["#"]===undefined)&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&(((τp5=τp2[1]),(τp5===null))&&((val=τp2[2]),true)))))))))){return ["dynsplice",val];}else{if((τ194&&(τ190[0],true,(τp1=τ190[1]),(τp1===null)))){return "___times";}else{if(((other=τ190),true)){return ["send","___times",expr];}else{throw ["Could not find a match",τ190];}}}}});stdenv.register_macro(".",function(τ196,τ195){var τp0;var context;var env;if(((τ196 instanceof Array)&&((τ196["#"]===undefined)&&(((τp0=τ196.length),true)&&((τp0===2)&&((context=τ196[0]),true,(env=τ196[1]),true)))))){false;}else{throw "a condition failed";}var τ197=τ195;var τp0;var τp1;var τp2;var τp3;var τ198;var τ199;var s;var s;var other;if(((τ197 instanceof Array)&&((τ197["#"]===undefined)&&(((τp0=τ197.length),true)&&((τp0===3)&&(((τp1=τ197[0]),(τp1==="data"))&&(((τp2=τ197[1]),(τp2===null))&&((τp3=τ197[2]),(((typeof(τp3)==="string")&&((s=τp3),true))||((τp3 instanceof Array)&&((τp3["#"]===undefined)&&(((τ198=τp3.length),true)&&((τ198===2)&&(((τ199=τp3[0]),(τ199==="symbol"))&&((s=τp3[1]),true))))))))))))))){return ["value",s];}else{if(((other=τ197),true)){throw ["invalid",other];}else{throw ["Could not find a match",τ197];}}});stdenv.register_macro("where",function(τ200,τ201){var τp0;var context;var env;if(((τ200 instanceof Array)&&((τ200["#"]===undefined)&&(((τp0=τ200.length),true)&&((τp0===2)&&((context=τ200[0]),true,(env=τ200[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var a;var b;if(((τ201 instanceof Array)&&((τ201["#"]===undefined)&&(((τp0=τ201.length),true)&&((τp0===3)&&(((τp1=τ201[0]),(τp1==="data"))&&((a=τ201[1]),true,(b=τ201[2]),true))))))){false;}else{throw "a condition failed";}return ["send","let",["data",b,a]];});stdenv.register_macro("let",function(τ202,τ203){var τp0;var context;var env;if(((τ202 instanceof Array)&&((τ202["#"]===undefined)&&(((τp0=τ202.length),true)&&((τp0===2)&&((context=τ202[0]),true,(env=τ202[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var a;var b;if(((τ203 instanceof Array)&&((τ203["#"]===undefined)&&(((τp0=τ203.length),true)&&((τp0===3)&&(((τp1=τ203[0]),(τp1==="data"))&&((a=τ203[1]),true,(b=τ203[2]),true))))))){false;}else{throw "a condition failed";}var bindings=aslist(a);var body=aslist(b);return patch_array(["multi"],bindings,body);});stdenv.register_macro("->",function(τ204,τ205){var τp0;var context;var env;if(((τ204 instanceof Array)&&((τ204["#"]===undefined)&&(((τp0=τ204.length),true)&&((τp0===2)&&((context=τ204[0]),true,(env=τ204[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var args;var stmts;if(((τ205 instanceof Array)&&((τ205["#"]===undefined)&&(((τp0=τ205.length),true)&&((τp0===3)&&(((τp1=τ205[0]),(τp1==="data"))&&((args=τ205[1]),true,(stmts=τ205[2]),true))))))){false;}else{throw "a condition failed";}var body=["multi"];var τp0;var τp1;var placeholder;var newargs;if((((τp0=find_arrow(args)),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((placeholder=τp0[0]),true,(newargs=τp0[1]),true)))))){false;}else{throw "a condition failed";}(newargs=function(){var τ206=[];var τ207=newargs.slice(1);var τ208=τ207.length;for(var τ209=0;(τ209<τ208);(τ209++)){var τ210=τ207[τ209];var s;var τp0;var τp1;var s;var other;var other;var τ211=false;if(((typeof(τ210)==="string")&&((s=τ210),true))){τ206.push(s);}else{if(((τ210 instanceof Array)&&((τ210["#"]===undefined)&&(((τp0=τ210.length),true)&&((τp0===2)&&(((τp1=τ210[0]),(τp1==="symbol"))&&((s=τ210[1]),true))))))){τ206.push(s);}else{if((τ211=((other=τ210),true))){τ206.push(function(){var t=gensym();body.push(["send","=",["data",other,t]]);return t;}());}else{if(τ211){false;}else{throw ["Could not find a match",τ210];}}}}}return τ206;}());body.push(function(){if(placeholder){return ["send","|>",["data",placeholder,stmts]];}else{if(true){return stmts;}else{return false;}}}());return ["lambda",newargs,body];});var build_each=function(source,patterns,τ212,τ213,lvar){var τp0;var prelude;if((((τp0=projector(aslist)(τ212)),τp0[0])&&((prelude=τp0[1]),true))){false;}else{throw "a condition failed";}var τp0;var tail;if((((τp0=projector(aslist)(τ213)),τp0[0])&&((tail=τp0[1]),true))){false;}else{throw "a condition failed";}var temp=gensym();var len=gensym();(lvar=(lvar||gensym()));var stmts=patch_array(["multi"],prelude).concat([["send","=",["data",temp,source]],["send","=",["data",len,["send",temp,["send",".",["data",null,"length"]]]]]]);var loop=function(){var a=["send","=",["data",lvar,["value",0]]];var b=["send","<",["data",lvar,len]];var c=["send","++",["data",lvar,null]];var body=["send","|>",["data",["send","___js_fetch",["data",temp,lvar]],patterns]];return ["js_for",a,b,c,body];}();stmts.push(loop);var stmts=stmts.concat(tail);return stmts;};stdenv.register_macro("each",function(τ215,τ216){var τp0;var τ214;var env;if(((τ215 instanceof Array)&&((τ215["#"]===undefined)&&(((τp0=τ215.length),true)&&((τp0===2)&&((τ214=τ215[0]),true,(env=τ215[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var arr;var τp2;var τp3;var patterns;if(((τ216 instanceof Array)&&((τ216["#"]===undefined)&&(((τp0=τ216.length),true)&&((τp0===3)&&(((τp1=τ216[0]),(τp1==="data"))&&(((arr=τ216[1]),true,(τp2=τ216[2]),(τp3=projector(aslist)(τp2)),τp3[0])&&((patterns=τp3[1]),true)))))))){false;}else{throw "a condition failed";}var τ217=τ214;var other;if((τ217==="multi")){patterns.push(["send","->",["data","other","false"]]);return build_each(arr,patch_array(["multi"],patterns),["multi"],"false");}else{if(((other=τ217),true)){var res=gensym();(patterns=function(){var τ218=[];var τ219=patterns;var τ220=τ219.length;for(var τ221=0;(τ221<τ220);(τ221++)){var τ222=τ219[τ221];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var patt;var expr;var other;var other;var τ223=false;if(((τ222 instanceof Array)&&((τ222["#"]===undefined)&&(((τp0=τ222.length),true)&&((τp0===3)&&(((τp1=τ222[0]),(τp1==="send"))&&(((τp2=τ222[1]),(τp2==="->"))&&(((τp3=τ222[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&((patt=τp3[1]),true,(expr=τp3[2]),true))))))))))))){τ218.push(["send","->",["data",patt,["send",["send",res,["send",".",["data",null,"push"]]],["data",expr]]]]);}else{if((τ223=((other=τ222),true))){τ218.push(INVALID_PATTERN);}else{if(τ223){false;}else{throw ["Could not find a match",τ222];}}}}return τ218;}());patterns.push(["send","->",["data","other","false"]]);return build_each(arr,patch_array(["multi"],patterns),["send","=",["data",res,["data"]]],res);}else{throw ["Could not find a match",τ217];}}});stdenv.register_macro("=>",function(τ224,τ225){var τp0;var context;var env;if(((τ224 instanceof Array)&&((τ224["#"]===undefined)&&(((τp0=τ224.length),true)&&((τp0===2)&&((context=τ224[0]),true,(env=τ224[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var binding;var value;if(((τ225 instanceof Array)&&((τ225["#"]===undefined)&&(((τp0=τ225.length),true)&&((τp0===3)&&(((τp1=τ225[0]),(τp1==="data"))&&((binding=τ225[1]),true,(value=τ225[2]),true))))))){false;}else{throw "a condition failed";}if((context==="data")){return ["assoc",binding,value];}else{if(true){throw (("Illegal context for '=>' ("+context)+")");}else{return false;}}});stdenv.register_macro("as",function(_,τ226){var τp0;var τp1;var expr;var variable;if(((τ226 instanceof Array)&&((τ226["#"]===undefined)&&(((τp0=τ226.length),true)&&((τp0===3)&&(((τp1=τ226[0]),(τp1==="data"))&&((expr=τ226[1]),true,(variable=τ226[2]),true))))))){false;}else{throw "a condition failed";}return ["send","=",["data",variable,expr]];});stdenv.register_macro("=",function(τ227,expr){var τp0;var context;var env;if(((τ227 instanceof Array)&&((τ227["#"]===undefined)&&(((τp0=τ227.length),true)&&((τp0===2)&&((context=τ227[0]),true,(env=τ227[1]),true)))))){false;}else{throw "a condition failed";}var τ228=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var lhs;var rhs;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var f;var args;var value;var τp0;var τp1;var τp2;var τp3;var τp4;var b;var value;var other;var τ229=false;var τ230=false;var τ231=false;var τ232=false;var τ233=false;var τ234=false;var τ235=false;var τ236=false;var τ237=false;var τ238=false;if(((τ229=(τ228 instanceof Array))&&((τ230=(τ228["#"]===undefined))&&((τ231=((τp0=τ228.length),true))&&((τ232=(τp0===2))&&(((τp1=τ228[0]),((τp1==="multi")||(τp1==="expr")))&&(((τp2=τ228[1]),(τp2 instanceof Array))&&((τp2["#"]===undefined)&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((lhs=τp2[1]),true,(rhs=τp2[2]),true)))))))))))){var τp0;var τp1;var τp2;var τp3;var vars;var clauses;if((((τp0=parse_lhs(env,lhs,rhs)),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&(((τp2=τp0[0]),(τp3=projector(make_declarations)(τp2)),τp3[0])&&((vars=τp3[1]),true,(clauses=τp0[1]),true))))))){false;}else{throw "a condition failed";}var r=patch_array(["splice"],vars);var mkif=function(x){return ["if",x,["value",false],["js_throw",["value","a condition failed"]]];};var τ239=clauses;var τp0;var clause;if(((τ239 instanceof Array)&&((τ239["#"]===undefined)&&(((τp0=τ239.length),true)&&((τp0===1)&&((clause=τ239[0]),true)))))){var τ240=send(clause,(clause.length-1));var τp0;var τp1;var τp2;var other;if(((τ240 instanceof Array)&&((τ240["#"]===undefined)&&(((τp0=τ240.length),true)&&((τp0===2)&&(((τp1=τ240[0]),(τp1==="value"))&&((τp2=τ240[1]),(τp2===true)))))))){if(((vars.length===1)&&(clause.length===3))){(r=patch_array(["declare"],clause[1].slice(1)));}else{if(true){(r=r.concat(clause.slice(1,(-1))));}else{false;}}}else{if(((other=τ240),true)){r.push(mkif(clause));}else{throw ["Could not find a match",τ240];}}}else{if(true){var ands=make_pattern_test(clauses);r.push(mkif(ands));}else{throw ["Could not find a match",τ239];}}return r;}else{if((τ232&&((τ233=((τp1=τ228[0]),(τp1==="data")))&&((τp2=τ228[1]),(τp2===null))))){return ["assoc"];}else{if((τ233&&((τ234=((τp2=τ228[1]),(τp2 instanceof Array)))&&((τ235=(τp2["#"]===undefined))&&((τ236=((τp3=τp2.length),true))&&((τ237=(τp3===3))&&((τ238=((τp4=τp2[0]),(τp4==="data")))&&(((τp5=τp2[1]),(τp5 instanceof Array))&&((τp5["#"]===undefined)&&(((τp6=τp5.length),true)&&((τp6===3)&&(((τp7=τp5[0]),(τp7==="send"))&&((f=τp5[1]),true,(args=τp5[2]),true,(value=τp2[2]),true))))))))))))){(f=function(){var τ241=f;var τp0;var τp1;var z;if(((τ241 instanceof Array)&&((τ241["#"]===undefined)&&(((τp0=τ241.length),true)&&((τp0===2)&&(((τp1=τ241[0]),(τp1==="value"))&&(τ241[1],true))))))){return f;}else{if(((z=τ241),true)){return ["value",z];}else{throw ["Could not find a match",τ241];}}}());return ["assoc",f,["send","->",["data",args,value]]];}else{if((τ238&&((b=τp2[1]),true,(value=τp2[2]),true))){(b=function(){var τ242=b;var τp0;var τp1;var z;if(((τ242 instanceof Array)&&((τ242["#"]===undefined)&&(((τp0=τ242.length),true)&&((τp0===2)&&(((τp1=τ242[0]),(τp1==="value"))&&(τ242[1],true))))))){return b;}else{if(((z=τ242),true)){return ["value",z];}else{throw ["Could not find a match",τ242];}}}());return ["assoc",b,value];}else{if(((other=τ228),true)){throw (("Illegal context for '=' ("+context)+")");}else{throw ["Could not find a match",τ228];}}}}}});var make_assigner=function(op){return function(τ243,τ244){var τp0;var context;var env;if(((τ243 instanceof Array)&&((τ243["#"]===undefined)&&(((τp0=τ243.length),true)&&((τp0===2)&&((context=τ243[0]),true,(env=τ243[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var a;var b;if(((τ244 instanceof Array)&&((τ244["#"]===undefined)&&(((τp0=τ244.length),true)&&((τp0===3)&&(((τp1=τ244[0]),(τp1==="data"))&&((a=τ244[1]),true,(b=τ244[2]),true))))))){false;}else{throw "a condition failed";}return ["assign",a,["send",op,["data",a,b]]];};};stdenv.register_macro(":=",function(τ245,τ246){var τp0;var context;var env;if(((τ245 instanceof Array)&&((τ245["#"]===undefined)&&(((τp0=τ245.length),true)&&((τp0===2)&&((context=τ245[0]),true,(env=τ245[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var a;var b;if(((τ246 instanceof Array)&&((τ246["#"]===undefined)&&(((τp0=τ246.length),true)&&((τp0===3)&&(((τp1=τ246[0]),(τp1==="data"))&&((a=τ246[1]),true,(b=τ246[2]),true))))))){false;}else{throw "a condition failed";}return ["assign",a,b];});stdenv.register_macro("+=",make_assigner("+"));stdenv.register_macro("-=",make_assigner("-"));stdenv.register_macro("*=",make_assigner("*"));stdenv.register_macro("/=",make_assigner("/"));stdenv.register_macro("<<=",make_assigner("<<"));stdenv.register_macro(">>=",make_assigner(">>"));stdenv.register_macro(">>>=",make_assigner(">>>"));stdenv.register_macro("if",function(τ247,τ248){var τp0;var context;var env;if(((τ247 instanceof Array)&&((τ247["#"]===undefined)&&(((τp0=τ247.length),true)&&((τp0===2)&&((context=τ247[0]),true,(env=τ247[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var test;var a;var b;if(((τ248 instanceof Array)&&((τ248["#"]===undefined)&&(((τp0=τ248.length),true)&&((τp0===4)&&(((τp1=τ248[0]),(τp1==="data"))&&((test=τ248[1]),true,(a=τ248[2]),true,(b=τ248[3]),true))))))){false;}else{throw "a condition failed";}return ["if",test,a,b];});stdenv.register_macro("cond",function(τ249,τ250){var τp0;var context;var env;if(((τ249 instanceof Array)&&((τ249["#"]===undefined)&&(((τp0=τ249.length),true)&&((τp0===2)&&((context=τ249[0]),true,(env=τ249[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var clauses;if(((τ250 instanceof Array)&&((τ250["#"]===undefined)&&(((τp0=τ250.length),true)&&((τp0===2)&&(((τp1=τ250[0]),(τp1==="data"))&&((clauses=τ250[1]),true))))))){false;}else{throw "a condition failed";}var handle=function(xs){var τ251=xs;var τp0;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var test;var body;var rest;var τ252=false;var τ253=false;var τ254=false;if(((τ252=(τ251 instanceof Array))&&((τ253=(τ251["#"]===undefined))&&((τ254=((τp0=τ251.length),true))&&(τp0===0))))){return ["value",false];}else{if((τ254&&((τp0>=1)&&(((τp1=τ251[0]),(τp1 instanceof Array))&&((τp1["#"]===undefined)&&(((τp2=τp1.length),true)&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((τp4=τp1[1]),(τp4==="=>"))&&(((τp5=τp1[2]),(τp5 instanceof Array))&&((τp5["#"]===undefined)&&(((τp6=τp5.length),true)&&((τp6===3)&&(((τp7=τp5[0]),(τp7==="data"))&&((test=τp5[1]),true,(body=τp5[2]),true,(rest=τ251.slice(1)),true))))))))))))))){(test=function(){var τ255=test;if((τ255==="else")){return ["value",true];}else{if(true){return test;}else{throw ["Could not find a match",τ255];}}}());return ["if",test,body,handle(rest)];}else{throw ["Could not find a match",τ251];}}};return handle(aslist(clauses));});stdenv.register_macro("while",function(τ256,expr){var τp0;var context;var env;if(((τ256 instanceof Array)&&((τ256["#"]===undefined)&&(((τp0=τ256.length),true)&&((τp0===2)&&((context=τ256[0]),true,(env=τ256[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var test;var body;if(((expr instanceof Array)&&((expr["#"]===undefined)&&(((τp0=expr.length),true)&&((τp0===3)&&(((τp1=expr[0]),(τp1==="data"))&&((test=expr[1]),true,(body=expr[2]),true))))))){false;}else{throw "a condition failed";}return ["js_while",test,body];});stdenv.register_macro("for",function(τ258,τ257){var τp0;var context;var env;if(((τ258 instanceof Array)&&((τ258["#"]===undefined)&&(((τp0=τ258.length),true)&&((τp0===2)&&((context=τ258[0]),true,(env=τ258[1]),true)))))){false;}else{throw "a condition failed";}var τ259=τ257;var τp0;var τp1;var τp2;var τp3;var τp4;var a;var b;var c;var body;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var a;var b;var body;var τ260=false;var τ261=false;var τ262=false;var τ263=false;var τ264=false;var τ265=false;var τ266=false;var τ267=false;if(((τ260=(τ259 instanceof Array))&&((τ261=(τ259["#"]===undefined))&&((τ262=((τp0=τ259.length),true))&&((τ263=(τp0===3))&&((τ264=((τp1=τ259[0]),(τp1==="data")))&&((τ265=((τp2=τ259[1]),(τp2 instanceof Array)))&&((τ266=(τp2["#"]===undefined))&&((τ267=((τp3=τp2.length),true))&&((τp3===4)&&(((τp4=τp2[0]),(τp4==="multi"))&&((a=τp2[1]),true,(b=τp2[2]),true,(c=τp2[3]),true,(body=τ259[2]),true)))))))))))){return ["js_for",a,b,c,body];}else{if((τ267&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="send"))&&(((τp5=τp2[1]),(τp5==="in"))&&(((τp6=τp2[2]),(τp6 instanceof Array))&&((τp6["#"]===undefined)&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&((a=τp6[1]),true,(b=τp6[2]),true,(body=τ259[2]),true))))))))))){return ["js_for_in",a,b,body];}else{throw ["Could not find a match",τ259];}}});stdenv.register_macro("!!",function(τ269,τ270){var τp0;var τ268;var env;if(((τ269 instanceof Array)&&((τ269["#"]===undefined)&&(((τp0=τ269.length),true)&&((τp0===2)&&((τ268=τ269[0]),true,(env=τ269[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var expr;var matchers;if(((τ270 instanceof Array)&&((τ270["#"]===undefined)&&(((τp0=τ270.length),true)&&((τp0===3)&&(((τp1=τ270[0]),(τp1==="data"))&&((expr=τ270[1]),true,(matchers=τ270[2]),true))))))){false;}else{throw "a condition failed";}var τ271=τ268;var other;if((τ271==="multi")){var excv=gensym();var m=function(){var τ272=aslist(matchers);var ms;var τp0;var τp1;var τp2;var τp3;var τp4;var x;if((((ms=τ272),true,(τ272 instanceof Array))&&((τ272["#"]===undefined)&&(((τp0=τ272.length),true)&&((τp0>=1)&&(((τp1=τ272[0]),(τp1 instanceof Array))&&((τp1["#"]===undefined)&&(((τp2=τp1.length),true)&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((τp4=τp1[1]),(τp4==="->"))&&(τp1[2],true,τ272.slice(1),true)))))))))))){ms.push(["send","->",["data","___exc",["send","throw","___exc"]]]);return ["send","|>",["data",excv,patch_array(["multi"],ms)]];}else{if(((x=τ272),true)){return matchers;}else{throw ["Could not find a match",τ272];}}}();var f=["send","->",["data",["data",excv],m]];return ["multi",["js_try",expr,f,null]];}else{if(((other=τ271),true)){var excv=gensym();var res=gensym();var m=function(){var τ273=aslist(matchers);var ms;var τp0;var τp1;var τp2;var τp3;var τp4;var x;if((((ms=τ273),true,(τ273 instanceof Array))&&((τ273["#"]===undefined)&&(((τp0=τ273.length),true)&&((τp0>=1)&&(((τp1=τ273[0]),(τp1 instanceof Array))&&((τp1["#"]===undefined)&&(((τp2=τp1.length),true)&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((τp4=τp1[1]),(τp4==="->"))&&(τp1[2],true,τ273.slice(1),true)))))))))))){ms.push(["send","->",["data","___exc",["send","throw","___exc"]]]);return ["send","|>",["data",excv,patch_array(["multi"],ms)]];}else{if(((x=τ273),true)){return matchers;}else{throw ["Could not find a match",τ273];}}}();var f=["send","->",["data",["data",excv],["send",":=",["data",res,m]]]];return ["multi",["declare",res,["value",undefined]],["js_try",["assign",res,expr],f,null],res];}else{throw ["Could not find a match",τ271];}}});stdenv.register_macro("new",function(_,expr){return ["js_new",expr];});stdenv.register_macro("return",function(_,expr){return ["js_return",expr];});stdenv.register_macro("throw",function(_,expr){return ["js_throw",expr];});stdenv.register_macro("break",function(_,expr){return ["js_break"];});stdenv.register_macro("continue",function(_,expr){return ["js_continue"];});var rx_wrap=function(x){return (("(?:"+x)+")");};var rx_quote=function(x){return x.replace(RegExp("([.?*+\\^$\\[\\]\\(\\)\\{\\}|\\\\])","g"),"\\$1");};var rx_quote2=function(x){return x.replace(RegExp("([\\[\\]\\(\\)\\{\\}\\^])","g"),"\\$1");};var rx_build2=function(τ274){var τ275=τ274;var τp0;var τp1;var x;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var s;var τp0;var τp1;var τ276;var τp2;var τp3;var τp4;var a;var b;var τp0;var τp1;var args;var τp0;var τp1;var args;var otherA;var τ277=false;var τ278=false;var τ279=false;var τ280=false;var τ281=false;if((τ275==="any")){return ".";}else{if((τ275==="start")){return "^";}else{if((τ275==="end")){return "$";}else{if((τ275==="alpha")){return "\\a";}else{if((τ275==="digit")){return "\\d";}else{if((τ275==="word")){return "\\w";}else{if((τ275==="space")){return "\\s";}else{if((τ275==="boundary")){return "\\b";}else{if((τ275==="a")){return "\\a";}else{if((τ275==="d")){return "\\d";}else{if((τ275==="w")){return "\\w";}else{if((τ275==="s")){return "\\s";}else{if((τ275==="b")){return "\\b";}else{if(((τ277=(τ275 instanceof Array))&&((τ278=(τ275["#"]===undefined))&&((τ279=((τp0=τ275.length),true))&&((τp0===2)&&(((τp1=τ275[0]),(τp1==="value"))&&((x=τ275[1]),true))))))){return rx_quote(x);}else{if((τ279&&((τ280=(τp0===3))&&((τ281=((τp1=τ275[0]),(τp1==="send")))&&(((τp2=τ275[1]),(τp2==="raw"))&&(((τp3=τ275[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===2)&&(((τp5=τp3[0]),(τp5==="value"))&&((s=τp3[1]),true))))))))))){return s;}else{if((τ281&&(((τ276=τ275[1]),true,(τp2=τ275[2]),(τp2 instanceof Array))&&((τp2["#"]===undefined)&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="data"))&&((a=τp2[1]),true,(b=τp2[2]),true)))))))){var τ282=τ276;if((τ282==="||")){return rx_wrap(((rx_build2(a)+"|")+rx_build2(b)));}else{if((τ282==="or")){return rx_wrap(((rx_build2(a)+"|")+rx_build2(b)));}else{if((τ282==="*")){if((a===null)){false;}else{throw "a condition failed";}return rx_wrap((rx_build2(b)+"*"));}else{if((τ282==="+")){if((a===null)){false;}else{throw "a condition failed";}return rx_wrap((rx_build2(b)+"+"));}else{if((τ282==="?")){if((a===null)){false;}else{throw "a condition failed";}return rx_wrap((rx_build2(b)+"?"));}else{if((τ282==="in")){if((a===null)){false;}else{throw "a condition failed";}var τp0;var τp1;var v;if(((b instanceof Array)&&((b["#"]===undefined)&&(((τp0=b.length),true)&&((τp0===2)&&(((τp1=b[0]),(τp1==="value"))&&((v=b[1]),true))))))){false;}else{throw "a condition failed";}var x=rx_quote2(v);return (("["+x)+"]");}else{if((τ282==="not")){if((a===null)){false;}else{throw "a condition failed";}var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var v;if(((b instanceof Array)&&((b["#"]===undefined)&&(((τp0=b.length),true)&&((τp0===3)&&(((τp1=b[0]),(τp1==="send"))&&(((τp2=b[1]),(τp2==="in"))&&(((τp3=b[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((τp6=τp3[1]),(τp6===null))&&(((τp7=τp3[2]),(τp7 instanceof Array))&&((τp7["#"]===undefined)&&(((τp8=τp7.length),true)&&((τp8===2)&&(((τp9=τp7[0]),(τp9==="value"))&&((v=τp7[1]),true))))))))))))))))))){false;}else{throw "a condition failed";}var x=rx_quote2(v);return (("[^"+x)+"]");}else{throw ["Could not find a match",τ282];}}}}}}}}else{if((τ279&&((τ280=(τp0>=1))&&(((τp1=τ275[0]),(τp1==="data"))&&((args=τ275.slice(1)),true))))){return (("("+args.map(rx_build2).join(""))+")");}else{if((τ280&&(((τp1=τ275[0]),(τp1==="multi"))&&((args=τ275.slice(1)),true)))){return (("(?:"+args.map(rx_build2).join(""))+")");}else{if(((otherA=τ275),true)){throw "OopsF";}else{throw ["Could not find a match",τ275];}}}}}}}}}}}}}}}}}}}};var mac=function(τ283,expr,flags){var τp0;var context;var env;if(((τ283 instanceof Array)&&((τ283["#"]===undefined)&&(((τp0=τ283.length),true)&&((τp0===2)&&((context=τ283[0]),true,(env=τ283[1]),true)))))){false;}else{throw "a condition failed";}(flags=(flags||""));var τ284=expr;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var flag;var τp0;var τp1;var τp2;var v;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var arg;var τ285=false;var τ286=false;var τ287=false;if(((τ285=(τ284 instanceof Array))&&((τ286=(τ284["#"]===undefined))&&((τ287=((τp0=τ284.length),true))&&((τp0===3)&&(((τp1=τ284[0]),(τp1==="send"))&&(((τp2=τ284[1]),(τp2==="."))&&(((τp3=τ284[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((τp6=τp3[1]),(τp6===null))&&((flag=τp3[2]),true)))))))))))))){var m=function(ctx,x){return mac(ctx,x,(flags+flag));};return ["macro",m];}else{if((τ287&&((τp0===2)&&(((τp1=τ284[0]),(τp1==="value"))&&(((τp2=τ284[1]),(typeof(τp2)==="string"))&&((v=τp2),true)))))){return ["send","RegExp",["data",["value",v],["value",flags]]];}else{if((τ287&&((τp0===3)&&(((τp1=τ284[0]),(τp1==="send"))&&(((τp2=τ284[1]),(τp2==="'"))&&(((τp3=τ284[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((τp6=τp3[1]),(τp6===null))&&((arg=τp3[2]),true)))))))))))){return ["send","RegExp",["data",["value",rx_build2(arg)],["value",flags]]];}else{throw ["Could not find a match",τ284];}}}};stdenv.register_macro("R",mac);stdenv.register_macro("?",function(τ289,τ288){var τp0;var context;var env;if(((τ289 instanceof Array)&&((τ289["#"]===undefined)&&(((τp0=τ289.length),true)&&((τp0===2)&&((context=τ289[0]),true,(env=τ289[1]),true)))))){false;}else{throw "a condition failed";}var τ290=τ288;var τp0;var τp1;var τp2;var expr;var τp0;var τp1;var expr;var τp2;var τ291=false;var τ292=false;var τ293=false;var τ294=false;var τ295=false;if(((τ291=(τ290 instanceof Array))&&((τ292=(τ290["#"]===undefined))&&((τ293=((τp0=τ290.length),true))&&((τ294=(τp0===3))&&((τ295=((τp1=τ290[0]),(τp1==="data")))&&(((τp2=τ290[1]),(τp2===null))&&((expr=τ290[2]),true)))))))){return ["send","cond",["data",expr]];}else{if((τ295&&((expr=τ290[1]),true,(τp2=τ290[2]),(τp2===null)))){var orig_expr=expr;var checker=function(){var τ296=expr;var other;if((τ296===null)){throw "can't use ? on its own";}else{if((τ296==="String")){return ["macro",function(_,τ297){var τp0;var τp1;var expr;if(((τ297 instanceof Array)&&((τ297["#"]===undefined)&&(((τp0=τ297.length),true)&&((τp0===2)&&(((τp1=τ297[0]),(τp1==="data"))&&((expr=τ297[1]),true))))))){false;}else{throw "a condition failed";}return ["send","==",["data",["send","typeof",["data",expr]],["value","string"]]];}];}else{if((τ296==="Number")){return ["macro",function(_,τ298){var τp0;var τp1;var expr;if(((τ298 instanceof Array)&&((τ298["#"]===undefined)&&(((τp0=τ298.length),true)&&((τp0===2)&&(((τp1=τ298[0]),(τp1==="data"))&&((expr=τ298[1]),true))))))){false;}else{throw "a condition failed";}return ["send","==",["data",["send","typeof",["data",expr]],["value","number"]]];}];}else{if((τ296==="true")){return ["macro",function(_,τ299){var τp0;var τp1;var expr;if(((τ299 instanceof Array)&&((τ299["#"]===undefined)&&(((τp0=τ299.length),true)&&((τp0===2)&&(((τp1=τ299[0]),(τp1==="data"))&&((expr=τ299[1]),true))))))){false;}else{throw "a condition failed";}return expr;}];}else{if((τ296==="false")){return ["macro",function(_,τ300){var τp0;var τp1;var expr;if(((τ300 instanceof Array)&&((τ300["#"]===undefined)&&(((τp0=τ300.length),true)&&((τp0===2)&&(((τp1=τ300[0]),(τp1==="data"))&&((expr=τ300[1]),true))))))){false;}else{throw "a condition failed";}return ["send","not",["data",null,expr]];}];}else{if((τ296==="null")){return ["macro",make_checker(["value",null],"___is")];}else{if((τ296==="undefined")){return ["macro",make_checker(["value",undefined],"___is")];}else{if(((other=τ296),true)){return ["send","checker",["data",expr]];}else{throw ["Could not find a match",τ296];}}}}}}}}}();var mac=function(τ302,expr){var τp0;var τ301;var env;if(((τ302 instanceof Array)&&((τ302["#"]===undefined)&&(((τp0=τ302.length),true)&&((τp0===2)&&((τ301=τ302[0]),true,(env=τ302[1]),true)))))){false;}else{throw "a condition failed";}var τ303=τ301;var other;if((τ303==="pattern")){var τ304=expr;var τp0;var τp1;var subp;var other;if(((τ304 instanceof Array)&&((τ304["#"]===undefined)&&(((τp0=τ304.length),true)&&((τp0>=1)&&(((τp1=τ304[0]),(τp1==="data"))&&((subp=τ304.slice(1)),true))))))){var projector=["send","deconstructor",["data",orig_expr]];return ["check",checker,["project",projector,expr]];}else{if(((other=τ304),true)){return ["check",checker,(expr||["ignore"])];}else{throw ["Could not find a match",τ304];}}}else{if(((other=τ303),true)){return ["send",checker,["data",expr]];}else{throw ["Could not find a match",τ303];}}};return ["macro",mac];}else{throw ["Could not find a match",τ290];}}});stdenv.register_macro("!",function(τ305,τ306){var τp0;var context;var env;if(((τ305 instanceof Array)&&((τ305["#"]===undefined)&&(((τp0=τ305.length),true)&&((τp0===2)&&((context=τ305[0]),true,(env=τ305[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var expr;var τp2;if(((τ306 instanceof Array)&&((τ306["#"]===undefined)&&(((τp0=τ306.length),true)&&((τp0===3)&&(((τp1=τ306[0]),(τp1==="data"))&&((expr=τ306[1]),true,(τp2=τ306[2]),(τp2===null)))))))){false;}else{throw "a condition failed";}var projector=function(){var τ307=expr;var other;if((τ307===null)){throw "can't use ! on its own";}else{if((τ307==="String")){return ["macro",function(_,τ308){var τp0;var τp1;var expr;if(((τ308 instanceof Array)&&((τ308["#"]===undefined)&&(((τp0=τ308.length),true)&&((τp0===2)&&(((τp1=τ308[0]),(τp1==="data"))&&((expr=τ308[1]),true))))))){false;}else{throw "a condition failed";}return ["data","true",["send","String",["data",expr]]];}];}else{if((τ307==="Number")){return ["macro",function(_,τ309){var τp0;var τp1;var expr;if(((τ309 instanceof Array)&&((τ309["#"]===undefined)&&(((τp0=τ309.length),true)&&((τp0===2)&&(((τp1=τ309[0]),(τp1==="data"))&&((expr=τ309[1]),true))))))){false;}else{throw "a condition failed";}return ["data","true",["send","parseFloat",["data",expr]]];}];}else{if(((other=τ307),true)){return ["send","projector",["data",expr]];}else{throw ["Could not find a match",τ307];}}}}}();var mac=function(τ311,expr){var τp0;var τ310;var env;if(((τ311 instanceof Array)&&((τ311["#"]===undefined)&&(((τp0=τ311.length),true)&&((τp0===2)&&((τ310=τ311[0]),true,(env=τ311[1]),true)))))){false;}else{throw "a condition failed";}var τ312=τ310;var other;if((τ312==="pattern")){return ["project",projector,(expr||["ignore"])];}else{if(((other=τ312),true)){return ["send",["send",projector,["data",expr]],["value",1]];}else{throw ["Could not find a match",τ312];}}};return ["macro",mac];});var gensym_factory=function(prefix){(prefix=("τ"+prefix));var id=0;return function(){var name=(prefix+String(id));(id=(id+1));return name;};};var gensym=gensym_factory("");var is_symbol=function(τ313,env){var τ314=τ313;var τ315;var τ316;var s;var s;if((((typeof(τ314)==="string")&&((s=τ314),true))||((τ314 instanceof Array)&&((τ314["#"]===undefined)&&(((τ315=τ314.length),true)&&((τ315===2)&&(((τ316=τ314[0]),(τ316==="symbol"))&&((s=τ314[1]),true)))))))){var τ317=env.resolve(s);var τp0;var τp1;var m;if(((τ317 instanceof Array)&&((τ317["#"]===undefined)&&(((τp0=τ317.length),true)&&((τp0===2)&&(((τp1=τ317[0]),(τp1==="macro"))&&((m=τ317[1]),true))))))){return false;}else{if(true){return true;}else{throw ["Could not find a match",τ317];}}}else{if(true){return false;}else{throw ["Could not find a match",τ314];}}};var parse_lhs=function(env,lhs,rhs,gen){(gen=(gen||gensym_factory("p")));var vars=[];var clauses=[];var current=["multi"];var mktemp=function(){var t=gen();vars.push(t);return t;};var newclause=function(){if((current.length>1)){clauses.push(current);}else{false;}return (current=["multi"]);};var maybe_temp=function(x){if(is_symbol(x,env)){return x;}else{if(true){var temp=mktemp();current.push(["assign",temp,x]);return temp;}else{return false;}}};var helper=function(lhs,curr){return helper_noexpand(expand.step(["pattern",env],lhs),curr);};var helper_noexpand=function(lhs,curr){var helper_data=function(temp,specs,start){var fw=0;var bw=0;var rest=undefined;var members=function(){var τ335=[];var τ336=specs;var τ337=τ336.length;for(var τ338=0;(τ338<τ337);(τ338++)){var τ339=τ336[τ338];var x;var other;if(((x=τ339),true)){τ335.push(function(){var v=expand.step(["pattern",env],x);var τ340=v;var τp0;var τp1;var variable;var other;if(((τ340 instanceof Array)&&((τ340["#"]===undefined)&&(((τp0=τ340.length),true)&&((τp0===2)&&(((τp1=τ340[0]),(τp1==="dynsplice"))&&((variable=τ340[1]),true))))))){(rest=variable);}else{if((rest===undefined)){(fw=(fw+1));}else{if(((other=τ340),true)){(bw=(bw+1));}else{throw ["Could not find a match",τ340];}}}return v;}());}else{if(((other=τ339),true)){false;}else{throw ["Could not find a match",τ339];}}}return τ335;}();var cmp=function(){if((rest===undefined)){return "___eq";}else{if(true){return "___gte";}else{return false;}}}();var len=mktemp();current.push(["send",":=",["data",len,["send",temp,["send",".",["data",null,"length"]]]]],"true");newclause();current.push(["send",cmp,["data",len,["value",((fw+bw)+start)]]]);newclause();var τ328=range(0,(fw-1));var τ329=τ328.length;for(var τ330=0;(τ330<τ329);(τ330++)){var τ341=τ328[τ330];var j;var other;if(((j=τ341),true)){helper_noexpand(send(members,j),["send",temp,["value",(j+start)]]);}else{if(((other=τ341),true)){false;}else{throw ["Could not find a match",τ341];}}}false;if((rest!==undefined)){var slice=function(){if((bw>0)){return ["data",["value",(fw+start)],["value",(-bw)]];}else{return ["data",["value",(fw+start)]];}}();helper_noexpand(send(members,fw)[1],["send",["send",temp,["send",".",["data",null,"slice"]]],slice]);}else{false;}var τ331=[];var τ332=range(0,(bw-1));var τ333=τ332.length;for(var τ334=0;(τ334<τ333);(τ334++)){var τ342=τ332[τ334];var j;var other;if(((j=τ342),true)){τ331.push(helper_noexpand(send(members,((fw+j)+1)),["send",temp,["send","-",["data",len,["value",(bw-j)]]]]));}else{if(((other=τ342),true)){false;}else{throw ["Could not find a match",τ342];}}}return τ331;};var τ318=lhs;var τ319;var τ320;var τ321;var τ322;var s;var s;var τp0;var τp1;var v;var τp0;var τp1;var condition;var pattern;var τp0;var τp1;var xs;var τp0;var τp1;var xs;var τp0;var τp1;var τp2;var τp3;var τp4;var checkers;var expr;var τp0;var τp1;var checker;var expr;var τp0;var τp1;var projector;var expr;var τp0;var τp1;var fname;var spec;var τp0;var τp1;var i;var specs;var τp0;var τp1;var specs;var other;var τ323=false;var τ324=false;var τ325=false;var τ326=false;var τ327=false;if((τ318===null)){var x=["check",["macro",make_checker(["value",null],"___eq")],["ignore"]];return helper_noexpand(x,curr);}else{if(((τ318==="_")||((τ318 instanceof Array)&&((τ318["#"]===undefined)&&(((τ319=τ318.length),true)&&((τ319===1)&&((τ320=τ318[0]),(τ320==="ignore")))))))){if((!is_symbol(curr,env))){current.push(curr);return current.push("true");}else{return false;}}else{if((((typeof(τ318)==="string")&&((s=τ318),true))||((τ318 instanceof Array)&&((τ318["#"]===undefined)&&(((τ321=τ318.length),true)&&((τ321===2)&&(((τ322=τ318[0]),(τ322==="symbol"))&&((s=τ318[1]),true)))))))){vars.push(s);current.push(["assign",s,curr]);return current.push(["value",true]);}else{if(((τ323=(τ318 instanceof Array))&&((τ324=(τ318["#"]===undefined))&&((τ325=((τp0=τ318.length),true))&&((τp0===2)&&(((τp1=τ318[0]),(τp1==="value"))&&((v=τ318[1]),true))))))){var x=["check",["macro",make_checker(lhs,"___eq")],["ignore"]];return helper_noexpand(x,curr);}else{if((τ325&&((τp0===3)&&(((τp1=τ318[0]),(τp1==="test"))&&((condition=τ318[1]),true,(pattern=τ318[2]),true))))){helper(pattern,curr);current.push(condition);return newclause();}else{if((τ325&&((τ326=(τp0>=1))&&(((τp1=τ318[0]),(τp1==="all"))&&((xs=τ318.slice(1)),true))))){var temp=maybe_temp(curr);var τ343=xs;var τ344=τ343.length;for(var τ345=0;(τ345<τ344);(τ345++)){var τ346=τ343[τ345];var x;var other;if(((x=τ346),true)){helper(x,temp);}else{if(((other=τ346),true)){false;}else{throw ["Could not find a match",τ346];}}}false;return false;}else{if((τ326&&(((τp1=τ318[0]),(τp1==="any"))&&((xs=τ318.slice(1)),true)))){var normalize=function(vars){return vars.filter(function(x){return (x[0]!=="τ");}).sort().join(",");};var temp=maybe_temp(curr);var myvars=undefined;var clauses=[];var τ347=xs;var τ348=τ347.length;for(var τ349=0;(τ349<τ348);(τ349++)){var τ350=τ347[τ349];var x;var other;if(((x=τ350),true)){var p=parse_lhs(env,x,temp,gensym);if((myvars===undefined)){(myvars=p[0]);}else{if((normalize(p[0])!==normalize(myvars))){throw [["Must have the same set of variables in both branches!",(("["+String(myvars))+"]"),(("["+String(p[0]))+"]")]];}else{if(true){(vars=vars.concat(p[0]));}else{false;}}}clauses.push(make_pattern_test(p[1]));}else{if(((other=τ350),true)){false;}else{throw ["Could not find a match",τ350];}}}false;current.push(make_or_pattern(clauses));(vars=vars.concat(myvars));return newclause();}else{if((τ325&&((τ326=(τp0===3))&&((τ327=((τp1=τ318[0]),(τp1==="check")))&&(((τp2=τ318[1]),(τp2 instanceof Array))&&((τp2["#"]===undefined)&&(((τp3=τp2.length),true)&&((τp3>=1)&&(((τp4=τp2[0]),(τp4==="multi"))&&((checkers=τp2.slice(1)),true,(expr=τ318[2]),true)))))))))){var temp=maybe_temp(curr);var τ351=checkers;var τ352=τ351.length;for(var τ353=0;(τ353<τ352);(τ353++)){var τ354=τ351[τ353];var checker;var other;if(((checker=τ354),true)){current.push(["send",checker,["data",temp]]);newclause();}else{if(((other=τ354),true)){false;}else{throw ["Could not find a match",τ354];}}}false;return helper(expr,temp);}else{if((τ327&&((checker=τ318[1]),true,(expr=τ318[2]),true))){var temp=maybe_temp(curr);current.push(["send",checker,["data",temp]]);newclause();return helper(expr,temp);}else{if((τ326&&(((τp1=τ318[0]),(τp1==="project"))&&((projector=τ318[1]),true,(expr=τ318[2]),true)))){var temp=maybe_temp(curr);var temp2=mktemp();current.push(["send",":=",["data",temp2,["send",projector,["data",temp]]]],["send",temp2,["value",0]]);newclause();return helper(expr,["send",temp2,["value",1]]);}else{if((τ326&&(((τp1=τ318[0]),(τp1==="send"))&&((fname=τ318[1]),true,(spec=τ318[2]),true)))){return helper(fname,["send","->",["data",spec,curr]]);}else{if((τ325&&((τp0>=2)&&(((τp1=τ318[0]),(τp1==="duck"))&&((i=τ318[1]),true,(specs=τ318.slice(2)),true))))){var temp=maybe_temp(curr);current.push(["value",true]);return helper_data(temp,specs,i);}else{if((τ325&&((τp0>=1)&&(((τp1=τ318[0]),(τp1==="data"))&&((specs=τ318.slice(1)),true))))){var temp=maybe_temp(curr);current.push(["send","instanceof",["data",temp,"Array"]]);newclause();current.push(["send","==",["data",["send",temp,["value","#"]],"undefined"]]);newclause();return helper_data(temp,specs,0);}else{if(((other=τ318),true)){throw ["OopsG",other];}else{throw ["Could not find a match",τ318];}}}}}}}}}}}}}}};helper(lhs,rhs);if((current.length>1)){clauses.push(current);}else{false;}return [vars,clauses];};var make_declarations=function(vars,val){var τ355=[];var τ356=vars;var τ357=τ356.length;for(var τ358=0;(τ358<τ357);(τ358++)){var τ359=τ356[τ358];var name;var other;if(((name=τ359),true)){τ355.push(["declare",name,["value",val]]);}else{if(((other=τ359),true)){false;}else{throw ["Could not find a match",τ359];}}}return τ355;};var make_pattern_test=function(clauses){var ands=clauses.pop();while((clauses.length>0)){(ands=["send","and",["data",clauses.pop(),ands]]);}return (ands||["value",true]);};var make_or_pattern=function(clauses){var ors=clauses.pop();while((clauses.length>0)){(ors=["send","or",["data",clauses.pop(),ors]]);}return ors;};var find_arrow=function(τ360){var τ361=τ360;var x;var x;var τp0;var τp1;var x;var x;var τp0;var τp1;var v;var τp0;var kind;var args;if((τ361==="|>")){var placeholder=gensym();return [placeholder,placeholder];}else{if((τ361==="|>*")){var placeholder=gensym();return [placeholder,["send","*",["data",null,placeholder]]];}else{if((((typeof(τ361)==="string")&&((x=τ361),true))||((τ361===null)&&((x=τ361),true)))){return [false,x];}else{if(((τ361 instanceof Array)&&((τ361["#"]===undefined)&&(((τp0=τ361.length),true)&&((τp0===2)&&(((τp1=τ361[0]),(τp1==="symbol"))&&((x=τ361[1]),true))))))){return [false,x];}else{if((((x=τ361),true,(τ361 instanceof Array))&&((τ361["#"]===undefined)&&(((τp0=τ361.length),true)&&((τp0===2)&&(((τp1=τ361[0]),(τp1==="value"))&&((v=τ361[1]),true))))))){return [false,x];}else{if(((τ361 instanceof Array)&&((τ361["#"]===undefined)&&(((τp0=τ361.length),true)&&((τp0>=1)&&((kind=τ361[0]),true,(args=τ361.slice(1)),true)))))){var placeholder=false;var new_args=function(){var τ362=[];var τ363=args;var τ364=τ363.length;for(var τ365=0;(τ365<τ364);(τ365++)){var τ366=τ363[τ365];var arg;var other;if(((arg=τ366),true)){τ362.push(function(){var τp0;var τp1;var ph;var new_arg;if((((τp0=find_arrow(arg)),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((ph=τp0[0]),true,(new_arg=τp0[1]),true)))))){false;}else{throw "a condition failed";}if(ph){(placeholder=ph);}else{false;}return new_arg;}());}else{if(((other=τ366),true)){false;}else{throw ["Could not find a match",τ366];}}}return τ362;}();return [placeholder,patch_array([kind],new_args)];}else{throw ["Could not find a match",τ361];}}}}}}};var same=function(a,b){var τ367=[a,b];var τp0;var τp1;var x;var τp2;var y;var τp0;var τp1;var τp2;var τp3;var x;var τp4;var τp5;var τp6;var y;var τp0;var τp1;var τp2;var τp3;var x;var τp4;var τp5;var τp6;var y;var τp0;var τp1;var τp2;var τp3;var x;var τp4;var τp5;var τp6;var y;var τp0;var τp1;var τp2;var τp3;var f;var x;var τp4;var τp5;var τp6;var g;var y;var τp0;var τp1;var τp2;var kind1;var xs;var τp3;var τp4;var kind2;var ys;var other;var τ368=false;var τ369=false;var τ370=false;var τ371=false;var τ372=false;var τ373=false;var τ374=false;var τ375=false;if(((τ368=(τ367 instanceof Array))&&((τ369=(τ367["#"]===undefined))&&((τ370=((τp0=τ367.length),true))&&((τ371=(τp0===2))&&(((τp1=τ367[0]),(typeof(τp1)==="string"))&&(((x=τp1),true,(τp2=τ367[1]),(typeof(τp2)==="string"))&&((y=τp2),true)))))))){return (x===y);}else{if((τ371&&((τ372=((τp1=τ367[0]),(τp1 instanceof Array)))&&((τ373=(τp1["#"]===undefined))&&((τ374=((τp2=τp1.length),true))&&((τ375=(τp2===2))&&(((τp3=τp1[0]),(τp3==="symbol"))&&(((x=τp1[1]),true,(τp4=τ367[1]),(τp4 instanceof Array))&&((τp4["#"]===undefined)&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="symbol"))&&((y=τp4[1]),true))))))))))))){return (x===y);}else{if((τ375&&(((τp3=τp1[0]),(τp3==="value"))&&(((x=τp1[1]),true,(τp4=τ367[1]),(τp4 instanceof Array))&&((τp4["#"]===undefined)&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="value"))&&((y=τp4[1]),true))))))))){return (x===y);}else{if((τ375&&(((τp3=τp1[0]),(τp3==="macro"))&&(((x=τp1[1]),true,(τp4=τ367[1]),(τp4 instanceof Array))&&((τp4["#"]===undefined)&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="macro"))&&((y=τp4[1]),true))))))))){return (x===y);}else{if((τ374&&((τp2===3)&&(((τp3=τp1[0]),(τp3==="send"))&&(((f=τp1[1]),true,(x=τp1[2]),true,(τp4=τ367[1]),(τp4 instanceof Array))&&((τp4["#"]===undefined)&&(((τp5=τp4.length),true)&&((τp5===3)&&(((τp6=τp4[0]),(τp6==="send"))&&((g=τp4[1]),true,(y=τp4[2]),true)))))))))){return (same(f,g)&&same(x,y));}else{if((τ374&&((τp2>=1)&&(((kind1=τp1[0]),true,(xs=τp1.slice(1)),true,(τp3=τ367[1]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4>=1)&&((kind2=τp3[0]),true,(ys=τp3.slice(1)),true)))))))){var allequal=xs.every(function(x,i){return same(x,send(ys,i));});return (((kind1===kind2)&&(xs.length===ys.length))&&allequal);}else{if(((other=τ367),true)){return false;}else{throw ["Could not find a match",τ367];}}}}}}}};stdenv.register_macro("|>",function(τ376,τ377){var τp0;var context;var env;if(((τ376 instanceof Array)&&((τ376["#"]===undefined)&&(((τp0=τ376.length),true)&&((τp0===2)&&((context=τ376[0]),true,(env=τ376[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var to_match;var cl;if(((τ377 instanceof Array)&&((τ377["#"]===undefined)&&(((τp0=τ377.length),true)&&((τp0===3)&&(((τp1=τ377[0]),(τp1==="data"))&&((to_match=τ377[1]),true,(cl=τ377[2]),true))))))){false;}else{throw "a condition failed";}var temp=gensym();var clauses=function(){var τ378=cl;var τp0;var τp1;var cls;var other;if(((τ378 instanceof Array)&&((τ378["#"]===undefined)&&(((τp0=τ378.length),true)&&((τp0>=1)&&(((τp1=τ378[0]),(τp1==="multi"))&&((cls=τ378.slice(1)),true))))))){return cls;}else{if(((other=τ378),true)){return [other];}else{throw ["Could not find a match",τ378];}}}();var cached_conditions=[];var stmts=["multi",["declare",temp,to_match]];(clauses=function(){var τ379=[];var τ380=clauses;var τ381=τ380.length;for(var τ382=0;(τ382<τ381);(τ382++)){var τ383=τ380[τ382];var clause;var other;if(((clause=τ383),true)){τ379.push(function(){var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var lhs;var body;if(((clause instanceof Array)&&((clause["#"]===undefined)&&(((τp0=clause.length),true)&&((τp0===3)&&(((τp1=clause[0]),(τp1==="send"))&&(((τp2=clause[1]),(τp2==="->"))&&(((τp3=clause[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&((lhs=τp3[1]),true,(body=τp3[2]),true))))))))))))){false;}else{throw "a condition failed";}var τp0;var τp1;var placeholder;var new_lhs;if((((τp0=find_arrow(lhs)),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((placeholder=τp0[0]),true,(new_lhs=τp0[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var decls;var conditions;if((((τp0=parse_lhs(env,new_lhs,temp)),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((decls=τp0[0]),true,(conditions=τp0[1]),true)))))){false;}else{throw "a condition failed";}(stmts=stmts.concat(make_declarations(decls)));var b=function(){if(placeholder){return ["send","|>",["data",placeholder,body]];}else{if(true){return body;}else{return false;}}}();var f=function(x){return ["done",expand(["expr",env],x)];};return [conditions.map(f),b];}());}else{if(((other=τ383),true)){false;}else{throw ["Could not find a match",τ383];}}}return τ379;}());var shares=function(){var f=function(τ384,i){var τp0;var conditions;var body;if(((τ384 instanceof Array)&&((τ384["#"]===undefined)&&(((τp0=τ384.length),true)&&((τp0===2)&&((conditions=τ384[0]),true,(body=τ384[1]),true)))))){false;}else{throw "a condition failed";}var res=0;var prev_conditions=send(clauses,i)[0];var nc=conditions.length;for(var j=0;((j<nc)&&same(send(conditions,j),send(prev_conditions,j)));(j++)){(res++);}return res;};return clauses.slice(1).map(f);}();var max=send(Math.max,shares);shares.push(0);var vars=[];(vars=vars.concat(function(){var τ385=[];var τ386=range(1,max);var τ387=τ386.length;for(var τ388=0;(τ388<τ387);(τ388++)){var τ389=τ386[τ388];var other;if(true){τ385.push(gensym());}else{if(((other=τ389),true)){false;}else{throw ["Could not find a match",τ389];}}}return τ385;}()));(stmts=stmts.concat(make_declarations(vars,false)));var shared_last=0;var new_clauses=clauses.map(function(τ390,i){var τp0;var conditions;var body;if(((τ390 instanceof Array)&&((τ390["#"]===undefined)&&(((τp0=τ390.length),true)&&((τp0===2)&&((conditions=τ390[0]),true,(body=τ390[1]),true)))))){false;}else{throw "a condition failed";}var shared=function(){if(shared_last){return [send(vars,(shared_last-1))];}else{return [];}}();var n_to_share=Math.max(shared_last,send(shares,i));var to_share=conditions.slice(shared_last,n_to_share).map(function(x,j){return ["assign",send(vars,(shared_last+j)),x];});(shared_last=send(shares,i));var rest=conditions.slice(n_to_share);return [shared.concat(to_share).concat(rest),body];});(clauses=new_clauses);var r=["js_throw",["data",["value","Could not find a match"],temp]];while((clauses.length>0)){var τp0;var τp1;var conditions;var body;if((((τp0=clauses.pop()),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((conditions=τp0[0]),true,(body=τp0[1]),true)))))){false;}else{throw "a condition failed";}var test=make_pattern_test(conditions);(r=["if",test,body,r]);}stmts.push(r);return stmts;});var qqstruct=function(name,args){return patch_array(["data",["value",name]],args);};var qq=function(τ392){var expr;var τ391;(expr=τ392);true;(τ391=τ392);var τ393=τ391;var τ394;var τ395;var s;var s;var τp0;var τp1;var v;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var insert;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var insert;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var insert;var τp0;var name;var args;var τ396=false;var τ397=false;var τ398=false;var τ399=false;var τ400=false;if((((typeof(τ393)==="string")&&((s=τ393),true))||((τ393 instanceof Array)&&((τ393["#"]===undefined)&&(((τ394=τ393.length),true)&&((τ394===2)&&(((τ395=τ393[0]),(τ395==="symbol"))&&((s=τ393[1]),true)))))))){return ["value",s];}else{if((τ393===null)){return ["value",null];}else{if(((τ396=(τ393 instanceof Array))&&((τ397=(τ393["#"]===undefined))&&((τ398=((τp0=τ393.length),true))&&((τp0===2)&&(((τp1=τ393[0]),(τp1==="value"))&&((v=τ393[1]),true))))))){return qqstruct("value",[expr]);}else{if((τ398&&((τ399=(τp0===3))&&((τ400=((τp1=τ393[0]),(τp1==="send")))&&(((τp2=τ393[1]),(τp2==="^"))&&(((τp3=τ393[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((τp6=τp3[1]),(τp6===null))&&((insert=τp3[2]),true)))))))))))){return insert;}else{if((τ400&&(((τp2=τ393[1]),(τp2==="^="))&&(((τp3=τ393[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((τp6=τp3[1]),(τp6===null))&&((insert=τp3[2]),true)))))))))){return qqstruct("value",[insert]);}else{if((τ400&&(((τp2=τ393[1]),(τp2==="^*"))&&(((τp3=τ393[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((τp6=τp3[1]),(τp6===null))&&((insert=τp3[2]),true)))))))))){return ["send","*",["data",null,insert]];}else{if((τ398&&((τp0>=1)&&((name=τ393[0]),true,(args=τ393.slice(1)),true)))){return qqstruct(name,function(){var τ401=[];var τ402=args;var τ403=τ402.length;for(var τ404=0;(τ404<τ403);(τ404++)){var τ405=τ402[τ404];var arg;var other;if(((arg=τ405),true)){τ401.push(qq(arg));}else{if(((other=τ405),true)){false;}else{throw ["Could not find a match",τ405];}}}return τ401;}());}else{throw ["Could not find a match",τ393];}}}}}}}};stdenv.register_macro("'",function(τ406,τ407){var τp0;var context;var env;if(((τ406 instanceof Array)&&((τ406["#"]===undefined)&&(((τp0=τ406.length),true)&&((τp0===2)&&((context=τ406[0]),true,(env=τ406[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var τp2;var expr;if(((τ407 instanceof Array)&&((τ407["#"]===undefined)&&(((τp0=τ407.length),true)&&((τp0===3)&&(((τp1=τ407[0]),(τp1==="data"))&&(((τp2=τ407[1]),(τp2===null))&&((expr=τ407[2]),true)))))))){false;}else{throw "a condition failed";}return qq(expr);});stdenv.register_macro("req",function(τ408,τ409){var τp0;var context;var env;if(((τ408 instanceof Array)&&((τ408["#"]===undefined)&&(((τp0=τ408.length),true)&&((τp0===2)&&((context=τ408[0]),true,(env=τ408[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var expr;if(((τ409 instanceof Array)&&((τ409["#"]===undefined)&&(((τp0=τ409.length),true)&&((τp0===2)&&(((τp1=τ409[0]),(τp1==="data"))&&((expr=τ409[1]),true))))))){false;}else{throw "a condition failed";}return ["send","require",["data",expr]];});stdenv.register_macro("require",function(τ410,τ411){var τp0;var context;var env;if(((τ410 instanceof Array)&&((τ410["#"]===undefined)&&(((τp0=τ410.length),true)&&((τp0===2)&&((context=τ410[0]),true,(env=τ410[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var expr;if(((τ411 instanceof Array)&&((τ411["#"]===undefined)&&(((τp0=τ411.length),true)&&((τp0===2)&&(((τp1=τ411[0]),(τp1==="data"))&&((expr=τ411[1]),true))))))){false;}else{throw "a condition failed";}var stmts=[];var topfetch=function(pkg,v){stmts.push(["send","=",["data",v,["send",["send","___node",["send",".",["data",null,"require"]]],["data",["value",pkg]]]]]);return v;};var produce=function(τ412,fetch){var τ413=τ412;var s;var τp0;var τp1;var τp2;var s;var τ416;var τ417;var subp;var τ414;var τ415;var subp;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var pkg;var τ418;var τ419;var pkg;var τp7;var s;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var pkg;var subp;var τ420=false;var τ421=false;var τ422=false;var τ423=false;var τ424=false;if(((typeof(τ413)==="string")&&((s=τ413),true))){return fetch(s,s);}else{if(((τ413 instanceof Array)&&((τ413["#"]===undefined)&&(((τp0=τ413.length),true)&&((τp0===2)&&(((τp1=τ413[0]),(τp1==="value"))&&(((τp2=τ413[1]),(typeof(τp2)==="string"))&&((s=τp2),true)))))))){return fetch(s,gensym());}else{if((((τ413 instanceof Array)&&((τ413["#"]===undefined)&&(((τ414=τ413.length),true)&&((τ414>=1)&&(((τ415=τ413[0]),(τ415==="multi"))&&((subp=τ413.slice(1)),true))))))||((τ413 instanceof Array)&&((τ413["#"]===undefined)&&(((τ416=τ413.length),true)&&((τ416>=1)&&(((τ417=τ413[0]),(τ417==="data"))&&((subp=τ413.slice(1)),true)))))))){var τ425=[];var τ426=subp;var τ427=τ426.length;for(var τ428=0;(τ428<τ427);(τ428++)){var τ429=τ426[τ428];var p;var other;if(((p=τ429),true)){τ425.push(produce(p,fetch));}else{if(((other=τ429),true)){false;}else{throw ["Could not find a match",τ429];}}}return τ425;}else{if(((τ420=(τ413 instanceof Array))&&((τ421=(τ413["#"]===undefined))&&((τ422=((τp0=τ413.length),true))&&((τ423=(τp0===3))&&((τ424=((τp1=τ413[0]),(τp1==="send")))&&(((τp2=τ413[1]),(τp2==="as"))&&(((τp3=τ413[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((τp6=τp3[1]),(((τp6 instanceof Array)&&((τp6["#"]===undefined)&&(((τ418=τp6.length),true)&&((τ418===2)&&(((τ419=τp6[0]),(τ419==="value"))&&((pkg=τp6[1]),true))))))||((pkg=τp6),true)))&&(((τp7=τp3[2]),(typeof(τp7)==="string"))&&((s=τp7),true))))))))))))))){return fetch(pkg,s);}else{if((τ424&&(((τp2=τ413[1]),(τp2==="->"))&&(((τp3=τ413[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&((pkg=τp3[1]),true,(subp=τp3[2]),true))))))))){var pkgv=produce(pkg,fetch);return produce(subp,function(pkg,v){return stmts.push(["send","=",["data",v,["send",pkgv,["value",pkg]]]]);});}else{throw ["Could not find a match",τ413];}}}}}};produce(expr,topfetch);return patch_array(["multi"],stmts);});stdenv.register_macro("%",function(τ430,τ431){var τp0;var context;var env;if(((τ430 instanceof Array)&&((τ430["#"]===undefined)&&(((τp0=τ430.length),true)&&((τp0===2)&&((context=τ430[0]),true,(env=τ430[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var descr;var contents;if(((τ431 instanceof Array)&&((τ431["#"]===undefined)&&(((τp0=τ431.length),true)&&((τp0===3)&&(((τp1=τ431[0]),(τp1==="data"))&&((descr=τ431[1]),true,(contents=τ431[2]),true))))))){false;}else{throw "a condition failed";}var tag=["value","div"];var id=["value",null];var classes=["data"];var kv=["data"];var parse=function(τ432){var τ433=τ432;var s;var τp0;var τp1;var x;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var x;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var x;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var prop;var value;var τp0;var τp1;var expr;var rest;var τ436;var τ437;var args;var τ434;var τ435;var args;var τ438=false;var τ439=false;var τ440=false;var τ441=false;var τ442=false;if((τ433===null)){return null;}else{if(((typeof(τ433)==="string")&&((s=τ433),true))){return (tag=["value",s]);}else{if(((τ438=(τ433 instanceof Array))&&((τ439=(τ433["#"]===undefined))&&((τ440=((τp0=τ433.length),true))&&((τp0===2)&&(((τp1=τ433[0]),(τp1==="value"))&&((x=τ433[1]),true))))))){return classes.push(["value",x]);}else{if((τ440&&((τ441=(τp0===3))&&((τ442=((τp1=τ433[0]),(τp1==="send")))&&(((τp2=τ433[1]),(τp2==="."))&&(((τp3=τ433[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((τp6=τp3[1]),(τp6===null))&&(((τp7=τp3[2]),(typeof(τp7)==="string"))&&((x=τp7),true))))))))))))){return classes.push(["value",x]);}else{if((τ442&&(((τp2=τ433[1]),(τp2==="#"))&&(((τp3=τ433[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((τp6=τp3[1]),(τp6===null))&&(((τp7=τp3[2]),(typeof(τp7)==="string"))&&((x=τp7),true))))))))))){return (id=["value",x]);}else{if((τ442&&(((τp2=τ433[1]),(τp2==="="))&&(((τp3=τ433[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((τp6=τp3[1]),(typeof(τp6)==="string"))&&((prop=τp6),true,(value=τp3[2]),true)))))))))){return kv.push(["data",["value",prop],value]);}else{if((τ442&&((expr=τ433[1]),true,(rest=τ433[2]),true))){parse(expr);return parse(rest);}else{if((((τ433 instanceof Array)&&((τ433["#"]===undefined)&&(((τ434=τ433.length),true)&&((τ434>=1)&&(((τ435=τ433[0]),(τ435==="multi"))&&((args=τ433.slice(1)),true))))))||((τ433 instanceof Array)&&((τ433["#"]===undefined)&&(((τ436=τ433.length),true)&&((τ436>=1)&&(((τ437=τ433[0]),(τ437==="data"))&&((args=τ433.slice(1)),true)))))))){return args.forEach(parse);}else{throw ["Could not find a match",τ433];}}}}}}}}};parse(descr);(contents=function(){var τ443=contents;var τp0;var τp1;var args;var x;if((τ443===null)){return ["data"];}else{if(((τ443 instanceof Array)&&((τ443["#"]===undefined)&&(((τp0=τ443.length),true)&&((τp0>=1)&&(((τp1=τ443[0]),(τp1==="multi"))&&((args=τ443.slice(1)),true))))))){return patch_array(["data"],args);}else{if(((x=τ443),true)){return x;}else{throw ["Could not find a match",τ443];}}}}());return ["send","create_node",["data",tag,id,classes,kv,contents]];});var var_operator=function(temp){return function(_,expr){var f=function(τ444){var τ445=τ444;var τp0;var τp1;var τp2;var τ446;var other;if((τ445===null)){return temp;}else{if(((τ445 instanceof Array)&&((τ445["#"]===undefined)&&(((τp0=τ445.length),true)&&((τp0===3)&&(((τp1=τ445[0]),(τp1==="data"))&&(((τp2=τ445[1]),(τp2===null))&&((τ446=τ445[2]),true)))))))){var τ447=τ446;var τ448;var τ449;var s;var s;var τp0;var τp1;var obj;var msg;var other;if((((typeof(τ447)==="string")&&((s=τ447),true))||((τ447 instanceof Array)&&((τ447["#"]===undefined)&&(((τ448=τ447.length),true)&&((τ448===2)&&(((τ449=τ447[0]),(τ449==="symbol"))&&((s=τ447[1]),true)))))))){return ["send",temp,["value",s]];}else{if(((τ447 instanceof Array)&&((τ447["#"]===undefined)&&(((τp0=τ447.length),true)&&((τp0===3)&&(((τp1=τ447[0]),(τp1==="send"))&&((obj=τ447[1]),true,(msg=τ447[2]),true))))))){var x=f(["data",null,obj]);return ["send",x,msg];}else{if(((other=τ447),true)){return ["send",temp,other];}else{throw ["Could not find a match",τ447];}}}}else{if(((other=τ445),true)){return ["send",temp,other];}else{throw ["Could not find a match",τ445];}}}};return f(expr);};};stdenv.register_macro("chain",function(τ450,τ451){var τp0;var context;var env;if(((τ450 instanceof Array)&&((τ450["#"]===undefined)&&(((τp0=τ450.length),true)&&((τp0===2)&&((context=τ450[0]),true,(env=τ450[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var defn;var body;if(((τ451 instanceof Array)&&((τ451["#"]===undefined)&&(((τp0=τ451.length),true)&&((τp0===3)&&(((τp1=τ451[0]),(τp1==="data"))&&((defn=τ451[1]),true,(body=τ451[2]),true))))))){false;}else{throw "a condition failed";}var newenv=env.fork();var temp=gensym();var τp0;var τp1;var variable;var expr;if((((τp0=function(){var τ452=defn;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var x;var y;var other;if(((τ452 instanceof Array)&&((τ452["#"]===undefined)&&(((τp0=τ452.length),true)&&((τp0===3)&&(((τp1=τ452[0]),(τp1==="send"))&&(((τp2=τ452[1]),(τp2==="as"))&&(((τp3=τ452[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&((x=τp3[1]),true,(y=τp3[2]),true))))))))))))){return [y,x];}else{if(((other=τ452),true)){return ["@",other];}else{throw ["Could not find a match",τ452];}}}()),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((variable=τp0[0]),true,(expr=τp0[1]),true)))))){false;}else{throw "a condition failed";}newenv.register_macro(variable,var_operator(temp));var stmts=["multi"].concat(function(){var τ453=[];var τ454=aslist(body);var τ455=τ454.length;for(var τ456=0;(τ456<τ455);(τ456++)){var τ457=τ454[τ456];var x;var other;if(((x=τ457),true)){τ453.push(["send",":=",["data",temp,x]]);}else{if(((other=τ457),true)){false;}else{throw ["Could not find a match",τ457];}}}return τ453;}());var v=["multi",["send","=",["data",temp,expr]],stmts,temp];return ["done",expand([context,newenv],v)];});var partition=function(xs,predicate){var t=[];var f=[];var τ458=xs;var τ459=τ458.length;for(var τ460=0;(τ460<τ459);(τ460++)){var τ461=τ458[τ460];var x;var x;var other;if(((x=τ461),true,predicate(x))){t.push(x);}else{if(((x=τ461),true)){f.push(x);}else{if(((other=τ461),true)){false;}else{throw ["Could not find a match",τ461];}}}}false;return [t,f];};stdenv.register_macro("class",function(τ462,arg){var τp0;var context;var env;if(((τ462 instanceof Array)&&((τ462["#"]===undefined)&&(((τp0=τ462.length),true)&&((τp0===2)&&((context=τ462[0]),true,(env=τ462[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var clsvar;var τp2;var τp3;var body;if((((τp0=function(){var τ466=arg;var τp0;var τp1;var body;var τp0;var τp1;var name;var body;var τ467=false;var τ468=false;var τ469=false;if(((τ467=(τ466 instanceof Array))&&((τ468=(τ466["#"]===undefined))&&((τ469=((τp0=τ466.length),true))&&((τp0===2)&&(((τp1=τ466[0]),(τp1==="data"))&&((body=τ466[1]),true))))))){return [gensym(),body];}else{if((τ469&&((τp0===3)&&(((τp1=τ466[0]),(τp1==="data"))&&((name=τ466[1]),true,(body=τ466[2]),true))))){return [name,body];}else{throw ["Could not find a match",τ466];}}}()),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&(((clsvar=τp0[0]),true,(τp2=τp0[1]),(τp3=projector(aslist)(τp2)),τp3[0])&&((body=τp3[1]),true))))))){false;}else{throw "a condition failed";}var τp0;var τp1;var ctors;var clauses;if((((τp0=partition(body,function(τ470){var τ471=τ470;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var τp9;var otherwise;if(((τ471 instanceof Array)&&((τ471["#"]===undefined)&&(((τp0=τ471.length),true)&&((τp0===3)&&(((τp1=τ471[0]),(τp1==="send"))&&(((τp2=τ471[1]),(τp2==="="))&&(((τp3=τ471[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((τp6=τp3[1]),(τp6 instanceof Array))&&((τp6["#"]===undefined)&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="send"))&&(((τp9=τp6[1]),(τp9==="constructor"))&&(τp6[2],true,τp3[2],true))))))))))))))))))){return true;}else{if(((otherwise=τ471),true)){return false;}else{throw ["Could not find a match",τ471];}}})),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((ctors=τp0[0]),true,(clauses=τp0[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var ctor_args;var ctor_body;if((((τp0=function(){var τ472=ctors;var τp0;var τp0;var τ473;var τ474=false;var τ475=false;var τ476=false;if(((τ474=(τ472 instanceof Array))&&((τ475=(τ472["#"]===undefined))&&((τ476=((τp0=τ472.length),true))&&(τp0===0))))){return [["data"],[]];}else{if((τ476&&((τp0===1)&&((τ473=τ472[0]),true)))){var τ477=τ473;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var args;var τp9;var τp10;var body;if(((τ477 instanceof Array)&&((τ477["#"]===undefined)&&(((τp0=τ477.length),true)&&((τp0===3)&&(((τp1=τ477[0]),(τp1==="send"))&&(((τp2=τ477[1]),(τp2==="="))&&(((τp3=τ477[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((τp6=τp3[1]),(τp6 instanceof Array))&&((τp6["#"]===undefined)&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="send"))&&((τp6[1],true,(args=τp6[2]),true,(τp9=τp3[2]),(τp10=projector(aslist)(τp9)),τp10[0])&&((body=τp10[1]),true))))))))))))))))))){return [args,body];}else{throw ["Could not find a match",τ477];}}else{throw ["Could not find a match",τ472];}}}()),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((ctor_args=τp0[0]),true,(ctor_body=τp0[1]),true)))))){false;}else{throw "a condition failed";}var selfvar=gensym();(ctor_body=function(){var prep=["send","=",["data",selfvar,["send","if",["data",["send","not",["data",null,["send",["send","?",["data",clsvar,null]],"this"]]],["send",["send","Object",["send",".",["data",null,"create"]]],["data",["send",clsvar,["send",".",["data",null,"prototype"]]]]],"this"]]]];var ret=selfvar;return patch_array(["multi",prep],ctor_body,[ret]);}());var newenv=env.fork();newenv.register_macro("@",var_operator(selfvar));var defns=[];var static_defns=[];var τ463=clauses;var τ464=τ463.length;for(var τ465=0;(τ465<τ464);(τ465++)){var τ478=τ463[τ465];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var body;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var name;var args;var τp9;var τp10;var body;var other;var τ479=false;var τ480=false;var τ481=false;var τ482=false;var τ483=false;if(((τ479=(τ478 instanceof Array))&&((τ480=(τ478["#"]===undefined))&&((τ481=((τp0=τ478.length),true))&&((τ482=(τp0===3))&&((τ483=((τp1=τ478[0]),(τp1==="send")))&&(((τp2=τ478[1]),(τp2==="static"))&&(((τp3=τ478[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===2)&&(((τp5=τp3[0]),(τp5==="data"))&&(((τp6=τp3[1]),(τp7=projector(aslist)(τp6)),τp7[0])&&((body=τp7[1]),true)))))))))))))){(static_defns=static_defns.concat(body));}else{if((τ483&&(((τp2=τ478[1]),(τp2==="="))&&(((τp3=τ478[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((τp6=τp3[1]),(τp6 instanceof Array))&&((τp6["#"]===undefined)&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="send"))&&(((name=τp6[1]),true,(args=τp6[2]),true,(τp9=τp3[2]),(τp10=projector(aslist)(τp9)),τp10[0])&&((body=τp10[1]),true))))))))))))))){(name=function(){var τ484=name;var τp0;var τp1;if(((τ484 instanceof Array)&&((τ484["#"]===undefined)&&(((τp0=τ484.length),true)&&((τp0===2)&&(((τp1=τ484[0]),(τp1==="value"))&&(τ484[1],true))))))){return name;}else{if(true){return ["value",name];}else{throw ["Could not find a match",τ484];}}}());defns.push(["send",":=",["data",["send",["send",clsvar,["send",".",["data",null,"prototype"]]],name],["send","->",["data",args,patch_array(["multi",["send","=",["data",selfvar,"this"]]],body)]]]]);}else{if(((other=τ478),true)){false;}else{throw ["Could not find a match",τ478];}}}}false;return ["done",expand([context,newenv],patch_array(["multi",["send","=",["data",clsvar,["send","->",["data",ctor_args,ctor_body]]]],["send","augment",["data",clsvar,patch_array(["data"],static_defns)]]],defns,[clsvar]))];});stdenv.register_macro("do",function(τ485,τ486){var τp0;var context;var env;if(((τ485 instanceof Array)&&((τ485["#"]===undefined)&&(((τp0=τ485.length),true)&&((τp0===2)&&((context=τ485[0]),true,(env=τ485[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var τp2;var τp3;var body;if(((τ486 instanceof Array)&&((τ486["#"]===undefined)&&(((τp0=τ486.length),true)&&((τp0===2)&&(((τp1=τ486[0]),(τp1==="data"))&&(((τp2=τ486[1]),(τp3=projector(aslist)(τp2)),τp3[0])&&((body=τp3[1]),true)))))))){false;}else{throw "a condition failed";}return patch_array(["multi"],body);});var group=function(xs,classifier){var groups=[];var curr=[];var newgroup=function(){if((curr.length>0)){groups.push(curr);}else{false;}return (curr=[]);};var τ487=xs;var τ488=τ487.length;for(var τ489=0;(τ489<τ488);(τ489++)){var τ490=τ487[τ489];var x;var other;if(((x=τ490),true)){if(classifier(x)){newgroup();}else{false;}curr.push(x);}else{if(((other=τ490),true)){false;}else{throw ["Could not find a match",τ490];}}}false;newgroup();return groups;};var blocktest_wrap=function(label,expr,accumulator){var value=gensym();return ["multi",["send","=",["data",value,["send","!!",["data",["multi",["send","|>",["data",expr,["multi",["send","->",["data",["send",["send","?",["data","true",null]],"x"],["send",["send","#",["data",null,"success"]],["data","x"]]]],["send","->",["data",["send",["send","?",["data","false",null]],"x"],["send",["send","#",["data",null,"failure"]],["data","x"]]]]]]]],["send","->",["data","__err",["send",["send","#",["data",null,"error"]],["data","__err"]]]]]]]],["send",["send",accumulator,["send",".",["data",null,"push"]]],["data",["send",["send","#",["data",null,"test_result"]],["data",label,value]]]]];};var blocktest_mac=function(label,tests,acc){var ok=gensym();var stmts=[];stmts.push(["send","=",["data",ok,"true"]]);var τ491=tests;var τ492=τ491.length;for(var τ493=0;(τ493<τ492);(τ493++)){var τ494=τ491[τ493];var stmt;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var new_label;var τp6;var τp7;var new_tests;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var sources;var τp6;var τp7;var clauses;var expr;var other;var τ495=false;var τ496=false;var τ497=false;var τ498=false;var τ499=false;if((((stmt=τ494),true,(τ494 instanceof Array))&&((τ494["#"]===undefined)&&(((τp0=τ494.length),true)&&((τp0===3)&&(((τp1=τ494[0]),(τp1==="send"))&&(((τp2=τ494[1]),(τp2==="do"))&&(τ494[2],true)))))))){stmts.push(["send","!!",["data",stmt,["send","->",["data","__err",["multi",["send",["send",acc,["send",".",["data",null,"push"]]],["data",["send",["send","#",["data",null,"error"]],["data",label,"__err"]]]],["send",":=",["data",ok,"false"]]]]]]]);}else{if(((τ495=(τ494 instanceof Array))&&((τ496=(τ494["#"]===undefined))&&((τ497=((τp0=τ494.length),true))&&((τ498=(τp0===3))&&((τ499=((τp1=τ494[0]),(τp1==="send")))&&(((τp2=τ494[1]),(τp2==="=>"))&&(((τp3=τ494[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((new_label=τp3[1]),true,(τp6=τp3[2]),(τp7=projector(aslist)(τp6)),τp7[0])&&((new_tests=τp7[1]),true)))))))))))))){var labv=gensym();stmts.push(["multi",["send","=",["data",labv,["send","++",["data",label,["send",["send","!",["data","Array",null]],new_label]]]]],patch_array(["multi"],blocktest_mac(labv,new_tests,acc))]);}else{if((τ499&&(((τp2=τ494[1]),(τp2==="each"))&&(((τp3=τ494[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(((sources=τp3[1]),true,(τp6=τp3[2]),(τp7=projector(aslist)(τp6)),τp7[0])&&((clauses=τp7[1]),true)))))))))){var loopvar=gensym();(clauses=function(){var τ500=[];var τ501=clauses;var τ502=τ501.length;for(var τ503=0;(τ503<τ502);(τ503++)){var τ504=τ501[τ503];var clause;var other;if(((clause=τ504),true)){τ500.push(function(){var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var lhs;var rhs;if(((clause instanceof Array)&&((clause["#"]===undefined)&&(((τp0=clause.length),true)&&((τp0===3)&&(((τp1=clause[0]),(τp1==="send"))&&(((τp2=clause[1]),(τp2==="->"))&&(((τp3=clause[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&((lhs=τp3[1]),true,(rhs=τp3[2]),true))))))))))))){false;}else{throw "a condition failed";}var x=blocktest_mac(["send","++",["data",label,["data",loopvar]]],projector(aslist)(rhs)[1],acc);return ["send","->",["data",lhs,patch_array(["multi"],x)]];}());}else{if(((other=τ504),true)){false;}else{throw ["Could not find a match",τ504];}}}return τ500;}());clauses.push(["send","->",["data","__no",["send",["send",acc,["send",".",["data",null,"push"]]],["data",["send",["send","#",["data",null,"error"]],["data",label,["value","No handler for test case"],"__no"]]]]]]);stmts.push(build_each(sources,patch_array(["multi"],clauses),["multi"],["multi"],loopvar));}else{if(((expr=τ494),true)){stmts.push(["send","?",["data",null,["multi",["send","=>",["data",ok,blocktest_wrap(label,expr,acc)]],["send","=>",["data","else",["send",["send",acc,["send",".",["data",null,"push"]]],["data",["send",["send","#",["data",null,"aborted"]],["data",label,["send","'",["data",null,expr]]]]]]]]]]]);}else{if(((other=τ494),true)){false;}else{throw ["Could not find a match",τ494];}}}}}}false;stmts.push(acc);return stmts;};stdenv.register_macro("blocktest",function(τ505,τ506){var τp0;var context;var env;if(((τ505 instanceof Array)&&((τ505["#"]===undefined)&&(((τp0=τ505.length),true)&&((τp0===2)&&((context=τ505[0]),true,(env=τ505[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var args;if(((τ506 instanceof Array)&&((τ506["#"]===undefined)&&(((τp0=τ506.length),true)&&((τp0>=1)&&(((τp1=τ506[0]),(τp1==="data"))&&((args=τ506.slice(1)),true))))))){false;}else{throw "a condition failed";}var acc=gensym();var labv=gensym();var stmts=["multi",["send","=",["data",acc,["data"]]]];var rval=function(){var τ507=args;var τp0;var τp1;var τp2;var tests;var τp0;var labels;var τp1;var τp2;var tests;var τ508=false;var τ509=false;var τ510=false;if(((τ508=(τ507 instanceof Array))&&((τ509=(τ507["#"]===undefined))&&((τ510=((τp0=τ507.length),true))&&((τp0===1)&&(((τp1=τ507[0]),(τp2=projector(aslist)(τp1)),τp2[0])&&((tests=τp2[1]),true))))))){stmts.push(["send","=",["data",labv,["data"]]]);return (stmts=stmts.concat(blocktest_mac(labv,tests,acc)));}else{if((τ510&&((τp0===2)&&(((labels=τ507[0]),true,(τp1=τ507[1]),(τp2=projector(aslist)(τp1)),τp2[0])&&((tests=τp2[1]),true))))){stmts.push(["send","=",["data",labv,["send",["send","!",["data","Array",null]],labels]]]);return (stmts=stmts.concat(blocktest_mac(labv,tests,acc)));}else{throw ["Could not find a match",τ507];}}}();return rval;});stdenv.register_macro("macro",function(τ511,expr){var τp0;var context;var env;if(((τ511 instanceof Array)&&((τ511["#"]===undefined)&&(((τp0=τ511.length),true)&&((τp0===2)&&((context=τ511[0]),true,(env=τ511[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var τp2;var τp3;var τp4;var name;var args;var body;if(((expr instanceof Array)&&((expr["#"]===undefined)&&(((τp0=expr.length),true)&&((τp0===3)&&(((τp1=expr[0]),(τp1==="data"))&&(((τp2=expr[1]),(τp2 instanceof Array))&&((τp2["#"]===undefined)&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="send"))&&((name=τp2[1]),true,(args=τp2[2]),true,(body=expr[2]),true)))))))))))){false;}else{throw "a condition failed";}var fn=["send","->",["data",args,body]];var code=generate_from_ast(fn);var efn=eval((("("+code.slice(0,(-1)))+")"));env.register_macro(name,efn);return ["value",undefined];});var js_op_table=({"___plus":"+","___minus":"-","___times":"*","___div":"/","___mod":"%","___binxor":"^","___binand":"&","___binor":"|","___binnot":"~","___and":"&&","___or":"||","___not":"!","___is":"===","___isnt":"!==","___eq":"===","___neq":"!==","___lt":"<","___gt":">","___lte":"<=","___gte":">=","___shl":"<<","___shr":">>","___shr2":">>>","___in":" in ","___instanceof":" instanceof ","___plusplus":"++","___minusminus":"--"});var translate=function(τ513,mode){var expr;var τ512;(expr=τ513);true;(τ512=τ513);var τ514=τ512;var τ515;var τ516;var s;var s;var τp0;var τp1;var v;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var f;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var f;var msg;var τp0;var τp1;var f;var τp2;var msg;var τp3;var τp4;var s;var τp0;var τp1;var f;var τp2;var τp3;var τp4;var args;var τp0;var τp1;var f;var msg;var τp0;var τp1;var args;var τp0;var τp1;var args;var τp0;var τp1;var bindings;var body;var τp0;var τp1;var test;var pos;var neg;var τp0;var τp1;var binding;var τp2;var τp3;var τp4;var τp5;var τp0;var τp1;var binding;var value;var τp0;var τp1;var τp2;var τp3;var τp4;var obj;var msg;var rhs;var τp0;var τp1;var lhs;var rhs;var τp0;var τp1;var args;var τp0;var τp1;var args;var τp0;var τp1;var value;var τp0;var τp1;var τp0;var τp1;var τp0;var τp1;var value;var τp0;var τp1;var value;var τp0;var τp1;var test;var body;var τp0;var τp1;var x;var y;var z;var body;var τp0;var τp1;var x;var y;var body;var τp0;var τp1;var attempt;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var v;var body;var τp8;var other;var τ517=false;var τ518=false;var τ519=false;var τ520=false;var τ521=false;if((((typeof(τ514)==="string")&&((s=τ514),true))||((τ514 instanceof Array)&&((τ514["#"]===undefined)&&(((τ515=τ514.length),true)&&((τ515===2)&&(((τ516=τ514[0]),(τ516==="symbol"))&&((s=τ514[1]),true)))))))){return translate.expr(translate.mangle(s),mode);}else{if((τ514===null)){return translate.expr("null",mode);}else{if(((τ517=(τ514 instanceof Array))&&((τ518=(τ514["#"]===undefined))&&((τ519=((τp0=τ514.length),true))&&((τp0===2)&&(((τp1=τ514[0]),(τp1==="value"))&&((v=τ514[1]),true))))))){var r=function(){var τ522=v;var other;if((typeof(τ522)==="string")){var repl=({"\"":"\\\"","\n":"\\n","\\":"\\\\"});(v=v.replace(RegExp("((?:(?:\"|\\\\)|\n))","g"),function(m){return send(repl,m);}));return (("\""+v)+"\"");}else{if((τ522===(void 0))){return "(void 0)";}else{if(((((typeof(τ522)==="number")||(τ522===true))||(τ522===false))||(τ522===null))){return String(v);}else{if(((other=τ522),true)){return (("?!?["+v)+"]?!?");}else{throw ["Could not find a match",τ522];}}}}}();return translate.expr(r,mode);}else{if((τ519&&((τ520=(τp0===3))&&((τ521=((τp1=τ514[0]),(τp1==="send")))&&(((τp2=τ514[1]),(τp2==="___node"))&&(((τp3=τ514[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===2)&&(((τp5=τp3[0]),(τp5==="value"))&&((f=τp3[1]),true))))))))))){return f;}else{if((τ521&&(((τp2=τ514[1]),(τp2==="___js_fetch"))&&(((τp3=τ514[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="array"))&&((f=τp3[1]),true,(msg=τp3[2]),true))))))))){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{if((τ521&&(((f=τ514[1]),true,(τp2=τ514[2]),(msg=τp2),true,(τp2 instanceof Array))&&((τp2["#"]===undefined)&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="value"))&&((s=τp2[1]),true)))))))){if(((typeof(s)==="string")&&s.match(RegExp("(?:^(?:[a-zA-Z_$]+)$)","")))){var trf=translate(f,"expr");var trmsg=translate(s,"expr");return translate.expr(((trf+".")+trmsg),mode);}else{if(true){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{return false;}}}else{if((τ521&&(((f=τ514[1]),true,(τp2=τ514[2]),(τp2 instanceof Array))&&((τp2["#"]===undefined)&&(((τp3=τp2.length),true)&&((τp3>=1)&&(((τp4=τp2[0]),(τp4==="array"))&&((args=τp2.slice(1)),true)))))))){var op=((typeof(f)==="string")&&send(js_op_table,f));if(op){return translate.expr(translate.op(op,args[0],args[1]),mode);}else{if(true){var trf=translate(f,"expr");var trargs=function(){var τ523=[];var τ524=args;var τ525=τ524.length;for(var τ526=0;(τ526<τ525);(τ526++)){var τ527=τ524[τ526];var x;var other;if(((x=τ527),true)){τ523.push(translate(x,"expr"));}else{if(((other=τ527),true)){false;}else{throw ["Could not find a match",τ527];}}}return τ523;}();return translate.expr((((trf+"(")+trargs.join(","))+")"),mode);}else{return false;}}}else{if((τ521&&((f=τ514[1]),true,(msg=τ514[2]),true))){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((("send("+trf)+",")+trmsg)+")"),mode);}else{if((τ519&&((τ520=(τp0>=1))&&(((τp1=τ514[0]),(τp1==="array"))&&((args=τ514.slice(1)),true))))){var r=function(){var f=function(x){return translate(x,"expr");};return (("["+args.map(f).join(","))+"]");}();return translate.expr(r,mode);}else{if((τ520&&(((τp1=τ514[0]),(τp1==="object"))&&((args=τ514.slice(1)),true)))){var r=function(){var f=function(x){var a=translate(x[1],"expr");var b=translate(x[2],"expr");return ((a+":")+b);};return (("({"+args.map(f).join(","))+"})");}();return translate.expr(r,mode);}else{if((τ519&&((τp0===3)&&(((τp1=τ514[0]),(τp1==="lambda"))&&((bindings=τ514[1]),true,(body=τ514[2]),true))))){var a=bindings.join(",");var b=translate.body(body,"return");return translate.expr((((("function("+a)+"){")+b)+"}"),mode);}else{if((τ519&&((τp0===4)&&(((τp1=τ514[0]),(τp1==="if"))&&((test=τ514[1]),true,(pos=τ514[2]),true,(neg=τ514[3]),true))))){var τ528=mode;var other;if((τ528==="expr")){return translate.body(expr,"expr");}else{if(((other=τ528),true)){var a=translate(test,"expr");var b=translate(pos,mode);var c=translate(neg,mode);return (((((("if("+a)+"){")+b)+"}else{")+c)+"}");}else{throw ["Could not find a match",τ528];}}}else{if((τ519&&((τ520=(τp0===3))&&((τ521=((τp1=τ514[0]),(τp1==="declare")))&&(((binding=τ514[1]),true,(τp2=τ514[2]),(τp2 instanceof Array))&&((τp2["#"]===undefined)&&(((τp3=τp2.length),true)&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="value"))&&((τp5=τp2[1]),(τp5===(void 0)))))))))))){var τ529=mode;var other;if(((τ529==="expr")||(τ529==="return"))){throw "Invalid in expr ctx";}else{if(((other=τ529),true)){var a=translate(binding,"expr");return (("var "+a)+";");}else{throw ["Could not find a match",τ529];}}}else{if((τ521&&((binding=τ514[1]),true,(value=τ514[2]),true))){var τ530=mode;var other;if(((τ530==="expr")||(τ530==="return"))){throw "Invalid in expr ctx";}else{if(((other=τ530),true)){var a=translate(binding,"expr");var b=translate(value,"expr");return (((("var "+a)+"=")+b)+";");}else{throw ["Could not find a match",τ530];}}}else{if((τ520&&((τ521=((τp1=τ514[0]),(τp1==="assign")))&&(((τp2=τ514[1]),(τp2 instanceof Array))&&((τp2["#"]===undefined)&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="send"))&&((obj=τp2[1]),true,(msg=τp2[2]),true,(rhs=τ514[2]),true))))))))){var a=translate(obj,"expr");var b=translate(msg,"expr");var c=translate(rhs,"expr");return translate.expr((((((("("+a)+"[")+b)+"]=")+c)+")"),mode);}else{if((τ521&&((lhs=τ514[1]),true,(rhs=τ514[2]),true))){var a=translate(lhs,"expr");var b=translate(rhs,"expr");return translate.expr((((("("+a)+"=")+b)+")"),mode);}else{if((τ519&&((τ520=(τp0>=1))&&(((τp1=τ514[0]),(τp1==="multi"))&&((args=τ514.slice(1)),true))))){var isdecl=function(τ531){var τ532=τ531;var τp0;var τp1;var variable;var value;var other;if(((τ532 instanceof Array)&&((τ532["#"]===undefined)&&(((τp0=τ532.length),true)&&((τp0===3)&&(((τp1=τ532[0]),(τp1==="declare"))&&((variable=τ532[1]),true,(value=τ532[2]),true))))))){return true;}else{if(((other=τ532),true)){return false;}else{throw ["Could not find a match",τ532];}}};if((args.length===1)){return translate(args[0],mode);}else{if(((mode==="expr")&&(!args.some(isdecl)))){var xs=function(){var τ533=[];var τ534=args;var τ535=τ534.length;for(var τ536=0;(τ536<τ535);(τ536++)){var τ537=τ534[τ536];var x;var other;if(((x=τ537),true)){τ533.push(translate(x,"expr"));}else{if(((other=τ537),true)){false;}else{throw ["Could not find a match",τ537];}}}return τ533;}();return (("("+xs.join(","))+")");}else{if(true){return translate.body(expr,mode);}else{return false;}}}}else{if((τ520&&(((τp1=τ514[0]),(τp1==="splice"))&&((args=τ514.slice(1)),true)))){return translate(patch_array(["multi"],args),mode);}else{if((τ519&&((τp0===2)&&(((τp1=τ514[0]),(τp1==="js_new"))&&((value=τ514[1]),true))))){return translate.expr((("(new "+translate(value,"expr"))+")"),mode);}else{if((τ519&&((τ520=(τp0===1))&&((τp1=τ514[0]),(τp1==="js_break"))))){if((mode==="expr")){throw "Invalid break in ctx";}else{if(true){return "break;";}else{return false;}}}else{if((τ520&&((τp1=τ514[0]),(τp1==="js_continue")))){if((mode==="expr")){throw "Invalid continue in ctx";}else{if(true){return "continue;";}else{return false;}}}else{if((τ519&&((τ520=(τp0===2))&&(((τp1=τ514[0]),(τp1==="js_return"))&&((value=τ514[1]),true))))){if((mode==="expr")){throw "Invalid return in ctx";}else{if(true){return (("return "+translate(value,"expr"))+";");}else{return false;}}}else{if((τ520&&(((τp1=τ514[0]),(τp1==="js_throw"))&&((value=τ514[1]),true)))){if((mode==="expr")){return (("function(){throw "+translate(value,"expr"))+";}()");}else{if(true){return (("throw "+translate(value,"expr"))+";");}else{return false;}}}else{if((τ519&&((τp0===3)&&(((τp1=τ514[0]),(τp1==="js_while"))&&((test=τ514[1]),true,(body=τ514[2]),true))))){var τ538=mode;var other;if((τ538==="expr")){return translate.body(expr,"expr");}else{if(((other=τ538),true)){var a=translate(test,"expr");var b=translate(body,"stmt");return (((("while("+a)+"){")+b)+"}");}else{throw ["Could not find a match",τ538];}}}else{if((τ519&&((τp0===5)&&(((τp1=τ514[0]),(τp1==="js_for"))&&((x=τ514[1]),true,(y=τ514[2]),true,(z=τ514[3]),true,(body=τ514[4]),true))))){var τ539=mode;var other;if((τ539==="expr")){return translate.body(expr,"expr");}else{if(((other=τ539),true)){var a=translate(x,"stmt");var b=translate(y,"stmt");var c=translate(z,"expr");var d=translate(body,"stmt");return (((((("for("+a)+b)+c)+"){")+d)+"}");}else{throw ["Could not find a match",τ539];}}}else{if((τ519&&((τ520=(τp0===4))&&(((τp1=τ514[0]),(τp1==="js_for_in"))&&((x=τ514[1]),true,(y=τ514[2]),true,(body=τ514[3]),true))))){var τ540=mode;var other;if((τ540==="expr")){return translate.body(expr,"expr");}else{if(((other=τ540),true)){var a=translate(x,"expr");var b=translate(y,"expr");var c=translate(body,"stmt");return (((((("for("+a)+" in ")+b)+"){")+c)+"}");}else{throw ["Could not find a match",τ540];}}}else{if((τ520&&(((τp1=τ514[0]),(τp1==="js_try"))&&(((attempt=τ514[1]),true,(τp2=τ514[2]),(τp2 instanceof Array))&&((τp2["#"]===undefined)&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="lambda"))&&(((τp5=τp2[1]),(τp5 instanceof Array))&&((τp5["#"]===undefined)&&(((τp6=τp5.length),true)&&((τp6===1)&&(((τp7=τp5[0]),(typeof(τp7)==="string"))&&((v=τp7),true,(body=τp2[2]),true,(τp8=τ514[3]),(τp8===null))))))))))))))){var τ541=mode;var other;if((τ541==="expr")){return translate.body(expr,"expr");}else{if(((other=τ541),true)){var a=translate(attempt,"stmt");var b=translate(body,"stmt");return (((((("try{"+a)+"}catch(")+v)+"){")+b)+"}");}else{throw ["Could not find a match",τ541];}}}else{if(((other=τ514),true)){throw other;}else{throw ["Could not find a match",τ514];}}}}}}}}}}}}}}}}}}}}}}}}}}}}};(translate["mangle"]=function(name){var tr=({"+":"__plus__","-":"__minus__","*":"__asterisk__","/":"__slash__","%":"__percent__","^":"__caret__","#":"__hash__","&":"__amp__","|":"__pipe__","@":"__at__","!":"__bang__","?":"__qmark__","=":"__equal__","<":"__lt__",">":"__gt__","~":"__tilde__",".":"__dot__",":":"__colon__"});var r=[];for(var i=0;(i<name.length);(++i)){var c=send(name,i);r.push((send(tr,c)||c));}return r.join("");});(translate["body"]=function(b,mode){(orig=b);(b=aslist(b));var trst=function(stmt){return translate(stmt,"stmt");};var τ542=mode;var other;if((τ542==="expr")){var x=["send",["lambda",[],orig],["array"]];return translate(x,mode);}else{if((τ542==="return")){var stmts=b.slice(0,(-1));var ret=send(b,(b.length-1));return (stmts.map(trst).join("")+translate(ret,"return"));}else{if((τ542==="stmt")){return b.map(trst).join("");}else{if(((other=τ542),true)){throw "OopsH";}else{throw ["Could not find a match",τ542];}}}}});(translate["expr"]=function(x,τ543){var τ544=τ543;var other;if((τ544==="expr")){return x;}else{if((τ544==="stmt")){return (x+";");}else{if((τ544==="return")){return (("return "+x)+";");}else{if(((other=τ544),true)){throw "OopsI";}else{throw ["Could not find a match",τ544];}}}}});(translate["op"]=function(op,a,b){var e=function(){var τ545=[a,b];var τp0;var τp1;var τp0;var τp1;var τ546=false;var τ547=false;var τ548=false;var τ549=false;if(((τ546=(τ545 instanceof Array))&&((τ547=(τ545["#"]===undefined))&&((τ548=((τp0=τ545.length),true))&&((τ549=(τp0===2))&&(((τp1=τ545[0]),(τp1===null))&&(τ545[1],true))))))){return (op+translate(b,"expr"));}else{if((τ549&&(τ545[0],true,(τp1=τ545[1]),(τp1===null)))){return (translate(a,"expr")+op);}else{if(true){return ((translate(a,"expr")+op)+translate(b,"expr"));}else{throw ["Could not find a match",τ545];}}}}();return (("("+e)+")");});var generate_from_ast=function(ast){var ex=expand(["top",stdenv.fork()],["multi",ast]);return translate(ex,"stmt");};var generate=function(data,prelude){var p=parse(data);var ex=expand(["top",stdenv.fork()],["multi",p]);return ((prelude||"")+translate(ex,"stmt"));};(exports["generate"]=generate);
