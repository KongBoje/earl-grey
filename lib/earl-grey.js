var τ27=function(type){var τ28=type["::check"];var f;if((τ28===(void 0))){return function(value){return (value instanceof type);};}else{if(((f=τ28),true)){return function(value){return f.call(type,value);};}else{throw τ19(["match"]).create("Could not find a match",({"value":τ28}));}}};
var τ29=function(dest,values){for(k in values){if(values.hasOwnProperty(k)){(dest[k]=send(values,k));}else{null;}}return dest;};
var τ19=function(){var τ20=function(tags){var τ21=function(){if((!τ27(τ20)(this))){return Object.create(τ20.prototype);}else{return this;}}();(τ21["tags"]=tags);return τ21;};τ29(τ20);(τ20.prototype["create"]=function(){var τ22=Array.prototype.slice.call(arguments,0);var τp0;var message;var args;if(((τ22 instanceof Array)&&(((τp0=τ22.length),true)&&((τp0>=0)&&((message=function(){if((0>=τp0)){return "";}else{return τ22[0];}}()),true,(args=τ22.slice(1)),true))))){var τ21=this;var e=Error(message);(e["::tags"]=τ21.tags);(e["args"]=args);(e["name"]=["E"].concat(τ21.tags).join("."));return e;}else{throw τ19(["match"]).create("Could not find a match",({"value":τ22}));}});(τ20.prototype["::check"]=function(e){var τ21=this;if(((!e)||(!τ27(Error)(e)))){return false;}else{null;}var tags=(e["::tags"]||[]);var τ23=τ21.tags;var τ24=τ23.length;for(var τ25=0;(τ25<τ24);(τ25++)){var τ26=τ23[τ25];var tag;var other;if(((tag=τ26),true,(tags.indexOf(tag)===(-1)))){return false;}else{if(((other=τ26),true)){false;}else{throw τ19(["match"]).create("Could not find a match",({"value":τ26}));}}}false;return true;});(τ20.prototype["::deconstruct"]=function(e){var τ21=this;return e.args;});return τ20;}();
var τ30=function(){var r=[];for(var i=0;(i<arguments.length);(i++)){(r=r.concat(arguments[i]));}return r;};
var τ31=function(τ32){var τ33=τ32;var x;var x;var other;if((((typeof(τ33)==="string")&&((x=τ33),true))||((typeof(τ33)==="number")&&((x=τ33),true)))){return ["value",x];}else{if(((other=τ33),true)){return other["::serialize_ast"]();}else{throw τ19(["match"]).create("Could not find a match",({"value":τ33}));}}};
var send=function(obj,τ12){var msg;var τ11;(msg=τ12);true;(τ11=τ12);var τ13=τ11;var other;if(((typeof(τ13)==="string")||(typeof(τ13)==="number"))){return obj[msg];}else{if(((other=τ13),true)){return obj["::send"](msg);}else{throw τ19(["match"]).create("Could not find a match",({"value":τ13}));}}};(Array[":::project"]=function(τ15){var value;var τ14;(value=τ15);true;(τ14=τ15);var τ16=τ14;var _;if(τ27(Array)(τ16)){return [true,value];}else{if(((_=τ16),true)){return [true,[value]];}else{throw τ19(["match"]).create("Could not find a match",({"value":τ16}));}}});(Array.prototype["::check"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){return false;}else{null;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){var rval=this.slice(0);rval.push(value);return [true,rval];}else{null;}}return [true,value];}else{var rval=this.slice(0);rval.push(value);return [true,rval];}});(Array.prototype[":::deconstruct"]=function(value){return [true,value.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return τ30(["array"],this.map(τ31));});(RegExp.prototype["::check"]=function(value){return value.match(this);});(RegExp.prototype[":::project"]=function(value){var τ17=value.match(this);var m;var m;if(((τ17===null)&&((m=τ17),true))){return [false,null];}else{if(((m=τ17),true)){return [true,m];}else{throw τ19(["match"]).create("Could not find a match",({"value":τ17}));}}});(RegExp.prototype[":::deconstruct"]=function(value){var τ18=value.match(this);var m;var m;if(((τ18===null)&&((m=τ18),true))){return [false,null];}else{if(((m=τ18),true)){return [true,m];}else{throw τ19(["match"]).create("Could not find a match",({"value":τ18}));}}});(Function.prototype["::send"]=function(args){return this.apply(this,args);});
var τ42=function(type){return function(value){var τ43=type[":::project"];var f;if((τ43===(void 0))){var τ44=type["::project"];var f;if((τ44===(void 0))){return [true,type(value)];}else{if(((f=τ44),true)){var τ46;try{(τ46=[true,f(value)]);}catch(τ45){(τ46=[false,null]);}return τ46;}else{throw τ19(["match"]).create("Could not find a match",({"value":τ44}));}}}else{if(((f=τ43),true)){return f.call(type,value);}else{throw τ19(["match"]).create("Could not find a match",({"value":τ43}));}}};};var τ34=require("./location");var Source=τ34.Source;var Location=τ34.Location;var highlight_locations=τ34.highlight_locations;var τ35=require("./lex");var tokenize=τ35.tokenize;var τ36=require("./parse");var parse=τ36.parse;var τ37=require("./expand");var expand=τ37.expand;var τ38=require("./stdenv");var stdenv=τ38.stdenv;var stdprelude=τ38.stdprelude;var τ39=require("./translate-js");var translate=τ39.translate;var Translator=τ39.Translator;var e2=require("./stdenv2");var opt=require("./opt");var generate_from_ast=function(ast){var ex=expand(["top",stdenv.fork()],["multi",ast]);return translate(ex,"stmt");};var generate=function(source,prelude){var t=tokenize(source);var p=parse(t);var ex=expand(["top",stdenv.fork()],["multi",p]);return ((prelude||"")+translate(ex,"stmt"));};var generate2=function(source){return Generator2().generate(source);};var Generator=function(){var τ40=function(){if((!τ27(Generator)(this))){return Object.create(Generator.prototype);}else{return this;}}();(τ40["tr"]=Translator(stdprelude));return τ40;};τ29(Generator);(Generator.prototype["generate"]=function(source){var τ40=this;var t=tokenize(source);var p=parse(t);var ex=expand(["top",stdenv.fork()],["multi",p]);var rval=τ40.tr.translate(ex,"stmt");return (τ40.tr.dump_store()+rval);});Generator;var Generator2=function(){var τ41=function(){if((!τ27(Generator2)(this))){return Object.create(Generator2.prototype);}else{return this;}}();(τ41["tr"]=Translator(e2.stdprelude));return τ41;};τ29(Generator2);(Generator2.prototype["generate"]=function(source){var τ41=this;var t=tokenize(source);var p=parse(t);var ex=e2.expand(["top"],e2.topscope,e2.bind_ast(τ42(["multi"])(p)[1],e2.stdenv.fork()));(ex=opt.hoist(ex));var rval=τ41.tr.translate(ex,"stmt");return (τ41.tr.dump_store()+rval);});Generator2;(exports["Source"]=Source);(exports["Location"]=Location);(exports["highlight_locations"]=highlight_locations);(exports["tokenize"]=tokenize);(exports["parse"]=parse);(exports["generate_from_ast"]=generate_from_ast);(exports["generate"]=generate);(exports["Generator"]=Generator);(exports["Generator2"]=Generator2);(exports["generate2"]=generate2);
