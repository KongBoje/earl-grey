var $185=function(type$187){var f$190;(f$190=type$187["::check"]);;if((f$190===(void 0))){return function(value$195){return (value$195 instanceof type$187);};}else{return function(value$198){return f$190.call(type$187,value$198);};}};
var $200=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $201=function(dest$203,values$204){var k$209;(k$209=null);$207:for(k$209 in values$204){if(values$204.hasOwnProperty(k$209)){(dest$203[k$209]=values$204[k$209]);}}return dest$203;};
var $213=function($214$216){var ph$220;(ph$220=$214$216);;var $218$225;($218$225=ph$220);;var bridge$219$230;var x$234;(bridge$219$230=$218$225);if((((typeof(bridge$219$230)==="string")&&((x$234=bridge$219$230),true))||((typeof(bridge$219$230)==="number")&&((x$234=bridge$219$230),true)))){return ["value",x$234];}else{var other$241;(other$241=$218$225);return other$241["::serialize_ast"]();}};
var send$25;(send$25=function(obj$30,$28$31){var ph$35;var msg$36;var t0$38;(t0$38=$28$31);(msg$36=t0$38);(ph$35=t0$38);;var $33$42;($33$42=ph$35);;var bridge$34$47;(bridge$34$47=$33$42);if(((typeof(bridge$34$47)==="string")||(typeof(bridge$34$47)==="number"))){return obj$30[msg$36];}else{var other$55;(other$55=$33$42);return obj$30["::send"](msg$36);}});;(Array[":::project"]=function($58$60){var ph$63;var value$64;var t0$66;(t0$66=$58$60);(value$64=t0$66);(ph$63=t0$66);;var $62$70;($62$70=ph$63);;if($185(Array)($62$70)){return [true,value$64];}else{$62$70;return [true,[value$64]];}});(Array.prototype["::check"]=function(value$84){if((value$84 instanceof Array)){var i$89;(i$89=0);;$87:for(;(i$89<this.length);(i$89++)){if(($200(this,i$89)!==$200(value$84,i$89))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $201(this.slice(0),this);});(Array.prototype[":::project"]=function(value$100){if((value$100 instanceof Array)){var i$105;(i$105=0);;$103:for(;(i$105<this.length);(i$105++)){if(($200(this,i$105)!==$200(value$100,i$105))){return [true,[value$100]];}}return [true,value$100.slice(this.length)];}else{return [true,[value$100]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($213));});(RegExp.prototype["::check"]=function($115$117){var ph$120;(ph$120=$115$117);;var $119$125;($119$125=ph$120);;var value$133;if((typeof($119$125)==="string")){(value$133=$119$125);if(value$133.match(this)){return true;}else{return false;}}else{var other$138;(other$138=$119$125);return false;}});(RegExp.prototype[":::project"]=function($140$142){var ph$145;(ph$145=$140$142);;var $144$150;($144$150=ph$145);;var value$158;if((typeof($144$150)==="string")){(value$158=$144$150);var $161$163;($161$163=value$158.match(this));;var m$171;if(($161$163===null)){(m$171=$161$163);return [false,null];}else{var m$176;(m$176=$161$163);return [true,m$176];}}else{var other$180;(other$180=$144$150);return [false,null];}});(Function.prototype["::send"]=function(args$183){return this.apply(this,args$183);});
var $744=function(arr$746){var results$750;var l$751;(results$750=[]);;(l$751=arr$746.length);;var i$759;(i$759=0);;$749:for(;(i$759<l$751);(i$759++)){results$750.push([i$759,$200(arr$746,i$759)]);}return results$750;};
var $575=function(){var $576$578;($576$578=function(tags$582){var it$0$585;(it$0$585=function(){if((!$185($576$578)(this))){return Object.create($576$578.prototype);}else{return this;}}());;(it$0$585["tags"]=tags$582);return it$0$585;});;($576$578.prototype["create"]=function(){var $594$596;($594$596=arguments);;var t0$601;var message$605;var args$606;(t0$601=$594$596.length);if((t0$601>=0)){(message$605=function(){if((0>=t0$601)){return "";}else{return $594$596[0];}}());(args$606=Array.prototype.slice.call($594$596,1));var it$0$610;(it$0$610=this);;var self$615;(self$615=this);;var e$620;(e$620=Error(message$605));;(e$620["::tags"]=it$0$610.tags);(e$620["args"]=args$606);var temp$628;(temp$628=$744(args$606));;var $length$633;($length$633=temp$628.length);;var $index$638;($index$638=0);;$621:for(;($index$638<$length$633);($index$638++)){var m$646;(m$646=temp$628[$index$638]);;var t0$651;var t1$652;var i$656;var arg$657;(t0$651=m$646);if(((t0$651 instanceof Array)&&((t1$652=t0$651.length),(t1$652===2)))){(i$656=t0$651[0]);(arg$657=t0$651[1]);(e$620[i$656]=arg$657);}else{$562(m$646);;}}(e$620["length"]=args$606.length);(e$620["name"]=["E"].concat(it$0$610.tags).join("."));return e$620;}else{$562($594$596);}});($576$578.prototype["::check"]=function(e$668){var it$0$671;(it$0$671=this);;var self$676;(self$676=this);;var tags$681;if(((!e$668)||(!$185(Error)(e$668)))){return false;}(tags$681=(e$668["::tags"]||[]));;var temp$690;(temp$690=it$0$671.tags);;var $length$695;($length$695=temp$690.length);;var $index$700;($index$700=0);;$682:for(;($index$700<$length$695);($index$700++)){var m$708;(m$708=temp$690[$index$700]);;var tag$716;(tag$716=m$708);if((tags$681.indexOf(tag$716)===-1)){return false;}else{false;;}}return true;});($576$578.prototype["::deconstruct"]=function(e$724){var it$0$727;(it$0$727=this);;var self$732;(self$732=this);;return e$724.args;});$201($576$578,$201(function(){var accum$737;(accum$737=({}));(accum$737["::name"]="$576");return accum$737;}(),function(){var accum$741;(accum$741=({}));(accum$741["::egclass"]=true);return accum$741;}()));return $576$578;}();
var $562=function(value$564,url$565,start$566,end$567){var err$570;(err$570=$575(["match"]).create("Could not find a match for value",({"value":value$564})));;if(url$565){(err$570["location"]=["location",url$565,start$566,end$567]);}throw err$570;};
var $766=function($767$769,key$770){var ph$774;(ph$774=$767$769);;var $772$779;($772$779=ph$774);;var bridge$773$784;(bridge$773$784=$772$779);if(((bridge$773$784===null)||(bridge$773$784===(void 0)))){return false;}else{var x$792;if((typeof($772$779)==="string")){(x$792=$772$779);return (key$770 in String.prototype);}else{var x$797;if((typeof($772$779)==="number")){(x$797=$772$779);return (key$770 in Number.prototype);}else{var x$802;(x$802=$772$779);return (key$770 in x$802);}}}};
var $804=function(obj$806){var results$810;(results$810=[]);;var k$815;(k$815=null);$809:for(k$815 in obj$806){if(Object.prototype.hasOwnProperty.call(obj$806,k$815)){results$810.push([k$815,$200(obj$806,k$815)]);}}return results$810;};var accum$554;var accum$558;var $245$252;var Source$253;var Location$254;var highlight_locations$255;var $246$256;var tokenize$257;var $247$258;var parse$259;var $248$260;var translate$261;var Translator$262;var std$263;var exp$264;var opt$265;var generate_from_ast$266;var generate$267;var Generator$268;($245$252=require("./location"));;(Source$253=$245$252.Source);;(Location$254=$245$252.Location);;(highlight_locations$255=$245$252.highlight_locations);;($246$256=require("./lex"));;(tokenize$257=$246$256.tokenize);;($247$258=require("./parse"));;(parse$259=$247$258.parse);;($248$260=require("./translate-js"));;(translate$261=$248$260.translate);;(Translator$262=$248$260.Translator);;(std$263=require("./stdenv"));;(exp$264=require("./expand"));;(opt$265=require("./opt"));;(generate_from_ast$266=function(ast$314){var ex$317;var tr$318;var rval$319;(ex$317=std$263.expand(["top"],std$263.topscope,std$263.stdenv.fork().convert(["multi",ast$314])));;(ex$317=opt$265.hoist(ex$317));(tr$318=Translator$262());;(rval$319=tr$318.translate(ex$317,"expr"));;return [tr$318.dump_store(),rval$319];});;std$263.stdenv.bind(std$263.topscope,"macro",["macro",function(context$332,scope$333,form$334,$330$335){var t0$374;var t1$375;var prep$369;var code$370;var mac$371;var mac2$372;var name$356;var sym$357;var arguments$358;var ast$359;var t0$348;var t1$349;var t2$350;var t3$351;var t4$352;var $337$343;var ph$338;(ph$338=$330$335);;($337$343=ph$338);;if((($337$343 instanceof Array)&&((t0$348=$337$343.length),((t0$348===3)&&(($337$343[0]==="data")&&((t1$349=$337$343[1]),((t1$349 instanceof Array)&&((t2$350=t1$349.length),((t2$350===3)&&((t1$349[0]==="send")&&((t3$351=t1$349[1]),((name$356=t3$351),((t3$351 instanceof Array)&&((t4$352=t3$351.length),((t4$352===2)&&(t3$351[0]==="symbol")))))))))))))))){(sym$357=t3$351[1]);(arguments$358=t1$349[2]);(ast$359=$337$343[2]);(t0$374=generate_from_ast$266(["send",["symbol","->"],["data",arguments$358,ast$359]]));if(((t0$374 instanceof Array)&&((t1$375=t0$374.length),(t1$375===2)))){(prep$369=t0$374[0]);(code$370=t0$374[1]);;}else{$562(generate_from_ast$266(["send",["symbol","->"],["data",arguments$358,ast$359]]),"/home/olivier/git/earl-grey/src/earl-grey.eg",798,848);}(mac$371=eval((prep$369+((";("+code$370)+")"))));;(mac2$372=function(c$386,s$387,f$388,e$389){var env$392;var r$393;(env$392=scope$333.expander.mkenv());;env$392.bind(scope$333,sym$357,["macro",mac2$372]);(r$393=mac$371(c$386,s$387,f$388,e$389));;return env$392.convert(r$393);});;return ["declare_raw",name$356,["macro",mac2$372]];}else{$562($337$343);}}]);std$263.stdenv.bind(std$263.topscope,"macros",["macro",function(context$406,scope$407,$403$408,$404$409){var t0$414;var t0$419;var t1$420;var t0$430;var t1$431;var $index$458;var $length$453;var temp$448;var acc$443;var prep$426;var code$427;var the_macros$428;var env$411;var body$412;(t0$414=$403$408);if($766(t0$414,"env")){(env$411=t0$414.env);;}else{$562($403$408);}(t0$419=$404$409);if(((t0$419 instanceof Array)&&((t1$420=t0$419.length),((t1$420===2)&&(t0$419[0]==="data"))))){(body$412=t0$419[1]);;}else{$562($404$409);}(t0$430=generate_from_ast$266(body$412));if(((t0$430 instanceof Array)&&((t1$431=t0$430.length),(t1$431===2)))){(prep$426=t0$430[0]);(code$427=t0$430[1]);;}else{$562(generate_from_ast$266(body$412),"/home/olivier/git/earl-grey/src/earl-grey.eg",1358,1388);}(the_macros$428=eval((((prep$426+";(")+code$427)+")")));;return ["splice"].concat((((acc$443=[])),(((temp$448=$804(the_macros$428))),((($length$453=temp$448.length)),((($index$458=0)),function(){$440:for(;($index$458<$length$453);($index$458++)){var k$476;var v$477;var t0$471;var t1$472;var m$466;(m$466=temp$448[$index$458]);;(t0$471=m$466);if(((t0$471 instanceof Array)&&((t1$472=t0$471.length),(t1$472===2)))){(k$476=t0$471[0]);(v$477=t0$471[1]);acc$443.push(["declare_raw",$201(["symbol",k$476],({"env":env$411})),["macro",v$477]]);}else{$562(m$466,"/home/olivier/git/earl-grey/src/earl-grey.eg",1458,1565);;}}}()))),acc$443));}]);(generate$267=function(source$486){return Generator$268().generate(source$486);});;(Generator$268=function(){var it$0$507;var interactive$503;var t0$499;var $492$494;($492$494=arguments);;(t0$499=$492$494.length);if(((t0$499>=0)&&(t0$499<=1))){(interactive$503=function(){if((0>=t0$499)){return false;}else{return $492$494[0];}}());(it$0$507=function(){if((!$185(Generator$268)(this))){return Object.create(Generator$268.prototype);}else{return this;}}());;(it$0$507["tr"]=Translator$262(std$263.stdprelude));(it$0$507["env"]=std$263.stdenv.fork());(it$0$507["interactive"]=interactive$503);return it$0$507;}else{$562($492$494);}});;(Generator$268.prototype["generate"]=function(source$519){var stmt$545;var t$532;var p$533;var ex$534;var rval$535;var self$527;var it$0$522;(it$0$522=this);;(self$527=this);;(t$532=tokenize$257(source$519));;(p$533=parse$259(t$532));;(ex$534=(((stmt$545=function(){if(it$0$522.interactive){return ["interactive",p$533];}else{return ["multi",p$533];}}())),std$263.expand(["top"],std$263.topscope,it$0$522.env.convert(stmt$545))));;(ex$534=opt$265.hoist(ex$534));(rval$535=it$0$522.tr.translate(ex$534,"stmt"));;return (it$0$522.tr.dump_store()+rval$535);});$201(Generator$268,$201(((accum$554=({})),((accum$554["::name"]="Generator"),accum$554)),((accum$558=({})),((accum$558["::egclass"]=true),accum$558))));Generator$268;(exports["Source"]=Source$253);(exports["Location"]=Location$254);(exports["highlight_locations"]=highlight_locations$255);(exports["tokenize"]=tokenize$257);(exports["parse"]=parse$259);(exports["Generator"]=Generator$268);(exports["generate"]=generate$267);
