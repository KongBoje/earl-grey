require("earlgrey-runtime");var accum$679;var accum$683;var $3$37;var Source$38;var Location$39;var highlight_locations$40;var $4$41;var tokenize$42;var $5$43;var parse$44;var $6$45;var translate$46;var Translator$47;var std$48;var exp$49;var opt$50;var $10$51;var Body$52;var vm$53;var module$54;var path$55;var version$56;var evaluator$57;var generate_from_ast$58;var generate$59;var Generator$60;($3$37=require("./location"));(Source$38=$3$37.Source);(Location$39=$3$37.Location);(highlight_locations$40=$3$37.highlight_locations);($4$41=require("./lex"));(tokenize$42=$4$41.tokenize);($5$43=require("./parse"));(parse$44=$5$43.parse);($6$45=require("./translate-js"));(translate$46=$6$45.translate);(Translator$47=$6$45.Translator);(std$48=require("./stdenv"));(exp$49=require("./expand"));(opt$50=require("./opt"));($10$51=require("./util"));(Body$52=$10$51.Body);(vm$53=require("vm"));(module$54=require("module"));(path$55=require("path"));(version$56="zero");(evaluator$57=(function($124$127){var t0$136;var accum$179;var paths$161;var e_module$162;var e_require$163;var __eval$201;var $132$151;var $129$145;var ph$133;var options$134;(t0$136=$124$127);(options$134=t0$136);(ph$133=t0$136);($129$145=ph$133);$129$145;if(module$54._nodeModulePaths){(paths$161=module$54._nodeModulePaths(options$134.cwd));(e_module$162=(new module$54(options$134.showname)));__amp____colon__(e_module$162,({"filename":options$134.filename,"paths":paths$161}));(e_require$163=(function(path$174){return module$54._load(path$174,e_module$162,true);}));__amp____colon__(e_require$163,__amp____colon__(({"main":e_module$162}),__amp____colon__(((accum$179=({})),((accum$179["resolve"]=(function(path$184){return module$54._resolveFileName(path$184,e_module$162);})),accum$179)),({"paths":paths$161,"cache":require.cache}))));__amp____colon__(global,({"__filename":options$134.filename,"__dirname":path$55.dirname(options$134.filename),"module":e_module$162,"require":e_require$163}));return (function(code$187){var script$191;(script$191=vm$53.createScript(code$187,options$134.showname));return script$191.runInThisContext();});}else{(__eval$201=eval);return (function(code$206){return __eval$201(code$206);});}}));(generate_from_ast$58=(function(ast$213){var ex$220;var tr$221;var rval$222;(ex$220=std$48.expand(["top"],std$48.topscope,std$48.stdenv.fork().mark(["multi",ast$213])));(ex$220=opt$50.hoist(ex$220));(tr$221=Translator$47());(rval$222=tr$221.translate(ex$220,"expr"));return [tr$221.dump_store(),rval$222];}));std$48.stdenv.bind(std$48.topscope,"macro",["macro",(function(context$240,scope$241,form$242,$237$243){var t0$311;var t1$312;var prep$304;var code$305;var file$306;var ev$307;var mac$308;var mac2$309;var name$266;var sym$267;var arguments$268;var ast$269;var t0$258;var t1$259;var t2$260;var t3$261;var t4$262;var $245$253;var ph$247;(ph$247=$237$243);($245$253=ph$247);if((($245$253 instanceof Array)&&(((t0$258=$245$253.length)),((t0$258===3)&&(($245$253[0]==="data")&&(((t1$259=$245$253[1])),((t1$259 instanceof Array)&&(((t2$260=t1$259.length)),((t2$260===3)&&((t1$259[0]==="send")&&(((t3$261=t1$259[1])),((name$266=t3$261),((t3$261 instanceof Array)&&(((t4$262=t3$261.length)),((t4$262===2)&&(t3$261[0]==="symbol")))))))))))))))){(sym$267=t3$261[1]);(arguments$268=t1$259[2]);(ast$269=$245$253[2]);(t0$311=generate_from_ast$58(["send",["symbol","->"],["data",arguments$268,ast$269]]));if(((t0$311 instanceof Array)&&(((t1$312=t0$311.length)),(t1$312===2)))){(prep$304=t0$311[0]);(code$305=t0$311[1]);}else{___match_error(generate_from_ast$58(["send",["symbol","->"],["data",arguments$268,ast$269]]),"/home/olivier/git/eg/src/earl-grey.eg",1709,1749);}(file$306=form$242.location.source.url);(ev$307=evaluator$57(({"filename":file$306,"showname":file$306,"cwd":file$306})));(mac$308=ev$307((((prep$304+";(")+code$305)+")")));(mac2$309=(function(c$338,s$339,f$340,e$341){var bindings$348;var env$349;var r$350;(bindings$348=form$242.env.list_bindings(scope$241));(env$349=exp$49.Env());(env$349.scopes[std$48.topscope.name]=bindings$348);(r$350=mac$308(c$338,s$339,f$340,e$341));return env$349.mark(r$350);}));return ["declare_raw",name$266,["macro",mac2$309]];}else{___match_error($245$253);}})]);std$48.stdenv.bind(std$48.topscope,"macros",["macro",(function(context$372,scope$373,$367$374,$369$375){var t0$381;var t0$390;var t1$391;var t0$415;var t1$416;var $index$462;var $length$456;var temp$450;var acc$444;var prep$409;var code$410;var file$411;var ev$412;var the_macros$413;var form$377;var env$378;var body$379;(t0$381=$367$374);(form$377=t0$381);if(___hasprop(t0$381,"env")){(env$378=t0$381.env);}else{___match_error($367$374);}(t0$390=$369$375);if(((t0$390 instanceof Array)&&(((t1$391=t0$390.length)),((t1$391===2)&&(t0$390[0]==="data"))))){(body$379=t0$390[1]);}else{___match_error($369$375);}(t0$415=generate_from_ast$58(body$379));if(((t0$415 instanceof Array)&&(((t1$416=t0$415.length)),(t1$416===2)))){(prep$409=t0$415[0]);(code$410=t0$415[1]);}else{___match_error(generate_from_ast$58(body$379),"/home/olivier/git/eg/src/earl-grey.eg",2686,2709);}(file$411=form$377.location.source.url);(ev$412=evaluator$57(({"filename":file$411,"showname":file$411,"cwd":file$411})));(the_macros$413=ev$412((((prep$409+";(")+code$410)+")")));return ["splice"].concat((((acc$444=[])),(((temp$450=items(the_macros$413))),((($length$456=temp$450.length)),((($index$462=0)),(function(){$439:for(;($index$462<$length$456);($index$462++)){var k$481;var v$482;var t0$476;var t1$477;var m$471;(m$471=temp$450[$index$462]);(t0$476=m$471);if(((t0$476 instanceof Array)&&(((t1$477=t0$476.length)),(t1$477===2)))){(k$481=t0$476[0]);(v$482=t0$476[1]);acc$444.push(["declare_raw",__amp____colon__(["symbol",k$481],({"env":env$378})),["macro",v$482]]);}else{___match_error(m$471,"/home/olivier/git/eg/src/earl-grey.eg",2938,3035);}}})()))),acc$444));})]);(generate$59=(function(source$501){return Generator$60().generate(source$501);}));(Generator$60=(function(){var interactive$528;var t0$524;var $515$519;var it$0$510;(it$0$510=(function(){if((!getChecker(Generator$60)(this))){return Object.create(Generator$60.prototype);}else{return this;}})());($515$519=arguments);(t0$524=$515$519.length);if(((t0$524>=0)&&(t0$524<=1))){(interactive$528=(function(){if((0>=t0$524)){return false;}else{return $515$519[0];}})());(it$0$510["tr"]=Translator$47("require(\"earlgrey-runtime\");"));(it$0$510["env"]=std$48.stdenv.fork());(it$0$510["interactive"]=interactive$528);(it$0$510["_eval"]=null);}else{___match_error($515$519);}return it$0$510;}));(Generator$60.prototype["generate"]=(function(){var t0$618;var t1$619;var t2$620;var args$616;var stmt$611;var t$597;var p$598;var ex$599;var rval$600;var source$583;var dump$584;var t0$579;var $562$574;var it$0$564;var self$565;(it$0$564=this);(self$565=this);($562$574=arguments);(t0$579=$562$574.length);if(((t0$579>=1)&&(t0$579<=2))){(source$583=$562$574[0]);(dump$584=(function(){if((1>=t0$579)){return true;}else{return $562$574[1];}})());(t$597=tokenize$42(source$583));(p$598=parse$44(t$597));(ex$599=(((stmt$611=(function(){if(it$0$564.interactive){(t0$618=getProjector(Body$52)(p$598));if((t0$618[0]&&(((t1$619=t0$618[1])),(((t2$620=t1$619.length)),(t2$620>=0))))){(args$616=Array.prototype.slice.call(t1$619,0));}else{___match_error(p$598,"/home/olivier/git/eg/src/earl-grey.eg",3852,3853);}return ["interactive"].concat(args$616);}else{return ["multi",p$598];}})())),std$48.expand(["top"],std$48.topscope,it$0$564.env.mark(stmt$611))));(ex$599=opt$50.hoist(ex$599));(rval$600=it$0$564.tr.translate(ex$599,"stmt"));if(dump$584){return (it$0$564.tr.dump_store()+rval$600);}else{return rval$600;}}else{___match_error($562$574);}}));(Generator$60.prototype["evaluate"]=(function(source$652){var file$669;var it$0$656;var self$657;(it$0$656=this);(self$657=this);if((!it$0$656._eval)){(file$669=source$652.url);(it$0$656["_eval"]=evaluator$57(({"filename":file$669,"showname":file$669,"cwd":file$669})));}return it$0$656._eval(it$0$656.generate(source$652));}));__amp____colon__(Generator$60,__amp____colon__(((accum$679=({})),((accum$679["::name"]="Generator"),accum$679)),((accum$683=({})),((accum$683["::egclass"]=true),accum$683))));Generator$60;(exports["evaluator"]=evaluator$57);(exports["Source"]=Source$38);(exports["Location"]=Location$39);(exports["highlight_locations"]=highlight_locations$40);(exports["tokenize"]=tokenize$42);(exports["parse"]=parse$44);(exports["Generator"]=Generator$60);(exports["generate"]=generate$59);(exports["version"]=version$56);
