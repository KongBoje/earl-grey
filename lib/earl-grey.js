var $137=function(type$139){var f$142;(f$142=type$139["::check"]);;if((f$142===(void 0))){return function(value$147){return (value$147 instanceof type$139);};}else{return function(value$150){return f$142.call(type$139,value$150);};}};
var $152=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $153=function($154$156){var ph$160;(ph$160=$154$156);;var $158$165;($158$165=ph$160);;var bridge$159$170;var x$174;(bridge$159$170=$158$165);if((((typeof(bridge$159$170)==="string")&&((x$174=bridge$159$170),true))||((typeof(bridge$159$170)==="number")&&((x$174=bridge$159$170),true)))){return ["value",x$174];}else{var other$181;(other$181=$158$165);return other$181["::serialize_ast"]();}};
var send$21;(send$21=function(obj$26,$24$27){var ph$31;var msg$32;var t0$34;(t0$34=$24$27);(msg$32=t0$34);(ph$31=t0$34);;var $29$38;($29$38=ph$31);;var bridge$30$43;(bridge$30$43=$29$38);if(((typeof(bridge$30$43)==="string")||(typeof(bridge$30$43)==="number"))){return obj$26[msg$32];}else{var other$51;(other$51=$29$38);return obj$26["::send"](msg$32);}});;(Array[":::project"]=function($54$56){var ph$59;var value$60;var t0$62;(t0$62=$54$56);(value$60=t0$62);(ph$59=t0$62);;var $58$66;($58$66=ph$59);;if($137(Array)($58$66)){return [true,value$60];}else{$58$66;return [true,[value$60]];}});(Array.prototype["::check"]=function(value$80){if((value$80 instanceof Array)){var i$85;(i$85=0);;$83:for(;(i$85<this.length);(i$85++)){if(($152(this,i$85)!==$152(value$80,i$85))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return this.slice(0);});(Array.prototype[":::project"]=function(value$96){if((value$96 instanceof Array)){var i$101;(i$101=0);;$99:for(;(i$101<this.length);(i$101++)){if(($152(this,i$101)!==$152(value$96,i$101))){return [true,[value$96]];}}return [true,value$96.slice(this.length)];}else{return [true,[value$96]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($153));});(RegExp.prototype["::check"]=function(value$112){return value$112.match(this);});(RegExp.prototype[":::project"]=function(value$115){var $117$119;($117$119=value$115.match(this));;var m$127;if(($117$119===null)){(m$127=$117$119);return [false,null];}else{var m$132;(m$132=$117$119);return [true,m$132];}});(Function.prototype["::send"]=function(args$135){return this.apply(this,args$135);});
var $597=function(dest$599,values$600){var k$605;(k$605=null);$603:for(k$605 in values$600){if(values$600.hasOwnProperty(k$605)){(dest$599[k$605]=values$600[k$605]);}}return dest$599;};
var $490=function(){var $491$493;($491$493=function(tags$497){var it$0$500;(it$0$500=function(){if((!$137($491$493)(this))){return Object.create($491$493.prototype);}else{return this;}}());;(it$0$500["tags"]=tags$497);return it$0$500;});;($491$493.prototype["create"]=function(){var $509$511;($509$511=arguments);;var t0$516;var message$520;var args$521;(t0$516=$509$511.length);if((t0$516>=0)){(message$520=function(){if((0>=t0$516)){return "";}else{return $509$511[0];}}());(args$521=Array.prototype.slice.call($509$511,1));var it$0$525;(it$0$525=this);;var e$530;(e$530=Error(message$520));;(e$530["::tags"]=it$0$525.tags);(e$530["args"]=args$521);(e$530["name"]=["E"].concat(it$0$525.tags).join("."));return e$530;}else{$477($509$511);}});($491$493.prototype["::check"]=function(e$539){var it$0$542;(it$0$542=this);;var tags$547;if(((!e$539)||(!$137(Error)(e$539)))){return false;}(tags$547=(e$539["::tags"]||[]));;var temp$556;(temp$556=it$0$542.tags);;var $length$561;($length$561=temp$556.length);;var $index$566;($index$566=0);;$548:for(;($index$566<$length$561);($index$566++)){var m$574;(m$574=temp$556[$index$566]);;var tag$582;(tag$582=m$574);if((tags$547.indexOf(tag$582)===(-1))){return false;}else{false;;}}return true;});($491$493.prototype["::deconstruct"]=function(e$590){var it$0$593;(it$0$593=this);;return e$590.args;});$597($491$493,({}));return $491$493;}();
var $477=function(value$479,url$480,start$481,end$482){var err$485;(err$485=$490(["match"]).create("Could not find a match for value",({"value":value$479})));;if(url$480){(err$485["location"]=["location",url$480,start$481,end$482]);}throw err$485;};
var $609=function($610$612,key$613){var ph$617;(ph$617=$610$612);;var $615$622;($615$622=ph$617);;var bridge$616$627;(bridge$616$627=$615$622);if(((bridge$616$627===null)||(bridge$616$627===(void 0)))){return false;}else{var x$635;if((typeof($615$622)==="string")){(x$635=$615$622);return (key$613 in String.prototype);}else{var x$640;if((typeof($615$622)==="number")){(x$640=$615$622);return (key$613 in Number.prototype);}else{var x$645;(x$645=$615$622);return (key$613 in x$645);}}}};var $184$192;var items$193;var $185$194;var Source$195;var Location$196;var highlight_locations$197;var $186$198;var tokenize$199;var $187$200;var parse$201;var $188$202;var translate$203;var Translator$204;var std$205;var exp$206;var opt$207;var generate_from_ast$208;var generate$209;var Generator$210;($184$192=require("./util"));;(items$193=$184$192.items);;($185$194=require("./location"));;(Source$195=$185$194.Source);;(Location$196=$185$194.Location);;(highlight_locations$197=$185$194.highlight_locations);;($186$198=require("./lex"));;(tokenize$199=$186$198.tokenize);;($187$200=require("./parse"));;(parse$201=$187$200.parse);;($188$202=require("./translate-js"));;(translate$203=$188$202.translate);;(Translator$204=$188$202.Translator);;(std$205=require("./stdenv"));;(exp$206=require("./expand"));;(opt$207=require("./opt"));;(generate_from_ast$208=function(ast$262){var ex$265;var tr$266;var rval$267;(ex$265=std$205.expand(["top"],std$205.topscope,std$205.stdenv.fork().convert(["multi",ast$262])));;(ex$265=opt$207.hoist(ex$265));(tr$266=Translator$204());;(rval$267=tr$266.translate(ex$265,"expr"));;return [tr$266.dump_store(),rval$267];});;std$205.stdenv.bind(std$205.topscope,"macro",["macro",function(context$280,scope$281,form$282,$278$283){var t0$322;var t1$323;var prep$317;var code$318;var mac$319;var mac2$320;var name$304;var sym$305;var arguments$306;var ast$307;var t0$296;var t1$297;var t2$298;var t3$299;var t4$300;var $285$291;var ph$286;(ph$286=$278$283);;($285$291=ph$286);;if((($285$291 instanceof Array)&&((t0$296=$285$291.length),((t0$296===3)&&(($285$291[0]==="data")&&((t1$297=$285$291[1]),((t1$297 instanceof Array)&&((t2$298=t1$297.length),((t2$298===3)&&((t1$297[0]==="send")&&((t3$299=t1$297[1]),((name$304=t3$299),((t3$299 instanceof Array)&&((t4$300=t3$299.length),((t4$300===2)&&(t3$299[0]==="symbol")))))))))))))))){(sym$305=t3$299[1]);(arguments$306=t1$297[2]);(ast$307=$285$291[2]);(t0$322=generate_from_ast$208(["send",["symbol","->"],["data",arguments$306,ast$307]]));if(((t0$322 instanceof Array)&&((t1$323=t0$322.length),(t1$323===2)))){(prep$317=t0$322[0]);(code$318=t0$322[1]);;}else{$477(generate_from_ast$208(["send",["symbol","->"],["data",arguments$306,ast$307]]),"/home/olivier/git/earl-grey/src/earl-grey.eg",792,832);}(mac$319=eval((prep$317+((";("+code$318)+")"))));;(mac2$320=function(c$334,s$335,f$336,e$337){var env$340;var r$341;(env$340=scope$281.expander.mkenv());;env$340.bind(scope$281,sym$305,["macro",mac2$320]);(r$341=mac$319(c$334,s$335,f$336,e$337));;return env$340.convert(r$341);});;return ["declare_raw",name$304,["macro",mac2$320]];}else{$477($285$291);}}]);std$205.stdenv.bind(std$205.topscope,"macros",["macro",function(context$354,scope$355,$351$356,$352$357){var t0$362;var t0$367;var t1$368;var t0$378;var t1$379;var $index$406;var $length$401;var temp$396;var acc$391;var prep$374;var code$375;var the_macros$376;var env$359;var body$360;(t0$362=$351$356);if($609(t0$362,"env")){(env$359=t0$362.env);;}else{$477($351$356);}(t0$367=$352$357);if(((t0$367 instanceof Array)&&((t1$368=t0$367.length),((t1$368===2)&&(t0$367[0]==="data"))))){(body$360=t0$367[1]);;}else{$477($352$357);}(t0$378=generate_from_ast$208(body$360));if(((t0$378 instanceof Array)&&((t1$379=t0$378.length),(t1$379===2)))){(prep$374=t0$378[0]);(code$375=t0$378[1]);;}else{$477(generate_from_ast$208(body$360),"/home/olivier/git/earl-grey/src/earl-grey.eg",1352,1375);}(the_macros$376=eval((((prep$374+";(")+code$375)+")")));;return ["splice"].concat((((acc$391=[])),(((temp$396=items$193(the_macros$376))),((($length$401=temp$396.length)),((($index$406=0)),function(){$388:for(;($index$406<$length$401);($index$406++)){var k$424;var v$425;var t0$419;var t1$420;var m$414;(m$414=temp$396[$index$406]);;(t0$419=m$414);if(((t0$419 instanceof Array)&&((t1$420=t0$419.length),(t1$420===2)))){(k$424=t0$419[0]);(v$425=t0$419[1]);acc$391.push(["declare_raw",$597(["symbol",k$424],({"env":env$359})),["macro",v$425]]);}else{$477(m$414,"/home/olivier/git/earl-grey/src/earl-grey.eg",1451,1558);;}}}()))),acc$391));}]);(generate$209=function(source$434){return Generator$210().generate(source$434);});;(Generator$210=function(){var it$0$442;(it$0$442=function(){if((!$137(Generator$210)(this))){return Object.create(Generator$210.prototype);}else{return this;}}());;(it$0$442["tr"]=Translator$204(std$205.stdprelude));(it$0$442["env"]=std$205.stdenv.fork());return it$0$442;});;(Generator$210.prototype["generate"]=function(source$452){var t$460;var p$461;var ex$462;var rval$463;var it$0$455;(it$0$455=this);;(t$460=tokenize$199(source$452));;(p$461=parse$201(t$460));;(ex$462=std$205.expand(["top"],std$205.topscope,it$0$455.env.convert(["splice",p$461])));;(ex$462=opt$207.hoist(ex$462));(rval$463=it$0$455.tr.translate(ex$462,"stmt"));;return (it$0$455.tr.dump_store()+rval$463);});$597(Generator$210,({}));Generator$210;(exports["Source"]=Source$195);(exports["Location"]=Location$196);(exports["highlight_locations"]=highlight_locations$197);(exports["tokenize"]=tokenize$199);(exports["parse"]=parse$201);(exports["Generator"]=Generator$210);(exports["generate"]=generate$209);
