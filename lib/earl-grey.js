var $237=function(type$240){var f$244;(f$244=type$240["::check"]);if((f$244===(void 0))){return function(value$250){return (value$250 instanceof type$240);};}else{return function(value$254){return f$244.call(type$240,value$254);};}};
var $256=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $257=function(dest$260,values$261){var k$266;(k$266=null);$264:for(k$266 in values$261){if(values$261.hasOwnProperty(k$266)){(dest$260[k$266]=values$261[k$266]);}}return dest$260;};
var $274=function($276$279){var ph$285;(ph$285=$276$279);var $281$291;($281$291=ph$285);var bridge$283$296;var x$300;(bridge$283$296=$281$291);if((((typeof(bridge$283$296)==="string")&&((x$300=bridge$283$296),true))||((typeof(bridge$283$296)==="number")&&((x$300=bridge$283$296),true)))){return ["value",x$300];}else{var other$311;(other$311=$281$291);return other$311["::serialize_ast"]();}};
var send$11;(send$11=function(obj$18,$15$19){var ph$25;var msg$26;var t0$28;(t0$28=$15$19);(msg$26=t0$28);(ph$25=t0$28);var $21$37;($21$37=ph$25);var bridge$23$42;(bridge$23$42=$21$37);if(((typeof(bridge$23$42)==="string")||(typeof(bridge$23$42)==="number"))){return obj$18[msg$26];}else{var other$54;(other$54=$21$37);return obj$18["::send"](msg$26);}});(Array[":::project"]=function($60$63){var ph$68;var value$69;var t0$71;(t0$71=$60$63);(value$69=t0$71);(ph$68=t0$71);var $65$80;($65$80=ph$68);if($237(Array)($65$80)){return [true,value$69];}else{$65$80;return [true,[value$69]];}});(Array.prototype["::check"]=function(value$98){if((value$98 instanceof Array)){var i$104;(i$104=0);$101:for(;(i$104<this.length);(i$104++)){if(($256(this,i$104)!==$256(value$98,i$104))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $257(this.slice(0),this);});(Array.prototype[":::project"]=function(value$123){if((value$123 instanceof Array)){var i$129;(i$129=0);$126:for(;(i$129<this.length);(i$129++)){if(($256(this,i$129)!==$256(value$123,i$129))){return [true,[value$123]];}}return [true,value$123.slice(this.length)];}else{return [true,[value$123]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($274));});(RegExp.prototype["::check"]=function($147$150){var ph$155;(ph$155=$147$150);var $152$161;($152$161=ph$155);var value$169;if((typeof($152$161)==="string")){(value$169=$152$161);if(value$169.match(this)){return true;}else{return false;}}else{var other$174;(other$174=$152$161);return false;}});(RegExp.prototype[":::project"]=function($180$183){var ph$188;(ph$188=$180$183);var $185$194;($185$194=ph$188);var value$202;if((typeof($185$194)==="string")){(value$202=$185$194);var $205$210;($205$210=value$202.match(this));var m$218;if(($205$210===null)){(m$218=$205$210);return [false,null];}else{var m$223;(m$223=$205$210);return [true,m$223];}}else{var other$227;(other$227=$185$194);return [false,null];}});(Function.prototype["::send"]=function(args$234){return this.apply(this,args$234);});
var $1104=function(arr$1107){var results$1113;var l$1114;(results$1113=[]);(l$1114=arr$1107.length);var i$1123;(i$1123=0);$1112:for(;(i$1123<l$1114);(i$1123++)){results$1113.push([i$1123,$256(arr$1107,i$1123)]);}return results$1113;};
var $871=function(){var $872$878;($872$878=function(tags$883){var it$0$886;(it$0$886=function(){if((!$237($872$878)(this))){return Object.create($872$878.prototype);}else{return this;}}());(it$0$886["tags"]=tags$883);return it$0$886;});($872$878.prototype["create"]=function(){var it$0$906;var self$907;(it$0$906=this);(self$907=this);var $904$916;($904$916=arguments);var t0$921;var message$925;var args$926;(t0$921=$904$916.length);if((t0$921>=0)){(message$925=function(){if((0>=t0$921)){return "";}else{return $904$916[0];}}());(args$926=Array.prototype.slice.call($904$916,1));var e$939;(e$939=Error(message$925));(e$939["::tags"]=it$0$906.tags);(e$939["args"]=args$926);var temp$955;(temp$955=$1104(args$926));var $length$961;($length$961=temp$955.length);var $index$967;($index$967=0);$940:for(;($index$967<$length$961);($index$967++)){var m$976;(m$976=temp$955[$index$967]);var t0$981;var t1$982;var i$986;var arg$987;(t0$981=m$976);if(((t0$981 instanceof Array)&&(((t1$982=t0$981.length)),(t1$982===2)))){(i$986=t0$981[0]);(arg$987=t0$981[1]);(e$939[i$986]=arg$987);}else{$852(m$976);}}(e$939["length"]=args$926.length);(e$939["name"]=["E"].concat(it$0$906.tags).join("."));return e$939;}else{$852($904$916);}});($872$878.prototype["::check"]=function(e$1017){var it$0$1021;var self$1022;(it$0$1021=this);(self$1022=this);var tags$1032;if(((!e$1017)||(!$237(Error)(e$1017)))){return false;}(tags$1032=(e$1017["::tags"]||[]));var temp$1043;(temp$1043=it$0$1021.tags);var $length$1049;($length$1049=temp$1043.length);var $index$1055;($index$1055=0);$1033:for(;($index$1055<$length$1049);($index$1055++)){var m$1064;(m$1064=temp$1043[$index$1055]);var tag$1072;(tag$1072=m$1064);if((tags$1032.indexOf(tag$1072)===-1)){return false;}else{false;}}return true;});($872$878.prototype["::deconstruct"]=function(e$1081){var it$0$1085;var self$1086;(it$0$1085=this);(self$1086=this);return e$1081.args;});$257($872$878,$257(function(){var accum$1097;(accum$1097=({}));(accum$1097["::name"]="$872");return accum$1097;}(),function(){var accum$1101;(accum$1101=({}));(accum$1101["::egclass"]=true);return accum$1101;}()));return $872$878;}();
var $852=function(value$855,url$856,start$857,end$858){var err$862;(err$862=$871(["match"]).create("Could not find a match for value",({"value":value$855})));if(url$856){(err$862["location"]=["location",url$856,start$857,end$858]);}throw err$862;};
var $1130=function($1132$1135,key$1136){var ph$1144;(ph$1144=$1132$1135);var $1138$1150;($1138$1150=ph$1144);var bridge$1140$1155;(bridge$1140$1155=$1138$1150);if(((bridge$1140$1155===null)||(bridge$1140$1155===(void 0)))){return false;}else{var x$1167;if((typeof($1138$1150)==="string")){(x$1167=$1138$1150);return (key$1136 in String.prototype);}else{var x$1172;if((typeof($1138$1150)==="number")){(x$1172=$1138$1150);return (key$1136 in Number.prototype);}else{var x$1177;(x$1177=$1138$1150);return (key$1136 in x$1177);}}}};
var $1179=function(obj$1182){var results$1187;(results$1187=[]);var k$1192;(k$1192=null);$1186:for(k$1192 in obj$1182){if(Object.prototype.hasOwnProperty.call(obj$1182,k$1192)){results$1187.push([k$1192,$256(obj$1182,k$1192)]);}}return results$1187;};
var $1196=function(type$1199){return function(value$1203){var f$1207;(f$1207=type$1199[":::project"]);if((f$1207===(void 0))){(f$1207=type$1199["::project"]);if((f$1207===(void 0))){return [true,type$1199(value$1203)];}else{var rval$1220;(rval$1220=false);try{(rval$1220=[true,f$1207(value$1203)]);}catch(excv$1231){var e$1237;(e$1237=excv$1231);(rval$1220=[false,null]);}return rval$1220;}}else{return f$1207.call(type$1199,value$1203);}};};var accum$812;var accum$816;var $315$341;var Source$342;var Location$343;var highlight_locations$344;var $316$345;var tokenize$346;var $317$347;var parse$348;var $318$349;var translate$350;var Translator$351;var std$352;var exp$353;var opt$354;var version$355;var generate_from_ast$356;var generate$357;var Generator$358;($315$341=require("./location"));(Source$342=$315$341.Source);(Location$343=$315$341.Location);(highlight_locations$344=$315$341.highlight_locations);($316$345=require("./lex"));(tokenize$346=$316$345.tokenize);($317$347=require("./parse"));(parse$348=$317$347.parse);($318$349=require("./translate-js"));(translate$350=$318$349.translate);(Translator$351=$318$349.Translator);(std$352=require("./stdenv"));(exp$353=require("./expand"));(opt$354=require("./opt"));(version$355="zero");(generate_from_ast$356=function(ast$408){var ex$415;var tr$416;var rval$417;(ex$415=std$352.expand(["top"],std$352.topscope,std$352.stdenv.fork().convert(["multi",ast$408])));(ex$415=opt$354.hoist(ex$415));(tr$416=Translator$351());(rval$417=tr$416.translate(ex$415,"expr"));return [tr$416.dump_store(),rval$417];});std$352.stdenv.bind(std$352.topscope,"macro",["macro",function(context$435,scope$436,form$437,$432$438){var t0$502;var t1$503;var prep$497;var code$498;var mac$499;var mac2$500;var name$461;var sym$462;var arguments$463;var ast$464;var t0$453;var t1$454;var t2$455;var t3$456;var t4$457;var $440$448;var ph$442;(ph$442=$432$438);($440$448=ph$442);if((($440$448 instanceof Array)&&(((t0$453=$440$448.length)),((t0$453===3)&&(($440$448[0]==="data")&&(((t1$454=$440$448[1])),((t1$454 instanceof Array)&&(((t2$455=t1$454.length)),((t2$455===3)&&((t1$454[0]==="send")&&(((t3$456=t1$454[1])),((name$461=t3$456),((t3$456 instanceof Array)&&(((t4$457=t3$456.length)),((t4$457===2)&&(t3$456[0]==="symbol")))))))))))))))){(sym$462=t3$456[1]);(arguments$463=t1$454[2]);(ast$464=$440$448[2]);(t0$502=generate_from_ast$356(["send",["symbol","->"],["data",arguments$463,ast$464]]));if(((t0$502 instanceof Array)&&(((t1$503=t0$502.length)),(t1$503===2)))){(prep$497=t0$502[0]);(code$498=t0$502[1]);}else{$852(generate_from_ast$356(["send",["symbol","->"],["data",arguments$463,ast$464]]),"/home/olivier/git/earl-grey/src/earl-grey.eg",808,858);}(mac$499=eval((prep$497+((";("+code$498)+")"))));(mac2$500=function(c$523,s$524,f$525,e$526){var env$531;var r$532;(env$531=scope$436.expander.mkenv());env$531.bind(scope$436,sym$462,["macro",mac2$500]);(r$532=mac$499(c$523,s$524,f$525,e$526));return env$531.convert(r$532);});return ["declare_raw",name$461,["macro",mac2$500]];}else{$852($440$448);}}]);std$352.stdenv.bind(std$352.topscope,"macros",["macro",function(context$548,scope$549,$543$550,$545$551){var t0$556;var t0$565;var t1$566;var t0$586;var t1$587;var $index$627;var $length$621;var temp$615;var acc$609;var prep$582;var code$583;var the_macros$584;var env$553;var body$554;(t0$556=$543$550);if($1130(t0$556,"env")){(env$553=t0$556.env);}else{$852($543$550);}(t0$565=$545$551);if(((t0$565 instanceof Array)&&(((t1$566=t0$565.length)),((t1$566===2)&&(t0$565[0]==="data"))))){(body$554=t0$565[1]);}else{$852($545$551);}(t0$586=generate_from_ast$356(body$554));if(((t0$586 instanceof Array)&&(((t1$587=t0$586.length)),(t1$587===2)))){(prep$582=t0$586[0]);(code$583=t0$586[1]);}else{$852(generate_from_ast$356(body$554),"/home/olivier/git/earl-grey/src/earl-grey.eg",1368,1398);}(the_macros$584=eval((((prep$582+";(")+code$583)+")")));return ["splice"].concat((((acc$609=[])),(((temp$615=$1179(the_macros$584))),((($length$621=temp$615.length)),((($index$627=0)),function(){$604:for(;($index$627<$length$621);($index$627++)){var k$646;var v$647;var t0$641;var t1$642;var m$636;(m$636=temp$615[$index$627]);(t0$641=m$636);if(((t0$641 instanceof Array)&&(((t1$642=t0$641.length)),(t1$642===2)))){(k$646=t0$641[0]);(v$647=t0$641[1]);acc$609.push(["declare_raw",$257(["symbol",k$646],({"env":env$553})),["macro",v$647]]);}else{$852(m$636,"/home/olivier/git/earl-grey/src/earl-grey.eg",1468,1575);}}}()))),acc$609));}]);(generate$357=function(source$666){return Generator$358().generate(source$666);});(Generator$358=function(){var interactive$693;var t0$689;var $680$684;var it$0$675;(it$0$675=function(){if((!$237(Generator$358)(this))){return Object.create(Generator$358.prototype);}else{return this;}}());($680$684=arguments);(t0$689=$680$684.length);if(((t0$689>=0)&&(t0$689<=1))){(interactive$693=function(){if((0>=t0$689)){return false;}else{return $680$684[0];}}());(it$0$675["tr"]=Translator$351(std$352.stdprelude));(it$0$675["env"]=std$352.stdenv.fork());(it$0$675["interactive"]=interactive$693);}else{$852($680$684);}return it$0$675;});(Generator$358.prototype["generate"]=function(){var t0$779;var t1$780;var t2$781;var args$777;var stmt$772;var t$758;var p$759;var ex$760;var rval$761;var source$744;var dump$745;var t0$740;var $723$735;var it$0$725;var self$726;(it$0$725=this);(self$726=this);($723$735=arguments);(t0$740=$723$735.length);if(((t0$740>=1)&&(t0$740<=2))){(source$744=$723$735[0]);(dump$745=function(){if((1>=t0$740)){return true;}else{return $723$735[1];}}());(t$758=tokenize$346(source$744));(p$759=parse$348(t$758));(ex$760=(((stmt$772=function(){if(it$0$725.interactive){(t0$779=$1196(["multi"])(p$759));if((t0$779[0]&&(((t1$780=t0$779[1])),(((t2$781=t1$780.length)),(t2$781>=0))))){(args$777=Array.prototype.slice.call(t1$780,0));}else{$852(p$759,"/home/olivier/git/earl-grey/src/earl-grey.eg",2357,2358);}return ["interactive"].concat(args$777);}else{return ["multi",p$759];}}())),std$352.expand(["top"],std$352.topscope,it$0$725.env.convert(stmt$772))));(ex$760=opt$354.hoist(ex$760));(rval$761=it$0$725.tr.translate(ex$760,"stmt"));if(dump$745){return (it$0$725.tr.dump_store()+rval$761);}else{return rval$761;}}else{$852($723$735);}});$257(Generator$358,$257(((accum$812=({})),((accum$812["::name"]="Generator"),accum$812)),((accum$816=({})),((accum$816["::egclass"]=true),accum$816))));Generator$358;(exports["Source"]=Source$342);(exports["Location"]=Location$343);(exports["highlight_locations"]=highlight_locations$344);(exports["tokenize"]=tokenize$346);(exports["parse"]=parse$348);(exports["Generator"]=Generator$358);(exports["generate"]=generate$357);(exports["version"]=version$355);
