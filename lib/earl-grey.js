var $185=function(type$187){var f$190;(f$190=type$187["::check"]);;if((f$190===(void 0))){return function(value$195){return (value$195 instanceof type$187);};}else{return function(value$198){return f$190.call(type$187,value$198);};}};
var $200=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $201=function($202$204){var ph$208;(ph$208=$202$204);;var $206$213;($206$213=ph$208);;var bridge$207$218;var x$222;(bridge$207$218=$206$213);if((((typeof(bridge$207$218)==="string")&&((x$222=bridge$207$218),true))||((typeof(bridge$207$218)==="number")&&((x$222=bridge$207$218),true)))){return ["value",x$222];}else{var other$229;(other$229=$206$213);return other$229["::serialize_ast"]();}};
var send$25;(send$25=function(obj$30,$28$31){var ph$35;var msg$36;var t0$38;(t0$38=$28$31);(msg$36=t0$38);(ph$35=t0$38);;var $33$42;($33$42=ph$35);;var bridge$34$47;(bridge$34$47=$33$42);if(((typeof(bridge$34$47)==="string")||(typeof(bridge$34$47)==="number"))){return obj$30[msg$36];}else{var other$55;(other$55=$33$42);return obj$30["::send"](msg$36);}});;(Array[":::project"]=function($58$60){var ph$63;var value$64;var t0$66;(t0$66=$58$60);(value$64=t0$66);(ph$63=t0$66);;var $62$70;($62$70=ph$63);;if($185(Array)($62$70)){return [true,value$64];}else{$62$70;return [true,[value$64]];}});(Array.prototype["::check"]=function(value$84){if((value$84 instanceof Array)){var i$89;(i$89=0);;$87:for(;(i$89<this.length);(i$89++)){if(($200(this,i$89)!==$200(value$84,i$89))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return this.slice(0);});(Array.prototype[":::project"]=function(value$100){if((value$100 instanceof Array)){var i$105;(i$105=0);;$103:for(;(i$105<this.length);(i$105++)){if(($200(this,i$105)!==$200(value$100,i$105))){return [true,[value$100]];}}return [true,value$100.slice(this.length)];}else{return [true,[value$100]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($201));});(RegExp.prototype["::check"]=function($115$117){var ph$120;(ph$120=$115$117);;var $119$125;($119$125=ph$120);;var value$133;if((typeof($119$125)==="string")){(value$133=$119$125);if(value$133.match(this)){return true;}else{return false;}}else{var other$138;(other$138=$119$125);return false;}});(RegExp.prototype[":::project"]=function($140$142){var ph$145;(ph$145=$140$142);;var $144$150;($144$150=ph$145);;var value$158;if((typeof($144$150)==="string")){(value$158=$144$150);var $161$163;($161$163=value$158.match(this));;var m$171;if(($161$163===null)){(m$171=$161$163);return [false,null];}else{var m$176;(m$176=$161$163);return [true,m$176];}}else{var other$180;(other$180=$144$150);return [false,null];}});(Function.prototype["::send"]=function(args$183){return this.apply(this,args$183);});
var $720=function(arr$722){var results$726;var l$727;(results$726=[]);;(l$727=arr$722.length);;var i$735;(i$735=0);;$725:for(;(i$735<l$727);(i$735++)){results$726.push([i$735,$200(arr$722,i$735)]);}return results$726;};
var $742=function(dest$744,values$745){var k$750;(k$750=null);$748:for(k$750 in values$745){if(values$745.hasOwnProperty(k$750)){(dest$744[k$750]=values$745[k$750]);}}return dest$744;};
var $551=function(){var $552$554;($552$554=function(tags$558){var it$0$561;(it$0$561=function(){if((!$185($552$554)(this))){return Object.create($552$554.prototype);}else{return this;}}());;(it$0$561["tags"]=tags$558);return it$0$561;});;($552$554.prototype["create"]=function(){var $570$572;($570$572=arguments);;var t0$577;var message$581;var args$582;(t0$577=$570$572.length);if((t0$577>=0)){(message$581=function(){if((0>=t0$577)){return "";}else{return $570$572[0];}}());(args$582=Array.prototype.slice.call($570$572,1));var it$0$586;(it$0$586=this);;var self$591;(self$591=this);;var e$596;(e$596=Error(message$581));;(e$596["::tags"]=it$0$586.tags);(e$596["args"]=args$582);var temp$604;(temp$604=$720(args$582));;var $length$609;($length$609=temp$604.length);;var $index$614;($index$614=0);;$597:for(;($index$614<$length$609);($index$614++)){var m$622;(m$622=temp$604[$index$614]);;var t0$627;var t1$628;var i$632;var arg$633;(t0$627=m$622);if(((t0$627 instanceof Array)&&((t1$628=t0$627.length),(t1$628===2)))){(i$632=t0$627[0]);(arg$633=t0$627[1]);(e$596[i$632]=arg$633);}else{$538(m$622);;}}(e$596["length"]=args$582.length);(e$596["name"]=["E"].concat(it$0$586.tags).join("."));return e$596;}else{$538($570$572);}});($552$554.prototype["::check"]=function(e$644){var it$0$647;(it$0$647=this);;var self$652;(self$652=this);;var tags$657;if(((!e$644)||(!$185(Error)(e$644)))){return false;}(tags$657=(e$644["::tags"]||[]));;var temp$666;(temp$666=it$0$647.tags);;var $length$671;($length$671=temp$666.length);;var $index$676;($index$676=0);;$658:for(;($index$676<$length$671);($index$676++)){var m$684;(m$684=temp$666[$index$676]);;var tag$692;(tag$692=m$684);if((tags$657.indexOf(tag$692)===-1)){return false;}else{false;;}}return true;});($552$554.prototype["::deconstruct"]=function(e$700){var it$0$703;(it$0$703=this);;var self$708;(self$708=this);;return e$700.args;});$742($552$554,$742(function(){var accum$713;(accum$713=({}));(accum$713["::name"]="$552");return accum$713;}(),function(){var accum$717;(accum$717=({}));(accum$717["::egclass"]=true);return accum$717;}()));return $552$554;}();
var $538=function(value$540,url$541,start$542,end$543){var err$546;(err$546=$551(["match"]).create("Could not find a match for value",({"value":value$540})));;if(url$541){(err$546["location"]=["location",url$541,start$542,end$543]);}throw err$546;};
var $754=function($755$757,key$758){var ph$762;(ph$762=$755$757);;var $760$767;($760$767=ph$762);;var bridge$761$772;(bridge$761$772=$760$767);if(((bridge$761$772===null)||(bridge$761$772===(void 0)))){return false;}else{var x$780;if((typeof($760$767)==="string")){(x$780=$760$767);return (key$758 in String.prototype);}else{var x$785;if((typeof($760$767)==="number")){(x$785=$760$767);return (key$758 in Number.prototype);}else{var x$790;(x$790=$760$767);return (key$758 in x$790);}}}};var accum$530;var accum$534;var $232$240;var items$241;var $233$242;var Source$243;var Location$244;var highlight_locations$245;var $234$246;var tokenize$247;var $235$248;var parse$249;var $236$250;var translate$251;var Translator$252;var std$253;var exp$254;var opt$255;var generate_from_ast$256;var generate$257;var Generator$258;($232$240=require("./util"));;(items$241=$232$240.items);;($233$242=require("./location"));;(Source$243=$233$242.Source);;(Location$244=$233$242.Location);;(highlight_locations$245=$233$242.highlight_locations);;($234$246=require("./lex"));;(tokenize$247=$234$246.tokenize);;($235$248=require("./parse"));;(parse$249=$235$248.parse);;($236$250=require("./translate-js"));;(translate$251=$236$250.translate);;(Translator$252=$236$250.Translator);;(std$253=require("./stdenv"));;(exp$254=require("./expand"));;(opt$255=require("./opt"));;(generate_from_ast$256=function(ast$310){var ex$313;var tr$314;var rval$315;(ex$313=std$253.expand(["top"],std$253.topscope,std$253.stdenv.fork().convert(["multi",ast$310])));;(ex$313=opt$255.hoist(ex$313));(tr$314=Translator$252());;(rval$315=tr$314.translate(ex$313,"expr"));;return [tr$314.dump_store(),rval$315];});;std$253.stdenv.bind(std$253.topscope,"macro",["macro",function(context$328,scope$329,form$330,$326$331){var t0$370;var t1$371;var prep$365;var code$366;var mac$367;var mac2$368;var name$352;var sym$353;var arguments$354;var ast$355;var t0$344;var t1$345;var t2$346;var t3$347;var t4$348;var $333$339;var ph$334;(ph$334=$326$331);;($333$339=ph$334);;if((($333$339 instanceof Array)&&((t0$344=$333$339.length),((t0$344===3)&&(($333$339[0]==="data")&&((t1$345=$333$339[1]),((t1$345 instanceof Array)&&((t2$346=t1$345.length),((t2$346===3)&&((t1$345[0]==="send")&&((t3$347=t1$345[1]),((name$352=t3$347),((t3$347 instanceof Array)&&((t4$348=t3$347.length),((t4$348===2)&&(t3$347[0]==="symbol")))))))))))))))){(sym$353=t3$347[1]);(arguments$354=t1$345[2]);(ast$355=$333$339[2]);(t0$370=generate_from_ast$256(["send",["symbol","->"],["data",arguments$354,ast$355]]));if(((t0$370 instanceof Array)&&((t1$371=t0$370.length),(t1$371===2)))){(prep$365=t0$370[0]);(code$366=t0$370[1]);;}else{$538(generate_from_ast$256(["send",["symbol","->"],["data",arguments$354,ast$355]]),"/home/olivier/git/earl-grey/src/earl-grey.eg",792,842);}(mac$367=eval((prep$365+((";("+code$366)+")"))));;(mac2$368=function(c$382,s$383,f$384,e$385){var env$388;var r$389;(env$388=scope$329.expander.mkenv());;env$388.bind(scope$329,sym$353,["macro",mac2$368]);(r$389=mac$367(c$382,s$383,f$384,e$385));;return env$388.convert(r$389);});;return ["declare_raw",name$352,["macro",mac2$368]];}else{$538($333$339);}}]);std$253.stdenv.bind(std$253.topscope,"macros",["macro",function(context$402,scope$403,$399$404,$400$405){var t0$410;var t0$415;var t1$416;var t0$426;var t1$427;var $index$454;var $length$449;var temp$444;var acc$439;var prep$422;var code$423;var the_macros$424;var env$407;var body$408;(t0$410=$399$404);if($754(t0$410,"env")){(env$407=t0$410.env);;}else{$538($399$404);}(t0$415=$400$405);if(((t0$415 instanceof Array)&&((t1$416=t0$415.length),((t1$416===2)&&(t0$415[0]==="data"))))){(body$408=t0$415[1]);;}else{$538($400$405);}(t0$426=generate_from_ast$256(body$408));if(((t0$426 instanceof Array)&&((t1$427=t0$426.length),(t1$427===2)))){(prep$422=t0$426[0]);(code$423=t0$426[1]);;}else{$538(generate_from_ast$256(body$408),"/home/olivier/git/earl-grey/src/earl-grey.eg",1352,1382);}(the_macros$424=eval((((prep$422+";(")+code$423)+")")));;return ["splice"].concat((((acc$439=[])),(((temp$444=items$241(the_macros$424))),((($length$449=temp$444.length)),((($index$454=0)),function(){$436:for(;($index$454<$length$449);($index$454++)){var k$472;var v$473;var t0$467;var t1$468;var m$462;(m$462=temp$444[$index$454]);;(t0$467=m$462);if(((t0$467 instanceof Array)&&((t1$468=t0$467.length),(t1$468===2)))){(k$472=t0$467[0]);(v$473=t0$467[1]);acc$439.push(["declare_raw",$742(["symbol",k$472],({"env":env$407})),["macro",v$473]]);}else{$538(m$462,"/home/olivier/git/earl-grey/src/earl-grey.eg",1452,1559);;}}}()))),acc$439));}]);(generate$257=function(source$482){return Generator$258().generate(source$482);});;(Generator$258=function(){var it$0$490;(it$0$490=function(){if((!$185(Generator$258)(this))){return Object.create(Generator$258.prototype);}else{return this;}}());;(it$0$490["tr"]=Translator$252(std$253.stdprelude));(it$0$490["env"]=std$253.stdenv.fork());return it$0$490;});;(Generator$258.prototype["generate"]=function(source$500){var t$513;var p$514;var ex$515;var rval$516;var self$508;var it$0$503;(it$0$503=this);;(self$508=this);;(t$513=tokenize$247(source$500));;(p$514=parse$249(t$513));;(ex$515=std$253.expand(["top"],std$253.topscope,it$0$503.env.convert(["splice",p$514])));;(ex$515=opt$255.hoist(ex$515));(rval$516=it$0$503.tr.translate(ex$515,"stmt"));;return (it$0$503.tr.dump_store()+rval$516);});$742(Generator$258,$742(((accum$530=({})),((accum$530["::name"]="Generator"),accum$530)),((accum$534=({})),((accum$534["::egclass"]=true),accum$534))));Generator$258;(exports["Source"]=Source$243);(exports["Location"]=Location$244);(exports["highlight_locations"]=highlight_locations$245);(exports["tokenize"]=tokenize$247);(exports["parse"]=parse$249);(exports["Generator"]=Generator$258);(exports["generate"]=generate$257);
