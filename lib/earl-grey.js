var $218=function(type$220){var f$223;(f$223=type$220["::check"]);if((f$223===(void 0))){return function(value$228){return (value$228 instanceof type$220);};}else{return function(value$231){return f$223.call(type$220,value$231);};}};
var $233=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $234=function(dest$236,values$237){var k$242;(k$242=null);$240:for(k$242 in values$237){if(values$237.hasOwnProperty(k$242)){(dest$236[k$242]=values$237[k$242]);}}return dest$236;};
var $249=function($250$252){var ph$256;(ph$256=$250$252);var $254$261;($254$261=ph$256);var bridge$255$266;var x$270;(bridge$255$266=$254$261);if((((typeof(bridge$255$266)==="string")&&((x$270=bridge$255$266),true))||((typeof(bridge$255$266)==="number")&&((x$270=bridge$255$266),true)))){return ["value",x$270];}else{var other$280;(other$280=$254$261);return other$280["::serialize_ast"]();}};
var send$25;(send$25=function(obj$30,$28$31){var ph$35;var msg$36;var t0$38;(t0$38=$28$31);(msg$36=t0$38);(ph$35=t0$38);var $33$45;($33$45=ph$35);var bridge$34$50;(bridge$34$50=$33$45);if(((typeof(bridge$34$50)==="string")||(typeof(bridge$34$50)==="number"))){return obj$30[msg$36];}else{var other$61;(other$61=$33$45);return obj$30["::send"](msg$36);}});(Array[":::project"]=function($66$68){var ph$71;var value$72;var t0$74;(t0$74=$66$68);(value$72=t0$74);(ph$71=t0$74);var $70$81;($70$81=ph$71);if($218(Array)($70$81)){return [true,value$72];}else{$70$81;return [true,[value$72]];}});(Array.prototype["::check"]=function(value$98){if((value$98 instanceof Array)){var i$103;(i$103=0);$101:for(;(i$103<this.length);(i$103++)){if(($233(this,i$103)!==$233(value$98,i$103))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $234(this.slice(0),this);});(Array.prototype[":::project"]=function(value$120){if((value$120 instanceof Array)){var i$125;(i$125=0);$123:for(;(i$125<this.length);(i$125++)){if(($233(this,i$125)!==$233(value$120,i$125))){return [true,[value$120]];}}return [true,value$120.slice(this.length)];}else{return [true,[value$120]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($249));});(RegExp.prototype["::check"]=function($141$143){var ph$146;(ph$146=$141$143);var $145$151;($145$151=ph$146);var value$159;if((typeof($145$151)==="string")){(value$159=$145$151);if(value$159.match(this)){return true;}else{return false;}}else{var other$164;(other$164=$145$151);return false;}});(RegExp.prototype[":::project"]=function($169$171){var ph$174;(ph$174=$169$171);var $173$179;($173$179=ph$174);var value$187;if((typeof($173$179)==="string")){(value$187=$173$179);var $190$192;($190$192=value$187.match(this));var m$200;if(($190$192===null)){(m$200=$190$192);return [false,null];}else{var m$205;(m$205=$190$192);return [true,m$205];}}else{var other$209;(other$209=$173$179);return [false,null];}});(Function.prototype["::send"]=function(args$215){return this.apply(this,args$215);});
var $895=function(arr$897){var results$901;var l$902;(results$901=[]);(l$902=arr$897.length);var i$910;(i$910=0);$900:for(;(i$910<l$902);(i$910++)){results$901.push([i$910,$233(arr$897,i$910)]);}return results$901;};
var $699=function(){var $700$702;($700$702=function(tags$706){var it$0$709;(it$0$709=function(){if((!$218($700$702)(this))){return Object.create($700$702.prototype);}else{return this;}}());(it$0$709["tags"]=tags$706);return it$0$709;});($700$702.prototype["create"]=function(){var $721$723;($721$723=arguments);var t0$728;var message$732;var args$733;(t0$728=$721$723.length);if((t0$728>=0)){(message$732=function(){if((0>=t0$728)){return "";}else{return $721$723[0];}}());(args$733=Array.prototype.slice.call($721$723,1));var it$0$740;(it$0$740=this);var self$745;(self$745=this);var e$750;(e$750=Error(message$732));(e$750["::tags"]=it$0$740.tags);(e$750["args"]=args$733);var temp$764;(temp$764=$895(args$733));var $length$769;($length$769=temp$764.length);var $index$774;($index$774=0);$751:for(;($index$774<$length$769);($index$774++)){var m$782;(m$782=temp$764[$index$774]);var t0$787;var t1$788;var i$792;var arg$793;(t0$787=m$782);if(((t0$787 instanceof Array)&&(((t1$788=t0$787.length)),(t1$788===2)))){(i$792=t0$787[0]);(arg$793=t0$787[1]);(e$750[i$792]=arg$793);}else{$683(m$782);}}(e$750["length"]=args$733.length);(e$750["name"]=["E"].concat(it$0$740.tags).join("."));return e$750;}else{$683($721$723);}});($700$702.prototype["::check"]=function(e$819){var it$0$822;(it$0$822=this);var self$827;(self$827=this);var tags$832;if(((!e$819)||(!$218(Error)(e$819)))){return false;}(tags$832=(e$819["::tags"]||[]));var temp$841;(temp$841=it$0$822.tags);var $length$846;($length$846=temp$841.length);var $index$851;($index$851=0);$833:for(;($index$851<$length$846);($index$851++)){var m$859;(m$859=temp$841[$index$851]);var tag$867;(tag$867=m$859);if((tags$832.indexOf(tag$867)===-1)){return false;}else{false;}}return true;});($700$702.prototype["::deconstruct"]=function(e$875){var it$0$878;(it$0$878=this);var self$883;(self$883=this);return e$875.args;});$234($700$702,$234(function(){var accum$888;(accum$888=({}));(accum$888["::name"]="$700");return accum$888;}(),function(){var accum$892;(accum$892=({}));(accum$892["::egclass"]=true);return accum$892;}()));return $700$702;}();
var $683=function(value$685,url$686,start$687,end$688){var err$691;(err$691=$699(["match"]).create("Could not find a match for value",({"value":value$685})));if(url$686){(err$691["location"]=["location",url$686,start$687,end$688]);}throw err$691;};
var $917=function($918$920,key$921){var ph$925;(ph$925=$918$920);var $923$930;($923$930=ph$925);var bridge$924$935;(bridge$924$935=$923$930);if(((bridge$924$935===null)||(bridge$924$935===(void 0)))){return false;}else{var x$946;if((typeof($923$930)==="string")){(x$946=$923$930);return (key$921 in String.prototype);}else{var x$951;if((typeof($923$930)==="number")){(x$951=$923$930);return (key$921 in Number.prototype);}else{var x$956;(x$956=$923$930);return (key$921 in x$956);}}}};
var $958=function(obj$960){var results$964;(results$964=[]);var k$969;(k$969=null);$963:for(k$969 in obj$960){if(Object.prototype.hasOwnProperty.call(obj$960,k$969)){results$964.push([k$969,$233(obj$960,k$969)]);}}return results$964;};var accum$654;var accum$658;var $284$291;var Source$292;var Location$293;var highlight_locations$294;var $285$295;var tokenize$296;var $286$297;var parse$298;var $287$299;var translate$300;var Translator$301;var std$302;var exp$303;var opt$304;var generate_from_ast$305;var generate$306;var Generator$307;($284$291=require("./location"));(Source$292=$284$291.Source);(Location$293=$284$291.Location);(highlight_locations$294=$284$291.highlight_locations);($285$295=require("./lex"));(tokenize$296=$285$295.tokenize);($286$297=require("./parse"));(parse$298=$286$297.parse);($287$299=require("./translate-js"));(translate$300=$287$299.translate);(Translator$301=$287$299.Translator);(std$302=require("./stdenv"));(exp$303=require("./expand"));(opt$304=require("./opt"));(generate_from_ast$305=function(ast$353){var ex$356;var tr$357;var rval$358;(ex$356=std$302.expand(["top"],std$302.topscope,std$302.stdenv.fork().convert(["multi",ast$353])));(ex$356=opt$304.hoist(ex$356));(tr$357=Translator$301());(rval$358=tr$357.translate(ex$356,"expr"));return [tr$357.dump_store(),rval$358];});std$302.stdenv.bind(std$302.topscope,"macro",["macro",function(context$374,scope$375,form$376,$372$377){var t0$431;var t1$432;var prep$426;var code$427;var mac$428;var mac2$429;var name$398;var sym$399;var arguments$400;var ast$401;var t0$390;var t1$391;var t2$392;var t3$393;var t4$394;var $379$385;var ph$380;(ph$380=$372$377);($379$385=ph$380);if((($379$385 instanceof Array)&&(((t0$390=$379$385.length)),((t0$390===3)&&(($379$385[0]==="data")&&(((t1$391=$379$385[1])),((t1$391 instanceof Array)&&(((t2$392=t1$391.length)),((t2$392===3)&&((t1$391[0]==="send")&&(((t3$393=t1$391[1])),((name$398=t3$393),((t3$393 instanceof Array)&&(((t4$394=t3$393.length)),((t4$394===2)&&(t3$393[0]==="symbol")))))))))))))))){(sym$399=t3$393[1]);(arguments$400=t1$391[2]);(ast$401=$379$385[2]);(t0$431=generate_from_ast$305(["send",["symbol","->"],["data",arguments$400,ast$401]]));if(((t0$431 instanceof Array)&&(((t1$432=t0$431.length)),(t1$432===2)))){(prep$426=t0$431[0]);(code$427=t0$431[1]);}else{$683(generate_from_ast$305(["send",["symbol","->"],["data",arguments$400,ast$401]]),"/home/olivier/git/earl-grey/src/earl-grey.eg",780,830);}(mac$428=eval((prep$426+((";("+code$427)+")"))));(mac2$429=function(c$449,s$450,f$451,e$452){var env$455;var r$456;(env$455=scope$375.expander.mkenv());env$455.bind(scope$375,sym$399,["macro",mac2$429]);(r$456=mac$428(c$449,s$450,f$451,e$452));return env$455.convert(r$456);});return ["declare_raw",name$398,["macro",mac2$429]];}else{$683($379$385);}}]);std$302.stdenv.bind(std$302.topscope,"macros",["macro",function(context$469,scope$470,$466$471,$467$472){var t0$477;var t0$485;var t1$486;var t0$502;var t1$503;var $index$536;var $length$531;var temp$526;var acc$521;var prep$498;var code$499;var the_macros$500;var env$474;var body$475;(t0$477=$466$471);if($917(t0$477,"env")){(env$474=t0$477.env);}else{$683($466$471);}(t0$485=$467$472);if(((t0$485 instanceof Array)&&(((t1$486=t0$485.length)),((t1$486===2)&&(t0$485[0]==="data"))))){(body$475=t0$485[1]);}else{$683($467$472);}(t0$502=generate_from_ast$305(body$475));if(((t0$502 instanceof Array)&&(((t1$503=t0$502.length)),(t1$503===2)))){(prep$498=t0$502[0]);(code$499=t0$502[1]);}else{$683(generate_from_ast$305(body$475),"/home/olivier/git/earl-grey/src/earl-grey.eg",1340,1370);}(the_macros$500=eval((((prep$498+";(")+code$499)+")")));return ["splice"].concat((((acc$521=[])),(((temp$526=$958(the_macros$500))),((($length$531=temp$526.length)),((($index$536=0)),function(){$518:for(;($index$536<$length$531);($index$536++)){var k$554;var v$555;var t0$549;var t1$550;var m$544;(m$544=temp$526[$index$536]);(t0$549=m$544);if(((t0$549 instanceof Array)&&(((t1$550=t0$549.length)),(t1$550===2)))){(k$554=t0$549[0]);(v$555=t0$549[1]);acc$521.push(["declare_raw",$234(["symbol",k$554],({"env":env$474})),["macro",v$555]]);}else{$683(m$544,"/home/olivier/git/earl-grey/src/earl-grey.eg",1440,1547);}}}()))),acc$521));}]);(generate$306=function(source$571){return Generator$307().generate(source$571);});(Generator$307=function(){var it$0$595;var interactive$588;var t0$584;var $577$579;($577$579=arguments);(t0$584=$577$579.length);if(((t0$584>=0)&&(t0$584<=1))){(interactive$588=function(){if((0>=t0$584)){return false;}else{return $577$579[0];}}());(it$0$595=function(){if((!$218(Generator$307)(this))){return Object.create(Generator$307.prototype);}else{return this;}}());(it$0$595["tr"]=Translator$301(std$302.stdprelude));(it$0$595["env"]=std$302.stdenv.fork());(it$0$595["interactive"]=interactive$588);return it$0$595;}else{$683($577$579);}});(Generator$307.prototype["generate"]=function(source$616){var stmt$642;var t$629;var p$630;var ex$631;var rval$632;var self$624;var it$0$619;(it$0$619=this);(self$624=this);(t$629=tokenize$296(source$616));(p$630=parse$298(t$629));(ex$631=(((stmt$642=function(){if(it$0$619.interactive){return ["interactive",p$630];}else{return ["multi",p$630];}}())),std$302.expand(["top"],std$302.topscope,it$0$619.env.convert(stmt$642))));(ex$631=opt$304.hoist(ex$631));(rval$632=it$0$619.tr.translate(ex$631,"stmt"));return (it$0$619.tr.dump_store()+rval$632);});$234(Generator$307,$234(((accum$654=({})),((accum$654["::name"]="Generator"),accum$654)),((accum$658=({})),((accum$658["::egclass"]=true),accum$658))));Generator$307;(exports["Source"]=Source$292);(exports["Location"]=Location$293);(exports["highlight_locations"]=highlight_locations$294);(exports["tokenize"]=tokenize$296);(exports["parse"]=parse$298);(exports["Generator"]=Generator$307);(exports["generate"]=generate$306);
