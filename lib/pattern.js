var τ58=function(type$8694){var f$8697;(f$8697=type$8694["::check"]);;if((f$8697===(void 0))){return function(value$8702){return (value$8702 instanceof type$8694);};}else{return function(value$8705){return f$8697.call(type$8694,value$8705);};}};
var τ59=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var τ60=function(temp$8707$8709){var ph$8713;(ph$8713=temp$8707$8709);;var m$8711$8718;(m$8711$8718=ph$8713);;var bridge$8712$8723;var x$8727;(bridge$8712$8723=m$8711$8718);if((((typeof(bridge$8712$8723)==="string")&&((x$8727=bridge$8712$8723),true))||((typeof(bridge$8712$8723)==="number")&&((x$8727=bridge$8712$8723),true)))){return ["value",x$8727];}else{var other$8734;(other$8734=m$8711$8718);return other$8734["::serialize_ast"]();}};
var send$8556;(send$8556=function(obj$8561,temp$8559$8562){var ph$8566;var msg$8567;var t0$8569;(t0$8569=temp$8559$8562);(msg$8567=t0$8569);(ph$8566=t0$8569);;var m$8564$8573;(m$8564$8573=ph$8566);;var bridge$8565$8578;(bridge$8565$8578=m$8564$8573);if(((typeof(bridge$8565$8578)==="string")||(typeof(bridge$8565$8578)==="number"))){return obj$8561[msg$8567];}else{var other$8586;(other$8586=m$8564$8573);return obj$8561["::send"](msg$8567);}});;(Array[":::project"]=function(temp$8589$8591){var ph$8594;var value$8595;var t0$8597;(t0$8597=temp$8589$8591);(value$8595=t0$8597);(ph$8594=t0$8597);;var m$8593$8601;(m$8593$8601=ph$8594);;if(τ58(Array)(m$8593$8601)){return [true,value$8595];}else{m$8593$8601;return [true,[value$8595]];}});(Array.prototype["::check"]=function(value$8615){if((value$8615 instanceof Array)){var i$8620;(i$8620=0);;$8618:for(;(i$8620<this.length);(i$8620++)){if((τ59(this,i$8620)!==τ59(value$8615,i$8620))){return false;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value$8629){if((value$8629 instanceof Array)){var i$8634;(i$8634=0);;$8632:for(;(i$8634<this.length);(i$8634++)){if((τ59(this,i$8634)!==τ59(value$8629,i$8634))){return [true,[value$8629]];}}return [true,value$8629.slice(this.length)];}else{return [true,[value$8629]];}});(Array.prototype[":::deconstruct"]=function(value$8643){return [true,value$8643.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map(τ60));});(RegExp.prototype["::check"]=function(value$8648){return value$8648.match(this);});(RegExp.prototype[":::project"]=function(value$8651){var m$8653$8655;(m$8653$8655=value$8651.match(this));;var m$8663;if((m$8653$8655===null)){(m$8663=m$8653$8655);return [false,null];}else{var m$8668;(m$8668=m$8653$8655);return [true,m$8668];}});(RegExp.prototype[":::deconstruct"]=function(value$8671){var m$8673$8675;(m$8673$8675=value$8671.match(this));;var m$8683;if((m$8673$8675===null)){(m$8683=m$8673$8675);return [false,null];}else{var m$8688;(m$8688=m$8673$8675);return [true,m$8688];}});(Function.prototype["::send"]=function(args$8691){return this.apply(this,args$8691);});
var τ62=function(dest$11503,values$11504){var k$11509;(k$11509=null);$11507:for(k$11509 in values$11504){if(values$11504.hasOwnProperty(k$11509)){(dest$11503[k$11509]=values$11504[k$11509]);}}return dest$11503;};
var τ61=function(){var $11397$11399;($11397$11399=function(tags$11403){var it$0$11406;(it$0$11406=function(){if((!τ58($11397$11399)(this))){return Object.create($11397$11399.prototype);}else{return this;}}());;(it$0$11406["tags"]=tags$11403);return it$0$11406;});;($11397$11399.prototype["create"]=function(){var m$11415$11417;(m$11415$11417=arguments);;var t0$11422;var message$11426;var args$11427;(t0$11422=m$11415$11417.length);if((t0$11422>=0)){(message$11426=function(){if((0>=t0$11422)){return "";}else{return m$11415$11417[0];}}());(args$11427=Array.prototype.slice.call(m$11415$11417,1));var it$0$11431;(it$0$11431=this);;var e$11436;(e$11436=Error(message$11426));;(e$11436["::tags"]=it$0$11431.tags);(e$11436["args"]=args$11427);(e$11436["name"]=["E"].concat(it$0$11431.tags).join("."));return e$11436;}else{throw Error("mismatch!!");}});($11397$11399.prototype["::check"]=function(e$11445){var it$0$11448;(it$0$11448=this);;var tags$11453;if(((!e$11445)||(!τ58(Error)(e$11445)))){return false;}(tags$11453=(e$11445["::tags"]||[]));;var temp$11461;(temp$11461=it$0$11448.tags);;var len$11466;(len$11466=temp$11461.length);;var i$11471;(i$11471=0);;$11458:for(;(i$11471<len$11466);(i$11471++)){var m$11479;(m$11479=temp$11461[i$11471]);;var tag$11487;(tag$11487=m$11479);if((tags$11453.indexOf(tag$11487)===(-1))){return false;}else{false;;}}return true;});($11397$11399.prototype["::deconstruct"]=function(e$11495){var it$0$11498;(it$0$11498=this);;return e$11495.args;});τ62($11397$11399,({}));return $11397$11399;}();
var τ63=function(temp$11513$11515,key$11516){var ph$11520;(ph$11520=temp$11513$11515);;var m$11518$11525;(m$11518$11525=ph$11520);;var bridge$11519$11530;(bridge$11519$11530=m$11518$11525);if(((bridge$11519$11530===null)||(bridge$11519$11530===(void 0)))){return false;}else{var x$11538;if((typeof(m$11518$11525)==="string")){(x$11538=m$11518$11525);return (key$11516 in String.prototype);}else{var x$11543;if((typeof(m$11518$11525)==="number")){(x$11543=m$11518$11525);return (key$11516 in Number.prototype);}else{var x$11548;(x$11548=m$11518$11525);return (key$11516 in x$11548);}}}};
var τ64=function(type$11551){return function(value$11554){var f$11557;(f$11557=type$11551[":::project"]);;if((f$11557===(void 0))){var f$11562;(f$11562=type$11551["::project"]);;if((f$11562===(void 0))){return [true,type$11551(value$11554)];}else{var rval$11567;(rval$11567=false);;try{(rval$11567=[true,f$11562(value$11554)]);}catch(excv$11573){var e$11579;(e$11579=excv$11573);(rval$11567=[false,null]);}return rval$11567;}}else{return f$11557.call(type$11551,value$11554);}};};
var τ65=function(a$11582,b$11583){var dest$11588;(dest$11588=({}));;var k$11593;(k$11593=null);$11586:for(k$11593 in a$11582){if(a$11582.hasOwnProperty(k$11593)){(dest$11588[k$11593]=a$11582[k$11593]);}}var k$11598;(k$11598=null);$11587:for(k$11598 in b$11583){if(b$11583.hasOwnProperty(k$11598)){(dest$11588[k$11598]=b$11583[k$11598]);}}return dest$11588;};
var τ66=function(from$11603,to$11604){var rval$11608;(rval$11608=[]);;var i$11613;(i$11613=from$11603);;$11607:for(;(i$11613<=to$11604);(i$11613++)){rval$11608.push(i$11613);}return rval$11608;};var $8738$8740;var __lt____gt__$8741;var $8739$8742;var __lt____lt____colon__$8743;var util$8744;var GenSym$8745;var gensym$8746;var zip$8747;var enumerate$8748;var iterkeys$8749;var neighbours$8750;var classify$8751;var classify_contiguous$8752;var identity$8753;var mt$8754;var PatternParser$8755;var PatternProcessor$8756;var assemble_conditions$8757;var assemble_pattern$8758;var inject_below_uses$8759;var parse_pattern$8760;var checkall$8761;var same_block$8762;var parse_clauses$8763;var opt_clauses$8764;var weave_clauses$8765;($8738$8740=require("./pp"));;(__lt____gt__$8741=$8738$8740["<>"]);;($8739$8742=require("./location"));;(__lt____lt____colon__$8743=$8739$8742["<<:"]);;(util$8744=require("./util"));;(GenSym$8745=util$8744.GenSym);;(gensym$8746=util$8744.gensym);;(zip$8747=util$8744.zip);;(enumerate$8748=util$8744.enumerate);;(iterkeys$8749=util$8744.keys);;(neighbours$8750=util$8744.neighbours);;(classify$8751=util$8744.classify);;(classify_contiguous$8752=util$8744.classify_contiguous);;(identity$8753=util$8744.identity);;(mt$8754=require("./expand2"));;(PatternParser$8755=function(expander$8814,scope$8815,pattern$8816,opt$8817){var it$0$8820;(it$0$8820=function(){if((!τ58(PatternParser$8755)(this))){return Object.create(PatternParser$8755.prototype);}else{return this;}}());;(it$0$8820["expander"]=expander$8814);(it$0$8820["opt"]=opt$8817);(it$0$8820["arguments"]=[]);(it$0$8820["vars"]=[]);(it$0$8820["specials"]=({}));(it$0$8820["pattern"]=it$0$8820.expand(scope$8815,pattern$8816,true,it$0$8820.opt.indexable));return it$0$8820;});;(PatternParser$8755.prototype["parse_specs"]=function(scope$8830,specs$8831){var i$8871;var len$8866;var temp$8861;var acc$8856;var rest$8839;var has_defaults$8840;var rval$8841;var it$0$8834;(it$0$8834=this);;(rest$8839=(void 0));;(has_defaults$8840=false);;(rval$8841=classify$8751("fw","bw","keys","defaults",(((acc$8856=[])),(((temp$8861=it$0$8834.expander.step_all(["pattern"],scope$8830,specs$8831))),(((len$8866=temp$8861.length)),(((i$8871=0)),function(){$8850:for(;(i$8871<len$8866);(i$8871++)){var v$8923;var v$8918;var variable$8911;var value$8912;var key$8905;var subp$8906;var key$8900;var variable$8893;var $8851$8887;var $8852$8888;var $8853$8889;var $8854$8890;var t0$8884;var t1$8885;var m$8879;(m$8879=temp$8861[i$8871]);;(t0$8884=m$8879);if((($8852$8888=(t0$8884 instanceof Array))&&((t1$8885=t0$8884.length),(($8854$8890=(t1$8885===2))&&(t0$8884[0]==="dynsplice"))))){(variable$8893=t0$8884[1]);acc$8856.push(((rest$8839=it$0$8834.expand(scope$8830,variable$8893)),["ignore"]));}else{if(($8854$8890&&(t0$8884[0]==="assoc"))){(key$8900=t0$8884[1]);acc$8856.push(["keys",[key$8900,it$0$8834.expand(scope$8830,key$8900)]]);}else{if(($8852$8888&&(($8854$8890=(t1$8885===3))&&(t0$8884[0]==="assoc")))){(key$8905=t0$8884[1]);(subp$8906=t0$8884[2]);acc$8856.push(["keys",[key$8905,it$0$8834.expand(scope$8830,subp$8906)]]);}else{if(($8854$8890&&(t0$8884[0]==="default"))){(variable$8911=t0$8884[1]);(value$8912=t0$8884[2]);acc$8856.push(((has_defaults$8840=true),function(){if(rest$8839){throw τ61(["syntax","pattern"]).create("No default arguments after rest arg.");}else{return ["defaults",[it$0$8834.expand(scope$8830,variable$8911),value$8912]];}}()));}else{(v$8918=m$8879);if(((rest$8839===(void 0))&&(!has_defaults$8840))){acc$8856.push(["fw",it$0$8834.expand(scope$8830,v$8918)]);}else{(v$8923=m$8879);acc$8856.push(["bw",it$0$8834.expand(scope$8830,v$8923)]);}}}}}}}()))),acc$8856)));;(rval$8841["rest"]=rest$8839);return rval$8841;});(PatternParser$8755.prototype["expand"]=function(){var x$8983;var x$8992;var x$9008;var x$9013;var msg$9059;var x$9071;var msg$9084;var msg$9093;var i$9120;var len$9115;var temp$9110;var acc$9105;var i$9220;var len$9215;var temp$9210;var acc$9205;var i$9252;var len$9247;var temp$9242;var t0$9312;var t1$9313;var t2$9314;var i$9341;var len$9336;var temp$9331;var acc$9326;var patts$9321;var canon$9144;var normalize$9145;var pps$9146;var vars$9147;var patt$9400;var msg$9421;var other$9418;var keys$9406;var fw$9388;var bw$9389;var defaults$9390;var rest$9391;var $9367$9385;var t0$9378;var t1$9379;var t2$9380;var t3$9381;var t4$9382;var t5$9383;var m$9366$9373;var specs$9368;var other$9427;var args$9362;var xs$9140;var xs$9099;var f$9079;var arg$9080;var f$9065;var arguments$9066;var f$9052;var arg$9053;var checker$9046;var subp$9047;var projector$9040;var subp$9041;var condition$9034;var subp$9035;var v$9029;var v$9021;var type$8999;var $8961$8975;var $8962$8976;var $8963$8977;var $8964$8978;var t0$8971;var bridge$8960$8972;var t1$8973;var m$8959$8966;var expr$8952;var rval$8953;var it$0$8947;var scope$8940;var pattern$8941;var toplevel$8942;var checked$8943;var t0$8936;var m$8929$8931;(m$8929$8931=arguments);;(t0$8936=m$8929$8931.length);if(((t0$8936>=2)&&(t0$8936<=4))){(scope$8940=m$8929$8931[0]);(pattern$8941=m$8929$8931[1]);(toplevel$8942=function(){if((2>=t0$8936)){return false;}else{return m$8929$8931[2];}}());(checked$8943=function(){if((3>=t0$8936)){return false;}else{return m$8929$8931[3];}}());(it$0$8947=this);;(expr$8952=it$0$8947.expander.step(["pattern"],scope$8940,pattern$8941));;(rval$8953=(((m$8959$8966=expr$8952)),function(){if((((x$8983=m$8959$8966)),((x$8983 instanceof Array)&&(x$8983[0]==="void")))){return ["check",mt$8754.checker.null,["ignore"]];}else{if((((x$8992=m$8959$8966)),((x$8992 instanceof Array)&&(x$8992[0]==="ignore")))){return expr$8952;}else{if(((m$8959$8966 instanceof Array)&&((t0$8971=m$8959$8966.length),((t0$8971===2)&&(m$8959$8966[0]==="special"))))){(type$8999=m$8959$8966[1]);(it$0$8947.specials[type$8999]=true);return expr$8952;}else{(bridge$8960$8972=m$8959$8966);if(((((x$9008=bridge$8960$8972)),((x$9008 instanceof Array)&&(x$9008[0]==="symbol")))||(((x$9013=bridge$8960$8972)),((x$9013 instanceof Array)&&(x$9013[0]==="variable"))))){it$0$8947.vars.push(expr$8952);return ["assign",expr$8952];}else{if((($8961$8975=(m$8959$8966 instanceof Array))&&((t0$8971=m$8959$8966.length),(($8963$8977=(t0$8971===2))&&(($8964$8978=(m$8959$8966[0]==="value"))&&((v$9021=m$8959$8966[1]),it$0$8947.opt.strings_as_variables)))))){it$0$8947.vars.push(expr$8952);return ["assign",expr$8952];}else{if($8964$8978){(v$9029=m$8959$8966[1]);return ["check",mt$8754.checker(v$9029),["ignore"]];}else{if(($8961$8975&&(($8963$8977=(t0$8971===3))&&(m$8959$8966[0]==="test")))){(condition$9034=m$8959$8966[1]);(subp$9035=m$8959$8966[2]);return ["test",condition$9034,it$0$8947.expand(scope$8940,subp$9035,toplevel$8942,false)];}else{if(($8963$8977&&(m$8959$8966[0]==="project"))){(projector$9040=m$8959$8966[1]);(subp$9041=m$8959$8966[2]);return ["project",projector$9040,it$0$8947.expand(scope$8940,subp$9041,toplevel$8942,true)];}else{if(($8963$8977&&(m$8959$8966[0]==="check"))){(checker$9046=m$8959$8966[1]);(subp$9047=m$8959$8966[2]);return ["check",checker$9046,it$0$8947.expand(scope$8940,subp$9047,toplevel$8942,true)];}else{if(($8963$8977&&(($8964$8978=(m$8959$8966[0]==="send"))&&((f$9052=m$8959$8966[1]),((arg$9053=m$8959$8966[2]),(!toplevel$8942)))))){(msg$9059="Function arguments can only be declared as a top level pattern.");;throw τ61(["syntax","pattern"]).create(msg$9059,({"node":expr$8952,"arg":arg$9053}));}else{if(($8964$8978&&((f$9065=m$8959$8966[1]),((t1$8973=m$8959$8966[2]),(((x$9071=t1$8973)),((x$9071 instanceof Array)&&(x$9071[0]==="data"))))))){(arguments$9066=t1$8973);it$0$8947.arguments.unshift(arguments$9066);return it$0$8947.expand(scope$8940,f$9065,true,false);}else{if($8964$8978){(f$9079=m$8959$8966[1]);(arg$9080=m$8959$8966[2]);(msg$9084=["Function must be declared with an array of arguments","(did you mean to use ':='?)"].join(" "));;throw τ61(["syntax","pattern"]).create(msg$9084,({"node":expr$8952,"arg":arg$9080}));}else{m$8959$8966;if((!it$0$8947.opt.allow_nested)){(msg$9093="Nested patterns are not allowed here.");;throw τ61(["syntax","pattern"]).create(msg$9093,({"node":expr$8952}));}else{if((($8961$8975=(m$8959$8966 instanceof Array))&&((t0$8971=m$8959$8966.length),(($8963$8977=(t0$8971>=1))&&(m$8959$8966[0]==="all"))))){(xs$9099=Array.prototype.slice.call(m$8959$8966,1));return ["all"].concat((((acc$9105=[])),(((temp$9110=xs$9099)),(((len$9115=temp$9110.length)),(((i$9120=0)),function(){$9103:for(;(i$9120<len$9115);(i$9120++)){var x$9136;var m$9128;(m$9128=temp$9110[i$9120]);;(x$9136=m$9128);acc$9105.push(it$0$8947.expand(scope$8940,x$9136));}}()))),acc$9105));}else{if(($8963$8977&&(m$8959$8966[0]==="any"))){(xs$9140=Array.prototype.slice.call(m$8959$8966,1));(canon$9144=function(all$9151){return all$9151.sort().join(",");});;(normalize$9145=function(vars$9157){var i$9176;var len$9171;var temp$9166;var acc$9161;return canon$9144((((acc$9161=[])),(((temp$9166=vars$9157)),(((len$9171=temp$9166.length)),(((i$9176=0)),function(){$9159:for(;(i$9176<len$9171);(i$9176++)){var v$9194;var t0$9189;var t1$9190;var m$9184;(m$9184=temp$9166[i$9176]);;(t0$9189=m$9184);if(((t0$9189 instanceof Array)&&((t1$9190=t0$9189.length),((t1$9190===2)&&(t0$9189[0]==="symbol"))))){(v$9194=t0$9189[1]);acc$9161.push(v$9194);}else{false;;}}}()))),acc$9161));});;(pps$9146=(((acc$9205=[])),(((temp$9210=xs$9140)),(((len$9215=temp$9210.length)),(((i$9220=0)),function(){$9203:for(;(i$9220<len$9215);(i$9220++)){var x$9236;var m$9228;(m$9228=temp$9210[i$9220]);;(x$9236=m$9228);acc$9205.push(PatternParser$8755(it$0$8947.expander,scope$8940,x$9236,it$0$8947.opt));}}()))),acc$9205));;(temp$9242=neighbours$8750(pps$9146));;(len$9247=temp$9242.length);;(i$9252=0);;$9239:for(;(i$9252<len$9247);(i$9252++)){var i$9289;var len$9284;var temp$9279;var pp1$9270;var pp2$9271;var t0$9265;var t1$9266;var m$9260;(m$9260=temp$9242[i$9252]);;(t0$9265=m$9260);if(((t0$9265 instanceof Array)&&((t1$9266=t0$9265.length),(t1$9266===2)))){(pp1$9270=t0$9265[0]);(pp2$9271=t0$9265[1]);(temp$9279=pps$9146);;(len$9284=temp$9279.length);;(i$9289=0);;$9276:for(;(i$9289<len$9284);(i$9289++)){var pp$9305;var m$9297;(m$9297=temp$9279[i$9289]);;(pp$9305=m$9297);normalize$9145(pp$9305.vars);}if((normalize$9145(pp1$9270.vars)!==normalize$9145(pp2$9271.vars))){throw τ61(["syntax","pattern"]).create("Both branches of 'or' must contain the same variables",({"vars1":__lt____lt____colon__$8743(pp1$9270.vars.sort(),pp1$9270.pattern),"vars2":__lt____lt____colon__$8743(pp2$9271.vars.sort(),pp2$9271.pattern)}));}if((canon$9144(iterkeys$8749(pp1$9270.specials))!==canon$9144(iterkeys$8749(pp2$9271.specials)))){throw τ61(["syntax","pattern"]).create("Both branches of 'or' must contain the same special tokens",({"special1":__lt____lt____colon__$8743(iterkeys$8749(pp1$9270.specials).sort(),pp1$9270.pattern),"special2":__lt____lt____colon__$8743(iterkeys$8749(pp2$9271.specials).sort(),pp2$9271.pattern)}));}}else{false;;}}(t0$9312=pps$9146);if(((t0$9312 instanceof Array)&&((t1$9313=t0$9312.length),((t1$9313>=1)&&((t2$9314=t0$9312[0]),τ63(t2$9314,"vars")))))){(vars$9147=t2$9314.vars);Array.prototype.slice.call(t0$9312,1);;}else{throw Error("Mismatch");}(it$0$8947["vars"]=it$0$8947.vars.concat(vars$9147));(patts$9321=(((acc$9326=[])),(((temp$9331=pps$9146)),(((len$9336=temp$9331.length)),(((i$9341=0)),function(){$9324:for(;(i$9341<len$9336);(i$9341++)){var pp$9357;var m$9349;(m$9349=temp$9331[i$9341]);;(pp$9357=m$9349);acc$9326.push(pp$9357.pattern);}}()))),acc$9326));;return ["any"].concat(patts$9321);}else{if(($8963$8977&&(m$8959$8966[0]==="data"))){(args$9362=Array.prototype.slice.call(m$8959$8966,1));(specs$9368=it$0$8947.parse_specs(scope$8940,args$9362));;(m$9366$9373=specs$9368);;if((($9367$9385=τ63(m$9366$9373,"keys"))&&((t0$9378=m$9366$9373.keys),((t0$9378 instanceof Array)&&((t1$9379=t0$9378.length),((t1$9379===0)&&(τ63(m$9366$9373,"fw")&&((fw$9388=m$9366$9373.fw),(τ63(m$9366$9373,"bw")&&((bw$9389=m$9366$9373.bw),(τ63(m$9366$9373,"defaults")&&((defaults$9390=m$9366$9373.defaults),τ63(m$9366$9373,"rest"))))))))))))){(rest$9391=m$9366$9373.rest);(patt$9400=__lt____lt____colon__$8743(["array_pattern",fw$9388,bw$9389,defaults$9390,rest$9391],pattern$8941));;if(checked$8943){return patt$9400;}else{return ["check",mt$8754.checker.Array,patt$9400];}}else{if(($9367$9385&&((keys$9406=m$9366$9373.keys),(τ63(m$9366$9373,"fw")&&((t0$9378=m$9366$9373.fw),((t0$9378 instanceof Array)&&((t1$9379=t0$9378.length),((t1$9379===0)&&(τ63(m$9366$9373,"bw")&&((t2$9380=m$9366$9373.bw),((t2$9380 instanceof Array)&&((t3$9381=t2$9380.length),((t3$9381===0)&&(τ63(m$9366$9373,"defaults")&&((t4$9382=m$9366$9373.defaults),((t4$9382 instanceof Array)&&((t5$9383=t4$9382.length),((t5$9383===0)&&(τ63(m$9366$9373,"rest")&&(m$9366$9373.rest===(void 0))))))))))))))))))))){return ["object_pattern"].concat(keys$9406);}else{(other$9418=m$9366$9373);(msg$9421="Pattern must be an array or an object.");;throw τ61(["syntax","pattern"]).create(msg$9421,({"node":expr$8952,"specs":specs$9368}));}}}else{(other$9427=m$8959$8966);throw τ61(["syntax","pattern"]).create("Illegal pattern",({"node":other$9427}));}}}}}}}}}}}}}}}}}()));;return __lt____lt____colon__$8743(rval$8953,pattern$8941);}else{throw Error("mismatch!!");}});τ62(PatternParser$8755,({}));PatternParser$8755;(PatternProcessor$8756=function(){var it$0$9437;(it$0$9437=function(){if((!τ58(PatternProcessor$8756)(this))){return Object.create(PatternProcessor$8756.prototype);}else{return this;}}());;(it$0$9437["temps"]=[]);(it$0$9437["parts"]=[]);(it$0$9437["gen"]=GenSym$8745("t"));return it$0$9437;});;(PatternProcessor$8756.prototype["do"]=function(part$9447){var it$0$9450;(it$0$9450=this);;return it$0$9450.parts.push(["do",part$9447]);});(PatternProcessor$8756.prototype["check"]=function(part$9457){var it$0$9460;(it$0$9460=this);;return it$0$9460.parts.push(["check",part$9457]);});(PatternProcessor$8756.prototype["temp"]=function(){var x$9501;var x$9506;var init$9513;var bridge$9484$9495;var m$9483$9490;var it$0$9485;var x$9478;var v$9479;var t0$9474;var m$9467$9469;(m$9467$9469=arguments);;(t0$9474=m$9467$9469.length);if(((t0$9474>=1)&&(t0$9474<=2))){(x$9478=m$9467$9469[0]);(v$9479=function(){if((1>=t0$9474)){return null;}else{return m$9467$9469[1];}}());(it$0$9485=this);;(m$9483$9490=x$9478);;(bridge$9484$9495=m$9483$9490);if((((((x$9501=bridge$9484$9495)),((x$9501 instanceof Array)&&(x$9501[0]==="variable")))||(((x$9506=bridge$9484$9495)),((x$9506 instanceof Array)&&(x$9506[0]==="symbol"))))&&(τ63(m$9483$9490,"single_assignment")&&(m$9483$9490.single_assignment&&(!v$9479))))){return x$9478;}else{(init$9513=m$9483$9490);(v$9479=(v$9479||["symbol",it$0$9485.gen()]));(v$9479["single_assignment"]=true);it$0$9485.temps.push(v$9479);it$0$9485.do(["send",["symbol",":="],["data",v$9479,init$9513]]);return v$9479;}}else{throw Error("mismatch!!");}});(PatternProcessor$8756.prototype["process"]=function(pattern$9521,rhs$9522,fns$9523){var x$9555;var x$9584;var t$9596;var t$9607;var i$9634;var len$9629;var temp$9624;var t$9617;var i$9691;var len$9686;var temp$9681;var acc$9676;var fn$9663;var parts$9664;var t$9658;var i$9742;var len$9737;var temp$9732;var acc$9727;var t$9721;var otherwise$9835;var m$9817$9819;var i$9850;var len$9845;var temp$9840;var i$9888;var len$9883;var temp$9878;var end$9930;var pos$9925;var i$9951;var len$9946;var temp$9941;var acc$9936;var nfw$9781;var nbw$9782;var ndflt$9783;var extract_length$9784;var check_length$9785;var lo$9786;var hi$9787;var t$9788;var len$9789;var fw$9774;var bw$9775;var dflt$9776;var rest$9777;var subp$9717;var xs$9654;var xs$9613;var projector$9602;var subp$9603;var checker$9591;var subp$9592;var checker$9580;var condition$9573;var subp$9574;var kind$9568;var sym$9562;var $9535$9547;var $9536$9548;var $9537$9549;var $9538$9550;var t0$9545;var m$9534$9540;var rval$9531;var it$0$9526;(it$0$9526=this);;(rval$9531=(((m$9534$9540=pattern$9521)),function(){if((((x$9555=m$9534$9540)),((x$9555 instanceof Array)&&(x$9555[0]==="ignore")))){return it$0$9526.do(rhs$9522);}else{if((($9535$9547=(m$9534$9540 instanceof Array))&&((t0$9545=m$9534$9540.length),(($9537$9549=(t0$9545===2))&&(m$9534$9540[0]==="assign"))))){(sym$9562=m$9534$9540[1]);return it$0$9526.parts.push(fns$9523.assign(sym$9562,rhs$9522));}else{if(($9537$9549&&(m$9534$9540[0]==="special"))){(kind$9568=m$9534$9540[1]);return it$0$9526.process(fns$9523.special(pattern$9521,rhs$9522),rhs$9522,fns$9523);}else{if(($9535$9547&&(($9537$9549=(t0$9545===3))&&(m$9534$9540[0]==="test")))){(condition$9573=m$9534$9540[1]);(subp$9574=m$9534$9540[2]);it$0$9526.process(subp$9574,rhs$9522,fns$9523);return it$0$9526.check(condition$9573);}else{if(($9537$9549&&(($9538$9550=(m$9534$9540[0]==="check"))&&((checker$9580=m$9534$9540[1]),(((x$9584=m$9534$9540[2])),((x$9584 instanceof Array)&&(x$9584[0]==="ignore"))))))){return it$0$9526.check(["send",checker$9580,["data",rhs$9522]]);}else{if($9538$9550){(checker$9591=m$9534$9540[1]);(subp$9592=m$9534$9540[2]);(t$9596=it$0$9526.temp(rhs$9522));;it$0$9526.check(["send",checker$9591,["data",t$9596]]);return it$0$9526.process(subp$9592,t$9596,fns$9523);}else{if(($9537$9549&&(m$9534$9540[0]==="project"))){(projector$9602=m$9534$9540[1]);(subp$9603=m$9534$9540[2]);(t$9607=it$0$9526.temp(["send",projector$9602,["data",rhs$9522]]));;it$0$9526.check(["send",t$9607,["value",0]]);return it$0$9526.process(subp$9603,["send",t$9607,["value",1]],fns$9523);}else{if(($9535$9547&&(($9537$9549=(t0$9545>=1))&&(m$9534$9540[0]==="all")))){(xs$9613=Array.prototype.slice.call(m$9534$9540,1));(t$9617=it$0$9526.temp(rhs$9522));;(temp$9624=xs$9613);;(len$9629=temp$9624.length);;(i$9634=0);;$9621:for(;(i$9634<len$9629);(i$9634++)){var x$9650;var m$9642;(m$9642=temp$9624[i$9634]);;(x$9650=m$9642);it$0$9526.process(x$9650,t$9617,fns$9523);}return null;}else{if(($9537$9549&&(m$9534$9540[0]==="any"))){(xs$9654=Array.prototype.slice.call(m$9534$9540,1));(t$9658=it$0$9526.temp(rhs$9522,["symbol",gensym$8746("bridge")]));;return it$0$9526.check((((fn$9663=function(x$9668,rest$9669){return ["send",["symbol","or"],["data",x$9668,rest$9669]];})),((parts$9664=(((acc$9676=[])),(((temp$9681=xs$9654)),(((len$9686=temp$9681.length)),(((i$9691=0)),function(){$9674:for(;(i$9691<len$9686);(i$9691++)){var pp$9710;var x$9707;var m$9699;(m$9699=temp$9681[i$9691]);;(x$9707=m$9699);acc$9676.push((((pp$9710=PatternProcessor$8756())),pp$9710.process(x$9707,t$9658,fns$9523),assemble_conditions$8757(pp$9710)));}}()))),acc$9676))),util$8744.construct(parts$9664,fn$9663,["symbol","false"])));}else{if(($9537$9549&&(m$9534$9540[0]==="object_pattern"))){(subp$9717=Array.prototype.slice.call(m$9534$9540,1));(t$9721=it$0$9526.temp(rhs$9522));;(acc$9727=[]);;(temp$9732=subp$9717);;(len$9737=temp$9732.length);;(i$9742=0);;$9725:for(;(i$9742<len$9737);(i$9742++)){var k$9762;var v$9763;var t0$9755;var t1$9756;var t2$9757;var t3$9758;var m$9750;(m$9750=temp$9732[i$9742]);;(t0$9755=m$9750);if(((t0$9755 instanceof Array)&&((t1$9756=t0$9755.length),((t1$9756===2)&&((t2$9757=t0$9755[0]),((t2$9757 instanceof Array)&&((t3$9758=t2$9757.length),((t3$9758===2)&&(t2$9757[0]==="value"))))))))){(k$9762=t2$9757[1]);(v$9763=t0$9755[1]);acc$9727.push((it$0$9526.check(["send",["symbol","___hasprop"],["data",t$9721,["value",k$9762]]]),it$0$9526.process(v$9763,["send",t$9721,["value",k$9762]],fns$9523)));}else{false;;}}return acc$9727;}else{if(($9535$9547&&((t0$9545===5)&&(m$9534$9540[0]==="array_pattern")))){(fw$9774=m$9534$9540[1]);(bw$9775=m$9534$9540[2]);(dflt$9776=m$9534$9540[3]);(rest$9777=m$9534$9540[4]);(nfw$9781=fw$9774.length);;(nbw$9782=bw$9775.length);;(ndflt$9783=dflt$9776.length);;(extract_length$9784=true);;(check_length$9785=true);;(lo$9786=(nfw$9781+nbw$9782));;(hi$9787=(lo$9786+ndflt$9783));;(t$9788=it$0$9526.temp(rhs$9522));;(len$9789=it$0$9526.temp(["send",t$9788,["send",["symbol","."],["data",["void"],["symbol","length"]]]]));;it$0$9526.check((((m$9817$9819=rest$9777)),function(){if(m$9817$9819){return ["send",["symbol",">="],["data",len$9789,["value",lo$9786]]];}else{m$9817$9819;if((lo$9786===hi$9787)){return ["send",["symbol","=="],["data",len$9789,["value",lo$9786]]];}else{(otherwise$9835=m$9817$9819);return ["send",["symbol","and"],["data",["send",["symbol",">="],["data",len$9789,["value",lo$9786]]],["send",["symbol","<="],["data",len$9789,["value",hi$9787]]]]];}}}()));(temp$9840=enumerate$8748(fw$9774));;(len$9845=temp$9840.length);;(i$9850=0);;$9837:for(;(i$9850<len$9845);(i$9850++)){var i$9868;var m$9869;var t0$9863;var t1$9864;var m$9858;(m$9858=temp$9840[i$9850]);;(t0$9863=m$9858);if(((t0$9863 instanceof Array)&&((t1$9864=t0$9863.length),(t1$9864===2)))){(i$9868=t0$9863[0]);(m$9869=t0$9863[1]);it$0$9526.process(m$9869,["send",t$9788,["value",i$9868]],fns$9523);}else{false;;}}(temp$9878=enumerate$8748(dflt$9776));;(len$9883=temp$9878.length);;(i$9888=0);;$9875:for(;(i$9888<len$9883);(i$9888++)){var idx$9918;var i$9908;var patt$9909;var value$9910;var t0$9901;var t1$9902;var t2$9903;var t3$9904;var m$9896;(m$9896=temp$9878[i$9888]);;(t0$9901=m$9896);if(((t0$9901 instanceof Array)&&((t1$9902=t0$9901.length),((t1$9902===2)&&((i$9908=t0$9901[0]),((t2$9903=t0$9901[1]),((t2$9903 instanceof Array)&&((t3$9904=t2$9903.length),(t3$9904===2))))))))){(patt$9909=t2$9903[0]);(value$9910=t2$9903[1]);(idx$9918=(i$9908+nfw$9781));;it$0$9526.process(patt$9909,["send",["symbol","if"],["data",["send",["symbol",">="],["data",["value",(idx$9918+nbw$9782)],len$9789]],value$9910,["send",t$9788,["value",idx$9918]]]],fns$9523);}else{false;;}}if((rest$9777!==(void 0))){(pos$9925=(nfw$9781+ndflt$9783));;(end$9930=function(){if((nbw$9782>0)){return [["value",(-nbw$9782)]];}else{return [];}}());;it$0$9526.process(rest$9777,["send",["send",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",t$9788,["value",pos$9925]].concat(end$9930)],fns$9523);}else{[];}(acc$9936=[]);;(temp$9941=enumerate$8748(bw$9775));;(len$9946=temp$9941.length);;(i$9951=0);;$9934:for(;(i$9951<len$9946);(i$9951++)){var i$9969;var m$9970;var t0$9964;var t1$9965;var m$9959;(m$9959=temp$9941[i$9951]);;(t0$9964=m$9959);if(((t0$9964 instanceof Array)&&((t1$9965=t0$9964.length),(t1$9965===2)))){(i$9969=t0$9964[0]);(m$9970=t0$9964[1]);acc$9936.push(it$0$9526.process(m$9970,["send",["symbol","___js_fetch"],["data",t$9788,["send",["symbol","-"],["data",len$9789,["value",(nbw$9782-i$9969)]]]]],fns$9523));}else{false;;}}return acc$9936;}else{throw Error("mismatch!!");}}}}}}}}}}}}()));;return rval$9531;});τ62(PatternProcessor$8756,({}));PatternProcessor$8756;(assemble_conditions$8757=function(pp$9982){var i$10063;var len$10058;var temp$10053;var acc$10048;var decls$10043;var construct$9985;(construct$9985=function(temp$9988$9990){var x$10033;var rest$10034;var x$10026;var x$10018;var rest$10019;var $9993$10009;var $9994$10010;var t0$10005;var t1$10006;var t2$10007;var m$9992$10000;var ph$9995;(ph$9995=temp$9988$9990);;(m$9992$10000=ph$9995);;if((($9993$10009=(m$9992$10000 instanceof Array))&&((t0$10005=m$9992$10000.length),(t0$10005===0)))){return ["value",true];}else{if(($9993$10009&&((t0$10005>=1)&&((t1$10006=m$9992$10000[0]),((t1$10006 instanceof Array)&&((t2$10007=t1$10006.length),((t2$10007===2)&&(t1$10006[0]==="do")))))))){(x$10018=t1$10006[1]);(rest$10019=Array.prototype.slice.call(m$9992$10000,1));return ["multi",x$10018,construct$9985(rest$10019)];}else{if(($9993$10009&&((t0$10005===1)&&((t1$10006=m$9992$10000[0]),((t1$10006 instanceof Array)&&((t2$10007=t1$10006.length),((t2$10007===2)&&(t1$10006[0]==="check")))))))){(x$10026=t1$10006[1]);return x$10026;}else{if(($9993$10009&&((t0$10005>=1)&&((t1$10006=m$9992$10000[0]),((t1$10006 instanceof Array)&&((t2$10007=t1$10006.length),((t2$10007===2)&&(t1$10006[0]==="check")))))))){(x$10033=t1$10006[1]);(rest$10034=Array.prototype.slice.call(m$9992$10000,1));return ["send",["symbol","and"],["data",x$10033,construct$9985(rest$10034)]];}else{throw Error("mismatch!!");}}}}});;if(pp$9982.temps.length){(decls$10043=(((acc$10048=[])),(((temp$10053=pp$9982.temps)),(((len$10058=temp$10053.length)),(((i$10063=0)),function(){$10046:for(;(i$10063<len$10058);(i$10063++)){var t$10079;var m$10071;(m$10071=temp$10053[i$10063]);;(t$10079=m$10071);acc$10048.push(["declare",t$10079]);}}()))),acc$10048));;return ["multi"].concat(decls$10043).concat([construct$9985(pp$9982.parts)]);}else{return construct$9985(pp$9982.parts);}});;(assemble_pattern$8758=function(){var i$10126;var len$10121;var temp$10116;var i$10180;var len$10175;var temp$10170;var test$10273;var lead$10103;var trail$10104;var construct$10105;var parts$10097;var t$10098;var f$10099;var t0$10093;var m$10086$10088;(m$10086$10088=arguments);;(t0$10093=m$10086$10088.length);if(((t0$10093>=2)&&(t0$10093<=3))){(parts$10097=m$10086$10088[0]);(t$10098=m$10086$10088[1]);(f$10099=function(){if((2>=t0$10093)){return null;}else{return m$10086$10088[2];}}());(lead$10103=[]);;(temp$10116=parts$10097.slice(0));;(len$10121=temp$10116.length);;(i$10126=0);;$10109:for(;(i$10126<len$10121);(i$10126++)){var x$10155;var x$10148;var $10110$10142;var $10111$10143;var $10112$10144;var $10113$10145;var t0$10139;var t1$10140;var m$10134;(m$10134=temp$10116[i$10126]);;(t0$10139=m$10134);if((($10111$10143=(t0$10139 instanceof Array))&&((t1$10140=t0$10139.length),(($10113$10145=(t1$10140===2))&&(t0$10139[0]==="do"))))){(x$10148=t0$10139[1]);lead$10103.push(x$10148);parts$10097.shift();}else{if(($10113$10145&&(t0$10139[0]==="check"))){(x$10155=t0$10139[1]);break $10109;}else{false;;}}}(trail$10104=[]);;(temp$10170=parts$10097.slice(0).reverse());;(len$10175=temp$10170.length);;(i$10180=0);;$10163:for(;(i$10180<len$10175);(i$10180++)){var x$10209;var x$10202;var $10164$10196;var $10165$10197;var $10166$10198;var $10167$10199;var t0$10193;var t1$10194;var m$10188;(m$10188=temp$10170[i$10180]);;(t0$10193=m$10188);if((($10165$10197=(t0$10193 instanceof Array))&&((t1$10194=t0$10193.length),(($10167$10199=(t1$10194===2))&&(t0$10193[0]==="do"))))){(x$10202=t0$10193[1]);trail$10104.unshift(x$10202);parts$10097.pop();}else{if(($10167$10199&&(t0$10193[0]==="check"))){(x$10209=t0$10193[1]);break $10163;}else{false;;}}}(construct$10105=function(temp$10216$10218){var other$10269;var x$10261;var rest$10262;var x$10254;var x$10246;var rest$10247;var $10221$10237;var $10222$10238;var t0$10233;var t1$10234;var t2$10235;var m$10220$10228;var ph$10223;(ph$10223=temp$10216$10218);;(m$10220$10228=ph$10223);;if((($10221$10237=(m$10220$10228 instanceof Array))&&((t0$10233=m$10220$10228.length),(t0$10233===0)))){return ["value",true];}else{if(($10221$10237&&((t0$10233>=1)&&((t1$10234=m$10220$10228[0]),((t1$10234 instanceof Array)&&((t2$10235=t1$10234.length),((t2$10235===2)&&(t1$10234[0]==="do")))))))){(x$10246=t1$10234[1]);(rest$10247=Array.prototype.slice.call(m$10220$10228,1));return ["multi",x$10246,construct$10105(rest$10247)];}else{if(($10221$10237&&((t0$10233===1)&&((t1$10234=m$10220$10228[0]),((t1$10234 instanceof Array)&&((t2$10235=t1$10234.length),((t2$10235===2)&&(t1$10234[0]==="check")))))))){(x$10254=t1$10234[1]);return x$10254;}else{if(($10221$10237&&((t0$10233>=1)&&((t1$10234=m$10220$10228[0]),((t1$10234 instanceof Array)&&((t2$10235=t1$10234.length),((t2$10235===2)&&(t1$10234[0]==="check")))))))){(x$10261=t1$10234[1]);(rest$10262=Array.prototype.slice.call(m$10220$10228,1));return ["send",["symbol","and"],["data",x$10261,construct$10105(rest$10262)]];}else{(other$10269=m$10220$10228);throw τ61(["oops"]).create("?!?",other$10269);}}}}});;if(parts$10097.length){(test$10273=construct$10105(parts$10097));;return ["multi"].concat(lead$10103).concat([function(){if(f$10099){return ["send",["symbol","if"],["data",test$10273,["multi"].concat(trail$10104).concat([t$10098]),f$10099]];}else{return ["send",["symbol","if"],["data",test$10273,["multi"].concat(trail$10104).concat([t$10098])]];}}()]);}else{return ["multi"].concat(lead$10103).concat(trail$10104).concat([t$10098]);}}else{throw Error("mismatch!!");}});;(inject_below_uses$8759=function(temp$10282$10284,fn$10285){var other$10309;var scope$10302;var x$10303;var t0$10298;var m$10287$10293;var ph$10288;(ph$10288=temp$10282$10284);;(m$10287$10293=ph$10288);;if(((m$10287$10293 instanceof Array)&&((t0$10298=m$10287$10293.length),((t0$10298===3)&&(m$10287$10293[0]==="use"))))){(scope$10302=m$10287$10293[1]);(x$10303=m$10287$10293[2]);return ["use",scope$10302,inject_below_uses$8759(x$10303,fn$10285)];}else{(other$10309=m$10287$10293);return fn$10285(other$10309);}});;(parse_pattern$8760=function(expander$10315,scope$10316,pattern$10317,rhs$10318,opt$10319){var t0$10330;var i$10361;var len$10356;var temp$10351;var acc$10346;var parse$10322;var target$10323;var proc$10324;(parse$10322=PatternParser$8755(expander$10315,scope$10316,pattern$10317,opt$10319));;if(((!opt$10319.allow_arguments)&&parse$10322.arguments.length)){throw τ61(["syntax","pattern","arguments"]).create("Arguments cannot be declared in this pattern",({"args":parse$10322.arguments[0]}));}(t0$10330=τ64((opt$10319.wrap_target||identity$8753))(function(){if(parse$10322.arguments.length){return inject_below_uses$8759(rhs$10318,function(x$10333){return util$8744.construct(parse$10322.arguments.concat([x$10333]),function(args$10336,rest$10337){return ["send",["symbol","->"],["data",args$10336,rest$10337]];});});}else{return rhs$10318;}}()));if(t0$10330[0]){(target$10323=t0$10330[1]);;}else{throw Error("Mismatch");}(proc$10324=PatternProcessor$8756());;proc$10324.process(parse$10322.pattern,target$10323,opt$10319);if(opt$10319.finalize){return ["splice"].concat(opt$10319.declare(parse$10322.vars)).concat([["multi"].concat((((acc$10346=[])),(((temp$10351=proc$10324.temps)),(((len$10356=temp$10351.length)),(((i$10361=0)),function(){$10344:for(;(i$10361<len$10356);(i$10361++)){var t$10377;var m$10369;(m$10369=temp$10351[i$10361]);;(t$10377=m$10369);acc$10346.push(["declare",t$10377]);}}()))),acc$10346)).concat([assemble_pattern$8758(proc$10324.parts,opt$10319.success(),opt$10319.failure())])]);}else{return [parse$10322.vars,proc$10324.temps,proc$10324.parts];}});;(checkall$8761=["send","data","multi","assign","void","check","do"]);;(same_block$8762=function(temp$10385$10387,ban1$10388,ban2$10389){var i$10489;var len$10484;var temp$10479;var other$10510;var type1$10463;var args1$10464;var type2$10465;var args2$10466;var m1$10454;var m2$10455;var v1$10445;var v2$10446;var s1$10436;var s2$10437;var v1$10424;var v2$10425;var $10392$10415;var $10393$10416;var $10394$10417;var $10395$10418;var $10396$10419;var $10397$10420;var $10398$10421;var t0$10409;var t1$10410;var t2$10411;var t3$10412;var t4$10413;var m$10391$10404;var ph$10399;(ph$10399=temp$10385$10387);;(m$10391$10404=ph$10399);;if((($10392$10415=(m$10391$10404 instanceof Array))&&((t0$10409=m$10391$10404.length),(($10394$10417=(t0$10409===2))&&((t1$10410=m$10391$10404[0]),(($10396$10419=(t1$10410 instanceof Array))&&((t2$10411=t1$10410.length),(($10398$10421=(t2$10411===2))&&((t1$10410[0]==="variable")&&((v1$10424=t1$10410[1]),((t3$10412=m$10391$10404[1]),((t3$10412 instanceof Array)&&((t4$10413=t3$10412.length),((t4$10413===2)&&(t3$10412[0]==="variable"))))))))))))))){(v2$10425=t3$10412[1]);return (v1$10424===v2$10425);}else{if(($10398$10421&&((t1$10410[0]==="symbol")&&((s1$10436=t1$10410[1]),((t3$10412=m$10391$10404[1]),((t3$10412 instanceof Array)&&((t4$10413=t3$10412.length),((t4$10413===2)&&(t3$10412[0]==="symbol"))))))))){(s2$10437=t3$10412[1]);return (((!τ59(ban1$10388,s1$10436))&&(!τ59(ban2$10389,s2$10437)))&&(s1$10436===s2$10437));}else{if(($10398$10421&&((t1$10410[0]==="value")&&((v1$10445=t1$10410[1]),((t3$10412=m$10391$10404[1]),((t3$10412 instanceof Array)&&((t4$10413=t3$10412.length),((t4$10413===2)&&(t3$10412[0]==="value"))))))))){(v2$10446=t3$10412[1]);return (v1$10445===v2$10446);}else{if(($10398$10421&&((t1$10410[0]==="macro")&&((m1$10454=t1$10410[1]),((t3$10412=m$10391$10404[1]),((t3$10412 instanceof Array)&&((t4$10413=t3$10412.length),((t4$10413===2)&&(t3$10412[0]==="macro"))))))))){(m2$10455=t3$10412[1]);return (m1$10454===m2$10455);}else{if(($10396$10419&&((t2$10411>=1)&&((type1$10463=t1$10410[0]),((args1$10464=Array.prototype.slice.call(t1$10410,1)),((t3$10412=m$10391$10404[1]),((t3$10412 instanceof Array)&&((t4$10413=t3$10412.length),((t4$10413>=1)&&((type2$10465=t3$10412[0]),((args2$10466=Array.prototype.slice.call(t3$10412,1)),(checkall$8761.indexOf(type1$10463)!==(-1))))))))))))){if(((type1$10463===type2$10465)&&(args1$10464.length===args2$10466.length))){(temp$10479=zip$8747(args1$10464,args2$10466));;(len$10484=temp$10479.length);;(i$10489=0);;$10476:for(;(i$10489<len$10484);(i$10489++)){var pair$10505;var m$10497;(m$10497=temp$10479[i$10489]);;(pair$10505=m$10497);if((!same_block$8762(pair$10505,ban1$10388,ban2$10389))){return false;}}return true;}else{return false;}}else{(other$10510=m$10391$10404);return false;}}}}}});;(parse_clauses$8763=function(expander$10516,scope$10517,target$10518,stmts$10519,opt$10520){var i$10549;var len$10544;var temp$10539;var acc$10534;var i$10715;var len$10710;var temp$10705;var acc$10700;var i$10761;var len$10756;var temp$10751;var acc$10746;var decls$10741;var all_temps$10523;var the_parts$10524;var unique_temps$10525;(all_temps$10523=[]);;(the_parts$10524=(((acc$10534=[])),(((temp$10539=expander$10516.step_all(["clause"],scope$10517,stmts$10519))),(((len$10544=temp$10539.length)),(((i$10549=0)),function(){$10531:for(;(i$10549<len$10544);(i$10549++)){var accum$10622;var t0$10618;var t1$10619;var i$10649;var len$10644;var temp$10639;var bod$10676;var placeholder$10574;var special_fn$10575;var vars$10576;var temps$10577;var blocks$10578;var vars2$10579;var x$10685;var other$10692;var b$10682;var pattern$10568;var body$10569;var $10532$10565;var t0$10562;var t1$10563;var m$10557;(m$10557=temp$10539[i$10549]);;(t0$10562=m$10557);if(((t0$10562 instanceof Array)&&((t1$10563=t0$10562.length),((t1$10563===3)&&(t0$10562[0]==="clause"))))){(pattern$10568=t0$10562[1]);(body$10569=t0$10562[2]);acc$10534.push((((placeholder$10574=(void 0))),((special_fn$10575=function(temp$10585$10587,value$10588){var t0$10594;var t1$10595;var other$10614;var m$10590$10601;var ph$10591;var expr$10592;(t0$10594=temp$10585$10587);if(((t0$10594 instanceof Array)&&((t1$10595=t0$10594.length),((t1$10595===2)&&(t0$10594[0]==="special"))))){(ph$10591=t0$10594[1]);(expr$10592=t0$10594);;}else{throw Error("Mismatch");}(m$10590$10601=ph$10591);;if((m$10590$10601==="match")){(placeholder$10574=["symbol",gensym$8746("ph")]);return ["assign",placeholder$10574];}else{(other$10614=m$10590$10601);throw τ61(["syntax","pattern","special"]).create("Special token cannot be used here",({"special":expr$10592}));}})),((t0$10618=parse_pattern$8760(expander$10516,scope$10517,pattern$10568,target$10518,τ65(opt$10520,τ62(({"allow_arguments":false,"allow_nested":true,"special":special_fn$10575}),τ62(((accum$10622=({})),((accum$10622["assign"]=function(v$10626,value$10627){return ["do",__lt____lt____colon__$8743(["assign",v$10626,value$10627],v$10626)];}),accum$10622)),({"finalize":false})))))),function(){if(((t0$10618 instanceof Array)&&((t1$10619=t0$10618.length),(t1$10619===3)))){(vars$10576=t0$10618[0]);(temps$10577=t0$10618[1]);(blocks$10578=t0$10618[2]);}else{throw Error("Mismatch");}}()),(all_temps$10523=all_temps$10523.concat(temps$10577)),function(){if(placeholder$10574){return vars$10576.push(placeholder$10574);}}(),((vars2$10579=({}))),(((temp$10639=vars$10576)),(((len$10644=temp$10639.length)),(((i$10649=0)),function(){$10636:for(;(i$10649<len$10644);(i$10649++)){var other$10673;var xxx$10667;var t0$10662;var t1$10663;var m$10657;(m$10657=temp$10639[i$10649]);;(t0$10662=m$10657);if(((t0$10662 instanceof Array)&&((t1$10663=t0$10662.length),((t1$10663===2)&&(t0$10662[0]==="symbol"))))){(xxx$10667=t0$10662[1]);(vars2$10579[xxx$10667]=true);}else{(other$10673=m$10657);throw τ61(["syntax","unexpected"]).create();}}}()))),(((bod$10676=function(){if(placeholder$10574){return parse_clauses$8763(expander$10516,scope$10517,placeholder$10574,τ64(["multi"])(body$10569)[1],opt$10520);}else{if(opt$10520.wrap){return opt$10520.wrap(body$10569);}else{return body$10569;}}}())),["clause",vars$10576,vars2$10579,blocks$10578,bod$10676])));}else{if((((x$10685=t0$10562)),((x$10685 instanceof Array)&&(x$10685[0]==="block")))){(b$10682=t0$10562);acc$10534.push(b$10682);}else{(other$10692=m$10557);acc$10534.push(function(){throw τ61(["syntax","clause"]).create("Illegal clause",({"clause":other$10692}));}());}}}}()))),acc$10534));;if(opt$10520.fallback){the_parts$10524.push(["block",opt$10520.fallback]);}(unique_temps$10525=iterkeys$8749(util$8744.set((((acc$10700=[])),(((temp$10705=all_temps$10523)),(((len$10710=temp$10705.length)),(((i$10715=0)),function(){$10698:for(;(i$10715<len$10710);(i$10715++)){var t$10733;var t0$10728;var t1$10729;var m$10723;(m$10723=temp$10705[i$10715]);;(t0$10728=m$10723);if(((t0$10728 instanceof Array)&&((t1$10729=t0$10728.length),((t1$10729===2)&&(t0$10728[0]==="symbol"))))){(t$10733=t0$10728[1]);acc$10700.push(t$10733);}else{false;;}}}()))),acc$10700))));;(decls$10741=(((acc$10746=[])),(((temp$10751=unique_temps$10525)),(((len$10756=temp$10751.length)),(((i$10761=0)),function(){$10744:for(;(i$10761<len$10756);(i$10761++)){var t$10777;var m$10769;(m$10769=temp$10751[i$10761]);;(t$10777=m$10769);acc$10746.push(["declare",["symbol",t$10777]]);}}()))),acc$10746));;return ["multi"].concat(decls$10741).concat([weave_clauses$8765(the_parts$10524)]);});;(opt_clauses$8764=function(clauses$10784){var i$10812;var len$10807;var temp$10802;var acc$10797;var i$10945;var len$10940;var temp$10935;var acc$10930;var i$10989;var len$10984;var temp$10979;var acc$10974;var i$11032;var len$11027;var temp$11022;var acc$11017;var shares$10787;var max$10788;var temps$10789;var shared_last$10790;var idx_last$10791;var new_clauses$10792;(shares$10787=(((acc$10797=[])),(((temp$10802=enumerate$8748(clauses$10784.slice(1)))),(((len$10807=temp$10802.length)),(((i$10812=0)),function(){$10795:for(;(i$10812<len$10807);(i$10812++)){var t0$10849;var t1$10850;var i$10874;var len$10869;var temp$10864;var varsd0$10844;var blocks0$10845;var share$10846;var idx$10847;var i$10832;var vars$10833;var varsd$10834;var blocks$10835;var body$10836;var t0$10825;var t1$10826;var t2$10827;var t3$10828;var m$10820;(m$10820=temp$10802[i$10812]);;(t0$10825=m$10820);if(((t0$10825 instanceof Array)&&((t1$10826=t0$10825.length),((t1$10826===2)&&((i$10832=t0$10825[0]),((t2$10827=t0$10825[1]),((t2$10827 instanceof Array)&&((t3$10828=t2$10827.length),((t3$10828===5)&&(t2$10827[0]==="clause")))))))))){(vars$10833=t2$10827[1]);(varsd$10834=t2$10827[2]);(blocks$10835=t2$10827[3]);(body$10836=t2$10827[4]);acc$10797.push((((t0$10849=τ59(clauses$10784,i$10832)),function(){if(((t0$10849 instanceof Array)&&((t1$10850=t0$10849.length),((t1$10850===5)&&(t0$10849[0]==="clause"))))){t0$10849[1];(varsd0$10844=t0$10849[2]);(blocks0$10845=t0$10849[3]);t0$10849[4];}else{throw Error("Mismatch");}}()),((share$10846=0)),((idx$10847=0)),(((temp$10864=blocks$10835)),(((len$10869=temp$10864.length)),(((i$10874=0)),function(){$10861:for(;(i$10874<len$10869);(i$10874++)){var x$10905;var x$10914;var other$10921;var m$10893$10895;var b$10890;var m$10882;(m$10882=temp$10864[i$10874]);;(b$10890=m$10882);if(same_block$8762([τ59(blocks0$10845,share$10846),b$10890],varsd0$10844,varsd$10834)){(share$10846++);(m$10893$10895=b$10890);;if((((x$10905=m$10893$10895)),((x$10905 instanceof Array)&&(x$10905[0]==="do")))){null;}else{if((((x$10914=m$10893$10895)),((x$10914 instanceof Array)&&(x$10914[0]==="check")))){(idx$10847=share$10846);}else{(other$10921=m$10893$10895);__lt____gt__$8741(null,other$10921);}}}else{break $10861;}}}()))),[share$10846,idx$10847]));}else{false;;}}}()))),acc$10797));;(max$10788=τ59(Math.max,(((acc$10930=[])),(((temp$10935=shares$10787)),(((len$10940=temp$10935.length)),(((i$10945=0)),function(){$10928:for(;(i$10945<len$10940);(i$10945++)){var x$10963;var t0$10958;var t1$10959;var m$10953;(m$10953=temp$10935[i$10945]);;(t0$10958=m$10953);if(((t0$10958 instanceof Array)&&((t1$10959=t0$10958.length),(t1$10959===2)))){(x$10963=t0$10958[0]);t0$10958[1];acc$10930.push(x$10963);}else{false;;}}}()))),acc$10930)));;shares$10787.push([0,0]);(temps$10789=(((acc$10974=[])),(((temp$10979=τ66(1,max$10788))),(((len$10984=temp$10979.length)),(((i$10989=0)),function(){$10972:for(;(i$10989<len$10984);(i$10989++)){var m$10997;(m$10997=temp$10979[i$10989]);;m$10997;acc$10974.push(["symbol",gensym$8746()]);}}()))),acc$10974));;(shared_last$10790=0);;(idx_last$10791=0);;(new_clauses$10792=(((acc$11017=[])),(((temp$11022=enumerate$8748(clauses$10784))),(((len$11027=temp$11022.length)),(((i$11032=0)),function(){$11015:for(;(i$11032<len$11027);(i$11032++)){var t0$11070;var t1$11071;var i$11105;var len$11100;var temp$11095;var acc$11090;var rest$11154;var newblocks$11150;var share$11064;var idx$11065;var shared$11066;var n_to_share$11067;var to_share$11068;var other$11161;var i$11052;var vars$11053;var varsd$11054;var blocks$11055;var body$11056;var t0$11045;var t1$11046;var t2$11047;var t3$11048;var m$11040;(m$11040=temp$11022[i$11032]);;(t0$11045=m$11040);if(((t0$11045 instanceof Array)&&((t1$11046=t0$11045.length),((t1$11046===2)&&((i$11052=t0$11045[0]),((t2$11047=t0$11045[1]),((t2$11047 instanceof Array)&&((t3$11048=t2$11047.length),((t3$11048===5)&&(t2$11047[0]==="clause")))))))))){(vars$11053=t2$11047[1]);(varsd$11054=t2$11047[2]);(blocks$11055=t2$11047[3]);(body$11056=t2$11047[4]);acc$11017.push((((t0$11070=τ59(shares$10787,i$11052)),function(){if(((t0$11070 instanceof Array)&&((t1$11071=t0$11070.length),(t1$11071===2)))){(share$11064=t0$11070[0]);(idx$11065=t0$11070[1]);}else{throw Error("Mismatch");}}()),((shared$11066=function(){if(idx_last$10791){return [["check",τ59(temps$10789,(idx_last$10791-1))]];}else{return [];}}())),((n_to_share$11067=Math.max(shared_last$10790,share$11064))),((to_share$11068=(((acc$11090=[])),(((temp$11095=enumerate$8748(blocks$11055.slice(shared_last$10790,n_to_share$11067)))),(((len$11100=temp$11095.length)),(((i$11105=0)),function(){$11084:for(;(i$11105<len$11100);(i$11105++)){var j$11139;var x$11140;var j$11129;var x$11130;var $11085$11123;var $11086$11124;var $11087$11125;var $11088$11126;var t0$11118;var t1$11119;var t2$11120;var t3$11121;var m$11113;(m$11113=temp$11095[i$11105]);;(t0$11118=m$11113);if((($11086$11124=(t0$11118 instanceof Array))&&((t1$11119=t0$11118.length),(($11088$11126=(t1$11119===2))&&((j$11129=t0$11118[0]),((t2$11120=t0$11118[1]),((t2$11120 instanceof Array)&&((t3$11121=t2$11120.length),((t3$11121===2)&&(t2$11120[0]==="check")))))))))){(x$11130=t2$11120[1]);acc$11090.push(["check",["assign",τ59(temps$10789,(shared_last$10790+j$11129)),x$11130]]);}else{if(($11088$11126&&((j$11139=t0$11118[0]),((t2$11120=t0$11118[1]),((t2$11120 instanceof Array)&&((t3$11121=t2$11120.length),((t3$11121===2)&&(t2$11120[0]==="do")))))))){(x$11140=t2$11120[1]);acc$11090.push(["do",x$11140]);}else{false;;}}}}()))),acc$11090))),(shared_last$10790=share$11064),(idx_last$10791=idx$11065),(((newblocks$11150=(((rest$11154=blocks$11055.slice(n_to_share$11067))),shared$11066.concat(to_share$11068).concat(rest$11154)))),["clause",vars$11053,varsd$11054,newblocks$11150,body$11056])));}else{(other$11161=m$11040);acc$11017.push(function(){throw τ61(["oops"]).create("what",({"value":other$11161}));}());}}}()))),acc$11017));;return [temps$10789,new_clauses$10792];});;(weave_clauses$8765=function(parts$11168){var i$11213;var len$11208;var temp$11203;var i$11377;var len$11372;var temp$11367;var acc$11362;var groups$11171;var reassemble$11172;var new_temps$11173;var helper$11174;(groups$11171=classify_contiguous$8752(parts$11168,function(temp$11177$11179){var t0$11183;var t1$11184;var cls$11181;(t0$11183=temp$11177$11179);if(((t0$11183 instanceof Array)&&((t1$11184=t0$11183.length),(t1$11184>=1)))){(cls$11181=t0$11183[0]);Array.prototype.slice.call(t0$11183,1);;}else{throw Error("Mismatch");}return cls$11181;}));;(reassemble$11172=[]);;(new_temps$11173=[]);;(temp$11203=groups$11171);;(len$11208=temp$11203.length);;(i$11213=0);;$11196:for(;(i$11213<len$11208);(i$11213++)){var t0$11243;var t1$11244;var ts$11240;var new_clauses$11241;var elems$11251;var elems$11235;var $11197$11229;var $11198$11230;var $11199$11231;var $11200$11232;var t0$11226;var t1$11227;var m$11221;(m$11221=temp$11203[i$11213]);;(t0$11226=m$11221);if((($11198$11230=(t0$11226 instanceof Array))&&((t1$11227=t0$11226.length),(($11200$11232=(t1$11227>=1))&&(t0$11226[0]==="clause"))))){(elems$11235=Array.prototype.slice.call(t0$11226,1));(t0$11243=opt_clauses$8764(elems$11235));if(((t0$11243 instanceof Array)&&((t1$11244=t0$11243.length),(t1$11244===2)))){(ts$11240=t0$11243[0]);(new_clauses$11241=t0$11243[1]);;}else{throw Error("Mismatch");}(new_temps$11173=new_temps$11173.concat(ts$11240));(reassemble$11172=reassemble$11172.concat(new_clauses$11241));}else{if(($11200$11232&&(t0$11226[0]==="block"))){(elems$11251=Array.prototype.slice.call(t0$11226,1));(reassemble$11172=reassemble$11172.concat(elems$11251));}else{false;;}}}(helper$11174=function(temp$11258$11260){var i$11338;var len$11333;var temp$11328;var acc$11323;var decls$11318;var vars$11310;var varsd$11311;var blocks$11312;var body$11313;var rest$11314;var body$11299;var rest$11300;var $11263$11286;var $11264$11287;var $11265$11288;var $11266$11289;var $11267$11290;var $11268$11291;var t0$11279;var t1$11280;var t2$11281;var t3$11282;var t4$11283;var t5$11284;var m$11262$11274;var ph$11269;(ph$11269=temp$11258$11260);;(m$11262$11274=ph$11269);;if((($11263$11286=(m$11262$11274 instanceof Array))&&((t0$11279=m$11262$11274.length),(t0$11279===0)))){return ["multi"];}else{if(($11263$11286&&(($11265$11288=(t0$11279>=1))&&((t1$11280=m$11262$11274[0]),(($11267$11290=(t1$11280 instanceof Array))&&((t2$11281=t1$11280.length),((t2$11281===2)&&((t1$11280[0]==="block")&&((t3$11282=τ64(["multi"])(t1$11280[1])),(t3$11282[0]&&((t4$11283=t3$11282[1]),((t5$11284=t4$11283.length),(t5$11284>=0))))))))))))){(body$11299=Array.prototype.slice.call(t4$11283,0));(rest$11300=Array.prototype.slice.call(m$11262$11274,1));return ["multi"].concat(body$11299).concat([helper$11174(rest$11300)]);}else{if(($11267$11290&&((t2$11281===5)&&(t1$11280[0]==="clause")))){(vars$11310=t1$11280[1]);(varsd$11311=t1$11280[2]);(blocks$11312=t1$11280[3]);(body$11313=t1$11280[4]);(rest$11314=Array.prototype.slice.call(m$11262$11274,1));(decls$11318=(((acc$11323=[])),(((temp$11328=vars$11310)),(((len$11333=temp$11328.length)),(((i$11338=0)),function(){$11321:for(;(i$11338<len$11333);(i$11338++)){var v$11354;var m$11346;(m$11346=temp$11328[i$11338]);;(v$11354=m$11346);acc$11323.push(["declare",v$11354]);}}()))),acc$11323));;return ["tagscope","back",["multi"].concat(decls$11318).concat([assemble_pattern$8758(blocks$11312,body$11313,["use","back",helper$11174(rest$11314)])])];}else{throw Error("mismatch!!");}}}});;return ["multi"].concat((((acc$11362=[])),(((temp$11367=new_temps$11173)),(((len$11372=temp$11367.length)),(((i$11377=0)),function(){$11360:for(;(i$11377<len$11372);(i$11377++)){var t$11393;var m$11385;(m$11385=temp$11367[i$11377]);;(t$11393=m$11385);acc$11362.push(["declare",t$11393]);}}()))),acc$11362)).concat([helper$11174(reassemble$11172)]);});;(exports["PatternParser"]=PatternParser$8755);(exports["PatternProcessor"]=PatternProcessor$8756);(exports["parse_clauses"]=parse_clauses$8763);(exports["parse_pattern"]=parse_pattern$8760);
