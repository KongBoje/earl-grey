var $16906=(function(type$16909){var f$16913;(f$16913=type$16909["::check"]);if((f$16913===(void 0))){return (function(value$16919){return (value$16919 instanceof type$16909);});}else{return (function(value$16923){return f$16913.call(type$16909,value$16923);});}});
var $16925=(function(dest$16928,values$16929){var k$16934;(k$16934=null);$16932:for(k$16934 in values$16929){if(values$16929.hasOwnProperty(k$16934)){(dest$16928[k$16934]=values$16929[k$16934]);}}return dest$16928;});
var $16942=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $16943=(function($16945$16948){var ph$16954;(ph$16954=$16945$16948);var $16950$16960;($16950$16960=ph$16954);var bridge$16952$16965;var x$16969;(bridge$16952$16965=$16950$16960);if((((typeof(bridge$16952$16965)==="string")&&((x$16969=bridge$16952$16965),true))||((typeof(bridge$16952$16965)==="number")&&((x$16969=bridge$16952$16965),true)))){return ["value",x$16969];}else{var other$16980;(other$16980=$16950$16960);return other$16980["::serialize_ast"]();}});
var $16982=(function(obj$16985){var results$16990;(results$16990=[]);var k$16995;(k$16995=null);$16989:for(k$16995 in obj$16985){if(Object.prototype.hasOwnProperty.call(obj$16985,k$16995)){results$16990.push([k$16995,$16942(obj$16985,k$16995)]);}}return results$16990;});
var $17251=(function(arr$17254){var results$17260;var l$17261;(results$17260=[]);(l$17261=arr$17254.length);var i$17270;(i$17270=0);$17259:for(;(i$17270<l$17261);(i$17270++)){results$17260.push([i$17270,$16942(arr$17254,i$17270)]);}return results$17260;});
var $17018=(function(){var $17019$17025;($17019$17025=(function(tags$17030){var it$0$17033;(it$0$17033=(function(){if((!$16906($17019$17025)(this))){return Object.create($17019$17025.prototype);}else{return this;}})());(it$0$17033["tags"]=tags$17030);return it$0$17033;}));($17019$17025.prototype["create"]=(function(){var it$0$17053;var self$17054;(it$0$17053=this);(self$17054=this);var $17051$17063;($17051$17063=arguments);var t0$17068;var message$17072;var args$17073;(t0$17068=$17051$17063.length);if((t0$17068>=0)){(message$17072=(function(){if((0>=t0$17068)){return "";}else{return $17051$17063[0];}})());(args$17073=Array.prototype.slice.call($17051$17063,1));var e$17086;(e$17086=Error(message$17072));(e$17086["::tags"]=it$0$17053.tags);(e$17086["args"]=args$17073);var temp$17102;(temp$17102=$17251(args$17073));var $length$17108;($length$17108=temp$17102.length);var $index$17114;($index$17114=0);$17087:for(;($index$17114<$length$17108);($index$17114++)){var m$17123;(m$17123=temp$17102[$index$17114]);var t0$17128;var t1$17129;var i$17133;var arg$17134;(t0$17128=m$17123);if(((t0$17128 instanceof Array)&&(((t1$17129=t0$17128.length)),(t1$17129===2)))){(i$17133=t0$17128[0]);(arg$17134=t0$17128[1]);(e$17086[i$17133]=arg$17134);}else{$16999(m$17123);}}(e$17086["length"]=args$17073.length);(e$17086["name"]=["E"].concat(it$0$17053.tags).join("."));return e$17086;}else{$16999($17051$17063);}}));($17019$17025.prototype["::check"]=(function(e$17164){var it$0$17168;var self$17169;(it$0$17168=this);(self$17169=this);var tags$17179;if(((!e$17164)||(!$16906(Error)(e$17164)))){return false;}(tags$17179=(e$17164["::tags"]||[]));var temp$17190;(temp$17190=it$0$17168.tags);var $length$17196;($length$17196=temp$17190.length);var $index$17202;($index$17202=0);$17180:for(;($index$17202<$length$17196);($index$17202++)){var m$17211;(m$17211=temp$17190[$index$17202]);var tag$17219;(tag$17219=m$17211);if((tags$17179.indexOf(tag$17219)===-1)){return false;}else{false;}}return true;}));($17019$17025.prototype["::deconstruct"]=(function(e$17228){var it$0$17232;var self$17233;(it$0$17232=this);(self$17233=this);return e$17228.args;}));$16925($17019$17025,$16925((function(){var accum$17244;(accum$17244=({}));(accum$17244["::name"]="$17019");return accum$17244;})(),(function(){var accum$17248;(accum$17248=({}));(accum$17248["::egclass"]=true);return accum$17248;})()));return $17019$17025;})();
var $16999=(function(value$17002,url$17003,start$17004,end$17005){var err$17009;(err$17009=$17018(["match"]).create("Could not find a match for value",({"value":value$17002})));if(url$17003){(err$17009["location"]=["location",url$17003,start$17004,end$17005]);}throw err$17009;});
var send$16551;var __array_methods$16552;var __re_methods$16553;(send$16551=(function(obj$16566,$16563$16567){var ph$16573;var msg$16574;var t0$16576;(t0$16576=$16563$16567);(msg$16574=t0$16576);(ph$16573=t0$16576);var $16569$16585;($16569$16585=ph$16573);var bridge$16571$16590;(bridge$16571$16590=$16569$16585);if(((typeof(bridge$16571$16590)==="string")||(typeof(bridge$16571$16590)==="number"))){return obj$16566[msg$16574];}else{var other$16602;(other$16602=$16569$16585);return obj$16566["::send"](msg$16574);}}));(Array[":::project"]=(function($16608$16611){var ph$16616;var value$16617;var t0$16619;(t0$16619=$16608$16611);(value$16617=t0$16619);(ph$16616=t0$16619);var $16613$16628;($16613$16628=ph$16616);if($16906(Array)($16613$16628)){return [true,value$16617];}else{$16613$16628;return [true,[value$16617]];}}));(__array_methods$16552=$16925((function(){var accum$16649;(accum$16649=({}));(accum$16649["::check"]=(function(value$16654){if((value$16654 instanceof Array)){var i$16660;(i$16660=0);$16657:for(;(i$16660<this.length);(i$16660++)){if(($16942(this,i$16660)!==$16942(value$16654,i$16660))){return false;}}return true;}else{return false;}}));return accum$16649;})(),$16925((function(){var accum$16669;(accum$16669=({}));(accum$16669["::clone"]=(function(){return $16925(this.slice(0),this);}));return accum$16669;})(),$16925((function(){var accum$16676;(accum$16676=({}));(accum$16676[":::project"]=(function(value$16681){if((value$16681 instanceof Array)){var i$16687;(i$16687=0);$16684:for(;(i$16687<this.length);(i$16687++)){if(($16942(this,i$16687)!==$16942(value$16681,i$16687))){return [true,this.concat([value$16681])];}}return [true,value$16681];}else{return [true,this.concat([value$16681])];}}));return accum$16676;})(),(function(){var accum$16696;(accum$16696=({}));(accum$16696["::serialize_ast"]=(function(){return ["array"].concat(this.map($16943));}));return accum$16696;})()))));var temp$16706;(temp$16706=$16982(__array_methods$16552));var $length$16712;($length$16712=temp$16706.length);var $index$16718;($index$16718=0);$16554:for(;($index$16718<$length$16712);($index$16718++)){var m$16727;(m$16727=temp$16706[$index$16718]);var t0$16732;var t1$16733;var k$16737;var v$16738;(t0$16732=m$16727);if(((t0$16732 instanceof Array)&&(((t1$16733=t0$16732.length)),(t1$16733===2)))){(k$16737=t0$16732[0]);(v$16738=t0$16732[1]);if((!$16942(Array.prototype,k$16737))){Object.defineProperty(Array.prototype,k$16737,({"enumerable":false,"value":v$16738}));}}else{$16999(m$16727);}}(__re_methods$16553=$16925((function(){var accum$16758;(accum$16758=({}));(accum$16758["::check"]=(function($16762$16765){var ph$16770;(ph$16770=$16762$16765);var $16767$16776;($16767$16776=ph$16770);var value$16784;if((typeof($16767$16776)==="string")){(value$16784=$16767$16776);if(value$16784.match(this)){return true;}else{return false;}}else{var other$16789;(other$16789=$16767$16776);return false;}}));return accum$16758;})(),(function(){var accum$16792;(accum$16792=({}));(accum$16792[":::project"]=(function($16796$16799){var ph$16804;(ph$16804=$16796$16799);var $16801$16810;($16801$16810=ph$16804);var value$16818;if((typeof($16801$16810)==="string")){(value$16818=$16801$16810);var $16821$16826;($16821$16826=value$16818.match(this));var m$16834;if(($16821$16826===null)){(m$16834=$16821$16826);return [false,null];}else{var m$16839;(m$16839=$16821$16826);return [true,m$16839];}}else{var other$16843;(other$16843=$16801$16810);return [false,null];}}));return accum$16792;})()));var temp$16849;(temp$16849=$16982(__re_methods$16553));var $length$16855;($length$16855=temp$16849.length);var $index$16861;($index$16861=0);$16557:for(;($index$16861<$length$16855);($index$16861++)){var m$16870;(m$16870=temp$16849[$index$16861]);var t0$16875;var t1$16876;var k$16880;var v$16881;(t0$16875=m$16870);if(((t0$16875 instanceof Array)&&(((t1$16876=t0$16875.length)),(t1$16876===2)))){(k$16880=t0$16875[0]);(v$16881=t0$16875[1]);if((!$16942(RegExp.prototype,k$16880))){Object.defineProperty(RegExp.prototype,k$16880,({"enumerable":false,"value":v$16881}));}}else{$16999(m$16870);}}if((!Function.prototype["::send"])){Object.defineProperty(Function.prototype,"::send",$16925(({"enumerable":false}),(function(){var accum$16899;(accum$16899=({}));(accum$16899["value"]=(function(args$16904){return this.apply(this,args$16904);}));return accum$16899;})()));}
var $21208=(function($21210$21213,key$21214){var ph$21222;(ph$21222=$21210$21213);var $21216$21228;($21216$21228=ph$21222);var bridge$21218$21233;(bridge$21218$21233=$21216$21228);if(((bridge$21218$21233===null)||(bridge$21218$21233===(void 0)))){return false;}else{var x$21245;if((typeof($21216$21228)==="string")){(x$21245=$21216$21228);return (key$21214 in String.prototype);}else{var x$21250;if((typeof($21216$21228)==="number")){(x$21250=$21216$21228);return (key$21214 in Number.prototype);}else{var x$21255;(x$21255=$21216$21228);return (key$21214 in x$21255);}}}});
var $21124=(function($21126$21129){var ph$21139;var x$21140;var t0$21142;(t0$21142=$21126$21129);(x$21140=t0$21142);(ph$21139=t0$21142);var $21131$21151;($21131$21151=ph$21139);var bridge$21133$21156;(bridge$21133$21156=$21131$21151);if(((function(){var bridge$21134$21166;(bridge$21134$21166=bridge$21133$21156);return ((function(){var bridge$21135$21173;(bridge$21135$21173=bridge$21134$21166);return ((bridge$21135$21173===(void 0))||(bridge$21135$21173===null));})()||(typeof(bridge$21134$21166)==="string"));})()||(typeof(bridge$21133$21156)==="number"))){return x$21140;}else{if($21208($21131$21151,"::clone")){$21131$21151["::clone"];return x$21140["::clone"]();}else{$21131$21151;if((Object.getPrototypeOf(x$21140)===Object.prototype)){var dest$21191;(dest$21191=({}));var k$21196;(k$21196=null);$21190:for(k$21196 in x$21140){if(Object.prototype.hasOwnProperty.call(x$21140,k$21196)){(dest$21191[k$21196]=x$21140[k$21196]);}}return dest$21191;}else{var other$21206;(other$21206=$21131$21151);throw $17018(["clone"]).create("Object cannot be cloned",({"obj":x$21140}));}}}});
var $21257=(function(a$21260,b$21261){var dest$21266;(dest$21266=$21124(a$21260));var k$21271;(k$21271=null);$21265:for(k$21271 in b$21261){if(Object.prototype.hasOwnProperty.call(b$21261,k$21271)){(dest$21266[k$21271]=b$21261[k$21271]);}}return dest$21266;});
var $21279=Object.keys;
var $21280=(function(type$21283){return (function(value$21287){var f$21291;(f$21291=type$21283[":::project"]);if((f$21291===(void 0))){(f$21291=type$21283["::project"]);if((f$21291===(void 0))){return [true,type$21283(value$21287)];}else{var rval$21304;(rval$21304=false);try{(rval$21304=[true,f$21291(value$21287)]);}catch(excv$21315){var e$21321;(e$21321=excv$21315);(rval$21304=[false,null]);}return rval$21304;}}else{return f$21291.call(type$21283,value$21287);}});});
var $21327=(function(xs$21330,ys$21331){var acc$21338;(acc$21338=[]);var temp$21344;(temp$21344=$17251(xs$21330));var $length$21350;($length$21350=temp$21344.length);var $index$21356;($index$21356=0);$21333:for(;($index$21356<$length$21350);($index$21356++)){var m$21365;(m$21365=temp$21344[$index$21356]);var t0$21370;var t1$21371;var i$21375;var x$21376;(t0$21370=m$21365);if(((t0$21370 instanceof Array)&&(((t1$21371=t0$21370.length)),(t1$21371===2)))){(i$21375=t0$21370[0]);(x$21376=t0$21370[1]);acc$21338.push([x$21376,$16942(ys$21331,i$21375)]);}else{$16999(m$21365);}}return acc$21338;});
var $21391=(function(from$21394,to$21395){var rval$21400;(rval$21400=[]);var i$21406;(i$21406=from$21394);$21399:for(;(i$21406<=to$21395);(i$21406++)){rval$21400.push(i$21406);}return rval$21400;});var accum$18272;var accum$18276;var accum$19061;var accum$19065;var $17279$17314;var __lt____gt__$17315;var $17280$17316;var __lt____lt____colon__$17317;var util$17318;var GenSym$17319;var gensym$17320;var neighbours$17321;var classify$17322;var classify_contiguous$17323;var identity$17324;var Body$17325;var $17282$17326;var checker_db$17327;var PatternParser$17328;var PatternProcessor$17329;var assemble_conditions$17330;var assemble_pattern$17331;var inject_below_uses$17332;var parse_pattern$17333;var checkall$17334;var same_block$17335;var parse_clauses$17336;var opt_clauses$17337;var weave_clauses$17338;($17279$17314=require("./pp"));(__lt____gt__$17315=$17279$17314["<>"]);($17280$17316=require("./location"));(__lt____lt____colon__$17317=$17280$17316["<<:"]);(util$17318=require("./util"));(GenSym$17319=util$17318.GenSym);(gensym$17320=util$17318.gensym);(neighbours$17321=util$17318.neighbours);(classify$17322=util$17318.classify);(classify_contiguous$17323=util$17318.classify_contiguous);(identity$17324=util$17318.identity);(Body$17325=util$17318.Body);($17282$17326=require("./expand"));(checker_db$17327=$17282$17326.checker_db);(PatternParser$17328=(function(scope$17385,pattern$17386,opt$17387){var tags$17403;var it$0$17390;(it$0$17390=(function(){if((!$16906(PatternParser$17328)(this))){return Object.create(PatternParser$17328.prototype);}else{return this;}})());(it$0$17390["opt"]=opt$17387);(it$0$17390["arguments"]=[]);(it$0$17390["vars"]=[]);(it$0$17390["specials"]=({}));(tags$17403=$21124((opt$17387.tags||({}))));(tags$17403["group_id"]=(tags$17403.group_id||gensym$17320("group")));(it$0$17390["pattern"]=it$0$17390.expand(scope$17385,pattern$17386,tags$17403,true,it$0$17390.opt.indexable));return it$0$17390;}));(PatternParser$17328.prototype["parse_specs"]=(function(scope$17427,specs$17428,tags$17429){var $index$17490;var $length$17484;var temp$17478;var acc$17472;var rest$17447;var has_defaults$17448;var rval$17449;var it$0$17433;var self$17434;(it$0$17433=this);(self$17434=this);(rest$17447=(void 0));(has_defaults$17448=false);(rval$17449=classify$17322("fw","bw","keys","defaults",(((acc$17472=[])),(((temp$17478=scope$17427.step_all(["pattern"],specs$17428))),((($length$17484=temp$17478.length)),((($index$17490=0)),(function(){$17458:for(;($index$17490<$length$17484);($index$17490++)){var v$17564;var v$17558;var variable$17546;var value$17547;var key$17539;var subp$17540;var key$17533;var variable$17513;var $17466$17507;var $17467$17508;var $17468$17509;var $17469$17510;var t0$17504;var t1$17505;var m$17499;(m$17499=temp$17478[$index$17490]);(t0$17504=m$17499);if((($17467$17508=(t0$17504 instanceof Array))&&(((t1$17505=t0$17504.length)),(($17469$17510=(t1$17505===2))&&(t0$17504[0]==="dynsplice"))))){(variable$17513=t0$17504[1]);acc$17472.push((((rest$17447=it$0$17433.expand(scope$17427,variable$17513,tags$17429))),["ignore"]));}else{if(($17469$17510&&(t0$17504[0]==="assoc"))){(key$17533=t0$17504[1]);acc$17472.push(["keys",[key$17533,it$0$17433.expand(scope$17427,key$17533,tags$17429)]]);}else{if(($17467$17508&&(($17469$17510=(t1$17505===3))&&(t0$17504[0]==="assoc")))){(key$17539=t0$17504[1]);(subp$17540=t0$17504[2]);acc$17472.push(["keys",[key$17539,it$0$17433.expand(scope$17427,subp$17540,tags$17429)]]);}else{if(($17469$17510&&(t0$17504[0]==="default"))){(variable$17546=t0$17504[1]);(value$17547=t0$17504[2]);acc$17472.push((((has_defaults$17448=true)),(function(){if(rest$17447){throw $17018(["syntax","pattern"]).create("No default arguments after rest arg.");}else{return ["defaults",[it$0$17433.expand(scope$17427,variable$17546,tags$17429),value$17547]];}})()));}else{(v$17558=m$17499);if(((rest$17447===(void 0))&&(!has_defaults$17448))){acc$17472.push(["fw",it$0$17433.expand(scope$17427,v$17558,tags$17429)]);}else{(v$17564=m$17499);acc$17472.push(["bw",it$0$17433.expand(scope$17427,v$17564,tags$17429)]);}}}}}}})()))),acc$17472)));(rval$17449["rest"]=rest$17447);return rval$17449;}));(PatternParser$17328.prototype["expand"]=(function(){var x$17664;var x$17674;var x$17703;var x$17709;var variable$17716;var variable$17733;var x$17773;var msg$17781;var msg$17797;var $index$17839;var $length$17833;var temp$17827;var acc$17821;var $index$17972;var $length$17966;var temp$17960;var acc$17954;var $index$18008;var $length$18002;var temp$17996;var t0$18083;var t1$18084;var t2$18085;var $index$18131;var $length$18125;var temp$18119;var acc$18113;var patts$18105;var canon$17869;var normalize$17870;var pps$17871;var vars$17872;var patt$18206;var msg$18252;var other$18248;var keys$18212;var fw$18185;var bw$18186;var defaults$18187;var rest$18188;var $18163$18182;var t0$18175;var t1$18176;var t2$18177;var t3$18178;var t4$18179;var t5$18180;var $18159$18170;var specs$18164;var other$18264;var mode$18258;var subp$18259;var args$18154;var xs$17861;var xs$17813;var x$17803;var f$17787;var arg$17788;var f$17762;var arguments$17763;var checker$17756;var subp$17757;var projector$17750;var subp$17751;var condition$17744;var subp$17745;var v$17739;var v$17722;var type$17681;var $17640$17655;var $17641$17656;var $17642$17657;var $17643$17658;var t0$17651;var bridge$17625$17652;var t1$17653;var $17620$17646;var expr$17613;var rval$17614;var scope$17599;var pattern$17600;var tags$17601;var toplevel$17602;var checked$17603;var t0$17595;var $17578$17590;var it$0$17580;var self$17581;(it$0$17580=this);(self$17581=this);($17578$17590=arguments);(t0$17595=$17578$17590.length);if(((t0$17595>=3)&&(t0$17595<=5))){(scope$17599=$17578$17590[0]);(pattern$17600=$17578$17590[1]);(tags$17601=$17578$17590[2]);(toplevel$17602=(function(){if((3>=t0$17595)){return false;}else{return $17578$17590[3];}})());(checked$17603=(function(){if((4>=t0$17595)){return false;}else{return $17578$17590[4];}})());(expr$17613=scope$17599.step(["pattern"],pattern$17600));(rval$17614=((($17620$17646=expr$17613)),(function(){if((((x$17664=$17620$17646)),((x$17664 instanceof Array)&&(x$17664[0]==="void")))){return ["check",checker_db$17327.null,["ignore"]];}else{if((((x$17674=$17620$17646)),((x$17674 instanceof Array)&&(x$17674[0]==="ignore")))){return expr$17613;}else{if((($17620$17646 instanceof Array)&&(((t0$17651=$17620$17646.length)),((t0$17651===2)&&($17620$17646[0]==="special"))))){(type$17681=$17620$17646[1]);(it$0$17580.specials[type$17681]=true);return expr$17613;}else{(bridge$17625$17652=$17620$17646);if(((((x$17703=bridge$17625$17652)),((x$17703 instanceof Array)&&(x$17703[0]==="symbol")))||(((x$17709=bridge$17625$17652)),((x$17709 instanceof Array)&&(x$17709[0]==="variable"))))){(variable$17716=$21257(expr$17613,tags$17601));it$0$17580.vars.push(variable$17716);return ["assign",variable$17716];}else{if((($17640$17655=($17620$17646 instanceof Array))&&(((t0$17651=$17620$17646.length)),(($17642$17657=(t0$17651===2))&&(($17643$17658=($17620$17646[0]==="value"))&&((v$17722=$17620$17646[1]),it$0$17580.opt.strings_as_variables)))))){(variable$17733=__lt____lt____colon__$17317($21257(["symbol",v$17722],tags$17601),expr$17613));it$0$17580.vars.push(variable$17733);return ["assign",variable$17733];}else{if($17643$17658){(v$17739=$17620$17646[1]);return ["check",checker_db$17327(v$17739),["ignore"]];}else{if(($17640$17655&&(($17642$17657=(t0$17651===3))&&($17620$17646[0]==="test")))){(condition$17744=$17620$17646[1]);(subp$17745=$17620$17646[2]);return ["test",condition$17744,it$0$17580.expand(scope$17599,subp$17745,tags$17601,toplevel$17602,false)];}else{if(($17642$17657&&($17620$17646[0]==="project"))){(projector$17750=$17620$17646[1]);(subp$17751=$17620$17646[2]);return ["project",projector$17750,it$0$17580.expand(scope$17599,subp$17751,tags$17601,toplevel$17602,true)];}else{if(($17642$17657&&($17620$17646[0]==="check"))){(checker$17756=$17620$17646[1]);(subp$17757=$17620$17646[2]);return ["check",checker$17756,it$0$17580.expand(scope$17599,subp$17757,tags$17601,toplevel$17602,true)];}else{if(($17642$17657&&(($17643$17658=($17620$17646[0]==="send"))&&((f$17762=$17620$17646[1]),(((t1$17653=$17620$17646[2])),(((x$17773=t1$17653)),((x$17773 instanceof Array)&&(x$17773[0]==="data")))))))){(arguments$17763=t1$17653);if(toplevel$17602){it$0$17580.arguments.unshift(arguments$17763);return it$0$17580.expand(scope$17599,f$17762,tags$17601,true,false);}else{(msg$17781="Function arguments can only be declared as a top level pattern.");throw $17018(["syntax","pattern"]).create(msg$17781,({"node":expr$17613,"arg":arguments$17763}));}}else{if($17643$17658){(f$17787=$17620$17646[1]);(arg$17788=$17620$17646[2]);return ["assign",expr$17613];}else{$17620$17646;if((!it$0$17580.opt.allow_nested)){(msg$17797="Nested patterns are not allowed here.");throw $17018(["syntax","pattern"]).create(msg$17797,({"node":expr$17613}));}else{if((($17640$17655=($17620$17646 instanceof Array))&&(((t0$17651=$17620$17646.length)),((t0$17651===2)&&($17620$17646[0]==="neg"))))){(x$17803=$17620$17646[1]);return ["neg",it$0$17580.expand(scope$17599,x$17803,tags$17601)];}else{if(($17640$17655&&(($17642$17657=(t0$17651>=1))&&($17620$17646[0]==="all")))){(xs$17813=Array.prototype.slice.call($17620$17646,1));return ["all"].concat((((acc$17821=[])),(((temp$17827=xs$17813)),((($length$17833=temp$17827.length)),((($index$17839=0)),(function(){$17816:for(;($index$17839<$length$17833);($index$17839++)){var x$17856;var m$17848;(m$17848=temp$17827[$index$17839]);(x$17856=m$17848);acc$17821.push(it$0$17580.expand(scope$17599,x$17856,tags$17601));}})()))),acc$17821));}else{if(($17642$17657&&($17620$17646[0]==="any"))){(xs$17861=Array.prototype.slice.call($17620$17646,1));(canon$17869=(function(all$17880){return all$17880.sort().join(",");}));(normalize$17870=(function(vars$17887){var $index$17912;var $length$17906;var temp$17900;var acc$17894;return canon$17869((((acc$17894=[])),(((temp$17900=vars$17887)),((($length$17906=temp$17900.length)),((($index$17912=0)),(function(){$17889:for(;($index$17912<$length$17906);($index$17912++)){var v$17931;var t0$17926;var t1$17927;var m$17921;(m$17921=temp$17900[$index$17912]);(t0$17926=m$17921);if(((t0$17926 instanceof Array)&&(((t1$17927=t0$17926.length)),((t1$17927===2)&&(t0$17926[0]==="symbol"))))){(v$17931=t0$17926[1]);acc$17894.push(v$17931);}else{$16999(m$17921,"/home/olivier/git/earl-grey/src/pattern.eg",3875,3913);}}})()))),acc$17894));}));(pps$17871=(((acc$17954=[])),(((temp$17960=xs$17861)),((($length$17966=temp$17960.length)),((($index$17972=0)),(function(){$17949:for(;($index$17972<$length$17966);($index$17972++)){var x$17989;var m$17981;(m$17981=temp$17960[$index$17972]);(x$17989=m$17981);acc$17954.push(PatternParser$17328(scope$17599,x$17989,$21257(it$0$17580.opt,({"tags":tags$17601}))));}})()))),acc$17954));(temp$17996=neighbours$17321(pps$17871));($length$18002=temp$17996.length);($index$18008=0);$17873:for(;($index$18008<$length$18002);($index$18008++)){var $index$18059;var $length$18053;var temp$18047;var pp1$18027;var pp2$18028;var t0$18022;var t1$18023;var m$18017;(m$18017=temp$17996[$index$18008]);(t0$18022=m$18017);if(((t0$18022 instanceof Array)&&(((t1$18023=t0$18022.length)),(t1$18023===2)))){(pp1$18027=t0$18022[0]);(pp2$18028=t0$18022[1]);(temp$18047=pps$17871);($length$18053=temp$18047.length);($index$18059=0);$18041:for(;($index$18059<$length$18053);($index$18059++)){var pp$18076;var m$18068;(m$18068=temp$18047[$index$18059]);(pp$18076=m$18068);normalize$17870(pp$18076.vars);}if((normalize$17870(pp1$18027.vars)!==normalize$17870(pp2$18028.vars))){throw $17018(["syntax","pattern"]).create("Both branches of 'or' must contain the same variables",({"vars1":__lt____lt____colon__$17317(pp1$18027.vars.sort(),pp1$18027.pattern),"vars2":__lt____lt____colon__$17317(pp2$18028.vars.sort(),pp2$18028.pattern)}));}if((canon$17869($21279(pp1$18027.specials))!==canon$17869($21279(pp2$18028.specials)))){throw $17018(["syntax","pattern"]).create("Both branches of 'or' must contain the same special tokens",({"special1":__lt____lt____colon__$17317($21279(pp1$18027.specials).sort(),pp1$18027.pattern),"special2":__lt____lt____colon__$17317($21279(pp2$18028.specials).sort(),pp2$18028.pattern)}));}}else{$16999(m$18017,"/home/olivier/git/earl-grey/src/pattern.eg",4005,4802);}}(t0$18083=pps$17871);if(((t0$18083 instanceof Array)&&(((t1$18084=t0$18083.length)),((t1$18084>=1)&&(((t2$18085=t0$18083[0])),$21208(t2$18085,"vars")))))){(vars$17872=t2$18085.vars);Array.prototype.slice.call(t0$18083,1);}else{$16999(pps$17871,"/home/olivier/git/earl-grey/src/pattern.eg",4819,4822);}(it$0$17580["vars"]=it$0$17580.vars.concat(vars$17872));(patts$18105=(((acc$18113=[])),(((temp$18119=pps$17871)),((($length$18125=temp$18119.length)),((($index$18131=0)),(function(){$18108:for(;($index$18131<$length$18125);($index$18131++)){var pp$18148;var m$18140;(m$18140=temp$18119[$index$18131]);(pp$18148=m$18140);acc$18113.push(pp$18148.pattern);}})()))),acc$18113));return ["any"].concat(patts$18105);}else{if(($17642$17657&&($17620$17646[0]==="data"))){(args$18154=Array.prototype.slice.call($17620$17646,1));(specs$18164=it$0$17580.parse_specs(scope$17599,args$18154,tags$17601));($18159$18170=specs$18164);if((($18163$18182=$21208($18159$18170,"keys"))&&(((t0$18175=$18159$18170.keys)),((t0$18175 instanceof Array)&&(((t1$18176=t0$18175.length)),((t1$18176===0)&&($21208($18159$18170,"fw")&&((fw$18185=$18159$18170.fw),($21208($18159$18170,"bw")&&((bw$18186=$18159$18170.bw),($21208($18159$18170,"defaults")&&((defaults$18187=$18159$18170.defaults),$21208($18159$18170,"rest"))))))))))))){(rest$18188=$18159$18170.rest);(patt$18206=__lt____lt____colon__$17317(["array_pattern",fw$18185,bw$18186,defaults$18187,rest$18188],pattern$17600));if(checked$17603){return patt$18206;}else{return ["check",checker_db$17327.Array,patt$18206];}}else{if(($18163$18182&&((keys$18212=$18159$18170.keys),($21208($18159$18170,"fw")&&(((t0$18175=$18159$18170.fw)),((t0$18175 instanceof Array)&&(((t1$18176=t0$18175.length)),((t1$18176===0)&&($21208($18159$18170,"bw")&&(((t2$18177=$18159$18170.bw)),((t2$18177 instanceof Array)&&(((t3$18178=t2$18177.length)),((t3$18178===0)&&($21208($18159$18170,"defaults")&&(((t4$18179=$18159$18170.defaults)),((t4$18179 instanceof Array)&&(((t5$18180=t4$18179.length)),((t5$18180===0)&&($21208($18159$18170,"rest")&&($18159$18170.rest===(void 0))))))))))))))))))))){return ["object_pattern"].concat(keys$18212);}else{(other$18248=$18159$18170);(msg$18252="Pattern must be an array or an object.");throw $17018(["syntax","pattern"]).create(msg$18252,({"node":expr$17613,"specs":specs$18164}));}}}else{if(($17640$17655&&((t0$17651===3)&&($17620$17646[0]==="mode")))){(mode$18258=$17620$17646[1]);(subp$18259=$17620$17646[2]);return it$0$17580.expand(scope$17599,subp$18259,$21257(tags$17601,({"declare_mode":mode$18258})),toplevel$17602,checked$17603);}else{(other$18264=$17620$17646);throw $17018(["syntax","pattern"]).create("Illegal pattern",({"node":other$18264}));}}}}}}}}}}}}}}}}}})()));return (it$0$17580.opt.wrap_pattern||identity$17324)(__lt____lt____colon__$17317(rval$17614,pattern$17600),toplevel$17602);}else{$16999($17578$17590);}}));$16925(PatternParser$17328,$16925(((accum$18272=({})),((accum$18272["::name"]="PatternParser"),accum$18272)),((accum$18276=({})),((accum$18276["::egclass"]=true),accum$18276))));PatternParser$17328;(PatternProcessor$17329=(function(){var it$0$18285;(it$0$18285=(function(){if((!$16906(PatternProcessor$17329)(this))){return Object.create(PatternProcessor$17329.prototype);}else{return this;}})());(it$0$18285["temps"]=[]);(it$0$18285["parts"]=[]);(it$0$18285["gen"]=GenSym$17319("t"));return it$0$18285;}));(PatternProcessor$17329.prototype["do"]=(function(part$18309){var it$0$18313;var self$18314;(it$0$18313=this);(self$18314=this);return it$0$18313.parts.push(["do",part$18309]);}));(PatternProcessor$17329.prototype["check"]=(function(){var part$18350;var tags$18351;var t0$18346;var $18329$18341;var it$0$18331;var self$18332;(it$0$18331=this);(self$18332=this);($18329$18341=arguments);(t0$18346=$18329$18341.length);if(((t0$18346>=1)&&(t0$18346<=2))){(part$18350=$18329$18341[0]);(tags$18351=(function(){if((1>=t0$18346)){return ({});}else{return $18329$18341[1];}})());return it$0$18331.parts.push($21257(["check",part$18350],tags$18351));}else{$16999($18329$18341);}}));(PatternProcessor$17329.prototype["temp"]=(function(){var x$18418;var x$18424;var init$18431;var bridge$18398$18407;var $18396$18402;var x$18388;var v$18389;var t0$18384;var $18367$18379;var it$0$18369;var self$18370;(it$0$18369=this);(self$18370=this);($18367$18379=arguments);(t0$18384=$18367$18379.length);if(((t0$18384>=1)&&(t0$18384<=2))){(x$18388=$18367$18379[0]);(v$18389=(function(){if((1>=t0$18384)){return null;}else{return $18367$18379[1];}})());($18396$18402=x$18388);(bridge$18398$18407=$18396$18402);if((((((x$18418=bridge$18398$18407)),((x$18418 instanceof Array)&&(x$18418[0]==="variable")))||(((x$18424=bridge$18398$18407)),((x$18424 instanceof Array)&&(x$18424[0]==="symbol"))))&&($21208($18396$18402,"single_assignment")&&($18396$18402.single_assignment&&(!v$18389))))){return x$18388;}else{(init$18431=$18396$18402);(v$18389=(v$18389||["symbol",it$0$18369.gen()]));(v$18389["single_assignment"]=true);it$0$18369.temps.push(v$18389);it$0$18369.do(["send",["symbol","="],["data",["send",["symbol","set"],v$18389],init$18431]]);return v$18389;}}else{$16999($18367$18379);}}));(PatternProcessor$17329.prototype["process"]=(function(pattern$18448,rhs$18449,fns$18450){var x$18503;var x$18537;var t$18550;var t$18562;var pp$18573;var $index$18606;var $length$18600;var temp$18594;var t$18584;var $index$18674;var $length$18668;var temp$18662;var acc$18656;var fn$18639;var parts$18640;var t$18632;var $index$18735;var $length$18729;var temp$18723;var acc$18717;var t$18708;var otherwise$18868;var $18846$18852;var $index$18885;var $length$18879;var temp$18873;var $index$18934;var $length$18928;var temp$18922;var end$18996;var pos$18990;var $index$19020;var $length$19014;var temp$19008;var acc$19002;var nfw$18801;var nbw$18802;var ndflt$18803;var extract_length$18804;var check_length$18805;var lo$18806;var hi$18807;var t$18808;var len$18809;var fw$18785;var bw$18786;var dflt$18787;var rest$18788;var subp$18703;var xs$18627;var xs$18579;var patt$18568;var projector$18556;var subp$18557;var checker$18544;var subp$18545;var checker$18532;var condition$18525;var subp$18526;var kind$18520;var sym$18510;var $18481$18494;var $18482$18495;var $18483$18496;var $18484$18497;var t0$18492;var $18468$18487;var rval$18465;var it$0$18454;var self$18455;(it$0$18454=this);(self$18455=this);(rval$18465=((($18468$18487=pattern$18448)),(function(){if((((x$18503=$18468$18487)),((x$18503 instanceof Array)&&(x$18503[0]==="ignore")))){return it$0$18454.do(rhs$18449);}else{if((($18481$18494=($18468$18487 instanceof Array))&&(((t0$18492=$18468$18487.length)),(($18483$18496=(t0$18492===2))&&($18468$18487[0]==="assign"))))){(sym$18510=$18468$18487[1]);return it$0$18454.parts.push(fns$18450.assign(sym$18510,rhs$18449));}else{if(($18483$18496&&($18468$18487[0]==="special"))){(kind$18520=$18468$18487[1]);return it$0$18454.process(fns$18450.special(pattern$18448,rhs$18449),rhs$18449,fns$18450);}else{if(($18481$18494&&(($18483$18496=(t0$18492===3))&&($18468$18487[0]==="test")))){(condition$18525=$18468$18487[1]);(subp$18526=$18468$18487[2]);it$0$18454.process(subp$18526,rhs$18449,fns$18450);return it$0$18454.check(condition$18525,({"test":true}));}else{if(($18483$18496&&(($18484$18497=($18468$18487[0]==="check"))&&((checker$18532=$18468$18487[1]),(((x$18537=$18468$18487[2])),((x$18537 instanceof Array)&&(x$18537[0]==="ignore"))))))){return it$0$18454.check(["send",checker$18532,["data",rhs$18449]]);}else{if($18484$18497){(checker$18544=$18468$18487[1]);(subp$18545=$18468$18487[2]);(t$18550=it$0$18454.temp(rhs$18449));it$0$18454.check(["send",checker$18544,["data",t$18550]]);return it$0$18454.process(subp$18545,t$18550,fns$18450);}else{if(($18483$18496&&($18468$18487[0]==="project"))){(projector$18556=$18468$18487[1]);(subp$18557=$18468$18487[2]);(t$18562=it$0$18454.temp(["send",projector$18556,["data",rhs$18449]]));it$0$18454.check(["send",t$18562,["value",0]]);return it$0$18454.process(subp$18557,["send",t$18562,["value",1]],fns$18450);}else{if(($18481$18494&&((t0$18492===2)&&($18468$18487[0]==="neg")))){(patt$18568=$18468$18487[1]);return it$0$18454.check(["send",["symbol","not"],["data",["void"],(((pp$18573=PatternProcessor$17329())),pp$18573.process(patt$18568,rhs$18449,fns$18450),assemble_conditions$17330(pp$18573))]]);}else{if(($18481$18494&&(($18483$18496=(t0$18492>=1))&&($18468$18487[0]==="all")))){(xs$18579=Array.prototype.slice.call($18468$18487,1));(t$18584=it$0$18454.temp(rhs$18449));(temp$18594=xs$18579);($length$18600=temp$18594.length);($index$18606=0);$18585:for(;($index$18606<$length$18600);($index$18606++)){var x$18623;var m$18615;(m$18615=temp$18594[$index$18606]);(x$18623=m$18615);it$0$18454.process(x$18623,t$18584,fns$18450);}return null;}else{if(($18483$18496&&($18468$18487[0]==="any"))){(xs$18627=Array.prototype.slice.call($18468$18487,1));(t$18632=it$0$18454.temp(rhs$18449,["symbol",gensym$17320("bridge")]));return it$0$18454.check((((fn$18639=(function(x$18645,rest$18646){return ["send",["symbol","or"],["data",x$18645,rest$18646]];}))),((parts$18640=(((acc$18656=[])),(((temp$18662=xs$18627)),((($length$18668=temp$18662.length)),((($index$18674=0)),(function(){$18651:for(;($index$18674<$length$18668);($index$18674++)){var pp$18696;var x$18691;var m$18683;(m$18683=temp$18662[$index$18674]);(x$18691=m$18683);acc$18656.push((((pp$18696=PatternProcessor$17329())),pp$18696.process(x$18691,t$18632,fns$18450),assemble_conditions$17330(pp$18696)));}})()))),acc$18656))),util$17318.construct(parts$18640,fn$18639,["symbol","false"])));}else{if(($18483$18496&&($18468$18487[0]==="object_pattern"))){(subp$18703=Array.prototype.slice.call($18468$18487,1));(t$18708=it$0$18454.temp(rhs$18449));(acc$18717=[]);(temp$18723=subp$18703);($length$18729=temp$18723.length);($index$18735=0);$18709:for(;($index$18735<$length$18729);($index$18735++)){var k$18756;var v$18757;var t0$18749;var t1$18750;var t2$18751;var t3$18752;var m$18744;(m$18744=temp$18723[$index$18735]);(t0$18749=m$18744);if(((t0$18749 instanceof Array)&&(((t1$18750=t0$18749.length)),((t1$18750===2)&&(((t2$18751=t0$18749[0])),((t2$18751 instanceof Array)&&(((t3$18752=t2$18751.length)),((t3$18752===2)&&(t2$18751[0]==="value"))))))))){(k$18756=t2$18751[1]);(v$18757=t0$18749[1]);acc$18717.push((it$0$18454.check(["send",["symbol","___hasprop"],["data",t$18708,["value",k$18756]]]),it$0$18454.process(v$18757,["send",t$18708,["value",k$18756]],fns$18450)));}else{$16999(m$18744,"/home/olivier/git/earl-grey/src/pattern.eg",8151,8283);}}return acc$18717;}else{if(($18481$18494&&((t0$18492===5)&&($18468$18487[0]==="array_pattern")))){(fw$18785=$18468$18487[1]);(bw$18786=$18468$18487[2]);(dflt$18787=$18468$18487[3]);(rest$18788=$18468$18487[4]);(nfw$18801=fw$18785.length);(nbw$18802=bw$18786.length);(ndflt$18803=dflt$18787.length);(extract_length$18804=true);(check_length$18805=true);(lo$18806=(nfw$18801+nbw$18802));(hi$18807=(lo$18806+ndflt$18803));(t$18808=it$0$18454.temp(rhs$18449));(len$18809=it$0$18454.temp(["send",t$18808,["send",["symbol","."],["data",["void"],["symbol","length"]]]]));it$0$18454.check(((($18846$18852=rest$18788)),(function(){if($18846$18852){return ["send",["symbol",">="],["data",len$18809,["value",lo$18806]]];}else{$18846$18852;if((lo$18806===hi$18807)){return ["send",["symbol","==="],["data",len$18809,["value",lo$18806]]];}else{(otherwise$18868=$18846$18852);return ["send",["symbol","and"],["data",["send",["symbol",">="],["data",len$18809,["value",lo$18806]]],["send",["symbol","<="],["data",len$18809,["value",hi$18807]]]]];}}})()));(temp$18873=$17251(fw$18785));($length$18879=temp$18873.length);($index$18885=0);$18810:for(;($index$18885<$length$18879);($index$18885++)){var i$18904;var m$18905;var t0$18899;var t1$18900;var m$18894;(m$18894=temp$18873[$index$18885]);(t0$18899=m$18894);if(((t0$18899 instanceof Array)&&(((t1$18900=t0$18899.length)),(t1$18900===2)))){(i$18904=t0$18899[0]);(m$18905=t0$18899[1]);it$0$18454.process(m$18905,["send",t$18808,["value",i$18904]],fns$18450);}else{$16999(m$18894,"/home/olivier/git/earl-grey/src/pattern.eg",9015,9101);}}(temp$18922=$17251(dflt$18787));($length$18928=temp$18922.length);($index$18934=0);$18813:for(;($index$18934<$length$18928);($index$18934++)){var idx$18982;var i$18955;var patt$18956;var value$18957;var t0$18948;var t1$18949;var t2$18950;var t3$18951;var m$18943;(m$18943=temp$18922[$index$18934]);(t0$18948=m$18943);if(((t0$18948 instanceof Array)&&(((t1$18949=t0$18948.length)),((t1$18949===2)&&((i$18955=t0$18948[0]),(((t2$18950=t0$18948[1])),((t2$18950 instanceof Array)&&(((t3$18951=t2$18950.length)),(t3$18951===2))))))))){(patt$18956=t2$18950[0]);(value$18957=t2$18950[1]);(idx$18982=(i$18955+nfw$18801));it$0$18454.process(patt$18956,["send",["symbol","if"],["data",["send",["symbol",">="],["data",["value",(idx$18982+nbw$18802)],len$18809]],value$18957,["send",t$18808,["value",idx$18982]]]],fns$18450);}else{$16999(m$18943,"/home/olivier/git/earl-grey/src/pattern.eg",9101,9270);}}if((rest$18788!==(void 0))){(pos$18990=(nfw$18801+ndflt$18803));(end$18996=(function(){if((nbw$18802>0)){return [["value",(-nbw$18802)]];}else{return [];}})());it$0$18454.process(rest$18788,["send",["send",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",t$18808,["value",pos$18990]].concat(end$18996)],fns$18450);}else{[];}(acc$19002=[]);(temp$19008=$17251(bw$18786));($length$19014=temp$19008.length);($index$19020=0);$18816:for(;($index$19020<$length$19014);($index$19020++)){var i$19039;var m$19040;var t0$19034;var t1$19035;var m$19029;(m$19029=temp$19008[$index$19020]);(t0$19034=m$19029);if(((t0$19034 instanceof Array)&&(((t1$19035=t0$19034.length)),(t1$19035===2)))){(i$19039=t0$19034[0]);(m$19040=t0$19034[1]);acc$19002.push(it$0$18454.process(m$19040,["send",["symbol","___js_fetch"],["data",t$18808,["send",["symbol","-"],["data",len$18809,["value",(nbw$18802-i$19039)]]]]],fns$18450));}else{$16999(m$19029,"/home/olivier/git/earl-grey/src/pattern.eg",9721,9872);}}return acc$19002;}else{$16999($18468$18487);}}}}}}}}}}}}})()));return rval$18465;}));$16925(PatternProcessor$17329,$16925(((accum$19061=({})),((accum$19061["::name"]="PatternProcessor"),accum$19061)),((accum$19065=({})),((accum$19065["::egclass"]=true),accum$19065))));PatternProcessor$17329;(assemble_conditions$17330=(function(pp$19072){var $index$19196;var $length$19190;var temp$19184;var acc$19178;var decls$19170;var construct$19076;(construct$19076=(function($19080$19083){var x$19151;var rest$19152;var x$19136;var x$19120;var rest$19121;var $19090$19107;var $19091$19108;var t0$19103;var t1$19104;var t2$19105;var $19085$19098;var ph$19092;(ph$19092=$19080$19083);($19085$19098=ph$19092);if((($19090$19107=($19085$19098 instanceof Array))&&(((t0$19103=$19085$19098.length)),(t0$19103===0)))){return ["value",true];}else{if(($19090$19107&&((t0$19103>=1)&&(((t1$19104=$19085$19098[0])),((t1$19104 instanceof Array)&&(((t2$19105=t1$19104.length)),((t2$19105===2)&&(t1$19104[0]==="do")))))))){(x$19120=t1$19104[1]);(rest$19121=Array.prototype.slice.call($19085$19098,1));return ["multi",x$19120,construct$19076(rest$19121)];}else{if(($19090$19107&&((t0$19103===1)&&(((t1$19104=$19085$19098[0])),((t1$19104 instanceof Array)&&(((t2$19105=t1$19104.length)),((t2$19105===2)&&(t1$19104[0]==="check")))))))){(x$19136=t1$19104[1]);return x$19136;}else{if(($19090$19107&&((t0$19103>=1)&&(((t1$19104=$19085$19098[0])),((t1$19104 instanceof Array)&&(((t2$19105=t1$19104.length)),((t2$19105===2)&&(t1$19104[0]==="check")))))))){(x$19151=t1$19104[1]);(rest$19152=Array.prototype.slice.call($19085$19098,1));return ["send",["symbol","and"],["data",x$19151,construct$19076(rest$19152)]];}else{$16999($19085$19098);}}}}}));if(pp$19072.temps.length){(decls$19170=(((acc$19178=[])),(((temp$19184=pp$19072.temps)),((($length$19190=temp$19184.length)),((($index$19196=0)),(function(){$19173:for(;($index$19196<$length$19190);($index$19196++)){var t$19213;var m$19205;(m$19205=temp$19184[$index$19196]);(t$19213=m$19205);acc$19178.push(["declare",t$19213]);}})()))),acc$19178));return ["multi"].concat(decls$19170).concat([construct$19076(pp$19072.parts)]);}else{return construct$19076(pp$19072.parts);}}));(assemble_pattern$17331=(function(){var $index$19285;var $length$19279;var temp$19273;var $index$19346;var $length$19340;var temp$19334;var test$19485;var lead$19248;var trail$19249;var construct$19250;var parts$19235;var t$19236;var f$19237;var t0$19231;var $19222$19226;($19222$19226=arguments);(t0$19231=$19222$19226.length);if(((t0$19231>=2)&&(t0$19231<=3))){(parts$19235=$19222$19226[0]);(t$19236=$19222$19226[1]);(f$19237=(function(){if((2>=t0$19231)){return null;}else{return $19222$19226[2];}})());(lead$19248=[]);(temp$19273=parts$19235.slice(0));($length$19279=temp$19273.length);($index$19285=0);$19251:for(;($index$19285<$length$19279);($index$19285++)){var x$19323;var x$19308;var $19255$19302;var $19256$19303;var $19257$19304;var $19258$19305;var t0$19299;var t1$19300;var m$19294;(m$19294=temp$19273[$index$19285]);(t0$19299=m$19294);if((($19256$19303=(t0$19299 instanceof Array))&&(((t1$19300=t0$19299.length)),(($19258$19305=(t1$19300===2))&&(t0$19299[0]==="do"))))){(x$19308=t0$19299[1]);lead$19248.push(x$19308);parts$19235.shift();}else{if(($19258$19305&&(t0$19299[0]==="check"))){(x$19323=t0$19299[1]);break $19251;}else{$16999(m$19294,"/home/olivier/git/earl-grey/src/pattern.eg",10333,10443);}}}(trail$19249=[]);(temp$19334=parts$19235.slice(0).reverse());($length$19340=temp$19334.length);($index$19346=0);$19259:for(;($index$19346<$length$19340);($index$19346++)){var x$19384;var x$19369;var $19263$19363;var $19264$19364;var $19265$19365;var $19266$19366;var t0$19360;var t1$19361;var m$19355;(m$19355=temp$19334[$index$19346]);(t0$19360=m$19355);if((($19264$19364=(t0$19360 instanceof Array))&&(((t1$19361=t0$19360.length)),(($19266$19366=(t1$19361===2))&&(t0$19360[0]==="do"))))){(x$19369=t0$19360[1]);trail$19249.unshift(x$19369);parts$19235.pop();}else{if(($19266$19366&&(t0$19360[0]==="check"))){(x$19384=t0$19360[1]);break $19259;}else{$16999(m$19355,"/home/olivier/git/earl-grey/src/pattern.eg",10457,10579);}}}(construct$19250=(function($19392$19395){var other$19480;var x$19464;var rest$19465;var x$19449;var x$19433;var rest$19434;var $19403$19420;var $19404$19421;var t0$19416;var t1$19417;var t2$19418;var $19397$19411;var ph$19405;(ph$19405=$19392$19395);($19397$19411=ph$19405);if((($19403$19420=($19397$19411 instanceof Array))&&(((t0$19416=$19397$19411.length)),(t0$19416===0)))){return ["value",true];}else{if(($19403$19420&&((t0$19416>=1)&&(((t1$19417=$19397$19411[0])),((t1$19417 instanceof Array)&&(((t2$19418=t1$19417.length)),((t2$19418===2)&&(t1$19417[0]==="do")))))))){(x$19433=t1$19417[1]);(rest$19434=Array.prototype.slice.call($19397$19411,1));return ["multi",x$19433,construct$19250(rest$19434)];}else{if(($19403$19420&&((t0$19416===1)&&(((t1$19417=$19397$19411[0])),((t1$19417 instanceof Array)&&(((t2$19418=t1$19417.length)),((t2$19418===2)&&(t1$19417[0]==="check")))))))){(x$19449=t1$19417[1]);return x$19449;}else{if(($19403$19420&&((t0$19416>=1)&&(((t1$19417=$19397$19411[0])),((t1$19417 instanceof Array)&&(((t2$19418=t1$19417.length)),((t2$19418===2)&&(t1$19417[0]==="check")))))))){(x$19464=t1$19417[1]);(rest$19465=Array.prototype.slice.call($19397$19411,1));return ["send",["symbol","and"],["data",x$19464,construct$19250(rest$19465)]];}else{(other$19480=$19397$19411);throw $17018(["oops"]).create("?!?",other$19480);}}}}}));if(parts$19235.length){(test$19485=construct$19250(parts$19235));return ["multi"].concat(lead$19248).concat([(function(){if(f$19237){return ["send",["symbol","if"],["data",test$19485,["multi"].concat(trail$19249).concat([t$19236]),f$19237]];}else{return ["send",["symbol","if"],["data",test$19485,["multi"].concat(trail$19249).concat([t$19236])]];}})()]);}else{return ["multi"].concat(lead$19248).concat(trail$19249).concat([t$19236]);}}else{$16999($19222$19226);}}));(inject_below_uses$17332=(function($19495$19498,fn$19499){var other$19530;var scope$19519;var x$19520;var t0$19515;var $19501$19510;var ph$19504;(ph$19504=$19495$19498);($19501$19510=ph$19504);if((($19501$19510 instanceof Array)&&(((t0$19515=$19501$19510.length)),((t0$19515===3)&&($19501$19510[0]==="use"))))){(scope$19519=$19501$19510[1]);(x$19520=$19501$19510[2]);return ["use",scope$19519,inject_below_uses$17332(x$19520,fn$19499)];}else{(other$19530=$19501$19510);return fn$19499(other$19530);}}));(parse_pattern$17333=(function(scope$19537,pattern$19538,rhs$19539,opt$19540){var t0$19554;var $index$19606;var $length$19600;var temp$19594;var acc$19588;var parse$19546;var target$19547;var proc$19548;(parse$19546=PatternParser$17328(scope$19537,pattern$19538,opt$19540));if(((!opt$19540.allow_arguments)&&parse$19546.arguments.length)){throw $17018(["syntax","pattern","arguments"]).create("Arguments cannot be declared in this pattern",({"args":parse$19546.arguments[0]}));}(t0$19554=$21280((opt$19540.wrap_target||identity$17324))((function(){if(parse$19546.arguments.length){return inject_below_uses$17332(rhs$19539,(function(x$19561){return util$17318.construct(parse$19546.arguments.concat([x$19561]),(function(args$19565,rest$19566){return ["send",["symbol","->"],["data",args$19565,rest$19566]];}));}));}else{return rhs$19539;}})()));if(t0$19554[0]){(target$19547=t0$19554[1]);}else{$16999((function(){if(parse$19546.arguments.length){return inject_below_uses$17332(rhs$19539,(function(x$19573){return util$17318.construct(parse$19546.arguments.concat([x$19573]),(function(args$19577,rest$19578){return ["send",["symbol","->"],["data",args$19577,rest$19578]];}));}));}else{return rhs$19539;}})(),"/home/olivier/git/earl-grey/src/pattern.eg",11979,12405);}(proc$19548=PatternProcessor$17329());proc$19548.process(parse$19546.pattern,target$19547,opt$19540);if(opt$19540.finalize){return ["splice"].concat(opt$19540.declare(scope$19537,parse$19546.vars)).concat([["multi"].concat((((acc$19588=[])),(((temp$19594=proc$19548.temps)),((($length$19600=temp$19594.length)),((($index$19606=0)),(function(){$19583:for(;($index$19606<$length$19600);($index$19606++)){var t$19623;var m$19615;(m$19615=temp$19594[$index$19606]);(t$19623=m$19615);acc$19588.push(["declare",t$19623]);}})()))),acc$19588)).concat([assemble_pattern$17331(proc$19548.parts,opt$19540.success(target$19547),opt$19540.failure(target$19547))])]);}else{return [parse$19546.vars,proc$19548.temps,proc$19548.parts];}}));(checkall$17334=["send","data","multi","assign","void","check","do"]);(same_block$17335=(function($19633$19636,ban1$19637,ban2$19638){var $index$19802;var $length$19796;var temp$19790;var other$19824;var type1$19763;var args1$19764;var type2$19765;var args2$19766;var m1$19746;var m2$19747;var v1$19729;var v2$19730;var s1$19712;var s2$19713;var v1$19680;var v2$19681;var $19647$19671;var $19648$19672;var $19649$19673;var $19650$19674;var $19651$19675;var $19652$19676;var $19653$19677;var t0$19665;var t1$19666;var t2$19667;var t3$19668;var t4$19669;var $19640$19660;var ph$19654;(ph$19654=$19633$19636);($19640$19660=ph$19654);if((($19647$19671=($19640$19660 instanceof Array))&&(((t0$19665=$19640$19660.length)),(($19649$19673=(t0$19665===2))&&(((t1$19666=$19640$19660[0])),(($19651$19675=(t1$19666 instanceof Array))&&(((t2$19667=t1$19666.length)),(($19653$19677=(t2$19667===2))&&((t1$19666[0]==="variable")&&((v1$19680=t1$19666[1]),(((t3$19668=$19640$19660[1])),((t3$19668 instanceof Array)&&(((t4$19669=t3$19668.length)),((t4$19669===2)&&(t3$19668[0]==="variable"))))))))))))))){(v2$19681=t3$19668[1]);return (v1$19680===v2$19681);}else{if(($19653$19677&&((t1$19666[0]==="symbol")&&((s1$19712=t1$19666[1]),(((t3$19668=$19640$19660[1])),((t3$19668 instanceof Array)&&(((t4$19669=t3$19668.length)),((t4$19669===2)&&(t3$19668[0]==="symbol"))))))))){(s2$19713=t3$19668[1]);return (((!$16942(ban1$19637,s1$19712))&&(!$16942(ban2$19638,s2$19713)))&&(s1$19712===s2$19713));}else{if(($19653$19677&&((t1$19666[0]==="value")&&((v1$19729=t1$19666[1]),(((t3$19668=$19640$19660[1])),((t3$19668 instanceof Array)&&(((t4$19669=t3$19668.length)),((t4$19669===2)&&(t3$19668[0]==="value"))))))))){(v2$19730=t3$19668[1]);return (v1$19729===v2$19730);}else{if(($19653$19677&&((t1$19666[0]==="macro")&&((m1$19746=t1$19666[1]),(((t3$19668=$19640$19660[1])),((t3$19668 instanceof Array)&&(((t4$19669=t3$19668.length)),((t4$19669===2)&&(t3$19668[0]==="macro"))))))))){(m2$19747=t3$19668[1]);return (m1$19746===m2$19747);}else{if(($19651$19675&&((t2$19667>=1)&&((type1$19763=t1$19666[0]),((args1$19764=Array.prototype.slice.call(t1$19666,1)),(((t3$19668=$19640$19660[1])),((t3$19668 instanceof Array)&&(((t4$19669=t3$19668.length)),((t4$19669>=1)&&((type2$19765=t3$19668[0]),((args2$19766=Array.prototype.slice.call(t3$19668,1)),(checkall$17334.indexOf(type1$19763)!==-1)))))))))))){if(((type1$19763===type2$19765)&&(args1$19764.length===args2$19766.length))){(temp$19790=$21327(args1$19764,args2$19766));($length$19796=temp$19790.length);($index$19802=0);$19784:for(;($index$19802<$length$19796);($index$19802++)){var pair$19819;var m$19811;(m$19811=temp$19790[$index$19802]);(pair$19819=m$19811);if((!same_block$17335(pair$19819,ban1$19637,ban2$19638))){return false;}}return true;}else{return false;}}else{(other$19824=$19640$19660);return false;}}}}}}));(parse_clauses$17336=(function(scope$19831,target$19832,stmts$19833,opt$19834){var $index$19874;var $length$19868;var temp$19862;var acc$19856;var $index$20120;var $length$20114;var temp$20108;var acc$20102;var $index$20183;var $length$20177;var temp$20171;var acc$20165;var decls$20157;var all_temps$19840;var the_parts$19841;var unique_temps$19842;(all_temps$19840=[]);(the_parts$19841=(((acc$19856=[])),(((temp$19862=scope$19831.step_all(["clause"],stmts$19833))),((($length$19868=temp$19862.length)),((($index$19874=0)),(function(){$19848:for(;($index$19874<$length$19868);($index$19874++)){var accum$19986;var accum$20004;var t0$19978;var t1$19979;var $index$20031;var $length$20025;var temp$20019;var bod$20072;var placeholder$19913;var special_fn$19914;var vars$19915;var temps$19916;var blocks$19917;var vars2$19918;var x$20082;var other$20090;var b$20078;var pattern$19894;var body$19895;var $19853$19891;var t0$19888;var t1$19889;var m$19883;(m$19883=temp$19862[$index$19874]);(t0$19888=m$19883);if(((t0$19888 instanceof Array)&&(((t1$19889=t0$19888.length)),((t1$19889===3)&&(t0$19888[0]==="clause"))))){(pattern$19894=t0$19888[1]);(body$19895=t0$19888[2]);acc$19856.push((((placeholder$19913=(void 0))),((special_fn$19914=(function($19929$19932,value$19933){var t0$19941;var t1$19942;var other$19974;var $19935$19957;var ph$19938;var expr$19939;(t0$19941=$19929$19932);if(((t0$19941 instanceof Array)&&(((t1$19942=t0$19941.length)),((t1$19942===2)&&(t0$19941[0]==="special"))))){(ph$19938=t0$19941[1]);(expr$19939=t0$19941);}else{$16999($19929$19932);}($19935$19957=ph$19938);if(($19935$19957==="match")){(placeholder$19913=__lt____lt____colon__$17317(["symbol",scope$19831.gensym("ph")],expr$19939));return ["assign",placeholder$19913];}else{(other$19974=$19935$19957);throw $17018(["syntax","pattern","special"]).create("Special token cannot be used here",({"special":expr$19939}));}}))),(((t0$19978=parse_pattern$17333(scope$19831,pattern$19894,target$19832,$21257(opt$19834,$16925(({"allow_arguments":false,"allow_nested":true,"special":special_fn$19914}),$16925(((accum$19986=({})),((accum$19986["assign"]=(function(v$19991,value$19992){return ["do",__lt____lt____colon__$17317(["assign",v$19991,value$19992],v$19991)];})),accum$19986)),({"finalize":false}))))))),(function(){if(((t0$19978 instanceof Array)&&(((t1$19979=t0$19978.length)),(t1$19979===3)))){(vars$19915=t0$19978[0]);(temps$19916=t0$19978[1]);(blocks$19917=t0$19978[2]);}else{return $16999(parse_pattern$17333(scope$19831,pattern$19894,target$19832,$21257(opt$19834,$16925(({"allow_arguments":false,"allow_nested":true,"special":special_fn$19914}),$16925(((accum$20004=({})),((accum$20004["assign"]=(function(v$20009,value$20010){return ["do",__lt____lt____colon__$17317(["assign",v$20009,value$20010],v$20009)];})),accum$20004)),({"finalize":false}))))),"/home/olivier/git/earl-grey/src/pattern.eg",14056,14390);}})()),(all_temps$19840=all_temps$19840.concat(temps$19916)),(function(){if(placeholder$19913){return vars$19915.push(placeholder$19913);}})(),((vars2$19918=({}))),(((temp$20019=vars$19915)),((($length$20025=temp$20019.length)),((($index$20031=0)),(function(){$19919:for(;($index$20031<$length$20025);($index$20031++)){var other$20068;var xxx$20050;var t0$20045;var t1$20046;var m$20040;(m$20040=temp$20019[$index$20031]);(t0$20045=m$20040);if(((t0$20045 instanceof Array)&&(((t1$20046=t0$20045.length)),((t1$20046===2)&&(t0$20045[0]==="symbol"))))){(xxx$20050=t0$20045[1]);(vars2$19918[xxx$20050]=true);}else{(other$20068=m$20040);throw $17018(["syntax","unexpected"]).create();}}})()))),(((bod$20072=(function(){if(placeholder$19913){return parse_clauses$17336(scope$19831,placeholder$19913,$21280(Body$17325)(body$19895)[1],opt$19834);}else{if(opt$19834.wrap){return opt$19834.wrap(body$19895);}else{return body$19895;}}})())),["clause",vars$19915,vars2$19918,blocks$19917,bod$20072])));}else{if((((x$20082=t0$19888)),((x$20082 instanceof Array)&&(x$20082[0]==="block")))){(b$20078=t0$19888);acc$19856.push(b$20078);}else{(other$20090=m$19883);acc$19856.push(function(){throw $17018(["syntax","clause"]).create("Illegal clause",({"clause":other$20090}));}());}}}})()))),acc$19856));if(opt$19834.fallback){the_parts$19841.push(["block",opt$19834.fallback(target$19832)]);}(unique_temps$19842=$21279(util$17318.mkset((((acc$20102=[])),(((temp$20108=all_temps$19840)),((($length$20114=temp$20108.length)),((($index$20120=0)),(function(){$20097:for(;($index$20120<$length$20114);($index$20120++)){var t$20139;var t0$20134;var t1$20135;var m$20129;(m$20129=temp$20108[$index$20120]);(t0$20134=m$20129);if(((t0$20134 instanceof Array)&&(((t1$20135=t0$20134.length)),((t1$20135===2)&&(t0$20134[0]==="symbol"))))){(t$20139=t0$20134[1]);acc$20102.push(t$20139);}else{$16999(m$20129,"/home/olivier/git/earl-grey/src/pattern.eg",15197,15227);}}})()))),acc$20102))));(decls$20157=(((acc$20165=[])),(((temp$20171=unique_temps$19842)),((($length$20177=temp$20171.length)),((($index$20183=0)),(function(){$20160:for(;($index$20183<$length$20177);($index$20183++)){var t$20200;var m$20192;(m$20192=temp$20171[$index$20183]);(t$20200=m$20192);acc$20165.push(["declare",$16925(["symbol",t$20200],({"mutable":true}))]);}})()))),acc$20165));return ["multi"].concat(decls$20157).concat([weave_clauses$17338(the_parts$19841)]);}));(opt_clauses$17337=(function(clauses$20209){var $index$20249;var $length$20243;var temp$20237;var acc$20231;var $index$20433;var $length$20427;var temp$20421;var acc$20415;var $index$20493;var $length$20487;var temp$20481;var acc$20475;var $index$20545;var $length$20539;var temp$20533;var acc$20527;var shares$20218;var max$20219;var temps$20220;var shared_last$20221;var idx_last$20222;var new_clauses$20223;(shares$20218=(((acc$20231=[])),(((temp$20237=$17251(clauses$20209.slice(1)))),((($length$20243=temp$20237.length)),((($index$20249=0)),(function(){$20226:for(;($index$20249<$length$20243);($index$20249++)){var t0$20310;var t1$20311;var $index$20345;var $length$20339;var temp$20333;var varsd0$20302;var blocks0$20303;var share$20304;var idx$20305;var i$20270;var vars$20271;var varsd$20272;var blocks$20273;var body$20274;var t0$20263;var t1$20264;var t2$20265;var t3$20266;var m$20258;(m$20258=temp$20237[$index$20249]);(t0$20263=m$20258);if(((t0$20263 instanceof Array)&&(((t1$20264=t0$20263.length)),((t1$20264===2)&&((i$20270=t0$20263[0]),(((t2$20265=t0$20263[1])),((t2$20265 instanceof Array)&&(((t3$20266=t2$20265.length)),((t3$20266===5)&&(t2$20265[0]==="clause")))))))))){(vars$20271=t2$20265[1]);(varsd$20272=t2$20265[2]);(blocks$20273=t2$20265[3]);(body$20274=t2$20265[4]);acc$20231.push(((((t0$20310=$16942(clauses$20209,i$20270))),(function(){if(((t0$20310 instanceof Array)&&(((t1$20311=t0$20310.length)),((t1$20311===5)&&(t0$20310[0]==="clause"))))){t0$20310[1];(varsd0$20302=t0$20310[2]);(blocks0$20303=t0$20310[3]);t0$20310[4];}else{return $16999($16942(clauses$20209,i$20270),"/home/olivier/git/earl-grey/src/pattern.eg",15520,15530);}})()),((share$20304=0)),((idx$20305=0)),(((temp$20333=blocks$20273)),((($length$20339=temp$20333.length)),((($index$20345=0)),(function(){$20306:for(;($index$20345<$length$20339);($index$20345++)){var x$20382;var x$20392;var other$20403;var $20365$20371;var b$20362;var m$20354;(m$20354=temp$20333[$index$20345]);(b$20362=m$20354);if(same_block$17335([$16942(blocks0$20303,share$20304),b$20362],varsd0$20302,varsd$20272)){(share$20304++);($20365$20371=b$20362);if((((x$20382=$20365$20371)),((x$20382 instanceof Array)&&(x$20382[0]==="do")))){null;}else{if((((x$20392=$20365$20371)),((x$20392 instanceof Array)&&(x$20392[0]==="check")))){(idx$20305=share$20304);}else{(other$20403=$20365$20371);__lt____gt__$17315(null,other$20403);}}}else{break $20306;}}})()))),[share$20304,idx$20305]));}else{$16999(m$20258,"/home/olivier/git/earl-grey/src/pattern.eg",15396,15924);}}})()))),acc$20231));(max$20219=$16942(Math.max,(((acc$20415=[])),(((temp$20421=shares$20218)),((($length$20427=temp$20421.length)),((($index$20433=0)),(function(){$20410:for(;($index$20433<$length$20427);($index$20433++)){var x$20452;var t0$20447;var t1$20448;var m$20442;(m$20442=temp$20421[$index$20433]);(t0$20447=m$20442);if(((t0$20447 instanceof Array)&&(((t1$20448=t0$20447.length)),(t1$20448===2)))){(x$20452=t0$20447[0]);t0$20447[1];acc$20415.push(x$20452);}else{$16999(m$20442,"/home/olivier/git/earl-grey/src/pattern.eg",15938,15963);}}})()))),acc$20415)));shares$20218.push([0,0]);(temps$20220=(((acc$20475=[])),(((temp$20481=$21391(1,max$20219))),((($length$20487=temp$20481.length)),((($index$20493=0)),(function(){$20470:for(;($index$20493<$length$20487);($index$20493++)){var m$20502;(m$20502=temp$20481[$index$20493]);m$20502;acc$20475.push(["symbol",gensym$17320()]);}})()))),acc$20475));(shared_last$20221=0);(idx_last$20222=0);(new_clauses$20223=(((acc$20527=[])),(((temp$20533=$17251(clauses$20209))),((($length$20539=temp$20533.length)),((($index$20545=0)),(function(){$20521:for(;($index$20545<$length$20539);($index$20545++)){var t0$20607;var t1$20608;var $index$20657;var $length$20651;var temp$20645;var acc$20639;var rest$20741;var newblocks$20736;var share$20601;var idx$20602;var shared$20603;var n_to_share$20604;var to_share$20605;var other$20748;var i$20566;var vars$20567;var varsd$20568;var blocks$20569;var body$20570;var t0$20559;var t1$20560;var t2$20561;var t3$20562;var m$20554;(m$20554=temp$20533[$index$20545]);(t0$20559=m$20554);if(((t0$20559 instanceof Array)&&(((t1$20560=t0$20559.length)),((t1$20560===2)&&((i$20566=t0$20559[0]),(((t2$20561=t0$20559[1])),((t2$20561 instanceof Array)&&(((t3$20562=t2$20561.length)),((t3$20562===5)&&(t2$20561[0]==="clause")))))))))){(vars$20567=t2$20561[1]);(varsd$20568=t2$20561[2]);(blocks$20569=t2$20561[3]);(body$20570=t2$20561[4]);acc$20527.push(((((t0$20607=$16942(shares$20218,i$20566))),(function(){if(((t0$20607 instanceof Array)&&(((t1$20608=t0$20607.length)),(t1$20608===2)))){(share$20601=t0$20607[0]);(idx$20602=t0$20607[1]);}else{return $16999($16942(shares$20218,i$20566),"/home/olivier/git/earl-grey/src/pattern.eg",16196,16205);}})()),((shared$20603=(function(){if(idx_last$20222){return [["check",$16942(temps$20220,(idx_last$20222-1))]];}else{return [];}})())),((n_to_share$20604=Math.max(shared_last$20221,share$20601))),((to_share$20605=(((acc$20639=[])),(((temp$20645=$17251(blocks$20569.slice(shared_last$20221,n_to_share$20604)))),((($length$20651=temp$20645.length)),((($index$20657=0)),(function(){$20629:for(;($index$20657<$length$20651);($index$20657++)){var j$20709;var x$20710;var j$20682;var x$20683;var $20633$20676;var $20634$20677;var $20635$20678;var $20636$20679;var t0$20671;var t1$20672;var t2$20673;var t3$20674;var m$20666;(m$20666=temp$20645[$index$20657]);(t0$20671=m$20666);if((($20634$20677=(t0$20671 instanceof Array))&&(((t1$20672=t0$20671.length)),(($20636$20679=(t1$20672===2))&&((j$20682=t0$20671[0]),(((t2$20673=t0$20671[1])),((t2$20673 instanceof Array)&&(((t3$20674=t2$20673.length)),((t3$20674===2)&&(t2$20673[0]==="check")))))))))){(x$20683=t2$20673[1]);acc$20639.push(["check",["assign",$16942(temps$20220,(shared_last$20221+j$20682)),x$20683]]);}else{if(($20636$20679&&((j$20709=t0$20671[0]),(((t2$20673=t0$20671[1])),((t2$20673 instanceof Array)&&(((t3$20674=t2$20673.length)),((t3$20674===2)&&(t2$20673[0]==="do")))))))){(x$20710=t2$20673[1]);acc$20639.push(["do",x$20710]);}else{$16999(m$20666,"/home/olivier/git/earl-grey/src/pattern.eg",16344,16515);}}}})()))),acc$20639))),((shared_last$20221=share$20601)),((idx_last$20222=idx$20602)),(((newblocks$20736=(((rest$20741=blocks$20569.slice(n_to_share$20604))),shared$20603.concat(to_share$20605).concat(rest$20741)))),["clause",vars$20567,varsd$20568,newblocks$20736,body$20570])));}else{(other$20748=m$20554);acc$20527.push(function(){throw $17018(["oops"]).create("what",({"value":other$20748}));}());}}})()))),acc$20527));return [temps$20220,new_clauses$20223];}));(weave_clauses$17338=(function(parts$20757){var $index$20822;var $length$20816;var temp$20810;var $index$21086;var $length$21080;var temp$21074;var acc$21068;var groups$20764;var reassemble$20765;var new_temps$20766;var helper$20767;(groups$20764=classify_contiguous$17323(parts$20757,(function($20779$20782){var t0$20786;var t1$20787;var cls$20784;(t0$20786=$20779$20782);if(((t0$20786 instanceof Array)&&(((t1$20787=t0$20786.length)),(t1$20787>=1)))){(cls$20784=t0$20786[0]);Array.prototype.slice.call(t0$20786,1);}else{$16999($20779$20782);}return cls$20784;})));(reassemble$20765=[]);(new_temps$20766=[]);(temp$20810=groups$20764);($length$20816=temp$20810.length);($index$20822=0);$20768:for(;($index$20822<$length$20816);($index$20822++)){var t0$20862;var t1$20863;var ts$20859;var new_clauses$20860;var elems$20878;var elems$20845;var $20772$20839;var $20773$20840;var $20774$20841;var $20775$20842;var t0$20836;var t1$20837;var m$20831;(m$20831=temp$20810[$index$20822]);(t0$20836=m$20831);if((($20773$20840=(t0$20836 instanceof Array))&&(((t1$20837=t0$20836.length)),(($20775$20842=(t1$20837>=1))&&(t0$20836[0]==="clause"))))){(elems$20845=Array.prototype.slice.call(t0$20836,1));(t0$20862=opt_clauses$17337(elems$20845));if(((t0$20862 instanceof Array)&&(((t1$20863=t0$20862.length)),(t1$20863===2)))){(ts$20859=t0$20862[0]);(new_clauses$20860=t0$20862[1]);}else{$16999(opt_clauses$17337(elems$20845),"/home/olivier/git/earl-grey/src/pattern.eg",17024,17042);}(new_temps$20766=new_temps$20766.concat(ts$20859));(reassemble$20765=reassemble$20765.concat(new_clauses$20860));}else{if(($20775$20842&&(t0$20836[0]==="block"))){(elems$20878=Array.prototype.slice.call(t0$20836,1));(reassemble$20765=reassemble$20765.concat(elems$20878));}else{$16999(m$20831,"/home/olivier/git/earl-grey/src/pattern.eg",16958,17163);}}}(helper$20767=(function($20886$20889){var $index$21002;var $length$20996;var temp$20990;var acc$20984;var decls$20976;var vars$20967;var varsd$20968;var blocks$20969;var body$20970;var rest$20971;var body$20936;var rest$20937;var $20895$20919;var $20896$20920;var $20897$20921;var $20898$20922;var $20899$20923;var $20900$20924;var t0$20912;var t1$20913;var t2$20914;var t3$20915;var t4$20916;var t5$20917;var $20891$20907;var ph$20901;(ph$20901=$20886$20889);($20891$20907=ph$20901);if((($20895$20919=($20891$20907 instanceof Array))&&(((t0$20912=$20891$20907.length)),(t0$20912===0)))){return ["multi"];}else{if(($20895$20919&&(($20897$20921=(t0$20912>=1))&&(((t1$20913=$20891$20907[0])),(($20899$20923=(t1$20913 instanceof Array))&&(((t2$20914=t1$20913.length)),((t2$20914===2)&&((t1$20913[0]==="block")&&(((t3$20915=$21280(Body$17325)(t1$20913[1]))),(t3$20915[0]&&(((t4$20916=t3$20915[1])),(((t5$20917=t4$20916.length)),(t5$20917>=0))))))))))))){(body$20936=Array.prototype.slice.call(t4$20916,0));(rest$20937=Array.prototype.slice.call($20891$20907,1));return ["multi"].concat(body$20936).concat([helper$20767(rest$20937)]);}else{if(($20899$20923&&((t2$20914===5)&&(t1$20913[0]==="clause")))){(vars$20967=t1$20913[1]);(varsd$20968=t1$20913[2]);(blocks$20969=t1$20913[3]);(body$20970=t1$20913[4]);(rest$20971=Array.prototype.slice.call($20891$20907,1));(decls$20976=(((acc$20984=[])),(((temp$20990=vars$20967)),((($length$20996=temp$20990.length)),((($index$21002=0)),(function(){$20979:for(;($index$21002<$length$20996);($index$21002++)){var bridge$21027$21035;var $21022$21030;var v$21019;var m$21011;(m$21011=temp$20990[$index$21002]);(v$21019=m$21011);acc$20984.push(((($21022$21030=v$21019.declare_mode)),(function(){if(($21022$21030==="set")){return ["splice"];}else{if(($21022$21030==="let")){return ["declare",$21257(v$21019,({"mutable":false}))];}else{if(($21022$21030==="var")){return ["declare",$21257(v$21019,({"mutable":true}))];}else{(bridge$21027$21035=$21022$21030);if(((bridge$21027$21035==="unqualified")||(bridge$21027$21035===(void 0)))){return ["declare",$21257(v$21019,({"mutable":false}))];}else{$16999($21022$21030);}}}}})()));}})()))),acc$20984));return ["tagscope","back",["multi"].concat(decls$20976).concat([assemble_pattern$17331(blocks$20969,body$20970,["use","back",helper$20767(rest$20971)])])];}else{$16999($20891$20907);}}}}));return ["multi"].concat((((acc$21068=[])),(((temp$21074=new_temps$20766)),((($length$21080=temp$21074.length)),((($index$21086=0)),(function(){$21063:for(;($index$21086<$length$21080);($index$21086++)){var t$21103;var m$21095;(m$21095=temp$21074[$index$21086]);(t$21103=m$21095);acc$21068.push(["declare",t$21103]);}})()))),acc$21068)).concat([helper$20767(reassemble$20765)]);}));(exports["PatternParser"]=PatternParser$17328);(exports["PatternProcessor"]=PatternProcessor$17329);(exports["parse_clauses"]=parse_clauses$17336);(exports["parse_pattern"]=parse_pattern$17333);
