var $16815=(function(type$16818){var f$16822;(f$16822=type$16818["::check"]);if((f$16822===(void 0))){return (function(value$16828){return (value$16828 instanceof type$16818);});}else{return (function(value$16832){return f$16822.call(type$16818,value$16832);});}});
var $16834=(function(dest$16837,values$16838){var k$16843;(k$16843=null);$16841:for(k$16843 in values$16838){if(values$16838.hasOwnProperty(k$16843)){(dest$16837[k$16843]=values$16838[k$16843]);}}return dest$16837;});
var $16851=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $16852=(function($16854$16857){var ph$16863;(ph$16863=$16854$16857);var $16859$16869;($16859$16869=ph$16863);var bridge$16861$16874;var x$16878;(bridge$16861$16874=$16859$16869);if((((typeof(bridge$16861$16874)==="string")&&((x$16878=bridge$16861$16874),true))||((typeof(bridge$16861$16874)==="number")&&((x$16878=bridge$16861$16874),true)))){return ["value",x$16878];}else{var other$16889;(other$16889=$16859$16869);return other$16889["::serialize_ast"]();}});
var $16891=(function(obj$16894){var results$16899;(results$16899=[]);var k$16904;(k$16904=null);$16898:for(k$16904 in obj$16894){if(Object.prototype.hasOwnProperty.call(obj$16894,k$16904)){results$16899.push([k$16904,$16851(obj$16894,k$16904)]);}}return results$16899;});
var $17160=(function(arr$17163){var results$17169;var l$17170;(results$17169=[]);(l$17170=arr$17163.length);var i$17179;(i$17179=0);$17168:for(;(i$17179<l$17170);(i$17179++)){results$17169.push([i$17179,$16851(arr$17163,i$17179)]);}return results$17169;});
var $16927=(function(){var $16928$16934;($16928$16934=(function(tags$16939){var it$0$16942;(it$0$16942=(function(){if((!$16815($16928$16934)(this))){return Object.create($16928$16934.prototype);}else{return this;}})());(it$0$16942["tags"]=tags$16939);return it$0$16942;}));($16928$16934.prototype["create"]=(function(){var it$0$16962;var self$16963;(it$0$16962=this);(self$16963=this);var $16960$16972;($16960$16972=arguments);var t0$16977;var message$16981;var args$16982;(t0$16977=$16960$16972.length);if((t0$16977>=0)){(message$16981=(function(){if((0>=t0$16977)){return "";}else{return $16960$16972[0];}})());(args$16982=Array.prototype.slice.call($16960$16972,1));var e$16995;(e$16995=Error(message$16981));(e$16995["::tags"]=it$0$16962.tags);(e$16995["args"]=args$16982);var temp$17011;(temp$17011=$17160(args$16982));var $length$17017;($length$17017=temp$17011.length);var $index$17023;($index$17023=0);$16996:for(;($index$17023<$length$17017);($index$17023++)){var m$17032;(m$17032=temp$17011[$index$17023]);var t0$17037;var t1$17038;var i$17042;var arg$17043;(t0$17037=m$17032);if(((t0$17037 instanceof Array)&&(((t1$17038=t0$17037.length)),(t1$17038===2)))){(i$17042=t0$17037[0]);(arg$17043=t0$17037[1]);(e$16995[i$17042]=arg$17043);}else{$16908(m$17032);}}(e$16995["length"]=args$16982.length);(e$16995["name"]=["E"].concat(it$0$16962.tags).join("."));return e$16995;}else{$16908($16960$16972);}}));($16928$16934.prototype["::check"]=(function(e$17073){var it$0$17077;var self$17078;(it$0$17077=this);(self$17078=this);var tags$17088;if(((!e$17073)||(!$16815(Error)(e$17073)))){return false;}(tags$17088=(e$17073["::tags"]||[]));var temp$17099;(temp$17099=it$0$17077.tags);var $length$17105;($length$17105=temp$17099.length);var $index$17111;($index$17111=0);$17089:for(;($index$17111<$length$17105);($index$17111++)){var m$17120;(m$17120=temp$17099[$index$17111]);var tag$17128;(tag$17128=m$17120);if((tags$17088.indexOf(tag$17128)===-1)){return false;}else{false;}}return true;}));($16928$16934.prototype["::deconstruct"]=(function(e$17137){var it$0$17141;var self$17142;(it$0$17141=this);(self$17142=this);return e$17137.args;}));$16834($16928$16934,$16834((function(){var accum$17153;(accum$17153=({}));(accum$17153["::name"]="$16928");return accum$17153;})(),(function(){var accum$17157;(accum$17157=({}));(accum$17157["::egclass"]=true);return accum$17157;})()));return $16928$16934;})();
var $16908=(function(value$16911,url$16912,start$16913,end$16914){var err$16918;(err$16918=$16927(["match"]).create("Could not find a match for value",({"value":value$16911})));if(url$16912){(err$16918["location"]=["location",url$16912,start$16913,end$16914]);}throw err$16918;});
var send$16460;var __array_methods$16461;var __re_methods$16462;(send$16460=(function(obj$16475,$16472$16476){var ph$16482;var msg$16483;var t0$16485;(t0$16485=$16472$16476);(msg$16483=t0$16485);(ph$16482=t0$16485);var $16478$16494;($16478$16494=ph$16482);var bridge$16480$16499;(bridge$16480$16499=$16478$16494);if(((typeof(bridge$16480$16499)==="string")||(typeof(bridge$16480$16499)==="number"))){return obj$16475[msg$16483];}else{var other$16511;(other$16511=$16478$16494);return obj$16475["::send"](msg$16483);}}));(Array[":::project"]=(function($16517$16520){var ph$16525;var value$16526;var t0$16528;(t0$16528=$16517$16520);(value$16526=t0$16528);(ph$16525=t0$16528);var $16522$16537;($16522$16537=ph$16525);if($16815(Array)($16522$16537)){return [true,value$16526];}else{$16522$16537;return [true,[value$16526]];}}));(__array_methods$16461=$16834((function(){var accum$16558;(accum$16558=({}));(accum$16558["::check"]=(function(value$16563){if((value$16563 instanceof Array)){var i$16569;(i$16569=0);$16566:for(;(i$16569<this.length);(i$16569++)){if(($16851(this,i$16569)!==$16851(value$16563,i$16569))){return false;}}return true;}else{return false;}}));return accum$16558;})(),$16834((function(){var accum$16578;(accum$16578=({}));(accum$16578["::clone"]=(function(){return $16834(this.slice(0),this);}));return accum$16578;})(),$16834((function(){var accum$16585;(accum$16585=({}));(accum$16585[":::project"]=(function(value$16590){if((value$16590 instanceof Array)){var i$16596;(i$16596=0);$16593:for(;(i$16596<this.length);(i$16596++)){if(($16851(this,i$16596)!==$16851(value$16590,i$16596))){return [true,this.concat([value$16590])];}}return [true,value$16590];}else{return [true,this.concat([value$16590])];}}));return accum$16585;})(),(function(){var accum$16605;(accum$16605=({}));(accum$16605["::serialize_ast"]=(function(){return ["array"].concat(this.map($16852));}));return accum$16605;})()))));var temp$16615;(temp$16615=$16891(__array_methods$16461));var $length$16621;($length$16621=temp$16615.length);var $index$16627;($index$16627=0);$16463:for(;($index$16627<$length$16621);($index$16627++)){var m$16636;(m$16636=temp$16615[$index$16627]);var t0$16641;var t1$16642;var k$16646;var v$16647;(t0$16641=m$16636);if(((t0$16641 instanceof Array)&&(((t1$16642=t0$16641.length)),(t1$16642===2)))){(k$16646=t0$16641[0]);(v$16647=t0$16641[1]);if((!$16851(Array.prototype,k$16646))){Object.defineProperty(Array.prototype,k$16646,({"enumerable":false,"value":v$16647}));}}else{$16908(m$16636);}}(__re_methods$16462=$16834((function(){var accum$16667;(accum$16667=({}));(accum$16667["::check"]=(function($16671$16674){var ph$16679;(ph$16679=$16671$16674);var $16676$16685;($16676$16685=ph$16679);var value$16693;if((typeof($16676$16685)==="string")){(value$16693=$16676$16685);if(value$16693.match(this)){return true;}else{return false;}}else{var other$16698;(other$16698=$16676$16685);return false;}}));return accum$16667;})(),(function(){var accum$16701;(accum$16701=({}));(accum$16701[":::project"]=(function($16705$16708){var ph$16713;(ph$16713=$16705$16708);var $16710$16719;($16710$16719=ph$16713);var value$16727;if((typeof($16710$16719)==="string")){(value$16727=$16710$16719);var $16730$16735;($16730$16735=value$16727.match(this));var m$16743;if(($16730$16735===null)){(m$16743=$16730$16735);return [false,null];}else{var m$16748;(m$16748=$16730$16735);return [true,m$16748];}}else{var other$16752;(other$16752=$16710$16719);return [false,null];}}));return accum$16701;})()));var temp$16758;(temp$16758=$16891(__re_methods$16462));var $length$16764;($length$16764=temp$16758.length);var $index$16770;($index$16770=0);$16466:for(;($index$16770<$length$16764);($index$16770++)){var m$16779;(m$16779=temp$16758[$index$16770]);var t0$16784;var t1$16785;var k$16789;var v$16790;(t0$16784=m$16779);if(((t0$16784 instanceof Array)&&(((t1$16785=t0$16784.length)),(t1$16785===2)))){(k$16789=t0$16784[0]);(v$16790=t0$16784[1]);if((!$16851(RegExp.prototype,k$16789))){Object.defineProperty(RegExp.prototype,k$16789,({"enumerable":false,"value":v$16790}));}}else{$16908(m$16779);}}if((!Function.prototype["::send"])){Object.defineProperty(Function.prototype,"::send",$16834(({"enumerable":false}),(function(){var accum$16808;(accum$16808=({}));(accum$16808["value"]=(function(args$16813){return this.apply(this,args$16813);}));return accum$16808;})()));}
var $21117=(function($21119$21122,key$21123){var ph$21131;(ph$21131=$21119$21122);var $21125$21137;($21125$21137=ph$21131);var bridge$21127$21142;(bridge$21127$21142=$21125$21137);if(((bridge$21127$21142===null)||(bridge$21127$21142===(void 0)))){return false;}else{var x$21154;if((typeof($21125$21137)==="string")){(x$21154=$21125$21137);return (key$21123 in String.prototype);}else{var x$21159;if((typeof($21125$21137)==="number")){(x$21159=$21125$21137);return (key$21123 in Number.prototype);}else{var x$21164;(x$21164=$21125$21137);return (key$21123 in x$21164);}}}});
var $21033=(function($21035$21038){var ph$21048;var x$21049;var t0$21051;(t0$21051=$21035$21038);(x$21049=t0$21051);(ph$21048=t0$21051);var $21040$21060;($21040$21060=ph$21048);var bridge$21042$21065;(bridge$21042$21065=$21040$21060);if(((function(){var bridge$21043$21075;(bridge$21043$21075=bridge$21042$21065);return ((function(){var bridge$21044$21082;(bridge$21044$21082=bridge$21043$21075);return ((bridge$21044$21082===(void 0))||(bridge$21044$21082===null));})()||(typeof(bridge$21043$21075)==="string"));})()||(typeof(bridge$21042$21065)==="number"))){return x$21049;}else{if($21117($21040$21060,"::clone")){$21040$21060["::clone"];return x$21049["::clone"]();}else{$21040$21060;if((Object.getPrototypeOf(x$21049)===Object.prototype)){var dest$21100;(dest$21100=({}));var k$21105;(k$21105=null);$21099:for(k$21105 in x$21049){if(Object.prototype.hasOwnProperty.call(x$21049,k$21105)){(dest$21100[k$21105]=x$21049[k$21105]);}}return dest$21100;}else{var other$21115;(other$21115=$21040$21060);throw $16927(["clone"]).create("Object cannot be cloned",({"obj":x$21049}));}}}});
var $21166=(function(a$21169,b$21170){var dest$21175;(dest$21175=$21033(a$21169));var k$21180;(k$21180=null);$21174:for(k$21180 in b$21170){if(Object.prototype.hasOwnProperty.call(b$21170,k$21180)){(dest$21175[k$21180]=b$21170[k$21180]);}}return dest$21175;});
var $21188=Object.keys;
var $21189=(function(type$21192){return (function(value$21196){var f$21200;(f$21200=type$21192[":::project"]);if((f$21200===(void 0))){(f$21200=type$21192["::project"]);if((f$21200===(void 0))){return [true,type$21192(value$21196)];}else{var rval$21213;(rval$21213=false);try{(rval$21213=[true,f$21200(value$21196)]);}catch(excv$21224){var e$21230;(e$21230=excv$21224);(rval$21213=[false,null]);}return rval$21213;}}else{return f$21200.call(type$21192,value$21196);}});});
var $21236=(function(xs$21239,ys$21240){var acc$21247;(acc$21247=[]);var temp$21253;(temp$21253=$17160(xs$21239));var $length$21259;($length$21259=temp$21253.length);var $index$21265;($index$21265=0);$21242:for(;($index$21265<$length$21259);($index$21265++)){var m$21274;(m$21274=temp$21253[$index$21265]);var t0$21279;var t1$21280;var i$21284;var x$21285;(t0$21279=m$21274);if(((t0$21279 instanceof Array)&&(((t1$21280=t0$21279.length)),(t1$21280===2)))){(i$21284=t0$21279[0]);(x$21285=t0$21279[1]);acc$21247.push([x$21285,$16851(ys$21240,i$21284)]);}else{$16908(m$21274);}}return acc$21247;});
var $21300=(function(from$21303,to$21304){var rval$21309;(rval$21309=[]);var i$21315;(i$21315=from$21303);$21308:for(;(i$21315<=to$21304);(i$21315++)){rval$21309.push(i$21315);}return rval$21309;});var accum$18181;var accum$18185;var accum$18970;var accum$18974;var $17188$17223;var __lt____gt__$17224;var $17189$17225;var __lt____lt____colon__$17226;var util$17227;var GenSym$17228;var gensym$17229;var neighbours$17230;var classify$17231;var classify_contiguous$17232;var identity$17233;var Body$17234;var $17191$17235;var checker_db$17236;var PatternParser$17237;var PatternProcessor$17238;var assemble_conditions$17239;var assemble_pattern$17240;var inject_below_uses$17241;var parse_pattern$17242;var checkall$17243;var same_block$17244;var parse_clauses$17245;var opt_clauses$17246;var weave_clauses$17247;($17188$17223=require("./pp"));(__lt____gt__$17224=$17188$17223["<>"]);($17189$17225=require("./location"));(__lt____lt____colon__$17226=$17189$17225["<<:"]);(util$17227=require("./util"));(GenSym$17228=util$17227.GenSym);(gensym$17229=util$17227.gensym);(neighbours$17230=util$17227.neighbours);(classify$17231=util$17227.classify);(classify_contiguous$17232=util$17227.classify_contiguous);(identity$17233=util$17227.identity);(Body$17234=util$17227.Body);($17191$17235=require("./expand"));(checker_db$17236=$17191$17235.checker_db);(PatternParser$17237=(function(scope$17294,pattern$17295,opt$17296){var tags$17312;var it$0$17299;(it$0$17299=(function(){if((!$16815(PatternParser$17237)(this))){return Object.create(PatternParser$17237.prototype);}else{return this;}})());(it$0$17299["opt"]=opt$17296);(it$0$17299["arguments"]=[]);(it$0$17299["vars"]=[]);(it$0$17299["specials"]=({}));(tags$17312=$21033((opt$17296.tags||({}))));(tags$17312["group_id"]=(tags$17312.group_id||gensym$17229("group")));(it$0$17299["pattern"]=it$0$17299.expand(scope$17294,pattern$17295,tags$17312,true,it$0$17299.opt.indexable));return it$0$17299;}));(PatternParser$17237.prototype["parse_specs"]=(function(scope$17336,specs$17337,tags$17338){var $index$17399;var $length$17393;var temp$17387;var acc$17381;var rest$17356;var has_defaults$17357;var rval$17358;var it$0$17342;var self$17343;(it$0$17342=this);(self$17343=this);(rest$17356=(void 0));(has_defaults$17357=false);(rval$17358=classify$17231("fw","bw","keys","defaults",(((acc$17381=[])),(((temp$17387=scope$17336.step_all(["pattern"],specs$17337))),((($length$17393=temp$17387.length)),((($index$17399=0)),(function(){$17367:for(;($index$17399<$length$17393);($index$17399++)){var v$17473;var v$17467;var variable$17455;var value$17456;var key$17448;var subp$17449;var key$17442;var variable$17422;var $17375$17416;var $17376$17417;var $17377$17418;var $17378$17419;var t0$17413;var t1$17414;var m$17408;(m$17408=temp$17387[$index$17399]);(t0$17413=m$17408);if((($17376$17417=(t0$17413 instanceof Array))&&(((t1$17414=t0$17413.length)),(($17378$17419=(t1$17414===2))&&(t0$17413[0]==="dynsplice"))))){(variable$17422=t0$17413[1]);acc$17381.push((((rest$17356=it$0$17342.expand(scope$17336,variable$17422,tags$17338))),["ignore"]));}else{if(($17378$17419&&(t0$17413[0]==="assoc"))){(key$17442=t0$17413[1]);acc$17381.push(["keys",[key$17442,it$0$17342.expand(scope$17336,key$17442,tags$17338)]]);}else{if(($17376$17417&&(($17378$17419=(t1$17414===3))&&(t0$17413[0]==="assoc")))){(key$17448=t0$17413[1]);(subp$17449=t0$17413[2]);acc$17381.push(["keys",[key$17448,it$0$17342.expand(scope$17336,subp$17449,tags$17338)]]);}else{if(($17378$17419&&(t0$17413[0]==="default"))){(variable$17455=t0$17413[1]);(value$17456=t0$17413[2]);acc$17381.push((((has_defaults$17357=true)),(function(){if(rest$17356){throw $16927(["syntax","pattern"]).create("No default arguments after rest arg.");}else{return ["defaults",[it$0$17342.expand(scope$17336,variable$17455,tags$17338),value$17456]];}})()));}else{(v$17467=m$17408);if(((rest$17356===(void 0))&&(!has_defaults$17357))){acc$17381.push(["fw",it$0$17342.expand(scope$17336,v$17467,tags$17338)]);}else{(v$17473=m$17408);acc$17381.push(["bw",it$0$17342.expand(scope$17336,v$17473,tags$17338)]);}}}}}}})()))),acc$17381)));(rval$17358["rest"]=rest$17356);return rval$17358;}));(PatternParser$17237.prototype["expand"]=(function(){var x$17573;var x$17583;var x$17612;var x$17618;var variable$17625;var variable$17642;var x$17682;var msg$17690;var msg$17706;var $index$17748;var $length$17742;var temp$17736;var acc$17730;var $index$17881;var $length$17875;var temp$17869;var acc$17863;var $index$17917;var $length$17911;var temp$17905;var t0$17992;var t1$17993;var t2$17994;var $index$18040;var $length$18034;var temp$18028;var acc$18022;var patts$18014;var canon$17778;var normalize$17779;var pps$17780;var vars$17781;var patt$18115;var msg$18161;var other$18157;var keys$18121;var fw$18094;var bw$18095;var defaults$18096;var rest$18097;var $18072$18091;var t0$18084;var t1$18085;var t2$18086;var t3$18087;var t4$18088;var t5$18089;var $18068$18079;var specs$18073;var other$18173;var mode$18167;var subp$18168;var args$18063;var xs$17770;var xs$17722;var x$17712;var f$17696;var arg$17697;var f$17671;var arguments$17672;var checker$17665;var subp$17666;var projector$17659;var subp$17660;var condition$17653;var subp$17654;var v$17648;var v$17631;var type$17590;var $17549$17564;var $17550$17565;var $17551$17566;var $17552$17567;var t0$17560;var bridge$17534$17561;var t1$17562;var $17529$17555;var expr$17522;var rval$17523;var scope$17508;var pattern$17509;var tags$17510;var toplevel$17511;var checked$17512;var t0$17504;var $17487$17499;var it$0$17489;var self$17490;(it$0$17489=this);(self$17490=this);($17487$17499=arguments);(t0$17504=$17487$17499.length);if(((t0$17504>=3)&&(t0$17504<=5))){(scope$17508=$17487$17499[0]);(pattern$17509=$17487$17499[1]);(tags$17510=$17487$17499[2]);(toplevel$17511=(function(){if((3>=t0$17504)){return false;}else{return $17487$17499[3];}})());(checked$17512=(function(){if((4>=t0$17504)){return false;}else{return $17487$17499[4];}})());(expr$17522=scope$17508.step(["pattern"],pattern$17509));(rval$17523=((($17529$17555=expr$17522)),(function(){if((((x$17573=$17529$17555)),((x$17573 instanceof Array)&&(x$17573[0]==="void")))){return ["check",checker_db$17236.null,["ignore"]];}else{if((((x$17583=$17529$17555)),((x$17583 instanceof Array)&&(x$17583[0]==="ignore")))){return expr$17522;}else{if((($17529$17555 instanceof Array)&&(((t0$17560=$17529$17555.length)),((t0$17560===2)&&($17529$17555[0]==="special"))))){(type$17590=$17529$17555[1]);(it$0$17489.specials[type$17590]=true);return expr$17522;}else{(bridge$17534$17561=$17529$17555);if(((((x$17612=bridge$17534$17561)),((x$17612 instanceof Array)&&(x$17612[0]==="symbol")))||(((x$17618=bridge$17534$17561)),((x$17618 instanceof Array)&&(x$17618[0]==="variable"))))){(variable$17625=$21166(expr$17522,tags$17510));it$0$17489.vars.push(variable$17625);return ["assign",variable$17625];}else{if((($17549$17564=($17529$17555 instanceof Array))&&(((t0$17560=$17529$17555.length)),(($17551$17566=(t0$17560===2))&&(($17552$17567=($17529$17555[0]==="value"))&&((v$17631=$17529$17555[1]),it$0$17489.opt.strings_as_variables)))))){(variable$17642=__lt____lt____colon__$17226($21166(["symbol",v$17631],tags$17510),expr$17522));it$0$17489.vars.push(variable$17642);return ["assign",variable$17642];}else{if($17552$17567){(v$17648=$17529$17555[1]);return ["check",checker_db$17236(v$17648),["ignore"]];}else{if(($17549$17564&&(($17551$17566=(t0$17560===3))&&($17529$17555[0]==="test")))){(condition$17653=$17529$17555[1]);(subp$17654=$17529$17555[2]);return ["test",condition$17653,it$0$17489.expand(scope$17508,subp$17654,tags$17510,toplevel$17511,false)];}else{if(($17551$17566&&($17529$17555[0]==="project"))){(projector$17659=$17529$17555[1]);(subp$17660=$17529$17555[2]);return ["project",projector$17659,it$0$17489.expand(scope$17508,subp$17660,tags$17510,toplevel$17511,true)];}else{if(($17551$17566&&($17529$17555[0]==="check"))){(checker$17665=$17529$17555[1]);(subp$17666=$17529$17555[2]);return ["check",checker$17665,it$0$17489.expand(scope$17508,subp$17666,tags$17510,toplevel$17511,true)];}else{if(($17551$17566&&(($17552$17567=($17529$17555[0]==="send"))&&((f$17671=$17529$17555[1]),(((t1$17562=$17529$17555[2])),(((x$17682=t1$17562)),((x$17682 instanceof Array)&&(x$17682[0]==="data")))))))){(arguments$17672=t1$17562);if(toplevel$17511){it$0$17489.arguments.unshift(arguments$17672);return it$0$17489.expand(scope$17508,f$17671,tags$17510,true,false);}else{(msg$17690="Function arguments can only be declared as a top level pattern.");throw $16927(["syntax","pattern"]).create(msg$17690,({"node":expr$17522,"arg":arguments$17672}));}}else{if($17552$17567){(f$17696=$17529$17555[1]);(arg$17697=$17529$17555[2]);return ["assign",expr$17522];}else{$17529$17555;if((!it$0$17489.opt.allow_nested)){(msg$17706="Nested patterns are not allowed here.");throw $16927(["syntax","pattern"]).create(msg$17706,({"node":expr$17522}));}else{if((($17549$17564=($17529$17555 instanceof Array))&&(((t0$17560=$17529$17555.length)),((t0$17560===2)&&($17529$17555[0]==="neg"))))){(x$17712=$17529$17555[1]);return ["neg",it$0$17489.expand(scope$17508,x$17712,tags$17510)];}else{if(($17549$17564&&(($17551$17566=(t0$17560>=1))&&($17529$17555[0]==="all")))){(xs$17722=Array.prototype.slice.call($17529$17555,1));return ["all"].concat((((acc$17730=[])),(((temp$17736=xs$17722)),((($length$17742=temp$17736.length)),((($index$17748=0)),(function(){$17725:for(;($index$17748<$length$17742);($index$17748++)){var x$17765;var m$17757;(m$17757=temp$17736[$index$17748]);(x$17765=m$17757);acc$17730.push(it$0$17489.expand(scope$17508,x$17765,tags$17510));}})()))),acc$17730));}else{if(($17551$17566&&($17529$17555[0]==="any"))){(xs$17770=Array.prototype.slice.call($17529$17555,1));(canon$17778=(function(all$17789){return all$17789.sort().join(",");}));(normalize$17779=(function(vars$17796){var $index$17821;var $length$17815;var temp$17809;var acc$17803;return canon$17778((((acc$17803=[])),(((temp$17809=vars$17796)),((($length$17815=temp$17809.length)),((($index$17821=0)),(function(){$17798:for(;($index$17821<$length$17815);($index$17821++)){var v$17840;var t0$17835;var t1$17836;var m$17830;(m$17830=temp$17809[$index$17821]);(t0$17835=m$17830);if(((t0$17835 instanceof Array)&&(((t1$17836=t0$17835.length)),((t1$17836===2)&&(t0$17835[0]==="symbol"))))){(v$17840=t0$17835[1]);acc$17803.push(v$17840);}else{$16908(m$17830,"/home/olivier/git/earl-grey/src/pattern.eg",3875,3913);}}})()))),acc$17803));}));(pps$17780=(((acc$17863=[])),(((temp$17869=xs$17770)),((($length$17875=temp$17869.length)),((($index$17881=0)),(function(){$17858:for(;($index$17881<$length$17875);($index$17881++)){var x$17898;var m$17890;(m$17890=temp$17869[$index$17881]);(x$17898=m$17890);acc$17863.push(PatternParser$17237(scope$17508,x$17898,$21166(it$0$17489.opt,({"tags":tags$17510}))));}})()))),acc$17863));(temp$17905=neighbours$17230(pps$17780));($length$17911=temp$17905.length);($index$17917=0);$17782:for(;($index$17917<$length$17911);($index$17917++)){var $index$17968;var $length$17962;var temp$17956;var pp1$17936;var pp2$17937;var t0$17931;var t1$17932;var m$17926;(m$17926=temp$17905[$index$17917]);(t0$17931=m$17926);if(((t0$17931 instanceof Array)&&(((t1$17932=t0$17931.length)),(t1$17932===2)))){(pp1$17936=t0$17931[0]);(pp2$17937=t0$17931[1]);(temp$17956=pps$17780);($length$17962=temp$17956.length);($index$17968=0);$17950:for(;($index$17968<$length$17962);($index$17968++)){var pp$17985;var m$17977;(m$17977=temp$17956[$index$17968]);(pp$17985=m$17977);normalize$17779(pp$17985.vars);}if((normalize$17779(pp1$17936.vars)!==normalize$17779(pp2$17937.vars))){throw $16927(["syntax","pattern"]).create("Both branches of 'or' must contain the same variables",({"vars1":__lt____lt____colon__$17226(pp1$17936.vars.sort(),pp1$17936.pattern),"vars2":__lt____lt____colon__$17226(pp2$17937.vars.sort(),pp2$17937.pattern)}));}if((canon$17778($21188(pp1$17936.specials))!==canon$17778($21188(pp2$17937.specials)))){throw $16927(["syntax","pattern"]).create("Both branches of 'or' must contain the same special tokens",({"special1":__lt____lt____colon__$17226($21188(pp1$17936.specials).sort(),pp1$17936.pattern),"special2":__lt____lt____colon__$17226($21188(pp2$17937.specials).sort(),pp2$17937.pattern)}));}}else{$16908(m$17926,"/home/olivier/git/earl-grey/src/pattern.eg",4005,4802);}}(t0$17992=pps$17780);if(((t0$17992 instanceof Array)&&(((t1$17993=t0$17992.length)),((t1$17993>=1)&&(((t2$17994=t0$17992[0])),$21117(t2$17994,"vars")))))){(vars$17781=t2$17994.vars);Array.prototype.slice.call(t0$17992,1);}else{$16908(pps$17780,"/home/olivier/git/earl-grey/src/pattern.eg",4819,4822);}(it$0$17489["vars"]=it$0$17489.vars.concat(vars$17781));(patts$18014=(((acc$18022=[])),(((temp$18028=pps$17780)),((($length$18034=temp$18028.length)),((($index$18040=0)),(function(){$18017:for(;($index$18040<$length$18034);($index$18040++)){var pp$18057;var m$18049;(m$18049=temp$18028[$index$18040]);(pp$18057=m$18049);acc$18022.push(pp$18057.pattern);}})()))),acc$18022));return ["any"].concat(patts$18014);}else{if(($17551$17566&&($17529$17555[0]==="data"))){(args$18063=Array.prototype.slice.call($17529$17555,1));(specs$18073=it$0$17489.parse_specs(scope$17508,args$18063,tags$17510));($18068$18079=specs$18073);if((($18072$18091=$21117($18068$18079,"keys"))&&(((t0$18084=$18068$18079.keys)),((t0$18084 instanceof Array)&&(((t1$18085=t0$18084.length)),((t1$18085===0)&&($21117($18068$18079,"fw")&&((fw$18094=$18068$18079.fw),($21117($18068$18079,"bw")&&((bw$18095=$18068$18079.bw),($21117($18068$18079,"defaults")&&((defaults$18096=$18068$18079.defaults),$21117($18068$18079,"rest"))))))))))))){(rest$18097=$18068$18079.rest);(patt$18115=__lt____lt____colon__$17226(["array_pattern",fw$18094,bw$18095,defaults$18096,rest$18097],pattern$17509));if(checked$17512){return patt$18115;}else{return ["check",checker_db$17236.Array,patt$18115];}}else{if(($18072$18091&&((keys$18121=$18068$18079.keys),($21117($18068$18079,"fw")&&(((t0$18084=$18068$18079.fw)),((t0$18084 instanceof Array)&&(((t1$18085=t0$18084.length)),((t1$18085===0)&&($21117($18068$18079,"bw")&&(((t2$18086=$18068$18079.bw)),((t2$18086 instanceof Array)&&(((t3$18087=t2$18086.length)),((t3$18087===0)&&($21117($18068$18079,"defaults")&&(((t4$18088=$18068$18079.defaults)),((t4$18088 instanceof Array)&&(((t5$18089=t4$18088.length)),((t5$18089===0)&&($21117($18068$18079,"rest")&&($18068$18079.rest===(void 0))))))))))))))))))))){return ["object_pattern"].concat(keys$18121);}else{(other$18157=$18068$18079);(msg$18161="Pattern must be an array or an object.");throw $16927(["syntax","pattern"]).create(msg$18161,({"node":expr$17522,"specs":specs$18073}));}}}else{if(($17549$17564&&((t0$17560===3)&&($17529$17555[0]==="mode")))){(mode$18167=$17529$17555[1]);(subp$18168=$17529$17555[2]);return it$0$17489.expand(scope$17508,subp$18168,$21166(tags$17510,({"declare_mode":mode$18167})),toplevel$17511,checked$17512);}else{(other$18173=$17529$17555);throw $16927(["syntax","pattern"]).create("Illegal pattern",({"node":other$18173}));}}}}}}}}}}}}}}}}}})()));return (it$0$17489.opt.wrap_pattern||identity$17233)(__lt____lt____colon__$17226(rval$17523,pattern$17509),toplevel$17511);}else{$16908($17487$17499);}}));$16834(PatternParser$17237,$16834(((accum$18181=({})),((accum$18181["::name"]="PatternParser"),accum$18181)),((accum$18185=({})),((accum$18185["::egclass"]=true),accum$18185))));PatternParser$17237;(PatternProcessor$17238=(function(){var it$0$18194;(it$0$18194=(function(){if((!$16815(PatternProcessor$17238)(this))){return Object.create(PatternProcessor$17238.prototype);}else{return this;}})());(it$0$18194["temps"]=[]);(it$0$18194["parts"]=[]);(it$0$18194["gen"]=GenSym$17228("t"));return it$0$18194;}));(PatternProcessor$17238.prototype["do"]=(function(part$18218){var it$0$18222;var self$18223;(it$0$18222=this);(self$18223=this);return it$0$18222.parts.push(["do",part$18218]);}));(PatternProcessor$17238.prototype["check"]=(function(){var part$18259;var tags$18260;var t0$18255;var $18238$18250;var it$0$18240;var self$18241;(it$0$18240=this);(self$18241=this);($18238$18250=arguments);(t0$18255=$18238$18250.length);if(((t0$18255>=1)&&(t0$18255<=2))){(part$18259=$18238$18250[0]);(tags$18260=(function(){if((1>=t0$18255)){return ({});}else{return $18238$18250[1];}})());return it$0$18240.parts.push($21166(["check",part$18259],tags$18260));}else{$16908($18238$18250);}}));(PatternProcessor$17238.prototype["temp"]=(function(){var x$18327;var x$18333;var init$18340;var bridge$18307$18316;var $18305$18311;var x$18297;var v$18298;var t0$18293;var $18276$18288;var it$0$18278;var self$18279;(it$0$18278=this);(self$18279=this);($18276$18288=arguments);(t0$18293=$18276$18288.length);if(((t0$18293>=1)&&(t0$18293<=2))){(x$18297=$18276$18288[0]);(v$18298=(function(){if((1>=t0$18293)){return null;}else{return $18276$18288[1];}})());($18305$18311=x$18297);(bridge$18307$18316=$18305$18311);if((((((x$18327=bridge$18307$18316)),((x$18327 instanceof Array)&&(x$18327[0]==="variable")))||(((x$18333=bridge$18307$18316)),((x$18333 instanceof Array)&&(x$18333[0]==="symbol"))))&&($21117($18305$18311,"single_assignment")&&($18305$18311.single_assignment&&(!v$18298))))){return x$18297;}else{(init$18340=$18305$18311);(v$18298=(v$18298||["symbol",it$0$18278.gen()]));(v$18298["single_assignment"]=true);it$0$18278.temps.push(v$18298);it$0$18278.do(["send",["symbol","="],["data",["send",["symbol","set"],v$18298],init$18340]]);return v$18298;}}else{$16908($18276$18288);}}));(PatternProcessor$17238.prototype["process"]=(function(pattern$18357,rhs$18358,fns$18359){var x$18412;var x$18446;var t$18459;var t$18471;var pp$18482;var $index$18515;var $length$18509;var temp$18503;var t$18493;var $index$18583;var $length$18577;var temp$18571;var acc$18565;var fn$18548;var parts$18549;var t$18541;var $index$18644;var $length$18638;var temp$18632;var acc$18626;var t$18617;var otherwise$18777;var $18755$18761;var $index$18794;var $length$18788;var temp$18782;var $index$18843;var $length$18837;var temp$18831;var end$18905;var pos$18899;var $index$18929;var $length$18923;var temp$18917;var acc$18911;var nfw$18710;var nbw$18711;var ndflt$18712;var extract_length$18713;var check_length$18714;var lo$18715;var hi$18716;var t$18717;var len$18718;var fw$18694;var bw$18695;var dflt$18696;var rest$18697;var subp$18612;var xs$18536;var xs$18488;var patt$18477;var projector$18465;var subp$18466;var checker$18453;var subp$18454;var checker$18441;var condition$18434;var subp$18435;var kind$18429;var sym$18419;var $18390$18403;var $18391$18404;var $18392$18405;var $18393$18406;var t0$18401;var $18377$18396;var rval$18374;var it$0$18363;var self$18364;(it$0$18363=this);(self$18364=this);(rval$18374=((($18377$18396=pattern$18357)),(function(){if((((x$18412=$18377$18396)),((x$18412 instanceof Array)&&(x$18412[0]==="ignore")))){return it$0$18363.do(rhs$18358);}else{if((($18390$18403=($18377$18396 instanceof Array))&&(((t0$18401=$18377$18396.length)),(($18392$18405=(t0$18401===2))&&($18377$18396[0]==="assign"))))){(sym$18419=$18377$18396[1]);return it$0$18363.parts.push(fns$18359.assign(sym$18419,rhs$18358));}else{if(($18392$18405&&($18377$18396[0]==="special"))){(kind$18429=$18377$18396[1]);return it$0$18363.process(fns$18359.special(pattern$18357,rhs$18358),rhs$18358,fns$18359);}else{if(($18390$18403&&(($18392$18405=(t0$18401===3))&&($18377$18396[0]==="test")))){(condition$18434=$18377$18396[1]);(subp$18435=$18377$18396[2]);it$0$18363.process(subp$18435,rhs$18358,fns$18359);return it$0$18363.check(condition$18434,({"test":true}));}else{if(($18392$18405&&(($18393$18406=($18377$18396[0]==="check"))&&((checker$18441=$18377$18396[1]),(((x$18446=$18377$18396[2])),((x$18446 instanceof Array)&&(x$18446[0]==="ignore"))))))){return it$0$18363.check(["send",checker$18441,["data",rhs$18358]]);}else{if($18393$18406){(checker$18453=$18377$18396[1]);(subp$18454=$18377$18396[2]);(t$18459=it$0$18363.temp(rhs$18358));it$0$18363.check(["send",checker$18453,["data",t$18459]]);return it$0$18363.process(subp$18454,t$18459,fns$18359);}else{if(($18392$18405&&($18377$18396[0]==="project"))){(projector$18465=$18377$18396[1]);(subp$18466=$18377$18396[2]);(t$18471=it$0$18363.temp(["send",projector$18465,["data",rhs$18358]]));it$0$18363.check(["send",t$18471,["value",0]]);return it$0$18363.process(subp$18466,["send",t$18471,["value",1]],fns$18359);}else{if(($18390$18403&&((t0$18401===2)&&($18377$18396[0]==="neg")))){(patt$18477=$18377$18396[1]);return it$0$18363.check(["send",["symbol","not"],["data",["void"],(((pp$18482=PatternProcessor$17238())),pp$18482.process(patt$18477,rhs$18358,fns$18359),assemble_conditions$17239(pp$18482))]]);}else{if(($18390$18403&&(($18392$18405=(t0$18401>=1))&&($18377$18396[0]==="all")))){(xs$18488=Array.prototype.slice.call($18377$18396,1));(t$18493=it$0$18363.temp(rhs$18358));(temp$18503=xs$18488);($length$18509=temp$18503.length);($index$18515=0);$18494:for(;($index$18515<$length$18509);($index$18515++)){var x$18532;var m$18524;(m$18524=temp$18503[$index$18515]);(x$18532=m$18524);it$0$18363.process(x$18532,t$18493,fns$18359);}return null;}else{if(($18392$18405&&($18377$18396[0]==="any"))){(xs$18536=Array.prototype.slice.call($18377$18396,1));(t$18541=it$0$18363.temp(rhs$18358,["symbol",gensym$17229("bridge")]));return it$0$18363.check((((fn$18548=(function(x$18554,rest$18555){return ["send",["symbol","or"],["data",x$18554,rest$18555]];}))),((parts$18549=(((acc$18565=[])),(((temp$18571=xs$18536)),((($length$18577=temp$18571.length)),((($index$18583=0)),(function(){$18560:for(;($index$18583<$length$18577);($index$18583++)){var pp$18605;var x$18600;var m$18592;(m$18592=temp$18571[$index$18583]);(x$18600=m$18592);acc$18565.push((((pp$18605=PatternProcessor$17238())),pp$18605.process(x$18600,t$18541,fns$18359),assemble_conditions$17239(pp$18605)));}})()))),acc$18565))),util$17227.construct(parts$18549,fn$18548,["symbol","false"])));}else{if(($18392$18405&&($18377$18396[0]==="object_pattern"))){(subp$18612=Array.prototype.slice.call($18377$18396,1));(t$18617=it$0$18363.temp(rhs$18358));(acc$18626=[]);(temp$18632=subp$18612);($length$18638=temp$18632.length);($index$18644=0);$18618:for(;($index$18644<$length$18638);($index$18644++)){var k$18665;var v$18666;var t0$18658;var t1$18659;var t2$18660;var t3$18661;var m$18653;(m$18653=temp$18632[$index$18644]);(t0$18658=m$18653);if(((t0$18658 instanceof Array)&&(((t1$18659=t0$18658.length)),((t1$18659===2)&&(((t2$18660=t0$18658[0])),((t2$18660 instanceof Array)&&(((t3$18661=t2$18660.length)),((t3$18661===2)&&(t2$18660[0]==="value"))))))))){(k$18665=t2$18660[1]);(v$18666=t0$18658[1]);acc$18626.push((it$0$18363.check(["send",["symbol","___hasprop"],["data",t$18617,["value",k$18665]]]),it$0$18363.process(v$18666,["send",t$18617,["value",k$18665]],fns$18359)));}else{$16908(m$18653,"/home/olivier/git/earl-grey/src/pattern.eg",8151,8283);}}return acc$18626;}else{if(($18390$18403&&((t0$18401===5)&&($18377$18396[0]==="array_pattern")))){(fw$18694=$18377$18396[1]);(bw$18695=$18377$18396[2]);(dflt$18696=$18377$18396[3]);(rest$18697=$18377$18396[4]);(nfw$18710=fw$18694.length);(nbw$18711=bw$18695.length);(ndflt$18712=dflt$18696.length);(extract_length$18713=true);(check_length$18714=true);(lo$18715=(nfw$18710+nbw$18711));(hi$18716=(lo$18715+ndflt$18712));(t$18717=it$0$18363.temp(rhs$18358));(len$18718=it$0$18363.temp(["send",t$18717,["send",["symbol","."],["data",["void"],["symbol","length"]]]]));it$0$18363.check(((($18755$18761=rest$18697)),(function(){if($18755$18761){return ["send",["symbol",">="],["data",len$18718,["value",lo$18715]]];}else{$18755$18761;if((lo$18715===hi$18716)){return ["send",["symbol","==="],["data",len$18718,["value",lo$18715]]];}else{(otherwise$18777=$18755$18761);return ["send",["symbol","and"],["data",["send",["symbol",">="],["data",len$18718,["value",lo$18715]]],["send",["symbol","<="],["data",len$18718,["value",hi$18716]]]]];}}})()));(temp$18782=$17160(fw$18694));($length$18788=temp$18782.length);($index$18794=0);$18719:for(;($index$18794<$length$18788);($index$18794++)){var i$18813;var m$18814;var t0$18808;var t1$18809;var m$18803;(m$18803=temp$18782[$index$18794]);(t0$18808=m$18803);if(((t0$18808 instanceof Array)&&(((t1$18809=t0$18808.length)),(t1$18809===2)))){(i$18813=t0$18808[0]);(m$18814=t0$18808[1]);it$0$18363.process(m$18814,["send",t$18717,["value",i$18813]],fns$18359);}else{$16908(m$18803,"/home/olivier/git/earl-grey/src/pattern.eg",9015,9101);}}(temp$18831=$17160(dflt$18696));($length$18837=temp$18831.length);($index$18843=0);$18722:for(;($index$18843<$length$18837);($index$18843++)){var idx$18891;var i$18864;var patt$18865;var value$18866;var t0$18857;var t1$18858;var t2$18859;var t3$18860;var m$18852;(m$18852=temp$18831[$index$18843]);(t0$18857=m$18852);if(((t0$18857 instanceof Array)&&(((t1$18858=t0$18857.length)),((t1$18858===2)&&((i$18864=t0$18857[0]),(((t2$18859=t0$18857[1])),((t2$18859 instanceof Array)&&(((t3$18860=t2$18859.length)),(t3$18860===2))))))))){(patt$18865=t2$18859[0]);(value$18866=t2$18859[1]);(idx$18891=(i$18864+nfw$18710));it$0$18363.process(patt$18865,["send",["symbol","if"],["data",["send",["symbol",">="],["data",["value",(idx$18891+nbw$18711)],len$18718]],value$18866,["send",t$18717,["value",idx$18891]]]],fns$18359);}else{$16908(m$18852,"/home/olivier/git/earl-grey/src/pattern.eg",9101,9270);}}if((rest$18697!==(void 0))){(pos$18899=(nfw$18710+ndflt$18712));(end$18905=(function(){if((nbw$18711>0)){return [["value",(-nbw$18711)]];}else{return [];}})());it$0$18363.process(rest$18697,["send",["send",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",t$18717,["value",pos$18899]].concat(end$18905)],fns$18359);}else{[];}(acc$18911=[]);(temp$18917=$17160(bw$18695));($length$18923=temp$18917.length);($index$18929=0);$18725:for(;($index$18929<$length$18923);($index$18929++)){var i$18948;var m$18949;var t0$18943;var t1$18944;var m$18938;(m$18938=temp$18917[$index$18929]);(t0$18943=m$18938);if(((t0$18943 instanceof Array)&&(((t1$18944=t0$18943.length)),(t1$18944===2)))){(i$18948=t0$18943[0]);(m$18949=t0$18943[1]);acc$18911.push(it$0$18363.process(m$18949,["send",["symbol","___js_fetch"],["data",t$18717,["send",["symbol","-"],["data",len$18718,["value",(nbw$18711-i$18948)]]]]],fns$18359));}else{$16908(m$18938,"/home/olivier/git/earl-grey/src/pattern.eg",9721,9872);}}return acc$18911;}else{$16908($18377$18396);}}}}}}}}}}}}})()));return rval$18374;}));$16834(PatternProcessor$17238,$16834(((accum$18970=({})),((accum$18970["::name"]="PatternProcessor"),accum$18970)),((accum$18974=({})),((accum$18974["::egclass"]=true),accum$18974))));PatternProcessor$17238;(assemble_conditions$17239=(function(pp$18981){var $index$19105;var $length$19099;var temp$19093;var acc$19087;var decls$19079;var construct$18985;(construct$18985=(function($18989$18992){var x$19060;var rest$19061;var x$19045;var x$19029;var rest$19030;var $18999$19016;var $19000$19017;var t0$19012;var t1$19013;var t2$19014;var $18994$19007;var ph$19001;(ph$19001=$18989$18992);($18994$19007=ph$19001);if((($18999$19016=($18994$19007 instanceof Array))&&(((t0$19012=$18994$19007.length)),(t0$19012===0)))){return ["value",true];}else{if(($18999$19016&&((t0$19012>=1)&&(((t1$19013=$18994$19007[0])),((t1$19013 instanceof Array)&&(((t2$19014=t1$19013.length)),((t2$19014===2)&&(t1$19013[0]==="do")))))))){(x$19029=t1$19013[1]);(rest$19030=Array.prototype.slice.call($18994$19007,1));return ["multi",x$19029,construct$18985(rest$19030)];}else{if(($18999$19016&&((t0$19012===1)&&(((t1$19013=$18994$19007[0])),((t1$19013 instanceof Array)&&(((t2$19014=t1$19013.length)),((t2$19014===2)&&(t1$19013[0]==="check")))))))){(x$19045=t1$19013[1]);return x$19045;}else{if(($18999$19016&&((t0$19012>=1)&&(((t1$19013=$18994$19007[0])),((t1$19013 instanceof Array)&&(((t2$19014=t1$19013.length)),((t2$19014===2)&&(t1$19013[0]==="check")))))))){(x$19060=t1$19013[1]);(rest$19061=Array.prototype.slice.call($18994$19007,1));return ["send",["symbol","and"],["data",x$19060,construct$18985(rest$19061)]];}else{$16908($18994$19007);}}}}}));if(pp$18981.temps.length){(decls$19079=(((acc$19087=[])),(((temp$19093=pp$18981.temps)),((($length$19099=temp$19093.length)),((($index$19105=0)),(function(){$19082:for(;($index$19105<$length$19099);($index$19105++)){var t$19122;var m$19114;(m$19114=temp$19093[$index$19105]);(t$19122=m$19114);acc$19087.push(["declare",t$19122]);}})()))),acc$19087));return ["multi"].concat(decls$19079).concat([construct$18985(pp$18981.parts)]);}else{return construct$18985(pp$18981.parts);}}));(assemble_pattern$17240=(function(){var $index$19194;var $length$19188;var temp$19182;var $index$19255;var $length$19249;var temp$19243;var test$19394;var lead$19157;var trail$19158;var construct$19159;var parts$19144;var t$19145;var f$19146;var t0$19140;var $19131$19135;($19131$19135=arguments);(t0$19140=$19131$19135.length);if(((t0$19140>=2)&&(t0$19140<=3))){(parts$19144=$19131$19135[0]);(t$19145=$19131$19135[1]);(f$19146=(function(){if((2>=t0$19140)){return null;}else{return $19131$19135[2];}})());(lead$19157=[]);(temp$19182=parts$19144.slice(0));($length$19188=temp$19182.length);($index$19194=0);$19160:for(;($index$19194<$length$19188);($index$19194++)){var x$19232;var x$19217;var $19164$19211;var $19165$19212;var $19166$19213;var $19167$19214;var t0$19208;var t1$19209;var m$19203;(m$19203=temp$19182[$index$19194]);(t0$19208=m$19203);if((($19165$19212=(t0$19208 instanceof Array))&&(((t1$19209=t0$19208.length)),(($19167$19214=(t1$19209===2))&&(t0$19208[0]==="do"))))){(x$19217=t0$19208[1]);lead$19157.push(x$19217);parts$19144.shift();}else{if(($19167$19214&&(t0$19208[0]==="check"))){(x$19232=t0$19208[1]);break $19160;}else{$16908(m$19203,"/home/olivier/git/earl-grey/src/pattern.eg",10333,10443);}}}(trail$19158=[]);(temp$19243=parts$19144.slice(0).reverse());($length$19249=temp$19243.length);($index$19255=0);$19168:for(;($index$19255<$length$19249);($index$19255++)){var x$19293;var x$19278;var $19172$19272;var $19173$19273;var $19174$19274;var $19175$19275;var t0$19269;var t1$19270;var m$19264;(m$19264=temp$19243[$index$19255]);(t0$19269=m$19264);if((($19173$19273=(t0$19269 instanceof Array))&&(((t1$19270=t0$19269.length)),(($19175$19275=(t1$19270===2))&&(t0$19269[0]==="do"))))){(x$19278=t0$19269[1]);trail$19158.unshift(x$19278);parts$19144.pop();}else{if(($19175$19275&&(t0$19269[0]==="check"))){(x$19293=t0$19269[1]);break $19168;}else{$16908(m$19264,"/home/olivier/git/earl-grey/src/pattern.eg",10457,10579);}}}(construct$19159=(function($19301$19304){var other$19389;var x$19373;var rest$19374;var x$19358;var x$19342;var rest$19343;var $19312$19329;var $19313$19330;var t0$19325;var t1$19326;var t2$19327;var $19306$19320;var ph$19314;(ph$19314=$19301$19304);($19306$19320=ph$19314);if((($19312$19329=($19306$19320 instanceof Array))&&(((t0$19325=$19306$19320.length)),(t0$19325===0)))){return ["value",true];}else{if(($19312$19329&&((t0$19325>=1)&&(((t1$19326=$19306$19320[0])),((t1$19326 instanceof Array)&&(((t2$19327=t1$19326.length)),((t2$19327===2)&&(t1$19326[0]==="do")))))))){(x$19342=t1$19326[1]);(rest$19343=Array.prototype.slice.call($19306$19320,1));return ["multi",x$19342,construct$19159(rest$19343)];}else{if(($19312$19329&&((t0$19325===1)&&(((t1$19326=$19306$19320[0])),((t1$19326 instanceof Array)&&(((t2$19327=t1$19326.length)),((t2$19327===2)&&(t1$19326[0]==="check")))))))){(x$19358=t1$19326[1]);return x$19358;}else{if(($19312$19329&&((t0$19325>=1)&&(((t1$19326=$19306$19320[0])),((t1$19326 instanceof Array)&&(((t2$19327=t1$19326.length)),((t2$19327===2)&&(t1$19326[0]==="check")))))))){(x$19373=t1$19326[1]);(rest$19374=Array.prototype.slice.call($19306$19320,1));return ["send",["symbol","and"],["data",x$19373,construct$19159(rest$19374)]];}else{(other$19389=$19306$19320);throw $16927(["oops"]).create("?!?",other$19389);}}}}}));if(parts$19144.length){(test$19394=construct$19159(parts$19144));return ["multi"].concat(lead$19157).concat([(function(){if(f$19146){return ["send",["symbol","if"],["data",test$19394,["multi"].concat(trail$19158).concat([t$19145]),f$19146]];}else{return ["send",["symbol","if"],["data",test$19394,["multi"].concat(trail$19158).concat([t$19145])]];}})()]);}else{return ["multi"].concat(lead$19157).concat(trail$19158).concat([t$19145]);}}else{$16908($19131$19135);}}));(inject_below_uses$17241=(function($19404$19407,fn$19408){var other$19439;var scope$19428;var x$19429;var t0$19424;var $19410$19419;var ph$19413;(ph$19413=$19404$19407);($19410$19419=ph$19413);if((($19410$19419 instanceof Array)&&(((t0$19424=$19410$19419.length)),((t0$19424===3)&&($19410$19419[0]==="use"))))){(scope$19428=$19410$19419[1]);(x$19429=$19410$19419[2]);return ["use",scope$19428,inject_below_uses$17241(x$19429,fn$19408)];}else{(other$19439=$19410$19419);return fn$19408(other$19439);}}));(parse_pattern$17242=(function(scope$19446,pattern$19447,rhs$19448,opt$19449){var t0$19463;var $index$19515;var $length$19509;var temp$19503;var acc$19497;var parse$19455;var target$19456;var proc$19457;(parse$19455=PatternParser$17237(scope$19446,pattern$19447,opt$19449));if(((!opt$19449.allow_arguments)&&parse$19455.arguments.length)){throw $16927(["syntax","pattern","arguments"]).create("Arguments cannot be declared in this pattern",({"args":parse$19455.arguments[0]}));}(t0$19463=$21189((opt$19449.wrap_target||identity$17233))((function(){if(parse$19455.arguments.length){return inject_below_uses$17241(rhs$19448,(function(x$19470){return util$17227.construct(parse$19455.arguments.concat([x$19470]),(function(args$19474,rest$19475){return ["send",["symbol","->"],["data",args$19474,rest$19475]];}));}));}else{return rhs$19448;}})()));if(t0$19463[0]){(target$19456=t0$19463[1]);}else{$16908((function(){if(parse$19455.arguments.length){return inject_below_uses$17241(rhs$19448,(function(x$19482){return util$17227.construct(parse$19455.arguments.concat([x$19482]),(function(args$19486,rest$19487){return ["send",["symbol","->"],["data",args$19486,rest$19487]];}));}));}else{return rhs$19448;}})(),"/home/olivier/git/earl-grey/src/pattern.eg",11979,12405);}(proc$19457=PatternProcessor$17238());proc$19457.process(parse$19455.pattern,target$19456,opt$19449);if(opt$19449.finalize){return ["splice"].concat(opt$19449.declare(scope$19446,parse$19455.vars)).concat([["multi"].concat((((acc$19497=[])),(((temp$19503=proc$19457.temps)),((($length$19509=temp$19503.length)),((($index$19515=0)),(function(){$19492:for(;($index$19515<$length$19509);($index$19515++)){var t$19532;var m$19524;(m$19524=temp$19503[$index$19515]);(t$19532=m$19524);acc$19497.push(["declare",t$19532]);}})()))),acc$19497)).concat([assemble_pattern$17240(proc$19457.parts,opt$19449.success(target$19456),opt$19449.failure(target$19456))])]);}else{return [parse$19455.vars,proc$19457.temps,proc$19457.parts];}}));(checkall$17243=["send","data","multi","assign","void","check","do"]);(same_block$17244=(function($19542$19545,ban1$19546,ban2$19547){var $index$19711;var $length$19705;var temp$19699;var other$19733;var type1$19672;var args1$19673;var type2$19674;var args2$19675;var m1$19655;var m2$19656;var v1$19638;var v2$19639;var s1$19621;var s2$19622;var v1$19589;var v2$19590;var $19556$19580;var $19557$19581;var $19558$19582;var $19559$19583;var $19560$19584;var $19561$19585;var $19562$19586;var t0$19574;var t1$19575;var t2$19576;var t3$19577;var t4$19578;var $19549$19569;var ph$19563;(ph$19563=$19542$19545);($19549$19569=ph$19563);if((($19556$19580=($19549$19569 instanceof Array))&&(((t0$19574=$19549$19569.length)),(($19558$19582=(t0$19574===2))&&(((t1$19575=$19549$19569[0])),(($19560$19584=(t1$19575 instanceof Array))&&(((t2$19576=t1$19575.length)),(($19562$19586=(t2$19576===2))&&((t1$19575[0]==="variable")&&((v1$19589=t1$19575[1]),(((t3$19577=$19549$19569[1])),((t3$19577 instanceof Array)&&(((t4$19578=t3$19577.length)),((t4$19578===2)&&(t3$19577[0]==="variable"))))))))))))))){(v2$19590=t3$19577[1]);return (v1$19589===v2$19590);}else{if(($19562$19586&&((t1$19575[0]==="symbol")&&((s1$19621=t1$19575[1]),(((t3$19577=$19549$19569[1])),((t3$19577 instanceof Array)&&(((t4$19578=t3$19577.length)),((t4$19578===2)&&(t3$19577[0]==="symbol"))))))))){(s2$19622=t3$19577[1]);return (((!$16851(ban1$19546,s1$19621))&&(!$16851(ban2$19547,s2$19622)))&&(s1$19621===s2$19622));}else{if(($19562$19586&&((t1$19575[0]==="value")&&((v1$19638=t1$19575[1]),(((t3$19577=$19549$19569[1])),((t3$19577 instanceof Array)&&(((t4$19578=t3$19577.length)),((t4$19578===2)&&(t3$19577[0]==="value"))))))))){(v2$19639=t3$19577[1]);return (v1$19638===v2$19639);}else{if(($19562$19586&&((t1$19575[0]==="macro")&&((m1$19655=t1$19575[1]),(((t3$19577=$19549$19569[1])),((t3$19577 instanceof Array)&&(((t4$19578=t3$19577.length)),((t4$19578===2)&&(t3$19577[0]==="macro"))))))))){(m2$19656=t3$19577[1]);return (m1$19655===m2$19656);}else{if(($19560$19584&&((t2$19576>=1)&&((type1$19672=t1$19575[0]),((args1$19673=Array.prototype.slice.call(t1$19575,1)),(((t3$19577=$19549$19569[1])),((t3$19577 instanceof Array)&&(((t4$19578=t3$19577.length)),((t4$19578>=1)&&((type2$19674=t3$19577[0]),((args2$19675=Array.prototype.slice.call(t3$19577,1)),(checkall$17243.indexOf(type1$19672)!==-1)))))))))))){if(((type1$19672===type2$19674)&&(args1$19673.length===args2$19675.length))){(temp$19699=$21236(args1$19673,args2$19675));($length$19705=temp$19699.length);($index$19711=0);$19693:for(;($index$19711<$length$19705);($index$19711++)){var pair$19728;var m$19720;(m$19720=temp$19699[$index$19711]);(pair$19728=m$19720);if((!same_block$17244(pair$19728,ban1$19546,ban2$19547))){return false;}}return true;}else{return false;}}else{(other$19733=$19549$19569);return false;}}}}}}));(parse_clauses$17245=(function(scope$19740,target$19741,stmts$19742,opt$19743){var $index$19783;var $length$19777;var temp$19771;var acc$19765;var $index$20029;var $length$20023;var temp$20017;var acc$20011;var $index$20092;var $length$20086;var temp$20080;var acc$20074;var decls$20066;var all_temps$19749;var the_parts$19750;var unique_temps$19751;(all_temps$19749=[]);(the_parts$19750=(((acc$19765=[])),(((temp$19771=scope$19740.step_all(["clause"],stmts$19742))),((($length$19777=temp$19771.length)),((($index$19783=0)),(function(){$19757:for(;($index$19783<$length$19777);($index$19783++)){var accum$19895;var accum$19913;var t0$19887;var t1$19888;var $index$19940;var $length$19934;var temp$19928;var bod$19981;var placeholder$19822;var special_fn$19823;var vars$19824;var temps$19825;var blocks$19826;var vars2$19827;var x$19991;var other$19999;var b$19987;var pattern$19803;var body$19804;var $19762$19800;var t0$19797;var t1$19798;var m$19792;(m$19792=temp$19771[$index$19783]);(t0$19797=m$19792);if(((t0$19797 instanceof Array)&&(((t1$19798=t0$19797.length)),((t1$19798===3)&&(t0$19797[0]==="clause"))))){(pattern$19803=t0$19797[1]);(body$19804=t0$19797[2]);acc$19765.push((((placeholder$19822=(void 0))),((special_fn$19823=(function($19838$19841,value$19842){var t0$19850;var t1$19851;var other$19883;var $19844$19866;var ph$19847;var expr$19848;(t0$19850=$19838$19841);if(((t0$19850 instanceof Array)&&(((t1$19851=t0$19850.length)),((t1$19851===2)&&(t0$19850[0]==="special"))))){(ph$19847=t0$19850[1]);(expr$19848=t0$19850);}else{$16908($19838$19841);}($19844$19866=ph$19847);if(($19844$19866==="match")){(placeholder$19822=__lt____lt____colon__$17226(["symbol",scope$19740.gensym("ph")],expr$19848));return ["assign",placeholder$19822];}else{(other$19883=$19844$19866);throw $16927(["syntax","pattern","special"]).create("Special token cannot be used here",({"special":expr$19848}));}}))),(((t0$19887=parse_pattern$17242(scope$19740,pattern$19803,target$19741,$21166(opt$19743,$16834(({"allow_arguments":false,"allow_nested":true,"special":special_fn$19823}),$16834(((accum$19895=({})),((accum$19895["assign"]=(function(v$19900,value$19901){return ["do",__lt____lt____colon__$17226(["assign",v$19900,value$19901],v$19900)];})),accum$19895)),({"finalize":false}))))))),(function(){if(((t0$19887 instanceof Array)&&(((t1$19888=t0$19887.length)),(t1$19888===3)))){(vars$19824=t0$19887[0]);(temps$19825=t0$19887[1]);(blocks$19826=t0$19887[2]);}else{return $16908(parse_pattern$17242(scope$19740,pattern$19803,target$19741,$21166(opt$19743,$16834(({"allow_arguments":false,"allow_nested":true,"special":special_fn$19823}),$16834(((accum$19913=({})),((accum$19913["assign"]=(function(v$19918,value$19919){return ["do",__lt____lt____colon__$17226(["assign",v$19918,value$19919],v$19918)];})),accum$19913)),({"finalize":false}))))),"/home/olivier/git/earl-grey/src/pattern.eg",14056,14390);}})()),(all_temps$19749=all_temps$19749.concat(temps$19825)),(function(){if(placeholder$19822){return vars$19824.push(placeholder$19822);}})(),((vars2$19827=({}))),(((temp$19928=vars$19824)),((($length$19934=temp$19928.length)),((($index$19940=0)),(function(){$19828:for(;($index$19940<$length$19934);($index$19940++)){var other$19977;var xxx$19959;var t0$19954;var t1$19955;var m$19949;(m$19949=temp$19928[$index$19940]);(t0$19954=m$19949);if(((t0$19954 instanceof Array)&&(((t1$19955=t0$19954.length)),((t1$19955===2)&&(t0$19954[0]==="symbol"))))){(xxx$19959=t0$19954[1]);(vars2$19827[xxx$19959]=true);}else{(other$19977=m$19949);throw $16927(["syntax","unexpected"]).create();}}})()))),(((bod$19981=(function(){if(placeholder$19822){return parse_clauses$17245(scope$19740,placeholder$19822,$21189(Body$17234)(body$19804)[1],opt$19743);}else{if(opt$19743.wrap){return opt$19743.wrap(body$19804);}else{return body$19804;}}})())),["clause",vars$19824,vars2$19827,blocks$19826,bod$19981])));}else{if((((x$19991=t0$19797)),((x$19991 instanceof Array)&&(x$19991[0]==="block")))){(b$19987=t0$19797);acc$19765.push(b$19987);}else{(other$19999=m$19792);acc$19765.push(function(){throw $16927(["syntax","clause"]).create("Illegal clause",({"clause":other$19999}));}());}}}})()))),acc$19765));if(opt$19743.fallback){the_parts$19750.push(["block",opt$19743.fallback(target$19741)]);}(unique_temps$19751=$21188(util$17227.mkset((((acc$20011=[])),(((temp$20017=all_temps$19749)),((($length$20023=temp$20017.length)),((($index$20029=0)),(function(){$20006:for(;($index$20029<$length$20023);($index$20029++)){var t$20048;var t0$20043;var t1$20044;var m$20038;(m$20038=temp$20017[$index$20029]);(t0$20043=m$20038);if(((t0$20043 instanceof Array)&&(((t1$20044=t0$20043.length)),((t1$20044===2)&&(t0$20043[0]==="symbol"))))){(t$20048=t0$20043[1]);acc$20011.push(t$20048);}else{$16908(m$20038,"/home/olivier/git/earl-grey/src/pattern.eg",15197,15227);}}})()))),acc$20011))));(decls$20066=(((acc$20074=[])),(((temp$20080=unique_temps$19751)),((($length$20086=temp$20080.length)),((($index$20092=0)),(function(){$20069:for(;($index$20092<$length$20086);($index$20092++)){var t$20109;var m$20101;(m$20101=temp$20080[$index$20092]);(t$20109=m$20101);acc$20074.push(["declare",$16834(["symbol",t$20109],({"mutable":true}))]);}})()))),acc$20074));return ["multi"].concat(decls$20066).concat([weave_clauses$17247(the_parts$19750)]);}));(opt_clauses$17246=(function(clauses$20118){var $index$20158;var $length$20152;var temp$20146;var acc$20140;var $index$20342;var $length$20336;var temp$20330;var acc$20324;var $index$20402;var $length$20396;var temp$20390;var acc$20384;var $index$20454;var $length$20448;var temp$20442;var acc$20436;var shares$20127;var max$20128;var temps$20129;var shared_last$20130;var idx_last$20131;var new_clauses$20132;(shares$20127=(((acc$20140=[])),(((temp$20146=$17160(clauses$20118.slice(1)))),((($length$20152=temp$20146.length)),((($index$20158=0)),(function(){$20135:for(;($index$20158<$length$20152);($index$20158++)){var t0$20219;var t1$20220;var $index$20254;var $length$20248;var temp$20242;var varsd0$20211;var blocks0$20212;var share$20213;var idx$20214;var i$20179;var vars$20180;var varsd$20181;var blocks$20182;var body$20183;var t0$20172;var t1$20173;var t2$20174;var t3$20175;var m$20167;(m$20167=temp$20146[$index$20158]);(t0$20172=m$20167);if(((t0$20172 instanceof Array)&&(((t1$20173=t0$20172.length)),((t1$20173===2)&&((i$20179=t0$20172[0]),(((t2$20174=t0$20172[1])),((t2$20174 instanceof Array)&&(((t3$20175=t2$20174.length)),((t3$20175===5)&&(t2$20174[0]==="clause")))))))))){(vars$20180=t2$20174[1]);(varsd$20181=t2$20174[2]);(blocks$20182=t2$20174[3]);(body$20183=t2$20174[4]);acc$20140.push(((((t0$20219=$16851(clauses$20118,i$20179))),(function(){if(((t0$20219 instanceof Array)&&(((t1$20220=t0$20219.length)),((t1$20220===5)&&(t0$20219[0]==="clause"))))){t0$20219[1];(varsd0$20211=t0$20219[2]);(blocks0$20212=t0$20219[3]);t0$20219[4];}else{return $16908($16851(clauses$20118,i$20179),"/home/olivier/git/earl-grey/src/pattern.eg",15520,15530);}})()),((share$20213=0)),((idx$20214=0)),(((temp$20242=blocks$20182)),((($length$20248=temp$20242.length)),((($index$20254=0)),(function(){$20215:for(;($index$20254<$length$20248);($index$20254++)){var x$20291;var x$20301;var other$20312;var $20274$20280;var b$20271;var m$20263;(m$20263=temp$20242[$index$20254]);(b$20271=m$20263);if(same_block$17244([$16851(blocks0$20212,share$20213),b$20271],varsd0$20211,varsd$20181)){(share$20213++);($20274$20280=b$20271);if((((x$20291=$20274$20280)),((x$20291 instanceof Array)&&(x$20291[0]==="do")))){null;}else{if((((x$20301=$20274$20280)),((x$20301 instanceof Array)&&(x$20301[0]==="check")))){(idx$20214=share$20213);}else{(other$20312=$20274$20280);__lt____gt__$17224(null,other$20312);}}}else{break $20215;}}})()))),[share$20213,idx$20214]));}else{$16908(m$20167,"/home/olivier/git/earl-grey/src/pattern.eg",15396,15924);}}})()))),acc$20140));(max$20128=$16851(Math.max,(((acc$20324=[])),(((temp$20330=shares$20127)),((($length$20336=temp$20330.length)),((($index$20342=0)),(function(){$20319:for(;($index$20342<$length$20336);($index$20342++)){var x$20361;var t0$20356;var t1$20357;var m$20351;(m$20351=temp$20330[$index$20342]);(t0$20356=m$20351);if(((t0$20356 instanceof Array)&&(((t1$20357=t0$20356.length)),(t1$20357===2)))){(x$20361=t0$20356[0]);t0$20356[1];acc$20324.push(x$20361);}else{$16908(m$20351,"/home/olivier/git/earl-grey/src/pattern.eg",15938,15963);}}})()))),acc$20324)));shares$20127.push([0,0]);(temps$20129=(((acc$20384=[])),(((temp$20390=$21300(1,max$20128))),((($length$20396=temp$20390.length)),((($index$20402=0)),(function(){$20379:for(;($index$20402<$length$20396);($index$20402++)){var m$20411;(m$20411=temp$20390[$index$20402]);m$20411;acc$20384.push(["symbol",gensym$17229()]);}})()))),acc$20384));(shared_last$20130=0);(idx_last$20131=0);(new_clauses$20132=(((acc$20436=[])),(((temp$20442=$17160(clauses$20118))),((($length$20448=temp$20442.length)),((($index$20454=0)),(function(){$20430:for(;($index$20454<$length$20448);($index$20454++)){var t0$20516;var t1$20517;var $index$20566;var $length$20560;var temp$20554;var acc$20548;var rest$20650;var newblocks$20645;var share$20510;var idx$20511;var shared$20512;var n_to_share$20513;var to_share$20514;var other$20657;var i$20475;var vars$20476;var varsd$20477;var blocks$20478;var body$20479;var t0$20468;var t1$20469;var t2$20470;var t3$20471;var m$20463;(m$20463=temp$20442[$index$20454]);(t0$20468=m$20463);if(((t0$20468 instanceof Array)&&(((t1$20469=t0$20468.length)),((t1$20469===2)&&((i$20475=t0$20468[0]),(((t2$20470=t0$20468[1])),((t2$20470 instanceof Array)&&(((t3$20471=t2$20470.length)),((t3$20471===5)&&(t2$20470[0]==="clause")))))))))){(vars$20476=t2$20470[1]);(varsd$20477=t2$20470[2]);(blocks$20478=t2$20470[3]);(body$20479=t2$20470[4]);acc$20436.push(((((t0$20516=$16851(shares$20127,i$20475))),(function(){if(((t0$20516 instanceof Array)&&(((t1$20517=t0$20516.length)),(t1$20517===2)))){(share$20510=t0$20516[0]);(idx$20511=t0$20516[1]);}else{return $16908($16851(shares$20127,i$20475),"/home/olivier/git/earl-grey/src/pattern.eg",16196,16205);}})()),((shared$20512=(function(){if(idx_last$20131){return [["check",$16851(temps$20129,(idx_last$20131-1))]];}else{return [];}})())),((n_to_share$20513=Math.max(shared_last$20130,share$20510))),((to_share$20514=(((acc$20548=[])),(((temp$20554=$17160(blocks$20478.slice(shared_last$20130,n_to_share$20513)))),((($length$20560=temp$20554.length)),((($index$20566=0)),(function(){$20538:for(;($index$20566<$length$20560);($index$20566++)){var j$20618;var x$20619;var j$20591;var x$20592;var $20542$20585;var $20543$20586;var $20544$20587;var $20545$20588;var t0$20580;var t1$20581;var t2$20582;var t3$20583;var m$20575;(m$20575=temp$20554[$index$20566]);(t0$20580=m$20575);if((($20543$20586=(t0$20580 instanceof Array))&&(((t1$20581=t0$20580.length)),(($20545$20588=(t1$20581===2))&&((j$20591=t0$20580[0]),(((t2$20582=t0$20580[1])),((t2$20582 instanceof Array)&&(((t3$20583=t2$20582.length)),((t3$20583===2)&&(t2$20582[0]==="check")))))))))){(x$20592=t2$20582[1]);acc$20548.push(["check",["assign",$16851(temps$20129,(shared_last$20130+j$20591)),x$20592]]);}else{if(($20545$20588&&((j$20618=t0$20580[0]),(((t2$20582=t0$20580[1])),((t2$20582 instanceof Array)&&(((t3$20583=t2$20582.length)),((t3$20583===2)&&(t2$20582[0]==="do")))))))){(x$20619=t2$20582[1]);acc$20548.push(["do",x$20619]);}else{$16908(m$20575,"/home/olivier/git/earl-grey/src/pattern.eg",16344,16515);}}}})()))),acc$20548))),((shared_last$20130=share$20510)),((idx_last$20131=idx$20511)),(((newblocks$20645=(((rest$20650=blocks$20478.slice(n_to_share$20513))),shared$20512.concat(to_share$20514).concat(rest$20650)))),["clause",vars$20476,varsd$20477,newblocks$20645,body$20479])));}else{(other$20657=m$20463);acc$20436.push(function(){throw $16927(["oops"]).create("what",({"value":other$20657}));}());}}})()))),acc$20436));return [temps$20129,new_clauses$20132];}));(weave_clauses$17247=(function(parts$20666){var $index$20731;var $length$20725;var temp$20719;var $index$20995;var $length$20989;var temp$20983;var acc$20977;var groups$20673;var reassemble$20674;var new_temps$20675;var helper$20676;(groups$20673=classify_contiguous$17232(parts$20666,(function($20688$20691){var t0$20695;var t1$20696;var cls$20693;(t0$20695=$20688$20691);if(((t0$20695 instanceof Array)&&(((t1$20696=t0$20695.length)),(t1$20696>=1)))){(cls$20693=t0$20695[0]);Array.prototype.slice.call(t0$20695,1);}else{$16908($20688$20691);}return cls$20693;})));(reassemble$20674=[]);(new_temps$20675=[]);(temp$20719=groups$20673);($length$20725=temp$20719.length);($index$20731=0);$20677:for(;($index$20731<$length$20725);($index$20731++)){var t0$20771;var t1$20772;var ts$20768;var new_clauses$20769;var elems$20787;var elems$20754;var $20681$20748;var $20682$20749;var $20683$20750;var $20684$20751;var t0$20745;var t1$20746;var m$20740;(m$20740=temp$20719[$index$20731]);(t0$20745=m$20740);if((($20682$20749=(t0$20745 instanceof Array))&&(((t1$20746=t0$20745.length)),(($20684$20751=(t1$20746>=1))&&(t0$20745[0]==="clause"))))){(elems$20754=Array.prototype.slice.call(t0$20745,1));(t0$20771=opt_clauses$17246(elems$20754));if(((t0$20771 instanceof Array)&&(((t1$20772=t0$20771.length)),(t1$20772===2)))){(ts$20768=t0$20771[0]);(new_clauses$20769=t0$20771[1]);}else{$16908(opt_clauses$17246(elems$20754),"/home/olivier/git/earl-grey/src/pattern.eg",17024,17042);}(new_temps$20675=new_temps$20675.concat(ts$20768));(reassemble$20674=reassemble$20674.concat(new_clauses$20769));}else{if(($20684$20751&&(t0$20745[0]==="block"))){(elems$20787=Array.prototype.slice.call(t0$20745,1));(reassemble$20674=reassemble$20674.concat(elems$20787));}else{$16908(m$20740,"/home/olivier/git/earl-grey/src/pattern.eg",16958,17163);}}}(helper$20676=(function($20795$20798){var $index$20911;var $length$20905;var temp$20899;var acc$20893;var decls$20885;var vars$20876;var varsd$20877;var blocks$20878;var body$20879;var rest$20880;var body$20845;var rest$20846;var $20804$20828;var $20805$20829;var $20806$20830;var $20807$20831;var $20808$20832;var $20809$20833;var t0$20821;var t1$20822;var t2$20823;var t3$20824;var t4$20825;var t5$20826;var $20800$20816;var ph$20810;(ph$20810=$20795$20798);($20800$20816=ph$20810);if((($20804$20828=($20800$20816 instanceof Array))&&(((t0$20821=$20800$20816.length)),(t0$20821===0)))){return ["multi"];}else{if(($20804$20828&&(($20806$20830=(t0$20821>=1))&&(((t1$20822=$20800$20816[0])),(($20808$20832=(t1$20822 instanceof Array))&&(((t2$20823=t1$20822.length)),((t2$20823===2)&&((t1$20822[0]==="block")&&(((t3$20824=$21189(Body$17234)(t1$20822[1]))),(t3$20824[0]&&(((t4$20825=t3$20824[1])),(((t5$20826=t4$20825.length)),(t5$20826>=0))))))))))))){(body$20845=Array.prototype.slice.call(t4$20825,0));(rest$20846=Array.prototype.slice.call($20800$20816,1));return ["multi"].concat(body$20845).concat([helper$20676(rest$20846)]);}else{if(($20808$20832&&((t2$20823===5)&&(t1$20822[0]==="clause")))){(vars$20876=t1$20822[1]);(varsd$20877=t1$20822[2]);(blocks$20878=t1$20822[3]);(body$20879=t1$20822[4]);(rest$20880=Array.prototype.slice.call($20800$20816,1));(decls$20885=(((acc$20893=[])),(((temp$20899=vars$20876)),((($length$20905=temp$20899.length)),((($index$20911=0)),(function(){$20888:for(;($index$20911<$length$20905);($index$20911++)){var bridge$20936$20944;var $20931$20939;var v$20928;var m$20920;(m$20920=temp$20899[$index$20911]);(v$20928=m$20920);acc$20893.push(((($20931$20939=v$20928.declare_mode)),(function(){if(($20931$20939==="set")){return ["splice"];}else{if(($20931$20939==="let")){return ["declare",$21166(v$20928,({"mutable":false}))];}else{if(($20931$20939==="var")){return ["declare",$21166(v$20928,({"mutable":true}))];}else{(bridge$20936$20944=$20931$20939);if(((bridge$20936$20944==="unqualified")||(bridge$20936$20944===(void 0)))){return ["declare",$21166(v$20928,({"mutable":false}))];}else{$16908($20931$20939);}}}}})()));}})()))),acc$20893));return ["tagscope","back",["multi"].concat(decls$20885).concat([assemble_pattern$17240(blocks$20878,body$20879,["use","back",helper$20676(rest$20880)])])];}else{$16908($20800$20816);}}}}));return ["multi"].concat((((acc$20977=[])),(((temp$20983=new_temps$20675)),((($length$20989=temp$20983.length)),((($index$20995=0)),(function(){$20972:for(;($index$20995<$length$20989);($index$20995++)){var t$21012;var m$21004;(m$21004=temp$20983[$index$20995]);(t$21012=m$21004);acc$20977.push(["declare",t$21012]);}})()))),acc$20977)).concat([helper$20676(reassemble$20674)]);}));(exports["PatternParser"]=PatternParser$17237);(exports["PatternProcessor"]=PatternProcessor$17238);(exports["parse_clauses"]=parse_clauses$17245);(exports["parse_pattern"]=parse_pattern$17242);
