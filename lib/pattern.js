var $15887=(function(type$15890){var f$15894;(f$15894=type$15890["::check"]);if((f$15894===(void 0))){return (function(value$15900){return (value$15900 instanceof type$15890);});}else{return (function(value$15904){return f$15894.call(type$15890,value$15904);});}});
var $15906=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $15907=(function(dest$15910,values$15911){var k$15916;(k$15916=null);$15914:for(k$15916 in values$15911){if(values$15911.hasOwnProperty(k$15916)){(dest$15910[k$15916]=values$15911[k$15916]);}}return dest$15910;});
var $15924=(function($15926$15929){var ph$15935;(ph$15935=$15926$15929);var $15931$15941;($15931$15941=ph$15935);var bridge$15933$15946;var x$15950;(bridge$15933$15946=$15931$15941);if((((typeof(bridge$15933$15946)==="string")&&((x$15950=bridge$15933$15946),true))||((typeof(bridge$15933$15946)==="number")&&((x$15950=bridge$15933$15946),true)))){return ["value",x$15950];}else{var other$15961;(other$15961=$15931$15941);return other$15961["::serialize_ast"]();}});
var send$15661;(send$15661=(function(obj$15668,$15665$15669){var ph$15675;var msg$15676;var t0$15678;(t0$15678=$15665$15669);(msg$15676=t0$15678);(ph$15675=t0$15678);var $15671$15687;($15671$15687=ph$15675);var bridge$15673$15692;(bridge$15673$15692=$15671$15687);if(((typeof(bridge$15673$15692)==="string")||(typeof(bridge$15673$15692)==="number"))){return obj$15668[msg$15676];}else{var other$15704;(other$15704=$15671$15687);return obj$15668["::send"](msg$15676);}}));(Array[":::project"]=(function($15710$15713){var ph$15718;var value$15719;var t0$15721;(t0$15721=$15710$15713);(value$15719=t0$15721);(ph$15718=t0$15721);var $15715$15730;($15715$15730=ph$15718);if($15887(Array)($15715$15730)){return [true,value$15719];}else{$15715$15730;return [true,[value$15719]];}}));(Array.prototype["::check"]=(function(value$15748){if((value$15748 instanceof Array)){var i$15754;(i$15754=0);$15751:for(;(i$15754<this.length);(i$15754++)){if(($15906(this,i$15754)!==$15906(value$15748,i$15754))){return false;}}return true;}else{return false;}}));(Array.prototype["::clone"]=(function(){return $15907(this.slice(0),this);}));(Array.prototype[":::project"]=(function(value$15773){if((value$15773 instanceof Array)){var i$15779;(i$15779=0);$15776:for(;(i$15779<this.length);(i$15779++)){if(($15906(this,i$15779)!==$15906(value$15773,i$15779))){return [true,[value$15773]];}}return [true,value$15773.slice(this.length)];}else{return [true,[value$15773]];}}));(Array.prototype["::serialize_ast"]=(function(){return ["array"].concat(this.map($15924));}));(RegExp.prototype["::check"]=(function($15797$15800){var ph$15805;(ph$15805=$15797$15800);var $15802$15811;($15802$15811=ph$15805);var value$15819;if((typeof($15802$15811)==="string")){(value$15819=$15802$15811);if(value$15819.match(this)){return true;}else{return false;}}else{var other$15824;(other$15824=$15802$15811);return false;}}));(RegExp.prototype[":::project"]=(function($15830$15833){var ph$15838;(ph$15838=$15830$15833);var $15835$15844;($15835$15844=ph$15838);var value$15852;if((typeof($15835$15844)==="string")){(value$15852=$15835$15844);var $15855$15860;($15855$15860=value$15852.match(this));var m$15868;if(($15855$15860===null)){(m$15868=$15855$15860);return [false,null];}else{var m$15873;(m$15873=$15855$15860);return [true,m$15873];}}else{var other$15877;(other$15877=$15835$15844);return [false,null];}}));(Function.prototype["::send"]=(function(args$15884){return this.apply(this,args$15884);}));
var $19889=(function($19891$19894,key$19895){var ph$19903;(ph$19903=$19891$19894);var $19897$19909;($19897$19909=ph$19903);var bridge$19899$19914;(bridge$19899$19914=$19897$19909);if(((bridge$19899$19914===null)||(bridge$19899$19914===(void 0)))){return false;}else{var x$19926;if((typeof($19897$19909)==="string")){(x$19926=$19897$19909);return (key$19895 in String.prototype);}else{var x$19931;if((typeof($19897$19909)==="number")){(x$19931=$19897$19909);return (key$19895 in Number.prototype);}else{var x$19936;(x$19936=$19897$19909);return (key$19895 in x$19936);}}}});
var $20171=(function(arr$20174){var results$20180;var l$20181;(results$20180=[]);(l$20181=arr$20174.length);var i$20190;(i$20190=0);$20179:for(;(i$20190<l$20181);(i$20190++)){results$20180.push([i$20190,$15906(arr$20174,i$20190)]);}return results$20180;});
var $20197=(function(value$20200,url$20201,start$20202,end$20203){var err$20207;(err$20207=$19938(["match"]).create("Could not find a match for value",({"value":value$20200})));if(url$20201){(err$20207["location"]=["location",url$20201,start$20202,end$20203]);}throw err$20207;});
var $19938=(function(){var $19939$19945;($19939$19945=(function(tags$19950){var it$0$19953;(it$0$19953=(function(){if((!$15887($19939$19945)(this))){return Object.create($19939$19945.prototype);}else{return this;}})());(it$0$19953["tags"]=tags$19950);return it$0$19953;}));($19939$19945.prototype["create"]=(function(){var it$0$19973;var self$19974;(it$0$19973=this);(self$19974=this);var $19971$19983;($19971$19983=arguments);var t0$19988;var message$19992;var args$19993;(t0$19988=$19971$19983.length);if((t0$19988>=0)){(message$19992=(function(){if((0>=t0$19988)){return "";}else{return $19971$19983[0];}})());(args$19993=Array.prototype.slice.call($19971$19983,1));var e$20006;(e$20006=Error(message$19992));(e$20006["::tags"]=it$0$19973.tags);(e$20006["args"]=args$19993);var temp$20022;(temp$20022=$20171(args$19993));var $length$20028;($length$20028=temp$20022.length);var $index$20034;($index$20034=0);$20007:for(;($index$20034<$length$20028);($index$20034++)){var m$20043;(m$20043=temp$20022[$index$20034]);var t0$20048;var t1$20049;var i$20053;var arg$20054;(t0$20048=m$20043);if(((t0$20048 instanceof Array)&&(((t1$20049=t0$20048.length)),(t1$20049===2)))){(i$20053=t0$20048[0]);(arg$20054=t0$20048[1]);(e$20006[i$20053]=arg$20054);}else{$20197(m$20043);}}(e$20006["length"]=args$19993.length);(e$20006["name"]=["E"].concat(it$0$19973.tags).join("."));return e$20006;}else{$20197($19971$19983);}}));($19939$19945.prototype["::check"]=(function(e$20084){var it$0$20088;var self$20089;(it$0$20088=this);(self$20089=this);var tags$20099;if(((!e$20084)||(!$15887(Error)(e$20084)))){return false;}(tags$20099=(e$20084["::tags"]||[]));var temp$20110;(temp$20110=it$0$20088.tags);var $length$20116;($length$20116=temp$20110.length);var $index$20122;($index$20122=0);$20100:for(;($index$20122<$length$20116);($index$20122++)){var m$20131;(m$20131=temp$20110[$index$20122]);var tag$20139;(tag$20139=m$20131);if((tags$20099.indexOf(tag$20139)===-1)){return false;}else{false;}}return true;}));($19939$19945.prototype["::deconstruct"]=(function(e$20148){var it$0$20152;var self$20153;(it$0$20152=this);(self$20153=this);return e$20148.args;}));$15907($19939$19945,$15907((function(){var accum$20164;(accum$20164=({}));(accum$20164["::name"]="$19939");return accum$20164;})(),(function(){var accum$20168;(accum$20168=({}));(accum$20168["::egclass"]=true);return accum$20168;})()));return $19939$19945;})();
var $19805=(function($19807$19810){var ph$19820;var x$19821;var t0$19823;(t0$19823=$19807$19810);(x$19821=t0$19823);(ph$19820=t0$19823);var $19812$19832;($19812$19832=ph$19820);var bridge$19814$19837;(bridge$19814$19837=$19812$19832);if(((function(){var bridge$19815$19847;(bridge$19815$19847=bridge$19814$19837);return ((function(){var bridge$19816$19854;(bridge$19816$19854=bridge$19815$19847);return ((bridge$19816$19854===(void 0))||(bridge$19816$19854===null));})()||(typeof(bridge$19815$19847)==="string"));})()||(typeof(bridge$19814$19837)==="number"))){return x$19821;}else{if($19889($19812$19832,"::clone")){$19812$19832["::clone"];return x$19821["::clone"]();}else{$19812$19832;if((Object.getPrototypeOf(x$19821)===Object.prototype)){var dest$19872;(dest$19872=({}));var k$19877;(k$19877=null);$19871:for(k$19877 in x$19821){if(Object.prototype.hasOwnProperty.call(x$19821,k$19877)){(dest$19872[k$19877]=x$19821[k$19877]);}}return dest$19872;}else{var other$19887;(other$19887=$19812$19832);throw $19938(["clone"]).create("Object cannot be cloned",({"obj":x$19821}));}}}});
var $20216=(function(a$20219,b$20220){var dest$20225;(dest$20225=$19805(a$20219));var k$20230;(k$20230=null);$20224:for(k$20230 in b$20220){if(Object.prototype.hasOwnProperty.call(b$20220,k$20230)){(dest$20225[k$20230]=b$20220[k$20230]);}}return dest$20225;});
var $20238=Object.keys;
var $20239=(function(type$20242){return (function(value$20246){var f$20250;(f$20250=type$20242[":::project"]);if((f$20250===(void 0))){(f$20250=type$20242["::project"]);if((f$20250===(void 0))){return [true,type$20242(value$20246)];}else{var rval$20263;(rval$20263=false);try{(rval$20263=[true,f$20250(value$20246)]);}catch(excv$20274){var e$20280;(e$20280=excv$20274);(rval$20263=[false,null]);}return rval$20263;}}else{return f$20250.call(type$20242,value$20246);}});});
var $20286=(function(xs$20289,ys$20290){var acc$20297;(acc$20297=[]);var temp$20303;(temp$20303=$20171(xs$20289));var $length$20309;($length$20309=temp$20303.length);var $index$20315;($index$20315=0);$20292:for(;($index$20315<$length$20309);($index$20315++)){var m$20324;(m$20324=temp$20303[$index$20315]);var t0$20329;var t1$20330;var i$20334;var x$20335;(t0$20329=m$20324);if(((t0$20329 instanceof Array)&&(((t1$20330=t0$20329.length)),(t1$20330===2)))){(i$20334=t0$20329[0]);(x$20335=t0$20329[1]);acc$20297.push([x$20335,$15906(ys$20290,i$20334)]);}else{$20197(m$20324);}}return acc$20297;});
var $20350=(function(from$20353,to$20354){var rval$20359;(rval$20359=[]);var i$20365;(i$20365=from$20353);$20358:for(;(i$20365<=to$20354);(i$20365++)){rval$20359.push(i$20365);}return rval$20359;});var accum$16953;var accum$16957;var accum$17742;var accum$17746;var $15965$15999;var __lt____gt__$16000;var $15966$16001;var __lt____lt____colon__$16002;var util$16003;var GenSym$16004;var gensym$16005;var neighbours$16006;var classify$16007;var classify_contiguous$16008;var identity$16009;var $15968$16010;var checker_db$16011;var PatternParser$16012;var PatternProcessor$16013;var assemble_conditions$16014;var assemble_pattern$16015;var inject_below_uses$16016;var parse_pattern$16017;var checkall$16018;var same_block$16019;var parse_clauses$16020;var opt_clauses$16021;var weave_clauses$16022;($15965$15999=require("./pp"));(__lt____gt__$16000=$15965$15999["<>"]);($15966$16001=require("./location"));(__lt____lt____colon__$16002=$15966$16001["<<:"]);(util$16003=require("./util"));(GenSym$16004=util$16003.GenSym);(gensym$16005=util$16003.gensym);(neighbours$16006=util$16003.neighbours);(classify$16007=util$16003.classify);(classify_contiguous$16008=util$16003.classify_contiguous);(identity$16009=util$16003.identity);($15968$16010=require("./expand"));(checker_db$16011=$15968$16010.checker_db);(PatternParser$16012=(function(scope$16066,pattern$16067,opt$16068){var tags$16084;var it$0$16071;(it$0$16071=(function(){if((!$15887(PatternParser$16012)(this))){return Object.create(PatternParser$16012.prototype);}else{return this;}})());(it$0$16071["opt"]=opt$16068);(it$0$16071["arguments"]=[]);(it$0$16071["vars"]=[]);(it$0$16071["specials"]=({}));(tags$16084=$19805((opt$16068.tags||({}))));(tags$16084["group_id"]=(tags$16084.group_id||gensym$16005("group")));(it$0$16071["pattern"]=it$0$16071.expand(scope$16066,pattern$16067,tags$16084,true,it$0$16071.opt.indexable));return it$0$16071;}));(PatternParser$16012.prototype["parse_specs"]=(function(scope$16108,specs$16109,tags$16110){var $index$16171;var $length$16165;var temp$16159;var acc$16153;var rest$16128;var has_defaults$16129;var rval$16130;var it$0$16114;var self$16115;(it$0$16114=this);(self$16115=this);(rest$16128=(void 0));(has_defaults$16129=false);(rval$16130=classify$16007("fw","bw","keys","defaults",(((acc$16153=[])),(((temp$16159=scope$16108.step_all(["pattern"],specs$16109))),((($length$16165=temp$16159.length)),((($index$16171=0)),(function(){$16139:for(;($index$16171<$length$16165);($index$16171++)){var v$16245;var v$16239;var variable$16227;var value$16228;var key$16220;var subp$16221;var key$16214;var variable$16194;var $16147$16188;var $16148$16189;var $16149$16190;var $16150$16191;var t0$16185;var t1$16186;var m$16180;(m$16180=temp$16159[$index$16171]);(t0$16185=m$16180);if((($16148$16189=(t0$16185 instanceof Array))&&(((t1$16186=t0$16185.length)),(($16150$16191=(t1$16186===2))&&(t0$16185[0]==="dynsplice"))))){(variable$16194=t0$16185[1]);acc$16153.push((((rest$16128=it$0$16114.expand(scope$16108,variable$16194,tags$16110))),["ignore"]));}else{if(($16150$16191&&(t0$16185[0]==="assoc"))){(key$16214=t0$16185[1]);acc$16153.push(["keys",[key$16214,it$0$16114.expand(scope$16108,key$16214,tags$16110)]]);}else{if(($16148$16189&&(($16150$16191=(t1$16186===3))&&(t0$16185[0]==="assoc")))){(key$16220=t0$16185[1]);(subp$16221=t0$16185[2]);acc$16153.push(["keys",[key$16220,it$0$16114.expand(scope$16108,subp$16221,tags$16110)]]);}else{if(($16150$16191&&(t0$16185[0]==="default"))){(variable$16227=t0$16185[1]);(value$16228=t0$16185[2]);acc$16153.push((((has_defaults$16129=true)),(function(){if(rest$16128){throw $19938(["syntax","pattern"]).create("No default arguments after rest arg.");}else{return ["defaults",[it$0$16114.expand(scope$16108,variable$16227,tags$16110),value$16228]];}})()));}else{(v$16239=m$16180);if(((rest$16128===(void 0))&&(!has_defaults$16129))){acc$16153.push(["fw",it$0$16114.expand(scope$16108,v$16239,tags$16110)]);}else{(v$16245=m$16180);acc$16153.push(["bw",it$0$16114.expand(scope$16108,v$16245,tags$16110)]);}}}}}}})()))),acc$16153)));(rval$16130["rest"]=rest$16128);return rval$16130;}));(PatternParser$16012.prototype["expand"]=(function(){var x$16345;var x$16355;var x$16384;var x$16390;var variable$16397;var variable$16414;var x$16454;var msg$16462;var msg$16478;var $index$16520;var $length$16514;var temp$16508;var acc$16502;var $index$16653;var $length$16647;var temp$16641;var acc$16635;var $index$16689;var $length$16683;var temp$16677;var t0$16764;var t1$16765;var t2$16766;var $index$16812;var $length$16806;var temp$16800;var acc$16794;var patts$16786;var canon$16550;var normalize$16551;var pps$16552;var vars$16553;var patt$16887;var msg$16933;var other$16929;var keys$16893;var fw$16866;var bw$16867;var defaults$16868;var rest$16869;var $16844$16863;var t0$16856;var t1$16857;var t2$16858;var t3$16859;var t4$16860;var t5$16861;var $16840$16851;var specs$16845;var other$16945;var mode$16939;var subp$16940;var args$16835;var xs$16542;var xs$16494;var x$16484;var f$16468;var arg$16469;var f$16443;var arguments$16444;var checker$16437;var subp$16438;var projector$16431;var subp$16432;var condition$16425;var subp$16426;var v$16420;var v$16403;var type$16362;var $16321$16336;var $16322$16337;var $16323$16338;var $16324$16339;var t0$16332;var bridge$16306$16333;var t1$16334;var $16301$16327;var expr$16294;var rval$16295;var scope$16280;var pattern$16281;var tags$16282;var toplevel$16283;var checked$16284;var t0$16276;var $16259$16271;var it$0$16261;var self$16262;(it$0$16261=this);(self$16262=this);($16259$16271=arguments);(t0$16276=$16259$16271.length);if(((t0$16276>=3)&&(t0$16276<=5))){(scope$16280=$16259$16271[0]);(pattern$16281=$16259$16271[1]);(tags$16282=$16259$16271[2]);(toplevel$16283=(function(){if((3>=t0$16276)){return false;}else{return $16259$16271[3];}})());(checked$16284=(function(){if((4>=t0$16276)){return false;}else{return $16259$16271[4];}})());(expr$16294=scope$16280.step(["pattern"],pattern$16281));(rval$16295=((($16301$16327=expr$16294)),(function(){if((((x$16345=$16301$16327)),((x$16345 instanceof Array)&&(x$16345[0]==="void")))){return ["check",checker_db$16011.null,["ignore"]];}else{if((((x$16355=$16301$16327)),((x$16355 instanceof Array)&&(x$16355[0]==="ignore")))){return expr$16294;}else{if((($16301$16327 instanceof Array)&&(((t0$16332=$16301$16327.length)),((t0$16332===2)&&($16301$16327[0]==="special"))))){(type$16362=$16301$16327[1]);(it$0$16261.specials[type$16362]=true);return expr$16294;}else{(bridge$16306$16333=$16301$16327);if(((((x$16384=bridge$16306$16333)),((x$16384 instanceof Array)&&(x$16384[0]==="symbol")))||(((x$16390=bridge$16306$16333)),((x$16390 instanceof Array)&&(x$16390[0]==="variable"))))){(variable$16397=$20216(expr$16294,tags$16282));it$0$16261.vars.push(variable$16397);return ["assign",variable$16397];}else{if((($16321$16336=($16301$16327 instanceof Array))&&(((t0$16332=$16301$16327.length)),(($16323$16338=(t0$16332===2))&&(($16324$16339=($16301$16327[0]==="value"))&&((v$16403=$16301$16327[1]),it$0$16261.opt.strings_as_variables)))))){(variable$16414=__lt____lt____colon__$16002($20216(["symbol",v$16403],tags$16282),expr$16294));it$0$16261.vars.push(variable$16414);return ["assign",variable$16414];}else{if($16324$16339){(v$16420=$16301$16327[1]);return ["check",checker_db$16011(v$16420),["ignore"]];}else{if(($16321$16336&&(($16323$16338=(t0$16332===3))&&($16301$16327[0]==="test")))){(condition$16425=$16301$16327[1]);(subp$16426=$16301$16327[2]);return ["test",condition$16425,it$0$16261.expand(scope$16280,subp$16426,tags$16282,toplevel$16283,false)];}else{if(($16323$16338&&($16301$16327[0]==="project"))){(projector$16431=$16301$16327[1]);(subp$16432=$16301$16327[2]);return ["project",projector$16431,it$0$16261.expand(scope$16280,subp$16432,tags$16282,toplevel$16283,true)];}else{if(($16323$16338&&($16301$16327[0]==="check"))){(checker$16437=$16301$16327[1]);(subp$16438=$16301$16327[2]);return ["check",checker$16437,it$0$16261.expand(scope$16280,subp$16438,tags$16282,toplevel$16283,true)];}else{if(($16323$16338&&(($16324$16339=($16301$16327[0]==="send"))&&((f$16443=$16301$16327[1]),(((t1$16334=$16301$16327[2])),(((x$16454=t1$16334)),((x$16454 instanceof Array)&&(x$16454[0]==="data")))))))){(arguments$16444=t1$16334);if(toplevel$16283){it$0$16261.arguments.unshift(arguments$16444);return it$0$16261.expand(scope$16280,f$16443,tags$16282,true,false);}else{(msg$16462="Function arguments can only be declared as a top level pattern.");throw $19938(["syntax","pattern"]).create(msg$16462,({"node":expr$16294,"arg":arguments$16444}));}}else{if($16324$16339){(f$16468=$16301$16327[1]);(arg$16469=$16301$16327[2]);return ["assign",expr$16294];}else{$16301$16327;if((!it$0$16261.opt.allow_nested)){(msg$16478="Nested patterns are not allowed here.");throw $19938(["syntax","pattern"]).create(msg$16478,({"node":expr$16294}));}else{if((($16321$16336=($16301$16327 instanceof Array))&&(((t0$16332=$16301$16327.length)),((t0$16332===2)&&($16301$16327[0]==="neg"))))){(x$16484=$16301$16327[1]);return ["neg",it$0$16261.expand(scope$16280,x$16484,tags$16282)];}else{if(($16321$16336&&(($16323$16338=(t0$16332>=1))&&($16301$16327[0]==="all")))){(xs$16494=Array.prototype.slice.call($16301$16327,1));return ["all"].concat((((acc$16502=[])),(((temp$16508=xs$16494)),((($length$16514=temp$16508.length)),((($index$16520=0)),(function(){$16497:for(;($index$16520<$length$16514);($index$16520++)){var x$16537;var m$16529;(m$16529=temp$16508[$index$16520]);(x$16537=m$16529);acc$16502.push(it$0$16261.expand(scope$16280,x$16537,tags$16282));}})()))),acc$16502));}else{if(($16323$16338&&($16301$16327[0]==="any"))){(xs$16542=Array.prototype.slice.call($16301$16327,1));(canon$16550=(function(all$16561){return all$16561.sort().join(",");}));(normalize$16551=(function(vars$16568){var $index$16593;var $length$16587;var temp$16581;var acc$16575;return canon$16550((((acc$16575=[])),(((temp$16581=vars$16568)),((($length$16587=temp$16581.length)),((($index$16593=0)),(function(){$16570:for(;($index$16593<$length$16587);($index$16593++)){var v$16612;var t0$16607;var t1$16608;var m$16602;(m$16602=temp$16581[$index$16593]);(t0$16607=m$16602);if(((t0$16607 instanceof Array)&&(((t1$16608=t0$16607.length)),((t1$16608===2)&&(t0$16607[0]==="symbol"))))){(v$16612=t0$16607[1]);acc$16575.push(v$16612);}else{$20197(m$16602,"/home/olivier/git/earl-grey/src/pattern.eg",3845,3902);}}})()))),acc$16575));}));(pps$16552=(((acc$16635=[])),(((temp$16641=xs$16542)),((($length$16647=temp$16641.length)),((($index$16653=0)),(function(){$16630:for(;($index$16653<$length$16647);($index$16653++)){var x$16670;var m$16662;(m$16662=temp$16641[$index$16653]);(x$16670=m$16662);acc$16635.push(PatternParser$16012(scope$16280,x$16670,$20216(it$0$16261.opt,({"tags":tags$16282}))));}})()))),acc$16635));(temp$16677=neighbours$16006(pps$16552));($length$16683=temp$16677.length);($index$16689=0);$16554:for(;($index$16689<$length$16683);($index$16689++)){var $index$16740;var $length$16734;var temp$16728;var pp1$16708;var pp2$16709;var t0$16703;var t1$16704;var m$16698;(m$16698=temp$16677[$index$16689]);(t0$16703=m$16698);if(((t0$16703 instanceof Array)&&(((t1$16704=t0$16703.length)),(t1$16704===2)))){(pp1$16708=t0$16703[0]);(pp2$16709=t0$16703[1]);(temp$16728=pps$16552);($length$16734=temp$16728.length);($index$16740=0);$16722:for(;($index$16740<$length$16734);($index$16740++)){var pp$16757;var m$16749;(m$16749=temp$16728[$index$16740]);(pp$16757=m$16749);normalize$16551(pp$16757.vars);}if((normalize$16551(pp1$16708.vars)!==normalize$16551(pp2$16709.vars))){throw $19938(["syntax","pattern"]).create("Both branches of 'or' must contain the same variables",({"vars1":__lt____lt____colon__$16002(pp1$16708.vars.sort(),pp1$16708.pattern),"vars2":__lt____lt____colon__$16002(pp2$16709.vars.sort(),pp2$16709.pattern)}));}if((canon$16550($20238(pp1$16708.specials))!==canon$16550($20238(pp2$16709.specials)))){throw $19938(["syntax","pattern"]).create("Both branches of 'or' must contain the same special tokens",({"special1":__lt____lt____colon__$16002($20238(pp1$16708.specials).sort(),pp1$16708.pattern),"special2":__lt____lt____colon__$16002($20238(pp2$16709.specials).sort(),pp2$16709.pattern)}));}}else{$20197(m$16698,"/home/olivier/git/earl-grey/src/pattern.eg",3994,4791);}}(t0$16764=pps$16552);if(((t0$16764 instanceof Array)&&(((t1$16765=t0$16764.length)),((t1$16765>=1)&&(((t2$16766=t0$16764[0])),$19889(t2$16766,"vars")))))){(vars$16553=t2$16766.vars);Array.prototype.slice.call(t0$16764,1);}else{$20197(pps$16552,"/home/olivier/git/earl-grey/src/pattern.eg",4808,4811);}(it$0$16261["vars"]=it$0$16261.vars.concat(vars$16553));(patts$16786=(((acc$16794=[])),(((temp$16800=pps$16552)),((($length$16806=temp$16800.length)),((($index$16812=0)),(function(){$16789:for(;($index$16812<$length$16806);($index$16812++)){var pp$16829;var m$16821;(m$16821=temp$16800[$index$16812]);(pp$16829=m$16821);acc$16794.push(pp$16829.pattern);}})()))),acc$16794));return ["any"].concat(patts$16786);}else{if(($16323$16338&&($16301$16327[0]==="data"))){(args$16835=Array.prototype.slice.call($16301$16327,1));(specs$16845=it$0$16261.parse_specs(scope$16280,args$16835,tags$16282));($16840$16851=specs$16845);if((($16844$16863=$19889($16840$16851,"keys"))&&(((t0$16856=$16840$16851.keys)),((t0$16856 instanceof Array)&&(((t1$16857=t0$16856.length)),((t1$16857===0)&&($19889($16840$16851,"fw")&&((fw$16866=$16840$16851.fw),($19889($16840$16851,"bw")&&((bw$16867=$16840$16851.bw),($19889($16840$16851,"defaults")&&((defaults$16868=$16840$16851.defaults),$19889($16840$16851,"rest"))))))))))))){(rest$16869=$16840$16851.rest);(patt$16887=__lt____lt____colon__$16002(["array_pattern",fw$16866,bw$16867,defaults$16868,rest$16869],pattern$16281));if(checked$16284){return patt$16887;}else{return ["check",checker_db$16011.Array,patt$16887];}}else{if(($16844$16863&&((keys$16893=$16840$16851.keys),($19889($16840$16851,"fw")&&(((t0$16856=$16840$16851.fw)),((t0$16856 instanceof Array)&&(((t1$16857=t0$16856.length)),((t1$16857===0)&&($19889($16840$16851,"bw")&&(((t2$16858=$16840$16851.bw)),((t2$16858 instanceof Array)&&(((t3$16859=t2$16858.length)),((t3$16859===0)&&($19889($16840$16851,"defaults")&&(((t4$16860=$16840$16851.defaults)),((t4$16860 instanceof Array)&&(((t5$16861=t4$16860.length)),((t5$16861===0)&&($19889($16840$16851,"rest")&&($16840$16851.rest===(void 0))))))))))))))))))))){return ["object_pattern"].concat(keys$16893);}else{(other$16929=$16840$16851);(msg$16933="Pattern must be an array or an object.");throw $19938(["syntax","pattern"]).create(msg$16933,({"node":expr$16294,"specs":specs$16845}));}}}else{if(($16321$16336&&((t0$16332===3)&&($16301$16327[0]==="mode")))){(mode$16939=$16301$16327[1]);(subp$16940=$16301$16327[2]);return it$0$16261.expand(scope$16280,subp$16940,$20216(tags$16282,({"declare_mode":mode$16939})),toplevel$16283,checked$16284);}else{(other$16945=$16301$16327);throw $19938(["syntax","pattern"]).create("Illegal pattern",({"node":other$16945}));}}}}}}}}}}}}}}}}}})()));return (it$0$16261.opt.wrap_pattern||identity$16009)(__lt____lt____colon__$16002(rval$16295,pattern$16281),toplevel$16283);}else{$20197($16259$16271);}}));$15907(PatternParser$16012,$15907(((accum$16953=({})),((accum$16953["::name"]="PatternParser"),accum$16953)),((accum$16957=({})),((accum$16957["::egclass"]=true),accum$16957))));PatternParser$16012;(PatternProcessor$16013=(function(){var it$0$16966;(it$0$16966=(function(){if((!$15887(PatternProcessor$16013)(this))){return Object.create(PatternProcessor$16013.prototype);}else{return this;}})());(it$0$16966["temps"]=[]);(it$0$16966["parts"]=[]);(it$0$16966["gen"]=GenSym$16004("t"));return it$0$16966;}));(PatternProcessor$16013.prototype["do"]=(function(part$16990){var it$0$16994;var self$16995;(it$0$16994=this);(self$16995=this);return it$0$16994.parts.push(["do",part$16990]);}));(PatternProcessor$16013.prototype["check"]=(function(){var part$17031;var tags$17032;var t0$17027;var $17010$17022;var it$0$17012;var self$17013;(it$0$17012=this);(self$17013=this);($17010$17022=arguments);(t0$17027=$17010$17022.length);if(((t0$17027>=1)&&(t0$17027<=2))){(part$17031=$17010$17022[0]);(tags$17032=(function(){if((1>=t0$17027)){return ({});}else{return $17010$17022[1];}})());return it$0$17012.parts.push($20216(["check",part$17031],tags$17032));}else{$20197($17010$17022);}}));(PatternProcessor$16013.prototype["temp"]=(function(){var x$17099;var x$17105;var init$17112;var bridge$17079$17088;var $17077$17083;var x$17069;var v$17070;var t0$17065;var $17048$17060;var it$0$17050;var self$17051;(it$0$17050=this);(self$17051=this);($17048$17060=arguments);(t0$17065=$17048$17060.length);if(((t0$17065>=1)&&(t0$17065<=2))){(x$17069=$17048$17060[0]);(v$17070=(function(){if((1>=t0$17065)){return null;}else{return $17048$17060[1];}})());($17077$17083=x$17069);(bridge$17079$17088=$17077$17083);if((((((x$17099=bridge$17079$17088)),((x$17099 instanceof Array)&&(x$17099[0]==="variable")))||(((x$17105=bridge$17079$17088)),((x$17105 instanceof Array)&&(x$17105[0]==="symbol"))))&&($19889($17077$17083,"single_assignment")&&($17077$17083.single_assignment&&(!v$17070))))){return x$17069;}else{(init$17112=$17077$17083);(v$17070=(v$17070||["symbol",it$0$17050.gen()]));(v$17070["single_assignment"]=true);it$0$17050.temps.push(v$17070);it$0$17050.do(["send",["symbol","="],["data",["send",["symbol","set"],v$17070],init$17112]]);return v$17070;}}else{$20197($17048$17060);}}));(PatternProcessor$16013.prototype["process"]=(function(pattern$17129,rhs$17130,fns$17131){var x$17184;var x$17218;var t$17231;var t$17243;var pp$17254;var $index$17287;var $length$17281;var temp$17275;var t$17265;var $index$17355;var $length$17349;var temp$17343;var acc$17337;var fn$17320;var parts$17321;var t$17313;var $index$17416;var $length$17410;var temp$17404;var acc$17398;var t$17389;var otherwise$17549;var $17527$17533;var $index$17566;var $length$17560;var temp$17554;var $index$17615;var $length$17609;var temp$17603;var end$17677;var pos$17671;var $index$17701;var $length$17695;var temp$17689;var acc$17683;var nfw$17482;var nbw$17483;var ndflt$17484;var extract_length$17485;var check_length$17486;var lo$17487;var hi$17488;var t$17489;var len$17490;var fw$17466;var bw$17467;var dflt$17468;var rest$17469;var subp$17384;var xs$17308;var xs$17260;var patt$17249;var projector$17237;var subp$17238;var checker$17225;var subp$17226;var checker$17213;var condition$17206;var subp$17207;var kind$17201;var sym$17191;var $17162$17175;var $17163$17176;var $17164$17177;var $17165$17178;var t0$17173;var $17149$17168;var rval$17146;var it$0$17135;var self$17136;(it$0$17135=this);(self$17136=this);(rval$17146=((($17149$17168=pattern$17129)),(function(){if((((x$17184=$17149$17168)),((x$17184 instanceof Array)&&(x$17184[0]==="ignore")))){return it$0$17135.do(rhs$17130);}else{if((($17162$17175=($17149$17168 instanceof Array))&&(((t0$17173=$17149$17168.length)),(($17164$17177=(t0$17173===2))&&($17149$17168[0]==="assign"))))){(sym$17191=$17149$17168[1]);return it$0$17135.parts.push(fns$17131.assign(sym$17191,rhs$17130));}else{if(($17164$17177&&($17149$17168[0]==="special"))){(kind$17201=$17149$17168[1]);return it$0$17135.process(fns$17131.special(pattern$17129,rhs$17130),rhs$17130,fns$17131);}else{if(($17162$17175&&(($17164$17177=(t0$17173===3))&&($17149$17168[0]==="test")))){(condition$17206=$17149$17168[1]);(subp$17207=$17149$17168[2]);it$0$17135.process(subp$17207,rhs$17130,fns$17131);return it$0$17135.check(condition$17206,({"test":true}));}else{if(($17164$17177&&(($17165$17178=($17149$17168[0]==="check"))&&((checker$17213=$17149$17168[1]),(((x$17218=$17149$17168[2])),((x$17218 instanceof Array)&&(x$17218[0]==="ignore"))))))){return it$0$17135.check(["send",checker$17213,["data",rhs$17130]]);}else{if($17165$17178){(checker$17225=$17149$17168[1]);(subp$17226=$17149$17168[2]);(t$17231=it$0$17135.temp(rhs$17130));it$0$17135.check(["send",checker$17225,["data",t$17231]]);return it$0$17135.process(subp$17226,t$17231,fns$17131);}else{if(($17164$17177&&($17149$17168[0]==="project"))){(projector$17237=$17149$17168[1]);(subp$17238=$17149$17168[2]);(t$17243=it$0$17135.temp(["send",projector$17237,["data",rhs$17130]]));it$0$17135.check(["send",t$17243,["value",0]]);return it$0$17135.process(subp$17238,["send",t$17243,["value",1]],fns$17131);}else{if(($17162$17175&&((t0$17173===2)&&($17149$17168[0]==="neg")))){(patt$17249=$17149$17168[1]);return it$0$17135.check(["send",["symbol","not"],["data",["void"],(((pp$17254=PatternProcessor$16013())),pp$17254.process(patt$17249,rhs$17130,fns$17131),assemble_conditions$16014(pp$17254))]]);}else{if(($17162$17175&&(($17164$17177=(t0$17173>=1))&&($17149$17168[0]==="all")))){(xs$17260=Array.prototype.slice.call($17149$17168,1));(t$17265=it$0$17135.temp(rhs$17130));(temp$17275=xs$17260);($length$17281=temp$17275.length);($index$17287=0);$17266:for(;($index$17287<$length$17281);($index$17287++)){var x$17304;var m$17296;(m$17296=temp$17275[$index$17287]);(x$17304=m$17296);it$0$17135.process(x$17304,t$17265,fns$17131);}return null;}else{if(($17164$17177&&($17149$17168[0]==="any"))){(xs$17308=Array.prototype.slice.call($17149$17168,1));(t$17313=it$0$17135.temp(rhs$17130,["symbol",gensym$16005("bridge")]));return it$0$17135.check((((fn$17320=(function(x$17326,rest$17327){return ["send",["symbol","or"],["data",x$17326,rest$17327]];}))),((parts$17321=(((acc$17337=[])),(((temp$17343=xs$17308)),((($length$17349=temp$17343.length)),((($index$17355=0)),(function(){$17332:for(;($index$17355<$length$17349);($index$17355++)){var pp$17377;var x$17372;var m$17364;(m$17364=temp$17343[$index$17355]);(x$17372=m$17364);acc$17337.push((((pp$17377=PatternProcessor$16013())),pp$17377.process(x$17372,t$17313,fns$17131),assemble_conditions$16014(pp$17377)));}})()))),acc$17337))),util$16003.construct(parts$17321,fn$17320,["symbol","false"])));}else{if(($17164$17177&&($17149$17168[0]==="object_pattern"))){(subp$17384=Array.prototype.slice.call($17149$17168,1));(t$17389=it$0$17135.temp(rhs$17130));(acc$17398=[]);(temp$17404=subp$17384);($length$17410=temp$17404.length);($index$17416=0);$17390:for(;($index$17416<$length$17410);($index$17416++)){var k$17437;var v$17438;var t0$17430;var t1$17431;var t2$17432;var t3$17433;var m$17425;(m$17425=temp$17404[$index$17416]);(t0$17430=m$17425);if(((t0$17430 instanceof Array)&&(((t1$17431=t0$17430.length)),((t1$17431===2)&&(((t2$17432=t0$17430[0])),((t2$17432 instanceof Array)&&(((t3$17433=t2$17432.length)),((t3$17433===2)&&(t2$17432[0]==="value"))))))))){(k$17437=t2$17432[1]);(v$17438=t0$17430[1]);acc$17398.push((it$0$17135.check(["send",["symbol","___hasprop"],["data",t$17389,["value",k$17437]]]),it$0$17135.process(v$17438,["send",t$17389,["value",k$17437]],fns$17131)));}else{$20197(m$17425,"/home/olivier/git/earl-grey/src/pattern.eg",8140,8272);}}return acc$17398;}else{if(($17162$17175&&((t0$17173===5)&&($17149$17168[0]==="array_pattern")))){(fw$17466=$17149$17168[1]);(bw$17467=$17149$17168[2]);(dflt$17468=$17149$17168[3]);(rest$17469=$17149$17168[4]);(nfw$17482=fw$17466.length);(nbw$17483=bw$17467.length);(ndflt$17484=dflt$17468.length);(extract_length$17485=true);(check_length$17486=true);(lo$17487=(nfw$17482+nbw$17483));(hi$17488=(lo$17487+ndflt$17484));(t$17489=it$0$17135.temp(rhs$17130));(len$17490=it$0$17135.temp(["send",t$17489,["send",["symbol","."],["data",["void"],["symbol","length"]]]]));it$0$17135.check(((($17527$17533=rest$17469)),(function(){if($17527$17533){return ["send",["symbol",">="],["data",len$17490,["value",lo$17487]]];}else{$17527$17533;if((lo$17487===hi$17488)){return ["send",["symbol","==="],["data",len$17490,["value",lo$17487]]];}else{(otherwise$17549=$17527$17533);return ["send",["symbol","and"],["data",["send",["symbol",">="],["data",len$17490,["value",lo$17487]]],["send",["symbol","<="],["data",len$17490,["value",hi$17488]]]]];}}})()));(temp$17554=$20171(fw$17466));($length$17560=temp$17554.length);($index$17566=0);$17491:for(;($index$17566<$length$17560);($index$17566++)){var i$17585;var m$17586;var t0$17580;var t1$17581;var m$17575;(m$17575=temp$17554[$index$17566]);(t0$17580=m$17575);if(((t0$17580 instanceof Array)&&(((t1$17581=t0$17580.length)),(t1$17581===2)))){(i$17585=t0$17580[0]);(m$17586=t0$17580[1]);it$0$17135.process(m$17586,["send",t$17489,["value",i$17585]],fns$17131);}else{$20197(m$17575,"/home/olivier/git/earl-grey/src/pattern.eg",9004,9090);}}(temp$17603=$20171(dflt$17468));($length$17609=temp$17603.length);($index$17615=0);$17494:for(;($index$17615<$length$17609);($index$17615++)){var idx$17663;var i$17636;var patt$17637;var value$17638;var t0$17629;var t1$17630;var t2$17631;var t3$17632;var m$17624;(m$17624=temp$17603[$index$17615]);(t0$17629=m$17624);if(((t0$17629 instanceof Array)&&(((t1$17630=t0$17629.length)),((t1$17630===2)&&((i$17636=t0$17629[0]),(((t2$17631=t0$17629[1])),((t2$17631 instanceof Array)&&(((t3$17632=t2$17631.length)),(t3$17632===2))))))))){(patt$17637=t2$17631[0]);(value$17638=t2$17631[1]);(idx$17663=(i$17636+nfw$17482));it$0$17135.process(patt$17637,["send",["symbol","if"],["data",["send",["symbol",">="],["data",["value",(idx$17663+nbw$17483)],len$17490]],value$17638,["send",t$17489,["value",idx$17663]]]],fns$17131);}else{$20197(m$17624,"/home/olivier/git/earl-grey/src/pattern.eg",9090,9259);}}if((rest$17469!==(void 0))){(pos$17671=(nfw$17482+ndflt$17484));(end$17677=(function(){if((nbw$17483>0)){return [["value",(-nbw$17483)]];}else{return [];}})());it$0$17135.process(rest$17469,["send",["send",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",t$17489,["value",pos$17671]].concat(end$17677)],fns$17131);}else{[];}(acc$17683=[]);(temp$17689=$20171(bw$17467));($length$17695=temp$17689.length);($index$17701=0);$17497:for(;($index$17701<$length$17695);($index$17701++)){var i$17720;var m$17721;var t0$17715;var t1$17716;var m$17710;(m$17710=temp$17689[$index$17701]);(t0$17715=m$17710);if(((t0$17715 instanceof Array)&&(((t1$17716=t0$17715.length)),(t1$17716===2)))){(i$17720=t0$17715[0]);(m$17721=t0$17715[1]);acc$17683.push(it$0$17135.process(m$17721,["send",["symbol","___js_fetch"],["data",t$17489,["send",["symbol","-"],["data",len$17490,["value",(nbw$17483-i$17720)]]]]],fns$17131));}else{$20197(m$17710,"/home/olivier/git/earl-grey/src/pattern.eg",9710,9861);}}return acc$17683;}else{$20197($17149$17168);}}}}}}}}}}}}})()));return rval$17146;}));$15907(PatternProcessor$16013,$15907(((accum$17742=({})),((accum$17742["::name"]="PatternProcessor"),accum$17742)),((accum$17746=({})),((accum$17746["::egclass"]=true),accum$17746))));PatternProcessor$16013;(assemble_conditions$16014=(function(pp$17753){var $index$17877;var $length$17871;var temp$17865;var acc$17859;var decls$17851;var construct$17757;(construct$17757=(function($17761$17764){var x$17832;var rest$17833;var x$17817;var x$17801;var rest$17802;var $17771$17788;var $17772$17789;var t0$17784;var t1$17785;var t2$17786;var $17766$17779;var ph$17773;(ph$17773=$17761$17764);($17766$17779=ph$17773);if((($17771$17788=($17766$17779 instanceof Array))&&(((t0$17784=$17766$17779.length)),(t0$17784===0)))){return ["value",true];}else{if(($17771$17788&&((t0$17784>=1)&&(((t1$17785=$17766$17779[0])),((t1$17785 instanceof Array)&&(((t2$17786=t1$17785.length)),((t2$17786===2)&&(t1$17785[0]==="do")))))))){(x$17801=t1$17785[1]);(rest$17802=Array.prototype.slice.call($17766$17779,1));return ["multi",x$17801,construct$17757(rest$17802)];}else{if(($17771$17788&&((t0$17784===1)&&(((t1$17785=$17766$17779[0])),((t1$17785 instanceof Array)&&(((t2$17786=t1$17785.length)),((t2$17786===2)&&(t1$17785[0]==="check")))))))){(x$17817=t1$17785[1]);return x$17817;}else{if(($17771$17788&&((t0$17784>=1)&&(((t1$17785=$17766$17779[0])),((t1$17785 instanceof Array)&&(((t2$17786=t1$17785.length)),((t2$17786===2)&&(t1$17785[0]==="check")))))))){(x$17832=t1$17785[1]);(rest$17833=Array.prototype.slice.call($17766$17779,1));return ["send",["symbol","and"],["data",x$17832,construct$17757(rest$17833)]];}else{$20197($17766$17779);}}}}}));if(pp$17753.temps.length){(decls$17851=(((acc$17859=[])),(((temp$17865=pp$17753.temps)),((($length$17871=temp$17865.length)),((($index$17877=0)),(function(){$17854:for(;($index$17877<$length$17871);($index$17877++)){var t$17894;var m$17886;(m$17886=temp$17865[$index$17877]);(t$17894=m$17886);acc$17859.push(["declare",t$17894]);}})()))),acc$17859));return ["multi"].concat(decls$17851).concat([construct$17757(pp$17753.parts)]);}else{return construct$17757(pp$17753.parts);}}));(assemble_pattern$16015=(function(){var $index$17966;var $length$17960;var temp$17954;var $index$18027;var $length$18021;var temp$18015;var test$18166;var lead$17929;var trail$17930;var construct$17931;var parts$17916;var t$17917;var f$17918;var t0$17912;var $17903$17907;($17903$17907=arguments);(t0$17912=$17903$17907.length);if(((t0$17912>=2)&&(t0$17912<=3))){(parts$17916=$17903$17907[0]);(t$17917=$17903$17907[1]);(f$17918=(function(){if((2>=t0$17912)){return null;}else{return $17903$17907[2];}})());(lead$17929=[]);(temp$17954=parts$17916.slice(0));($length$17960=temp$17954.length);($index$17966=0);$17932:for(;($index$17966<$length$17960);($index$17966++)){var x$18004;var x$17989;var $17936$17983;var $17937$17984;var $17938$17985;var $17939$17986;var t0$17980;var t1$17981;var m$17975;(m$17975=temp$17954[$index$17966]);(t0$17980=m$17975);if((($17937$17984=(t0$17980 instanceof Array))&&(((t1$17981=t0$17980.length)),(($17939$17986=(t1$17981===2))&&(t0$17980[0]==="do"))))){(x$17989=t0$17980[1]);lead$17929.push(x$17989);parts$17916.shift();}else{if(($17939$17986&&(t0$17980[0]==="check"))){(x$18004=t0$17980[1]);break $17932;}else{$20197(m$17975,"/home/olivier/git/earl-grey/src/pattern.eg",10322,10432);}}}(trail$17930=[]);(temp$18015=parts$17916.slice(0).reverse());($length$18021=temp$18015.length);($index$18027=0);$17940:for(;($index$18027<$length$18021);($index$18027++)){var x$18065;var x$18050;var $17944$18044;var $17945$18045;var $17946$18046;var $17947$18047;var t0$18041;var t1$18042;var m$18036;(m$18036=temp$18015[$index$18027]);(t0$18041=m$18036);if((($17945$18045=(t0$18041 instanceof Array))&&(((t1$18042=t0$18041.length)),(($17947$18047=(t1$18042===2))&&(t0$18041[0]==="do"))))){(x$18050=t0$18041[1]);trail$17930.unshift(x$18050);parts$17916.pop();}else{if(($17947$18047&&(t0$18041[0]==="check"))){(x$18065=t0$18041[1]);break $17940;}else{$20197(m$18036,"/home/olivier/git/earl-grey/src/pattern.eg",10446,10568);}}}(construct$17931=(function($18073$18076){var other$18161;var x$18145;var rest$18146;var x$18130;var x$18114;var rest$18115;var $18084$18101;var $18085$18102;var t0$18097;var t1$18098;var t2$18099;var $18078$18092;var ph$18086;(ph$18086=$18073$18076);($18078$18092=ph$18086);if((($18084$18101=($18078$18092 instanceof Array))&&(((t0$18097=$18078$18092.length)),(t0$18097===0)))){return ["value",true];}else{if(($18084$18101&&((t0$18097>=1)&&(((t1$18098=$18078$18092[0])),((t1$18098 instanceof Array)&&(((t2$18099=t1$18098.length)),((t2$18099===2)&&(t1$18098[0]==="do")))))))){(x$18114=t1$18098[1]);(rest$18115=Array.prototype.slice.call($18078$18092,1));return ["multi",x$18114,construct$17931(rest$18115)];}else{if(($18084$18101&&((t0$18097===1)&&(((t1$18098=$18078$18092[0])),((t1$18098 instanceof Array)&&(((t2$18099=t1$18098.length)),((t2$18099===2)&&(t1$18098[0]==="check")))))))){(x$18130=t1$18098[1]);return x$18130;}else{if(($18084$18101&&((t0$18097>=1)&&(((t1$18098=$18078$18092[0])),((t1$18098 instanceof Array)&&(((t2$18099=t1$18098.length)),((t2$18099===2)&&(t1$18098[0]==="check")))))))){(x$18145=t1$18098[1]);(rest$18146=Array.prototype.slice.call($18078$18092,1));return ["send",["symbol","and"],["data",x$18145,construct$17931(rest$18146)]];}else{(other$18161=$18078$18092);throw $19938(["oops"]).create("?!?",other$18161);}}}}}));if(parts$17916.length){(test$18166=construct$17931(parts$17916));return ["multi"].concat(lead$17929).concat([(function(){if(f$17918){return ["send",["symbol","if"],["data",test$18166,["multi"].concat(trail$17930).concat([t$17917]),f$17918]];}else{return ["send",["symbol","if"],["data",test$18166,["multi"].concat(trail$17930).concat([t$17917])]];}})()]);}else{return ["multi"].concat(lead$17929).concat(trail$17930).concat([t$17917]);}}else{$20197($17903$17907);}}));(inject_below_uses$16016=(function($18176$18179,fn$18180){var other$18211;var scope$18200;var x$18201;var t0$18196;var $18182$18191;var ph$18185;(ph$18185=$18176$18179);($18182$18191=ph$18185);if((($18182$18191 instanceof Array)&&(((t0$18196=$18182$18191.length)),((t0$18196===3)&&($18182$18191[0]==="use"))))){(scope$18200=$18182$18191[1]);(x$18201=$18182$18191[2]);return ["use",scope$18200,inject_below_uses$16016(x$18201,fn$18180)];}else{(other$18211=$18182$18191);return fn$18180(other$18211);}}));(parse_pattern$16017=(function(scope$18218,pattern$18219,rhs$18220,opt$18221){var t0$18235;var $index$18287;var $length$18281;var temp$18275;var acc$18269;var parse$18227;var target$18228;var proc$18229;(parse$18227=PatternParser$16012(scope$18218,pattern$18219,opt$18221));if(((!opt$18221.allow_arguments)&&parse$18227.arguments.length)){throw $19938(["syntax","pattern","arguments"]).create("Arguments cannot be declared in this pattern",({"args":parse$18227.arguments[0]}));}(t0$18235=$20239((opt$18221.wrap_target||identity$16009))((function(){if(parse$18227.arguments.length){return inject_below_uses$16016(rhs$18220,(function(x$18242){return util$16003.construct(parse$18227.arguments.concat([x$18242]),(function(args$18246,rest$18247){return ["send",["symbol","->"],["data",args$18246,rest$18247]];}));}));}else{return rhs$18220;}})()));if(t0$18235[0]){(target$18228=t0$18235[1]);}else{$20197((function(){if(parse$18227.arguments.length){return inject_below_uses$16016(rhs$18220,(function(x$18254){return util$16003.construct(parse$18227.arguments.concat([x$18254]),(function(args$18258,rest$18259){return ["send",["symbol","->"],["data",args$18258,rest$18259]];}));}));}else{return rhs$18220;}})(),"/home/olivier/git/earl-grey/src/pattern.eg",11961,12394);}(proc$18229=PatternProcessor$16013());proc$18229.process(parse$18227.pattern,target$18228,opt$18221);if(opt$18221.finalize){return ["splice"].concat(opt$18221.declare(scope$18218,parse$18227.vars)).concat([["multi"].concat((((acc$18269=[])),(((temp$18275=proc$18229.temps)),((($length$18281=temp$18275.length)),((($index$18287=0)),(function(){$18264:for(;($index$18287<$length$18281);($index$18287++)){var t$18304;var m$18296;(m$18296=temp$18275[$index$18287]);(t$18304=m$18296);acc$18269.push(["declare",t$18304]);}})()))),acc$18269)).concat([assemble_pattern$16015(proc$18229.parts,opt$18221.success(target$18228),opt$18221.failure(target$18228))])]);}else{return [parse$18227.vars,proc$18229.temps,proc$18229.parts];}}));(checkall$16018=["send","data","multi","assign","void","check","do"]);(same_block$16019=(function($18314$18317,ban1$18318,ban2$18319){var $index$18483;var $length$18477;var temp$18471;var other$18505;var type1$18444;var args1$18445;var type2$18446;var args2$18447;var m1$18427;var m2$18428;var v1$18410;var v2$18411;var s1$18393;var s2$18394;var v1$18361;var v2$18362;var $18328$18352;var $18329$18353;var $18330$18354;var $18331$18355;var $18332$18356;var $18333$18357;var $18334$18358;var t0$18346;var t1$18347;var t2$18348;var t3$18349;var t4$18350;var $18321$18341;var ph$18335;(ph$18335=$18314$18317);($18321$18341=ph$18335);if((($18328$18352=($18321$18341 instanceof Array))&&(((t0$18346=$18321$18341.length)),(($18330$18354=(t0$18346===2))&&(((t1$18347=$18321$18341[0])),(($18332$18356=(t1$18347 instanceof Array))&&(((t2$18348=t1$18347.length)),(($18334$18358=(t2$18348===2))&&((t1$18347[0]==="variable")&&((v1$18361=t1$18347[1]),(((t3$18349=$18321$18341[1])),((t3$18349 instanceof Array)&&(((t4$18350=t3$18349.length)),((t4$18350===2)&&(t3$18349[0]==="variable"))))))))))))))){(v2$18362=t3$18349[1]);return (v1$18361===v2$18362);}else{if(($18334$18358&&((t1$18347[0]==="symbol")&&((s1$18393=t1$18347[1]),(((t3$18349=$18321$18341[1])),((t3$18349 instanceof Array)&&(((t4$18350=t3$18349.length)),((t4$18350===2)&&(t3$18349[0]==="symbol"))))))))){(s2$18394=t3$18349[1]);return (((!$15906(ban1$18318,s1$18393))&&(!$15906(ban2$18319,s2$18394)))&&(s1$18393===s2$18394));}else{if(($18334$18358&&((t1$18347[0]==="value")&&((v1$18410=t1$18347[1]),(((t3$18349=$18321$18341[1])),((t3$18349 instanceof Array)&&(((t4$18350=t3$18349.length)),((t4$18350===2)&&(t3$18349[0]==="value"))))))))){(v2$18411=t3$18349[1]);return (v1$18410===v2$18411);}else{if(($18334$18358&&((t1$18347[0]==="macro")&&((m1$18427=t1$18347[1]),(((t3$18349=$18321$18341[1])),((t3$18349 instanceof Array)&&(((t4$18350=t3$18349.length)),((t4$18350===2)&&(t3$18349[0]==="macro"))))))))){(m2$18428=t3$18349[1]);return (m1$18427===m2$18428);}else{if(($18332$18356&&((t2$18348>=1)&&((type1$18444=t1$18347[0]),((args1$18445=Array.prototype.slice.call(t1$18347,1)),(((t3$18349=$18321$18341[1])),((t3$18349 instanceof Array)&&(((t4$18350=t3$18349.length)),((t4$18350>=1)&&((type2$18446=t3$18349[0]),((args2$18447=Array.prototype.slice.call(t3$18349,1)),(checkall$16018.indexOf(type1$18444)!==-1)))))))))))){if(((type1$18444===type2$18446)&&(args1$18445.length===args2$18447.length))){(temp$18471=$20286(args1$18445,args2$18447));($length$18477=temp$18471.length);($index$18483=0);$18465:for(;($index$18483<$length$18477);($index$18483++)){var pair$18500;var m$18492;(m$18492=temp$18471[$index$18483]);(pair$18500=m$18492);if((!same_block$16019(pair$18500,ban1$18318,ban2$18319))){return false;}}return true;}else{return false;}}else{(other$18505=$18321$18341);return false;}}}}}}));(parse_clauses$16020=(function(scope$18512,target$18513,stmts$18514,opt$18515){var $index$18555;var $length$18549;var temp$18543;var acc$18537;var $index$18801;var $length$18795;var temp$18789;var acc$18783;var $index$18864;var $length$18858;var temp$18852;var acc$18846;var decls$18838;var all_temps$18521;var the_parts$18522;var unique_temps$18523;(all_temps$18521=[]);(the_parts$18522=(((acc$18537=[])),(((temp$18543=scope$18512.step_all(["clause"],stmts$18514))),((($length$18549=temp$18543.length)),((($index$18555=0)),(function(){$18529:for(;($index$18555<$length$18549);($index$18555++)){var accum$18667;var accum$18685;var t0$18659;var t1$18660;var $index$18712;var $length$18706;var temp$18700;var bod$18753;var placeholder$18594;var special_fn$18595;var vars$18596;var temps$18597;var blocks$18598;var vars2$18599;var x$18763;var other$18771;var b$18759;var pattern$18575;var body$18576;var $18534$18572;var t0$18569;var t1$18570;var m$18564;(m$18564=temp$18543[$index$18555]);(t0$18569=m$18564);if(((t0$18569 instanceof Array)&&(((t1$18570=t0$18569.length)),((t1$18570===3)&&(t0$18569[0]==="clause"))))){(pattern$18575=t0$18569[1]);(body$18576=t0$18569[2]);acc$18537.push((((placeholder$18594=(void 0))),((special_fn$18595=(function($18610$18613,value$18614){var t0$18622;var t1$18623;var other$18655;var $18616$18638;var ph$18619;var expr$18620;(t0$18622=$18610$18613);if(((t0$18622 instanceof Array)&&(((t1$18623=t0$18622.length)),((t1$18623===2)&&(t0$18622[0]==="special"))))){(ph$18619=t0$18622[1]);(expr$18620=t0$18622);}else{$20197($18610$18613);}($18616$18638=ph$18619);if(($18616$18638==="match")){(placeholder$18594=__lt____lt____colon__$16002(["symbol",scope$18512.gensym("ph")],expr$18620));return ["assign",placeholder$18594];}else{(other$18655=$18616$18638);throw $19938(["syntax","pattern","special"]).create("Special token cannot be used here",({"special":expr$18620}));}}))),(((t0$18659=parse_pattern$16017(scope$18512,pattern$18575,target$18513,$20216(opt$18515,$15907(({"allow_arguments":false,"allow_nested":true,"special":special_fn$18595}),$15907(((accum$18667=({})),((accum$18667["assign"]=(function(v$18672,value$18673){return ["do",__lt____lt____colon__$16002(["assign",v$18672,value$18673],v$18672)];})),accum$18667)),({"finalize":false}))))))),(function(){if(((t0$18659 instanceof Array)&&(((t1$18660=t0$18659.length)),(t1$18660===3)))){(vars$18596=t0$18659[0]);(temps$18597=t0$18659[1]);(blocks$18598=t0$18659[2]);}else{return $20197(parse_pattern$16017(scope$18512,pattern$18575,target$18513,$20216(opt$18515,$15907(({"allow_arguments":false,"allow_nested":true,"special":special_fn$18595}),$15907(((accum$18685=({})),((accum$18685["assign"]=(function(v$18690,value$18691){return ["do",__lt____lt____colon__$16002(["assign",v$18690,value$18691],v$18690)];})),accum$18685)),({"finalize":false}))))),"/home/olivier/git/earl-grey/src/pattern.eg",14032,14379);}})()),(all_temps$18521=all_temps$18521.concat(temps$18597)),(function(){if(placeholder$18594){return vars$18596.push(placeholder$18594);}})(),((vars2$18599=({}))),(((temp$18700=vars$18596)),((($length$18706=temp$18700.length)),((($index$18712=0)),(function(){$18600:for(;($index$18712<$length$18706);($index$18712++)){var other$18749;var xxx$18731;var t0$18726;var t1$18727;var m$18721;(m$18721=temp$18700[$index$18712]);(t0$18726=m$18721);if(((t0$18726 instanceof Array)&&(((t1$18727=t0$18726.length)),((t1$18727===2)&&(t0$18726[0]==="symbol"))))){(xxx$18731=t0$18726[1]);(vars2$18599[xxx$18731]=true);}else{(other$18749=m$18721);throw $19938(["syntax","unexpected"]).create();}}})()))),(((bod$18753=(function(){if(placeholder$18594){return parse_clauses$16020(scope$18512,placeholder$18594,$20239(["multi"])(body$18576)[1],opt$18515);}else{if(opt$18515.wrap){return opt$18515.wrap(body$18576);}else{return body$18576;}}})())),["clause",vars$18596,vars2$18599,blocks$18598,bod$18753])));}else{if((((x$18763=t0$18569)),((x$18763 instanceof Array)&&(x$18763[0]==="block")))){(b$18759=t0$18569);acc$18537.push(b$18759);}else{(other$18771=m$18564);acc$18537.push(function(){throw $19938(["syntax","clause"]).create("Illegal clause",({"clause":other$18771}));}());}}}})()))),acc$18537));if(opt$18515.fallback){the_parts$18522.push(["block",opt$18515.fallback(target$18513)]);}(unique_temps$18523=$20238(util$16003.mkset((((acc$18783=[])),(((temp$18789=all_temps$18521)),((($length$18795=temp$18789.length)),((($index$18801=0)),(function(){$18778:for(;($index$18801<$length$18795);($index$18801++)){var t$18820;var t0$18815;var t1$18816;var m$18810;(m$18810=temp$18789[$index$18801]);(t0$18815=m$18810);if(((t0$18815 instanceof Array)&&(((t1$18816=t0$18815.length)),((t1$18816===2)&&(t0$18815[0]==="symbol"))))){(t$18820=t0$18815[1]);acc$18783.push(t$18820);}else{$20197(m$18810,"/home/olivier/git/earl-grey/src/pattern.eg",15188,15218);}}})()))),acc$18783))));(decls$18838=(((acc$18846=[])),(((temp$18852=unique_temps$18523)),((($length$18858=temp$18852.length)),((($index$18864=0)),(function(){$18841:for(;($index$18864<$length$18858);($index$18864++)){var t$18881;var m$18873;(m$18873=temp$18852[$index$18864]);(t$18881=m$18873);acc$18846.push(["declare",$15907(["symbol",t$18881],({"mutable":true}))]);}})()))),acc$18846));return ["multi"].concat(decls$18838).concat([weave_clauses$16022(the_parts$18522)]);}));(opt_clauses$16021=(function(clauses$18890){var $index$18930;var $length$18924;var temp$18918;var acc$18912;var $index$19114;var $length$19108;var temp$19102;var acc$19096;var $index$19174;var $length$19168;var temp$19162;var acc$19156;var $index$19226;var $length$19220;var temp$19214;var acc$19208;var shares$18899;var max$18900;var temps$18901;var shared_last$18902;var idx_last$18903;var new_clauses$18904;(shares$18899=(((acc$18912=[])),(((temp$18918=$20171(clauses$18890.slice(1)))),((($length$18924=temp$18918.length)),((($index$18930=0)),(function(){$18907:for(;($index$18930<$length$18924);($index$18930++)){var t0$18991;var t1$18992;var $index$19026;var $length$19020;var temp$19014;var varsd0$18983;var blocks0$18984;var share$18985;var idx$18986;var i$18951;var vars$18952;var varsd$18953;var blocks$18954;var body$18955;var t0$18944;var t1$18945;var t2$18946;var t3$18947;var m$18939;(m$18939=temp$18918[$index$18930]);(t0$18944=m$18939);if(((t0$18944 instanceof Array)&&(((t1$18945=t0$18944.length)),((t1$18945===2)&&((i$18951=t0$18944[0]),(((t2$18946=t0$18944[1])),((t2$18946 instanceof Array)&&(((t3$18947=t2$18946.length)),((t3$18947===5)&&(t2$18946[0]==="clause")))))))))){(vars$18952=t2$18946[1]);(varsd$18953=t2$18946[2]);(blocks$18954=t2$18946[3]);(body$18955=t2$18946[4]);acc$18912.push(((((t0$18991=$15906(clauses$18890,i$18951))),(function(){if(((t0$18991 instanceof Array)&&(((t1$18992=t0$18991.length)),((t1$18992===5)&&(t0$18991[0]==="clause"))))){t0$18991[1];(varsd0$18983=t0$18991[2]);(blocks0$18984=t0$18991[3]);t0$18991[4];}else{return $20197($15906(clauses$18890,i$18951),"/home/olivier/git/earl-grey/src/pattern.eg",15511,15531);}})()),((share$18985=0)),((idx$18986=0)),(((temp$19014=blocks$18954)),((($length$19020=temp$19014.length)),((($index$19026=0)),(function(){$18987:for(;($index$19026<$length$19020);($index$19026++)){var x$19063;var x$19073;var other$19084;var $19046$19052;var b$19043;var m$19035;(m$19035=temp$19014[$index$19026]);(b$19043=m$19035);if(same_block$16019([$15906(blocks0$18984,share$18985),b$19043],varsd0$18983,varsd$18953)){(share$18985++);($19046$19052=b$19043);if((((x$19063=$19046$19052)),((x$19063 instanceof Array)&&(x$19063[0]==="do")))){null;}else{if((((x$19073=$19046$19052)),((x$19073 instanceof Array)&&(x$19073[0]==="check")))){(idx$18986=share$18985);}else{(other$19084=$19046$19052);__lt____gt__$16000(null,other$19084);}}}else{break $18987;}}})()))),[share$18985,idx$18986]));}else{$20197(m$18939,"/home/olivier/git/earl-grey/src/pattern.eg",15387,15915);}}})()))),acc$18912));(max$18900=$15906(Math.max,(((acc$19096=[])),(((temp$19102=shares$18899)),((($length$19108=temp$19102.length)),((($index$19114=0)),(function(){$19091:for(;($index$19114<$length$19108);($index$19114++)){var x$19133;var t0$19128;var t1$19129;var m$19123;(m$19123=temp$19102[$index$19114]);(t0$19128=m$19123);if(((t0$19128 instanceof Array)&&(((t1$19129=t0$19128.length)),(t1$19129===2)))){(x$19133=t0$19128[0]);t0$19128[1];acc$19096.push(x$19133);}else{$20197(m$19123,"/home/olivier/git/earl-grey/src/pattern.eg",15929,15958);}}})()))),acc$19096)));shares$18899.push([0,0]);(temps$18901=(((acc$19156=[])),(((temp$19162=$20350(1,max$18900))),((($length$19168=temp$19162.length)),((($index$19174=0)),(function(){$19151:for(;($index$19174<$length$19168);($index$19174++)){var m$19183;(m$19183=temp$19162[$index$19174]);m$19183;acc$19156.push(["symbol",gensym$16005()]);}})()))),acc$19156));(shared_last$18902=0);(idx_last$18903=0);(new_clauses$18904=(((acc$19208=[])),(((temp$19214=$20171(clauses$18890))),((($length$19220=temp$19214.length)),((($index$19226=0)),(function(){$19202:for(;($index$19226<$length$19220);($index$19226++)){var t0$19288;var t1$19289;var $index$19338;var $length$19332;var temp$19326;var acc$19320;var rest$19422;var newblocks$19417;var share$19282;var idx$19283;var shared$19284;var n_to_share$19285;var to_share$19286;var other$19429;var i$19247;var vars$19248;var varsd$19249;var blocks$19250;var body$19251;var t0$19240;var t1$19241;var t2$19242;var t3$19243;var m$19235;(m$19235=temp$19214[$index$19226]);(t0$19240=m$19235);if(((t0$19240 instanceof Array)&&(((t1$19241=t0$19240.length)),((t1$19241===2)&&((i$19247=t0$19240[0]),(((t2$19242=t0$19240[1])),((t2$19242 instanceof Array)&&(((t3$19243=t2$19242.length)),((t3$19243===5)&&(t2$19242[0]==="clause")))))))))){(vars$19248=t2$19242[1]);(varsd$19249=t2$19242[2]);(blocks$19250=t2$19242[3]);(body$19251=t2$19242[4]);acc$19208.push(((((t0$19288=$15906(shares$18899,i$19247))),(function(){if(((t0$19288 instanceof Array)&&(((t1$19289=t0$19288.length)),(t1$19289===2)))){(share$19282=t0$19288[0]);(idx$19283=t0$19288[1]);}else{return $20197($15906(shares$18899,i$19247),"/home/olivier/git/earl-grey/src/pattern.eg",16187,16206);}})()),((shared$19284=(function(){if(idx_last$18903){return [["check",$15906(temps$18901,(idx_last$18903-1))]];}else{return [];}})())),((n_to_share$19285=Math.max(shared_last$18902,share$19282))),((to_share$19286=(((acc$19320=[])),(((temp$19326=$20171(blocks$19250.slice(shared_last$18902,n_to_share$19285)))),((($length$19332=temp$19326.length)),((($index$19338=0)),(function(){$19310:for(;($index$19338<$length$19332);($index$19338++)){var j$19390;var x$19391;var j$19363;var x$19364;var $19314$19357;var $19315$19358;var $19316$19359;var $19317$19360;var t0$19352;var t1$19353;var t2$19354;var t3$19355;var m$19347;(m$19347=temp$19326[$index$19338]);(t0$19352=m$19347);if((($19315$19358=(t0$19352 instanceof Array))&&(((t1$19353=t0$19352.length)),(($19317$19360=(t1$19353===2))&&((j$19363=t0$19352[0]),(((t2$19354=t0$19352[1])),((t2$19354 instanceof Array)&&(((t3$19355=t2$19354.length)),((t3$19355===2)&&(t2$19354[0]==="check")))))))))){(x$19364=t2$19354[1]);acc$19320.push(["check",["assign",$15906(temps$18901,(shared_last$18902+j$19363)),x$19364]]);}else{if(($19317$19360&&((j$19390=t0$19352[0]),(((t2$19354=t0$19352[1])),((t2$19354 instanceof Array)&&(((t3$19355=t2$19354.length)),((t3$19355===2)&&(t2$19354[0]==="do")))))))){(x$19391=t2$19354[1]);acc$19320.push(["do",x$19391]);}else{$20197(m$19347,"/home/olivier/git/earl-grey/src/pattern.eg",16335,16506);}}}})()))),acc$19320))),((shared_last$18902=share$19282)),((idx_last$18903=idx$19283)),(((newblocks$19417=(((rest$19422=blocks$19250.slice(n_to_share$19285))),shared$19284.concat(to_share$19286).concat(rest$19422)))),["clause",vars$19248,varsd$19249,newblocks$19417,body$19251])));}else{(other$19429=m$19235);acc$19208.push(function(){throw $19938(["oops"]).create("what",({"value":other$19429}));}());}}})()))),acc$19208));return [temps$18901,new_clauses$18904];}));(weave_clauses$16022=(function(parts$19438){var $index$19503;var $length$19497;var temp$19491;var $index$19767;var $length$19761;var temp$19755;var acc$19749;var groups$19445;var reassemble$19446;var new_temps$19447;var helper$19448;(groups$19445=classify_contiguous$16008(parts$19438,(function($19460$19463){var t0$19467;var t1$19468;var cls$19465;(t0$19467=$19460$19463);if(((t0$19467 instanceof Array)&&(((t1$19468=t0$19467.length)),(t1$19468>=1)))){(cls$19465=t0$19467[0]);Array.prototype.slice.call(t0$19467,1);}else{$20197($19460$19463);}return cls$19465;})));(reassemble$19446=[]);(new_temps$19447=[]);(temp$19491=groups$19445);($length$19497=temp$19491.length);($index$19503=0);$19449:for(;($index$19503<$length$19497);($index$19503++)){var t0$19543;var t1$19544;var ts$19540;var new_clauses$19541;var elems$19559;var elems$19526;var $19453$19520;var $19454$19521;var $19455$19522;var $19456$19523;var t0$19517;var t1$19518;var m$19512;(m$19512=temp$19491[$index$19503]);(t0$19517=m$19512);if((($19454$19521=(t0$19517 instanceof Array))&&(((t1$19518=t0$19517.length)),(($19456$19523=(t1$19518>=1))&&(t0$19517[0]==="clause"))))){(elems$19526=Array.prototype.slice.call(t0$19517,1));(t0$19543=opt_clauses$16021(elems$19526));if(((t0$19543 instanceof Array)&&(((t1$19544=t0$19543.length)),(t1$19544===2)))){(ts$19540=t0$19543[0]);(new_clauses$19541=t0$19543[1]);}else{$20197(opt_clauses$16021(elems$19526),"/home/olivier/git/earl-grey/src/pattern.eg",17015,17043);}(new_temps$19447=new_temps$19447.concat(ts$19540));(reassemble$19446=reassemble$19446.concat(new_clauses$19541));}else{if(($19456$19523&&(t0$19517[0]==="block"))){(elems$19559=Array.prototype.slice.call(t0$19517,1));(reassemble$19446=reassemble$19446.concat(elems$19559));}else{$20197(m$19512,"/home/olivier/git/earl-grey/src/pattern.eg",16949,17154);}}}(helper$19448=(function($19567$19570){var $index$19683;var $length$19677;var temp$19671;var acc$19665;var decls$19657;var vars$19648;var varsd$19649;var blocks$19650;var body$19651;var rest$19652;var body$19617;var rest$19618;var $19576$19600;var $19577$19601;var $19578$19602;var $19579$19603;var $19580$19604;var $19581$19605;var t0$19593;var t1$19594;var t2$19595;var t3$19596;var t4$19597;var t5$19598;var $19572$19588;var ph$19582;(ph$19582=$19567$19570);($19572$19588=ph$19582);if((($19576$19600=($19572$19588 instanceof Array))&&(((t0$19593=$19572$19588.length)),(t0$19593===0)))){return ["multi"];}else{if(($19576$19600&&(($19578$19602=(t0$19593>=1))&&(((t1$19594=$19572$19588[0])),(($19580$19604=(t1$19594 instanceof Array))&&(((t2$19595=t1$19594.length)),((t2$19595===2)&&((t1$19594[0]==="block")&&(((t3$19596=$20239(["multi"])(t1$19594[1]))),(t3$19596[0]&&(((t4$19597=t3$19596[1])),(((t5$19598=t4$19597.length)),(t5$19598>=0))))))))))))){(body$19617=Array.prototype.slice.call(t4$19597,0));(rest$19618=Array.prototype.slice.call($19572$19588,1));return ["multi"].concat(body$19617).concat([helper$19448(rest$19618)]);}else{if(($19580$19604&&((t2$19595===5)&&(t1$19594[0]==="clause")))){(vars$19648=t1$19594[1]);(varsd$19649=t1$19594[2]);(blocks$19650=t1$19594[3]);(body$19651=t1$19594[4]);(rest$19652=Array.prototype.slice.call($19572$19588,1));(decls$19657=(((acc$19665=[])),(((temp$19671=vars$19648)),((($length$19677=temp$19671.length)),((($index$19683=0)),(function(){$19660:for(;($index$19683<$length$19677);($index$19683++)){var bridge$19708$19716;var $19703$19711;var v$19700;var m$19692;(m$19692=temp$19671[$index$19683]);(v$19700=m$19692);acc$19665.push(((($19703$19711=v$19700.declare_mode)),(function(){if(($19703$19711==="set")){return ["splice"];}else{if(($19703$19711==="let")){return ["declare",$20216(v$19700,({"mutable":false}))];}else{if(($19703$19711==="var")){return ["declare",$20216(v$19700,({"mutable":true}))];}else{(bridge$19708$19716=$19703$19711);if(((bridge$19708$19716==="unqualified")||(bridge$19708$19716===(void 0)))){return ["declare",$20216(v$19700,({"mutable":false}))];}else{$20197($19703$19711);}}}}})()));}})()))),acc$19665));return ["tagscope","back",["multi"].concat(decls$19657).concat([assemble_pattern$16015(blocks$19650,body$19651,["use","back",helper$19448(rest$19652)])])];}else{$20197($19572$19588);}}}}));return ["multi"].concat((((acc$19749=[])),(((temp$19755=new_temps$19447)),((($length$19761=temp$19755.length)),((($index$19767=0)),(function(){$19744:for(;($index$19767<$length$19761);($index$19767++)){var t$19784;var m$19776;(m$19776=temp$19755[$index$19767]);(t$19784=m$19776);acc$19749.push(["declare",t$19784]);}})()))),acc$19749)).concat([helper$19448(reassemble$19446)]);}));(exports["PatternParser"]=PatternParser$16012);(exports["PatternProcessor"]=PatternProcessor$16013);(exports["parse_clauses"]=parse_clauses$16020);(exports["parse_pattern"]=parse_pattern$16017);
