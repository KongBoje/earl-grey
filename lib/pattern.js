var $7828=function(type$7830){var f$7833;(f$7833=type$7830["::check"]);;if((f$7833===(void 0))){return function(value$7838){return (value$7838 instanceof type$7830);};}else{return function(value$7841){return f$7833.call(type$7830,value$7841);};}};
var $7843=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $7844=function($7845$7847){var ph$7851;(ph$7851=$7845$7847);;var $7849$7856;($7849$7856=ph$7851);;var bridge$7850$7861;var x$7865;(bridge$7850$7861=$7849$7856);if((((typeof(bridge$7850$7861)==="string")&&((x$7865=bridge$7850$7861),true))||((typeof(bridge$7850$7861)==="number")&&((x$7865=bridge$7850$7861),true)))){return ["value",x$7865];}else{var other$7872;(other$7872=$7849$7856);return other$7872["::serialize_ast"]();}};
var send$7691;(send$7691=function(obj$7696,$7694$7697){var ph$7701;var msg$7702;var t0$7704;(t0$7704=$7694$7697);(msg$7702=t0$7704);(ph$7701=t0$7704);;var $7699$7708;($7699$7708=ph$7701);;var bridge$7700$7713;(bridge$7700$7713=$7699$7708);if(((typeof(bridge$7700$7713)==="string")||(typeof(bridge$7700$7713)==="number"))){return obj$7696[msg$7702];}else{var other$7721;(other$7721=$7699$7708);return obj$7696["::send"](msg$7702);}});;(Array[":::project"]=function($7724$7726){var ph$7729;var value$7730;var t0$7732;(t0$7732=$7724$7726);(value$7730=t0$7732);(ph$7729=t0$7732);;var $7728$7736;($7728$7736=ph$7729);;if($7828(Array)($7728$7736)){return [true,value$7730];}else{$7728$7736;return [true,[value$7730]];}});(Array.prototype["::check"]=function(value$7750){if((value$7750 instanceof Array)){var i$7755;(i$7755=0);;$7753:for(;(i$7755<this.length);(i$7755++)){if(($7843(this,i$7755)!==$7843(value$7750,i$7755))){return false;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value$7764){if((value$7764 instanceof Array)){var i$7769;(i$7769=0);;$7767:for(;(i$7769<this.length);(i$7769++)){if(($7843(this,i$7769)!==$7843(value$7764,i$7769))){return [true,[value$7764]];}}return [true,value$7764.slice(this.length)];}else{return [true,[value$7764]];}});(Array.prototype[":::deconstruct"]=function(value$7778){return [true,value$7778.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($7844));});(RegExp.prototype["::check"]=function(value$7783){return value$7783.match(this);});(RegExp.prototype[":::project"]=function(value$7786){var $7788$7790;($7788$7790=value$7786.match(this));;var m$7798;if(($7788$7790===null)){(m$7798=$7788$7790);return [false,null];}else{var m$7803;(m$7803=$7788$7790);return [true,m$7803];}});(RegExp.prototype[":::deconstruct"]=function(value$7806){var $7808$7810;($7808$7810=value$7806.match(this));;var m$7818;if(($7808$7810===null)){(m$7818=$7808$7810);return [false,null];}else{var m$7823;(m$7823=$7808$7810);return [true,m$7823];}});(Function.prototype["::send"]=function(args$7826){return this.apply(this,args$7826);});
var $10672=function(value$10674,url$10675,start$10676,end$10677){var err$10680;(err$10680=$10566(["match"]).create("Could not find a match for value",({"value":value$10674})));;if(url$10675){(err$10680["location"]=["location",url$10675,start$10676,end$10677]);}throw err$10680;};
var $10685=function(dest$10687,values$10688){var k$10693;(k$10693=null);$10691:for(k$10693 in values$10688){if(values$10688.hasOwnProperty(k$10693)){(dest$10687[k$10693]=values$10688[k$10693]);}}return dest$10687;};
var $10566=function(){var $10567$10569;($10567$10569=function(tags$10573){var it$0$10576;(it$0$10576=function(){if((!$7828($10567$10569)(this))){return Object.create($10567$10569.prototype);}else{return this;}}());;(it$0$10576["tags"]=tags$10573);return it$0$10576;});;($10567$10569.prototype["create"]=function(){var $10585$10587;($10585$10587=arguments);;var t0$10592;var message$10596;var args$10597;(t0$10592=$10585$10587.length);if((t0$10592>=0)){(message$10596=function(){if((0>=t0$10592)){return "";}else{return $10585$10587[0];}}());(args$10597=Array.prototype.slice.call($10585$10587,1));var it$0$10601;(it$0$10601=this);;var e$10606;(e$10606=Error(message$10596));;(e$10606["::tags"]=it$0$10601.tags);(e$10606["args"]=args$10597);(e$10606["name"]=["E"].concat(it$0$10601.tags).join("."));return e$10606;}else{$10672($10585$10587);}});($10567$10569.prototype["::check"]=function(e$10615){var it$0$10618;(it$0$10618=this);;var tags$10623;if(((!e$10615)||(!$7828(Error)(e$10615)))){return false;}(tags$10623=(e$10615["::tags"]||[]));;var temp$10631;(temp$10631=it$0$10618.tags);;var len$10636;(len$10636=temp$10631.length);;var i$10641;(i$10641=0);;$10624:for(;(i$10641<len$10636);(i$10641++)){var m$10649;(m$10649=temp$10631[i$10641]);;var tag$10657;(tag$10657=m$10649);if((tags$10623.indexOf(tag$10657)===(-1))){return false;}else{false;;}}return true;});($10567$10569.prototype["::deconstruct"]=function(e$10665){var it$0$10668;(it$0$10668=this);;return e$10665.args;});$10685($10567$10569,({}));return $10567$10569;}();
var $10697=function($10698$10700,key$10701){var ph$10705;(ph$10705=$10698$10700);;var $10703$10710;($10703$10710=ph$10705);;var bridge$10704$10715;(bridge$10704$10715=$10703$10710);if(((bridge$10704$10715===null)||(bridge$10704$10715===(void 0)))){return false;}else{var x$10723;if((typeof($10703$10710)==="string")){(x$10723=$10703$10710);return (key$10701 in String.prototype);}else{var x$10728;if((typeof($10703$10710)==="number")){(x$10728=$10703$10710);return (key$10701 in Number.prototype);}else{var x$10733;(x$10733=$10703$10710);return (key$10701 in x$10733);}}}};
var $10735=function(type$10737){return function(value$10740){var f$10743;(f$10743=type$10737[":::project"]);;if((f$10743===(void 0))){var f$10748;(f$10748=type$10737["::project"]);;if((f$10748===(void 0))){return [true,type$10737(value$10740)];}else{var rval$10753;(rval$10753=false);;try{(rval$10753=[true,f$10748(value$10740)]);}catch(excv$10759){var e$10765;(e$10765=excv$10759);(rval$10753=[false,null]);}return rval$10753;}}else{return f$10743.call(type$10737,value$10740);}};};
var $10767=function(a$10769,b$10770){var dest$10775;(dest$10775=({}));;var k$10780;(k$10780=null);$10773:for(k$10780 in a$10769){if(a$10769.hasOwnProperty(k$10780)){(dest$10775[k$10780]=a$10769[k$10780]);}}var k$10785;(k$10785=null);$10774:for(k$10785 in b$10770){if(b$10770.hasOwnProperty(k$10785)){(dest$10775[k$10785]=b$10770[k$10785]);}}return dest$10775;};
var $10789=function(from$10791,to$10792){var rval$10796;(rval$10796=[]);;var i$10801;(i$10801=from$10791);;$10795:for(;(i$10801<=to$10792);(i$10801++)){rval$10796.push(i$10801);}return rval$10796;};var $7875$7878;var __lt____gt__$7879;var $7876$7880;var __lt____lt____colon__$7881;var util$7882;var GenSym$7883;var gensym$7884;var zip$7885;var enumerate$7886;var iterkeys$7887;var neighbours$7888;var classify$7889;var classify_contiguous$7890;var identity$7891;var $7877$7892;var checker_db$7893;var PatternParser$7894;var PatternProcessor$7895;var assemble_conditions$7896;var assemble_pattern$7897;var inject_below_uses$7898;var parse_pattern$7899;var checkall$7900;var same_block$7901;var parse_clauses$7902;var opt_clauses$7903;var weave_clauses$7904;($7875$7878=require("./pp"));;(__lt____gt__$7879=$7875$7878["<>"]);;($7876$7880=require("./location"));;(__lt____lt____colon__$7881=$7876$7880["<<:"]);;(util$7882=require("./util"));;(GenSym$7883=util$7882.GenSym);;(gensym$7884=util$7882.gensym);;(zip$7885=util$7882.zip);;(enumerate$7886=util$7882.enumerate);;(iterkeys$7887=util$7882.keys);;(neighbours$7888=util$7882.neighbours);;(classify$7889=util$7882.classify);;(classify_contiguous$7890=util$7882.classify_contiguous);;(identity$7891=util$7882.identity);;($7877$7892=require("./expand"));;(checker_db$7893=$7877$7892.checker_db);;(PatternParser$7894=function(scope$7956,pattern$7957,opt$7958){var it$0$7961;(it$0$7961=function(){if((!$7828(PatternParser$7894)(this))){return Object.create(PatternParser$7894.prototype);}else{return this;}}());;(it$0$7961["opt"]=opt$7958);(it$0$7961["arguments"]=[]);(it$0$7961["vars"]=[]);(it$0$7961["specials"]=({}));(it$0$7961["pattern"]=it$0$7961.expand(scope$7956,pattern$7957,true,it$0$7961.opt.indexable));return it$0$7961;});;(PatternParser$7894.prototype["parse_specs"]=function(scope$7971,specs$7972){var i$8012;var len$8007;var temp$8002;var acc$7997;var rest$7980;var has_defaults$7981;var rval$7982;var it$0$7975;(it$0$7975=this);;(rest$7980=(void 0));;(has_defaults$7981=false);;(rval$7982=classify$7889("fw","bw","keys","defaults",(((acc$7997=[])),(((temp$8002=scope$7971.step_all(["pattern"],specs$7972))),(((len$8007=temp$8002.length)),(((i$8012=0)),function(){$7991:for(;(i$8012<len$8007);(i$8012++)){var v$8064;var v$8059;var variable$8052;var value$8053;var key$8046;var subp$8047;var key$8041;var variable$8034;var $7992$8028;var $7993$8029;var $7994$8030;var $7995$8031;var t0$8025;var t1$8026;var m$8020;(m$8020=temp$8002[i$8012]);;(t0$8025=m$8020);if((($7993$8029=(t0$8025 instanceof Array))&&((t1$8026=t0$8025.length),(($7995$8031=(t1$8026===2))&&(t0$8025[0]==="dynsplice"))))){(variable$8034=t0$8025[1]);acc$7997.push(((rest$7980=it$0$7975.expand(scope$7971,variable$8034)),["ignore"]));}else{if(($7995$8031&&(t0$8025[0]==="assoc"))){(key$8041=t0$8025[1]);acc$7997.push(["keys",[key$8041,it$0$7975.expand(scope$7971,key$8041)]]);}else{if(($7993$8029&&(($7995$8031=(t1$8026===3))&&(t0$8025[0]==="assoc")))){(key$8046=t0$8025[1]);(subp$8047=t0$8025[2]);acc$7997.push(["keys",[key$8046,it$0$7975.expand(scope$7971,subp$8047)]]);}else{if(($7995$8031&&(t0$8025[0]==="default"))){(variable$8052=t0$8025[1]);(value$8053=t0$8025[2]);acc$7997.push(((has_defaults$7981=true),function(){if(rest$7980){throw $10566(["syntax","pattern"]).create("No default arguments after rest arg.");}else{return ["defaults",[it$0$7975.expand(scope$7971,variable$8052),value$8053]];}}()));}else{(v$8059=m$8020);if(((rest$7980===(void 0))&&(!has_defaults$7981))){acc$7997.push(["fw",it$0$7975.expand(scope$7971,v$8059)]);}else{(v$8064=m$8020);acc$7997.push(["bw",it$0$7975.expand(scope$7971,v$8064)]);}}}}}}}()))),acc$7997)));;(rval$7982["rest"]=rest$7980);return rval$7982;});(PatternParser$7894.prototype["expand"]=function(){var x$8124;var x$8133;var x$8149;var x$8154;var msg$8200;var x$8212;var msg$8225;var msg$8234;var i$8266;var len$8261;var temp$8256;var acc$8251;var i$8367;var len$8362;var temp$8357;var acc$8352;var i$8398;var len$8393;var temp$8388;var t0$8458;var t1$8459;var t2$8460;var i$8487;var len$8482;var temp$8477;var acc$8472;var patts$8467;var canon$8290;var normalize$8291;var pps$8292;var vars$8293;var patt$8546;var msg$8567;var other$8564;var keys$8552;var fw$8534;var bw$8535;var defaults$8536;var rest$8537;var $8513$8531;var t0$8524;var t1$8525;var t2$8526;var t3$8527;var t4$8528;var t5$8529;var $8512$8519;var specs$8514;var other$8573;var args$8508;var xs$8286;var xs$8246;var x$8240;var f$8220;var arg$8221;var f$8206;var arguments$8207;var f$8193;var arg$8194;var checker$8187;var subp$8188;var projector$8181;var subp$8182;var condition$8175;var subp$8176;var v$8170;var v$8162;var type$8140;var $8102$8116;var $8103$8117;var $8104$8118;var $8105$8119;var t0$8112;var bridge$8101$8113;var t1$8114;var $8100$8107;var expr$8093;var rval$8094;var it$0$8088;var scope$8081;var pattern$8082;var toplevel$8083;var checked$8084;var t0$8077;var $8070$8072;($8070$8072=arguments);;(t0$8077=$8070$8072.length);if(((t0$8077>=2)&&(t0$8077<=4))){(scope$8081=$8070$8072[0]);(pattern$8082=$8070$8072[1]);(toplevel$8083=function(){if((2>=t0$8077)){return false;}else{return $8070$8072[2];}}());(checked$8084=function(){if((3>=t0$8077)){return false;}else{return $8070$8072[3];}}());(it$0$8088=this);;(expr$8093=scope$8081.step(["pattern"],pattern$8082));;(rval$8094=((($8100$8107=expr$8093)),function(){if((((x$8124=$8100$8107)),((x$8124 instanceof Array)&&(x$8124[0]==="void")))){return ["check",checker_db$7893.null,["ignore"]];}else{if((((x$8133=$8100$8107)),((x$8133 instanceof Array)&&(x$8133[0]==="ignore")))){return expr$8093;}else{if((($8100$8107 instanceof Array)&&((t0$8112=$8100$8107.length),((t0$8112===2)&&($8100$8107[0]==="special"))))){(type$8140=$8100$8107[1]);(it$0$8088.specials[type$8140]=true);return expr$8093;}else{(bridge$8101$8113=$8100$8107);if(((((x$8149=bridge$8101$8113)),((x$8149 instanceof Array)&&(x$8149[0]==="symbol")))||(((x$8154=bridge$8101$8113)),((x$8154 instanceof Array)&&(x$8154[0]==="variable"))))){it$0$8088.vars.push(expr$8093);return ["assign",expr$8093];}else{if((($8102$8116=($8100$8107 instanceof Array))&&((t0$8112=$8100$8107.length),(($8104$8118=(t0$8112===2))&&(($8105$8119=($8100$8107[0]==="value"))&&((v$8162=$8100$8107[1]),it$0$8088.opt.strings_as_variables)))))){it$0$8088.vars.push(expr$8093);return ["assign",expr$8093];}else{if($8105$8119){(v$8170=$8100$8107[1]);return ["check",checker_db$7893(v$8170),["ignore"]];}else{if(($8102$8116&&(($8104$8118=(t0$8112===3))&&($8100$8107[0]==="test")))){(condition$8175=$8100$8107[1]);(subp$8176=$8100$8107[2]);return ["test",condition$8175,it$0$8088.expand(scope$8081,subp$8176,toplevel$8083,false)];}else{if(($8104$8118&&($8100$8107[0]==="project"))){(projector$8181=$8100$8107[1]);(subp$8182=$8100$8107[2]);return ["project",projector$8181,it$0$8088.expand(scope$8081,subp$8182,toplevel$8083,true)];}else{if(($8104$8118&&($8100$8107[0]==="check"))){(checker$8187=$8100$8107[1]);(subp$8188=$8100$8107[2]);return ["check",checker$8187,it$0$8088.expand(scope$8081,subp$8188,toplevel$8083,true)];}else{if(($8104$8118&&(($8105$8119=($8100$8107[0]==="send"))&&((f$8193=$8100$8107[1]),((arg$8194=$8100$8107[2]),(!toplevel$8083)))))){(msg$8200="Function arguments can only be declared as a top level pattern.");;throw $10566(["syntax","pattern"]).create(msg$8200,({"node":expr$8093,"arg":arg$8194}));}else{if(($8105$8119&&((f$8206=$8100$8107[1]),((t1$8114=$8100$8107[2]),(((x$8212=t1$8114)),((x$8212 instanceof Array)&&(x$8212[0]==="data"))))))){(arguments$8207=t1$8114);it$0$8088.arguments.unshift(arguments$8207);return it$0$8088.expand(scope$8081,f$8206,true,false);}else{if($8105$8119){(f$8220=$8100$8107[1]);(arg$8221=$8100$8107[2]);(msg$8225=["Function must be declared with an array of arguments","(did you mean to use ':='?)"].join(" "));;throw $10566(["syntax","pattern"]).create(msg$8225,({"node":expr$8093,"arg":arg$8221}));}else{$8100$8107;if((!it$0$8088.opt.allow_nested)){(msg$8234="Nested patterns are not allowed here.");;throw $10566(["syntax","pattern"]).create(msg$8234,({"node":expr$8093}));}else{if((($8102$8116=($8100$8107 instanceof Array))&&((t0$8112=$8100$8107.length),((t0$8112===2)&&($8100$8107[0]==="neg"))))){(x$8240=$8100$8107[1]);return ["neg",it$0$8088.expand(scope$8081,x$8240)];}else{if(($8102$8116&&(($8104$8118=(t0$8112>=1))&&($8100$8107[0]==="all")))){(xs$8246=Array.prototype.slice.call($8100$8107,1));return ["all"].concat((((acc$8251=[])),(((temp$8256=xs$8246)),(((len$8261=temp$8256.length)),(((i$8266=0)),function(){$8249:for(;(i$8266<len$8261);(i$8266++)){var x$8282;var m$8274;(m$8274=temp$8256[i$8266]);;(x$8282=m$8274);acc$8251.push(it$0$8088.expand(scope$8081,x$8282));}}()))),acc$8251));}else{if(($8104$8118&&($8100$8107[0]==="any"))){(xs$8286=Array.prototype.slice.call($8100$8107,1));(canon$8290=function(all$8298){return all$8298.sort().join(",");});;(normalize$8291=function(vars$8304){var i$8323;var len$8318;var temp$8313;var acc$8308;return canon$8290((((acc$8308=[])),(((temp$8313=vars$8304)),(((len$8318=temp$8313.length)),(((i$8323=0)),function(){$8306:for(;(i$8323<len$8318);(i$8323++)){var v$8341;var t0$8336;var t1$8337;var m$8331;(m$8331=temp$8313[i$8323]);;(t0$8336=m$8331);if(((t0$8336 instanceof Array)&&((t1$8337=t0$8336.length),((t1$8337===2)&&(t0$8336[0]==="symbol"))))){(v$8341=t0$8336[1]);acc$8308.push(v$8341);}else{false;;}}}()))),acc$8308));});;(pps$8292=(((acc$8352=[])),(((temp$8357=xs$8286)),(((len$8362=temp$8357.length)),(((i$8367=0)),function(){$8350:for(;(i$8367<len$8362);(i$8367++)){var x$8383;var m$8375;(m$8375=temp$8357[i$8367]);;(x$8383=m$8375);acc$8352.push(PatternParser$7894(scope$8081,x$8383,it$0$8088.opt));}}()))),acc$8352));;(temp$8388=neighbours$7888(pps$8292));;(len$8393=temp$8388.length);;(i$8398=0);;$8294:for(;(i$8398<len$8393);(i$8398++)){var i$8435;var len$8430;var temp$8425;var pp1$8416;var pp2$8417;var t0$8411;var t1$8412;var m$8406;(m$8406=temp$8388[i$8398]);;(t0$8411=m$8406);if(((t0$8411 instanceof Array)&&((t1$8412=t0$8411.length),(t1$8412===2)))){(pp1$8416=t0$8411[0]);(pp2$8417=t0$8411[1]);(temp$8425=pps$8292);;(len$8430=temp$8425.length);;(i$8435=0);;$8422:for(;(i$8435<len$8430);(i$8435++)){var pp$8451;var m$8443;(m$8443=temp$8425[i$8435]);;(pp$8451=m$8443);normalize$8291(pp$8451.vars);}if((normalize$8291(pp1$8416.vars)!==normalize$8291(pp2$8417.vars))){throw $10566(["syntax","pattern"]).create("Both branches of 'or' must contain the same variables",({"vars1":__lt____lt____colon__$7881(pp1$8416.vars.sort(),pp1$8416.pattern),"vars2":__lt____lt____colon__$7881(pp2$8417.vars.sort(),pp2$8417.pattern)}));}if((canon$8290(iterkeys$7887(pp1$8416.specials))!==canon$8290(iterkeys$7887(pp2$8417.specials)))){throw $10566(["syntax","pattern"]).create("Both branches of 'or' must contain the same special tokens",({"special1":__lt____lt____colon__$7881(iterkeys$7887(pp1$8416.specials).sort(),pp1$8416.pattern),"special2":__lt____lt____colon__$7881(iterkeys$7887(pp2$8417.specials).sort(),pp2$8417.pattern)}));}}else{false;;}}(t0$8458=pps$8292);if(((t0$8458 instanceof Array)&&((t1$8459=t0$8458.length),((t1$8459>=1)&&((t2$8460=t0$8458[0]),$10697(t2$8460,"vars")))))){(vars$8293=t2$8460.vars);Array.prototype.slice.call(t0$8458,1);;}else{$10672(pps$8292,"/home/olivier/git/earl-grey/src/pattern.eg",4406,4409);}(it$0$8088["vars"]=it$0$8088.vars.concat(vars$8293));(patts$8467=(((acc$8472=[])),(((temp$8477=pps$8292)),(((len$8482=temp$8477.length)),(((i$8487=0)),function(){$8470:for(;(i$8487<len$8482);(i$8487++)){var pp$8503;var m$8495;(m$8495=temp$8477[i$8487]);;(pp$8503=m$8495);acc$8472.push(pp$8503.pattern);}}()))),acc$8472));;return ["any"].concat(patts$8467);}else{if(($8104$8118&&($8100$8107[0]==="data"))){(args$8508=Array.prototype.slice.call($8100$8107,1));(specs$8514=it$0$8088.parse_specs(scope$8081,args$8508));;($8512$8519=specs$8514);;if((($8513$8531=$10697($8512$8519,"keys"))&&((t0$8524=$8512$8519.keys),((t0$8524 instanceof Array)&&((t1$8525=t0$8524.length),((t1$8525===0)&&($10697($8512$8519,"fw")&&((fw$8534=$8512$8519.fw),($10697($8512$8519,"bw")&&((bw$8535=$8512$8519.bw),($10697($8512$8519,"defaults")&&((defaults$8536=$8512$8519.defaults),$10697($8512$8519,"rest"))))))))))))){(rest$8537=$8512$8519.rest);(patt$8546=__lt____lt____colon__$7881(["array_pattern",fw$8534,bw$8535,defaults$8536,rest$8537],pattern$8082));;if(checked$8084){return patt$8546;}else{return ["check",checker_db$7893.Array,patt$8546];}}else{if(($8513$8531&&((keys$8552=$8512$8519.keys),($10697($8512$8519,"fw")&&((t0$8524=$8512$8519.fw),((t0$8524 instanceof Array)&&((t1$8525=t0$8524.length),((t1$8525===0)&&($10697($8512$8519,"bw")&&((t2$8526=$8512$8519.bw),((t2$8526 instanceof Array)&&((t3$8527=t2$8526.length),((t3$8527===0)&&($10697($8512$8519,"defaults")&&((t4$8528=$8512$8519.defaults),((t4$8528 instanceof Array)&&((t5$8529=t4$8528.length),((t5$8529===0)&&($10697($8512$8519,"rest")&&($8512$8519.rest===(void 0))))))))))))))))))))){return ["object_pattern"].concat(keys$8552);}else{(other$8564=$8512$8519);(msg$8567="Pattern must be an array or an object.");;throw $10566(["syntax","pattern"]).create(msg$8567,({"node":expr$8093,"specs":specs$8514}));}}}else{(other$8573=$8100$8107);throw $10566(["syntax","pattern"]).create("Illegal pattern",({"node":other$8573}));}}}}}}}}}}}}}}}}}}()));;return __lt____lt____colon__$7881(rval$8094,pattern$8082);}else{$10672($8070$8072);}});$10685(PatternParser$7894,({}));PatternParser$7894;(PatternProcessor$7895=function(){var it$0$8583;(it$0$8583=function(){if((!$7828(PatternProcessor$7895)(this))){return Object.create(PatternProcessor$7895.prototype);}else{return this;}}());;(it$0$8583["temps"]=[]);(it$0$8583["parts"]=[]);(it$0$8583["gen"]=GenSym$7883("t"));return it$0$8583;});;(PatternProcessor$7895.prototype["do"]=function(part$8593){var it$0$8596;(it$0$8596=this);;return it$0$8596.parts.push(["do",part$8593]);});(PatternProcessor$7895.prototype["check"]=function(part$8603){var it$0$8606;(it$0$8606=this);;return it$0$8606.parts.push(["check",part$8603]);});(PatternProcessor$7895.prototype["temp"]=function(){var x$8647;var x$8652;var init$8659;var bridge$8630$8641;var $8629$8636;var it$0$8631;var x$8624;var v$8625;var t0$8620;var $8613$8615;($8613$8615=arguments);;(t0$8620=$8613$8615.length);if(((t0$8620>=1)&&(t0$8620<=2))){(x$8624=$8613$8615[0]);(v$8625=function(){if((1>=t0$8620)){return null;}else{return $8613$8615[1];}}());(it$0$8631=this);;($8629$8636=x$8624);;(bridge$8630$8641=$8629$8636);if((((((x$8647=bridge$8630$8641)),((x$8647 instanceof Array)&&(x$8647[0]==="variable")))||(((x$8652=bridge$8630$8641)),((x$8652 instanceof Array)&&(x$8652[0]==="symbol"))))&&($10697($8629$8636,"single_assignment")&&($8629$8636.single_assignment&&(!v$8625))))){return x$8624;}else{(init$8659=$8629$8636);(v$8625=(v$8625||["symbol",it$0$8631.gen()]));(v$8625["single_assignment"]=true);it$0$8631.temps.push(v$8625);it$0$8631.do(["send",["symbol",":="],["data",v$8625,init$8659]]);return v$8625;}}else{$10672($8613$8615);}});(PatternProcessor$7895.prototype["process"]=function(pattern$8667,rhs$8668,fns$8669){var x$8701;var x$8730;var t$8742;var t$8753;var pp$8763;var i$8790;var len$8785;var temp$8780;var t$8773;var i$8847;var len$8842;var temp$8837;var acc$8832;var fn$8819;var parts$8820;var t$8814;var i$8898;var len$8893;var temp$8888;var acc$8883;var t$8877;var otherwise$8994;var $8976$8978;var i$9008;var len$9003;var temp$8998;var i$9045;var len$9040;var temp$9035;var end$9087;var pos$9082;var i$9107;var len$9102;var temp$9097;var acc$9092;var nfw$8937;var nbw$8938;var ndflt$8939;var extract_length$8940;var check_length$8941;var lo$8942;var hi$8943;var t$8944;var len$8945;var fw$8930;var bw$8931;var dflt$8932;var rest$8933;var subp$8873;var xs$8810;var xs$8769;var patt$8759;var projector$8748;var subp$8749;var checker$8737;var subp$8738;var checker$8726;var condition$8719;var subp$8720;var kind$8714;var sym$8708;var $8681$8693;var $8682$8694;var $8683$8695;var $8684$8696;var t0$8691;var $8680$8686;var rval$8677;var it$0$8672;(it$0$8672=this);;(rval$8677=((($8680$8686=pattern$8667)),function(){if((((x$8701=$8680$8686)),((x$8701 instanceof Array)&&(x$8701[0]==="ignore")))){return it$0$8672.do(rhs$8668);}else{if((($8681$8693=($8680$8686 instanceof Array))&&((t0$8691=$8680$8686.length),(($8683$8695=(t0$8691===2))&&($8680$8686[0]==="assign"))))){(sym$8708=$8680$8686[1]);return it$0$8672.parts.push(fns$8669.assign(sym$8708,rhs$8668));}else{if(($8683$8695&&($8680$8686[0]==="special"))){(kind$8714=$8680$8686[1]);return it$0$8672.process(fns$8669.special(pattern$8667,rhs$8668),rhs$8668,fns$8669);}else{if(($8681$8693&&(($8683$8695=(t0$8691===3))&&($8680$8686[0]==="test")))){(condition$8719=$8680$8686[1]);(subp$8720=$8680$8686[2]);it$0$8672.process(subp$8720,rhs$8668,fns$8669);return it$0$8672.check(condition$8719);}else{if(($8683$8695&&(($8684$8696=($8680$8686[0]==="check"))&&((checker$8726=$8680$8686[1]),(((x$8730=$8680$8686[2])),((x$8730 instanceof Array)&&(x$8730[0]==="ignore"))))))){return it$0$8672.check(["send",checker$8726,["data",rhs$8668]]);}else{if($8684$8696){(checker$8737=$8680$8686[1]);(subp$8738=$8680$8686[2]);(t$8742=it$0$8672.temp(rhs$8668));;it$0$8672.check(["send",checker$8737,["data",t$8742]]);return it$0$8672.process(subp$8738,t$8742,fns$8669);}else{if(($8683$8695&&($8680$8686[0]==="project"))){(projector$8748=$8680$8686[1]);(subp$8749=$8680$8686[2]);(t$8753=it$0$8672.temp(["send",projector$8748,["data",rhs$8668]]));;it$0$8672.check(["send",t$8753,["value",0]]);return it$0$8672.process(subp$8749,["send",t$8753,["value",1]],fns$8669);}else{if(($8681$8693&&((t0$8691===2)&&($8680$8686[0]==="neg")))){(patt$8759=$8680$8686[1]);return it$0$8672.check(["send",["symbol","not"],["data",["void"],(((pp$8763=PatternProcessor$7895())),pp$8763.process(patt$8759,rhs$8668,fns$8669),assemble_conditions$7896(pp$8763))]]);}else{if(($8681$8693&&(($8683$8695=(t0$8691>=1))&&($8680$8686[0]==="all")))){(xs$8769=Array.prototype.slice.call($8680$8686,1));(t$8773=it$0$8672.temp(rhs$8668));;(temp$8780=xs$8769);;(len$8785=temp$8780.length);;(i$8790=0);;$8774:for(;(i$8790<len$8785);(i$8790++)){var x$8806;var m$8798;(m$8798=temp$8780[i$8790]);;(x$8806=m$8798);it$0$8672.process(x$8806,t$8773,fns$8669);}return null;}else{if(($8683$8695&&($8680$8686[0]==="any"))){(xs$8810=Array.prototype.slice.call($8680$8686,1));(t$8814=it$0$8672.temp(rhs$8668,["symbol",gensym$7884("bridge")]));;return it$0$8672.check((((fn$8819=function(x$8824,rest$8825){return ["send",["symbol","or"],["data",x$8824,rest$8825]];})),((parts$8820=(((acc$8832=[])),(((temp$8837=xs$8810)),(((len$8842=temp$8837.length)),(((i$8847=0)),function(){$8830:for(;(i$8847<len$8842);(i$8847++)){var pp$8866;var x$8863;var m$8855;(m$8855=temp$8837[i$8847]);;(x$8863=m$8855);acc$8832.push((((pp$8866=PatternProcessor$7895())),pp$8866.process(x$8863,t$8814,fns$8669),assemble_conditions$7896(pp$8866)));}}()))),acc$8832))),util$7882.construct(parts$8820,fn$8819,["symbol","false"])));}else{if(($8683$8695&&($8680$8686[0]==="object_pattern"))){(subp$8873=Array.prototype.slice.call($8680$8686,1));(t$8877=it$0$8672.temp(rhs$8668));;(acc$8883=[]);;(temp$8888=subp$8873);;(len$8893=temp$8888.length);;(i$8898=0);;$8878:for(;(i$8898<len$8893);(i$8898++)){var k$8918;var v$8919;var t0$8911;var t1$8912;var t2$8913;var t3$8914;var m$8906;(m$8906=temp$8888[i$8898]);;(t0$8911=m$8906);if(((t0$8911 instanceof Array)&&((t1$8912=t0$8911.length),((t1$8912===2)&&((t2$8913=t0$8911[0]),((t2$8913 instanceof Array)&&((t3$8914=t2$8913.length),((t3$8914===2)&&(t2$8913[0]==="value"))))))))){(k$8918=t2$8913[1]);(v$8919=t0$8911[1]);acc$8883.push((it$0$8672.check(["send",["symbol","___hasprop"],["data",t$8877,["value",k$8918]]]),it$0$8672.process(v$8919,["send",t$8877,["value",k$8918]],fns$8669)));}else{false;;}}return acc$8883;}else{if(($8681$8693&&((t0$8691===5)&&($8680$8686[0]==="array_pattern")))){(fw$8930=$8680$8686[1]);(bw$8931=$8680$8686[2]);(dflt$8932=$8680$8686[3]);(rest$8933=$8680$8686[4]);(nfw$8937=fw$8930.length);;(nbw$8938=bw$8931.length);;(ndflt$8939=dflt$8932.length);;(extract_length$8940=true);;(check_length$8941=true);;(lo$8942=(nfw$8937+nbw$8938));;(hi$8943=(lo$8942+ndflt$8939));;(t$8944=it$0$8672.temp(rhs$8668));;(len$8945=it$0$8672.temp(["send",t$8944,["send",["symbol","."],["data",["void"],["symbol","length"]]]]));;it$0$8672.check(((($8976$8978=rest$8933)),function(){if($8976$8978){return ["send",["symbol",">="],["data",len$8945,["value",lo$8942]]];}else{$8976$8978;if((lo$8942===hi$8943)){return ["send",["symbol","=="],["data",len$8945,["value",lo$8942]]];}else{(otherwise$8994=$8976$8978);return ["send",["symbol","and"],["data",["send",["symbol",">="],["data",len$8945,["value",lo$8942]]],["send",["symbol","<="],["data",len$8945,["value",hi$8943]]]]];}}}()));(temp$8998=enumerate$7886(fw$8930));;(len$9003=temp$8998.length);;(i$9008=0);;$8946:for(;(i$9008<len$9003);(i$9008++)){var i$9026;var m$9027;var t0$9021;var t1$9022;var m$9016;(m$9016=temp$8998[i$9008]);;(t0$9021=m$9016);if(((t0$9021 instanceof Array)&&((t1$9022=t0$9021.length),(t1$9022===2)))){(i$9026=t0$9021[0]);(m$9027=t0$9021[1]);it$0$8672.process(m$9027,["send",t$8944,["value",i$9026]],fns$8669);}else{false;;}}(temp$9035=enumerate$7886(dflt$8932));;(len$9040=temp$9035.length);;(i$9045=0);;$8947:for(;(i$9045<len$9040);(i$9045++)){var idx$9075;var i$9065;var patt$9066;var value$9067;var t0$9058;var t1$9059;var t2$9060;var t3$9061;var m$9053;(m$9053=temp$9035[i$9045]);;(t0$9058=m$9053);if(((t0$9058 instanceof Array)&&((t1$9059=t0$9058.length),((t1$9059===2)&&((i$9065=t0$9058[0]),((t2$9060=t0$9058[1]),((t2$9060 instanceof Array)&&((t3$9061=t2$9060.length),(t3$9061===2))))))))){(patt$9066=t2$9060[0]);(value$9067=t2$9060[1]);(idx$9075=(i$9065+nfw$8937));;it$0$8672.process(patt$9066,["send",["symbol","if"],["data",["send",["symbol",">="],["data",["value",(idx$9075+nbw$8938)],len$8945]],value$9067,["send",t$8944,["value",idx$9075]]]],fns$8669);}else{false;;}}if((rest$8933!==(void 0))){(pos$9082=(nfw$8937+ndflt$8939));;(end$9087=function(){if((nbw$8938>0)){return [["value",(-nbw$8938)]];}else{return [];}}());;it$0$8672.process(rest$8933,["send",["send",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",t$8944,["value",pos$9082]].concat(end$9087)],fns$8669);}else{[];}(acc$9092=[]);;(temp$9097=enumerate$7886(bw$8931));;(len$9102=temp$9097.length);;(i$9107=0);;$8948:for(;(i$9107<len$9102);(i$9107++)){var i$9125;var m$9126;var t0$9120;var t1$9121;var m$9115;(m$9115=temp$9097[i$9107]);;(t0$9120=m$9115);if(((t0$9120 instanceof Array)&&((t1$9121=t0$9120.length),(t1$9121===2)))){(i$9125=t0$9120[0]);(m$9126=t0$9120[1]);acc$9092.push(it$0$8672.process(m$9126,["send",["symbol","___js_fetch"],["data",t$8944,["send",["symbol","-"],["data",len$8945,["value",(nbw$8938-i$9125)]]]]],fns$8669));}else{false;;}}return acc$9092;}else{$10672($8680$8686);}}}}}}}}}}}}}()));;return rval$8677;});$10685(PatternProcessor$7895,({}));PatternProcessor$7895;(assemble_conditions$7896=function(pp$9138){var i$9219;var len$9214;var temp$9209;var acc$9204;var decls$9199;var construct$9141;(construct$9141=function($9144$9146){var x$9189;var rest$9190;var x$9182;var x$9174;var rest$9175;var $9149$9165;var $9150$9166;var t0$9161;var t1$9162;var t2$9163;var $9148$9156;var ph$9151;(ph$9151=$9144$9146);;($9148$9156=ph$9151);;if((($9149$9165=($9148$9156 instanceof Array))&&((t0$9161=$9148$9156.length),(t0$9161===0)))){return ["value",true];}else{if(($9149$9165&&((t0$9161>=1)&&((t1$9162=$9148$9156[0]),((t1$9162 instanceof Array)&&((t2$9163=t1$9162.length),((t2$9163===2)&&(t1$9162[0]==="do")))))))){(x$9174=t1$9162[1]);(rest$9175=Array.prototype.slice.call($9148$9156,1));return ["multi",x$9174,construct$9141(rest$9175)];}else{if(($9149$9165&&((t0$9161===1)&&((t1$9162=$9148$9156[0]),((t1$9162 instanceof Array)&&((t2$9163=t1$9162.length),((t2$9163===2)&&(t1$9162[0]==="check")))))))){(x$9182=t1$9162[1]);return x$9182;}else{if(($9149$9165&&((t0$9161>=1)&&((t1$9162=$9148$9156[0]),((t1$9162 instanceof Array)&&((t2$9163=t1$9162.length),((t2$9163===2)&&(t1$9162[0]==="check")))))))){(x$9189=t1$9162[1]);(rest$9190=Array.prototype.slice.call($9148$9156,1));return ["send",["symbol","and"],["data",x$9189,construct$9141(rest$9190)]];}else{$10672($9148$9156);}}}}});;if(pp$9138.temps.length){(decls$9199=(((acc$9204=[])),(((temp$9209=pp$9138.temps)),(((len$9214=temp$9209.length)),(((i$9219=0)),function(){$9202:for(;(i$9219<len$9214);(i$9219++)){var t$9235;var m$9227;(m$9227=temp$9209[i$9219]);;(t$9235=m$9227);acc$9204.push(["declare",t$9235]);}}()))),acc$9204));;return ["multi"].concat(decls$9199).concat([construct$9141(pp$9138.parts)]);}else{return construct$9141(pp$9138.parts);}});;(assemble_pattern$7897=function(){var i$9287;var len$9282;var temp$9277;var i$9336;var len$9331;var temp$9326;var test$9429;var lead$9259;var trail$9260;var construct$9261;var parts$9253;var t$9254;var f$9255;var t0$9249;var $9242$9244;($9242$9244=arguments);;(t0$9249=$9242$9244.length);if(((t0$9249>=2)&&(t0$9249<=3))){(parts$9253=$9242$9244[0]);(t$9254=$9242$9244[1]);(f$9255=function(){if((2>=t0$9249)){return null;}else{return $9242$9244[2];}}());(lead$9259=[]);;(temp$9277=parts$9253.slice(0));;(len$9282=temp$9277.length);;(i$9287=0);;$9262:for(;(i$9287<len$9282);(i$9287++)){var x$9316;var x$9309;var $9263$9303;var $9264$9304;var $9265$9305;var $9266$9306;var t0$9300;var t1$9301;var m$9295;(m$9295=temp$9277[i$9287]);;(t0$9300=m$9295);if((($9264$9304=(t0$9300 instanceof Array))&&((t1$9301=t0$9300.length),(($9266$9306=(t1$9301===2))&&(t0$9300[0]==="do"))))){(x$9309=t0$9300[1]);lead$9259.push(x$9309);parts$9253.shift();}else{if(($9266$9306&&(t0$9300[0]==="check"))){(x$9316=t0$9300[1]);break $9262;}else{false;;}}}(trail$9260=[]);;(temp$9326=parts$9253.slice(0).reverse());;(len$9331=temp$9326.length);;(i$9336=0);;$9267:for(;(i$9336<len$9331);(i$9336++)){var x$9365;var x$9358;var $9268$9352;var $9269$9353;var $9270$9354;var $9271$9355;var t0$9349;var t1$9350;var m$9344;(m$9344=temp$9326[i$9336]);;(t0$9349=m$9344);if((($9269$9353=(t0$9349 instanceof Array))&&((t1$9350=t0$9349.length),(($9271$9355=(t1$9350===2))&&(t0$9349[0]==="do"))))){(x$9358=t0$9349[1]);trail$9260.unshift(x$9358);parts$9253.pop();}else{if(($9271$9355&&(t0$9349[0]==="check"))){(x$9365=t0$9349[1]);break $9267;}else{false;;}}}(construct$9261=function($9372$9374){var other$9425;var x$9417;var rest$9418;var x$9410;var x$9402;var rest$9403;var $9377$9393;var $9378$9394;var t0$9389;var t1$9390;var t2$9391;var $9376$9384;var ph$9379;(ph$9379=$9372$9374);;($9376$9384=ph$9379);;if((($9377$9393=($9376$9384 instanceof Array))&&((t0$9389=$9376$9384.length),(t0$9389===0)))){return ["value",true];}else{if(($9377$9393&&((t0$9389>=1)&&((t1$9390=$9376$9384[0]),((t1$9390 instanceof Array)&&((t2$9391=t1$9390.length),((t2$9391===2)&&(t1$9390[0]==="do")))))))){(x$9402=t1$9390[1]);(rest$9403=Array.prototype.slice.call($9376$9384,1));return ["multi",x$9402,construct$9261(rest$9403)];}else{if(($9377$9393&&((t0$9389===1)&&((t1$9390=$9376$9384[0]),((t1$9390 instanceof Array)&&((t2$9391=t1$9390.length),((t2$9391===2)&&(t1$9390[0]==="check")))))))){(x$9410=t1$9390[1]);return x$9410;}else{if(($9377$9393&&((t0$9389>=1)&&((t1$9390=$9376$9384[0]),((t1$9390 instanceof Array)&&((t2$9391=t1$9390.length),((t2$9391===2)&&(t1$9390[0]==="check")))))))){(x$9417=t1$9390[1]);(rest$9418=Array.prototype.slice.call($9376$9384,1));return ["send",["symbol","and"],["data",x$9417,construct$9261(rest$9418)]];}else{(other$9425=$9376$9384);throw $10566(["oops"]).create("?!?",other$9425);}}}}});;if(parts$9253.length){(test$9429=construct$9261(parts$9253));;return ["multi"].concat(lead$9259).concat([function(){if(f$9255){return ["send",["symbol","if"],["data",test$9429,["multi"].concat(trail$9260).concat([t$9254]),f$9255]];}else{return ["send",["symbol","if"],["data",test$9429,["multi"].concat(trail$9260).concat([t$9254])]];}}()]);}else{return ["multi"].concat(lead$9259).concat(trail$9260).concat([t$9254]);}}else{$10672($9242$9244);}});;(inject_below_uses$7898=function($9438$9440,fn$9441){var other$9465;var scope$9458;var x$9459;var t0$9454;var $9443$9449;var ph$9444;(ph$9444=$9438$9440);;($9443$9449=ph$9444);;if((($9443$9449 instanceof Array)&&((t0$9454=$9443$9449.length),((t0$9454===3)&&($9443$9449[0]==="use"))))){(scope$9458=$9443$9449[1]);(x$9459=$9443$9449[2]);return ["use",scope$9458,inject_below_uses$7898(x$9459,fn$9441)];}else{(other$9465=$9443$9449);return fn$9441(other$9465);}});;(parse_pattern$7899=function(scope$9471,pattern$9472,rhs$9473,opt$9474){var t0$9485;var i$9523;var len$9518;var temp$9513;var acc$9508;var parse$9477;var target$9478;var proc$9479;(parse$9477=PatternParser$7894(scope$9471,pattern$9472,opt$9474));;if(((!opt$9474.allow_arguments)&&parse$9477.arguments.length)){throw $10566(["syntax","pattern","arguments"]).create("Arguments cannot be declared in this pattern",({"args":parse$9477.arguments[0]}));}(t0$9485=$10735((opt$9474.wrap_target||identity$7891))(function(){if(parse$9477.arguments.length){return inject_below_uses$7898(rhs$9473,function(x$9488){return util$7882.construct(parse$9477.arguments.concat([x$9488]),function(args$9491,rest$9492){return ["send",["symbol","->"],["data",args$9491,rest$9492]];});});}else{return rhs$9473;}}()));if(t0$9485[0]){(target$9478=t0$9485[1]);;}else{$10672(function(){if(parse$9477.arguments.length){return inject_below_uses$7898(rhs$9473,function(x$9497){return util$7882.construct(parse$9477.arguments.concat([x$9497]),function(args$9500,rest$9501){return ["send",["symbol","->"],["data",args$9500,rest$9501]];});});}else{return rhs$9473;}}(),"/home/olivier/git/earl-grey/src/pattern.eg",11358,11791);}(proc$9479=PatternProcessor$7895());;proc$9479.process(parse$9477.pattern,target$9478,opt$9474);if(opt$9474.finalize){return ["splice"].concat(opt$9474.declare(parse$9477.vars)).concat([["multi"].concat((((acc$9508=[])),(((temp$9513=proc$9479.temps)),(((len$9518=temp$9513.length)),(((i$9523=0)),function(){$9506:for(;(i$9523<len$9518);(i$9523++)){var t$9539;var m$9531;(m$9531=temp$9513[i$9523]);;(t$9539=m$9531);acc$9508.push(["declare",t$9539]);}}()))),acc$9508)).concat([assemble_pattern$7897(proc$9479.parts,opt$9474.success(target$9478),opt$9474.failure(target$9478))])]);}else{return [parse$9477.vars,proc$9479.temps,proc$9479.parts];}});;(checkall$7900=["send","data","multi","assign","void","check","do"]);;(same_block$7901=function($9547$9549,ban1$9550,ban2$9551){var i$9651;var len$9646;var temp$9641;var other$9672;var type1$9625;var args1$9626;var type2$9627;var args2$9628;var m1$9616;var m2$9617;var v1$9607;var v2$9608;var s1$9598;var s2$9599;var v1$9586;var v2$9587;var $9554$9577;var $9555$9578;var $9556$9579;var $9557$9580;var $9558$9581;var $9559$9582;var $9560$9583;var t0$9571;var t1$9572;var t2$9573;var t3$9574;var t4$9575;var $9553$9566;var ph$9561;(ph$9561=$9547$9549);;($9553$9566=ph$9561);;if((($9554$9577=($9553$9566 instanceof Array))&&((t0$9571=$9553$9566.length),(($9556$9579=(t0$9571===2))&&((t1$9572=$9553$9566[0]),(($9558$9581=(t1$9572 instanceof Array))&&((t2$9573=t1$9572.length),(($9560$9583=(t2$9573===2))&&((t1$9572[0]==="variable")&&((v1$9586=t1$9572[1]),((t3$9574=$9553$9566[1]),((t3$9574 instanceof Array)&&((t4$9575=t3$9574.length),((t4$9575===2)&&(t3$9574[0]==="variable"))))))))))))))){(v2$9587=t3$9574[1]);return (v1$9586===v2$9587);}else{if(($9560$9583&&((t1$9572[0]==="symbol")&&((s1$9598=t1$9572[1]),((t3$9574=$9553$9566[1]),((t3$9574 instanceof Array)&&((t4$9575=t3$9574.length),((t4$9575===2)&&(t3$9574[0]==="symbol"))))))))){(s2$9599=t3$9574[1]);return (((!$7843(ban1$9550,s1$9598))&&(!$7843(ban2$9551,s2$9599)))&&(s1$9598===s2$9599));}else{if(($9560$9583&&((t1$9572[0]==="value")&&((v1$9607=t1$9572[1]),((t3$9574=$9553$9566[1]),((t3$9574 instanceof Array)&&((t4$9575=t3$9574.length),((t4$9575===2)&&(t3$9574[0]==="value"))))))))){(v2$9608=t3$9574[1]);return (v1$9607===v2$9608);}else{if(($9560$9583&&((t1$9572[0]==="macro")&&((m1$9616=t1$9572[1]),((t3$9574=$9553$9566[1]),((t3$9574 instanceof Array)&&((t4$9575=t3$9574.length),((t4$9575===2)&&(t3$9574[0]==="macro"))))))))){(m2$9617=t3$9574[1]);return (m1$9616===m2$9617);}else{if(($9558$9581&&((t2$9573>=1)&&((type1$9625=t1$9572[0]),((args1$9626=Array.prototype.slice.call(t1$9572,1)),((t3$9574=$9553$9566[1]),((t3$9574 instanceof Array)&&((t4$9575=t3$9574.length),((t4$9575>=1)&&((type2$9627=t3$9574[0]),((args2$9628=Array.prototype.slice.call(t3$9574,1)),(checkall$7900.indexOf(type1$9625)!==(-1))))))))))))){if(((type1$9625===type2$9627)&&(args1$9626.length===args2$9628.length))){(temp$9641=zip$7885(args1$9626,args2$9628));;(len$9646=temp$9641.length);;(i$9651=0);;$9638:for(;(i$9651<len$9646);(i$9651++)){var pair$9667;var m$9659;(m$9659=temp$9641[i$9651]);;(pair$9667=m$9659);if((!same_block$7901(pair$9667,ban1$9550,ban2$9551))){return false;}}return true;}else{return false;}}else{(other$9672=$9553$9566);return false;}}}}}});;(parse_clauses$7902=function(scope$9678,target$9679,stmts$9680,opt$9681){var i$9710;var len$9705;var temp$9700;var acc$9695;var i$9884;var len$9879;var temp$9874;var acc$9869;var i$9930;var len$9925;var temp$9920;var acc$9915;var decls$9910;var all_temps$9684;var the_parts$9685;var unique_temps$9686;(all_temps$9684=[]);;(the_parts$9685=(((acc$9695=[])),(((temp$9700=scope$9678.step_all(["clause"],stmts$9680))),(((len$9705=temp$9700.length)),(((i$9710=0)),function(){$9692:for(;(i$9710<len$9705);(i$9710++)){var accum$9784;var accum$9795;var t0$9780;var t1$9781;var i$9818;var len$9813;var temp$9808;var bod$9845;var placeholder$9735;var special_fn$9736;var vars$9737;var temps$9738;var blocks$9739;var vars2$9740;var x$9854;var other$9861;var b$9851;var pattern$9729;var body$9730;var $9693$9726;var t0$9723;var t1$9724;var m$9718;(m$9718=temp$9700[i$9710]);;(t0$9723=m$9718);if(((t0$9723 instanceof Array)&&((t1$9724=t0$9723.length),((t1$9724===3)&&(t0$9723[0]==="clause"))))){(pattern$9729=t0$9723[1]);(body$9730=t0$9723[2]);acc$9695.push((((placeholder$9735=(void 0))),((special_fn$9736=function($9747$9749,value$9750){var t0$9756;var t1$9757;var other$9776;var $9752$9763;var ph$9753;var expr$9754;(t0$9756=$9747$9749);if(((t0$9756 instanceof Array)&&((t1$9757=t0$9756.length),((t1$9757===2)&&(t0$9756[0]==="special"))))){(ph$9753=t0$9756[1]);(expr$9754=t0$9756);;}else{$10672($9747$9749);}($9752$9763=ph$9753);;if(($9752$9763==="match")){(placeholder$9735=__lt____lt____colon__$7881(["symbol",scope$9678.gensym("ph")],expr$9754));return ["assign",placeholder$9735];}else{(other$9776=$9752$9763);throw $10566(["syntax","pattern","special"]).create("Special token cannot be used here",({"special":expr$9754}));}})),((t0$9780=parse_pattern$7899(scope$9678,pattern$9729,target$9679,$10767(opt$9681,$10685(({"allow_arguments":false,"allow_nested":true,"special":special_fn$9736}),$10685(((accum$9784=({})),((accum$9784["assign"]=function(v$9788,value$9789){return ["do",__lt____lt____colon__$7881(["assign",v$9788,value$9789],v$9788)];}),accum$9784)),({"finalize":false})))))),function(){if(((t0$9780 instanceof Array)&&((t1$9781=t0$9780.length),(t1$9781===3)))){(vars$9737=t0$9780[0]);(temps$9738=t0$9780[1]);(blocks$9739=t0$9780[2]);}else{return $10672(parse_pattern$7899(scope$9678,pattern$9729,target$9679,$10767(opt$9681,$10685(({"allow_arguments":false,"allow_nested":true,"special":special_fn$9736}),$10685(((accum$9795=({})),((accum$9795["assign"]=function(v$9799,value$9800){return ["do",__lt____lt____colon__$7881(["assign",v$9799,value$9800],v$9799)];}),accum$9795)),({"finalize":false}))))),"/home/olivier/git/earl-grey/src/pattern.eg",13403,13751);}}()),(all_temps$9684=all_temps$9684.concat(temps$9738)),function(){if(placeholder$9735){return vars$9737.push(placeholder$9735);}}(),((vars2$9740=({}))),(((temp$9808=vars$9737)),(((len$9813=temp$9808.length)),(((i$9818=0)),function(){$9741:for(;(i$9818<len$9813);(i$9818++)){var other$9842;var xxx$9836;var t0$9831;var t1$9832;var m$9826;(m$9826=temp$9808[i$9818]);;(t0$9831=m$9826);if(((t0$9831 instanceof Array)&&((t1$9832=t0$9831.length),((t1$9832===2)&&(t0$9831[0]==="symbol"))))){(xxx$9836=t0$9831[1]);(vars2$9740[xxx$9836]=true);}else{(other$9842=m$9826);throw $10566(["syntax","unexpected"]).create();}}}()))),(((bod$9845=function(){if(placeholder$9735){return parse_clauses$7902(scope$9678,placeholder$9735,$10735(["multi"])(body$9730)[1],opt$9681);}else{if(opt$9681.wrap){return opt$9681.wrap(body$9730);}else{return body$9730;}}}())),["clause",vars$9737,vars2$9740,blocks$9739,bod$9845])));}else{if((((x$9854=t0$9723)),((x$9854 instanceof Array)&&(x$9854[0]==="block")))){(b$9851=t0$9723);acc$9695.push(b$9851);}else{(other$9861=m$9718);acc$9695.push(function(){throw $10566(["syntax","clause"]).create("Illegal clause",({"clause":other$9861}));}());}}}}()))),acc$9695));;if(opt$9681.fallback){the_parts$9685.push(["block",opt$9681.fallback(target$9679)]);}(unique_temps$9686=iterkeys$7887(util$7882.set((((acc$9869=[])),(((temp$9874=all_temps$9684)),(((len$9879=temp$9874.length)),(((i$9884=0)),function(){$9867:for(;(i$9884<len$9879);(i$9884++)){var t$9902;var t0$9897;var t1$9898;var m$9892;(m$9892=temp$9874[i$9884]);;(t0$9897=m$9892);if(((t0$9897 instanceof Array)&&((t1$9898=t0$9897.length),((t1$9898===2)&&(t0$9897[0]==="symbol"))))){(t$9902=t0$9897[1]);acc$9869.push(t$9902);}else{false;;}}}()))),acc$9869))));;(decls$9910=(((acc$9915=[])),(((temp$9920=unique_temps$9686)),(((len$9925=temp$9920.length)),(((i$9930=0)),function(){$9913:for(;(i$9930<len$9925);(i$9930++)){var t$9946;var m$9938;(m$9938=temp$9920[i$9930]);;(t$9946=m$9938);acc$9915.push(["declare",["symbol",t$9946]]);}}()))),acc$9915));;return ["multi"].concat(decls$9910).concat([weave_clauses$7904(the_parts$9685)]);});;(opt_clauses$7903=function(clauses$9953){var i$9981;var len$9976;var temp$9971;var acc$9966;var i$10114;var len$10109;var temp$10104;var acc$10099;var i$10158;var len$10153;var temp$10148;var acc$10143;var i$10201;var len$10196;var temp$10191;var acc$10186;var shares$9956;var max$9957;var temps$9958;var shared_last$9959;var idx_last$9960;var new_clauses$9961;(shares$9956=(((acc$9966=[])),(((temp$9971=enumerate$7886(clauses$9953.slice(1)))),(((len$9976=temp$9971.length)),(((i$9981=0)),function(){$9964:for(;(i$9981<len$9976);(i$9981++)){var t0$10019;var t1$10020;var i$10043;var len$10038;var temp$10033;var varsd0$10013;var blocks0$10014;var share$10015;var idx$10016;var i$10001;var vars$10002;var varsd$10003;var blocks$10004;var body$10005;var t0$9994;var t1$9995;var t2$9996;var t3$9997;var m$9989;(m$9989=temp$9971[i$9981]);;(t0$9994=m$9989);if(((t0$9994 instanceof Array)&&((t1$9995=t0$9994.length),((t1$9995===2)&&((i$10001=t0$9994[0]),((t2$9996=t0$9994[1]),((t2$9996 instanceof Array)&&((t3$9997=t2$9996.length),((t3$9997===5)&&(t2$9996[0]==="clause")))))))))){(vars$10002=t2$9996[1]);(varsd$10003=t2$9996[2]);(blocks$10004=t2$9996[3]);(body$10005=t2$9996[4]);acc$9966.push((((t0$10019=$7843(clauses$9953,i$10001)),function(){if(((t0$10019 instanceof Array)&&((t1$10020=t0$10019.length),((t1$10020===5)&&(t0$10019[0]==="clause"))))){t0$10019[1];(varsd0$10013=t0$10019[2]);(blocks0$10014=t0$10019[3]);t0$10019[4];}else{return $10672($7843(clauses$9953,i$10001),"/home/olivier/git/earl-grey/src/pattern.eg",14866,14876);}}()),((share$10015=0)),((idx$10016=0)),(((temp$10033=blocks$10004)),(((len$10038=temp$10033.length)),(((i$10043=0)),function(){$10017:for(;(i$10043<len$10038);(i$10043++)){var x$10074;var x$10083;var other$10090;var $10062$10064;var b$10059;var m$10051;(m$10051=temp$10033[i$10043]);;(b$10059=m$10051);if(same_block$7901([$7843(blocks0$10014,share$10015),b$10059],varsd0$10013,varsd$10003)){(share$10015++);($10062$10064=b$10059);;if((((x$10074=$10062$10064)),((x$10074 instanceof Array)&&(x$10074[0]==="do")))){null;}else{if((((x$10083=$10062$10064)),((x$10083 instanceof Array)&&(x$10083[0]==="check")))){(idx$10016=share$10015);}else{(other$10090=$10062$10064);__lt____gt__$7879(null,other$10090);}}}else{break $10017;}}}()))),[share$10015,idx$10016]));}else{false;;}}}()))),acc$9966));;(max$9957=$7843(Math.max,(((acc$10099=[])),(((temp$10104=shares$9956)),(((len$10109=temp$10104.length)),(((i$10114=0)),function(){$10097:for(;(i$10114<len$10109);(i$10114++)){var x$10132;var t0$10127;var t1$10128;var m$10122;(m$10122=temp$10104[i$10114]);;(t0$10127=m$10122);if(((t0$10127 instanceof Array)&&((t1$10128=t0$10127.length),(t1$10128===2)))){(x$10132=t0$10127[0]);t0$10127[1];acc$10099.push(x$10132);}else{false;;}}}()))),acc$10099)));;shares$9956.push([0,0]);(temps$9958=(((acc$10143=[])),(((temp$10148=$10789(1,max$9957))),(((len$10153=temp$10148.length)),(((i$10158=0)),function(){$10141:for(;(i$10158<len$10153);(i$10158++)){var m$10166;(m$10166=temp$10148[i$10158]);;m$10166;acc$10143.push(["symbol",gensym$7884()]);}}()))),acc$10143));;(shared_last$9959=0);;(idx_last$9960=0);;(new_clauses$9961=(((acc$10186=[])),(((temp$10191=enumerate$7886(clauses$9953))),(((len$10196=temp$10191.length)),(((i$10201=0)),function(){$10184:for(;(i$10201<len$10196);(i$10201++)){var t0$10239;var t1$10240;var i$10274;var len$10269;var temp$10264;var acc$10259;var rest$10323;var newblocks$10319;var share$10233;var idx$10234;var shared$10235;var n_to_share$10236;var to_share$10237;var other$10330;var i$10221;var vars$10222;var varsd$10223;var blocks$10224;var body$10225;var t0$10214;var t1$10215;var t2$10216;var t3$10217;var m$10209;(m$10209=temp$10191[i$10201]);;(t0$10214=m$10209);if(((t0$10214 instanceof Array)&&((t1$10215=t0$10214.length),((t1$10215===2)&&((i$10221=t0$10214[0]),((t2$10216=t0$10214[1]),((t2$10216 instanceof Array)&&((t3$10217=t2$10216.length),((t3$10217===5)&&(t2$10216[0]==="clause")))))))))){(vars$10222=t2$10216[1]);(varsd$10223=t2$10216[2]);(blocks$10224=t2$10216[3]);(body$10225=t2$10216[4]);acc$10186.push((((t0$10239=$7843(shares$9956,i$10221)),function(){if(((t0$10239 instanceof Array)&&((t1$10240=t0$10239.length),(t1$10240===2)))){(share$10233=t0$10239[0]);(idx$10234=t0$10239[1]);}else{return $10672($7843(shares$9956,i$10221),"/home/olivier/git/earl-grey/src/pattern.eg",15527,15536);}}()),((shared$10235=function(){if(idx_last$9960){return [["check",$7843(temps$9958,(idx_last$9960-1))]];}else{return [];}}())),((n_to_share$10236=Math.max(shared_last$9959,share$10233))),((to_share$10237=(((acc$10259=[])),(((temp$10264=enumerate$7886(blocks$10224.slice(shared_last$9959,n_to_share$10236)))),(((len$10269=temp$10264.length)),(((i$10274=0)),function(){$10253:for(;(i$10274<len$10269);(i$10274++)){var j$10308;var x$10309;var j$10298;var x$10299;var $10254$10292;var $10255$10293;var $10256$10294;var $10257$10295;var t0$10287;var t1$10288;var t2$10289;var t3$10290;var m$10282;(m$10282=temp$10264[i$10274]);;(t0$10287=m$10282);if((($10255$10293=(t0$10287 instanceof Array))&&((t1$10288=t0$10287.length),(($10257$10295=(t1$10288===2))&&((j$10298=t0$10287[0]),((t2$10289=t0$10287[1]),((t2$10289 instanceof Array)&&((t3$10290=t2$10289.length),((t3$10290===2)&&(t2$10289[0]==="check")))))))))){(x$10299=t2$10289[1]);acc$10259.push(["check",["assign",$7843(temps$9958,(shared_last$9959+j$10298)),x$10299]]);}else{if(($10257$10295&&((j$10308=t0$10287[0]),((t2$10289=t0$10287[1]),((t2$10289 instanceof Array)&&((t3$10290=t2$10289.length),((t3$10290===2)&&(t2$10289[0]==="do")))))))){(x$10309=t2$10289[1]);acc$10259.push(["do",x$10309]);}else{false;;}}}}()))),acc$10259))),(shared_last$9959=share$10233),(idx_last$9960=idx$10234),(((newblocks$10319=(((rest$10323=blocks$10224.slice(n_to_share$10236))),shared$10235.concat(to_share$10237).concat(rest$10323)))),["clause",vars$10222,varsd$10223,newblocks$10319,body$10225])));}else{(other$10330=m$10209);acc$10186.push(function(){throw $10566(["oops"]).create("what",({"value":other$10330}));}());}}}()))),acc$10186));;return [temps$9958,new_clauses$9961];});;(weave_clauses$7904=function(parts$10337){var i$10382;var len$10377;var temp$10372;var i$10546;var len$10541;var temp$10536;var acc$10531;var groups$10340;var reassemble$10341;var new_temps$10342;var helper$10343;(groups$10340=classify_contiguous$7890(parts$10337,function($10351$10353){var t0$10357;var t1$10358;var cls$10355;(t0$10357=$10351$10353);if(((t0$10357 instanceof Array)&&((t1$10358=t0$10357.length),(t1$10358>=1)))){(cls$10355=t0$10357[0]);Array.prototype.slice.call(t0$10357,1);;}else{$10672($10351$10353);}return cls$10355;}));;(reassemble$10341=[]);;(new_temps$10342=[]);;(temp$10372=groups$10340);;(len$10377=temp$10372.length);;(i$10382=0);;$10344:for(;(i$10382<len$10377);(i$10382++)){var t0$10412;var t1$10413;var ts$10409;var new_clauses$10410;var elems$10420;var elems$10404;var $10345$10398;var $10346$10399;var $10347$10400;var $10348$10401;var t0$10395;var t1$10396;var m$10390;(m$10390=temp$10372[i$10382]);;(t0$10395=m$10390);if((($10346$10399=(t0$10395 instanceof Array))&&((t1$10396=t0$10395.length),(($10348$10401=(t1$10396>=1))&&(t0$10395[0]==="clause"))))){(elems$10404=Array.prototype.slice.call(t0$10395,1));(t0$10412=opt_clauses$7903(elems$10404));if(((t0$10412 instanceof Array)&&((t1$10413=t0$10412.length),(t1$10413===2)))){(ts$10409=t0$10412[0]);(new_clauses$10410=t0$10412[1]);;}else{$10672(opt_clauses$7903(elems$10404),"/home/olivier/git/earl-grey/src/pattern.eg",16341,16359);}(new_temps$10342=new_temps$10342.concat(ts$10409));(reassemble$10341=reassemble$10341.concat(new_clauses$10410));}else{if(($10348$10401&&(t0$10395[0]==="block"))){(elems$10420=Array.prototype.slice.call(t0$10395,1));(reassemble$10341=reassemble$10341.concat(elems$10420));}else{false;;}}}(helper$10343=function($10427$10429){var i$10507;var len$10502;var temp$10497;var acc$10492;var decls$10487;var vars$10479;var varsd$10480;var blocks$10481;var body$10482;var rest$10483;var body$10468;var rest$10469;var $10432$10455;var $10433$10456;var $10434$10457;var $10435$10458;var $10436$10459;var $10437$10460;var t0$10448;var t1$10449;var t2$10450;var t3$10451;var t4$10452;var t5$10453;var $10431$10443;var ph$10438;(ph$10438=$10427$10429);;($10431$10443=ph$10438);;if((($10432$10455=($10431$10443 instanceof Array))&&((t0$10448=$10431$10443.length),(t0$10448===0)))){return ["multi"];}else{if(($10432$10455&&(($10434$10457=(t0$10448>=1))&&((t1$10449=$10431$10443[0]),(($10436$10459=(t1$10449 instanceof Array))&&((t2$10450=t1$10449.length),((t2$10450===2)&&((t1$10449[0]==="block")&&((t3$10451=$10735(["multi"])(t1$10449[1])),(t3$10451[0]&&((t4$10452=t3$10451[1]),((t5$10453=t4$10452.length),(t5$10453>=0))))))))))))){(body$10468=Array.prototype.slice.call(t4$10452,0));(rest$10469=Array.prototype.slice.call($10431$10443,1));return ["multi"].concat(body$10468).concat([helper$10343(rest$10469)]);}else{if(($10436$10459&&((t2$10450===5)&&(t1$10449[0]==="clause")))){(vars$10479=t1$10449[1]);(varsd$10480=t1$10449[2]);(blocks$10481=t1$10449[3]);(body$10482=t1$10449[4]);(rest$10483=Array.prototype.slice.call($10431$10443,1));(decls$10487=(((acc$10492=[])),(((temp$10497=vars$10479)),(((len$10502=temp$10497.length)),(((i$10507=0)),function(){$10490:for(;(i$10507<len$10502);(i$10507++)){var v$10523;var m$10515;(m$10515=temp$10497[i$10507]);;(v$10523=m$10515);acc$10492.push(["declare",v$10523]);}}()))),acc$10492));;return ["tagscope","back",["multi"].concat(decls$10487).concat([assemble_pattern$7897(blocks$10481,body$10482,["use","back",helper$10343(rest$10483)])])];}else{$10672($10431$10443);}}}});;return ["multi"].concat((((acc$10531=[])),(((temp$10536=new_temps$10342)),(((len$10541=temp$10536.length)),(((i$10546=0)),function(){$10529:for(;(i$10546<len$10541);(i$10546++)){var t$10562;var m$10554;(m$10554=temp$10536[i$10546]);;(t$10562=m$10554);acc$10531.push(["declare",t$10562]);}}()))),acc$10531)).concat([helper$10343(reassemble$10341)]);});;(exports["PatternParser"]=PatternParser$7894);(exports["PatternProcessor"]=PatternProcessor$7895);(exports["parse_clauses"]=parse_clauses$7902);(exports["parse_pattern"]=parse_pattern$7899);
