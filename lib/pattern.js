var $7713=function(type$7715){var f$7718;(f$7718=type$7715["::check"]);;if((f$7718===(void 0))){return function(value$7723){return (value$7723 instanceof type$7715);};}else{return function(value$7726){return f$7718.call(type$7715,value$7726);};}};
var $7728=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $7729=function($7730$7732){var ph$7736;(ph$7736=$7730$7732);;var $7734$7741;($7734$7741=ph$7736);;var bridge$7735$7746;var x$7750;(bridge$7735$7746=$7734$7741);if((((typeof(bridge$7735$7746)==="string")&&((x$7750=bridge$7735$7746),true))||((typeof(bridge$7735$7746)==="number")&&((x$7750=bridge$7735$7746),true)))){return ["value",x$7750];}else{var other$7757;(other$7757=$7734$7741);return other$7757["::serialize_ast"]();}};
var send$7597;(send$7597=function(obj$7602,$7600$7603){var ph$7607;var msg$7608;var t0$7610;(t0$7610=$7600$7603);(msg$7608=t0$7610);(ph$7607=t0$7610);;var $7605$7614;($7605$7614=ph$7607);;var bridge$7606$7619;(bridge$7606$7619=$7605$7614);if(((typeof(bridge$7606$7619)==="string")||(typeof(bridge$7606$7619)==="number"))){return obj$7602[msg$7608];}else{var other$7627;(other$7627=$7605$7614);return obj$7602["::send"](msg$7608);}});;(Array[":::project"]=function($7630$7632){var ph$7635;var value$7636;var t0$7638;(t0$7638=$7630$7632);(value$7636=t0$7638);(ph$7635=t0$7638);;var $7634$7642;($7634$7642=ph$7635);;if($7713(Array)($7634$7642)){return [true,value$7636];}else{$7634$7642;return [true,[value$7636]];}});(Array.prototype["::check"]=function(value$7656){if((value$7656 instanceof Array)){var i$7661;(i$7661=0);;$7659:for(;(i$7661<this.length);(i$7661++)){if(($7728(this,i$7661)!==$7728(value$7656,i$7661))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return this.slice(0);});(Array.prototype[":::project"]=function(value$7672){if((value$7672 instanceof Array)){var i$7677;(i$7677=0);;$7675:for(;(i$7677<this.length);(i$7677++)){if(($7728(this,i$7677)!==$7728(value$7672,i$7677))){return [true,[value$7672]];}}return [true,value$7672.slice(this.length)];}else{return [true,[value$7672]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($7729));});(RegExp.prototype["::check"]=function(value$7688){return value$7688.match(this);});(RegExp.prototype[":::project"]=function(value$7691){var $7693$7695;($7693$7695=value$7691.match(this));;var m$7703;if(($7693$7695===null)){(m$7703=$7693$7695);return [false,null];}else{var m$7708;(m$7708=$7693$7695);return [true,m$7708];}});(Function.prototype["::send"]=function(args$7711){return this.apply(this,args$7711);});
var $10605=function(value$10607,url$10608,start$10609,end$10610){var err$10613;(err$10613=$10498(["match"]).create("Could not find a match for value",({"value":value$10607})));;if(url$10608){(err$10613["location"]=["location",url$10608,start$10609,end$10610]);}throw err$10613;};
var $10618=function(dest$10620,values$10621){var k$10626;(k$10626=null);$10624:for(k$10626 in values$10621){if(values$10621.hasOwnProperty(k$10626)){(dest$10620[k$10626]=values$10621[k$10626]);}}return dest$10620;};
var $10498=function(){var $10499$10501;($10499$10501=function(tags$10505){var it$0$10508;(it$0$10508=function(){if((!$7713($10499$10501)(this))){return Object.create($10499$10501.prototype);}else{return this;}}());;(it$0$10508["tags"]=tags$10505);return it$0$10508;});;($10499$10501.prototype["create"]=function(){var $10517$10519;($10517$10519=arguments);;var t0$10524;var message$10528;var args$10529;(t0$10524=$10517$10519.length);if((t0$10524>=0)){(message$10528=function(){if((0>=t0$10524)){return "";}else{return $10517$10519[0];}}());(args$10529=Array.prototype.slice.call($10517$10519,1));var it$0$10533;(it$0$10533=this);;var e$10538;(e$10538=Error(message$10528));;(e$10538["::tags"]=it$0$10533.tags);(e$10538["args"]=args$10529);(e$10538["name"]=["E"].concat(it$0$10533.tags).join("."));return e$10538;}else{$10605($10517$10519);}});($10499$10501.prototype["::check"]=function(e$10547){var it$0$10550;(it$0$10550=this);;var tags$10555;if(((!e$10547)||(!$7713(Error)(e$10547)))){return false;}(tags$10555=(e$10547["::tags"]||[]));;var temp$10564;(temp$10564=it$0$10550.tags);;var $length$10569;($length$10569=temp$10564.length);;var $index$10574;($index$10574=0);;$10556:for(;($index$10574<$length$10569);($index$10574++)){var m$10582;(m$10582=temp$10564[$index$10574]);;var tag$10590;(tag$10590=m$10582);if((tags$10555.indexOf(tag$10590)===(-1))){return false;}else{false;;}}return true;});($10499$10501.prototype["::deconstruct"]=function(e$10598){var it$0$10601;(it$0$10601=this);;return e$10598.args;});$10618($10499$10501,({}));return $10499$10501;}();
var $10630=function($10631$10633,key$10634){var ph$10638;(ph$10638=$10631$10633);;var $10636$10643;($10636$10643=ph$10638);;var bridge$10637$10648;(bridge$10637$10648=$10636$10643);if(((bridge$10637$10648===null)||(bridge$10637$10648===(void 0)))){return false;}else{var x$10656;if((typeof($10636$10643)==="string")){(x$10656=$10636$10643);return (key$10634 in String.prototype);}else{var x$10661;if((typeof($10636$10643)==="number")){(x$10661=$10636$10643);return (key$10634 in Number.prototype);}else{var x$10666;(x$10666=$10636$10643);return (key$10634 in x$10666);}}}};
var $10684=function($10685$10687){var ph$10693;var x$10694;var t0$10696;(t0$10696=$10685$10687);(x$10694=t0$10696);(ph$10693=t0$10696);;var $10689$10700;($10689$10700=ph$10693);;var bridge$10690$10705;(bridge$10690$10705=$10689$10700);if((function(){var bridge$10691$10711;(bridge$10691$10711=bridge$10690$10705);return (function(){var bridge$10692$10714;(bridge$10692$10714=bridge$10691$10711);return ((bridge$10692$10714===(void 0))||(bridge$10692$10714===null));}()||(typeof(bridge$10691$10711)==="string"));}()||(typeof(bridge$10690$10705)==="number"))){return x$10694;}else{if($10630($10689$10700,"::clone")){$10689$10700["::clone"];return x$10694["::clone"]();}else{$10689$10700;if((Object.getPrototypeOf(x$10694)===Object.prototype)){var dest$10727;(dest$10727=({}));;var k$10732;(k$10732=null);$10726:for(k$10732 in x$10694){if(Object.prototype.hasOwnProperty.call(x$10694,k$10732)){(dest$10727[k$10732]=x$10694[k$10732]);}}return dest$10727;}else{var other$10738;(other$10738=$10689$10700);throw $10498(["clone"]).create("Object cannot be cloned",({"obj":x$10694}));}}}};
var $10668=function(a$10670,b$10671){var dest$10675;(dest$10675=$10684(a$10670));;var k$10680;(k$10680=null);$10674:for(k$10680 in b$10671){if(Object.prototype.hasOwnProperty.call(b$10671,k$10680)){(dest$10675[k$10680]=b$10671[k$10680]);}}return dest$10675;};
var $10740=function(type$10742){return function(value$10745){var f$10748;(f$10748=type$10742[":::project"]);;if((f$10748===(void 0))){var f$10753;(f$10753=type$10742["::project"]);;if((f$10753===(void 0))){return [true,type$10742(value$10745)];}else{var rval$10758;(rval$10758=false);;try{(rval$10758=[true,f$10753(value$10745)]);}catch(excv$10764){var e$10770;(e$10770=excv$10764);(rval$10758=[false,null]);}return rval$10758;}}else{return f$10748.call(type$10742,value$10745);}};};
var $10772=function(from$10774,to$10775){var rval$10779;(rval$10779=[]);;var i$10784;(i$10784=from$10774);;$10778:for(;(i$10784<=to$10775);(i$10784++)){rval$10779.push(i$10784);}return rval$10779;};var $7760$7764;var __lt____gt__$7765;var $7761$7766;var __lt____lt____colon__$7767;var util$7768;var GenSym$7769;var gensym$7770;var zip$7771;var enumerate$7772;var iterkeys$7773;var neighbours$7774;var classify$7775;var classify_contiguous$7776;var identity$7777;var $7763$7778;var checker_db$7779;var PatternParser$7780;var PatternProcessor$7781;var assemble_conditions$7782;var assemble_pattern$7783;var inject_below_uses$7784;var parse_pattern$7785;var checkall$7786;var same_block$7787;var parse_clauses$7788;var opt_clauses$7789;var weave_clauses$7790;($7760$7764=require("./pp"));;(__lt____gt__$7765=$7760$7764["<>"]);;($7761$7766=require("./location"));;(__lt____lt____colon__$7767=$7761$7766["<<:"]);;(util$7768=require("./util"));;(GenSym$7769=util$7768.GenSym);;(gensym$7770=util$7768.gensym);;(zip$7771=util$7768.zip);;(enumerate$7772=util$7768.enumerate);;(iterkeys$7773=util$7768.keys);;(neighbours$7774=util$7768.neighbours);;(classify$7775=util$7768.classify);;(classify_contiguous$7776=util$7768.classify_contiguous);;(identity$7777=util$7768.identity);;($7763$7778=require("./expand"));;(checker_db$7779=$7763$7778.checker_db);;(PatternParser$7780=function(scope$7842,pattern$7843,opt$7844){var it$0$7847;(it$0$7847=function(){if((!$7713(PatternParser$7780)(this))){return Object.create(PatternParser$7780.prototype);}else{return this;}}());;(it$0$7847["opt"]=opt$7844);(it$0$7847["arguments"]=[]);(it$0$7847["vars"]=[]);(it$0$7847["specials"]=({}));(it$0$7847["pattern"]=it$0$7847.expand(scope$7842,pattern$7843,true,it$0$7847.opt.indexable));return it$0$7847;});;(PatternParser$7780.prototype["parse_specs"]=function(scope$7857,specs$7858){var $index$7899;var $length$7894;var temp$7889;var acc$7884;var rest$7866;var has_defaults$7867;var rval$7868;var it$0$7861;(it$0$7861=this);;(rest$7866=(void 0));;(has_defaults$7867=false);;(rval$7868=classify$7775("fw","bw","keys","defaults",(((acc$7884=[])),(((temp$7889=scope$7857.step_all(["pattern"],specs$7858))),((($length$7894=temp$7889.length)),((($index$7899=0)),function(){$7877:for(;($index$7899<$length$7894);($index$7899++)){var v$7951;var v$7946;var variable$7939;var value$7940;var key$7933;var subp$7934;var key$7928;var variable$7921;var $7879$7915;var $7880$7916;var $7881$7917;var $7882$7918;var t0$7912;var t1$7913;var m$7907;(m$7907=temp$7889[$index$7899]);;(t0$7912=m$7907);if((($7880$7916=(t0$7912 instanceof Array))&&((t1$7913=t0$7912.length),(($7882$7918=(t1$7913===2))&&(t0$7912[0]==="dynsplice"))))){(variable$7921=t0$7912[1]);acc$7884.push(((rest$7866=it$0$7861.expand(scope$7857,variable$7921)),["ignore"]));}else{if(($7882$7918&&(t0$7912[0]==="assoc"))){(key$7928=t0$7912[1]);acc$7884.push(["keys",[key$7928,it$0$7861.expand(scope$7857,key$7928)]]);}else{if(($7880$7916&&(($7882$7918=(t1$7913===3))&&(t0$7912[0]==="assoc")))){(key$7933=t0$7912[1]);(subp$7934=t0$7912[2]);acc$7884.push(["keys",[key$7933,it$0$7861.expand(scope$7857,subp$7934)]]);}else{if(($7882$7918&&(t0$7912[0]==="default"))){(variable$7939=t0$7912[1]);(value$7940=t0$7912[2]);acc$7884.push(((has_defaults$7867=true),function(){if(rest$7866){throw $10498(["syntax","pattern"]).create("No default arguments after rest arg.");}else{return ["defaults",[it$0$7861.expand(scope$7857,variable$7939),value$7940]];}}()));}else{(v$7946=m$7907);if(((rest$7866===(void 0))&&(!has_defaults$7867))){acc$7884.push(["fw",it$0$7861.expand(scope$7857,v$7946)]);}else{(v$7951=m$7907);acc$7884.push(["bw",it$0$7861.expand(scope$7857,v$7951)]);}}}}}}}()))),acc$7884)));;(rval$7868["rest"]=rest$7866);return rval$7868;});(PatternParser$7780.prototype["expand"]=function(){var x$8011;var x$8020;var x$8036;var x$8041;var msg$8087;var x$8099;var msg$8112;var msg$8121;var $index$8154;var $length$8149;var temp$8144;var acc$8139;var $index$8258;var $length$8253;var temp$8248;var acc$8243;var $index$8289;var $length$8284;var temp$8279;var t0$8350;var t1$8351;var t2$8352;var $index$8380;var $length$8375;var temp$8370;var acc$8365;var patts$8359;var canon$8178;var normalize$8179;var pps$8180;var vars$8181;var patt$8439;var msg$8460;var other$8457;var keys$8445;var fw$8427;var bw$8428;var defaults$8429;var rest$8430;var $8406$8424;var t0$8417;var t1$8418;var t2$8419;var t3$8420;var t4$8421;var t5$8422;var $8405$8412;var specs$8407;var other$8466;var args$8401;var xs$8174;var xs$8133;var x$8127;var f$8107;var arg$8108;var f$8093;var arguments$8094;var f$8080;var arg$8081;var checker$8074;var subp$8075;var projector$8068;var subp$8069;var condition$8062;var subp$8063;var v$8057;var v$8049;var type$8027;var $7989$8003;var $7990$8004;var $7991$8005;var $7992$8006;var t0$7999;var bridge$7988$8000;var t1$8001;var $7987$7994;var expr$7980;var rval$7981;var it$0$7975;var scope$7968;var pattern$7969;var toplevel$7970;var checked$7971;var t0$7964;var $7957$7959;($7957$7959=arguments);;(t0$7964=$7957$7959.length);if(((t0$7964>=2)&&(t0$7964<=4))){(scope$7968=$7957$7959[0]);(pattern$7969=$7957$7959[1]);(toplevel$7970=function(){if((2>=t0$7964)){return false;}else{return $7957$7959[2];}}());(checked$7971=function(){if((3>=t0$7964)){return false;}else{return $7957$7959[3];}}());(it$0$7975=this);;(expr$7980=scope$7968.step(["pattern"],pattern$7969));;(rval$7981=((($7987$7994=expr$7980)),function(){if((((x$8011=$7987$7994)),((x$8011 instanceof Array)&&(x$8011[0]==="void")))){return ["check",checker_db$7779.null,["ignore"]];}else{if((((x$8020=$7987$7994)),((x$8020 instanceof Array)&&(x$8020[0]==="ignore")))){return expr$7980;}else{if((($7987$7994 instanceof Array)&&((t0$7999=$7987$7994.length),((t0$7999===2)&&($7987$7994[0]==="special"))))){(type$8027=$7987$7994[1]);(it$0$7975.specials[type$8027]=true);return expr$7980;}else{(bridge$7988$8000=$7987$7994);if(((((x$8036=bridge$7988$8000)),((x$8036 instanceof Array)&&(x$8036[0]==="symbol")))||(((x$8041=bridge$7988$8000)),((x$8041 instanceof Array)&&(x$8041[0]==="variable"))))){it$0$7975.vars.push(expr$7980);return ["assign",expr$7980];}else{if((($7989$8003=($7987$7994 instanceof Array))&&((t0$7999=$7987$7994.length),(($7991$8005=(t0$7999===2))&&(($7992$8006=($7987$7994[0]==="value"))&&((v$8049=$7987$7994[1]),it$0$7975.opt.strings_as_variables)))))){it$0$7975.vars.push(expr$7980);return ["assign",expr$7980];}else{if($7992$8006){(v$8057=$7987$7994[1]);return ["check",checker_db$7779(v$8057),["ignore"]];}else{if(($7989$8003&&(($7991$8005=(t0$7999===3))&&($7987$7994[0]==="test")))){(condition$8062=$7987$7994[1]);(subp$8063=$7987$7994[2]);return ["test",condition$8062,it$0$7975.expand(scope$7968,subp$8063,toplevel$7970,false)];}else{if(($7991$8005&&($7987$7994[0]==="project"))){(projector$8068=$7987$7994[1]);(subp$8069=$7987$7994[2]);return ["project",projector$8068,it$0$7975.expand(scope$7968,subp$8069,toplevel$7970,true)];}else{if(($7991$8005&&($7987$7994[0]==="check"))){(checker$8074=$7987$7994[1]);(subp$8075=$7987$7994[2]);return ["check",checker$8074,it$0$7975.expand(scope$7968,subp$8075,toplevel$7970,true)];}else{if(($7991$8005&&(($7992$8006=($7987$7994[0]==="send"))&&((f$8080=$7987$7994[1]),((arg$8081=$7987$7994[2]),(!toplevel$7970)))))){(msg$8087="Function arguments can only be declared as a top level pattern.");;throw $10498(["syntax","pattern"]).create(msg$8087,({"node":expr$7980,"arg":arg$8081}));}else{if(($7992$8006&&((f$8093=$7987$7994[1]),((t1$8001=$7987$7994[2]),(((x$8099=t1$8001)),((x$8099 instanceof Array)&&(x$8099[0]==="data"))))))){(arguments$8094=t1$8001);it$0$7975.arguments.unshift(arguments$8094);return it$0$7975.expand(scope$7968,f$8093,true,false);}else{if($7992$8006){(f$8107=$7987$7994[1]);(arg$8108=$7987$7994[2]);(msg$8112=["Function must be declared with an array of arguments","(did you mean to use ':='?)"].join(" "));;throw $10498(["syntax","pattern"]).create(msg$8112,({"node":expr$7980,"arg":arg$8108}));}else{$7987$7994;if((!it$0$7975.opt.allow_nested)){(msg$8121="Nested patterns are not allowed here.");;throw $10498(["syntax","pattern"]).create(msg$8121,({"node":expr$7980}));}else{if((($7989$8003=($7987$7994 instanceof Array))&&((t0$7999=$7987$7994.length),((t0$7999===2)&&($7987$7994[0]==="neg"))))){(x$8127=$7987$7994[1]);return ["neg",it$0$7975.expand(scope$7968,x$8127)];}else{if(($7989$8003&&(($7991$8005=(t0$7999>=1))&&($7987$7994[0]==="all")))){(xs$8133=Array.prototype.slice.call($7987$7994,1));return ["all"].concat((((acc$8139=[])),(((temp$8144=xs$8133)),((($length$8149=temp$8144.length)),((($index$8154=0)),function(){$8136:for(;($index$8154<$length$8149);($index$8154++)){var x$8170;var m$8162;(m$8162=temp$8144[$index$8154]);;(x$8170=m$8162);acc$8139.push(it$0$7975.expand(scope$7968,x$8170));}}()))),acc$8139));}else{if(($7991$8005&&($7987$7994[0]==="any"))){(xs$8174=Array.prototype.slice.call($7987$7994,1));(canon$8178=function(all$8187){return all$8187.sort().join(",");});;(normalize$8179=function(vars$8193){var $index$8213;var $length$8208;var temp$8203;var acc$8198;return canon$8178((((acc$8198=[])),(((temp$8203=vars$8193)),((($length$8208=temp$8203.length)),((($index$8213=0)),function(){$8195:for(;($index$8213<$length$8208);($index$8213++)){var v$8231;var t0$8226;var t1$8227;var m$8221;(m$8221=temp$8203[$index$8213]);;(t0$8226=m$8221);if(((t0$8226 instanceof Array)&&((t1$8227=t0$8226.length),((t1$8227===2)&&(t0$8226[0]==="symbol"))))){(v$8231=t0$8226[1]);acc$8198.push(v$8231);}else{$10605(m$8221,"/home/olivier/git/earl-grey/src/pattern.eg",3447,3504);;}}}()))),acc$8198));});;(pps$8180=(((acc$8243=[])),(((temp$8248=xs$8174)),((($length$8253=temp$8248.length)),((($index$8258=0)),function(){$8240:for(;($index$8258<$length$8253);($index$8258++)){var x$8274;var m$8266;(m$8266=temp$8248[$index$8258]);;(x$8274=m$8266);acc$8243.push(PatternParser$7780(scope$7968,x$8274,it$0$7975.opt));}}()))),acc$8243));;(temp$8279=neighbours$7774(pps$8180));;($length$8284=temp$8279.length);;($index$8289=0);;$8182:for(;($index$8289<$length$8284);($index$8289++)){var $index$8327;var $length$8322;var temp$8317;var pp1$8307;var pp2$8308;var t0$8302;var t1$8303;var m$8297;(m$8297=temp$8279[$index$8289]);;(t0$8302=m$8297);if(((t0$8302 instanceof Array)&&((t1$8303=t0$8302.length),(t1$8303===2)))){(pp1$8307=t0$8302[0]);(pp2$8308=t0$8302[1]);(temp$8317=pps$8180);;($length$8322=temp$8317.length);;($index$8327=0);;$8313:for(;($index$8327<$length$8322);($index$8327++)){var pp$8343;var m$8335;(m$8335=temp$8317[$index$8327]);;(pp$8343=m$8335);normalize$8179(pp$8343.vars);}if((normalize$8179(pp1$8307.vars)!==normalize$8179(pp2$8308.vars))){throw $10498(["syntax","pattern"]).create("Both branches of 'or' must contain the same variables",({"vars1":__lt____lt____colon__$7767(pp1$8307.vars.sort(),pp1$8307.pattern),"vars2":__lt____lt____colon__$7767(pp2$8308.vars.sort(),pp2$8308.pattern)}));}if((canon$8178(iterkeys$7773(pp1$8307.specials))!==canon$8178(iterkeys$7773(pp2$8308.specials)))){throw $10498(["syntax","pattern"]).create("Both branches of 'or' must contain the same special tokens",({"special1":__lt____lt____colon__$7767(iterkeys$7773(pp1$8307.specials).sort(),pp1$8307.pattern),"special2":__lt____lt____colon__$7767(iterkeys$7773(pp2$8308.specials).sort(),pp2$8308.pattern)}));}}else{$10605(m$8297,"/home/olivier/git/earl-grey/src/pattern.eg",3580,4393);;}}(t0$8350=pps$8180);if(((t0$8350 instanceof Array)&&((t1$8351=t0$8350.length),((t1$8351>=1)&&((t2$8352=t0$8350[0]),$10630(t2$8352,"vars")))))){(vars$8181=t2$8352.vars);Array.prototype.slice.call(t0$8350,1);;}else{$10605(pps$8180,"/home/olivier/git/earl-grey/src/pattern.eg",4410,4413);}(it$0$7975["vars"]=it$0$7975.vars.concat(vars$8181));(patts$8359=(((acc$8365=[])),(((temp$8370=pps$8180)),((($length$8375=temp$8370.length)),((($index$8380=0)),function(){$8362:for(;($index$8380<$length$8375);($index$8380++)){var pp$8396;var m$8388;(m$8388=temp$8370[$index$8380]);;(pp$8396=m$8388);acc$8365.push(pp$8396.pattern);}}()))),acc$8365));;return ["any"].concat(patts$8359);}else{if(($7991$8005&&($7987$7994[0]==="data"))){(args$8401=Array.prototype.slice.call($7987$7994,1));(specs$8407=it$0$7975.parse_specs(scope$7968,args$8401));;($8405$8412=specs$8407);;if((($8406$8424=$10630($8405$8412,"keys"))&&((t0$8417=$8405$8412.keys),((t0$8417 instanceof Array)&&((t1$8418=t0$8417.length),((t1$8418===0)&&($10630($8405$8412,"fw")&&((fw$8427=$8405$8412.fw),($10630($8405$8412,"bw")&&((bw$8428=$8405$8412.bw),($10630($8405$8412,"defaults")&&((defaults$8429=$8405$8412.defaults),$10630($8405$8412,"rest"))))))))))))){(rest$8430=$8405$8412.rest);(patt$8439=__lt____lt____colon__$7767(["array_pattern",fw$8427,bw$8428,defaults$8429,rest$8430],pattern$7969));;if(checked$7971){return patt$8439;}else{return ["check",checker_db$7779.Array,patt$8439];}}else{if(($8406$8424&&((keys$8445=$8405$8412.keys),($10630($8405$8412,"fw")&&((t0$8417=$8405$8412.fw),((t0$8417 instanceof Array)&&((t1$8418=t0$8417.length),((t1$8418===0)&&($10630($8405$8412,"bw")&&((t2$8419=$8405$8412.bw),((t2$8419 instanceof Array)&&((t3$8420=t2$8419.length),((t3$8420===0)&&($10630($8405$8412,"defaults")&&((t4$8421=$8405$8412.defaults),((t4$8421 instanceof Array)&&((t5$8422=t4$8421.length),((t5$8422===0)&&($10630($8405$8412,"rest")&&($8405$8412.rest===(void 0))))))))))))))))))))){return ["object_pattern"].concat(keys$8445);}else{(other$8457=$8405$8412);(msg$8460="Pattern must be an array or an object.");;throw $10498(["syntax","pattern"]).create(msg$8460,({"node":expr$7980,"specs":specs$8407}));}}}else{(other$8466=$7987$7994);throw $10498(["syntax","pattern"]).create("Illegal pattern",({"node":other$8466}));}}}}}}}}}}}}}}}}}}()));;return (it$0$7975.opt.wrap_pattern||identity$7777)(__lt____lt____colon__$7767(rval$7981,pattern$7969),toplevel$7970);}else{$10605($7957$7959);}});$10618(PatternParser$7780,({}));PatternParser$7780;(PatternProcessor$7781=function(){var it$0$8476;(it$0$8476=function(){if((!$7713(PatternProcessor$7781)(this))){return Object.create(PatternProcessor$7781.prototype);}else{return this;}}());;(it$0$8476["temps"]=[]);(it$0$8476["parts"]=[]);(it$0$8476["gen"]=GenSym$7769("t"));return it$0$8476;});;(PatternProcessor$7781.prototype["do"]=function(part$8486){var it$0$8489;(it$0$8489=this);;return it$0$8489.parts.push(["do",part$8486]);});(PatternProcessor$7781.prototype["check"]=function(){var it$0$8512;var part$8507;var tags$8508;var t0$8503;var $8496$8498;($8496$8498=arguments);;(t0$8503=$8496$8498.length);if(((t0$8503>=1)&&(t0$8503<=2))){(part$8507=$8496$8498[0]);(tags$8508=function(){if((1>=t0$8503)){return ({});}else{return $8496$8498[1];}}());(it$0$8512=this);;return it$0$8512.parts.push($10668(["check",part$8507],tags$8508));}else{$10605($8496$8498);}});(PatternProcessor$7781.prototype["temp"]=function(){var x$8555;var x$8560;var init$8567;var bridge$8538$8549;var $8537$8544;var it$0$8539;var x$8532;var v$8533;var t0$8528;var $8521$8523;($8521$8523=arguments);;(t0$8528=$8521$8523.length);if(((t0$8528>=1)&&(t0$8528<=2))){(x$8532=$8521$8523[0]);(v$8533=function(){if((1>=t0$8528)){return null;}else{return $8521$8523[1];}}());(it$0$8539=this);;($8537$8544=x$8532);;(bridge$8538$8549=$8537$8544);if((((((x$8555=bridge$8538$8549)),((x$8555 instanceof Array)&&(x$8555[0]==="variable")))||(((x$8560=bridge$8538$8549)),((x$8560 instanceof Array)&&(x$8560[0]==="symbol"))))&&($10630($8537$8544,"single_assignment")&&($8537$8544.single_assignment&&(!v$8533))))){return x$8532;}else{(init$8567=$8537$8544);(v$8533=(v$8533||["symbol",it$0$8539.gen()]));(v$8533["single_assignment"]=true);it$0$8539.temps.push(v$8533);it$0$8539.do(["send",["symbol",":="],["data",v$8533,init$8567]]);return v$8533;}}else{$10605($8521$8523);}});(PatternProcessor$7781.prototype["process"]=function(pattern$8575,rhs$8576,fns$8577){var x$8609;var x$8638;var t$8650;var t$8661;var pp$8671;var $index$8699;var $length$8694;var temp$8689;var t$8681;var $index$8757;var $length$8752;var temp$8747;var acc$8742;var fn$8728;var parts$8729;var t$8723;var $index$8809;var $length$8804;var temp$8799;var acc$8794;var t$8787;var otherwise$8908;var $8890$8892;var $index$8922;var $length$8917;var temp$8912;var $index$8959;var $length$8954;var temp$8949;var end$9001;var pos$8996;var $index$9021;var $length$9016;var temp$9011;var acc$9006;var nfw$8848;var nbw$8849;var ndflt$8850;var extract_length$8851;var check_length$8852;var lo$8853;var hi$8854;var t$8855;var len$8856;var fw$8841;var bw$8842;var dflt$8843;var rest$8844;var subp$8783;var xs$8719;var xs$8677;var patt$8667;var projector$8656;var subp$8657;var checker$8645;var subp$8646;var checker$8634;var condition$8627;var subp$8628;var kind$8622;var sym$8616;var $8589$8601;var $8590$8602;var $8591$8603;var $8592$8604;var t0$8599;var $8588$8594;var rval$8585;var it$0$8580;(it$0$8580=this);;(rval$8585=((($8588$8594=pattern$8575)),function(){if((((x$8609=$8588$8594)),((x$8609 instanceof Array)&&(x$8609[0]==="ignore")))){return it$0$8580.do(rhs$8576);}else{if((($8589$8601=($8588$8594 instanceof Array))&&((t0$8599=$8588$8594.length),(($8591$8603=(t0$8599===2))&&($8588$8594[0]==="assign"))))){(sym$8616=$8588$8594[1]);return it$0$8580.parts.push(fns$8577.assign(sym$8616,rhs$8576));}else{if(($8591$8603&&($8588$8594[0]==="special"))){(kind$8622=$8588$8594[1]);return it$0$8580.process(fns$8577.special(pattern$8575,rhs$8576),rhs$8576,fns$8577);}else{if(($8589$8601&&(($8591$8603=(t0$8599===3))&&($8588$8594[0]==="test")))){(condition$8627=$8588$8594[1]);(subp$8628=$8588$8594[2]);it$0$8580.process(subp$8628,rhs$8576,fns$8577);return it$0$8580.check(condition$8627,({"test":true}));}else{if(($8591$8603&&(($8592$8604=($8588$8594[0]==="check"))&&((checker$8634=$8588$8594[1]),(((x$8638=$8588$8594[2])),((x$8638 instanceof Array)&&(x$8638[0]==="ignore"))))))){return it$0$8580.check(["send",checker$8634,["data",rhs$8576]]);}else{if($8592$8604){(checker$8645=$8588$8594[1]);(subp$8646=$8588$8594[2]);(t$8650=it$0$8580.temp(rhs$8576));;it$0$8580.check(["send",checker$8645,["data",t$8650]]);return it$0$8580.process(subp$8646,t$8650,fns$8577);}else{if(($8591$8603&&($8588$8594[0]==="project"))){(projector$8656=$8588$8594[1]);(subp$8657=$8588$8594[2]);(t$8661=it$0$8580.temp(["send",projector$8656,["data",rhs$8576]]));;it$0$8580.check(["send",t$8661,["value",0]]);return it$0$8580.process(subp$8657,["send",t$8661,["value",1]],fns$8577);}else{if(($8589$8601&&((t0$8599===2)&&($8588$8594[0]==="neg")))){(patt$8667=$8588$8594[1]);return it$0$8580.check(["send",["symbol","not"],["data",["void"],(((pp$8671=PatternProcessor$7781())),pp$8671.process(patt$8667,rhs$8576,fns$8577),assemble_conditions$7782(pp$8671))]]);}else{if(($8589$8601&&(($8591$8603=(t0$8599>=1))&&($8588$8594[0]==="all")))){(xs$8677=Array.prototype.slice.call($8588$8594,1));(t$8681=it$0$8580.temp(rhs$8576));;(temp$8689=xs$8677);;($length$8694=temp$8689.length);;($index$8699=0);;$8682:for(;($index$8699<$length$8694);($index$8699++)){var x$8715;var m$8707;(m$8707=temp$8689[$index$8699]);;(x$8715=m$8707);it$0$8580.process(x$8715,t$8681,fns$8577);}return null;}else{if(($8591$8603&&($8588$8594[0]==="any"))){(xs$8719=Array.prototype.slice.call($8588$8594,1));(t$8723=it$0$8580.temp(rhs$8576,["symbol",gensym$7770("bridge")]));;return it$0$8580.check((((fn$8728=function(x$8733,rest$8734){return ["send",["symbol","or"],["data",x$8733,rest$8734]];})),((parts$8729=(((acc$8742=[])),(((temp$8747=xs$8719)),((($length$8752=temp$8747.length)),((($index$8757=0)),function(){$8739:for(;($index$8757<$length$8752);($index$8757++)){var pp$8776;var x$8773;var m$8765;(m$8765=temp$8747[$index$8757]);;(x$8773=m$8765);acc$8742.push((((pp$8776=PatternProcessor$7781())),pp$8776.process(x$8773,t$8723,fns$8577),assemble_conditions$7782(pp$8776)));}}()))),acc$8742))),util$7768.construct(parts$8729,fn$8728,["symbol","false"])));}else{if(($8591$8603&&($8588$8594[0]==="object_pattern"))){(subp$8783=Array.prototype.slice.call($8588$8594,1));(t$8787=it$0$8580.temp(rhs$8576));;(acc$8794=[]);;(temp$8799=subp$8783);;($length$8804=temp$8799.length);;($index$8809=0);;$8788:for(;($index$8809<$length$8804);($index$8809++)){var k$8829;var v$8830;var t0$8822;var t1$8823;var t2$8824;var t3$8825;var m$8817;(m$8817=temp$8799[$index$8809]);;(t0$8822=m$8817);if(((t0$8822 instanceof Array)&&((t1$8823=t0$8822.length),((t1$8823===2)&&((t2$8824=t0$8822[0]),((t2$8824 instanceof Array)&&((t3$8825=t2$8824.length),((t3$8825===2)&&(t2$8824[0]==="value"))))))))){(k$8829=t2$8824[1]);(v$8830=t0$8822[1]);acc$8794.push((it$0$8580.check(["send",["symbol","___hasprop"],["data",t$8787,["value",k$8829]]]),it$0$8580.process(v$8830,["send",t$8787,["value",k$8829]],fns$8577)));}else{$10605(m$8817,"/home/olivier/git/earl-grey/src/pattern.eg",7617,7749);;}}return acc$8794;}else{if(($8589$8601&&((t0$8599===5)&&($8588$8594[0]==="array_pattern")))){(fw$8841=$8588$8594[1]);(bw$8842=$8588$8594[2]);(dflt$8843=$8588$8594[3]);(rest$8844=$8588$8594[4]);(nfw$8848=fw$8841.length);;(nbw$8849=bw$8842.length);;(ndflt$8850=dflt$8843.length);;(extract_length$8851=true);;(check_length$8852=true);;(lo$8853=(nfw$8848+nbw$8849));;(hi$8854=(lo$8853+ndflt$8850));;(t$8855=it$0$8580.temp(rhs$8576));;(len$8856=it$0$8580.temp(["send",t$8855,["send",["symbol","."],["data",["void"],["symbol","length"]]]]));;it$0$8580.check(((($8890$8892=rest$8844)),function(){if($8890$8892){return ["send",["symbol",">="],["data",len$8856,["value",lo$8853]]];}else{$8890$8892;if((lo$8853===hi$8854)){return ["send",["symbol","==="],["data",len$8856,["value",lo$8853]]];}else{(otherwise$8908=$8890$8892);return ["send",["symbol","and"],["data",["send",["symbol",">="],["data",len$8856,["value",lo$8853]]],["send",["symbol","<="],["data",len$8856,["value",hi$8854]]]]];}}}()));(temp$8912=enumerate$7772(fw$8841));;($length$8917=temp$8912.length);;($index$8922=0);;$8857:for(;($index$8922<$length$8917);($index$8922++)){var i$8940;var m$8941;var t0$8935;var t1$8936;var m$8930;(m$8930=temp$8912[$index$8922]);;(t0$8935=m$8930);if(((t0$8935 instanceof Array)&&((t1$8936=t0$8935.length),(t1$8936===2)))){(i$8940=t0$8935[0]);(m$8941=t0$8935[1]);it$0$8580.process(m$8941,["send",t$8855,["value",i$8940]],fns$8577);}else{$10605(m$8930,"/home/olivier/git/earl-grey/src/pattern.eg",8481,8567);;}}(temp$8949=enumerate$7772(dflt$8843));;($length$8954=temp$8949.length);;($index$8959=0);;$8859:for(;($index$8959<$length$8954);($index$8959++)){var idx$8989;var i$8979;var patt$8980;var value$8981;var t0$8972;var t1$8973;var t2$8974;var t3$8975;var m$8967;(m$8967=temp$8949[$index$8959]);;(t0$8972=m$8967);if(((t0$8972 instanceof Array)&&((t1$8973=t0$8972.length),((t1$8973===2)&&((i$8979=t0$8972[0]),((t2$8974=t0$8972[1]),((t2$8974 instanceof Array)&&((t3$8975=t2$8974.length),(t3$8975===2))))))))){(patt$8980=t2$8974[0]);(value$8981=t2$8974[1]);(idx$8989=(i$8979+nfw$8848));;it$0$8580.process(patt$8980,["send",["symbol","if"],["data",["send",["symbol",">="],["data",["value",(idx$8989+nbw$8849)],len$8856]],value$8981,["send",t$8855,["value",idx$8989]]]],fns$8577);}else{$10605(m$8967,"/home/olivier/git/earl-grey/src/pattern.eg",8567,8736);;}}if((rest$8844!==(void 0))){(pos$8996=(nfw$8848+ndflt$8850));;(end$9001=function(){if((nbw$8849>0)){return [["value",(-nbw$8849)]];}else{return [];}}());;it$0$8580.process(rest$8844,["send",["send",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",t$8855,["value",pos$8996]].concat(end$9001)],fns$8577);}else{[];}(acc$9006=[]);;(temp$9011=enumerate$7772(bw$8842));;($length$9016=temp$9011.length);;($index$9021=0);;$8861:for(;($index$9021<$length$9016);($index$9021++)){var i$9039;var m$9040;var t0$9034;var t1$9035;var m$9029;(m$9029=temp$9011[$index$9021]);;(t0$9034=m$9029);if(((t0$9034 instanceof Array)&&((t1$9035=t0$9034.length),(t1$9035===2)))){(i$9039=t0$9034[0]);(m$9040=t0$9034[1]);acc$9006.push(it$0$8580.process(m$9040,["send",["symbol","___js_fetch"],["data",t$8855,["send",["symbol","-"],["data",len$8856,["value",(nbw$8849-i$9039)]]]]],fns$8577));}else{$10605(m$9029,"/home/olivier/git/earl-grey/src/pattern.eg",9187,9293);;}}return acc$9006;}else{$10605($8588$8594);}}}}}}}}}}}}}()));;return rval$8585;});$10618(PatternProcessor$7781,({}));PatternProcessor$7781;(assemble_conditions$7782=function(pp$9052){var $index$9134;var $length$9129;var temp$9124;var acc$9119;var decls$9113;var construct$9055;(construct$9055=function($9058$9060){var x$9103;var rest$9104;var x$9096;var x$9088;var rest$9089;var $9063$9079;var $9064$9080;var t0$9075;var t1$9076;var t2$9077;var $9062$9070;var ph$9065;(ph$9065=$9058$9060);;($9062$9070=ph$9065);;if((($9063$9079=($9062$9070 instanceof Array))&&((t0$9075=$9062$9070.length),(t0$9075===0)))){return ["value",true];}else{if(($9063$9079&&((t0$9075>=1)&&((t1$9076=$9062$9070[0]),((t1$9076 instanceof Array)&&((t2$9077=t1$9076.length),((t2$9077===2)&&(t1$9076[0]==="do")))))))){(x$9088=t1$9076[1]);(rest$9089=Array.prototype.slice.call($9062$9070,1));return ["multi",x$9088,construct$9055(rest$9089)];}else{if(($9063$9079&&((t0$9075===1)&&((t1$9076=$9062$9070[0]),((t1$9076 instanceof Array)&&((t2$9077=t1$9076.length),((t2$9077===2)&&(t1$9076[0]==="check")))))))){(x$9096=t1$9076[1]);return x$9096;}else{if(($9063$9079&&((t0$9075>=1)&&((t1$9076=$9062$9070[0]),((t1$9076 instanceof Array)&&((t2$9077=t1$9076.length),((t2$9077===2)&&(t1$9076[0]==="check")))))))){(x$9103=t1$9076[1]);(rest$9104=Array.prototype.slice.call($9062$9070,1));return ["send",["symbol","and"],["data",x$9103,construct$9055(rest$9104)]];}else{$10605($9062$9070);}}}}});;if(pp$9052.temps.length){(decls$9113=(((acc$9119=[])),(((temp$9124=pp$9052.temps)),((($length$9129=temp$9124.length)),((($index$9134=0)),function(){$9116:for(;($index$9134<$length$9129);($index$9134++)){var t$9150;var m$9142;(m$9142=temp$9124[$index$9134]);;(t$9150=m$9142);acc$9119.push(["declare",t$9150]);}}()))),acc$9119));;return ["multi"].concat(decls$9113).concat([construct$9055(pp$9052.parts)]);}else{return construct$9055(pp$9052.parts);}});;(assemble_pattern$7783=function(){var $index$9204;var $length$9199;var temp$9194;var $index$9253;var $length$9248;var temp$9243;var test$9346;var lead$9174;var trail$9175;var construct$9176;var parts$9168;var t$9169;var f$9170;var t0$9164;var $9157$9159;($9157$9159=arguments);;(t0$9164=$9157$9159.length);if(((t0$9164>=2)&&(t0$9164<=3))){(parts$9168=$9157$9159[0]);(t$9169=$9157$9159[1]);(f$9170=function(){if((2>=t0$9164)){return null;}else{return $9157$9159[2];}}());(lead$9174=[]);;(temp$9194=parts$9168.slice(0));;($length$9199=temp$9194.length);;($index$9204=0);;$9177:for(;($index$9204<$length$9199);($index$9204++)){var x$9233;var x$9226;var $9179$9220;var $9180$9221;var $9181$9222;var $9182$9223;var t0$9217;var t1$9218;var m$9212;(m$9212=temp$9194[$index$9204]);;(t0$9217=m$9212);if((($9180$9221=(t0$9217 instanceof Array))&&((t1$9218=t0$9217.length),(($9182$9223=(t1$9218===2))&&(t0$9217[0]==="do"))))){(x$9226=t0$9217[1]);lead$9174.push(x$9226);parts$9168.shift();}else{if(($9182$9223&&(t0$9217[0]==="check"))){(x$9233=t0$9217[1]);break $9177;}else{$10605(m$9212,"/home/olivier/git/earl-grey/src/pattern.eg",9799,9909);;}}}(trail$9175=[]);;(temp$9243=parts$9168.slice(0).reverse());;($length$9248=temp$9243.length);;($index$9253=0);;$9183:for(;($index$9253<$length$9248);($index$9253++)){var x$9282;var x$9275;var $9185$9269;var $9186$9270;var $9187$9271;var $9188$9272;var t0$9266;var t1$9267;var m$9261;(m$9261=temp$9243[$index$9253]);;(t0$9266=m$9261);if((($9186$9270=(t0$9266 instanceof Array))&&((t1$9267=t0$9266.length),(($9188$9272=(t1$9267===2))&&(t0$9266[0]==="do"))))){(x$9275=t0$9266[1]);trail$9175.unshift(x$9275);parts$9168.pop();}else{if(($9188$9272&&(t0$9266[0]==="check"))){(x$9282=t0$9266[1]);break $9183;}else{$10605(m$9261,"/home/olivier/git/earl-grey/src/pattern.eg",9923,10045);;}}}(construct$9176=function($9289$9291){var other$9342;var x$9334;var rest$9335;var x$9327;var x$9319;var rest$9320;var $9294$9310;var $9295$9311;var t0$9306;var t1$9307;var t2$9308;var $9293$9301;var ph$9296;(ph$9296=$9289$9291);;($9293$9301=ph$9296);;if((($9294$9310=($9293$9301 instanceof Array))&&((t0$9306=$9293$9301.length),(t0$9306===0)))){return ["value",true];}else{if(($9294$9310&&((t0$9306>=1)&&((t1$9307=$9293$9301[0]),((t1$9307 instanceof Array)&&((t2$9308=t1$9307.length),((t2$9308===2)&&(t1$9307[0]==="do")))))))){(x$9319=t1$9307[1]);(rest$9320=Array.prototype.slice.call($9293$9301,1));return ["multi",x$9319,construct$9176(rest$9320)];}else{if(($9294$9310&&((t0$9306===1)&&((t1$9307=$9293$9301[0]),((t1$9307 instanceof Array)&&((t2$9308=t1$9307.length),((t2$9308===2)&&(t1$9307[0]==="check")))))))){(x$9327=t1$9307[1]);return x$9327;}else{if(($9294$9310&&((t0$9306>=1)&&((t1$9307=$9293$9301[0]),((t1$9307 instanceof Array)&&((t2$9308=t1$9307.length),((t2$9308===2)&&(t1$9307[0]==="check")))))))){(x$9334=t1$9307[1]);(rest$9335=Array.prototype.slice.call($9293$9301,1));return ["send",["symbol","and"],["data",x$9334,construct$9176(rest$9335)]];}else{(other$9342=$9293$9301);throw $10498(["oops"]).create("?!?",other$9342);}}}}});;if(parts$9168.length){(test$9346=construct$9176(parts$9168));;return ["multi"].concat(lead$9174).concat([function(){if(f$9170){return ["send",["symbol","if"],["data",test$9346,["multi"].concat(trail$9175).concat([t$9169]),f$9170]];}else{return ["send",["symbol","if"],["data",test$9346,["multi"].concat(trail$9175).concat([t$9169])]];}}()]);}else{return ["multi"].concat(lead$9174).concat(trail$9175).concat([t$9169]);}}else{$10605($9157$9159);}});;(inject_below_uses$7784=function($9355$9357,fn$9358){var other$9382;var scope$9375;var x$9376;var t0$9371;var $9360$9366;var ph$9361;(ph$9361=$9355$9357);;($9360$9366=ph$9361);;if((($9360$9366 instanceof Array)&&((t0$9371=$9360$9366.length),((t0$9371===3)&&($9360$9366[0]==="use"))))){(scope$9375=$9360$9366[1]);(x$9376=$9360$9366[2]);return ["use",scope$9375,inject_below_uses$7784(x$9376,fn$9358)];}else{(other$9382=$9360$9366);return fn$9358(other$9382);}});;(parse_pattern$7785=function(scope$9388,pattern$9389,rhs$9390,opt$9391){var t0$9402;var $index$9441;var $length$9436;var temp$9431;var acc$9426;var parse$9394;var target$9395;var proc$9396;(parse$9394=PatternParser$7780(scope$9388,pattern$9389,opt$9391));;if(((!opt$9391.allow_arguments)&&parse$9394.arguments.length)){throw $10498(["syntax","pattern","arguments"]).create("Arguments cannot be declared in this pattern",({"args":parse$9394.arguments[0]}));}(t0$9402=$10740((opt$9391.wrap_target||identity$7777))(function(){if(parse$9394.arguments.length){return inject_below_uses$7784(rhs$9390,function(x$9405){return util$7768.construct(parse$9394.arguments.concat([x$9405]),function(args$9408,rest$9409){return ["send",["symbol","->"],["data",args$9408,rest$9409]];});});}else{return rhs$9390;}}()));if(t0$9402[0]){(target$9395=t0$9402[1]);;}else{$10605(function(){if(parse$9394.arguments.length){return inject_below_uses$7784(rhs$9390,function(x$9414){return util$7768.construct(parse$9394.arguments.concat([x$9414]),function(args$9417,rest$9418){return ["send",["symbol","->"],["data",args$9417,rest$9418]];});});}else{return rhs$9390;}}(),"/home/olivier/git/earl-grey/src/pattern.eg",11438,11871);}(proc$9396=PatternProcessor$7781());;proc$9396.process(parse$9394.pattern,target$9395,opt$9391);if(opt$9391.finalize){return ["splice"].concat(opt$9391.declare(parse$9394.vars)).concat([["multi"].concat((((acc$9426=[])),(((temp$9431=proc$9396.temps)),((($length$9436=temp$9431.length)),((($index$9441=0)),function(){$9423:for(;($index$9441<$length$9436);($index$9441++)){var t$9457;var m$9449;(m$9449=temp$9431[$index$9441]);;(t$9457=m$9449);acc$9426.push(["declare",t$9457]);}}()))),acc$9426)).concat([assemble_pattern$7783(proc$9396.parts,opt$9391.success(target$9395),opt$9391.failure(target$9395))])]);}else{return [parse$9394.vars,proc$9396.temps,proc$9396.parts];}});;(checkall$7786=["send","data","multi","assign","void","check","do"]);;(same_block$7787=function($9465$9467,ban1$9468,ban2$9469){var $index$9570;var $length$9565;var temp$9560;var other$9591;var type1$9543;var args1$9544;var type2$9545;var args2$9546;var m1$9534;var m2$9535;var v1$9525;var v2$9526;var s1$9516;var s2$9517;var v1$9504;var v2$9505;var $9472$9495;var $9473$9496;var $9474$9497;var $9475$9498;var $9476$9499;var $9477$9500;var $9478$9501;var t0$9489;var t1$9490;var t2$9491;var t3$9492;var t4$9493;var $9471$9484;var ph$9479;(ph$9479=$9465$9467);;($9471$9484=ph$9479);;if((($9472$9495=($9471$9484 instanceof Array))&&((t0$9489=$9471$9484.length),(($9474$9497=(t0$9489===2))&&((t1$9490=$9471$9484[0]),(($9476$9499=(t1$9490 instanceof Array))&&((t2$9491=t1$9490.length),(($9478$9501=(t2$9491===2))&&((t1$9490[0]==="variable")&&((v1$9504=t1$9490[1]),((t3$9492=$9471$9484[1]),((t3$9492 instanceof Array)&&((t4$9493=t3$9492.length),((t4$9493===2)&&(t3$9492[0]==="variable"))))))))))))))){(v2$9505=t3$9492[1]);return (v1$9504===v2$9505);}else{if(($9478$9501&&((t1$9490[0]==="symbol")&&((s1$9516=t1$9490[1]),((t3$9492=$9471$9484[1]),((t3$9492 instanceof Array)&&((t4$9493=t3$9492.length),((t4$9493===2)&&(t3$9492[0]==="symbol"))))))))){(s2$9517=t3$9492[1]);return (((!$7728(ban1$9468,s1$9516))&&(!$7728(ban2$9469,s2$9517)))&&(s1$9516===s2$9517));}else{if(($9478$9501&&((t1$9490[0]==="value")&&((v1$9525=t1$9490[1]),((t3$9492=$9471$9484[1]),((t3$9492 instanceof Array)&&((t4$9493=t3$9492.length),((t4$9493===2)&&(t3$9492[0]==="value"))))))))){(v2$9526=t3$9492[1]);return (v1$9525===v2$9526);}else{if(($9478$9501&&((t1$9490[0]==="macro")&&((m1$9534=t1$9490[1]),((t3$9492=$9471$9484[1]),((t3$9492 instanceof Array)&&((t4$9493=t3$9492.length),((t4$9493===2)&&(t3$9492[0]==="macro"))))))))){(m2$9535=t3$9492[1]);return (m1$9534===m2$9535);}else{if(($9476$9499&&((t2$9491>=1)&&((type1$9543=t1$9490[0]),((args1$9544=Array.prototype.slice.call(t1$9490,1)),((t3$9492=$9471$9484[1]),((t3$9492 instanceof Array)&&((t4$9493=t3$9492.length),((t4$9493>=1)&&((type2$9545=t3$9492[0]),((args2$9546=Array.prototype.slice.call(t3$9492,1)),(checkall$7786.indexOf(type1$9543)!==(-1))))))))))))){if(((type1$9543===type2$9545)&&(args1$9544.length===args2$9546.length))){(temp$9560=zip$7771(args1$9544,args2$9546));;($length$9565=temp$9560.length);;($index$9570=0);;$9556:for(;($index$9570<$length$9565);($index$9570++)){var pair$9586;var m$9578;(m$9578=temp$9560[$index$9570]);;(pair$9586=m$9578);if((!same_block$7787(pair$9586,ban1$9468,ban2$9469))){return false;}}return true;}else{return false;}}else{(other$9591=$9471$9484);return false;}}}}}});;(parse_clauses$7788=function(scope$9597,target$9598,stmts$9599,opt$9600){var $index$9630;var $length$9625;var temp$9620;var acc$9615;var $index$9806;var $length$9801;var temp$9796;var acc$9791;var $index$9853;var $length$9848;var temp$9843;var acc$9838;var decls$9832;var all_temps$9603;var the_parts$9604;var unique_temps$9605;(all_temps$9603=[]);;(the_parts$9604=(((acc$9615=[])),(((temp$9620=scope$9597.step_all(["clause"],stmts$9599))),((($length$9625=temp$9620.length)),((($index$9630=0)),function(){$9611:for(;($index$9630<$length$9625);($index$9630++)){var accum$9705;var accum$9716;var t0$9701;var t1$9702;var $index$9739;var $length$9734;var temp$9729;var bod$9766;var placeholder$9655;var special_fn$9656;var vars$9657;var temps$9658;var blocks$9659;var vars2$9660;var x$9775;var other$9782;var b$9772;var pattern$9649;var body$9650;var $9613$9646;var t0$9643;var t1$9644;var m$9638;(m$9638=temp$9620[$index$9630]);;(t0$9643=m$9638);if(((t0$9643 instanceof Array)&&((t1$9644=t0$9643.length),((t1$9644===3)&&(t0$9643[0]==="clause"))))){(pattern$9649=t0$9643[1]);(body$9650=t0$9643[2]);acc$9615.push((((placeholder$9655=(void 0))),((special_fn$9656=function($9668$9670,value$9671){var t0$9677;var t1$9678;var other$9697;var $9673$9684;var ph$9674;var expr$9675;(t0$9677=$9668$9670);if(((t0$9677 instanceof Array)&&((t1$9678=t0$9677.length),((t1$9678===2)&&(t0$9677[0]==="special"))))){(ph$9674=t0$9677[1]);(expr$9675=t0$9677);;}else{$10605($9668$9670);}($9673$9684=ph$9674);;if(($9673$9684==="match")){(placeholder$9655=__lt____lt____colon__$7767(["symbol",scope$9597.gensym("ph")],expr$9675));return ["assign",placeholder$9655];}else{(other$9697=$9673$9684);throw $10498(["syntax","pattern","special"]).create("Special token cannot be used here",({"special":expr$9675}));}})),((t0$9701=parse_pattern$7785(scope$9597,pattern$9649,target$9598,$10668(opt$9600,$10618(({"allow_arguments":false,"allow_nested":true,"special":special_fn$9656}),$10618(((accum$9705=({})),((accum$9705["assign"]=function(v$9709,value$9710){return ["do",__lt____lt____colon__$7767(["assign",v$9709,value$9710],v$9709)];}),accum$9705)),({"finalize":false})))))),function(){if(((t0$9701 instanceof Array)&&((t1$9702=t0$9701.length),(t1$9702===3)))){(vars$9657=t0$9701[0]);(temps$9658=t0$9701[1]);(blocks$9659=t0$9701[2]);}else{return $10605(parse_pattern$7785(scope$9597,pattern$9649,target$9598,$10668(opt$9600,$10618(({"allow_arguments":false,"allow_nested":true,"special":special_fn$9656}),$10618(((accum$9716=({})),((accum$9716["assign"]=function(v$9720,value$9721){return ["do",__lt____lt____colon__$7767(["assign",v$9720,value$9721],v$9720)];}),accum$9716)),({"finalize":false}))))),"/home/olivier/git/earl-grey/src/pattern.eg",13491,13838);}}()),(all_temps$9603=all_temps$9603.concat(temps$9658)),function(){if(placeholder$9655){return vars$9657.push(placeholder$9655);}}(),((vars2$9660=({}))),(((temp$9729=vars$9657)),((($length$9734=temp$9729.length)),((($index$9739=0)),function(){$9661:for(;($index$9739<$length$9734);($index$9739++)){var other$9763;var xxx$9757;var t0$9752;var t1$9753;var m$9747;(m$9747=temp$9729[$index$9739]);;(t0$9752=m$9747);if(((t0$9752 instanceof Array)&&((t1$9753=t0$9752.length),((t1$9753===2)&&(t0$9752[0]==="symbol"))))){(xxx$9757=t0$9752[1]);(vars2$9660[xxx$9757]=true);}else{(other$9763=m$9747);throw $10498(["syntax","unexpected"]).create();}}}()))),(((bod$9766=function(){if(placeholder$9655){return parse_clauses$7788(scope$9597,placeholder$9655,$10740(["multi"])(body$9650)[1],opt$9600);}else{if(opt$9600.wrap){return opt$9600.wrap(body$9650);}else{return body$9650;}}}())),["clause",vars$9657,vars2$9660,blocks$9659,bod$9766])));}else{if((((x$9775=t0$9643)),((x$9775 instanceof Array)&&(x$9775[0]==="block")))){(b$9772=t0$9643);acc$9615.push(b$9772);}else{(other$9782=m$9638);acc$9615.push(function(){throw $10498(["syntax","clause"]).create("Illegal clause",({"clause":other$9782}));}());}}}}()))),acc$9615));;if(opt$9600.fallback){the_parts$9604.push(["block",opt$9600.fallback(target$9598)]);}(unique_temps$9605=iterkeys$7773(util$7768.set((((acc$9791=[])),(((temp$9796=all_temps$9603)),((($length$9801=temp$9796.length)),((($index$9806=0)),function(){$9788:for(;($index$9806<$length$9801);($index$9806++)){var t$9824;var t0$9819;var t1$9820;var m$9814;(m$9814=temp$9796[$index$9806]);;(t0$9819=m$9814);if(((t0$9819 instanceof Array)&&((t1$9820=t0$9819.length),((t1$9820===2)&&(t0$9819[0]==="symbol"))))){(t$9824=t0$9819[1]);acc$9791.push(t$9824);}else{$10605(m$9814,"/home/olivier/git/earl-grey/src/pattern.eg",14650,14680);;}}}()))),acc$9791))));;(decls$9832=(((acc$9838=[])),(((temp$9843=unique_temps$9605)),((($length$9848=temp$9843.length)),((($index$9853=0)),function(){$9835:for(;($index$9853<$length$9848);($index$9853++)){var t$9869;var m$9861;(m$9861=temp$9843[$index$9853]);;(t$9869=m$9861);acc$9838.push(["declare",["symbol",t$9869]]);}}()))),acc$9838));;return ["multi"].concat(decls$9832).concat([weave_clauses$7790(the_parts$9604)]);});;(opt_clauses$7789=function(clauses$9876){var $index$9905;var $length$9900;var temp$9895;var acc$9890;var $index$10040;var $length$10035;var temp$10030;var acc$10025;var $index$10085;var $length$10080;var temp$10075;var acc$10070;var $index$10129;var $length$10124;var temp$10119;var acc$10114;var shares$9879;var max$9880;var temps$9881;var shared_last$9882;var idx_last$9883;var new_clauses$9884;(shares$9879=(((acc$9890=[])),(((temp$9895=enumerate$7772(clauses$9876.slice(1)))),((($length$9900=temp$9895.length)),((($index$9905=0)),function(){$9887:for(;($index$9905<$length$9900);($index$9905++)){var t0$9944;var t1$9945;var $index$9968;var $length$9963;var temp$9958;var varsd0$9937;var blocks0$9938;var share$9939;var idx$9940;var i$9925;var vars$9926;var varsd$9927;var blocks$9928;var body$9929;var t0$9918;var t1$9919;var t2$9920;var t3$9921;var m$9913;(m$9913=temp$9895[$index$9905]);;(t0$9918=m$9913);if(((t0$9918 instanceof Array)&&((t1$9919=t0$9918.length),((t1$9919===2)&&((i$9925=t0$9918[0]),((t2$9920=t0$9918[1]),((t2$9920 instanceof Array)&&((t3$9921=t2$9920.length),((t3$9921===5)&&(t2$9920[0]==="clause")))))))))){(vars$9926=t2$9920[1]);(varsd$9927=t2$9920[2]);(blocks$9928=t2$9920[3]);(body$9929=t2$9920[4]);acc$9890.push((((t0$9944=$7728(clauses$9876,i$9925)),function(){if(((t0$9944 instanceof Array)&&((t1$9945=t0$9944.length),((t1$9945===5)&&(t0$9944[0]==="clause"))))){t0$9944[1];(varsd0$9937=t0$9944[2]);(blocks0$9938=t0$9944[3]);t0$9944[4];}else{return $10605($7728(clauses$9876,i$9925),"/home/olivier/git/earl-grey/src/pattern.eg",14953,14963);}}()),((share$9939=0)),((idx$9940=0)),(((temp$9958=blocks$9928)),((($length$9963=temp$9958.length)),((($index$9968=0)),function(){$9941:for(;($index$9968<$length$9963);($index$9968++)){var x$9999;var x$10008;var other$10015;var $9987$9989;var b$9984;var m$9976;(m$9976=temp$9958[$index$9968]);;(b$9984=m$9976);if(same_block$7787([$7728(blocks0$9938,share$9939),b$9984],varsd0$9937,varsd$9927)){(share$9939++);($9987$9989=b$9984);;if((((x$9999=$9987$9989)),((x$9999 instanceof Array)&&(x$9999[0]==="do")))){null;}else{if((((x$10008=$9987$9989)),((x$10008 instanceof Array)&&(x$10008[0]==="check")))){(idx$9940=share$9939);}else{(other$10015=$9987$9989);__lt____gt__$7765(null,other$10015);}}}else{break $9941;}}}()))),[share$9939,idx$9940]));}else{$10605(m$9913,"/home/olivier/git/earl-grey/src/pattern.eg",14829,15350);;}}}()))),acc$9890));;(max$9880=$7728(Math.max,(((acc$10025=[])),(((temp$10030=shares$9879)),((($length$10035=temp$10030.length)),((($index$10040=0)),function(){$10022:for(;($index$10040<$length$10035);($index$10040++)){var x$10058;var t0$10053;var t1$10054;var m$10048;(m$10048=temp$10030[$index$10040]);;(t0$10053=m$10048);if(((t0$10053 instanceof Array)&&((t1$10054=t0$10053.length),(t1$10054===2)))){(x$10058=t0$10053[0]);t0$10053[1];acc$10025.push(x$10058);}else{$10605(m$10048,"/home/olivier/git/earl-grey/src/pattern.eg",15364,15389);;}}}()))),acc$10025)));;shares$9879.push([0,0]);(temps$9881=(((acc$10070=[])),(((temp$10075=$10772(1,max$9880))),((($length$10080=temp$10075.length)),((($index$10085=0)),function(){$10067:for(;($index$10085<$length$10080);($index$10085++)){var m$10093;(m$10093=temp$10075[$index$10085]);;m$10093;acc$10070.push(["symbol",gensym$7770()]);}}()))),acc$10070));;(shared_last$9882=0);;(idx_last$9883=0);;(new_clauses$9884=(((acc$10114=[])),(((temp$10119=enumerate$7772(clauses$9876))),((($length$10124=temp$10119.length)),((($index$10129=0)),function(){$10111:for(;($index$10129<$length$10124);($index$10129++)){var t0$10167;var t1$10168;var $index$10203;var $length$10198;var temp$10193;var acc$10188;var rest$10252;var newblocks$10248;var share$10161;var idx$10162;var shared$10163;var n_to_share$10164;var to_share$10165;var other$10259;var i$10149;var vars$10150;var varsd$10151;var blocks$10152;var body$10153;var t0$10142;var t1$10143;var t2$10144;var t3$10145;var m$10137;(m$10137=temp$10119[$index$10129]);;(t0$10142=m$10137);if(((t0$10142 instanceof Array)&&((t1$10143=t0$10142.length),((t1$10143===2)&&((i$10149=t0$10142[0]),((t2$10144=t0$10142[1]),((t2$10144 instanceof Array)&&((t3$10145=t2$10144.length),((t3$10145===5)&&(t2$10144[0]==="clause")))))))))){(vars$10150=t2$10144[1]);(varsd$10151=t2$10144[2]);(blocks$10152=t2$10144[3]);(body$10153=t2$10144[4]);acc$10114.push((((t0$10167=$7728(shares$9879,i$10149)),function(){if(((t0$10167 instanceof Array)&&((t1$10168=t0$10167.length),(t1$10168===2)))){(share$10161=t0$10167[0]);(idx$10162=t0$10167[1]);}else{return $10605($7728(shares$9879,i$10149),"/home/olivier/git/earl-grey/src/pattern.eg",15614,15623);}}()),((shared$10163=function(){if(idx_last$9883){return [["check",$7728(temps$9881,(idx_last$9883-1))]];}else{return [];}}())),((n_to_share$10164=Math.max(shared_last$9882,share$10161))),((to_share$10165=(((acc$10188=[])),(((temp$10193=enumerate$7772(blocks$10152.slice(shared_last$9882,n_to_share$10164)))),((($length$10198=temp$10193.length)),((($index$10203=0)),function(){$10181:for(;($index$10203<$length$10198);($index$10203++)){var j$10237;var x$10238;var j$10227;var x$10228;var $10183$10221;var $10184$10222;var $10185$10223;var $10186$10224;var t0$10216;var t1$10217;var t2$10218;var t3$10219;var m$10211;(m$10211=temp$10193[$index$10203]);;(t0$10216=m$10211);if((($10184$10222=(t0$10216 instanceof Array))&&((t1$10217=t0$10216.length),(($10186$10224=(t1$10217===2))&&((j$10227=t0$10216[0]),((t2$10218=t0$10216[1]),((t2$10218 instanceof Array)&&((t3$10219=t2$10218.length),((t3$10219===2)&&(t2$10218[0]==="check")))))))))){(x$10228=t2$10218[1]);acc$10188.push(["check",["assign",$7728(temps$9881,(shared_last$9882+j$10227)),x$10228]]);}else{if(($10186$10224&&((j$10237=t0$10216[0]),((t2$10218=t0$10216[1]),((t2$10218 instanceof Array)&&((t3$10219=t2$10218.length),((t3$10219===2)&&(t2$10218[0]==="do")))))))){(x$10238=t2$10218[1]);acc$10188.push(["do",x$10238]);}else{$10605(m$10211,"/home/olivier/git/earl-grey/src/pattern.eg",15762,15933);;}}}}()))),acc$10188))),(shared_last$9882=share$10161),(idx_last$9883=idx$10162),(((newblocks$10248=(((rest$10252=blocks$10152.slice(n_to_share$10164))),shared$10163.concat(to_share$10165).concat(rest$10252)))),["clause",vars$10150,varsd$10151,newblocks$10248,body$10153])));}else{(other$10259=m$10137);acc$10114.push(function(){throw $10498(["oops"]).create("what",({"value":other$10259}));}());}}}()))),acc$10114));;return [temps$9881,new_clauses$9884];});;(weave_clauses$7790=function(parts$10266){var $index$10312;var $length$10307;var temp$10302;var $index$10478;var $length$10473;var temp$10468;var acc$10463;var groups$10269;var reassemble$10270;var new_temps$10271;var helper$10272;(groups$10269=classify_contiguous$7776(parts$10266,function($10281$10283){var t0$10287;var t1$10288;var cls$10285;(t0$10287=$10281$10283);if(((t0$10287 instanceof Array)&&((t1$10288=t0$10287.length),(t1$10288>=1)))){(cls$10285=t0$10287[0]);Array.prototype.slice.call(t0$10287,1);;}else{$10605($10281$10283);}return cls$10285;}));;(reassemble$10270=[]);;(new_temps$10271=[]);;(temp$10302=groups$10269);;($length$10307=temp$10302.length);;($index$10312=0);;$10273:for(;($index$10312<$length$10307);($index$10312++)){var t0$10342;var t1$10343;var ts$10339;var new_clauses$10340;var elems$10350;var elems$10334;var $10275$10328;var $10276$10329;var $10277$10330;var $10278$10331;var t0$10325;var t1$10326;var m$10320;(m$10320=temp$10302[$index$10312]);;(t0$10325=m$10320);if((($10276$10329=(t0$10325 instanceof Array))&&((t1$10326=t0$10325.length),(($10278$10331=(t1$10326>=1))&&(t0$10325[0]==="clause"))))){(elems$10334=Array.prototype.slice.call(t0$10325,1));(t0$10342=opt_clauses$7789(elems$10334));if(((t0$10342 instanceof Array)&&((t1$10343=t0$10342.length),(t1$10343===2)))){(ts$10339=t0$10342[0]);(new_clauses$10340=t0$10342[1]);;}else{$10605(opt_clauses$7789(elems$10334),"/home/olivier/git/earl-grey/src/pattern.eg",16428,16446);}(new_temps$10271=new_temps$10271.concat(ts$10339));(reassemble$10270=reassemble$10270.concat(new_clauses$10340));}else{if(($10278$10331&&(t0$10325[0]==="block"))){(elems$10350=Array.prototype.slice.call(t0$10325,1));(reassemble$10270=reassemble$10270.concat(elems$10350));}else{$10605(m$10320,"/home/olivier/git/earl-grey/src/pattern.eg",16362,16567);;}}}(helper$10272=function($10357$10359){var $index$10438;var $length$10433;var temp$10428;var acc$10423;var decls$10417;var vars$10409;var varsd$10410;var blocks$10411;var body$10412;var rest$10413;var body$10398;var rest$10399;var $10362$10385;var $10363$10386;var $10364$10387;var $10365$10388;var $10366$10389;var $10367$10390;var t0$10378;var t1$10379;var t2$10380;var t3$10381;var t4$10382;var t5$10383;var $10361$10373;var ph$10368;(ph$10368=$10357$10359);;($10361$10373=ph$10368);;if((($10362$10385=($10361$10373 instanceof Array))&&((t0$10378=$10361$10373.length),(t0$10378===0)))){return ["multi"];}else{if(($10362$10385&&(($10364$10387=(t0$10378>=1))&&((t1$10379=$10361$10373[0]),(($10366$10389=(t1$10379 instanceof Array))&&((t2$10380=t1$10379.length),((t2$10380===2)&&((t1$10379[0]==="block")&&((t3$10381=$10740(["multi"])(t1$10379[1])),(t3$10381[0]&&((t4$10382=t3$10381[1]),((t5$10383=t4$10382.length),(t5$10383>=0))))))))))))){(body$10398=Array.prototype.slice.call(t4$10382,0));(rest$10399=Array.prototype.slice.call($10361$10373,1));return ["multi"].concat(body$10398).concat([helper$10272(rest$10399)]);}else{if(($10366$10389&&((t2$10380===5)&&(t1$10379[0]==="clause")))){(vars$10409=t1$10379[1]);(varsd$10410=t1$10379[2]);(blocks$10411=t1$10379[3]);(body$10412=t1$10379[4]);(rest$10413=Array.prototype.slice.call($10361$10373,1));(decls$10417=(((acc$10423=[])),(((temp$10428=vars$10409)),((($length$10433=temp$10428.length)),((($index$10438=0)),function(){$10420:for(;($index$10438<$length$10433);($index$10438++)){var v$10454;var m$10446;(m$10446=temp$10428[$index$10438]);;(v$10454=m$10446);acc$10423.push(["declare",v$10454]);}}()))),acc$10423));;return ["tagscope","back",["multi"].concat(decls$10417).concat([assemble_pattern$7783(blocks$10411,body$10412,["use","back",helper$10272(rest$10413)])])];}else{$10605($10361$10373);}}}});;return ["multi"].concat((((acc$10463=[])),(((temp$10468=new_temps$10271)),((($length$10473=temp$10468.length)),((($index$10478=0)),function(){$10460:for(;($index$10478<$length$10473);($index$10478++)){var t$10494;var m$10486;(m$10486=temp$10468[$index$10478]);;(t$10494=m$10486);acc$10463.push(["declare",t$10494]);}}()))),acc$10463)).concat([helper$10272(reassemble$10270)]);});;(exports["PatternParser"]=PatternParser$7780);(exports["PatternProcessor"]=PatternProcessor$7781);(exports["parse_clauses"]=parse_clauses$7788);(exports["parse_pattern"]=parse_pattern$7785);
