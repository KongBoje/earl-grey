var $16865=(function(type$16868){var f$16872;(f$16872=type$16868["::check"]);if((f$16872===(void 0))){return (function(value$16878){return (value$16878 instanceof type$16868);});}else{return (function(value$16882){return f$16872.call(type$16868,value$16882);});}});
var $16884=(function(dest$16887,values$16888){var k$16893;(k$16893=null);$16891:for(k$16893 in values$16888){if(values$16888.hasOwnProperty(k$16893)){(dest$16887[k$16893]=values$16888[k$16893]);}}return dest$16887;});
var $16901=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $16902=(function($16904$16907){var ph$16913;(ph$16913=$16904$16907);var $16909$16919;($16909$16919=ph$16913);var bridge$16911$16924;var x$16928;(bridge$16911$16924=$16909$16919);if((((typeof(bridge$16911$16924)==="string")&&((x$16928=bridge$16911$16924),true))||((typeof(bridge$16911$16924)==="number")&&((x$16928=bridge$16911$16924),true)))){return ["value",x$16928];}else{var other$16939;(other$16939=$16909$16919);return other$16939["::serialize_ast"]();}});
var $16941=(function(obj$16944){var results$16949;(results$16949=[]);var k$16954;(k$16954=null);$16948:for(k$16954 in obj$16944){if(Object.prototype.hasOwnProperty.call(obj$16944,k$16954)){results$16949.push([k$16954,$16901(obj$16944,k$16954)]);}}return results$16949;});
var $17210=(function(arr$17213){var results$17219;var l$17220;(results$17219=[]);(l$17220=arr$17213.length);var i$17229;(i$17229=0);$17218:for(;(i$17229<l$17220);(i$17229++)){results$17219.push([i$17229,$16901(arr$17213,i$17229)]);}return results$17219;});
var $16977=(function(){var $16978$16984;($16978$16984=(function(tags$16989){var it$0$16992;(it$0$16992=(function(){if((!$16865($16978$16984)(this))){return Object.create($16978$16984.prototype);}else{return this;}})());(it$0$16992["tags"]=tags$16989);return it$0$16992;}));($16978$16984.prototype["create"]=(function(){var it$0$17012;var self$17013;(it$0$17012=this);(self$17013=this);var $17010$17022;($17010$17022=arguments);var t0$17027;var message$17031;var args$17032;(t0$17027=$17010$17022.length);if((t0$17027>=0)){(message$17031=(function(){if((0>=t0$17027)){return "";}else{return $17010$17022[0];}})());(args$17032=Array.prototype.slice.call($17010$17022,1));var e$17045;(e$17045=Error(message$17031));(e$17045["::tags"]=it$0$17012.tags);(e$17045["args"]=args$17032);var temp$17061;(temp$17061=$17210(args$17032));var $length$17067;($length$17067=temp$17061.length);var $index$17073;($index$17073=0);$17046:for(;($index$17073<$length$17067);($index$17073++)){var m$17082;(m$17082=temp$17061[$index$17073]);var t0$17087;var t1$17088;var i$17092;var arg$17093;(t0$17087=m$17082);if(((t0$17087 instanceof Array)&&(((t1$17088=t0$17087.length)),(t1$17088===2)))){(i$17092=t0$17087[0]);(arg$17093=t0$17087[1]);(e$17045[i$17092]=arg$17093);}else{$16958(m$17082);}}(e$17045["length"]=args$17032.length);(e$17045["name"]=["E"].concat(it$0$17012.tags).join("."));return e$17045;}else{$16958($17010$17022);}}));($16978$16984.prototype["::check"]=(function(e$17123){var it$0$17127;var self$17128;(it$0$17127=this);(self$17128=this);var tags$17138;if(((!e$17123)||(!$16865(Error)(e$17123)))){return false;}(tags$17138=(e$17123["::tags"]||[]));var temp$17149;(temp$17149=it$0$17127.tags);var $length$17155;($length$17155=temp$17149.length);var $index$17161;($index$17161=0);$17139:for(;($index$17161<$length$17155);($index$17161++)){var m$17170;(m$17170=temp$17149[$index$17161]);var tag$17178;(tag$17178=m$17170);if((tags$17138.indexOf(tag$17178)===-1)){return false;}else{false;}}return true;}));($16978$16984.prototype["::deconstruct"]=(function(e$17187){var it$0$17191;var self$17192;(it$0$17191=this);(self$17192=this);return e$17187.args;}));$16884($16978$16984,$16884((function(){var accum$17203;(accum$17203=({}));(accum$17203["::name"]="$16978");return accum$17203;})(),(function(){var accum$17207;(accum$17207=({}));(accum$17207["::egclass"]=true);return accum$17207;})()));return $16978$16984;})();
var $16958=(function(value$16961,url$16962,start$16963,end$16964){var err$16968;(err$16968=$16977(["match"]).create("Could not find a match for value",({"value":value$16961})));if(url$16962){(err$16968["location"]=["location",url$16962,start$16963,end$16964]);}throw err$16968;});
var send$16510;var __array_methods$16511;var __re_methods$16512;(send$16510=(function(obj$16525,$16522$16526){var ph$16532;var msg$16533;var t0$16535;(t0$16535=$16522$16526);(msg$16533=t0$16535);(ph$16532=t0$16535);var $16528$16544;($16528$16544=ph$16532);var bridge$16530$16549;(bridge$16530$16549=$16528$16544);if(((typeof(bridge$16530$16549)==="string")||(typeof(bridge$16530$16549)==="number"))){return obj$16525[msg$16533];}else{var other$16561;(other$16561=$16528$16544);return obj$16525["::send"](msg$16533);}}));(Array[":::project"]=(function($16567$16570){var ph$16575;var value$16576;var t0$16578;(t0$16578=$16567$16570);(value$16576=t0$16578);(ph$16575=t0$16578);var $16572$16587;($16572$16587=ph$16575);if($16865(Array)($16572$16587)){return [true,value$16576];}else{$16572$16587;return [true,[value$16576]];}}));(__array_methods$16511=$16884((function(){var accum$16608;(accum$16608=({}));(accum$16608["::check"]=(function(value$16613){if((value$16613 instanceof Array)){var i$16619;(i$16619=0);$16616:for(;(i$16619<this.length);(i$16619++)){if(($16901(this,i$16619)!==$16901(value$16613,i$16619))){return false;}}return true;}else{return false;}}));return accum$16608;})(),$16884((function(){var accum$16628;(accum$16628=({}));(accum$16628["::clone"]=(function(){return $16884(this.slice(0),this);}));return accum$16628;})(),$16884((function(){var accum$16635;(accum$16635=({}));(accum$16635[":::project"]=(function(value$16640){if((value$16640 instanceof Array)){var i$16646;(i$16646=0);$16643:for(;(i$16646<this.length);(i$16646++)){if(($16901(this,i$16646)!==$16901(value$16640,i$16646))){return [true,this.concat([value$16640])];}}return [true,value$16640];}else{return [true,this.concat([value$16640])];}}));return accum$16635;})(),(function(){var accum$16655;(accum$16655=({}));(accum$16655["::serialize_ast"]=(function(){return ["array"].concat(this.map($16902));}));return accum$16655;})()))));var temp$16665;(temp$16665=$16941(__array_methods$16511));var $length$16671;($length$16671=temp$16665.length);var $index$16677;($index$16677=0);$16513:for(;($index$16677<$length$16671);($index$16677++)){var m$16686;(m$16686=temp$16665[$index$16677]);var t0$16691;var t1$16692;var k$16696;var v$16697;(t0$16691=m$16686);if(((t0$16691 instanceof Array)&&(((t1$16692=t0$16691.length)),(t1$16692===2)))){(k$16696=t0$16691[0]);(v$16697=t0$16691[1]);if((!$16901(Array.prototype,k$16696))){Object.defineProperty(Array.prototype,k$16696,({"enumerable":false,"value":v$16697}));}}else{$16958(m$16686);}}(__re_methods$16512=$16884((function(){var accum$16717;(accum$16717=({}));(accum$16717["::check"]=(function($16721$16724){var ph$16729;(ph$16729=$16721$16724);var $16726$16735;($16726$16735=ph$16729);var value$16743;if((typeof($16726$16735)==="string")){(value$16743=$16726$16735);if(value$16743.match(this)){return true;}else{return false;}}else{var other$16748;(other$16748=$16726$16735);return false;}}));return accum$16717;})(),(function(){var accum$16751;(accum$16751=({}));(accum$16751[":::project"]=(function($16755$16758){var ph$16763;(ph$16763=$16755$16758);var $16760$16769;($16760$16769=ph$16763);var value$16777;if((typeof($16760$16769)==="string")){(value$16777=$16760$16769);var $16780$16785;($16780$16785=value$16777.match(this));var m$16793;if(($16780$16785===null)){(m$16793=$16780$16785);return [false,null];}else{var m$16798;(m$16798=$16780$16785);return [true,m$16798];}}else{var other$16802;(other$16802=$16760$16769);return [false,null];}}));return accum$16751;})()));var temp$16808;(temp$16808=$16941(__re_methods$16512));var $length$16814;($length$16814=temp$16808.length);var $index$16820;($index$16820=0);$16516:for(;($index$16820<$length$16814);($index$16820++)){var m$16829;(m$16829=temp$16808[$index$16820]);var t0$16834;var t1$16835;var k$16839;var v$16840;(t0$16834=m$16829);if(((t0$16834 instanceof Array)&&(((t1$16835=t0$16834.length)),(t1$16835===2)))){(k$16839=t0$16834[0]);(v$16840=t0$16834[1]);if((!$16901(RegExp.prototype,k$16839))){Object.defineProperty(RegExp.prototype,k$16839,({"enumerable":false,"value":v$16840}));}}else{$16958(m$16829);}}if((!Function.prototype["::send"])){Object.defineProperty(Function.prototype,"::send",$16884(({"enumerable":false}),(function(){var accum$16858;(accum$16858=({}));(accum$16858["value"]=(function(args$16863){return this.apply(this,args$16863);}));return accum$16858;})()));}
var $21082=(function($21084$21087){var ph$21095;(ph$21095=$21084$21087);var $21089$21101;($21089$21101=ph$21095);var t0$21106;var $21093$21108;var $21094$21109;if((($21093$21108=($21089$21101 instanceof Array))&&(((t0$21106=$21089$21101.length)),(t0$21106===0)))){return [];}else{var x$21121;if(($21093$21108&&(t0$21106===1))){(x$21121=$21089$21101[0]);return [];}else{var x$21126;var y$21127;var rest$21128;if(($21093$21108&&(t0$21106>=2))){(x$21126=$21089$21101[0]);(y$21127=$21089$21101[1]);(rest$21128=Array.prototype.slice.call($21089$21101,2));return [[x$21126,y$21127]].concat($21082([y$21127].concat(rest$21128)));}else{$16958($21089$21101);}}}});
var $21217=(function($21219$21222,key$21223){var ph$21231;(ph$21231=$21219$21222);var $21225$21237;($21225$21237=ph$21231);var bridge$21227$21242;(bridge$21227$21242=$21225$21237);if(((bridge$21227$21242===null)||(bridge$21227$21242===(void 0)))){return false;}else{var x$21254;if((typeof($21225$21237)==="string")){(x$21254=$21225$21237);return (key$21223 in String.prototype);}else{var x$21259;if((typeof($21225$21237)==="number")){(x$21259=$21225$21237);return (key$21223 in Number.prototype);}else{var x$21264;(x$21264=$21225$21237);return (key$21223 in x$21264);}}}});
var $21133=(function($21135$21138){var ph$21148;var x$21149;var t0$21151;(t0$21151=$21135$21138);(x$21149=t0$21151);(ph$21148=t0$21151);var $21140$21160;($21140$21160=ph$21148);var bridge$21142$21165;(bridge$21142$21165=$21140$21160);if(((function(){var bridge$21143$21175;(bridge$21143$21175=bridge$21142$21165);return ((function(){var bridge$21144$21182;(bridge$21144$21182=bridge$21143$21175);return ((bridge$21144$21182===(void 0))||(bridge$21144$21182===null));})()||(typeof(bridge$21143$21175)==="string"));})()||(typeof(bridge$21142$21165)==="number"))){return x$21149;}else{if($21217($21140$21160,"::clone")){$21140$21160["::clone"];return x$21149["::clone"]();}else{$21140$21160;if((Object.getPrototypeOf(x$21149)===Object.prototype)){var dest$21200;(dest$21200=({}));var k$21205;(k$21205=null);$21199:for(k$21205 in x$21149){if(Object.prototype.hasOwnProperty.call(x$21149,k$21205)){(dest$21200[k$21205]=x$21149[k$21205]);}}return dest$21200;}else{var other$21215;(other$21215=$21140$21160);throw $16977(["clone"]).create("Object cannot be cloned",({"obj":x$21149}));}}}});
var $21266=(function(a$21269,b$21270){var dest$21275;(dest$21275=$21133(a$21269));var k$21280;(k$21280=null);$21274:for(k$21280 in b$21270){if(Object.prototype.hasOwnProperty.call(b$21270,k$21280)){(dest$21275[k$21280]=b$21270[k$21280]);}}return dest$21275;});
var $21288=Object.keys;
var $21289=(function(type$21292){return (function(value$21296){var f$21300;(f$21300=type$21292[":::project"]);if((f$21300===(void 0))){(f$21300=type$21292["::project"]);if((f$21300===(void 0))){return [true,type$21292(value$21296)];}else{var rval$21313;(rval$21313=false);try{(rval$21313=[true,f$21300(value$21296)]);}catch(excv$21324){var e$21330;(e$21330=excv$21324);(rval$21313=[false,null]);}return rval$21313;}}else{return f$21300.call(type$21292,value$21296);}});});
var $21336=(function(xs$21339,ys$21340){var acc$21347;(acc$21347=[]);var temp$21353;(temp$21353=$17210(xs$21339));var $length$21359;($length$21359=temp$21353.length);var $index$21365;($index$21365=0);$21342:for(;($index$21365<$length$21359);($index$21365++)){var m$21374;(m$21374=temp$21353[$index$21365]);var t0$21379;var t1$21380;var i$21384;var x$21385;(t0$21379=m$21374);if(((t0$21379 instanceof Array)&&(((t1$21380=t0$21379.length)),(t1$21380===2)))){(i$21384=t0$21379[0]);(x$21385=t0$21379[1]);acc$21347.push([x$21385,$16901(ys$21340,i$21384)]);}else{$16958(m$21374);}}return acc$21347;});
var $21400=(function(from$21403,to$21404){var rval$21409;(rval$21409=[]);var i$21415;(i$21415=from$21403);$21408:for(;(i$21415<=to$21404);(i$21415++)){rval$21409.push(i$21415);}return rval$21409;});var accum$18230;var accum$18234;var accum$19019;var accum$19023;var $17238$17273;var __lt____gt__$17274;var $17239$17275;var __lt____lt____colon__$17276;var util$17277;var GenSym$17278;var gensym$17279;var classify$17280;var classify_contiguous$17281;var identity$17282;var Body$17283;var $17241$17284;var checker_db$17285;var PatternParser$17286;var PatternProcessor$17287;var assemble_conditions$17288;var assemble_pattern$17289;var inject_below_uses$17290;var parse_pattern$17291;var checkall$17292;var same_block$17293;var parse_clauses$17294;var opt_clauses$17295;var weave_clauses$17296;($17238$17273=require("./pp"));(__lt____gt__$17274=$17238$17273["<>"]);($17239$17275=require("./location"));(__lt____lt____colon__$17276=$17239$17275["<<:"]);(util$17277=require("./util"));(GenSym$17278=util$17277.GenSym);(gensym$17279=util$17277.gensym);($21082=util$17277.neighbours);(classify$17280=util$17277.classify);(classify_contiguous$17281=util$17277.classify_contiguous);(identity$17282=util$17277.identity);(Body$17283=util$17277.Body);($17241$17284=require("./expand"));(checker_db$17285=$17241$17284.checker_db);(PatternParser$17286=(function(scope$17343,pattern$17344,opt$17345){var tags$17361;var it$0$17348;(it$0$17348=(function(){if((!$16865(PatternParser$17286)(this))){return Object.create(PatternParser$17286.prototype);}else{return this;}})());(it$0$17348["opt"]=opt$17345);(it$0$17348["arguments"]=[]);(it$0$17348["vars"]=[]);(it$0$17348["specials"]=({}));(tags$17361=$21133((opt$17345.tags||({}))));(tags$17361["group_id"]=(tags$17361.group_id||gensym$17279("group")));(it$0$17348["pattern"]=it$0$17348.expand(scope$17343,pattern$17344,tags$17361,true,it$0$17348.opt.indexable));return it$0$17348;}));(PatternParser$17286.prototype["parse_specs"]=(function(scope$17385,specs$17386,tags$17387){var $index$17448;var $length$17442;var temp$17436;var acc$17430;var rest$17405;var has_defaults$17406;var rval$17407;var it$0$17391;var self$17392;(it$0$17391=this);(self$17392=this);(rest$17405=(void 0));(has_defaults$17406=false);(rval$17407=classify$17280("fw","bw","keys","defaults",(((acc$17430=[])),(((temp$17436=scope$17385.step_all(["pattern"],specs$17386))),((($length$17442=temp$17436.length)),((($index$17448=0)),(function(){$17416:for(;($index$17448<$length$17442);($index$17448++)){var v$17522;var v$17516;var variable$17504;var value$17505;var key$17497;var subp$17498;var key$17491;var variable$17471;var $17424$17465;var $17425$17466;var $17426$17467;var $17427$17468;var t0$17462;var t1$17463;var m$17457;(m$17457=temp$17436[$index$17448]);(t0$17462=m$17457);if((($17425$17466=(t0$17462 instanceof Array))&&(((t1$17463=t0$17462.length)),(($17427$17468=(t1$17463===2))&&(t0$17462[0]==="dynsplice"))))){(variable$17471=t0$17462[1]);acc$17430.push((((rest$17405=it$0$17391.expand(scope$17385,variable$17471,tags$17387))),["ignore"]));}else{if(($17427$17468&&(t0$17462[0]==="assoc"))){(key$17491=t0$17462[1]);acc$17430.push(["keys",[key$17491,it$0$17391.expand(scope$17385,key$17491,tags$17387)]]);}else{if(($17425$17466&&(($17427$17468=(t1$17463===3))&&(t0$17462[0]==="assoc")))){(key$17497=t0$17462[1]);(subp$17498=t0$17462[2]);acc$17430.push(["keys",[key$17497,it$0$17391.expand(scope$17385,subp$17498,tags$17387)]]);}else{if(($17427$17468&&(t0$17462[0]==="default"))){(variable$17504=t0$17462[1]);(value$17505=t0$17462[2]);acc$17430.push((((has_defaults$17406=true)),(function(){if(rest$17405){throw $16977(["syntax","pattern"]).create("No default arguments after rest arg.");}else{return ["defaults",[it$0$17391.expand(scope$17385,variable$17504,tags$17387),value$17505]];}})()));}else{(v$17516=m$17457);if(((rest$17405===(void 0))&&(!has_defaults$17406))){acc$17430.push(["fw",it$0$17391.expand(scope$17385,v$17516,tags$17387)]);}else{(v$17522=m$17457);acc$17430.push(["bw",it$0$17391.expand(scope$17385,v$17522,tags$17387)]);}}}}}}})()))),acc$17430)));(rval$17407["rest"]=rest$17405);return rval$17407;}));(PatternParser$17286.prototype["expand"]=(function(){var x$17622;var x$17632;var x$17661;var x$17667;var variable$17674;var variable$17691;var x$17731;var msg$17739;var msg$17755;var $index$17797;var $length$17791;var temp$17785;var acc$17779;var $index$17930;var $length$17924;var temp$17918;var acc$17912;var $index$17966;var $length$17960;var temp$17954;var t0$18041;var t1$18042;var t2$18043;var $index$18089;var $length$18083;var temp$18077;var acc$18071;var patts$18063;var canon$17827;var normalize$17828;var pps$17829;var vars$17830;var patt$18164;var msg$18210;var other$18206;var keys$18170;var fw$18143;var bw$18144;var defaults$18145;var rest$18146;var $18121$18140;var t0$18133;var t1$18134;var t2$18135;var t3$18136;var t4$18137;var t5$18138;var $18117$18128;var specs$18122;var other$18222;var mode$18216;var subp$18217;var args$18112;var xs$17819;var xs$17771;var x$17761;var f$17745;var arg$17746;var f$17720;var arguments$17721;var checker$17714;var subp$17715;var projector$17708;var subp$17709;var condition$17702;var subp$17703;var v$17697;var v$17680;var type$17639;var $17598$17613;var $17599$17614;var $17600$17615;var $17601$17616;var t0$17609;var bridge$17583$17610;var t1$17611;var $17578$17604;var expr$17571;var rval$17572;var scope$17557;var pattern$17558;var tags$17559;var toplevel$17560;var checked$17561;var t0$17553;var $17536$17548;var it$0$17538;var self$17539;(it$0$17538=this);(self$17539=this);($17536$17548=arguments);(t0$17553=$17536$17548.length);if(((t0$17553>=3)&&(t0$17553<=5))){(scope$17557=$17536$17548[0]);(pattern$17558=$17536$17548[1]);(tags$17559=$17536$17548[2]);(toplevel$17560=(function(){if((3>=t0$17553)){return false;}else{return $17536$17548[3];}})());(checked$17561=(function(){if((4>=t0$17553)){return false;}else{return $17536$17548[4];}})());(expr$17571=scope$17557.step(["pattern"],pattern$17558));(rval$17572=((($17578$17604=expr$17571)),(function(){if((((x$17622=$17578$17604)),((x$17622 instanceof Array)&&(x$17622[0]==="void")))){return ["check",checker_db$17285.null,["ignore"]];}else{if((((x$17632=$17578$17604)),((x$17632 instanceof Array)&&(x$17632[0]==="ignore")))){return expr$17571;}else{if((($17578$17604 instanceof Array)&&(((t0$17609=$17578$17604.length)),((t0$17609===2)&&($17578$17604[0]==="special"))))){(type$17639=$17578$17604[1]);(it$0$17538.specials[type$17639]=true);return expr$17571;}else{(bridge$17583$17610=$17578$17604);if(((((x$17661=bridge$17583$17610)),((x$17661 instanceof Array)&&(x$17661[0]==="symbol")))||(((x$17667=bridge$17583$17610)),((x$17667 instanceof Array)&&(x$17667[0]==="variable"))))){(variable$17674=$21266(expr$17571,tags$17559));it$0$17538.vars.push(variable$17674);return ["assign",variable$17674];}else{if((($17598$17613=($17578$17604 instanceof Array))&&(((t0$17609=$17578$17604.length)),(($17600$17615=(t0$17609===2))&&(($17601$17616=($17578$17604[0]==="value"))&&((v$17680=$17578$17604[1]),it$0$17538.opt.strings_as_variables)))))){(variable$17691=__lt____lt____colon__$17276($21266(["symbol",v$17680],tags$17559),expr$17571));it$0$17538.vars.push(variable$17691);return ["assign",variable$17691];}else{if($17601$17616){(v$17697=$17578$17604[1]);return ["check",checker_db$17285(v$17697),["ignore"]];}else{if(($17598$17613&&(($17600$17615=(t0$17609===3))&&($17578$17604[0]==="test")))){(condition$17702=$17578$17604[1]);(subp$17703=$17578$17604[2]);return ["test",condition$17702,it$0$17538.expand(scope$17557,subp$17703,tags$17559,toplevel$17560,false)];}else{if(($17600$17615&&($17578$17604[0]==="project"))){(projector$17708=$17578$17604[1]);(subp$17709=$17578$17604[2]);return ["project",projector$17708,it$0$17538.expand(scope$17557,subp$17709,tags$17559,toplevel$17560,true)];}else{if(($17600$17615&&($17578$17604[0]==="check"))){(checker$17714=$17578$17604[1]);(subp$17715=$17578$17604[2]);return ["check",checker$17714,it$0$17538.expand(scope$17557,subp$17715,tags$17559,toplevel$17560,true)];}else{if(($17600$17615&&(($17601$17616=($17578$17604[0]==="send"))&&((f$17720=$17578$17604[1]),(((t1$17611=$17578$17604[2])),(((x$17731=t1$17611)),((x$17731 instanceof Array)&&(x$17731[0]==="data")))))))){(arguments$17721=t1$17611);if(toplevel$17560){it$0$17538.arguments.unshift(arguments$17721);return it$0$17538.expand(scope$17557,f$17720,tags$17559,true,false);}else{(msg$17739="Function arguments can only be declared as a top level pattern.");throw $16977(["syntax","pattern"]).create(msg$17739,({"node":expr$17571,"arg":arguments$17721}));}}else{if($17601$17616){(f$17745=$17578$17604[1]);(arg$17746=$17578$17604[2]);return ["assign",expr$17571];}else{$17578$17604;if((!it$0$17538.opt.allow_nested)){(msg$17755="Nested patterns are not allowed here.");throw $16977(["syntax","pattern"]).create(msg$17755,({"node":expr$17571}));}else{if((($17598$17613=($17578$17604 instanceof Array))&&(((t0$17609=$17578$17604.length)),((t0$17609===2)&&($17578$17604[0]==="neg"))))){(x$17761=$17578$17604[1]);return ["neg",it$0$17538.expand(scope$17557,x$17761,tags$17559)];}else{if(($17598$17613&&(($17600$17615=(t0$17609>=1))&&($17578$17604[0]==="all")))){(xs$17771=Array.prototype.slice.call($17578$17604,1));return ["all"].concat((((acc$17779=[])),(((temp$17785=xs$17771)),((($length$17791=temp$17785.length)),((($index$17797=0)),(function(){$17774:for(;($index$17797<$length$17791);($index$17797++)){var x$17814;var m$17806;(m$17806=temp$17785[$index$17797]);(x$17814=m$17806);acc$17779.push(it$0$17538.expand(scope$17557,x$17814,tags$17559));}})()))),acc$17779));}else{if(($17600$17615&&($17578$17604[0]==="any"))){(xs$17819=Array.prototype.slice.call($17578$17604,1));(canon$17827=(function(all$17838){return all$17838.sort().join(",");}));(normalize$17828=(function(vars$17845){var $index$17870;var $length$17864;var temp$17858;var acc$17852;return canon$17827((((acc$17852=[])),(((temp$17858=vars$17845)),((($length$17864=temp$17858.length)),((($index$17870=0)),(function(){$17847:for(;($index$17870<$length$17864);($index$17870++)){var v$17889;var t0$17884;var t1$17885;var m$17879;(m$17879=temp$17858[$index$17870]);(t0$17884=m$17879);if(((t0$17884 instanceof Array)&&(((t1$17885=t0$17884.length)),((t1$17885===2)&&(t0$17884[0]==="symbol"))))){(v$17889=t0$17884[1]);acc$17852.push(v$17889);}else{$16958(m$17879,"/home/olivier/git/earl-grey/src/pattern.eg",3875,3913);}}})()))),acc$17852));}));(pps$17829=(((acc$17912=[])),(((temp$17918=xs$17819)),((($length$17924=temp$17918.length)),((($index$17930=0)),(function(){$17907:for(;($index$17930<$length$17924);($index$17930++)){var x$17947;var m$17939;(m$17939=temp$17918[$index$17930]);(x$17947=m$17939);acc$17912.push(PatternParser$17286(scope$17557,x$17947,$21266(it$0$17538.opt,({"tags":tags$17559}))));}})()))),acc$17912));(temp$17954=$21082(pps$17829));($length$17960=temp$17954.length);($index$17966=0);$17831:for(;($index$17966<$length$17960);($index$17966++)){var $index$18017;var $length$18011;var temp$18005;var pp1$17985;var pp2$17986;var t0$17980;var t1$17981;var m$17975;(m$17975=temp$17954[$index$17966]);(t0$17980=m$17975);if(((t0$17980 instanceof Array)&&(((t1$17981=t0$17980.length)),(t1$17981===2)))){(pp1$17985=t0$17980[0]);(pp2$17986=t0$17980[1]);(temp$18005=pps$17829);($length$18011=temp$18005.length);($index$18017=0);$17999:for(;($index$18017<$length$18011);($index$18017++)){var pp$18034;var m$18026;(m$18026=temp$18005[$index$18017]);(pp$18034=m$18026);normalize$17828(pp$18034.vars);}if((normalize$17828(pp1$17985.vars)!==normalize$17828(pp2$17986.vars))){throw $16977(["syntax","pattern"]).create("Both branches of 'or' must contain the same variables",({"vars1":__lt____lt____colon__$17276(pp1$17985.vars.sort(),pp1$17985.pattern),"vars2":__lt____lt____colon__$17276(pp2$17986.vars.sort(),pp2$17986.pattern)}));}if((canon$17827($21288(pp1$17985.specials))!==canon$17827($21288(pp2$17986.specials)))){throw $16977(["syntax","pattern"]).create("Both branches of 'or' must contain the same special tokens",({"special1":__lt____lt____colon__$17276($21288(pp1$17985.specials).sort(),pp1$17985.pattern),"special2":__lt____lt____colon__$17276($21288(pp2$17986.specials).sort(),pp2$17986.pattern)}));}}else{$16958(m$17975,"/home/olivier/git/earl-grey/src/pattern.eg",4005,4802);}}(t0$18041=pps$17829);if(((t0$18041 instanceof Array)&&(((t1$18042=t0$18041.length)),((t1$18042>=1)&&(((t2$18043=t0$18041[0])),$21217(t2$18043,"vars")))))){(vars$17830=t2$18043.vars);Array.prototype.slice.call(t0$18041,1);}else{$16958(pps$17829,"/home/olivier/git/earl-grey/src/pattern.eg",4819,4822);}(it$0$17538["vars"]=it$0$17538.vars.concat(vars$17830));(patts$18063=(((acc$18071=[])),(((temp$18077=pps$17829)),((($length$18083=temp$18077.length)),((($index$18089=0)),(function(){$18066:for(;($index$18089<$length$18083);($index$18089++)){var pp$18106;var m$18098;(m$18098=temp$18077[$index$18089]);(pp$18106=m$18098);acc$18071.push(pp$18106.pattern);}})()))),acc$18071));return ["any"].concat(patts$18063);}else{if(($17600$17615&&($17578$17604[0]==="data"))){(args$18112=Array.prototype.slice.call($17578$17604,1));(specs$18122=it$0$17538.parse_specs(scope$17557,args$18112,tags$17559));($18117$18128=specs$18122);if((($18121$18140=$21217($18117$18128,"keys"))&&(((t0$18133=$18117$18128.keys)),((t0$18133 instanceof Array)&&(((t1$18134=t0$18133.length)),((t1$18134===0)&&($21217($18117$18128,"fw")&&((fw$18143=$18117$18128.fw),($21217($18117$18128,"bw")&&((bw$18144=$18117$18128.bw),($21217($18117$18128,"defaults")&&((defaults$18145=$18117$18128.defaults),$21217($18117$18128,"rest"))))))))))))){(rest$18146=$18117$18128.rest);(patt$18164=__lt____lt____colon__$17276(["array_pattern",fw$18143,bw$18144,defaults$18145,rest$18146],pattern$17558));if(checked$17561){return patt$18164;}else{return ["check",checker_db$17285.Array,patt$18164];}}else{if(($18121$18140&&((keys$18170=$18117$18128.keys),($21217($18117$18128,"fw")&&(((t0$18133=$18117$18128.fw)),((t0$18133 instanceof Array)&&(((t1$18134=t0$18133.length)),((t1$18134===0)&&($21217($18117$18128,"bw")&&(((t2$18135=$18117$18128.bw)),((t2$18135 instanceof Array)&&(((t3$18136=t2$18135.length)),((t3$18136===0)&&($21217($18117$18128,"defaults")&&(((t4$18137=$18117$18128.defaults)),((t4$18137 instanceof Array)&&(((t5$18138=t4$18137.length)),((t5$18138===0)&&($21217($18117$18128,"rest")&&($18117$18128.rest===(void 0))))))))))))))))))))){return ["object_pattern"].concat(keys$18170);}else{(other$18206=$18117$18128);(msg$18210="Pattern must be an array or an object.");throw $16977(["syntax","pattern"]).create(msg$18210,({"node":expr$17571,"specs":specs$18122}));}}}else{if(($17598$17613&&((t0$17609===3)&&($17578$17604[0]==="mode")))){(mode$18216=$17578$17604[1]);(subp$18217=$17578$17604[2]);return it$0$17538.expand(scope$17557,subp$18217,$21266(tags$17559,({"declare_mode":mode$18216})),toplevel$17560,checked$17561);}else{(other$18222=$17578$17604);throw $16977(["syntax","pattern"]).create("Illegal pattern",({"node":other$18222}));}}}}}}}}}}}}}}}}}})()));return (it$0$17538.opt.wrap_pattern||identity$17282)(__lt____lt____colon__$17276(rval$17572,pattern$17558),toplevel$17560);}else{$16958($17536$17548);}}));$16884(PatternParser$17286,$16884(((accum$18230=({})),((accum$18230["::name"]="PatternParser"),accum$18230)),((accum$18234=({})),((accum$18234["::egclass"]=true),accum$18234))));PatternParser$17286;(PatternProcessor$17287=(function(){var it$0$18243;(it$0$18243=(function(){if((!$16865(PatternProcessor$17287)(this))){return Object.create(PatternProcessor$17287.prototype);}else{return this;}})());(it$0$18243["temps"]=[]);(it$0$18243["parts"]=[]);(it$0$18243["gen"]=GenSym$17278("t"));return it$0$18243;}));(PatternProcessor$17287.prototype["do"]=(function(part$18267){var it$0$18271;var self$18272;(it$0$18271=this);(self$18272=this);return it$0$18271.parts.push(["do",part$18267]);}));(PatternProcessor$17287.prototype["check"]=(function(){var part$18308;var tags$18309;var t0$18304;var $18287$18299;var it$0$18289;var self$18290;(it$0$18289=this);(self$18290=this);($18287$18299=arguments);(t0$18304=$18287$18299.length);if(((t0$18304>=1)&&(t0$18304<=2))){(part$18308=$18287$18299[0]);(tags$18309=(function(){if((1>=t0$18304)){return ({});}else{return $18287$18299[1];}})());return it$0$18289.parts.push($21266(["check",part$18308],tags$18309));}else{$16958($18287$18299);}}));(PatternProcessor$17287.prototype["temp"]=(function(){var x$18376;var x$18382;var init$18389;var bridge$18356$18365;var $18354$18360;var x$18346;var v$18347;var t0$18342;var $18325$18337;var it$0$18327;var self$18328;(it$0$18327=this);(self$18328=this);($18325$18337=arguments);(t0$18342=$18325$18337.length);if(((t0$18342>=1)&&(t0$18342<=2))){(x$18346=$18325$18337[0]);(v$18347=(function(){if((1>=t0$18342)){return null;}else{return $18325$18337[1];}})());($18354$18360=x$18346);(bridge$18356$18365=$18354$18360);if((((((x$18376=bridge$18356$18365)),((x$18376 instanceof Array)&&(x$18376[0]==="variable")))||(((x$18382=bridge$18356$18365)),((x$18382 instanceof Array)&&(x$18382[0]==="symbol"))))&&($21217($18354$18360,"single_assignment")&&($18354$18360.single_assignment&&(!v$18347))))){return x$18346;}else{(init$18389=$18354$18360);(v$18347=(v$18347||["symbol",it$0$18327.gen()]));(v$18347["single_assignment"]=true);it$0$18327.temps.push(v$18347);it$0$18327.do(["send",["symbol","="],["data",["send",["symbol","set"],v$18347],init$18389]]);return v$18347;}}else{$16958($18325$18337);}}));(PatternProcessor$17287.prototype["process"]=(function(pattern$18406,rhs$18407,fns$18408){var x$18461;var x$18495;var t$18508;var t$18520;var pp$18531;var $index$18564;var $length$18558;var temp$18552;var t$18542;var $index$18632;var $length$18626;var temp$18620;var acc$18614;var fn$18597;var parts$18598;var t$18590;var $index$18693;var $length$18687;var temp$18681;var acc$18675;var t$18666;var otherwise$18826;var $18804$18810;var $index$18843;var $length$18837;var temp$18831;var $index$18892;var $length$18886;var temp$18880;var end$18954;var pos$18948;var $index$18978;var $length$18972;var temp$18966;var acc$18960;var nfw$18759;var nbw$18760;var ndflt$18761;var extract_length$18762;var check_length$18763;var lo$18764;var hi$18765;var t$18766;var len$18767;var fw$18743;var bw$18744;var dflt$18745;var rest$18746;var subp$18661;var xs$18585;var xs$18537;var patt$18526;var projector$18514;var subp$18515;var checker$18502;var subp$18503;var checker$18490;var condition$18483;var subp$18484;var kind$18478;var sym$18468;var $18439$18452;var $18440$18453;var $18441$18454;var $18442$18455;var t0$18450;var $18426$18445;var rval$18423;var it$0$18412;var self$18413;(it$0$18412=this);(self$18413=this);(rval$18423=((($18426$18445=pattern$18406)),(function(){if((((x$18461=$18426$18445)),((x$18461 instanceof Array)&&(x$18461[0]==="ignore")))){return it$0$18412.do(rhs$18407);}else{if((($18439$18452=($18426$18445 instanceof Array))&&(((t0$18450=$18426$18445.length)),(($18441$18454=(t0$18450===2))&&($18426$18445[0]==="assign"))))){(sym$18468=$18426$18445[1]);return it$0$18412.parts.push(fns$18408.assign(sym$18468,rhs$18407));}else{if(($18441$18454&&($18426$18445[0]==="special"))){(kind$18478=$18426$18445[1]);return it$0$18412.process(fns$18408.special(pattern$18406,rhs$18407),rhs$18407,fns$18408);}else{if(($18439$18452&&(($18441$18454=(t0$18450===3))&&($18426$18445[0]==="test")))){(condition$18483=$18426$18445[1]);(subp$18484=$18426$18445[2]);it$0$18412.process(subp$18484,rhs$18407,fns$18408);return it$0$18412.check(condition$18483,({"test":true}));}else{if(($18441$18454&&(($18442$18455=($18426$18445[0]==="check"))&&((checker$18490=$18426$18445[1]),(((x$18495=$18426$18445[2])),((x$18495 instanceof Array)&&(x$18495[0]==="ignore"))))))){return it$0$18412.check(["send",checker$18490,["data",rhs$18407]]);}else{if($18442$18455){(checker$18502=$18426$18445[1]);(subp$18503=$18426$18445[2]);(t$18508=it$0$18412.temp(rhs$18407));it$0$18412.check(["send",checker$18502,["data",t$18508]]);return it$0$18412.process(subp$18503,t$18508,fns$18408);}else{if(($18441$18454&&($18426$18445[0]==="project"))){(projector$18514=$18426$18445[1]);(subp$18515=$18426$18445[2]);(t$18520=it$0$18412.temp(["send",projector$18514,["data",rhs$18407]]));it$0$18412.check(["send",t$18520,["value",0]]);return it$0$18412.process(subp$18515,["send",t$18520,["value",1]],fns$18408);}else{if(($18439$18452&&((t0$18450===2)&&($18426$18445[0]==="neg")))){(patt$18526=$18426$18445[1]);return it$0$18412.check(["send",["symbol","not"],["data",["void"],(((pp$18531=PatternProcessor$17287())),pp$18531.process(patt$18526,rhs$18407,fns$18408),assemble_conditions$17288(pp$18531))]]);}else{if(($18439$18452&&(($18441$18454=(t0$18450>=1))&&($18426$18445[0]==="all")))){(xs$18537=Array.prototype.slice.call($18426$18445,1));(t$18542=it$0$18412.temp(rhs$18407));(temp$18552=xs$18537);($length$18558=temp$18552.length);($index$18564=0);$18543:for(;($index$18564<$length$18558);($index$18564++)){var x$18581;var m$18573;(m$18573=temp$18552[$index$18564]);(x$18581=m$18573);it$0$18412.process(x$18581,t$18542,fns$18408);}return null;}else{if(($18441$18454&&($18426$18445[0]==="any"))){(xs$18585=Array.prototype.slice.call($18426$18445,1));(t$18590=it$0$18412.temp(rhs$18407,["symbol",gensym$17279("bridge")]));return it$0$18412.check((((fn$18597=(function(x$18603,rest$18604){return ["send",["symbol","or"],["data",x$18603,rest$18604]];}))),((parts$18598=(((acc$18614=[])),(((temp$18620=xs$18585)),((($length$18626=temp$18620.length)),((($index$18632=0)),(function(){$18609:for(;($index$18632<$length$18626);($index$18632++)){var pp$18654;var x$18649;var m$18641;(m$18641=temp$18620[$index$18632]);(x$18649=m$18641);acc$18614.push((((pp$18654=PatternProcessor$17287())),pp$18654.process(x$18649,t$18590,fns$18408),assemble_conditions$17288(pp$18654)));}})()))),acc$18614))),util$17277.construct(parts$18598,fn$18597,["symbol","false"])));}else{if(($18441$18454&&($18426$18445[0]==="object_pattern"))){(subp$18661=Array.prototype.slice.call($18426$18445,1));(t$18666=it$0$18412.temp(rhs$18407));(acc$18675=[]);(temp$18681=subp$18661);($length$18687=temp$18681.length);($index$18693=0);$18667:for(;($index$18693<$length$18687);($index$18693++)){var k$18714;var v$18715;var t0$18707;var t1$18708;var t2$18709;var t3$18710;var m$18702;(m$18702=temp$18681[$index$18693]);(t0$18707=m$18702);if(((t0$18707 instanceof Array)&&(((t1$18708=t0$18707.length)),((t1$18708===2)&&(((t2$18709=t0$18707[0])),((t2$18709 instanceof Array)&&(((t3$18710=t2$18709.length)),((t3$18710===2)&&(t2$18709[0]==="value"))))))))){(k$18714=t2$18709[1]);(v$18715=t0$18707[1]);acc$18675.push((it$0$18412.check(["send",["symbol","___hasprop"],["data",t$18666,["value",k$18714]]]),it$0$18412.process(v$18715,["send",t$18666,["value",k$18714]],fns$18408)));}else{$16958(m$18702,"/home/olivier/git/earl-grey/src/pattern.eg",8151,8283);}}return acc$18675;}else{if(($18439$18452&&((t0$18450===5)&&($18426$18445[0]==="array_pattern")))){(fw$18743=$18426$18445[1]);(bw$18744=$18426$18445[2]);(dflt$18745=$18426$18445[3]);(rest$18746=$18426$18445[4]);(nfw$18759=fw$18743.length);(nbw$18760=bw$18744.length);(ndflt$18761=dflt$18745.length);(extract_length$18762=true);(check_length$18763=true);(lo$18764=(nfw$18759+nbw$18760));(hi$18765=(lo$18764+ndflt$18761));(t$18766=it$0$18412.temp(rhs$18407));(len$18767=it$0$18412.temp(["send",t$18766,["send",["symbol","."],["data",["void"],["symbol","length"]]]]));it$0$18412.check(((($18804$18810=rest$18746)),(function(){if($18804$18810){return ["send",["symbol",">="],["data",len$18767,["value",lo$18764]]];}else{$18804$18810;if((lo$18764===hi$18765)){return ["send",["symbol","==="],["data",len$18767,["value",lo$18764]]];}else{(otherwise$18826=$18804$18810);return ["send",["symbol","and"],["data",["send",["symbol",">="],["data",len$18767,["value",lo$18764]]],["send",["symbol","<="],["data",len$18767,["value",hi$18765]]]]];}}})()));(temp$18831=$17210(fw$18743));($length$18837=temp$18831.length);($index$18843=0);$18768:for(;($index$18843<$length$18837);($index$18843++)){var i$18862;var m$18863;var t0$18857;var t1$18858;var m$18852;(m$18852=temp$18831[$index$18843]);(t0$18857=m$18852);if(((t0$18857 instanceof Array)&&(((t1$18858=t0$18857.length)),(t1$18858===2)))){(i$18862=t0$18857[0]);(m$18863=t0$18857[1]);it$0$18412.process(m$18863,["send",t$18766,["value",i$18862]],fns$18408);}else{$16958(m$18852,"/home/olivier/git/earl-grey/src/pattern.eg",9015,9101);}}(temp$18880=$17210(dflt$18745));($length$18886=temp$18880.length);($index$18892=0);$18771:for(;($index$18892<$length$18886);($index$18892++)){var idx$18940;var i$18913;var patt$18914;var value$18915;var t0$18906;var t1$18907;var t2$18908;var t3$18909;var m$18901;(m$18901=temp$18880[$index$18892]);(t0$18906=m$18901);if(((t0$18906 instanceof Array)&&(((t1$18907=t0$18906.length)),((t1$18907===2)&&((i$18913=t0$18906[0]),(((t2$18908=t0$18906[1])),((t2$18908 instanceof Array)&&(((t3$18909=t2$18908.length)),(t3$18909===2))))))))){(patt$18914=t2$18908[0]);(value$18915=t2$18908[1]);(idx$18940=(i$18913+nfw$18759));it$0$18412.process(patt$18914,["send",["symbol","if"],["data",["send",["symbol",">="],["data",["value",(idx$18940+nbw$18760)],len$18767]],value$18915,["send",t$18766,["value",idx$18940]]]],fns$18408);}else{$16958(m$18901,"/home/olivier/git/earl-grey/src/pattern.eg",9101,9270);}}if((rest$18746!==(void 0))){(pos$18948=(nfw$18759+ndflt$18761));(end$18954=(function(){if((nbw$18760>0)){return [["value",(-nbw$18760)]];}else{return [];}})());it$0$18412.process(rest$18746,["send",["send",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",t$18766,["value",pos$18948]].concat(end$18954)],fns$18408);}else{[];}(acc$18960=[]);(temp$18966=$17210(bw$18744));($length$18972=temp$18966.length);($index$18978=0);$18774:for(;($index$18978<$length$18972);($index$18978++)){var i$18997;var m$18998;var t0$18992;var t1$18993;var m$18987;(m$18987=temp$18966[$index$18978]);(t0$18992=m$18987);if(((t0$18992 instanceof Array)&&(((t1$18993=t0$18992.length)),(t1$18993===2)))){(i$18997=t0$18992[0]);(m$18998=t0$18992[1]);acc$18960.push(it$0$18412.process(m$18998,["send",["symbol","___js_fetch"],["data",t$18766,["send",["symbol","-"],["data",len$18767,["value",(nbw$18760-i$18997)]]]]],fns$18408));}else{$16958(m$18987,"/home/olivier/git/earl-grey/src/pattern.eg",9721,9872);}}return acc$18960;}else{$16958($18426$18445);}}}}}}}}}}}}})()));return rval$18423;}));$16884(PatternProcessor$17287,$16884(((accum$19019=({})),((accum$19019["::name"]="PatternProcessor"),accum$19019)),((accum$19023=({})),((accum$19023["::egclass"]=true),accum$19023))));PatternProcessor$17287;(assemble_conditions$17288=(function(pp$19030){var $index$19154;var $length$19148;var temp$19142;var acc$19136;var decls$19128;var construct$19034;(construct$19034=(function($19038$19041){var x$19109;var rest$19110;var x$19094;var x$19078;var rest$19079;var $19048$19065;var $19049$19066;var t0$19061;var t1$19062;var t2$19063;var $19043$19056;var ph$19050;(ph$19050=$19038$19041);($19043$19056=ph$19050);if((($19048$19065=($19043$19056 instanceof Array))&&(((t0$19061=$19043$19056.length)),(t0$19061===0)))){return ["value",true];}else{if(($19048$19065&&((t0$19061>=1)&&(((t1$19062=$19043$19056[0])),((t1$19062 instanceof Array)&&(((t2$19063=t1$19062.length)),((t2$19063===2)&&(t1$19062[0]==="do")))))))){(x$19078=t1$19062[1]);(rest$19079=Array.prototype.slice.call($19043$19056,1));return ["multi",x$19078,construct$19034(rest$19079)];}else{if(($19048$19065&&((t0$19061===1)&&(((t1$19062=$19043$19056[0])),((t1$19062 instanceof Array)&&(((t2$19063=t1$19062.length)),((t2$19063===2)&&(t1$19062[0]==="check")))))))){(x$19094=t1$19062[1]);return x$19094;}else{if(($19048$19065&&((t0$19061>=1)&&(((t1$19062=$19043$19056[0])),((t1$19062 instanceof Array)&&(((t2$19063=t1$19062.length)),((t2$19063===2)&&(t1$19062[0]==="check")))))))){(x$19109=t1$19062[1]);(rest$19110=Array.prototype.slice.call($19043$19056,1));return ["send",["symbol","and"],["data",x$19109,construct$19034(rest$19110)]];}else{$16958($19043$19056);}}}}}));if(pp$19030.temps.length){(decls$19128=(((acc$19136=[])),(((temp$19142=pp$19030.temps)),((($length$19148=temp$19142.length)),((($index$19154=0)),(function(){$19131:for(;($index$19154<$length$19148);($index$19154++)){var t$19171;var m$19163;(m$19163=temp$19142[$index$19154]);(t$19171=m$19163);acc$19136.push(["declare",t$19171]);}})()))),acc$19136));return ["multi"].concat(decls$19128).concat([construct$19034(pp$19030.parts)]);}else{return construct$19034(pp$19030.parts);}}));(assemble_pattern$17289=(function(){var $index$19243;var $length$19237;var temp$19231;var $index$19304;var $length$19298;var temp$19292;var test$19443;var lead$19206;var trail$19207;var construct$19208;var parts$19193;var t$19194;var f$19195;var t0$19189;var $19180$19184;($19180$19184=arguments);(t0$19189=$19180$19184.length);if(((t0$19189>=2)&&(t0$19189<=3))){(parts$19193=$19180$19184[0]);(t$19194=$19180$19184[1]);(f$19195=(function(){if((2>=t0$19189)){return null;}else{return $19180$19184[2];}})());(lead$19206=[]);(temp$19231=parts$19193.slice(0));($length$19237=temp$19231.length);($index$19243=0);$19209:for(;($index$19243<$length$19237);($index$19243++)){var x$19281;var x$19266;var $19213$19260;var $19214$19261;var $19215$19262;var $19216$19263;var t0$19257;var t1$19258;var m$19252;(m$19252=temp$19231[$index$19243]);(t0$19257=m$19252);if((($19214$19261=(t0$19257 instanceof Array))&&(((t1$19258=t0$19257.length)),(($19216$19263=(t1$19258===2))&&(t0$19257[0]==="do"))))){(x$19266=t0$19257[1]);lead$19206.push(x$19266);parts$19193.shift();}else{if(($19216$19263&&(t0$19257[0]==="check"))){(x$19281=t0$19257[1]);break $19209;}else{$16958(m$19252,"/home/olivier/git/earl-grey/src/pattern.eg",10333,10443);}}}(trail$19207=[]);(temp$19292=parts$19193.slice(0).reverse());($length$19298=temp$19292.length);($index$19304=0);$19217:for(;($index$19304<$length$19298);($index$19304++)){var x$19342;var x$19327;var $19221$19321;var $19222$19322;var $19223$19323;var $19224$19324;var t0$19318;var t1$19319;var m$19313;(m$19313=temp$19292[$index$19304]);(t0$19318=m$19313);if((($19222$19322=(t0$19318 instanceof Array))&&(((t1$19319=t0$19318.length)),(($19224$19324=(t1$19319===2))&&(t0$19318[0]==="do"))))){(x$19327=t0$19318[1]);trail$19207.unshift(x$19327);parts$19193.pop();}else{if(($19224$19324&&(t0$19318[0]==="check"))){(x$19342=t0$19318[1]);break $19217;}else{$16958(m$19313,"/home/olivier/git/earl-grey/src/pattern.eg",10457,10579);}}}(construct$19208=(function($19350$19353){var other$19438;var x$19422;var rest$19423;var x$19407;var x$19391;var rest$19392;var $19361$19378;var $19362$19379;var t0$19374;var t1$19375;var t2$19376;var $19355$19369;var ph$19363;(ph$19363=$19350$19353);($19355$19369=ph$19363);if((($19361$19378=($19355$19369 instanceof Array))&&(((t0$19374=$19355$19369.length)),(t0$19374===0)))){return ["value",true];}else{if(($19361$19378&&((t0$19374>=1)&&(((t1$19375=$19355$19369[0])),((t1$19375 instanceof Array)&&(((t2$19376=t1$19375.length)),((t2$19376===2)&&(t1$19375[0]==="do")))))))){(x$19391=t1$19375[1]);(rest$19392=Array.prototype.slice.call($19355$19369,1));return ["multi",x$19391,construct$19208(rest$19392)];}else{if(($19361$19378&&((t0$19374===1)&&(((t1$19375=$19355$19369[0])),((t1$19375 instanceof Array)&&(((t2$19376=t1$19375.length)),((t2$19376===2)&&(t1$19375[0]==="check")))))))){(x$19407=t1$19375[1]);return x$19407;}else{if(($19361$19378&&((t0$19374>=1)&&(((t1$19375=$19355$19369[0])),((t1$19375 instanceof Array)&&(((t2$19376=t1$19375.length)),((t2$19376===2)&&(t1$19375[0]==="check")))))))){(x$19422=t1$19375[1]);(rest$19423=Array.prototype.slice.call($19355$19369,1));return ["send",["symbol","and"],["data",x$19422,construct$19208(rest$19423)]];}else{(other$19438=$19355$19369);throw $16977(["oops"]).create("?!?",other$19438);}}}}}));if(parts$19193.length){(test$19443=construct$19208(parts$19193));return ["multi"].concat(lead$19206).concat([(function(){if(f$19195){return ["send",["symbol","if"],["data",test$19443,["multi"].concat(trail$19207).concat([t$19194]),f$19195]];}else{return ["send",["symbol","if"],["data",test$19443,["multi"].concat(trail$19207).concat([t$19194])]];}})()]);}else{return ["multi"].concat(lead$19206).concat(trail$19207).concat([t$19194]);}}else{$16958($19180$19184);}}));(inject_below_uses$17290=(function($19453$19456,fn$19457){var other$19488;var scope$19477;var x$19478;var t0$19473;var $19459$19468;var ph$19462;(ph$19462=$19453$19456);($19459$19468=ph$19462);if((($19459$19468 instanceof Array)&&(((t0$19473=$19459$19468.length)),((t0$19473===3)&&($19459$19468[0]==="use"))))){(scope$19477=$19459$19468[1]);(x$19478=$19459$19468[2]);return ["use",scope$19477,inject_below_uses$17290(x$19478,fn$19457)];}else{(other$19488=$19459$19468);return fn$19457(other$19488);}}));(parse_pattern$17291=(function(scope$19495,pattern$19496,rhs$19497,opt$19498){var t0$19512;var $index$19564;var $length$19558;var temp$19552;var acc$19546;var parse$19504;var target$19505;var proc$19506;(parse$19504=PatternParser$17286(scope$19495,pattern$19496,opt$19498));if(((!opt$19498.allow_arguments)&&parse$19504.arguments.length)){throw $16977(["syntax","pattern","arguments"]).create("Arguments cannot be declared in this pattern",({"args":parse$19504.arguments[0]}));}(t0$19512=$21289((opt$19498.wrap_target||identity$17282))((function(){if(parse$19504.arguments.length){return inject_below_uses$17290(rhs$19497,(function(x$19519){return util$17277.construct(parse$19504.arguments.concat([x$19519]),(function(args$19523,rest$19524){return ["send",["symbol","->"],["data",args$19523,rest$19524]];}));}));}else{return rhs$19497;}})()));if(t0$19512[0]){(target$19505=t0$19512[1]);}else{$16958((function(){if(parse$19504.arguments.length){return inject_below_uses$17290(rhs$19497,(function(x$19531){return util$17277.construct(parse$19504.arguments.concat([x$19531]),(function(args$19535,rest$19536){return ["send",["symbol","->"],["data",args$19535,rest$19536]];}));}));}else{return rhs$19497;}})(),"/home/olivier/git/earl-grey/src/pattern.eg",11979,12405);}(proc$19506=PatternProcessor$17287());proc$19506.process(parse$19504.pattern,target$19505,opt$19498);if(opt$19498.finalize){return ["splice"].concat(opt$19498.declare(scope$19495,parse$19504.vars)).concat([["multi"].concat((((acc$19546=[])),(((temp$19552=proc$19506.temps)),((($length$19558=temp$19552.length)),((($index$19564=0)),(function(){$19541:for(;($index$19564<$length$19558);($index$19564++)){var t$19581;var m$19573;(m$19573=temp$19552[$index$19564]);(t$19581=m$19573);acc$19546.push(["declare",t$19581]);}})()))),acc$19546)).concat([assemble_pattern$17289(proc$19506.parts,opt$19498.success(target$19505),opt$19498.failure(target$19505))])]);}else{return [parse$19504.vars,proc$19506.temps,proc$19506.parts];}}));(checkall$17292=["send","data","multi","assign","void","check","do"]);(same_block$17293=(function($19591$19594,ban1$19595,ban2$19596){var $index$19760;var $length$19754;var temp$19748;var other$19782;var type1$19721;var args1$19722;var type2$19723;var args2$19724;var m1$19704;var m2$19705;var v1$19687;var v2$19688;var s1$19670;var s2$19671;var v1$19638;var v2$19639;var $19605$19629;var $19606$19630;var $19607$19631;var $19608$19632;var $19609$19633;var $19610$19634;var $19611$19635;var t0$19623;var t1$19624;var t2$19625;var t3$19626;var t4$19627;var $19598$19618;var ph$19612;(ph$19612=$19591$19594);($19598$19618=ph$19612);if((($19605$19629=($19598$19618 instanceof Array))&&(((t0$19623=$19598$19618.length)),(($19607$19631=(t0$19623===2))&&(((t1$19624=$19598$19618[0])),(($19609$19633=(t1$19624 instanceof Array))&&(((t2$19625=t1$19624.length)),(($19611$19635=(t2$19625===2))&&((t1$19624[0]==="variable")&&((v1$19638=t1$19624[1]),(((t3$19626=$19598$19618[1])),((t3$19626 instanceof Array)&&(((t4$19627=t3$19626.length)),((t4$19627===2)&&(t3$19626[0]==="variable"))))))))))))))){(v2$19639=t3$19626[1]);return (v1$19638===v2$19639);}else{if(($19611$19635&&((t1$19624[0]==="symbol")&&((s1$19670=t1$19624[1]),(((t3$19626=$19598$19618[1])),((t3$19626 instanceof Array)&&(((t4$19627=t3$19626.length)),((t4$19627===2)&&(t3$19626[0]==="symbol"))))))))){(s2$19671=t3$19626[1]);return (((!$16901(ban1$19595,s1$19670))&&(!$16901(ban2$19596,s2$19671)))&&(s1$19670===s2$19671));}else{if(($19611$19635&&((t1$19624[0]==="value")&&((v1$19687=t1$19624[1]),(((t3$19626=$19598$19618[1])),((t3$19626 instanceof Array)&&(((t4$19627=t3$19626.length)),((t4$19627===2)&&(t3$19626[0]==="value"))))))))){(v2$19688=t3$19626[1]);return (v1$19687===v2$19688);}else{if(($19611$19635&&((t1$19624[0]==="macro")&&((m1$19704=t1$19624[1]),(((t3$19626=$19598$19618[1])),((t3$19626 instanceof Array)&&(((t4$19627=t3$19626.length)),((t4$19627===2)&&(t3$19626[0]==="macro"))))))))){(m2$19705=t3$19626[1]);return (m1$19704===m2$19705);}else{if(($19609$19633&&((t2$19625>=1)&&((type1$19721=t1$19624[0]),((args1$19722=Array.prototype.slice.call(t1$19624,1)),(((t3$19626=$19598$19618[1])),((t3$19626 instanceof Array)&&(((t4$19627=t3$19626.length)),((t4$19627>=1)&&((type2$19723=t3$19626[0]),((args2$19724=Array.prototype.slice.call(t3$19626,1)),(checkall$17292.indexOf(type1$19721)!==-1)))))))))))){if(((type1$19721===type2$19723)&&(args1$19722.length===args2$19724.length))){(temp$19748=$21336(args1$19722,args2$19724));($length$19754=temp$19748.length);($index$19760=0);$19742:for(;($index$19760<$length$19754);($index$19760++)){var pair$19777;var m$19769;(m$19769=temp$19748[$index$19760]);(pair$19777=m$19769);if((!same_block$17293(pair$19777,ban1$19595,ban2$19596))){return false;}}return true;}else{return false;}}else{(other$19782=$19598$19618);return false;}}}}}}));(parse_clauses$17294=(function(scope$19789,target$19790,stmts$19791,opt$19792){var $index$19832;var $length$19826;var temp$19820;var acc$19814;var $index$20078;var $length$20072;var temp$20066;var acc$20060;var $index$20141;var $length$20135;var temp$20129;var acc$20123;var decls$20115;var all_temps$19798;var the_parts$19799;var unique_temps$19800;(all_temps$19798=[]);(the_parts$19799=(((acc$19814=[])),(((temp$19820=scope$19789.step_all(["clause"],stmts$19791))),((($length$19826=temp$19820.length)),((($index$19832=0)),(function(){$19806:for(;($index$19832<$length$19826);($index$19832++)){var accum$19944;var accum$19962;var t0$19936;var t1$19937;var $index$19989;var $length$19983;var temp$19977;var bod$20030;var placeholder$19871;var special_fn$19872;var vars$19873;var temps$19874;var blocks$19875;var vars2$19876;var x$20040;var other$20048;var b$20036;var pattern$19852;var body$19853;var $19811$19849;var t0$19846;var t1$19847;var m$19841;(m$19841=temp$19820[$index$19832]);(t0$19846=m$19841);if(((t0$19846 instanceof Array)&&(((t1$19847=t0$19846.length)),((t1$19847===3)&&(t0$19846[0]==="clause"))))){(pattern$19852=t0$19846[1]);(body$19853=t0$19846[2]);acc$19814.push((((placeholder$19871=(void 0))),((special_fn$19872=(function($19887$19890,value$19891){var t0$19899;var t1$19900;var other$19932;var $19893$19915;var ph$19896;var expr$19897;(t0$19899=$19887$19890);if(((t0$19899 instanceof Array)&&(((t1$19900=t0$19899.length)),((t1$19900===2)&&(t0$19899[0]==="special"))))){(ph$19896=t0$19899[1]);(expr$19897=t0$19899);}else{$16958($19887$19890);}($19893$19915=ph$19896);if(($19893$19915==="match")){(placeholder$19871=__lt____lt____colon__$17276(["symbol",scope$19789.gensym("ph")],expr$19897));return ["assign",placeholder$19871];}else{(other$19932=$19893$19915);throw $16977(["syntax","pattern","special"]).create("Special token cannot be used here",({"special":expr$19897}));}}))),(((t0$19936=parse_pattern$17291(scope$19789,pattern$19852,target$19790,$21266(opt$19792,$16884(({"allow_arguments":false,"allow_nested":true,"special":special_fn$19872}),$16884(((accum$19944=({})),((accum$19944["assign"]=(function(v$19949,value$19950){return ["do",__lt____lt____colon__$17276(["assign",v$19949,value$19950],v$19949)];})),accum$19944)),({"finalize":false}))))))),(function(){if(((t0$19936 instanceof Array)&&(((t1$19937=t0$19936.length)),(t1$19937===3)))){(vars$19873=t0$19936[0]);(temps$19874=t0$19936[1]);(blocks$19875=t0$19936[2]);}else{return $16958(parse_pattern$17291(scope$19789,pattern$19852,target$19790,$21266(opt$19792,$16884(({"allow_arguments":false,"allow_nested":true,"special":special_fn$19872}),$16884(((accum$19962=({})),((accum$19962["assign"]=(function(v$19967,value$19968){return ["do",__lt____lt____colon__$17276(["assign",v$19967,value$19968],v$19967)];})),accum$19962)),({"finalize":false}))))),"/home/olivier/git/earl-grey/src/pattern.eg",14056,14390);}})()),(all_temps$19798=all_temps$19798.concat(temps$19874)),(function(){if(placeholder$19871){return vars$19873.push(placeholder$19871);}})(),((vars2$19876=({}))),(((temp$19977=vars$19873)),((($length$19983=temp$19977.length)),((($index$19989=0)),(function(){$19877:for(;($index$19989<$length$19983);($index$19989++)){var other$20026;var xxx$20008;var t0$20003;var t1$20004;var m$19998;(m$19998=temp$19977[$index$19989]);(t0$20003=m$19998);if(((t0$20003 instanceof Array)&&(((t1$20004=t0$20003.length)),((t1$20004===2)&&(t0$20003[0]==="symbol"))))){(xxx$20008=t0$20003[1]);(vars2$19876[xxx$20008]=true);}else{(other$20026=m$19998);throw $16977(["syntax","unexpected"]).create();}}})()))),(((bod$20030=(function(){if(placeholder$19871){return parse_clauses$17294(scope$19789,placeholder$19871,$21289(Body$17283)(body$19853)[1],opt$19792);}else{if(opt$19792.wrap){return opt$19792.wrap(body$19853);}else{return body$19853;}}})())),["clause",vars$19873,vars2$19876,blocks$19875,bod$20030])));}else{if((((x$20040=t0$19846)),((x$20040 instanceof Array)&&(x$20040[0]==="block")))){(b$20036=t0$19846);acc$19814.push(b$20036);}else{(other$20048=m$19841);acc$19814.push(function(){throw $16977(["syntax","clause"]).create("Illegal clause",({"clause":other$20048}));}());}}}})()))),acc$19814));if(opt$19792.fallback){the_parts$19799.push(["block",opt$19792.fallback(target$19790)]);}(unique_temps$19800=$21288(util$17277.mkset((((acc$20060=[])),(((temp$20066=all_temps$19798)),((($length$20072=temp$20066.length)),((($index$20078=0)),(function(){$20055:for(;($index$20078<$length$20072);($index$20078++)){var t$20097;var t0$20092;var t1$20093;var m$20087;(m$20087=temp$20066[$index$20078]);(t0$20092=m$20087);if(((t0$20092 instanceof Array)&&(((t1$20093=t0$20092.length)),((t1$20093===2)&&(t0$20092[0]==="symbol"))))){(t$20097=t0$20092[1]);acc$20060.push(t$20097);}else{$16958(m$20087,"/home/olivier/git/earl-grey/src/pattern.eg",15197,15227);}}})()))),acc$20060))));(decls$20115=(((acc$20123=[])),(((temp$20129=unique_temps$19800)),((($length$20135=temp$20129.length)),((($index$20141=0)),(function(){$20118:for(;($index$20141<$length$20135);($index$20141++)){var t$20158;var m$20150;(m$20150=temp$20129[$index$20141]);(t$20158=m$20150);acc$20123.push(["declare",$16884(["symbol",t$20158],({"mutable":true}))]);}})()))),acc$20123));return ["multi"].concat(decls$20115).concat([weave_clauses$17296(the_parts$19799)]);}));(opt_clauses$17295=(function(clauses$20167){var $index$20207;var $length$20201;var temp$20195;var acc$20189;var $index$20391;var $length$20385;var temp$20379;var acc$20373;var $index$20451;var $length$20445;var temp$20439;var acc$20433;var $index$20503;var $length$20497;var temp$20491;var acc$20485;var shares$20176;var max$20177;var temps$20178;var shared_last$20179;var idx_last$20180;var new_clauses$20181;(shares$20176=(((acc$20189=[])),(((temp$20195=$17210(clauses$20167.slice(1)))),((($length$20201=temp$20195.length)),((($index$20207=0)),(function(){$20184:for(;($index$20207<$length$20201);($index$20207++)){var t0$20268;var t1$20269;var $index$20303;var $length$20297;var temp$20291;var varsd0$20260;var blocks0$20261;var share$20262;var idx$20263;var i$20228;var vars$20229;var varsd$20230;var blocks$20231;var body$20232;var t0$20221;var t1$20222;var t2$20223;var t3$20224;var m$20216;(m$20216=temp$20195[$index$20207]);(t0$20221=m$20216);if(((t0$20221 instanceof Array)&&(((t1$20222=t0$20221.length)),((t1$20222===2)&&((i$20228=t0$20221[0]),(((t2$20223=t0$20221[1])),((t2$20223 instanceof Array)&&(((t3$20224=t2$20223.length)),((t3$20224===5)&&(t2$20223[0]==="clause")))))))))){(vars$20229=t2$20223[1]);(varsd$20230=t2$20223[2]);(blocks$20231=t2$20223[3]);(body$20232=t2$20223[4]);acc$20189.push(((((t0$20268=$16901(clauses$20167,i$20228))),(function(){if(((t0$20268 instanceof Array)&&(((t1$20269=t0$20268.length)),((t1$20269===5)&&(t0$20268[0]==="clause"))))){t0$20268[1];(varsd0$20260=t0$20268[2]);(blocks0$20261=t0$20268[3]);t0$20268[4];}else{return $16958($16901(clauses$20167,i$20228),"/home/olivier/git/earl-grey/src/pattern.eg",15520,15530);}})()),((share$20262=0)),((idx$20263=0)),(((temp$20291=blocks$20231)),((($length$20297=temp$20291.length)),((($index$20303=0)),(function(){$20264:for(;($index$20303<$length$20297);($index$20303++)){var x$20340;var x$20350;var other$20361;var $20323$20329;var b$20320;var m$20312;(m$20312=temp$20291[$index$20303]);(b$20320=m$20312);if(same_block$17293([$16901(blocks0$20261,share$20262),b$20320],varsd0$20260,varsd$20230)){(share$20262++);($20323$20329=b$20320);if((((x$20340=$20323$20329)),((x$20340 instanceof Array)&&(x$20340[0]==="do")))){null;}else{if((((x$20350=$20323$20329)),((x$20350 instanceof Array)&&(x$20350[0]==="check")))){(idx$20263=share$20262);}else{(other$20361=$20323$20329);__lt____gt__$17274(null,other$20361);}}}else{break $20264;}}})()))),[share$20262,idx$20263]));}else{$16958(m$20216,"/home/olivier/git/earl-grey/src/pattern.eg",15396,15924);}}})()))),acc$20189));(max$20177=$16901(Math.max,(((acc$20373=[])),(((temp$20379=shares$20176)),((($length$20385=temp$20379.length)),((($index$20391=0)),(function(){$20368:for(;($index$20391<$length$20385);($index$20391++)){var x$20410;var t0$20405;var t1$20406;var m$20400;(m$20400=temp$20379[$index$20391]);(t0$20405=m$20400);if(((t0$20405 instanceof Array)&&(((t1$20406=t0$20405.length)),(t1$20406===2)))){(x$20410=t0$20405[0]);t0$20405[1];acc$20373.push(x$20410);}else{$16958(m$20400,"/home/olivier/git/earl-grey/src/pattern.eg",15938,15963);}}})()))),acc$20373)));shares$20176.push([0,0]);(temps$20178=(((acc$20433=[])),(((temp$20439=$21400(1,max$20177))),((($length$20445=temp$20439.length)),((($index$20451=0)),(function(){$20428:for(;($index$20451<$length$20445);($index$20451++)){var m$20460;(m$20460=temp$20439[$index$20451]);m$20460;acc$20433.push(["symbol",gensym$17279()]);}})()))),acc$20433));(shared_last$20179=0);(idx_last$20180=0);(new_clauses$20181=(((acc$20485=[])),(((temp$20491=$17210(clauses$20167))),((($length$20497=temp$20491.length)),((($index$20503=0)),(function(){$20479:for(;($index$20503<$length$20497);($index$20503++)){var t0$20565;var t1$20566;var $index$20615;var $length$20609;var temp$20603;var acc$20597;var rest$20699;var newblocks$20694;var share$20559;var idx$20560;var shared$20561;var n_to_share$20562;var to_share$20563;var other$20706;var i$20524;var vars$20525;var varsd$20526;var blocks$20527;var body$20528;var t0$20517;var t1$20518;var t2$20519;var t3$20520;var m$20512;(m$20512=temp$20491[$index$20503]);(t0$20517=m$20512);if(((t0$20517 instanceof Array)&&(((t1$20518=t0$20517.length)),((t1$20518===2)&&((i$20524=t0$20517[0]),(((t2$20519=t0$20517[1])),((t2$20519 instanceof Array)&&(((t3$20520=t2$20519.length)),((t3$20520===5)&&(t2$20519[0]==="clause")))))))))){(vars$20525=t2$20519[1]);(varsd$20526=t2$20519[2]);(blocks$20527=t2$20519[3]);(body$20528=t2$20519[4]);acc$20485.push(((((t0$20565=$16901(shares$20176,i$20524))),(function(){if(((t0$20565 instanceof Array)&&(((t1$20566=t0$20565.length)),(t1$20566===2)))){(share$20559=t0$20565[0]);(idx$20560=t0$20565[1]);}else{return $16958($16901(shares$20176,i$20524),"/home/olivier/git/earl-grey/src/pattern.eg",16196,16205);}})()),((shared$20561=(function(){if(idx_last$20180){return [["check",$16901(temps$20178,(idx_last$20180-1))]];}else{return [];}})())),((n_to_share$20562=Math.max(shared_last$20179,share$20559))),((to_share$20563=(((acc$20597=[])),(((temp$20603=$17210(blocks$20527.slice(shared_last$20179,n_to_share$20562)))),((($length$20609=temp$20603.length)),((($index$20615=0)),(function(){$20587:for(;($index$20615<$length$20609);($index$20615++)){var j$20667;var x$20668;var j$20640;var x$20641;var $20591$20634;var $20592$20635;var $20593$20636;var $20594$20637;var t0$20629;var t1$20630;var t2$20631;var t3$20632;var m$20624;(m$20624=temp$20603[$index$20615]);(t0$20629=m$20624);if((($20592$20635=(t0$20629 instanceof Array))&&(((t1$20630=t0$20629.length)),(($20594$20637=(t1$20630===2))&&((j$20640=t0$20629[0]),(((t2$20631=t0$20629[1])),((t2$20631 instanceof Array)&&(((t3$20632=t2$20631.length)),((t3$20632===2)&&(t2$20631[0]==="check")))))))))){(x$20641=t2$20631[1]);acc$20597.push(["check",["assign",$16901(temps$20178,(shared_last$20179+j$20640)),x$20641]]);}else{if(($20594$20637&&((j$20667=t0$20629[0]),(((t2$20631=t0$20629[1])),((t2$20631 instanceof Array)&&(((t3$20632=t2$20631.length)),((t3$20632===2)&&(t2$20631[0]==="do")))))))){(x$20668=t2$20631[1]);acc$20597.push(["do",x$20668]);}else{$16958(m$20624,"/home/olivier/git/earl-grey/src/pattern.eg",16344,16515);}}}})()))),acc$20597))),((shared_last$20179=share$20559)),((idx_last$20180=idx$20560)),(((newblocks$20694=(((rest$20699=blocks$20527.slice(n_to_share$20562))),shared$20561.concat(to_share$20563).concat(rest$20699)))),["clause",vars$20525,varsd$20526,newblocks$20694,body$20528])));}else{(other$20706=m$20512);acc$20485.push(function(){throw $16977(["oops"]).create("what",({"value":other$20706}));}());}}})()))),acc$20485));return [temps$20178,new_clauses$20181];}));(weave_clauses$17296=(function(parts$20715){var $index$20780;var $length$20774;var temp$20768;var $index$21044;var $length$21038;var temp$21032;var acc$21026;var groups$20722;var reassemble$20723;var new_temps$20724;var helper$20725;(groups$20722=classify_contiguous$17281(parts$20715,(function($20737$20740){var t0$20744;var t1$20745;var cls$20742;(t0$20744=$20737$20740);if(((t0$20744 instanceof Array)&&(((t1$20745=t0$20744.length)),(t1$20745>=1)))){(cls$20742=t0$20744[0]);Array.prototype.slice.call(t0$20744,1);}else{$16958($20737$20740);}return cls$20742;})));(reassemble$20723=[]);(new_temps$20724=[]);(temp$20768=groups$20722);($length$20774=temp$20768.length);($index$20780=0);$20726:for(;($index$20780<$length$20774);($index$20780++)){var t0$20820;var t1$20821;var ts$20817;var new_clauses$20818;var elems$20836;var elems$20803;var $20730$20797;var $20731$20798;var $20732$20799;var $20733$20800;var t0$20794;var t1$20795;var m$20789;(m$20789=temp$20768[$index$20780]);(t0$20794=m$20789);if((($20731$20798=(t0$20794 instanceof Array))&&(((t1$20795=t0$20794.length)),(($20733$20800=(t1$20795>=1))&&(t0$20794[0]==="clause"))))){(elems$20803=Array.prototype.slice.call(t0$20794,1));(t0$20820=opt_clauses$17295(elems$20803));if(((t0$20820 instanceof Array)&&(((t1$20821=t0$20820.length)),(t1$20821===2)))){(ts$20817=t0$20820[0]);(new_clauses$20818=t0$20820[1]);}else{$16958(opt_clauses$17295(elems$20803),"/home/olivier/git/earl-grey/src/pattern.eg",17024,17042);}(new_temps$20724=new_temps$20724.concat(ts$20817));(reassemble$20723=reassemble$20723.concat(new_clauses$20818));}else{if(($20733$20800&&(t0$20794[0]==="block"))){(elems$20836=Array.prototype.slice.call(t0$20794,1));(reassemble$20723=reassemble$20723.concat(elems$20836));}else{$16958(m$20789,"/home/olivier/git/earl-grey/src/pattern.eg",16958,17163);}}}(helper$20725=(function($20844$20847){var $index$20960;var $length$20954;var temp$20948;var acc$20942;var decls$20934;var vars$20925;var varsd$20926;var blocks$20927;var body$20928;var rest$20929;var body$20894;var rest$20895;var $20853$20877;var $20854$20878;var $20855$20879;var $20856$20880;var $20857$20881;var $20858$20882;var t0$20870;var t1$20871;var t2$20872;var t3$20873;var t4$20874;var t5$20875;var $20849$20865;var ph$20859;(ph$20859=$20844$20847);($20849$20865=ph$20859);if((($20853$20877=($20849$20865 instanceof Array))&&(((t0$20870=$20849$20865.length)),(t0$20870===0)))){return ["multi"];}else{if(($20853$20877&&(($20855$20879=(t0$20870>=1))&&(((t1$20871=$20849$20865[0])),(($20857$20881=(t1$20871 instanceof Array))&&(((t2$20872=t1$20871.length)),((t2$20872===2)&&((t1$20871[0]==="block")&&(((t3$20873=$21289(Body$17283)(t1$20871[1]))),(t3$20873[0]&&(((t4$20874=t3$20873[1])),(((t5$20875=t4$20874.length)),(t5$20875>=0))))))))))))){(body$20894=Array.prototype.slice.call(t4$20874,0));(rest$20895=Array.prototype.slice.call($20849$20865,1));return ["multi"].concat(body$20894).concat([helper$20725(rest$20895)]);}else{if(($20857$20881&&((t2$20872===5)&&(t1$20871[0]==="clause")))){(vars$20925=t1$20871[1]);(varsd$20926=t1$20871[2]);(blocks$20927=t1$20871[3]);(body$20928=t1$20871[4]);(rest$20929=Array.prototype.slice.call($20849$20865,1));(decls$20934=(((acc$20942=[])),(((temp$20948=vars$20925)),((($length$20954=temp$20948.length)),((($index$20960=0)),(function(){$20937:for(;($index$20960<$length$20954);($index$20960++)){var bridge$20985$20993;var $20980$20988;var v$20977;var m$20969;(m$20969=temp$20948[$index$20960]);(v$20977=m$20969);acc$20942.push(((($20980$20988=v$20977.declare_mode)),(function(){if(($20980$20988==="set")){return ["splice"];}else{if(($20980$20988==="let")){return ["declare",$21266(v$20977,({"mutable":false}))];}else{if(($20980$20988==="var")){return ["declare",$21266(v$20977,({"mutable":true}))];}else{(bridge$20985$20993=$20980$20988);if(((bridge$20985$20993==="unqualified")||(bridge$20985$20993===(void 0)))){return ["declare",$21266(v$20977,({"mutable":false}))];}else{$16958($20980$20988);}}}}})()));}})()))),acc$20942));return ["tagscope","back",["multi"].concat(decls$20934).concat([assemble_pattern$17289(blocks$20927,body$20928,["use","back",helper$20725(rest$20929)])])];}else{$16958($20849$20865);}}}}));return ["multi"].concat((((acc$21026=[])),(((temp$21032=new_temps$20724)),((($length$21038=temp$21032.length)),((($index$21044=0)),(function(){$21021:for(;($index$21044<$length$21038);($index$21044++)){var t$21061;var m$21053;(m$21053=temp$21032[$index$21044]);(t$21061=m$21053);acc$21026.push(["declare",t$21061]);}})()))),acc$21026)).concat([helper$20725(reassemble$20723)]);}));(exports["PatternParser"]=PatternParser$17286);(exports["PatternProcessor"]=PatternProcessor$17287);(exports["parse_clauses"]=parse_clauses$17294);(exports["parse_pattern"]=parse_pattern$17291);
