var $16889=(function(type$16892){var f$16896;(f$16896=type$16892["::check"]);if((f$16896===(void 0))){return (function(value$16902){return (value$16902 instanceof type$16892);});}else{return (function(value$16906){return f$16896.call(type$16892,value$16906);});}});
var $16908=(function(dest$16911,values$16912){var k$16917;(k$16917=null);$16915:for(k$16917 in values$16912){if(values$16912.hasOwnProperty(k$16917)){(dest$16911[k$16917]=values$16912[k$16917]);}}return dest$16911;});
var $16925=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $16926=(function($16928$16931){var ph$16937;(ph$16937=$16928$16931);var $16933$16943;($16933$16943=ph$16937);var bridge$16935$16948;var x$16952;(bridge$16935$16948=$16933$16943);if((((typeof(bridge$16935$16948)==="string")&&((x$16952=bridge$16935$16948),true))||((typeof(bridge$16935$16948)==="number")&&((x$16952=bridge$16935$16948),true)))){return ["value",x$16952];}else{var other$16963;(other$16963=$16933$16943);return other$16963["::serialize_ast"]();}});
var $16965=(function(obj$16968){var results$16973;(results$16973=[]);var k$16978;(k$16978=null);$16972:for(k$16978 in obj$16968){if(Object.prototype.hasOwnProperty.call(obj$16968,k$16978)){results$16973.push([k$16978,$16925(obj$16968,k$16978)]);}}return results$16973;});
var $17234=(function(arr$17237){var results$17243;var l$17244;(results$17243=[]);(l$17244=arr$17237.length);var i$17253;(i$17253=0);$17242:for(;(i$17253<l$17244);(i$17253++)){results$17243.push([i$17253,$16925(arr$17237,i$17253)]);}return results$17243;});
var $17001=(function(){var $17002$17008;($17002$17008=(function(tags$17013){var it$0$17016;(it$0$17016=(function(){if((!$16889($17002$17008)(this))){return Object.create($17002$17008.prototype);}else{return this;}})());(it$0$17016["tags"]=tags$17013);return it$0$17016;}));($17002$17008.prototype["create"]=(function(){var it$0$17036;var self$17037;(it$0$17036=this);(self$17037=this);var $17034$17046;($17034$17046=arguments);var t0$17051;var message$17055;var args$17056;(t0$17051=$17034$17046.length);if((t0$17051>=0)){(message$17055=(function(){if((0>=t0$17051)){return "";}else{return $17034$17046[0];}})());(args$17056=Array.prototype.slice.call($17034$17046,1));var e$17069;(e$17069=Error(message$17055));(e$17069["::tags"]=it$0$17036.tags);(e$17069["args"]=args$17056);var temp$17085;(temp$17085=$17234(args$17056));var $length$17091;($length$17091=temp$17085.length);var $index$17097;($index$17097=0);$17070:for(;($index$17097<$length$17091);($index$17097++)){var m$17106;(m$17106=temp$17085[$index$17097]);var t0$17111;var t1$17112;var i$17116;var arg$17117;(t0$17111=m$17106);if(((t0$17111 instanceof Array)&&(((t1$17112=t0$17111.length)),(t1$17112===2)))){(i$17116=t0$17111[0]);(arg$17117=t0$17111[1]);(e$17069[i$17116]=arg$17117);}else{$16982(m$17106);}}(e$17069["length"]=args$17056.length);(e$17069["name"]=["E"].concat(it$0$17036.tags).join("."));return e$17069;}else{$16982($17034$17046);}}));($17002$17008.prototype["::check"]=(function(e$17147){var it$0$17151;var self$17152;(it$0$17151=this);(self$17152=this);var tags$17162;if(((!e$17147)||(!$16889(Error)(e$17147)))){return false;}(tags$17162=(e$17147["::tags"]||[]));var temp$17173;(temp$17173=it$0$17151.tags);var $length$17179;($length$17179=temp$17173.length);var $index$17185;($index$17185=0);$17163:for(;($index$17185<$length$17179);($index$17185++)){var m$17194;(m$17194=temp$17173[$index$17185]);var tag$17202;(tag$17202=m$17194);if((tags$17162.indexOf(tag$17202)===-1)){return false;}else{false;}}return true;}));($17002$17008.prototype["::deconstruct"]=(function(e$17211){var it$0$17215;var self$17216;(it$0$17215=this);(self$17216=this);return e$17211.args;}));$16908($17002$17008,$16908((function(){var accum$17227;(accum$17227=({}));(accum$17227["::name"]="$17002");return accum$17227;})(),(function(){var accum$17231;(accum$17231=({}));(accum$17231["::egclass"]=true);return accum$17231;})()));return $17002$17008;})();
var $16982=(function(value$16985,url$16986,start$16987,end$16988){var err$16992;(err$16992=$17001(["match"]).create("Could not find a match for value",({"value":value$16985})));if(url$16986){(err$16992["location"]=["location",url$16986,start$16987,end$16988]);}throw err$16992;});
var send$16534;var __array_methods$16535;var __re_methods$16536;(send$16534=(function(obj$16549,$16546$16550){var ph$16556;var msg$16557;var t0$16559;(t0$16559=$16546$16550);(msg$16557=t0$16559);(ph$16556=t0$16559);var $16552$16568;($16552$16568=ph$16556);var bridge$16554$16573;(bridge$16554$16573=$16552$16568);if(((typeof(bridge$16554$16573)==="string")||(typeof(bridge$16554$16573)==="number"))){return obj$16549[msg$16557];}else{var other$16585;(other$16585=$16552$16568);return obj$16549["::send"](msg$16557);}}));(Array[":::project"]=(function($16591$16594){var ph$16599;var value$16600;var t0$16602;(t0$16602=$16591$16594);(value$16600=t0$16602);(ph$16599=t0$16602);var $16596$16611;($16596$16611=ph$16599);if($16889(Array)($16596$16611)){return [true,value$16600];}else{$16596$16611;return [true,[value$16600]];}}));(__array_methods$16535=$16908((function(){var accum$16632;(accum$16632=({}));(accum$16632["::check"]=(function(value$16637){if((value$16637 instanceof Array)){var i$16643;(i$16643=0);$16640:for(;(i$16643<this.length);(i$16643++)){if(($16925(this,i$16643)!==$16925(value$16637,i$16643))){return false;}}return true;}else{return false;}}));return accum$16632;})(),$16908((function(){var accum$16652;(accum$16652=({}));(accum$16652["::clone"]=(function(){return $16908(this.slice(0),this);}));return accum$16652;})(),$16908((function(){var accum$16659;(accum$16659=({}));(accum$16659[":::project"]=(function(value$16664){if((value$16664 instanceof Array)){var i$16670;(i$16670=0);$16667:for(;(i$16670<this.length);(i$16670++)){if(($16925(this,i$16670)!==$16925(value$16664,i$16670))){return [true,this.concat([value$16664])];}}return [true,value$16664];}else{return [true,this.concat([value$16664])];}}));return accum$16659;})(),(function(){var accum$16679;(accum$16679=({}));(accum$16679["::serialize_ast"]=(function(){return ["array"].concat(this.map($16926));}));return accum$16679;})()))));var temp$16689;(temp$16689=$16965(__array_methods$16535));var $length$16695;($length$16695=temp$16689.length);var $index$16701;($index$16701=0);$16537:for(;($index$16701<$length$16695);($index$16701++)){var m$16710;(m$16710=temp$16689[$index$16701]);var t0$16715;var t1$16716;var k$16720;var v$16721;(t0$16715=m$16710);if(((t0$16715 instanceof Array)&&(((t1$16716=t0$16715.length)),(t1$16716===2)))){(k$16720=t0$16715[0]);(v$16721=t0$16715[1]);if((!$16925(Array.prototype,k$16720))){Object.defineProperty(Array.prototype,k$16720,({"enumerable":false,"value":v$16721}));}}else{$16982(m$16710);}}(__re_methods$16536=$16908((function(){var accum$16741;(accum$16741=({}));(accum$16741["::check"]=(function($16745$16748){var ph$16753;(ph$16753=$16745$16748);var $16750$16759;($16750$16759=ph$16753);var value$16767;if((typeof($16750$16759)==="string")){(value$16767=$16750$16759);if(value$16767.match(this)){return true;}else{return false;}}else{var other$16772;(other$16772=$16750$16759);return false;}}));return accum$16741;})(),(function(){var accum$16775;(accum$16775=({}));(accum$16775[":::project"]=(function($16779$16782){var ph$16787;(ph$16787=$16779$16782);var $16784$16793;($16784$16793=ph$16787);var value$16801;if((typeof($16784$16793)==="string")){(value$16801=$16784$16793);var $16804$16809;($16804$16809=value$16801.match(this));var m$16817;if(($16804$16809===null)){(m$16817=$16804$16809);return [false,null];}else{var m$16822;(m$16822=$16804$16809);return [true,m$16822];}}else{var other$16826;(other$16826=$16784$16793);return [false,null];}}));return accum$16775;})()));var temp$16832;(temp$16832=$16965(__re_methods$16536));var $length$16838;($length$16838=temp$16832.length);var $index$16844;($index$16844=0);$16540:for(;($index$16844<$length$16838);($index$16844++)){var m$16853;(m$16853=temp$16832[$index$16844]);var t0$16858;var t1$16859;var k$16863;var v$16864;(t0$16858=m$16853);if(((t0$16858 instanceof Array)&&(((t1$16859=t0$16858.length)),(t1$16859===2)))){(k$16863=t0$16858[0]);(v$16864=t0$16858[1]);if((!$16925(RegExp.prototype,k$16863))){Object.defineProperty(RegExp.prototype,k$16863,({"enumerable":false,"value":v$16864}));}}else{$16982(m$16853);}}if((!Function.prototype["::send"])){Object.defineProperty(Function.prototype,"::send",$16908(({"enumerable":false}),(function(){var accum$16882;(accum$16882=({}));(accum$16882["value"]=(function(args$16887){return this.apply(this,args$16887);}));return accum$16882;})()));}
var $21191=(function($21193$21196,key$21197){var ph$21205;(ph$21205=$21193$21196);var $21199$21211;($21199$21211=ph$21205);var bridge$21201$21216;(bridge$21201$21216=$21199$21211);if(((bridge$21201$21216===null)||(bridge$21201$21216===(void 0)))){return false;}else{var x$21228;if((typeof($21199$21211)==="string")){(x$21228=$21199$21211);return (key$21197 in String.prototype);}else{var x$21233;if((typeof($21199$21211)==="number")){(x$21233=$21199$21211);return (key$21197 in Number.prototype);}else{var x$21238;(x$21238=$21199$21211);return (key$21197 in x$21238);}}}});
var $21107=(function($21109$21112){var ph$21122;var x$21123;var t0$21125;(t0$21125=$21109$21112);(x$21123=t0$21125);(ph$21122=t0$21125);var $21114$21134;($21114$21134=ph$21122);var bridge$21116$21139;(bridge$21116$21139=$21114$21134);if(((function(){var bridge$21117$21149;(bridge$21117$21149=bridge$21116$21139);return ((function(){var bridge$21118$21156;(bridge$21118$21156=bridge$21117$21149);return ((bridge$21118$21156===(void 0))||(bridge$21118$21156===null));})()||(typeof(bridge$21117$21149)==="string"));})()||(typeof(bridge$21116$21139)==="number"))){return x$21123;}else{if($21191($21114$21134,"::clone")){$21114$21134["::clone"];return x$21123["::clone"]();}else{$21114$21134;if((Object.getPrototypeOf(x$21123)===Object.prototype)){var dest$21174;(dest$21174=({}));var k$21179;(k$21179=null);$21173:for(k$21179 in x$21123){if(Object.prototype.hasOwnProperty.call(x$21123,k$21179)){(dest$21174[k$21179]=x$21123[k$21179]);}}return dest$21174;}else{var other$21189;(other$21189=$21114$21134);throw $17001(["clone"]).create("Object cannot be cloned",({"obj":x$21123}));}}}});
var $21240=(function(a$21243,b$21244){var dest$21249;(dest$21249=$21107(a$21243));var k$21254;(k$21254=null);$21248:for(k$21254 in b$21244){if(Object.prototype.hasOwnProperty.call(b$21244,k$21254)){(dest$21249[k$21254]=b$21244[k$21254]);}}return dest$21249;});
var $21262=Object.keys;
var $21263=(function(type$21266){return (function(value$21270){var f$21274;(f$21274=type$21266[":::project"]);if((f$21274===(void 0))){(f$21274=type$21266["::project"]);if((f$21274===(void 0))){return [true,type$21266(value$21270)];}else{var rval$21287;(rval$21287=false);try{(rval$21287=[true,f$21274(value$21270)]);}catch(excv$21298){var e$21304;(e$21304=excv$21298);(rval$21287=[false,null]);}return rval$21287;}}else{return f$21274.call(type$21266,value$21270);}});});
var $21310=(function(xs$21313,ys$21314){var acc$21321;(acc$21321=[]);var temp$21327;(temp$21327=$17234(xs$21313));var $length$21333;($length$21333=temp$21327.length);var $index$21339;($index$21339=0);$21316:for(;($index$21339<$length$21333);($index$21339++)){var m$21348;(m$21348=temp$21327[$index$21339]);var t0$21353;var t1$21354;var i$21358;var x$21359;(t0$21353=m$21348);if(((t0$21353 instanceof Array)&&(((t1$21354=t0$21353.length)),(t1$21354===2)))){(i$21358=t0$21353[0]);(x$21359=t0$21353[1]);acc$21321.push([x$21359,$16925(ys$21314,i$21358)]);}else{$16982(m$21348);}}return acc$21321;});
var $21374=(function(from$21377,to$21378){var rval$21383;(rval$21383=[]);var i$21389;(i$21389=from$21377);$21382:for(;(i$21389<=to$21378);(i$21389++)){rval$21383.push(i$21389);}return rval$21383;});var accum$18255;var accum$18259;var accum$19044;var accum$19048;var $17262$17297;var __lt____gt__$17298;var $17263$17299;var __lt____lt____colon__$17300;var util$17301;var GenSym$17302;var gensym$17303;var neighbours$17304;var classify$17305;var classify_contiguous$17306;var identity$17307;var Body$17308;var $17265$17309;var checker_db$17310;var PatternParser$17311;var PatternProcessor$17312;var assemble_conditions$17313;var assemble_pattern$17314;var inject_below_uses$17315;var parse_pattern$17316;var checkall$17317;var same_block$17318;var parse_clauses$17319;var opt_clauses$17320;var weave_clauses$17321;($17262$17297=require("./pp"));(__lt____gt__$17298=$17262$17297["<>"]);($17263$17299=require("./location"));(__lt____lt____colon__$17300=$17263$17299["<<:"]);(util$17301=require("./util"));(GenSym$17302=util$17301.GenSym);(gensym$17303=util$17301.gensym);(neighbours$17304=util$17301.neighbours);(classify$17305=util$17301.classify);(classify_contiguous$17306=util$17301.classify_contiguous);(identity$17307=util$17301.identity);(Body$17308=util$17301.Body);($17265$17309=require("./expand"));(checker_db$17310=$17265$17309.checker_db);(PatternParser$17311=(function(scope$17368,pattern$17369,opt$17370){var tags$17386;var it$0$17373;(it$0$17373=(function(){if((!$16889(PatternParser$17311)(this))){return Object.create(PatternParser$17311.prototype);}else{return this;}})());(it$0$17373["opt"]=opt$17370);(it$0$17373["arguments"]=[]);(it$0$17373["vars"]=[]);(it$0$17373["specials"]=({}));(tags$17386=$21107((opt$17370.tags||({}))));(tags$17386["group_id"]=(tags$17386.group_id||gensym$17303("group")));(it$0$17373["pattern"]=it$0$17373.expand(scope$17368,pattern$17369,tags$17386,true,it$0$17373.opt.indexable));return it$0$17373;}));(PatternParser$17311.prototype["parse_specs"]=(function(scope$17410,specs$17411,tags$17412){var $index$17473;var $length$17467;var temp$17461;var acc$17455;var rest$17430;var has_defaults$17431;var rval$17432;var it$0$17416;var self$17417;(it$0$17416=this);(self$17417=this);(rest$17430=(void 0));(has_defaults$17431=false);(rval$17432=classify$17305("fw","bw","keys","defaults",(((acc$17455=[])),(((temp$17461=scope$17410.step_all(["pattern"],specs$17411))),((($length$17467=temp$17461.length)),((($index$17473=0)),(function(){$17441:for(;($index$17473<$length$17467);($index$17473++)){var v$17547;var v$17541;var variable$17529;var value$17530;var key$17522;var subp$17523;var key$17516;var variable$17496;var $17449$17490;var $17450$17491;var $17451$17492;var $17452$17493;var t0$17487;var t1$17488;var m$17482;(m$17482=temp$17461[$index$17473]);(t0$17487=m$17482);if((($17450$17491=(t0$17487 instanceof Array))&&(((t1$17488=t0$17487.length)),(($17452$17493=(t1$17488===2))&&(t0$17487[0]==="dynsplice"))))){(variable$17496=t0$17487[1]);acc$17455.push((((rest$17430=it$0$17416.expand(scope$17410,variable$17496,tags$17412))),["ignore"]));}else{if(($17452$17493&&(t0$17487[0]==="assoc"))){(key$17516=t0$17487[1]);acc$17455.push(["keys",[key$17516,it$0$17416.expand(scope$17410,key$17516,tags$17412)]]);}else{if(($17450$17491&&(($17452$17493=(t1$17488===3))&&(t0$17487[0]==="assoc")))){(key$17522=t0$17487[1]);(subp$17523=t0$17487[2]);acc$17455.push(["keys",[key$17522,it$0$17416.expand(scope$17410,subp$17523,tags$17412)]]);}else{if(($17452$17493&&(t0$17487[0]==="default"))){(variable$17529=t0$17487[1]);(value$17530=t0$17487[2]);acc$17455.push((((has_defaults$17431=true)),(function(){if(rest$17430){throw $17001(["syntax","pattern"]).create("No default arguments after rest arg.");}else{return ["defaults",[it$0$17416.expand(scope$17410,variable$17529,tags$17412),value$17530]];}})()));}else{(v$17541=m$17482);if(((rest$17430===(void 0))&&(!has_defaults$17431))){acc$17455.push(["fw",it$0$17416.expand(scope$17410,v$17541,tags$17412)]);}else{(v$17547=m$17482);acc$17455.push(["bw",it$0$17416.expand(scope$17410,v$17547,tags$17412)]);}}}}}}})()))),acc$17455)));(rval$17432["rest"]=rest$17430);return rval$17432;}));(PatternParser$17311.prototype["expand"]=(function(){var x$17647;var x$17657;var x$17686;var x$17692;var variable$17699;var variable$17716;var x$17756;var msg$17764;var msg$17780;var $index$17822;var $length$17816;var temp$17810;var acc$17804;var $index$17955;var $length$17949;var temp$17943;var acc$17937;var $index$17991;var $length$17985;var temp$17979;var t0$18066;var t1$18067;var t2$18068;var $index$18114;var $length$18108;var temp$18102;var acc$18096;var patts$18088;var canon$17852;var normalize$17853;var pps$17854;var vars$17855;var patt$18189;var msg$18235;var other$18231;var keys$18195;var fw$18168;var bw$18169;var defaults$18170;var rest$18171;var $18146$18165;var t0$18158;var t1$18159;var t2$18160;var t3$18161;var t4$18162;var t5$18163;var $18142$18153;var specs$18147;var other$18247;var mode$18241;var subp$18242;var args$18137;var xs$17844;var xs$17796;var x$17786;var f$17770;var arg$17771;var f$17745;var arguments$17746;var checker$17739;var subp$17740;var projector$17733;var subp$17734;var condition$17727;var subp$17728;var v$17722;var v$17705;var type$17664;var $17623$17638;var $17624$17639;var $17625$17640;var $17626$17641;var t0$17634;var bridge$17608$17635;var t1$17636;var $17603$17629;var expr$17596;var rval$17597;var scope$17582;var pattern$17583;var tags$17584;var toplevel$17585;var checked$17586;var t0$17578;var $17561$17573;var it$0$17563;var self$17564;(it$0$17563=this);(self$17564=this);($17561$17573=arguments);(t0$17578=$17561$17573.length);if(((t0$17578>=3)&&(t0$17578<=5))){(scope$17582=$17561$17573[0]);(pattern$17583=$17561$17573[1]);(tags$17584=$17561$17573[2]);(toplevel$17585=(function(){if((3>=t0$17578)){return false;}else{return $17561$17573[3];}})());(checked$17586=(function(){if((4>=t0$17578)){return false;}else{return $17561$17573[4];}})());(expr$17596=scope$17582.step(["pattern"],pattern$17583));(rval$17597=((($17603$17629=expr$17596)),(function(){if((((x$17647=$17603$17629)),((x$17647 instanceof Array)&&(x$17647[0]==="void")))){return ["check",checker_db$17310.null,["ignore"]];}else{if((((x$17657=$17603$17629)),((x$17657 instanceof Array)&&(x$17657[0]==="ignore")))){return expr$17596;}else{if((($17603$17629 instanceof Array)&&(((t0$17634=$17603$17629.length)),((t0$17634===2)&&($17603$17629[0]==="special"))))){(type$17664=$17603$17629[1]);(it$0$17563.specials[type$17664]=true);return expr$17596;}else{(bridge$17608$17635=$17603$17629);if(((((x$17686=bridge$17608$17635)),((x$17686 instanceof Array)&&(x$17686[0]==="symbol")))||(((x$17692=bridge$17608$17635)),((x$17692 instanceof Array)&&(x$17692[0]==="variable"))))){(variable$17699=$21240(expr$17596,tags$17584));it$0$17563.vars.push(variable$17699);return ["assign",variable$17699];}else{if((($17623$17638=($17603$17629 instanceof Array))&&(((t0$17634=$17603$17629.length)),(($17625$17640=(t0$17634===2))&&(($17626$17641=($17603$17629[0]==="value"))&&((v$17705=$17603$17629[1]),it$0$17563.opt.strings_as_variables)))))){(variable$17716=__lt____lt____colon__$17300($21240(["symbol",v$17705],tags$17584),expr$17596));it$0$17563.vars.push(variable$17716);return ["assign",variable$17716];}else{if($17626$17641){(v$17722=$17603$17629[1]);return ["check",checker_db$17310(v$17722),["ignore"]];}else{if(($17623$17638&&(($17625$17640=(t0$17634===3))&&($17603$17629[0]==="test")))){(condition$17727=$17603$17629[1]);(subp$17728=$17603$17629[2]);return ["test",condition$17727,it$0$17563.expand(scope$17582,subp$17728,tags$17584,toplevel$17585,false)];}else{if(($17625$17640&&($17603$17629[0]==="project"))){(projector$17733=$17603$17629[1]);(subp$17734=$17603$17629[2]);return ["project",projector$17733,it$0$17563.expand(scope$17582,subp$17734,tags$17584,toplevel$17585,true)];}else{if(($17625$17640&&($17603$17629[0]==="check"))){(checker$17739=$17603$17629[1]);(subp$17740=$17603$17629[2]);return ["check",checker$17739,it$0$17563.expand(scope$17582,subp$17740,tags$17584,toplevel$17585,true)];}else{if(($17625$17640&&(($17626$17641=($17603$17629[0]==="send"))&&((f$17745=$17603$17629[1]),(((t1$17636=$17603$17629[2])),(((x$17756=t1$17636)),((x$17756 instanceof Array)&&(x$17756[0]==="data")))))))){(arguments$17746=t1$17636);if(toplevel$17585){it$0$17563.arguments.unshift(arguments$17746);return it$0$17563.expand(scope$17582,f$17745,tags$17584,true,false);}else{(msg$17764="Function arguments can only be declared as a top level pattern.");throw $17001(["syntax","pattern"]).create(msg$17764,({"node":expr$17596,"arg":arguments$17746}));}}else{if($17626$17641){(f$17770=$17603$17629[1]);(arg$17771=$17603$17629[2]);return ["assign",expr$17596];}else{$17603$17629;if((!it$0$17563.opt.allow_nested)){(msg$17780="Nested patterns are not allowed here.");throw $17001(["syntax","pattern"]).create(msg$17780,({"node":expr$17596}));}else{if((($17623$17638=($17603$17629 instanceof Array))&&(((t0$17634=$17603$17629.length)),((t0$17634===2)&&($17603$17629[0]==="neg"))))){(x$17786=$17603$17629[1]);return ["neg",it$0$17563.expand(scope$17582,x$17786,tags$17584)];}else{if(($17623$17638&&(($17625$17640=(t0$17634>=1))&&($17603$17629[0]==="all")))){(xs$17796=Array.prototype.slice.call($17603$17629,1));return ["all"].concat((((acc$17804=[])),(((temp$17810=xs$17796)),((($length$17816=temp$17810.length)),((($index$17822=0)),(function(){$17799:for(;($index$17822<$length$17816);($index$17822++)){var x$17839;var m$17831;(m$17831=temp$17810[$index$17822]);(x$17839=m$17831);acc$17804.push(it$0$17563.expand(scope$17582,x$17839,tags$17584));}})()))),acc$17804));}else{if(($17625$17640&&($17603$17629[0]==="any"))){(xs$17844=Array.prototype.slice.call($17603$17629,1));(canon$17852=(function(all$17863){return all$17863.sort().join(",");}));(normalize$17853=(function(vars$17870){var $index$17895;var $length$17889;var temp$17883;var acc$17877;return canon$17852((((acc$17877=[])),(((temp$17883=vars$17870)),((($length$17889=temp$17883.length)),((($index$17895=0)),(function(){$17872:for(;($index$17895<$length$17889);($index$17895++)){var v$17914;var t0$17909;var t1$17910;var m$17904;(m$17904=temp$17883[$index$17895]);(t0$17909=m$17904);if(((t0$17909 instanceof Array)&&(((t1$17910=t0$17909.length)),((t1$17910===2)&&(t0$17909[0]==="symbol"))))){(v$17914=t0$17909[1]);acc$17877.push(v$17914);}else{$16982(m$17904,"/home/olivier/git/earl-grey/src/pattern.eg",3875,3913);}}})()))),acc$17877));}));(pps$17854=(((acc$17937=[])),(((temp$17943=xs$17844)),((($length$17949=temp$17943.length)),((($index$17955=0)),(function(){$17932:for(;($index$17955<$length$17949);($index$17955++)){var x$17972;var m$17964;(m$17964=temp$17943[$index$17955]);(x$17972=m$17964);acc$17937.push(PatternParser$17311(scope$17582,x$17972,$21240(it$0$17563.opt,({"tags":tags$17584}))));}})()))),acc$17937));(temp$17979=neighbours$17304(pps$17854));($length$17985=temp$17979.length);($index$17991=0);$17856:for(;($index$17991<$length$17985);($index$17991++)){var $index$18042;var $length$18036;var temp$18030;var pp1$18010;var pp2$18011;var t0$18005;var t1$18006;var m$18000;(m$18000=temp$17979[$index$17991]);(t0$18005=m$18000);if(((t0$18005 instanceof Array)&&(((t1$18006=t0$18005.length)),(t1$18006===2)))){(pp1$18010=t0$18005[0]);(pp2$18011=t0$18005[1]);(temp$18030=pps$17854);($length$18036=temp$18030.length);($index$18042=0);$18024:for(;($index$18042<$length$18036);($index$18042++)){var pp$18059;var m$18051;(m$18051=temp$18030[$index$18042]);(pp$18059=m$18051);normalize$17853(pp$18059.vars);}if((normalize$17853(pp1$18010.vars)!==normalize$17853(pp2$18011.vars))){throw $17001(["syntax","pattern"]).create("Both branches of 'or' must contain the same variables",({"vars1":__lt____lt____colon__$17300(pp1$18010.vars.sort(),pp1$18010.pattern),"vars2":__lt____lt____colon__$17300(pp2$18011.vars.sort(),pp2$18011.pattern)}));}if((canon$17852($21262(pp1$18010.specials))!==canon$17852($21262(pp2$18011.specials)))){throw $17001(["syntax","pattern"]).create("Both branches of 'or' must contain the same special tokens",({"special1":__lt____lt____colon__$17300($21262(pp1$18010.specials).sort(),pp1$18010.pattern),"special2":__lt____lt____colon__$17300($21262(pp2$18011.specials).sort(),pp2$18011.pattern)}));}}else{$16982(m$18000,"/home/olivier/git/earl-grey/src/pattern.eg",4005,4802);}}(t0$18066=pps$17854);if(((t0$18066 instanceof Array)&&(((t1$18067=t0$18066.length)),((t1$18067>=1)&&(((t2$18068=t0$18066[0])),$21191(t2$18068,"vars")))))){(vars$17855=t2$18068.vars);Array.prototype.slice.call(t0$18066,1);}else{$16982(pps$17854,"/home/olivier/git/earl-grey/src/pattern.eg",4819,4822);}(it$0$17563["vars"]=it$0$17563.vars.concat(vars$17855));(patts$18088=(((acc$18096=[])),(((temp$18102=pps$17854)),((($length$18108=temp$18102.length)),((($index$18114=0)),(function(){$18091:for(;($index$18114<$length$18108);($index$18114++)){var pp$18131;var m$18123;(m$18123=temp$18102[$index$18114]);(pp$18131=m$18123);acc$18096.push(pp$18131.pattern);}})()))),acc$18096));return ["any"].concat(patts$18088);}else{if(($17625$17640&&($17603$17629[0]==="data"))){(args$18137=Array.prototype.slice.call($17603$17629,1));(specs$18147=it$0$17563.parse_specs(scope$17582,args$18137,tags$17584));($18142$18153=specs$18147);if((($18146$18165=$21191($18142$18153,"keys"))&&(((t0$18158=$18142$18153.keys)),((t0$18158 instanceof Array)&&(((t1$18159=t0$18158.length)),((t1$18159===0)&&($21191($18142$18153,"fw")&&((fw$18168=$18142$18153.fw),($21191($18142$18153,"bw")&&((bw$18169=$18142$18153.bw),($21191($18142$18153,"defaults")&&((defaults$18170=$18142$18153.defaults),$21191($18142$18153,"rest"))))))))))))){(rest$18171=$18142$18153.rest);(patt$18189=__lt____lt____colon__$17300(["array_pattern",fw$18168,bw$18169,defaults$18170,rest$18171],pattern$17583));if(checked$17586){return patt$18189;}else{return ["check",checker_db$17310.Array,patt$18189];}}else{if(($18146$18165&&((keys$18195=$18142$18153.keys),($21191($18142$18153,"fw")&&(((t0$18158=$18142$18153.fw)),((t0$18158 instanceof Array)&&(((t1$18159=t0$18158.length)),((t1$18159===0)&&($21191($18142$18153,"bw")&&(((t2$18160=$18142$18153.bw)),((t2$18160 instanceof Array)&&(((t3$18161=t2$18160.length)),((t3$18161===0)&&($21191($18142$18153,"defaults")&&(((t4$18162=$18142$18153.defaults)),((t4$18162 instanceof Array)&&(((t5$18163=t4$18162.length)),((t5$18163===0)&&($21191($18142$18153,"rest")&&($18142$18153.rest===(void 0))))))))))))))))))))){return ["object_pattern"].concat(keys$18195);}else{(other$18231=$18142$18153);(msg$18235="Pattern must be an array or an object.");throw $17001(["syntax","pattern"]).create(msg$18235,({"node":expr$17596,"specs":specs$18147}));}}}else{if(($17623$17638&&((t0$17634===3)&&($17603$17629[0]==="mode")))){(mode$18241=$17603$17629[1]);(subp$18242=$17603$17629[2]);return it$0$17563.expand(scope$17582,subp$18242,$21240(tags$17584,({"declare_mode":mode$18241})),toplevel$17585,checked$17586);}else{(other$18247=$17603$17629);throw $17001(["syntax","pattern"]).create("Illegal pattern",({"node":other$18247}));}}}}}}}}}}}}}}}}}})()));return (it$0$17563.opt.wrap_pattern||identity$17307)(__lt____lt____colon__$17300(rval$17597,pattern$17583),toplevel$17585);}else{$16982($17561$17573);}}));$16908(PatternParser$17311,$16908(((accum$18255=({})),((accum$18255["::name"]="PatternParser"),accum$18255)),((accum$18259=({})),((accum$18259["::egclass"]=true),accum$18259))));PatternParser$17311;(PatternProcessor$17312=(function(){var it$0$18268;(it$0$18268=(function(){if((!$16889(PatternProcessor$17312)(this))){return Object.create(PatternProcessor$17312.prototype);}else{return this;}})());(it$0$18268["temps"]=[]);(it$0$18268["parts"]=[]);(it$0$18268["gen"]=GenSym$17302("t"));return it$0$18268;}));(PatternProcessor$17312.prototype["do"]=(function(part$18292){var it$0$18296;var self$18297;(it$0$18296=this);(self$18297=this);return it$0$18296.parts.push(["do",part$18292]);}));(PatternProcessor$17312.prototype["check"]=(function(){var part$18333;var tags$18334;var t0$18329;var $18312$18324;var it$0$18314;var self$18315;(it$0$18314=this);(self$18315=this);($18312$18324=arguments);(t0$18329=$18312$18324.length);if(((t0$18329>=1)&&(t0$18329<=2))){(part$18333=$18312$18324[0]);(tags$18334=(function(){if((1>=t0$18329)){return ({});}else{return $18312$18324[1];}})());return it$0$18314.parts.push($21240(["check",part$18333],tags$18334));}else{$16982($18312$18324);}}));(PatternProcessor$17312.prototype["temp"]=(function(){var x$18401;var x$18407;var init$18414;var bridge$18381$18390;var $18379$18385;var x$18371;var v$18372;var t0$18367;var $18350$18362;var it$0$18352;var self$18353;(it$0$18352=this);(self$18353=this);($18350$18362=arguments);(t0$18367=$18350$18362.length);if(((t0$18367>=1)&&(t0$18367<=2))){(x$18371=$18350$18362[0]);(v$18372=(function(){if((1>=t0$18367)){return null;}else{return $18350$18362[1];}})());($18379$18385=x$18371);(bridge$18381$18390=$18379$18385);if((((((x$18401=bridge$18381$18390)),((x$18401 instanceof Array)&&(x$18401[0]==="variable")))||(((x$18407=bridge$18381$18390)),((x$18407 instanceof Array)&&(x$18407[0]==="symbol"))))&&($21191($18379$18385,"single_assignment")&&($18379$18385.single_assignment&&(!v$18372))))){return x$18371;}else{(init$18414=$18379$18385);(v$18372=(v$18372||["symbol",it$0$18352.gen()]));(v$18372["single_assignment"]=true);it$0$18352.temps.push(v$18372);it$0$18352.do(["send",["symbol","="],["data",["send",["symbol","set"],v$18372],init$18414]]);return v$18372;}}else{$16982($18350$18362);}}));(PatternProcessor$17312.prototype["process"]=(function(pattern$18431,rhs$18432,fns$18433){var x$18486;var x$18520;var t$18533;var t$18545;var pp$18556;var $index$18589;var $length$18583;var temp$18577;var t$18567;var $index$18657;var $length$18651;var temp$18645;var acc$18639;var fn$18622;var parts$18623;var t$18615;var $index$18718;var $length$18712;var temp$18706;var acc$18700;var t$18691;var otherwise$18851;var $18829$18835;var $index$18868;var $length$18862;var temp$18856;var $index$18917;var $length$18911;var temp$18905;var end$18979;var pos$18973;var $index$19003;var $length$18997;var temp$18991;var acc$18985;var nfw$18784;var nbw$18785;var ndflt$18786;var extract_length$18787;var check_length$18788;var lo$18789;var hi$18790;var t$18791;var len$18792;var fw$18768;var bw$18769;var dflt$18770;var rest$18771;var subp$18686;var xs$18610;var xs$18562;var patt$18551;var projector$18539;var subp$18540;var checker$18527;var subp$18528;var checker$18515;var condition$18508;var subp$18509;var kind$18503;var sym$18493;var $18464$18477;var $18465$18478;var $18466$18479;var $18467$18480;var t0$18475;var $18451$18470;var rval$18448;var it$0$18437;var self$18438;(it$0$18437=this);(self$18438=this);(rval$18448=((($18451$18470=pattern$18431)),(function(){if((((x$18486=$18451$18470)),((x$18486 instanceof Array)&&(x$18486[0]==="ignore")))){return it$0$18437.do(rhs$18432);}else{if((($18464$18477=($18451$18470 instanceof Array))&&(((t0$18475=$18451$18470.length)),(($18466$18479=(t0$18475===2))&&($18451$18470[0]==="assign"))))){(sym$18493=$18451$18470[1]);return it$0$18437.parts.push(fns$18433.assign(sym$18493,rhs$18432));}else{if(($18466$18479&&($18451$18470[0]==="special"))){(kind$18503=$18451$18470[1]);return it$0$18437.process(fns$18433.special(pattern$18431,rhs$18432),rhs$18432,fns$18433);}else{if(($18464$18477&&(($18466$18479=(t0$18475===3))&&($18451$18470[0]==="test")))){(condition$18508=$18451$18470[1]);(subp$18509=$18451$18470[2]);it$0$18437.process(subp$18509,rhs$18432,fns$18433);return it$0$18437.check(condition$18508,({"test":true}));}else{if(($18466$18479&&(($18467$18480=($18451$18470[0]==="check"))&&((checker$18515=$18451$18470[1]),(((x$18520=$18451$18470[2])),((x$18520 instanceof Array)&&(x$18520[0]==="ignore"))))))){return it$0$18437.check(["send",checker$18515,["data",rhs$18432]]);}else{if($18467$18480){(checker$18527=$18451$18470[1]);(subp$18528=$18451$18470[2]);(t$18533=it$0$18437.temp(rhs$18432));it$0$18437.check(["send",checker$18527,["data",t$18533]]);return it$0$18437.process(subp$18528,t$18533,fns$18433);}else{if(($18466$18479&&($18451$18470[0]==="project"))){(projector$18539=$18451$18470[1]);(subp$18540=$18451$18470[2]);(t$18545=it$0$18437.temp(["send",projector$18539,["data",rhs$18432]]));it$0$18437.check(["send",t$18545,["value",0]]);return it$0$18437.process(subp$18540,["send",t$18545,["value",1]],fns$18433);}else{if(($18464$18477&&((t0$18475===2)&&($18451$18470[0]==="neg")))){(patt$18551=$18451$18470[1]);return it$0$18437.check(["send",["symbol","not"],["data",["void"],(((pp$18556=PatternProcessor$17312())),pp$18556.process(patt$18551,rhs$18432,fns$18433),assemble_conditions$17313(pp$18556))]]);}else{if(($18464$18477&&(($18466$18479=(t0$18475>=1))&&($18451$18470[0]==="all")))){(xs$18562=Array.prototype.slice.call($18451$18470,1));(t$18567=it$0$18437.temp(rhs$18432));(temp$18577=xs$18562);($length$18583=temp$18577.length);($index$18589=0);$18568:for(;($index$18589<$length$18583);($index$18589++)){var x$18606;var m$18598;(m$18598=temp$18577[$index$18589]);(x$18606=m$18598);it$0$18437.process(x$18606,t$18567,fns$18433);}return null;}else{if(($18466$18479&&($18451$18470[0]==="any"))){(xs$18610=Array.prototype.slice.call($18451$18470,1));(t$18615=it$0$18437.temp(rhs$18432,["symbol",gensym$17303("bridge")]));return it$0$18437.check((((fn$18622=(function(x$18628,rest$18629){return ["send",["symbol","or"],["data",x$18628,rest$18629]];}))),((parts$18623=(((acc$18639=[])),(((temp$18645=xs$18610)),((($length$18651=temp$18645.length)),((($index$18657=0)),(function(){$18634:for(;($index$18657<$length$18651);($index$18657++)){var pp$18679;var x$18674;var m$18666;(m$18666=temp$18645[$index$18657]);(x$18674=m$18666);acc$18639.push((((pp$18679=PatternProcessor$17312())),pp$18679.process(x$18674,t$18615,fns$18433),assemble_conditions$17313(pp$18679)));}})()))),acc$18639))),util$17301.construct(parts$18623,fn$18622,["symbol","false"])));}else{if(($18466$18479&&($18451$18470[0]==="object_pattern"))){(subp$18686=Array.prototype.slice.call($18451$18470,1));(t$18691=it$0$18437.temp(rhs$18432));(acc$18700=[]);(temp$18706=subp$18686);($length$18712=temp$18706.length);($index$18718=0);$18692:for(;($index$18718<$length$18712);($index$18718++)){var k$18739;var v$18740;var t0$18732;var t1$18733;var t2$18734;var t3$18735;var m$18727;(m$18727=temp$18706[$index$18718]);(t0$18732=m$18727);if(((t0$18732 instanceof Array)&&(((t1$18733=t0$18732.length)),((t1$18733===2)&&(((t2$18734=t0$18732[0])),((t2$18734 instanceof Array)&&(((t3$18735=t2$18734.length)),((t3$18735===2)&&(t2$18734[0]==="value"))))))))){(k$18739=t2$18734[1]);(v$18740=t0$18732[1]);acc$18700.push((it$0$18437.check(["send",["symbol","___hasprop"],["data",t$18691,["value",k$18739]]]),it$0$18437.process(v$18740,["send",t$18691,["value",k$18739]],fns$18433)));}else{$16982(m$18727,"/home/olivier/git/earl-grey/src/pattern.eg",8151,8283);}}return acc$18700;}else{if(($18464$18477&&((t0$18475===5)&&($18451$18470[0]==="array_pattern")))){(fw$18768=$18451$18470[1]);(bw$18769=$18451$18470[2]);(dflt$18770=$18451$18470[3]);(rest$18771=$18451$18470[4]);(nfw$18784=fw$18768.length);(nbw$18785=bw$18769.length);(ndflt$18786=dflt$18770.length);(extract_length$18787=true);(check_length$18788=true);(lo$18789=(nfw$18784+nbw$18785));(hi$18790=(lo$18789+ndflt$18786));(t$18791=it$0$18437.temp(rhs$18432));(len$18792=it$0$18437.temp(["send",t$18791,["send",["symbol","."],["data",["void"],["symbol","length"]]]]));it$0$18437.check(((($18829$18835=rest$18771)),(function(){if($18829$18835){return ["send",["symbol",">="],["data",len$18792,["value",lo$18789]]];}else{$18829$18835;if((lo$18789===hi$18790)){return ["send",["symbol","==="],["data",len$18792,["value",lo$18789]]];}else{(otherwise$18851=$18829$18835);return ["send",["symbol","and"],["data",["send",["symbol",">="],["data",len$18792,["value",lo$18789]]],["send",["symbol","<="],["data",len$18792,["value",hi$18790]]]]];}}})()));(temp$18856=$17234(fw$18768));($length$18862=temp$18856.length);($index$18868=0);$18793:for(;($index$18868<$length$18862);($index$18868++)){var i$18887;var m$18888;var t0$18882;var t1$18883;var m$18877;(m$18877=temp$18856[$index$18868]);(t0$18882=m$18877);if(((t0$18882 instanceof Array)&&(((t1$18883=t0$18882.length)),(t1$18883===2)))){(i$18887=t0$18882[0]);(m$18888=t0$18882[1]);it$0$18437.process(m$18888,["send",t$18791,["value",i$18887]],fns$18433);}else{$16982(m$18877,"/home/olivier/git/earl-grey/src/pattern.eg",9015,9101);}}(temp$18905=$17234(dflt$18770));($length$18911=temp$18905.length);($index$18917=0);$18796:for(;($index$18917<$length$18911);($index$18917++)){var idx$18965;var i$18938;var patt$18939;var value$18940;var t0$18931;var t1$18932;var t2$18933;var t3$18934;var m$18926;(m$18926=temp$18905[$index$18917]);(t0$18931=m$18926);if(((t0$18931 instanceof Array)&&(((t1$18932=t0$18931.length)),((t1$18932===2)&&((i$18938=t0$18931[0]),(((t2$18933=t0$18931[1])),((t2$18933 instanceof Array)&&(((t3$18934=t2$18933.length)),(t3$18934===2))))))))){(patt$18939=t2$18933[0]);(value$18940=t2$18933[1]);(idx$18965=(i$18938+nfw$18784));it$0$18437.process(patt$18939,["send",["symbol","if"],["data",["send",["symbol",">="],["data",["value",(idx$18965+nbw$18785)],len$18792]],value$18940,["send",t$18791,["value",idx$18965]]]],fns$18433);}else{$16982(m$18926,"/home/olivier/git/earl-grey/src/pattern.eg",9101,9270);}}if((rest$18771!==(void 0))){(pos$18973=(nfw$18784+ndflt$18786));(end$18979=(function(){if((nbw$18785>0)){return [["value",(-nbw$18785)]];}else{return [];}})());it$0$18437.process(rest$18771,["send",["send",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",t$18791,["value",pos$18973]].concat(end$18979)],fns$18433);}else{[];}(acc$18985=[]);(temp$18991=$17234(bw$18769));($length$18997=temp$18991.length);($index$19003=0);$18799:for(;($index$19003<$length$18997);($index$19003++)){var i$19022;var m$19023;var t0$19017;var t1$19018;var m$19012;(m$19012=temp$18991[$index$19003]);(t0$19017=m$19012);if(((t0$19017 instanceof Array)&&(((t1$19018=t0$19017.length)),(t1$19018===2)))){(i$19022=t0$19017[0]);(m$19023=t0$19017[1]);acc$18985.push(it$0$18437.process(m$19023,["send",["symbol","___js_fetch"],["data",t$18791,["send",["symbol","-"],["data",len$18792,["value",(nbw$18785-i$19022)]]]]],fns$18433));}else{$16982(m$19012,"/home/olivier/git/earl-grey/src/pattern.eg",9721,9872);}}return acc$18985;}else{$16982($18451$18470);}}}}}}}}}}}}})()));return rval$18448;}));$16908(PatternProcessor$17312,$16908(((accum$19044=({})),((accum$19044["::name"]="PatternProcessor"),accum$19044)),((accum$19048=({})),((accum$19048["::egclass"]=true),accum$19048))));PatternProcessor$17312;(assemble_conditions$17313=(function(pp$19055){var $index$19179;var $length$19173;var temp$19167;var acc$19161;var decls$19153;var construct$19059;(construct$19059=(function($19063$19066){var x$19134;var rest$19135;var x$19119;var x$19103;var rest$19104;var $19073$19090;var $19074$19091;var t0$19086;var t1$19087;var t2$19088;var $19068$19081;var ph$19075;(ph$19075=$19063$19066);($19068$19081=ph$19075);if((($19073$19090=($19068$19081 instanceof Array))&&(((t0$19086=$19068$19081.length)),(t0$19086===0)))){return ["value",true];}else{if(($19073$19090&&((t0$19086>=1)&&(((t1$19087=$19068$19081[0])),((t1$19087 instanceof Array)&&(((t2$19088=t1$19087.length)),((t2$19088===2)&&(t1$19087[0]==="do")))))))){(x$19103=t1$19087[1]);(rest$19104=Array.prototype.slice.call($19068$19081,1));return ["multi",x$19103,construct$19059(rest$19104)];}else{if(($19073$19090&&((t0$19086===1)&&(((t1$19087=$19068$19081[0])),((t1$19087 instanceof Array)&&(((t2$19088=t1$19087.length)),((t2$19088===2)&&(t1$19087[0]==="check")))))))){(x$19119=t1$19087[1]);return x$19119;}else{if(($19073$19090&&((t0$19086>=1)&&(((t1$19087=$19068$19081[0])),((t1$19087 instanceof Array)&&(((t2$19088=t1$19087.length)),((t2$19088===2)&&(t1$19087[0]==="check")))))))){(x$19134=t1$19087[1]);(rest$19135=Array.prototype.slice.call($19068$19081,1));return ["send",["symbol","and"],["data",x$19134,construct$19059(rest$19135)]];}else{$16982($19068$19081);}}}}}));if(pp$19055.temps.length){(decls$19153=(((acc$19161=[])),(((temp$19167=pp$19055.temps)),((($length$19173=temp$19167.length)),((($index$19179=0)),(function(){$19156:for(;($index$19179<$length$19173);($index$19179++)){var t$19196;var m$19188;(m$19188=temp$19167[$index$19179]);(t$19196=m$19188);acc$19161.push(["declare",t$19196]);}})()))),acc$19161));return ["multi"].concat(decls$19153).concat([construct$19059(pp$19055.parts)]);}else{return construct$19059(pp$19055.parts);}}));(assemble_pattern$17314=(function(){var $index$19268;var $length$19262;var temp$19256;var $index$19329;var $length$19323;var temp$19317;var test$19468;var lead$19231;var trail$19232;var construct$19233;var parts$19218;var t$19219;var f$19220;var t0$19214;var $19205$19209;($19205$19209=arguments);(t0$19214=$19205$19209.length);if(((t0$19214>=2)&&(t0$19214<=3))){(parts$19218=$19205$19209[0]);(t$19219=$19205$19209[1]);(f$19220=(function(){if((2>=t0$19214)){return null;}else{return $19205$19209[2];}})());(lead$19231=[]);(temp$19256=parts$19218.slice(0));($length$19262=temp$19256.length);($index$19268=0);$19234:for(;($index$19268<$length$19262);($index$19268++)){var x$19306;var x$19291;var $19238$19285;var $19239$19286;var $19240$19287;var $19241$19288;var t0$19282;var t1$19283;var m$19277;(m$19277=temp$19256[$index$19268]);(t0$19282=m$19277);if((($19239$19286=(t0$19282 instanceof Array))&&(((t1$19283=t0$19282.length)),(($19241$19288=(t1$19283===2))&&(t0$19282[0]==="do"))))){(x$19291=t0$19282[1]);lead$19231.push(x$19291);parts$19218.shift();}else{if(($19241$19288&&(t0$19282[0]==="check"))){(x$19306=t0$19282[1]);break $19234;}else{$16982(m$19277,"/home/olivier/git/earl-grey/src/pattern.eg",10333,10443);}}}(trail$19232=[]);(temp$19317=parts$19218.slice(0).reverse());($length$19323=temp$19317.length);($index$19329=0);$19242:for(;($index$19329<$length$19323);($index$19329++)){var x$19367;var x$19352;var $19246$19346;var $19247$19347;var $19248$19348;var $19249$19349;var t0$19343;var t1$19344;var m$19338;(m$19338=temp$19317[$index$19329]);(t0$19343=m$19338);if((($19247$19347=(t0$19343 instanceof Array))&&(((t1$19344=t0$19343.length)),(($19249$19349=(t1$19344===2))&&(t0$19343[0]==="do"))))){(x$19352=t0$19343[1]);trail$19232.unshift(x$19352);parts$19218.pop();}else{if(($19249$19349&&(t0$19343[0]==="check"))){(x$19367=t0$19343[1]);break $19242;}else{$16982(m$19338,"/home/olivier/git/earl-grey/src/pattern.eg",10457,10579);}}}(construct$19233=(function($19375$19378){var other$19463;var x$19447;var rest$19448;var x$19432;var x$19416;var rest$19417;var $19386$19403;var $19387$19404;var t0$19399;var t1$19400;var t2$19401;var $19380$19394;var ph$19388;(ph$19388=$19375$19378);($19380$19394=ph$19388);if((($19386$19403=($19380$19394 instanceof Array))&&(((t0$19399=$19380$19394.length)),(t0$19399===0)))){return ["value",true];}else{if(($19386$19403&&((t0$19399>=1)&&(((t1$19400=$19380$19394[0])),((t1$19400 instanceof Array)&&(((t2$19401=t1$19400.length)),((t2$19401===2)&&(t1$19400[0]==="do")))))))){(x$19416=t1$19400[1]);(rest$19417=Array.prototype.slice.call($19380$19394,1));return ["multi",x$19416,construct$19233(rest$19417)];}else{if(($19386$19403&&((t0$19399===1)&&(((t1$19400=$19380$19394[0])),((t1$19400 instanceof Array)&&(((t2$19401=t1$19400.length)),((t2$19401===2)&&(t1$19400[0]==="check")))))))){(x$19432=t1$19400[1]);return x$19432;}else{if(($19386$19403&&((t0$19399>=1)&&(((t1$19400=$19380$19394[0])),((t1$19400 instanceof Array)&&(((t2$19401=t1$19400.length)),((t2$19401===2)&&(t1$19400[0]==="check")))))))){(x$19447=t1$19400[1]);(rest$19448=Array.prototype.slice.call($19380$19394,1));return ["send",["symbol","and"],["data",x$19447,construct$19233(rest$19448)]];}else{(other$19463=$19380$19394);throw $17001(["oops"]).create("?!?",other$19463);}}}}}));if(parts$19218.length){(test$19468=construct$19233(parts$19218));return ["multi"].concat(lead$19231).concat([(function(){if(f$19220){return ["send",["symbol","if"],["data",test$19468,["multi"].concat(trail$19232).concat([t$19219]),f$19220]];}else{return ["send",["symbol","if"],["data",test$19468,["multi"].concat(trail$19232).concat([t$19219])]];}})()]);}else{return ["multi"].concat(lead$19231).concat(trail$19232).concat([t$19219]);}}else{$16982($19205$19209);}}));(inject_below_uses$17315=(function($19478$19481,fn$19482){var other$19513;var scope$19502;var x$19503;var t0$19498;var $19484$19493;var ph$19487;(ph$19487=$19478$19481);($19484$19493=ph$19487);if((($19484$19493 instanceof Array)&&(((t0$19498=$19484$19493.length)),((t0$19498===3)&&($19484$19493[0]==="use"))))){(scope$19502=$19484$19493[1]);(x$19503=$19484$19493[2]);return ["use",scope$19502,inject_below_uses$17315(x$19503,fn$19482)];}else{(other$19513=$19484$19493);return fn$19482(other$19513);}}));(parse_pattern$17316=(function(scope$19520,pattern$19521,rhs$19522,opt$19523){var t0$19537;var $index$19589;var $length$19583;var temp$19577;var acc$19571;var parse$19529;var target$19530;var proc$19531;(parse$19529=PatternParser$17311(scope$19520,pattern$19521,opt$19523));if(((!opt$19523.allow_arguments)&&parse$19529.arguments.length)){throw $17001(["syntax","pattern","arguments"]).create("Arguments cannot be declared in this pattern",({"args":parse$19529.arguments[0]}));}(t0$19537=$21263((opt$19523.wrap_target||identity$17307))((function(){if(parse$19529.arguments.length){return inject_below_uses$17315(rhs$19522,(function(x$19544){return util$17301.construct(parse$19529.arguments.concat([x$19544]),(function(args$19548,rest$19549){return ["send",["symbol","->"],["data",args$19548,rest$19549]];}));}));}else{return rhs$19522;}})()));if(t0$19537[0]){(target$19530=t0$19537[1]);}else{$16982((function(){if(parse$19529.arguments.length){return inject_below_uses$17315(rhs$19522,(function(x$19556){return util$17301.construct(parse$19529.arguments.concat([x$19556]),(function(args$19560,rest$19561){return ["send",["symbol","->"],["data",args$19560,rest$19561]];}));}));}else{return rhs$19522;}})(),"/home/olivier/git/earl-grey/src/pattern.eg",11979,12405);}(proc$19531=PatternProcessor$17312());proc$19531.process(parse$19529.pattern,target$19530,opt$19523);if(opt$19523.finalize){return ["splice"].concat(opt$19523.declare(scope$19520,parse$19529.vars)).concat([["multi"].concat((((acc$19571=[])),(((temp$19577=proc$19531.temps)),((($length$19583=temp$19577.length)),((($index$19589=0)),(function(){$19566:for(;($index$19589<$length$19583);($index$19589++)){var t$19606;var m$19598;(m$19598=temp$19577[$index$19589]);(t$19606=m$19598);acc$19571.push(["declare",t$19606]);}})()))),acc$19571)).concat([assemble_pattern$17314(proc$19531.parts,opt$19523.success(target$19530),opt$19523.failure(target$19530))])]);}else{return [parse$19529.vars,proc$19531.temps,proc$19531.parts];}}));(checkall$17317=["send","data","multi","assign","void","check","do"]);(same_block$17318=(function($19616$19619,ban1$19620,ban2$19621){var $index$19785;var $length$19779;var temp$19773;var other$19807;var type1$19746;var args1$19747;var type2$19748;var args2$19749;var m1$19729;var m2$19730;var v1$19712;var v2$19713;var s1$19695;var s2$19696;var v1$19663;var v2$19664;var $19630$19654;var $19631$19655;var $19632$19656;var $19633$19657;var $19634$19658;var $19635$19659;var $19636$19660;var t0$19648;var t1$19649;var t2$19650;var t3$19651;var t4$19652;var $19623$19643;var ph$19637;(ph$19637=$19616$19619);($19623$19643=ph$19637);if((($19630$19654=($19623$19643 instanceof Array))&&(((t0$19648=$19623$19643.length)),(($19632$19656=(t0$19648===2))&&(((t1$19649=$19623$19643[0])),(($19634$19658=(t1$19649 instanceof Array))&&(((t2$19650=t1$19649.length)),(($19636$19660=(t2$19650===2))&&((t1$19649[0]==="variable")&&((v1$19663=t1$19649[1]),(((t3$19651=$19623$19643[1])),((t3$19651 instanceof Array)&&(((t4$19652=t3$19651.length)),((t4$19652===2)&&(t3$19651[0]==="variable"))))))))))))))){(v2$19664=t3$19651[1]);return (v1$19663===v2$19664);}else{if(($19636$19660&&((t1$19649[0]==="symbol")&&((s1$19695=t1$19649[1]),(((t3$19651=$19623$19643[1])),((t3$19651 instanceof Array)&&(((t4$19652=t3$19651.length)),((t4$19652===2)&&(t3$19651[0]==="symbol"))))))))){(s2$19696=t3$19651[1]);return (((!$16925(ban1$19620,s1$19695))&&(!$16925(ban2$19621,s2$19696)))&&(s1$19695===s2$19696));}else{if(($19636$19660&&((t1$19649[0]==="value")&&((v1$19712=t1$19649[1]),(((t3$19651=$19623$19643[1])),((t3$19651 instanceof Array)&&(((t4$19652=t3$19651.length)),((t4$19652===2)&&(t3$19651[0]==="value"))))))))){(v2$19713=t3$19651[1]);return (v1$19712===v2$19713);}else{if(($19636$19660&&((t1$19649[0]==="macro")&&((m1$19729=t1$19649[1]),(((t3$19651=$19623$19643[1])),((t3$19651 instanceof Array)&&(((t4$19652=t3$19651.length)),((t4$19652===2)&&(t3$19651[0]==="macro"))))))))){(m2$19730=t3$19651[1]);return (m1$19729===m2$19730);}else{if(($19634$19658&&((t2$19650>=1)&&((type1$19746=t1$19649[0]),((args1$19747=Array.prototype.slice.call(t1$19649,1)),(((t3$19651=$19623$19643[1])),((t3$19651 instanceof Array)&&(((t4$19652=t3$19651.length)),((t4$19652>=1)&&((type2$19748=t3$19651[0]),((args2$19749=Array.prototype.slice.call(t3$19651,1)),(checkall$17317.indexOf(type1$19746)!==-1)))))))))))){if(((type1$19746===type2$19748)&&(args1$19747.length===args2$19749.length))){(temp$19773=$21310(args1$19747,args2$19749));($length$19779=temp$19773.length);($index$19785=0);$19767:for(;($index$19785<$length$19779);($index$19785++)){var pair$19802;var m$19794;(m$19794=temp$19773[$index$19785]);(pair$19802=m$19794);if((!same_block$17318(pair$19802,ban1$19620,ban2$19621))){return false;}}return true;}else{return false;}}else{(other$19807=$19623$19643);return false;}}}}}}));(parse_clauses$17319=(function(scope$19814,target$19815,stmts$19816,opt$19817){var $index$19857;var $length$19851;var temp$19845;var acc$19839;var $index$20103;var $length$20097;var temp$20091;var acc$20085;var $index$20166;var $length$20160;var temp$20154;var acc$20148;var decls$20140;var all_temps$19823;var the_parts$19824;var unique_temps$19825;(all_temps$19823=[]);(the_parts$19824=(((acc$19839=[])),(((temp$19845=scope$19814.step_all(["clause"],stmts$19816))),((($length$19851=temp$19845.length)),((($index$19857=0)),(function(){$19831:for(;($index$19857<$length$19851);($index$19857++)){var accum$19969;var accum$19987;var t0$19961;var t1$19962;var $index$20014;var $length$20008;var temp$20002;var bod$20055;var placeholder$19896;var special_fn$19897;var vars$19898;var temps$19899;var blocks$19900;var vars2$19901;var x$20065;var other$20073;var b$20061;var pattern$19877;var body$19878;var $19836$19874;var t0$19871;var t1$19872;var m$19866;(m$19866=temp$19845[$index$19857]);(t0$19871=m$19866);if(((t0$19871 instanceof Array)&&(((t1$19872=t0$19871.length)),((t1$19872===3)&&(t0$19871[0]==="clause"))))){(pattern$19877=t0$19871[1]);(body$19878=t0$19871[2]);acc$19839.push((((placeholder$19896=(void 0))),((special_fn$19897=(function($19912$19915,value$19916){var t0$19924;var t1$19925;var other$19957;var $19918$19940;var ph$19921;var expr$19922;(t0$19924=$19912$19915);if(((t0$19924 instanceof Array)&&(((t1$19925=t0$19924.length)),((t1$19925===2)&&(t0$19924[0]==="special"))))){(ph$19921=t0$19924[1]);(expr$19922=t0$19924);}else{$16982($19912$19915);}($19918$19940=ph$19921);if(($19918$19940==="match")){(placeholder$19896=__lt____lt____colon__$17300(["symbol",scope$19814.gensym("ph")],expr$19922));return ["assign",placeholder$19896];}else{(other$19957=$19918$19940);throw $17001(["syntax","pattern","special"]).create("Special token cannot be used here",({"special":expr$19922}));}}))),(((t0$19961=parse_pattern$17316(scope$19814,pattern$19877,target$19815,$21240(opt$19817,$16908(({"allow_arguments":false,"allow_nested":true,"special":special_fn$19897}),$16908(((accum$19969=({})),((accum$19969["assign"]=(function(v$19974,value$19975){return ["do",__lt____lt____colon__$17300(["assign",v$19974,value$19975],v$19974)];})),accum$19969)),({"finalize":false}))))))),(function(){if(((t0$19961 instanceof Array)&&(((t1$19962=t0$19961.length)),(t1$19962===3)))){(vars$19898=t0$19961[0]);(temps$19899=t0$19961[1]);(blocks$19900=t0$19961[2]);}else{return $16982(parse_pattern$17316(scope$19814,pattern$19877,target$19815,$21240(opt$19817,$16908(({"allow_arguments":false,"allow_nested":true,"special":special_fn$19897}),$16908(((accum$19987=({})),((accum$19987["assign"]=(function(v$19992,value$19993){return ["do",__lt____lt____colon__$17300(["assign",v$19992,value$19993],v$19992)];})),accum$19987)),({"finalize":false}))))),"/home/olivier/git/earl-grey/src/pattern.eg",14056,14390);}})()),(all_temps$19823=all_temps$19823.concat(temps$19899)),(function(){if(placeholder$19896){return vars$19898.push(placeholder$19896);}})(),((vars2$19901=({}))),(((temp$20002=vars$19898)),((($length$20008=temp$20002.length)),((($index$20014=0)),(function(){$19902:for(;($index$20014<$length$20008);($index$20014++)){var other$20051;var xxx$20033;var t0$20028;var t1$20029;var m$20023;(m$20023=temp$20002[$index$20014]);(t0$20028=m$20023);if(((t0$20028 instanceof Array)&&(((t1$20029=t0$20028.length)),((t1$20029===2)&&(t0$20028[0]==="symbol"))))){(xxx$20033=t0$20028[1]);(vars2$19901[xxx$20033]=true);}else{(other$20051=m$20023);throw $17001(["syntax","unexpected"]).create();}}})()))),(((bod$20055=(function(){if(placeholder$19896){return parse_clauses$17319(scope$19814,placeholder$19896,$21263(Body$17308)(body$19878)[1],opt$19817);}else{if(opt$19817.wrap){return opt$19817.wrap(body$19878);}else{return body$19878;}}})())),["clause",vars$19898,vars2$19901,blocks$19900,bod$20055])));}else{if((((x$20065=t0$19871)),((x$20065 instanceof Array)&&(x$20065[0]==="block")))){(b$20061=t0$19871);acc$19839.push(b$20061);}else{(other$20073=m$19866);acc$19839.push(function(){throw $17001(["syntax","clause"]).create("Illegal clause",({"clause":other$20073}));}());}}}})()))),acc$19839));if(opt$19817.fallback){the_parts$19824.push(["block",opt$19817.fallback(target$19815)]);}(unique_temps$19825=$21262(util$17301.mkset((((acc$20085=[])),(((temp$20091=all_temps$19823)),((($length$20097=temp$20091.length)),((($index$20103=0)),(function(){$20080:for(;($index$20103<$length$20097);($index$20103++)){var t$20122;var t0$20117;var t1$20118;var m$20112;(m$20112=temp$20091[$index$20103]);(t0$20117=m$20112);if(((t0$20117 instanceof Array)&&(((t1$20118=t0$20117.length)),((t1$20118===2)&&(t0$20117[0]==="symbol"))))){(t$20122=t0$20117[1]);acc$20085.push(t$20122);}else{$16982(m$20112,"/home/olivier/git/earl-grey/src/pattern.eg",15197,15227);}}})()))),acc$20085))));(decls$20140=(((acc$20148=[])),(((temp$20154=unique_temps$19825)),((($length$20160=temp$20154.length)),((($index$20166=0)),(function(){$20143:for(;($index$20166<$length$20160);($index$20166++)){var t$20183;var m$20175;(m$20175=temp$20154[$index$20166]);(t$20183=m$20175);acc$20148.push(["declare",$16908(["symbol",t$20183],({"mutable":true}))]);}})()))),acc$20148));return ["multi"].concat(decls$20140).concat([weave_clauses$17321(the_parts$19824)]);}));(opt_clauses$17320=(function(clauses$20192){var $index$20232;var $length$20226;var temp$20220;var acc$20214;var $index$20416;var $length$20410;var temp$20404;var acc$20398;var $index$20476;var $length$20470;var temp$20464;var acc$20458;var $index$20528;var $length$20522;var temp$20516;var acc$20510;var shares$20201;var max$20202;var temps$20203;var shared_last$20204;var idx_last$20205;var new_clauses$20206;(shares$20201=(((acc$20214=[])),(((temp$20220=$17234(clauses$20192.slice(1)))),((($length$20226=temp$20220.length)),((($index$20232=0)),(function(){$20209:for(;($index$20232<$length$20226);($index$20232++)){var t0$20293;var t1$20294;var $index$20328;var $length$20322;var temp$20316;var varsd0$20285;var blocks0$20286;var share$20287;var idx$20288;var i$20253;var vars$20254;var varsd$20255;var blocks$20256;var body$20257;var t0$20246;var t1$20247;var t2$20248;var t3$20249;var m$20241;(m$20241=temp$20220[$index$20232]);(t0$20246=m$20241);if(((t0$20246 instanceof Array)&&(((t1$20247=t0$20246.length)),((t1$20247===2)&&((i$20253=t0$20246[0]),(((t2$20248=t0$20246[1])),((t2$20248 instanceof Array)&&(((t3$20249=t2$20248.length)),((t3$20249===5)&&(t2$20248[0]==="clause")))))))))){(vars$20254=t2$20248[1]);(varsd$20255=t2$20248[2]);(blocks$20256=t2$20248[3]);(body$20257=t2$20248[4]);acc$20214.push(((((t0$20293=$16925(clauses$20192,i$20253))),(function(){if(((t0$20293 instanceof Array)&&(((t1$20294=t0$20293.length)),((t1$20294===5)&&(t0$20293[0]==="clause"))))){t0$20293[1];(varsd0$20285=t0$20293[2]);(blocks0$20286=t0$20293[3]);t0$20293[4];}else{return $16982($16925(clauses$20192,i$20253),"/home/olivier/git/earl-grey/src/pattern.eg",15520,15530);}})()),((share$20287=0)),((idx$20288=0)),(((temp$20316=blocks$20256)),((($length$20322=temp$20316.length)),((($index$20328=0)),(function(){$20289:for(;($index$20328<$length$20322);($index$20328++)){var x$20365;var x$20375;var other$20386;var $20348$20354;var b$20345;var m$20337;(m$20337=temp$20316[$index$20328]);(b$20345=m$20337);if(same_block$17318([$16925(blocks0$20286,share$20287),b$20345],varsd0$20285,varsd$20255)){(share$20287++);($20348$20354=b$20345);if((((x$20365=$20348$20354)),((x$20365 instanceof Array)&&(x$20365[0]==="do")))){null;}else{if((((x$20375=$20348$20354)),((x$20375 instanceof Array)&&(x$20375[0]==="check")))){(idx$20288=share$20287);}else{(other$20386=$20348$20354);__lt____gt__$17298(null,other$20386);}}}else{break $20289;}}})()))),[share$20287,idx$20288]));}else{$16982(m$20241,"/home/olivier/git/earl-grey/src/pattern.eg",15396,15924);}}})()))),acc$20214));(max$20202=$16925(Math.max,(((acc$20398=[])),(((temp$20404=shares$20201)),((($length$20410=temp$20404.length)),((($index$20416=0)),(function(){$20393:for(;($index$20416<$length$20410);($index$20416++)){var x$20435;var t0$20430;var t1$20431;var m$20425;(m$20425=temp$20404[$index$20416]);(t0$20430=m$20425);if(((t0$20430 instanceof Array)&&(((t1$20431=t0$20430.length)),(t1$20431===2)))){(x$20435=t0$20430[0]);t0$20430[1];acc$20398.push(x$20435);}else{$16982(m$20425,"/home/olivier/git/earl-grey/src/pattern.eg",15938,15963);}}})()))),acc$20398)));shares$20201.push([0,0]);(temps$20203=(((acc$20458=[])),(((temp$20464=$21374(1,max$20202))),((($length$20470=temp$20464.length)),((($index$20476=0)),(function(){$20453:for(;($index$20476<$length$20470);($index$20476++)){var m$20485;(m$20485=temp$20464[$index$20476]);m$20485;acc$20458.push(["symbol",gensym$17303()]);}})()))),acc$20458));(shared_last$20204=0);(idx_last$20205=0);(new_clauses$20206=(((acc$20510=[])),(((temp$20516=$17234(clauses$20192))),((($length$20522=temp$20516.length)),((($index$20528=0)),(function(){$20504:for(;($index$20528<$length$20522);($index$20528++)){var t0$20590;var t1$20591;var $index$20640;var $length$20634;var temp$20628;var acc$20622;var rest$20724;var newblocks$20719;var share$20584;var idx$20585;var shared$20586;var n_to_share$20587;var to_share$20588;var other$20731;var i$20549;var vars$20550;var varsd$20551;var blocks$20552;var body$20553;var t0$20542;var t1$20543;var t2$20544;var t3$20545;var m$20537;(m$20537=temp$20516[$index$20528]);(t0$20542=m$20537);if(((t0$20542 instanceof Array)&&(((t1$20543=t0$20542.length)),((t1$20543===2)&&((i$20549=t0$20542[0]),(((t2$20544=t0$20542[1])),((t2$20544 instanceof Array)&&(((t3$20545=t2$20544.length)),((t3$20545===5)&&(t2$20544[0]==="clause")))))))))){(vars$20550=t2$20544[1]);(varsd$20551=t2$20544[2]);(blocks$20552=t2$20544[3]);(body$20553=t2$20544[4]);acc$20510.push(((((t0$20590=$16925(shares$20201,i$20549))),(function(){if(((t0$20590 instanceof Array)&&(((t1$20591=t0$20590.length)),(t1$20591===2)))){(share$20584=t0$20590[0]);(idx$20585=t0$20590[1]);}else{return $16982($16925(shares$20201,i$20549),"/home/olivier/git/earl-grey/src/pattern.eg",16196,16205);}})()),((shared$20586=(function(){if(idx_last$20205){return [["check",$16925(temps$20203,(idx_last$20205-1))]];}else{return [];}})())),((n_to_share$20587=Math.max(shared_last$20204,share$20584))),((to_share$20588=(((acc$20622=[])),(((temp$20628=$17234(blocks$20552.slice(shared_last$20204,n_to_share$20587)))),((($length$20634=temp$20628.length)),((($index$20640=0)),(function(){$20612:for(;($index$20640<$length$20634);($index$20640++)){var j$20692;var x$20693;var j$20665;var x$20666;var $20616$20659;var $20617$20660;var $20618$20661;var $20619$20662;var t0$20654;var t1$20655;var t2$20656;var t3$20657;var m$20649;(m$20649=temp$20628[$index$20640]);(t0$20654=m$20649);if((($20617$20660=(t0$20654 instanceof Array))&&(((t1$20655=t0$20654.length)),(($20619$20662=(t1$20655===2))&&((j$20665=t0$20654[0]),(((t2$20656=t0$20654[1])),((t2$20656 instanceof Array)&&(((t3$20657=t2$20656.length)),((t3$20657===2)&&(t2$20656[0]==="check")))))))))){(x$20666=t2$20656[1]);acc$20622.push(["check",["assign",$16925(temps$20203,(shared_last$20204+j$20665)),x$20666]]);}else{if(($20619$20662&&((j$20692=t0$20654[0]),(((t2$20656=t0$20654[1])),((t2$20656 instanceof Array)&&(((t3$20657=t2$20656.length)),((t3$20657===2)&&(t2$20656[0]==="do")))))))){(x$20693=t2$20656[1]);acc$20622.push(["do",x$20693]);}else{$16982(m$20649,"/home/olivier/git/earl-grey/src/pattern.eg",16344,16515);}}}})()))),acc$20622))),((shared_last$20204=share$20584)),((idx_last$20205=idx$20585)),(((newblocks$20719=(((rest$20724=blocks$20552.slice(n_to_share$20587))),shared$20586.concat(to_share$20588).concat(rest$20724)))),["clause",vars$20550,varsd$20551,newblocks$20719,body$20553])));}else{(other$20731=m$20537);acc$20510.push(function(){throw $17001(["oops"]).create("what",({"value":other$20731}));}());}}})()))),acc$20510));return [temps$20203,new_clauses$20206];}));(weave_clauses$17321=(function(parts$20740){var $index$20805;var $length$20799;var temp$20793;var $index$21069;var $length$21063;var temp$21057;var acc$21051;var groups$20747;var reassemble$20748;var new_temps$20749;var helper$20750;(groups$20747=classify_contiguous$17306(parts$20740,(function($20762$20765){var t0$20769;var t1$20770;var cls$20767;(t0$20769=$20762$20765);if(((t0$20769 instanceof Array)&&(((t1$20770=t0$20769.length)),(t1$20770>=1)))){(cls$20767=t0$20769[0]);Array.prototype.slice.call(t0$20769,1);}else{$16982($20762$20765);}return cls$20767;})));(reassemble$20748=[]);(new_temps$20749=[]);(temp$20793=groups$20747);($length$20799=temp$20793.length);($index$20805=0);$20751:for(;($index$20805<$length$20799);($index$20805++)){var t0$20845;var t1$20846;var ts$20842;var new_clauses$20843;var elems$20861;var elems$20828;var $20755$20822;var $20756$20823;var $20757$20824;var $20758$20825;var t0$20819;var t1$20820;var m$20814;(m$20814=temp$20793[$index$20805]);(t0$20819=m$20814);if((($20756$20823=(t0$20819 instanceof Array))&&(((t1$20820=t0$20819.length)),(($20758$20825=(t1$20820>=1))&&(t0$20819[0]==="clause"))))){(elems$20828=Array.prototype.slice.call(t0$20819,1));(t0$20845=opt_clauses$17320(elems$20828));if(((t0$20845 instanceof Array)&&(((t1$20846=t0$20845.length)),(t1$20846===2)))){(ts$20842=t0$20845[0]);(new_clauses$20843=t0$20845[1]);}else{$16982(opt_clauses$17320(elems$20828),"/home/olivier/git/earl-grey/src/pattern.eg",17024,17042);}(new_temps$20749=new_temps$20749.concat(ts$20842));(reassemble$20748=reassemble$20748.concat(new_clauses$20843));}else{if(($20758$20825&&(t0$20819[0]==="block"))){(elems$20861=Array.prototype.slice.call(t0$20819,1));(reassemble$20748=reassemble$20748.concat(elems$20861));}else{$16982(m$20814,"/home/olivier/git/earl-grey/src/pattern.eg",16958,17163);}}}(helper$20750=(function($20869$20872){var $index$20985;var $length$20979;var temp$20973;var acc$20967;var decls$20959;var vars$20950;var varsd$20951;var blocks$20952;var body$20953;var rest$20954;var body$20919;var rest$20920;var $20878$20902;var $20879$20903;var $20880$20904;var $20881$20905;var $20882$20906;var $20883$20907;var t0$20895;var t1$20896;var t2$20897;var t3$20898;var t4$20899;var t5$20900;var $20874$20890;var ph$20884;(ph$20884=$20869$20872);($20874$20890=ph$20884);if((($20878$20902=($20874$20890 instanceof Array))&&(((t0$20895=$20874$20890.length)),(t0$20895===0)))){return ["multi"];}else{if(($20878$20902&&(($20880$20904=(t0$20895>=1))&&(((t1$20896=$20874$20890[0])),(($20882$20906=(t1$20896 instanceof Array))&&(((t2$20897=t1$20896.length)),((t2$20897===2)&&((t1$20896[0]==="block")&&(((t3$20898=$21263(Body$17308)(t1$20896[1]))),(t3$20898[0]&&(((t4$20899=t3$20898[1])),(((t5$20900=t4$20899.length)),(t5$20900>=0))))))))))))){(body$20919=Array.prototype.slice.call(t4$20899,0));(rest$20920=Array.prototype.slice.call($20874$20890,1));return ["multi"].concat(body$20919).concat([helper$20750(rest$20920)]);}else{if(($20882$20906&&((t2$20897===5)&&(t1$20896[0]==="clause")))){(vars$20950=t1$20896[1]);(varsd$20951=t1$20896[2]);(blocks$20952=t1$20896[3]);(body$20953=t1$20896[4]);(rest$20954=Array.prototype.slice.call($20874$20890,1));(decls$20959=(((acc$20967=[])),(((temp$20973=vars$20950)),((($length$20979=temp$20973.length)),((($index$20985=0)),(function(){$20962:for(;($index$20985<$length$20979);($index$20985++)){var bridge$21010$21018;var $21005$21013;var v$21002;var m$20994;(m$20994=temp$20973[$index$20985]);(v$21002=m$20994);acc$20967.push(((($21005$21013=v$21002.declare_mode)),(function(){if(($21005$21013==="set")){return ["splice"];}else{if(($21005$21013==="let")){return ["declare",$21240(v$21002,({"mutable":false}))];}else{if(($21005$21013==="var")){return ["declare",$21240(v$21002,({"mutable":true}))];}else{(bridge$21010$21018=$21005$21013);if(((bridge$21010$21018==="unqualified")||(bridge$21010$21018===(void 0)))){return ["declare",$21240(v$21002,({"mutable":false}))];}else{$16982($21005$21013);}}}}})()));}})()))),acc$20967));return ["tagscope","back",["multi"].concat(decls$20959).concat([assemble_pattern$17314(blocks$20952,body$20953,["use","back",helper$20750(rest$20954)])])];}else{$16982($20874$20890);}}}}));return ["multi"].concat((((acc$21051=[])),(((temp$21057=new_temps$20749)),((($length$21063=temp$21057.length)),((($index$21069=0)),(function(){$21046:for(;($index$21069<$length$21063);($index$21069++)){var t$21086;var m$21078;(m$21078=temp$21057[$index$21069]);(t$21086=m$21078);acc$21051.push(["declare",t$21086]);}})()))),acc$21051)).concat([helper$20750(reassemble$20748)]);}));(exports["PatternParser"]=PatternParser$17311);(exports["PatternProcessor"]=PatternProcessor$17312);(exports["parse_clauses"]=parse_clauses$17319);(exports["parse_pattern"]=parse_pattern$17316);
