var $15557=function(type$15560){var f$15564;(f$15564=type$15560["::check"]);if((f$15564===(void 0))){return function(value$15570){return (value$15570 instanceof type$15560);};}else{return function(value$15574){return f$15564.call(type$15560,value$15574);};}};
var $15576=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $15577=function(dest$15580,values$15581){var k$15586;(k$15586=null);$15584:for(k$15586 in values$15581){if(values$15581.hasOwnProperty(k$15586)){(dest$15580[k$15586]=values$15581[k$15586]);}}return dest$15580;};
var $15594=function($15596$15599){var ph$15605;(ph$15605=$15596$15599);var $15601$15611;($15601$15611=ph$15605);var bridge$15603$15616;var x$15620;(bridge$15603$15616=$15601$15611);if((((typeof(bridge$15603$15616)==="string")&&((x$15620=bridge$15603$15616),true))||((typeof(bridge$15603$15616)==="number")&&((x$15620=bridge$15603$15616),true)))){return ["value",x$15620];}else{var other$15631;(other$15631=$15601$15611);return other$15631["::serialize_ast"]();}};
var send$15331;(send$15331=function(obj$15338,$15335$15339){var ph$15345;var msg$15346;var t0$15348;(t0$15348=$15335$15339);(msg$15346=t0$15348);(ph$15345=t0$15348);var $15341$15357;($15341$15357=ph$15345);var bridge$15343$15362;(bridge$15343$15362=$15341$15357);if(((typeof(bridge$15343$15362)==="string")||(typeof(bridge$15343$15362)==="number"))){return obj$15338[msg$15346];}else{var other$15374;(other$15374=$15341$15357);return obj$15338["::send"](msg$15346);}});(Array[":::project"]=function($15380$15383){var ph$15388;var value$15389;var t0$15391;(t0$15391=$15380$15383);(value$15389=t0$15391);(ph$15388=t0$15391);var $15385$15400;($15385$15400=ph$15388);if($15557(Array)($15385$15400)){return [true,value$15389];}else{$15385$15400;return [true,[value$15389]];}});(Array.prototype["::check"]=function(value$15418){if((value$15418 instanceof Array)){var i$15424;(i$15424=0);$15421:for(;(i$15424<this.length);(i$15424++)){if(($15576(this,i$15424)!==$15576(value$15418,i$15424))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $15577(this.slice(0),this);});(Array.prototype[":::project"]=function(value$15443){if((value$15443 instanceof Array)){var i$15449;(i$15449=0);$15446:for(;(i$15449<this.length);(i$15449++)){if(($15576(this,i$15449)!==$15576(value$15443,i$15449))){return [true,[value$15443]];}}return [true,value$15443.slice(this.length)];}else{return [true,[value$15443]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($15594));});(RegExp.prototype["::check"]=function($15467$15470){var ph$15475;(ph$15475=$15467$15470);var $15472$15481;($15472$15481=ph$15475);var value$15489;if((typeof($15472$15481)==="string")){(value$15489=$15472$15481);if(value$15489.match(this)){return true;}else{return false;}}else{var other$15494;(other$15494=$15472$15481);return false;}});(RegExp.prototype[":::project"]=function($15500$15503){var ph$15508;(ph$15508=$15500$15503);var $15505$15514;($15505$15514=ph$15508);var value$15522;if((typeof($15505$15514)==="string")){(value$15522=$15505$15514);var $15525$15530;($15525$15530=value$15522.match(this));var m$15538;if(($15525$15530===null)){(m$15538=$15525$15530);return [false,null];}else{var m$15543;(m$15543=$15525$15530);return [true,m$15543];}}else{var other$15547;(other$15547=$15505$15514);return [false,null];}});(Function.prototype["::send"]=function(args$15554){return this.apply(this,args$15554);});
var $19559=function($19561$19564,key$19565){var ph$19573;(ph$19573=$19561$19564);var $19567$19579;($19567$19579=ph$19573);var bridge$19569$19584;(bridge$19569$19584=$19567$19579);if(((bridge$19569$19584===null)||(bridge$19569$19584===(void 0)))){return false;}else{var x$19596;if((typeof($19567$19579)==="string")){(x$19596=$19567$19579);return (key$19565 in String.prototype);}else{var x$19601;if((typeof($19567$19579)==="number")){(x$19601=$19567$19579);return (key$19565 in Number.prototype);}else{var x$19606;(x$19606=$19567$19579);return (key$19565 in x$19606);}}}};
var $19841=function(arr$19844){var results$19850;var l$19851;(results$19850=[]);(l$19851=arr$19844.length);var i$19860;(i$19860=0);$19849:for(;(i$19860<l$19851);(i$19860++)){results$19850.push([i$19860,$15576(arr$19844,i$19860)]);}return results$19850;};
var $19867=function(value$19870,url$19871,start$19872,end$19873){var err$19877;(err$19877=$19608(["match"]).create("Could not find a match for value",({"value":value$19870})));if(url$19871){(err$19877["location"]=["location",url$19871,start$19872,end$19873]);}throw err$19877;};
var $19608=function(){var $19609$19615;($19609$19615=function(tags$19620){var it$0$19623;(it$0$19623=function(){if((!$15557($19609$19615)(this))){return Object.create($19609$19615.prototype);}else{return this;}}());(it$0$19623["tags"]=tags$19620);return it$0$19623;});($19609$19615.prototype["create"]=function(){var it$0$19643;var self$19644;(it$0$19643=this);(self$19644=this);var $19641$19653;($19641$19653=arguments);var t0$19658;var message$19662;var args$19663;(t0$19658=$19641$19653.length);if((t0$19658>=0)){(message$19662=function(){if((0>=t0$19658)){return "";}else{return $19641$19653[0];}}());(args$19663=Array.prototype.slice.call($19641$19653,1));var e$19676;(e$19676=Error(message$19662));(e$19676["::tags"]=it$0$19643.tags);(e$19676["args"]=args$19663);var temp$19692;(temp$19692=$19841(args$19663));var $length$19698;($length$19698=temp$19692.length);var $index$19704;($index$19704=0);$19677:for(;($index$19704<$length$19698);($index$19704++)){var m$19713;(m$19713=temp$19692[$index$19704]);var t0$19718;var t1$19719;var i$19723;var arg$19724;(t0$19718=m$19713);if(((t0$19718 instanceof Array)&&(((t1$19719=t0$19718.length)),(t1$19719===2)))){(i$19723=t0$19718[0]);(arg$19724=t0$19718[1]);(e$19676[i$19723]=arg$19724);}else{$19867(m$19713);}}(e$19676["length"]=args$19663.length);(e$19676["name"]=["E"].concat(it$0$19643.tags).join("."));return e$19676;}else{$19867($19641$19653);}});($19609$19615.prototype["::check"]=function(e$19754){var it$0$19758;var self$19759;(it$0$19758=this);(self$19759=this);var tags$19769;if(((!e$19754)||(!$15557(Error)(e$19754)))){return false;}(tags$19769=(e$19754["::tags"]||[]));var temp$19780;(temp$19780=it$0$19758.tags);var $length$19786;($length$19786=temp$19780.length);var $index$19792;($index$19792=0);$19770:for(;($index$19792<$length$19786);($index$19792++)){var m$19801;(m$19801=temp$19780[$index$19792]);var tag$19809;(tag$19809=m$19801);if((tags$19769.indexOf(tag$19809)===-1)){return false;}else{false;}}return true;});($19609$19615.prototype["::deconstruct"]=function(e$19818){var it$0$19822;var self$19823;(it$0$19822=this);(self$19823=this);return e$19818.args;});$15577($19609$19615,$15577(function(){var accum$19834;(accum$19834=({}));(accum$19834["::name"]="$19609");return accum$19834;}(),function(){var accum$19838;(accum$19838=({}));(accum$19838["::egclass"]=true);return accum$19838;}()));return $19609$19615;}();
var $19475=function($19477$19480){var ph$19490;var x$19491;var t0$19493;(t0$19493=$19477$19480);(x$19491=t0$19493);(ph$19490=t0$19493);var $19482$19502;($19482$19502=ph$19490);var bridge$19484$19507;(bridge$19484$19507=$19482$19502);if((function(){var bridge$19485$19517;(bridge$19485$19517=bridge$19484$19507);return (function(){var bridge$19486$19524;(bridge$19486$19524=bridge$19485$19517);return ((bridge$19486$19524===(void 0))||(bridge$19486$19524===null));}()||(typeof(bridge$19485$19517)==="string"));}()||(typeof(bridge$19484$19507)==="number"))){return x$19491;}else{if($19559($19482$19502,"::clone")){$19482$19502["::clone"];return x$19491["::clone"]();}else{$19482$19502;if((Object.getPrototypeOf(x$19491)===Object.prototype)){var dest$19542;(dest$19542=({}));var k$19547;(k$19547=null);$19541:for(k$19547 in x$19491){if(Object.prototype.hasOwnProperty.call(x$19491,k$19547)){(dest$19542[k$19547]=x$19491[k$19547]);}}return dest$19542;}else{var other$19557;(other$19557=$19482$19502);throw $19608(["clone"]).create("Object cannot be cloned",({"obj":x$19491}));}}}};
var $19886=function(a$19889,b$19890){var dest$19895;(dest$19895=$19475(a$19889));var k$19900;(k$19900=null);$19894:for(k$19900 in b$19890){if(Object.prototype.hasOwnProperty.call(b$19890,k$19900)){(dest$19895[k$19900]=b$19890[k$19900]);}}return dest$19895;};
var $19908=Object.keys;
var $19909=function(type$19912){return function(value$19916){var f$19920;(f$19920=type$19912[":::project"]);if((f$19920===(void 0))){(f$19920=type$19912["::project"]);if((f$19920===(void 0))){return [true,type$19912(value$19916)];}else{var rval$19933;(rval$19933=false);try{(rval$19933=[true,f$19920(value$19916)]);}catch(excv$19944){var e$19950;(e$19950=excv$19944);(rval$19933=[false,null]);}return rval$19933;}}else{return f$19920.call(type$19912,value$19916);}};};
var $19956=function(xs$19959,ys$19960){var acc$19967;(acc$19967=[]);var temp$19973;(temp$19973=$19841(xs$19959));var $length$19979;($length$19979=temp$19973.length);var $index$19985;($index$19985=0);$19962:for(;($index$19985<$length$19979);($index$19985++)){var m$19994;(m$19994=temp$19973[$index$19985]);var t0$19999;var t1$20000;var i$20004;var x$20005;(t0$19999=m$19994);if(((t0$19999 instanceof Array)&&(((t1$20000=t0$19999.length)),(t1$20000===2)))){(i$20004=t0$19999[0]);(x$20005=t0$19999[1]);acc$19967.push([x$20005,$15576(ys$19960,i$20004)]);}else{$19867(m$19994);}}return acc$19967;};
var $20020=function(from$20023,to$20024){var rval$20029;(rval$20029=[]);var i$20035;(i$20035=from$20023);$20028:for(;(i$20035<=to$20024);(i$20035++)){rval$20029.push(i$20035);}return rval$20029;};var accum$16623;var accum$16627;var accum$17412;var accum$17416;var $15635$15669;var __lt____gt__$15670;var $15636$15671;var __lt____lt____colon__$15672;var util$15673;var GenSym$15674;var gensym$15675;var neighbours$15676;var classify$15677;var classify_contiguous$15678;var identity$15679;var $15638$15680;var checker_db$15681;var PatternParser$15682;var PatternProcessor$15683;var assemble_conditions$15684;var assemble_pattern$15685;var inject_below_uses$15686;var parse_pattern$15687;var checkall$15688;var same_block$15689;var parse_clauses$15690;var opt_clauses$15691;var weave_clauses$15692;($15635$15669=require("./pp"));(__lt____gt__$15670=$15635$15669["<>"]);($15636$15671=require("./location"));(__lt____lt____colon__$15672=$15636$15671["<<:"]);(util$15673=require("./util"));(GenSym$15674=util$15673.GenSym);(gensym$15675=util$15673.gensym);(neighbours$15676=util$15673.neighbours);(classify$15677=util$15673.classify);(classify_contiguous$15678=util$15673.classify_contiguous);(identity$15679=util$15673.identity);($15638$15680=require("./expand"));(checker_db$15681=$15638$15680.checker_db);(PatternParser$15682=function(scope$15736,pattern$15737,opt$15738){var tags$15754;var it$0$15741;(it$0$15741=function(){if((!$15557(PatternParser$15682)(this))){return Object.create(PatternParser$15682.prototype);}else{return this;}}());(it$0$15741["opt"]=opt$15738);(it$0$15741["arguments"]=[]);(it$0$15741["vars"]=[]);(it$0$15741["specials"]=({}));(tags$15754=$19475((opt$15738.tags||({}))));(tags$15754["group_id"]=(tags$15754.group_id||gensym$15675("group")));(it$0$15741["pattern"]=it$0$15741.expand(scope$15736,pattern$15737,tags$15754,true,it$0$15741.opt.indexable));return it$0$15741;});(PatternParser$15682.prototype["parse_specs"]=function(scope$15778,specs$15779,tags$15780){var $index$15841;var $length$15835;var temp$15829;var acc$15823;var rest$15798;var has_defaults$15799;var rval$15800;var it$0$15784;var self$15785;(it$0$15784=this);(self$15785=this);(rest$15798=(void 0));(has_defaults$15799=false);(rval$15800=classify$15677("fw","bw","keys","defaults",(((acc$15823=[])),(((temp$15829=scope$15778.step_all(["pattern"],specs$15779))),((($length$15835=temp$15829.length)),((($index$15841=0)),function(){$15809:for(;($index$15841<$length$15835);($index$15841++)){var v$15915;var v$15909;var variable$15897;var value$15898;var key$15890;var subp$15891;var key$15884;var variable$15864;var $15817$15858;var $15818$15859;var $15819$15860;var $15820$15861;var t0$15855;var t1$15856;var m$15850;(m$15850=temp$15829[$index$15841]);(t0$15855=m$15850);if((($15818$15859=(t0$15855 instanceof Array))&&(((t1$15856=t0$15855.length)),(($15820$15861=(t1$15856===2))&&(t0$15855[0]==="dynsplice"))))){(variable$15864=t0$15855[1]);acc$15823.push((((rest$15798=it$0$15784.expand(scope$15778,variable$15864,tags$15780))),["ignore"]));}else{if(($15820$15861&&(t0$15855[0]==="assoc"))){(key$15884=t0$15855[1]);acc$15823.push(["keys",[key$15884,it$0$15784.expand(scope$15778,key$15884,tags$15780)]]);}else{if(($15818$15859&&(($15820$15861=(t1$15856===3))&&(t0$15855[0]==="assoc")))){(key$15890=t0$15855[1]);(subp$15891=t0$15855[2]);acc$15823.push(["keys",[key$15890,it$0$15784.expand(scope$15778,subp$15891,tags$15780)]]);}else{if(($15820$15861&&(t0$15855[0]==="default"))){(variable$15897=t0$15855[1]);(value$15898=t0$15855[2]);acc$15823.push((((has_defaults$15799=true)),function(){if(rest$15798){throw $19608(["syntax","pattern"]).create("No default arguments after rest arg.");}else{return ["defaults",[it$0$15784.expand(scope$15778,variable$15897,tags$15780),value$15898]];}}()));}else{(v$15909=m$15850);if(((rest$15798===(void 0))&&(!has_defaults$15799))){acc$15823.push(["fw",it$0$15784.expand(scope$15778,v$15909,tags$15780)]);}else{(v$15915=m$15850);acc$15823.push(["bw",it$0$15784.expand(scope$15778,v$15915,tags$15780)]);}}}}}}}()))),acc$15823)));(rval$15800["rest"]=rest$15798);return rval$15800;});(PatternParser$15682.prototype["expand"]=function(){var x$16015;var x$16025;var x$16054;var x$16060;var variable$16067;var variable$16084;var x$16124;var msg$16132;var msg$16148;var $index$16190;var $length$16184;var temp$16178;var acc$16172;var $index$16323;var $length$16317;var temp$16311;var acc$16305;var $index$16359;var $length$16353;var temp$16347;var t0$16434;var t1$16435;var t2$16436;var $index$16482;var $length$16476;var temp$16470;var acc$16464;var patts$16456;var canon$16220;var normalize$16221;var pps$16222;var vars$16223;var patt$16557;var msg$16603;var other$16599;var keys$16563;var fw$16536;var bw$16537;var defaults$16538;var rest$16539;var $16514$16533;var t0$16526;var t1$16527;var t2$16528;var t3$16529;var t4$16530;var t5$16531;var $16510$16521;var specs$16515;var other$16615;var mode$16609;var subp$16610;var args$16505;var xs$16212;var xs$16164;var x$16154;var f$16138;var arg$16139;var f$16113;var arguments$16114;var checker$16107;var subp$16108;var projector$16101;var subp$16102;var condition$16095;var subp$16096;var v$16090;var v$16073;var type$16032;var $15991$16006;var $15992$16007;var $15993$16008;var $15994$16009;var t0$16002;var bridge$15976$16003;var t1$16004;var $15971$15997;var expr$15964;var rval$15965;var scope$15950;var pattern$15951;var tags$15952;var toplevel$15953;var checked$15954;var t0$15946;var $15929$15941;var it$0$15931;var self$15932;(it$0$15931=this);(self$15932=this);($15929$15941=arguments);(t0$15946=$15929$15941.length);if(((t0$15946>=3)&&(t0$15946<=5))){(scope$15950=$15929$15941[0]);(pattern$15951=$15929$15941[1]);(tags$15952=$15929$15941[2]);(toplevel$15953=function(){if((3>=t0$15946)){return false;}else{return $15929$15941[3];}}());(checked$15954=function(){if((4>=t0$15946)){return false;}else{return $15929$15941[4];}}());(expr$15964=scope$15950.step(["pattern"],pattern$15951));(rval$15965=((($15971$15997=expr$15964)),function(){if((((x$16015=$15971$15997)),((x$16015 instanceof Array)&&(x$16015[0]==="void")))){return ["check",checker_db$15681.null,["ignore"]];}else{if((((x$16025=$15971$15997)),((x$16025 instanceof Array)&&(x$16025[0]==="ignore")))){return expr$15964;}else{if((($15971$15997 instanceof Array)&&(((t0$16002=$15971$15997.length)),((t0$16002===2)&&($15971$15997[0]==="special"))))){(type$16032=$15971$15997[1]);(it$0$15931.specials[type$16032]=true);return expr$15964;}else{(bridge$15976$16003=$15971$15997);if(((((x$16054=bridge$15976$16003)),((x$16054 instanceof Array)&&(x$16054[0]==="symbol")))||(((x$16060=bridge$15976$16003)),((x$16060 instanceof Array)&&(x$16060[0]==="variable"))))){(variable$16067=$19886(expr$15964,tags$15952));it$0$15931.vars.push(variable$16067);return ["assign",variable$16067];}else{if((($15991$16006=($15971$15997 instanceof Array))&&(((t0$16002=$15971$15997.length)),(($15993$16008=(t0$16002===2))&&(($15994$16009=($15971$15997[0]==="value"))&&((v$16073=$15971$15997[1]),it$0$15931.opt.strings_as_variables)))))){(variable$16084=__lt____lt____colon__$15672($19886(["symbol",v$16073],tags$15952),expr$15964));it$0$15931.vars.push(variable$16084);return ["assign",variable$16084];}else{if($15994$16009){(v$16090=$15971$15997[1]);return ["check",checker_db$15681(v$16090),["ignore"]];}else{if(($15991$16006&&(($15993$16008=(t0$16002===3))&&($15971$15997[0]==="test")))){(condition$16095=$15971$15997[1]);(subp$16096=$15971$15997[2]);return ["test",condition$16095,it$0$15931.expand(scope$15950,subp$16096,tags$15952,toplevel$15953,false)];}else{if(($15993$16008&&($15971$15997[0]==="project"))){(projector$16101=$15971$15997[1]);(subp$16102=$15971$15997[2]);return ["project",projector$16101,it$0$15931.expand(scope$15950,subp$16102,tags$15952,toplevel$15953,true)];}else{if(($15993$16008&&($15971$15997[0]==="check"))){(checker$16107=$15971$15997[1]);(subp$16108=$15971$15997[2]);return ["check",checker$16107,it$0$15931.expand(scope$15950,subp$16108,tags$15952,toplevel$15953,true)];}else{if(($15993$16008&&(($15994$16009=($15971$15997[0]==="send"))&&((f$16113=$15971$15997[1]),(((t1$16004=$15971$15997[2])),(((x$16124=t1$16004)),((x$16124 instanceof Array)&&(x$16124[0]==="data")))))))){(arguments$16114=t1$16004);if(toplevel$15953){it$0$15931.arguments.unshift(arguments$16114);return it$0$15931.expand(scope$15950,f$16113,tags$15952,true,false);}else{(msg$16132="Function arguments can only be declared as a top level pattern.");throw $19608(["syntax","pattern"]).create(msg$16132,({"node":expr$15964,"arg":arguments$16114}));}}else{if($15994$16009){(f$16138=$15971$15997[1]);(arg$16139=$15971$15997[2]);return ["assign",expr$15964];}else{$15971$15997;if((!it$0$15931.opt.allow_nested)){(msg$16148="Nested patterns are not allowed here.");throw $19608(["syntax","pattern"]).create(msg$16148,({"node":expr$15964}));}else{if((($15991$16006=($15971$15997 instanceof Array))&&(((t0$16002=$15971$15997.length)),((t0$16002===2)&&($15971$15997[0]==="neg"))))){(x$16154=$15971$15997[1]);return ["neg",it$0$15931.expand(scope$15950,x$16154,tags$15952)];}else{if(($15991$16006&&(($15993$16008=(t0$16002>=1))&&($15971$15997[0]==="all")))){(xs$16164=Array.prototype.slice.call($15971$15997,1));return ["all"].concat((((acc$16172=[])),(((temp$16178=xs$16164)),((($length$16184=temp$16178.length)),((($index$16190=0)),function(){$16167:for(;($index$16190<$length$16184);($index$16190++)){var x$16207;var m$16199;(m$16199=temp$16178[$index$16190]);(x$16207=m$16199);acc$16172.push(it$0$15931.expand(scope$15950,x$16207,tags$15952));}}()))),acc$16172));}else{if(($15993$16008&&($15971$15997[0]==="any"))){(xs$16212=Array.prototype.slice.call($15971$15997,1));(canon$16220=function(all$16231){return all$16231.sort().join(",");});(normalize$16221=function(vars$16238){var $index$16263;var $length$16257;var temp$16251;var acc$16245;return canon$16220((((acc$16245=[])),(((temp$16251=vars$16238)),((($length$16257=temp$16251.length)),((($index$16263=0)),function(){$16240:for(;($index$16263<$length$16257);($index$16263++)){var v$16282;var t0$16277;var t1$16278;var m$16272;(m$16272=temp$16251[$index$16263]);(t0$16277=m$16272);if(((t0$16277 instanceof Array)&&(((t1$16278=t0$16277.length)),((t1$16278===2)&&(t0$16277[0]==="symbol"))))){(v$16282=t0$16277[1]);acc$16245.push(v$16282);}else{$19867(m$16272,"/home/olivier/git/earl-grey/src/pattern.eg",3845,3902);}}}()))),acc$16245));});(pps$16222=(((acc$16305=[])),(((temp$16311=xs$16212)),((($length$16317=temp$16311.length)),((($index$16323=0)),function(){$16300:for(;($index$16323<$length$16317);($index$16323++)){var x$16340;var m$16332;(m$16332=temp$16311[$index$16323]);(x$16340=m$16332);acc$16305.push(PatternParser$15682(scope$15950,x$16340,$19886(it$0$15931.opt,({"tags":tags$15952}))));}}()))),acc$16305));(temp$16347=neighbours$15676(pps$16222));($length$16353=temp$16347.length);($index$16359=0);$16224:for(;($index$16359<$length$16353);($index$16359++)){var $index$16410;var $length$16404;var temp$16398;var pp1$16378;var pp2$16379;var t0$16373;var t1$16374;var m$16368;(m$16368=temp$16347[$index$16359]);(t0$16373=m$16368);if(((t0$16373 instanceof Array)&&(((t1$16374=t0$16373.length)),(t1$16374===2)))){(pp1$16378=t0$16373[0]);(pp2$16379=t0$16373[1]);(temp$16398=pps$16222);($length$16404=temp$16398.length);($index$16410=0);$16392:for(;($index$16410<$length$16404);($index$16410++)){var pp$16427;var m$16419;(m$16419=temp$16398[$index$16410]);(pp$16427=m$16419);normalize$16221(pp$16427.vars);}if((normalize$16221(pp1$16378.vars)!==normalize$16221(pp2$16379.vars))){throw $19608(["syntax","pattern"]).create("Both branches of 'or' must contain the same variables",({"vars1":__lt____lt____colon__$15672(pp1$16378.vars.sort(),pp1$16378.pattern),"vars2":__lt____lt____colon__$15672(pp2$16379.vars.sort(),pp2$16379.pattern)}));}if((canon$16220($19908(pp1$16378.specials))!==canon$16220($19908(pp2$16379.specials)))){throw $19608(["syntax","pattern"]).create("Both branches of 'or' must contain the same special tokens",({"special1":__lt____lt____colon__$15672($19908(pp1$16378.specials).sort(),pp1$16378.pattern),"special2":__lt____lt____colon__$15672($19908(pp2$16379.specials).sort(),pp2$16379.pattern)}));}}else{$19867(m$16368,"/home/olivier/git/earl-grey/src/pattern.eg",3994,4791);}}(t0$16434=pps$16222);if(((t0$16434 instanceof Array)&&(((t1$16435=t0$16434.length)),((t1$16435>=1)&&(((t2$16436=t0$16434[0])),$19559(t2$16436,"vars")))))){(vars$16223=t2$16436.vars);Array.prototype.slice.call(t0$16434,1);}else{$19867(pps$16222,"/home/olivier/git/earl-grey/src/pattern.eg",4808,4811);}(it$0$15931["vars"]=it$0$15931.vars.concat(vars$16223));(patts$16456=(((acc$16464=[])),(((temp$16470=pps$16222)),((($length$16476=temp$16470.length)),((($index$16482=0)),function(){$16459:for(;($index$16482<$length$16476);($index$16482++)){var pp$16499;var m$16491;(m$16491=temp$16470[$index$16482]);(pp$16499=m$16491);acc$16464.push(pp$16499.pattern);}}()))),acc$16464));return ["any"].concat(patts$16456);}else{if(($15993$16008&&($15971$15997[0]==="data"))){(args$16505=Array.prototype.slice.call($15971$15997,1));(specs$16515=it$0$15931.parse_specs(scope$15950,args$16505,tags$15952));($16510$16521=specs$16515);if((($16514$16533=$19559($16510$16521,"keys"))&&(((t0$16526=$16510$16521.keys)),((t0$16526 instanceof Array)&&(((t1$16527=t0$16526.length)),((t1$16527===0)&&($19559($16510$16521,"fw")&&((fw$16536=$16510$16521.fw),($19559($16510$16521,"bw")&&((bw$16537=$16510$16521.bw),($19559($16510$16521,"defaults")&&((defaults$16538=$16510$16521.defaults),$19559($16510$16521,"rest"))))))))))))){(rest$16539=$16510$16521.rest);(patt$16557=__lt____lt____colon__$15672(["array_pattern",fw$16536,bw$16537,defaults$16538,rest$16539],pattern$15951));if(checked$15954){return patt$16557;}else{return ["check",checker_db$15681.Array,patt$16557];}}else{if(($16514$16533&&((keys$16563=$16510$16521.keys),($19559($16510$16521,"fw")&&(((t0$16526=$16510$16521.fw)),((t0$16526 instanceof Array)&&(((t1$16527=t0$16526.length)),((t1$16527===0)&&($19559($16510$16521,"bw")&&(((t2$16528=$16510$16521.bw)),((t2$16528 instanceof Array)&&(((t3$16529=t2$16528.length)),((t3$16529===0)&&($19559($16510$16521,"defaults")&&(((t4$16530=$16510$16521.defaults)),((t4$16530 instanceof Array)&&(((t5$16531=t4$16530.length)),((t5$16531===0)&&($19559($16510$16521,"rest")&&($16510$16521.rest===(void 0))))))))))))))))))))){return ["object_pattern"].concat(keys$16563);}else{(other$16599=$16510$16521);(msg$16603="Pattern must be an array or an object.");throw $19608(["syntax","pattern"]).create(msg$16603,({"node":expr$15964,"specs":specs$16515}));}}}else{if(($15991$16006&&((t0$16002===3)&&($15971$15997[0]==="mode")))){(mode$16609=$15971$15997[1]);(subp$16610=$15971$15997[2]);return it$0$15931.expand(scope$15950,subp$16610,$19886(tags$15952,({"declare_mode":mode$16609})),toplevel$15953,checked$15954);}else{(other$16615=$15971$15997);throw $19608(["syntax","pattern"]).create("Illegal pattern",({"node":other$16615}));}}}}}}}}}}}}}}}}}}()));return (it$0$15931.opt.wrap_pattern||identity$15679)(__lt____lt____colon__$15672(rval$15965,pattern$15951),toplevel$15953);}else{$19867($15929$15941);}});$15577(PatternParser$15682,$15577(((accum$16623=({})),((accum$16623["::name"]="PatternParser"),accum$16623)),((accum$16627=({})),((accum$16627["::egclass"]=true),accum$16627))));PatternParser$15682;(PatternProcessor$15683=function(){var it$0$16636;(it$0$16636=function(){if((!$15557(PatternProcessor$15683)(this))){return Object.create(PatternProcessor$15683.prototype);}else{return this;}}());(it$0$16636["temps"]=[]);(it$0$16636["parts"]=[]);(it$0$16636["gen"]=GenSym$15674("t"));return it$0$16636;});(PatternProcessor$15683.prototype["do"]=function(part$16660){var it$0$16664;var self$16665;(it$0$16664=this);(self$16665=this);return it$0$16664.parts.push(["do",part$16660]);});(PatternProcessor$15683.prototype["check"]=function(){var part$16701;var tags$16702;var t0$16697;var $16680$16692;var it$0$16682;var self$16683;(it$0$16682=this);(self$16683=this);($16680$16692=arguments);(t0$16697=$16680$16692.length);if(((t0$16697>=1)&&(t0$16697<=2))){(part$16701=$16680$16692[0]);(tags$16702=function(){if((1>=t0$16697)){return ({});}else{return $16680$16692[1];}}());return it$0$16682.parts.push($19886(["check",part$16701],tags$16702));}else{$19867($16680$16692);}});(PatternProcessor$15683.prototype["temp"]=function(){var x$16769;var x$16775;var init$16782;var bridge$16749$16758;var $16747$16753;var x$16739;var v$16740;var t0$16735;var $16718$16730;var it$0$16720;var self$16721;(it$0$16720=this);(self$16721=this);($16718$16730=arguments);(t0$16735=$16718$16730.length);if(((t0$16735>=1)&&(t0$16735<=2))){(x$16739=$16718$16730[0]);(v$16740=function(){if((1>=t0$16735)){return null;}else{return $16718$16730[1];}}());($16747$16753=x$16739);(bridge$16749$16758=$16747$16753);if((((((x$16769=bridge$16749$16758)),((x$16769 instanceof Array)&&(x$16769[0]==="variable")))||(((x$16775=bridge$16749$16758)),((x$16775 instanceof Array)&&(x$16775[0]==="symbol"))))&&($19559($16747$16753,"single_assignment")&&($16747$16753.single_assignment&&(!v$16740))))){return x$16739;}else{(init$16782=$16747$16753);(v$16740=(v$16740||["symbol",it$0$16720.gen()]));(v$16740["single_assignment"]=true);it$0$16720.temps.push(v$16740);it$0$16720.do(["send",["symbol","="],["data",["send",["symbol","set"],v$16740],init$16782]]);return v$16740;}}else{$19867($16718$16730);}});(PatternProcessor$15683.prototype["process"]=function(pattern$16799,rhs$16800,fns$16801){var x$16854;var x$16888;var t$16901;var t$16913;var pp$16924;var $index$16957;var $length$16951;var temp$16945;var t$16935;var $index$17025;var $length$17019;var temp$17013;var acc$17007;var fn$16990;var parts$16991;var t$16983;var $index$17086;var $length$17080;var temp$17074;var acc$17068;var t$17059;var otherwise$17219;var $17197$17203;var $index$17236;var $length$17230;var temp$17224;var $index$17285;var $length$17279;var temp$17273;var end$17347;var pos$17341;var $index$17371;var $length$17365;var temp$17359;var acc$17353;var nfw$17152;var nbw$17153;var ndflt$17154;var extract_length$17155;var check_length$17156;var lo$17157;var hi$17158;var t$17159;var len$17160;var fw$17136;var bw$17137;var dflt$17138;var rest$17139;var subp$17054;var xs$16978;var xs$16930;var patt$16919;var projector$16907;var subp$16908;var checker$16895;var subp$16896;var checker$16883;var condition$16876;var subp$16877;var kind$16871;var sym$16861;var $16832$16845;var $16833$16846;var $16834$16847;var $16835$16848;var t0$16843;var $16819$16838;var rval$16816;var it$0$16805;var self$16806;(it$0$16805=this);(self$16806=this);(rval$16816=((($16819$16838=pattern$16799)),function(){if((((x$16854=$16819$16838)),((x$16854 instanceof Array)&&(x$16854[0]==="ignore")))){return it$0$16805.do(rhs$16800);}else{if((($16832$16845=($16819$16838 instanceof Array))&&(((t0$16843=$16819$16838.length)),(($16834$16847=(t0$16843===2))&&($16819$16838[0]==="assign"))))){(sym$16861=$16819$16838[1]);return it$0$16805.parts.push(fns$16801.assign(sym$16861,rhs$16800));}else{if(($16834$16847&&($16819$16838[0]==="special"))){(kind$16871=$16819$16838[1]);return it$0$16805.process(fns$16801.special(pattern$16799,rhs$16800),rhs$16800,fns$16801);}else{if(($16832$16845&&(($16834$16847=(t0$16843===3))&&($16819$16838[0]==="test")))){(condition$16876=$16819$16838[1]);(subp$16877=$16819$16838[2]);it$0$16805.process(subp$16877,rhs$16800,fns$16801);return it$0$16805.check(condition$16876,({"test":true}));}else{if(($16834$16847&&(($16835$16848=($16819$16838[0]==="check"))&&((checker$16883=$16819$16838[1]),(((x$16888=$16819$16838[2])),((x$16888 instanceof Array)&&(x$16888[0]==="ignore"))))))){return it$0$16805.check(["send",checker$16883,["data",rhs$16800]]);}else{if($16835$16848){(checker$16895=$16819$16838[1]);(subp$16896=$16819$16838[2]);(t$16901=it$0$16805.temp(rhs$16800));it$0$16805.check(["send",checker$16895,["data",t$16901]]);return it$0$16805.process(subp$16896,t$16901,fns$16801);}else{if(($16834$16847&&($16819$16838[0]==="project"))){(projector$16907=$16819$16838[1]);(subp$16908=$16819$16838[2]);(t$16913=it$0$16805.temp(["send",projector$16907,["data",rhs$16800]]));it$0$16805.check(["send",t$16913,["value",0]]);return it$0$16805.process(subp$16908,["send",t$16913,["value",1]],fns$16801);}else{if(($16832$16845&&((t0$16843===2)&&($16819$16838[0]==="neg")))){(patt$16919=$16819$16838[1]);return it$0$16805.check(["send",["symbol","not"],["data",["void"],(((pp$16924=PatternProcessor$15683())),pp$16924.process(patt$16919,rhs$16800,fns$16801),assemble_conditions$15684(pp$16924))]]);}else{if(($16832$16845&&(($16834$16847=(t0$16843>=1))&&($16819$16838[0]==="all")))){(xs$16930=Array.prototype.slice.call($16819$16838,1));(t$16935=it$0$16805.temp(rhs$16800));(temp$16945=xs$16930);($length$16951=temp$16945.length);($index$16957=0);$16936:for(;($index$16957<$length$16951);($index$16957++)){var x$16974;var m$16966;(m$16966=temp$16945[$index$16957]);(x$16974=m$16966);it$0$16805.process(x$16974,t$16935,fns$16801);}return null;}else{if(($16834$16847&&($16819$16838[0]==="any"))){(xs$16978=Array.prototype.slice.call($16819$16838,1));(t$16983=it$0$16805.temp(rhs$16800,["symbol",gensym$15675("bridge")]));return it$0$16805.check((((fn$16990=function(x$16996,rest$16997){return ["send",["symbol","or"],["data",x$16996,rest$16997]];})),((parts$16991=(((acc$17007=[])),(((temp$17013=xs$16978)),((($length$17019=temp$17013.length)),((($index$17025=0)),function(){$17002:for(;($index$17025<$length$17019);($index$17025++)){var pp$17047;var x$17042;var m$17034;(m$17034=temp$17013[$index$17025]);(x$17042=m$17034);acc$17007.push((((pp$17047=PatternProcessor$15683())),pp$17047.process(x$17042,t$16983,fns$16801),assemble_conditions$15684(pp$17047)));}}()))),acc$17007))),util$15673.construct(parts$16991,fn$16990,["symbol","false"])));}else{if(($16834$16847&&($16819$16838[0]==="object_pattern"))){(subp$17054=Array.prototype.slice.call($16819$16838,1));(t$17059=it$0$16805.temp(rhs$16800));(acc$17068=[]);(temp$17074=subp$17054);($length$17080=temp$17074.length);($index$17086=0);$17060:for(;($index$17086<$length$17080);($index$17086++)){var k$17107;var v$17108;var t0$17100;var t1$17101;var t2$17102;var t3$17103;var m$17095;(m$17095=temp$17074[$index$17086]);(t0$17100=m$17095);if(((t0$17100 instanceof Array)&&(((t1$17101=t0$17100.length)),((t1$17101===2)&&(((t2$17102=t0$17100[0])),((t2$17102 instanceof Array)&&(((t3$17103=t2$17102.length)),((t3$17103===2)&&(t2$17102[0]==="value"))))))))){(k$17107=t2$17102[1]);(v$17108=t0$17100[1]);acc$17068.push((it$0$16805.check(["send",["symbol","___hasprop"],["data",t$17059,["value",k$17107]]]),it$0$16805.process(v$17108,["send",t$17059,["value",k$17107]],fns$16801)));}else{$19867(m$17095,"/home/olivier/git/earl-grey/src/pattern.eg",8140,8272);}}return acc$17068;}else{if(($16832$16845&&((t0$16843===5)&&($16819$16838[0]==="array_pattern")))){(fw$17136=$16819$16838[1]);(bw$17137=$16819$16838[2]);(dflt$17138=$16819$16838[3]);(rest$17139=$16819$16838[4]);(nfw$17152=fw$17136.length);(nbw$17153=bw$17137.length);(ndflt$17154=dflt$17138.length);(extract_length$17155=true);(check_length$17156=true);(lo$17157=(nfw$17152+nbw$17153));(hi$17158=(lo$17157+ndflt$17154));(t$17159=it$0$16805.temp(rhs$16800));(len$17160=it$0$16805.temp(["send",t$17159,["send",["symbol","."],["data",["void"],["symbol","length"]]]]));it$0$16805.check(((($17197$17203=rest$17139)),function(){if($17197$17203){return ["send",["symbol",">="],["data",len$17160,["value",lo$17157]]];}else{$17197$17203;if((lo$17157===hi$17158)){return ["send",["symbol","==="],["data",len$17160,["value",lo$17157]]];}else{(otherwise$17219=$17197$17203);return ["send",["symbol","and"],["data",["send",["symbol",">="],["data",len$17160,["value",lo$17157]]],["send",["symbol","<="],["data",len$17160,["value",hi$17158]]]]];}}}()));(temp$17224=$19841(fw$17136));($length$17230=temp$17224.length);($index$17236=0);$17161:for(;($index$17236<$length$17230);($index$17236++)){var i$17255;var m$17256;var t0$17250;var t1$17251;var m$17245;(m$17245=temp$17224[$index$17236]);(t0$17250=m$17245);if(((t0$17250 instanceof Array)&&(((t1$17251=t0$17250.length)),(t1$17251===2)))){(i$17255=t0$17250[0]);(m$17256=t0$17250[1]);it$0$16805.process(m$17256,["send",t$17159,["value",i$17255]],fns$16801);}else{$19867(m$17245,"/home/olivier/git/earl-grey/src/pattern.eg",9004,9090);}}(temp$17273=$19841(dflt$17138));($length$17279=temp$17273.length);($index$17285=0);$17164:for(;($index$17285<$length$17279);($index$17285++)){var idx$17333;var i$17306;var patt$17307;var value$17308;var t0$17299;var t1$17300;var t2$17301;var t3$17302;var m$17294;(m$17294=temp$17273[$index$17285]);(t0$17299=m$17294);if(((t0$17299 instanceof Array)&&(((t1$17300=t0$17299.length)),((t1$17300===2)&&((i$17306=t0$17299[0]),(((t2$17301=t0$17299[1])),((t2$17301 instanceof Array)&&(((t3$17302=t2$17301.length)),(t3$17302===2))))))))){(patt$17307=t2$17301[0]);(value$17308=t2$17301[1]);(idx$17333=(i$17306+nfw$17152));it$0$16805.process(patt$17307,["send",["symbol","if"],["data",["send",["symbol",">="],["data",["value",(idx$17333+nbw$17153)],len$17160]],value$17308,["send",t$17159,["value",idx$17333]]]],fns$16801);}else{$19867(m$17294,"/home/olivier/git/earl-grey/src/pattern.eg",9090,9259);}}if((rest$17139!==(void 0))){(pos$17341=(nfw$17152+ndflt$17154));(end$17347=function(){if((nbw$17153>0)){return [["value",(-nbw$17153)]];}else{return [];}}());it$0$16805.process(rest$17139,["send",["send",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",t$17159,["value",pos$17341]].concat(end$17347)],fns$16801);}else{[];}(acc$17353=[]);(temp$17359=$19841(bw$17137));($length$17365=temp$17359.length);($index$17371=0);$17167:for(;($index$17371<$length$17365);($index$17371++)){var i$17390;var m$17391;var t0$17385;var t1$17386;var m$17380;(m$17380=temp$17359[$index$17371]);(t0$17385=m$17380);if(((t0$17385 instanceof Array)&&(((t1$17386=t0$17385.length)),(t1$17386===2)))){(i$17390=t0$17385[0]);(m$17391=t0$17385[1]);acc$17353.push(it$0$16805.process(m$17391,["send",["symbol","___js_fetch"],["data",t$17159,["send",["symbol","-"],["data",len$17160,["value",(nbw$17153-i$17390)]]]]],fns$16801));}else{$19867(m$17380,"/home/olivier/git/earl-grey/src/pattern.eg",9710,9861);}}return acc$17353;}else{$19867($16819$16838);}}}}}}}}}}}}}()));return rval$16816;});$15577(PatternProcessor$15683,$15577(((accum$17412=({})),((accum$17412["::name"]="PatternProcessor"),accum$17412)),((accum$17416=({})),((accum$17416["::egclass"]=true),accum$17416))));PatternProcessor$15683;(assemble_conditions$15684=function(pp$17423){var $index$17547;var $length$17541;var temp$17535;var acc$17529;var decls$17521;var construct$17427;(construct$17427=function($17431$17434){var x$17502;var rest$17503;var x$17487;var x$17471;var rest$17472;var $17441$17458;var $17442$17459;var t0$17454;var t1$17455;var t2$17456;var $17436$17449;var ph$17443;(ph$17443=$17431$17434);($17436$17449=ph$17443);if((($17441$17458=($17436$17449 instanceof Array))&&(((t0$17454=$17436$17449.length)),(t0$17454===0)))){return ["value",true];}else{if(($17441$17458&&((t0$17454>=1)&&(((t1$17455=$17436$17449[0])),((t1$17455 instanceof Array)&&(((t2$17456=t1$17455.length)),((t2$17456===2)&&(t1$17455[0]==="do")))))))){(x$17471=t1$17455[1]);(rest$17472=Array.prototype.slice.call($17436$17449,1));return ["multi",x$17471,construct$17427(rest$17472)];}else{if(($17441$17458&&((t0$17454===1)&&(((t1$17455=$17436$17449[0])),((t1$17455 instanceof Array)&&(((t2$17456=t1$17455.length)),((t2$17456===2)&&(t1$17455[0]==="check")))))))){(x$17487=t1$17455[1]);return x$17487;}else{if(($17441$17458&&((t0$17454>=1)&&(((t1$17455=$17436$17449[0])),((t1$17455 instanceof Array)&&(((t2$17456=t1$17455.length)),((t2$17456===2)&&(t1$17455[0]==="check")))))))){(x$17502=t1$17455[1]);(rest$17503=Array.prototype.slice.call($17436$17449,1));return ["send",["symbol","and"],["data",x$17502,construct$17427(rest$17503)]];}else{$19867($17436$17449);}}}}});if(pp$17423.temps.length){(decls$17521=(((acc$17529=[])),(((temp$17535=pp$17423.temps)),((($length$17541=temp$17535.length)),((($index$17547=0)),function(){$17524:for(;($index$17547<$length$17541);($index$17547++)){var t$17564;var m$17556;(m$17556=temp$17535[$index$17547]);(t$17564=m$17556);acc$17529.push(["declare",t$17564]);}}()))),acc$17529));return ["multi"].concat(decls$17521).concat([construct$17427(pp$17423.parts)]);}else{return construct$17427(pp$17423.parts);}});(assemble_pattern$15685=function(){var $index$17636;var $length$17630;var temp$17624;var $index$17697;var $length$17691;var temp$17685;var test$17836;var lead$17599;var trail$17600;var construct$17601;var parts$17586;var t$17587;var f$17588;var t0$17582;var $17573$17577;($17573$17577=arguments);(t0$17582=$17573$17577.length);if(((t0$17582>=2)&&(t0$17582<=3))){(parts$17586=$17573$17577[0]);(t$17587=$17573$17577[1]);(f$17588=function(){if((2>=t0$17582)){return null;}else{return $17573$17577[2];}}());(lead$17599=[]);(temp$17624=parts$17586.slice(0));($length$17630=temp$17624.length);($index$17636=0);$17602:for(;($index$17636<$length$17630);($index$17636++)){var x$17674;var x$17659;var $17606$17653;var $17607$17654;var $17608$17655;var $17609$17656;var t0$17650;var t1$17651;var m$17645;(m$17645=temp$17624[$index$17636]);(t0$17650=m$17645);if((($17607$17654=(t0$17650 instanceof Array))&&(((t1$17651=t0$17650.length)),(($17609$17656=(t1$17651===2))&&(t0$17650[0]==="do"))))){(x$17659=t0$17650[1]);lead$17599.push(x$17659);parts$17586.shift();}else{if(($17609$17656&&(t0$17650[0]==="check"))){(x$17674=t0$17650[1]);break $17602;}else{$19867(m$17645,"/home/olivier/git/earl-grey/src/pattern.eg",10322,10432);}}}(trail$17600=[]);(temp$17685=parts$17586.slice(0).reverse());($length$17691=temp$17685.length);($index$17697=0);$17610:for(;($index$17697<$length$17691);($index$17697++)){var x$17735;var x$17720;var $17614$17714;var $17615$17715;var $17616$17716;var $17617$17717;var t0$17711;var t1$17712;var m$17706;(m$17706=temp$17685[$index$17697]);(t0$17711=m$17706);if((($17615$17715=(t0$17711 instanceof Array))&&(((t1$17712=t0$17711.length)),(($17617$17717=(t1$17712===2))&&(t0$17711[0]==="do"))))){(x$17720=t0$17711[1]);trail$17600.unshift(x$17720);parts$17586.pop();}else{if(($17617$17717&&(t0$17711[0]==="check"))){(x$17735=t0$17711[1]);break $17610;}else{$19867(m$17706,"/home/olivier/git/earl-grey/src/pattern.eg",10446,10568);}}}(construct$17601=function($17743$17746){var other$17831;var x$17815;var rest$17816;var x$17800;var x$17784;var rest$17785;var $17754$17771;var $17755$17772;var t0$17767;var t1$17768;var t2$17769;var $17748$17762;var ph$17756;(ph$17756=$17743$17746);($17748$17762=ph$17756);if((($17754$17771=($17748$17762 instanceof Array))&&(((t0$17767=$17748$17762.length)),(t0$17767===0)))){return ["value",true];}else{if(($17754$17771&&((t0$17767>=1)&&(((t1$17768=$17748$17762[0])),((t1$17768 instanceof Array)&&(((t2$17769=t1$17768.length)),((t2$17769===2)&&(t1$17768[0]==="do")))))))){(x$17784=t1$17768[1]);(rest$17785=Array.prototype.slice.call($17748$17762,1));return ["multi",x$17784,construct$17601(rest$17785)];}else{if(($17754$17771&&((t0$17767===1)&&(((t1$17768=$17748$17762[0])),((t1$17768 instanceof Array)&&(((t2$17769=t1$17768.length)),((t2$17769===2)&&(t1$17768[0]==="check")))))))){(x$17800=t1$17768[1]);return x$17800;}else{if(($17754$17771&&((t0$17767>=1)&&(((t1$17768=$17748$17762[0])),((t1$17768 instanceof Array)&&(((t2$17769=t1$17768.length)),((t2$17769===2)&&(t1$17768[0]==="check")))))))){(x$17815=t1$17768[1]);(rest$17816=Array.prototype.slice.call($17748$17762,1));return ["send",["symbol","and"],["data",x$17815,construct$17601(rest$17816)]];}else{(other$17831=$17748$17762);throw $19608(["oops"]).create("?!?",other$17831);}}}}});if(parts$17586.length){(test$17836=construct$17601(parts$17586));return ["multi"].concat(lead$17599).concat([function(){if(f$17588){return ["send",["symbol","if"],["data",test$17836,["multi"].concat(trail$17600).concat([t$17587]),f$17588]];}else{return ["send",["symbol","if"],["data",test$17836,["multi"].concat(trail$17600).concat([t$17587])]];}}()]);}else{return ["multi"].concat(lead$17599).concat(trail$17600).concat([t$17587]);}}else{$19867($17573$17577);}});(inject_below_uses$15686=function($17846$17849,fn$17850){var other$17881;var scope$17870;var x$17871;var t0$17866;var $17852$17861;var ph$17855;(ph$17855=$17846$17849);($17852$17861=ph$17855);if((($17852$17861 instanceof Array)&&(((t0$17866=$17852$17861.length)),((t0$17866===3)&&($17852$17861[0]==="use"))))){(scope$17870=$17852$17861[1]);(x$17871=$17852$17861[2]);return ["use",scope$17870,inject_below_uses$15686(x$17871,fn$17850)];}else{(other$17881=$17852$17861);return fn$17850(other$17881);}});(parse_pattern$15687=function(scope$17888,pattern$17889,rhs$17890,opt$17891){var t0$17905;var $index$17957;var $length$17951;var temp$17945;var acc$17939;var parse$17897;var target$17898;var proc$17899;(parse$17897=PatternParser$15682(scope$17888,pattern$17889,opt$17891));if(((!opt$17891.allow_arguments)&&parse$17897.arguments.length)){throw $19608(["syntax","pattern","arguments"]).create("Arguments cannot be declared in this pattern",({"args":parse$17897.arguments[0]}));}(t0$17905=$19909((opt$17891.wrap_target||identity$15679))(function(){if(parse$17897.arguments.length){return inject_below_uses$15686(rhs$17890,function(x$17912){return util$15673.construct(parse$17897.arguments.concat([x$17912]),function(args$17916,rest$17917){return ["send",["symbol","->"],["data",args$17916,rest$17917]];});});}else{return rhs$17890;}}()));if(t0$17905[0]){(target$17898=t0$17905[1]);}else{$19867(function(){if(parse$17897.arguments.length){return inject_below_uses$15686(rhs$17890,function(x$17924){return util$15673.construct(parse$17897.arguments.concat([x$17924]),function(args$17928,rest$17929){return ["send",["symbol","->"],["data",args$17928,rest$17929]];});});}else{return rhs$17890;}}(),"/home/olivier/git/earl-grey/src/pattern.eg",11961,12394);}(proc$17899=PatternProcessor$15683());proc$17899.process(parse$17897.pattern,target$17898,opt$17891);if(opt$17891.finalize){return ["splice"].concat(opt$17891.declare(scope$17888,parse$17897.vars)).concat([["multi"].concat((((acc$17939=[])),(((temp$17945=proc$17899.temps)),((($length$17951=temp$17945.length)),((($index$17957=0)),function(){$17934:for(;($index$17957<$length$17951);($index$17957++)){var t$17974;var m$17966;(m$17966=temp$17945[$index$17957]);(t$17974=m$17966);acc$17939.push(["declare",t$17974]);}}()))),acc$17939)).concat([assemble_pattern$15685(proc$17899.parts,opt$17891.success(target$17898),opt$17891.failure(target$17898))])]);}else{return [parse$17897.vars,proc$17899.temps,proc$17899.parts];}});(checkall$15688=["send","data","multi","assign","void","check","do"]);(same_block$15689=function($17984$17987,ban1$17988,ban2$17989){var $index$18153;var $length$18147;var temp$18141;var other$18175;var type1$18114;var args1$18115;var type2$18116;var args2$18117;var m1$18097;var m2$18098;var v1$18080;var v2$18081;var s1$18063;var s2$18064;var v1$18031;var v2$18032;var $17998$18022;var $17999$18023;var $18000$18024;var $18001$18025;var $18002$18026;var $18003$18027;var $18004$18028;var t0$18016;var t1$18017;var t2$18018;var t3$18019;var t4$18020;var $17991$18011;var ph$18005;(ph$18005=$17984$17987);($17991$18011=ph$18005);if((($17998$18022=($17991$18011 instanceof Array))&&(((t0$18016=$17991$18011.length)),(($18000$18024=(t0$18016===2))&&(((t1$18017=$17991$18011[0])),(($18002$18026=(t1$18017 instanceof Array))&&(((t2$18018=t1$18017.length)),(($18004$18028=(t2$18018===2))&&((t1$18017[0]==="variable")&&((v1$18031=t1$18017[1]),(((t3$18019=$17991$18011[1])),((t3$18019 instanceof Array)&&(((t4$18020=t3$18019.length)),((t4$18020===2)&&(t3$18019[0]==="variable"))))))))))))))){(v2$18032=t3$18019[1]);return (v1$18031===v2$18032);}else{if(($18004$18028&&((t1$18017[0]==="symbol")&&((s1$18063=t1$18017[1]),(((t3$18019=$17991$18011[1])),((t3$18019 instanceof Array)&&(((t4$18020=t3$18019.length)),((t4$18020===2)&&(t3$18019[0]==="symbol"))))))))){(s2$18064=t3$18019[1]);return (((!$15576(ban1$17988,s1$18063))&&(!$15576(ban2$17989,s2$18064)))&&(s1$18063===s2$18064));}else{if(($18004$18028&&((t1$18017[0]==="value")&&((v1$18080=t1$18017[1]),(((t3$18019=$17991$18011[1])),((t3$18019 instanceof Array)&&(((t4$18020=t3$18019.length)),((t4$18020===2)&&(t3$18019[0]==="value"))))))))){(v2$18081=t3$18019[1]);return (v1$18080===v2$18081);}else{if(($18004$18028&&((t1$18017[0]==="macro")&&((m1$18097=t1$18017[1]),(((t3$18019=$17991$18011[1])),((t3$18019 instanceof Array)&&(((t4$18020=t3$18019.length)),((t4$18020===2)&&(t3$18019[0]==="macro"))))))))){(m2$18098=t3$18019[1]);return (m1$18097===m2$18098);}else{if(($18002$18026&&((t2$18018>=1)&&((type1$18114=t1$18017[0]),((args1$18115=Array.prototype.slice.call(t1$18017,1)),(((t3$18019=$17991$18011[1])),((t3$18019 instanceof Array)&&(((t4$18020=t3$18019.length)),((t4$18020>=1)&&((type2$18116=t3$18019[0]),((args2$18117=Array.prototype.slice.call(t3$18019,1)),(checkall$15688.indexOf(type1$18114)!==-1)))))))))))){if(((type1$18114===type2$18116)&&(args1$18115.length===args2$18117.length))){(temp$18141=$19956(args1$18115,args2$18117));($length$18147=temp$18141.length);($index$18153=0);$18135:for(;($index$18153<$length$18147);($index$18153++)){var pair$18170;var m$18162;(m$18162=temp$18141[$index$18153]);(pair$18170=m$18162);if((!same_block$15689(pair$18170,ban1$17988,ban2$17989))){return false;}}return true;}else{return false;}}else{(other$18175=$17991$18011);return false;}}}}}});(parse_clauses$15690=function(scope$18182,target$18183,stmts$18184,opt$18185){var $index$18225;var $length$18219;var temp$18213;var acc$18207;var $index$18471;var $length$18465;var temp$18459;var acc$18453;var $index$18534;var $length$18528;var temp$18522;var acc$18516;var decls$18508;var all_temps$18191;var the_parts$18192;var unique_temps$18193;(all_temps$18191=[]);(the_parts$18192=(((acc$18207=[])),(((temp$18213=scope$18182.step_all(["clause"],stmts$18184))),((($length$18219=temp$18213.length)),((($index$18225=0)),function(){$18199:for(;($index$18225<$length$18219);($index$18225++)){var accum$18337;var accum$18355;var t0$18329;var t1$18330;var $index$18382;var $length$18376;var temp$18370;var bod$18423;var placeholder$18264;var special_fn$18265;var vars$18266;var temps$18267;var blocks$18268;var vars2$18269;var x$18433;var other$18441;var b$18429;var pattern$18245;var body$18246;var $18204$18242;var t0$18239;var t1$18240;var m$18234;(m$18234=temp$18213[$index$18225]);(t0$18239=m$18234);if(((t0$18239 instanceof Array)&&(((t1$18240=t0$18239.length)),((t1$18240===3)&&(t0$18239[0]==="clause"))))){(pattern$18245=t0$18239[1]);(body$18246=t0$18239[2]);acc$18207.push((((placeholder$18264=(void 0))),((special_fn$18265=function($18280$18283,value$18284){var t0$18292;var t1$18293;var other$18325;var $18286$18308;var ph$18289;var expr$18290;(t0$18292=$18280$18283);if(((t0$18292 instanceof Array)&&(((t1$18293=t0$18292.length)),((t1$18293===2)&&(t0$18292[0]==="special"))))){(ph$18289=t0$18292[1]);(expr$18290=t0$18292);}else{$19867($18280$18283);}($18286$18308=ph$18289);if(($18286$18308==="match")){(placeholder$18264=__lt____lt____colon__$15672(["symbol",scope$18182.gensym("ph")],expr$18290));return ["assign",placeholder$18264];}else{(other$18325=$18286$18308);throw $19608(["syntax","pattern","special"]).create("Special token cannot be used here",({"special":expr$18290}));}})),(((t0$18329=parse_pattern$15687(scope$18182,pattern$18245,target$18183,$19886(opt$18185,$15577(({"allow_arguments":false,"allow_nested":true,"special":special_fn$18265}),$15577(((accum$18337=({})),((accum$18337["assign"]=function(v$18342,value$18343){return ["do",__lt____lt____colon__$15672(["assign",v$18342,value$18343],v$18342)];}),accum$18337)),({"finalize":false}))))))),function(){if(((t0$18329 instanceof Array)&&(((t1$18330=t0$18329.length)),(t1$18330===3)))){(vars$18266=t0$18329[0]);(temps$18267=t0$18329[1]);(blocks$18268=t0$18329[2]);}else{return $19867(parse_pattern$15687(scope$18182,pattern$18245,target$18183,$19886(opt$18185,$15577(({"allow_arguments":false,"allow_nested":true,"special":special_fn$18265}),$15577(((accum$18355=({})),((accum$18355["assign"]=function(v$18360,value$18361){return ["do",__lt____lt____colon__$15672(["assign",v$18360,value$18361],v$18360)];}),accum$18355)),({"finalize":false}))))),"/home/olivier/git/earl-grey/src/pattern.eg",14032,14379);}}()),(all_temps$18191=all_temps$18191.concat(temps$18267)),function(){if(placeholder$18264){return vars$18266.push(placeholder$18264);}}(),((vars2$18269=({}))),(((temp$18370=vars$18266)),((($length$18376=temp$18370.length)),((($index$18382=0)),function(){$18270:for(;($index$18382<$length$18376);($index$18382++)){var other$18419;var xxx$18401;var t0$18396;var t1$18397;var m$18391;(m$18391=temp$18370[$index$18382]);(t0$18396=m$18391);if(((t0$18396 instanceof Array)&&(((t1$18397=t0$18396.length)),((t1$18397===2)&&(t0$18396[0]==="symbol"))))){(xxx$18401=t0$18396[1]);(vars2$18269[xxx$18401]=true);}else{(other$18419=m$18391);throw $19608(["syntax","unexpected"]).create();}}}()))),(((bod$18423=function(){if(placeholder$18264){return parse_clauses$15690(scope$18182,placeholder$18264,$19909(["multi"])(body$18246)[1],opt$18185);}else{if(opt$18185.wrap){return opt$18185.wrap(body$18246);}else{return body$18246;}}}())),["clause",vars$18266,vars2$18269,blocks$18268,bod$18423])));}else{if((((x$18433=t0$18239)),((x$18433 instanceof Array)&&(x$18433[0]==="block")))){(b$18429=t0$18239);acc$18207.push(b$18429);}else{(other$18441=m$18234);acc$18207.push(function(){throw $19608(["syntax","clause"]).create("Illegal clause",({"clause":other$18441}));}());}}}}()))),acc$18207));if(opt$18185.fallback){the_parts$18192.push(["block",opt$18185.fallback(target$18183)]);}(unique_temps$18193=$19908(util$15673.mkset((((acc$18453=[])),(((temp$18459=all_temps$18191)),((($length$18465=temp$18459.length)),((($index$18471=0)),function(){$18448:for(;($index$18471<$length$18465);($index$18471++)){var t$18490;var t0$18485;var t1$18486;var m$18480;(m$18480=temp$18459[$index$18471]);(t0$18485=m$18480);if(((t0$18485 instanceof Array)&&(((t1$18486=t0$18485.length)),((t1$18486===2)&&(t0$18485[0]==="symbol"))))){(t$18490=t0$18485[1]);acc$18453.push(t$18490);}else{$19867(m$18480,"/home/olivier/git/earl-grey/src/pattern.eg",15188,15218);}}}()))),acc$18453))));(decls$18508=(((acc$18516=[])),(((temp$18522=unique_temps$18193)),((($length$18528=temp$18522.length)),((($index$18534=0)),function(){$18511:for(;($index$18534<$length$18528);($index$18534++)){var t$18551;var m$18543;(m$18543=temp$18522[$index$18534]);(t$18551=m$18543);acc$18516.push(["declare",$15577(["symbol",t$18551],({"mutable":true}))]);}}()))),acc$18516));return ["multi"].concat(decls$18508).concat([weave_clauses$15692(the_parts$18192)]);});(opt_clauses$15691=function(clauses$18560){var $index$18600;var $length$18594;var temp$18588;var acc$18582;var $index$18784;var $length$18778;var temp$18772;var acc$18766;var $index$18844;var $length$18838;var temp$18832;var acc$18826;var $index$18896;var $length$18890;var temp$18884;var acc$18878;var shares$18569;var max$18570;var temps$18571;var shared_last$18572;var idx_last$18573;var new_clauses$18574;(shares$18569=(((acc$18582=[])),(((temp$18588=$19841(clauses$18560.slice(1)))),((($length$18594=temp$18588.length)),((($index$18600=0)),function(){$18577:for(;($index$18600<$length$18594);($index$18600++)){var t0$18661;var t1$18662;var $index$18696;var $length$18690;var temp$18684;var varsd0$18653;var blocks0$18654;var share$18655;var idx$18656;var i$18621;var vars$18622;var varsd$18623;var blocks$18624;var body$18625;var t0$18614;var t1$18615;var t2$18616;var t3$18617;var m$18609;(m$18609=temp$18588[$index$18600]);(t0$18614=m$18609);if(((t0$18614 instanceof Array)&&(((t1$18615=t0$18614.length)),((t1$18615===2)&&((i$18621=t0$18614[0]),(((t2$18616=t0$18614[1])),((t2$18616 instanceof Array)&&(((t3$18617=t2$18616.length)),((t3$18617===5)&&(t2$18616[0]==="clause")))))))))){(vars$18622=t2$18616[1]);(varsd$18623=t2$18616[2]);(blocks$18624=t2$18616[3]);(body$18625=t2$18616[4]);acc$18582.push(((((t0$18661=$15576(clauses$18560,i$18621))),function(){if(((t0$18661 instanceof Array)&&(((t1$18662=t0$18661.length)),((t1$18662===5)&&(t0$18661[0]==="clause"))))){t0$18661[1];(varsd0$18653=t0$18661[2]);(blocks0$18654=t0$18661[3]);t0$18661[4];}else{return $19867($15576(clauses$18560,i$18621),"/home/olivier/git/earl-grey/src/pattern.eg",15511,15531);}}()),((share$18655=0)),((idx$18656=0)),(((temp$18684=blocks$18624)),((($length$18690=temp$18684.length)),((($index$18696=0)),function(){$18657:for(;($index$18696<$length$18690);($index$18696++)){var x$18733;var x$18743;var other$18754;var $18716$18722;var b$18713;var m$18705;(m$18705=temp$18684[$index$18696]);(b$18713=m$18705);if(same_block$15689([$15576(blocks0$18654,share$18655),b$18713],varsd0$18653,varsd$18623)){(share$18655++);($18716$18722=b$18713);if((((x$18733=$18716$18722)),((x$18733 instanceof Array)&&(x$18733[0]==="do")))){null;}else{if((((x$18743=$18716$18722)),((x$18743 instanceof Array)&&(x$18743[0]==="check")))){(idx$18656=share$18655);}else{(other$18754=$18716$18722);__lt____gt__$15670(null,other$18754);}}}else{break $18657;}}}()))),[share$18655,idx$18656]));}else{$19867(m$18609,"/home/olivier/git/earl-grey/src/pattern.eg",15387,15915);}}}()))),acc$18582));(max$18570=$15576(Math.max,(((acc$18766=[])),(((temp$18772=shares$18569)),((($length$18778=temp$18772.length)),((($index$18784=0)),function(){$18761:for(;($index$18784<$length$18778);($index$18784++)){var x$18803;var t0$18798;var t1$18799;var m$18793;(m$18793=temp$18772[$index$18784]);(t0$18798=m$18793);if(((t0$18798 instanceof Array)&&(((t1$18799=t0$18798.length)),(t1$18799===2)))){(x$18803=t0$18798[0]);t0$18798[1];acc$18766.push(x$18803);}else{$19867(m$18793,"/home/olivier/git/earl-grey/src/pattern.eg",15929,15958);}}}()))),acc$18766)));shares$18569.push([0,0]);(temps$18571=(((acc$18826=[])),(((temp$18832=$20020(1,max$18570))),((($length$18838=temp$18832.length)),((($index$18844=0)),function(){$18821:for(;($index$18844<$length$18838);($index$18844++)){var m$18853;(m$18853=temp$18832[$index$18844]);m$18853;acc$18826.push(["symbol",gensym$15675()]);}}()))),acc$18826));(shared_last$18572=0);(idx_last$18573=0);(new_clauses$18574=(((acc$18878=[])),(((temp$18884=$19841(clauses$18560))),((($length$18890=temp$18884.length)),((($index$18896=0)),function(){$18872:for(;($index$18896<$length$18890);($index$18896++)){var t0$18958;var t1$18959;var $index$19008;var $length$19002;var temp$18996;var acc$18990;var rest$19092;var newblocks$19087;var share$18952;var idx$18953;var shared$18954;var n_to_share$18955;var to_share$18956;var other$19099;var i$18917;var vars$18918;var varsd$18919;var blocks$18920;var body$18921;var t0$18910;var t1$18911;var t2$18912;var t3$18913;var m$18905;(m$18905=temp$18884[$index$18896]);(t0$18910=m$18905);if(((t0$18910 instanceof Array)&&(((t1$18911=t0$18910.length)),((t1$18911===2)&&((i$18917=t0$18910[0]),(((t2$18912=t0$18910[1])),((t2$18912 instanceof Array)&&(((t3$18913=t2$18912.length)),((t3$18913===5)&&(t2$18912[0]==="clause")))))))))){(vars$18918=t2$18912[1]);(varsd$18919=t2$18912[2]);(blocks$18920=t2$18912[3]);(body$18921=t2$18912[4]);acc$18878.push(((((t0$18958=$15576(shares$18569,i$18917))),function(){if(((t0$18958 instanceof Array)&&(((t1$18959=t0$18958.length)),(t1$18959===2)))){(share$18952=t0$18958[0]);(idx$18953=t0$18958[1]);}else{return $19867($15576(shares$18569,i$18917),"/home/olivier/git/earl-grey/src/pattern.eg",16187,16206);}}()),((shared$18954=function(){if(idx_last$18573){return [["check",$15576(temps$18571,(idx_last$18573-1))]];}else{return [];}}())),((n_to_share$18955=Math.max(shared_last$18572,share$18952))),((to_share$18956=(((acc$18990=[])),(((temp$18996=$19841(blocks$18920.slice(shared_last$18572,n_to_share$18955)))),((($length$19002=temp$18996.length)),((($index$19008=0)),function(){$18980:for(;($index$19008<$length$19002);($index$19008++)){var j$19060;var x$19061;var j$19033;var x$19034;var $18984$19027;var $18985$19028;var $18986$19029;var $18987$19030;var t0$19022;var t1$19023;var t2$19024;var t3$19025;var m$19017;(m$19017=temp$18996[$index$19008]);(t0$19022=m$19017);if((($18985$19028=(t0$19022 instanceof Array))&&(((t1$19023=t0$19022.length)),(($18987$19030=(t1$19023===2))&&((j$19033=t0$19022[0]),(((t2$19024=t0$19022[1])),((t2$19024 instanceof Array)&&(((t3$19025=t2$19024.length)),((t3$19025===2)&&(t2$19024[0]==="check")))))))))){(x$19034=t2$19024[1]);acc$18990.push(["check",["assign",$15576(temps$18571,(shared_last$18572+j$19033)),x$19034]]);}else{if(($18987$19030&&((j$19060=t0$19022[0]),(((t2$19024=t0$19022[1])),((t2$19024 instanceof Array)&&(((t3$19025=t2$19024.length)),((t3$19025===2)&&(t2$19024[0]==="do")))))))){(x$19061=t2$19024[1]);acc$18990.push(["do",x$19061]);}else{$19867(m$19017,"/home/olivier/git/earl-grey/src/pattern.eg",16335,16506);}}}}()))),acc$18990))),((shared_last$18572=share$18952)),((idx_last$18573=idx$18953)),(((newblocks$19087=(((rest$19092=blocks$18920.slice(n_to_share$18955))),shared$18954.concat(to_share$18956).concat(rest$19092)))),["clause",vars$18918,varsd$18919,newblocks$19087,body$18921])));}else{(other$19099=m$18905);acc$18878.push(function(){throw $19608(["oops"]).create("what",({"value":other$19099}));}());}}}()))),acc$18878));return [temps$18571,new_clauses$18574];});(weave_clauses$15692=function(parts$19108){var $index$19173;var $length$19167;var temp$19161;var $index$19437;var $length$19431;var temp$19425;var acc$19419;var groups$19115;var reassemble$19116;var new_temps$19117;var helper$19118;(groups$19115=classify_contiguous$15678(parts$19108,function($19130$19133){var t0$19137;var t1$19138;var cls$19135;(t0$19137=$19130$19133);if(((t0$19137 instanceof Array)&&(((t1$19138=t0$19137.length)),(t1$19138>=1)))){(cls$19135=t0$19137[0]);Array.prototype.slice.call(t0$19137,1);}else{$19867($19130$19133);}return cls$19135;}));(reassemble$19116=[]);(new_temps$19117=[]);(temp$19161=groups$19115);($length$19167=temp$19161.length);($index$19173=0);$19119:for(;($index$19173<$length$19167);($index$19173++)){var t0$19213;var t1$19214;var ts$19210;var new_clauses$19211;var elems$19229;var elems$19196;var $19123$19190;var $19124$19191;var $19125$19192;var $19126$19193;var t0$19187;var t1$19188;var m$19182;(m$19182=temp$19161[$index$19173]);(t0$19187=m$19182);if((($19124$19191=(t0$19187 instanceof Array))&&(((t1$19188=t0$19187.length)),(($19126$19193=(t1$19188>=1))&&(t0$19187[0]==="clause"))))){(elems$19196=Array.prototype.slice.call(t0$19187,1));(t0$19213=opt_clauses$15691(elems$19196));if(((t0$19213 instanceof Array)&&(((t1$19214=t0$19213.length)),(t1$19214===2)))){(ts$19210=t0$19213[0]);(new_clauses$19211=t0$19213[1]);}else{$19867(opt_clauses$15691(elems$19196),"/home/olivier/git/earl-grey/src/pattern.eg",17015,17043);}(new_temps$19117=new_temps$19117.concat(ts$19210));(reassemble$19116=reassemble$19116.concat(new_clauses$19211));}else{if(($19126$19193&&(t0$19187[0]==="block"))){(elems$19229=Array.prototype.slice.call(t0$19187,1));(reassemble$19116=reassemble$19116.concat(elems$19229));}else{$19867(m$19182,"/home/olivier/git/earl-grey/src/pattern.eg",16949,17154);}}}(helper$19118=function($19237$19240){var $index$19353;var $length$19347;var temp$19341;var acc$19335;var decls$19327;var vars$19318;var varsd$19319;var blocks$19320;var body$19321;var rest$19322;var body$19287;var rest$19288;var $19246$19270;var $19247$19271;var $19248$19272;var $19249$19273;var $19250$19274;var $19251$19275;var t0$19263;var t1$19264;var t2$19265;var t3$19266;var t4$19267;var t5$19268;var $19242$19258;var ph$19252;(ph$19252=$19237$19240);($19242$19258=ph$19252);if((($19246$19270=($19242$19258 instanceof Array))&&(((t0$19263=$19242$19258.length)),(t0$19263===0)))){return ["multi"];}else{if(($19246$19270&&(($19248$19272=(t0$19263>=1))&&(((t1$19264=$19242$19258[0])),(($19250$19274=(t1$19264 instanceof Array))&&(((t2$19265=t1$19264.length)),((t2$19265===2)&&((t1$19264[0]==="block")&&(((t3$19266=$19909(["multi"])(t1$19264[1]))),(t3$19266[0]&&(((t4$19267=t3$19266[1])),(((t5$19268=t4$19267.length)),(t5$19268>=0))))))))))))){(body$19287=Array.prototype.slice.call(t4$19267,0));(rest$19288=Array.prototype.slice.call($19242$19258,1));return ["multi"].concat(body$19287).concat([helper$19118(rest$19288)]);}else{if(($19250$19274&&((t2$19265===5)&&(t1$19264[0]==="clause")))){(vars$19318=t1$19264[1]);(varsd$19319=t1$19264[2]);(blocks$19320=t1$19264[3]);(body$19321=t1$19264[4]);(rest$19322=Array.prototype.slice.call($19242$19258,1));(decls$19327=(((acc$19335=[])),(((temp$19341=vars$19318)),((($length$19347=temp$19341.length)),((($index$19353=0)),function(){$19330:for(;($index$19353<$length$19347);($index$19353++)){var bridge$19378$19386;var $19373$19381;var v$19370;var m$19362;(m$19362=temp$19341[$index$19353]);(v$19370=m$19362);acc$19335.push(((($19373$19381=v$19370.declare_mode)),function(){if(($19373$19381==="set")){return ["splice"];}else{if(($19373$19381==="let")){return ["declare",$19886(v$19370,({"mutable":false}))];}else{if(($19373$19381==="var")){return ["declare",$19886(v$19370,({"mutable":true}))];}else{(bridge$19378$19386=$19373$19381);if(((bridge$19378$19386==="unqualified")||(bridge$19378$19386===(void 0)))){return ["declare",$19886(v$19370,({"mutable":false}))];}else{$19867($19373$19381);}}}}}()));}}()))),acc$19335));return ["tagscope","back",["multi"].concat(decls$19327).concat([assemble_pattern$15685(blocks$19320,body$19321,["use","back",helper$19118(rest$19322)])])];}else{$19867($19242$19258);}}}});return ["multi"].concat((((acc$19419=[])),(((temp$19425=new_temps$19117)),((($length$19431=temp$19425.length)),((($index$19437=0)),function(){$19414:for(;($index$19437<$length$19431);($index$19437++)){var t$19454;var m$19446;(m$19446=temp$19425[$index$19437]);(t$19454=m$19446);acc$19419.push(["declare",t$19454]);}}()))),acc$19419)).concat([helper$19118(reassemble$19116)]);});(exports["PatternParser"]=PatternParser$15682);(exports["PatternProcessor"]=PatternProcessor$15683);(exports["parse_clauses"]=parse_clauses$15690);(exports["parse_pattern"]=parse_pattern$15687);
