require("earlgrey-runtime");
var $14721=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});var accum$11869;var accum$11873;var accum$12658;var accum$12662;var $10881$10915;var __lt____gt__$10916;var $10882$10917;var __lt____lt____colon__$10918;var util$10919;var GenSym$10920;var gensym$10921;var classify$10922;var classify_contiguous$10923;var identity$10924;var Body$10925;var $10884$10926;var checker_db$10927;var PatternParser$10928;var PatternProcessor$10929;var assemble_conditions$10930;var assemble_pattern$10931;var inject_below_uses$10932;var parse_pattern$10933;var checkall$10934;var same_block$10935;var parse_clauses$10936;var opt_clauses$10937;var weave_clauses$10938;($10881$10915=require("./pp"));(__lt____gt__$10916=$10881$10915["<>"]);($10882$10917=require("./location"));(__lt____lt____colon__$10918=$10882$10917["<<:"]);(util$10919=require("./util"));(GenSym$10920=util$10919.GenSym);(gensym$10921=util$10919.gensym);(classify$10922=util$10919.classify);(classify_contiguous$10923=util$10919.classify_contiguous);(identity$10924=util$10919.identity);(Body$10925=util$10919.Body);($10884$10926=require("./expand"));(checker_db$10927=$10884$10926.checker_db);(PatternParser$10928=(function(scope$10982,pattern$10983,opt$10984){var tags$11000;var it$0$10987;(it$0$10987=(function(){if((!getChecker(PatternParser$10928)(this))){return Object.create(PatternParser$10928.prototype);}else{return this;}})());(it$0$10987["opt"]=opt$10984);(it$0$10987["arguments"]=[]);(it$0$10987["vars"]=[]);(it$0$10987["specials"]=({}));(tags$11000=clone((opt$10984.tags||({}))));(tags$11000["group_id"]=(tags$11000.group_id||gensym$10921("group")));(it$0$10987["pattern"]=it$0$10987.expand(scope$10982,pattern$10983,tags$11000,true,it$0$10987.opt.indexable));return it$0$10987;}));(PatternParser$10928.prototype["parse_specs"]=(function(scope$11024,specs$11025,tags$11026){var $index$11087;var $length$11081;var temp$11075;var acc$11069;var rest$11044;var has_defaults$11045;var rval$11046;var it$0$11030;var self$11031;(it$0$11030=this);(self$11031=this);(rest$11044=(void 0));(has_defaults$11045=false);(rval$11046=classify$10922("fw","bw","keys","defaults",(((acc$11069=[])),(((temp$11075=scope$11024.step_all(["pattern"],specs$11025))),((($length$11081=temp$11075.length)),((($index$11087=0)),(function(){$11055:for(;($index$11087<$length$11081);($index$11087++)){var v$11161;var v$11155;var variable$11143;var value$11144;var key$11136;var subp$11137;var key$11130;var variable$11110;var $11063$11104;var $11064$11105;var $11065$11106;var $11066$11107;var t0$11101;var t1$11102;var m$11096;(m$11096=temp$11075[$index$11087]);(t0$11101=m$11096);if((($11064$11105=(t0$11101 instanceof Array))&&(((t1$11102=t0$11101.length)),(($11066$11107=(t1$11102===2))&&(t0$11101[0]==="dynsplice"))))){(variable$11110=t0$11101[1]);acc$11069.push((((rest$11044=it$0$11030.expand(scope$11024,variable$11110,tags$11026))),["ignore"]));}else{if(($11066$11107&&(t0$11101[0]==="assoc"))){(key$11130=t0$11101[1]);acc$11069.push(["keys",[key$11130,it$0$11030.expand(scope$11024,key$11130,tags$11026)]]);}else{if(($11064$11105&&(($11066$11107=(t1$11102===3))&&(t0$11101[0]==="assoc")))){(key$11136=t0$11101[1]);(subp$11137=t0$11101[2]);acc$11069.push(["keys",[key$11136,it$0$11030.expand(scope$11024,subp$11137,tags$11026)]]);}else{if(($11066$11107&&(t0$11101[0]==="default"))){(variable$11143=t0$11101[1]);(value$11144=t0$11101[2]);acc$11069.push((((has_defaults$11045=true)),(function(){if(rest$11044){throw ErrorFactory(["syntax","pattern"]).create("No default arguments after rest arg.");}else{return ["defaults",[it$0$11030.expand(scope$11024,variable$11143,tags$11026),value$11144]];}})()));}else{(v$11155=m$11096);if(((rest$11044===(void 0))&&(!has_defaults$11045))){acc$11069.push(["fw",it$0$11030.expand(scope$11024,v$11155,tags$11026)]);}else{(v$11161=m$11096);acc$11069.push(["bw",it$0$11030.expand(scope$11024,v$11161,tags$11026)]);}}}}}}})()))),acc$11069)));(rval$11046["rest"]=rest$11044);return rval$11046;}));(PatternParser$10928.prototype["expand"]=(function(){var x$11261;var x$11271;var x$11300;var x$11306;var variable$11313;var variable$11330;var x$11370;var msg$11378;var msg$11394;var $index$11436;var $length$11430;var temp$11424;var acc$11418;var $index$11569;var $length$11563;var temp$11557;var acc$11551;var $index$11605;var $length$11599;var temp$11593;var t0$11680;var t1$11681;var t2$11682;var $index$11728;var $length$11722;var temp$11716;var acc$11710;var patts$11702;var canon$11466;var normalize$11467;var pps$11468;var vars$11469;var patt$11803;var msg$11849;var other$11845;var keys$11809;var fw$11782;var bw$11783;var defaults$11784;var rest$11785;var $11760$11779;var t0$11772;var t1$11773;var t2$11774;var t3$11775;var t4$11776;var t5$11777;var $11756$11767;var specs$11761;var other$11861;var mode$11855;var subp$11856;var args$11751;var xs$11458;var xs$11410;var x$11400;var f$11384;var arg$11385;var f$11359;var arguments$11360;var checker$11353;var subp$11354;var projector$11347;var subp$11348;var condition$11341;var subp$11342;var v$11336;var v$11319;var type$11278;var $11237$11252;var $11238$11253;var $11239$11254;var $11240$11255;var t0$11248;var bridge$11222$11249;var t1$11250;var $11217$11243;var expr$11210;var rval$11211;var scope$11196;var pattern$11197;var tags$11198;var toplevel$11199;var checked$11200;var t0$11192;var $11175$11187;var it$0$11177;var self$11178;(it$0$11177=this);(self$11178=this);($11175$11187=arguments);(t0$11192=$11175$11187.length);if(((t0$11192>=3)&&(t0$11192<=5))){(scope$11196=$11175$11187[0]);(pattern$11197=$11175$11187[1]);(tags$11198=$11175$11187[2]);(toplevel$11199=(function(){if((3>=t0$11192)){return false;}else{return $11175$11187[3];}})());(checked$11200=(function(){if((4>=t0$11192)){return false;}else{return $11175$11187[4];}})());(expr$11210=scope$11196.step(["pattern"],pattern$11197));(rval$11211=((($11217$11243=expr$11210)),(function(){if((((x$11261=$11217$11243)),((x$11261 instanceof Array)&&(x$11261[0]==="void")))){return ["check",checker_db$10927.null,["ignore"]];}else{if((((x$11271=$11217$11243)),((x$11271 instanceof Array)&&(x$11271[0]==="ignore")))){return expr$11210;}else{if((($11217$11243 instanceof Array)&&(((t0$11248=$11217$11243.length)),((t0$11248===2)&&($11217$11243[0]==="special"))))){(type$11278=$11217$11243[1]);(it$0$11177.specials[type$11278]=true);return expr$11210;}else{(bridge$11222$11249=$11217$11243);if(((((x$11300=bridge$11222$11249)),((x$11300 instanceof Array)&&(x$11300[0]==="symbol")))||(((x$11306=bridge$11222$11249)),((x$11306 instanceof Array)&&(x$11306[0]==="variable"))))){(variable$11313=__amp__(expr$11210,tags$11198));it$0$11177.vars.push(variable$11313);return ["assign",variable$11313];}else{if((($11237$11252=($11217$11243 instanceof Array))&&(((t0$11248=$11217$11243.length)),(($11239$11254=(t0$11248===2))&&(($11240$11255=($11217$11243[0]==="value"))&&((v$11319=$11217$11243[1]),it$0$11177.opt.strings_as_variables)))))){(variable$11330=__lt____lt____colon__$10918(__amp__(["symbol",v$11319],tags$11198),expr$11210));it$0$11177.vars.push(variable$11330);return ["assign",variable$11330];}else{if($11240$11255){(v$11336=$11217$11243[1]);return ["check",checker_db$10927(v$11336),["ignore"]];}else{if(($11237$11252&&(($11239$11254=(t0$11248===3))&&($11217$11243[0]==="test")))){(condition$11341=$11217$11243[1]);(subp$11342=$11217$11243[2]);return ["test",condition$11341,it$0$11177.expand(scope$11196,subp$11342,tags$11198,toplevel$11199,false)];}else{if(($11239$11254&&($11217$11243[0]==="project"))){(projector$11347=$11217$11243[1]);(subp$11348=$11217$11243[2]);return ["project",projector$11347,it$0$11177.expand(scope$11196,subp$11348,tags$11198,toplevel$11199,true)];}else{if(($11239$11254&&($11217$11243[0]==="check"))){(checker$11353=$11217$11243[1]);(subp$11354=$11217$11243[2]);return ["check",checker$11353,it$0$11177.expand(scope$11196,subp$11354,tags$11198,toplevel$11199,true)];}else{if(($11239$11254&&(($11240$11255=($11217$11243[0]==="send"))&&((f$11359=$11217$11243[1]),(((t1$11250=$11217$11243[2])),(((x$11370=t1$11250)),((x$11370 instanceof Array)&&(x$11370[0]==="data")))))))){(arguments$11360=t1$11250);if(toplevel$11199){it$0$11177.arguments.unshift(arguments$11360);return it$0$11177.expand(scope$11196,f$11359,tags$11198,true,false);}else{(msg$11378="Function arguments can only be declared as a top level pattern.");throw ErrorFactory(["syntax","pattern"]).create(msg$11378,({"node":expr$11210,"arg":arguments$11360}));}}else{if($11240$11255){(f$11384=$11217$11243[1]);(arg$11385=$11217$11243[2]);return ["assign",expr$11210];}else{$11217$11243;if((!it$0$11177.opt.allow_nested)){(msg$11394="Nested patterns are not allowed here.");throw ErrorFactory(["syntax","pattern"]).create(msg$11394,({"node":expr$11210}));}else{if((($11237$11252=($11217$11243 instanceof Array))&&(((t0$11248=$11217$11243.length)),((t0$11248===2)&&($11217$11243[0]==="neg"))))){(x$11400=$11217$11243[1]);return ["neg",it$0$11177.expand(scope$11196,x$11400,tags$11198)];}else{if(($11237$11252&&(($11239$11254=(t0$11248>=1))&&($11217$11243[0]==="all")))){(xs$11410=Array.prototype.slice.call($11217$11243,1));return ["all"].concat((((acc$11418=[])),(((temp$11424=xs$11410)),((($length$11430=temp$11424.length)),((($index$11436=0)),(function(){$11413:for(;($index$11436<$length$11430);($index$11436++)){var x$11453;var m$11445;(m$11445=temp$11424[$index$11436]);(x$11453=m$11445);acc$11418.push(it$0$11177.expand(scope$11196,x$11453,tags$11198));}})()))),acc$11418));}else{if(($11239$11254&&($11217$11243[0]==="any"))){(xs$11458=Array.prototype.slice.call($11217$11243,1));(canon$11466=(function(all$11477){return all$11477.sort().join(",");}));(normalize$11467=(function(vars$11484){var $index$11509;var $length$11503;var temp$11497;var acc$11491;return canon$11466((((acc$11491=[])),(((temp$11497=vars$11484)),((($length$11503=temp$11497.length)),((($index$11509=0)),(function(){$11486:for(;($index$11509<$length$11503);($index$11509++)){var v$11528;var t0$11523;var t1$11524;var m$11518;(m$11518=temp$11497[$index$11509]);(t0$11523=m$11518);if(((t0$11523 instanceof Array)&&(((t1$11524=t0$11523.length)),((t1$11524===2)&&(t0$11523[0]==="symbol"))))){(v$11528=t0$11523[1]);acc$11491.push(v$11528);}else{___match_error(m$11518,"/home/olivier/git/eg/src/pattern.eg",3879,3917);}}})()))),acc$11491));}));(pps$11468=(((acc$11551=[])),(((temp$11557=xs$11458)),((($length$11563=temp$11557.length)),((($index$11569=0)),(function(){$11546:for(;($index$11569<$length$11563);($index$11569++)){var x$11586;var m$11578;(m$11578=temp$11557[$index$11569]);(x$11586=m$11578);acc$11551.push(PatternParser$10928(scope$11196,x$11586,__amp__(it$0$11177.opt,({"tags":tags$11198}))));}})()))),acc$11551));(temp$11593=neighbours(pps$11468));($length$11599=temp$11593.length);($index$11605=0);$11470:for(;($index$11605<$length$11599);($index$11605++)){var $index$11656;var $length$11650;var temp$11644;var pp1$11624;var pp2$11625;var t0$11619;var t1$11620;var m$11614;(m$11614=temp$11593[$index$11605]);(t0$11619=m$11614);if(((t0$11619 instanceof Array)&&(((t1$11620=t0$11619.length)),(t1$11620===2)))){(pp1$11624=t0$11619[0]);(pp2$11625=t0$11619[1]);(temp$11644=pps$11468);($length$11650=temp$11644.length);($index$11656=0);$11638:for(;($index$11656<$length$11650);($index$11656++)){var pp$11673;var m$11665;(m$11665=temp$11644[$index$11656]);(pp$11673=m$11665);normalize$11467(pp$11673.vars);}if((normalize$11467(pp1$11624.vars)!==normalize$11467(pp2$11625.vars))){throw ErrorFactory(["syntax","pattern"]).create("Both branches of 'or' must contain the same variables",({"vars1":__lt____lt____colon__$10918(pp1$11624.vars.sort(),pp1$11624.pattern),"vars2":__lt____lt____colon__$10918(pp2$11625.vars.sort(),pp2$11625.pattern)}));}if((canon$11466(keys(pp1$11624.specials))!==canon$11466(keys(pp2$11625.specials)))){throw ErrorFactory(["syntax","pattern"]).create("Both branches of 'or' must contain the same special tokens",({"special1":__lt____lt____colon__$10918(keys(pp1$11624.specials).sort(),pp1$11624.pattern),"special2":__lt____lt____colon__$10918(keys(pp2$11625.specials).sort(),pp2$11625.pattern)}));}}else{___match_error(m$11614,"/home/olivier/git/eg/src/pattern.eg",4009,4806);}}(t0$11680=pps$11468);if(((t0$11680 instanceof Array)&&(((t1$11681=t0$11680.length)),((t1$11681>=1)&&(((t2$11682=t0$11680[0])),___hasprop(t2$11682,"vars")))))){(vars$11469=t2$11682.vars);Array.prototype.slice.call(t0$11680,1);}else{___match_error(pps$11468,"/home/olivier/git/eg/src/pattern.eg",4823,4826);}(it$0$11177["vars"]=it$0$11177.vars.concat(vars$11469));(patts$11702=(((acc$11710=[])),(((temp$11716=pps$11468)),((($length$11722=temp$11716.length)),((($index$11728=0)),(function(){$11705:for(;($index$11728<$length$11722);($index$11728++)){var pp$11745;var m$11737;(m$11737=temp$11716[$index$11728]);(pp$11745=m$11737);acc$11710.push(pp$11745.pattern);}})()))),acc$11710));return ["any"].concat(patts$11702);}else{if(($11239$11254&&($11217$11243[0]==="data"))){(args$11751=Array.prototype.slice.call($11217$11243,1));(specs$11761=it$0$11177.parse_specs(scope$11196,args$11751,tags$11198));($11756$11767=specs$11761);if((($11760$11779=___hasprop($11756$11767,"keys"))&&(((t0$11772=$11756$11767.keys)),((t0$11772 instanceof Array)&&(((t1$11773=t0$11772.length)),((t1$11773===0)&&(___hasprop($11756$11767,"fw")&&((fw$11782=$11756$11767.fw),(___hasprop($11756$11767,"bw")&&((bw$11783=$11756$11767.bw),(___hasprop($11756$11767,"defaults")&&((defaults$11784=$11756$11767.defaults),___hasprop($11756$11767,"rest"))))))))))))){(rest$11785=$11756$11767.rest);(patt$11803=__lt____lt____colon__$10918(["array_pattern",fw$11782,bw$11783,defaults$11784,rest$11785],pattern$11197));if(checked$11200){return patt$11803;}else{return ["check",checker_db$10927.Array,patt$11803];}}else{if(($11760$11779&&((keys$11809=$11756$11767.keys),(___hasprop($11756$11767,"fw")&&(((t0$11772=$11756$11767.fw)),((t0$11772 instanceof Array)&&(((t1$11773=t0$11772.length)),((t1$11773===0)&&(___hasprop($11756$11767,"bw")&&(((t2$11774=$11756$11767.bw)),((t2$11774 instanceof Array)&&(((t3$11775=t2$11774.length)),((t3$11775===0)&&(___hasprop($11756$11767,"defaults")&&(((t4$11776=$11756$11767.defaults)),((t4$11776 instanceof Array)&&(((t5$11777=t4$11776.length)),((t5$11777===0)&&(___hasprop($11756$11767,"rest")&&($11756$11767.rest===(void 0))))))))))))))))))))){return ["object_pattern"].concat(keys$11809);}else{(other$11845=$11756$11767);(msg$11849="Pattern must be an array or an object.");throw ErrorFactory(["syntax","pattern"]).create(msg$11849,({"node":expr$11210,"specs":specs$11761}));}}}else{if(($11237$11252&&((t0$11248===3)&&($11217$11243[0]==="mode")))){(mode$11855=$11217$11243[1]);(subp$11856=$11217$11243[2]);return it$0$11177.expand(scope$11196,subp$11856,__amp__(tags$11198,({"declare_mode":mode$11855})),toplevel$11199,checked$11200);}else{(other$11861=$11217$11243);throw ErrorFactory(["syntax","pattern"]).create("Illegal pattern",({"node":other$11861}));}}}}}}}}}}}}}}}}}})()));return (it$0$11177.opt.wrap_pattern||identity$10924)(__lt____lt____colon__$10918(rval$11211,pattern$11197),toplevel$11199);}else{___match_error($11175$11187);}}));__amp____colon__(PatternParser$10928,__amp____colon__(((accum$11869=({})),((accum$11869["::name"]="PatternParser"),accum$11869)),((accum$11873=({})),((accum$11873["::egclass"]=true),accum$11873))));PatternParser$10928;(PatternProcessor$10929=(function(){var it$0$11882;(it$0$11882=(function(){if((!getChecker(PatternProcessor$10929)(this))){return Object.create(PatternProcessor$10929.prototype);}else{return this;}})());(it$0$11882["temps"]=[]);(it$0$11882["parts"]=[]);(it$0$11882["gen"]=GenSym$10920("t"));return it$0$11882;}));(PatternProcessor$10929.prototype["do"]=(function(part$11906){var it$0$11910;var self$11911;(it$0$11910=this);(self$11911=this);return it$0$11910.parts.push(["do",part$11906]);}));(PatternProcessor$10929.prototype["check"]=(function(){var part$11947;var tags$11948;var t0$11943;var $11926$11938;var it$0$11928;var self$11929;(it$0$11928=this);(self$11929=this);($11926$11938=arguments);(t0$11943=$11926$11938.length);if(((t0$11943>=1)&&(t0$11943<=2))){(part$11947=$11926$11938[0]);(tags$11948=(function(){if((1>=t0$11943)){return ({});}else{return $11926$11938[1];}})());return it$0$11928.parts.push(__amp__(["check",part$11947],tags$11948));}else{___match_error($11926$11938);}}));(PatternProcessor$10929.prototype["temp"]=(function(){var x$12015;var x$12021;var init$12028;var bridge$11995$12004;var $11993$11999;var x$11985;var v$11986;var t0$11981;var $11964$11976;var it$0$11966;var self$11967;(it$0$11966=this);(self$11967=this);($11964$11976=arguments);(t0$11981=$11964$11976.length);if(((t0$11981>=1)&&(t0$11981<=2))){(x$11985=$11964$11976[0]);(v$11986=(function(){if((1>=t0$11981)){return null;}else{return $11964$11976[1];}})());($11993$11999=x$11985);(bridge$11995$12004=$11993$11999);if((((((x$12015=bridge$11995$12004)),((x$12015 instanceof Array)&&(x$12015[0]==="variable")))||(((x$12021=bridge$11995$12004)),((x$12021 instanceof Array)&&(x$12021[0]==="symbol"))))&&(___hasprop($11993$11999,"single_assignment")&&($11993$11999.single_assignment&&(!v$11986))))){return x$11985;}else{(init$12028=$11993$11999);(v$11986=(v$11986||["symbol",it$0$11966.gen()]));(v$11986["single_assignment"]=true);it$0$11966.temps.push(v$11986);it$0$11966.do(["send",["symbol","="],["data",["send",["symbol","set"],v$11986],init$12028]]);return v$11986;}}else{___match_error($11964$11976);}}));(PatternProcessor$10929.prototype["process"]=(function(pattern$12045,rhs$12046,fns$12047){var x$12100;var x$12134;var t$12147;var t$12159;var pp$12170;var $index$12203;var $length$12197;var temp$12191;var t$12181;var $index$12271;var $length$12265;var temp$12259;var acc$12253;var fn$12236;var parts$12237;var t$12229;var $index$12332;var $length$12326;var temp$12320;var acc$12314;var t$12305;var otherwise$12465;var $12443$12449;var $index$12482;var $length$12476;var temp$12470;var $index$12531;var $length$12525;var temp$12519;var end$12593;var pos$12587;var $index$12617;var $length$12611;var temp$12605;var acc$12599;var nfw$12398;var nbw$12399;var ndflt$12400;var extract_length$12401;var check_length$12402;var lo$12403;var hi$12404;var t$12405;var len$12406;var fw$12382;var bw$12383;var dflt$12384;var rest$12385;var subp$12300;var xs$12224;var xs$12176;var patt$12165;var projector$12153;var subp$12154;var checker$12141;var subp$12142;var checker$12129;var condition$12122;var subp$12123;var kind$12117;var sym$12107;var $12078$12091;var $12079$12092;var $12080$12093;var $12081$12094;var t0$12089;var $12065$12084;var rval$12062;var it$0$12051;var self$12052;(it$0$12051=this);(self$12052=this);(rval$12062=((($12065$12084=pattern$12045)),(function(){if((((x$12100=$12065$12084)),((x$12100 instanceof Array)&&(x$12100[0]==="ignore")))){return it$0$12051.do(rhs$12046);}else{if((($12078$12091=($12065$12084 instanceof Array))&&(((t0$12089=$12065$12084.length)),(($12080$12093=(t0$12089===2))&&($12065$12084[0]==="assign"))))){(sym$12107=$12065$12084[1]);return it$0$12051.parts.push(fns$12047.assign(sym$12107,rhs$12046));}else{if(($12080$12093&&($12065$12084[0]==="special"))){(kind$12117=$12065$12084[1]);return it$0$12051.process(fns$12047.special(pattern$12045,rhs$12046),rhs$12046,fns$12047);}else{if(($12078$12091&&(($12080$12093=(t0$12089===3))&&($12065$12084[0]==="test")))){(condition$12122=$12065$12084[1]);(subp$12123=$12065$12084[2]);it$0$12051.process(subp$12123,rhs$12046,fns$12047);return it$0$12051.check(condition$12122,({"test":true}));}else{if(($12080$12093&&(($12081$12094=($12065$12084[0]==="check"))&&((checker$12129=$12065$12084[1]),(((x$12134=$12065$12084[2])),((x$12134 instanceof Array)&&(x$12134[0]==="ignore"))))))){return it$0$12051.check(["send",checker$12129,["data",rhs$12046]]);}else{if($12081$12094){(checker$12141=$12065$12084[1]);(subp$12142=$12065$12084[2]);(t$12147=it$0$12051.temp(rhs$12046));it$0$12051.check(["send",checker$12141,["data",t$12147]]);return it$0$12051.process(subp$12142,t$12147,fns$12047);}else{if(($12080$12093&&($12065$12084[0]==="project"))){(projector$12153=$12065$12084[1]);(subp$12154=$12065$12084[2]);(t$12159=it$0$12051.temp(["send",projector$12153,["data",rhs$12046]]));it$0$12051.check(["send",t$12159,["value",0]]);return it$0$12051.process(subp$12154,["send",t$12159,["value",1]],fns$12047);}else{if(($12078$12091&&((t0$12089===2)&&($12065$12084[0]==="neg")))){(patt$12165=$12065$12084[1]);return it$0$12051.check(["send",["symbol","not"],["data",["void"],(((pp$12170=PatternProcessor$10929())),pp$12170.process(patt$12165,rhs$12046,fns$12047),assemble_conditions$10930(pp$12170))]]);}else{if(($12078$12091&&(($12080$12093=(t0$12089>=1))&&($12065$12084[0]==="all")))){(xs$12176=Array.prototype.slice.call($12065$12084,1));(t$12181=it$0$12051.temp(rhs$12046));(temp$12191=xs$12176);($length$12197=temp$12191.length);($index$12203=0);$12182:for(;($index$12203<$length$12197);($index$12203++)){var x$12220;var m$12212;(m$12212=temp$12191[$index$12203]);(x$12220=m$12212);it$0$12051.process(x$12220,t$12181,fns$12047);}return null;}else{if(($12080$12093&&($12065$12084[0]==="any"))){(xs$12224=Array.prototype.slice.call($12065$12084,1));(t$12229=it$0$12051.temp(rhs$12046,["symbol",gensym$10921("bridge")]));return it$0$12051.check((((fn$12236=(function(x$12242,rest$12243){return ["send",["symbol","or"],["data",x$12242,rest$12243]];}))),((parts$12237=(((acc$12253=[])),(((temp$12259=xs$12224)),((($length$12265=temp$12259.length)),((($index$12271=0)),(function(){$12248:for(;($index$12271<$length$12265);($index$12271++)){var pp$12293;var x$12288;var m$12280;(m$12280=temp$12259[$index$12271]);(x$12288=m$12280);acc$12253.push((((pp$12293=PatternProcessor$10929())),pp$12293.process(x$12288,t$12229,fns$12047),assemble_conditions$10930(pp$12293)));}})()))),acc$12253))),util$10919.construct(parts$12237,fn$12236,["symbol","false"])));}else{if(($12080$12093&&($12065$12084[0]==="object_pattern"))){(subp$12300=Array.prototype.slice.call($12065$12084,1));(t$12305=it$0$12051.temp(rhs$12046));(acc$12314=[]);(temp$12320=subp$12300);($length$12326=temp$12320.length);($index$12332=0);$12306:for(;($index$12332<$length$12326);($index$12332++)){var k$12353;var v$12354;var t0$12346;var t1$12347;var t2$12348;var t3$12349;var m$12341;(m$12341=temp$12320[$index$12332]);(t0$12346=m$12341);if(((t0$12346 instanceof Array)&&(((t1$12347=t0$12346.length)),((t1$12347===2)&&(((t2$12348=t0$12346[0])),((t2$12348 instanceof Array)&&(((t3$12349=t2$12348.length)),((t3$12349===2)&&(t2$12348[0]==="value"))))))))){(k$12353=t2$12348[1]);(v$12354=t0$12346[1]);acc$12314.push((it$0$12051.check(["send",["symbol","___hasprop"],["data",t$12305,["value",k$12353]]]),it$0$12051.process(v$12354,["send",t$12305,["value",k$12353]],fns$12047)));}else{___match_error(m$12341,"/home/olivier/git/eg/src/pattern.eg",8155,8287);}}return acc$12314;}else{if(($12078$12091&&((t0$12089===5)&&($12065$12084[0]==="array_pattern")))){(fw$12382=$12065$12084[1]);(bw$12383=$12065$12084[2]);(dflt$12384=$12065$12084[3]);(rest$12385=$12065$12084[4]);(nfw$12398=fw$12382.length);(nbw$12399=bw$12383.length);(ndflt$12400=dflt$12384.length);(extract_length$12401=true);(check_length$12402=true);(lo$12403=(nfw$12398+nbw$12399));(hi$12404=(lo$12403+ndflt$12400));(t$12405=it$0$12051.temp(rhs$12046));(len$12406=it$0$12051.temp(["send",t$12405,["send",["symbol","."],["data",["void"],["symbol","length"]]]]));it$0$12051.check(((($12443$12449=rest$12385)),(function(){if($12443$12449){return ["send",["symbol",">="],["data",len$12406,["value",lo$12403]]];}else{$12443$12449;if((lo$12403===hi$12404)){return ["send",["symbol","==="],["data",len$12406,["value",lo$12403]]];}else{(otherwise$12465=$12443$12449);return ["send",["symbol","and"],["data",["send",["symbol",">="],["data",len$12406,["value",lo$12403]]],["send",["symbol","<="],["data",len$12406,["value",hi$12404]]]]];}}})()));(temp$12470=enumerate(fw$12382));($length$12476=temp$12470.length);($index$12482=0);$12407:for(;($index$12482<$length$12476);($index$12482++)){var i$12501;var m$12502;var t0$12496;var t1$12497;var m$12491;(m$12491=temp$12470[$index$12482]);(t0$12496=m$12491);if(((t0$12496 instanceof Array)&&(((t1$12497=t0$12496.length)),(t1$12497===2)))){(i$12501=t0$12496[0]);(m$12502=t0$12496[1]);it$0$12051.process(m$12502,["send",t$12405,["value",i$12501]],fns$12047);}else{___match_error(m$12491,"/home/olivier/git/eg/src/pattern.eg",9019,9105);}}(temp$12519=enumerate(dflt$12384));($length$12525=temp$12519.length);($index$12531=0);$12410:for(;($index$12531<$length$12525);($index$12531++)){var idx$12579;var i$12552;var patt$12553;var value$12554;var t0$12545;var t1$12546;var t2$12547;var t3$12548;var m$12540;(m$12540=temp$12519[$index$12531]);(t0$12545=m$12540);if(((t0$12545 instanceof Array)&&(((t1$12546=t0$12545.length)),((t1$12546===2)&&((i$12552=t0$12545[0]),(((t2$12547=t0$12545[1])),((t2$12547 instanceof Array)&&(((t3$12548=t2$12547.length)),(t3$12548===2))))))))){(patt$12553=t2$12547[0]);(value$12554=t2$12547[1]);(idx$12579=(i$12552+nfw$12398));it$0$12051.process(patt$12553,["send",["symbol","if"],["data",["send",["symbol",">="],["data",["value",(idx$12579+nbw$12399)],len$12406]],value$12554,["send",t$12405,["value",idx$12579]]]],fns$12047);}else{___match_error(m$12540,"/home/olivier/git/eg/src/pattern.eg",9105,9274);}}if((rest$12385!==(void 0))){(pos$12587=(nfw$12398+ndflt$12400));(end$12593=(function(){if((nbw$12399>0)){return [["value",(-nbw$12399)]];}else{return [];}})());it$0$12051.process(rest$12385,["send",["send",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",t$12405,["value",pos$12587]].concat(end$12593)],fns$12047);}else{[];}(acc$12599=[]);(temp$12605=enumerate(bw$12383));($length$12611=temp$12605.length);($index$12617=0);$12413:for(;($index$12617<$length$12611);($index$12617++)){var i$12636;var m$12637;var t0$12631;var t1$12632;var m$12626;(m$12626=temp$12605[$index$12617]);(t0$12631=m$12626);if(((t0$12631 instanceof Array)&&(((t1$12632=t0$12631.length)),(t1$12632===2)))){(i$12636=t0$12631[0]);(m$12637=t0$12631[1]);acc$12599.push(it$0$12051.process(m$12637,["send",["symbol","___js_fetch"],["data",t$12405,["send",["symbol","-"],["data",len$12406,["value",(nbw$12399-i$12636)]]]]],fns$12047));}else{___match_error(m$12626,"/home/olivier/git/eg/src/pattern.eg",9725,9876);}}return acc$12599;}else{___match_error($12065$12084);}}}}}}}}}}}}})()));return rval$12062;}));__amp____colon__(PatternProcessor$10929,__amp____colon__(((accum$12658=({})),((accum$12658["::name"]="PatternProcessor"),accum$12658)),((accum$12662=({})),((accum$12662["::egclass"]=true),accum$12662))));PatternProcessor$10929;(assemble_conditions$10930=(function(pp$12669){var $index$12793;var $length$12787;var temp$12781;var acc$12775;var decls$12767;var construct$12673;(construct$12673=(function($12677$12680){var x$12748;var rest$12749;var x$12733;var x$12717;var rest$12718;var $12687$12704;var $12688$12705;var t0$12700;var t1$12701;var t2$12702;var $12682$12695;var ph$12689;(ph$12689=$12677$12680);($12682$12695=ph$12689);if((($12687$12704=($12682$12695 instanceof Array))&&(((t0$12700=$12682$12695.length)),(t0$12700===0)))){return ["value",true];}else{if(($12687$12704&&((t0$12700>=1)&&(((t1$12701=$12682$12695[0])),((t1$12701 instanceof Array)&&(((t2$12702=t1$12701.length)),((t2$12702===2)&&(t1$12701[0]==="do")))))))){(x$12717=t1$12701[1]);(rest$12718=Array.prototype.slice.call($12682$12695,1));return ["multi",x$12717,construct$12673(rest$12718)];}else{if(($12687$12704&&((t0$12700===1)&&(((t1$12701=$12682$12695[0])),((t1$12701 instanceof Array)&&(((t2$12702=t1$12701.length)),((t2$12702===2)&&(t1$12701[0]==="check")))))))){(x$12733=t1$12701[1]);return x$12733;}else{if(($12687$12704&&((t0$12700>=1)&&(((t1$12701=$12682$12695[0])),((t1$12701 instanceof Array)&&(((t2$12702=t1$12701.length)),((t2$12702===2)&&(t1$12701[0]==="check")))))))){(x$12748=t1$12701[1]);(rest$12749=Array.prototype.slice.call($12682$12695,1));return ["send",["symbol","and"],["data",x$12748,construct$12673(rest$12749)]];}else{___match_error($12682$12695);}}}}}));if(pp$12669.temps.length){(decls$12767=(((acc$12775=[])),(((temp$12781=pp$12669.temps)),((($length$12787=temp$12781.length)),((($index$12793=0)),(function(){$12770:for(;($index$12793<$length$12787);($index$12793++)){var t$12810;var m$12802;(m$12802=temp$12781[$index$12793]);(t$12810=m$12802);acc$12775.push(["declare",t$12810]);}})()))),acc$12775));return ["multi"].concat(decls$12767).concat([construct$12673(pp$12669.parts)]);}else{return construct$12673(pp$12669.parts);}}));(assemble_pattern$10931=(function(){var $index$12882;var $length$12876;var temp$12870;var $index$12943;var $length$12937;var temp$12931;var test$13082;var lead$12845;var trail$12846;var construct$12847;var parts$12832;var t$12833;var f$12834;var t0$12828;var $12819$12823;($12819$12823=arguments);(t0$12828=$12819$12823.length);if(((t0$12828>=2)&&(t0$12828<=3))){(parts$12832=$12819$12823[0]);(t$12833=$12819$12823[1]);(f$12834=(function(){if((2>=t0$12828)){return null;}else{return $12819$12823[2];}})());(lead$12845=[]);(temp$12870=parts$12832.slice(0));($length$12876=temp$12870.length);($index$12882=0);$12848:for(;($index$12882<$length$12876);($index$12882++)){var x$12920;var x$12905;var $12852$12899;var $12853$12900;var $12854$12901;var $12855$12902;var t0$12896;var t1$12897;var m$12891;(m$12891=temp$12870[$index$12882]);(t0$12896=m$12891);if((($12853$12900=(t0$12896 instanceof Array))&&(((t1$12897=t0$12896.length)),(($12855$12902=(t1$12897===2))&&(t0$12896[0]==="do"))))){(x$12905=t0$12896[1]);lead$12845.push(x$12905);parts$12832.shift();}else{if(($12855$12902&&(t0$12896[0]==="check"))){(x$12920=t0$12896[1]);break $12848;}else{___match_error(m$12891,"/home/olivier/git/eg/src/pattern.eg",10337,10447);}}}(trail$12846=[]);(temp$12931=parts$12832.slice(0).reverse());($length$12937=temp$12931.length);($index$12943=0);$12856:for(;($index$12943<$length$12937);($index$12943++)){var x$12981;var x$12966;var $12860$12960;var $12861$12961;var $12862$12962;var $12863$12963;var t0$12957;var t1$12958;var m$12952;(m$12952=temp$12931[$index$12943]);(t0$12957=m$12952);if((($12861$12961=(t0$12957 instanceof Array))&&(((t1$12958=t0$12957.length)),(($12863$12963=(t1$12958===2))&&(t0$12957[0]==="do"))))){(x$12966=t0$12957[1]);trail$12846.unshift(x$12966);parts$12832.pop();}else{if(($12863$12963&&(t0$12957[0]==="check"))){(x$12981=t0$12957[1]);break $12856;}else{___match_error(m$12952,"/home/olivier/git/eg/src/pattern.eg",10461,10583);}}}(construct$12847=(function($12989$12992){var other$13077;var x$13061;var rest$13062;var x$13046;var x$13030;var rest$13031;var $13000$13017;var $13001$13018;var t0$13013;var t1$13014;var t2$13015;var $12994$13008;var ph$13002;(ph$13002=$12989$12992);($12994$13008=ph$13002);if((($13000$13017=($12994$13008 instanceof Array))&&(((t0$13013=$12994$13008.length)),(t0$13013===0)))){return ["value",true];}else{if(($13000$13017&&((t0$13013>=1)&&(((t1$13014=$12994$13008[0])),((t1$13014 instanceof Array)&&(((t2$13015=t1$13014.length)),((t2$13015===2)&&(t1$13014[0]==="do")))))))){(x$13030=t1$13014[1]);(rest$13031=Array.prototype.slice.call($12994$13008,1));return ["multi",x$13030,construct$12847(rest$13031)];}else{if(($13000$13017&&((t0$13013===1)&&(((t1$13014=$12994$13008[0])),((t1$13014 instanceof Array)&&(((t2$13015=t1$13014.length)),((t2$13015===2)&&(t1$13014[0]==="check")))))))){(x$13046=t1$13014[1]);return x$13046;}else{if(($13000$13017&&((t0$13013>=1)&&(((t1$13014=$12994$13008[0])),((t1$13014 instanceof Array)&&(((t2$13015=t1$13014.length)),((t2$13015===2)&&(t1$13014[0]==="check")))))))){(x$13061=t1$13014[1]);(rest$13062=Array.prototype.slice.call($12994$13008,1));return ["send",["symbol","and"],["data",x$13061,construct$12847(rest$13062)]];}else{(other$13077=$12994$13008);throw ErrorFactory(["oops"]).create("?!?",other$13077);}}}}}));if(parts$12832.length){(test$13082=construct$12847(parts$12832));return ["multi"].concat(lead$12845).concat([(function(){if(f$12834){return ["send",["symbol","if"],["data",test$13082,["multi"].concat(trail$12846).concat([t$12833]),f$12834]];}else{return ["send",["symbol","if"],["data",test$13082,["multi"].concat(trail$12846).concat([t$12833])]];}})()]);}else{return ["multi"].concat(lead$12845).concat(trail$12846).concat([t$12833]);}}else{___match_error($12819$12823);}}));(inject_below_uses$10932=(function($13092$13095,fn$13096){var other$13127;var scope$13116;var x$13117;var t0$13112;var $13098$13107;var ph$13101;(ph$13101=$13092$13095);($13098$13107=ph$13101);if((($13098$13107 instanceof Array)&&(((t0$13112=$13098$13107.length)),((t0$13112===3)&&($13098$13107[0]==="use"))))){(scope$13116=$13098$13107[1]);(x$13117=$13098$13107[2]);return ["use",scope$13116,inject_below_uses$10932(x$13117,fn$13096)];}else{(other$13127=$13098$13107);return fn$13096(other$13127);}}));(parse_pattern$10933=(function(scope$13134,pattern$13135,rhs$13136,opt$13137){var t0$13151;var $index$13203;var $length$13197;var temp$13191;var acc$13185;var parse$13143;var target$13144;var proc$13145;(parse$13143=PatternParser$10928(scope$13134,pattern$13135,opt$13137));if(((!opt$13137.allow_arguments)&&parse$13143.arguments.length)){throw ErrorFactory(["syntax","pattern","arguments"]).create("Arguments cannot be declared in this pattern",({"args":parse$13143.arguments[0]}));}(t0$13151=getProjector((opt$13137.wrap_target||identity$10924))((function(){if(parse$13143.arguments.length){return inject_below_uses$10932(rhs$13136,(function(x$13158){return util$10919.construct(parse$13143.arguments.concat([x$13158]),(function(args$13162,rest$13163){return ["send",["symbol","->"],["data",args$13162,rest$13163]];}));}));}else{return rhs$13136;}})()));if(t0$13151[0]){(target$13144=t0$13151[1]);}else{___match_error((function(){if(parse$13143.arguments.length){return inject_below_uses$10932(rhs$13136,(function(x$13170){return util$10919.construct(parse$13143.arguments.concat([x$13170]),(function(args$13174,rest$13175){return ["send",["symbol","->"],["data",args$13174,rest$13175]];}));}));}else{return rhs$13136;}})(),"/home/olivier/git/eg/src/pattern.eg",11983,12409);}(proc$13145=PatternProcessor$10929());proc$13145.process(parse$13143.pattern,target$13144,opt$13137);if(opt$13137.finalize){return ["splice"].concat(opt$13137.declare(scope$13134,parse$13143.vars)).concat([["multi"].concat((((acc$13185=[])),(((temp$13191=proc$13145.temps)),((($length$13197=temp$13191.length)),((($index$13203=0)),(function(){$13180:for(;($index$13203<$length$13197);($index$13203++)){var t$13220;var m$13212;(m$13212=temp$13191[$index$13203]);(t$13220=m$13212);acc$13185.push(["declare",t$13220]);}})()))),acc$13185)).concat([assemble_pattern$10931(proc$13145.parts,opt$13137.success(target$13144),opt$13137.failure(target$13144))])]);}else{return [parse$13143.vars,proc$13145.temps,proc$13145.parts];}}));(checkall$10934=["send","data","multi","assign","void","check","do"]);(same_block$10935=(function($13230$13233,ban1$13234,ban2$13235){var $index$13399;var $length$13393;var temp$13387;var other$13421;var type1$13360;var args1$13361;var type2$13362;var args2$13363;var m1$13343;var m2$13344;var v1$13326;var v2$13327;var s1$13309;var s2$13310;var v1$13277;var v2$13278;var $13244$13268;var $13245$13269;var $13246$13270;var $13247$13271;var $13248$13272;var $13249$13273;var $13250$13274;var t0$13262;var t1$13263;var t2$13264;var t3$13265;var t4$13266;var $13237$13257;var ph$13251;(ph$13251=$13230$13233);($13237$13257=ph$13251);if((($13244$13268=($13237$13257 instanceof Array))&&(((t0$13262=$13237$13257.length)),(($13246$13270=(t0$13262===2))&&(((t1$13263=$13237$13257[0])),(($13248$13272=(t1$13263 instanceof Array))&&(((t2$13264=t1$13263.length)),(($13250$13274=(t2$13264===2))&&((t1$13263[0]==="variable")&&((v1$13277=t1$13263[1]),(((t3$13265=$13237$13257[1])),((t3$13265 instanceof Array)&&(((t4$13266=t3$13265.length)),((t4$13266===2)&&(t3$13265[0]==="variable"))))))))))))))){(v2$13278=t3$13265[1]);return (v1$13277===v2$13278);}else{if(($13250$13274&&((t1$13263[0]==="symbol")&&((s1$13309=t1$13263[1]),(((t3$13265=$13237$13257[1])),((t3$13265 instanceof Array)&&(((t4$13266=t3$13265.length)),((t4$13266===2)&&(t3$13265[0]==="symbol"))))))))){(s2$13310=t3$13265[1]);return (((!$14721(ban1$13234,s1$13309))&&(!$14721(ban2$13235,s2$13310)))&&(s1$13309===s2$13310));}else{if(($13250$13274&&((t1$13263[0]==="value")&&((v1$13326=t1$13263[1]),(((t3$13265=$13237$13257[1])),((t3$13265 instanceof Array)&&(((t4$13266=t3$13265.length)),((t4$13266===2)&&(t3$13265[0]==="value"))))))))){(v2$13327=t3$13265[1]);return (v1$13326===v2$13327);}else{if(($13250$13274&&((t1$13263[0]==="macro")&&((m1$13343=t1$13263[1]),(((t3$13265=$13237$13257[1])),((t3$13265 instanceof Array)&&(((t4$13266=t3$13265.length)),((t4$13266===2)&&(t3$13265[0]==="macro"))))))))){(m2$13344=t3$13265[1]);return (m1$13343===m2$13344);}else{if(($13248$13272&&((t2$13264>=1)&&((type1$13360=t1$13263[0]),((args1$13361=Array.prototype.slice.call(t1$13263,1)),(((t3$13265=$13237$13257[1])),((t3$13265 instanceof Array)&&(((t4$13266=t3$13265.length)),((t4$13266>=1)&&((type2$13362=t3$13265[0]),((args2$13363=Array.prototype.slice.call(t3$13265,1)),(checkall$10934.indexOf(type1$13360)!==-1)))))))))))){if(((type1$13360===type2$13362)&&(args1$13361.length===args2$13363.length))){(temp$13387=zip(args1$13361,args2$13363));($length$13393=temp$13387.length);($index$13399=0);$13381:for(;($index$13399<$length$13393);($index$13399++)){var pair$13416;var m$13408;(m$13408=temp$13387[$index$13399]);(pair$13416=m$13408);if((!same_block$10935(pair$13416,ban1$13234,ban2$13235))){return false;}}return true;}else{return false;}}else{(other$13421=$13237$13257);return false;}}}}}}));(parse_clauses$10936=(function(scope$13428,target$13429,stmts$13430,opt$13431){var $index$13471;var $length$13465;var temp$13459;var acc$13453;var $index$13717;var $length$13711;var temp$13705;var acc$13699;var $index$13780;var $length$13774;var temp$13768;var acc$13762;var decls$13754;var all_temps$13437;var the_parts$13438;var unique_temps$13439;(all_temps$13437=[]);(the_parts$13438=(((acc$13453=[])),(((temp$13459=scope$13428.step_all(["clause"],stmts$13430))),((($length$13465=temp$13459.length)),((($index$13471=0)),(function(){$13445:for(;($index$13471<$length$13465);($index$13471++)){var accum$13583;var accum$13601;var t0$13575;var t1$13576;var $index$13628;var $length$13622;var temp$13616;var bod$13669;var placeholder$13510;var special_fn$13511;var vars$13512;var temps$13513;var blocks$13514;var vars2$13515;var x$13679;var other$13687;var b$13675;var pattern$13491;var body$13492;var $13450$13488;var t0$13485;var t1$13486;var m$13480;(m$13480=temp$13459[$index$13471]);(t0$13485=m$13480);if(((t0$13485 instanceof Array)&&(((t1$13486=t0$13485.length)),((t1$13486===3)&&(t0$13485[0]==="clause"))))){(pattern$13491=t0$13485[1]);(body$13492=t0$13485[2]);acc$13453.push((((placeholder$13510=(void 0))),((special_fn$13511=(function($13526$13529,value$13530){var t0$13538;var t1$13539;var other$13571;var $13532$13554;var ph$13535;var expr$13536;(t0$13538=$13526$13529);if(((t0$13538 instanceof Array)&&(((t1$13539=t0$13538.length)),((t1$13539===2)&&(t0$13538[0]==="special"))))){(ph$13535=t0$13538[1]);(expr$13536=t0$13538);}else{___match_error($13526$13529);}($13532$13554=ph$13535);if(($13532$13554==="match")){(placeholder$13510=__lt____lt____colon__$10918(["symbol",scope$13428.gensym("ph")],expr$13536));return ["assign",placeholder$13510];}else{(other$13571=$13532$13554);throw ErrorFactory(["syntax","pattern","special"]).create("Special token cannot be used here",({"special":expr$13536}));}}))),(((t0$13575=parse_pattern$10933(scope$13428,pattern$13491,target$13429,__amp__(opt$13431,__amp____colon__(({"allow_arguments":false,"allow_nested":true,"special":special_fn$13511}),__amp____colon__(((accum$13583=({})),((accum$13583["assign"]=(function(v$13588,value$13589){return ["do",__lt____lt____colon__$10918(["assign",v$13588,value$13589],v$13588)];})),accum$13583)),({"finalize":false}))))))),(function(){if(((t0$13575 instanceof Array)&&(((t1$13576=t0$13575.length)),(t1$13576===3)))){(vars$13512=t0$13575[0]);(temps$13513=t0$13575[1]);(blocks$13514=t0$13575[2]);}else{return ___match_error(parse_pattern$10933(scope$13428,pattern$13491,target$13429,__amp__(opt$13431,__amp____colon__(({"allow_arguments":false,"allow_nested":true,"special":special_fn$13511}),__amp____colon__(((accum$13601=({})),((accum$13601["assign"]=(function(v$13606,value$13607){return ["do",__lt____lt____colon__$10918(["assign",v$13606,value$13607],v$13606)];})),accum$13601)),({"finalize":false}))))),"/home/olivier/git/eg/src/pattern.eg",14060,14394);}})()),(all_temps$13437=all_temps$13437.concat(temps$13513)),(function(){if(placeholder$13510){return vars$13512.push(placeholder$13510);}})(),((vars2$13515=({}))),(((temp$13616=vars$13512)),((($length$13622=temp$13616.length)),((($index$13628=0)),(function(){$13516:for(;($index$13628<$length$13622);($index$13628++)){var other$13665;var xxx$13647;var t0$13642;var t1$13643;var m$13637;(m$13637=temp$13616[$index$13628]);(t0$13642=m$13637);if(((t0$13642 instanceof Array)&&(((t1$13643=t0$13642.length)),((t1$13643===2)&&(t0$13642[0]==="symbol"))))){(xxx$13647=t0$13642[1]);(vars2$13515[xxx$13647]=true);}else{(other$13665=m$13637);throw ErrorFactory(["syntax","unexpected"]).create();}}})()))),(((bod$13669=(function(){if(placeholder$13510){return parse_clauses$10936(scope$13428,placeholder$13510,getProjector(Body$10925)(body$13492)[1],opt$13431);}else{if(opt$13431.wrap){return opt$13431.wrap(body$13492);}else{return body$13492;}}})())),["clause",vars$13512,vars2$13515,blocks$13514,bod$13669])));}else{if((((x$13679=t0$13485)),((x$13679 instanceof Array)&&(x$13679[0]==="block")))){(b$13675=t0$13485);acc$13453.push(b$13675);}else{(other$13687=m$13480);acc$13453.push(function(){throw ErrorFactory(["syntax","clause"]).create("Illegal clause",({"clause":other$13687}));}());}}}})()))),acc$13453));if(opt$13431.fallback){the_parts$13438.push(["block",opt$13431.fallback(target$13429)]);}(unique_temps$13439=keys(util$10919.mkset((((acc$13699=[])),(((temp$13705=all_temps$13437)),((($length$13711=temp$13705.length)),((($index$13717=0)),(function(){$13694:for(;($index$13717<$length$13711);($index$13717++)){var t$13736;var t0$13731;var t1$13732;var m$13726;(m$13726=temp$13705[$index$13717]);(t0$13731=m$13726);if(((t0$13731 instanceof Array)&&(((t1$13732=t0$13731.length)),((t1$13732===2)&&(t0$13731[0]==="symbol"))))){(t$13736=t0$13731[1]);acc$13699.push(t$13736);}else{___match_error(m$13726,"/home/olivier/git/eg/src/pattern.eg",15201,15231);}}})()))),acc$13699))));(decls$13754=(((acc$13762=[])),(((temp$13768=unique_temps$13439)),((($length$13774=temp$13768.length)),((($index$13780=0)),(function(){$13757:for(;($index$13780<$length$13774);($index$13780++)){var t$13797;var m$13789;(m$13789=temp$13768[$index$13780]);(t$13797=m$13789);acc$13762.push(["declare",__amp____colon__(["symbol",t$13797],({"mutable":true}))]);}})()))),acc$13762));return ["multi"].concat(decls$13754).concat([weave_clauses$10938(the_parts$13438)]);}));(opt_clauses$10937=(function(clauses$13806){var $index$13846;var $length$13840;var temp$13834;var acc$13828;var $index$14030;var $length$14024;var temp$14018;var acc$14012;var $index$14090;var $length$14084;var temp$14078;var acc$14072;var $index$14142;var $length$14136;var temp$14130;var acc$14124;var shares$13815;var max$13816;var temps$13817;var shared_last$13818;var idx_last$13819;var new_clauses$13820;(shares$13815=(((acc$13828=[])),(((temp$13834=enumerate(clauses$13806.slice(1)))),((($length$13840=temp$13834.length)),((($index$13846=0)),(function(){$13823:for(;($index$13846<$length$13840);($index$13846++)){var t0$13907;var t1$13908;var $index$13942;var $length$13936;var temp$13930;var varsd0$13899;var blocks0$13900;var share$13901;var idx$13902;var i$13867;var vars$13868;var varsd$13869;var blocks$13870;var body$13871;var t0$13860;var t1$13861;var t2$13862;var t3$13863;var m$13855;(m$13855=temp$13834[$index$13846]);(t0$13860=m$13855);if(((t0$13860 instanceof Array)&&(((t1$13861=t0$13860.length)),((t1$13861===2)&&((i$13867=t0$13860[0]),(((t2$13862=t0$13860[1])),((t2$13862 instanceof Array)&&(((t3$13863=t2$13862.length)),((t3$13863===5)&&(t2$13862[0]==="clause")))))))))){(vars$13868=t2$13862[1]);(varsd$13869=t2$13862[2]);(blocks$13870=t2$13862[3]);(body$13871=t2$13862[4]);acc$13828.push(((((t0$13907=$14721(clauses$13806,i$13867))),(function(){if(((t0$13907 instanceof Array)&&(((t1$13908=t0$13907.length)),((t1$13908===5)&&(t0$13907[0]==="clause"))))){t0$13907[1];(varsd0$13899=t0$13907[2]);(blocks0$13900=t0$13907[3]);t0$13907[4];}else{return ___match_error($14721(clauses$13806,i$13867),"/home/olivier/git/eg/src/pattern.eg",15524,15534);}})()),((share$13901=0)),((idx$13902=0)),(((temp$13930=blocks$13870)),((($length$13936=temp$13930.length)),((($index$13942=0)),(function(){$13903:for(;($index$13942<$length$13936);($index$13942++)){var x$13979;var x$13989;var other$14000;var $13962$13968;var b$13959;var m$13951;(m$13951=temp$13930[$index$13942]);(b$13959=m$13951);if(same_block$10935([$14721(blocks0$13900,share$13901),b$13959],varsd0$13899,varsd$13869)){(share$13901++);($13962$13968=b$13959);if((((x$13979=$13962$13968)),((x$13979 instanceof Array)&&(x$13979[0]==="do")))){null;}else{if((((x$13989=$13962$13968)),((x$13989 instanceof Array)&&(x$13989[0]==="check")))){(idx$13902=share$13901);}else{(other$14000=$13962$13968);__lt____gt__$10916(null,other$14000);}}}else{break $13903;}}})()))),[share$13901,idx$13902]));}else{___match_error(m$13855,"/home/olivier/git/eg/src/pattern.eg",15400,15928);}}})()))),acc$13828));(max$13816=$14721(Math.max,(((acc$14012=[])),(((temp$14018=shares$13815)),((($length$14024=temp$14018.length)),((($index$14030=0)),(function(){$14007:for(;($index$14030<$length$14024);($index$14030++)){var x$14049;var t0$14044;var t1$14045;var m$14039;(m$14039=temp$14018[$index$14030]);(t0$14044=m$14039);if(((t0$14044 instanceof Array)&&(((t1$14045=t0$14044.length)),(t1$14045===2)))){(x$14049=t0$14044[0]);t0$14044[1];acc$14012.push(x$14049);}else{___match_error(m$14039,"/home/olivier/git/eg/src/pattern.eg",15942,15967);}}})()))),acc$14012)));shares$13815.push([0,0]);(temps$13817=(((acc$14072=[])),(((temp$14078=range(1,max$13816))),((($length$14084=temp$14078.length)),((($index$14090=0)),(function(){$14067:for(;($index$14090<$length$14084);($index$14090++)){var m$14099;(m$14099=temp$14078[$index$14090]);m$14099;acc$14072.push(["symbol",gensym$10921()]);}})()))),acc$14072));(shared_last$13818=0);(idx_last$13819=0);(new_clauses$13820=(((acc$14124=[])),(((temp$14130=enumerate(clauses$13806))),((($length$14136=temp$14130.length)),((($index$14142=0)),(function(){$14118:for(;($index$14142<$length$14136);($index$14142++)){var t0$14204;var t1$14205;var $index$14254;var $length$14248;var temp$14242;var acc$14236;var rest$14338;var newblocks$14333;var share$14198;var idx$14199;var shared$14200;var n_to_share$14201;var to_share$14202;var other$14345;var i$14163;var vars$14164;var varsd$14165;var blocks$14166;var body$14167;var t0$14156;var t1$14157;var t2$14158;var t3$14159;var m$14151;(m$14151=temp$14130[$index$14142]);(t0$14156=m$14151);if(((t0$14156 instanceof Array)&&(((t1$14157=t0$14156.length)),((t1$14157===2)&&((i$14163=t0$14156[0]),(((t2$14158=t0$14156[1])),((t2$14158 instanceof Array)&&(((t3$14159=t2$14158.length)),((t3$14159===5)&&(t2$14158[0]==="clause")))))))))){(vars$14164=t2$14158[1]);(varsd$14165=t2$14158[2]);(blocks$14166=t2$14158[3]);(body$14167=t2$14158[4]);acc$14124.push(((((t0$14204=$14721(shares$13815,i$14163))),(function(){if(((t0$14204 instanceof Array)&&(((t1$14205=t0$14204.length)),(t1$14205===2)))){(share$14198=t0$14204[0]);(idx$14199=t0$14204[1]);}else{return ___match_error($14721(shares$13815,i$14163),"/home/olivier/git/eg/src/pattern.eg",16200,16209);}})()),((shared$14200=(function(){if(idx_last$13819){return [["check",$14721(temps$13817,(idx_last$13819-1))]];}else{return [];}})())),((n_to_share$14201=Math.max(shared_last$13818,share$14198))),((to_share$14202=(((acc$14236=[])),(((temp$14242=enumerate(blocks$14166.slice(shared_last$13818,n_to_share$14201)))),((($length$14248=temp$14242.length)),((($index$14254=0)),(function(){$14226:for(;($index$14254<$length$14248);($index$14254++)){var j$14306;var x$14307;var j$14279;var x$14280;var $14230$14273;var $14231$14274;var $14232$14275;var $14233$14276;var t0$14268;var t1$14269;var t2$14270;var t3$14271;var m$14263;(m$14263=temp$14242[$index$14254]);(t0$14268=m$14263);if((($14231$14274=(t0$14268 instanceof Array))&&(((t1$14269=t0$14268.length)),(($14233$14276=(t1$14269===2))&&((j$14279=t0$14268[0]),(((t2$14270=t0$14268[1])),((t2$14270 instanceof Array)&&(((t3$14271=t2$14270.length)),((t3$14271===2)&&(t2$14270[0]==="check")))))))))){(x$14280=t2$14270[1]);acc$14236.push(["check",["assign",$14721(temps$13817,(shared_last$13818+j$14279)),x$14280]]);}else{if(($14233$14276&&((j$14306=t0$14268[0]),(((t2$14270=t0$14268[1])),((t2$14270 instanceof Array)&&(((t3$14271=t2$14270.length)),((t3$14271===2)&&(t2$14270[0]==="do")))))))){(x$14307=t2$14270[1]);acc$14236.push(["do",x$14307]);}else{___match_error(m$14263,"/home/olivier/git/eg/src/pattern.eg",16348,16519);}}}})()))),acc$14236))),((shared_last$13818=share$14198)),((idx_last$13819=idx$14199)),(((newblocks$14333=(((rest$14338=blocks$14166.slice(n_to_share$14201))),shared$14200.concat(to_share$14202).concat(rest$14338)))),["clause",vars$14164,varsd$14165,newblocks$14333,body$14167])));}else{(other$14345=m$14151);acc$14124.push(function(){throw ErrorFactory(["oops"]).create("what",({"value":other$14345}));}());}}})()))),acc$14124));return [temps$13817,new_clauses$13820];}));(weave_clauses$10938=(function(parts$14354){var $index$14419;var $length$14413;var temp$14407;var $index$14683;var $length$14677;var temp$14671;var acc$14665;var groups$14361;var reassemble$14362;var new_temps$14363;var helper$14364;(groups$14361=classify_contiguous$10923(parts$14354,(function($14376$14379){var t0$14383;var t1$14384;var cls$14381;(t0$14383=$14376$14379);if(((t0$14383 instanceof Array)&&(((t1$14384=t0$14383.length)),(t1$14384>=1)))){(cls$14381=t0$14383[0]);Array.prototype.slice.call(t0$14383,1);}else{___match_error($14376$14379);}return cls$14381;})));(reassemble$14362=[]);(new_temps$14363=[]);(temp$14407=groups$14361);($length$14413=temp$14407.length);($index$14419=0);$14365:for(;($index$14419<$length$14413);($index$14419++)){var t0$14459;var t1$14460;var ts$14456;var new_clauses$14457;var elems$14475;var elems$14442;var $14369$14436;var $14370$14437;var $14371$14438;var $14372$14439;var t0$14433;var t1$14434;var m$14428;(m$14428=temp$14407[$index$14419]);(t0$14433=m$14428);if((($14370$14437=(t0$14433 instanceof Array))&&(((t1$14434=t0$14433.length)),(($14372$14439=(t1$14434>=1))&&(t0$14433[0]==="clause"))))){(elems$14442=Array.prototype.slice.call(t0$14433,1));(t0$14459=opt_clauses$10937(elems$14442));if(((t0$14459 instanceof Array)&&(((t1$14460=t0$14459.length)),(t1$14460===2)))){(ts$14456=t0$14459[0]);(new_clauses$14457=t0$14459[1]);}else{___match_error(opt_clauses$10937(elems$14442),"/home/olivier/git/eg/src/pattern.eg",17028,17046);}(new_temps$14363=new_temps$14363.concat(ts$14456));(reassemble$14362=reassemble$14362.concat(new_clauses$14457));}else{if(($14372$14439&&(t0$14433[0]==="block"))){(elems$14475=Array.prototype.slice.call(t0$14433,1));(reassemble$14362=reassemble$14362.concat(elems$14475));}else{___match_error(m$14428,"/home/olivier/git/eg/src/pattern.eg",16962,17167);}}}(helper$14364=(function($14483$14486){var $index$14599;var $length$14593;var temp$14587;var acc$14581;var decls$14573;var vars$14564;var varsd$14565;var blocks$14566;var body$14567;var rest$14568;var body$14533;var rest$14534;var $14492$14516;var $14493$14517;var $14494$14518;var $14495$14519;var $14496$14520;var $14497$14521;var t0$14509;var t1$14510;var t2$14511;var t3$14512;var t4$14513;var t5$14514;var $14488$14504;var ph$14498;(ph$14498=$14483$14486);($14488$14504=ph$14498);if((($14492$14516=($14488$14504 instanceof Array))&&(((t0$14509=$14488$14504.length)),(t0$14509===0)))){return ["multi"];}else{if(($14492$14516&&(($14494$14518=(t0$14509>=1))&&(((t1$14510=$14488$14504[0])),(($14496$14520=(t1$14510 instanceof Array))&&(((t2$14511=t1$14510.length)),((t2$14511===2)&&((t1$14510[0]==="block")&&(((t3$14512=getProjector(Body$10925)(t1$14510[1]))),(t3$14512[0]&&(((t4$14513=t3$14512[1])),(((t5$14514=t4$14513.length)),(t5$14514>=0))))))))))))){(body$14533=Array.prototype.slice.call(t4$14513,0));(rest$14534=Array.prototype.slice.call($14488$14504,1));return ["multi"].concat(body$14533).concat([helper$14364(rest$14534)]);}else{if(($14496$14520&&((t2$14511===5)&&(t1$14510[0]==="clause")))){(vars$14564=t1$14510[1]);(varsd$14565=t1$14510[2]);(blocks$14566=t1$14510[3]);(body$14567=t1$14510[4]);(rest$14568=Array.prototype.slice.call($14488$14504,1));(decls$14573=(((acc$14581=[])),(((temp$14587=vars$14564)),((($length$14593=temp$14587.length)),((($index$14599=0)),(function(){$14576:for(;($index$14599<$length$14593);($index$14599++)){var bridge$14624$14632;var $14619$14627;var v$14616;var m$14608;(m$14608=temp$14587[$index$14599]);(v$14616=m$14608);acc$14581.push(((($14619$14627=v$14616.declare_mode)),(function(){if(($14619$14627==="set")){return ["splice"];}else{if(($14619$14627==="let")){return ["declare",__amp__(v$14616,({"mutable":false}))];}else{if(($14619$14627==="var")){return ["declare",__amp__(v$14616,({"mutable":true}))];}else{(bridge$14624$14632=$14619$14627);if(((bridge$14624$14632==="unqualified")||(bridge$14624$14632===(void 0)))){return ["declare",__amp__(v$14616,({"mutable":false}))];}else{___match_error($14619$14627);}}}}})()));}})()))),acc$14581));return ["tagscope","back",["multi"].concat(decls$14573).concat([assemble_pattern$10931(blocks$14566,body$14567,["use","back",helper$14364(rest$14568)])])];}else{___match_error($14488$14504);}}}}));return ["multi"].concat((((acc$14665=[])),(((temp$14671=new_temps$14363)),((($length$14677=temp$14671.length)),((($index$14683=0)),(function(){$14660:for(;($index$14683<$length$14677);($index$14683++)){var t$14700;var m$14692;(m$14692=temp$14671[$index$14683]);(t$14700=m$14692);acc$14665.push(["declare",t$14700]);}})()))),acc$14665)).concat([helper$14364(reassemble$14362)]);}));(exports["PatternParser"]=PatternParser$10928);(exports["PatternProcessor"]=PatternProcessor$10929);(exports["parse_clauses"]=parse_clauses$10936);(exports["parse_pattern"]=parse_pattern$10933);
