var $15467=function(type$15470){var f$15474;(f$15474=type$15470["::check"]);if((f$15474===(void 0))){return function(value$15480){return (value$15480 instanceof type$15470);};}else{return function(value$15484){return f$15474.call(type$15470,value$15484);};}};
var $15486=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $15487=function(dest$15490,values$15491){var k$15496;(k$15496=null);$15494:for(k$15496 in values$15491){if(values$15491.hasOwnProperty(k$15496)){(dest$15490[k$15496]=values$15491[k$15496]);}}return dest$15490;};
var $15504=function($15506$15509){var ph$15515;(ph$15515=$15506$15509);var $15511$15521;($15511$15521=ph$15515);var bridge$15513$15526;var x$15530;(bridge$15513$15526=$15511$15521);if((((typeof(bridge$15513$15526)==="string")&&((x$15530=bridge$15513$15526),true))||((typeof(bridge$15513$15526)==="number")&&((x$15530=bridge$15513$15526),true)))){return ["value",x$15530];}else{var other$15541;(other$15541=$15511$15521);return other$15541["::serialize_ast"]();}};
var send$15241;(send$15241=function(obj$15248,$15245$15249){var ph$15255;var msg$15256;var t0$15258;(t0$15258=$15245$15249);(msg$15256=t0$15258);(ph$15255=t0$15258);var $15251$15267;($15251$15267=ph$15255);var bridge$15253$15272;(bridge$15253$15272=$15251$15267);if(((typeof(bridge$15253$15272)==="string")||(typeof(bridge$15253$15272)==="number"))){return obj$15248[msg$15256];}else{var other$15284;(other$15284=$15251$15267);return obj$15248["::send"](msg$15256);}});(Array[":::project"]=function($15290$15293){var ph$15298;var value$15299;var t0$15301;(t0$15301=$15290$15293);(value$15299=t0$15301);(ph$15298=t0$15301);var $15295$15310;($15295$15310=ph$15298);if($15467(Array)($15295$15310)){return [true,value$15299];}else{$15295$15310;return [true,[value$15299]];}});(Array.prototype["::check"]=function(value$15328){if((value$15328 instanceof Array)){var i$15334;(i$15334=0);$15331:for(;(i$15334<this.length);(i$15334++)){if(($15486(this,i$15334)!==$15486(value$15328,i$15334))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $15487(this.slice(0),this);});(Array.prototype[":::project"]=function(value$15353){if((value$15353 instanceof Array)){var i$15359;(i$15359=0);$15356:for(;(i$15359<this.length);(i$15359++)){if(($15486(this,i$15359)!==$15486(value$15353,i$15359))){return [true,[value$15353]];}}return [true,value$15353.slice(this.length)];}else{return [true,[value$15353]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($15504));});(RegExp.prototype["::check"]=function($15377$15380){var ph$15385;(ph$15385=$15377$15380);var $15382$15391;($15382$15391=ph$15385);var value$15399;if((typeof($15382$15391)==="string")){(value$15399=$15382$15391);if(value$15399.match(this)){return true;}else{return false;}}else{var other$15404;(other$15404=$15382$15391);return false;}});(RegExp.prototype[":::project"]=function($15410$15413){var ph$15418;(ph$15418=$15410$15413);var $15415$15424;($15415$15424=ph$15418);var value$15432;if((typeof($15415$15424)==="string")){(value$15432=$15415$15424);var $15435$15440;($15435$15440=value$15432.match(this));var m$15448;if(($15435$15440===null)){(m$15448=$15435$15440);return [false,null];}else{var m$15453;(m$15453=$15435$15440);return [true,m$15453];}}else{var other$15457;(other$15457=$15415$15424);return [false,null];}});(Function.prototype["::send"]=function(args$15464){return this.apply(this,args$15464);});
var $19469=function($19471$19474,key$19475){var ph$19483;(ph$19483=$19471$19474);var $19477$19489;($19477$19489=ph$19483);var bridge$19479$19494;(bridge$19479$19494=$19477$19489);if(((bridge$19479$19494===null)||(bridge$19479$19494===(void 0)))){return false;}else{var x$19506;if((typeof($19477$19489)==="string")){(x$19506=$19477$19489);return (key$19475 in String.prototype);}else{var x$19511;if((typeof($19477$19489)==="number")){(x$19511=$19477$19489);return (key$19475 in Number.prototype);}else{var x$19516;(x$19516=$19477$19489);return (key$19475 in x$19516);}}}};
var $19751=function(arr$19754){var results$19760;var l$19761;(results$19760=[]);(l$19761=arr$19754.length);var i$19770;(i$19770=0);$19759:for(;(i$19770<l$19761);(i$19770++)){results$19760.push([i$19770,$15486(arr$19754,i$19770)]);}return results$19760;};
var $19777=function(value$19780,url$19781,start$19782,end$19783){var err$19787;(err$19787=$19518(["match"]).create("Could not find a match for value",({"value":value$19780})));if(url$19781){(err$19787["location"]=["location",url$19781,start$19782,end$19783]);}throw err$19787;};
var $19518=function(){var $19519$19525;($19519$19525=function(tags$19530){var it$0$19533;(it$0$19533=function(){if((!$15467($19519$19525)(this))){return Object.create($19519$19525.prototype);}else{return this;}}());(it$0$19533["tags"]=tags$19530);return it$0$19533;});($19519$19525.prototype["create"]=function(){var it$0$19553;var self$19554;(it$0$19553=this);(self$19554=this);var $19551$19563;($19551$19563=arguments);var t0$19568;var message$19572;var args$19573;(t0$19568=$19551$19563.length);if((t0$19568>=0)){(message$19572=function(){if((0>=t0$19568)){return "";}else{return $19551$19563[0];}}());(args$19573=Array.prototype.slice.call($19551$19563,1));var e$19586;(e$19586=Error(message$19572));(e$19586["::tags"]=it$0$19553.tags);(e$19586["args"]=args$19573);var temp$19602;(temp$19602=$19751(args$19573));var $length$19608;($length$19608=temp$19602.length);var $index$19614;($index$19614=0);$19587:for(;($index$19614<$length$19608);($index$19614++)){var m$19623;(m$19623=temp$19602[$index$19614]);var t0$19628;var t1$19629;var i$19633;var arg$19634;(t0$19628=m$19623);if(((t0$19628 instanceof Array)&&(((t1$19629=t0$19628.length)),(t1$19629===2)))){(i$19633=t0$19628[0]);(arg$19634=t0$19628[1]);(e$19586[i$19633]=arg$19634);}else{$19777(m$19623);}}(e$19586["length"]=args$19573.length);(e$19586["name"]=["E"].concat(it$0$19553.tags).join("."));return e$19586;}else{$19777($19551$19563);}});($19519$19525.prototype["::check"]=function(e$19664){var it$0$19668;var self$19669;(it$0$19668=this);(self$19669=this);var tags$19679;if(((!e$19664)||(!$15467(Error)(e$19664)))){return false;}(tags$19679=(e$19664["::tags"]||[]));var temp$19690;(temp$19690=it$0$19668.tags);var $length$19696;($length$19696=temp$19690.length);var $index$19702;($index$19702=0);$19680:for(;($index$19702<$length$19696);($index$19702++)){var m$19711;(m$19711=temp$19690[$index$19702]);var tag$19719;(tag$19719=m$19711);if((tags$19679.indexOf(tag$19719)===-1)){return false;}else{false;}}return true;});($19519$19525.prototype["::deconstruct"]=function(e$19728){var it$0$19732;var self$19733;(it$0$19732=this);(self$19733=this);return e$19728.args;});$15487($19519$19525,$15487(function(){var accum$19744;(accum$19744=({}));(accum$19744["::name"]="$19519");return accum$19744;}(),function(){var accum$19748;(accum$19748=({}));(accum$19748["::egclass"]=true);return accum$19748;}()));return $19519$19525;}();
var $19385=function($19387$19390){var ph$19400;var x$19401;var t0$19403;(t0$19403=$19387$19390);(x$19401=t0$19403);(ph$19400=t0$19403);var $19392$19412;($19392$19412=ph$19400);var bridge$19394$19417;(bridge$19394$19417=$19392$19412);if((function(){var bridge$19395$19427;(bridge$19395$19427=bridge$19394$19417);return (function(){var bridge$19396$19434;(bridge$19396$19434=bridge$19395$19427);return ((bridge$19396$19434===(void 0))||(bridge$19396$19434===null));}()||(typeof(bridge$19395$19427)==="string"));}()||(typeof(bridge$19394$19417)==="number"))){return x$19401;}else{if($19469($19392$19412,"::clone")){$19392$19412["::clone"];return x$19401["::clone"]();}else{$19392$19412;if((Object.getPrototypeOf(x$19401)===Object.prototype)){var dest$19452;(dest$19452=({}));var k$19457;(k$19457=null);$19451:for(k$19457 in x$19401){if(Object.prototype.hasOwnProperty.call(x$19401,k$19457)){(dest$19452[k$19457]=x$19401[k$19457]);}}return dest$19452;}else{var other$19467;(other$19467=$19392$19412);throw $19518(["clone"]).create("Object cannot be cloned",({"obj":x$19401}));}}}};
var $19796=function(a$19799,b$19800){var dest$19805;(dest$19805=$19385(a$19799));var k$19810;(k$19810=null);$19804:for(k$19810 in b$19800){if(Object.prototype.hasOwnProperty.call(b$19800,k$19810)){(dest$19805[k$19810]=b$19800[k$19810]);}}return dest$19805;};
var $19818=Object.keys;
var $19819=function(type$19822){return function(value$19826){var f$19830;(f$19830=type$19822[":::project"]);if((f$19830===(void 0))){(f$19830=type$19822["::project"]);if((f$19830===(void 0))){return [true,type$19822(value$19826)];}else{var rval$19843;(rval$19843=false);try{(rval$19843=[true,f$19830(value$19826)]);}catch(excv$19854){var e$19860;(e$19860=excv$19854);(rval$19843=[false,null]);}return rval$19843;}}else{return f$19830.call(type$19822,value$19826);}};};
var $19866=function(xs$19869,ys$19870){var acc$19877;(acc$19877=[]);var temp$19883;(temp$19883=$19751(xs$19869));var $length$19889;($length$19889=temp$19883.length);var $index$19895;($index$19895=0);$19872:for(;($index$19895<$length$19889);($index$19895++)){var m$19904;(m$19904=temp$19883[$index$19895]);var t0$19909;var t1$19910;var i$19914;var x$19915;(t0$19909=m$19904);if(((t0$19909 instanceof Array)&&(((t1$19910=t0$19909.length)),(t1$19910===2)))){(i$19914=t0$19909[0]);(x$19915=t0$19909[1]);acc$19877.push([x$19915,$15486(ys$19870,i$19914)]);}else{$19777(m$19904);}}return acc$19877;};
var $19930=function(from$19933,to$19934){var rval$19939;(rval$19939=[]);var i$19945;(i$19945=from$19933);$19938:for(;(i$19945<=to$19934);(i$19945++)){rval$19939.push(i$19945);}return rval$19939;};var accum$16533;var accum$16537;var accum$17322;var accum$17326;var $15545$15579;var __lt____gt__$15580;var $15546$15581;var __lt____lt____colon__$15582;var util$15583;var GenSym$15584;var gensym$15585;var neighbours$15586;var classify$15587;var classify_contiguous$15588;var identity$15589;var $15548$15590;var checker_db$15591;var PatternParser$15592;var PatternProcessor$15593;var assemble_conditions$15594;var assemble_pattern$15595;var inject_below_uses$15596;var parse_pattern$15597;var checkall$15598;var same_block$15599;var parse_clauses$15600;var opt_clauses$15601;var weave_clauses$15602;($15545$15579=require("./pp"));(__lt____gt__$15580=$15545$15579["<>"]);($15546$15581=require("./location"));(__lt____lt____colon__$15582=$15546$15581["<<:"]);(util$15583=require("./util"));(GenSym$15584=util$15583.GenSym);(gensym$15585=util$15583.gensym);(neighbours$15586=util$15583.neighbours);(classify$15587=util$15583.classify);(classify_contiguous$15588=util$15583.classify_contiguous);(identity$15589=util$15583.identity);($15548$15590=require("./expand"));(checker_db$15591=$15548$15590.checker_db);(PatternParser$15592=function(scope$15646,pattern$15647,opt$15648){var tags$15664;var it$0$15651;(it$0$15651=function(){if((!$15467(PatternParser$15592)(this))){return Object.create(PatternParser$15592.prototype);}else{return this;}}());(it$0$15651["opt"]=opt$15648);(it$0$15651["arguments"]=[]);(it$0$15651["vars"]=[]);(it$0$15651["specials"]=({}));(tags$15664=$19385((opt$15648.tags||({}))));(tags$15664["group_id"]=(tags$15664.group_id||gensym$15585("group")));(it$0$15651["pattern"]=it$0$15651.expand(scope$15646,pattern$15647,tags$15664,true,it$0$15651.opt.indexable));return it$0$15651;});(PatternParser$15592.prototype["parse_specs"]=function(scope$15688,specs$15689,tags$15690){var $index$15751;var $length$15745;var temp$15739;var acc$15733;var rest$15708;var has_defaults$15709;var rval$15710;var it$0$15694;var self$15695;(it$0$15694=this);(self$15695=this);(rest$15708=(void 0));(has_defaults$15709=false);(rval$15710=classify$15587("fw","bw","keys","defaults",(((acc$15733=[])),(((temp$15739=scope$15688.step_all(["pattern"],specs$15689))),((($length$15745=temp$15739.length)),((($index$15751=0)),function(){$15719:for(;($index$15751<$length$15745);($index$15751++)){var v$15825;var v$15819;var variable$15807;var value$15808;var key$15800;var subp$15801;var key$15794;var variable$15774;var $15727$15768;var $15728$15769;var $15729$15770;var $15730$15771;var t0$15765;var t1$15766;var m$15760;(m$15760=temp$15739[$index$15751]);(t0$15765=m$15760);if((($15728$15769=(t0$15765 instanceof Array))&&(((t1$15766=t0$15765.length)),(($15730$15771=(t1$15766===2))&&(t0$15765[0]==="dynsplice"))))){(variable$15774=t0$15765[1]);acc$15733.push((((rest$15708=it$0$15694.expand(scope$15688,variable$15774,tags$15690))),["ignore"]));}else{if(($15730$15771&&(t0$15765[0]==="assoc"))){(key$15794=t0$15765[1]);acc$15733.push(["keys",[key$15794,it$0$15694.expand(scope$15688,key$15794,tags$15690)]]);}else{if(($15728$15769&&(($15730$15771=(t1$15766===3))&&(t0$15765[0]==="assoc")))){(key$15800=t0$15765[1]);(subp$15801=t0$15765[2]);acc$15733.push(["keys",[key$15800,it$0$15694.expand(scope$15688,subp$15801,tags$15690)]]);}else{if(($15730$15771&&(t0$15765[0]==="default"))){(variable$15807=t0$15765[1]);(value$15808=t0$15765[2]);acc$15733.push((((has_defaults$15709=true)),function(){if(rest$15708){throw $19518(["syntax","pattern"]).create("No default arguments after rest arg.");}else{return ["defaults",[it$0$15694.expand(scope$15688,variable$15807,tags$15690),value$15808]];}}()));}else{(v$15819=m$15760);if(((rest$15708===(void 0))&&(!has_defaults$15709))){acc$15733.push(["fw",it$0$15694.expand(scope$15688,v$15819,tags$15690)]);}else{(v$15825=m$15760);acc$15733.push(["bw",it$0$15694.expand(scope$15688,v$15825,tags$15690)]);}}}}}}}()))),acc$15733)));(rval$15710["rest"]=rest$15708);return rval$15710;});(PatternParser$15592.prototype["expand"]=function(){var x$15925;var x$15935;var x$15964;var x$15970;var variable$15977;var variable$15994;var x$16034;var msg$16042;var msg$16058;var $index$16100;var $length$16094;var temp$16088;var acc$16082;var $index$16233;var $length$16227;var temp$16221;var acc$16215;var $index$16269;var $length$16263;var temp$16257;var t0$16344;var t1$16345;var t2$16346;var $index$16392;var $length$16386;var temp$16380;var acc$16374;var patts$16366;var canon$16130;var normalize$16131;var pps$16132;var vars$16133;var patt$16467;var msg$16513;var other$16509;var keys$16473;var fw$16446;var bw$16447;var defaults$16448;var rest$16449;var $16424$16443;var t0$16436;var t1$16437;var t2$16438;var t3$16439;var t4$16440;var t5$16441;var $16420$16431;var specs$16425;var other$16525;var mode$16519;var subp$16520;var args$16415;var xs$16122;var xs$16074;var x$16064;var f$16048;var arg$16049;var f$16023;var arguments$16024;var checker$16017;var subp$16018;var projector$16011;var subp$16012;var condition$16005;var subp$16006;var v$16000;var v$15983;var type$15942;var $15901$15916;var $15902$15917;var $15903$15918;var $15904$15919;var t0$15912;var bridge$15886$15913;var t1$15914;var $15881$15907;var expr$15874;var rval$15875;var scope$15860;var pattern$15861;var tags$15862;var toplevel$15863;var checked$15864;var t0$15856;var $15839$15851;var it$0$15841;var self$15842;(it$0$15841=this);(self$15842=this);($15839$15851=arguments);(t0$15856=$15839$15851.length);if(((t0$15856>=3)&&(t0$15856<=5))){(scope$15860=$15839$15851[0]);(pattern$15861=$15839$15851[1]);(tags$15862=$15839$15851[2]);(toplevel$15863=function(){if((3>=t0$15856)){return false;}else{return $15839$15851[3];}}());(checked$15864=function(){if((4>=t0$15856)){return false;}else{return $15839$15851[4];}}());(expr$15874=scope$15860.step(["pattern"],pattern$15861));(rval$15875=((($15881$15907=expr$15874)),function(){if((((x$15925=$15881$15907)),((x$15925 instanceof Array)&&(x$15925[0]==="void")))){return ["check",checker_db$15591.null,["ignore"]];}else{if((((x$15935=$15881$15907)),((x$15935 instanceof Array)&&(x$15935[0]==="ignore")))){return expr$15874;}else{if((($15881$15907 instanceof Array)&&(((t0$15912=$15881$15907.length)),((t0$15912===2)&&($15881$15907[0]==="special"))))){(type$15942=$15881$15907[1]);(it$0$15841.specials[type$15942]=true);return expr$15874;}else{(bridge$15886$15913=$15881$15907);if(((((x$15964=bridge$15886$15913)),((x$15964 instanceof Array)&&(x$15964[0]==="symbol")))||(((x$15970=bridge$15886$15913)),((x$15970 instanceof Array)&&(x$15970[0]==="variable"))))){(variable$15977=$19796(expr$15874,tags$15862));it$0$15841.vars.push(variable$15977);return ["assign",variable$15977];}else{if((($15901$15916=($15881$15907 instanceof Array))&&(((t0$15912=$15881$15907.length)),(($15903$15918=(t0$15912===2))&&(($15904$15919=($15881$15907[0]==="value"))&&((v$15983=$15881$15907[1]),it$0$15841.opt.strings_as_variables)))))){(variable$15994=__lt____lt____colon__$15582($19796(["symbol",v$15983],tags$15862),expr$15874));it$0$15841.vars.push(variable$15994);return ["assign",variable$15994];}else{if($15904$15919){(v$16000=$15881$15907[1]);return ["check",checker_db$15591(v$16000),["ignore"]];}else{if(($15901$15916&&(($15903$15918=(t0$15912===3))&&($15881$15907[0]==="test")))){(condition$16005=$15881$15907[1]);(subp$16006=$15881$15907[2]);return ["test",condition$16005,it$0$15841.expand(scope$15860,subp$16006,tags$15862,toplevel$15863,false)];}else{if(($15903$15918&&($15881$15907[0]==="project"))){(projector$16011=$15881$15907[1]);(subp$16012=$15881$15907[2]);return ["project",projector$16011,it$0$15841.expand(scope$15860,subp$16012,tags$15862,toplevel$15863,true)];}else{if(($15903$15918&&($15881$15907[0]==="check"))){(checker$16017=$15881$15907[1]);(subp$16018=$15881$15907[2]);return ["check",checker$16017,it$0$15841.expand(scope$15860,subp$16018,tags$15862,toplevel$15863,true)];}else{if(($15903$15918&&(($15904$15919=($15881$15907[0]==="send"))&&((f$16023=$15881$15907[1]),(((t1$15914=$15881$15907[2])),(((x$16034=t1$15914)),((x$16034 instanceof Array)&&(x$16034[0]==="data")))))))){(arguments$16024=t1$15914);if(toplevel$15863){it$0$15841.arguments.unshift(arguments$16024);return it$0$15841.expand(scope$15860,f$16023,tags$15862,true,false);}else{(msg$16042="Function arguments can only be declared as a top level pattern.");throw $19518(["syntax","pattern"]).create(msg$16042,({"node":expr$15874,"arg":arguments$16024}));}}else{if($15904$15919){(f$16048=$15881$15907[1]);(arg$16049=$15881$15907[2]);return ["assign",expr$15874];}else{$15881$15907;if((!it$0$15841.opt.allow_nested)){(msg$16058="Nested patterns are not allowed here.");throw $19518(["syntax","pattern"]).create(msg$16058,({"node":expr$15874}));}else{if((($15901$15916=($15881$15907 instanceof Array))&&(((t0$15912=$15881$15907.length)),((t0$15912===2)&&($15881$15907[0]==="neg"))))){(x$16064=$15881$15907[1]);return ["neg",it$0$15841.expand(scope$15860,x$16064,tags$15862)];}else{if(($15901$15916&&(($15903$15918=(t0$15912>=1))&&($15881$15907[0]==="all")))){(xs$16074=Array.prototype.slice.call($15881$15907,1));return ["all"].concat((((acc$16082=[])),(((temp$16088=xs$16074)),((($length$16094=temp$16088.length)),((($index$16100=0)),function(){$16077:for(;($index$16100<$length$16094);($index$16100++)){var x$16117;var m$16109;(m$16109=temp$16088[$index$16100]);(x$16117=m$16109);acc$16082.push(it$0$15841.expand(scope$15860,x$16117,tags$15862));}}()))),acc$16082));}else{if(($15903$15918&&($15881$15907[0]==="any"))){(xs$16122=Array.prototype.slice.call($15881$15907,1));(canon$16130=function(all$16141){return all$16141.sort().join(",");});(normalize$16131=function(vars$16148){var $index$16173;var $length$16167;var temp$16161;var acc$16155;return canon$16130((((acc$16155=[])),(((temp$16161=vars$16148)),((($length$16167=temp$16161.length)),((($index$16173=0)),function(){$16150:for(;($index$16173<$length$16167);($index$16173++)){var v$16192;var t0$16187;var t1$16188;var m$16182;(m$16182=temp$16161[$index$16173]);(t0$16187=m$16182);if(((t0$16187 instanceof Array)&&(((t1$16188=t0$16187.length)),((t1$16188===2)&&(t0$16187[0]==="symbol"))))){(v$16192=t0$16187[1]);acc$16155.push(v$16192);}else{$19777(m$16182,"/home/olivier/git/earl-grey/src/pattern.eg",3845,3902);}}}()))),acc$16155));});(pps$16132=(((acc$16215=[])),(((temp$16221=xs$16122)),((($length$16227=temp$16221.length)),((($index$16233=0)),function(){$16210:for(;($index$16233<$length$16227);($index$16233++)){var x$16250;var m$16242;(m$16242=temp$16221[$index$16233]);(x$16250=m$16242);acc$16215.push(PatternParser$15592(scope$15860,x$16250,$19796(it$0$15841.opt,({"tags":tags$15862}))));}}()))),acc$16215));(temp$16257=neighbours$15586(pps$16132));($length$16263=temp$16257.length);($index$16269=0);$16134:for(;($index$16269<$length$16263);($index$16269++)){var $index$16320;var $length$16314;var temp$16308;var pp1$16288;var pp2$16289;var t0$16283;var t1$16284;var m$16278;(m$16278=temp$16257[$index$16269]);(t0$16283=m$16278);if(((t0$16283 instanceof Array)&&(((t1$16284=t0$16283.length)),(t1$16284===2)))){(pp1$16288=t0$16283[0]);(pp2$16289=t0$16283[1]);(temp$16308=pps$16132);($length$16314=temp$16308.length);($index$16320=0);$16302:for(;($index$16320<$length$16314);($index$16320++)){var pp$16337;var m$16329;(m$16329=temp$16308[$index$16320]);(pp$16337=m$16329);normalize$16131(pp$16337.vars);}if((normalize$16131(pp1$16288.vars)!==normalize$16131(pp2$16289.vars))){throw $19518(["syntax","pattern"]).create("Both branches of 'or' must contain the same variables",({"vars1":__lt____lt____colon__$15582(pp1$16288.vars.sort(),pp1$16288.pattern),"vars2":__lt____lt____colon__$15582(pp2$16289.vars.sort(),pp2$16289.pattern)}));}if((canon$16130($19818(pp1$16288.specials))!==canon$16130($19818(pp2$16289.specials)))){throw $19518(["syntax","pattern"]).create("Both branches of 'or' must contain the same special tokens",({"special1":__lt____lt____colon__$15582($19818(pp1$16288.specials).sort(),pp1$16288.pattern),"special2":__lt____lt____colon__$15582($19818(pp2$16289.specials).sort(),pp2$16289.pattern)}));}}else{$19777(m$16278,"/home/olivier/git/earl-grey/src/pattern.eg",3994,4791);}}(t0$16344=pps$16132);if(((t0$16344 instanceof Array)&&(((t1$16345=t0$16344.length)),((t1$16345>=1)&&(((t2$16346=t0$16344[0])),$19469(t2$16346,"vars")))))){(vars$16133=t2$16346.vars);Array.prototype.slice.call(t0$16344,1);}else{$19777(pps$16132,"/home/olivier/git/earl-grey/src/pattern.eg",4808,4811);}(it$0$15841["vars"]=it$0$15841.vars.concat(vars$16133));(patts$16366=(((acc$16374=[])),(((temp$16380=pps$16132)),((($length$16386=temp$16380.length)),((($index$16392=0)),function(){$16369:for(;($index$16392<$length$16386);($index$16392++)){var pp$16409;var m$16401;(m$16401=temp$16380[$index$16392]);(pp$16409=m$16401);acc$16374.push(pp$16409.pattern);}}()))),acc$16374));return ["any"].concat(patts$16366);}else{if(($15903$15918&&($15881$15907[0]==="data"))){(args$16415=Array.prototype.slice.call($15881$15907,1));(specs$16425=it$0$15841.parse_specs(scope$15860,args$16415,tags$15862));($16420$16431=specs$16425);if((($16424$16443=$19469($16420$16431,"keys"))&&(((t0$16436=$16420$16431.keys)),((t0$16436 instanceof Array)&&(((t1$16437=t0$16436.length)),((t1$16437===0)&&($19469($16420$16431,"fw")&&((fw$16446=$16420$16431.fw),($19469($16420$16431,"bw")&&((bw$16447=$16420$16431.bw),($19469($16420$16431,"defaults")&&((defaults$16448=$16420$16431.defaults),$19469($16420$16431,"rest"))))))))))))){(rest$16449=$16420$16431.rest);(patt$16467=__lt____lt____colon__$15582(["array_pattern",fw$16446,bw$16447,defaults$16448,rest$16449],pattern$15861));if(checked$15864){return patt$16467;}else{return ["check",checker_db$15591.Array,patt$16467];}}else{if(($16424$16443&&((keys$16473=$16420$16431.keys),($19469($16420$16431,"fw")&&(((t0$16436=$16420$16431.fw)),((t0$16436 instanceof Array)&&(((t1$16437=t0$16436.length)),((t1$16437===0)&&($19469($16420$16431,"bw")&&(((t2$16438=$16420$16431.bw)),((t2$16438 instanceof Array)&&(((t3$16439=t2$16438.length)),((t3$16439===0)&&($19469($16420$16431,"defaults")&&(((t4$16440=$16420$16431.defaults)),((t4$16440 instanceof Array)&&(((t5$16441=t4$16440.length)),((t5$16441===0)&&($19469($16420$16431,"rest")&&($16420$16431.rest===(void 0))))))))))))))))))))){return ["object_pattern"].concat(keys$16473);}else{(other$16509=$16420$16431);(msg$16513="Pattern must be an array or an object.");throw $19518(["syntax","pattern"]).create(msg$16513,({"node":expr$15874,"specs":specs$16425}));}}}else{if(($15901$15916&&((t0$15912===3)&&($15881$15907[0]==="mode")))){(mode$16519=$15881$15907[1]);(subp$16520=$15881$15907[2]);return it$0$15841.expand(scope$15860,subp$16520,$19796(tags$15862,({"declare_mode":mode$16519})),toplevel$15863,checked$15864);}else{(other$16525=$15881$15907);throw $19518(["syntax","pattern"]).create("Illegal pattern",({"node":other$16525}));}}}}}}}}}}}}}}}}}}()));return (it$0$15841.opt.wrap_pattern||identity$15589)(__lt____lt____colon__$15582(rval$15875,pattern$15861),toplevel$15863);}else{$19777($15839$15851);}});$15487(PatternParser$15592,$15487(((accum$16533=({})),((accum$16533["::name"]="PatternParser"),accum$16533)),((accum$16537=({})),((accum$16537["::egclass"]=true),accum$16537))));PatternParser$15592;(PatternProcessor$15593=function(){var it$0$16546;(it$0$16546=function(){if((!$15467(PatternProcessor$15593)(this))){return Object.create(PatternProcessor$15593.prototype);}else{return this;}}());(it$0$16546["temps"]=[]);(it$0$16546["parts"]=[]);(it$0$16546["gen"]=GenSym$15584("t"));return it$0$16546;});(PatternProcessor$15593.prototype["do"]=function(part$16570){var it$0$16574;var self$16575;(it$0$16574=this);(self$16575=this);return it$0$16574.parts.push(["do",part$16570]);});(PatternProcessor$15593.prototype["check"]=function(){var part$16611;var tags$16612;var t0$16607;var $16590$16602;var it$0$16592;var self$16593;(it$0$16592=this);(self$16593=this);($16590$16602=arguments);(t0$16607=$16590$16602.length);if(((t0$16607>=1)&&(t0$16607<=2))){(part$16611=$16590$16602[0]);(tags$16612=function(){if((1>=t0$16607)){return ({});}else{return $16590$16602[1];}}());return it$0$16592.parts.push($19796(["check",part$16611],tags$16612));}else{$19777($16590$16602);}});(PatternProcessor$15593.prototype["temp"]=function(){var x$16679;var x$16685;var init$16692;var bridge$16659$16668;var $16657$16663;var x$16649;var v$16650;var t0$16645;var $16628$16640;var it$0$16630;var self$16631;(it$0$16630=this);(self$16631=this);($16628$16640=arguments);(t0$16645=$16628$16640.length);if(((t0$16645>=1)&&(t0$16645<=2))){(x$16649=$16628$16640[0]);(v$16650=function(){if((1>=t0$16645)){return null;}else{return $16628$16640[1];}}());($16657$16663=x$16649);(bridge$16659$16668=$16657$16663);if((((((x$16679=bridge$16659$16668)),((x$16679 instanceof Array)&&(x$16679[0]==="variable")))||(((x$16685=bridge$16659$16668)),((x$16685 instanceof Array)&&(x$16685[0]==="symbol"))))&&($19469($16657$16663,"single_assignment")&&($16657$16663.single_assignment&&(!v$16650))))){return x$16649;}else{(init$16692=$16657$16663);(v$16650=(v$16650||["symbol",it$0$16630.gen()]));(v$16650["single_assignment"]=true);it$0$16630.temps.push(v$16650);it$0$16630.do(["send",["symbol","="],["data",["send",["symbol","set"],v$16650],init$16692]]);return v$16650;}}else{$19777($16628$16640);}});(PatternProcessor$15593.prototype["process"]=function(pattern$16709,rhs$16710,fns$16711){var x$16764;var x$16798;var t$16811;var t$16823;var pp$16834;var $index$16867;var $length$16861;var temp$16855;var t$16845;var $index$16935;var $length$16929;var temp$16923;var acc$16917;var fn$16900;var parts$16901;var t$16893;var $index$16996;var $length$16990;var temp$16984;var acc$16978;var t$16969;var otherwise$17129;var $17107$17113;var $index$17146;var $length$17140;var temp$17134;var $index$17195;var $length$17189;var temp$17183;var end$17257;var pos$17251;var $index$17281;var $length$17275;var temp$17269;var acc$17263;var nfw$17062;var nbw$17063;var ndflt$17064;var extract_length$17065;var check_length$17066;var lo$17067;var hi$17068;var t$17069;var len$17070;var fw$17046;var bw$17047;var dflt$17048;var rest$17049;var subp$16964;var xs$16888;var xs$16840;var patt$16829;var projector$16817;var subp$16818;var checker$16805;var subp$16806;var checker$16793;var condition$16786;var subp$16787;var kind$16781;var sym$16771;var $16742$16755;var $16743$16756;var $16744$16757;var $16745$16758;var t0$16753;var $16729$16748;var rval$16726;var it$0$16715;var self$16716;(it$0$16715=this);(self$16716=this);(rval$16726=((($16729$16748=pattern$16709)),function(){if((((x$16764=$16729$16748)),((x$16764 instanceof Array)&&(x$16764[0]==="ignore")))){return it$0$16715.do(rhs$16710);}else{if((($16742$16755=($16729$16748 instanceof Array))&&(((t0$16753=$16729$16748.length)),(($16744$16757=(t0$16753===2))&&($16729$16748[0]==="assign"))))){(sym$16771=$16729$16748[1]);return it$0$16715.parts.push(fns$16711.assign(sym$16771,rhs$16710));}else{if(($16744$16757&&($16729$16748[0]==="special"))){(kind$16781=$16729$16748[1]);return it$0$16715.process(fns$16711.special(pattern$16709,rhs$16710),rhs$16710,fns$16711);}else{if(($16742$16755&&(($16744$16757=(t0$16753===3))&&($16729$16748[0]==="test")))){(condition$16786=$16729$16748[1]);(subp$16787=$16729$16748[2]);it$0$16715.process(subp$16787,rhs$16710,fns$16711);return it$0$16715.check(condition$16786,({"test":true}));}else{if(($16744$16757&&(($16745$16758=($16729$16748[0]==="check"))&&((checker$16793=$16729$16748[1]),(((x$16798=$16729$16748[2])),((x$16798 instanceof Array)&&(x$16798[0]==="ignore"))))))){return it$0$16715.check(["send",checker$16793,["data",rhs$16710]]);}else{if($16745$16758){(checker$16805=$16729$16748[1]);(subp$16806=$16729$16748[2]);(t$16811=it$0$16715.temp(rhs$16710));it$0$16715.check(["send",checker$16805,["data",t$16811]]);return it$0$16715.process(subp$16806,t$16811,fns$16711);}else{if(($16744$16757&&($16729$16748[0]==="project"))){(projector$16817=$16729$16748[1]);(subp$16818=$16729$16748[2]);(t$16823=it$0$16715.temp(["send",projector$16817,["data",rhs$16710]]));it$0$16715.check(["send",t$16823,["value",0]]);return it$0$16715.process(subp$16818,["send",t$16823,["value",1]],fns$16711);}else{if(($16742$16755&&((t0$16753===2)&&($16729$16748[0]==="neg")))){(patt$16829=$16729$16748[1]);return it$0$16715.check(["send",["symbol","not"],["data",["void"],(((pp$16834=PatternProcessor$15593())),pp$16834.process(patt$16829,rhs$16710,fns$16711),assemble_conditions$15594(pp$16834))]]);}else{if(($16742$16755&&(($16744$16757=(t0$16753>=1))&&($16729$16748[0]==="all")))){(xs$16840=Array.prototype.slice.call($16729$16748,1));(t$16845=it$0$16715.temp(rhs$16710));(temp$16855=xs$16840);($length$16861=temp$16855.length);($index$16867=0);$16846:for(;($index$16867<$length$16861);($index$16867++)){var x$16884;var m$16876;(m$16876=temp$16855[$index$16867]);(x$16884=m$16876);it$0$16715.process(x$16884,t$16845,fns$16711);}return null;}else{if(($16744$16757&&($16729$16748[0]==="any"))){(xs$16888=Array.prototype.slice.call($16729$16748,1));(t$16893=it$0$16715.temp(rhs$16710,["symbol",gensym$15585("bridge")]));return it$0$16715.check((((fn$16900=function(x$16906,rest$16907){return ["send",["symbol","or"],["data",x$16906,rest$16907]];})),((parts$16901=(((acc$16917=[])),(((temp$16923=xs$16888)),((($length$16929=temp$16923.length)),((($index$16935=0)),function(){$16912:for(;($index$16935<$length$16929);($index$16935++)){var pp$16957;var x$16952;var m$16944;(m$16944=temp$16923[$index$16935]);(x$16952=m$16944);acc$16917.push((((pp$16957=PatternProcessor$15593())),pp$16957.process(x$16952,t$16893,fns$16711),assemble_conditions$15594(pp$16957)));}}()))),acc$16917))),util$15583.construct(parts$16901,fn$16900,["symbol","false"])));}else{if(($16744$16757&&($16729$16748[0]==="object_pattern"))){(subp$16964=Array.prototype.slice.call($16729$16748,1));(t$16969=it$0$16715.temp(rhs$16710));(acc$16978=[]);(temp$16984=subp$16964);($length$16990=temp$16984.length);($index$16996=0);$16970:for(;($index$16996<$length$16990);($index$16996++)){var k$17017;var v$17018;var t0$17010;var t1$17011;var t2$17012;var t3$17013;var m$17005;(m$17005=temp$16984[$index$16996]);(t0$17010=m$17005);if(((t0$17010 instanceof Array)&&(((t1$17011=t0$17010.length)),((t1$17011===2)&&(((t2$17012=t0$17010[0])),((t2$17012 instanceof Array)&&(((t3$17013=t2$17012.length)),((t3$17013===2)&&(t2$17012[0]==="value"))))))))){(k$17017=t2$17012[1]);(v$17018=t0$17010[1]);acc$16978.push((it$0$16715.check(["send",["symbol","___hasprop"],["data",t$16969,["value",k$17017]]]),it$0$16715.process(v$17018,["send",t$16969,["value",k$17017]],fns$16711)));}else{$19777(m$17005,"/home/olivier/git/earl-grey/src/pattern.eg",8140,8272);}}return acc$16978;}else{if(($16742$16755&&((t0$16753===5)&&($16729$16748[0]==="array_pattern")))){(fw$17046=$16729$16748[1]);(bw$17047=$16729$16748[2]);(dflt$17048=$16729$16748[3]);(rest$17049=$16729$16748[4]);(nfw$17062=fw$17046.length);(nbw$17063=bw$17047.length);(ndflt$17064=dflt$17048.length);(extract_length$17065=true);(check_length$17066=true);(lo$17067=(nfw$17062+nbw$17063));(hi$17068=(lo$17067+ndflt$17064));(t$17069=it$0$16715.temp(rhs$16710));(len$17070=it$0$16715.temp(["send",t$17069,["send",["symbol","."],["data",["void"],["symbol","length"]]]]));it$0$16715.check(((($17107$17113=rest$17049)),function(){if($17107$17113){return ["send",["symbol",">="],["data",len$17070,["value",lo$17067]]];}else{$17107$17113;if((lo$17067===hi$17068)){return ["send",["symbol","==="],["data",len$17070,["value",lo$17067]]];}else{(otherwise$17129=$17107$17113);return ["send",["symbol","and"],["data",["send",["symbol",">="],["data",len$17070,["value",lo$17067]]],["send",["symbol","<="],["data",len$17070,["value",hi$17068]]]]];}}}()));(temp$17134=$19751(fw$17046));($length$17140=temp$17134.length);($index$17146=0);$17071:for(;($index$17146<$length$17140);($index$17146++)){var i$17165;var m$17166;var t0$17160;var t1$17161;var m$17155;(m$17155=temp$17134[$index$17146]);(t0$17160=m$17155);if(((t0$17160 instanceof Array)&&(((t1$17161=t0$17160.length)),(t1$17161===2)))){(i$17165=t0$17160[0]);(m$17166=t0$17160[1]);it$0$16715.process(m$17166,["send",t$17069,["value",i$17165]],fns$16711);}else{$19777(m$17155,"/home/olivier/git/earl-grey/src/pattern.eg",9004,9090);}}(temp$17183=$19751(dflt$17048));($length$17189=temp$17183.length);($index$17195=0);$17074:for(;($index$17195<$length$17189);($index$17195++)){var idx$17243;var i$17216;var patt$17217;var value$17218;var t0$17209;var t1$17210;var t2$17211;var t3$17212;var m$17204;(m$17204=temp$17183[$index$17195]);(t0$17209=m$17204);if(((t0$17209 instanceof Array)&&(((t1$17210=t0$17209.length)),((t1$17210===2)&&((i$17216=t0$17209[0]),(((t2$17211=t0$17209[1])),((t2$17211 instanceof Array)&&(((t3$17212=t2$17211.length)),(t3$17212===2))))))))){(patt$17217=t2$17211[0]);(value$17218=t2$17211[1]);(idx$17243=(i$17216+nfw$17062));it$0$16715.process(patt$17217,["send",["symbol","if"],["data",["send",["symbol",">="],["data",["value",(idx$17243+nbw$17063)],len$17070]],value$17218,["send",t$17069,["value",idx$17243]]]],fns$16711);}else{$19777(m$17204,"/home/olivier/git/earl-grey/src/pattern.eg",9090,9259);}}if((rest$17049!==(void 0))){(pos$17251=(nfw$17062+ndflt$17064));(end$17257=function(){if((nbw$17063>0)){return [["value",(-nbw$17063)]];}else{return [];}}());it$0$16715.process(rest$17049,["send",["send",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",t$17069,["value",pos$17251]].concat(end$17257)],fns$16711);}else{[];}(acc$17263=[]);(temp$17269=$19751(bw$17047));($length$17275=temp$17269.length);($index$17281=0);$17077:for(;($index$17281<$length$17275);($index$17281++)){var i$17300;var m$17301;var t0$17295;var t1$17296;var m$17290;(m$17290=temp$17269[$index$17281]);(t0$17295=m$17290);if(((t0$17295 instanceof Array)&&(((t1$17296=t0$17295.length)),(t1$17296===2)))){(i$17300=t0$17295[0]);(m$17301=t0$17295[1]);acc$17263.push(it$0$16715.process(m$17301,["send",["symbol","___js_fetch"],["data",t$17069,["send",["symbol","-"],["data",len$17070,["value",(nbw$17063-i$17300)]]]]],fns$16711));}else{$19777(m$17290,"/home/olivier/git/earl-grey/src/pattern.eg",9710,9861);}}return acc$17263;}else{$19777($16729$16748);}}}}}}}}}}}}}()));return rval$16726;});$15487(PatternProcessor$15593,$15487(((accum$17322=({})),((accum$17322["::name"]="PatternProcessor"),accum$17322)),((accum$17326=({})),((accum$17326["::egclass"]=true),accum$17326))));PatternProcessor$15593;(assemble_conditions$15594=function(pp$17333){var $index$17457;var $length$17451;var temp$17445;var acc$17439;var decls$17431;var construct$17337;(construct$17337=function($17341$17344){var x$17412;var rest$17413;var x$17397;var x$17381;var rest$17382;var $17351$17368;var $17352$17369;var t0$17364;var t1$17365;var t2$17366;var $17346$17359;var ph$17353;(ph$17353=$17341$17344);($17346$17359=ph$17353);if((($17351$17368=($17346$17359 instanceof Array))&&(((t0$17364=$17346$17359.length)),(t0$17364===0)))){return ["value",true];}else{if(($17351$17368&&((t0$17364>=1)&&(((t1$17365=$17346$17359[0])),((t1$17365 instanceof Array)&&(((t2$17366=t1$17365.length)),((t2$17366===2)&&(t1$17365[0]==="do")))))))){(x$17381=t1$17365[1]);(rest$17382=Array.prototype.slice.call($17346$17359,1));return ["multi",x$17381,construct$17337(rest$17382)];}else{if(($17351$17368&&((t0$17364===1)&&(((t1$17365=$17346$17359[0])),((t1$17365 instanceof Array)&&(((t2$17366=t1$17365.length)),((t2$17366===2)&&(t1$17365[0]==="check")))))))){(x$17397=t1$17365[1]);return x$17397;}else{if(($17351$17368&&((t0$17364>=1)&&(((t1$17365=$17346$17359[0])),((t1$17365 instanceof Array)&&(((t2$17366=t1$17365.length)),((t2$17366===2)&&(t1$17365[0]==="check")))))))){(x$17412=t1$17365[1]);(rest$17413=Array.prototype.slice.call($17346$17359,1));return ["send",["symbol","and"],["data",x$17412,construct$17337(rest$17413)]];}else{$19777($17346$17359);}}}}});if(pp$17333.temps.length){(decls$17431=(((acc$17439=[])),(((temp$17445=pp$17333.temps)),((($length$17451=temp$17445.length)),((($index$17457=0)),function(){$17434:for(;($index$17457<$length$17451);($index$17457++)){var t$17474;var m$17466;(m$17466=temp$17445[$index$17457]);(t$17474=m$17466);acc$17439.push(["declare",t$17474]);}}()))),acc$17439));return ["multi"].concat(decls$17431).concat([construct$17337(pp$17333.parts)]);}else{return construct$17337(pp$17333.parts);}});(assemble_pattern$15595=function(){var $index$17546;var $length$17540;var temp$17534;var $index$17607;var $length$17601;var temp$17595;var test$17746;var lead$17509;var trail$17510;var construct$17511;var parts$17496;var t$17497;var f$17498;var t0$17492;var $17483$17487;($17483$17487=arguments);(t0$17492=$17483$17487.length);if(((t0$17492>=2)&&(t0$17492<=3))){(parts$17496=$17483$17487[0]);(t$17497=$17483$17487[1]);(f$17498=function(){if((2>=t0$17492)){return null;}else{return $17483$17487[2];}}());(lead$17509=[]);(temp$17534=parts$17496.slice(0));($length$17540=temp$17534.length);($index$17546=0);$17512:for(;($index$17546<$length$17540);($index$17546++)){var x$17584;var x$17569;var $17516$17563;var $17517$17564;var $17518$17565;var $17519$17566;var t0$17560;var t1$17561;var m$17555;(m$17555=temp$17534[$index$17546]);(t0$17560=m$17555);if((($17517$17564=(t0$17560 instanceof Array))&&(((t1$17561=t0$17560.length)),(($17519$17566=(t1$17561===2))&&(t0$17560[0]==="do"))))){(x$17569=t0$17560[1]);lead$17509.push(x$17569);parts$17496.shift();}else{if(($17519$17566&&(t0$17560[0]==="check"))){(x$17584=t0$17560[1]);break $17512;}else{$19777(m$17555,"/home/olivier/git/earl-grey/src/pattern.eg",10322,10432);}}}(trail$17510=[]);(temp$17595=parts$17496.slice(0).reverse());($length$17601=temp$17595.length);($index$17607=0);$17520:for(;($index$17607<$length$17601);($index$17607++)){var x$17645;var x$17630;var $17524$17624;var $17525$17625;var $17526$17626;var $17527$17627;var t0$17621;var t1$17622;var m$17616;(m$17616=temp$17595[$index$17607]);(t0$17621=m$17616);if((($17525$17625=(t0$17621 instanceof Array))&&(((t1$17622=t0$17621.length)),(($17527$17627=(t1$17622===2))&&(t0$17621[0]==="do"))))){(x$17630=t0$17621[1]);trail$17510.unshift(x$17630);parts$17496.pop();}else{if(($17527$17627&&(t0$17621[0]==="check"))){(x$17645=t0$17621[1]);break $17520;}else{$19777(m$17616,"/home/olivier/git/earl-grey/src/pattern.eg",10446,10568);}}}(construct$17511=function($17653$17656){var other$17741;var x$17725;var rest$17726;var x$17710;var x$17694;var rest$17695;var $17664$17681;var $17665$17682;var t0$17677;var t1$17678;var t2$17679;var $17658$17672;var ph$17666;(ph$17666=$17653$17656);($17658$17672=ph$17666);if((($17664$17681=($17658$17672 instanceof Array))&&(((t0$17677=$17658$17672.length)),(t0$17677===0)))){return ["value",true];}else{if(($17664$17681&&((t0$17677>=1)&&(((t1$17678=$17658$17672[0])),((t1$17678 instanceof Array)&&(((t2$17679=t1$17678.length)),((t2$17679===2)&&(t1$17678[0]==="do")))))))){(x$17694=t1$17678[1]);(rest$17695=Array.prototype.slice.call($17658$17672,1));return ["multi",x$17694,construct$17511(rest$17695)];}else{if(($17664$17681&&((t0$17677===1)&&(((t1$17678=$17658$17672[0])),((t1$17678 instanceof Array)&&(((t2$17679=t1$17678.length)),((t2$17679===2)&&(t1$17678[0]==="check")))))))){(x$17710=t1$17678[1]);return x$17710;}else{if(($17664$17681&&((t0$17677>=1)&&(((t1$17678=$17658$17672[0])),((t1$17678 instanceof Array)&&(((t2$17679=t1$17678.length)),((t2$17679===2)&&(t1$17678[0]==="check")))))))){(x$17725=t1$17678[1]);(rest$17726=Array.prototype.slice.call($17658$17672,1));return ["send",["symbol","and"],["data",x$17725,construct$17511(rest$17726)]];}else{(other$17741=$17658$17672);throw $19518(["oops"]).create("?!?",other$17741);}}}}});if(parts$17496.length){(test$17746=construct$17511(parts$17496));return ["multi"].concat(lead$17509).concat([function(){if(f$17498){return ["send",["symbol","if"],["data",test$17746,["multi"].concat(trail$17510).concat([t$17497]),f$17498]];}else{return ["send",["symbol","if"],["data",test$17746,["multi"].concat(trail$17510).concat([t$17497])]];}}()]);}else{return ["multi"].concat(lead$17509).concat(trail$17510).concat([t$17497]);}}else{$19777($17483$17487);}});(inject_below_uses$15596=function($17756$17759,fn$17760){var other$17791;var scope$17780;var x$17781;var t0$17776;var $17762$17771;var ph$17765;(ph$17765=$17756$17759);($17762$17771=ph$17765);if((($17762$17771 instanceof Array)&&(((t0$17776=$17762$17771.length)),((t0$17776===3)&&($17762$17771[0]==="use"))))){(scope$17780=$17762$17771[1]);(x$17781=$17762$17771[2]);return ["use",scope$17780,inject_below_uses$15596(x$17781,fn$17760)];}else{(other$17791=$17762$17771);return fn$17760(other$17791);}});(parse_pattern$15597=function(scope$17798,pattern$17799,rhs$17800,opt$17801){var t0$17815;var $index$17867;var $length$17861;var temp$17855;var acc$17849;var parse$17807;var target$17808;var proc$17809;(parse$17807=PatternParser$15592(scope$17798,pattern$17799,opt$17801));if(((!opt$17801.allow_arguments)&&parse$17807.arguments.length)){throw $19518(["syntax","pattern","arguments"]).create("Arguments cannot be declared in this pattern",({"args":parse$17807.arguments[0]}));}(t0$17815=$19819((opt$17801.wrap_target||identity$15589))(function(){if(parse$17807.arguments.length){return inject_below_uses$15596(rhs$17800,function(x$17822){return util$15583.construct(parse$17807.arguments.concat([x$17822]),function(args$17826,rest$17827){return ["send",["symbol","->"],["data",args$17826,rest$17827]];});});}else{return rhs$17800;}}()));if(t0$17815[0]){(target$17808=t0$17815[1]);}else{$19777(function(){if(parse$17807.arguments.length){return inject_below_uses$15596(rhs$17800,function(x$17834){return util$15583.construct(parse$17807.arguments.concat([x$17834]),function(args$17838,rest$17839){return ["send",["symbol","->"],["data",args$17838,rest$17839]];});});}else{return rhs$17800;}}(),"/home/olivier/git/earl-grey/src/pattern.eg",11961,12394);}(proc$17809=PatternProcessor$15593());proc$17809.process(parse$17807.pattern,target$17808,opt$17801);if(opt$17801.finalize){return ["splice"].concat(opt$17801.declare(scope$17798,parse$17807.vars)).concat([["multi"].concat((((acc$17849=[])),(((temp$17855=proc$17809.temps)),((($length$17861=temp$17855.length)),((($index$17867=0)),function(){$17844:for(;($index$17867<$length$17861);($index$17867++)){var t$17884;var m$17876;(m$17876=temp$17855[$index$17867]);(t$17884=m$17876);acc$17849.push(["declare",t$17884]);}}()))),acc$17849)).concat([assemble_pattern$15595(proc$17809.parts,opt$17801.success(target$17808),opt$17801.failure(target$17808))])]);}else{return [parse$17807.vars,proc$17809.temps,proc$17809.parts];}});(checkall$15598=["send","data","multi","assign","void","check","do"]);(same_block$15599=function($17894$17897,ban1$17898,ban2$17899){var $index$18063;var $length$18057;var temp$18051;var other$18085;var type1$18024;var args1$18025;var type2$18026;var args2$18027;var m1$18007;var m2$18008;var v1$17990;var v2$17991;var s1$17973;var s2$17974;var v1$17941;var v2$17942;var $17908$17932;var $17909$17933;var $17910$17934;var $17911$17935;var $17912$17936;var $17913$17937;var $17914$17938;var t0$17926;var t1$17927;var t2$17928;var t3$17929;var t4$17930;var $17901$17921;var ph$17915;(ph$17915=$17894$17897);($17901$17921=ph$17915);if((($17908$17932=($17901$17921 instanceof Array))&&(((t0$17926=$17901$17921.length)),(($17910$17934=(t0$17926===2))&&(((t1$17927=$17901$17921[0])),(($17912$17936=(t1$17927 instanceof Array))&&(((t2$17928=t1$17927.length)),(($17914$17938=(t2$17928===2))&&((t1$17927[0]==="variable")&&((v1$17941=t1$17927[1]),(((t3$17929=$17901$17921[1])),((t3$17929 instanceof Array)&&(((t4$17930=t3$17929.length)),((t4$17930===2)&&(t3$17929[0]==="variable"))))))))))))))){(v2$17942=t3$17929[1]);return (v1$17941===v2$17942);}else{if(($17914$17938&&((t1$17927[0]==="symbol")&&((s1$17973=t1$17927[1]),(((t3$17929=$17901$17921[1])),((t3$17929 instanceof Array)&&(((t4$17930=t3$17929.length)),((t4$17930===2)&&(t3$17929[0]==="symbol"))))))))){(s2$17974=t3$17929[1]);return (((!$15486(ban1$17898,s1$17973))&&(!$15486(ban2$17899,s2$17974)))&&(s1$17973===s2$17974));}else{if(($17914$17938&&((t1$17927[0]==="value")&&((v1$17990=t1$17927[1]),(((t3$17929=$17901$17921[1])),((t3$17929 instanceof Array)&&(((t4$17930=t3$17929.length)),((t4$17930===2)&&(t3$17929[0]==="value"))))))))){(v2$17991=t3$17929[1]);return (v1$17990===v2$17991);}else{if(($17914$17938&&((t1$17927[0]==="macro")&&((m1$18007=t1$17927[1]),(((t3$17929=$17901$17921[1])),((t3$17929 instanceof Array)&&(((t4$17930=t3$17929.length)),((t4$17930===2)&&(t3$17929[0]==="macro"))))))))){(m2$18008=t3$17929[1]);return (m1$18007===m2$18008);}else{if(($17912$17936&&((t2$17928>=1)&&((type1$18024=t1$17927[0]),((args1$18025=Array.prototype.slice.call(t1$17927,1)),(((t3$17929=$17901$17921[1])),((t3$17929 instanceof Array)&&(((t4$17930=t3$17929.length)),((t4$17930>=1)&&((type2$18026=t3$17929[0]),((args2$18027=Array.prototype.slice.call(t3$17929,1)),(checkall$15598.indexOf(type1$18024)!==-1)))))))))))){if(((type1$18024===type2$18026)&&(args1$18025.length===args2$18027.length))){(temp$18051=$19866(args1$18025,args2$18027));($length$18057=temp$18051.length);($index$18063=0);$18045:for(;($index$18063<$length$18057);($index$18063++)){var pair$18080;var m$18072;(m$18072=temp$18051[$index$18063]);(pair$18080=m$18072);if((!same_block$15599(pair$18080,ban1$17898,ban2$17899))){return false;}}return true;}else{return false;}}else{(other$18085=$17901$17921);return false;}}}}}});(parse_clauses$15600=function(scope$18092,target$18093,stmts$18094,opt$18095){var $index$18135;var $length$18129;var temp$18123;var acc$18117;var $index$18381;var $length$18375;var temp$18369;var acc$18363;var $index$18444;var $length$18438;var temp$18432;var acc$18426;var decls$18418;var all_temps$18101;var the_parts$18102;var unique_temps$18103;(all_temps$18101=[]);(the_parts$18102=(((acc$18117=[])),(((temp$18123=scope$18092.step_all(["clause"],stmts$18094))),((($length$18129=temp$18123.length)),((($index$18135=0)),function(){$18109:for(;($index$18135<$length$18129);($index$18135++)){var accum$18247;var accum$18265;var t0$18239;var t1$18240;var $index$18292;var $length$18286;var temp$18280;var bod$18333;var placeholder$18174;var special_fn$18175;var vars$18176;var temps$18177;var blocks$18178;var vars2$18179;var x$18343;var other$18351;var b$18339;var pattern$18155;var body$18156;var $18114$18152;var t0$18149;var t1$18150;var m$18144;(m$18144=temp$18123[$index$18135]);(t0$18149=m$18144);if(((t0$18149 instanceof Array)&&(((t1$18150=t0$18149.length)),((t1$18150===3)&&(t0$18149[0]==="clause"))))){(pattern$18155=t0$18149[1]);(body$18156=t0$18149[2]);acc$18117.push((((placeholder$18174=(void 0))),((special_fn$18175=function($18190$18193,value$18194){var t0$18202;var t1$18203;var other$18235;var $18196$18218;var ph$18199;var expr$18200;(t0$18202=$18190$18193);if(((t0$18202 instanceof Array)&&(((t1$18203=t0$18202.length)),((t1$18203===2)&&(t0$18202[0]==="special"))))){(ph$18199=t0$18202[1]);(expr$18200=t0$18202);}else{$19777($18190$18193);}($18196$18218=ph$18199);if(($18196$18218==="match")){(placeholder$18174=__lt____lt____colon__$15582(["symbol",scope$18092.gensym("ph")],expr$18200));return ["assign",placeholder$18174];}else{(other$18235=$18196$18218);throw $19518(["syntax","pattern","special"]).create("Special token cannot be used here",({"special":expr$18200}));}})),(((t0$18239=parse_pattern$15597(scope$18092,pattern$18155,target$18093,$19796(opt$18095,$15487(({"allow_arguments":false,"allow_nested":true,"special":special_fn$18175}),$15487(((accum$18247=({})),((accum$18247["assign"]=function(v$18252,value$18253){return ["do",__lt____lt____colon__$15582(["assign",v$18252,value$18253],v$18252)];}),accum$18247)),({"finalize":false}))))))),function(){if(((t0$18239 instanceof Array)&&(((t1$18240=t0$18239.length)),(t1$18240===3)))){(vars$18176=t0$18239[0]);(temps$18177=t0$18239[1]);(blocks$18178=t0$18239[2]);}else{return $19777(parse_pattern$15597(scope$18092,pattern$18155,target$18093,$19796(opt$18095,$15487(({"allow_arguments":false,"allow_nested":true,"special":special_fn$18175}),$15487(((accum$18265=({})),((accum$18265["assign"]=function(v$18270,value$18271){return ["do",__lt____lt____colon__$15582(["assign",v$18270,value$18271],v$18270)];}),accum$18265)),({"finalize":false}))))),"/home/olivier/git/earl-grey/src/pattern.eg",14032,14379);}}()),(all_temps$18101=all_temps$18101.concat(temps$18177)),function(){if(placeholder$18174){return vars$18176.push(placeholder$18174);}}(),((vars2$18179=({}))),(((temp$18280=vars$18176)),((($length$18286=temp$18280.length)),((($index$18292=0)),function(){$18180:for(;($index$18292<$length$18286);($index$18292++)){var other$18329;var xxx$18311;var t0$18306;var t1$18307;var m$18301;(m$18301=temp$18280[$index$18292]);(t0$18306=m$18301);if(((t0$18306 instanceof Array)&&(((t1$18307=t0$18306.length)),((t1$18307===2)&&(t0$18306[0]==="symbol"))))){(xxx$18311=t0$18306[1]);(vars2$18179[xxx$18311]=true);}else{(other$18329=m$18301);throw $19518(["syntax","unexpected"]).create();}}}()))),(((bod$18333=function(){if(placeholder$18174){return parse_clauses$15600(scope$18092,placeholder$18174,$19819(["multi"])(body$18156)[1],opt$18095);}else{if(opt$18095.wrap){return opt$18095.wrap(body$18156);}else{return body$18156;}}}())),["clause",vars$18176,vars2$18179,blocks$18178,bod$18333])));}else{if((((x$18343=t0$18149)),((x$18343 instanceof Array)&&(x$18343[0]==="block")))){(b$18339=t0$18149);acc$18117.push(b$18339);}else{(other$18351=m$18144);acc$18117.push(function(){throw $19518(["syntax","clause"]).create("Illegal clause",({"clause":other$18351}));}());}}}}()))),acc$18117));if(opt$18095.fallback){the_parts$18102.push(["block",opt$18095.fallback(target$18093)]);}(unique_temps$18103=$19818(util$15583.mkset((((acc$18363=[])),(((temp$18369=all_temps$18101)),((($length$18375=temp$18369.length)),((($index$18381=0)),function(){$18358:for(;($index$18381<$length$18375);($index$18381++)){var t$18400;var t0$18395;var t1$18396;var m$18390;(m$18390=temp$18369[$index$18381]);(t0$18395=m$18390);if(((t0$18395 instanceof Array)&&(((t1$18396=t0$18395.length)),((t1$18396===2)&&(t0$18395[0]==="symbol"))))){(t$18400=t0$18395[1]);acc$18363.push(t$18400);}else{$19777(m$18390,"/home/olivier/git/earl-grey/src/pattern.eg",15188,15218);}}}()))),acc$18363))));(decls$18418=(((acc$18426=[])),(((temp$18432=unique_temps$18103)),((($length$18438=temp$18432.length)),((($index$18444=0)),function(){$18421:for(;($index$18444<$length$18438);($index$18444++)){var t$18461;var m$18453;(m$18453=temp$18432[$index$18444]);(t$18461=m$18453);acc$18426.push(["declare",$15487(["symbol",t$18461],({"mutable":true}))]);}}()))),acc$18426));return ["multi"].concat(decls$18418).concat([weave_clauses$15602(the_parts$18102)]);});(opt_clauses$15601=function(clauses$18470){var $index$18510;var $length$18504;var temp$18498;var acc$18492;var $index$18694;var $length$18688;var temp$18682;var acc$18676;var $index$18754;var $length$18748;var temp$18742;var acc$18736;var $index$18806;var $length$18800;var temp$18794;var acc$18788;var shares$18479;var max$18480;var temps$18481;var shared_last$18482;var idx_last$18483;var new_clauses$18484;(shares$18479=(((acc$18492=[])),(((temp$18498=$19751(clauses$18470.slice(1)))),((($length$18504=temp$18498.length)),((($index$18510=0)),function(){$18487:for(;($index$18510<$length$18504);($index$18510++)){var t0$18571;var t1$18572;var $index$18606;var $length$18600;var temp$18594;var varsd0$18563;var blocks0$18564;var share$18565;var idx$18566;var i$18531;var vars$18532;var varsd$18533;var blocks$18534;var body$18535;var t0$18524;var t1$18525;var t2$18526;var t3$18527;var m$18519;(m$18519=temp$18498[$index$18510]);(t0$18524=m$18519);if(((t0$18524 instanceof Array)&&(((t1$18525=t0$18524.length)),((t1$18525===2)&&((i$18531=t0$18524[0]),(((t2$18526=t0$18524[1])),((t2$18526 instanceof Array)&&(((t3$18527=t2$18526.length)),((t3$18527===5)&&(t2$18526[0]==="clause")))))))))){(vars$18532=t2$18526[1]);(varsd$18533=t2$18526[2]);(blocks$18534=t2$18526[3]);(body$18535=t2$18526[4]);acc$18492.push(((((t0$18571=$15486(clauses$18470,i$18531))),function(){if(((t0$18571 instanceof Array)&&(((t1$18572=t0$18571.length)),((t1$18572===5)&&(t0$18571[0]==="clause"))))){t0$18571[1];(varsd0$18563=t0$18571[2]);(blocks0$18564=t0$18571[3]);t0$18571[4];}else{return $19777($15486(clauses$18470,i$18531),"/home/olivier/git/earl-grey/src/pattern.eg",15511,15531);}}()),((share$18565=0)),((idx$18566=0)),(((temp$18594=blocks$18534)),((($length$18600=temp$18594.length)),((($index$18606=0)),function(){$18567:for(;($index$18606<$length$18600);($index$18606++)){var x$18643;var x$18653;var other$18664;var $18626$18632;var b$18623;var m$18615;(m$18615=temp$18594[$index$18606]);(b$18623=m$18615);if(same_block$15599([$15486(blocks0$18564,share$18565),b$18623],varsd0$18563,varsd$18533)){(share$18565++);($18626$18632=b$18623);if((((x$18643=$18626$18632)),((x$18643 instanceof Array)&&(x$18643[0]==="do")))){null;}else{if((((x$18653=$18626$18632)),((x$18653 instanceof Array)&&(x$18653[0]==="check")))){(idx$18566=share$18565);}else{(other$18664=$18626$18632);__lt____gt__$15580(null,other$18664);}}}else{break $18567;}}}()))),[share$18565,idx$18566]));}else{$19777(m$18519,"/home/olivier/git/earl-grey/src/pattern.eg",15387,15915);}}}()))),acc$18492));(max$18480=$15486(Math.max,(((acc$18676=[])),(((temp$18682=shares$18479)),((($length$18688=temp$18682.length)),((($index$18694=0)),function(){$18671:for(;($index$18694<$length$18688);($index$18694++)){var x$18713;var t0$18708;var t1$18709;var m$18703;(m$18703=temp$18682[$index$18694]);(t0$18708=m$18703);if(((t0$18708 instanceof Array)&&(((t1$18709=t0$18708.length)),(t1$18709===2)))){(x$18713=t0$18708[0]);t0$18708[1];acc$18676.push(x$18713);}else{$19777(m$18703,"/home/olivier/git/earl-grey/src/pattern.eg",15929,15958);}}}()))),acc$18676)));shares$18479.push([0,0]);(temps$18481=(((acc$18736=[])),(((temp$18742=$19930(1,max$18480))),((($length$18748=temp$18742.length)),((($index$18754=0)),function(){$18731:for(;($index$18754<$length$18748);($index$18754++)){var m$18763;(m$18763=temp$18742[$index$18754]);m$18763;acc$18736.push(["symbol",gensym$15585()]);}}()))),acc$18736));(shared_last$18482=0);(idx_last$18483=0);(new_clauses$18484=(((acc$18788=[])),(((temp$18794=$19751(clauses$18470))),((($length$18800=temp$18794.length)),((($index$18806=0)),function(){$18782:for(;($index$18806<$length$18800);($index$18806++)){var t0$18868;var t1$18869;var $index$18918;var $length$18912;var temp$18906;var acc$18900;var rest$19002;var newblocks$18997;var share$18862;var idx$18863;var shared$18864;var n_to_share$18865;var to_share$18866;var other$19009;var i$18827;var vars$18828;var varsd$18829;var blocks$18830;var body$18831;var t0$18820;var t1$18821;var t2$18822;var t3$18823;var m$18815;(m$18815=temp$18794[$index$18806]);(t0$18820=m$18815);if(((t0$18820 instanceof Array)&&(((t1$18821=t0$18820.length)),((t1$18821===2)&&((i$18827=t0$18820[0]),(((t2$18822=t0$18820[1])),((t2$18822 instanceof Array)&&(((t3$18823=t2$18822.length)),((t3$18823===5)&&(t2$18822[0]==="clause")))))))))){(vars$18828=t2$18822[1]);(varsd$18829=t2$18822[2]);(blocks$18830=t2$18822[3]);(body$18831=t2$18822[4]);acc$18788.push(((((t0$18868=$15486(shares$18479,i$18827))),function(){if(((t0$18868 instanceof Array)&&(((t1$18869=t0$18868.length)),(t1$18869===2)))){(share$18862=t0$18868[0]);(idx$18863=t0$18868[1]);}else{return $19777($15486(shares$18479,i$18827),"/home/olivier/git/earl-grey/src/pattern.eg",16187,16206);}}()),((shared$18864=function(){if(idx_last$18483){return [["check",$15486(temps$18481,(idx_last$18483-1))]];}else{return [];}}())),((n_to_share$18865=Math.max(shared_last$18482,share$18862))),((to_share$18866=(((acc$18900=[])),(((temp$18906=$19751(blocks$18830.slice(shared_last$18482,n_to_share$18865)))),((($length$18912=temp$18906.length)),((($index$18918=0)),function(){$18890:for(;($index$18918<$length$18912);($index$18918++)){var j$18970;var x$18971;var j$18943;var x$18944;var $18894$18937;var $18895$18938;var $18896$18939;var $18897$18940;var t0$18932;var t1$18933;var t2$18934;var t3$18935;var m$18927;(m$18927=temp$18906[$index$18918]);(t0$18932=m$18927);if((($18895$18938=(t0$18932 instanceof Array))&&(((t1$18933=t0$18932.length)),(($18897$18940=(t1$18933===2))&&((j$18943=t0$18932[0]),(((t2$18934=t0$18932[1])),((t2$18934 instanceof Array)&&(((t3$18935=t2$18934.length)),((t3$18935===2)&&(t2$18934[0]==="check")))))))))){(x$18944=t2$18934[1]);acc$18900.push(["check",["assign",$15486(temps$18481,(shared_last$18482+j$18943)),x$18944]]);}else{if(($18897$18940&&((j$18970=t0$18932[0]),(((t2$18934=t0$18932[1])),((t2$18934 instanceof Array)&&(((t3$18935=t2$18934.length)),((t3$18935===2)&&(t2$18934[0]==="do")))))))){(x$18971=t2$18934[1]);acc$18900.push(["do",x$18971]);}else{$19777(m$18927,"/home/olivier/git/earl-grey/src/pattern.eg",16335,16506);}}}}()))),acc$18900))),((shared_last$18482=share$18862)),((idx_last$18483=idx$18863)),(((newblocks$18997=(((rest$19002=blocks$18830.slice(n_to_share$18865))),shared$18864.concat(to_share$18866).concat(rest$19002)))),["clause",vars$18828,varsd$18829,newblocks$18997,body$18831])));}else{(other$19009=m$18815);acc$18788.push(function(){throw $19518(["oops"]).create("what",({"value":other$19009}));}());}}}()))),acc$18788));return [temps$18481,new_clauses$18484];});(weave_clauses$15602=function(parts$19018){var $index$19083;var $length$19077;var temp$19071;var $index$19347;var $length$19341;var temp$19335;var acc$19329;var groups$19025;var reassemble$19026;var new_temps$19027;var helper$19028;(groups$19025=classify_contiguous$15588(parts$19018,function($19040$19043){var t0$19047;var t1$19048;var cls$19045;(t0$19047=$19040$19043);if(((t0$19047 instanceof Array)&&(((t1$19048=t0$19047.length)),(t1$19048>=1)))){(cls$19045=t0$19047[0]);Array.prototype.slice.call(t0$19047,1);}else{$19777($19040$19043);}return cls$19045;}));(reassemble$19026=[]);(new_temps$19027=[]);(temp$19071=groups$19025);($length$19077=temp$19071.length);($index$19083=0);$19029:for(;($index$19083<$length$19077);($index$19083++)){var t0$19123;var t1$19124;var ts$19120;var new_clauses$19121;var elems$19139;var elems$19106;var $19033$19100;var $19034$19101;var $19035$19102;var $19036$19103;var t0$19097;var t1$19098;var m$19092;(m$19092=temp$19071[$index$19083]);(t0$19097=m$19092);if((($19034$19101=(t0$19097 instanceof Array))&&(((t1$19098=t0$19097.length)),(($19036$19103=(t1$19098>=1))&&(t0$19097[0]==="clause"))))){(elems$19106=Array.prototype.slice.call(t0$19097,1));(t0$19123=opt_clauses$15601(elems$19106));if(((t0$19123 instanceof Array)&&(((t1$19124=t0$19123.length)),(t1$19124===2)))){(ts$19120=t0$19123[0]);(new_clauses$19121=t0$19123[1]);}else{$19777(opt_clauses$15601(elems$19106),"/home/olivier/git/earl-grey/src/pattern.eg",17015,17043);}(new_temps$19027=new_temps$19027.concat(ts$19120));(reassemble$19026=reassemble$19026.concat(new_clauses$19121));}else{if(($19036$19103&&(t0$19097[0]==="block"))){(elems$19139=Array.prototype.slice.call(t0$19097,1));(reassemble$19026=reassemble$19026.concat(elems$19139));}else{$19777(m$19092,"/home/olivier/git/earl-grey/src/pattern.eg",16949,17154);}}}(helper$19028=function($19147$19150){var $index$19263;var $length$19257;var temp$19251;var acc$19245;var decls$19237;var vars$19228;var varsd$19229;var blocks$19230;var body$19231;var rest$19232;var body$19197;var rest$19198;var $19156$19180;var $19157$19181;var $19158$19182;var $19159$19183;var $19160$19184;var $19161$19185;var t0$19173;var t1$19174;var t2$19175;var t3$19176;var t4$19177;var t5$19178;var $19152$19168;var ph$19162;(ph$19162=$19147$19150);($19152$19168=ph$19162);if((($19156$19180=($19152$19168 instanceof Array))&&(((t0$19173=$19152$19168.length)),(t0$19173===0)))){return ["multi"];}else{if(($19156$19180&&(($19158$19182=(t0$19173>=1))&&(((t1$19174=$19152$19168[0])),(($19160$19184=(t1$19174 instanceof Array))&&(((t2$19175=t1$19174.length)),((t2$19175===2)&&((t1$19174[0]==="block")&&(((t3$19176=$19819(["multi"])(t1$19174[1]))),(t3$19176[0]&&(((t4$19177=t3$19176[1])),(((t5$19178=t4$19177.length)),(t5$19178>=0))))))))))))){(body$19197=Array.prototype.slice.call(t4$19177,0));(rest$19198=Array.prototype.slice.call($19152$19168,1));return ["multi"].concat(body$19197).concat([helper$19028(rest$19198)]);}else{if(($19160$19184&&((t2$19175===5)&&(t1$19174[0]==="clause")))){(vars$19228=t1$19174[1]);(varsd$19229=t1$19174[2]);(blocks$19230=t1$19174[3]);(body$19231=t1$19174[4]);(rest$19232=Array.prototype.slice.call($19152$19168,1));(decls$19237=(((acc$19245=[])),(((temp$19251=vars$19228)),((($length$19257=temp$19251.length)),((($index$19263=0)),function(){$19240:for(;($index$19263<$length$19257);($index$19263++)){var bridge$19288$19296;var $19283$19291;var v$19280;var m$19272;(m$19272=temp$19251[$index$19263]);(v$19280=m$19272);acc$19245.push(((($19283$19291=v$19280.declare_mode)),function(){if(($19283$19291==="set")){return ["splice"];}else{if(($19283$19291==="let")){return ["declare",$19796(v$19280,({"mutable":false}))];}else{if(($19283$19291==="var")){return ["declare",$19796(v$19280,({"mutable":true}))];}else{(bridge$19288$19296=$19283$19291);if(((bridge$19288$19296==="unqualified")||(bridge$19288$19296===(void 0)))){return ["declare",$19796(v$19280,({"mutable":false}))];}else{$19777($19283$19291);}}}}}()));}}()))),acc$19245));return ["tagscope","back",["multi"].concat(decls$19237).concat([assemble_pattern$15595(blocks$19230,body$19231,["use","back",helper$19028(rest$19232)])])];}else{$19777($19152$19168);}}}});return ["multi"].concat((((acc$19329=[])),(((temp$19335=new_temps$19027)),((($length$19341=temp$19335.length)),((($index$19347=0)),function(){$19324:for(;($index$19347<$length$19341);($index$19347++)){var t$19364;var m$19356;(m$19356=temp$19335[$index$19347]);(t$19364=m$19356);acc$19329.push(["declare",t$19364]);}}()))),acc$19329)).concat([helper$19028(reassemble$19026)]);});(exports["PatternParser"]=PatternParser$15592);(exports["PatternProcessor"]=PatternProcessor$15593);(exports["parse_clauses"]=parse_clauses$15600);(exports["parse_pattern"]=parse_pattern$15597);
