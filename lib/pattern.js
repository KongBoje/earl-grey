var $7018=function(type$7020){var f$7023;(f$7023=type$7020["::check"]);;if((f$7023===(void 0))){return function(value$7028){return (value$7028 instanceof type$7020);};}else{return function(value$7031){return f$7023.call(type$7020,value$7031);};}};
var $7033=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $7034=function(temp$7035$7037){var ph$7041;(ph$7041=temp$7035$7037);;var m$7039$7046;(m$7039$7046=ph$7041);;var bridge$7040$7051;var x$7055;(bridge$7040$7051=m$7039$7046);if((((typeof(bridge$7040$7051)==="string")&&((x$7055=bridge$7040$7051),true))||((typeof(bridge$7040$7051)==="number")&&((x$7055=bridge$7040$7051),true)))){return ["value",x$7055];}else{var other$7062;(other$7062=m$7039$7046);return other$7062["::serialize_ast"]();}};
var send$6881;(send$6881=function(obj$6886,temp$6884$6887){var ph$6891;var msg$6892;var t0$6894;(t0$6894=temp$6884$6887);(msg$6892=t0$6894);(ph$6891=t0$6894);;var m$6889$6898;(m$6889$6898=ph$6891);;var bridge$6890$6903;(bridge$6890$6903=m$6889$6898);if(((typeof(bridge$6890$6903)==="string")||(typeof(bridge$6890$6903)==="number"))){return obj$6886[msg$6892];}else{var other$6911;(other$6911=m$6889$6898);return obj$6886["::send"](msg$6892);}});;(Array[":::project"]=function(temp$6914$6916){var ph$6919;var value$6920;var t0$6922;(t0$6922=temp$6914$6916);(value$6920=t0$6922);(ph$6919=t0$6922);;var m$6918$6926;(m$6918$6926=ph$6919);;if($7018(Array)(m$6918$6926)){return [true,value$6920];}else{m$6918$6926;return [true,[value$6920]];}});(Array.prototype["::check"]=function(value$6940){if((value$6940 instanceof Array)){var i$6945;(i$6945=0);;$6943:for(;(i$6945<this.length);(i$6945++)){if(($7033(this,i$6945)!==$7033(value$6940,i$6945))){return false;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value$6954){if((value$6954 instanceof Array)){var i$6959;(i$6959=0);;$6957:for(;(i$6959<this.length);(i$6959++)){if(($7033(this,i$6959)!==$7033(value$6954,i$6959))){return [true,[value$6954]];}}return [true,value$6954.slice(this.length)];}else{return [true,[value$6954]];}});(Array.prototype[":::deconstruct"]=function(value$6968){return [true,value$6968.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($7034));});(RegExp.prototype["::check"]=function(value$6973){return value$6973.match(this);});(RegExp.prototype[":::project"]=function(value$6976){var m$6978$6980;(m$6978$6980=value$6976.match(this));;var m$6988;if((m$6978$6980===null)){(m$6988=m$6978$6980);return [false,null];}else{var m$6993;(m$6993=m$6978$6980);return [true,m$6993];}});(RegExp.prototype[":::deconstruct"]=function(value$6996){var m$6998$7000;(m$6998$7000=value$6996.match(this));;var m$7008;if((m$6998$7000===null)){(m$7008=m$6998$7000);return [false,null];}else{var m$7013;(m$7013=m$6998$7000);return [true,m$7013];}});(Function.prototype["::send"]=function(args$7016){return this.apply(this,args$7016);});
var $9831=function(dest$9833,values$9834){var k$9839;(k$9839=null);$9837:for(k$9839 in values$9834){if(values$9834.hasOwnProperty(k$9839)){(dest$9833[k$9839]=values$9834[k$9839]);}}return dest$9833;};
var $9725=function(){var $9726$9728;($9726$9728=function(tags$9732){var it$0$9735;(it$0$9735=function(){if((!$7018($9726$9728)(this))){return Object.create($9726$9728.prototype);}else{return this;}}());;(it$0$9735["tags"]=tags$9732);return it$0$9735;});;($9726$9728.prototype["create"]=function(){var m$9744$9746;(m$9744$9746=arguments);;var t0$9751;var message$9755;var args$9756;(t0$9751=m$9744$9746.length);if((t0$9751>=0)){(message$9755=function(){if((0>=t0$9751)){return "";}else{return m$9744$9746[0];}}());(args$9756=Array.prototype.slice.call(m$9744$9746,1));var it$0$9760;(it$0$9760=this);;var e$9765;(e$9765=Error(message$9755));;(e$9765["::tags"]=it$0$9760.tags);(e$9765["args"]=args$9756);(e$9765["name"]=["E"].concat(it$0$9760.tags).join("."));return e$9765;}else{throw Error("mismatch!!");}});($9726$9728.prototype["::check"]=function(e$9774){var it$0$9777;(it$0$9777=this);;var tags$9782;if(((!e$9774)||(!$7018(Error)(e$9774)))){return false;}(tags$9782=(e$9774["::tags"]||[]));;var temp$9790;(temp$9790=it$0$9777.tags);;var len$9795;(len$9795=temp$9790.length);;var i$9800;(i$9800=0);;$9787:for(;(i$9800<len$9795);(i$9800++)){var m$9808;(m$9808=temp$9790[i$9800]);;var tag$9816;(tag$9816=m$9808);if((tags$9782.indexOf(tag$9816)===(-1))){return false;}else{false;;}}return true;});($9726$9728.prototype["::deconstruct"]=function(e$9824){var it$0$9827;(it$0$9827=this);;return e$9824.args;});$9831($9726$9728,({}));return $9726$9728;}();
var $9843=function(temp$9844$9846,key$9847){var ph$9851;(ph$9851=temp$9844$9846);;var m$9849$9856;(m$9849$9856=ph$9851);;var bridge$9850$9861;(bridge$9850$9861=m$9849$9856);if(((bridge$9850$9861===null)||(bridge$9850$9861===(void 0)))){return false;}else{var x$9869;if((typeof(m$9849$9856)==="string")){(x$9869=m$9849$9856);return (key$9847 in String.prototype);}else{var x$9874;if((typeof(m$9849$9856)==="number")){(x$9874=m$9849$9856);return (key$9847 in Number.prototype);}else{var x$9879;(x$9879=m$9849$9856);return (key$9847 in x$9879);}}}};
var $9881=function(type$9883){return function(value$9886){var f$9889;(f$9889=type$9883[":::project"]);;if((f$9889===(void 0))){var f$9894;(f$9894=type$9883["::project"]);;if((f$9894===(void 0))){return [true,type$9883(value$9886)];}else{var rval$9899;(rval$9899=false);;try{(rval$9899=[true,f$9894(value$9886)]);}catch(excv$9905){var e$9911;(e$9911=excv$9905);(rval$9899=[false,null]);}return rval$9899;}}else{return f$9889.call(type$9883,value$9886);}};};
var $9913=function(a$9915,b$9916){var dest$9921;(dest$9921=({}));;var k$9926;(k$9926=null);$9919:for(k$9926 in a$9915){if(a$9915.hasOwnProperty(k$9926)){(dest$9921[k$9926]=a$9915[k$9926]);}}var k$9931;(k$9931=null);$9920:for(k$9931 in b$9916){if(b$9916.hasOwnProperty(k$9931)){(dest$9921[k$9931]=b$9916[k$9931]);}}return dest$9921;};
var $9935=function(from$9937,to$9938){var rval$9942;(rval$9942=[]);;var i$9947;(i$9947=from$9937);;$9941:for(;(i$9947<=to$9938);(i$9947++)){rval$9942.push(i$9947);}return rval$9942;};var $7066$7068;var __lt____gt__$7069;var $7067$7070;var __lt____lt____colon__$7071;var util$7072;var GenSym$7073;var gensym$7074;var zip$7075;var enumerate$7076;var iterkeys$7077;var neighbours$7078;var classify$7079;var classify_contiguous$7080;var identity$7081;var mt$7082;var PatternParser$7083;var PatternProcessor$7084;var assemble_conditions$7085;var assemble_pattern$7086;var inject_below_uses$7087;var parse_pattern$7088;var checkall$7089;var same_block$7090;var parse_clauses$7091;var opt_clauses$7092;var weave_clauses$7093;($7066$7068=require("./pp"));;(__lt____gt__$7069=$7066$7068["<>"]);;($7067$7070=require("./location"));;(__lt____lt____colon__$7071=$7067$7070["<<:"]);;(util$7072=require("./util"));;(GenSym$7073=util$7072.GenSym);;(gensym$7074=util$7072.gensym);;(zip$7075=util$7072.zip);;(enumerate$7076=util$7072.enumerate);;(iterkeys$7077=util$7072.keys);;(neighbours$7078=util$7072.neighbours);;(classify$7079=util$7072.classify);;(classify_contiguous$7080=util$7072.classify_contiguous);;(identity$7081=util$7072.identity);;(mt$7082=require("./expand"));;(PatternParser$7083=function(expander$7142,scope$7143,pattern$7144,opt$7145){var it$0$7148;(it$0$7148=function(){if((!$7018(PatternParser$7083)(this))){return Object.create(PatternParser$7083.prototype);}else{return this;}}());;(it$0$7148["expander"]=expander$7142);(it$0$7148["opt"]=opt$7145);(it$0$7148["arguments"]=[]);(it$0$7148["vars"]=[]);(it$0$7148["specials"]=({}));(it$0$7148["pattern"]=it$0$7148.expand(scope$7143,pattern$7144,true,it$0$7148.opt.indexable));return it$0$7148;});;(PatternParser$7083.prototype["parse_specs"]=function(scope$7158,specs$7159){var i$7199;var len$7194;var temp$7189;var acc$7184;var rest$7167;var has_defaults$7168;var rval$7169;var it$0$7162;(it$0$7162=this);;(rest$7167=(void 0));;(has_defaults$7168=false);;(rval$7169=classify$7079("fw","bw","keys","defaults",(((acc$7184=[])),(((temp$7189=it$0$7162.expander.step_all(["pattern"],scope$7158,specs$7159))),(((len$7194=temp$7189.length)),(((i$7199=0)),function(){$7178:for(;(i$7199<len$7194);(i$7199++)){var v$7251;var v$7246;var variable$7239;var value$7240;var key$7233;var subp$7234;var key$7228;var variable$7221;var $7179$7215;var $7180$7216;var $7181$7217;var $7182$7218;var t0$7212;var t1$7213;var m$7207;(m$7207=temp$7189[i$7199]);;(t0$7212=m$7207);if((($7180$7216=(t0$7212 instanceof Array))&&((t1$7213=t0$7212.length),(($7182$7218=(t1$7213===2))&&(t0$7212[0]==="dynsplice"))))){(variable$7221=t0$7212[1]);acc$7184.push(((rest$7167=it$0$7162.expand(scope$7158,variable$7221)),["ignore"]));}else{if(($7182$7218&&(t0$7212[0]==="assoc"))){(key$7228=t0$7212[1]);acc$7184.push(["keys",[key$7228,it$0$7162.expand(scope$7158,key$7228)]]);}else{if(($7180$7216&&(($7182$7218=(t1$7213===3))&&(t0$7212[0]==="assoc")))){(key$7233=t0$7212[1]);(subp$7234=t0$7212[2]);acc$7184.push(["keys",[key$7233,it$0$7162.expand(scope$7158,subp$7234)]]);}else{if(($7182$7218&&(t0$7212[0]==="default"))){(variable$7239=t0$7212[1]);(value$7240=t0$7212[2]);acc$7184.push(((has_defaults$7168=true),function(){if(rest$7167){throw $9725(["syntax","pattern"]).create("No default arguments after rest arg.");}else{return ["defaults",[it$0$7162.expand(scope$7158,variable$7239),value$7240]];}}()));}else{(v$7246=m$7207);if(((rest$7167===(void 0))&&(!has_defaults$7168))){acc$7184.push(["fw",it$0$7162.expand(scope$7158,v$7246)]);}else{(v$7251=m$7207);acc$7184.push(["bw",it$0$7162.expand(scope$7158,v$7251)]);}}}}}}}()))),acc$7184)));;(rval$7169["rest"]=rest$7167);return rval$7169;});(PatternParser$7083.prototype["expand"]=function(){var x$7311;var x$7320;var x$7336;var x$7341;var msg$7387;var x$7399;var msg$7412;var msg$7421;var i$7448;var len$7443;var temp$7438;var acc$7433;var i$7548;var len$7543;var temp$7538;var acc$7533;var i$7580;var len$7575;var temp$7570;var t0$7640;var t1$7641;var t2$7642;var i$7669;var len$7664;var temp$7659;var acc$7654;var patts$7649;var canon$7472;var normalize$7473;var pps$7474;var vars$7475;var patt$7728;var msg$7749;var other$7746;var keys$7734;var fw$7716;var bw$7717;var defaults$7718;var rest$7719;var $7695$7713;var t0$7706;var t1$7707;var t2$7708;var t3$7709;var t4$7710;var t5$7711;var m$7694$7701;var specs$7696;var other$7755;var args$7690;var xs$7468;var xs$7427;var f$7407;var arg$7408;var f$7393;var arguments$7394;var f$7380;var arg$7381;var checker$7374;var subp$7375;var projector$7368;var subp$7369;var condition$7362;var subp$7363;var v$7357;var v$7349;var type$7327;var $7289$7303;var $7290$7304;var $7291$7305;var $7292$7306;var t0$7299;var bridge$7288$7300;var t1$7301;var m$7287$7294;var expr$7280;var rval$7281;var it$0$7275;var scope$7268;var pattern$7269;var toplevel$7270;var checked$7271;var t0$7264;var m$7257$7259;(m$7257$7259=arguments);;(t0$7264=m$7257$7259.length);if(((t0$7264>=2)&&(t0$7264<=4))){(scope$7268=m$7257$7259[0]);(pattern$7269=m$7257$7259[1]);(toplevel$7270=function(){if((2>=t0$7264)){return false;}else{return m$7257$7259[2];}}());(checked$7271=function(){if((3>=t0$7264)){return false;}else{return m$7257$7259[3];}}());(it$0$7275=this);;(expr$7280=it$0$7275.expander.step(["pattern"],scope$7268,pattern$7269));;(rval$7281=(((m$7287$7294=expr$7280)),function(){if((((x$7311=m$7287$7294)),((x$7311 instanceof Array)&&(x$7311[0]==="void")))){return ["check",mt$7082.checker.null,["ignore"]];}else{if((((x$7320=m$7287$7294)),((x$7320 instanceof Array)&&(x$7320[0]==="ignore")))){return expr$7280;}else{if(((m$7287$7294 instanceof Array)&&((t0$7299=m$7287$7294.length),((t0$7299===2)&&(m$7287$7294[0]==="special"))))){(type$7327=m$7287$7294[1]);(it$0$7275.specials[type$7327]=true);return expr$7280;}else{(bridge$7288$7300=m$7287$7294);if(((((x$7336=bridge$7288$7300)),((x$7336 instanceof Array)&&(x$7336[0]==="symbol")))||(((x$7341=bridge$7288$7300)),((x$7341 instanceof Array)&&(x$7341[0]==="variable"))))){it$0$7275.vars.push(expr$7280);return ["assign",expr$7280];}else{if((($7289$7303=(m$7287$7294 instanceof Array))&&((t0$7299=m$7287$7294.length),(($7291$7305=(t0$7299===2))&&(($7292$7306=(m$7287$7294[0]==="value"))&&((v$7349=m$7287$7294[1]),it$0$7275.opt.strings_as_variables)))))){it$0$7275.vars.push(expr$7280);return ["assign",expr$7280];}else{if($7292$7306){(v$7357=m$7287$7294[1]);return ["check",mt$7082.checker(v$7357),["ignore"]];}else{if(($7289$7303&&(($7291$7305=(t0$7299===3))&&(m$7287$7294[0]==="test")))){(condition$7362=m$7287$7294[1]);(subp$7363=m$7287$7294[2]);return ["test",condition$7362,it$0$7275.expand(scope$7268,subp$7363,toplevel$7270,false)];}else{if(($7291$7305&&(m$7287$7294[0]==="project"))){(projector$7368=m$7287$7294[1]);(subp$7369=m$7287$7294[2]);return ["project",projector$7368,it$0$7275.expand(scope$7268,subp$7369,toplevel$7270,true)];}else{if(($7291$7305&&(m$7287$7294[0]==="check"))){(checker$7374=m$7287$7294[1]);(subp$7375=m$7287$7294[2]);return ["check",checker$7374,it$0$7275.expand(scope$7268,subp$7375,toplevel$7270,true)];}else{if(($7291$7305&&(($7292$7306=(m$7287$7294[0]==="send"))&&((f$7380=m$7287$7294[1]),((arg$7381=m$7287$7294[2]),(!toplevel$7270)))))){(msg$7387="Function arguments can only be declared as a top level pattern.");;throw $9725(["syntax","pattern"]).create(msg$7387,({"node":expr$7280,"arg":arg$7381}));}else{if(($7292$7306&&((f$7393=m$7287$7294[1]),((t1$7301=m$7287$7294[2]),(((x$7399=t1$7301)),((x$7399 instanceof Array)&&(x$7399[0]==="data"))))))){(arguments$7394=t1$7301);it$0$7275.arguments.unshift(arguments$7394);return it$0$7275.expand(scope$7268,f$7393,true,false);}else{if($7292$7306){(f$7407=m$7287$7294[1]);(arg$7408=m$7287$7294[2]);(msg$7412=["Function must be declared with an array of arguments","(did you mean to use ':='?)"].join(" "));;throw $9725(["syntax","pattern"]).create(msg$7412,({"node":expr$7280,"arg":arg$7408}));}else{m$7287$7294;if((!it$0$7275.opt.allow_nested)){(msg$7421="Nested patterns are not allowed here.");;throw $9725(["syntax","pattern"]).create(msg$7421,({"node":expr$7280}));}else{if((($7289$7303=(m$7287$7294 instanceof Array))&&((t0$7299=m$7287$7294.length),(($7291$7305=(t0$7299>=1))&&(m$7287$7294[0]==="all"))))){(xs$7427=Array.prototype.slice.call(m$7287$7294,1));return ["all"].concat((((acc$7433=[])),(((temp$7438=xs$7427)),(((len$7443=temp$7438.length)),(((i$7448=0)),function(){$7431:for(;(i$7448<len$7443);(i$7448++)){var x$7464;var m$7456;(m$7456=temp$7438[i$7448]);;(x$7464=m$7456);acc$7433.push(it$0$7275.expand(scope$7268,x$7464));}}()))),acc$7433));}else{if(($7291$7305&&(m$7287$7294[0]==="any"))){(xs$7468=Array.prototype.slice.call(m$7287$7294,1));(canon$7472=function(all$7479){return all$7479.sort().join(",");});;(normalize$7473=function(vars$7485){var i$7504;var len$7499;var temp$7494;var acc$7489;return canon$7472((((acc$7489=[])),(((temp$7494=vars$7485)),(((len$7499=temp$7494.length)),(((i$7504=0)),function(){$7487:for(;(i$7504<len$7499);(i$7504++)){var v$7522;var t0$7517;var t1$7518;var m$7512;(m$7512=temp$7494[i$7504]);;(t0$7517=m$7512);if(((t0$7517 instanceof Array)&&((t1$7518=t0$7517.length),((t1$7518===2)&&(t0$7517[0]==="symbol"))))){(v$7522=t0$7517[1]);acc$7489.push(v$7522);}else{false;;}}}()))),acc$7489));});;(pps$7474=(((acc$7533=[])),(((temp$7538=xs$7468)),(((len$7543=temp$7538.length)),(((i$7548=0)),function(){$7531:for(;(i$7548<len$7543);(i$7548++)){var x$7564;var m$7556;(m$7556=temp$7538[i$7548]);;(x$7564=m$7556);acc$7533.push(PatternParser$7083(it$0$7275.expander,scope$7268,x$7564,it$0$7275.opt));}}()))),acc$7533));;(temp$7570=neighbours$7078(pps$7474));;(len$7575=temp$7570.length);;(i$7580=0);;$7567:for(;(i$7580<len$7575);(i$7580++)){var i$7617;var len$7612;var temp$7607;var pp1$7598;var pp2$7599;var t0$7593;var t1$7594;var m$7588;(m$7588=temp$7570[i$7580]);;(t0$7593=m$7588);if(((t0$7593 instanceof Array)&&((t1$7594=t0$7593.length),(t1$7594===2)))){(pp1$7598=t0$7593[0]);(pp2$7599=t0$7593[1]);(temp$7607=pps$7474);;(len$7612=temp$7607.length);;(i$7617=0);;$7604:for(;(i$7617<len$7612);(i$7617++)){var pp$7633;var m$7625;(m$7625=temp$7607[i$7617]);;(pp$7633=m$7625);normalize$7473(pp$7633.vars);}if((normalize$7473(pp1$7598.vars)!==normalize$7473(pp2$7599.vars))){throw $9725(["syntax","pattern"]).create("Both branches of 'or' must contain the same variables",({"vars1":__lt____lt____colon__$7071(pp1$7598.vars.sort(),pp1$7598.pattern),"vars2":__lt____lt____colon__$7071(pp2$7599.vars.sort(),pp2$7599.pattern)}));}if((canon$7472(iterkeys$7077(pp1$7598.specials))!==canon$7472(iterkeys$7077(pp2$7599.specials)))){throw $9725(["syntax","pattern"]).create("Both branches of 'or' must contain the same special tokens",({"special1":__lt____lt____colon__$7071(iterkeys$7077(pp1$7598.specials).sort(),pp1$7598.pattern),"special2":__lt____lt____colon__$7071(iterkeys$7077(pp2$7599.specials).sort(),pp2$7599.pattern)}));}}else{false;;}}(t0$7640=pps$7474);if(((t0$7640 instanceof Array)&&((t1$7641=t0$7640.length),((t1$7641>=1)&&((t2$7642=t0$7640[0]),$9843(t2$7642,"vars")))))){(vars$7475=t2$7642.vars);Array.prototype.slice.call(t0$7640,1);;}else{throw Error("Mismatch");}(it$0$7275["vars"]=it$0$7275.vars.concat(vars$7475));(patts$7649=(((acc$7654=[])),(((temp$7659=pps$7474)),(((len$7664=temp$7659.length)),(((i$7669=0)),function(){$7652:for(;(i$7669<len$7664);(i$7669++)){var pp$7685;var m$7677;(m$7677=temp$7659[i$7669]);;(pp$7685=m$7677);acc$7654.push(pp$7685.pattern);}}()))),acc$7654));;return ["any"].concat(patts$7649);}else{if(($7291$7305&&(m$7287$7294[0]==="data"))){(args$7690=Array.prototype.slice.call(m$7287$7294,1));(specs$7696=it$0$7275.parse_specs(scope$7268,args$7690));;(m$7694$7701=specs$7696);;if((($7695$7713=$9843(m$7694$7701,"keys"))&&((t0$7706=m$7694$7701.keys),((t0$7706 instanceof Array)&&((t1$7707=t0$7706.length),((t1$7707===0)&&($9843(m$7694$7701,"fw")&&((fw$7716=m$7694$7701.fw),($9843(m$7694$7701,"bw")&&((bw$7717=m$7694$7701.bw),($9843(m$7694$7701,"defaults")&&((defaults$7718=m$7694$7701.defaults),$9843(m$7694$7701,"rest"))))))))))))){(rest$7719=m$7694$7701.rest);(patt$7728=__lt____lt____colon__$7071(["array_pattern",fw$7716,bw$7717,defaults$7718,rest$7719],pattern$7269));;if(checked$7271){return patt$7728;}else{return ["check",mt$7082.checker.Array,patt$7728];}}else{if(($7695$7713&&((keys$7734=m$7694$7701.keys),($9843(m$7694$7701,"fw")&&((t0$7706=m$7694$7701.fw),((t0$7706 instanceof Array)&&((t1$7707=t0$7706.length),((t1$7707===0)&&($9843(m$7694$7701,"bw")&&((t2$7708=m$7694$7701.bw),((t2$7708 instanceof Array)&&((t3$7709=t2$7708.length),((t3$7709===0)&&($9843(m$7694$7701,"defaults")&&((t4$7710=m$7694$7701.defaults),((t4$7710 instanceof Array)&&((t5$7711=t4$7710.length),((t5$7711===0)&&($9843(m$7694$7701,"rest")&&(m$7694$7701.rest===(void 0))))))))))))))))))))){return ["object_pattern"].concat(keys$7734);}else{(other$7746=m$7694$7701);(msg$7749="Pattern must be an array or an object.");;throw $9725(["syntax","pattern"]).create(msg$7749,({"node":expr$7280,"specs":specs$7696}));}}}else{(other$7755=m$7287$7294);throw $9725(["syntax","pattern"]).create("Illegal pattern",({"node":other$7755}));}}}}}}}}}}}}}}}}}()));;return __lt____lt____colon__$7071(rval$7281,pattern$7269);}else{throw Error("mismatch!!");}});$9831(PatternParser$7083,({}));PatternParser$7083;(PatternProcessor$7084=function(){var it$0$7765;(it$0$7765=function(){if((!$7018(PatternProcessor$7084)(this))){return Object.create(PatternProcessor$7084.prototype);}else{return this;}}());;(it$0$7765["temps"]=[]);(it$0$7765["parts"]=[]);(it$0$7765["gen"]=GenSym$7073("t"));return it$0$7765;});;(PatternProcessor$7084.prototype["do"]=function(part$7775){var it$0$7778;(it$0$7778=this);;return it$0$7778.parts.push(["do",part$7775]);});(PatternProcessor$7084.prototype["check"]=function(part$7785){var it$0$7788;(it$0$7788=this);;return it$0$7788.parts.push(["check",part$7785]);});(PatternProcessor$7084.prototype["temp"]=function(){var x$7829;var x$7834;var init$7841;var bridge$7812$7823;var m$7811$7818;var it$0$7813;var x$7806;var v$7807;var t0$7802;var m$7795$7797;(m$7795$7797=arguments);;(t0$7802=m$7795$7797.length);if(((t0$7802>=1)&&(t0$7802<=2))){(x$7806=m$7795$7797[0]);(v$7807=function(){if((1>=t0$7802)){return null;}else{return m$7795$7797[1];}}());(it$0$7813=this);;(m$7811$7818=x$7806);;(bridge$7812$7823=m$7811$7818);if((((((x$7829=bridge$7812$7823)),((x$7829 instanceof Array)&&(x$7829[0]==="variable")))||(((x$7834=bridge$7812$7823)),((x$7834 instanceof Array)&&(x$7834[0]==="symbol"))))&&($9843(m$7811$7818,"single_assignment")&&(m$7811$7818.single_assignment&&(!v$7807))))){return x$7806;}else{(init$7841=m$7811$7818);(v$7807=(v$7807||["symbol",it$0$7813.gen()]));(v$7807["single_assignment"]=true);it$0$7813.temps.push(v$7807);it$0$7813.do(["send",["symbol",":="],["data",v$7807,init$7841]]);return v$7807;}}else{throw Error("mismatch!!");}});(PatternProcessor$7084.prototype["process"]=function(pattern$7849,rhs$7850,fns$7851){var x$7883;var x$7912;var t$7924;var t$7935;var i$7962;var len$7957;var temp$7952;var t$7945;var i$8019;var len$8014;var temp$8009;var acc$8004;var fn$7991;var parts$7992;var t$7986;var i$8070;var len$8065;var temp$8060;var acc$8055;var t$8049;var otherwise$8163;var m$8145$8147;var i$8178;var len$8173;var temp$8168;var i$8216;var len$8211;var temp$8206;var end$8258;var pos$8253;var i$8279;var len$8274;var temp$8269;var acc$8264;var nfw$8109;var nbw$8110;var ndflt$8111;var extract_length$8112;var check_length$8113;var lo$8114;var hi$8115;var t$8116;var len$8117;var fw$8102;var bw$8103;var dflt$8104;var rest$8105;var subp$8045;var xs$7982;var xs$7941;var projector$7930;var subp$7931;var checker$7919;var subp$7920;var checker$7908;var condition$7901;var subp$7902;var kind$7896;var sym$7890;var $7863$7875;var $7864$7876;var $7865$7877;var $7866$7878;var t0$7873;var m$7862$7868;var rval$7859;var it$0$7854;(it$0$7854=this);;(rval$7859=(((m$7862$7868=pattern$7849)),function(){if((((x$7883=m$7862$7868)),((x$7883 instanceof Array)&&(x$7883[0]==="ignore")))){return it$0$7854.do(rhs$7850);}else{if((($7863$7875=(m$7862$7868 instanceof Array))&&((t0$7873=m$7862$7868.length),(($7865$7877=(t0$7873===2))&&(m$7862$7868[0]==="assign"))))){(sym$7890=m$7862$7868[1]);return it$0$7854.parts.push(fns$7851.assign(sym$7890,rhs$7850));}else{if(($7865$7877&&(m$7862$7868[0]==="special"))){(kind$7896=m$7862$7868[1]);return it$0$7854.process(fns$7851.special(pattern$7849,rhs$7850),rhs$7850,fns$7851);}else{if(($7863$7875&&(($7865$7877=(t0$7873===3))&&(m$7862$7868[0]==="test")))){(condition$7901=m$7862$7868[1]);(subp$7902=m$7862$7868[2]);it$0$7854.process(subp$7902,rhs$7850,fns$7851);return it$0$7854.check(condition$7901);}else{if(($7865$7877&&(($7866$7878=(m$7862$7868[0]==="check"))&&((checker$7908=m$7862$7868[1]),(((x$7912=m$7862$7868[2])),((x$7912 instanceof Array)&&(x$7912[0]==="ignore"))))))){return it$0$7854.check(["send",checker$7908,["data",rhs$7850]]);}else{if($7866$7878){(checker$7919=m$7862$7868[1]);(subp$7920=m$7862$7868[2]);(t$7924=it$0$7854.temp(rhs$7850));;it$0$7854.check(["send",checker$7919,["data",t$7924]]);return it$0$7854.process(subp$7920,t$7924,fns$7851);}else{if(($7865$7877&&(m$7862$7868[0]==="project"))){(projector$7930=m$7862$7868[1]);(subp$7931=m$7862$7868[2]);(t$7935=it$0$7854.temp(["send",projector$7930,["data",rhs$7850]]));;it$0$7854.check(["send",t$7935,["value",0]]);return it$0$7854.process(subp$7931,["send",t$7935,["value",1]],fns$7851);}else{if(($7863$7875&&(($7865$7877=(t0$7873>=1))&&(m$7862$7868[0]==="all")))){(xs$7941=Array.prototype.slice.call(m$7862$7868,1));(t$7945=it$0$7854.temp(rhs$7850));;(temp$7952=xs$7941);;(len$7957=temp$7952.length);;(i$7962=0);;$7949:for(;(i$7962<len$7957);(i$7962++)){var x$7978;var m$7970;(m$7970=temp$7952[i$7962]);;(x$7978=m$7970);it$0$7854.process(x$7978,t$7945,fns$7851);}return null;}else{if(($7865$7877&&(m$7862$7868[0]==="any"))){(xs$7982=Array.prototype.slice.call(m$7862$7868,1));(t$7986=it$0$7854.temp(rhs$7850,["symbol",gensym$7074("bridge")]));;return it$0$7854.check((((fn$7991=function(x$7996,rest$7997){return ["send",["symbol","or"],["data",x$7996,rest$7997]];})),((parts$7992=(((acc$8004=[])),(((temp$8009=xs$7982)),(((len$8014=temp$8009.length)),(((i$8019=0)),function(){$8002:for(;(i$8019<len$8014);(i$8019++)){var pp$8038;var x$8035;var m$8027;(m$8027=temp$8009[i$8019]);;(x$8035=m$8027);acc$8004.push((((pp$8038=PatternProcessor$7084())),pp$8038.process(x$8035,t$7986,fns$7851),assemble_conditions$7085(pp$8038)));}}()))),acc$8004))),util$7072.construct(parts$7992,fn$7991,["symbol","false"])));}else{if(($7865$7877&&(m$7862$7868[0]==="object_pattern"))){(subp$8045=Array.prototype.slice.call(m$7862$7868,1));(t$8049=it$0$7854.temp(rhs$7850));;(acc$8055=[]);;(temp$8060=subp$8045);;(len$8065=temp$8060.length);;(i$8070=0);;$8053:for(;(i$8070<len$8065);(i$8070++)){var k$8090;var v$8091;var t0$8083;var t1$8084;var t2$8085;var t3$8086;var m$8078;(m$8078=temp$8060[i$8070]);;(t0$8083=m$8078);if(((t0$8083 instanceof Array)&&((t1$8084=t0$8083.length),((t1$8084===2)&&((t2$8085=t0$8083[0]),((t2$8085 instanceof Array)&&((t3$8086=t2$8085.length),((t3$8086===2)&&(t2$8085[0]==="value"))))))))){(k$8090=t2$8085[1]);(v$8091=t0$8083[1]);acc$8055.push((it$0$7854.check(["send",["symbol","___hasprop"],["data",t$8049,["value",k$8090]]]),it$0$7854.process(v$8091,["send",t$8049,["value",k$8090]],fns$7851)));}else{false;;}}return acc$8055;}else{if(($7863$7875&&((t0$7873===5)&&(m$7862$7868[0]==="array_pattern")))){(fw$8102=m$7862$7868[1]);(bw$8103=m$7862$7868[2]);(dflt$8104=m$7862$7868[3]);(rest$8105=m$7862$7868[4]);(nfw$8109=fw$8102.length);;(nbw$8110=bw$8103.length);;(ndflt$8111=dflt$8104.length);;(extract_length$8112=true);;(check_length$8113=true);;(lo$8114=(nfw$8109+nbw$8110));;(hi$8115=(lo$8114+ndflt$8111));;(t$8116=it$0$7854.temp(rhs$7850));;(len$8117=it$0$7854.temp(["send",t$8116,["send",["symbol","."],["data",["void"],["symbol","length"]]]]));;it$0$7854.check((((m$8145$8147=rest$8105)),function(){if(m$8145$8147){return ["send",["symbol",">="],["data",len$8117,["value",lo$8114]]];}else{m$8145$8147;if((lo$8114===hi$8115)){return ["send",["symbol","=="],["data",len$8117,["value",lo$8114]]];}else{(otherwise$8163=m$8145$8147);return ["send",["symbol","and"],["data",["send",["symbol",">="],["data",len$8117,["value",lo$8114]]],["send",["symbol","<="],["data",len$8117,["value",hi$8115]]]]];}}}()));(temp$8168=enumerate$7076(fw$8102));;(len$8173=temp$8168.length);;(i$8178=0);;$8165:for(;(i$8178<len$8173);(i$8178++)){var i$8196;var m$8197;var t0$8191;var t1$8192;var m$8186;(m$8186=temp$8168[i$8178]);;(t0$8191=m$8186);if(((t0$8191 instanceof Array)&&((t1$8192=t0$8191.length),(t1$8192===2)))){(i$8196=t0$8191[0]);(m$8197=t0$8191[1]);it$0$7854.process(m$8197,["send",t$8116,["value",i$8196]],fns$7851);}else{false;;}}(temp$8206=enumerate$7076(dflt$8104));;(len$8211=temp$8206.length);;(i$8216=0);;$8203:for(;(i$8216<len$8211);(i$8216++)){var idx$8246;var i$8236;var patt$8237;var value$8238;var t0$8229;var t1$8230;var t2$8231;var t3$8232;var m$8224;(m$8224=temp$8206[i$8216]);;(t0$8229=m$8224);if(((t0$8229 instanceof Array)&&((t1$8230=t0$8229.length),((t1$8230===2)&&((i$8236=t0$8229[0]),((t2$8231=t0$8229[1]),((t2$8231 instanceof Array)&&((t3$8232=t2$8231.length),(t3$8232===2))))))))){(patt$8237=t2$8231[0]);(value$8238=t2$8231[1]);(idx$8246=(i$8236+nfw$8109));;it$0$7854.process(patt$8237,["send",["symbol","if"],["data",["send",["symbol",">="],["data",["value",(idx$8246+nbw$8110)],len$8117]],value$8238,["send",t$8116,["value",idx$8246]]]],fns$7851);}else{false;;}}if((rest$8105!==(void 0))){(pos$8253=(nfw$8109+ndflt$8111));;(end$8258=function(){if((nbw$8110>0)){return [["value",(-nbw$8110)]];}else{return [];}}());;it$0$7854.process(rest$8105,["send",["send",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",t$8116,["value",pos$8253]].concat(end$8258)],fns$7851);}else{[];}(acc$8264=[]);;(temp$8269=enumerate$7076(bw$8103));;(len$8274=temp$8269.length);;(i$8279=0);;$8262:for(;(i$8279<len$8274);(i$8279++)){var i$8297;var m$8298;var t0$8292;var t1$8293;var m$8287;(m$8287=temp$8269[i$8279]);;(t0$8292=m$8287);if(((t0$8292 instanceof Array)&&((t1$8293=t0$8292.length),(t1$8293===2)))){(i$8297=t0$8292[0]);(m$8298=t0$8292[1]);acc$8264.push(it$0$7854.process(m$8298,["send",["symbol","___js_fetch"],["data",t$8116,["send",["symbol","-"],["data",len$8117,["value",(nbw$8110-i$8297)]]]]],fns$7851));}else{false;;}}return acc$8264;}else{throw Error("mismatch!!");}}}}}}}}}}}}()));;return rval$7859;});$9831(PatternProcessor$7084,({}));PatternProcessor$7084;(assemble_conditions$7085=function(pp$8310){var i$8391;var len$8386;var temp$8381;var acc$8376;var decls$8371;var construct$8313;(construct$8313=function(temp$8316$8318){var x$8361;var rest$8362;var x$8354;var x$8346;var rest$8347;var $8321$8337;var $8322$8338;var t0$8333;var t1$8334;var t2$8335;var m$8320$8328;var ph$8323;(ph$8323=temp$8316$8318);;(m$8320$8328=ph$8323);;if((($8321$8337=(m$8320$8328 instanceof Array))&&((t0$8333=m$8320$8328.length),(t0$8333===0)))){return ["value",true];}else{if(($8321$8337&&((t0$8333>=1)&&((t1$8334=m$8320$8328[0]),((t1$8334 instanceof Array)&&((t2$8335=t1$8334.length),((t2$8335===2)&&(t1$8334[0]==="do")))))))){(x$8346=t1$8334[1]);(rest$8347=Array.prototype.slice.call(m$8320$8328,1));return ["multi",x$8346,construct$8313(rest$8347)];}else{if(($8321$8337&&((t0$8333===1)&&((t1$8334=m$8320$8328[0]),((t1$8334 instanceof Array)&&((t2$8335=t1$8334.length),((t2$8335===2)&&(t1$8334[0]==="check")))))))){(x$8354=t1$8334[1]);return x$8354;}else{if(($8321$8337&&((t0$8333>=1)&&((t1$8334=m$8320$8328[0]),((t1$8334 instanceof Array)&&((t2$8335=t1$8334.length),((t2$8335===2)&&(t1$8334[0]==="check")))))))){(x$8361=t1$8334[1]);(rest$8362=Array.prototype.slice.call(m$8320$8328,1));return ["send",["symbol","and"],["data",x$8361,construct$8313(rest$8362)]];}else{throw Error("mismatch!!");}}}}});;if(pp$8310.temps.length){(decls$8371=(((acc$8376=[])),(((temp$8381=pp$8310.temps)),(((len$8386=temp$8381.length)),(((i$8391=0)),function(){$8374:for(;(i$8391<len$8386);(i$8391++)){var t$8407;var m$8399;(m$8399=temp$8381[i$8391]);;(t$8407=m$8399);acc$8376.push(["declare",t$8407]);}}()))),acc$8376));;return ["multi"].concat(decls$8371).concat([construct$8313(pp$8310.parts)]);}else{return construct$8313(pp$8310.parts);}});;(assemble_pattern$7086=function(){var i$8454;var len$8449;var temp$8444;var i$8508;var len$8503;var temp$8498;var test$8601;var lead$8431;var trail$8432;var construct$8433;var parts$8425;var t$8426;var f$8427;var t0$8421;var m$8414$8416;(m$8414$8416=arguments);;(t0$8421=m$8414$8416.length);if(((t0$8421>=2)&&(t0$8421<=3))){(parts$8425=m$8414$8416[0]);(t$8426=m$8414$8416[1]);(f$8427=function(){if((2>=t0$8421)){return null;}else{return m$8414$8416[2];}}());(lead$8431=[]);;(temp$8444=parts$8425.slice(0));;(len$8449=temp$8444.length);;(i$8454=0);;$8437:for(;(i$8454<len$8449);(i$8454++)){var x$8483;var x$8476;var $8438$8470;var $8439$8471;var $8440$8472;var $8441$8473;var t0$8467;var t1$8468;var m$8462;(m$8462=temp$8444[i$8454]);;(t0$8467=m$8462);if((($8439$8471=(t0$8467 instanceof Array))&&((t1$8468=t0$8467.length),(($8441$8473=(t1$8468===2))&&(t0$8467[0]==="do"))))){(x$8476=t0$8467[1]);lead$8431.push(x$8476);parts$8425.shift();}else{if(($8441$8473&&(t0$8467[0]==="check"))){(x$8483=t0$8467[1]);break $8437;}else{false;;}}}(trail$8432=[]);;(temp$8498=parts$8425.slice(0).reverse());;(len$8503=temp$8498.length);;(i$8508=0);;$8491:for(;(i$8508<len$8503);(i$8508++)){var x$8537;var x$8530;var $8492$8524;var $8493$8525;var $8494$8526;var $8495$8527;var t0$8521;var t1$8522;var m$8516;(m$8516=temp$8498[i$8508]);;(t0$8521=m$8516);if((($8493$8525=(t0$8521 instanceof Array))&&((t1$8522=t0$8521.length),(($8495$8527=(t1$8522===2))&&(t0$8521[0]==="do"))))){(x$8530=t0$8521[1]);trail$8432.unshift(x$8530);parts$8425.pop();}else{if(($8495$8527&&(t0$8521[0]==="check"))){(x$8537=t0$8521[1]);break $8491;}else{false;;}}}(construct$8433=function(temp$8544$8546){var other$8597;var x$8589;var rest$8590;var x$8582;var x$8574;var rest$8575;var $8549$8565;var $8550$8566;var t0$8561;var t1$8562;var t2$8563;var m$8548$8556;var ph$8551;(ph$8551=temp$8544$8546);;(m$8548$8556=ph$8551);;if((($8549$8565=(m$8548$8556 instanceof Array))&&((t0$8561=m$8548$8556.length),(t0$8561===0)))){return ["value",true];}else{if(($8549$8565&&((t0$8561>=1)&&((t1$8562=m$8548$8556[0]),((t1$8562 instanceof Array)&&((t2$8563=t1$8562.length),((t2$8563===2)&&(t1$8562[0]==="do")))))))){(x$8574=t1$8562[1]);(rest$8575=Array.prototype.slice.call(m$8548$8556,1));return ["multi",x$8574,construct$8433(rest$8575)];}else{if(($8549$8565&&((t0$8561===1)&&((t1$8562=m$8548$8556[0]),((t1$8562 instanceof Array)&&((t2$8563=t1$8562.length),((t2$8563===2)&&(t1$8562[0]==="check")))))))){(x$8582=t1$8562[1]);return x$8582;}else{if(($8549$8565&&((t0$8561>=1)&&((t1$8562=m$8548$8556[0]),((t1$8562 instanceof Array)&&((t2$8563=t1$8562.length),((t2$8563===2)&&(t1$8562[0]==="check")))))))){(x$8589=t1$8562[1]);(rest$8590=Array.prototype.slice.call(m$8548$8556,1));return ["send",["symbol","and"],["data",x$8589,construct$8433(rest$8590)]];}else{(other$8597=m$8548$8556);throw $9725(["oops"]).create("?!?",other$8597);}}}}});;if(parts$8425.length){(test$8601=construct$8433(parts$8425));;return ["multi"].concat(lead$8431).concat([function(){if(f$8427){return ["send",["symbol","if"],["data",test$8601,["multi"].concat(trail$8432).concat([t$8426]),f$8427]];}else{return ["send",["symbol","if"],["data",test$8601,["multi"].concat(trail$8432).concat([t$8426])]];}}()]);}else{return ["multi"].concat(lead$8431).concat(trail$8432).concat([t$8426]);}}else{throw Error("mismatch!!");}});;(inject_below_uses$7087=function(temp$8610$8612,fn$8613){var other$8637;var scope$8630;var x$8631;var t0$8626;var m$8615$8621;var ph$8616;(ph$8616=temp$8610$8612);;(m$8615$8621=ph$8616);;if(((m$8615$8621 instanceof Array)&&((t0$8626=m$8615$8621.length),((t0$8626===3)&&(m$8615$8621[0]==="use"))))){(scope$8630=m$8615$8621[1]);(x$8631=m$8615$8621[2]);return ["use",scope$8630,inject_below_uses$7087(x$8631,fn$8613)];}else{(other$8637=m$8615$8621);return fn$8613(other$8637);}});;(parse_pattern$7088=function(expander$8643,scope$8644,pattern$8645,rhs$8646,opt$8647){var t0$8658;var i$8689;var len$8684;var temp$8679;var acc$8674;var parse$8650;var target$8651;var proc$8652;(parse$8650=PatternParser$7083(expander$8643,scope$8644,pattern$8645,opt$8647));;if(((!opt$8647.allow_arguments)&&parse$8650.arguments.length)){throw $9725(["syntax","pattern","arguments"]).create("Arguments cannot be declared in this pattern",({"args":parse$8650.arguments[0]}));}(t0$8658=$9881((opt$8647.wrap_target||identity$7081))(function(){if(parse$8650.arguments.length){return inject_below_uses$7087(rhs$8646,function(x$8661){return util$7072.construct(parse$8650.arguments.concat([x$8661]),function(args$8664,rest$8665){return ["send",["symbol","->"],["data",args$8664,rest$8665]];});});}else{return rhs$8646;}}()));if(t0$8658[0]){(target$8651=t0$8658[1]);;}else{throw Error("Mismatch");}(proc$8652=PatternProcessor$7084());;proc$8652.process(parse$8650.pattern,target$8651,opt$8647);if(opt$8647.finalize){return ["splice"].concat(opt$8647.declare(parse$8650.vars)).concat([["multi"].concat((((acc$8674=[])),(((temp$8679=proc$8652.temps)),(((len$8684=temp$8679.length)),(((i$8689=0)),function(){$8672:for(;(i$8689<len$8684);(i$8689++)){var t$8705;var m$8697;(m$8697=temp$8679[i$8689]);;(t$8705=m$8697);acc$8674.push(["declare",t$8705]);}}()))),acc$8674)).concat([assemble_pattern$7086(proc$8652.parts,opt$8647.success(),opt$8647.failure())])]);}else{return [parse$8650.vars,proc$8652.temps,proc$8652.parts];}});;(checkall$7089=["send","data","multi","assign","void","check","do"]);;(same_block$7090=function(temp$8713$8715,ban1$8716,ban2$8717){var i$8817;var len$8812;var temp$8807;var other$8838;var type1$8791;var args1$8792;var type2$8793;var args2$8794;var m1$8782;var m2$8783;var v1$8773;var v2$8774;var s1$8764;var s2$8765;var v1$8752;var v2$8753;var $8720$8743;var $8721$8744;var $8722$8745;var $8723$8746;var $8724$8747;var $8725$8748;var $8726$8749;var t0$8737;var t1$8738;var t2$8739;var t3$8740;var t4$8741;var m$8719$8732;var ph$8727;(ph$8727=temp$8713$8715);;(m$8719$8732=ph$8727);;if((($8720$8743=(m$8719$8732 instanceof Array))&&((t0$8737=m$8719$8732.length),(($8722$8745=(t0$8737===2))&&((t1$8738=m$8719$8732[0]),(($8724$8747=(t1$8738 instanceof Array))&&((t2$8739=t1$8738.length),(($8726$8749=(t2$8739===2))&&((t1$8738[0]==="variable")&&((v1$8752=t1$8738[1]),((t3$8740=m$8719$8732[1]),((t3$8740 instanceof Array)&&((t4$8741=t3$8740.length),((t4$8741===2)&&(t3$8740[0]==="variable"))))))))))))))){(v2$8753=t3$8740[1]);return (v1$8752===v2$8753);}else{if(($8726$8749&&((t1$8738[0]==="symbol")&&((s1$8764=t1$8738[1]),((t3$8740=m$8719$8732[1]),((t3$8740 instanceof Array)&&((t4$8741=t3$8740.length),((t4$8741===2)&&(t3$8740[0]==="symbol"))))))))){(s2$8765=t3$8740[1]);return (((!$7033(ban1$8716,s1$8764))&&(!$7033(ban2$8717,s2$8765)))&&(s1$8764===s2$8765));}else{if(($8726$8749&&((t1$8738[0]==="value")&&((v1$8773=t1$8738[1]),((t3$8740=m$8719$8732[1]),((t3$8740 instanceof Array)&&((t4$8741=t3$8740.length),((t4$8741===2)&&(t3$8740[0]==="value"))))))))){(v2$8774=t3$8740[1]);return (v1$8773===v2$8774);}else{if(($8726$8749&&((t1$8738[0]==="macro")&&((m1$8782=t1$8738[1]),((t3$8740=m$8719$8732[1]),((t3$8740 instanceof Array)&&((t4$8741=t3$8740.length),((t4$8741===2)&&(t3$8740[0]==="macro"))))))))){(m2$8783=t3$8740[1]);return (m1$8782===m2$8783);}else{if(($8724$8747&&((t2$8739>=1)&&((type1$8791=t1$8738[0]),((args1$8792=Array.prototype.slice.call(t1$8738,1)),((t3$8740=m$8719$8732[1]),((t3$8740 instanceof Array)&&((t4$8741=t3$8740.length),((t4$8741>=1)&&((type2$8793=t3$8740[0]),((args2$8794=Array.prototype.slice.call(t3$8740,1)),(checkall$7089.indexOf(type1$8791)!==(-1))))))))))))){if(((type1$8791===type2$8793)&&(args1$8792.length===args2$8794.length))){(temp$8807=zip$7075(args1$8792,args2$8794));;(len$8812=temp$8807.length);;(i$8817=0);;$8804:for(;(i$8817<len$8812);(i$8817++)){var pair$8833;var m$8825;(m$8825=temp$8807[i$8817]);;(pair$8833=m$8825);if((!same_block$7090(pair$8833,ban1$8716,ban2$8717))){return false;}}return true;}else{return false;}}else{(other$8838=m$8719$8732);return false;}}}}}});;(parse_clauses$7091=function(expander$8844,scope$8845,target$8846,stmts$8847,opt$8848){var i$8877;var len$8872;var temp$8867;var acc$8862;var i$9043;var len$9038;var temp$9033;var acc$9028;var i$9089;var len$9084;var temp$9079;var acc$9074;var decls$9069;var all_temps$8851;var the_parts$8852;var unique_temps$8853;(all_temps$8851=[]);;(the_parts$8852=(((acc$8862=[])),(((temp$8867=expander$8844.step_all(["clause"],scope$8845,stmts$8847))),(((len$8872=temp$8867.length)),(((i$8877=0)),function(){$8859:for(;(i$8877<len$8872);(i$8877++)){var accum$8950;var t0$8946;var t1$8947;var i$8977;var len$8972;var temp$8967;var bod$9004;var placeholder$8902;var special_fn$8903;var vars$8904;var temps$8905;var blocks$8906;var vars2$8907;var x$9013;var other$9020;var b$9010;var pattern$8896;var body$8897;var $8860$8893;var t0$8890;var t1$8891;var m$8885;(m$8885=temp$8867[i$8877]);;(t0$8890=m$8885);if(((t0$8890 instanceof Array)&&((t1$8891=t0$8890.length),((t1$8891===3)&&(t0$8890[0]==="clause"))))){(pattern$8896=t0$8890[1]);(body$8897=t0$8890[2]);acc$8862.push((((placeholder$8902=(void 0))),((special_fn$8903=function(temp$8913$8915,value$8916){var t0$8922;var t1$8923;var other$8942;var m$8918$8929;var ph$8919;var expr$8920;(t0$8922=temp$8913$8915);if(((t0$8922 instanceof Array)&&((t1$8923=t0$8922.length),((t1$8923===2)&&(t0$8922[0]==="special"))))){(ph$8919=t0$8922[1]);(expr$8920=t0$8922);;}else{throw Error("Mismatch");}(m$8918$8929=ph$8919);;if((m$8918$8929==="match")){(placeholder$8902=["symbol",gensym$7074("ph")]);return ["assign",placeholder$8902];}else{(other$8942=m$8918$8929);throw $9725(["syntax","pattern","special"]).create("Special token cannot be used here",({"special":expr$8920}));}})),((t0$8946=parse_pattern$7088(expander$8844,scope$8845,pattern$8896,target$8846,$9913(opt$8848,$9831(({"allow_arguments":false,"allow_nested":true,"special":special_fn$8903}),$9831(((accum$8950=({})),((accum$8950["assign"]=function(v$8954,value$8955){return ["do",__lt____lt____colon__$7071(["assign",v$8954,value$8955],v$8954)];}),accum$8950)),({"finalize":false})))))),function(){if(((t0$8946 instanceof Array)&&((t1$8947=t0$8946.length),(t1$8947===3)))){(vars$8904=t0$8946[0]);(temps$8905=t0$8946[1]);(blocks$8906=t0$8946[2]);}else{throw Error("Mismatch");}}()),(all_temps$8851=all_temps$8851.concat(temps$8905)),function(){if(placeholder$8902){return vars$8904.push(placeholder$8902);}}(),((vars2$8907=({}))),(((temp$8967=vars$8904)),(((len$8972=temp$8967.length)),(((i$8977=0)),function(){$8964:for(;(i$8977<len$8972);(i$8977++)){var other$9001;var xxx$8995;var t0$8990;var t1$8991;var m$8985;(m$8985=temp$8967[i$8977]);;(t0$8990=m$8985);if(((t0$8990 instanceof Array)&&((t1$8991=t0$8990.length),((t1$8991===2)&&(t0$8990[0]==="symbol"))))){(xxx$8995=t0$8990[1]);(vars2$8907[xxx$8995]=true);}else{(other$9001=m$8985);throw $9725(["syntax","unexpected"]).create();}}}()))),(((bod$9004=function(){if(placeholder$8902){return parse_clauses$7091(expander$8844,scope$8845,placeholder$8902,$9881(["multi"])(body$8897)[1],opt$8848);}else{if(opt$8848.wrap){return opt$8848.wrap(body$8897);}else{return body$8897;}}}())),["clause",vars$8904,vars2$8907,blocks$8906,bod$9004])));}else{if((((x$9013=t0$8890)),((x$9013 instanceof Array)&&(x$9013[0]==="block")))){(b$9010=t0$8890);acc$8862.push(b$9010);}else{(other$9020=m$8885);acc$8862.push(function(){throw $9725(["syntax","clause"]).create("Illegal clause",({"clause":other$9020}));}());}}}}()))),acc$8862));;if(opt$8848.fallback){the_parts$8852.push(["block",opt$8848.fallback]);}(unique_temps$8853=iterkeys$7077(util$7072.set((((acc$9028=[])),(((temp$9033=all_temps$8851)),(((len$9038=temp$9033.length)),(((i$9043=0)),function(){$9026:for(;(i$9043<len$9038);(i$9043++)){var t$9061;var t0$9056;var t1$9057;var m$9051;(m$9051=temp$9033[i$9043]);;(t0$9056=m$9051);if(((t0$9056 instanceof Array)&&((t1$9057=t0$9056.length),((t1$9057===2)&&(t0$9056[0]==="symbol"))))){(t$9061=t0$9056[1]);acc$9028.push(t$9061);}else{false;;}}}()))),acc$9028))));;(decls$9069=(((acc$9074=[])),(((temp$9079=unique_temps$8853)),(((len$9084=temp$9079.length)),(((i$9089=0)),function(){$9072:for(;(i$9089<len$9084);(i$9089++)){var t$9105;var m$9097;(m$9097=temp$9079[i$9089]);;(t$9105=m$9097);acc$9074.push(["declare",["symbol",t$9105]]);}}()))),acc$9074));;return ["multi"].concat(decls$9069).concat([weave_clauses$7093(the_parts$8852)]);});;(opt_clauses$7092=function(clauses$9112){var i$9140;var len$9135;var temp$9130;var acc$9125;var i$9273;var len$9268;var temp$9263;var acc$9258;var i$9317;var len$9312;var temp$9307;var acc$9302;var i$9360;var len$9355;var temp$9350;var acc$9345;var shares$9115;var max$9116;var temps$9117;var shared_last$9118;var idx_last$9119;var new_clauses$9120;(shares$9115=(((acc$9125=[])),(((temp$9130=enumerate$7076(clauses$9112.slice(1)))),(((len$9135=temp$9130.length)),(((i$9140=0)),function(){$9123:for(;(i$9140<len$9135);(i$9140++)){var t0$9177;var t1$9178;var i$9202;var len$9197;var temp$9192;var varsd0$9172;var blocks0$9173;var share$9174;var idx$9175;var i$9160;var vars$9161;var varsd$9162;var blocks$9163;var body$9164;var t0$9153;var t1$9154;var t2$9155;var t3$9156;var m$9148;(m$9148=temp$9130[i$9140]);;(t0$9153=m$9148);if(((t0$9153 instanceof Array)&&((t1$9154=t0$9153.length),((t1$9154===2)&&((i$9160=t0$9153[0]),((t2$9155=t0$9153[1]),((t2$9155 instanceof Array)&&((t3$9156=t2$9155.length),((t3$9156===5)&&(t2$9155[0]==="clause")))))))))){(vars$9161=t2$9155[1]);(varsd$9162=t2$9155[2]);(blocks$9163=t2$9155[3]);(body$9164=t2$9155[4]);acc$9125.push((((t0$9177=$7033(clauses$9112,i$9160)),function(){if(((t0$9177 instanceof Array)&&((t1$9178=t0$9177.length),((t1$9178===5)&&(t0$9177[0]==="clause"))))){t0$9177[1];(varsd0$9172=t0$9177[2]);(blocks0$9173=t0$9177[3]);t0$9177[4];}else{throw Error("Mismatch");}}()),((share$9174=0)),((idx$9175=0)),(((temp$9192=blocks$9163)),(((len$9197=temp$9192.length)),(((i$9202=0)),function(){$9189:for(;(i$9202<len$9197);(i$9202++)){var x$9233;var x$9242;var other$9249;var m$9221$9223;var b$9218;var m$9210;(m$9210=temp$9192[i$9202]);;(b$9218=m$9210);if(same_block$7090([$7033(blocks0$9173,share$9174),b$9218],varsd0$9172,varsd$9162)){(share$9174++);(m$9221$9223=b$9218);;if((((x$9233=m$9221$9223)),((x$9233 instanceof Array)&&(x$9233[0]==="do")))){null;}else{if((((x$9242=m$9221$9223)),((x$9242 instanceof Array)&&(x$9242[0]==="check")))){(idx$9175=share$9174);}else{(other$9249=m$9221$9223);__lt____gt__$7069(null,other$9249);}}}else{break $9189;}}}()))),[share$9174,idx$9175]));}else{false;;}}}()))),acc$9125));;(max$9116=$7033(Math.max,(((acc$9258=[])),(((temp$9263=shares$9115)),(((len$9268=temp$9263.length)),(((i$9273=0)),function(){$9256:for(;(i$9273<len$9268);(i$9273++)){var x$9291;var t0$9286;var t1$9287;var m$9281;(m$9281=temp$9263[i$9273]);;(t0$9286=m$9281);if(((t0$9286 instanceof Array)&&((t1$9287=t0$9286.length),(t1$9287===2)))){(x$9291=t0$9286[0]);t0$9286[1];acc$9258.push(x$9291);}else{false;;}}}()))),acc$9258)));;shares$9115.push([0,0]);(temps$9117=(((acc$9302=[])),(((temp$9307=$9935(1,max$9116))),(((len$9312=temp$9307.length)),(((i$9317=0)),function(){$9300:for(;(i$9317<len$9312);(i$9317++)){var m$9325;(m$9325=temp$9307[i$9317]);;m$9325;acc$9302.push(["symbol",gensym$7074()]);}}()))),acc$9302));;(shared_last$9118=0);;(idx_last$9119=0);;(new_clauses$9120=(((acc$9345=[])),(((temp$9350=enumerate$7076(clauses$9112))),(((len$9355=temp$9350.length)),(((i$9360=0)),function(){$9343:for(;(i$9360<len$9355);(i$9360++)){var t0$9398;var t1$9399;var i$9433;var len$9428;var temp$9423;var acc$9418;var rest$9482;var newblocks$9478;var share$9392;var idx$9393;var shared$9394;var n_to_share$9395;var to_share$9396;var other$9489;var i$9380;var vars$9381;var varsd$9382;var blocks$9383;var body$9384;var t0$9373;var t1$9374;var t2$9375;var t3$9376;var m$9368;(m$9368=temp$9350[i$9360]);;(t0$9373=m$9368);if(((t0$9373 instanceof Array)&&((t1$9374=t0$9373.length),((t1$9374===2)&&((i$9380=t0$9373[0]),((t2$9375=t0$9373[1]),((t2$9375 instanceof Array)&&((t3$9376=t2$9375.length),((t3$9376===5)&&(t2$9375[0]==="clause")))))))))){(vars$9381=t2$9375[1]);(varsd$9382=t2$9375[2]);(blocks$9383=t2$9375[3]);(body$9384=t2$9375[4]);acc$9345.push((((t0$9398=$7033(shares$9115,i$9380)),function(){if(((t0$9398 instanceof Array)&&((t1$9399=t0$9398.length),(t1$9399===2)))){(share$9392=t0$9398[0]);(idx$9393=t0$9398[1]);}else{throw Error("Mismatch");}}()),((shared$9394=function(){if(idx_last$9119){return [["check",$7033(temps$9117,(idx_last$9119-1))]];}else{return [];}}())),((n_to_share$9395=Math.max(shared_last$9118,share$9392))),((to_share$9396=(((acc$9418=[])),(((temp$9423=enumerate$7076(blocks$9383.slice(shared_last$9118,n_to_share$9395)))),(((len$9428=temp$9423.length)),(((i$9433=0)),function(){$9412:for(;(i$9433<len$9428);(i$9433++)){var j$9467;var x$9468;var j$9457;var x$9458;var $9413$9451;var $9414$9452;var $9415$9453;var $9416$9454;var t0$9446;var t1$9447;var t2$9448;var t3$9449;var m$9441;(m$9441=temp$9423[i$9433]);;(t0$9446=m$9441);if((($9414$9452=(t0$9446 instanceof Array))&&((t1$9447=t0$9446.length),(($9416$9454=(t1$9447===2))&&((j$9457=t0$9446[0]),((t2$9448=t0$9446[1]),((t2$9448 instanceof Array)&&((t3$9449=t2$9448.length),((t3$9449===2)&&(t2$9448[0]==="check")))))))))){(x$9458=t2$9448[1]);acc$9418.push(["check",["assign",$7033(temps$9117,(shared_last$9118+j$9457)),x$9458]]);}else{if(($9416$9454&&((j$9467=t0$9446[0]),((t2$9448=t0$9446[1]),((t2$9448 instanceof Array)&&((t3$9449=t2$9448.length),((t3$9449===2)&&(t2$9448[0]==="do")))))))){(x$9468=t2$9448[1]);acc$9418.push(["do",x$9468]);}else{false;;}}}}()))),acc$9418))),(shared_last$9118=share$9392),(idx_last$9119=idx$9393),(((newblocks$9478=(((rest$9482=blocks$9383.slice(n_to_share$9395))),shared$9394.concat(to_share$9396).concat(rest$9482)))),["clause",vars$9381,varsd$9382,newblocks$9478,body$9384])));}else{(other$9489=m$9368);acc$9345.push(function(){throw $9725(["oops"]).create("what",({"value":other$9489}));}());}}}()))),acc$9345));;return [temps$9117,new_clauses$9120];});;(weave_clauses$7093=function(parts$9496){var i$9541;var len$9536;var temp$9531;var i$9705;var len$9700;var temp$9695;var acc$9690;var groups$9499;var reassemble$9500;var new_temps$9501;var helper$9502;(groups$9499=classify_contiguous$7080(parts$9496,function(temp$9505$9507){var t0$9511;var t1$9512;var cls$9509;(t0$9511=temp$9505$9507);if(((t0$9511 instanceof Array)&&((t1$9512=t0$9511.length),(t1$9512>=1)))){(cls$9509=t0$9511[0]);Array.prototype.slice.call(t0$9511,1);;}else{throw Error("Mismatch");}return cls$9509;}));;(reassemble$9500=[]);;(new_temps$9501=[]);;(temp$9531=groups$9499);;(len$9536=temp$9531.length);;(i$9541=0);;$9524:for(;(i$9541<len$9536);(i$9541++)){var t0$9571;var t1$9572;var ts$9568;var new_clauses$9569;var elems$9579;var elems$9563;var $9525$9557;var $9526$9558;var $9527$9559;var $9528$9560;var t0$9554;var t1$9555;var m$9549;(m$9549=temp$9531[i$9541]);;(t0$9554=m$9549);if((($9526$9558=(t0$9554 instanceof Array))&&((t1$9555=t0$9554.length),(($9528$9560=(t1$9555>=1))&&(t0$9554[0]==="clause"))))){(elems$9563=Array.prototype.slice.call(t0$9554,1));(t0$9571=opt_clauses$7092(elems$9563));if(((t0$9571 instanceof Array)&&((t1$9572=t0$9571.length),(t1$9572===2)))){(ts$9568=t0$9571[0]);(new_clauses$9569=t0$9571[1]);;}else{throw Error("Mismatch");}(new_temps$9501=new_temps$9501.concat(ts$9568));(reassemble$9500=reassemble$9500.concat(new_clauses$9569));}else{if(($9528$9560&&(t0$9554[0]==="block"))){(elems$9579=Array.prototype.slice.call(t0$9554,1));(reassemble$9500=reassemble$9500.concat(elems$9579));}else{false;;}}}(helper$9502=function(temp$9586$9588){var i$9666;var len$9661;var temp$9656;var acc$9651;var decls$9646;var vars$9638;var varsd$9639;var blocks$9640;var body$9641;var rest$9642;var body$9627;var rest$9628;var $9591$9614;var $9592$9615;var $9593$9616;var $9594$9617;var $9595$9618;var $9596$9619;var t0$9607;var t1$9608;var t2$9609;var t3$9610;var t4$9611;var t5$9612;var m$9590$9602;var ph$9597;(ph$9597=temp$9586$9588);;(m$9590$9602=ph$9597);;if((($9591$9614=(m$9590$9602 instanceof Array))&&((t0$9607=m$9590$9602.length),(t0$9607===0)))){return ["multi"];}else{if(($9591$9614&&(($9593$9616=(t0$9607>=1))&&((t1$9608=m$9590$9602[0]),(($9595$9618=(t1$9608 instanceof Array))&&((t2$9609=t1$9608.length),((t2$9609===2)&&((t1$9608[0]==="block")&&((t3$9610=$9881(["multi"])(t1$9608[1])),(t3$9610[0]&&((t4$9611=t3$9610[1]),((t5$9612=t4$9611.length),(t5$9612>=0))))))))))))){(body$9627=Array.prototype.slice.call(t4$9611,0));(rest$9628=Array.prototype.slice.call(m$9590$9602,1));return ["multi"].concat(body$9627).concat([helper$9502(rest$9628)]);}else{if(($9595$9618&&((t2$9609===5)&&(t1$9608[0]==="clause")))){(vars$9638=t1$9608[1]);(varsd$9639=t1$9608[2]);(blocks$9640=t1$9608[3]);(body$9641=t1$9608[4]);(rest$9642=Array.prototype.slice.call(m$9590$9602,1));(decls$9646=(((acc$9651=[])),(((temp$9656=vars$9638)),(((len$9661=temp$9656.length)),(((i$9666=0)),function(){$9649:for(;(i$9666<len$9661);(i$9666++)){var v$9682;var m$9674;(m$9674=temp$9656[i$9666]);;(v$9682=m$9674);acc$9651.push(["declare",v$9682]);}}()))),acc$9651));;return ["tagscope","back",["multi"].concat(decls$9646).concat([assemble_pattern$7086(blocks$9640,body$9641,["use","back",helper$9502(rest$9642)])])];}else{throw Error("mismatch!!");}}}});;return ["multi"].concat((((acc$9690=[])),(((temp$9695=new_temps$9501)),(((len$9700=temp$9695.length)),(((i$9705=0)),function(){$9688:for(;(i$9705<len$9700);(i$9705++)){var t$9721;var m$9713;(m$9713=temp$9695[i$9705]);;(t$9721=m$9713);acc$9690.push(["declare",t$9721]);}}()))),acc$9690)).concat([helper$9502(reassemble$9500)]);});;(exports["PatternParser"]=PatternParser$7083);(exports["PatternProcessor"]=PatternProcessor$7084);(exports["parse_clauses"]=parse_clauses$7091);(exports["parse_pattern"]=parse_pattern$7088);
