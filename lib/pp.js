var augment=function(dest,values){for(k in values){if(values.hasOwnProperty(k)){(dest[k]=send(values,k));}else{null;}}return dest;};var send=function(obj,__t94){var msg;var __t93;(msg=__t94);true;(__t93=__t94);var __t95=__t93;var other;if(((typeof(__t95)==="string")||(typeof(__t95)==="number"))){return obj[msg];}else{if(((other=__t95),true)){return obj["::send"](msg);}else{throw ["Could not find a match",__t95];}}};var patch_array=function(){var r=[];for(var i=0;(i<arguments.length);(i++)){(r=r.concat(arguments[i]));}return r;};var range=function(from,to){var rval=[];for(var i=from;(i<=to);(i++)){rval.push(i);}return rval;};var ___checker=function(type){var __t96=type["::check"];var f;if((__t96===(void 0))){return function(value){return (value instanceof type);};}else{if(((f=__t96),true)){return function(value){return f.call(type,value);};}else{throw ["Could not find a match",__t96];}}};var ___projector=function(type){return function(value){var __t97=type[":::project"];var f;if((__t97===(void 0))){var __t98=type["::project"];var f;if((__t98===(void 0))){return [true,type(value)];}else{if(((f=__t98),true)){var __t100;try{(__t100=[true,f(value)]);}catch(__t99){(__t100=[false,null]);}return __t100;}else{throw ["Could not find a match",__t98];}}}else{if(((f=__t97),true)){return f.call(type,value);}else{throw ["Could not find a match",__t97];}}};};var ___deconstructor=function(type){return function(value){var __t101=type[":::deconstruct"];var f;if((__t101===(void 0))){var __t102=type["::deconstruct"];var f;if((__t102===(void 0))){if((value instanceof Array)){return [true,value];}else{if(true){return [false,null];}else{return false;}}}else{if(((f=__t102),true)){var __t104;try{(__t104=[true,f.call(type,value)]);}catch(__t103){(__t104=[false,null]);}return __t104;}else{throw ["Could not find a match",__t102];}}}else{if(((f=__t101),true)){return f.call(type,value);}else{throw ["Could not find a match",__t101];}}};};(Array[":::project"]=function(__t106){var value;var __t105;(value=__t106);true;(__t105=__t106);var __t107=__t105;var _;if(___checker(Array)(__t107)){return [true,value];}else{if(((_=__t107),true)){return [true,[value]];}else{throw ["Could not find a match",__t107];}}});(Array.prototype["boink"]=function(){return this;});(Array.prototype["::check"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){return false;}else{null;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){var rval=this.slice(0);rval.push(value);return [true,rval];}else{null;}}return [true,value];}else{var rval=this.slice(0);rval.push(value);return [true,rval];}});(Array.prototype[":::deconstruct"]=function(value){return value.slice(this.length);});(RegExp.prototype["::check"]=function(value){return value.match(this);});(RegExp.prototype[":::project"]=function(value){var __t108=value.match(this);var m;var m;if(((__t108===null)&&((m=__t108),true))){return [false,null];}else{if(((m=__t108),true)){return [true,m];}else{throw ["Could not find a match",__t108];}}});(RegExp.prototype[":::deconstruct"]=function(value){var __t109=value.match(this);var m;var m;if(((__t109===null)&&((m=__t109),true))){return [false,null];}else{if(((m=__t109),true)){return [true,m];}else{throw ["Could not find a match",__t109];}}});(Function.prototype["::send"]=function(args){return this.apply(this,args);});var ErrorFactory=function(tags){var __t87=function(){if((!___checker(ErrorFactory)(this))){return Object.create(ErrorFactory.prototype);}else{return this;}}();(__t87["tags"]=tags);return __t87;};augment(ErrorFactory,[]);(ErrorFactory.prototype["create"]=function(){var __t88=Array.prototype.slice.call(arguments,0);var __tp0;var message;var args;if(((__t88 instanceof Array)&&(((__tp0=__t88.length),true)&&((__tp0>=0)&&((message=function(){if((0>=__tp0)){return "";}else{return __t88[0];}}()),true,(args=__t88.slice(1)),true))))){var __t87=this;var e=Error(message);(e["::tags"]=__t87.tags);(e["args"]=args);(e["name"]=["E"].concat(__t87.tags).join("."));return e;}else{throw ["Could not find a match",__t88];}});(ErrorFactory.prototype["::check"]=function(e){var __t87=this;if(((!e)||(!___checker(Error)(e)))){return false;}else{null;}var tags=(e["::tags"]||[]);var __t89=__t87.tags;var __t90=__t89.length;for(var __t91=0;(__t91<__t90);(__t91++)){var __t92=__t89[__t91];var tag;var other;if(((tag=__t92),true,(tags.indexOf(tag)===(-1)))){return false;}else{if(((other=__t92),true)){false;}else{throw ["Could not find a match",__t92];}}}false;return true;});(ErrorFactory.prototype["::deconstruct"]=function(e){var __t87=this;return e.args;});ErrorFactory;
var __t254=require("./util");var items=__t254.items;var Node=function(__t256,__t257){var __tp0;var classes;if((((__tp0=___projector(Array)(__t256)),__tp0[0])&&((classes=__tp0[1]),true))){(void 0);}else{throw "a condition failed";}var __tp0;var children;if((((__tp0=___projector(Array)(__t257)),__tp0[0])&&((children=__tp0[1]),true))){(void 0);}else{throw "a condition failed";}var __t255=function(){if((!___checker(Node)(this))){return Object.create(Node.prototype);}else{return this;}}();(__t255["classes"]=classes.sort());(__t255["children"]=children);return __t255;};augment(Node,({"::check":function(x){return ((x&&x.classes)&&x.children);},"::deconstruct":function(x){return [x.classes,x.children];}}));(Node.prototype["::check"]=function(n){var __t255=this;var __t258=__t255.classes;var __t259=__t258.length;for(var __t260=0;(__t260<__t259);(__t260++)){var __t261=__t258[__t260];var c;var other;if(((c=__t261),true,(n.classes.indexOf(c)===(-1)))){return false;}else{if(((other=__t261),true)){false;}else{throw ["Could not find a match",__t261];}}}false;return true;});Node;var pr_terminus=function(node){var r=HTML(node,"span");var pre=(String.fromCharCode(27)+"[?0;7y+h <div class=\"ug\">");var post=("</div>"+String.fromCharCode(7));return console.log(((pre+r)+post));};var pr=function(__t262,r){var __t263=__t262;var n;var x;if((___checker(Node)(__t263)&&((n=__t263),true))){return pr_terminus(n);}else{if(((x=__t263),true)){return pr_terminus((r||repr)(x));}else{throw ["Could not find a match",__t263];}}};var __lt____gt__=function(__t264,x){if((__t264===null)){(void 0);}else{throw "a condition failed";}return pr(x);};var repr=function(__t266,__t267){var x;var __t265;(x=__t266);true;(__t265=__t266);var recur;var recur;if(((___checker(Function)(__t267)&&((recur=__t267),true))||((recur=repr),true))){(void 0);}else{throw "a condition failed";}var __t268=__t265;var entries;var other;if((__t268===true)){return Node(["special","true"],"true");}else{if((__t268===false)){return Node(["special","false"],"false");}else{if((__t268===null)){return Node(["special","nil"],"null");}else{if((__t268===(void 0))){return Node(["special","nil"],"undefined");}else{if((typeof(__t268)==="number")){return Node(["num"],String(x));}else{if((typeof(__t268)==="string")){return Node(["str"],x);}else{if((___checker(Array)(__t268)&&((entries=__t268),true))){return Node(["sequence"],function(){var __t269=[];var __t270=entries;var __t271=__t270.length;for(var __t272=0;(__t272<__t271);(__t272++)){var __t273=__t270[__t272];var x;var other;if(((x=__t273),true)){__t269.push(recur(x,repr));}else{if(((other=__t273),true)){false;}else{throw ["Could not find a match",__t273];}}}return __t269;}());}else{if(x["::repr"]){return x["::repr"](recur);}else{if((Object.getPrototypeOf(x)===Object.prototype)){return Node(["table"],function(){var __t274=[];var __t275=items(x);var __t276=__t275.length;for(var __t277=0;(__t277<__t276);(__t277++)){var __t278=__t275[__t277];var __tp0;var k;var v;var other;if(((__t278 instanceof Array)&&(((__tp0=__t278.length),true)&&((__tp0===2)&&((k=__t278[0]),true,(v=__t278[1]),true))))){__t274.push(Node(["pairing"],[recur(k,repr),recur(v,repr)]));}else{if(((other=__t278),true)){false;}else{throw ["Could not find a match",__t278];}}}return __t274;}());}else{if(((other=__t268),true)){return Node(["unknown"],other.toString());}else{throw ["Could not find a match",__t268];}}}}}}}}}}};var escape_html=function(__t279){var __tp0;var s;if((((__tp0=[true,String(__t279)]),__tp0[0])&&((s=__tp0[1]),true))){(void 0);}else{throw "a condition failed";}var repl=({"&":"&amp;","<":"&lt;",">":"&gt;"});return s.replace(RegExp("[&<>]","g"),function(x){return send(repl,x);});};var quotify=function(__t280){var __tp0;var s;if((((__tp0=[true,String(__t280)]),__tp0[0])&&((s=__tp0[1]),true))){(void 0);}else{throw "a condition failed";}return s.replace(RegExp("[\"\\\\]","g"),function(x){return ("\\"+x);});};var HTML=function(__t281,default_tag){var __t282=__t281;var s;var children;var __tp0;var __tp1;var __tp2;var tags;var children;var other;if(((typeof(__t282)==="string")&&((s=__t282),true))){return escape_html(s);}else{if((___checker(Array)(__t282)&&((children=__t282),true))){return function(){var __t283=[];var __t284=children;var __t285=__t284.length;for(var __t286=0;(__t286<__t285);(__t286++)){var __t287=__t284[__t286];var child;var other;if(((child=__t287),true)){__t283.push(HTML(child,default_tag));}else{if(((other=__t287),true)){false;}else{throw ["Could not find a match",__t287];}}}return __t283;}().join("");}else{if((___checker(Node)(__t282)&&(((__tp0=___deconstructor(Node)(__t282)),__tp0[0])&&(((__tp1=__tp0[1]),true,(__tp2=__tp1.length),true)&&((__tp2===2)&&((tags=__tp1[0]),true,(children=__tp1[1]),true)))))){var tag=(default_tag||"span");var classes=[];var id=null;var kv=[];var sub=[];var __t288=tags;var __t289=__t288.length;for(var __t290=0;(__t290<__t289);(__t290++)){var __t292=__t288[__t290];var __tp0;var __tp1;var k;var v;var __tp0;var __tp1;var k;var __tp0;var __tp1;var __tp2;var _;var m;var __tp0;var __tp1;var __tp2;var _;var m;var s;var other;var __t293=false;var __t294=false;if(((__t293=(__t292 instanceof Array))&&((__t294=((__tp0=__t292.length),true))&&((__tp0===3)&&(((__tp1=__t292[0]),(__tp1==="assoc"))&&((k=__t292[1]),true,(v=__t292[2]),true)))))){kv.push([k,v]);}else{if((__t294&&((__tp0===2)&&(((__tp1=__t292[0]),(__tp1==="assoc"))&&((k=__t292[1]),true))))){kv.push([k,undefined]);}else{if((___checker(RegExp("(?:^\\+((?:.*)))",""))(__t292)&&(((__tp0=___deconstructor(RegExp("(?:^\\+((?:.*)))",""))(__t292)),__tp0[0])&&(((__tp1=__tp0[1]),true,(__tp2=__tp1.length),true)&&((__tp2===2)&&((_=__tp1[0]),true,(m=__tp1[1]),true)))))){(tag=m);}else{if((___checker(RegExp("(?:^#((?:.*)))",""))(__t292)&&(((__tp0=___deconstructor(RegExp("(?:^#((?:.*)))",""))(__t292)),__tp0[0])&&(((__tp1=__tp0[1]),true,(__tp2=__tp1.length),true)&&((__tp2===2)&&((_=__tp1[0]),true,(m=__tp1[1]),true)))))){(id=m);}else{if(((typeof(__t292)==="string")&&((s=__t292),true))){classes.push(s);}else{if(((other=__t292),true)){false;}else{throw ["Could not find a match",__t292];}}}}}}}false;var accum=function(){if((tag==="raw")){return [];}else{return ["<",tag];}}();if(id){(accum=accum.concat(" id=\"",id,"\""));}else{null;}if(classes.length){(accum=accum.concat(" class=\"",quotify(classes.join(" ")),"\""));}else{null;}if(kv){var __t295=[];var __t296=kv;var __t297=__t296.length;for(var __t298=0;(__t298<__t297);(__t298++)){var __t299=__t296[__t298];var __tp0;var k;var v;var other;if(((__t299 instanceof Array)&&(((__tp0=__t299.length),true)&&((__tp0===2)&&((k=__t299[0]),true,(v=__t299[1]),true))))){__t295.push((accum=accum.concat(function(){if((v!==null)){return [" ",k,"=\"",quotify(v),"\""];}else{return [" ",k];}}())));}else{if(((other=__t299),true)){false;}else{throw ["Could not find a match",__t299];}}}__t295;}else{null;}(children=function(){var __t300=tag;var other;if((__t300==="raw")){var __t301=[];var __t302=children;var __t303=__t302.length;for(var __t304=0;(__t304<__t303);(__t304++)){var __t305=__t302[__t304];var s;var c;var other;if(((typeof(__t305)==="string")&&((s=__t305),true))){__t301.push(s);}else{if(((c=__t305),true)){__t301.push(HTML(c,default_tag));}else{if(((other=__t305),true)){false;}else{throw ["Could not find a match",__t305];}}}}return __t301;}else{if(((other=__t300),true)){var __t306=[];var __t307=children;var __t308=__t307.length;for(var __t309=0;(__t309<__t308);(__t309++)){var __t310=__t307[__t309];var c;var other;if(((c=__t310),true)){__t306.push(HTML(c,default_tag));}else{if(((other=__t310),true)){false;}else{throw ["Could not find a match",__t310];}}}return __t306;}else{throw ["Could not find a match",__t300];}}}());var __t291=tag;var other;if((__t291==="raw")){return accum.concat(children).join("");}else{if(((other=__t291),true)){var x=patch_array([">"],children,["</",tag,">"]);return accum.concat(x).join("");}else{throw ["Could not find a match",__t291];}}}else{if(((other=__t282),true)){return HTML([true,String(other)][1],default_tag);}else{throw ["Could not find a match",__t282];}}}}};(exports["pr_terminus"]=pr_terminus);(exports["pr"]=pr);(exports["<>"]=__lt____gt__);(exports["repr"]=repr);(exports["Node"]=Node);
