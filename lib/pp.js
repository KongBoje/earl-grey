var τ434=function(type){var τ435=type["::check"];var f;if((τ435===(void 0))){return function(value){return (value instanceof type);};}else{if(((f=τ435),true)){return function(value){return f.call(type,value);};}else{throw ["Could not find a match",τ435];}}};
var τ436=function(){var r=[];for(var i=0;(i<arguments.length);(i++)){(r=r.concat(arguments[i]));}return r;};
var τ437=function(τ438){var τ439=τ438;var x;var x;var other;if((((typeof(τ439)==="string")&&((x=τ439),true))||((typeof(τ439)==="number")&&((x=τ439),true)))){return ["value",x];}else{if(((other=τ439),true)){return other["::serialize_ast"]();}else{throw ["Could not find a match",τ439];}}};
var send=function(obj,τ427){var msg;var τ426;(msg=τ427);true;(τ426=τ427);var τ428=τ426;var other;if(((typeof(τ428)==="string")||(typeof(τ428)==="number"))){return obj[msg];}else{if(((other=τ428),true)){return obj["::send"](msg);}else{throw ["Could not find a match",τ428];}}};(Array[":::project"]=function(τ430){var value;var τ429;(value=τ430);true;(τ429=τ430);var τ431=τ429;var _;if(τ434(Array)(τ431)){return [true,value];}else{if(((_=τ431),true)){return [true,[value]];}else{throw ["Could not find a match",τ431];}}});(Array.prototype["::check"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){return false;}else{null;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){var rval=this.slice(0);rval.push(value);return [true,rval];}else{null;}}return [true,value];}else{var rval=this.slice(0);rval.push(value);return [true,rval];}});(Array.prototype[":::deconstruct"]=function(value){return [true,value.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return τ436(["array"],this.map(τ437));});(RegExp.prototype["::check"]=function(value){return value.match(this);});(RegExp.prototype[":::project"]=function(value){var τ432=value.match(this);var m;var m;if(((τ432===null)&&((m=τ432),true))){return [false,null];}else{if(((m=τ432),true)){return [true,m];}else{throw ["Could not find a match",τ432];}}});(RegExp.prototype[":::deconstruct"]=function(value){var τ433=value.match(this);var m;var m;if(((τ433===null)&&((m=τ433),true))){return [false,null];}else{if(((m=τ433),true)){return [true,m];}else{throw ["Could not find a match",τ433];}}});(Function.prototype["::send"]=function(args){return this.apply(this,args);});
var τ497=function(type){return function(value){var τ498=type[":::project"];var f;if((τ498===(void 0))){var τ499=type["::project"];var f;if((τ499===(void 0))){return [true,type(value)];}else{if(((f=τ499),true)){var τ501;try{(τ501=[true,f(value)]);}catch(τ500){(τ501=[false,null]);}return τ501;}else{throw ["Could not find a match",τ499];}}}else{if(((f=τ498),true)){return f.call(type,value);}else{throw ["Could not find a match",τ498];}}};};
var τ502=function(dest,values){for(k in values){if(values.hasOwnProperty(k)){(dest[k]=send(values,k));}else{null;}}return dest;};
var τ503=function(){var τ504=function(tags){var τ505=function(){if((!τ434(τ504)(this))){return Object.create(τ504.prototype);}else{return this;}}();(τ505["tags"]=tags);return τ505;};τ502(τ504);(τ504.prototype["create"]=function(){var τ506=Array.prototype.slice.call(arguments,0);var τp0;var message;var args;if(((τ506 instanceof Array)&&(((τp0=τ506.length),true)&&((τp0>=0)&&((message=function(){if((0>=τp0)){return "";}else{return τ506[0];}}()),true,(args=τ506.slice(1)),true))))){var τ505=this;var e=Error(message);(e["::tags"]=τ505.tags);(e["args"]=args);(e["name"]=["E"].concat(τ505.tags).join("."));return e;}else{throw ["Could not find a match",τ506];}});(τ504.prototype["::check"]=function(e){var τ505=this;if(((!e)||(!τ434(Error)(e)))){return false;}else{null;}var tags=(e["::tags"]||[]);var τ507=τ505.tags;var τ508=τ507.length;for(var τ509=0;(τ509<τ508);(τ509++)){var τ510=τ507[τ509];var tag;var other;if(((tag=τ510),true,(tags.indexOf(tag)===(-1)))){return false;}else{if(((other=τ510),true)){false;}else{throw ["Could not find a match",τ510];}}}false;return true;});(τ504.prototype["::deconstruct"]=function(e){var τ505=this;return e.args;});return τ504;}();
var τ511=function(type){return function(value){var τ512=type[":::deconstruct"];var f;if((τ512===(void 0))){var τ513=type["::deconstruct"];var f;if((τ513===(void 0))){if((value instanceof Array)){return [true,value];}else{if(true){return [false,null];}else{return false;}}}else{if(((f=τ513),true)){var τ515;try{(τ515=[true,f.call(type,value)]);}catch(τ514){(τ515=[false,null]);}return τ515;}else{throw ["Could not find a match",τ513];}}}else{if(((f=τ512),true)){return f.call(type,value);}else{throw ["Could not find a match",τ512];}}};};var τ440=require("./util");var items=τ440.items;var Node=function(τ442,τ443){var τp0;var classes;if((((τp0=τ497(Array)(τ442)),τp0[0])&&((classes=τp0[1]),true))){undefined;}else{throw τ502(τ503(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var children;if((((τp0=τ497(Array)(τ443)),τp0[0])&&((children=τp0[1]),true))){undefined;}else{throw τ502(τ503(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ441=function(){if((!τ434(Node)(this))){return Object.create(Node.prototype);}else{return this;}}();(τ441["classes"]=classes.sort());(τ441["children"]=children);return τ441;};τ502(Node,({"::check":function(x){return ((x&&x.classes)&&x.children);},"::deconstruct":function(x){return [x.classes,x.children];}}));(Node.prototype["::check"]=function(n){var τ441=this;var τ444=τ441.classes;var τ445=τ444.length;for(var τ446=0;(τ446<τ445);(τ446++)){var τ447=τ444[τ446];var c;var other;if(((c=τ447),true,(n.classes.indexOf(c)===(-1)))){return false;}else{if(((other=τ447),true)){false;}else{throw ["Could not find a match",τ447];}}}false;return true;});Node;var pr_terminus=function(node){var r=HTML(node,"span");var pre=(String.fromCharCode(27)+"[?0;7y+h <div class=\"ug\">");var post=("</div>"+String.fromCharCode(7));return console.log(((pre+r)+post));};var pr=function(τ448,r){var τ449=τ448;var n;var x;if((τ434(Node)(τ449)&&((n=τ449),true))){return pr_terminus(n);}else{if(((x=τ449),true)){return pr_terminus((r||repr)(x));}else{throw ["Could not find a match",τ449];}}};var __lt____gt__=function(τ450,x){if((τ450===null)){undefined;}else{throw τ502(τ503(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/pp.eg",744,744]}));}return pr(x);};var repr=function(τ452,τ453){var x;var τ451;(x=τ452);true;(τ451=τ452);var recur;var recur;if(((τ434(Function)(τ453)&&((recur=τ453),true))||((recur=repr),true))){undefined;}else{throw τ502(τ503(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ454=τ451;var entries;var other;if((τ454===true)){return Node(["special","true"],"true");}else{if((τ454===false)){return Node(["special","false"],"false");}else{if((τ454===null)){return Node(["special","nil"],"null");}else{if((τ454===(void 0))){return Node(["special","nil"],"undefined");}else{if((typeof(τ454)==="number")){return Node(["num"],String(x));}else{if((typeof(τ454)==="string")){return Node(["str"],x);}else{if((τ434(Array)(τ454)&&((entries=τ454),true))){return Node(["sequence"],function(){var τ455=[];var τ456=entries;var τ457=τ456.length;for(var τ458=0;(τ458<τ457);(τ458++)){var τ459=τ456[τ458];var x;var other;if(((x=τ459),true)){τ455.push(recur(x,repr));}else{if(((other=τ459),true)){false;}else{throw ["Could not find a match",τ459];}}}return τ455;}());}else{if(x["::repr"]){return x["::repr"](recur);}else{if((Object.getPrototypeOf(x)===Object.prototype)){return Node(["table"],function(){var τ460=[];var τ461=items(x);var τ462=τ461.length;for(var τ463=0;(τ463<τ462);(τ463++)){var τ464=τ461[τ463];var τp0;var k;var v;var other;if(((τ464 instanceof Array)&&(((τp0=τ464.length),true)&&((τp0===2)&&((k=τ464[0]),true,(v=τ464[1]),true))))){τ460.push(Node(["pairing"],[recur(k,repr),recur(v,repr)]));}else{if(((other=τ464),true)){false;}else{throw ["Could not find a match",τ464];}}}return τ460;}());}else{if(((other=τ454),true)){return Node(["unknown"],other.toString());}else{throw ["Could not find a match",τ454];}}}}}}}}}}};var escape_html=function(τ465){var τp0;var s;if((((τp0=[true,String(τ465)]),τp0[0])&&((s=τp0[1]),true))){undefined;}else{throw τ502(τ503(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var repl=({"&":"&amp;","<":"&lt;",">":"&gt;"});return s.replace(RegExp("[&<>]","g"),function(x){return send(repl,x);});};var quotify=function(τ466){var τp0;var s;if((((τp0=[true,String(τ466)]),τp0[0])&&((s=τp0[1]),true))){undefined;}else{throw τ502(τ503(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return s.replace(RegExp("[\"\\\\]","g"),function(x){return ("\\"+x);});};var HTML=function(τ467,default_tag){var τ468=τ467;var s;var children;var τp0;var τp1;var τp2;var tags;var children;var other;if(((typeof(τ468)==="string")&&((s=τ468),true))){return escape_html(s);}else{if((τ434(Array)(τ468)&&((children=τ468),true))){return function(){var τ469=[];var τ470=children;var τ471=τ470.length;for(var τ472=0;(τ472<τ471);(τ472++)){var τ473=τ470[τ472];var child;var other;if(((child=τ473),true)){τ469.push(HTML(child,default_tag));}else{if(((other=τ473),true)){false;}else{throw ["Could not find a match",τ473];}}}return τ469;}().join("");}else{if((τ434(Node)(τ468)&&(((τp0=τ511(Node)(τ468)),τp0[0])&&(((τp1=τp0[1]),true,(τp2=τp1.length),true)&&((τp2===2)&&((tags=τp1[0]),true,(children=τp1[1]),true)))))){var tag=(default_tag||"span");var classes=[];var id=null;var kv=[];var sub=[];var τ474=tags;var τ475=τ474.length;for(var τ476=0;(τ476<τ475);(τ476++)){var τ478=τ474[τ476];var τp0;var τp1;var k;var v;var τp0;var τp1;var k;var τp0;var τp1;var τp2;var _;var m;var τp0;var τp1;var τp2;var _;var m;var s;var other;var τ479=false;var τ480=false;if(((τ479=(τ478 instanceof Array))&&((τ480=((τp0=τ478.length),true))&&((τp0===3)&&(((τp1=τ478[0]),(τp1==="assoc"))&&((k=τ478[1]),true,(v=τ478[2]),true)))))){kv.push([k,v]);}else{if((τ480&&((τp0===2)&&(((τp1=τ478[0]),(τp1==="assoc"))&&((k=τ478[1]),true))))){kv.push([k,undefined]);}else{if((τ434(RegExp("(?:^\\+((?:.*)))",""))(τ478)&&(((τp0=τ511(RegExp("(?:^\\+((?:.*)))",""))(τ478)),τp0[0])&&(((τp1=τp0[1]),true,(τp2=τp1.length),true)&&((τp2===2)&&((_=τp1[0]),true,(m=τp1[1]),true)))))){(tag=m);}else{if((τ434(RegExp("(?:^#((?:.*)))",""))(τ478)&&(((τp0=τ511(RegExp("(?:^#((?:.*)))",""))(τ478)),τp0[0])&&(((τp1=τp0[1]),true,(τp2=τp1.length),true)&&((τp2===2)&&((_=τp1[0]),true,(m=τp1[1]),true)))))){(id=m);}else{if(((typeof(τ478)==="string")&&((s=τ478),true))){classes.push(s);}else{if(((other=τ478),true)){false;}else{throw ["Could not find a match",τ478];}}}}}}}false;var accum=function(){if((tag==="raw")){return [];}else{return ["<",tag];}}();if(id){(accum=accum.concat(" id=\"",id,"\""));}else{null;}if(classes.length){(accum=accum.concat(" class=\"",quotify(classes.join(" ")),"\""));}else{null;}if(kv){var τ481=[];var τ482=kv;var τ483=τ482.length;for(var τ484=0;(τ484<τ483);(τ484++)){var τ485=τ482[τ484];var τp0;var k;var v;var other;if(((τ485 instanceof Array)&&(((τp0=τ485.length),true)&&((τp0===2)&&((k=τ485[0]),true,(v=τ485[1]),true))))){τ481.push((accum=accum.concat(function(){if((v!==null)){return [" ",k,"=\"",quotify(v),"\""];}else{return [" ",k];}}())));}else{if(((other=τ485),true)){false;}else{throw ["Could not find a match",τ485];}}}τ481;}else{null;}(children=function(){var τ486=tag;var other;if((τ486==="raw")){var τ487=[];var τ488=children;var τ489=τ488.length;for(var τ490=0;(τ490<τ489);(τ490++)){var τ491=τ488[τ490];var s;var c;var other;if(((typeof(τ491)==="string")&&((s=τ491),true))){τ487.push(s);}else{if(((c=τ491),true)){τ487.push(HTML(c,default_tag));}else{if(((other=τ491),true)){false;}else{throw ["Could not find a match",τ491];}}}}return τ487;}else{if(((other=τ486),true)){var τ492=[];var τ493=children;var τ494=τ493.length;for(var τ495=0;(τ495<τ494);(τ495++)){var τ496=τ493[τ495];var c;var other;if(((c=τ496),true)){τ492.push(HTML(c,default_tag));}else{if(((other=τ496),true)){false;}else{throw ["Could not find a match",τ496];}}}return τ492;}else{throw ["Could not find a match",τ486];}}}());var τ477=tag;var other;if((τ477==="raw")){return accum.concat(children).join("");}else{if(((other=τ477),true)){var x=τ436([">"],children,["</",tag,">"]);return accum.concat(x).join("");}else{throw ["Could not find a match",τ477];}}}else{if(((other=τ468),true)){return HTML([true,String(other)][1],default_tag);}else{throw ["Could not find a match",τ468];}}}}};(exports["pr_terminus"]=pr_terminus);(exports["pr"]=pr);(exports["<>"]=__lt____gt__);(exports["repr"]=repr);(exports["Node"]=Node);
