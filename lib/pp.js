var τ900=function(type){var τ901=type["::check"];var f;if((τ901===(void 0))){return function(value){return (value instanceof type);};}else{if(((f=τ901),true)){return function(value){return f.call(type,value);};}else{throw τ892(["match"]).create("Could not find a match",({"value":τ901}));}}};
var τ902=function(dest,values){for(k in values){if(values.hasOwnProperty(k)){(dest[k]=send(values,k));}else{null;}}return dest;};
var τ892=function(){var τ893=function(tags){var τ894=function(){if((!τ900(τ893)(this))){return Object.create(τ893.prototype);}else{return this;}}();(τ894["tags"]=tags);return τ894;};τ902(τ893);(τ893.prototype["create"]=function(){var τ895=Array.prototype.slice.call(arguments,0);var τp0;var message;var args;if(((τ895 instanceof Array)&&(((τp0=τ895.length),true)&&((τp0>=0)&&((message=function(){if((0>=τp0)){return "";}else{return τ895[0];}}()),true,(args=τ895.slice(1)),true))))){var τ894=this;var e=Error(message);(e["::tags"]=τ894.tags);(e["args"]=args);(e["name"]=["E"].concat(τ894.tags).join("."));return e;}else{throw τ892(["match"]).create("Could not find a match",({"value":τ895}));}});(τ893.prototype["::check"]=function(e){var τ894=this;if(((!e)||(!τ900(Error)(e)))){return false;}else{null;}var tags=(e["::tags"]||[]);var τ896=τ894.tags;var τ897=τ896.length;for(var τ898=0;(τ898<τ897);(τ898++)){var τ899=τ896[τ898];var tag;var other;if(((tag=τ899),true,(tags.indexOf(tag)===(-1)))){return false;}else{if(((other=τ899),true)){false;}else{throw τ892(["match"]).create("Could not find a match",({"value":τ899}));}}}false;return true;});(τ893.prototype["::deconstruct"]=function(e){var τ894=this;return e.args;});return τ893;}();
var τ903=function(){var r=[];for(var i=0;(i<arguments.length);(i++)){(r=r.concat(arguments[i]));}return r;};
var τ904=function(τ905){var τ906=τ905;var x;var x;var other;if((((typeof(τ906)==="string")&&((x=τ906),true))||((typeof(τ906)==="number")&&((x=τ906),true)))){return ["value",x];}else{if(((other=τ906),true)){return other["::serialize_ast"]();}else{throw τ892(["match"]).create("Could not find a match",({"value":τ906}));}}};
var send=function(obj,τ885){var msg;var τ884;(msg=τ885);true;(τ884=τ885);var τ886=τ884;var other;if(((typeof(τ886)==="string")||(typeof(τ886)==="number"))){return obj[msg];}else{if(((other=τ886),true)){return obj["::send"](msg);}else{throw τ892(["match"]).create("Could not find a match",({"value":τ886}));}}};(Array[":::project"]=function(τ888){var value;var τ887;(value=τ888);true;(τ887=τ888);var τ889=τ887;var _;if(τ900(Array)(τ889)){return [true,value];}else{if(((_=τ889),true)){return [true,[value]];}else{throw τ892(["match"]).create("Could not find a match",({"value":τ889}));}}});(Array.prototype["::check"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){return false;}else{null;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){var rval=this.slice(0);rval.push(value);return [true,rval];}else{null;}}return [true,value];}else{var rval=this.slice(0);rval.push(value);return [true,rval];}});(Array.prototype[":::deconstruct"]=function(value){return [true,value.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return τ903(["array"],this.map(τ904));});(RegExp.prototype["::check"]=function(value){return value.match(this);});(RegExp.prototype[":::project"]=function(value){var τ890=value.match(this);var m;var m;if(((τ890===null)&&((m=τ890),true))){return [false,null];}else{if(((m=τ890),true)){return [true,m];}else{throw τ892(["match"]).create("Could not find a match",({"value":τ890}));}}});(RegExp.prototype[":::deconstruct"]=function(value){var τ891=value.match(this);var m;var m;if(((τ891===null)&&((m=τ891),true))){return [false,null];}else{if(((m=τ891),true)){return [true,m];}else{throw τ892(["match"]).create("Could not find a match",({"value":τ891}));}}});(Function.prototype["::send"]=function(args){return this.apply(this,args);});
var τ964=function(type){return function(value){var τ965=type[":::project"];var f;if((τ965===(void 0))){var τ966=type["::project"];var f;if((τ966===(void 0))){return [true,type(value)];}else{if(((f=τ966),true)){var τ968;try{(τ968=[true,f(value)]);}catch(τ967){(τ968=[false,null]);}return τ968;}else{throw τ892(["match"]).create("Could not find a match",({"value":τ966}));}}}else{if(((f=τ965),true)){return f.call(type,value);}else{throw τ892(["match"]).create("Could not find a match",({"value":τ965}));}}};};
var τ969=function(type){return function(value){var τ970=type[":::deconstruct"];var f;if((τ970===(void 0))){var τ971=type["::deconstruct"];var f;if((τ971===(void 0))){if((value instanceof Array)){return [true,value];}else{if(true){return [false,null];}else{return false;}}}else{if(((f=τ971),true)){var τ973;try{(τ973=[true,f.call(type,value)]);}catch(τ972){(τ973=[false,null]);}return τ973;}else{throw τ892(["match"]).create("Could not find a match",({"value":τ971}));}}}else{if(((f=τ970),true)){return f.call(type,value);}else{throw τ892(["match"]).create("Could not find a match",({"value":τ970}));}}};};var τ907=require("./util");var items=τ907.items;var Node=function(τ909,τ910){var τp0;var classes;if((((τp0=τ964(Array)(τ909)),τp0[0])&&((classes=τp0[1]),true))){undefined;}else{throw τ892(["match"]).create("The value failed to match");}var τp0;var children;if((((τp0=τ964(Array)(τ910)),τp0[0])&&((children=τp0[1]),true))){undefined;}else{throw τ892(["match"]).create("The value failed to match");}var τ908=function(){if((!τ900(Node)(this))){return Object.create(Node.prototype);}else{return this;}}();(τ908["classes"]=classes.sort());(τ908["children"]=children);return τ908;};τ902(Node,({"::check":function(x){return ((x&&x.classes)&&x.children);},"::deconstruct":function(x){return [x.classes,x.children];}}));(Node.prototype["::check"]=function(n){var τ908=this;var τ911=τ908.classes;var τ912=τ911.length;for(var τ913=0;(τ913<τ912);(τ913++)){var τ914=τ911[τ913];var c;var other;if(((c=τ914),true,(n.classes.indexOf(c)===(-1)))){return false;}else{if(((other=τ914),true)){false;}else{throw τ892(["match"]).create("Could not find a match",({"value":τ914}));}}}false;return true;});Node;var pr_terminus=function(node){var r=HTML(node,"span");var pre=(String.fromCharCode(27)+"[?0;7y+h <div class=\"ug\">");var post=("</div>"+String.fromCharCode(7));return console.log(((pre+r)+post));};var pr=function(τ915,r){var τ916=τ915;var n;var x;if((τ900(Node)(τ916)&&((n=τ916),true))){return pr_terminus(n);}else{if(((x=τ916),true)){return pr_terminus((r||repr)(x));}else{throw τ892(["match"]).create("Could not find a match",({"value":τ916}));}}};var __lt____gt__=function(τ917,x){if((τ917===null)){undefined;}else{throw τ892(["match"]).create("The value failed to match");}return pr(x);};var repr=function(){var τ919=Array.prototype.slice.call(arguments,0);var τp0;var τp1;var x;var τ920;var τp2;var recur;if(((τ919 instanceof Array)&&(((τp0=τ919.length),true)&&(((τp0>=1)&&(τp0<=2))&&(((τp1=τ919[0]),(x=τp1),true,(τ920=τp1),true,(τp2=function(){if((1>=τp0)){return repr;}else{return τ919[1];}}()),τ900(Function)(τp2))&&((recur=τp2),true)))))){var τ921=τ920;var entries;var other;if((τ921===true)){return Node(["special","true"],"true");}else{if((τ921===false)){return Node(["special","false"],"false");}else{if((τ921===null)){return Node(["special","nil"],"null");}else{if((τ921===(void 0))){return Node(["special","nil"],"undefined");}else{if((typeof(τ921)==="number")){return Node(["num"],String(x));}else{if((typeof(τ921)==="string")){return Node(["str"],x);}else{if((τ900(Array)(τ921)&&((entries=τ921),true))){return Node(["sequence"],function(){var τ922=[];var τ923=entries;var τ924=τ923.length;for(var τ925=0;(τ925<τ924);(τ925++)){var τ926=τ923[τ925];var x;var other;if(((x=τ926),true)){τ922.push(recur(x,repr));}else{if(((other=τ926),true)){false;}else{throw τ892(["match"]).create("Could not find a match",({"value":τ926}));}}}return τ922;}());}else{if(x["::repr"]){return x["::repr"](recur);}else{if((Object.getPrototypeOf(x)===Object.prototype)){return Node(["table"],function(){var τ927=[];var τ928=items(x);var τ929=τ928.length;for(var τ930=0;(τ930<τ929);(τ930++)){var τ931=τ928[τ930];var τp0;var k;var v;var other;if(((τ931 instanceof Array)&&(((τp0=τ931.length),true)&&((τp0===2)&&((k=τ931[0]),true,(v=τ931[1]),true))))){τ927.push(Node(["pairing"],[recur(k,repr),recur(v,repr)]));}else{if(((other=τ931),true)){false;}else{throw τ892(["match"]).create("Could not find a match",({"value":τ931}));}}}return τ927;}());}else{if(((other=τ921),true)){return Node(["unknown"],other.toString());}else{throw τ892(["match"]).create("Could not find a match",({"value":τ921}));}}}}}}}}}}}else{throw τ892(["match"]).create("Could not find a match",({"value":τ919}));}};var escape_html=function(τ932){var τp0;var s;if((((τp0=[true,String(τ932)]),τp0[0])&&((s=τp0[1]),true))){undefined;}else{throw τ892(["match"]).create("The value failed to match");}var repl=({"&":"&amp;","<":"&lt;",">":"&gt;"});return s.replace(RegExp("[&<>]","g"),function(x){return send(repl,x);});};var quotify=function(τ933){var τp0;var s;if((((τp0=[true,String(τ933)]),τp0[0])&&((s=τp0[1]),true))){undefined;}else{throw τ892(["match"]).create("The value failed to match");}return s.replace(RegExp("[\"\\\\]","g"),function(x){return ("\\"+x);});};var HTML=function(τ934,default_tag){var τ935=τ934;var s;var children;var τp0;var τp1;var τp2;var tags;var children;var other;if(((typeof(τ935)==="string")&&((s=τ935),true))){return escape_html(s);}else{if((τ900(Array)(τ935)&&((children=τ935),true))){return function(){var τ936=[];var τ937=children;var τ938=τ937.length;for(var τ939=0;(τ939<τ938);(τ939++)){var τ940=τ937[τ939];var child;var other;if(((child=τ940),true)){τ936.push(HTML(child,default_tag));}else{if(((other=τ940),true)){false;}else{throw τ892(["match"]).create("Could not find a match",({"value":τ940}));}}}return τ936;}().join("");}else{if((τ900(Node)(τ935)&&(((τp0=τ969(Node)(τ935)),τp0[0])&&(((τp1=τp0[1]),true,(τp2=τp1.length),true)&&((τp2===2)&&((tags=τp1[0]),true,(children=τp1[1]),true)))))){var tag=(default_tag||"span");var classes=[];var id=null;var kv=[];var sub=[];var τ941=tags;var τ942=τ941.length;for(var τ943=0;(τ943<τ942);(τ943++)){var τ945=τ941[τ943];var τp0;var τp1;var k;var v;var τp0;var τp1;var k;var τp0;var τp1;var τp2;var _;var m;var τp0;var τp1;var τp2;var _;var m;var s;var other;var τ946=false;var τ947=false;if(((τ946=(τ945 instanceof Array))&&((τ947=((τp0=τ945.length),true))&&((τp0===3)&&(((τp1=τ945[0]),(τp1==="assoc"))&&((k=τ945[1]),true,(v=τ945[2]),true)))))){kv.push([k,v]);}else{if((τ947&&((τp0===2)&&(((τp1=τ945[0]),(τp1==="assoc"))&&((k=τ945[1]),true))))){kv.push([k,undefined]);}else{if((τ900(RegExp("(?:^\\+((?:.*)))",""))(τ945)&&(((τp0=τ969(RegExp("(?:^\\+((?:.*)))",""))(τ945)),τp0[0])&&(((τp1=τp0[1]),true,(τp2=τp1.length),true)&&((τp2===2)&&((_=τp1[0]),true,(m=τp1[1]),true)))))){(tag=m);}else{if((τ900(RegExp("(?:^#((?:.*)))",""))(τ945)&&(((τp0=τ969(RegExp("(?:^#((?:.*)))",""))(τ945)),τp0[0])&&(((τp1=τp0[1]),true,(τp2=τp1.length),true)&&((τp2===2)&&((_=τp1[0]),true,(m=τp1[1]),true)))))){(id=m);}else{if(((typeof(τ945)==="string")&&((s=τ945),true))){classes.push(s);}else{if(((other=τ945),true)){false;}else{throw τ892(["match"]).create("Could not find a match",({"value":τ945}));}}}}}}}false;var accum=function(){if((tag==="raw")){return [];}else{return ["<",tag];}}();if(id){(accum=accum.concat(" id=\"",id,"\""));}else{null;}if(classes.length){(accum=accum.concat(" class=\"",quotify(classes.join(" ")),"\""));}else{null;}if(kv){var τ948=[];var τ949=kv;var τ950=τ949.length;for(var τ951=0;(τ951<τ950);(τ951++)){var τ952=τ949[τ951];var τp0;var k;var v;var other;if(((τ952 instanceof Array)&&(((τp0=τ952.length),true)&&((τp0===2)&&((k=τ952[0]),true,(v=τ952[1]),true))))){τ948.push((accum=accum.concat(function(){if((v!==null)){return [" ",k,"=\"",quotify(v),"\""];}else{return [" ",k];}}())));}else{if(((other=τ952),true)){false;}else{throw τ892(["match"]).create("Could not find a match",({"value":τ952}));}}}τ948;}else{null;}(children=function(){var τ953=tag;var other;if((τ953==="raw")){var τ954=[];var τ955=children;var τ956=τ955.length;for(var τ957=0;(τ957<τ956);(τ957++)){var τ958=τ955[τ957];var s;var c;var other;if(((typeof(τ958)==="string")&&((s=τ958),true))){τ954.push(s);}else{if(((c=τ958),true)){τ954.push(HTML(c,default_tag));}else{if(((other=τ958),true)){false;}else{throw τ892(["match"]).create("Could not find a match",({"value":τ958}));}}}}return τ954;}else{if(((other=τ953),true)){var τ959=[];var τ960=children;var τ961=τ960.length;for(var τ962=0;(τ962<τ961);(τ962++)){var τ963=τ960[τ962];var c;var other;if(((c=τ963),true)){τ959.push(HTML(c,default_tag));}else{if(((other=τ963),true)){false;}else{throw τ892(["match"]).create("Could not find a match",({"value":τ963}));}}}return τ959;}else{throw τ892(["match"]).create("Could not find a match",({"value":τ953}));}}}());var τ944=tag;var other;if((τ944==="raw")){return accum.concat(children).join("");}else{if(((other=τ944),true)){var x=τ903([">"],children,["</",tag,">"]);return accum.concat(x).join("");}else{throw τ892(["match"]).create("Could not find a match",({"value":τ944}));}}}else{if(((other=τ935),true)){return HTML([true,String(other)][1],default_tag);}else{throw τ892(["match"]).create("Could not find a match",({"value":τ935}));}}}}};(exports["pr_terminus"]=pr_terminus);(exports["pr"]=pr);(exports["<>"]=__lt____gt__);(exports["repr"]=repr);(exports["Node"]=Node);
