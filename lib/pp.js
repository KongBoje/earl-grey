var τ429=function(type){var τ430=type["::check"];var f;if((τ430===(void 0))){return function(value){return (value instanceof type);};}else{if(((f=τ430),true)){return function(value){return f.call(type,value);};}else{throw ["Could not find a match",τ430];}}};
var τ431=function(){var r=[];for(var i=0;(i<arguments.length);(i++)){(r=r.concat(arguments[i]));}return r;};
var τ432=function(τ433){var τ434=τ433;var x;var x;var other;if((((typeof(τ434)==="string")&&((x=τ434),true))||((typeof(τ434)==="number")&&((x=τ434),true)))){return ["value",x];}else{if(((other=τ434),true)){return other["::serialize_ast"]();}else{throw ["Could not find a match",τ434];}}};
var send=function(obj,τ422){var msg;var τ421;(msg=τ422);true;(τ421=τ422);var τ423=τ421;var other;if(((typeof(τ423)==="string")||(typeof(τ423)==="number"))){return obj[msg];}else{if(((other=τ423),true)){return obj["::send"](msg);}else{throw ["Could not find a match",τ423];}}};(Array[":::project"]=function(τ425){var value;var τ424;(value=τ425);true;(τ424=τ425);var τ426=τ424;var _;if(τ429(Array)(τ426)){return [true,value];}else{if(((_=τ426),true)){return [true,[value]];}else{throw ["Could not find a match",τ426];}}});(Array.prototype["::check"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){return false;}else{null;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){var rval=this.slice(0);rval.push(value);return [true,rval];}else{null;}}return [true,value];}else{var rval=this.slice(0);rval.push(value);return [true,rval];}});(Array.prototype[":::deconstruct"]=function(value){return [true,value.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return τ431(["array"],this.map(τ432));});(RegExp.prototype["::check"]=function(value){return value.match(this);});(RegExp.prototype[":::project"]=function(value){var τ427=value.match(this);var m;var m;if(((τ427===null)&&((m=τ427),true))){return [false,null];}else{if(((m=τ427),true)){return [true,m];}else{throw ["Could not find a match",τ427];}}});(RegExp.prototype[":::deconstruct"]=function(value){var τ428=value.match(this);var m;var m;if(((τ428===null)&&((m=τ428),true))){return [false,null];}else{if(((m=τ428),true)){return [true,m];}else{throw ["Could not find a match",τ428];}}});(Function.prototype["::send"]=function(args){return this.apply(this,args);});
var τ492=function(type){return function(value){var τ493=type[":::project"];var f;if((τ493===(void 0))){var τ494=type["::project"];var f;if((τ494===(void 0))){return [true,type(value)];}else{if(((f=τ494),true)){var τ496;try{(τ496=[true,f(value)]);}catch(τ495){(τ496=[false,null]);}return τ496;}else{throw ["Could not find a match",τ494];}}}else{if(((f=τ493),true)){return f.call(type,value);}else{throw ["Could not find a match",τ493];}}};};
var τ497=function(dest,values){for(k in values){if(values.hasOwnProperty(k)){(dest[k]=send(values,k));}else{null;}}return dest;};
var τ498=function(){var τ499=function(tags){var τ500=function(){if((!τ429(τ499)(this))){return Object.create(τ499.prototype);}else{return this;}}();(τ500["tags"]=tags);return τ500;};τ497(τ499);(τ499.prototype["create"]=function(){var τ501=Array.prototype.slice.call(arguments,0);var τp0;var message;var args;if(((τ501 instanceof Array)&&(((τp0=τ501.length),true)&&((τp0>=0)&&((message=function(){if((0>=τp0)){return "";}else{return τ501[0];}}()),true,(args=τ501.slice(1)),true))))){var τ500=this;var e=Error(message);(e["::tags"]=τ500.tags);(e["args"]=args);(e["name"]=["E"].concat(τ500.tags).join("."));return e;}else{throw ["Could not find a match",τ501];}});(τ499.prototype["::check"]=function(e){var τ500=this;if(((!e)||(!τ429(Error)(e)))){return false;}else{null;}var tags=(e["::tags"]||[]);var τ502=τ500.tags;var τ503=τ502.length;for(var τ504=0;(τ504<τ503);(τ504++)){var τ505=τ502[τ504];var tag;var other;if(((tag=τ505),true,(tags.indexOf(tag)===(-1)))){return false;}else{if(((other=τ505),true)){false;}else{throw ["Could not find a match",τ505];}}}false;return true;});(τ499.prototype["::deconstruct"]=function(e){var τ500=this;return e.args;});return τ499;}();
var τ506=function(type){return function(value){var τ507=type[":::deconstruct"];var f;if((τ507===(void 0))){var τ508=type["::deconstruct"];var f;if((τ508===(void 0))){if((value instanceof Array)){return [true,value];}else{if(true){return [false,null];}else{return false;}}}else{if(((f=τ508),true)){var τ510;try{(τ510=[true,f.call(type,value)]);}catch(τ509){(τ510=[false,null]);}return τ510;}else{throw ["Could not find a match",τ508];}}}else{if(((f=τ507),true)){return f.call(type,value);}else{throw ["Could not find a match",τ507];}}};};var τ435=require("./util");var items=τ435.items;var Node=function(τ437,τ438){var τp0;var classes;if((((τp0=τ492(Array)(τ437)),τp0[0])&&((classes=τp0[1]),true))){undefined;}else{throw τ497(τ498(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var children;if((((τp0=τ492(Array)(τ438)),τp0[0])&&((children=τp0[1]),true))){undefined;}else{throw τ497(τ498(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ436=function(){if((!τ429(Node)(this))){return Object.create(Node.prototype);}else{return this;}}();(τ436["classes"]=classes.sort());(τ436["children"]=children);return τ436;};τ497(Node,({"::check":function(x){return ((x&&x.classes)&&x.children);},"::deconstruct":function(x){return [x.classes,x.children];}}));(Node.prototype["::check"]=function(n){var τ436=this;var τ439=τ436.classes;var τ440=τ439.length;for(var τ441=0;(τ441<τ440);(τ441++)){var τ442=τ439[τ441];var c;var other;if(((c=τ442),true,(n.classes.indexOf(c)===(-1)))){return false;}else{if(((other=τ442),true)){false;}else{throw ["Could not find a match",τ442];}}}false;return true;});Node;var pr_terminus=function(node){var r=HTML(node,"span");var pre=(String.fromCharCode(27)+"[?0;7y+h <div class=\"ug\">");var post=("</div>"+String.fromCharCode(7));return console.log(((pre+r)+post));};var pr=function(τ443,r){var τ444=τ443;var n;var x;if((τ429(Node)(τ444)&&((n=τ444),true))){return pr_terminus(n);}else{if(((x=τ444),true)){return pr_terminus((r||repr)(x));}else{throw ["Could not find a match",τ444];}}};var __lt____gt__=function(τ445,x){if((τ445===null)){undefined;}else{throw τ497(τ498(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/pp.eg",744,744]}));}return pr(x);};var repr=function(τ447,τ448){var x;var τ446;(x=τ447);true;(τ446=τ447);var recur;var recur;if(((τ429(Function)(τ448)&&((recur=τ448),true))||((recur=repr),true))){undefined;}else{throw τ497(τ498(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τ449=τ446;var entries;var other;if((τ449===true)){return Node(["special","true"],"true");}else{if((τ449===false)){return Node(["special","false"],"false");}else{if((τ449===null)){return Node(["special","nil"],"null");}else{if((τ449===(void 0))){return Node(["special","nil"],"undefined");}else{if((typeof(τ449)==="number")){return Node(["num"],String(x));}else{if((typeof(τ449)==="string")){return Node(["str"],x);}else{if((τ429(Array)(τ449)&&((entries=τ449),true))){return Node(["sequence"],function(){var τ450=[];var τ451=entries;var τ452=τ451.length;for(var τ453=0;(τ453<τ452);(τ453++)){var τ454=τ451[τ453];var x;var other;if(((x=τ454),true)){τ450.push(recur(x,repr));}else{if(((other=τ454),true)){false;}else{throw ["Could not find a match",τ454];}}}return τ450;}());}else{if(x["::repr"]){return x["::repr"](recur);}else{if((Object.getPrototypeOf(x)===Object.prototype)){return Node(["table"],function(){var τ455=[];var τ456=items(x);var τ457=τ456.length;for(var τ458=0;(τ458<τ457);(τ458++)){var τ459=τ456[τ458];var τp0;var k;var v;var other;if(((τ459 instanceof Array)&&(((τp0=τ459.length),true)&&((τp0===2)&&((k=τ459[0]),true,(v=τ459[1]),true))))){τ455.push(Node(["pairing"],[recur(k,repr),recur(v,repr)]));}else{if(((other=τ459),true)){false;}else{throw ["Could not find a match",τ459];}}}return τ455;}());}else{if(((other=τ449),true)){return Node(["unknown"],other.toString());}else{throw ["Could not find a match",τ449];}}}}}}}}}}};var escape_html=function(τ460){var τp0;var s;if((((τp0=[true,String(τ460)]),τp0[0])&&((s=τp0[1]),true))){undefined;}else{throw τ497(τ498(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var repl=({"&":"&amp;","<":"&lt;",">":"&gt;"});return s.replace(RegExp("[&<>]","g"),function(x){return send(repl,x);});};var quotify=function(τ461){var τp0;var s;if((((τp0=[true,String(τ461)]),τp0[0])&&((s=τp0[1]),true))){undefined;}else{throw τ497(τ498(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return s.replace(RegExp("[\"\\\\]","g"),function(x){return ("\\"+x);});};var HTML=function(τ462,default_tag){var τ463=τ462;var s;var children;var τp0;var τp1;var τp2;var tags;var children;var other;if(((typeof(τ463)==="string")&&((s=τ463),true))){return escape_html(s);}else{if((τ429(Array)(τ463)&&((children=τ463),true))){return function(){var τ464=[];var τ465=children;var τ466=τ465.length;for(var τ467=0;(τ467<τ466);(τ467++)){var τ468=τ465[τ467];var child;var other;if(((child=τ468),true)){τ464.push(HTML(child,default_tag));}else{if(((other=τ468),true)){false;}else{throw ["Could not find a match",τ468];}}}return τ464;}().join("");}else{if((τ429(Node)(τ463)&&(((τp0=τ506(Node)(τ463)),τp0[0])&&(((τp1=τp0[1]),true,(τp2=τp1.length),true)&&((τp2===2)&&((tags=τp1[0]),true,(children=τp1[1]),true)))))){var tag=(default_tag||"span");var classes=[];var id=null;var kv=[];var sub=[];var τ469=tags;var τ470=τ469.length;for(var τ471=0;(τ471<τ470);(τ471++)){var τ473=τ469[τ471];var τp0;var τp1;var k;var v;var τp0;var τp1;var k;var τp0;var τp1;var τp2;var _;var m;var τp0;var τp1;var τp2;var _;var m;var s;var other;var τ474=false;var τ475=false;if(((τ474=(τ473 instanceof Array))&&((τ475=((τp0=τ473.length),true))&&((τp0===3)&&(((τp1=τ473[0]),(τp1==="assoc"))&&((k=τ473[1]),true,(v=τ473[2]),true)))))){kv.push([k,v]);}else{if((τ475&&((τp0===2)&&(((τp1=τ473[0]),(τp1==="assoc"))&&((k=τ473[1]),true))))){kv.push([k,undefined]);}else{if((τ429(RegExp("(?:^\\+((?:.*)))",""))(τ473)&&(((τp0=τ506(RegExp("(?:^\\+((?:.*)))",""))(τ473)),τp0[0])&&(((τp1=τp0[1]),true,(τp2=τp1.length),true)&&((τp2===2)&&((_=τp1[0]),true,(m=τp1[1]),true)))))){(tag=m);}else{if((τ429(RegExp("(?:^#((?:.*)))",""))(τ473)&&(((τp0=τ506(RegExp("(?:^#((?:.*)))",""))(τ473)),τp0[0])&&(((τp1=τp0[1]),true,(τp2=τp1.length),true)&&((τp2===2)&&((_=τp1[0]),true,(m=τp1[1]),true)))))){(id=m);}else{if(((typeof(τ473)==="string")&&((s=τ473),true))){classes.push(s);}else{if(((other=τ473),true)){false;}else{throw ["Could not find a match",τ473];}}}}}}}false;var accum=function(){if((tag==="raw")){return [];}else{return ["<",tag];}}();if(id){(accum=accum.concat(" id=\"",id,"\""));}else{null;}if(classes.length){(accum=accum.concat(" class=\"",quotify(classes.join(" ")),"\""));}else{null;}if(kv){var τ476=[];var τ477=kv;var τ478=τ477.length;for(var τ479=0;(τ479<τ478);(τ479++)){var τ480=τ477[τ479];var τp0;var k;var v;var other;if(((τ480 instanceof Array)&&(((τp0=τ480.length),true)&&((τp0===2)&&((k=τ480[0]),true,(v=τ480[1]),true))))){τ476.push((accum=accum.concat(function(){if((v!==null)){return [" ",k,"=\"",quotify(v),"\""];}else{return [" ",k];}}())));}else{if(((other=τ480),true)){false;}else{throw ["Could not find a match",τ480];}}}τ476;}else{null;}(children=function(){var τ481=tag;var other;if((τ481==="raw")){var τ482=[];var τ483=children;var τ484=τ483.length;for(var τ485=0;(τ485<τ484);(τ485++)){var τ486=τ483[τ485];var s;var c;var other;if(((typeof(τ486)==="string")&&((s=τ486),true))){τ482.push(s);}else{if(((c=τ486),true)){τ482.push(HTML(c,default_tag));}else{if(((other=τ486),true)){false;}else{throw ["Could not find a match",τ486];}}}}return τ482;}else{if(((other=τ481),true)){var τ487=[];var τ488=children;var τ489=τ488.length;for(var τ490=0;(τ490<τ489);(τ490++)){var τ491=τ488[τ490];var c;var other;if(((c=τ491),true)){τ487.push(HTML(c,default_tag));}else{if(((other=τ491),true)){false;}else{throw ["Could not find a match",τ491];}}}return τ487;}else{throw ["Could not find a match",τ481];}}}());var τ472=tag;var other;if((τ472==="raw")){return accum.concat(children).join("");}else{if(((other=τ472),true)){var x=τ431([">"],children,["</",tag,">"]);return accum.concat(x).join("");}else{throw ["Could not find a match",τ472];}}}else{if(((other=τ463),true)){return HTML([true,String(other)][1],default_tag);}else{throw ["Could not find a match",τ463];}}}}};(exports["pr_terminus"]=pr_terminus);(exports["pr"]=pr);(exports["<>"]=__lt____gt__);(exports["repr"]=repr);(exports["Node"]=Node);
