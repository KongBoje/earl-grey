var τ1059=function(type){var τ1060=type["::check"];var f;if((τ1060===(void 0))){return function(value){return (value instanceof type);};}else{if(((f=τ1060),true)){return function(value){return f.call(type,value);};}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1060}));}}};
var τ1061=function(dest,values){for(k in values){if(values.hasOwnProperty(k)){(dest[k]=send(values,k));}else{null;}}return dest;};
var τ1051=function(){var τ1052=function(tags){var τ1053=function(){if((!τ1059(τ1052)(this))){return Object.create(τ1052.prototype);}else{return this;}}();(τ1053["tags"]=tags);return τ1053;};τ1061(τ1052);(τ1052.prototype["create"]=function(){var τ1054=Array.prototype.slice.call(arguments,0);var τp0;var message;var args;if(((τ1054 instanceof Array)&&(((τp0=τ1054.length),true)&&((τp0>=0)&&((message=function(){if((0>=τp0)){return "";}else{return τ1054[0];}}()),true,(args=τ1054.slice(1)),true))))){var τ1053=this;var e=Error(message);(e["::tags"]=τ1053.tags);(e["args"]=args);(e["name"]=["E"].concat(τ1053.tags).join("."));return e;}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1054}));}});(τ1052.prototype["::check"]=function(e){var τ1053=this;if(((!e)||(!τ1059(Error)(e)))){return false;}else{null;}var tags=(e["::tags"]||[]);var τ1055=τ1053.tags;var τ1056=τ1055.length;for(var τ1057=0;(τ1057<τ1056);(τ1057++)){var τ1058=τ1055[τ1057];var tag;var other;if(((tag=τ1058),true,(tags.indexOf(tag)===(-1)))){return false;}else{if(((other=τ1058),true)){false;}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1058}));}}}false;return true;});(τ1052.prototype["::deconstruct"]=function(e){var τ1053=this;return e.args;});return τ1052;}();
var τ1062=function(){var r=[];for(var i=0;(i<arguments.length);(i++)){(r=r.concat(arguments[i]));}return r;};
var τ1063=function(τ1064){var τ1065=τ1064;var x;var x;var other;if((((typeof(τ1065)==="string")&&((x=τ1065),true))||((typeof(τ1065)==="number")&&((x=τ1065),true)))){return ["value",x];}else{if(((other=τ1065),true)){return other["::serialize_ast"]();}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1065}));}}};
var send=function(obj,τ1044){var msg;var τ1043;(msg=τ1044);true;(τ1043=τ1044);var τ1045=τ1043;var other;if(((typeof(τ1045)==="string")||(typeof(τ1045)==="number"))){return obj[msg];}else{if(((other=τ1045),true)){return obj["::send"](msg);}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1045}));}}};(Array[":::project"]=function(τ1047){var value;var τ1046;(value=τ1047);true;(τ1046=τ1047);var τ1048=τ1046;var _;if(τ1059(Array)(τ1048)){return [true,value];}else{if(((_=τ1048),true)){return [true,[value]];}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1048}));}}});(Array.prototype["::check"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){return false;}else{null;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){var rval=this.slice(0);rval.push(value);return [true,rval];}else{null;}}return [true,value];}else{var rval=this.slice(0);rval.push(value);return [true,rval];}});(Array.prototype[":::deconstruct"]=function(value){return [true,value.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return τ1062(["array"],this.map(τ1063));});(RegExp.prototype["::check"]=function(value){return value.match(this);});(RegExp.prototype[":::project"]=function(value){var τ1049=value.match(this);var m;var m;if(((τ1049===null)&&((m=τ1049),true))){return [false,null];}else{if(((m=τ1049),true)){return [true,m];}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1049}));}}});(RegExp.prototype[":::deconstruct"]=function(value){var τ1050=value.match(this);var m;var m;if(((τ1050===null)&&((m=τ1050),true))){return [false,null];}else{if(((m=τ1050),true)){return [true,m];}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1050}));}}});(Function.prototype["::send"]=function(args){return this.apply(this,args);});
var τ1123=function(type){return function(value){var τ1124=type[":::project"];var f;if((τ1124===(void 0))){var τ1125=type["::project"];var f;if((τ1125===(void 0))){return [true,type(value)];}else{if(((f=τ1125),true)){var τ1127;try{(τ1127=[true,f(value)]);}catch(τ1126){(τ1127=[false,null]);}return τ1127;}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1125}));}}}else{if(((f=τ1124),true)){return f.call(type,value);}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1124}));}}};};
var τ1128=function(type){return function(value){var τ1129=type[":::deconstruct"];var f;if((τ1129===(void 0))){var τ1130=type["::deconstruct"];var f;if((τ1130===(void 0))){if((value instanceof Array)){return [true,value];}else{if(true){return [false,null];}else{return false;}}}else{if(((f=τ1130),true)){var τ1132;try{(τ1132=[true,f.call(type,value)]);}catch(τ1131){(τ1132=[false,null]);}return τ1132;}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1130}));}}}else{if(((f=τ1129),true)){return f.call(type,value);}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1129}));}}};};var τ1066=require("./util");var items=τ1066.items;var Node=function(τ1068,τ1069){var τp0;var classes;if((((τp0=τ1123(Array)(τ1068)),τp0[0])&&((classes=τp0[1]),true))){undefined;}else{throw τ1051(["match"]).create("The value failed to match");}var τp0;var children;if((((τp0=τ1123(Array)(τ1069)),τp0[0])&&((children=τp0[1]),true))){undefined;}else{throw τ1051(["match"]).create("The value failed to match");}var τ1067=function(){if((!τ1059(Node)(this))){return Object.create(Node.prototype);}else{return this;}}();(τ1067["classes"]=classes.sort());(τ1067["children"]=children);return τ1067;};τ1061(Node,({"::check":function(x){return ((x&&x.classes)&&x.children);},"::deconstruct":function(x){return [x.classes,x.children];}}));(Node.prototype["::check"]=function(n){var τ1067=this;var τ1070=τ1067.classes;var τ1071=τ1070.length;for(var τ1072=0;(τ1072<τ1071);(τ1072++)){var τ1073=τ1070[τ1072];var c;var other;if(((c=τ1073),true,(n.classes.indexOf(c)===(-1)))){return false;}else{if(((other=τ1073),true)){false;}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1073}));}}}false;return true;});Node;var pr_terminus=function(node){var r=HTML(node,"span");var pre=(String.fromCharCode(27)+"[?0;7y+h <div class=\"ug\">");var post=("</div>"+String.fromCharCode(7));return console.log(((pre+r)+post));};var pr=function(τ1074,r){var τ1075=τ1074;var n;var x;if((τ1059(Node)(τ1075)&&((n=τ1075),true))){return pr_terminus(n);}else{if(((x=τ1075),true)){return pr_terminus((r||repr)(x));}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1075}));}}};var __lt____gt__=function(τ1076,x){if((τ1076===null)){undefined;}else{throw τ1051(["match"]).create("The value failed to match");}return pr(x);};var repr=function(τ1078,τ1079){var x;var τ1077;(x=τ1078);true;(τ1077=τ1078);var recur;var recur;if(((τ1059(Function)(τ1079)&&((recur=τ1079),true))||((recur=repr),true))){undefined;}else{throw τ1051(["match"]).create("The value failed to match");}var τ1080=τ1077;var entries;var other;if((τ1080===true)){return Node(["special","true"],"true");}else{if((τ1080===false)){return Node(["special","false"],"false");}else{if((τ1080===null)){return Node(["special","nil"],"null");}else{if((τ1080===(void 0))){return Node(["special","nil"],"undefined");}else{if((typeof(τ1080)==="number")){return Node(["num"],String(x));}else{if((typeof(τ1080)==="string")){return Node(["str"],x);}else{if((τ1059(Array)(τ1080)&&((entries=τ1080),true))){return Node(["sequence"],function(){var τ1081=[];var τ1082=entries;var τ1083=τ1082.length;for(var τ1084=0;(τ1084<τ1083);(τ1084++)){var τ1085=τ1082[τ1084];var x;var other;if(((x=τ1085),true)){τ1081.push(recur(x,repr));}else{if(((other=τ1085),true)){false;}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1085}));}}}return τ1081;}());}else{if(x["::repr"]){return x["::repr"](recur);}else{if((Object.getPrototypeOf(x)===Object.prototype)){return Node(["table"],function(){var τ1086=[];var τ1087=items(x);var τ1088=τ1087.length;for(var τ1089=0;(τ1089<τ1088);(τ1089++)){var τ1090=τ1087[τ1089];var τp0;var k;var v;var other;if(((τ1090 instanceof Array)&&(((τp0=τ1090.length),true)&&((τp0===2)&&((k=τ1090[0]),true,(v=τ1090[1]),true))))){τ1086.push(Node(["pairing"],[recur(k,repr),recur(v,repr)]));}else{if(((other=τ1090),true)){false;}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1090}));}}}return τ1086;}());}else{if(((other=τ1080),true)){return Node(["unknown"],other.toString());}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1080}));}}}}}}}}}}};var escape_html=function(τ1091){var τp0;var s;if((((τp0=[true,String(τ1091)]),τp0[0])&&((s=τp0[1]),true))){undefined;}else{throw τ1051(["match"]).create("The value failed to match");}var repl=({"&":"&amp;","<":"&lt;",">":"&gt;"});return s.replace(RegExp("[&<>]","g"),function(x){return send(repl,x);});};var quotify=function(τ1092){var τp0;var s;if((((τp0=[true,String(τ1092)]),τp0[0])&&((s=τp0[1]),true))){undefined;}else{throw τ1051(["match"]).create("The value failed to match");}return s.replace(RegExp("[\"\\\\]","g"),function(x){return ("\\"+x);});};var HTML=function(τ1093,default_tag){var τ1094=τ1093;var s;var children;var τp0;var τp1;var τp2;var tags;var children;var other;if(((typeof(τ1094)==="string")&&((s=τ1094),true))){return escape_html(s);}else{if((τ1059(Array)(τ1094)&&((children=τ1094),true))){return function(){var τ1095=[];var τ1096=children;var τ1097=τ1096.length;for(var τ1098=0;(τ1098<τ1097);(τ1098++)){var τ1099=τ1096[τ1098];var child;var other;if(((child=τ1099),true)){τ1095.push(HTML(child,default_tag));}else{if(((other=τ1099),true)){false;}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1099}));}}}return τ1095;}().join("");}else{if((τ1059(Node)(τ1094)&&(((τp0=τ1128(Node)(τ1094)),τp0[0])&&(((τp1=τp0[1]),true,(τp2=τp1.length),true)&&((τp2===2)&&((tags=τp1[0]),true,(children=τp1[1]),true)))))){var tag=(default_tag||"span");var classes=[];var id=null;var kv=[];var sub=[];var τ1100=tags;var τ1101=τ1100.length;for(var τ1102=0;(τ1102<τ1101);(τ1102++)){var τ1104=τ1100[τ1102];var τp0;var τp1;var k;var v;var τp0;var τp1;var k;var τp0;var τp1;var τp2;var _;var m;var τp0;var τp1;var τp2;var _;var m;var s;var other;var τ1105=false;var τ1106=false;if(((τ1105=(τ1104 instanceof Array))&&((τ1106=((τp0=τ1104.length),true))&&((τp0===3)&&(((τp1=τ1104[0]),(τp1==="assoc"))&&((k=τ1104[1]),true,(v=τ1104[2]),true)))))){kv.push([k,v]);}else{if((τ1106&&((τp0===2)&&(((τp1=τ1104[0]),(τp1==="assoc"))&&((k=τ1104[1]),true))))){kv.push([k,undefined]);}else{if((τ1059(RegExp("(?:^\\+((?:.*)))",""))(τ1104)&&(((τp0=τ1128(RegExp("(?:^\\+((?:.*)))",""))(τ1104)),τp0[0])&&(((τp1=τp0[1]),true,(τp2=τp1.length),true)&&((τp2===2)&&((_=τp1[0]),true,(m=τp1[1]),true)))))){(tag=m);}else{if((τ1059(RegExp("(?:^#((?:.*)))",""))(τ1104)&&(((τp0=τ1128(RegExp("(?:^#((?:.*)))",""))(τ1104)),τp0[0])&&(((τp1=τp0[1]),true,(τp2=τp1.length),true)&&((τp2===2)&&((_=τp1[0]),true,(m=τp1[1]),true)))))){(id=m);}else{if(((typeof(τ1104)==="string")&&((s=τ1104),true))){classes.push(s);}else{if(((other=τ1104),true)){false;}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1104}));}}}}}}}false;var accum=function(){if((tag==="raw")){return [];}else{return ["<",tag];}}();if(id){(accum=accum.concat(" id=\"",id,"\""));}else{null;}if(classes.length){(accum=accum.concat(" class=\"",quotify(classes.join(" ")),"\""));}else{null;}if(kv){var τ1107=[];var τ1108=kv;var τ1109=τ1108.length;for(var τ1110=0;(τ1110<τ1109);(τ1110++)){var τ1111=τ1108[τ1110];var τp0;var k;var v;var other;if(((τ1111 instanceof Array)&&(((τp0=τ1111.length),true)&&((τp0===2)&&((k=τ1111[0]),true,(v=τ1111[1]),true))))){τ1107.push((accum=accum.concat(function(){if((v!==null)){return [" ",k,"=\"",quotify(v),"\""];}else{return [" ",k];}}())));}else{if(((other=τ1111),true)){false;}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1111}));}}}τ1107;}else{null;}(children=function(){var τ1112=tag;var other;if((τ1112==="raw")){var τ1113=[];var τ1114=children;var τ1115=τ1114.length;for(var τ1116=0;(τ1116<τ1115);(τ1116++)){var τ1117=τ1114[τ1116];var s;var c;var other;if(((typeof(τ1117)==="string")&&((s=τ1117),true))){τ1113.push(s);}else{if(((c=τ1117),true)){τ1113.push(HTML(c,default_tag));}else{if(((other=τ1117),true)){false;}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1117}));}}}}return τ1113;}else{if(((other=τ1112),true)){var τ1118=[];var τ1119=children;var τ1120=τ1119.length;for(var τ1121=0;(τ1121<τ1120);(τ1121++)){var τ1122=τ1119[τ1121];var c;var other;if(((c=τ1122),true)){τ1118.push(HTML(c,default_tag));}else{if(((other=τ1122),true)){false;}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1122}));}}}return τ1118;}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1112}));}}}());var τ1103=tag;var other;if((τ1103==="raw")){return accum.concat(children).join("");}else{if(((other=τ1103),true)){var x=τ1062([">"],children,["</",tag,">"]);return accum.concat(x).join("");}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1103}));}}}else{if(((other=τ1094),true)){return HTML([true,String(other)][1],default_tag);}else{throw τ1051(["match"]).create("Could not find a match",({"value":τ1094}));}}}}};(exports["pr_terminus"]=pr_terminus);(exports["pr"]=pr);(exports["<>"]=__lt____gt__);(exports["repr"]=repr);(exports["Node"]=Node);
