var $6335=function(type$6337){var f$6340;(f$6340=type$6337["::check"]);if((f$6340===(void 0))){return function(value$6345){return (value$6345 instanceof type$6337);};}else{return function(value$6348){return f$6340.call(type$6337,value$6348);};}};
var $6350=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $6351=function(dest$6353,values$6354){var k$6359;(k$6359=null);$6357:for(k$6359 in values$6354){if(values$6354.hasOwnProperty(k$6359)){(dest$6353[k$6359]=values$6354[k$6359]);}}return dest$6353;};
var $6366=function($6367$6369){var ph$6373;(ph$6373=$6367$6369);var $6371$6378;($6371$6378=ph$6373);var bridge$6372$6383;var x$6387;(bridge$6372$6383=$6371$6378);if((((typeof(bridge$6372$6383)==="string")&&((x$6387=bridge$6372$6383),true))||((typeof(bridge$6372$6383)==="number")&&((x$6387=bridge$6372$6383),true)))){return ["value",x$6387];}else{var other$6397;(other$6397=$6371$6378);return other$6397["::serialize_ast"]();}};
var send$6142;(send$6142=function(obj$6147,$6145$6148){var ph$6152;var msg$6153;var t0$6155;(t0$6155=$6145$6148);(msg$6153=t0$6155);(ph$6152=t0$6155);var $6150$6162;($6150$6162=ph$6152);var bridge$6151$6167;(bridge$6151$6167=$6150$6162);if(((typeof(bridge$6151$6167)==="string")||(typeof(bridge$6151$6167)==="number"))){return obj$6147[msg$6153];}else{var other$6178;(other$6178=$6150$6162);return obj$6147["::send"](msg$6153);}});(Array[":::project"]=function($6183$6185){var ph$6188;var value$6189;var t0$6191;(t0$6191=$6183$6185);(value$6189=t0$6191);(ph$6188=t0$6191);var $6187$6198;($6187$6198=ph$6188);if($6335(Array)($6187$6198)){return [true,value$6189];}else{$6187$6198;return [true,[value$6189]];}});(Array.prototype["::check"]=function(value$6215){if((value$6215 instanceof Array)){var i$6220;(i$6220=0);$6218:for(;(i$6220<this.length);(i$6220++)){if(($6350(this,i$6220)!==$6350(value$6215,i$6220))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $6351(this.slice(0),this);});(Array.prototype[":::project"]=function(value$6237){if((value$6237 instanceof Array)){var i$6242;(i$6242=0);$6240:for(;(i$6242<this.length);(i$6242++)){if(($6350(this,i$6242)!==$6350(value$6237,i$6242))){return [true,[value$6237]];}}return [true,value$6237.slice(this.length)];}else{return [true,[value$6237]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($6366));});(RegExp.prototype["::check"]=function($6258$6260){var ph$6263;(ph$6263=$6258$6260);var $6262$6268;($6262$6268=ph$6263);var value$6276;if((typeof($6262$6268)==="string")){(value$6276=$6262$6268);if(value$6276.match(this)){return true;}else{return false;}}else{var other$6281;(other$6281=$6262$6268);return false;}});(RegExp.prototype[":::project"]=function($6286$6288){var ph$6291;(ph$6291=$6286$6288);var $6290$6296;($6290$6296=ph$6291);var value$6304;if((typeof($6290$6296)==="string")){(value$6304=$6290$6296);var $6307$6309;($6307$6309=value$6304.match(this));var m$6317;if(($6307$6309===null)){(m$6317=$6307$6309);return [false,null];}else{var m$6322;(m$6322=$6307$6309);return [true,m$6322];}}else{var other$6326;(other$6326=$6290$6296);return [false,null];}});(Function.prototype["::send"]=function(args$6332){return this.apply(this,args$6332);});
var $8467=function(arr$8469){var results$8473;var l$8474;(results$8473=[]);(l$8474=arr$8469.length);var i$8482;(i$8482=0);$8472:for(;(i$8482<l$8474);(i$8482++)){results$8473.push([i$8482,$6350(arr$8469,i$8482)]);}return results$8473;};
var $8271=function(){var $8272$8274;($8272$8274=function(tags$8278){var it$0$8281;(it$0$8281=function(){if((!$6335($8272$8274)(this))){return Object.create($8272$8274.prototype);}else{return this;}}());(it$0$8281["tags"]=tags$8278);return it$0$8281;});($8272$8274.prototype["create"]=function(){var $8293$8295;($8293$8295=arguments);var t0$8300;var message$8304;var args$8305;(t0$8300=$8293$8295.length);if((t0$8300>=0)){(message$8304=function(){if((0>=t0$8300)){return "";}else{return $8293$8295[0];}}());(args$8305=Array.prototype.slice.call($8293$8295,1));var it$0$8312;(it$0$8312=this);var self$8317;(self$8317=this);var e$8322;(e$8322=Error(message$8304));(e$8322["::tags"]=it$0$8312.tags);(e$8322["args"]=args$8305);var temp$8336;(temp$8336=$8467(args$8305));var $length$8341;($length$8341=temp$8336.length);var $index$8346;($index$8346=0);$8323:for(;($index$8346<$length$8341);($index$8346++)){var m$8354;(m$8354=temp$8336[$index$8346]);var t0$8359;var t1$8360;var i$8364;var arg$8365;(t0$8359=m$8354);if(((t0$8359 instanceof Array)&&(((t1$8360=t0$8359.length)),(t1$8360===2)))){(i$8364=t0$8359[0]);(arg$8365=t0$8359[1]);(e$8322[i$8364]=arg$8365);}else{$8255(m$8354);}}(e$8322["length"]=args$8305.length);(e$8322["name"]=["E"].concat(it$0$8312.tags).join("."));return e$8322;}else{$8255($8293$8295);}});($8272$8274.prototype["::check"]=function(e$8391){var it$0$8394;(it$0$8394=this);var self$8399;(self$8399=this);var tags$8404;if(((!e$8391)||(!$6335(Error)(e$8391)))){return false;}(tags$8404=(e$8391["::tags"]||[]));var temp$8413;(temp$8413=it$0$8394.tags);var $length$8418;($length$8418=temp$8413.length);var $index$8423;($index$8423=0);$8405:for(;($index$8423<$length$8418);($index$8423++)){var m$8431;(m$8431=temp$8413[$index$8423]);var tag$8439;(tag$8439=m$8431);if((tags$8404.indexOf(tag$8439)===-1)){return false;}else{false;}}return true;});($8272$8274.prototype["::deconstruct"]=function(e$8447){var it$0$8450;(it$0$8450=this);var self$8455;(self$8455=this);return e$8447.args;});$6351($8272$8274,$6351(function(){var accum$8460;(accum$8460=({}));(accum$8460["::name"]="$8272");return accum$8460;}(),function(){var accum$8464;(accum$8464=({}));(accum$8464["::egclass"]=true);return accum$8464;}()));return $8272$8274;}();
var $8255=function(value$8257,url$8258,start$8259,end$8260){var err$8263;(err$8263=$8271(["match"]).create("Could not find a match for value",({"value":value$8257})));if(url$8258){(err$8263["location"]=["location",url$8258,start$8259,end$8260]);}throw err$8263;};
var $8628=function(type$8630){return function(value$8633){var f$8636;(f$8636=type$8630[":::project"]);if((f$8636===(void 0))){(f$8636=type$8630["::project"]);if((f$8636===(void 0))){return [true,type$8630(value$8633)];}else{var rval$8645;(rval$8645=false);try{(rval$8645=[true,f$8636(value$8633)]);}catch(excv$8654){var e$8660;(e$8660=excv$8654);(rval$8645=[false,null]);}return rval$8645;}}else{return f$8636.call(type$8630,value$8633);}};};
var $8489=function(){var $8490$8492;($8490$8492=function($8495$8498,$8496$8499){var classes$8501;var children$8502;var t0$8504;(t0$8504=$8628(Array)($8495$8498));if(t0$8504[0]){(classes$8501=t0$8504[1]);}else{$8255($8495$8498);}var t0$8512;(t0$8512=$8628(Array)($8496$8499));if(t0$8512[0]){(children$8502=t0$8512[1]);}else{$8255($8496$8499);}var it$0$8520;(it$0$8520=function(){if((!$6335($8490$8492)(this))){return Object.create($8490$8492.prototype);}else{return this;}}());(it$0$8520["classes"]=classes$8501.sort());(it$0$8520["children"]=children$8502);return it$0$8520;});$6351(function(){var accum$8534;(accum$8534=({}));(accum$8534["::check"]=function(x$8538){return ((x$8538&&x$8538.classes)&&x$8538.children);});return accum$8534;}(),$6351(function(){var accum$8541;(accum$8541=({}));(accum$8541["::deconstruct"]=function(x$8545){return [x$8545.classes,x$8545.children];});return accum$8541;}(),$6351(function(){var accum$8548;(accum$8548=({}));(accum$8548["::name"]="$8490");return accum$8548;}(),function(){var accum$8552;(accum$8552=({}));(accum$8552["::egclass"]=true);return accum$8552;}())));($8490$8492.prototype["::check"]=function(n$8558){var it$0$8561;(it$0$8561=this);var self$8566;(self$8566=this);var temp$8575;(temp$8575=it$0$8561.classes);var $length$8580;($length$8580=temp$8575.length);var $index$8585;($index$8585=0);$8571:for(;($index$8585<$length$8580);($index$8585++)){var m$8593;(m$8593=temp$8575[$index$8585]);var c$8601;(c$8601=m$8593);if((n$8558.classes.indexOf(c$8601)===-1)){return false;}else{false;}}return true;});$6351($8490$8492,$6351(function(){var accum$8607;(accum$8607=({}));(accum$8607["::check"]=function(x$8611){return ((x$8611&&x$8611.classes)&&x$8611.children);});return accum$8607;}(),$6351(function(){var accum$8614;(accum$8614=({}));(accum$8614["::deconstruct"]=function(x$8618){return [x$8618.classes,x$8618.children];});return accum$8614;}(),$6351(function(){var accum$8621;(accum$8621=({}));(accum$8621["::name"]="$8490");return accum$8621;}(),function(){var accum$8625;(accum$8625=({}));(accum$8625["::egclass"]=true);return accum$8625;}()))));return $8490$8492;}();
var $8665=function(from$8667,to$8668){var rval$8672;(rval$8672=[]);var i$8677;(i$8677=from$8667);$8671:for(;(i$8677<=to$8668);(i$8677++)){rval$8672.push(i$8677);}return rval$8672;};
var $8684=function(obj$8686){var results$8690;(results$8690=[]);var k$8695;(k$8695=null);$8689:for(k$8695 in obj$8686){if(Object.prototype.hasOwnProperty.call(obj$8686,k$8695)){results$8690.push([k$8695,$6350(obj$8686,k$8695)]);}}return results$8690;};
var $8699=function($8700$8702,key$8703){var ph$8707;(ph$8707=$8700$8702);var $8705$8712;($8705$8712=ph$8707);var bridge$8706$8717;(bridge$8706$8717=$8705$8712);if(((bridge$8706$8717===null)||(bridge$8706$8717===(void 0)))){return false;}else{var x$8728;if((typeof($8705$8712)==="string")){(x$8728=$8705$8712);return (key$8703 in String.prototype);}else{var x$8733;if((typeof($8705$8712)==="number")){(x$8733=$8705$8712);return (key$8703 in Number.prototype);}else{var x$8738;(x$8738=$8705$8712);return (key$8703 in x$8738);}}}};var accum$6562;var accum$6566;var accum$6846;var accum$6850;var $6401$6403;var binsearch$6404;var $6402$6405;var __lt____gt__$6406;var repr$6407;var fs$6408;var Source$6409;var Location$6410;var highlight$6411;var highlight_lines$6412;var clamp$6413;var morsel$6414;var highlight_locations$6415;var highlight_locations_same_source$6416;var merge_locations$6417;var __lt____lt____colon__$6418;var __plus____plus____colon__$6419;var format_error$6420;var display_error$6421;($6401$6403=require("./util"));(binsearch$6404=$6401$6403.binsearch);($6402$6405=require("./pp"));(__lt____gt__$6406=$6402$6405["<>"]);(repr$6407=$6402$6405.repr);(fs$6408=require("fs"));(Source$6409=function(){var $index$6495;var $length$6490;var temp$6485;var curr$6468;var it$0$6462;var text$6454;var url$6455;var t0$6450;var $6443$6445;($6443$6445=arguments);(t0$6450=$6443$6445.length);if(((t0$6450>=1)&&(t0$6450<=2))){(text$6454=$6443$6445[0]);(url$6455=function(){if((1>=t0$6450)){return false;}else{return $6443$6445[1];}}());(it$0$6462=function(){if((!$6335(Source$6409)(this))){return Object.create(Source$6409.prototype);}else{return this;}}());(it$0$6462["text"]=text$6454);(it$0$6462["url"]=url$6455);(it$0$6462["counts"]=[]);(curr$6468=0);(temp$6485=text$6454.split("\n"));($length$6490=temp$6485.length);($index$6495=0);$6469:for(;($index$6495<$length$6490);($index$6495++)){var line$6511;var m$6503;(m$6503=temp$6485[$index$6495]);(line$6511=m$6503);it$0$6462.counts.push(curr$6468);(curr$6468=(curr$6468+(line$6511.length+1)));}it$0$6462.counts.push(curr$6468);(it$0$6462["nlines"]=(it$0$6462.counts.length-1));return it$0$6462;}else{$8255($6443$6445);}});(Source$6409.prototype["linecol"]=function(pos$6523){var line$6536;var col$6537;var self$6531;var it$0$6526;(it$0$6526=this);(self$6531=this);(line$6536=binsearch$6404(it$0$6526.counts,pos$6523));(col$6537=(pos$6523-$6350(it$0$6526.counts,(line$6536-1))));return [line$6536,col$6537];});(Source$6409.prototype["highlight_lines"]=function(l1$6547,l2$6548,spans$6549){var self$6557;var it$0$6552;(it$0$6552=this);(self$6557=this);return highlight_lines$6412(it$0$6552.text,it$0$6552.counts,[(l1$6547-1),(l2$6548-1)],spans$6549);});$6351(Source$6409,$6351(((accum$6562=({})),((accum$6562["::name"]="Source"),accum$6562)),((accum$6566=({})),((accum$6566["::egclass"]=true),accum$6566))));Source$6409;(Location$6410=function(source$6572,start$6573,end$6574){var it$0$6577;(it$0$6577=function(){if((!$6335(Location$6410)(this))){return Object.create(Location$6410.prototype);}else{return this;}}());(it$0$6577["source"]=(source$6572||Source$6409("",null)));(it$0$6577["start"]=start$6573);(it$0$6577["end"]=end$6574);return it$0$6577;});(Location$6410.prototype["text"]=function(){var self$6603;var it$0$6598;(it$0$6598=this);(self$6603=this);return it$0$6598.source.text.slice(it$0$6598.start,it$0$6598.end);});(Location$6410.prototype["linerange"]=function(){var l2$6661;var t0$6652;var t1$6653;var l1$6635;var $6618$6636;var t0$6629;var t1$6630;var t2$6631;var $6617$6624;var self$6619;var it$0$6612;(it$0$6612=this);(self$6619=this);($6617$6624=it$0$6612.linecol());if((($6617$6624 instanceof Array)&&(((t0$6629=$6617$6624.length)),((t0$6629===2)&&(((t1$6630=$6617$6624[0])),((t1$6630 instanceof Array)&&(((t2$6631=t1$6630.length)),(t2$6631===2)))))))){(l1$6635=t1$6630[0]);t1$6630[1];($6618$6636=$6617$6624[1]);if(($6618$6636===null)){return [l1$6635,l1$6635];}else{(t0$6652=$6618$6636);if(((t0$6652 instanceof Array)&&(((t1$6653=t0$6652.length)),(t1$6653===2)))){(l2$6661=t0$6652[0]);t0$6652[1];return [l1$6635,l2$6661];}else{$8255($6618$6636,"/home/olivier/git/earl-grey/src/location.eg",968,973);}}}else{$8255($6617$6624);}});(Location$6410.prototype["linecol"]=function(){var start$6690;var end$6691;var self$6685;var it$0$6680;(it$0$6680=this);(self$6685=this);(start$6690=it$0$6680.source.linecol(it$0$6680.start));(end$6691=function(){if((it$0$6680.start===it$0$6680.end)){return null;}else{return it$0$6680.source.linecol((it$0$6680.end-1));}}());return [start$6690,end$6691];});(Location$6410.prototype["ref"]=function(){var otherwise$6806;var $6787$6795;var $6786$6789;var l2$6766;var c2$6767;var t0$6755;var t1$6756;var t2$6757;var t3$6758;var l1$6728;var c1$6729;var $6709$6730;var t0$6720;var t1$6721;var t2$6722;var t3$6723;var t4$6724;var $6708$6715;var self$6710;var it$0$6703;(it$0$6703=this);(self$6710=this);($6708$6715=it$0$6703.linecol());if((($6708$6715 instanceof Array)&&(((t0$6720=$6708$6715.length)),((t0$6720===2)&&(((t1$6721=$6708$6715[0])),((t1$6721 instanceof Array)&&(((t2$6722=t1$6721.length)),((t2$6722===2)&&(((t3$6723=[true,String(t1$6721[0])])),(t3$6723[0]&&((l1$6728=t3$6723[1]),(((t4$6724=[true,String(t1$6721[1])])),t4$6724[0])))))))))))){(c1$6729=t4$6724[1]);($6709$6730=$6708$6715[1]);if(($6709$6730===null)){return ((l1$6728+":")+c1$6729);}else{(t0$6755=$6709$6730);if(((t0$6755 instanceof Array)&&(((t1$6756=t0$6755.length)),((t1$6756===2)&&(((t2$6757=[true,String(t0$6755[0])])),(t2$6757[0]&&((l2$6766=t2$6757[1]),(((t3$6758=[true,String(t0$6755[1])])),t3$6758[0])))))))){(c2$6767=t3$6758[1]);($6786$6789=null);$6786$6789;if(((l1$6728===l2$6766)&&(c1$6729===c2$6767))){return ((l1$6728+":")+c1$6729);}else{if((l1$6728===l2$6766)){return ((((l1$6728+":")+c1$6729)+"-")+c2$6767);}else{(otherwise$6806=$6786$6789);return ((((((l1$6728+":")+c1$6729)+"-")+l1$6728)+":")+c2$6767);}}}else{$8255($6709$6730,"/home/olivier/git/earl-grey/src/location.eg",1310,1315);}}}else{$8255($6708$6715);}});(Location$6410.prototype["highlight"]=function(){var self$6839;var it$0$6834;var cls$6826;var context$6827;var t0$6822;var $6815$6817;($6815$6817=arguments);(t0$6822=$6815$6817.length);if(((t0$6822>=0)&&(t0$6822<=2))){(cls$6826=function(){if((0>=t0$6822)){return "hl1";}else{return $6815$6817[0];}}());(context$6827=function(){if((1>=t0$6822)){return 0;}else{return $6815$6817[1];}}());(it$0$6834=this);(self$6839=this);return highlight_locations$6415([[it$0$6834,cls$6826]],context$6827);}else{$8255($6815$6817);}});$6351(Location$6410,$6351(((accum$6846=({})),((accum$6846["::name"]="Location"),accum$6846)),((accum$6850=({})),((accum$6850["::egclass"]=true),accum$6850))));Location$6410;(highlight$6411=function(){var $index$6893;var $length$6888;var temp$6883;var acc$6878;var text$6867;var spans$6868;var offset$6869;var t0$6863;var $6856$6858;($6856$6858=arguments);(t0$6863=$6856$6858.length);if(((t0$6863>=2)&&(t0$6863<=3))){(text$6867=$6856$6858[0]);(spans$6868=$6856$6858[1]);(offset$6869=function(){if((2>=t0$6863)){return 0;}else{return $6856$6858[2];}}());return $8489([],(((acc$6878=[])),(((temp$6883=morsel$6414(spans$6868))),((($length$6888=temp$6883.length)),((($index$6893=0)),function(){$6875:for(;($index$6893<$length$6888);($index$6893++)){var xstart$6925;var xend$6926;var start$6911;var end$6912;var attributes$6913;var t0$6906;var t1$6907;var m$6901;(m$6901=temp$6883[$index$6893]);(t0$6906=m$6901);if(((t0$6906 instanceof Array)&&(((t1$6907=t0$6906.length)),(t1$6907===3)))){(start$6911=t0$6906[0]);(end$6912=t0$6906[1]);(attributes$6913=t0$6906[2]);acc$6878.push((((xstart$6925=Math.max((start$6911-offset$6869),0))),((xend$6926=Math.min((end$6912-offset$6869),text$6867.length))),$8489(attributes$6913.slice(0,1),[text$6867.slice(xstart$6925,xend$6926)])));}else{$8255(m$6901,"/home/olivier/git/earl-grey/src/location.eg",1857,2069);}}}()))),acc$6878));}else{$8255($6856$6858);}});(highlight_lines$6412=function(text$6942,linelocs$6943,$6940$6944,spans$6945){var t0$6950;var t1$6951;var $index$6980;var $length$6975;var temp$6970;var acc$6965;var l1$6947;var l2$6948;(t0$6950=$6940$6944);if(((t0$6950 instanceof Array)&&(((t1$6951=t0$6950.length)),(t1$6951===2)))){(l1$6947=t0$6950[0]);(l2$6948=t0$6950[1]);}else{$8255($6940$6944);}return $8489(["+span"],(((acc$6965=[])),(((temp$6970=$8665(l1$6947,l2$6948))),((($length$6975=temp$6970.length)),((($index$6980=0)),function(){$6962:for(;($index$6980<$length$6975);($index$6980++)){var start$7000;var end$7001;var lineno$6996;var m$6988;(m$6988=temp$6970[$index$6980]);(lineno$6996=m$6988);acc$6965.push((((start$7000=$6350(linelocs$6943,lineno$6996))),((end$7001=$6350(linelocs$6943,(lineno$6996+1)))),$8489(["+span"],[$8489(["lineno"],(lineno$6996+1)),$8489(["source"],highlight$6411(text$6942,[[start$7000,end$7001,[]]].concat(clamp$6413(spans$6945,start$7000,end$7001))))])));}}()))),acc$6965));});(clamp$6413=function(spans$7012,bot$7013,top$7014){var $index$7034;var $length$7029;var temp$7024;var acc$7019;(acc$7019=[]);(temp$7024=spans$7012);($length$7029=temp$7024.length);($index$7034=0);$7016:for(;($index$7034<$length$7029);($index$7034++)){var start$7052;var end$7053;var attr$7054;var t0$7047;var t1$7048;var m$7042;(m$7042=temp$7024[$index$7034]);(t0$7047=m$7042);if(((t0$7047 instanceof Array)&&(((t1$7048=t0$7047.length)),((t1$7048===3)&&((start$7052=t0$7047[0]),((end$7053=t0$7047[1]),((attr$7054=t0$7047[2]),((end$7053>=bot$7013)&&(start$7052<=top$7014))))))))){acc$7019.push([Math.max(start$7052,bot$7013),Math.min(end$7053,top$7014),attr$7054]);}else{false;}}return acc$7019;});(morsel$6414=function(spans$7073){var jump$7076;var jumptill$7077;var process_elements$7078;var thespans$7079;(jump$7076=function(active$7083,bot$7084,top$7085){var $index$7113;var $length$7108;var temp$7103;var acc$7098;var $index$7160;var $length$7155;var temp$7150;var e$7088;var attributes$7089;(e$7088=$6350(Math.min,[top$7085].concat((((acc$7098=[])),(((temp$7103=active$7083)),((($length$7108=temp$7103.length)),((($index$7113=0)),function(){$7095:for(;($index$7113<$length$7108);($index$7113++)){var x$7131;var t0$7126;var t1$7127;var m$7121;(m$7121=temp$7103[$index$7113]);(t0$7126=m$7121);if(((t0$7126 instanceof Array)&&(((t1$7127=t0$7126.length)),(t1$7127===3)))){t0$7126[0];(x$7131=t0$7126[1]);t0$7126[2];acc$7098.push(x$7131);}else{$8255(m$7121,"/home/olivier/git/earl-grey/src/location.eg",3392,3435);}}}()))),acc$7098))));(attributes$7089=[]);(temp$7150=active$7083);($length$7155=temp$7150.length);($index$7160=0);$7090:for(;($index$7160<$length$7155);($index$7160++)){var X$7178;var t0$7173;var t1$7174;var m$7168;(m$7168=temp$7150[$index$7160]);(t0$7173=m$7168);if(((t0$7173 instanceof Array)&&(((t1$7174=t0$7173.length)),(t1$7174===3)))){t0$7173[0];t0$7173[1];(X$7178=t0$7173[2]);(attributes$7089=attributes$7089.concat(X$7178));}else{$8255(m$7168,"/home/olivier/git/earl-grey/src/location.eg",3457,3498);}}return [e$7088,[bot$7084,e$7088,attributes$7089]];});(jumptill$7077=function(active$7194,bot$7195,top$7196){var t0$7205;var t1$7206;var $index$7237;var $length$7232;var temp$7227;var acc$7222;var t0$7274;var t1$7275;var newbot$7199;var span$7200;var newactive$7201;var spans$7202;var remainder$7203;if((bot$7195===top$7196)){return [[],active$7194];}else{(t0$7205=jump$7076(active$7194,bot$7195,top$7196));if(((t0$7205 instanceof Array)&&(((t1$7206=t0$7205.length)),(t1$7206===2)))){(newbot$7199=t0$7205[0]);(span$7200=t0$7205[1]);}else{$8255(jump$7076(active$7194,bot$7195,top$7196),"/home/olivier/git/earl-grey/src/location.eg",3734,3768);}(newactive$7201=(((acc$7222=[])),(((temp$7227=active$7194)),((($length$7232=temp$7227.length)),((($index$7237=0)),function(){$7219:for(;($index$7237<$length$7232);($index$7237++)){var x$7255;var e$7256;var attr$7257;var t0$7250;var t1$7251;var m$7245;(m$7245=temp$7227[$index$7237]);(t0$7250=m$7245);(x$7255=t0$7250);if(((t0$7250 instanceof Array)&&(((t1$7251=t0$7250.length)),((t1$7251===3)&&(t0$7250[0],((e$7256=t0$7250[1]),((attr$7257=t0$7250[2]),(e$7256>newbot$7199)))))))){acc$7222.push(x$7255);}else{false;}}}()))),acc$7222));(t0$7274=jumptill$7077(newactive$7201,newbot$7199,top$7196));if(((t0$7274 instanceof Array)&&(((t1$7275=t0$7274.length)),(t1$7275===2)))){(spans$7202=t0$7274[0]);(remainder$7203=t0$7274[1]);}else{$8255(jumptill$7077(newactive$7201,newbot$7199,top$7196),"/home/olivier/git/earl-grey/src/location.eg",3883,3927);}return [[span$7200].concat(spans$7202),remainder$7203];}});(process_elements$7078=function(start$7290,active$7291,rem$7292){var $index$7378;var $length$7373;var temp$7368;var acc$7363;var t0$7414;var t1$7415;var top$7355;var bot$7356;var spans$7357;var t0$7460;var t1$7461;var spans$7457;var newactive$7458;var start$7428;var active$7429;var next$7430;var target$7431;var end$7432;var attr$7433;var rest$7434;var start$7340;var active$7341;var $7295$7310;var $7296$7311;var $7297$7312;var t0$7304;var t1$7305;var t2$7306;var t3$7307;var t4$7308;var $7294$7299;($7294$7299=[start$7290,active$7291,rem$7292]);if((($7295$7310=($7294$7299 instanceof Array))&&(((t0$7304=$7294$7299.length)),(($7297$7312=(t0$7304===3))&&($7294$7299[0],(((t1$7305=$7294$7299[1])),((t1$7305 instanceof Array)&&(((t2$7306=t1$7305.length)),((t2$7306===0)&&(((t3$7307=$7294$7299[2])),((t3$7307 instanceof Array)&&(((t4$7308=t3$7307.length)),(t4$7308===0))))))))))))){return [];}else{if(($7297$7312&&((start$7340=$7294$7299[0]),((active$7341=$7294$7299[1]),(((t1$7305=$7294$7299[2])),((t1$7305 instanceof Array)&&(((t2$7306=t1$7305.length)),(t2$7306===0)))))))){(top$7355=$6350(Math.max,(((acc$7363=[])),(((temp$7368=active$7341)),((($length$7373=temp$7368.length)),((($index$7378=0)),function(){$7360:for(;($index$7378<$length$7373);($index$7378++)){var e$7396;var t0$7391;var t1$7392;var m$7386;(m$7386=temp$7368[$index$7378]);(t0$7391=m$7386);if(((t0$7391 instanceof Array)&&(((t1$7392=t0$7391.length)),(t1$7392===3)))){t0$7391[0];(e$7396=t0$7391[1]);t0$7391[2];acc$7363.push(e$7396);}else{$8255(m$7386,"/home/olivier/git/earl-grey/src/location.eg",4112,4150);}}}()))),acc$7363)));(bot$7356=Math.min(start$7340,top$7355));(t0$7414=jumptill$7077(active$7341,start$7340,top$7355));if(((t0$7414 instanceof Array)&&(((t1$7415=t0$7414.length)),(t1$7415===2)))){(spans$7357=t0$7414[0]);t0$7414[1];}else{$8255(jumptill$7077(active$7341,start$7340,top$7355),"/home/olivier/git/earl-grey/src/location.eg",4203,4241);}return spans$7357;}else{if(($7297$7312&&((start$7428=$7294$7299[0]),((active$7429=$7294$7299[1]),(((t1$7305=$7294$7299[2])),((t1$7305 instanceof Array)&&(((t2$7306=t1$7305.length)),((t2$7306>=1)&&(((t3$7307=t1$7305[0])),((next$7430=t3$7307),((t3$7307 instanceof Array)&&(((t4$7308=t3$7307.length)),(t4$7308===3))))))))))))){(target$7431=t3$7307[0]);(end$7432=t3$7307[1]);(attr$7433=t3$7307[2]);(rest$7434=Array.prototype.slice.call(t1$7305,1));(t0$7460=jumptill$7077(active$7429,start$7428,target$7431));if(((t0$7460 instanceof Array)&&(((t1$7461=t0$7460.length)),(t1$7461===2)))){(spans$7457=t0$7460[0]);(newactive$7458=t0$7460[1]);}else{$8255(jumptill$7077(active$7429,start$7428,target$7431),"/home/olivier/git/earl-grey/src/location.eg",4345,4386);}return spans$7457.concat(process_elements$7078(target$7431,[next$7430].concat(newactive$7458),rest$7434));}else{$8255($7294$7299);}}}});(thespans$7079=spans$7073.sort(function($7477$7480,$7478$7481){var t0$7488;var t1$7489;var t0$7501;var t1$7502;var s1$7483;var e1$7484;var s2$7485;var e2$7486;(t0$7488=$7477$7480);if(((t0$7488 instanceof Array)&&(((t1$7489=t0$7488.length)),(t1$7489===3)))){(s1$7483=t0$7488[0]);(e1$7484=t0$7488[1]);t0$7488[2];}else{$8255($7477$7480);}(t0$7501=$7478$7481);if(((t0$7501 instanceof Array)&&(((t1$7502=t0$7501.length)),(t1$7502===3)))){(s2$7485=t0$7501[0]);(e2$7486=t0$7501[1]);t0$7501[2];}else{$8255($7478$7481);}if((s1$7483===s2$7485)){return (e1$7484-e2$7486);}else{return (s1$7483-s2$7485);}}));return process_elements$7078(thespans$7079[0][0],[],thespans$7079);});(highlight_locations$6415=function(){var $index$7555;var $length$7550;var temp$7545;var $index$7613;var $length$7608;var temp$7603;var acc$7598;var srcs$7537;var locations$7529;var context$7530;var t0$7525;var $7518$7520;($7518$7520=arguments);(t0$7525=$7518$7520.length);if(((t0$7525>=1)&&(t0$7525<=2))){(locations$7529=$7518$7520[0]);(context$7530=function(){if((1>=t0$7525)){return 0;}else{return $7518$7520[1];}}());(srcs$7537=({}));(temp$7545=locations$7529);($length$7550=temp$7545.length);($index$7555=0);$7538:for(;($index$7555<$length$7550);($index$7555++)){var key$7585;var loc$7573;var cls$7574;var t0$7568;var t1$7569;var m$7563;(m$7563=temp$7545[$index$7555]);(t0$7568=m$7563);if(((t0$7568 instanceof Array)&&(((t1$7569=t0$7568.length)),(t1$7569===2)))){(loc$7573=t0$7568[0]);(cls$7574=t0$7568[1]);(key$7585=String((loc$7573.source&&loc$7573.source.url)));if((!$6350(srcs$7537,key$7585))){(srcs$7537[key$7585]=[]);}$6350(srcs$7537,key$7585).push([loc$7573,cls$7574]);}else{$8255(m$7563,"/home/olivier/git/earl-grey/src/location.eg",4732,4901);}}return $8489(["+div"],(((acc$7598=[])),(((temp$7603=$8684(srcs$7537))),((($length$7608=temp$7603.length)),((($index$7613=0)),function(){$7595:for(;($index$7613<$length$7608);($index$7613++)){var locs$7631;var t0$7626;var t1$7627;var m$7621;(m$7621=temp$7603[$index$7613]);(t0$7626=m$7621);if(((t0$7626 instanceof Array)&&(((t1$7627=t0$7626.length)),(t1$7627===2)))){t0$7626[0];(locs$7631=t0$7626[1]);acc$7598.push(highlight_locations_same_source$6416(locs$7631,context$7530));}else{$8255(m$7621,"/home/olivier/git/earl-grey/src/location.eg",4906,5000);}}}()))),acc$7598));}else{$8255($7518$7520);}});(highlight_locations_same_source$6416=function(){var $index$7695;var $length$7690;var temp$7685;var acc$7680;var t0$7732;var t1$7733;var $index$7768;var $length$7763;var temp$7758;var acc$7753;var $index$7818;var $length$7813;var temp$7808;var acc$7803;var loc$7669;var src$7670;var l1$7671;var l2$7672;var first$7673;var last$7674;var locations$7661;var context$7662;var t0$7657;var $7650$7652;($7650$7652=arguments);(t0$7657=$7650$7652.length);if(((t0$7657>=1)&&(t0$7657<=2))){(locations$7661=$7650$7652[0]);(context$7662=function(){if((1>=t0$7657)){return 0;}else{return $7650$7652[1];}}());(loc$7669=merge_locations$6417((((acc$7680=[])),(((temp$7685=locations$7661)),((($length$7690=temp$7685.length)),((($index$7695=0)),function(){$7677:for(;($index$7695<$length$7690);($index$7695++)){var x$7713;var cls$7714;var t0$7708;var t1$7709;var m$7703;(m$7703=temp$7685[$index$7695]);(t0$7708=m$7703);if(((t0$7708 instanceof Array)&&(((t1$7709=t0$7708.length)),(t1$7709===2)))){(x$7713=t0$7708[0]);(cls$7714=t0$7708[1]);acc$7680.push(x$7713);}else{$8255(m$7703,"/home/olivier/git/earl-grey/src/location.eg",5083,5111);}}}()))),acc$7680)));(src$7670=loc$7669.source);(t0$7732=loc$7669.linerange());if(((t0$7732 instanceof Array)&&(((t1$7733=t0$7732.length)),(t1$7733===2)))){(l1$7671=t0$7732[0]);(l2$7672=t0$7732[1]);}else{$8255(loc$7669.linerange(),"/home/olivier/git/earl-grey/src/location.eg",5147,5166);}(first$7673=Math.max(1,(l1$7671-context$7662)));(last$7674=Math.min(src$7670.nlines,(l2$7672+context$7662)));return $8489(["+div","location"],[$8489(["+div","source"],[$8489(["sourcefile"],(src$7670.url||"???")),(((acc$7753=[])),(((temp$7758=locations$7661)),((($length$7763=temp$7758.length)),((($index$7768=0)),function(){$7750:for(;($index$7768<$length$7763);($index$7768++)){var loc$7786;var cls$7787;var t0$7781;var t1$7782;var m$7776;(m$7776=temp$7758[$index$7768]);(t0$7781=m$7776);if(((t0$7781 instanceof Array)&&(((t1$7782=t0$7781.length)),(t1$7782===2)))){(loc$7786=t0$7781[0]);(cls$7787=t0$7781[1]);acc$7753.push($8489([cls$7787,"sourcepos"],loc$7786.ref()));}else{$8255(m$7776,"/home/olivier/git/earl-grey/src/location.eg",5331,5401);}}}()))),acc$7753)]),src$7670.highlight_lines(first$7673,last$7674,(((acc$7803=[])),(((temp$7808=locations$7661)),((($length$7813=temp$7808.length)),((($index$7818=0)),function(){$7800:for(;($index$7818<$length$7813);($index$7818++)){var loc$7836;var cls$7837;var t0$7831;var t1$7832;var m$7826;(m$7826=temp$7808[$index$7818]);(t0$7831=m$7826);if(((t0$7831 instanceof Array)&&(((t1$7832=t0$7831.length)),(t1$7832===2)))){(loc$7836=t0$7831[0]);(cls$7837=t0$7831[1]);acc$7803.push([loc$7836.start,loc$7836.end,[cls$7837]]);}else{$8255(m$7826,"/home/olivier/git/earl-grey/src/location.eg",5456,5514);}}}()))),acc$7803))]);}else{$8255($7650$7652);}});(merge_locations$6417=function($7855$7857){var $index$7917;var $length$7912;var temp$7907;var acc$7902;var $index$7957;var $length$7952;var temp$7947;var acc$7942;var start$7895;var end$7896;var locs$7891;var loc$7886;var $7860$7874;var $7861$7875;var t0$7872;var $7859$7867;var ph$7862;(ph$7862=$7855$7857);($7859$7867=ph$7862);if((($7860$7874=($7859$7867 instanceof Array))&&(((t0$7872=$7859$7867.length)),(t0$7872===0)))){return Location$6410(null,0,0);}else{if(($7860$7874&&(t0$7872===1))){(loc$7886=$7859$7867[0]);return loc$7886;}else{if(($7860$7874&&(t0$7872>=0))){(locs$7891=Array.prototype.slice.call($7859$7867,0));(start$7895=$6350(Math.min,(((acc$7902=[])),(((temp$7907=locs$7891)),((($length$7912=temp$7907.length)),((($index$7917=0)),function(){$7899:for(;($index$7917<$length$7912);($index$7917++)){var loc$7933;var m$7925;(m$7925=temp$7907[$index$7917]);(loc$7933=m$7925);acc$7902.push(loc$7933.start);}}()))),acc$7902)));(end$7896=$6350(Math.max,(((acc$7942=[])),(((temp$7947=locs$7891)),((($length$7952=temp$7947.length)),((($index$7957=0)),function(){$7939:for(;($index$7957<$length$7952);($index$7957++)){var loc$7973;var m$7965;(m$7965=temp$7947[$index$7957]);(loc$7973=m$7965);acc$7942.push(loc$7973.end);}}()))),acc$7942)));return Location$6410(locs$7891[0].source,start$7895,end$7896);}else{$8255($7859$7867);}}}});(__lt____lt____colon__$6418=function(x$7983,y$7984){if((!$6335(Location$6410)(x$7983.location))){(x$7983["location"]=function(){if(((!y$7984)||$6335(Location$6410)(y$7984))){return y$7984;}else{return y$7984.location;}}());}return x$7983;});(__plus____plus____colon__$6419=function(x$7995,y$7996){var rval$8008;var x2$7999;var y2$8000;(x2$7999=function(){if(((!x$7995)||$6335(Location$6410)(x$7995))){return x$7995;}else{return x$7995.location;}}());(y2$8000=function(){if(((!y$7996)||$6335(Location$6410)(y$7996))){return y$7996;}else{return y$7996.location;}}());(rval$8008=false);try{(rval$8008=merge_locations$6417([x2$7999,y2$8000]));}catch(excv$8017){var e$8023;(e$8023=excv$8017);(rval$8008=(void 0));}return rval$8008;});(format_error$6420=function(){var $index$8117;var $length$8112;var temp$8107;var acc$8102;var hls$8092;var locs$8093;var rval$8188;var loc$8210;var data$8184;var other$8216;var url$8174;var start$8175;var end$8176;var loc$8165;var args$8077;var fmt_args$8068;var $8034$8064;var $8035$8065;var $8036$8066;var t0$8060;var t1$8061;var t2$8062;var e$8048;var context$8049;var $8033$8050;var t0$8043;var t1$8044;var $8032$8038;($8032$8038=arguments);(t0$8043=$8032$8038.length);if(((t0$8043>=1)&&(t0$8043<=2))){(t1$8044=$8032$8038[0]);(e$8048=t1$8044);($8033$8050=t1$8044);(context$8049=function(){if((1>=t0$8043)){return 0;}else{return $8032$8038[1];}}());(fmt_args$8068=function(e$8072){if((e$8072.args&&e$8072.args.length)){return $8489(["error_args"],repr$6407(e$8072.args));}else{return "";}});(t0$8060=$8033$8050);if(($6335($8271(["syntax"]))(t0$8060)&&($8699(t0$8060,"args")&&(((t1$8061=t0$8060.args)),((t1$8061 instanceof Array)&&(((t2$8062=t1$8061.length)),(t2$8062===1))))))){(args$8077=t1$8061[0]);(hls$8092=["hl1","hl2","hl3","hl4"]);(locs$8093=(((acc$8102=[])),(((temp$8107=$8467($8684(args$8077)))),((($length$8112=temp$8107.length)),((($index$8117=0)),function(){$8099:for(;($index$8117<$length$8112);($index$8117++)){var i$8137;var key$8138;var arg$8139;var t0$8130;var t1$8131;var t2$8132;var t3$8133;var m$8125;(m$8125=temp$8107[$index$8117]);(t0$8130=m$8125);if(((t0$8130 instanceof Array)&&(((t1$8131=t0$8130.length)),((t1$8131===2)&&((i$8137=t0$8130[0]),(((t2$8132=t0$8130[1])),((t2$8132 instanceof Array)&&(((t3$8133=t2$8132.length)),((t3$8133===2)&&((key$8138=t2$8132[0]),((arg$8139=t2$8132[1]),(arg$8139&&arg$8139.location)))))))))))){acc$8102.push([arg$8139.location,$6350(hls$8092,(i$8137%4))]);}else{false;}}}()))),acc$8102));return $8489(["+div"],[$8489(["error"],[$8489(["error_type"],e$8048.name),$8489(["error_message"],e$8048.message)]),$8489(["error_args","syntax"],repr$6407(args$8077)),highlight_locations$6415(locs$8093,context$8049)]);}else{if((($8035$8065=$8699(t0$8060,"location"))&&(((t1$8061=t0$8060.location)),$6335(Location$6410)(t1$8061)))){(loc$8165=t1$8061);return $8489(["+div"],[$8489(["error"],[$8489(["error_type"],e$8048.name),$8489(["error_message"],e$8048.message)]),fmt_args$8068(e$8048),highlight_locations$6415([[loc$8165,"hl1"]],context$8049),$8489(["traceback"],(e$8048.stack||""))]);}else{if(($8035$8065&&((t1$8061 instanceof Array)&&(((t2$8062=t1$8061.length)),((t2$8062===4)&&(t1$8061[0]==="location")))))){(url$8174=t1$8061[1]);(start$8175=t1$8061[2]);(end$8176=t1$8061[3]);(data$8184=(((rval$8188=false)),(function(){try{(rval$8188=fs$6408.readFileSync(url$8174,"utf8"));}catch(excv$8197){var e$8203;(e$8203=excv$8197);(rval$8188=null);}}(),rval$8188)));if(data$8184){(loc$8210=Location$6410(Source$6409(data$8184,url$8174),start$8175,end$8176));return $8489(["+div"],[$8489(["error"],[$8489(["error_type"],e$8048.name),$8489(["error_message"],e$8048.message)]),fmt_args$8068(e$8048),highlight_locations$6415([[loc$8210,"hl1"]],context$8049),$8489(["traceback"],($8489([],e$8048.stack)||""))]);}else{return $8489(["+div"],[$8489(["error"],[$8489(["error_type"],e$8048.name),$8489(["error_message"],e$8048.message)]),fmt_args$8068(e$8048),$8489(["traceback"],($8489([],e$8048.stack)||e$8048))]);}}else{(other$8216=$8033$8050);return $8489(["+div"],[$8489(["error"],[$8489(["error_type"],e$8048.name),$8489(["error_message"],e$8048.message)]),fmt_args$8068(e$8048),$8489(["traceback"],$8489([],e$8048.stack))]);}}}}else{$8255($8032$8038);}});(display_error$6421=function(e$8224){return __lt____gt__$6406(null,format_error$6420(e$8224));});(exports["Source"]=Source$6409);(exports["Location"]=Location$6410);(exports["highlight"]=highlight$6411);(exports["highlight_locations"]=highlight_locations$6415);(exports["merge_locations"]=merge_locations$6417);(exports["<<:"]=__lt____lt____colon__$6418);(exports["++:"]=__plus____plus____colon__$6419);(exports["format_error"]=format_error$6420);(exports["display_error"]=display_error$6421);
