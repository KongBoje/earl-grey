var τ195=function(type){var τ196=type["::check"];var f;if((τ196===(void 0))){return function(value){return (value instanceof type);};}else{if(((f=τ196),true)){return function(value){return f.call(type,value);};}else{throw ["Could not find a match",τ196];}}};
var τ197=function(){var r=[];for(var i=0;(i<arguments.length);(i++)){(r=r.concat(arguments[i]));}return r;};
var τ198=function(τ199){var τ200=τ199;var x;var x;var other;if((((typeof(τ200)==="string")&&((x=τ200),true))||((typeof(τ200)==="number")&&((x=τ200),true)))){return ["value",x];}else{if(((other=τ200),true)){return other["::serialize_ast"]();}else{throw ["Could not find a match",τ200];}}};
var send=function(obj,τ188){var msg;var τ187;(msg=τ188);true;(τ187=τ188);var τ189=τ187;var other;if(((typeof(τ189)==="string")||(typeof(τ189)==="number"))){return obj[msg];}else{if(((other=τ189),true)){return obj["::send"](msg);}else{throw ["Could not find a match",τ189];}}};(Array[":::project"]=function(τ191){var value;var τ190;(value=τ191);true;(τ190=τ191);var τ192=τ190;var _;if(τ195(Array)(τ192)){return [true,value];}else{if(((_=τ192),true)){return [true,[value]];}else{throw ["Could not find a match",τ192];}}});(Array.prototype["::check"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){return false;}else{null;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){var rval=this.slice(0);rval.push(value);return [true,rval];}else{null;}}return [true,value];}else{var rval=this.slice(0);rval.push(value);return [true,rval];}});(Array.prototype[":::deconstruct"]=function(value){return [true,value.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return τ197(["array"],this.map(τ198));});(RegExp.prototype["::check"]=function(value){return value.match(this);});(RegExp.prototype[":::project"]=function(value){var τ193=value.match(this);var m;var m;if(((τ193===null)&&((m=τ193),true))){return [false,null];}else{if(((m=τ193),true)){return [true,m];}else{throw ["Could not find a match",τ193];}}});(RegExp.prototype[":::deconstruct"]=function(value){var τ194=value.match(this);var m;var m;if(((τ194===null)&&((m=τ194),true))){return [false,null];}else{if(((m=τ194),true)){return [true,m];}else{throw ["Could not find a match",τ194];}}});(Function.prototype["::send"]=function(args){return this.apply(this,args);});
var τ315=function(dest,values){for(k in values){if(values.hasOwnProperty(k)){(dest[k]=send(values,k));}else{null;}}return dest;};
var τ316=function(){var τ317=function(tags){var τ318=function(){if((!τ195(τ317)(this))){return Object.create(τ317.prototype);}else{return this;}}();(τ318["tags"]=tags);return τ318;};τ315(τ317);(τ317.prototype["create"]=function(){var τ319=Array.prototype.slice.call(arguments,0);var τp0;var message;var args;if(((τ319 instanceof Array)&&(((τp0=τ319.length),true)&&((τp0>=0)&&((message=function(){if((0>=τp0)){return "";}else{return τ319[0];}}()),true,(args=τ319.slice(1)),true))))){var τ318=this;var e=Error(message);(e["::tags"]=τ318.tags);(e["args"]=args);(e["name"]=["E"].concat(τ318.tags).join("."));return e;}else{throw ["Could not find a match",τ319];}});(τ317.prototype["::check"]=function(e){var τ318=this;if(((!e)||(!τ195(Error)(e)))){return false;}else{null;}var tags=(e["::tags"]||[]);var τ320=τ318.tags;var τ321=τ320.length;for(var τ322=0;(τ322<τ321);(τ322++)){var τ323=τ320[τ322];var tag;var other;if(((tag=τ323),true,(tags.indexOf(tag)===(-1)))){return false;}else{if(((other=τ323),true)){false;}else{throw ["Could not find a match",τ323];}}}false;return true;});(τ317.prototype["::deconstruct"]=function(e){var τ318=this;return e.args;});return τ317;}();
var τ324=function(from,to){var rval=[];for(var i=from;(i<=to);(i++)){rval.push(i);}return rval;};
var τ325=function(type){return function(value){var τ326=type[":::deconstruct"];var f;if((τ326===(void 0))){var τ327=type["::deconstruct"];var f;if((τ327===(void 0))){if((value instanceof Array)){return [true,value];}else{if(true){return [false,null];}else{return false;}}}else{if(((f=τ327),true)){var τ329;try{(τ329=[true,f.call(type,value)]);}catch(τ328){(τ329=[false,null]);}return τ329;}else{throw ["Could not find a match",τ327];}}}else{if(((f=τ326),true)){return f.call(type,value);}else{throw ["Could not find a match",τ326];}}};};
var τ330=function(τ331,key){var τ332=τ331;var x;var x;var x;if(((τ332===null)||(τ332===(void 0)))){return false;}else{if(((typeof(τ332)==="string")&&((x=τ332),true))){return (key in String.prototype);}else{if(((typeof(τ332)==="number")&&((x=τ332),true))){return (key in Number.prototype);}else{if(((x=τ332),true)){return (key in x);}else{throw ["Could not find a match",τ332];}}}}};var τ201=require("./util");var binsearch=τ201.binsearch;var items=τ201.items;var enumerate=τ201.enumerate;var τ202=require("./pp");var Node=τ202.Node;var __lt____gt__=τ202["<>"];var repr=τ202.repr;var fs=require("fs");var Source=function(){var τ204=Array.prototype.slice.call(arguments,0);var τp0;var text;var url;if(((τ204 instanceof Array)&&(((τp0=τ204.length),true)&&(((τp0>=1)&&(τp0<=2))&&((text=τ204[0]),true,(url=function(){if((1>=τp0)){return false;}else{return τ204[1];}}()),true))))){var τ203=function(){if((!τ195(Source)(this))){return Object.create(Source.prototype);}else{return this;}}();(τ203["text"]=text);(τ203["url"]=url);(τ203["counts"]=[]);var curr=0;var τ205=text.split("\n");var τ206=τ205.length;for(var τ207=0;(τ207<τ206);(τ207++)){var τ208=τ205[τ207];var line;var other;if(((line=τ208),true)){τ203.counts.push(curr);(curr=(curr+(line.length+1)));}else{if(((other=τ208),true)){false;}else{throw ["Could not find a match",τ208];}}}false;τ203.counts.push(curr);(τ203["nlines"]=(τ203.counts.length-1));return τ203;}else{throw ["Could not find a match",τ204];}};τ315(Source);(Source.prototype["linecol"]=function(pos){var τ203=this;var line=binsearch(τ203.counts,pos);var col=(pos-send(τ203.counts,(line-1)));return [line,col];});(Source.prototype["highlight_lines"]=function(l1,l2,spans){var τ203=this;return highlight_lines(τ203.text,τ203.counts,[(l1-1),(l2-1)],spans);});Source;var Location=function(source,start,end){var τ209=function(){if((!τ195(Location)(this))){return Object.create(Location.prototype);}else{return this;}}();(τ209["source"]=(source||Source("",null)));(τ209["start"]=start);(τ209["end"]=end);return τ209;};τ315(Location);(Location.prototype["text"]=function(){var τ209=this;return τ209.source.text.slice(τ209.start,τ209.end);});(Location.prototype["linerange"]=function(){var τ209=this;var τ210=τ209.linecol();var τp0;var τp1;var τp2;var l1;var _;var τ211;if(((τ210 instanceof Array)&&(((τp0=τ210.length),true)&&((τp0===2)&&(((τp1=τ210[0]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===2)&&((l1=τp1[0]),true,(_=τp1[1]),true,(τ211=τ210[1]),true)))))))){var τ212=τ211;var τp0;var l2;var _;if((τ212===null)){return [l1,l1];}else{if(((τ212 instanceof Array)&&(((τp0=τ212.length),true)&&((τp0===2)&&((l2=τ212[0]),true,(_=τ212[1]),true))))){return [l1,l2];}else{throw ["Could not find a match",τ212];}}}else{throw ["Could not find a match",τ210];}});(Location.prototype["linecol"]=function(){var τ209=this;var start=τ209.source.linecol(τ209.start);var end=function(){if((τ209.start===τ209.end)){return null;}else{return τ209.source.linecol((τ209.end-1));}}();return [start,end];});(Location.prototype["ref"]=function(){var τ209=this;var τ213=τ209.linecol();var τp0;var τp1;var τp2;var τp3;var τp4;var l1;var τp5;var τp6;var c1;var τ214;if(((τ213 instanceof Array)&&(((τp0=τ213.length),true)&&((τp0===2)&&(((τp1=τ213[0]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===2)&&(((τp3=τp1[0]),(τp4=[true,String(τp3)]),τp4[0])&&(((l1=τp4[1]),true,(τp5=τp1[1]),(τp6=[true,String(τp5)]),τp6[0])&&((c1=τp6[1]),true,(τ214=τ213[1]),true)))))))))){var τ215=τ214;var τp0;var τp1;var τp2;var l2;var τp3;var τp4;var c2;if((τ215===null)){return ((l1+":")+c1);}else{if(((τ215 instanceof Array)&&(((τp0=τ215.length),true)&&((τp0===2)&&(((τp1=τ215[0]),(τp2=[true,String(τp1)]),τp2[0])&&(((l2=τp2[1]),true,(τp3=τ215[1]),(τp4=[true,String(τp3)]),τp4[0])&&((c2=τp4[1]),true))))))){var τ216=null;var otherwise;if(((l1===l2)&&(c1===c2))){return ((l1+":")+c1);}else{if((l1===l2)){return ((((l1+":")+c1)+"-")+c2);}else{if(((otherwise=τ216),true)){return ((((((l1+":")+c1)+"-")+l1)+":")+c2);}else{throw ["Could not find a match",τ216];}}}}else{throw ["Could not find a match",τ215];}}}else{throw ["Could not find a match",τ213];}});(Location.prototype["highlight"]=function(){var τ217=Array.prototype.slice.call(arguments,0);var τp0;var cls;var context;if(((τ217 instanceof Array)&&(((τp0=τ217.length),true)&&(((τp0>=0)&&(τp0<=2))&&((cls=function(){if((0>=τp0)){return "hl1";}else{return τ217[0];}}()),true,(context=function(){if((1>=τp0)){return 0;}else{return τ217[1];}}()),true))))){var τ209=this;return highlight_locations([[τ209,cls]],context);}else{throw ["Could not find a match",τ217];}});Location;var highlight=function(){var τ218=Array.prototype.slice.call(arguments,0);var τp0;var text;var spans;var offset;if(((τ218 instanceof Array)&&(((τp0=τ218.length),true)&&(((τp0>=2)&&(τp0<=3))&&((text=τ218[0]),true,(spans=τ218[1]),true,(offset=function(){if((2>=τp0)){return 0;}else{return τ218[2];}}()),true))))){return Node([],function(){var τ219=[];var τ220=morsel(spans);var τ221=τ220.length;for(var τ222=0;(τ222<τ221);(τ222++)){var τ223=τ220[τ222];var τp0;var start;var end;var attributes;var other;if(((τ223 instanceof Array)&&(((τp0=τ223.length),true)&&((τp0===3)&&((start=τ223[0]),true,(end=τ223[1]),true,(attributes=τ223[2]),true))))){τ219.push(function(){var xstart=Math.max((start-offset),0);var xend=Math.min((end-offset),text.length);return Node(attributes,[text.slice(xstart,xend)]);}());}else{if(((other=τ223),true)){false;}else{throw ["Could not find a match",τ223];}}}return τ219;}());}else{throw ["Could not find a match",τ218];}};var highlight_lines=function(text,linelocs,τ224,spans){var τp0;var l1;var l2;if(((τ224 instanceof Array)&&(((τp0=τ224.length),true)&&((τp0===2)&&((l1=τ224[0]),true,(l2=τ224[1]),true))))){undefined;}else{throw τ315(τ316(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return Node(["+span"],function(){var τ225=[];var τ226=τ324(l1,l2);var τ227=τ226.length;for(var τ228=0;(τ228<τ227);(τ228++)){var τ229=τ226[τ228];var lineno;var other;if(((lineno=τ229),true)){τ225.push(function(){var start=send(linelocs,lineno);var end=send(linelocs,(lineno+1));return Node(["+span"],[Node(["lineno"],(lineno+1)),Node(["source"],highlight(text,τ197([[start,end,[]]],clamp(spans,start,end))))]);}());}else{if(((other=τ229),true)){false;}else{throw ["Could not find a match",τ229];}}}return τ225;}());};var clamp=function(spans,bot,top){var τ230=[];var τ231=spans;var τ232=τ231.length;for(var τ233=0;(τ233<τ232);(τ233++)){var τ234=τ231[τ233];var τp0;var start;var end;var attr;var other;if(((τ234 instanceof Array)&&(((τp0=τ234.length),true)&&((τp0===3)&&((start=τ234[0]),true,(end=τ234[1]),true,(attr=τ234[2]),true,((end>=bot)&&(start<=top))))))){τ230.push([Math.max(start,bot),Math.min(end,top),attr]);}else{if(((other=τ234),true)){false;}else{throw ["Could not find a match",τ234];}}}return τ230;};var morsel=function(spans){var jump=function(active,bot,top){var e=send(Math.min,τ197([top],function(){var τ235=[];var τ236=active;var τ237=τ236.length;for(var τ238=0;(τ238<τ237);(τ238++)){var τ239=τ236[τ238];var τp0;var _;var x;var _;var other;if(((τ239 instanceof Array)&&(((τp0=τ239.length),true)&&((τp0===3)&&((_=τ239[0]),true,(x=τ239[1]),true,(_=τ239[2]),true))))){τ235.push(x);}else{if(((other=τ239),true)){false;}else{throw ["Could not find a match",τ239];}}}return τ235;}()));var attributes=send(τ197,function(){var τ240=[];var τ241=active;var τ242=τ241.length;for(var τ243=0;(τ243<τ242);(τ243++)){var τ244=τ241[τ243];var τp0;var _;var _;var X;var other;if(((τ244 instanceof Array)&&(((τp0=τ244.length),true)&&((τp0===3)&&((_=τ244[0]),true,(_=τ244[1]),true,(X=τ244[2]),true))))){τ240.push(X);}else{if(((other=τ244),true)){false;}else{throw ["Could not find a match",τ244];}}}return τ240;}());return [e,[bot,e,attributes]];};var jumptill=function(active,bot,top){if((bot===top)){return [[],active];}else{if(true){var τp0;var τp1;var newbot;var span;if((((τp0=jump(active,bot,top)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((newbot=τp0[0]),true,(span=τp0[1]),true))))){undefined;}else{throw τ315(τ316(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/location.eg",3584,3598]}));}var newactive=function(){var τ245=[];var τ246=active;var τ247=τ246.length;for(var τ248=0;(τ248<τ247);(τ248++)){var τ249=τ246[τ248];var x;var τp0;var _;var e;var attr;var other;if((((x=τ249),true,(τ249 instanceof Array))&&(((τp0=τ249.length),true)&&((τp0===3)&&((_=τ249[0]),true,(e=τ249[1]),true,(attr=τ249[2]),true,(e>newbot)))))){τ245.push(x);}else{if(((other=τ249),true)){false;}else{throw ["Could not find a match",τ249];}}}return τ245;}();var τp0;var τp1;var spans;var remainder;if((((τp0=jumptill(newactive,newbot,top)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((spans=τp0[0]),true,(remainder=τp0[1]),true))))){undefined;}else{throw τ315(τ316(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/location.eg",3724,3742]}));}return [[span].concat(spans),remainder];}else{return false;}}};var process=function(start,active,rem){var τ250=[start,active,rem];var τp0;var _;var τp1;var τp2;var τp3;var τp4;var τp0;var start;var active;var τp1;var τp2;var τp0;var start;var active;var τp1;var τp2;var τp3;var next;var τp4;var target;var end;var attr;var rest;var τ251=false;var τ252=false;var τ253=false;var τ254=false;var τ255=false;if(((τ251=(τ250 instanceof Array))&&((τ252=((τp0=τ250.length),true))&&((τ253=(τp0===3))&&(((_=τ250[0]),true,(τp1=τ250[1]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===0)&&(((τp3=τ250[2]),(τp3 instanceof Array))&&(((τp4=τp3.length),true)&&(τp4===0)))))))))){return [];}else{if((τ253&&((τ254=((start=τ250[0]),true,(active=τ250[1]),true,(τp1=τ250[2]),(τp1 instanceof Array)))&&((τ255=((τp2=τp1.length),true))&&(τp2===0))))){var top=send(Math.max,function(){var τ256=[];var τ257=active;var τ258=τ257.length;for(var τ259=0;(τ259<τ258);(τ259++)){var τ260=τ257[τ259];var τp0;var _;var e;var _;var other;if(((τ260 instanceof Array)&&(((τp0=τ260.length),true)&&((τp0===3)&&((_=τ260[0]),true,(e=τ260[1]),true,(_=τ260[2]),true))))){τ256.push(e);}else{if(((other=τ260),true)){false;}else{throw ["Could not find a match",τ260];}}}return τ256;}());var bot=Math.min(start,top);var τp0;var τp1;var spans;var _;if((((τp0=jumptill(active,start,top)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((spans=τp0[0]),true,(_=τp0[1]),true))))){undefined;}else{throw τ315(τ316(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/location.eg",4035,4045]}));}return spans;}else{if((τ255&&((τp2>=1)&&(((τp3=τp1[0]),(next=τp3),true,(τp3 instanceof Array))&&(((τp4=τp3.length),true)&&((τp4===3)&&((target=τp3[0]),true,(end=τp3[1]),true,(attr=τp3[2]),true,(rest=τp1.slice(1)),true))))))){var τp0;var τp1;var spans;var newactive;if((((τp0=jumptill(active,start,target)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((spans=τp0[0]),true,(newactive=τp0[1]),true))))){undefined;}else{throw τ315(τ316(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/location.eg",4165,4183]}));}return spans.concat(process(target,[next].concat(newactive),rest));}else{throw ["Could not find a match",τ250];}}}};var thespans=spans.sort(function(τ261,τ262){var τp0;var s1;var e1;var _;if(((τ261 instanceof Array)&&(((τp0=τ261.length),true)&&((τp0===3)&&((s1=τ261[0]),true,(e1=τ261[1]),true,(_=τ261[2]),true))))){undefined;}else{throw τ315(τ316(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var s2;var e2;var _;if(((τ262 instanceof Array)&&(((τp0=τ262.length),true)&&((τp0===3)&&((s2=τ262[0]),true,(e2=τ262[1]),true,(_=τ262[2]),true))))){undefined;}else{throw τ315(τ316(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}if((s1===s2)){return (e1-e2);}else{return (s1-s2);}});return process(thespans[0][0],[],thespans);};var highlight_locations=function(){var τ263=Array.prototype.slice.call(arguments,0);var τp0;var locations;var context;if(((τ263 instanceof Array)&&(((τp0=τ263.length),true)&&(((τp0>=1)&&(τp0<=2))&&((locations=τ263[0]),true,(context=function(){if((1>=τp0)){return 0;}else{return τ263[1];}}()),true))))){var srcs=({});var τ264=locations;var τ265=τ264.length;for(var τ266=0;(τ266<τ265);(τ266++)){var τ267=τ264[τ266];var τp0;var loc;var cls;var other;if(((τ267 instanceof Array)&&(((τp0=τ267.length),true)&&((τp0===2)&&((loc=τ267[0]),true,(cls=τ267[1]),true))))){var key=String((loc.source&&loc.source.url));if((!send(srcs,key))){(srcs[key]=[]);}else{null;}send(srcs,key).push([loc,cls]);}else{if(((other=τ267),true)){false;}else{throw ["Could not find a match",τ267];}}}false;return Node(["+div"],function(){var τ268=[];var τ269=items(srcs);var τ270=τ269.length;for(var τ271=0;(τ271<τ270);(τ271++)){var τ272=τ269[τ271];var τp0;var _;var locs;var other;if(((τ272 instanceof Array)&&(((τp0=τ272.length),true)&&((τp0===2)&&((_=τ272[0]),true,(locs=τ272[1]),true))))){τ268.push(highlight_locations_same_source(locs,context));}else{if(((other=τ272),true)){false;}else{throw ["Could not find a match",τ272];}}}return τ268;}());}else{throw ["Could not find a match",τ263];}};var highlight_locations_same_source=function(){var τ273=Array.prototype.slice.call(arguments,0);var τp0;var locations;var context;if(((τ273 instanceof Array)&&(((τp0=τ273.length),true)&&(((τp0>=1)&&(τp0<=2))&&((locations=τ273[0]),true,(context=function(){if((1>=τp0)){return 0;}else{return τ273[1];}}()),true))))){var loc=merge_locations(function(){var τ274=[];var τ275=locations;var τ276=τ275.length;for(var τ277=0;(τ277<τ276);(τ277++)){var τ278=τ275[τ277];var τp0;var x;var cls;var other;if(((τ278 instanceof Array)&&(((τp0=τ278.length),true)&&((τp0===2)&&((x=τ278[0]),true,(cls=τ278[1]),true))))){τ274.push(x);}else{if(((other=τ278),true)){false;}else{throw ["Could not find a match",τ278];}}}return τ274;}());var src=loc.source;var τp0;var τp1;var l1;var l2;if((((τp0=loc.linerange()),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((l1=τp0[0]),true,(l2=τp0[1]),true))))){undefined;}else{throw τ315(τ316(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/location.eg",4958,4966]}));}var first=Math.max(1,(l1-context));var last=Math.min(src.nlines,(l2+context));return Node(["+div","location"],[Node(["+div","source"],[Node(["sourcefile"],(src.url||"???")),function(){var τ279=[];var τ280=locations;var τ281=τ280.length;for(var τ282=0;(τ282<τ281);(τ282++)){var τ283=τ280[τ282];var τp0;var loc;var cls;var other;if(((τ283 instanceof Array)&&(((τp0=τ283.length),true)&&((τp0===2)&&((loc=τ283[0]),true,(cls=τ283[1]),true))))){τ279.push(Node([cls,"sourcepos"],loc.ref()));}else{if(((other=τ283),true)){false;}else{throw ["Could not find a match",τ283];}}}return τ279;}()]),src.highlight_lines(first,last,function(){var τ284=[];var τ285=locations;var τ286=τ285.length;for(var τ287=0;(τ287<τ286);(τ287++)){var τ288=τ285[τ287];var τp0;var loc;var cls;var other;if(((τ288 instanceof Array)&&(((τp0=τ288.length),true)&&((τp0===2)&&((loc=τ288[0]),true,(cls=τ288[1]),true))))){τ284.push([loc.start,loc.end,[cls]]);}else{if(((other=τ288),true)){false;}else{throw ["Could not find a match",τ288];}}}return τ284;}())]);}else{throw ["Could not find a match",τ273];}};var merge_locations=function(τ289){var τ290=τ289;var τp0;var τp0;var loc;var τp0;var locs;var τ291=false;var τ292=false;if(((τ291=(τ290 instanceof Array))&&((τ292=((τp0=τ290.length),true))&&(τp0===0)))){return Location(null,0,0);}else{if((τ292&&((τp0===1)&&((loc=τ290[0]),true)))){return loc;}else{if((τ292&&((τp0>=0)&&((locs=τ290.slice(0)),true)))){var start=send(Math.min,function(){var τ293=[];var τ294=locs;var τ295=τ294.length;for(var τ296=0;(τ296<τ295);(τ296++)){var τ297=τ294[τ296];var loc;var other;if(((loc=τ297),true)){τ293.push(loc.start);}else{if(((other=τ297),true)){false;}else{throw ["Could not find a match",τ297];}}}return τ293;}());var end=send(Math.max,function(){var τ298=[];var τ299=locs;var τ300=τ299.length;for(var τ301=0;(τ301<τ300);(τ301++)){var τ302=τ299[τ301];var loc;var other;if(((loc=τ302),true)){τ298.push(loc.end);}else{if(((other=τ302),true)){false;}else{throw ["Could not find a match",τ302];}}}return τ298;}());return Location(locs[0].source,start,end);}else{throw ["Could not find a match",τ290];}}}};var __lt____lt____colon__=function(x,y){(x["location"]=function(){if(((!y)||τ195(Location)(y))){return y;}else{return y.location;}}());return x;};var __plus____plus____colon__=function(x,y){(x=function(){if(((!x)||τ195(Location)(x))){return x;}else{return x.location;}}());(y=function(){if(((!y)||τ195(Location)(y))){return y;}else{return y.location;}}());var τ304;try{(τ304=merge_locations([x,y]));}catch(τ303){(τ304=undefined);}return τ304;};var format_error=function(τ306){var e;var τ305;(e=τ306);true;(τ305=τ306);var τ307=τ305;var τp0;var τp1;var τp2;var args;var τp0;var τp1;var τp2;var url;var start;var end;var other;if((τ195(τ316(["syntax"]))(τ307)&&(((τp0=τ325(τ316(["syntax"]))(τ307)),τp0[0])&&(((τp1=τp0[1]),true,(τp2=τp1.length),true)&&((τp2===1)&&((args=τp1[0]),true)))))){var hls=["hl1","hl2","hl3","hl4"];var locs=function(){var τ308=[];var τ309=enumerate(items(args));var τ310=τ309.length;for(var τ311=0;(τ311<τ310);(τ311++)){var τ312=τ309[τ311];var τp0;var i;var τp1;var τp2;var key;var arg;var other;if(((τ312 instanceof Array)&&(((τp0=τ312.length),true)&&((τp0===2)&&(((i=τ312[0]),true,(τp1=τ312[1]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===2)&&((key=τp1[0]),true,(arg=τp1[1]),true,arg.location)))))))){τ308.push([arg.location,send(hls,(i%4))]);}else{if(((other=τ312),true)){false;}else{throw ["Could not find a match",τ312];}}}return τ308;}();return Node(["+div"],[Node(["+div"],[Node(["error_type"],e.name),Node(["error_message"],e.message)]),repr(args),highlight_locations(locs)]);}else{if((τ330(τ307,"location")&&(((τp0=τ307.location),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===4)&&(((τp2=τp0[0]),(τp2==="location"))&&((url=τp0[1]),true,(start=τp0[2]),true,(end=τp0[3]),true))))))){var data=function(){var τ314;try{(τ314=fs.readFileSync(url,"utf8"));}catch(τ313){(τ314=null);}return τ314;}();if(data){var loc=Location(Source(data,url),start,end);return Node(["+div"],[Node(["+div"],[Node(["error_type"],e.name),Node(["error_message"],e.message)]),highlight_locations([[loc,"hl1"]])]);}else{return Node(["+div"],Node(["traceback"],(e.stack||e)));}}else{if(((other=τ307),true)){return Node(["traceback"],(e.stack||e));}else{throw ["Could not find a match",τ307];}}}};var display_error=function(e){return __lt____gt__(null,format_error(e));};(exports["Source"]=Source);(exports["Location"]=Location);(exports["highlight"]=highlight);(exports["highlight_locations"]=highlight_locations);(exports["merge_locations"]=merge_locations);(exports["<<:"]=__lt____lt____colon__);(exports["++:"]=__plus____plus____colon__);(exports["format_error"]=format_error);(exports["display_error"]=display_error);
