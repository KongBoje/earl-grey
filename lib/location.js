var $4031=function(type$4033){var f$4036;(f$4036=type$4033["::check"]);;if((f$4036===(void 0))){return function(value$4041){return (value$4041 instanceof type$4033);};}else{return function(value$4044){return f$4036.call(type$4033,value$4044);};}};
var $4046=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $4047=function($4048$4050){var ph$4054;(ph$4054=$4048$4050);;var $4052$4059;($4052$4059=ph$4054);;var bridge$4053$4064;var x$4068;(bridge$4053$4064=$4052$4059);if((((typeof(bridge$4053$4064)==="string")&&((x$4068=bridge$4053$4064),true))||((typeof(bridge$4053$4064)==="number")&&((x$4068=bridge$4053$4064),true)))){return ["value",x$4068];}else{var other$4075;(other$4075=$4052$4059);return other$4075["::serialize_ast"]();}};
var send$3915;(send$3915=function(obj$3920,$3918$3921){var ph$3925;var msg$3926;var t0$3928;(t0$3928=$3918$3921);(msg$3926=t0$3928);(ph$3925=t0$3928);;var $3923$3932;($3923$3932=ph$3925);;var bridge$3924$3937;(bridge$3924$3937=$3923$3932);if(((typeof(bridge$3924$3937)==="string")||(typeof(bridge$3924$3937)==="number"))){return obj$3920[msg$3926];}else{var other$3945;(other$3945=$3923$3932);return obj$3920["::send"](msg$3926);}});;(Array[":::project"]=function($3948$3950){var ph$3953;var value$3954;var t0$3956;(t0$3956=$3948$3950);(value$3954=t0$3956);(ph$3953=t0$3956);;var $3952$3960;($3952$3960=ph$3953);;if($4031(Array)($3952$3960)){return [true,value$3954];}else{$3952$3960;return [true,[value$3954]];}});(Array.prototype["::check"]=function(value$3974){if((value$3974 instanceof Array)){var i$3979;(i$3979=0);;$3977:for(;(i$3979<this.length);(i$3979++)){if(($4046(this,i$3979)!==$4046(value$3974,i$3979))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return this.slice(0);});(Array.prototype[":::project"]=function(value$3990){if((value$3990 instanceof Array)){var i$3995;(i$3995=0);;$3993:for(;(i$3995<this.length);(i$3995++)){if(($4046(this,i$3995)!==$4046(value$3990,i$3995))){return [true,[value$3990]];}}return [true,value$3990.slice(this.length)];}else{return [true,[value$3990]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($4047));});(RegExp.prototype["::check"]=function(value$4006){return value$4006.match(this);});(RegExp.prototype[":::project"]=function(value$4009){var $4011$4013;($4011$4013=value$4009.match(this));;var m$4021;if(($4011$4013===null)){(m$4021=$4011$4013);return [false,null];}else{var m$4026;(m$4026=$4011$4013);return [true,m$4026];}});(Function.prototype["::send"]=function(args$4029){return this.apply(this,args$4029);});
var $5669=function(dest$5671,values$5672){var k$5677;(k$5677=null);$5675:for(k$5677 in values$5672){if(values$5672.hasOwnProperty(k$5677)){(dest$5671[k$5677]=values$5672[k$5677]);}}return dest$5671;};
var $5562=function(){var $5563$5565;($5563$5565=function(tags$5569){var it$0$5572;(it$0$5572=function(){if((!$4031($5563$5565)(this))){return Object.create($5563$5565.prototype);}else{return this;}}());;(it$0$5572["tags"]=tags$5569);return it$0$5572;});;($5563$5565.prototype["create"]=function(){var $5581$5583;($5581$5583=arguments);;var t0$5588;var message$5592;var args$5593;(t0$5588=$5581$5583.length);if((t0$5588>=0)){(message$5592=function(){if((0>=t0$5588)){return "";}else{return $5581$5583[0];}}());(args$5593=Array.prototype.slice.call($5581$5583,1));var it$0$5597;(it$0$5597=this);;var e$5602;(e$5602=Error(message$5592));;(e$5602["::tags"]=it$0$5597.tags);(e$5602["args"]=args$5593);(e$5602["name"]=["E"].concat(it$0$5597.tags).join("."));return e$5602;}else{$5549($5581$5583);}});($5563$5565.prototype["::check"]=function(e$5611){var it$0$5614;(it$0$5614=this);;var tags$5619;if(((!e$5611)||(!$4031(Error)(e$5611)))){return false;}(tags$5619=(e$5611["::tags"]||[]));;var temp$5628;(temp$5628=it$0$5614.tags);;var $length$5633;($length$5633=temp$5628.length);;var $index$5638;($index$5638=0);;$5620:for(;($index$5638<$length$5633);($index$5638++)){var m$5646;(m$5646=temp$5628[$index$5638]);;var tag$5654;(tag$5654=m$5646);if((tags$5619.indexOf(tag$5654)===(-1))){return false;}else{false;;}}return true;});($5563$5565.prototype["::deconstruct"]=function(e$5662){var it$0$5665;(it$0$5665=this);;return e$5662.args;});$5669($5563$5565,({}));return $5563$5565;}();
var $5549=function(value$5551,url$5552,start$5553,end$5554){var err$5557;(err$5557=$5562(["match"]).create("Could not find a match for value",({"value":value$5551})));;if(url$5552){(err$5557["location"]=["location",url$5552,start$5553,end$5554]);}throw err$5557;};
var $5787=function(type$5789){return function(value$5792){var f$5795;(f$5795=type$5789[":::project"]);;if((f$5795===(void 0))){var f$5800;(f$5800=type$5789["::project"]);;if((f$5800===(void 0))){return [true,type$5789(value$5792)];}else{var rval$5805;(rval$5805=false);;try{(rval$5805=[true,f$5800(value$5792)]);}catch(excv$5811){var e$5817;(e$5817=excv$5811);(rval$5805=[false,null]);}return rval$5805;}}else{return f$5795.call(type$5789,value$5792);}};};
var $5681=function(){var $5682$5684;($5682$5684=function($5687$5690,$5688$5691){var classes$5693;var children$5694;var t0$5696;(t0$5696=$5787(Array)($5687$5690));if(t0$5696[0]){(classes$5693=t0$5696[1]);;}else{$5549($5687$5690);}var t0$5701;(t0$5701=$5787(Array)($5688$5691));if(t0$5701[0]){(children$5694=t0$5701[1]);;}else{$5549($5688$5691);}var it$0$5706;(it$0$5706=function(){if((!$4031($5682$5684)(this))){return Object.create($5682$5684.prototype);}else{return this;}}());;(it$0$5706["classes"]=classes$5693.sort());(it$0$5706["children"]=children$5694);return it$0$5706;});;$5669(function(){var accum$5714;(accum$5714=({}));(accum$5714["::check"]=function(x$5718){return ((x$5718&&x$5718.classes)&&x$5718.children);});return accum$5714;}(),function(){var accum$5721;(accum$5721=({}));(accum$5721["::deconstruct"]=function(x$5725){return [x$5725.classes,x$5725.children];});return accum$5721;}());($5682$5684.prototype["::check"]=function(n$5730){var it$0$5733;(it$0$5733=this);;var temp$5742;(temp$5742=it$0$5733.classes);;var $length$5747;($length$5747=temp$5742.length);;var $index$5752;($index$5752=0);;$5738:for(;($index$5752<$length$5747);($index$5752++)){var m$5760;(m$5760=temp$5742[$index$5752]);;var c$5768;(c$5768=m$5760);if((n$5730.classes.indexOf(c$5768)===(-1))){return false;}else{false;;}}return true;});$5669($5682$5684,$5669(function(){var accum$5774;(accum$5774=({}));(accum$5774["::check"]=function(x$5778){return ((x$5778&&x$5778.classes)&&x$5778.children);});return accum$5774;}(),function(){var accum$5781;(accum$5781=({}));(accum$5781["::deconstruct"]=function(x$5785){return [x$5785.classes,x$5785.children];});return accum$5781;}()));return $5682$5684;}();
var $5819=function(from$5821,to$5822){var rval$5826;(rval$5826=[]);;var i$5831;(i$5831=from$5821);;$5825:for(;(i$5831<=to$5822);(i$5831++)){rval$5826.push(i$5831);}return rval$5826;};
var $5838=function($5839$5841,key$5842){var ph$5846;(ph$5846=$5839$5841);;var $5844$5851;($5844$5851=ph$5846);;var bridge$5845$5856;(bridge$5845$5856=$5844$5851);if(((bridge$5845$5856===null)||(bridge$5845$5856===(void 0)))){return false;}else{var x$5864;if((typeof($5844$5851)==="string")){(x$5864=$5844$5851);return (key$5842 in String.prototype);}else{var x$5869;if((typeof($5844$5851)==="number")){(x$5869=$5844$5851);return (key$5842 in Number.prototype);}else{var x$5874;(x$5874=$5844$5851);return (key$5842 in x$5874);}}}};var $4078$4080;var binsearch$4081;var items$4082;var enumerate$4083;var $4079$4084;var __lt____gt__$4085;var repr$4086;var fs$4087;var Source$4088;var Location$4089;var highlight$4090;var highlight_lines$4091;var clamp$4092;var morsel$4093;var highlight_locations$4094;var highlight_locations_same_source$4095;var merge_locations$4096;var __lt____lt____colon__$4097;var __plus____plus____colon__$4098;var format_error$4099;var display_error$4100;($4078$4080=require("./util"));;(binsearch$4081=$4078$4080.binsearch);;(items$4082=$4078$4080.items);;(enumerate$4083=$4078$4080.enumerate);;($4079$4084=require("./pp"));;(__lt____gt__$4085=$4079$4084["<>"]);;(repr$4086=$4079$4084.repr);;(fs$4087=require("fs"));;(Source$4088=function(){var $index$4168;var $length$4163;var temp$4158;var curr$4150;var it$0$4144;var text$4139;var url$4140;var t0$4135;var $4128$4130;($4128$4130=arguments);;(t0$4135=$4128$4130.length);if(((t0$4135>=1)&&(t0$4135<=2))){(text$4139=$4128$4130[0]);(url$4140=function(){if((1>=t0$4135)){return false;}else{return $4128$4130[1];}}());(it$0$4144=function(){if((!$4031(Source$4088)(this))){return Object.create(Source$4088.prototype);}else{return this;}}());;(it$0$4144["text"]=text$4139);(it$0$4144["url"]=url$4140);(it$0$4144["counts"]=[]);(curr$4150=0);;(temp$4158=text$4139.split("\n"));;($length$4163=temp$4158.length);;($index$4168=0);;$4151:for(;($index$4168<$length$4163);($index$4168++)){var line$4184;var m$4176;(m$4176=temp$4158[$index$4168]);;(line$4184=m$4176);it$0$4144.counts.push(curr$4150);(curr$4150=(curr$4150+(line$4184.length+1)));}it$0$4144.counts.push(curr$4150);(it$0$4144["nlines"]=(it$0$4144.counts.length-1));return it$0$4144;}else{$5549($4128$4130);}});;(Source$4088.prototype["linecol"]=function(pos$4193){var line$4201;var col$4202;var it$0$4196;(it$0$4196=this);;(line$4201=binsearch$4081(it$0$4196.counts,pos$4193));;(col$4202=(pos$4193-$4046(it$0$4196.counts,(line$4201-1))));;return [line$4201,col$4202];});(Source$4088.prototype["highlight_lines"]=function(l1$4212,l2$4213,spans$4214){var it$0$4217;(it$0$4217=this);;return highlight_lines$4091(it$0$4217.text,it$0$4217.counts,[(l1$4212-1),(l2$4213-1)],spans$4214);});$5669(Source$4088,({}));Source$4088;(Location$4089=function(source$4224,start$4225,end$4226){var it$0$4229;(it$0$4229=function(){if((!$4031(Location$4089)(this))){return Object.create(Location$4089.prototype);}else{return this;}}());;(it$0$4229["source"]=(source$4224||Source$4088("",null)));(it$0$4229["start"]=start$4225);(it$0$4229["end"]=end$4226);return it$0$4229;});;(Location$4089.prototype["text"]=function(){var it$0$4241;(it$0$4241=this);;return it$0$4241.source.text.slice(it$0$4241.start,it$0$4241.end);});(Location$4089.prototype["linerange"]=function(){var l2$4285;var t0$4276;var t1$4277;var l1$4268;var $4251$4269;var t0$4262;var t1$4263;var t2$4264;var $4250$4257;var it$0$4252;(it$0$4252=this);;($4250$4257=it$0$4252.linecol());;if((($4250$4257 instanceof Array)&&((t0$4262=$4250$4257.length),((t0$4262===2)&&((t1$4263=$4250$4257[0]),((t1$4263 instanceof Array)&&((t2$4264=t1$4263.length),(t2$4264===2)))))))){(l1$4268=t1$4263[0]);t1$4263[1];($4251$4269=$4250$4257[1]);if(($4251$4269===null)){return [l1$4268,l1$4268];}else{(t0$4276=$4251$4269);if(((t0$4276 instanceof Array)&&((t1$4277=t0$4276.length),(t1$4277===2)))){(l2$4285=t0$4276[0]);t0$4276[1];return [l1$4268,l2$4285];}else{$5549($4251$4269,"/home/olivier/git/earl-grey/src/location.eg",972,977);}}}else{$5549($4250$4257);}});(Location$4089.prototype["linecol"]=function(){var start$4303;var end$4304;var it$0$4298;(it$0$4298=this);;(start$4303=it$0$4298.source.linecol(it$0$4298.start));;(end$4304=function(){if((it$0$4298.start===it$0$4298.end)){return null;}else{return it$0$4298.source.linecol((it$0$4298.end-1));}}());;return [start$4303,end$4304];});(Location$4089.prototype["ref"]=function(){var otherwise$4387;var $4368$4376;var $4367$4370;var l2$4359;var c2$4360;var t0$4348;var t1$4349;var t2$4350;var t3$4351;var l1$4336;var c1$4337;var $4317$4338;var t0$4328;var t1$4329;var t2$4330;var t3$4331;var t4$4332;var $4316$4323;var it$0$4318;(it$0$4318=this);;($4316$4323=it$0$4318.linecol());;if((($4316$4323 instanceof Array)&&((t0$4328=$4316$4323.length),((t0$4328===2)&&((t1$4329=$4316$4323[0]),((t1$4329 instanceof Array)&&((t2$4330=t1$4329.length),((t2$4330===2)&&((t3$4331=[true,String(t1$4329[0])]),(t3$4331[0]&&((l1$4336=t3$4331[1]),((t4$4332=[true,String(t1$4329[1])]),t4$4332[0])))))))))))){(c1$4337=t4$4332[1]);($4317$4338=$4316$4323[1]);if(($4317$4338===null)){return ((l1$4336+":")+c1$4337);}else{(t0$4348=$4317$4338);if(((t0$4348 instanceof Array)&&((t1$4349=t0$4348.length),((t1$4349===2)&&((t2$4350=[true,String(t0$4348[0])]),(t2$4350[0]&&((l2$4359=t2$4350[1]),((t3$4351=[true,String(t0$4348[1])]),t3$4351[0])))))))){(c2$4360=t3$4351[1]);($4367$4370=null);;$4367$4370;if(((l1$4336===l2$4359)&&(c1$4337===c2$4360))){return ((l1$4336+":")+c1$4337);}else{if((l1$4336===l2$4359)){return ((((l1$4336+":")+c1$4337)+"-")+c2$4360);}else{(otherwise$4387=$4367$4370);return ((((((l1$4336+":")+c1$4337)+"-")+l1$4336)+":")+c2$4360);}}}else{$5549($4317$4338,"/home/olivier/git/earl-grey/src/location.eg",1313,1318);}}}else{$5549($4316$4323);}});(Location$4089.prototype["highlight"]=function(){var it$0$4412;var cls$4407;var context$4408;var t0$4403;var $4396$4398;($4396$4398=arguments);;(t0$4403=$4396$4398.length);if(((t0$4403>=0)&&(t0$4403<=2))){(cls$4407=function(){if((0>=t0$4403)){return "hl1";}else{return $4396$4398[0];}}());(context$4408=function(){if((1>=t0$4403)){return 0;}else{return $4396$4398[1];}}());(it$0$4412=this);;return highlight_locations$4094([[it$0$4412,cls$4407]],context$4408);}else{$5549($4396$4398);}});$5669(Location$4089,({}));Location$4089;(highlight$4090=function(){var $index$4455;var $length$4450;var temp$4445;var acc$4440;var text$4432;var spans$4433;var offset$4434;var t0$4428;var $4421$4423;($4421$4423=arguments);;(t0$4428=$4421$4423.length);if(((t0$4428>=2)&&(t0$4428<=3))){(text$4432=$4421$4423[0]);(spans$4433=$4421$4423[1]);(offset$4434=function(){if((2>=t0$4428)){return 0;}else{return $4421$4423[2];}}());return $5681([],(((acc$4440=[])),(((temp$4445=morsel$4093(spans$4433))),((($length$4450=temp$4445.length)),((($index$4455=0)),function(){$4437:for(;($index$4455<$length$4450);($index$4455++)){var xstart$4480;var xend$4481;var start$4473;var end$4474;var attributes$4475;var t0$4468;var t1$4469;var m$4463;(m$4463=temp$4445[$index$4455]);;(t0$4468=m$4463);if(((t0$4468 instanceof Array)&&((t1$4469=t0$4468.length),(t1$4469===3)))){(start$4473=t0$4468[0]);(end$4474=t0$4468[1]);(attributes$4475=t0$4468[2]);acc$4440.push((((xstart$4480=Math.max((start$4473-offset$4434),0))),((xend$4481=Math.min((end$4474-offset$4434),text$4432.length))),$5681(attributes$4475.slice(0,1),[text$4432.slice(xstart$4480,xend$4481)])));}else{$5549(m$4463,"/home/olivier/git/earl-grey/src/location.eg",1861,2072);;}}}()))),acc$4440));}else{$5549($4421$4423);}});;(highlight_lines$4091=function(text$4497,linelocs$4498,$4495$4499,spans$4500){var t0$4505;var t1$4506;var $index$4529;var $length$4524;var temp$4519;var acc$4514;var l1$4502;var l2$4503;(t0$4505=$4495$4499);if(((t0$4505 instanceof Array)&&((t1$4506=t0$4505.length),(t1$4506===2)))){(l1$4502=t0$4505[0]);(l2$4503=t0$4505[1]);;}else{$5549($4495$4499);}return $5681(["+span"],(((acc$4514=[])),(((temp$4519=$5819(l1$4502,l2$4503))),((($length$4524=temp$4519.length)),((($index$4529=0)),function(){$4511:for(;($index$4529<$length$4524);($index$4529++)){var start$4548;var end$4549;var lineno$4545;var m$4537;(m$4537=temp$4519[$index$4529]);;(lineno$4545=m$4537);acc$4514.push((((start$4548=$4046(linelocs$4498,lineno$4545))),((end$4549=$4046(linelocs$4498,(lineno$4545+1)))),$5681(["+span"],[$5681(["lineno"],(lineno$4545+1)),$5681(["source"],highlight$4090(text$4497,[[start$4548,end$4549,[]]].concat(clamp$4092(spans$4500,start$4548,end$4549))))])));}}()))),acc$4514));});;(clamp$4092=function(spans$4560,bot$4561,top$4562){var $index$4582;var $length$4577;var temp$4572;var acc$4567;(acc$4567=[]);;(temp$4572=spans$4560);;($length$4577=temp$4572.length);;($index$4582=0);;$4564:for(;($index$4582<$length$4577);($index$4582++)){var start$4600;var end$4601;var attr$4602;var t0$4595;var t1$4596;var m$4590;(m$4590=temp$4572[$index$4582]);;(t0$4595=m$4590);if(((t0$4595 instanceof Array)&&((t1$4596=t0$4595.length),((t1$4596===3)&&((start$4600=t0$4595[0]),((end$4601=t0$4595[1]),((attr$4602=t0$4595[2]),((end$4601>=bot$4561)&&(start$4600<=top$4562))))))))){acc$4567.push([Math.max(start$4600,bot$4561),Math.min(end$4601,top$4562),attr$4602]);}else{false;;}}return acc$4567;});;(morsel$4093=function(spans$4615){var jump$4618;var jumptill$4619;var process$4620;var thespans$4621;(jump$4618=function(active$4625,bot$4626,top$4627){var $index$4655;var $length$4650;var temp$4645;var acc$4640;var $index$4695;var $length$4690;var temp$4685;var e$4630;var attributes$4631;(e$4630=$4046(Math.min,[top$4627].concat((((acc$4640=[])),(((temp$4645=active$4625)),((($length$4650=temp$4645.length)),((($index$4655=0)),function(){$4637:for(;($index$4655<$length$4650);($index$4655++)){var x$4673;var t0$4668;var t1$4669;var m$4663;(m$4663=temp$4645[$index$4655]);;(t0$4668=m$4663);if(((t0$4668 instanceof Array)&&((t1$4669=t0$4668.length),(t1$4669===3)))){t0$4668[0];(x$4673=t0$4668[1]);t0$4668[2];acc$4640.push(x$4673);}else{$5549(m$4663,"/home/olivier/git/earl-grey/src/location.eg",3394,3437);;}}}()))),acc$4640))));;(attributes$4631=[]);;(temp$4685=active$4625);;($length$4690=temp$4685.length);;($index$4695=0);;$4632:for(;($index$4695<$length$4690);($index$4695++)){var X$4713;var t0$4708;var t1$4709;var m$4703;(m$4703=temp$4685[$index$4695]);;(t0$4708=m$4703);if(((t0$4708 instanceof Array)&&((t1$4709=t0$4708.length),(t1$4709===3)))){t0$4708[0];t0$4708[1];(X$4713=t0$4708[2]);(attributes$4631=attributes$4631.concat(X$4713));}else{$5549(m$4703,"/home/olivier/git/earl-grey/src/location.eg",3459,3500);;}}return [e$4630,[bot$4626,e$4630,attributes$4631]];});;(jumptill$4619=function(active$4723,bot$4724,top$4725){var t0$4734;var t1$4735;var $index$4760;var $length$4755;var temp$4750;var acc$4745;var t0$4791;var t1$4792;var newbot$4728;var span$4729;var newactive$4730;var spans$4731;var remainder$4732;if((bot$4724===top$4725)){return [[],active$4723];}else{(t0$4734=jump$4618(active$4723,bot$4724,top$4725));if(((t0$4734 instanceof Array)&&((t1$4735=t0$4734.length),(t1$4735===2)))){(newbot$4728=t0$4734[0]);(span$4729=t0$4734[1]);;}else{$5549(jump$4618(active$4723,bot$4724,top$4725),"/home/olivier/git/earl-grey/src/location.eg",3736,3758);}(newactive$4730=(((acc$4745=[])),(((temp$4750=active$4723)),((($length$4755=temp$4750.length)),((($index$4760=0)),function(){$4742:for(;($index$4760<$length$4755);($index$4760++)){var x$4778;var e$4779;var attr$4780;var t0$4773;var t1$4774;var m$4768;(m$4768=temp$4750[$index$4760]);;(t0$4773=m$4768);(x$4778=t0$4773);if(((t0$4773 instanceof Array)&&((t1$4774=t0$4773.length),((t1$4774===3)&&(t0$4773[0],((e$4779=t0$4773[1]),((attr$4780=t0$4773[2]),(e$4779>newbot$4728)))))))){acc$4745.push(x$4778);}else{false;;}}}()))),acc$4745));;(t0$4791=jumptill$4619(newactive$4730,newbot$4728,top$4725));if(((t0$4791 instanceof Array)&&((t1$4792=t0$4791.length),(t1$4792===2)))){(spans$4731=t0$4791[0]);(remainder$4732=t0$4791[1]);;}else{$5549(jumptill$4619(newactive$4730,newbot$4728,top$4725),"/home/olivier/git/earl-grey/src/location.eg",3881,3913);}return [[span$4729].concat(spans$4731),remainder$4732];}});;(process$4620=function(start$4801,active$4802,rem$4803){var $index$4868;var $length$4863;var temp$4858;var acc$4853;var t0$4897;var t1$4898;var top$4845;var bot$4846;var spans$4847;var t0$4925;var t1$4926;var spans$4922;var newactive$4923;var start$4905;var active$4906;var next$4907;var target$4908;var end$4909;var attr$4910;var rest$4911;var start$4836;var active$4837;var $4806$4821;var $4807$4822;var $4808$4823;var t0$4815;var t1$4816;var t2$4817;var t3$4818;var t4$4819;var $4805$4810;($4805$4810=[start$4801,active$4802,rem$4803]);;if((($4806$4821=($4805$4810 instanceof Array))&&((t0$4815=$4805$4810.length),(($4808$4823=(t0$4815===3))&&($4805$4810[0],((t1$4816=$4805$4810[1]),((t1$4816 instanceof Array)&&((t2$4817=t1$4816.length),((t2$4817===0)&&((t3$4818=$4805$4810[2]),((t3$4818 instanceof Array)&&((t4$4819=t3$4818.length),(t4$4819===0))))))))))))){return [];}else{if(($4808$4823&&((start$4836=$4805$4810[0]),((active$4837=$4805$4810[1]),((t1$4816=$4805$4810[2]),((t1$4816 instanceof Array)&&((t2$4817=t1$4816.length),(t2$4817===0)))))))){(top$4845=$4046(Math.max,(((acc$4853=[])),(((temp$4858=active$4837)),((($length$4863=temp$4858.length)),((($index$4868=0)),function(){$4850:for(;($index$4868<$length$4863);($index$4868++)){var e$4886;var t0$4881;var t1$4882;var m$4876;(m$4876=temp$4858[$index$4868]);;(t0$4881=m$4876);if(((t0$4881 instanceof Array)&&((t1$4882=t0$4881.length),(t1$4882===3)))){t0$4881[0];(e$4886=t0$4881[1]);t0$4881[2];acc$4853.push(e$4886);}else{$5549(m$4876,"/home/olivier/git/earl-grey/src/location.eg",4101,4129);;}}}()))),acc$4853)));;(bot$4846=Math.min(start$4836,top$4845));;(t0$4897=jumptill$4619(active$4837,start$4836,top$4845));if(((t0$4897 instanceof Array)&&((t1$4898=t0$4897.length),(t1$4898===2)))){(spans$4847=t0$4897[0]);t0$4897[1];;}else{$5549(jumptill$4619(active$4837,start$4836,top$4845),"/home/olivier/git/earl-grey/src/location.eg",4188,4216);}return spans$4847;}else{if(($4808$4823&&((start$4905=$4805$4810[0]),((active$4906=$4805$4810[1]),((t1$4816=$4805$4810[2]),((t1$4816 instanceof Array)&&((t2$4817=t1$4816.length),((t2$4817>=1)&&((t3$4818=t1$4816[0]),((next$4907=t3$4818),((t3$4818 instanceof Array)&&((t4$4819=t3$4818.length),(t4$4819===3))))))))))))){(target$4908=t3$4818[0]);(end$4909=t3$4818[1]);(attr$4910=t3$4818[2]);(rest$4911=Array.prototype.slice.call(t1$4816,1));(t0$4925=jumptill$4619(active$4906,start$4905,target$4908));if(((t0$4925 instanceof Array)&&((t1$4926=t0$4925.length),(t1$4926===2)))){(spans$4922=t0$4925[0]);(newactive$4923=t0$4925[1]);;}else{$5549(jumptill$4619(active$4906,start$4905,target$4908),"/home/olivier/git/earl-grey/src/location.eg",4326,4357);}return spans$4922.concat(process$4620(target$4908,[next$4907].concat(newactive$4923),rest$4911));}else{$5549($4805$4810);}}}});;(thespans$4621=spans$4615.sort(function($4936$4939,$4937$4940){var t0$4947;var t1$4948;var t0$4954;var t1$4955;var s1$4942;var e1$4943;var s2$4944;var e2$4945;(t0$4947=$4936$4939);if(((t0$4947 instanceof Array)&&((t1$4948=t0$4947.length),(t1$4948===3)))){(s1$4942=t0$4947[0]);(e1$4943=t0$4947[1]);t0$4947[2];;}else{$5549($4936$4939);}(t0$4954=$4937$4940);if(((t0$4954 instanceof Array)&&((t1$4955=t0$4954.length),(t1$4955===3)))){(s2$4944=t0$4954[0]);(e2$4945=t0$4954[1]);t0$4954[2];;}else{$5549($4937$4940);}if((s1$4942===s2$4944)){return (e1$4943-e2$4945);}else{return (s1$4942-s2$4944);}}));;return process$4620(thespans$4621[0][0],[],thespans$4621);});;(highlight_locations$4094=function(){var $index$4999;var $length$4994;var temp$4989;var $index$5048;var $length$5043;var temp$5038;var acc$5033;var srcs$4981;var locations$4976;var context$4977;var t0$4972;var $4965$4967;($4965$4967=arguments);;(t0$4972=$4965$4967.length);if(((t0$4972>=1)&&(t0$4972<=2))){(locations$4976=$4965$4967[0]);(context$4977=function(){if((1>=t0$4972)){return 0;}else{return $4965$4967[1];}}());(srcs$4981=({}));;(temp$4989=locations$4976);;($length$4994=temp$4989.length);;($index$4999=0);;$4982:for(;($index$4999<$length$4994);($index$4999++)){var key$5023;var loc$5017;var cls$5018;var t0$5012;var t1$5013;var m$5007;(m$5007=temp$4989[$index$4999]);;(t0$5012=m$5007);if(((t0$5012 instanceof Array)&&((t1$5013=t0$5012.length),(t1$5013===2)))){(loc$5017=t0$5012[0]);(cls$5018=t0$5012[1]);(key$5023=String((loc$5017.source&&loc$5017.source.url)));;if((!$4046(srcs$4981,key$5023))){(srcs$4981[key$5023]=[]);}$4046(srcs$4981,key$5023).push([loc$5017,cls$5018]);}else{$5549(m$5007,"/home/olivier/git/earl-grey/src/location.eg",4695,4865);;}}return $5681(["+div"],(((acc$5033=[])),(((temp$5038=items$4082(srcs$4981))),((($length$5043=temp$5038.length)),((($index$5048=0)),function(){$5030:for(;($index$5048<$length$5043);($index$5048++)){var locs$5066;var t0$5061;var t1$5062;var m$5056;(m$5056=temp$5038[$index$5048]);;(t0$5061=m$5056);if(((t0$5061 instanceof Array)&&((t1$5062=t0$5061.length),(t1$5062===2)))){t0$5061[0];(locs$5066=t0$5061[1]);acc$5033.push(highlight_locations_same_source$4095(locs$5066,context$4977));}else{$5549(m$5056,"/home/olivier/git/earl-grey/src/location.eg",4870,4964);;}}}()))),acc$5033));}else{$5549($4965$4967);}});;(highlight_locations_same_source$4095=function(){var $index$5120;var $length$5115;var temp$5110;var acc$5105;var t0$5150;var t1$5151;var $index$5180;var $length$5175;var temp$5170;var acc$5165;var $index$5223;var $length$5218;var temp$5213;var acc$5208;var loc$5094;var src$5095;var l1$5096;var l2$5097;var first$5098;var last$5099;var locations$5089;var context$5090;var t0$5085;var $5078$5080;($5078$5080=arguments);;(t0$5085=$5078$5080.length);if(((t0$5085>=1)&&(t0$5085<=2))){(locations$5089=$5078$5080[0]);(context$5090=function(){if((1>=t0$5085)){return 0;}else{return $5078$5080[1];}}());(loc$5094=merge_locations$4096((((acc$5105=[])),(((temp$5110=locations$5089)),((($length$5115=temp$5110.length)),((($index$5120=0)),function(){$5102:for(;($index$5120<$length$5115);($index$5120++)){var x$5138;var cls$5139;var t0$5133;var t1$5134;var m$5128;(m$5128=temp$5110[$index$5120]);;(t0$5133=m$5128);if(((t0$5133 instanceof Array)&&((t1$5134=t0$5133.length),(t1$5134===2)))){(x$5138=t0$5133[0]);(cls$5139=t0$5133[1]);acc$5105.push(x$5138);}else{$5549(m$5128,"/home/olivier/git/earl-grey/src/location.eg",5047,5075);;}}}()))),acc$5105)));;(src$5095=loc$5094.source);;(t0$5150=loc$5094.linerange());if(((t0$5150 instanceof Array)&&((t1$5151=t0$5150.length),(t1$5151===2)))){(l1$5096=t0$5150[0]);(l2$5097=t0$5150[1]);;}else{$5549(loc$5094.linerange(),"/home/olivier/git/earl-grey/src/location.eg",5111,5126);}(first$5098=Math.max(1,(l1$5096-context$5090)));;(last$5099=Math.min(src$5095.nlines,(l2$5097+context$5090)));;return $5681(["+div","location"],[$5681(["+div","source"],[$5681(["sourcefile"],(src$5095.url||"???")),(((acc$5165=[])),(((temp$5170=locations$5089)),((($length$5175=temp$5170.length)),((($index$5180=0)),function(){$5162:for(;($index$5180<$length$5175);($index$5180++)){var loc$5198;var cls$5199;var t0$5193;var t1$5194;var m$5188;(m$5188=temp$5170[$index$5180]);;(t0$5193=m$5188);if(((t0$5193 instanceof Array)&&((t1$5194=t0$5193.length),(t1$5194===2)))){(loc$5198=t0$5193[0]);(cls$5199=t0$5193[1]);acc$5165.push($5681([cls$5199,"sourcepos"],loc$5198.ref()));}else{$5549(m$5188,"/home/olivier/git/earl-grey/src/location.eg",5295,5358);;}}}()))),acc$5165)]),src$5095.highlight_lines(first$5098,last$5099,(((acc$5208=[])),(((temp$5213=locations$5089)),((($length$5218=temp$5213.length)),((($index$5223=0)),function(){$5205:for(;($index$5223<$length$5218);($index$5223++)){var loc$5241;var cls$5242;var t0$5236;var t1$5237;var m$5231;(m$5231=temp$5213[$index$5223]);;(t0$5236=m$5231);if(((t0$5236 instanceof Array)&&((t1$5237=t0$5236.length),(t1$5237===2)))){(loc$5241=t0$5236[0]);(cls$5242=t0$5236[1]);acc$5208.push([loc$5241.start,loc$5241.end,[cls$5242]]);}else{$5549(m$5231,"/home/olivier/git/earl-grey/src/location.eg",5420,5476);;}}}()))),acc$5208))]);}else{$5549($5078$5080);}});;(merge_locations$4096=function($5253$5255){var $index$5312;var $length$5307;var temp$5302;var acc$5297;var $index$5351;var $length$5346;var temp$5341;var acc$5336;var start$5290;var end$5291;var locs$5286;var loc$5281;var $5258$5272;var $5259$5273;var t0$5270;var $5257$5265;var ph$5260;(ph$5260=$5253$5255);;($5257$5265=ph$5260);;if((($5258$5272=($5257$5265 instanceof Array))&&((t0$5270=$5257$5265.length),(t0$5270===0)))){return Location$4089(null,0,0);}else{if(($5258$5272&&(t0$5270===1))){(loc$5281=$5257$5265[0]);return loc$5281;}else{if(($5258$5272&&(t0$5270>=0))){(locs$5286=Array.prototype.slice.call($5257$5265,0));(start$5290=$4046(Math.min,(((acc$5297=[])),(((temp$5302=locs$5286)),((($length$5307=temp$5302.length)),((($index$5312=0)),function(){$5294:for(;($index$5312<$length$5307);($index$5312++)){var loc$5328;var m$5320;(m$5320=temp$5302[$index$5312]);;(loc$5328=m$5320);acc$5297.push(loc$5328.start);}}()))),acc$5297)));;(end$5291=$4046(Math.max,(((acc$5336=[])),(((temp$5341=locs$5286)),((($length$5346=temp$5341.length)),((($index$5351=0)),function(){$5333:for(;($index$5351<$length$5346);($index$5351++)){var loc$5367;var m$5359;(m$5359=temp$5341[$index$5351]);;(loc$5367=m$5359);acc$5336.push(loc$5367.end);}}()))),acc$5336)));;return Location$4089(locs$5286[0].source,start$5290,end$5291);}else{$5549($5257$5265);}}}});;(__lt____lt____colon__$4097=function(x$5376,y$5377){if((!$4031(Location$4089)(x$5376.location))){(x$5376["location"]=function(){if(((!y$5377)||$4031(Location$4089)(y$5377))){return y$5377;}else{return y$5377.location;}}());}return x$5376;});;(__plus____plus____colon__$4098=function(x$5385,y$5386){var rval$5390;(x$5385=function(){if(((!x$5385)||$4031(Location$4089)(x$5385))){return x$5385;}else{return x$5385.location;}}());(y$5386=function(){if(((!y$5386)||$4031(Location$4089)(y$5386))){return y$5386;}else{return y$5386.location;}}());(rval$5390=false);;try{(rval$5390=merge_locations$4096([x$5385,y$5386]));}catch(excv$5396){var e$5402;(e$5402=excv$5396);(rval$5390=(void 0));}return rval$5390;});;(format_error$4099=function($5407$5409){var t0$5417;var $index$5464;var $length$5459;var temp$5454;var acc$5449;var hls$5439;var locs$5440;var rval$5517;var loc$5533;var data$5513;var other$5539;var url$5506;var start$5507;var end$5508;var loc$5500;var args$5433;var $5412$5429;var $5413$5430;var t0$5426;var t1$5427;var $5411$5421;var ph$5414;var e$5415;(t0$5417=$5407$5409);(e$5415=t0$5417);(ph$5414=t0$5417);;($5411$5421=ph$5414);;if(($4031($5562(["syntax"]))($5411$5421)&&($5838($5411$5421,"args")&&((t0$5426=$5411$5421.args),((t0$5426 instanceof Array)&&((t1$5427=t0$5426.length),(t1$5427===1))))))){(args$5433=t0$5426[0]);(hls$5439=["hl1","hl2","hl3","hl4"]);;(locs$5440=(((acc$5449=[])),(((temp$5454=enumerate$4083(items$4082(args$5433)))),((($length$5459=temp$5454.length)),((($index$5464=0)),function(){$5446:for(;($index$5464<$length$5459);($index$5464++)){var i$5484;var key$5485;var arg$5486;var t0$5477;var t1$5478;var t2$5479;var t3$5480;var m$5472;(m$5472=temp$5454[$index$5464]);;(t0$5477=m$5472);if(((t0$5477 instanceof Array)&&((t1$5478=t0$5477.length),((t1$5478===2)&&((i$5484=t0$5477[0]),((t2$5479=t0$5477[1]),((t2$5479 instanceof Array)&&((t3$5480=t2$5479.length),((t3$5480===2)&&((key$5485=t2$5479[0]),((arg$5486=t2$5479[1]),(arg$5486&&arg$5486.location)))))))))))){acc$5449.push([arg$5486.location,$4046(hls$5439,(i$5484%4))]);}else{false;;}}}()))),acc$5449));;return $5681(["+div"],[$5681(["+div"],[$5681(["error_type"],e$5415.name),$5681(["error_message"],e$5415.message)]),repr$4086(args$5433),highlight_locations$4094(locs$5440)]);}else{if((($5412$5429=$5838($5411$5421,"location"))&&((t0$5426=$5411$5421.location),$4031(Location$4089)(t0$5426)))){(loc$5500=t0$5426);return $5681(["+div"],[$5681(["+div"],[$5681(["error_type"],e$5415.name),$5681(["error_message"],e$5415.message)]),function(){if(e$5415.args){return repr$4086(e$5415.args);}else{return "";}}(),highlight_locations$4094([[loc$5500,"hl1"]]),$5681(["traceback"],(e$5415.stack||""))]);}else{if(($5412$5429&&((t0$5426 instanceof Array)&&((t1$5427=t0$5426.length),((t1$5427===4)&&(t0$5426[0]==="location")))))){(url$5506=t0$5426[1]);(start$5507=t0$5426[2]);(end$5508=t0$5426[3]);(data$5513=(((rval$5517=false)),(function(){try{(rval$5517=fs$4087.readFileSync(url$5506,"utf8"));}catch(excv$5523){var e$5529;(e$5529=excv$5523);(rval$5517=null);}}(),rval$5517)));;if(data$5513){(loc$5533=Location$4089(Source$4088(data$5513,url$5506),start$5507,end$5508));;return $5681(["+div"],[$5681(["+div"],[$5681(["error_type"],e$5415.name),$5681(["error_message"],e$5415.message)]),function(){if(e$5415.args){return repr$4086(e$5415.args);}else{return "";}}(),highlight_locations$4094([[loc$5533,"hl1"]]),$5681(["traceback"],(e$5415.stack||""))]);}else{return $5681(["+div"],$5681(["traceback"],(e$5415.stack||e$5415)));}}else{(other$5539=$5411$5421);return $5681(["traceback"],(e$5415.stack||e$5415));}}}});;(display_error$4100=function(e$5545){return __lt____gt__$4085(null,format_error$4099(e$5545));});;(exports["Source"]=Source$4088);(exports["Location"]=Location$4089);(exports["highlight"]=highlight$4090);(exports["highlight_locations"]=highlight_locations$4094);(exports["merge_locations"]=merge_locations$4096);(exports["<<:"]=__lt____lt____colon__$4097);(exports["++:"]=__plus____plus____colon__$4098);(exports["format_error"]=format_error$4099);(exports["display_error"]=display_error$4100);
