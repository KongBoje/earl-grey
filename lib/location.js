var $5155=function(type$5157){var f$5160;(f$5160=type$5157["::check"]);;if((f$5160===(void 0))){return function(value$5165){return (value$5165 instanceof type$5157);};}else{return function(value$5168){return f$5160.call(type$5157,value$5168);};}};
var $5170=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $5171=function($5172$5174){var ph$5178;(ph$5178=$5172$5174);;var $5176$5183;($5176$5183=ph$5178);;var bridge$5177$5188;var x$5192;(bridge$5177$5188=$5176$5183);if((((typeof(bridge$5177$5188)==="string")&&((x$5192=bridge$5177$5188),true))||((typeof(bridge$5177$5188)==="number")&&((x$5192=bridge$5177$5188),true)))){return ["value",x$5192];}else{var other$5199;(other$5199=$5176$5183);return other$5199["::serialize_ast"]();}};
var send$4995;(send$4995=function(obj$5000,$4998$5001){var ph$5005;var msg$5006;var t0$5008;(t0$5008=$4998$5001);(msg$5006=t0$5008);(ph$5005=t0$5008);;var $5003$5012;($5003$5012=ph$5005);;var bridge$5004$5017;(bridge$5004$5017=$5003$5012);if(((typeof(bridge$5004$5017)==="string")||(typeof(bridge$5004$5017)==="number"))){return obj$5000[msg$5006];}else{var other$5025;(other$5025=$5003$5012);return obj$5000["::send"](msg$5006);}});;(Array[":::project"]=function($5028$5030){var ph$5033;var value$5034;var t0$5036;(t0$5036=$5028$5030);(value$5034=t0$5036);(ph$5033=t0$5036);;var $5032$5040;($5032$5040=ph$5033);;if($5155(Array)($5032$5040)){return [true,value$5034];}else{$5032$5040;return [true,[value$5034]];}});(Array.prototype["::check"]=function(value$5054){if((value$5054 instanceof Array)){var i$5059;(i$5059=0);;$5057:for(;(i$5059<this.length);(i$5059++)){if(($5170(this,i$5059)!==$5170(value$5054,i$5059))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return this.slice(0);});(Array.prototype[":::project"]=function(value$5070){if((value$5070 instanceof Array)){var i$5075;(i$5075=0);;$5073:for(;(i$5075<this.length);(i$5075++)){if(($5170(this,i$5075)!==$5170(value$5070,i$5075))){return [true,[value$5070]];}}return [true,value$5070.slice(this.length)];}else{return [true,[value$5070]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($5171));});(RegExp.prototype["::check"]=function($5085$5087){var ph$5090;(ph$5090=$5085$5087);;var $5089$5095;($5089$5095=ph$5090);;var value$5103;if((typeof($5089$5095)==="string")){(value$5103=$5089$5095);if(value$5103.match(this)){return true;}else{return false;}}else{var other$5108;(other$5108=$5089$5095);return false;}});(RegExp.prototype[":::project"]=function($5110$5112){var ph$5115;(ph$5115=$5110$5112);;var $5114$5120;($5114$5120=ph$5115);;var value$5128;if((typeof($5114$5120)==="string")){(value$5128=$5114$5120);var $5131$5133;($5131$5133=value$5128.match(this));;var m$5141;if(($5131$5133===null)){(m$5141=$5131$5133);return [false,null];}else{var m$5146;(m$5146=$5131$5133);return [true,m$5146];}}else{var other$5150;(other$5150=$5114$5120);return [false,null];}});(Function.prototype["::send"]=function(args$5153){return this.apply(this,args$5153);});
var $6922=function(arr$6924){var results$6928;var l$6929;(results$6928=[]);;(l$6929=arr$6924.length);;var i$6937;(i$6937=0);;$6927:for(;(i$6937<l$6929);(i$6937++)){results$6928.push([i$6937,$5170(arr$6924,i$6937)]);}return results$6928;};
var $6944=function(dest$6946,values$6947){var k$6952;(k$6952=null);$6950:for(k$6952 in values$6947){if(values$6947.hasOwnProperty(k$6952)){(dest$6946[k$6952]=values$6947[k$6952]);}}return dest$6946;};
var $6753=function(){var $6754$6756;($6754$6756=function(tags$6760){var it$0$6763;(it$0$6763=function(){if((!$5155($6754$6756)(this))){return Object.create($6754$6756.prototype);}else{return this;}}());;(it$0$6763["tags"]=tags$6760);return it$0$6763;});;($6754$6756.prototype["create"]=function(){var $6772$6774;($6772$6774=arguments);;var t0$6779;var message$6783;var args$6784;(t0$6779=$6772$6774.length);if((t0$6779>=0)){(message$6783=function(){if((0>=t0$6779)){return "";}else{return $6772$6774[0];}}());(args$6784=Array.prototype.slice.call($6772$6774,1));var it$0$6788;(it$0$6788=this);;var self$6793;(self$6793=this);;var e$6798;(e$6798=Error(message$6783));;(e$6798["::tags"]=it$0$6788.tags);(e$6798["args"]=args$6784);var temp$6806;(temp$6806=$6922(args$6784));;var $length$6811;($length$6811=temp$6806.length);;var $index$6816;($index$6816=0);;$6799:for(;($index$6816<$length$6811);($index$6816++)){var m$6824;(m$6824=temp$6806[$index$6816]);;var t0$6829;var t1$6830;var i$6834;var arg$6835;(t0$6829=m$6824);if(((t0$6829 instanceof Array)&&((t1$6830=t0$6829.length),(t1$6830===2)))){(i$6834=t0$6829[0]);(arg$6835=t0$6829[1]);(e$6798[i$6834]=arg$6835);}else{$6740(m$6824);;}}(e$6798["length"]=args$6784.length);(e$6798["name"]=["E"].concat(it$0$6788.tags).join("."));return e$6798;}else{$6740($6772$6774);}});($6754$6756.prototype["::check"]=function(e$6846){var it$0$6849;(it$0$6849=this);;var self$6854;(self$6854=this);;var tags$6859;if(((!e$6846)||(!$5155(Error)(e$6846)))){return false;}(tags$6859=(e$6846["::tags"]||[]));;var temp$6868;(temp$6868=it$0$6849.tags);;var $length$6873;($length$6873=temp$6868.length);;var $index$6878;($index$6878=0);;$6860:for(;($index$6878<$length$6873);($index$6878++)){var m$6886;(m$6886=temp$6868[$index$6878]);;var tag$6894;(tag$6894=m$6886);if((tags$6859.indexOf(tag$6894)===-1)){return false;}else{false;;}}return true;});($6754$6756.prototype["::deconstruct"]=function(e$6902){var it$0$6905;(it$0$6905=this);;var self$6910;(self$6910=this);;return e$6902.args;});$6944($6754$6756,$6944(function(){var accum$6915;(accum$6915=({}));(accum$6915["::name"]="$6754");return accum$6915;}(),function(){var accum$6919;(accum$6919=({}));(accum$6919["::egclass"]=true);return accum$6919;}()));return $6754$6756;}();
var $6740=function(value$6742,url$6743,start$6744,end$6745){var err$6748;(err$6748=$6753(["match"]).create("Could not find a match for value",({"value":value$6742})));;if(url$6743){(err$6748["location"]=["location",url$6743,start$6744,end$6745]);}throw err$6748;};
var $7083=function(type$7085){return function(value$7088){var f$7091;(f$7091=type$7085[":::project"]);;if((f$7091===(void 0))){var f$7096;(f$7096=type$7085["::project"]);;if((f$7096===(void 0))){return [true,type$7085(value$7088)];}else{var rval$7101;(rval$7101=false);;try{(rval$7101=[true,f$7096(value$7088)]);}catch(excv$7107){var e$7113;(e$7113=excv$7107);(rval$7101=[false,null]);}return rval$7101;}}else{return f$7091.call(type$7085,value$7088);}};};
var $6956=function(){var $6957$6959;($6957$6959=function($6962$6965,$6963$6966){var classes$6968;var children$6969;var t0$6971;(t0$6971=$7083(Array)($6962$6965));if(t0$6971[0]){(classes$6968=t0$6971[1]);;}else{$6740($6962$6965);}var t0$6976;(t0$6976=$7083(Array)($6963$6966));if(t0$6976[0]){(children$6969=t0$6976[1]);;}else{$6740($6963$6966);}var it$0$6981;(it$0$6981=function(){if((!$5155($6957$6959)(this))){return Object.create($6957$6959.prototype);}else{return this;}}());;(it$0$6981["classes"]=classes$6968.sort());(it$0$6981["children"]=children$6969);return it$0$6981;});;$6944(function(){var accum$6989;(accum$6989=({}));(accum$6989["::check"]=function(x$6993){return ((x$6993&&x$6993.classes)&&x$6993.children);});return accum$6989;}(),$6944(function(){var accum$6996;(accum$6996=({}));(accum$6996["::deconstruct"]=function(x$7000){return [x$7000.classes,x$7000.children];});return accum$6996;}(),$6944(function(){var accum$7003;(accum$7003=({}));(accum$7003["::name"]="$6957");return accum$7003;}(),function(){var accum$7007;(accum$7007=({}));(accum$7007["::egclass"]=true);return accum$7007;}())));($6957$6959.prototype["::check"]=function(n$7013){var it$0$7016;(it$0$7016=this);;var self$7021;(self$7021=this);;var temp$7030;(temp$7030=it$0$7016.classes);;var $length$7035;($length$7035=temp$7030.length);;var $index$7040;($index$7040=0);;$7026:for(;($index$7040<$length$7035);($index$7040++)){var m$7048;(m$7048=temp$7030[$index$7040]);;var c$7056;(c$7056=m$7048);if((n$7013.classes.indexOf(c$7056)===-1)){return false;}else{false;;}}return true;});$6944($6957$6959,$6944(function(){var accum$7062;(accum$7062=({}));(accum$7062["::check"]=function(x$7066){return ((x$7066&&x$7066.classes)&&x$7066.children);});return accum$7062;}(),$6944(function(){var accum$7069;(accum$7069=({}));(accum$7069["::deconstruct"]=function(x$7073){return [x$7073.classes,x$7073.children];});return accum$7069;}(),$6944(function(){var accum$7076;(accum$7076=({}));(accum$7076["::name"]="$6957");return accum$7076;}(),function(){var accum$7080;(accum$7080=({}));(accum$7080["::egclass"]=true);return accum$7080;}()))));return $6957$6959;}();
var $7115=function(from$7117,to$7118){var rval$7122;(rval$7122=[]);;var i$7127;(i$7127=from$7117);;$7121:for(;(i$7127<=to$7118);(i$7127++)){rval$7122.push(i$7127);}return rval$7122;};
var $7134=function($7135$7137,key$7138){var ph$7142;(ph$7142=$7135$7137);;var $7140$7147;($7140$7147=ph$7142);;var bridge$7141$7152;(bridge$7141$7152=$7140$7147);if(((bridge$7141$7152===null)||(bridge$7141$7152===(void 0)))){return false;}else{var x$7160;if((typeof($7140$7147)==="string")){(x$7160=$7140$7147);return (key$7138 in String.prototype);}else{var x$7165;if((typeof($7140$7147)==="number")){(x$7165=$7140$7147);return (key$7138 in Number.prototype);}else{var x$7170;(x$7170=$7140$7147);return (key$7138 in x$7170);}}}};var accum$5356;var accum$5360;var accum$5586;var accum$5590;var $5202$5204;var binsearch$5205;var items$5206;var enumerate$5207;var $5203$5208;var __lt____gt__$5209;var repr$5210;var fs$5211;var Source$5212;var Location$5213;var highlight$5214;var highlight_lines$5215;var clamp$5216;var morsel$5217;var highlight_locations$5218;var highlight_locations_same_source$5219;var merge_locations$5220;var __lt____lt____colon__$5221;var __plus____plus____colon__$5222;var format_error$5223;var display_error$5224;($5202$5204=require("./util"));;(binsearch$5205=$5202$5204.binsearch);;(items$5206=$5202$5204.items);;(enumerate$5207=$5202$5204.enumerate);;($5203$5208=require("./pp"));;(__lt____gt__$5209=$5203$5208["<>"]);;(repr$5210=$5203$5208.repr);;(fs$5211=require("fs"));;(Source$5212=function(){var $index$5292;var $length$5287;var temp$5282;var curr$5274;var it$0$5268;var text$5263;var url$5264;var t0$5259;var $5252$5254;($5252$5254=arguments);;(t0$5259=$5252$5254.length);if(((t0$5259>=1)&&(t0$5259<=2))){(text$5263=$5252$5254[0]);(url$5264=function(){if((1>=t0$5259)){return false;}else{return $5252$5254[1];}}());(it$0$5268=function(){if((!$5155(Source$5212)(this))){return Object.create(Source$5212.prototype);}else{return this;}}());;(it$0$5268["text"]=text$5263);(it$0$5268["url"]=url$5264);(it$0$5268["counts"]=[]);(curr$5274=0);;(temp$5282=text$5263.split("\n"));;($length$5287=temp$5282.length);;($index$5292=0);;$5275:for(;($index$5292<$length$5287);($index$5292++)){var line$5308;var m$5300;(m$5300=temp$5282[$index$5292]);;(line$5308=m$5300);it$0$5268.counts.push(curr$5274);(curr$5274=(curr$5274+(line$5308.length+1)));}it$0$5268.counts.push(curr$5274);(it$0$5268["nlines"]=(it$0$5268.counts.length-1));return it$0$5268;}else{$6740($5252$5254);}});;(Source$5212.prototype["linecol"]=function(pos$5317){var line$5330;var col$5331;var self$5325;var it$0$5320;(it$0$5320=this);;(self$5325=this);;(line$5330=binsearch$5205(it$0$5320.counts,pos$5317));;(col$5331=(pos$5317-$5170(it$0$5320.counts,(line$5330-1))));;return [line$5330,col$5331];});(Source$5212.prototype["highlight_lines"]=function(l1$5341,l2$5342,spans$5343){var self$5351;var it$0$5346;(it$0$5346=this);;(self$5351=this);;return highlight_lines$5215(it$0$5346.text,it$0$5346.counts,[(l1$5341-1),(l2$5342-1)],spans$5343);});$6944(Source$5212,$6944(((accum$5356=({})),((accum$5356["::name"]="Source"),accum$5356)),((accum$5360=({})),((accum$5360["::egclass"]=true),accum$5360))));Source$5212;(Location$5213=function(source$5366,start$5367,end$5368){var it$0$5371;(it$0$5371=function(){if((!$5155(Location$5213)(this))){return Object.create(Location$5213.prototype);}else{return this;}}());;(it$0$5371["source"]=(source$5366||Source$5212("",null)));(it$0$5371["start"]=start$5367);(it$0$5371["end"]=end$5368);return it$0$5371;});;(Location$5213.prototype["text"]=function(){var self$5388;var it$0$5383;(it$0$5383=this);;(self$5388=this);;return it$0$5383.source.text.slice(it$0$5383.start,it$0$5383.end);});(Location$5213.prototype["linerange"]=function(){var l2$5437;var t0$5428;var t1$5429;var l1$5420;var $5403$5421;var t0$5414;var t1$5415;var t2$5416;var $5402$5409;var self$5404;var it$0$5397;(it$0$5397=this);;(self$5404=this);;($5402$5409=it$0$5397.linecol());;if((($5402$5409 instanceof Array)&&((t0$5414=$5402$5409.length),((t0$5414===2)&&((t1$5415=$5402$5409[0]),((t1$5415 instanceof Array)&&((t2$5416=t1$5415.length),(t2$5416===2)))))))){(l1$5420=t1$5415[0]);t1$5415[1];($5403$5421=$5402$5409[1]);if(($5403$5421===null)){return [l1$5420,l1$5420];}else{(t0$5428=$5403$5421);if(((t0$5428 instanceof Array)&&((t1$5429=t0$5428.length),(t1$5429===2)))){(l2$5437=t0$5428[0]);t0$5428[1];return [l1$5420,l2$5437];}else{$6740($5403$5421,"/home/olivier/git/earl-grey/src/location.eg",972,977);}}}else{$6740($5402$5409);}});(Location$5213.prototype["linecol"]=function(){var start$5460;var end$5461;var self$5455;var it$0$5450;(it$0$5450=this);;(self$5455=this);;(start$5460=it$0$5450.source.linecol(it$0$5450.start));;(end$5461=function(){if((it$0$5450.start===it$0$5450.end)){return null;}else{return it$0$5450.source.linecol((it$0$5450.end-1));}}());;return [start$5460,end$5461];});(Location$5213.prototype["ref"]=function(){var otherwise$5549;var $5530$5538;var $5529$5532;var l2$5521;var c2$5522;var t0$5510;var t1$5511;var t2$5512;var t3$5513;var l1$5498;var c1$5499;var $5479$5500;var t0$5490;var t1$5491;var t2$5492;var t3$5493;var t4$5494;var $5478$5485;var self$5480;var it$0$5473;(it$0$5473=this);;(self$5480=this);;($5478$5485=it$0$5473.linecol());;if((($5478$5485 instanceof Array)&&((t0$5490=$5478$5485.length),((t0$5490===2)&&((t1$5491=$5478$5485[0]),((t1$5491 instanceof Array)&&((t2$5492=t1$5491.length),((t2$5492===2)&&((t3$5493=[true,String(t1$5491[0])]),(t3$5493[0]&&((l1$5498=t3$5493[1]),((t4$5494=[true,String(t1$5491[1])]),t4$5494[0])))))))))))){(c1$5499=t4$5494[1]);($5479$5500=$5478$5485[1]);if(($5479$5500===null)){return ((l1$5498+":")+c1$5499);}else{(t0$5510=$5479$5500);if(((t0$5510 instanceof Array)&&((t1$5511=t0$5510.length),((t1$5511===2)&&((t2$5512=[true,String(t0$5510[0])]),(t2$5512[0]&&((l2$5521=t2$5512[1]),((t3$5513=[true,String(t0$5510[1])]),t3$5513[0])))))))){(c2$5522=t3$5513[1]);($5529$5532=null);;$5529$5532;if(((l1$5498===l2$5521)&&(c1$5499===c2$5522))){return ((l1$5498+":")+c1$5499);}else{if((l1$5498===l2$5521)){return ((((l1$5498+":")+c1$5499)+"-")+c2$5522);}else{(otherwise$5549=$5529$5532);return ((((((l1$5498+":")+c1$5499)+"-")+l1$5498)+":")+c2$5522);}}}else{$6740($5479$5500,"/home/olivier/git/earl-grey/src/location.eg",1314,1319);}}}else{$6740($5478$5485);}});(Location$5213.prototype["highlight"]=function(){var self$5579;var it$0$5574;var cls$5569;var context$5570;var t0$5565;var $5558$5560;($5558$5560=arguments);;(t0$5565=$5558$5560.length);if(((t0$5565>=0)&&(t0$5565<=2))){(cls$5569=function(){if((0>=t0$5565)){return "hl1";}else{return $5558$5560[0];}}());(context$5570=function(){if((1>=t0$5565)){return 0;}else{return $5558$5560[1];}}());(it$0$5574=this);;(self$5579=this);;return highlight_locations$5218([[it$0$5574,cls$5569]],context$5570);}else{$6740($5558$5560);}});$6944(Location$5213,$6944(((accum$5586=({})),((accum$5586["::name"]="Location"),accum$5586)),((accum$5590=({})),((accum$5590["::egclass"]=true),accum$5590))));Location$5213;(highlight$5214=function(){var $index$5630;var $length$5625;var temp$5620;var acc$5615;var text$5607;var spans$5608;var offset$5609;var t0$5603;var $5596$5598;($5596$5598=arguments);;(t0$5603=$5596$5598.length);if(((t0$5603>=2)&&(t0$5603<=3))){(text$5607=$5596$5598[0]);(spans$5608=$5596$5598[1]);(offset$5609=function(){if((2>=t0$5603)){return 0;}else{return $5596$5598[2];}}());return $6956([],(((acc$5615=[])),(((temp$5620=morsel$5217(spans$5608))),((($length$5625=temp$5620.length)),((($index$5630=0)),function(){$5612:for(;($index$5630<$length$5625);($index$5630++)){var xstart$5655;var xend$5656;var start$5648;var end$5649;var attributes$5650;var t0$5643;var t1$5644;var m$5638;(m$5638=temp$5620[$index$5630]);;(t0$5643=m$5638);if(((t0$5643 instanceof Array)&&((t1$5644=t0$5643.length),(t1$5644===3)))){(start$5648=t0$5643[0]);(end$5649=t0$5643[1]);(attributes$5650=t0$5643[2]);acc$5615.push((((xstart$5655=Math.max((start$5648-offset$5609),0))),((xend$5656=Math.min((end$5649-offset$5609),text$5607.length))),$6956(attributes$5650.slice(0,1),[text$5607.slice(xstart$5655,xend$5656)])));}else{$6740(m$5638,"/home/olivier/git/earl-grey/src/location.eg",1861,2073);;}}}()))),acc$5615));}else{$6740($5596$5598);}});;(highlight_lines$5215=function(text$5672,linelocs$5673,$5670$5674,spans$5675){var t0$5680;var t1$5681;var $index$5704;var $length$5699;var temp$5694;var acc$5689;var l1$5677;var l2$5678;(t0$5680=$5670$5674);if(((t0$5680 instanceof Array)&&((t1$5681=t0$5680.length),(t1$5681===2)))){(l1$5677=t0$5680[0]);(l2$5678=t0$5680[1]);;}else{$6740($5670$5674);}return $6956(["+span"],(((acc$5689=[])),(((temp$5694=$7115(l1$5677,l2$5678))),((($length$5699=temp$5694.length)),((($index$5704=0)),function(){$5686:for(;($index$5704<$length$5699);($index$5704++)){var start$5723;var end$5724;var lineno$5720;var m$5712;(m$5712=temp$5694[$index$5704]);;(lineno$5720=m$5712);acc$5689.push((((start$5723=$5170(linelocs$5673,lineno$5720))),((end$5724=$5170(linelocs$5673,(lineno$5720+1)))),$6956(["+span"],[$6956(["lineno"],(lineno$5720+1)),$6956(["source"],highlight$5214(text$5672,[[start$5723,end$5724,[]]].concat(clamp$5216(spans$5675,start$5723,end$5724))))])));}}()))),acc$5689));});;(clamp$5216=function(spans$5735,bot$5736,top$5737){var $index$5757;var $length$5752;var temp$5747;var acc$5742;(acc$5742=[]);;(temp$5747=spans$5735);;($length$5752=temp$5747.length);;($index$5757=0);;$5739:for(;($index$5757<$length$5752);($index$5757++)){var start$5775;var end$5776;var attr$5777;var t0$5770;var t1$5771;var m$5765;(m$5765=temp$5747[$index$5757]);;(t0$5770=m$5765);if(((t0$5770 instanceof Array)&&((t1$5771=t0$5770.length),((t1$5771===3)&&((start$5775=t0$5770[0]),((end$5776=t0$5770[1]),((attr$5777=t0$5770[2]),((end$5776>=bot$5736)&&(start$5775<=top$5737))))))))){acc$5742.push([Math.max(start$5775,bot$5736),Math.min(end$5776,top$5737),attr$5777]);}else{false;;}}return acc$5742;});;(morsel$5217=function(spans$5790){var jump$5793;var jumptill$5794;var process$5795;var thespans$5796;(jump$5793=function(active$5800,bot$5801,top$5802){var $index$5830;var $length$5825;var temp$5820;var acc$5815;var $index$5870;var $length$5865;var temp$5860;var e$5805;var attributes$5806;(e$5805=$5170(Math.min,[top$5802].concat((((acc$5815=[])),(((temp$5820=active$5800)),((($length$5825=temp$5820.length)),((($index$5830=0)),function(){$5812:for(;($index$5830<$length$5825);($index$5830++)){var x$5848;var t0$5843;var t1$5844;var m$5838;(m$5838=temp$5820[$index$5830]);;(t0$5843=m$5838);if(((t0$5843 instanceof Array)&&((t1$5844=t0$5843.length),(t1$5844===3)))){t0$5843[0];(x$5848=t0$5843[1]);t0$5843[2];acc$5815.push(x$5848);}else{$6740(m$5838,"/home/olivier/git/earl-grey/src/location.eg",3396,3439);;}}}()))),acc$5815))));;(attributes$5806=[]);;(temp$5860=active$5800);;($length$5865=temp$5860.length);;($index$5870=0);;$5807:for(;($index$5870<$length$5865);($index$5870++)){var X$5888;var t0$5883;var t1$5884;var m$5878;(m$5878=temp$5860[$index$5870]);;(t0$5883=m$5878);if(((t0$5883 instanceof Array)&&((t1$5884=t0$5883.length),(t1$5884===3)))){t0$5883[0];t0$5883[1];(X$5888=t0$5883[2]);(attributes$5806=attributes$5806.concat(X$5888));}else{$6740(m$5878,"/home/olivier/git/earl-grey/src/location.eg",3461,3502);;}}return [e$5805,[bot$5801,e$5805,attributes$5806]];});;(jumptill$5794=function(active$5898,bot$5899,top$5900){var t0$5909;var t1$5910;var $index$5935;var $length$5930;var temp$5925;var acc$5920;var t0$5966;var t1$5967;var newbot$5903;var span$5904;var newactive$5905;var spans$5906;var remainder$5907;if((bot$5899===top$5900)){return [[],active$5898];}else{(t0$5909=jump$5793(active$5898,bot$5899,top$5900));if(((t0$5909 instanceof Array)&&((t1$5910=t0$5909.length),(t1$5910===2)))){(newbot$5903=t0$5909[0]);(span$5904=t0$5909[1]);;}else{$6740(jump$5793(active$5898,bot$5899,top$5900),"/home/olivier/git/earl-grey/src/location.eg",3738,3772);}(newactive$5905=(((acc$5920=[])),(((temp$5925=active$5898)),((($length$5930=temp$5925.length)),((($index$5935=0)),function(){$5917:for(;($index$5935<$length$5930);($index$5935++)){var x$5953;var e$5954;var attr$5955;var t0$5948;var t1$5949;var m$5943;(m$5943=temp$5925[$index$5935]);;(t0$5948=m$5943);(x$5953=t0$5948);if(((t0$5948 instanceof Array)&&((t1$5949=t0$5948.length),((t1$5949===3)&&(t0$5948[0],((e$5954=t0$5948[1]),((attr$5955=t0$5948[2]),(e$5954>newbot$5903)))))))){acc$5920.push(x$5953);}else{false;;}}}()))),acc$5920));;(t0$5966=jumptill$5794(newactive$5905,newbot$5903,top$5900));if(((t0$5966 instanceof Array)&&((t1$5967=t0$5966.length),(t1$5967===2)))){(spans$5906=t0$5966[0]);(remainder$5907=t0$5966[1]);;}else{$6740(jumptill$5794(newactive$5905,newbot$5903,top$5900),"/home/olivier/git/earl-grey/src/location.eg",3883,3927);}return [[span$5904].concat(spans$5906),remainder$5907];}});;(process$5795=function(start$5976,active$5977,rem$5978){var $index$6043;var $length$6038;var temp$6033;var acc$6028;var t0$6072;var t1$6073;var top$6020;var bot$6021;var spans$6022;var t0$6100;var t1$6101;var spans$6097;var newactive$6098;var start$6080;var active$6081;var next$6082;var target$6083;var end$6084;var attr$6085;var rest$6086;var start$6011;var active$6012;var $5981$5996;var $5982$5997;var $5983$5998;var t0$5990;var t1$5991;var t2$5992;var t3$5993;var t4$5994;var $5980$5985;($5980$5985=[start$5976,active$5977,rem$5978]);;if((($5981$5996=($5980$5985 instanceof Array))&&((t0$5990=$5980$5985.length),(($5983$5998=(t0$5990===3))&&($5980$5985[0],((t1$5991=$5980$5985[1]),((t1$5991 instanceof Array)&&((t2$5992=t1$5991.length),((t2$5992===0)&&((t3$5993=$5980$5985[2]),((t3$5993 instanceof Array)&&((t4$5994=t3$5993.length),(t4$5994===0))))))))))))){return [];}else{if(($5983$5998&&((start$6011=$5980$5985[0]),((active$6012=$5980$5985[1]),((t1$5991=$5980$5985[2]),((t1$5991 instanceof Array)&&((t2$5992=t1$5991.length),(t2$5992===0)))))))){(top$6020=$5170(Math.max,(((acc$6028=[])),(((temp$6033=active$6012)),((($length$6038=temp$6033.length)),((($index$6043=0)),function(){$6025:for(;($index$6043<$length$6038);($index$6043++)){var e$6061;var t0$6056;var t1$6057;var m$6051;(m$6051=temp$6033[$index$6043]);;(t0$6056=m$6051);if(((t0$6056 instanceof Array)&&((t1$6057=t0$6056.length),(t1$6057===3)))){t0$6056[0];(e$6061=t0$6056[1]);t0$6056[2];acc$6028.push(e$6061);}else{$6740(m$6051,"/home/olivier/git/earl-grey/src/location.eg",4103,4141);;}}}()))),acc$6028)));;(bot$6021=Math.min(start$6011,top$6020));;(t0$6072=jumptill$5794(active$6012,start$6011,top$6020));if(((t0$6072 instanceof Array)&&((t1$6073=t0$6072.length),(t1$6073===2)))){(spans$6022=t0$6072[0]);t0$6072[1];;}else{$6740(jumptill$5794(active$6012,start$6011,top$6020),"/home/olivier/git/earl-grey/src/location.eg",4190,4228);}return spans$6022;}else{if(($5983$5998&&((start$6080=$5980$5985[0]),((active$6081=$5980$5985[1]),((t1$5991=$5980$5985[2]),((t1$5991 instanceof Array)&&((t2$5992=t1$5991.length),((t2$5992>=1)&&((t3$5993=t1$5991[0]),((next$6082=t3$5993),((t3$5993 instanceof Array)&&((t4$5994=t3$5993.length),(t4$5994===3))))))))))))){(target$6083=t3$5993[0]);(end$6084=t3$5993[1]);(attr$6085=t3$5993[2]);(rest$6086=Array.prototype.slice.call(t1$5991,1));(t0$6100=jumptill$5794(active$6081,start$6080,target$6083));if(((t0$6100 instanceof Array)&&((t1$6101=t0$6100.length),(t1$6101===2)))){(spans$6097=t0$6100[0]);(newactive$6098=t0$6100[1]);;}else{$6740(jumptill$5794(active$6081,start$6080,target$6083),"/home/olivier/git/earl-grey/src/location.eg",4328,4369);}return spans$6097.concat(process$5795(target$6083,[next$6082].concat(newactive$6098),rest$6086));}else{$6740($5980$5985);}}}});;(thespans$5796=spans$5790.sort(function($6111$6114,$6112$6115){var t0$6122;var t1$6123;var t0$6129;var t1$6130;var s1$6117;var e1$6118;var s2$6119;var e2$6120;(t0$6122=$6111$6114);if(((t0$6122 instanceof Array)&&((t1$6123=t0$6122.length),(t1$6123===3)))){(s1$6117=t0$6122[0]);(e1$6118=t0$6122[1]);t0$6122[2];;}else{$6740($6111$6114);}(t0$6129=$6112$6115);if(((t0$6129 instanceof Array)&&((t1$6130=t0$6129.length),(t1$6130===3)))){(s2$6119=t0$6129[0]);(e2$6120=t0$6129[1]);t0$6129[2];;}else{$6740($6112$6115);}if((s1$6117===s2$6119)){return (e1$6118-e2$6120);}else{return (s1$6117-s2$6119);}}));;return process$5795(thespans$5796[0][0],[],thespans$5796);});;(highlight_locations$5218=function(){var $index$6174;var $length$6169;var temp$6164;var $index$6223;var $length$6218;var temp$6213;var acc$6208;var srcs$6156;var locations$6151;var context$6152;var t0$6147;var $6140$6142;($6140$6142=arguments);;(t0$6147=$6140$6142.length);if(((t0$6147>=1)&&(t0$6147<=2))){(locations$6151=$6140$6142[0]);(context$6152=function(){if((1>=t0$6147)){return 0;}else{return $6140$6142[1];}}());(srcs$6156=({}));;(temp$6164=locations$6151);;($length$6169=temp$6164.length);;($index$6174=0);;$6157:for(;($index$6174<$length$6169);($index$6174++)){var key$6198;var loc$6192;var cls$6193;var t0$6187;var t1$6188;var m$6182;(m$6182=temp$6164[$index$6174]);;(t0$6187=m$6182);if(((t0$6187 instanceof Array)&&((t1$6188=t0$6187.length),(t1$6188===2)))){(loc$6192=t0$6187[0]);(cls$6193=t0$6187[1]);(key$6198=String((loc$6192.source&&loc$6192.source.url)));;if((!$5170(srcs$6156,key$6198))){(srcs$6156[key$6198]=[]);}$5170(srcs$6156,key$6198).push([loc$6192,cls$6193]);}else{$6740(m$6182,"/home/olivier/git/earl-grey/src/location.eg",4697,4867);;}}return $6956(["+div"],(((acc$6208=[])),(((temp$6213=items$5206(srcs$6156))),((($length$6218=temp$6213.length)),((($index$6223=0)),function(){$6205:for(;($index$6223<$length$6218);($index$6223++)){var locs$6241;var t0$6236;var t1$6237;var m$6231;(m$6231=temp$6213[$index$6223]);;(t0$6236=m$6231);if(((t0$6236 instanceof Array)&&((t1$6237=t0$6236.length),(t1$6237===2)))){t0$6236[0];(locs$6241=t0$6236[1]);acc$6208.push(highlight_locations_same_source$5219(locs$6241,context$6152));}else{$6740(m$6231,"/home/olivier/git/earl-grey/src/location.eg",4872,4966);;}}}()))),acc$6208));}else{$6740($6140$6142);}});;(highlight_locations_same_source$5219=function(){var $index$6295;var $length$6290;var temp$6285;var acc$6280;var t0$6325;var t1$6326;var $index$6355;var $length$6350;var temp$6345;var acc$6340;var $index$6398;var $length$6393;var temp$6388;var acc$6383;var loc$6269;var src$6270;var l1$6271;var l2$6272;var first$6273;var last$6274;var locations$6264;var context$6265;var t0$6260;var $6253$6255;($6253$6255=arguments);;(t0$6260=$6253$6255.length);if(((t0$6260>=1)&&(t0$6260<=2))){(locations$6264=$6253$6255[0]);(context$6265=function(){if((1>=t0$6260)){return 0;}else{return $6253$6255[1];}}());(loc$6269=merge_locations$5220((((acc$6280=[])),(((temp$6285=locations$6264)),((($length$6290=temp$6285.length)),((($index$6295=0)),function(){$6277:for(;($index$6295<$length$6290);($index$6295++)){var x$6313;var cls$6314;var t0$6308;var t1$6309;var m$6303;(m$6303=temp$6285[$index$6295]);;(t0$6308=m$6303);if(((t0$6308 instanceof Array)&&((t1$6309=t0$6308.length),(t1$6309===2)))){(x$6313=t0$6308[0]);(cls$6314=t0$6308[1]);acc$6280.push(x$6313);}else{$6740(m$6303,"/home/olivier/git/earl-grey/src/location.eg",5049,5077);;}}}()))),acc$6280)));;(src$6270=loc$6269.source);;(t0$6325=loc$6269.linerange());if(((t0$6325 instanceof Array)&&((t1$6326=t0$6325.length),(t1$6326===2)))){(l1$6271=t0$6325[0]);(l2$6272=t0$6325[1]);;}else{$6740(loc$6269.linerange(),"/home/olivier/git/earl-grey/src/location.eg",5113,5132);}(first$6273=Math.max(1,(l1$6271-context$6265)));;(last$6274=Math.min(src$6270.nlines,(l2$6272+context$6265)));;return $6956(["+div","location"],[$6956(["+div","source"],[$6956(["sourcefile"],(src$6270.url||"???")),(((acc$6340=[])),(((temp$6345=locations$6264)),((($length$6350=temp$6345.length)),((($index$6355=0)),function(){$6337:for(;($index$6355<$length$6350);($index$6355++)){var loc$6373;var cls$6374;var t0$6368;var t1$6369;var m$6363;(m$6363=temp$6345[$index$6355]);;(t0$6368=m$6363);if(((t0$6368 instanceof Array)&&((t1$6369=t0$6368.length),(t1$6369===2)))){(loc$6373=t0$6368[0]);(cls$6374=t0$6368[1]);acc$6340.push($6956([cls$6374,"sourcepos"],loc$6373.ref()));}else{$6740(m$6363,"/home/olivier/git/earl-grey/src/location.eg",5297,5367);;}}}()))),acc$6340)]),src$6270.highlight_lines(first$6273,last$6274,(((acc$6383=[])),(((temp$6388=locations$6264)),((($length$6393=temp$6388.length)),((($index$6398=0)),function(){$6380:for(;($index$6398<$length$6393);($index$6398++)){var loc$6416;var cls$6417;var t0$6411;var t1$6412;var m$6406;(m$6406=temp$6388[$index$6398]);;(t0$6411=m$6406);if(((t0$6411 instanceof Array)&&((t1$6412=t0$6411.length),(t1$6412===2)))){(loc$6416=t0$6411[0]);(cls$6417=t0$6411[1]);acc$6383.push([loc$6416.start,loc$6416.end,[cls$6417]]);}else{$6740(m$6406,"/home/olivier/git/earl-grey/src/location.eg",5422,5480);;}}}()))),acc$6383))]);}else{$6740($6253$6255);}});;(merge_locations$5220=function($6428$6430){var $index$6487;var $length$6482;var temp$6477;var acc$6472;var $index$6526;var $length$6521;var temp$6516;var acc$6511;var start$6465;var end$6466;var locs$6461;var loc$6456;var $6433$6447;var $6434$6448;var t0$6445;var $6432$6440;var ph$6435;(ph$6435=$6428$6430);;($6432$6440=ph$6435);;if((($6433$6447=($6432$6440 instanceof Array))&&((t0$6445=$6432$6440.length),(t0$6445===0)))){return Location$5213(null,0,0);}else{if(($6433$6447&&(t0$6445===1))){(loc$6456=$6432$6440[0]);return loc$6456;}else{if(($6433$6447&&(t0$6445>=0))){(locs$6461=Array.prototype.slice.call($6432$6440,0));(start$6465=$5170(Math.min,(((acc$6472=[])),(((temp$6477=locs$6461)),((($length$6482=temp$6477.length)),((($index$6487=0)),function(){$6469:for(;($index$6487<$length$6482);($index$6487++)){var loc$6503;var m$6495;(m$6495=temp$6477[$index$6487]);;(loc$6503=m$6495);acc$6472.push(loc$6503.start);}}()))),acc$6472)));;(end$6466=$5170(Math.max,(((acc$6511=[])),(((temp$6516=locs$6461)),((($length$6521=temp$6516.length)),((($index$6526=0)),function(){$6508:for(;($index$6526<$length$6521);($index$6526++)){var loc$6542;var m$6534;(m$6534=temp$6516[$index$6526]);;(loc$6542=m$6534);acc$6511.push(loc$6542.end);}}()))),acc$6511)));;return Location$5213(locs$6461[0].source,start$6465,end$6466);}else{$6740($6432$6440);}}}});;(__lt____lt____colon__$5221=function(x$6551,y$6552){if((!$5155(Location$5213)(x$6551.location))){(x$6551["location"]=function(){if(((!y$6552)||$5155(Location$5213)(y$6552))){return y$6552;}else{return y$6552.location;}}());}return x$6551;});;(__plus____plus____colon__$5222=function(x$6560,y$6561){var rval$6565;(x$6560=function(){if(((!x$6560)||$5155(Location$5213)(x$6560))){return x$6560;}else{return x$6560.location;}}());(y$6561=function(){if(((!y$6561)||$5155(Location$5213)(y$6561))){return y$6561;}else{return y$6561.location;}}());(rval$6565=false);;try{(rval$6565=merge_locations$5220([x$6560,y$6561]));}catch(excv$6571){var e$6577;(e$6577=excv$6571);(rval$6565=(void 0));}return rval$6565;});;(format_error$5223=function(){var $index$6653;var $length$6648;var temp$6643;var acc$6638;var hls$6628;var locs$6629;var rval$6706;var loc$6722;var data$6702;var other$6728;var url$6695;var start$6696;var end$6697;var loc$6689;var args$6622;var fmt_args$6613;var $6585$6609;var $6586$6610;var $6587$6611;var t0$6605;var t1$6606;var t2$6607;var e$6599;var context$6600;var $6584$6601;var t0$6594;var t1$6595;var $6583$6589;($6583$6589=arguments);;(t0$6594=$6583$6589.length);if(((t0$6594>=1)&&(t0$6594<=2))){(t1$6595=$6583$6589[0]);(e$6599=t1$6595);($6584$6601=t1$6595);(context$6600=function(){if((1>=t0$6594)){return 0;}else{return $6583$6589[1];}}());(fmt_args$6613=function(e$6617){if((e$6617.args&&e$6617.args.length)){return $6956(["error_args"],repr$5210(e$6617.args));}else{return "";}});;(t0$6605=$6584$6601);if(($5155($6753(["syntax"]))(t0$6605)&&($7134(t0$6605,"args")&&((t1$6606=t0$6605.args),((t1$6606 instanceof Array)&&((t2$6607=t1$6606.length),(t2$6607===1))))))){(args$6622=t1$6606[0]);(hls$6628=["hl1","hl2","hl3","hl4"]);;(locs$6629=(((acc$6638=[])),(((temp$6643=enumerate$5207(items$5206(args$6622)))),((($length$6648=temp$6643.length)),((($index$6653=0)),function(){$6635:for(;($index$6653<$length$6648);($index$6653++)){var i$6673;var key$6674;var arg$6675;var t0$6666;var t1$6667;var t2$6668;var t3$6669;var m$6661;(m$6661=temp$6643[$index$6653]);;(t0$6666=m$6661);if(((t0$6666 instanceof Array)&&((t1$6667=t0$6666.length),((t1$6667===2)&&((i$6673=t0$6666[0]),((t2$6668=t0$6666[1]),((t2$6668 instanceof Array)&&((t3$6669=t2$6668.length),((t3$6669===2)&&((key$6674=t2$6668[0]),((arg$6675=t2$6668[1]),(arg$6675&&arg$6675.location)))))))))))){acc$6638.push([arg$6675.location,$5170(hls$6628,(i$6673%4))]);}else{false;;}}}()))),acc$6638));;return $6956(["+div"],[$6956(["error"],[$6956(["error_type"],e$6599.name),$6956(["error_message"],e$6599.message)]),$6956(["error_args","syntax"],repr$5210(args$6622)),highlight_locations$5218(locs$6629,context$6600)]);}else{if((($6586$6610=$7134(t0$6605,"location"))&&((t1$6606=t0$6605.location),$5155(Location$5213)(t1$6606)))){(loc$6689=t1$6606);return $6956(["+div"],[$6956(["error"],[$6956(["error_type"],e$6599.name),$6956(["error_message"],e$6599.message)]),fmt_args$6613(e$6599),highlight_locations$5218([[loc$6689,"hl1"]],context$6600),$6956(["traceback"],(e$6599.stack||""))]);}else{if(($6586$6610&&((t1$6606 instanceof Array)&&((t2$6607=t1$6606.length),((t2$6607===4)&&(t1$6606[0]==="location")))))){(url$6695=t1$6606[1]);(start$6696=t1$6606[2]);(end$6697=t1$6606[3]);(data$6702=(((rval$6706=false)),(function(){try{(rval$6706=fs$5211.readFileSync(url$6695,"utf8"));}catch(excv$6712){var e$6718;(e$6718=excv$6712);(rval$6706=null);}}(),rval$6706)));;if(data$6702){(loc$6722=Location$5213(Source$5212(data$6702,url$6695),start$6696,end$6697));;return $6956(["+div"],[$6956(["error"],[$6956(["error_type"],e$6599.name),$6956(["error_message"],e$6599.message)]),fmt_args$6613(e$6599),highlight_locations$5218([[loc$6722,"hl1"]],context$6600),$6956(["traceback"],($6956([],e$6599.stack)||""))]);}else{return $6956(["+div"],[$6956(["error"],[$6956(["error_type"],e$6599.name),$6956(["error_message"],e$6599.message)]),fmt_args$6613(e$6599),$6956(["traceback"],($6956([],e$6599.stack)||e$6599))]);}}else{(other$6728=$6584$6601);return $6956(["+div"],[$6956(["error"],[$6956(["error_type"],e$6599.name),$6956(["error_message"],e$6599.message)]),fmt_args$6613(e$6599),$6956(["traceback"],$6956([],e$6599.stack))]);}}}}else{$6740($6583$6589);}});;(display_error$5224=function(e$6736){return __lt____gt__$5209(null,format_error$5223(e$6736));});;(exports["Source"]=Source$5212);(exports["Location"]=Location$5213);(exports["highlight"]=highlight$5214);(exports["highlight_locations"]=highlight_locations$5218);(exports["merge_locations"]=merge_locations$5220);(exports["<<:"]=__lt____lt____colon__$5221);(exports["++:"]=__plus____plus____colon__$5222);(exports["format_error"]=format_error$5223);(exports["display_error"]=display_error$5224);
