var $7763=function(type$7766){var f$7770;(f$7770=type$7766["::check"]);if((f$7770===(void 0))){return function(value$7776){return (value$7776 instanceof type$7766);};}else{return function(value$7780){return f$7770.call(type$7766,value$7780);};}};
var $7782=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $7783=function(dest$7786,values$7787){var k$7792;(k$7792=null);$7790:for(k$7792 in values$7787){if(values$7787.hasOwnProperty(k$7792)){(dest$7786[k$7792]=values$7787[k$7792]);}}return dest$7786;};
var $7800=function($7802$7805){var ph$7811;(ph$7811=$7802$7805);var $7807$7817;($7807$7817=ph$7811);var bridge$7809$7822;var x$7826;(bridge$7809$7822=$7807$7817);if((((typeof(bridge$7809$7822)==="string")&&((x$7826=bridge$7809$7822),true))||((typeof(bridge$7809$7822)==="number")&&((x$7826=bridge$7809$7822),true)))){return ["value",x$7826];}else{var other$7837;(other$7837=$7807$7817);return other$7837["::serialize_ast"]();}};
var send$7537;(send$7537=function(obj$7544,$7541$7545){var ph$7551;var msg$7552;var t0$7554;(t0$7554=$7541$7545);(msg$7552=t0$7554);(ph$7551=t0$7554);var $7547$7563;($7547$7563=ph$7551);var bridge$7549$7568;(bridge$7549$7568=$7547$7563);if(((typeof(bridge$7549$7568)==="string")||(typeof(bridge$7549$7568)==="number"))){return obj$7544[msg$7552];}else{var other$7580;(other$7580=$7547$7563);return obj$7544["::send"](msg$7552);}});(Array[":::project"]=function($7586$7589){var ph$7594;var value$7595;var t0$7597;(t0$7597=$7586$7589);(value$7595=t0$7597);(ph$7594=t0$7597);var $7591$7606;($7591$7606=ph$7594);if($7763(Array)($7591$7606)){return [true,value$7595];}else{$7591$7606;return [true,[value$7595]];}});(Array.prototype["::check"]=function(value$7624){if((value$7624 instanceof Array)){var i$7630;(i$7630=0);$7627:for(;(i$7630<this.length);(i$7630++)){if(($7782(this,i$7630)!==$7782(value$7624,i$7630))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $7783(this.slice(0),this);});(Array.prototype[":::project"]=function(value$7649){if((value$7649 instanceof Array)){var i$7655;(i$7655=0);$7652:for(;(i$7655<this.length);(i$7655++)){if(($7782(this,i$7655)!==$7782(value$7649,i$7655))){return [true,[value$7649]];}}return [true,value$7649.slice(this.length)];}else{return [true,[value$7649]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($7800));});(RegExp.prototype["::check"]=function($7673$7676){var ph$7681;(ph$7681=$7673$7676);var $7678$7687;($7678$7687=ph$7681);var value$7695;if((typeof($7678$7687)==="string")){(value$7695=$7678$7687);if(value$7695.match(this)){return true;}else{return false;}}else{var other$7700;(other$7700=$7678$7687);return false;}});(RegExp.prototype[":::project"]=function($7706$7709){var ph$7714;(ph$7714=$7706$7709);var $7711$7720;($7711$7720=ph$7714);var value$7728;if((typeof($7711$7720)==="string")){(value$7728=$7711$7720);var $7731$7736;($7731$7736=value$7728.match(this));var m$7744;if(($7731$7736===null)){(m$7744=$7731$7736);return [false,null];}else{var m$7749;(m$7749=$7731$7736);return [true,m$7749];}}else{var other$7753;(other$7753=$7711$7720);return [false,null];}});(Function.prototype["::send"]=function(args$7760){return this.apply(this,args$7760);});
var $10292=function(arr$10295){var results$10301;var l$10302;(results$10301=[]);(l$10302=arr$10295.length);var i$10311;(i$10311=0);$10300:for(;(i$10311<l$10302);(i$10311++)){results$10301.push([i$10311,$7782(arr$10295,i$10311)]);}return results$10301;};
var $10059=function(){var $10060$10066;($10060$10066=function(tags$10071){var it$0$10074;(it$0$10074=function(){if((!$7763($10060$10066)(this))){return Object.create($10060$10066.prototype);}else{return this;}}());(it$0$10074["tags"]=tags$10071);return it$0$10074;});($10060$10066.prototype["create"]=function(){var it$0$10094;var self$10095;(it$0$10094=this);(self$10095=this);var $10092$10104;($10092$10104=arguments);var t0$10109;var message$10113;var args$10114;(t0$10109=$10092$10104.length);if((t0$10109>=0)){(message$10113=function(){if((0>=t0$10109)){return "";}else{return $10092$10104[0];}}());(args$10114=Array.prototype.slice.call($10092$10104,1));var e$10127;(e$10127=Error(message$10113));(e$10127["::tags"]=it$0$10094.tags);(e$10127["args"]=args$10114);var temp$10143;(temp$10143=$10292(args$10114));var $length$10149;($length$10149=temp$10143.length);var $index$10155;($index$10155=0);$10128:for(;($index$10155<$length$10149);($index$10155++)){var m$10164;(m$10164=temp$10143[$index$10155]);var t0$10169;var t1$10170;var i$10174;var arg$10175;(t0$10169=m$10164);if(((t0$10169 instanceof Array)&&(((t1$10170=t0$10169.length)),(t1$10170===2)))){(i$10174=t0$10169[0]);(arg$10175=t0$10169[1]);(e$10127[i$10174]=arg$10175);}else{$10040(m$10164);}}(e$10127["length"]=args$10114.length);(e$10127["name"]=["E"].concat(it$0$10094.tags).join("."));return e$10127;}else{$10040($10092$10104);}});($10060$10066.prototype["::check"]=function(e$10205){var it$0$10209;var self$10210;(it$0$10209=this);(self$10210=this);var tags$10220;if(((!e$10205)||(!$7763(Error)(e$10205)))){return false;}(tags$10220=(e$10205["::tags"]||[]));var temp$10231;(temp$10231=it$0$10209.tags);var $length$10237;($length$10237=temp$10231.length);var $index$10243;($index$10243=0);$10221:for(;($index$10243<$length$10237);($index$10243++)){var m$10252;(m$10252=temp$10231[$index$10243]);var tag$10260;(tag$10260=m$10252);if((tags$10220.indexOf(tag$10260)===-1)){return false;}else{false;}}return true;});($10060$10066.prototype["::deconstruct"]=function(e$10269){var it$0$10273;var self$10274;(it$0$10273=this);(self$10274=this);return e$10269.args;});$7783($10060$10066,$7783(function(){var accum$10285;(accum$10285=({}));(accum$10285["::name"]="$10060");return accum$10285;}(),function(){var accum$10289;(accum$10289=({}));(accum$10289["::egclass"]=true);return accum$10289;}()));return $10060$10066;}();
var $10040=function(value$10043,url$10044,start$10045,end$10046){var err$10050;(err$10050=$10059(["match"]).create("Could not find a match for value",({"value":value$10043})));if(url$10044){(err$10050["location"]=["location",url$10044,start$10045,end$10046]);}throw err$10050;};
var $10486=function(type$10489){return function(value$10493){var f$10497;(f$10497=type$10489[":::project"]);if((f$10497===(void 0))){(f$10497=type$10489["::project"]);if((f$10497===(void 0))){return [true,type$10489(value$10493)];}else{var rval$10510;(rval$10510=false);try{(rval$10510=[true,f$10497(value$10493)]);}catch(excv$10521){var e$10527;(e$10527=excv$10521);(rval$10510=[false,null]);}return rval$10510;}}else{return f$10497.call(type$10489,value$10493);}};};
var $10318=function(){var $10319$10323;($10319$10323=function($10327$10332,$10329$10333){var it$0$10336;(it$0$10336=function(){if((!$7763($10319$10323)(this))){return Object.create($10319$10323.prototype);}else{return this;}}());var classes$10342;var children$10343;var t0$10345;(t0$10345=$10486(Array)($10327$10332));if(t0$10345[0]){(classes$10342=t0$10345[1]);}else{$10040($10327$10332);}var t0$10354;(t0$10354=$10486(Array)($10329$10333));if(t0$10354[0]){(children$10343=t0$10354[1]);}else{$10040($10329$10333);}(it$0$10336["classes"]=classes$10342.sort());(it$0$10336["children"]=children$10343);return it$0$10336;});$7783(function(){var accum$10377;(accum$10377=({}));(accum$10377["::check"]=function(x$10382){return ((x$10382&&x$10382.classes)&&x$10382.children);});return accum$10377;}(),$7783(function(){var accum$10385;(accum$10385=({}));(accum$10385["::deconstruct"]=function(x$10390){return [x$10390.classes,x$10390.children];});return accum$10385;}(),$7783(function(){var accum$10393;(accum$10393=({}));(accum$10393["::name"]="$10319");return accum$10393;}(),function(){var accum$10397;(accum$10397=({}));(accum$10397["::egclass"]=true);return accum$10397;}())));($10319$10323.prototype["::check"]=function(n$10404){var it$0$10408;var self$10409;(it$0$10408=this);(self$10409=this);var temp$10424;(temp$10424=it$0$10408.classes);var $length$10430;($length$10430=temp$10424.length);var $index$10436;($index$10436=0);$10418:for(;($index$10436<$length$10430);($index$10436++)){var m$10445;(m$10445=temp$10424[$index$10436]);var c$10453;(c$10453=m$10445);if((n$10404.classes.indexOf(c$10453)===-1)){return false;}else{false;}}return true;});$7783($10319$10323,$7783(function(){var accum$10463;(accum$10463=({}));(accum$10463["::check"]=function(x$10468){return ((x$10468&&x$10468.classes)&&x$10468.children);});return accum$10463;}(),$7783(function(){var accum$10471;(accum$10471=({}));(accum$10471["::deconstruct"]=function(x$10476){return [x$10476.classes,x$10476.children];});return accum$10471;}(),$7783(function(){var accum$10479;(accum$10479=({}));(accum$10479["::name"]="$10319");return accum$10479;}(),function(){var accum$10483;(accum$10483=({}));(accum$10483["::egclass"]=true);return accum$10483;}()))));return $10319$10323;}();
var $10533=function(from$10536,to$10537){var rval$10542;(rval$10542=[]);var i$10548;(i$10548=from$10536);$10541:for(;(i$10548<=to$10537);(i$10548++)){rval$10542.push(i$10548);}return rval$10542;};
var $10555=function(obj$10558){var results$10563;(results$10563=[]);var k$10568;(k$10568=null);$10562:for(k$10568 in obj$10558){if(Object.prototype.hasOwnProperty.call(obj$10558,k$10568)){results$10563.push([k$10568,$7782(obj$10558,k$10568)]);}}return results$10563;};
var $10572=function($10574$10577,key$10578){var ph$10586;(ph$10586=$10574$10577);var $10580$10592;($10580$10592=ph$10586);var bridge$10582$10597;(bridge$10582$10597=$10580$10592);if(((bridge$10582$10597===null)||(bridge$10582$10597===(void 0)))){return false;}else{var x$10609;if((typeof($10580$10592)==="string")){(x$10609=$10580$10592);return (key$10578 in String.prototype);}else{var x$10614;if((typeof($10580$10592)==="number")){(x$10614=$10580$10592);return (key$10578 in Number.prototype);}else{var x$10619;(x$10619=$10580$10592);return (key$10578 in x$10619);}}}};var accum$8051;var accum$8055;var accum$8383;var accum$8387;var $7841$7869;var binsearch$7870;var $7842$7871;var __lt____gt__$7872;var repr$7873;var fs$7874;var Source$7875;var Location$7876;var highlight$7877;var highlight_lines$7878;var clamp$7879;var morsel$7880;var highlight_locations$7881;var highlight_locations_same_source$7882;var merge_locations$7883;var __lt____lt____colon__$7884;var __plus____plus____colon__$7885;var format_error$7886;var display_error$7887;($7841$7869=require("./util"));(binsearch$7870=$7841$7869.binsearch);($7842$7871=require("./pp"));(__lt____gt__$7872=$7842$7871["<>"]);(repr$7873=$7842$7871.repr);(fs$7874=require("fs"));(Source$7875=function(){var $index$7975;var $length$7969;var temp$7963;var curr$7944;var text$7930;var url$7931;var t0$7926;var $7917$7921;var it$0$7912;(it$0$7912=function(){if((!$7763(Source$7875)(this))){return Object.create(Source$7875.prototype);}else{return this;}}());($7917$7921=arguments);(t0$7926=$7917$7921.length);if(((t0$7926>=1)&&(t0$7926<=2))){(text$7930=$7917$7921[0]);(url$7931=function(){if((1>=t0$7926)){return false;}else{return $7917$7921[1];}}());(it$0$7912["text"]=text$7930);(it$0$7912["url"]=url$7931);(it$0$7912["counts"]=[]);(curr$7944=0);(temp$7963=text$7930.split("\n"));($length$7969=temp$7963.length);($index$7975=0);$7945:for(;($index$7975<$length$7969);($index$7975++)){var line$7992;var m$7984;(m$7984=temp$7963[$index$7975]);(line$7992=m$7984);it$0$7912.counts.push(curr$7944);(curr$7944=(curr$7944+(line$7992.length+1)));}it$0$7912.counts.push(curr$7944);(it$0$7912["nlines"]=(it$0$7912.counts.length-1));}else{$10040($7917$7921);}return it$0$7912;});(Source$7875.prototype["linecol"]=function(pos$8005){var line$8021;var col$8022;var it$0$8009;var self$8010;(it$0$8009=this);(self$8010=this);(line$8021=binsearch$7870(it$0$8009.counts,pos$8005));(col$8022=(pos$8005-$7782(it$0$8009.counts,(line$8021-1))));return [line$8021,col$8022];});(Source$7875.prototype["highlight_lines"]=function(l1$8033,l2$8034,spans$8035){var it$0$8039;var self$8040;(it$0$8039=this);(self$8040=this);return highlight_lines$7878(it$0$8039.text,it$0$8039.counts,[(l1$8033-1),(l2$8034-1)],spans$8035);});$7783(Source$7875,$7783(((accum$8051=({})),((accum$8051["::name"]="Source"),accum$8051)),((accum$8055=({})),((accum$8055["::egclass"]=true),accum$8055))));Source$7875;(Location$7876=function(source$8062,start$8063,end$8064){var it$0$8067;(it$0$8067=function(){if((!$7763(Location$7876)(this))){return Object.create(Location$7876.prototype);}else{return this;}}());(it$0$8067["source"]=(source$8062||Source$7875("",null)));(it$0$8067["start"]=start$8063);(it$0$8067["end"]=end$8064);return it$0$8067;});(Location$7876.prototype["text"]=function(){var it$0$8094;var self$8095;(it$0$8094=this);(self$8095=this);return it$0$8094.source.text.slice(it$0$8094.start,it$0$8094.end);});(Location$7876.prototype["linerange"]=function(){var l2$8166;var t0$8157;var t1$8158;var l1$8137;var $8121$8138;var t0$8131;var t1$8132;var t2$8133;var $8119$8126;var it$0$8110;var self$8111;(it$0$8110=this);(self$8111=this);($8119$8126=it$0$8110.linecol());if((($8119$8126 instanceof Array)&&(((t0$8131=$8119$8126.length)),((t0$8131===2)&&(((t1$8132=$8119$8126[0])),((t1$8132 instanceof Array)&&(((t2$8133=t1$8132.length)),(t2$8133===2)))))))){(l1$8137=t1$8132[0]);t1$8132[1];($8121$8138=$8119$8126[1]);if(($8121$8138===null)){return [l1$8137,l1$8137];}else{(t0$8157=$8121$8138);if(((t0$8157 instanceof Array)&&(((t1$8158=t0$8157.length)),(t1$8158===2)))){(l2$8166=t0$8157[0]);t0$8157[1];return [l1$8137,l2$8166];}else{$10040($8121$8138,"/home/olivier/git/earl-grey/src/location.eg",972,977);}}}else{$10040($8119$8126);}});(Location$7876.prototype["linecol"]=function(){var start$8201;var end$8202;var it$0$8189;var self$8190;(it$0$8189=this);(self$8190=this);(start$8201=it$0$8189.source.linecol(it$0$8189.start));(end$8202=function(){if((it$0$8189.start===it$0$8189.end)){return null;}else{return it$0$8189.source.linecol((it$0$8189.end-1));}}());return [start$8201,end$8202];});(Location$7876.prototype["ref"]=function(){var otherwise$8336;var $8316$8325;var $8312$8319;var l2$8288;var c2$8289;var t0$8277;var t1$8278;var t2$8279;var t3$8280;var l1$8245;var c1$8246;var $8227$8247;var t0$8237;var t1$8238;var t2$8239;var t3$8240;var t4$8241;var $8225$8232;var it$0$8216;var self$8217;(it$0$8216=this);(self$8217=this);($8225$8232=it$0$8216.linecol());if((($8225$8232 instanceof Array)&&(((t0$8237=$8225$8232.length)),((t0$8237===2)&&(((t1$8238=$8225$8232[0])),((t1$8238 instanceof Array)&&(((t2$8239=t1$8238.length)),((t2$8239===2)&&(((t3$8240=[true,String(t1$8238[0])])),(t3$8240[0]&&((l1$8245=t3$8240[1]),(((t4$8241=[true,String(t1$8238[1])])),t4$8241[0])))))))))))){(c1$8246=t4$8241[1]);($8227$8247=$8225$8232[1]);if(($8227$8247===null)){return ((l1$8245+":")+c1$8246);}else{(t0$8277=$8227$8247);if(((t0$8277 instanceof Array)&&(((t1$8278=t0$8277.length)),((t1$8278===2)&&(((t2$8279=[true,String(t0$8277[0])])),(t2$8279[0]&&((l2$8288=t2$8279[1]),(((t3$8280=[true,String(t0$8277[1])])),t3$8280[0])))))))){(c2$8289=t3$8280[1]);($8312$8319=null);$8312$8319;if(((l1$8245===l2$8288)&&(c1$8246===c2$8289))){return ((l1$8245+":")+c1$8246);}else{if((l1$8245===l2$8288)){return ((((l1$8245+":")+c1$8246)+"-")+c2$8289);}else{(otherwise$8336=$8312$8319);return ((((((l1$8245+":")+c1$8246)+"-")+l1$8245)+":")+c2$8289);}}}else{$10040($8227$8247,"/home/olivier/git/earl-grey/src/location.eg",1314,1319);}}}else{$10040($8225$8232);}});(Location$7876.prototype["highlight"]=function(){var cls$8370;var context$8371;var t0$8366;var $8349$8361;var it$0$8351;var self$8352;(it$0$8351=this);(self$8352=this);($8349$8361=arguments);(t0$8366=$8349$8361.length);if(((t0$8366>=0)&&(t0$8366<=2))){(cls$8370=function(){if((0>=t0$8366)){return "hl1";}else{return $8349$8361[0];}}());(context$8371=function(){if((1>=t0$8366)){return 0;}else{return $8349$8361[1];}}());return highlight_locations$7881([[it$0$8351,cls$8370]],context$8371);}else{$10040($8349$8361);}});$7783(Location$7876,$7783(((accum$8383=({})),((accum$8383["::name"]="Location"),accum$8383)),((accum$8387=({})),((accum$8387["::egclass"]=true),accum$8387))));Location$7876;(highlight$7877=function(){var $index$8439;var $length$8433;var temp$8427;var acc$8421;var text$8407;var spans$8408;var offset$8409;var t0$8403;var $8394$8398;($8394$8398=arguments);(t0$8403=$8394$8398.length);if(((t0$8403>=2)&&(t0$8403<=3))){(text$8407=$8394$8398[0]);(spans$8408=$8394$8398[1]);(offset$8409=function(){if((2>=t0$8403)){return 0;}else{return $8394$8398[2];}}());return $10318([],(((acc$8421=[])),(((temp$8427=morsel$7880(spans$8408))),((($length$8433=temp$8427.length)),((($index$8439=0)),function(){$8416:for(;($index$8439<$length$8433);($index$8439++)){var xstart$8476;var xend$8477;var start$8458;var end$8459;var attributes$8460;var t0$8453;var t1$8454;var m$8448;(m$8448=temp$8427[$index$8439]);(t0$8453=m$8448);if(((t0$8453 instanceof Array)&&(((t1$8454=t0$8453.length)),(t1$8454===3)))){(start$8458=t0$8453[0]);(end$8459=t0$8453[1]);(attributes$8460=t0$8453[2]);acc$8421.push((((xstart$8476=Math.max((start$8458-offset$8409),0))),((xend$8477=Math.min((end$8459-offset$8409),text$8407.length))),$10318(attributes$8460.slice(0,1),[text$8407.slice(xstart$8476,xend$8477)])));}else{$10040(m$8448,"/home/olivier/git/earl-grey/src/location.eg",1861,2073);}}}()))),acc$8421));}else{$10040($8394$8398);}});(highlight_lines$7878=function(text$8495,linelocs$8496,$8492$8497,spans$8498){var t0$8503;var t1$8504;var $index$8540;var $length$8534;var temp$8528;var acc$8522;var l1$8500;var l2$8501;(t0$8503=$8492$8497);if(((t0$8503 instanceof Array)&&(((t1$8504=t0$8503.length)),(t1$8504===2)))){(l1$8500=t0$8503[0]);(l2$8501=t0$8503[1]);}else{$10040($8492$8497);}return $10318(["+span"],(((acc$8522=[])),(((temp$8528=$10533(l1$8500,l2$8501))),((($length$8534=temp$8528.length)),((($index$8540=0)),function(){$8517:for(;($index$8540<$length$8534);($index$8540++)){var start$8563;var end$8564;var lineno$8557;var m$8549;(m$8549=temp$8528[$index$8540]);(lineno$8557=m$8549);acc$8522.push((((start$8563=$7782(linelocs$8496,lineno$8557))),((end$8564=$7782(linelocs$8496,(lineno$8557+1)))),$10318(["+span"],[$10318(["lineno"],(lineno$8557+1)),$10318(["source"],highlight$7877(text$8495,[[start$8563,end$8564,[]]].concat(clamp$7879(spans$8498,start$8563,end$8564))))])));}}()))),acc$8522));});(clamp$7879=function(spans$8576,bot$8577,top$8578){var $index$8603;var $length$8597;var temp$8591;var acc$8585;(acc$8585=[]);(temp$8591=spans$8576);($length$8597=temp$8591.length);($index$8603=0);$8580:for(;($index$8603<$length$8597);($index$8603++)){var start$8622;var end$8623;var attr$8624;var t0$8617;var t1$8618;var m$8612;(m$8612=temp$8591[$index$8603]);(t0$8617=m$8612);if(((t0$8617 instanceof Array)&&(((t1$8618=t0$8617.length)),((t1$8618===3)&&((start$8622=t0$8617[0]),((end$8623=t0$8617[1]),((attr$8624=t0$8617[2]),((end$8623>=bot$8577)&&(start$8622<=top$8578))))))))){acc$8585.push([Math.max(start$8622,bot$8577),Math.min(end$8623,top$8578),attr$8624]);}else{false;}}return acc$8585;});(morsel$7880=function(spans$8646){var jump$8653;var jumptill$8654;var process_elements$8655;var thespans$8656;(jump$8653=function(active$8661,bot$8662,top$8663){var $index$8699;var $length$8693;var temp$8687;var acc$8681;var $index$8752;var $length$8746;var temp$8740;var e$8668;var attributes$8669;(e$8668=$7782(Math.min,[top$8663].concat((((acc$8681=[])),(((temp$8687=active$8661)),((($length$8693=temp$8687.length)),((($index$8699=0)),function(){$8676:for(;($index$8699<$length$8693);($index$8699++)){var x$8718;var t0$8713;var t1$8714;var m$8708;(m$8708=temp$8687[$index$8699]);(t0$8713=m$8708);if(((t0$8713 instanceof Array)&&(((t1$8714=t0$8713.length)),(t1$8714===3)))){t0$8713[0];(x$8718=t0$8713[1]);t0$8713[2];acc$8681.push(x$8718);}else{$10040(m$8708,"/home/olivier/git/earl-grey/src/location.eg",3396,3439);}}}()))),acc$8681))));(attributes$8669=[]);(temp$8740=active$8661);($length$8746=temp$8740.length);($index$8752=0);$8670:for(;($index$8752<$length$8746);($index$8752++)){var X$8771;var t0$8766;var t1$8767;var m$8761;(m$8761=temp$8740[$index$8752]);(t0$8766=m$8761);if(((t0$8766 instanceof Array)&&(((t1$8767=t0$8766.length)),(t1$8767===3)))){t0$8766[0];t0$8766[1];(X$8771=t0$8766[2]);(attributes$8669=attributes$8669.concat(X$8771));}else{$10040(m$8761,"/home/olivier/git/earl-grey/src/location.eg",3465,3506);}}return [e$8668,[bot$8662,e$8668,attributes$8669]];});(jumptill$8654=function(active$8790,bot$8791,top$8792){var t0$8804;var t1$8805;var $index$8843;var $length$8837;var temp$8831;var acc$8825;var t0$8883;var t1$8884;var newbot$8798;var span$8799;var newactive$8800;var spans$8801;var remainder$8802;if((bot$8791===top$8792)){return [[],active$8790];}else{(t0$8804=jump$8653(active$8790,bot$8791,top$8792));if(((t0$8804 instanceof Array)&&(((t1$8805=t0$8804.length)),(t1$8805===2)))){(newbot$8798=t0$8804[0]);(span$8799=t0$8804[1]);}else{$10040(jump$8653(active$8790,bot$8791,top$8792),"/home/olivier/git/earl-grey/src/location.eg",3742,3776);}(newactive$8800=(((acc$8825=[])),(((temp$8831=active$8790)),((($length$8837=temp$8831.length)),((($index$8843=0)),function(){$8820:for(;($index$8843<$length$8837);($index$8843++)){var x$8862;var e$8863;var attr$8864;var t0$8857;var t1$8858;var m$8852;(m$8852=temp$8831[$index$8843]);(t0$8857=m$8852);(x$8862=t0$8857);if(((t0$8857 instanceof Array)&&(((t1$8858=t0$8857.length)),((t1$8858===3)&&(t0$8857[0],((e$8863=t0$8857[1]),((attr$8864=t0$8857[2]),(e$8863>newbot$8798)))))))){acc$8825.push(x$8862);}else{false;}}}()))),acc$8825));(t0$8883=jumptill$8654(newactive$8800,newbot$8798,top$8792));if(((t0$8883 instanceof Array)&&(((t1$8884=t0$8883.length)),(t1$8884===2)))){(spans$8801=t0$8883[0]);(remainder$8802=t0$8883[1]);}else{$10040(jumptill$8654(newactive$8800,newbot$8798,top$8792),"/home/olivier/git/earl-grey/src/location.eg",3891,3935);}return [[span$8799].concat(spans$8801),remainder$8802];}});(process_elements$8655=function(start$8902,active$8903,rem$8904){var $index$9009;var $length$9003;var temp$8997;var acc$8991;var t0$9048;var t1$9049;var top$8981;var bot$8982;var spans$8983;var t0$9101;var t1$9102;var spans$9098;var newactive$9099;var start$9064;var active$9065;var next$9066;var target$9067;var end$9068;var attr$9069;var rest$9070;var start$8961;var active$8962;var $8910$8926;var $8911$8927;var $8912$8928;var t0$8920;var t1$8921;var t2$8922;var t3$8923;var t4$8924;var $8906$8915;($8906$8915=[start$8902,active$8903,rem$8904]);if((($8910$8926=($8906$8915 instanceof Array))&&(((t0$8920=$8906$8915.length)),(($8912$8928=(t0$8920===3))&&($8906$8915[0],(((t1$8921=$8906$8915[1])),((t1$8921 instanceof Array)&&(((t2$8922=t1$8921.length)),((t2$8922===0)&&(((t3$8923=$8906$8915[2])),((t3$8923 instanceof Array)&&(((t4$8924=t3$8923.length)),(t4$8924===0))))))))))))){return [];}else{if(($8912$8928&&((start$8961=$8906$8915[0]),((active$8962=$8906$8915[1]),(((t1$8921=$8906$8915[2])),((t1$8921 instanceof Array)&&(((t2$8922=t1$8921.length)),(t2$8922===0)))))))){(top$8981=$7782(Math.max,(((acc$8991=[])),(((temp$8997=active$8962)),((($length$9003=temp$8997.length)),((($index$9009=0)),function(){$8986:for(;($index$9009<$length$9003);($index$9009++)){var e$9028;var t0$9023;var t1$9024;var m$9018;(m$9018=temp$8997[$index$9009]);(t0$9023=m$9018);if(((t0$9023 instanceof Array)&&(((t1$9024=t0$9023.length)),(t1$9024===3)))){t0$9023[0];(e$9028=t0$9023[1]);t0$9023[2];acc$8991.push(e$9028);}else{$10040(m$9018,"/home/olivier/git/earl-grey/src/location.eg",4120,4158);}}}()))),acc$8991)));(bot$8982=Math.min(start$8961,top$8981));(t0$9048=jumptill$8654(active$8962,start$8961,top$8981));if(((t0$9048 instanceof Array)&&(((t1$9049=t0$9048.length)),(t1$9049===2)))){(spans$8983=t0$9048[0]);t0$9048[1];}else{$10040(jumptill$8654(active$8962,start$8961,top$8981),"/home/olivier/git/earl-grey/src/location.eg",4211,4249);}return spans$8983;}else{if(($8912$8928&&((start$9064=$8906$8915[0]),((active$9065=$8906$8915[1]),(((t1$8921=$8906$8915[2])),((t1$8921 instanceof Array)&&(((t2$8922=t1$8921.length)),((t2$8922>=1)&&(((t3$8923=t1$8921[0])),((next$9066=t3$8923),((t3$8923 instanceof Array)&&(((t4$8924=t3$8923.length)),(t4$8924===3))))))))))))){(target$9067=t3$8923[0]);(end$9068=t3$8923[1]);(attr$9069=t3$8923[2]);(rest$9070=Array.prototype.slice.call(t1$8921,1));(t0$9101=jumptill$8654(active$9065,start$9064,target$9067));if(((t0$9101 instanceof Array)&&(((t1$9102=t0$9101.length)),(t1$9102===2)))){(spans$9098=t0$9101[0]);(newactive$9099=t0$9101[1]);}else{$10040(jumptill$8654(active$9065,start$9064,target$9067),"/home/olivier/git/earl-grey/src/location.eg",4353,4394);}return spans$9098.concat(process_elements$8655(target$9067,[next$9066].concat(newactive$9099),rest$9070));}else{$10040($8906$8915);}}}});(thespans$8656=spans$8646.sort(function($9121$9126,$9123$9127){var t0$9134;var t1$9135;var t0$9149;var t1$9150;var s1$9129;var e1$9130;var s2$9131;var e2$9132;(t0$9134=$9121$9126);if(((t0$9134 instanceof Array)&&(((t1$9135=t0$9134.length)),(t1$9135===3)))){(s1$9129=t0$9134[0]);(e1$9130=t0$9134[1]);t0$9134[2];}else{$10040($9121$9126);}(t0$9149=$9123$9127);if(((t0$9149 instanceof Array)&&(((t1$9150=t0$9149.length)),(t1$9150===3)))){(s2$9131=t0$9149[0]);(e2$9132=t0$9149[1]);t0$9149[2];}else{$10040($9123$9127);}if((s1$9129===s2$9131)){return (e1$9130-e2$9132);}else{return (s1$9129-s2$9131);}}));return process_elements$8655(thespans$8656[0][0],[],thespans$8656);});(highlight_locations$7881=function(){var $index$9214;var $length$9208;var temp$9202;var $index$9282;var $length$9276;var temp$9270;var acc$9264;var srcs$9192;var locations$9182;var context$9183;var t0$9178;var $9169$9173;($9169$9173=arguments);(t0$9178=$9169$9173.length);if(((t0$9178>=1)&&(t0$9178<=2))){(locations$9182=$9169$9173[0]);(context$9183=function(){if((1>=t0$9178)){return 0;}else{return $9169$9173[1];}}());(srcs$9192=({}));(temp$9202=locations$9182);($length$9208=temp$9202.length);($index$9214=0);$9193:for(;($index$9214<$length$9208);($index$9214++)){var key$9248;var loc$9233;var cls$9234;var t0$9228;var t1$9229;var m$9223;(m$9223=temp$9202[$index$9214]);(t0$9228=m$9223);if(((t0$9228 instanceof Array)&&(((t1$9229=t0$9228.length)),(t1$9229===2)))){(loc$9233=t0$9228[0]);(cls$9234=t0$9228[1]);(key$9248=String((loc$9233.source&&loc$9233.source.url)));if((!$7782(srcs$9192,key$9248))){(srcs$9192[key$9248]=[]);}$7782(srcs$9192,key$9248).push([loc$9233,cls$9234]);}else{$10040(m$9223,"/home/olivier/git/earl-grey/src/location.eg",4740,4909);}}return $10318(["+div"],(((acc$9264=[])),(((temp$9270=$10555(srcs$9192))),((($length$9276=temp$9270.length)),((($index$9282=0)),function(){$9259:for(;($index$9282<$length$9276);($index$9282++)){var locs$9301;var t0$9296;var t1$9297;var m$9291;(m$9291=temp$9270[$index$9282]);(t0$9296=m$9291);if(((t0$9296 instanceof Array)&&(((t1$9297=t0$9296.length)),(t1$9297===2)))){t0$9296[0];(locs$9301=t0$9296[1]);acc$9264.push(highlight_locations_same_source$7882(locs$9301,context$9183));}else{$10040(m$9291,"/home/olivier/git/earl-grey/src/location.eg",4914,5008);}}}()))),acc$9264));}else{$10040($9169$9173);}});(highlight_locations_same_source$7882=function(){var $index$9381;var $length$9375;var temp$9369;var acc$9363;var t0$9421;var t1$9422;var $index$9464;var $length$9458;var temp$9452;var acc$9446;var $index$9522;var $length$9516;var temp$9510;var acc$9504;var loc$9350;var src$9351;var l1$9352;var l2$9353;var first$9354;var last$9355;var locations$9336;var context$9337;var t0$9332;var $9323$9327;($9323$9327=arguments);(t0$9332=$9323$9327.length);if(((t0$9332>=1)&&(t0$9332<=2))){(locations$9336=$9323$9327[0]);(context$9337=function(){if((1>=t0$9332)){return 0;}else{return $9323$9327[1];}}());(loc$9350=merge_locations$7883((((acc$9363=[])),(((temp$9369=locations$9336)),((($length$9375=temp$9369.length)),((($index$9381=0)),function(){$9358:for(;($index$9381<$length$9375);($index$9381++)){var x$9400;var cls$9401;var t0$9395;var t1$9396;var m$9390;(m$9390=temp$9369[$index$9381]);(t0$9395=m$9390);if(((t0$9395 instanceof Array)&&(((t1$9396=t0$9395.length)),(t1$9396===2)))){(x$9400=t0$9395[0]);(cls$9401=t0$9395[1]);acc$9363.push(x$9400);}else{$10040(m$9390,"/home/olivier/git/earl-grey/src/location.eg",5091,5119);}}}()))),acc$9363)));(src$9351=loc$9350.source);(t0$9421=loc$9350.linerange());if(((t0$9421 instanceof Array)&&(((t1$9422=t0$9421.length)),(t1$9422===2)))){(l1$9352=t0$9421[0]);(l2$9353=t0$9421[1]);}else{$10040(loc$9350.linerange(),"/home/olivier/git/earl-grey/src/location.eg",5155,5174);}(first$9354=Math.max(1,(l1$9352-context$9337)));(last$9355=Math.min(src$9351.nlines,(l2$9353+context$9337)));return $10318(["+div","location"],[$10318(["+div","source"],[$10318(["sourcefile"],(src$9351.url||"???")),(((acc$9446=[])),(((temp$9452=locations$9336)),((($length$9458=temp$9452.length)),((($index$9464=0)),function(){$9441:for(;($index$9464<$length$9458);($index$9464++)){var loc$9483;var cls$9484;var t0$9478;var t1$9479;var m$9473;(m$9473=temp$9452[$index$9464]);(t0$9478=m$9473);if(((t0$9478 instanceof Array)&&(((t1$9479=t0$9478.length)),(t1$9479===2)))){(loc$9483=t0$9478[0]);(cls$9484=t0$9478[1]);acc$9446.push($10318([cls$9484,"sourcepos"],loc$9483.ref()));}else{$10040(m$9473,"/home/olivier/git/earl-grey/src/location.eg",5339,5409);}}}()))),acc$9446)]),src$9351.highlight_lines(first$9354,last$9355,(((acc$9504=[])),(((temp$9510=locations$9336)),((($length$9516=temp$9510.length)),((($index$9522=0)),function(){$9499:for(;($index$9522<$length$9516);($index$9522++)){var loc$9541;var cls$9542;var t0$9536;var t1$9537;var m$9531;(m$9531=temp$9510[$index$9522]);(t0$9536=m$9531);if(((t0$9536 instanceof Array)&&(((t1$9537=t0$9536.length)),(t1$9537===2)))){(loc$9541=t0$9536[0]);(cls$9542=t0$9536[1]);acc$9504.push([loc$9541.start,loc$9541.end,[cls$9542]]);}else{$10040(m$9531,"/home/olivier/git/earl-grey/src/location.eg",5464,5522);}}}()))),acc$9504))]);}else{$10040($9323$9327);}});(merge_locations$7883=function($9563$9566){var $index$9638;var $length$9632;var temp$9626;var acc$9620;var $index$9684;var $length$9678;var temp$9672;var acc$9666;var start$9611;var end$9612;var locs$9605;var loc$9600;var $9572$9587;var $9573$9588;var t0$9585;var $9568$9580;var ph$9574;(ph$9574=$9563$9566);($9568$9580=ph$9574);if((($9572$9587=($9568$9580 instanceof Array))&&(((t0$9585=$9568$9580.length)),(t0$9585===0)))){return Location$7876(null,0,0);}else{if(($9572$9587&&(t0$9585===1))){(loc$9600=$9568$9580[0]);return loc$9600;}else{if(($9572$9587&&(t0$9585>=0))){(locs$9605=Array.prototype.slice.call($9568$9580,0));(start$9611=$7782(Math.min,(((acc$9620=[])),(((temp$9626=locs$9605)),((($length$9632=temp$9626.length)),((($index$9638=0)),function(){$9615:for(;($index$9638<$length$9632);($index$9638++)){var loc$9655;var m$9647;(m$9647=temp$9626[$index$9638]);(loc$9655=m$9647);acc$9620.push(loc$9655.start);}}()))),acc$9620)));(end$9612=$7782(Math.max,(((acc$9666=[])),(((temp$9672=locs$9605)),((($length$9678=temp$9672.length)),((($index$9684=0)),function(){$9661:for(;($index$9684<$length$9678);($index$9684++)){var loc$9701;var m$9693;(m$9693=temp$9672[$index$9684]);(loc$9701=m$9693);acc$9666.push(loc$9701.end);}}()))),acc$9666)));return Location$7876(locs$9605[0].source,start$9611,end$9612);}else{$10040($9568$9580);}}}});(__lt____lt____colon__$7884=function(x$9712,y$9713){if((!$7763(Location$7876)(x$9712.location))){(x$9712["location"]=function(){if(((!y$9713)||$7763(Location$7876)(y$9713))){return y$9713;}else{return y$9713.location;}}());}return x$9712;});(__plus____plus____colon__$7885=function(x$9726,y$9727){var rval$9744;var x2$9732;var y2$9733;(x2$9732=function(){if(((!x$9726)||$7763(Location$7876)(x$9726))){return x$9726;}else{return x$9726.location;}}());(y2$9733=function(){if(((!y$9727)||$7763(Location$7876)(y$9727))){return y$9727;}else{return y$9727.location;}}());(rval$9744=false);try{(rval$9744=merge_locations$7883([x2$9732,y2$9733]));}catch(excv$9755){var e$9761;(e$9761=excv$9755);(rval$9744=(void 0));}return rval$9744;});(format_error$7886=function(){var $index$9877;var $length$9871;var temp$9865;var acc$9859;var hls$9847;var locs$9848;var rval$9959;var loc$9985;var data$9952;var other$9991;var url$9940;var start$9941;var end$9942;var loc$9930;var args$9827;var fmt_args$9817;var $9779$9812;var $9780$9813;var $9781$9814;var t0$9808;var t1$9809;var t2$9810;var e$9794;var context$9795;var $9774$9796;var t0$9789;var t1$9790;var $9772$9784;($9772$9784=arguments);(t0$9789=$9772$9784.length);if(((t0$9789>=1)&&(t0$9789<=2))){(t1$9790=$9772$9784[0]);(e$9794=t1$9790);($9774$9796=t1$9790);(context$9795=function(){if((1>=t0$9789)){return 0;}else{return $9772$9784[1];}}());(fmt_args$9817=function(e$9822){if((e$9822.args&&e$9822.args.length)){return $10318(["error_args"],repr$7873(e$9822.args));}else{return "";}});(t0$9808=$9774$9796);if(($7763($10059(["syntax"]))(t0$9808)&&($10572(t0$9808,"args")&&(((t1$9809=t0$9808.args)),((t1$9809 instanceof Array)&&(((t2$9810=t1$9809.length)),(t2$9810===1))))))){(args$9827=t1$9809[0]);(hls$9847=["hl1","hl2","hl3","hl4"]);(locs$9848=(((acc$9859=[])),(((temp$9865=$10292($10555(args$9827)))),((($length$9871=temp$9865.length)),((($index$9877=0)),function(){$9854:for(;($index$9877<$length$9871);($index$9877++)){var i$9898;var key$9899;var arg$9900;var t0$9891;var t1$9892;var t2$9893;var t3$9894;var m$9886;(m$9886=temp$9865[$index$9877]);(t0$9891=m$9886);if(((t0$9891 instanceof Array)&&(((t1$9892=t0$9891.length)),((t1$9892===2)&&((i$9898=t0$9891[0]),(((t2$9893=t0$9891[1])),((t2$9893 instanceof Array)&&(((t3$9894=t2$9893.length)),((t3$9894===2)&&((key$9899=t2$9893[0]),((arg$9900=t2$9893[1]),(arg$9900&&arg$9900.location)))))))))))){acc$9859.push([arg$9900.location,$7782(hls$9847,(i$9898%4))]);}else{false;}}}()))),acc$9859));return $10318(["+div"],[$10318(["error"],[$10318(["error_type"],e$9794.name),$10318(["error_message"],e$9794.message)]),$10318(["error_args","syntax"],repr$7873(args$9827)),highlight_locations$7881(locs$9848,context$9795)]);}else{if((($9780$9813=$10572(t0$9808,"location"))&&(((t1$9809=t0$9808.location)),$7763(Location$7876)(t1$9809)))){(loc$9930=t1$9809);return $10318(["+div"],[$10318(["error"],[$10318(["error_type"],e$9794.name),$10318(["error_message"],e$9794.message)]),fmt_args$9817(e$9794),highlight_locations$7881([[loc$9930,"hl1"]],context$9795),$10318(["traceback"],(e$9794.stack||""))]);}else{if(($9780$9813&&((t1$9809 instanceof Array)&&(((t2$9810=t1$9809.length)),((t2$9810===4)&&(t1$9809[0]==="location")))))){(url$9940=t1$9809[1]);(start$9941=t1$9809[2]);(end$9942=t1$9809[3]);(data$9952=(((rval$9959=false)),(function(){try{(rval$9959=fs$7874.readFileSync(url$9940,"utf8"));}catch(excv$9970){var e$9976;(e$9976=excv$9970);(rval$9959=null);}}(),rval$9959)));if(data$9952){(loc$9985=Location$7876(Source$7875(data$9952,url$9940),start$9941,end$9942));return $10318(["+div"],[$10318(["error"],[$10318(["error_type"],e$9794.name),$10318(["error_message"],e$9794.message)]),fmt_args$9817(e$9794),highlight_locations$7881([[loc$9985,"hl1"]],context$9795),$10318(["traceback"],($10318([],e$9794.stack)||""))]);}else{return $10318(["+div"],[$10318(["error"],[$10318(["error_type"],e$9794.name),$10318(["error_message"],e$9794.message)]),fmt_args$9817(e$9794),$10318(["traceback"],($10318([],e$9794.stack)||e$9794))]);}}else{(other$9991=$9774$9796);return $10318(["+div"],[$10318(["error"],[$10318(["error_type"],e$9794.name),$10318(["error_message"],e$9794.message)]),fmt_args$9817(e$9794),$10318(["traceback"],$10318([],e$9794.stack))]);}}}}else{$10040($9772$9784);}});(display_error$7887=function(e$10000){return __lt____gt__$7872(null,format_error$7886(e$10000));});(exports["Source"]=Source$7875);(exports["Location"]=Location$7876);(exports["highlight"]=highlight$7877);(exports["highlight_locations"]=highlight_locations$7881);(exports["merge_locations"]=merge_locations$7883);(exports["<<:"]=__lt____lt____colon__$7884);(exports["++:"]=__plus____plus____colon__$7885);(exports["format_error"]=format_error$7886);(exports["display_error"]=display_error$7887);
