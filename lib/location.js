var $7689=function(type$7692){var f$7696;(f$7696=type$7692["::check"]);if((f$7696===(void 0))){return function(value$7702){return (value$7702 instanceof type$7692);};}else{return function(value$7706){return f$7696.call(type$7692,value$7706);};}};
var $7708=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $7709=function(dest$7712,values$7713){var k$7718;(k$7718=null);$7716:for(k$7718 in values$7713){if(values$7713.hasOwnProperty(k$7718)){(dest$7712[k$7718]=values$7713[k$7718]);}}return dest$7712;};
var $7726=function($7728$7731){var ph$7737;(ph$7737=$7728$7731);var $7733$7743;($7733$7743=ph$7737);var bridge$7735$7748;var x$7752;(bridge$7735$7748=$7733$7743);if((((typeof(bridge$7735$7748)==="string")&&((x$7752=bridge$7735$7748),true))||((typeof(bridge$7735$7748)==="number")&&((x$7752=bridge$7735$7748),true)))){return ["value",x$7752];}else{var other$7763;(other$7763=$7733$7743);return other$7763["::serialize_ast"]();}};
var send$7463;(send$7463=function(obj$7470,$7467$7471){var ph$7477;var msg$7478;var t0$7480;(t0$7480=$7467$7471);(msg$7478=t0$7480);(ph$7477=t0$7480);var $7473$7489;($7473$7489=ph$7477);var bridge$7475$7494;(bridge$7475$7494=$7473$7489);if(((typeof(bridge$7475$7494)==="string")||(typeof(bridge$7475$7494)==="number"))){return obj$7470[msg$7478];}else{var other$7506;(other$7506=$7473$7489);return obj$7470["::send"](msg$7478);}});(Array[":::project"]=function($7512$7515){var ph$7520;var value$7521;var t0$7523;(t0$7523=$7512$7515);(value$7521=t0$7523);(ph$7520=t0$7523);var $7517$7532;($7517$7532=ph$7520);if($7689(Array)($7517$7532)){return [true,value$7521];}else{$7517$7532;return [true,[value$7521]];}});(Array.prototype["::check"]=function(value$7550){if((value$7550 instanceof Array)){var i$7556;(i$7556=0);$7553:for(;(i$7556<this.length);(i$7556++)){if(($7708(this,i$7556)!==$7708(value$7550,i$7556))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $7709(this.slice(0),this);});(Array.prototype[":::project"]=function(value$7575){if((value$7575 instanceof Array)){var i$7581;(i$7581=0);$7578:for(;(i$7581<this.length);(i$7581++)){if(($7708(this,i$7581)!==$7708(value$7575,i$7581))){return [true,[value$7575]];}}return [true,value$7575.slice(this.length)];}else{return [true,[value$7575]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($7726));});(RegExp.prototype["::check"]=function($7599$7602){var ph$7607;(ph$7607=$7599$7602);var $7604$7613;($7604$7613=ph$7607);var value$7621;if((typeof($7604$7613)==="string")){(value$7621=$7604$7613);if(value$7621.match(this)){return true;}else{return false;}}else{var other$7626;(other$7626=$7604$7613);return false;}});(RegExp.prototype[":::project"]=function($7632$7635){var ph$7640;(ph$7640=$7632$7635);var $7637$7646;($7637$7646=ph$7640);var value$7654;if((typeof($7637$7646)==="string")){(value$7654=$7637$7646);var $7657$7662;($7657$7662=value$7654.match(this));var m$7670;if(($7657$7662===null)){(m$7670=$7657$7662);return [false,null];}else{var m$7675;(m$7675=$7657$7662);return [true,m$7675];}}else{var other$7679;(other$7679=$7637$7646);return [false,null];}});(Function.prototype["::send"]=function(args$7686){return this.apply(this,args$7686);});
var $10218=function(arr$10221){var results$10227;var l$10228;(results$10227=[]);(l$10228=arr$10221.length);var i$10237;(i$10237=0);$10226:for(;(i$10237<l$10228);(i$10237++)){results$10227.push([i$10237,$7708(arr$10221,i$10237)]);}return results$10227;};
var $9985=function(){var $9986$9992;($9986$9992=function(tags$9997){var it$0$10000;(it$0$10000=function(){if((!$7689($9986$9992)(this))){return Object.create($9986$9992.prototype);}else{return this;}}());(it$0$10000["tags"]=tags$9997);return it$0$10000;});($9986$9992.prototype["create"]=function(){var it$0$10020;var self$10021;(it$0$10020=this);(self$10021=this);var $10018$10030;($10018$10030=arguments);var t0$10035;var message$10039;var args$10040;(t0$10035=$10018$10030.length);if((t0$10035>=0)){(message$10039=function(){if((0>=t0$10035)){return "";}else{return $10018$10030[0];}}());(args$10040=Array.prototype.slice.call($10018$10030,1));var e$10053;(e$10053=Error(message$10039));(e$10053["::tags"]=it$0$10020.tags);(e$10053["args"]=args$10040);var temp$10069;(temp$10069=$10218(args$10040));var $length$10075;($length$10075=temp$10069.length);var $index$10081;($index$10081=0);$10054:for(;($index$10081<$length$10075);($index$10081++)){var m$10090;(m$10090=temp$10069[$index$10081]);var t0$10095;var t1$10096;var i$10100;var arg$10101;(t0$10095=m$10090);if(((t0$10095 instanceof Array)&&(((t1$10096=t0$10095.length)),(t1$10096===2)))){(i$10100=t0$10095[0]);(arg$10101=t0$10095[1]);(e$10053[i$10100]=arg$10101);}else{$9966(m$10090);}}(e$10053["length"]=args$10040.length);(e$10053["name"]=["E"].concat(it$0$10020.tags).join("."));return e$10053;}else{$9966($10018$10030);}});($9986$9992.prototype["::check"]=function(e$10131){var it$0$10135;var self$10136;(it$0$10135=this);(self$10136=this);var tags$10146;if(((!e$10131)||(!$7689(Error)(e$10131)))){return false;}(tags$10146=(e$10131["::tags"]||[]));var temp$10157;(temp$10157=it$0$10135.tags);var $length$10163;($length$10163=temp$10157.length);var $index$10169;($index$10169=0);$10147:for(;($index$10169<$length$10163);($index$10169++)){var m$10178;(m$10178=temp$10157[$index$10169]);var tag$10186;(tag$10186=m$10178);if((tags$10146.indexOf(tag$10186)===-1)){return false;}else{false;}}return true;});($9986$9992.prototype["::deconstruct"]=function(e$10195){var it$0$10199;var self$10200;(it$0$10199=this);(self$10200=this);return e$10195.args;});$7709($9986$9992,$7709(function(){var accum$10211;(accum$10211=({}));(accum$10211["::name"]="$9986");return accum$10211;}(),function(){var accum$10215;(accum$10215=({}));(accum$10215["::egclass"]=true);return accum$10215;}()));return $9986$9992;}();
var $9966=function(value$9969,url$9970,start$9971,end$9972){var err$9976;(err$9976=$9985(["match"]).create("Could not find a match for value",({"value":value$9969})));if(url$9970){(err$9976["location"]=["location",url$9970,start$9971,end$9972]);}throw err$9976;};
var $10412=function(type$10415){return function(value$10419){var f$10423;(f$10423=type$10415[":::project"]);if((f$10423===(void 0))){(f$10423=type$10415["::project"]);if((f$10423===(void 0))){return [true,type$10415(value$10419)];}else{var rval$10436;(rval$10436=false);try{(rval$10436=[true,f$10423(value$10419)]);}catch(excv$10447){var e$10453;(e$10453=excv$10447);(rval$10436=[false,null]);}return rval$10436;}}else{return f$10423.call(type$10415,value$10419);}};};
var $10244=function(){var $10245$10249;($10245$10249=function($10253$10258,$10255$10259){var it$0$10262;(it$0$10262=function(){if((!$7689($10245$10249)(this))){return Object.create($10245$10249.prototype);}else{return this;}}());var classes$10268;var children$10269;var t0$10271;(t0$10271=$10412(Array)($10253$10258));if(t0$10271[0]){(classes$10268=t0$10271[1]);}else{$9966($10253$10258);}var t0$10280;(t0$10280=$10412(Array)($10255$10259));if(t0$10280[0]){(children$10269=t0$10280[1]);}else{$9966($10255$10259);}(it$0$10262["classes"]=classes$10268.sort());(it$0$10262["children"]=children$10269);return it$0$10262;});$7709(function(){var accum$10303;(accum$10303=({}));(accum$10303["::check"]=function(x$10308){return ((x$10308&&x$10308.classes)&&x$10308.children);});return accum$10303;}(),$7709(function(){var accum$10311;(accum$10311=({}));(accum$10311["::deconstruct"]=function(x$10316){return [x$10316.classes,x$10316.children];});return accum$10311;}(),$7709(function(){var accum$10319;(accum$10319=({}));(accum$10319["::name"]="$10245");return accum$10319;}(),function(){var accum$10323;(accum$10323=({}));(accum$10323["::egclass"]=true);return accum$10323;}())));($10245$10249.prototype["::check"]=function(n$10330){var it$0$10334;var self$10335;(it$0$10334=this);(self$10335=this);var temp$10350;(temp$10350=it$0$10334.classes);var $length$10356;($length$10356=temp$10350.length);var $index$10362;($index$10362=0);$10344:for(;($index$10362<$length$10356);($index$10362++)){var m$10371;(m$10371=temp$10350[$index$10362]);var c$10379;(c$10379=m$10371);if((n$10330.classes.indexOf(c$10379)===-1)){return false;}else{false;}}return true;});$7709($10245$10249,$7709(function(){var accum$10389;(accum$10389=({}));(accum$10389["::check"]=function(x$10394){return ((x$10394&&x$10394.classes)&&x$10394.children);});return accum$10389;}(),$7709(function(){var accum$10397;(accum$10397=({}));(accum$10397["::deconstruct"]=function(x$10402){return [x$10402.classes,x$10402.children];});return accum$10397;}(),$7709(function(){var accum$10405;(accum$10405=({}));(accum$10405["::name"]="$10245");return accum$10405;}(),function(){var accum$10409;(accum$10409=({}));(accum$10409["::egclass"]=true);return accum$10409;}()))));return $10245$10249;}();
var $10459=function(from$10462,to$10463){var rval$10468;(rval$10468=[]);var i$10474;(i$10474=from$10462);$10467:for(;(i$10474<=to$10463);(i$10474++)){rval$10468.push(i$10474);}return rval$10468;};
var $10481=function(obj$10484){var results$10489;(results$10489=[]);var k$10494;(k$10494=null);$10488:for(k$10494 in obj$10484){if(Object.prototype.hasOwnProperty.call(obj$10484,k$10494)){results$10489.push([k$10494,$7708(obj$10484,k$10494)]);}}return results$10489;};
var $10498=function($10500$10503,key$10504){var ph$10512;(ph$10512=$10500$10503);var $10506$10518;($10506$10518=ph$10512);var bridge$10508$10523;(bridge$10508$10523=$10506$10518);if(((bridge$10508$10523===null)||(bridge$10508$10523===(void 0)))){return false;}else{var x$10535;if((typeof($10506$10518)==="string")){(x$10535=$10506$10518);return (key$10504 in String.prototype);}else{var x$10540;if((typeof($10506$10518)==="number")){(x$10540=$10506$10518);return (key$10504 in Number.prototype);}else{var x$10545;(x$10545=$10506$10518);return (key$10504 in x$10545);}}}};var accum$7977;var accum$7981;var accum$8309;var accum$8313;var $7767$7795;var binsearch$7796;var $7768$7797;var __lt____gt__$7798;var repr$7799;var fs$7800;var Source$7801;var Location$7802;var highlight$7803;var highlight_lines$7804;var clamp$7805;var morsel$7806;var highlight_locations$7807;var highlight_locations_same_source$7808;var merge_locations$7809;var __lt____lt____colon__$7810;var __plus____plus____colon__$7811;var format_error$7812;var display_error$7813;($7767$7795=require("./util"));(binsearch$7796=$7767$7795.binsearch);($7768$7797=require("./pp"));(__lt____gt__$7798=$7768$7797["<>"]);(repr$7799=$7768$7797.repr);(fs$7800=require("fs"));(Source$7801=function(){var $index$7901;var $length$7895;var temp$7889;var curr$7870;var text$7856;var url$7857;var t0$7852;var $7843$7847;var it$0$7838;(it$0$7838=function(){if((!$7689(Source$7801)(this))){return Object.create(Source$7801.prototype);}else{return this;}}());($7843$7847=arguments);(t0$7852=$7843$7847.length);if(((t0$7852>=1)&&(t0$7852<=2))){(text$7856=$7843$7847[0]);(url$7857=function(){if((1>=t0$7852)){return false;}else{return $7843$7847[1];}}());(it$0$7838["text"]=text$7856);(it$0$7838["url"]=url$7857);(it$0$7838["counts"]=[]);(curr$7870=0);(temp$7889=text$7856.split("\n"));($length$7895=temp$7889.length);($index$7901=0);$7871:for(;($index$7901<$length$7895);($index$7901++)){var line$7918;var m$7910;(m$7910=temp$7889[$index$7901]);(line$7918=m$7910);it$0$7838.counts.push(curr$7870);(curr$7870=(curr$7870+(line$7918.length+1)));}it$0$7838.counts.push(curr$7870);(it$0$7838["nlines"]=(it$0$7838.counts.length-1));}else{$9966($7843$7847);}return it$0$7838;});(Source$7801.prototype["linecol"]=function(pos$7931){var line$7947;var col$7948;var it$0$7935;var self$7936;(it$0$7935=this);(self$7936=this);(line$7947=binsearch$7796(it$0$7935.counts,pos$7931));(col$7948=(pos$7931-$7708(it$0$7935.counts,(line$7947-1))));return [line$7947,col$7948];});(Source$7801.prototype["highlight_lines"]=function(l1$7959,l2$7960,spans$7961){var it$0$7965;var self$7966;(it$0$7965=this);(self$7966=this);return highlight_lines$7804(it$0$7965.text,it$0$7965.counts,[(l1$7959-1),(l2$7960-1)],spans$7961);});$7709(Source$7801,$7709(((accum$7977=({})),((accum$7977["::name"]="Source"),accum$7977)),((accum$7981=({})),((accum$7981["::egclass"]=true),accum$7981))));Source$7801;(Location$7802=function(source$7988,start$7989,end$7990){var it$0$7993;(it$0$7993=function(){if((!$7689(Location$7802)(this))){return Object.create(Location$7802.prototype);}else{return this;}}());(it$0$7993["source"]=(source$7988||Source$7801("",null)));(it$0$7993["start"]=start$7989);(it$0$7993["end"]=end$7990);return it$0$7993;});(Location$7802.prototype["text"]=function(){var it$0$8020;var self$8021;(it$0$8020=this);(self$8021=this);return it$0$8020.source.text.slice(it$0$8020.start,it$0$8020.end);});(Location$7802.prototype["linerange"]=function(){var l2$8092;var t0$8083;var t1$8084;var l1$8063;var $8047$8064;var t0$8057;var t1$8058;var t2$8059;var $8045$8052;var it$0$8036;var self$8037;(it$0$8036=this);(self$8037=this);($8045$8052=it$0$8036.linecol());if((($8045$8052 instanceof Array)&&(((t0$8057=$8045$8052.length)),((t0$8057===2)&&(((t1$8058=$8045$8052[0])),((t1$8058 instanceof Array)&&(((t2$8059=t1$8058.length)),(t2$8059===2)))))))){(l1$8063=t1$8058[0]);t1$8058[1];($8047$8064=$8045$8052[1]);if(($8047$8064===null)){return [l1$8063,l1$8063];}else{(t0$8083=$8047$8064);if(((t0$8083 instanceof Array)&&(((t1$8084=t0$8083.length)),(t1$8084===2)))){(l2$8092=t0$8083[0]);t0$8083[1];return [l1$8063,l2$8092];}else{$9966($8047$8064,"/home/olivier/git/earl-grey/src/location.eg",972,977);}}}else{$9966($8045$8052);}});(Location$7802.prototype["linecol"]=function(){var start$8127;var end$8128;var it$0$8115;var self$8116;(it$0$8115=this);(self$8116=this);(start$8127=it$0$8115.source.linecol(it$0$8115.start));(end$8128=function(){if((it$0$8115.start===it$0$8115.end)){return null;}else{return it$0$8115.source.linecol((it$0$8115.end-1));}}());return [start$8127,end$8128];});(Location$7802.prototype["ref"]=function(){var otherwise$8262;var $8242$8251;var $8238$8245;var l2$8214;var c2$8215;var t0$8203;var t1$8204;var t2$8205;var t3$8206;var l1$8171;var c1$8172;var $8153$8173;var t0$8163;var t1$8164;var t2$8165;var t3$8166;var t4$8167;var $8151$8158;var it$0$8142;var self$8143;(it$0$8142=this);(self$8143=this);($8151$8158=it$0$8142.linecol());if((($8151$8158 instanceof Array)&&(((t0$8163=$8151$8158.length)),((t0$8163===2)&&(((t1$8164=$8151$8158[0])),((t1$8164 instanceof Array)&&(((t2$8165=t1$8164.length)),((t2$8165===2)&&(((t3$8166=[true,String(t1$8164[0])])),(t3$8166[0]&&((l1$8171=t3$8166[1]),(((t4$8167=[true,String(t1$8164[1])])),t4$8167[0])))))))))))){(c1$8172=t4$8167[1]);($8153$8173=$8151$8158[1]);if(($8153$8173===null)){return ((l1$8171+":")+c1$8172);}else{(t0$8203=$8153$8173);if(((t0$8203 instanceof Array)&&(((t1$8204=t0$8203.length)),((t1$8204===2)&&(((t2$8205=[true,String(t0$8203[0])])),(t2$8205[0]&&((l2$8214=t2$8205[1]),(((t3$8206=[true,String(t0$8203[1])])),t3$8206[0])))))))){(c2$8215=t3$8206[1]);($8238$8245=null);$8238$8245;if(((l1$8171===l2$8214)&&(c1$8172===c2$8215))){return ((l1$8171+":")+c1$8172);}else{if((l1$8171===l2$8214)){return ((((l1$8171+":")+c1$8172)+"-")+c2$8215);}else{(otherwise$8262=$8238$8245);return ((((((l1$8171+":")+c1$8172)+"-")+l1$8171)+":")+c2$8215);}}}else{$9966($8153$8173,"/home/olivier/git/earl-grey/src/location.eg",1314,1319);}}}else{$9966($8151$8158);}});(Location$7802.prototype["highlight"]=function(){var cls$8296;var context$8297;var t0$8292;var $8275$8287;var it$0$8277;var self$8278;(it$0$8277=this);(self$8278=this);($8275$8287=arguments);(t0$8292=$8275$8287.length);if(((t0$8292>=0)&&(t0$8292<=2))){(cls$8296=function(){if((0>=t0$8292)){return "hl1";}else{return $8275$8287[0];}}());(context$8297=function(){if((1>=t0$8292)){return 0;}else{return $8275$8287[1];}}());return highlight_locations$7807([[it$0$8277,cls$8296]],context$8297);}else{$9966($8275$8287);}});$7709(Location$7802,$7709(((accum$8309=({})),((accum$8309["::name"]="Location"),accum$8309)),((accum$8313=({})),((accum$8313["::egclass"]=true),accum$8313))));Location$7802;(highlight$7803=function(){var $index$8365;var $length$8359;var temp$8353;var acc$8347;var text$8333;var spans$8334;var offset$8335;var t0$8329;var $8320$8324;($8320$8324=arguments);(t0$8329=$8320$8324.length);if(((t0$8329>=2)&&(t0$8329<=3))){(text$8333=$8320$8324[0]);(spans$8334=$8320$8324[1]);(offset$8335=function(){if((2>=t0$8329)){return 0;}else{return $8320$8324[2];}}());return $10244([],(((acc$8347=[])),(((temp$8353=morsel$7806(spans$8334))),((($length$8359=temp$8353.length)),((($index$8365=0)),function(){$8342:for(;($index$8365<$length$8359);($index$8365++)){var xstart$8402;var xend$8403;var start$8384;var end$8385;var attributes$8386;var t0$8379;var t1$8380;var m$8374;(m$8374=temp$8353[$index$8365]);(t0$8379=m$8374);if(((t0$8379 instanceof Array)&&(((t1$8380=t0$8379.length)),(t1$8380===3)))){(start$8384=t0$8379[0]);(end$8385=t0$8379[1]);(attributes$8386=t0$8379[2]);acc$8347.push((((xstart$8402=Math.max((start$8384-offset$8335),0))),((xend$8403=Math.min((end$8385-offset$8335),text$8333.length))),$10244(attributes$8386.slice(0,1),[text$8333.slice(xstart$8402,xend$8403)])));}else{$9966(m$8374,"/home/olivier/git/earl-grey/src/location.eg",1861,2073);}}}()))),acc$8347));}else{$9966($8320$8324);}});(highlight_lines$7804=function(text$8421,linelocs$8422,$8418$8423,spans$8424){var t0$8429;var t1$8430;var $index$8466;var $length$8460;var temp$8454;var acc$8448;var l1$8426;var l2$8427;(t0$8429=$8418$8423);if(((t0$8429 instanceof Array)&&(((t1$8430=t0$8429.length)),(t1$8430===2)))){(l1$8426=t0$8429[0]);(l2$8427=t0$8429[1]);}else{$9966($8418$8423);}return $10244(["+span"],(((acc$8448=[])),(((temp$8454=$10459(l1$8426,l2$8427))),((($length$8460=temp$8454.length)),((($index$8466=0)),function(){$8443:for(;($index$8466<$length$8460);($index$8466++)){var start$8489;var end$8490;var lineno$8483;var m$8475;(m$8475=temp$8454[$index$8466]);(lineno$8483=m$8475);acc$8448.push((((start$8489=$7708(linelocs$8422,lineno$8483))),((end$8490=$7708(linelocs$8422,(lineno$8483+1)))),$10244(["+span"],[$10244(["lineno"],(lineno$8483+1)),$10244(["source"],highlight$7803(text$8421,[[start$8489,end$8490,[]]].concat(clamp$7805(spans$8424,start$8489,end$8490))))])));}}()))),acc$8448));});(clamp$7805=function(spans$8502,bot$8503,top$8504){var $index$8529;var $length$8523;var temp$8517;var acc$8511;(acc$8511=[]);(temp$8517=spans$8502);($length$8523=temp$8517.length);($index$8529=0);$8506:for(;($index$8529<$length$8523);($index$8529++)){var start$8548;var end$8549;var attr$8550;var t0$8543;var t1$8544;var m$8538;(m$8538=temp$8517[$index$8529]);(t0$8543=m$8538);if(((t0$8543 instanceof Array)&&(((t1$8544=t0$8543.length)),((t1$8544===3)&&((start$8548=t0$8543[0]),((end$8549=t0$8543[1]),((attr$8550=t0$8543[2]),((end$8549>=bot$8503)&&(start$8548<=top$8504))))))))){acc$8511.push([Math.max(start$8548,bot$8503),Math.min(end$8549,top$8504),attr$8550]);}else{false;}}return acc$8511;});(morsel$7806=function(spans$8572){var jump$8579;var jumptill$8580;var process_elements$8581;var thespans$8582;(jump$8579=function(active$8587,bot$8588,top$8589){var $index$8625;var $length$8619;var temp$8613;var acc$8607;var $index$8678;var $length$8672;var temp$8666;var e$8594;var attributes$8595;(e$8594=$7708(Math.min,[top$8589].concat((((acc$8607=[])),(((temp$8613=active$8587)),((($length$8619=temp$8613.length)),((($index$8625=0)),function(){$8602:for(;($index$8625<$length$8619);($index$8625++)){var x$8644;var t0$8639;var t1$8640;var m$8634;(m$8634=temp$8613[$index$8625]);(t0$8639=m$8634);if(((t0$8639 instanceof Array)&&(((t1$8640=t0$8639.length)),(t1$8640===3)))){t0$8639[0];(x$8644=t0$8639[1]);t0$8639[2];acc$8607.push(x$8644);}else{$9966(m$8634,"/home/olivier/git/earl-grey/src/location.eg",3396,3439);}}}()))),acc$8607))));(attributes$8595=[]);(temp$8666=active$8587);($length$8672=temp$8666.length);($index$8678=0);$8596:for(;($index$8678<$length$8672);($index$8678++)){var X$8697;var t0$8692;var t1$8693;var m$8687;(m$8687=temp$8666[$index$8678]);(t0$8692=m$8687);if(((t0$8692 instanceof Array)&&(((t1$8693=t0$8692.length)),(t1$8693===3)))){t0$8692[0];t0$8692[1];(X$8697=t0$8692[2]);(attributes$8595=attributes$8595.concat(X$8697));}else{$9966(m$8687,"/home/olivier/git/earl-grey/src/location.eg",3465,3506);}}return [e$8594,[bot$8588,e$8594,attributes$8595]];});(jumptill$8580=function(active$8716,bot$8717,top$8718){var t0$8730;var t1$8731;var $index$8769;var $length$8763;var temp$8757;var acc$8751;var t0$8809;var t1$8810;var newbot$8724;var span$8725;var newactive$8726;var spans$8727;var remainder$8728;if((bot$8717===top$8718)){return [[],active$8716];}else{(t0$8730=jump$8579(active$8716,bot$8717,top$8718));if(((t0$8730 instanceof Array)&&(((t1$8731=t0$8730.length)),(t1$8731===2)))){(newbot$8724=t0$8730[0]);(span$8725=t0$8730[1]);}else{$9966(jump$8579(active$8716,bot$8717,top$8718),"/home/olivier/git/earl-grey/src/location.eg",3742,3776);}(newactive$8726=(((acc$8751=[])),(((temp$8757=active$8716)),((($length$8763=temp$8757.length)),((($index$8769=0)),function(){$8746:for(;($index$8769<$length$8763);($index$8769++)){var x$8788;var e$8789;var attr$8790;var t0$8783;var t1$8784;var m$8778;(m$8778=temp$8757[$index$8769]);(t0$8783=m$8778);(x$8788=t0$8783);if(((t0$8783 instanceof Array)&&(((t1$8784=t0$8783.length)),((t1$8784===3)&&(t0$8783[0],((e$8789=t0$8783[1]),((attr$8790=t0$8783[2]),(e$8789>newbot$8724)))))))){acc$8751.push(x$8788);}else{false;}}}()))),acc$8751));(t0$8809=jumptill$8580(newactive$8726,newbot$8724,top$8718));if(((t0$8809 instanceof Array)&&(((t1$8810=t0$8809.length)),(t1$8810===2)))){(spans$8727=t0$8809[0]);(remainder$8728=t0$8809[1]);}else{$9966(jumptill$8580(newactive$8726,newbot$8724,top$8718),"/home/olivier/git/earl-grey/src/location.eg",3891,3935);}return [[span$8725].concat(spans$8727),remainder$8728];}});(process_elements$8581=function(start$8828,active$8829,rem$8830){var $index$8935;var $length$8929;var temp$8923;var acc$8917;var t0$8974;var t1$8975;var top$8907;var bot$8908;var spans$8909;var t0$9027;var t1$9028;var spans$9024;var newactive$9025;var start$8990;var active$8991;var next$8992;var target$8993;var end$8994;var attr$8995;var rest$8996;var start$8887;var active$8888;var $8836$8852;var $8837$8853;var $8838$8854;var t0$8846;var t1$8847;var t2$8848;var t3$8849;var t4$8850;var $8832$8841;($8832$8841=[start$8828,active$8829,rem$8830]);if((($8836$8852=($8832$8841 instanceof Array))&&(((t0$8846=$8832$8841.length)),(($8838$8854=(t0$8846===3))&&($8832$8841[0],(((t1$8847=$8832$8841[1])),((t1$8847 instanceof Array)&&(((t2$8848=t1$8847.length)),((t2$8848===0)&&(((t3$8849=$8832$8841[2])),((t3$8849 instanceof Array)&&(((t4$8850=t3$8849.length)),(t4$8850===0))))))))))))){return [];}else{if(($8838$8854&&((start$8887=$8832$8841[0]),((active$8888=$8832$8841[1]),(((t1$8847=$8832$8841[2])),((t1$8847 instanceof Array)&&(((t2$8848=t1$8847.length)),(t2$8848===0)))))))){(top$8907=$7708(Math.max,(((acc$8917=[])),(((temp$8923=active$8888)),((($length$8929=temp$8923.length)),((($index$8935=0)),function(){$8912:for(;($index$8935<$length$8929);($index$8935++)){var e$8954;var t0$8949;var t1$8950;var m$8944;(m$8944=temp$8923[$index$8935]);(t0$8949=m$8944);if(((t0$8949 instanceof Array)&&(((t1$8950=t0$8949.length)),(t1$8950===3)))){t0$8949[0];(e$8954=t0$8949[1]);t0$8949[2];acc$8917.push(e$8954);}else{$9966(m$8944,"/home/olivier/git/earl-grey/src/location.eg",4120,4158);}}}()))),acc$8917)));(bot$8908=Math.min(start$8887,top$8907));(t0$8974=jumptill$8580(active$8888,start$8887,top$8907));if(((t0$8974 instanceof Array)&&(((t1$8975=t0$8974.length)),(t1$8975===2)))){(spans$8909=t0$8974[0]);t0$8974[1];}else{$9966(jumptill$8580(active$8888,start$8887,top$8907),"/home/olivier/git/earl-grey/src/location.eg",4211,4249);}return spans$8909;}else{if(($8838$8854&&((start$8990=$8832$8841[0]),((active$8991=$8832$8841[1]),(((t1$8847=$8832$8841[2])),((t1$8847 instanceof Array)&&(((t2$8848=t1$8847.length)),((t2$8848>=1)&&(((t3$8849=t1$8847[0])),((next$8992=t3$8849),((t3$8849 instanceof Array)&&(((t4$8850=t3$8849.length)),(t4$8850===3))))))))))))){(target$8993=t3$8849[0]);(end$8994=t3$8849[1]);(attr$8995=t3$8849[2]);(rest$8996=Array.prototype.slice.call(t1$8847,1));(t0$9027=jumptill$8580(active$8991,start$8990,target$8993));if(((t0$9027 instanceof Array)&&(((t1$9028=t0$9027.length)),(t1$9028===2)))){(spans$9024=t0$9027[0]);(newactive$9025=t0$9027[1]);}else{$9966(jumptill$8580(active$8991,start$8990,target$8993),"/home/olivier/git/earl-grey/src/location.eg",4353,4394);}return spans$9024.concat(process_elements$8581(target$8993,[next$8992].concat(newactive$9025),rest$8996));}else{$9966($8832$8841);}}}});(thespans$8582=spans$8572.sort(function($9047$9052,$9049$9053){var t0$9060;var t1$9061;var t0$9075;var t1$9076;var s1$9055;var e1$9056;var s2$9057;var e2$9058;(t0$9060=$9047$9052);if(((t0$9060 instanceof Array)&&(((t1$9061=t0$9060.length)),(t1$9061===3)))){(s1$9055=t0$9060[0]);(e1$9056=t0$9060[1]);t0$9060[2];}else{$9966($9047$9052);}(t0$9075=$9049$9053);if(((t0$9075 instanceof Array)&&(((t1$9076=t0$9075.length)),(t1$9076===3)))){(s2$9057=t0$9075[0]);(e2$9058=t0$9075[1]);t0$9075[2];}else{$9966($9049$9053);}if((s1$9055===s2$9057)){return (e1$9056-e2$9058);}else{return (s1$9055-s2$9057);}}));return process_elements$8581(thespans$8582[0][0],[],thespans$8582);});(highlight_locations$7807=function(){var $index$9140;var $length$9134;var temp$9128;var $index$9208;var $length$9202;var temp$9196;var acc$9190;var srcs$9118;var locations$9108;var context$9109;var t0$9104;var $9095$9099;($9095$9099=arguments);(t0$9104=$9095$9099.length);if(((t0$9104>=1)&&(t0$9104<=2))){(locations$9108=$9095$9099[0]);(context$9109=function(){if((1>=t0$9104)){return 0;}else{return $9095$9099[1];}}());(srcs$9118=({}));(temp$9128=locations$9108);($length$9134=temp$9128.length);($index$9140=0);$9119:for(;($index$9140<$length$9134);($index$9140++)){var key$9174;var loc$9159;var cls$9160;var t0$9154;var t1$9155;var m$9149;(m$9149=temp$9128[$index$9140]);(t0$9154=m$9149);if(((t0$9154 instanceof Array)&&(((t1$9155=t0$9154.length)),(t1$9155===2)))){(loc$9159=t0$9154[0]);(cls$9160=t0$9154[1]);(key$9174=String((loc$9159.source&&loc$9159.source.url)));if((!$7708(srcs$9118,key$9174))){(srcs$9118[key$9174]=[]);}$7708(srcs$9118,key$9174).push([loc$9159,cls$9160]);}else{$9966(m$9149,"/home/olivier/git/earl-grey/src/location.eg",4740,4909);}}return $10244(["+div"],(((acc$9190=[])),(((temp$9196=$10481(srcs$9118))),((($length$9202=temp$9196.length)),((($index$9208=0)),function(){$9185:for(;($index$9208<$length$9202);($index$9208++)){var locs$9227;var t0$9222;var t1$9223;var m$9217;(m$9217=temp$9196[$index$9208]);(t0$9222=m$9217);if(((t0$9222 instanceof Array)&&(((t1$9223=t0$9222.length)),(t1$9223===2)))){t0$9222[0];(locs$9227=t0$9222[1]);acc$9190.push(highlight_locations_same_source$7808(locs$9227,context$9109));}else{$9966(m$9217,"/home/olivier/git/earl-grey/src/location.eg",4914,5008);}}}()))),acc$9190));}else{$9966($9095$9099);}});(highlight_locations_same_source$7808=function(){var $index$9307;var $length$9301;var temp$9295;var acc$9289;var t0$9347;var t1$9348;var $index$9390;var $length$9384;var temp$9378;var acc$9372;var $index$9448;var $length$9442;var temp$9436;var acc$9430;var loc$9276;var src$9277;var l1$9278;var l2$9279;var first$9280;var last$9281;var locations$9262;var context$9263;var t0$9258;var $9249$9253;($9249$9253=arguments);(t0$9258=$9249$9253.length);if(((t0$9258>=1)&&(t0$9258<=2))){(locations$9262=$9249$9253[0]);(context$9263=function(){if((1>=t0$9258)){return 0;}else{return $9249$9253[1];}}());(loc$9276=merge_locations$7809((((acc$9289=[])),(((temp$9295=locations$9262)),((($length$9301=temp$9295.length)),((($index$9307=0)),function(){$9284:for(;($index$9307<$length$9301);($index$9307++)){var x$9326;var cls$9327;var t0$9321;var t1$9322;var m$9316;(m$9316=temp$9295[$index$9307]);(t0$9321=m$9316);if(((t0$9321 instanceof Array)&&(((t1$9322=t0$9321.length)),(t1$9322===2)))){(x$9326=t0$9321[0]);(cls$9327=t0$9321[1]);acc$9289.push(x$9326);}else{$9966(m$9316,"/home/olivier/git/earl-grey/src/location.eg",5091,5119);}}}()))),acc$9289)));(src$9277=loc$9276.source);(t0$9347=loc$9276.linerange());if(((t0$9347 instanceof Array)&&(((t1$9348=t0$9347.length)),(t1$9348===2)))){(l1$9278=t0$9347[0]);(l2$9279=t0$9347[1]);}else{$9966(loc$9276.linerange(),"/home/olivier/git/earl-grey/src/location.eg",5155,5174);}(first$9280=Math.max(1,(l1$9278-context$9263)));(last$9281=Math.min(src$9277.nlines,(l2$9279+context$9263)));return $10244(["+div","location"],[$10244(["+div","source"],[$10244(["sourcefile"],(src$9277.url||"???")),(((acc$9372=[])),(((temp$9378=locations$9262)),((($length$9384=temp$9378.length)),((($index$9390=0)),function(){$9367:for(;($index$9390<$length$9384);($index$9390++)){var loc$9409;var cls$9410;var t0$9404;var t1$9405;var m$9399;(m$9399=temp$9378[$index$9390]);(t0$9404=m$9399);if(((t0$9404 instanceof Array)&&(((t1$9405=t0$9404.length)),(t1$9405===2)))){(loc$9409=t0$9404[0]);(cls$9410=t0$9404[1]);acc$9372.push($10244([cls$9410,"sourcepos"],loc$9409.ref()));}else{$9966(m$9399,"/home/olivier/git/earl-grey/src/location.eg",5339,5409);}}}()))),acc$9372)]),src$9277.highlight_lines(first$9280,last$9281,(((acc$9430=[])),(((temp$9436=locations$9262)),((($length$9442=temp$9436.length)),((($index$9448=0)),function(){$9425:for(;($index$9448<$length$9442);($index$9448++)){var loc$9467;var cls$9468;var t0$9462;var t1$9463;var m$9457;(m$9457=temp$9436[$index$9448]);(t0$9462=m$9457);if(((t0$9462 instanceof Array)&&(((t1$9463=t0$9462.length)),(t1$9463===2)))){(loc$9467=t0$9462[0]);(cls$9468=t0$9462[1]);acc$9430.push([loc$9467.start,loc$9467.end,[cls$9468]]);}else{$9966(m$9457,"/home/olivier/git/earl-grey/src/location.eg",5464,5522);}}}()))),acc$9430))]);}else{$9966($9249$9253);}});(merge_locations$7809=function($9489$9492){var $index$9564;var $length$9558;var temp$9552;var acc$9546;var $index$9610;var $length$9604;var temp$9598;var acc$9592;var start$9537;var end$9538;var locs$9531;var loc$9526;var $9498$9513;var $9499$9514;var t0$9511;var $9494$9506;var ph$9500;(ph$9500=$9489$9492);($9494$9506=ph$9500);if((($9498$9513=($9494$9506 instanceof Array))&&(((t0$9511=$9494$9506.length)),(t0$9511===0)))){return Location$7802(null,0,0);}else{if(($9498$9513&&(t0$9511===1))){(loc$9526=$9494$9506[0]);return loc$9526;}else{if(($9498$9513&&(t0$9511>=0))){(locs$9531=Array.prototype.slice.call($9494$9506,0));(start$9537=$7708(Math.min,(((acc$9546=[])),(((temp$9552=locs$9531)),((($length$9558=temp$9552.length)),((($index$9564=0)),function(){$9541:for(;($index$9564<$length$9558);($index$9564++)){var loc$9581;var m$9573;(m$9573=temp$9552[$index$9564]);(loc$9581=m$9573);acc$9546.push(loc$9581.start);}}()))),acc$9546)));(end$9538=$7708(Math.max,(((acc$9592=[])),(((temp$9598=locs$9531)),((($length$9604=temp$9598.length)),((($index$9610=0)),function(){$9587:for(;($index$9610<$length$9604);($index$9610++)){var loc$9627;var m$9619;(m$9619=temp$9598[$index$9610]);(loc$9627=m$9619);acc$9592.push(loc$9627.end);}}()))),acc$9592)));return Location$7802(locs$9531[0].source,start$9537,end$9538);}else{$9966($9494$9506);}}}});(__lt____lt____colon__$7810=function(x$9638,y$9639){if((!$7689(Location$7802)(x$9638.location))){(x$9638["location"]=function(){if(((!y$9639)||$7689(Location$7802)(y$9639))){return y$9639;}else{return y$9639.location;}}());}return x$9638;});(__plus____plus____colon__$7811=function(x$9652,y$9653){var rval$9670;var x2$9658;var y2$9659;(x2$9658=function(){if(((!x$9652)||$7689(Location$7802)(x$9652))){return x$9652;}else{return x$9652.location;}}());(y2$9659=function(){if(((!y$9653)||$7689(Location$7802)(y$9653))){return y$9653;}else{return y$9653.location;}}());(rval$9670=false);try{(rval$9670=merge_locations$7809([x2$9658,y2$9659]));}catch(excv$9681){var e$9687;(e$9687=excv$9681);(rval$9670=(void 0));}return rval$9670;});(format_error$7812=function(){var $index$9803;var $length$9797;var temp$9791;var acc$9785;var hls$9773;var locs$9774;var rval$9885;var loc$9911;var data$9878;var other$9917;var url$9866;var start$9867;var end$9868;var loc$9856;var args$9753;var fmt_args$9743;var $9705$9738;var $9706$9739;var $9707$9740;var t0$9734;var t1$9735;var t2$9736;var e$9720;var context$9721;var $9700$9722;var t0$9715;var t1$9716;var $9698$9710;($9698$9710=arguments);(t0$9715=$9698$9710.length);if(((t0$9715>=1)&&(t0$9715<=2))){(t1$9716=$9698$9710[0]);(e$9720=t1$9716);($9700$9722=t1$9716);(context$9721=function(){if((1>=t0$9715)){return 0;}else{return $9698$9710[1];}}());(fmt_args$9743=function(e$9748){if((e$9748.args&&e$9748.args.length)){return $10244(["error_args"],repr$7799(e$9748.args));}else{return "";}});(t0$9734=$9700$9722);if(($7689($9985(["syntax"]))(t0$9734)&&($10498(t0$9734,"args")&&(((t1$9735=t0$9734.args)),((t1$9735 instanceof Array)&&(((t2$9736=t1$9735.length)),(t2$9736===1))))))){(args$9753=t1$9735[0]);(hls$9773=["hl1","hl2","hl3","hl4"]);(locs$9774=(((acc$9785=[])),(((temp$9791=$10218($10481(args$9753)))),((($length$9797=temp$9791.length)),((($index$9803=0)),function(){$9780:for(;($index$9803<$length$9797);($index$9803++)){var i$9824;var key$9825;var arg$9826;var t0$9817;var t1$9818;var t2$9819;var t3$9820;var m$9812;(m$9812=temp$9791[$index$9803]);(t0$9817=m$9812);if(((t0$9817 instanceof Array)&&(((t1$9818=t0$9817.length)),((t1$9818===2)&&((i$9824=t0$9817[0]),(((t2$9819=t0$9817[1])),((t2$9819 instanceof Array)&&(((t3$9820=t2$9819.length)),((t3$9820===2)&&((key$9825=t2$9819[0]),((arg$9826=t2$9819[1]),(arg$9826&&arg$9826.location)))))))))))){acc$9785.push([arg$9826.location,$7708(hls$9773,(i$9824%4))]);}else{false;}}}()))),acc$9785));return $10244(["+div"],[$10244(["error"],[$10244(["error_type"],e$9720.name),$10244(["error_message"],e$9720.message)]),$10244(["error_args","syntax"],repr$7799(args$9753)),highlight_locations$7807(locs$9774,context$9721)]);}else{if((($9706$9739=$10498(t0$9734,"location"))&&(((t1$9735=t0$9734.location)),$7689(Location$7802)(t1$9735)))){(loc$9856=t1$9735);return $10244(["+div"],[$10244(["error"],[$10244(["error_type"],e$9720.name),$10244(["error_message"],e$9720.message)]),fmt_args$9743(e$9720),highlight_locations$7807([[loc$9856,"hl1"]],context$9721),$10244(["traceback"],(e$9720.stack||""))]);}else{if(($9706$9739&&((t1$9735 instanceof Array)&&(((t2$9736=t1$9735.length)),((t2$9736===4)&&(t1$9735[0]==="location")))))){(url$9866=t1$9735[1]);(start$9867=t1$9735[2]);(end$9868=t1$9735[3]);(data$9878=(((rval$9885=false)),(function(){try{(rval$9885=fs$7800.readFileSync(url$9866,"utf8"));}catch(excv$9896){var e$9902;(e$9902=excv$9896);(rval$9885=null);}}(),rval$9885)));if(data$9878){(loc$9911=Location$7802(Source$7801(data$9878,url$9866),start$9867,end$9868));return $10244(["+div"],[$10244(["error"],[$10244(["error_type"],e$9720.name),$10244(["error_message"],e$9720.message)]),fmt_args$9743(e$9720),highlight_locations$7807([[loc$9911,"hl1"]],context$9721),$10244(["traceback"],($10244([],e$9720.stack)||""))]);}else{return $10244(["+div"],[$10244(["error"],[$10244(["error_type"],e$9720.name),$10244(["error_message"],e$9720.message)]),fmt_args$9743(e$9720),$10244(["traceback"],($10244([],e$9720.stack)||e$9720))]);}}else{(other$9917=$9700$9722);return $10244(["+div"],[$10244(["error"],[$10244(["error_type"],e$9720.name),$10244(["error_message"],e$9720.message)]),fmt_args$9743(e$9720),$10244(["traceback"],$10244([],e$9720.stack))]);}}}}else{$9966($9698$9710);}});(display_error$7813=function(e$9926){return __lt____gt__$7798(null,format_error$7812(e$9926));});(exports["Source"]=Source$7801);(exports["Location"]=Location$7802);(exports["highlight"]=highlight$7803);(exports["highlight_locations"]=highlight_locations$7807);(exports["merge_locations"]=merge_locations$7809);(exports["<<:"]=__lt____lt____colon__$7810);(exports["++:"]=__plus____plus____colon__$7811);(exports["format_error"]=format_error$7812);(exports["display_error"]=display_error$7813);
