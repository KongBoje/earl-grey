var τ824=function(type){var τ825=type["::check"];var f;if((τ825===(void 0))){return function(value){return (value instanceof type);};}else{if(((f=τ825),true)){return function(value){return f.call(type,value);};}else{throw τ816(["match"]).create("Could not find a match",({"value":τ825}));}}};
var τ826=function(dest,values){for(k in values){if(values.hasOwnProperty(k)){(dest[k]=send(values,k));}else{null;}}return dest;};
var τ816=function(){var τ817=function(tags){var τ818=function(){if((!τ824(τ817)(this))){return Object.create(τ817.prototype);}else{return this;}}();(τ818["tags"]=tags);return τ818;};τ826(τ817);(τ817.prototype["create"]=function(){var τ819=Array.prototype.slice.call(arguments,0);var τp0;var message;var args;if(((τ819 instanceof Array)&&(((τp0=τ819.length),true)&&((τp0>=0)&&((message=function(){if((0>=τp0)){return "";}else{return τ819[0];}}()),true,(args=τ819.slice(1)),true))))){var τ818=this;var e=Error(message);(e["::tags"]=τ818.tags);(e["args"]=args);(e["name"]=["E"].concat(τ818.tags).join("."));return e;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ819}));}});(τ817.prototype["::check"]=function(e){var τ818=this;if(((!e)||(!τ824(Error)(e)))){return false;}else{null;}var tags=(e["::tags"]||[]);var τ820=τ818.tags;var τ821=τ820.length;for(var τ822=0;(τ822<τ821);(τ822++)){var τ823=τ820[τ822];var tag;var other;if(((tag=τ823),true,(tags.indexOf(tag)===(-1)))){return false;}else{if(((other=τ823),true)){false;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ823}));}}}false;return true;});(τ817.prototype["::deconstruct"]=function(e){var τ818=this;return e.args;});return τ817;}();
var τ827=function(){var r=[];for(var i=0;(i<arguments.length);(i++)){(r=r.concat(arguments[i]));}return r;};
var τ828=function(τ829){var τ830=τ829;var x;var x;var other;if((((typeof(τ830)==="string")&&((x=τ830),true))||((typeof(τ830)==="number")&&((x=τ830),true)))){return ["value",x];}else{if(((other=τ830),true)){return other["::serialize_ast"]();}else{throw τ816(["match"]).create("Could not find a match",({"value":τ830}));}}};
var send=function(obj,τ809){var msg;var τ808;(msg=τ809);true;(τ808=τ809);var τ810=τ808;var other;if(((typeof(τ810)==="string")||(typeof(τ810)==="number"))){return obj[msg];}else{if(((other=τ810),true)){return obj["::send"](msg);}else{throw τ816(["match"]).create("Could not find a match",({"value":τ810}));}}};(Array[":::project"]=function(τ812){var value;var τ811;(value=τ812);true;(τ811=τ812);var τ813=τ811;var _;if(τ824(Array)(τ813)){return [true,value];}else{if(((_=τ813),true)){return [true,[value]];}else{throw τ816(["match"]).create("Could not find a match",({"value":τ813}));}}});(Array.prototype["::check"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){return false;}else{null;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){var rval=this.slice(0);rval.push(value);return [true,rval];}else{null;}}return [true,value];}else{var rval=this.slice(0);rval.push(value);return [true,rval];}});(Array.prototype[":::deconstruct"]=function(value){return [true,value.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return τ827(["array"],this.map(τ828));});(RegExp.prototype["::check"]=function(value){return value.match(this);});(RegExp.prototype[":::project"]=function(value){var τ814=value.match(this);var m;var m;if(((τ814===null)&&((m=τ814),true))){return [false,null];}else{if(((m=τ814),true)){return [true,m];}else{throw τ816(["match"]).create("Could not find a match",({"value":τ814}));}}});(RegExp.prototype[":::deconstruct"]=function(value){var τ815=value.match(this);var m;var m;if(((τ815===null)&&((m=τ815),true))){return [false,null];}else{if(((m=τ815),true)){return [true,m];}else{throw τ816(["match"]).create("Could not find a match",({"value":τ815}));}}});(Function.prototype["::send"]=function(args){return this.apply(this,args);});
var τ946=function(from,to){var rval=[];for(var i=from;(i<=to);(i++)){rval.push(i);}return rval;};
var τ947=function(type){return function(value){var τ948=type[":::deconstruct"];var f;if((τ948===(void 0))){var τ949=type["::deconstruct"];var f;if((τ949===(void 0))){if((value instanceof Array)){return [true,value];}else{if(true){return [false,null];}else{return false;}}}else{if(((f=τ949),true)){var τ951;try{(τ951=[true,f.call(type,value)]);}catch(τ950){(τ951=[false,null]);}return τ951;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ949}));}}}else{if(((f=τ948),true)){return f.call(type,value);}else{throw τ816(["match"]).create("Could not find a match",({"value":τ948}));}}};};
var τ952=function(τ953,key){var τ954=τ953;var x;var x;var x;if(((τ954===null)||(τ954===(void 0)))){return false;}else{if(((typeof(τ954)==="string")&&((x=τ954),true))){return (key in String.prototype);}else{if(((typeof(τ954)==="number")&&((x=τ954),true))){return (key in Number.prototype);}else{if(((x=τ954),true)){return (key in x);}else{throw τ816(["match"]).create("Could not find a match",({"value":τ954}));}}}}};var τ831=require("./util");var binsearch=τ831.binsearch;var items=τ831.items;var enumerate=τ831.enumerate;var τ832=require("./pp");var Node=τ832.Node;var __lt____gt__=τ832["<>"];var repr=τ832.repr;var fs=require("fs");var Source=function(){var τ834=Array.prototype.slice.call(arguments,0);var τp0;var text;var url;if(((τ834 instanceof Array)&&(((τp0=τ834.length),true)&&(((τp0>=1)&&(τp0<=2))&&((text=τ834[0]),true,(url=function(){if((1>=τp0)){return false;}else{return τ834[1];}}()),true))))){var τ833=function(){if((!τ824(Source)(this))){return Object.create(Source.prototype);}else{return this;}}();(τ833["text"]=text);(τ833["url"]=url);(τ833["counts"]=[]);var curr=0;var τ835=text.split("\n");var τ836=τ835.length;for(var τ837=0;(τ837<τ836);(τ837++)){var τ838=τ835[τ837];var line;var other;if(((line=τ838),true)){τ833.counts.push(curr);(curr=(curr+(line.length+1)));}else{if(((other=τ838),true)){false;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ838}));}}}false;τ833.counts.push(curr);(τ833["nlines"]=(τ833.counts.length-1));return τ833;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ834}));}};τ826(Source);(Source.prototype["linecol"]=function(pos){var τ833=this;var line=binsearch(τ833.counts,pos);var col=(pos-send(τ833.counts,(line-1)));return [line,col];});(Source.prototype["highlight_lines"]=function(l1,l2,spans){var τ833=this;return highlight_lines(τ833.text,τ833.counts,[(l1-1),(l2-1)],spans);});Source;var Location=function(source,start,end){var τ839=function(){if((!τ824(Location)(this))){return Object.create(Location.prototype);}else{return this;}}();(τ839["source"]=(source||Source("",null)));(τ839["start"]=start);(τ839["end"]=end);return τ839;};τ826(Location);(Location.prototype["text"]=function(){var τ839=this;return τ839.source.text.slice(τ839.start,τ839.end);});(Location.prototype["linerange"]=function(){var τ839=this;var τ840=τ839.linecol();var τp0;var τp1;var τp2;var l1;var _;var τ841;if(((τ840 instanceof Array)&&(((τp0=τ840.length),true)&&((τp0===2)&&(((τp1=τ840[0]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===2)&&((l1=τp1[0]),true,(_=τp1[1]),true,(τ841=τ840[1]),true)))))))){var τ842=τ841;var τp0;var l2;var _;if((τ842===null)){return [l1,l1];}else{if(((τ842 instanceof Array)&&(((τp0=τ842.length),true)&&((τp0===2)&&((l2=τ842[0]),true,(_=τ842[1]),true))))){return [l1,l2];}else{throw τ816(["match"]).create("Could not find a match",({"value":τ842}));}}}else{throw τ816(["match"]).create("Could not find a match",({"value":τ840}));}});(Location.prototype["linecol"]=function(){var τ839=this;var start=τ839.source.linecol(τ839.start);var end=function(){if((τ839.start===τ839.end)){return null;}else{return τ839.source.linecol((τ839.end-1));}}();return [start,end];});(Location.prototype["ref"]=function(){var τ839=this;var τ843=τ839.linecol();var τp0;var τp1;var τp2;var τp3;var τp4;var l1;var τp5;var τp6;var c1;var τ844;if(((τ843 instanceof Array)&&(((τp0=τ843.length),true)&&((τp0===2)&&(((τp1=τ843[0]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===2)&&(((τp3=τp1[0]),(τp4=[true,String(τp3)]),τp4[0])&&(((l1=τp4[1]),true,(τp5=τp1[1]),(τp6=[true,String(τp5)]),τp6[0])&&((c1=τp6[1]),true,(τ844=τ843[1]),true)))))))))){var τ845=τ844;var τp0;var τp1;var τp2;var l2;var τp3;var τp4;var c2;if((τ845===null)){return ((l1+":")+c1);}else{if(((τ845 instanceof Array)&&(((τp0=τ845.length),true)&&((τp0===2)&&(((τp1=τ845[0]),(τp2=[true,String(τp1)]),τp2[0])&&(((l2=τp2[1]),true,(τp3=τ845[1]),(τp4=[true,String(τp3)]),τp4[0])&&((c2=τp4[1]),true))))))){var τ846=null;var otherwise;if(((l1===l2)&&(c1===c2))){return ((l1+":")+c1);}else{if((l1===l2)){return ((((l1+":")+c1)+"-")+c2);}else{if(((otherwise=τ846),true)){return ((((((l1+":")+c1)+"-")+l1)+":")+c2);}else{throw τ816(["match"]).create("Could not find a match",({"value":τ846}));}}}}else{throw τ816(["match"]).create("Could not find a match",({"value":τ845}));}}}else{throw τ816(["match"]).create("Could not find a match",({"value":τ843}));}});(Location.prototype["highlight"]=function(){var τ847=Array.prototype.slice.call(arguments,0);var τp0;var cls;var context;if(((τ847 instanceof Array)&&(((τp0=τ847.length),true)&&(((τp0>=0)&&(τp0<=2))&&((cls=function(){if((0>=τp0)){return "hl1";}else{return τ847[0];}}()),true,(context=function(){if((1>=τp0)){return 0;}else{return τ847[1];}}()),true))))){var τ839=this;return highlight_locations([[τ839,cls]],context);}else{throw τ816(["match"]).create("Could not find a match",({"value":τ847}));}});Location;var highlight=function(){var τ848=Array.prototype.slice.call(arguments,0);var τp0;var text;var spans;var offset;if(((τ848 instanceof Array)&&(((τp0=τ848.length),true)&&(((τp0>=2)&&(τp0<=3))&&((text=τ848[0]),true,(spans=τ848[1]),true,(offset=function(){if((2>=τp0)){return 0;}else{return τ848[2];}}()),true))))){return Node([],function(){var τ849=[];var τ850=morsel(spans);var τ851=τ850.length;for(var τ852=0;(τ852<τ851);(τ852++)){var τ853=τ850[τ852];var τp0;var start;var end;var attributes;var other;if(((τ853 instanceof Array)&&(((τp0=τ853.length),true)&&((τp0===3)&&((start=τ853[0]),true,(end=τ853[1]),true,(attributes=τ853[2]),true))))){τ849.push(function(){var xstart=Math.max((start-offset),0);var xend=Math.min((end-offset),text.length);return Node(attributes,[text.slice(xstart,xend)]);}());}else{if(((other=τ853),true)){false;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ853}));}}}return τ849;}());}else{throw τ816(["match"]).create("Could not find a match",({"value":τ848}));}};var highlight_lines=function(text,linelocs,τ854,spans){var τp0;var l1;var l2;if(((τ854 instanceof Array)&&(((τp0=τ854.length),true)&&((τp0===2)&&((l1=τ854[0]),true,(l2=τ854[1]),true))))){undefined;}else{throw τ816(["match"]).create("The value failed to match");}return Node(["+span"],function(){var τ855=[];var τ856=τ946(l1,l2);var τ857=τ856.length;for(var τ858=0;(τ858<τ857);(τ858++)){var τ859=τ856[τ858];var lineno;var other;if(((lineno=τ859),true)){τ855.push(function(){var start=send(linelocs,lineno);var end=send(linelocs,(lineno+1));return Node(["+span"],[Node(["lineno"],(lineno+1)),Node(["source"],highlight(text,τ827([[start,end,[]]],clamp(spans,start,end))))]);}());}else{if(((other=τ859),true)){false;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ859}));}}}return τ855;}());};var clamp=function(spans,bot,top){var τ860=[];var τ861=spans;var τ862=τ861.length;for(var τ863=0;(τ863<τ862);(τ863++)){var τ864=τ861[τ863];var τp0;var start;var end;var attr;var other;if(((τ864 instanceof Array)&&(((τp0=τ864.length),true)&&((τp0===3)&&((start=τ864[0]),true,(end=τ864[1]),true,(attr=τ864[2]),true,((end>=bot)&&(start<=top))))))){τ860.push([Math.max(start,bot),Math.min(end,top),attr]);}else{if(((other=τ864),true)){false;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ864}));}}}return τ860;};var morsel=function(spans){var jump=function(active,bot,top){var e=send(Math.min,τ827([top],function(){var τ865=[];var τ866=active;var τ867=τ866.length;for(var τ868=0;(τ868<τ867);(τ868++)){var τ869=τ866[τ868];var τp0;var _;var x;var _;var other;if(((τ869 instanceof Array)&&(((τp0=τ869.length),true)&&((τp0===3)&&((_=τ869[0]),true,(x=τ869[1]),true,(_=τ869[2]),true))))){τ865.push(x);}else{if(((other=τ869),true)){false;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ869}));}}}return τ865;}()));var attributes=send(τ827,function(){var τ870=[];var τ871=active;var τ872=τ871.length;for(var τ873=0;(τ873<τ872);(τ873++)){var τ874=τ871[τ873];var τp0;var _;var _;var X;var other;if(((τ874 instanceof Array)&&(((τp0=τ874.length),true)&&((τp0===3)&&((_=τ874[0]),true,(_=τ874[1]),true,(X=τ874[2]),true))))){τ870.push(X);}else{if(((other=τ874),true)){false;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ874}));}}}return τ870;}());return [e,[bot,e,attributes]];};var jumptill=function(active,bot,top){if((bot===top)){return [[],active];}else{if(true){var τp0;var τp1;var newbot;var span;if((((τp0=jump(active,bot,top)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((newbot=τp0[0]),true,(span=τp0[1]),true))))){undefined;}else{throw τ816(["match"]).create("The value failed to match");}var newactive=function(){var τ875=[];var τ876=active;var τ877=τ876.length;for(var τ878=0;(τ878<τ877);(τ878++)){var τ879=τ876[τ878];var x;var τp0;var _;var e;var attr;var other;if((((x=τ879),true,(τ879 instanceof Array))&&(((τp0=τ879.length),true)&&((τp0===3)&&((_=τ879[0]),true,(e=τ879[1]),true,(attr=τ879[2]),true,(e>newbot)))))){τ875.push(x);}else{if(((other=τ879),true)){false;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ879}));}}}return τ875;}();var τp0;var τp1;var spans;var remainder;if((((τp0=jumptill(newactive,newbot,top)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((spans=τp0[0]),true,(remainder=τp0[1]),true))))){undefined;}else{throw τ816(["match"]).create("The value failed to match");}return [[span].concat(spans),remainder];}else{return false;}}};var process=function(start,active,rem){var τ880=[start,active,rem];var τp0;var _;var τp1;var τp2;var τp3;var τp4;var τp0;var start;var active;var τp1;var τp2;var τp0;var start;var active;var τp1;var τp2;var τp3;var next;var τp4;var target;var end;var attr;var rest;var τ881=false;var τ882=false;var τ883=false;var τ884=false;var τ885=false;if(((τ881=(τ880 instanceof Array))&&((τ882=((τp0=τ880.length),true))&&((τ883=(τp0===3))&&(((_=τ880[0]),true,(τp1=τ880[1]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===0)&&(((τp3=τ880[2]),(τp3 instanceof Array))&&(((τp4=τp3.length),true)&&(τp4===0)))))))))){return [];}else{if((τ883&&((τ884=((start=τ880[0]),true,(active=τ880[1]),true,(τp1=τ880[2]),(τp1 instanceof Array)))&&((τ885=((τp2=τp1.length),true))&&(τp2===0))))){var top=send(Math.max,function(){var τ886=[];var τ887=active;var τ888=τ887.length;for(var τ889=0;(τ889<τ888);(τ889++)){var τ890=τ887[τ889];var τp0;var _;var e;var _;var other;if(((τ890 instanceof Array)&&(((τp0=τ890.length),true)&&((τp0===3)&&((_=τ890[0]),true,(e=τ890[1]),true,(_=τ890[2]),true))))){τ886.push(e);}else{if(((other=τ890),true)){false;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ890}));}}}return τ886;}());var bot=Math.min(start,top);var τp0;var τp1;var spans;var _;if((((τp0=jumptill(active,start,top)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((spans=τp0[0]),true,(_=τp0[1]),true))))){undefined;}else{throw τ816(["match"]).create("The value failed to match");}return spans;}else{if((τ885&&((τp2>=1)&&(((τp3=τp1[0]),(next=τp3),true,(τp3 instanceof Array))&&(((τp4=τp3.length),true)&&((τp4===3)&&((target=τp3[0]),true,(end=τp3[1]),true,(attr=τp3[2]),true,(rest=τp1.slice(1)),true))))))){var τp0;var τp1;var spans;var newactive;if((((τp0=jumptill(active,start,target)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((spans=τp0[0]),true,(newactive=τp0[1]),true))))){undefined;}else{throw τ816(["match"]).create("The value failed to match");}return spans.concat(process(target,[next].concat(newactive),rest));}else{throw τ816(["match"]).create("Could not find a match",({"value":τ880}));}}}};var thespans=spans.sort(function(τ891,τ892){var τp0;var s1;var e1;var _;if(((τ891 instanceof Array)&&(((τp0=τ891.length),true)&&((τp0===3)&&((s1=τ891[0]),true,(e1=τ891[1]),true,(_=τ891[2]),true))))){undefined;}else{throw τ816(["match"]).create("The value failed to match");}var τp0;var s2;var e2;var _;if(((τ892 instanceof Array)&&(((τp0=τ892.length),true)&&((τp0===3)&&((s2=τ892[0]),true,(e2=τ892[1]),true,(_=τ892[2]),true))))){undefined;}else{throw τ816(["match"]).create("The value failed to match");}if((s1===s2)){return (e1-e2);}else{return (s1-s2);}});return process(thespans[0][0],[],thespans);};var highlight_locations=function(){var τ893=Array.prototype.slice.call(arguments,0);var τp0;var locations;var context;if(((τ893 instanceof Array)&&(((τp0=τ893.length),true)&&(((τp0>=1)&&(τp0<=2))&&((locations=τ893[0]),true,(context=function(){if((1>=τp0)){return 0;}else{return τ893[1];}}()),true))))){var srcs=({});var τ894=locations;var τ895=τ894.length;for(var τ896=0;(τ896<τ895);(τ896++)){var τ897=τ894[τ896];var τp0;var loc;var cls;var other;if(((τ897 instanceof Array)&&(((τp0=τ897.length),true)&&((τp0===2)&&((loc=τ897[0]),true,(cls=τ897[1]),true))))){var key=String((loc.source&&loc.source.url));if((!send(srcs,key))){(srcs[key]=[]);}else{null;}send(srcs,key).push([loc,cls]);}else{if(((other=τ897),true)){false;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ897}));}}}false;return Node(["+div"],function(){var τ898=[];var τ899=items(srcs);var τ900=τ899.length;for(var τ901=0;(τ901<τ900);(τ901++)){var τ902=τ899[τ901];var τp0;var _;var locs;var other;if(((τ902 instanceof Array)&&(((τp0=τ902.length),true)&&((τp0===2)&&((_=τ902[0]),true,(locs=τ902[1]),true))))){τ898.push(highlight_locations_same_source(locs,context));}else{if(((other=τ902),true)){false;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ902}));}}}return τ898;}());}else{throw τ816(["match"]).create("Could not find a match",({"value":τ893}));}};var highlight_locations_same_source=function(){var τ903=Array.prototype.slice.call(arguments,0);var τp0;var locations;var context;if(((τ903 instanceof Array)&&(((τp0=τ903.length),true)&&(((τp0>=1)&&(τp0<=2))&&((locations=τ903[0]),true,(context=function(){if((1>=τp0)){return 0;}else{return τ903[1];}}()),true))))){var loc=merge_locations(function(){var τ904=[];var τ905=locations;var τ906=τ905.length;for(var τ907=0;(τ907<τ906);(τ907++)){var τ908=τ905[τ907];var τp0;var x;var cls;var other;if(((τ908 instanceof Array)&&(((τp0=τ908.length),true)&&((τp0===2)&&((x=τ908[0]),true,(cls=τ908[1]),true))))){τ904.push(x);}else{if(((other=τ908),true)){false;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ908}));}}}return τ904;}());var src=loc.source;var τp0;var τp1;var l1;var l2;if((((τp0=loc.linerange()),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((l1=τp0[0]),true,(l2=τp0[1]),true))))){undefined;}else{throw τ816(["match"]).create("The value failed to match");}var first=Math.max(1,(l1-context));var last=Math.min(src.nlines,(l2+context));return Node(["+div","location"],[Node(["+div","source"],[Node(["sourcefile"],(src.url||"???")),function(){var τ909=[];var τ910=locations;var τ911=τ910.length;for(var τ912=0;(τ912<τ911);(τ912++)){var τ913=τ910[τ912];var τp0;var loc;var cls;var other;if(((τ913 instanceof Array)&&(((τp0=τ913.length),true)&&((τp0===2)&&((loc=τ913[0]),true,(cls=τ913[1]),true))))){τ909.push(Node([cls,"sourcepos"],loc.ref()));}else{if(((other=τ913),true)){false;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ913}));}}}return τ909;}()]),src.highlight_lines(first,last,function(){var τ914=[];var τ915=locations;var τ916=τ915.length;for(var τ917=0;(τ917<τ916);(τ917++)){var τ918=τ915[τ917];var τp0;var loc;var cls;var other;if(((τ918 instanceof Array)&&(((τp0=τ918.length),true)&&((τp0===2)&&((loc=τ918[0]),true,(cls=τ918[1]),true))))){τ914.push([loc.start,loc.end,[cls]]);}else{if(((other=τ918),true)){false;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ918}));}}}return τ914;}())]);}else{throw τ816(["match"]).create("Could not find a match",({"value":τ903}));}};var merge_locations=function(τ919){var τ920=τ919;var τp0;var τp0;var loc;var τp0;var locs;var τ921=false;var τ922=false;if(((τ921=(τ920 instanceof Array))&&((τ922=((τp0=τ920.length),true))&&(τp0===0)))){return Location(null,0,0);}else{if((τ922&&((τp0===1)&&((loc=τ920[0]),true)))){return loc;}else{if((τ922&&((τp0>=0)&&((locs=τ920.slice(0)),true)))){var start=send(Math.min,function(){var τ923=[];var τ924=locs;var τ925=τ924.length;for(var τ926=0;(τ926<τ925);(τ926++)){var τ927=τ924[τ926];var loc;var other;if(((loc=τ927),true)){τ923.push(loc.start);}else{if(((other=τ927),true)){false;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ927}));}}}return τ923;}());var end=send(Math.max,function(){var τ928=[];var τ929=locs;var τ930=τ929.length;for(var τ931=0;(τ931<τ930);(τ931++)){var τ932=τ929[τ931];var loc;var other;if(((loc=τ932),true)){τ928.push(loc.end);}else{if(((other=τ932),true)){false;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ932}));}}}return τ928;}());return Location(locs[0].source,start,end);}else{throw τ816(["match"]).create("Could not find a match",({"value":τ920}));}}}};var __lt____lt____colon__=function(x,y){if((!x.location)){(x["location"]=function(){if(((!y)||τ824(Location)(y))){return y;}else{return y.location;}}());}else{null;}return x;};var __plus____plus____colon__=function(x,y){(x=function(){if(((!x)||τ824(Location)(x))){return x;}else{return x.location;}}());(y=function(){if(((!y)||τ824(Location)(y))){return y;}else{return y.location;}}());var τ934;try{(τ934=merge_locations([x,y]));}catch(τ933){(τ934=undefined);}return τ934;};var format_error=function(τ936){var e;var τ935;(e=τ936);true;(τ935=τ936);var τ937=τ935;var τp0;var τp1;var τp2;var args;var τp0;var loc;var τp0;var τp1;var τp2;var url;var start;var end;var other;var τ938=false;if((τ824(τ816(["syntax"]))(τ937)&&(((τp0=τ947(τ816(["syntax"]))(τ937)),τp0[0])&&(((τp1=τp0[1]),true,(τp2=τp1.length),true)&&((τp2===1)&&((args=τp1[0]),true)))))){var hls=["hl1","hl2","hl3","hl4"];var locs=function(){var τ939=[];var τ940=enumerate(items(args));var τ941=τ940.length;for(var τ942=0;(τ942<τ941);(τ942++)){var τ943=τ940[τ942];var τp0;var i;var τp1;var τp2;var key;var arg;var other;if(((τ943 instanceof Array)&&(((τp0=τ943.length),true)&&((τp0===2)&&(((i=τ943[0]),true,(τp1=τ943[1]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===2)&&((key=τp1[0]),true,(arg=τp1[1]),true,(arg&&arg.location))))))))){τ939.push([arg.location,send(hls,(i%4))]);}else{if(((other=τ943),true)){false;}else{throw τ816(["match"]).create("Could not find a match",({"value":τ943}));}}}return τ939;}();return Node(["+div"],[Node(["+div"],[Node(["error_type"],e.name),Node(["error_message"],e.message)]),repr(args),highlight_locations(locs)]);}else{if(((τ938=τ952(τ937,"location"))&&(((τp0=τ937.location),τ824(Location)(τp0))&&((loc=τp0),true)))){return Node(["+div"],[Node(["+div"],[Node(["error_type"],e.name),Node(["error_message"],e.message)]),function(){if(e.args){return repr(e.args);}else{return "";}}(),highlight_locations([[loc,"hl1"]]),Node(["traceback"],(e.stack||""))]);}else{if((τ938&&(((τp0=τ937.location),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===4)&&(((τp2=τp0[0]),(τp2==="location"))&&((url=τp0[1]),true,(start=τp0[2]),true,(end=τp0[3]),true))))))){var data=function(){var τ945;try{(τ945=fs.readFileSync(url,"utf8"));}catch(τ944){(τ945=null);}return τ945;}();if(data){var loc=Location(Source(data,url),start,end);return Node(["+div"],[Node(["+div"],[Node(["error_type"],e.name),Node(["error_message"],e.message)]),function(){if(e.args){return repr(e.args);}else{return "";}}(),highlight_locations([[loc,"hl1"]]),Node(["traceback"],(e.stack||""))]);}else{return Node(["+div"],Node(["traceback"],(e.stack||e)));}}else{if(((other=τ937),true)){return Node(["traceback"],(e.stack||e));}else{throw τ816(["match"]).create("Could not find a match",({"value":τ937}));}}}}};var display_error=function(e){return __lt____gt__(null,format_error(e));};(exports["Source"]=Source);(exports["Location"]=Location);(exports["highlight"]=highlight);(exports["highlight_locations"]=highlight_locations);(exports["merge_locations"]=merge_locations);(exports["<<:"]=__lt____lt____colon__);(exports["++:"]=__plus____plus____colon__);(exports["format_error"]=format_error);(exports["display_error"]=display_error);
