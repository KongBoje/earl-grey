var $5228=function(type$5230){var f$5233;(f$5233=type$5230["::check"]);;if((f$5233===(void 0))){return function(value$5238){return (value$5238 instanceof type$5230);};}else{return function(value$5241){return f$5233.call(type$5230,value$5241);};}};
var $5243=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $5244=function(dest$5246,values$5247){var k$5252;(k$5252=null);$5250:for(k$5252 in values$5247){if(values$5247.hasOwnProperty(k$5252)){(dest$5246[k$5252]=values$5247[k$5252]);}}return dest$5246;};
var $5256=function($5257$5259){var ph$5263;(ph$5263=$5257$5259);;var $5261$5268;($5261$5268=ph$5263);;var bridge$5262$5273;var x$5277;(bridge$5262$5273=$5261$5268);if((((typeof(bridge$5262$5273)==="string")&&((x$5277=bridge$5262$5273),true))||((typeof(bridge$5262$5273)==="number")&&((x$5277=bridge$5262$5273),true)))){return ["value",x$5277];}else{var other$5284;(other$5284=$5261$5268);return other$5284["::serialize_ast"]();}};
var send$5068;(send$5068=function(obj$5073,$5071$5074){var ph$5078;var msg$5079;var t0$5081;(t0$5081=$5071$5074);(msg$5079=t0$5081);(ph$5078=t0$5081);;var $5076$5085;($5076$5085=ph$5078);;var bridge$5077$5090;(bridge$5077$5090=$5076$5085);if(((typeof(bridge$5077$5090)==="string")||(typeof(bridge$5077$5090)==="number"))){return obj$5073[msg$5079];}else{var other$5098;(other$5098=$5076$5085);return obj$5073["::send"](msg$5079);}});;(Array[":::project"]=function($5101$5103){var ph$5106;var value$5107;var t0$5109;(t0$5109=$5101$5103);(value$5107=t0$5109);(ph$5106=t0$5109);;var $5105$5113;($5105$5113=ph$5106);;if($5228(Array)($5105$5113)){return [true,value$5107];}else{$5105$5113;return [true,[value$5107]];}});(Array.prototype["::check"]=function(value$5127){if((value$5127 instanceof Array)){var i$5132;(i$5132=0);;$5130:for(;(i$5132<this.length);(i$5132++)){if(($5243(this,i$5132)!==$5243(value$5127,i$5132))){return false;}}return true;}else{return false;}});(Array.prototype["::clone"]=function(){return $5244(this.slice(0),this);});(Array.prototype[":::project"]=function(value$5143){if((value$5143 instanceof Array)){var i$5148;(i$5148=0);;$5146:for(;(i$5148<this.length);(i$5148++)){if(($5243(this,i$5148)!==$5243(value$5143,i$5148))){return [true,[value$5143]];}}return [true,value$5143.slice(this.length)];}else{return [true,[value$5143]];}});(Array.prototype["::serialize_ast"]=function(){return ["array"].concat(this.map($5256));});(RegExp.prototype["::check"]=function($5158$5160){var ph$5163;(ph$5163=$5158$5160);;var $5162$5168;($5162$5168=ph$5163);;var value$5176;if((typeof($5162$5168)==="string")){(value$5176=$5162$5168);if(value$5176.match(this)){return true;}else{return false;}}else{var other$5181;(other$5181=$5162$5168);return false;}});(RegExp.prototype[":::project"]=function($5183$5185){var ph$5188;(ph$5188=$5183$5185);;var $5187$5193;($5187$5193=ph$5188);;var value$5201;if((typeof($5187$5193)==="string")){(value$5201=$5187$5193);var $5204$5206;($5204$5206=value$5201.match(this));;var m$5214;if(($5204$5206===null)){(m$5214=$5204$5206);return [false,null];}else{var m$5219;(m$5219=$5204$5206);return [true,m$5219];}}else{var other$5223;(other$5223=$5187$5193);return [false,null];}});(Function.prototype["::send"]=function(args$5226){return this.apply(this,args$5226);});
var $7000=function(arr$7002){var results$7006;var l$7007;(results$7006=[]);;(l$7007=arr$7002.length);;var i$7015;(i$7015=0);;$7005:for(;(i$7015<l$7007);(i$7015++)){results$7006.push([i$7015,$5243(arr$7002,i$7015)]);}return results$7006;};
var $6831=function(){var $6832$6834;($6832$6834=function(tags$6838){var it$0$6841;(it$0$6841=function(){if((!$5228($6832$6834)(this))){return Object.create($6832$6834.prototype);}else{return this;}}());;(it$0$6841["tags"]=tags$6838);return it$0$6841;});;($6832$6834.prototype["create"]=function(){var $6850$6852;($6850$6852=arguments);;var t0$6857;var message$6861;var args$6862;(t0$6857=$6850$6852.length);if((t0$6857>=0)){(message$6861=function(){if((0>=t0$6857)){return "";}else{return $6850$6852[0];}}());(args$6862=Array.prototype.slice.call($6850$6852,1));var it$0$6866;(it$0$6866=this);;var self$6871;(self$6871=this);;var e$6876;(e$6876=Error(message$6861));;(e$6876["::tags"]=it$0$6866.tags);(e$6876["args"]=args$6862);var temp$6884;(temp$6884=$7000(args$6862));;var $length$6889;($length$6889=temp$6884.length);;var $index$6894;($index$6894=0);;$6877:for(;($index$6894<$length$6889);($index$6894++)){var m$6902;(m$6902=temp$6884[$index$6894]);;var t0$6907;var t1$6908;var i$6912;var arg$6913;(t0$6907=m$6902);if(((t0$6907 instanceof Array)&&((t1$6908=t0$6907.length),(t1$6908===2)))){(i$6912=t0$6907[0]);(arg$6913=t0$6907[1]);(e$6876[i$6912]=arg$6913);}else{$6818(m$6902);;}}(e$6876["length"]=args$6862.length);(e$6876["name"]=["E"].concat(it$0$6866.tags).join("."));return e$6876;}else{$6818($6850$6852);}});($6832$6834.prototype["::check"]=function(e$6924){var it$0$6927;(it$0$6927=this);;var self$6932;(self$6932=this);;var tags$6937;if(((!e$6924)||(!$5228(Error)(e$6924)))){return false;}(tags$6937=(e$6924["::tags"]||[]));;var temp$6946;(temp$6946=it$0$6927.tags);;var $length$6951;($length$6951=temp$6946.length);;var $index$6956;($index$6956=0);;$6938:for(;($index$6956<$length$6951);($index$6956++)){var m$6964;(m$6964=temp$6946[$index$6956]);;var tag$6972;(tag$6972=m$6964);if((tags$6937.indexOf(tag$6972)===-1)){return false;}else{false;;}}return true;});($6832$6834.prototype["::deconstruct"]=function(e$6980){var it$0$6983;(it$0$6983=this);;var self$6988;(self$6988=this);;return e$6980.args;});$5244($6832$6834,$5244(function(){var accum$6993;(accum$6993=({}));(accum$6993["::name"]="$6832");return accum$6993;}(),function(){var accum$6997;(accum$6997=({}));(accum$6997["::egclass"]=true);return accum$6997;}()));return $6832$6834;}();
var $6818=function(value$6820,url$6821,start$6822,end$6823){var err$6826;(err$6826=$6831(["match"]).create("Could not find a match for value",({"value":value$6820})));;if(url$6821){(err$6826["location"]=["location",url$6821,start$6822,end$6823]);}throw err$6826;};
var $7149=function(type$7151){return function(value$7154){var f$7157;(f$7157=type$7151[":::project"]);;if((f$7157===(void 0))){(f$7157=type$7151["::project"]);if((f$7157===(void 0))){return [true,type$7151(value$7154)];}else{var rval$7163;(rval$7163=false);;try{(rval$7163=[true,f$7157(value$7154)]);}catch(excv$7169){var e$7175;(e$7175=excv$7169);(rval$7163=[false,null]);}return rval$7163;}}else{return f$7157.call(type$7151,value$7154);}};};
var $7022=function(){var $7023$7025;($7023$7025=function($7028$7031,$7029$7032){var classes$7034;var children$7035;var t0$7037;(t0$7037=$7149(Array)($7028$7031));if(t0$7037[0]){(classes$7034=t0$7037[1]);;}else{$6818($7028$7031);}var t0$7042;(t0$7042=$7149(Array)($7029$7032));if(t0$7042[0]){(children$7035=t0$7042[1]);;}else{$6818($7029$7032);}var it$0$7047;(it$0$7047=function(){if((!$5228($7023$7025)(this))){return Object.create($7023$7025.prototype);}else{return this;}}());;(it$0$7047["classes"]=classes$7034.sort());(it$0$7047["children"]=children$7035);return it$0$7047;});;$5244(function(){var accum$7055;(accum$7055=({}));(accum$7055["::check"]=function(x$7059){return ((x$7059&&x$7059.classes)&&x$7059.children);});return accum$7055;}(),$5244(function(){var accum$7062;(accum$7062=({}));(accum$7062["::deconstruct"]=function(x$7066){return [x$7066.classes,x$7066.children];});return accum$7062;}(),$5244(function(){var accum$7069;(accum$7069=({}));(accum$7069["::name"]="$7023");return accum$7069;}(),function(){var accum$7073;(accum$7073=({}));(accum$7073["::egclass"]=true);return accum$7073;}())));($7023$7025.prototype["::check"]=function(n$7079){var it$0$7082;(it$0$7082=this);;var self$7087;(self$7087=this);;var temp$7096;(temp$7096=it$0$7082.classes);;var $length$7101;($length$7101=temp$7096.length);;var $index$7106;($index$7106=0);;$7092:for(;($index$7106<$length$7101);($index$7106++)){var m$7114;(m$7114=temp$7096[$index$7106]);;var c$7122;(c$7122=m$7114);if((n$7079.classes.indexOf(c$7122)===-1)){return false;}else{false;;}}return true;});$5244($7023$7025,$5244(function(){var accum$7128;(accum$7128=({}));(accum$7128["::check"]=function(x$7132){return ((x$7132&&x$7132.classes)&&x$7132.children);});return accum$7128;}(),$5244(function(){var accum$7135;(accum$7135=({}));(accum$7135["::deconstruct"]=function(x$7139){return [x$7139.classes,x$7139.children];});return accum$7135;}(),$5244(function(){var accum$7142;(accum$7142=({}));(accum$7142["::name"]="$7023");return accum$7142;}(),function(){var accum$7146;(accum$7146=({}));(accum$7146["::egclass"]=true);return accum$7146;}()))));return $7023$7025;}();
var $7177=function(from$7179,to$7180){var rval$7184;(rval$7184=[]);;var i$7189;(i$7189=from$7179);;$7183:for(;(i$7189<=to$7180);(i$7189++)){rval$7184.push(i$7189);}return rval$7184;};
var $7196=function(obj$7198){var results$7202;(results$7202=[]);;var k$7207;(k$7207=null);$7201:for(k$7207 in obj$7198){if(Object.prototype.hasOwnProperty.call(obj$7198,k$7207)){results$7202.push([k$7207,$5243(obj$7198,k$7207)]);}}return results$7202;};
var $7211=function($7212$7214,key$7215){var ph$7219;(ph$7219=$7212$7214);;var $7217$7224;($7217$7224=ph$7219);;var bridge$7218$7229;(bridge$7218$7229=$7217$7224);if(((bridge$7218$7229===null)||(bridge$7218$7229===(void 0)))){return false;}else{var x$7237;if((typeof($7217$7224)==="string")){(x$7237=$7217$7224);return (key$7215 in String.prototype);}else{var x$7242;if((typeof($7217$7224)==="number")){(x$7242=$7217$7224);return (key$7215 in Number.prototype);}else{var x$7247;(x$7247=$7217$7224);return (key$7215 in x$7247);}}}};var accum$5434;var accum$5438;var accum$5664;var accum$5668;var $5288$5290;var binsearch$5291;var $5289$5292;var __lt____gt__$5293;var repr$5294;var fs$5295;var Source$5296;var Location$5297;var highlight$5298;var highlight_lines$5299;var clamp$5300;var morsel$5301;var highlight_locations$5302;var highlight_locations_same_source$5303;var merge_locations$5304;var __lt____lt____colon__$5305;var __plus____plus____colon__$5306;var format_error$5307;var display_error$5308;($5288$5290=require("./util"));;(binsearch$5291=$5288$5290.binsearch);;($5289$5292=require("./pp"));;(__lt____gt__$5293=$5289$5292["<>"]);;(repr$5294=$5289$5292.repr);;(fs$5295=require("fs"));;(Source$5296=function(){var $index$5370;var $length$5365;var temp$5360;var curr$5352;var it$0$5346;var text$5341;var url$5342;var t0$5337;var $5330$5332;($5330$5332=arguments);;(t0$5337=$5330$5332.length);if(((t0$5337>=1)&&(t0$5337<=2))){(text$5341=$5330$5332[0]);(url$5342=function(){if((1>=t0$5337)){return false;}else{return $5330$5332[1];}}());(it$0$5346=function(){if((!$5228(Source$5296)(this))){return Object.create(Source$5296.prototype);}else{return this;}}());;(it$0$5346["text"]=text$5341);(it$0$5346["url"]=url$5342);(it$0$5346["counts"]=[]);(curr$5352=0);;(temp$5360=text$5341.split("\n"));;($length$5365=temp$5360.length);;($index$5370=0);;$5353:for(;($index$5370<$length$5365);($index$5370++)){var line$5386;var m$5378;(m$5378=temp$5360[$index$5370]);;(line$5386=m$5378);it$0$5346.counts.push(curr$5352);(curr$5352=(curr$5352+(line$5386.length+1)));}it$0$5346.counts.push(curr$5352);(it$0$5346["nlines"]=(it$0$5346.counts.length-1));return it$0$5346;}else{$6818($5330$5332);}});;(Source$5296.prototype["linecol"]=function(pos$5395){var line$5408;var col$5409;var self$5403;var it$0$5398;(it$0$5398=this);;(self$5403=this);;(line$5408=binsearch$5291(it$0$5398.counts,pos$5395));;(col$5409=(pos$5395-$5243(it$0$5398.counts,(line$5408-1))));;return [line$5408,col$5409];});(Source$5296.prototype["highlight_lines"]=function(l1$5419,l2$5420,spans$5421){var self$5429;var it$0$5424;(it$0$5424=this);;(self$5429=this);;return highlight_lines$5299(it$0$5424.text,it$0$5424.counts,[(l1$5419-1),(l2$5420-1)],spans$5421);});$5244(Source$5296,$5244(((accum$5434=({})),((accum$5434["::name"]="Source"),accum$5434)),((accum$5438=({})),((accum$5438["::egclass"]=true),accum$5438))));Source$5296;(Location$5297=function(source$5444,start$5445,end$5446){var it$0$5449;(it$0$5449=function(){if((!$5228(Location$5297)(this))){return Object.create(Location$5297.prototype);}else{return this;}}());;(it$0$5449["source"]=(source$5444||Source$5296("",null)));(it$0$5449["start"]=start$5445);(it$0$5449["end"]=end$5446);return it$0$5449;});;(Location$5297.prototype["text"]=function(){var self$5466;var it$0$5461;(it$0$5461=this);;(self$5466=this);;return it$0$5461.source.text.slice(it$0$5461.start,it$0$5461.end);});(Location$5297.prototype["linerange"]=function(){var l2$5515;var t0$5506;var t1$5507;var l1$5498;var $5481$5499;var t0$5492;var t1$5493;var t2$5494;var $5480$5487;var self$5482;var it$0$5475;(it$0$5475=this);;(self$5482=this);;($5480$5487=it$0$5475.linecol());;if((($5480$5487 instanceof Array)&&((t0$5492=$5480$5487.length),((t0$5492===2)&&((t1$5493=$5480$5487[0]),((t1$5493 instanceof Array)&&((t2$5494=t1$5493.length),(t2$5494===2)))))))){(l1$5498=t1$5493[0]);t1$5493[1];($5481$5499=$5480$5487[1]);if(($5481$5499===null)){return [l1$5498,l1$5498];}else{(t0$5506=$5481$5499);if(((t0$5506 instanceof Array)&&((t1$5507=t0$5506.length),(t1$5507===2)))){(l2$5515=t0$5506[0]);t0$5506[1];return [l1$5498,l2$5515];}else{$6818($5481$5499,"/home/olivier/git/earl-grey/src/location.eg",975,980);}}}else{$6818($5480$5487);}});(Location$5297.prototype["linecol"]=function(){var start$5538;var end$5539;var self$5533;var it$0$5528;(it$0$5528=this);;(self$5533=this);;(start$5538=it$0$5528.source.linecol(it$0$5528.start));;(end$5539=function(){if((it$0$5528.start===it$0$5528.end)){return null;}else{return it$0$5528.source.linecol((it$0$5528.end-1));}}());;return [start$5538,end$5539];});(Location$5297.prototype["ref"]=function(){var otherwise$5627;var $5608$5616;var $5607$5610;var l2$5599;var c2$5600;var t0$5588;var t1$5589;var t2$5590;var t3$5591;var l1$5576;var c1$5577;var $5557$5578;var t0$5568;var t1$5569;var t2$5570;var t3$5571;var t4$5572;var $5556$5563;var self$5558;var it$0$5551;(it$0$5551=this);;(self$5558=this);;($5556$5563=it$0$5551.linecol());;if((($5556$5563 instanceof Array)&&((t0$5568=$5556$5563.length),((t0$5568===2)&&((t1$5569=$5556$5563[0]),((t1$5569 instanceof Array)&&((t2$5570=t1$5569.length),((t2$5570===2)&&((t3$5571=[true,String(t1$5569[0])]),(t3$5571[0]&&((l1$5576=t3$5571[1]),((t4$5572=[true,String(t1$5569[1])]),t4$5572[0])))))))))))){(c1$5577=t4$5572[1]);($5557$5578=$5556$5563[1]);if(($5557$5578===null)){return ((l1$5576+":")+c1$5577);}else{(t0$5588=$5557$5578);if(((t0$5588 instanceof Array)&&((t1$5589=t0$5588.length),((t1$5589===2)&&((t2$5590=[true,String(t0$5588[0])]),(t2$5590[0]&&((l2$5599=t2$5590[1]),((t3$5591=[true,String(t0$5588[1])]),t3$5591[0])))))))){(c2$5600=t3$5591[1]);($5607$5610=null);;$5607$5610;if(((l1$5576===l2$5599)&&(c1$5577===c2$5600))){return ((l1$5576+":")+c1$5577);}else{if((l1$5576===l2$5599)){return ((((l1$5576+":")+c1$5577)+"-")+c2$5600);}else{(otherwise$5627=$5607$5610);return ((((((l1$5576+":")+c1$5577)+"-")+l1$5576)+":")+c2$5600);}}}else{$6818($5557$5578,"/home/olivier/git/earl-grey/src/location.eg",1317,1322);}}}else{$6818($5556$5563);}});(Location$5297.prototype["highlight"]=function(){var self$5657;var it$0$5652;var cls$5647;var context$5648;var t0$5643;var $5636$5638;($5636$5638=arguments);;(t0$5643=$5636$5638.length);if(((t0$5643>=0)&&(t0$5643<=2))){(cls$5647=function(){if((0>=t0$5643)){return "hl1";}else{return $5636$5638[0];}}());(context$5648=function(){if((1>=t0$5643)){return 0;}else{return $5636$5638[1];}}());(it$0$5652=this);;(self$5657=this);;return highlight_locations$5302([[it$0$5652,cls$5647]],context$5648);}else{$6818($5636$5638);}});$5244(Location$5297,$5244(((accum$5664=({})),((accum$5664["::name"]="Location"),accum$5664)),((accum$5668=({})),((accum$5668["::egclass"]=true),accum$5668))));Location$5297;(highlight$5298=function(){var $index$5708;var $length$5703;var temp$5698;var acc$5693;var text$5685;var spans$5686;var offset$5687;var t0$5681;var $5674$5676;($5674$5676=arguments);;(t0$5681=$5674$5676.length);if(((t0$5681>=2)&&(t0$5681<=3))){(text$5685=$5674$5676[0]);(spans$5686=$5674$5676[1]);(offset$5687=function(){if((2>=t0$5681)){return 0;}else{return $5674$5676[2];}}());return $7022([],(((acc$5693=[])),(((temp$5698=morsel$5301(spans$5686))),((($length$5703=temp$5698.length)),((($index$5708=0)),function(){$5690:for(;($index$5708<$length$5703);($index$5708++)){var xstart$5733;var xend$5734;var start$5726;var end$5727;var attributes$5728;var t0$5721;var t1$5722;var m$5716;(m$5716=temp$5698[$index$5708]);;(t0$5721=m$5716);if(((t0$5721 instanceof Array)&&((t1$5722=t0$5721.length),(t1$5722===3)))){(start$5726=t0$5721[0]);(end$5727=t0$5721[1]);(attributes$5728=t0$5721[2]);acc$5693.push((((xstart$5733=Math.max((start$5726-offset$5687),0))),((xend$5734=Math.min((end$5727-offset$5687),text$5685.length))),$7022(attributes$5728.slice(0,1),[text$5685.slice(xstart$5733,xend$5734)])));}else{$6818(m$5716,"/home/olivier/git/earl-grey/src/location.eg",1864,2076);;}}}()))),acc$5693));}else{$6818($5674$5676);}});;(highlight_lines$5299=function(text$5750,linelocs$5751,$5748$5752,spans$5753){var t0$5758;var t1$5759;var $index$5782;var $length$5777;var temp$5772;var acc$5767;var l1$5755;var l2$5756;(t0$5758=$5748$5752);if(((t0$5758 instanceof Array)&&((t1$5759=t0$5758.length),(t1$5759===2)))){(l1$5755=t0$5758[0]);(l2$5756=t0$5758[1]);;}else{$6818($5748$5752);}return $7022(["+span"],(((acc$5767=[])),(((temp$5772=$7177(l1$5755,l2$5756))),((($length$5777=temp$5772.length)),((($index$5782=0)),function(){$5764:for(;($index$5782<$length$5777);($index$5782++)){var start$5801;var end$5802;var lineno$5798;var m$5790;(m$5790=temp$5772[$index$5782]);;(lineno$5798=m$5790);acc$5767.push((((start$5801=$5243(linelocs$5751,lineno$5798))),((end$5802=$5243(linelocs$5751,(lineno$5798+1)))),$7022(["+span"],[$7022(["lineno"],(lineno$5798+1)),$7022(["source"],highlight$5298(text$5750,[[start$5801,end$5802,[]]].concat(clamp$5300(spans$5753,start$5801,end$5802))))])));}}()))),acc$5767));});;(clamp$5300=function(spans$5813,bot$5814,top$5815){var $index$5835;var $length$5830;var temp$5825;var acc$5820;(acc$5820=[]);;(temp$5825=spans$5813);;($length$5830=temp$5825.length);;($index$5835=0);;$5817:for(;($index$5835<$length$5830);($index$5835++)){var start$5853;var end$5854;var attr$5855;var t0$5848;var t1$5849;var m$5843;(m$5843=temp$5825[$index$5835]);;(t0$5848=m$5843);if(((t0$5848 instanceof Array)&&((t1$5849=t0$5848.length),((t1$5849===3)&&((start$5853=t0$5848[0]),((end$5854=t0$5848[1]),((attr$5855=t0$5848[2]),((end$5854>=bot$5814)&&(start$5853<=top$5815))))))))){acc$5820.push([Math.max(start$5853,bot$5814),Math.min(end$5854,top$5815),attr$5855]);}else{false;;}}return acc$5820;});;(morsel$5301=function(spans$5868){var jump$5871;var jumptill$5872;var process_elements$5873;var thespans$5874;(jump$5871=function(active$5878,bot$5879,top$5880){var $index$5908;var $length$5903;var temp$5898;var acc$5893;var $index$5948;var $length$5943;var temp$5938;var e$5883;var attributes$5884;(e$5883=$5243(Math.min,[top$5880].concat((((acc$5893=[])),(((temp$5898=active$5878)),((($length$5903=temp$5898.length)),((($index$5908=0)),function(){$5890:for(;($index$5908<$length$5903);($index$5908++)){var x$5926;var t0$5921;var t1$5922;var m$5916;(m$5916=temp$5898[$index$5908]);;(t0$5921=m$5916);if(((t0$5921 instanceof Array)&&((t1$5922=t0$5921.length),(t1$5922===3)))){t0$5921[0];(x$5926=t0$5921[1]);t0$5921[2];acc$5893.push(x$5926);}else{$6818(m$5916,"/home/olivier/git/earl-grey/src/location.eg",3399,3442);;}}}()))),acc$5893))));;(attributes$5884=[]);;(temp$5938=active$5878);;($length$5943=temp$5938.length);;($index$5948=0);;$5885:for(;($index$5948<$length$5943);($index$5948++)){var X$5966;var t0$5961;var t1$5962;var m$5956;(m$5956=temp$5938[$index$5948]);;(t0$5961=m$5956);if(((t0$5961 instanceof Array)&&((t1$5962=t0$5961.length),(t1$5962===3)))){t0$5961[0];t0$5961[1];(X$5966=t0$5961[2]);(attributes$5884=attributes$5884.concat(X$5966));}else{$6818(m$5956,"/home/olivier/git/earl-grey/src/location.eg",3464,3505);;}}return [e$5883,[bot$5879,e$5883,attributes$5884]];});;(jumptill$5872=function(active$5976,bot$5977,top$5978){var t0$5987;var t1$5988;var $index$6013;var $length$6008;var temp$6003;var acc$5998;var t0$6044;var t1$6045;var newbot$5981;var span$5982;var newactive$5983;var spans$5984;var remainder$5985;if((bot$5977===top$5978)){return [[],active$5976];}else{(t0$5987=jump$5871(active$5976,bot$5977,top$5978));if(((t0$5987 instanceof Array)&&((t1$5988=t0$5987.length),(t1$5988===2)))){(newbot$5981=t0$5987[0]);(span$5982=t0$5987[1]);;}else{$6818(jump$5871(active$5976,bot$5977,top$5978),"/home/olivier/git/earl-grey/src/location.eg",3741,3775);}(newactive$5983=(((acc$5998=[])),(((temp$6003=active$5976)),((($length$6008=temp$6003.length)),((($index$6013=0)),function(){$5995:for(;($index$6013<$length$6008);($index$6013++)){var x$6031;var e$6032;var attr$6033;var t0$6026;var t1$6027;var m$6021;(m$6021=temp$6003[$index$6013]);;(t0$6026=m$6021);(x$6031=t0$6026);if(((t0$6026 instanceof Array)&&((t1$6027=t0$6026.length),((t1$6027===3)&&(t0$6026[0],((e$6032=t0$6026[1]),((attr$6033=t0$6026[2]),(e$6032>newbot$5981)))))))){acc$5998.push(x$6031);}else{false;;}}}()))),acc$5998));;(t0$6044=jumptill$5872(newactive$5983,newbot$5981,top$5978));if(((t0$6044 instanceof Array)&&((t1$6045=t0$6044.length),(t1$6045===2)))){(spans$5984=t0$6044[0]);(remainder$5985=t0$6044[1]);;}else{$6818(jumptill$5872(newactive$5983,newbot$5981,top$5978),"/home/olivier/git/earl-grey/src/location.eg",3890,3934);}return [[span$5982].concat(spans$5984),remainder$5985];}});;(process_elements$5873=function(start$6054,active$6055,rem$6056){var $index$6121;var $length$6116;var temp$6111;var acc$6106;var t0$6150;var t1$6151;var top$6098;var bot$6099;var spans$6100;var t0$6178;var t1$6179;var spans$6175;var newactive$6176;var start$6158;var active$6159;var next$6160;var target$6161;var end$6162;var attr$6163;var rest$6164;var start$6089;var active$6090;var $6059$6074;var $6060$6075;var $6061$6076;var t0$6068;var t1$6069;var t2$6070;var t3$6071;var t4$6072;var $6058$6063;($6058$6063=[start$6054,active$6055,rem$6056]);;if((($6059$6074=($6058$6063 instanceof Array))&&((t0$6068=$6058$6063.length),(($6061$6076=(t0$6068===3))&&($6058$6063[0],((t1$6069=$6058$6063[1]),((t1$6069 instanceof Array)&&((t2$6070=t1$6069.length),((t2$6070===0)&&((t3$6071=$6058$6063[2]),((t3$6071 instanceof Array)&&((t4$6072=t3$6071.length),(t4$6072===0))))))))))))){return [];}else{if(($6061$6076&&((start$6089=$6058$6063[0]),((active$6090=$6058$6063[1]),((t1$6069=$6058$6063[2]),((t1$6069 instanceof Array)&&((t2$6070=t1$6069.length),(t2$6070===0)))))))){(top$6098=$5243(Math.max,(((acc$6106=[])),(((temp$6111=active$6090)),((($length$6116=temp$6111.length)),((($index$6121=0)),function(){$6103:for(;($index$6121<$length$6116);($index$6121++)){var e$6139;var t0$6134;var t1$6135;var m$6129;(m$6129=temp$6111[$index$6121]);;(t0$6134=m$6129);if(((t0$6134 instanceof Array)&&((t1$6135=t0$6134.length),(t1$6135===3)))){t0$6134[0];(e$6139=t0$6134[1]);t0$6134[2];acc$6106.push(e$6139);}else{$6818(m$6129,"/home/olivier/git/earl-grey/src/location.eg",4119,4157);;}}}()))),acc$6106)));;(bot$6099=Math.min(start$6089,top$6098));;(t0$6150=jumptill$5872(active$6090,start$6089,top$6098));if(((t0$6150 instanceof Array)&&((t1$6151=t0$6150.length),(t1$6151===2)))){(spans$6100=t0$6150[0]);t0$6150[1];;}else{$6818(jumptill$5872(active$6090,start$6089,top$6098),"/home/olivier/git/earl-grey/src/location.eg",4210,4248);}return spans$6100;}else{if(($6061$6076&&((start$6158=$6058$6063[0]),((active$6159=$6058$6063[1]),((t1$6069=$6058$6063[2]),((t1$6069 instanceof Array)&&((t2$6070=t1$6069.length),((t2$6070>=1)&&((t3$6071=t1$6069[0]),((next$6160=t3$6071),((t3$6071 instanceof Array)&&((t4$6072=t3$6071.length),(t4$6072===3))))))))))))){(target$6161=t3$6071[0]);(end$6162=t3$6071[1]);(attr$6163=t3$6071[2]);(rest$6164=Array.prototype.slice.call(t1$6069,1));(t0$6178=jumptill$5872(active$6159,start$6158,target$6161));if(((t0$6178 instanceof Array)&&((t1$6179=t0$6178.length),(t1$6179===2)))){(spans$6175=t0$6178[0]);(newactive$6176=t0$6178[1]);;}else{$6818(jumptill$5872(active$6159,start$6158,target$6161),"/home/olivier/git/earl-grey/src/location.eg",4352,4393);}return spans$6175.concat(process_elements$5873(target$6161,[next$6160].concat(newactive$6176),rest$6164));}else{$6818($6058$6063);}}}});;(thespans$5874=spans$5868.sort(function($6189$6192,$6190$6193){var t0$6200;var t1$6201;var t0$6207;var t1$6208;var s1$6195;var e1$6196;var s2$6197;var e2$6198;(t0$6200=$6189$6192);if(((t0$6200 instanceof Array)&&((t1$6201=t0$6200.length),(t1$6201===3)))){(s1$6195=t0$6200[0]);(e1$6196=t0$6200[1]);t0$6200[2];;}else{$6818($6189$6192);}(t0$6207=$6190$6193);if(((t0$6207 instanceof Array)&&((t1$6208=t0$6207.length),(t1$6208===3)))){(s2$6197=t0$6207[0]);(e2$6198=t0$6207[1]);t0$6207[2];;}else{$6818($6190$6193);}if((s1$6195===s2$6197)){return (e1$6196-e2$6198);}else{return (s1$6195-s2$6197);}}));;return process_elements$5873(thespans$5874[0][0],[],thespans$5874);});;(highlight_locations$5302=function(){var $index$6252;var $length$6247;var temp$6242;var $index$6301;var $length$6296;var temp$6291;var acc$6286;var srcs$6234;var locations$6229;var context$6230;var t0$6225;var $6218$6220;($6218$6220=arguments);;(t0$6225=$6218$6220.length);if(((t0$6225>=1)&&(t0$6225<=2))){(locations$6229=$6218$6220[0]);(context$6230=function(){if((1>=t0$6225)){return 0;}else{return $6218$6220[1];}}());(srcs$6234=({}));;(temp$6242=locations$6229);;($length$6247=temp$6242.length);;($index$6252=0);;$6235:for(;($index$6252<$length$6247);($index$6252++)){var key$6276;var loc$6270;var cls$6271;var t0$6265;var t1$6266;var m$6260;(m$6260=temp$6242[$index$6252]);;(t0$6265=m$6260);if(((t0$6265 instanceof Array)&&((t1$6266=t0$6265.length),(t1$6266===2)))){(loc$6270=t0$6265[0]);(cls$6271=t0$6265[1]);(key$6276=String((loc$6270.source&&loc$6270.source.url)));;if((!$5243(srcs$6234,key$6276))){(srcs$6234[key$6276]=[]);}$5243(srcs$6234,key$6276).push([loc$6270,cls$6271]);}else{$6818(m$6260,"/home/olivier/git/earl-grey/src/location.eg",4739,4909);;}}return $7022(["+div"],(((acc$6286=[])),(((temp$6291=$7196(srcs$6234))),((($length$6296=temp$6291.length)),((($index$6301=0)),function(){$6283:for(;($index$6301<$length$6296);($index$6301++)){var locs$6319;var t0$6314;var t1$6315;var m$6309;(m$6309=temp$6291[$index$6301]);;(t0$6314=m$6309);if(((t0$6314 instanceof Array)&&((t1$6315=t0$6314.length),(t1$6315===2)))){t0$6314[0];(locs$6319=t0$6314[1]);acc$6286.push(highlight_locations_same_source$5303(locs$6319,context$6230));}else{$6818(m$6309,"/home/olivier/git/earl-grey/src/location.eg",4914,5008);;}}}()))),acc$6286));}else{$6818($6218$6220);}});;(highlight_locations_same_source$5303=function(){var $index$6373;var $length$6368;var temp$6363;var acc$6358;var t0$6403;var t1$6404;var $index$6433;var $length$6428;var temp$6423;var acc$6418;var $index$6476;var $length$6471;var temp$6466;var acc$6461;var loc$6347;var src$6348;var l1$6349;var l2$6350;var first$6351;var last$6352;var locations$6342;var context$6343;var t0$6338;var $6331$6333;($6331$6333=arguments);;(t0$6338=$6331$6333.length);if(((t0$6338>=1)&&(t0$6338<=2))){(locations$6342=$6331$6333[0]);(context$6343=function(){if((1>=t0$6338)){return 0;}else{return $6331$6333[1];}}());(loc$6347=merge_locations$5304((((acc$6358=[])),(((temp$6363=locations$6342)),((($length$6368=temp$6363.length)),((($index$6373=0)),function(){$6355:for(;($index$6373<$length$6368);($index$6373++)){var x$6391;var cls$6392;var t0$6386;var t1$6387;var m$6381;(m$6381=temp$6363[$index$6373]);;(t0$6386=m$6381);if(((t0$6386 instanceof Array)&&((t1$6387=t0$6386.length),(t1$6387===2)))){(x$6391=t0$6386[0]);(cls$6392=t0$6386[1]);acc$6358.push(x$6391);}else{$6818(m$6381,"/home/olivier/git/earl-grey/src/location.eg",5091,5119);;}}}()))),acc$6358)));;(src$6348=loc$6347.source);;(t0$6403=loc$6347.linerange());if(((t0$6403 instanceof Array)&&((t1$6404=t0$6403.length),(t1$6404===2)))){(l1$6349=t0$6403[0]);(l2$6350=t0$6403[1]);;}else{$6818(loc$6347.linerange(),"/home/olivier/git/earl-grey/src/location.eg",5155,5174);}(first$6351=Math.max(1,(l1$6349-context$6343)));;(last$6352=Math.min(src$6348.nlines,(l2$6350+context$6343)));;return $7022(["+div","location"],[$7022(["+div","source"],[$7022(["sourcefile"],(src$6348.url||"???")),(((acc$6418=[])),(((temp$6423=locations$6342)),((($length$6428=temp$6423.length)),((($index$6433=0)),function(){$6415:for(;($index$6433<$length$6428);($index$6433++)){var loc$6451;var cls$6452;var t0$6446;var t1$6447;var m$6441;(m$6441=temp$6423[$index$6433]);;(t0$6446=m$6441);if(((t0$6446 instanceof Array)&&((t1$6447=t0$6446.length),(t1$6447===2)))){(loc$6451=t0$6446[0]);(cls$6452=t0$6446[1]);acc$6418.push($7022([cls$6452,"sourcepos"],loc$6451.ref()));}else{$6818(m$6441,"/home/olivier/git/earl-grey/src/location.eg",5339,5409);;}}}()))),acc$6418)]),src$6348.highlight_lines(first$6351,last$6352,(((acc$6461=[])),(((temp$6466=locations$6342)),((($length$6471=temp$6466.length)),((($index$6476=0)),function(){$6458:for(;($index$6476<$length$6471);($index$6476++)){var loc$6494;var cls$6495;var t0$6489;var t1$6490;var m$6484;(m$6484=temp$6466[$index$6476]);;(t0$6489=m$6484);if(((t0$6489 instanceof Array)&&((t1$6490=t0$6489.length),(t1$6490===2)))){(loc$6494=t0$6489[0]);(cls$6495=t0$6489[1]);acc$6461.push([loc$6494.start,loc$6494.end,[cls$6495]]);}else{$6818(m$6484,"/home/olivier/git/earl-grey/src/location.eg",5464,5522);;}}}()))),acc$6461))]);}else{$6818($6331$6333);}});;(merge_locations$5304=function($6506$6508){var $index$6565;var $length$6560;var temp$6555;var acc$6550;var $index$6604;var $length$6599;var temp$6594;var acc$6589;var start$6543;var end$6544;var locs$6539;var loc$6534;var $6511$6525;var $6512$6526;var t0$6523;var $6510$6518;var ph$6513;(ph$6513=$6506$6508);;($6510$6518=ph$6513);;if((($6511$6525=($6510$6518 instanceof Array))&&((t0$6523=$6510$6518.length),(t0$6523===0)))){return Location$5297(null,0,0);}else{if(($6511$6525&&(t0$6523===1))){(loc$6534=$6510$6518[0]);return loc$6534;}else{if(($6511$6525&&(t0$6523>=0))){(locs$6539=Array.prototype.slice.call($6510$6518,0));(start$6543=$5243(Math.min,(((acc$6550=[])),(((temp$6555=locs$6539)),((($length$6560=temp$6555.length)),((($index$6565=0)),function(){$6547:for(;($index$6565<$length$6560);($index$6565++)){var loc$6581;var m$6573;(m$6573=temp$6555[$index$6565]);;(loc$6581=m$6573);acc$6550.push(loc$6581.start);}}()))),acc$6550)));;(end$6544=$5243(Math.max,(((acc$6589=[])),(((temp$6594=locs$6539)),((($length$6599=temp$6594.length)),((($index$6604=0)),function(){$6586:for(;($index$6604<$length$6599);($index$6604++)){var loc$6620;var m$6612;(m$6612=temp$6594[$index$6604]);;(loc$6620=m$6612);acc$6589.push(loc$6620.end);}}()))),acc$6589)));;return Location$5297(locs$6539[0].source,start$6543,end$6544);}else{$6818($6510$6518);}}}});;(__lt____lt____colon__$5305=function(x$6629,y$6630){if((!$5228(Location$5297)(x$6629.location))){(x$6629["location"]=function(){if(((!y$6630)||$5228(Location$5297)(y$6630))){return y$6630;}else{return y$6630.location;}}());}return x$6629;});;(__plus____plus____colon__$5306=function(x$6638,y$6639){var rval$6643;(x$6638=function(){if(((!x$6638)||$5228(Location$5297)(x$6638))){return x$6638;}else{return x$6638.location;}}());(y$6639=function(){if(((!y$6639)||$5228(Location$5297)(y$6639))){return y$6639;}else{return y$6639.location;}}());(rval$6643=false);;try{(rval$6643=merge_locations$5304([x$6638,y$6639]));}catch(excv$6649){var e$6655;(e$6655=excv$6649);(rval$6643=(void 0));}return rval$6643;});;(format_error$5307=function(){var $index$6731;var $length$6726;var temp$6721;var acc$6716;var hls$6706;var locs$6707;var rval$6784;var loc$6800;var data$6780;var other$6806;var url$6773;var start$6774;var end$6775;var loc$6767;var args$6700;var fmt_args$6691;var $6663$6687;var $6664$6688;var $6665$6689;var t0$6683;var t1$6684;var t2$6685;var e$6677;var context$6678;var $6662$6679;var t0$6672;var t1$6673;var $6661$6667;($6661$6667=arguments);;(t0$6672=$6661$6667.length);if(((t0$6672>=1)&&(t0$6672<=2))){(t1$6673=$6661$6667[0]);(e$6677=t1$6673);($6662$6679=t1$6673);(context$6678=function(){if((1>=t0$6672)){return 0;}else{return $6661$6667[1];}}());(fmt_args$6691=function(e$6695){if((e$6695.args&&e$6695.args.length)){return $7022(["error_args"],repr$5294(e$6695.args));}else{return "";}});;(t0$6683=$6662$6679);if(($5228($6831(["syntax"]))(t0$6683)&&($7211(t0$6683,"args")&&((t1$6684=t0$6683.args),((t1$6684 instanceof Array)&&((t2$6685=t1$6684.length),(t2$6685===1))))))){(args$6700=t1$6684[0]);(hls$6706=["hl1","hl2","hl3","hl4"]);;(locs$6707=(((acc$6716=[])),(((temp$6721=$7000($7196(args$6700)))),((($length$6726=temp$6721.length)),((($index$6731=0)),function(){$6713:for(;($index$6731<$length$6726);($index$6731++)){var i$6751;var key$6752;var arg$6753;var t0$6744;var t1$6745;var t2$6746;var t3$6747;var m$6739;(m$6739=temp$6721[$index$6731]);;(t0$6744=m$6739);if(((t0$6744 instanceof Array)&&((t1$6745=t0$6744.length),((t1$6745===2)&&((i$6751=t0$6744[0]),((t2$6746=t0$6744[1]),((t2$6746 instanceof Array)&&((t3$6747=t2$6746.length),((t3$6747===2)&&((key$6752=t2$6746[0]),((arg$6753=t2$6746[1]),(arg$6753&&arg$6753.location)))))))))))){acc$6716.push([arg$6753.location,$5243(hls$6706,(i$6751%4))]);}else{false;;}}}()))),acc$6716));;return $7022(["+div"],[$7022(["error"],[$7022(["error_type"],e$6677.name),$7022(["error_message"],e$6677.message)]),$7022(["error_args","syntax"],repr$5294(args$6700)),highlight_locations$5302(locs$6707,context$6678)]);}else{if((($6664$6688=$7211(t0$6683,"location"))&&((t1$6684=t0$6683.location),$5228(Location$5297)(t1$6684)))){(loc$6767=t1$6684);return $7022(["+div"],[$7022(["error"],[$7022(["error_type"],e$6677.name),$7022(["error_message"],e$6677.message)]),fmt_args$6691(e$6677),highlight_locations$5302([[loc$6767,"hl1"]],context$6678),$7022(["traceback"],(e$6677.stack||""))]);}else{if(($6664$6688&&((t1$6684 instanceof Array)&&((t2$6685=t1$6684.length),((t2$6685===4)&&(t1$6684[0]==="location")))))){(url$6773=t1$6684[1]);(start$6774=t1$6684[2]);(end$6775=t1$6684[3]);(data$6780=(((rval$6784=false)),(function(){try{(rval$6784=fs$5295.readFileSync(url$6773,"utf8"));}catch(excv$6790){var e$6796;(e$6796=excv$6790);(rval$6784=null);}}(),rval$6784)));;if(data$6780){(loc$6800=Location$5297(Source$5296(data$6780,url$6773),start$6774,end$6775));;return $7022(["+div"],[$7022(["error"],[$7022(["error_type"],e$6677.name),$7022(["error_message"],e$6677.message)]),fmt_args$6691(e$6677),highlight_locations$5302([[loc$6800,"hl1"]],context$6678),$7022(["traceback"],($7022([],e$6677.stack)||""))]);}else{return $7022(["+div"],[$7022(["error"],[$7022(["error_type"],e$6677.name),$7022(["error_message"],e$6677.message)]),fmt_args$6691(e$6677),$7022(["traceback"],($7022([],e$6677.stack)||e$6677))]);}}else{(other$6806=$6662$6679);return $7022(["+div"],[$7022(["error"],[$7022(["error_type"],e$6677.name),$7022(["error_message"],e$6677.message)]),fmt_args$6691(e$6677),$7022(["traceback"],$7022([],e$6677.stack))]);}}}}else{$6818($6661$6667);}});;(display_error$5308=function(e$6814){return __lt____gt__$5293(null,format_error$5307(e$6814));});;(exports["Source"]=Source$5296);(exports["Location"]=Location$5297);(exports["highlight"]=highlight$5298);(exports["highlight_locations"]=highlight_locations$5302);(exports["merge_locations"]=merge_locations$5304);(exports["<<:"]=__lt____lt____colon__$5305);(exports["++:"]=__plus____plus____colon__$5306);(exports["format_error"]=format_error$5307);(exports["display_error"]=display_error$5308);
