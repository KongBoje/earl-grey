var τ200=function(type){var τ201=type["::check"];var f;if((τ201===(void 0))){return function(value){return (value instanceof type);};}else{if(((f=τ201),true)){return function(value){return f.call(type,value);};}else{throw ["Could not find a match",τ201];}}};
var τ202=function(){var r=[];for(var i=0;(i<arguments.length);(i++)){(r=r.concat(arguments[i]));}return r;};
var τ203=function(τ204){var τ205=τ204;var x;var x;var other;if((((typeof(τ205)==="string")&&((x=τ205),true))||((typeof(τ205)==="number")&&((x=τ205),true)))){return ["value",x];}else{if(((other=τ205),true)){return other["::serialize_ast"]();}else{throw ["Could not find a match",τ205];}}};
var send=function(obj,τ193){var msg;var τ192;(msg=τ193);true;(τ192=τ193);var τ194=τ192;var other;if(((typeof(τ194)==="string")||(typeof(τ194)==="number"))){return obj[msg];}else{if(((other=τ194),true)){return obj["::send"](msg);}else{throw ["Could not find a match",τ194];}}};(Array[":::project"]=function(τ196){var value;var τ195;(value=τ196);true;(τ195=τ196);var τ197=τ195;var _;if(τ200(Array)(τ197)){return [true,value];}else{if(((_=τ197),true)){return [true,[value]];}else{throw ["Could not find a match",τ197];}}});(Array.prototype["::check"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){return false;}else{null;}}return true;}else{return false;}});(Array.prototype[":::project"]=function(value){if((value instanceof Array)){for(var i=0;(i<this.length);(i++)){if((send(this,i)!==send(value,i))){var rval=this.slice(0);rval.push(value);return [true,rval];}else{null;}}return [true,value];}else{var rval=this.slice(0);rval.push(value);return [true,rval];}});(Array.prototype[":::deconstruct"]=function(value){return [true,value.slice(this.length)];});(Array.prototype["::serialize_ast"]=function(){return τ202(["array"],this.map(τ203));});(RegExp.prototype["::check"]=function(value){return value.match(this);});(RegExp.prototype[":::project"]=function(value){var τ198=value.match(this);var m;var m;if(((τ198===null)&&((m=τ198),true))){return [false,null];}else{if(((m=τ198),true)){return [true,m];}else{throw ["Could not find a match",τ198];}}});(RegExp.prototype[":::deconstruct"]=function(value){var τ199=value.match(this);var m;var m;if(((τ199===null)&&((m=τ199),true))){return [false,null];}else{if(((m=τ199),true)){return [true,m];}else{throw ["Could not find a match",τ199];}}});(Function.prototype["::send"]=function(args){return this.apply(this,args);});
var τ320=function(dest,values){for(k in values){if(values.hasOwnProperty(k)){(dest[k]=send(values,k));}else{null;}}return dest;};
var τ321=function(){var τ322=function(tags){var τ323=function(){if((!τ200(τ322)(this))){return Object.create(τ322.prototype);}else{return this;}}();(τ323["tags"]=tags);return τ323;};τ320(τ322);(τ322.prototype["create"]=function(){var τ324=Array.prototype.slice.call(arguments,0);var τp0;var message;var args;if(((τ324 instanceof Array)&&(((τp0=τ324.length),true)&&((τp0>=0)&&((message=function(){if((0>=τp0)){return "";}else{return τ324[0];}}()),true,(args=τ324.slice(1)),true))))){var τ323=this;var e=Error(message);(e["::tags"]=τ323.tags);(e["args"]=args);(e["name"]=["E"].concat(τ323.tags).join("."));return e;}else{throw ["Could not find a match",τ324];}});(τ322.prototype["::check"]=function(e){var τ323=this;if(((!e)||(!τ200(Error)(e)))){return false;}else{null;}var tags=(e["::tags"]||[]);var τ325=τ323.tags;var τ326=τ325.length;for(var τ327=0;(τ327<τ326);(τ327++)){var τ328=τ325[τ327];var tag;var other;if(((tag=τ328),true,(tags.indexOf(tag)===(-1)))){return false;}else{if(((other=τ328),true)){false;}else{throw ["Could not find a match",τ328];}}}false;return true;});(τ322.prototype["::deconstruct"]=function(e){var τ323=this;return e.args;});return τ322;}();
var τ329=function(from,to){var rval=[];for(var i=from;(i<=to);(i++)){rval.push(i);}return rval;};
var τ330=function(type){return function(value){var τ331=type[":::deconstruct"];var f;if((τ331===(void 0))){var τ332=type["::deconstruct"];var f;if((τ332===(void 0))){if((value instanceof Array)){return [true,value];}else{if(true){return [false,null];}else{return false;}}}else{if(((f=τ332),true)){var τ334;try{(τ334=[true,f.call(type,value)]);}catch(τ333){(τ334=[false,null]);}return τ334;}else{throw ["Could not find a match",τ332];}}}else{if(((f=τ331),true)){return f.call(type,value);}else{throw ["Could not find a match",τ331];}}};};
var τ335=function(τ336,key){var τ337=τ336;var x;var x;var x;if(((τ337===null)||(τ337===(void 0)))){return false;}else{if(((typeof(τ337)==="string")&&((x=τ337),true))){return (key in String.prototype);}else{if(((typeof(τ337)==="number")&&((x=τ337),true))){return (key in Number.prototype);}else{if(((x=τ337),true)){return (key in x);}else{throw ["Could not find a match",τ337];}}}}};var τ206=require("./util");var binsearch=τ206.binsearch;var items=τ206.items;var enumerate=τ206.enumerate;var τ207=require("./pp");var Node=τ207.Node;var __lt____gt__=τ207["<>"];var repr=τ207.repr;var fs=require("fs");var Source=function(){var τ209=Array.prototype.slice.call(arguments,0);var τp0;var text;var url;if(((τ209 instanceof Array)&&(((τp0=τ209.length),true)&&(((τp0>=1)&&(τp0<=2))&&((text=τ209[0]),true,(url=function(){if((1>=τp0)){return false;}else{return τ209[1];}}()),true))))){var τ208=function(){if((!τ200(Source)(this))){return Object.create(Source.prototype);}else{return this;}}();(τ208["text"]=text);(τ208["url"]=url);(τ208["counts"]=[]);var curr=0;var τ210=text.split("\n");var τ211=τ210.length;for(var τ212=0;(τ212<τ211);(τ212++)){var τ213=τ210[τ212];var line;var other;if(((line=τ213),true)){τ208.counts.push(curr);(curr=(curr+(line.length+1)));}else{if(((other=τ213),true)){false;}else{throw ["Could not find a match",τ213];}}}false;τ208.counts.push(curr);(τ208["nlines"]=(τ208.counts.length-1));return τ208;}else{throw ["Could not find a match",τ209];}};τ320(Source);(Source.prototype["linecol"]=function(pos){var τ208=this;var line=binsearch(τ208.counts,pos);var col=(pos-send(τ208.counts,(line-1)));return [line,col];});(Source.prototype["highlight_lines"]=function(l1,l2,spans){var τ208=this;return highlight_lines(τ208.text,τ208.counts,[(l1-1),(l2-1)],spans);});Source;var Location=function(source,start,end){var τ214=function(){if((!τ200(Location)(this))){return Object.create(Location.prototype);}else{return this;}}();(τ214["source"]=(source||Source("",null)));(τ214["start"]=start);(τ214["end"]=end);return τ214;};τ320(Location);(Location.prototype["text"]=function(){var τ214=this;return τ214.source.text.slice(τ214.start,τ214.end);});(Location.prototype["linerange"]=function(){var τ214=this;var τ215=τ214.linecol();var τp0;var τp1;var τp2;var l1;var _;var τ216;if(((τ215 instanceof Array)&&(((τp0=τ215.length),true)&&((τp0===2)&&(((τp1=τ215[0]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===2)&&((l1=τp1[0]),true,(_=τp1[1]),true,(τ216=τ215[1]),true)))))))){var τ217=τ216;var τp0;var l2;var _;if((τ217===null)){return [l1,l1];}else{if(((τ217 instanceof Array)&&(((τp0=τ217.length),true)&&((τp0===2)&&((l2=τ217[0]),true,(_=τ217[1]),true))))){return [l1,l2];}else{throw ["Could not find a match",τ217];}}}else{throw ["Could not find a match",τ215];}});(Location.prototype["linecol"]=function(){var τ214=this;var start=τ214.source.linecol(τ214.start);var end=function(){if((τ214.start===τ214.end)){return null;}else{return τ214.source.linecol((τ214.end-1));}}();return [start,end];});(Location.prototype["ref"]=function(){var τ214=this;var τ218=τ214.linecol();var τp0;var τp1;var τp2;var τp3;var τp4;var l1;var τp5;var τp6;var c1;var τ219;if(((τ218 instanceof Array)&&(((τp0=τ218.length),true)&&((τp0===2)&&(((τp1=τ218[0]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===2)&&(((τp3=τp1[0]),(τp4=[true,String(τp3)]),τp4[0])&&(((l1=τp4[1]),true,(τp5=τp1[1]),(τp6=[true,String(τp5)]),τp6[0])&&((c1=τp6[1]),true,(τ219=τ218[1]),true)))))))))){var τ220=τ219;var τp0;var τp1;var τp2;var l2;var τp3;var τp4;var c2;if((τ220===null)){return ((l1+":")+c1);}else{if(((τ220 instanceof Array)&&(((τp0=τ220.length),true)&&((τp0===2)&&(((τp1=τ220[0]),(τp2=[true,String(τp1)]),τp2[0])&&(((l2=τp2[1]),true,(τp3=τ220[1]),(τp4=[true,String(τp3)]),τp4[0])&&((c2=τp4[1]),true))))))){var τ221=null;var otherwise;if(((l1===l2)&&(c1===c2))){return ((l1+":")+c1);}else{if((l1===l2)){return ((((l1+":")+c1)+"-")+c2);}else{if(((otherwise=τ221),true)){return ((((((l1+":")+c1)+"-")+l1)+":")+c2);}else{throw ["Could not find a match",τ221];}}}}else{throw ["Could not find a match",τ220];}}}else{throw ["Could not find a match",τ218];}});(Location.prototype["highlight"]=function(){var τ222=Array.prototype.slice.call(arguments,0);var τp0;var cls;var context;if(((τ222 instanceof Array)&&(((τp0=τ222.length),true)&&(((τp0>=0)&&(τp0<=2))&&((cls=function(){if((0>=τp0)){return "hl1";}else{return τ222[0];}}()),true,(context=function(){if((1>=τp0)){return 0;}else{return τ222[1];}}()),true))))){var τ214=this;return highlight_locations([[τ214,cls]],context);}else{throw ["Could not find a match",τ222];}});Location;var highlight=function(){var τ223=Array.prototype.slice.call(arguments,0);var τp0;var text;var spans;var offset;if(((τ223 instanceof Array)&&(((τp0=τ223.length),true)&&(((τp0>=2)&&(τp0<=3))&&((text=τ223[0]),true,(spans=τ223[1]),true,(offset=function(){if((2>=τp0)){return 0;}else{return τ223[2];}}()),true))))){return Node([],function(){var τ224=[];var τ225=morsel(spans);var τ226=τ225.length;for(var τ227=0;(τ227<τ226);(τ227++)){var τ228=τ225[τ227];var τp0;var start;var end;var attributes;var other;if(((τ228 instanceof Array)&&(((τp0=τ228.length),true)&&((τp0===3)&&((start=τ228[0]),true,(end=τ228[1]),true,(attributes=τ228[2]),true))))){τ224.push(function(){var xstart=Math.max((start-offset),0);var xend=Math.min((end-offset),text.length);return Node(attributes,[text.slice(xstart,xend)]);}());}else{if(((other=τ228),true)){false;}else{throw ["Could not find a match",τ228];}}}return τ224;}());}else{throw ["Could not find a match",τ223];}};var highlight_lines=function(text,linelocs,τ229,spans){var τp0;var l1;var l2;if(((τ229 instanceof Array)&&(((τp0=τ229.length),true)&&((τp0===2)&&((l1=τ229[0]),true,(l2=τ229[1]),true))))){undefined;}else{throw τ320(τ321(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}return Node(["+span"],function(){var τ230=[];var τ231=τ329(l1,l2);var τ232=τ231.length;for(var τ233=0;(τ233<τ232);(τ233++)){var τ234=τ231[τ233];var lineno;var other;if(((lineno=τ234),true)){τ230.push(function(){var start=send(linelocs,lineno);var end=send(linelocs,(lineno+1));return Node(["+span"],[Node(["lineno"],(lineno+1)),Node(["source"],highlight(text,τ202([[start,end,[]]],clamp(spans,start,end))))]);}());}else{if(((other=τ234),true)){false;}else{throw ["Could not find a match",τ234];}}}return τ230;}());};var clamp=function(spans,bot,top){var τ235=[];var τ236=spans;var τ237=τ236.length;for(var τ238=0;(τ238<τ237);(τ238++)){var τ239=τ236[τ238];var τp0;var start;var end;var attr;var other;if(((τ239 instanceof Array)&&(((τp0=τ239.length),true)&&((τp0===3)&&((start=τ239[0]),true,(end=τ239[1]),true,(attr=τ239[2]),true,((end>=bot)&&(start<=top))))))){τ235.push([Math.max(start,bot),Math.min(end,top),attr]);}else{if(((other=τ239),true)){false;}else{throw ["Could not find a match",τ239];}}}return τ235;};var morsel=function(spans){var jump=function(active,bot,top){var e=send(Math.min,τ202([top],function(){var τ240=[];var τ241=active;var τ242=τ241.length;for(var τ243=0;(τ243<τ242);(τ243++)){var τ244=τ241[τ243];var τp0;var _;var x;var _;var other;if(((τ244 instanceof Array)&&(((τp0=τ244.length),true)&&((τp0===3)&&((_=τ244[0]),true,(x=τ244[1]),true,(_=τ244[2]),true))))){τ240.push(x);}else{if(((other=τ244),true)){false;}else{throw ["Could not find a match",τ244];}}}return τ240;}()));var attributes=send(τ202,function(){var τ245=[];var τ246=active;var τ247=τ246.length;for(var τ248=0;(τ248<τ247);(τ248++)){var τ249=τ246[τ248];var τp0;var _;var _;var X;var other;if(((τ249 instanceof Array)&&(((τp0=τ249.length),true)&&((τp0===3)&&((_=τ249[0]),true,(_=τ249[1]),true,(X=τ249[2]),true))))){τ245.push(X);}else{if(((other=τ249),true)){false;}else{throw ["Could not find a match",τ249];}}}return τ245;}());return [e,[bot,e,attributes]];};var jumptill=function(active,bot,top){if((bot===top)){return [[],active];}else{if(true){var τp0;var τp1;var newbot;var span;if((((τp0=jump(active,bot,top)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((newbot=τp0[0]),true,(span=τp0[1]),true))))){undefined;}else{throw τ320(τ321(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/location.eg",3584,3598]}));}var newactive=function(){var τ250=[];var τ251=active;var τ252=τ251.length;for(var τ253=0;(τ253<τ252);(τ253++)){var τ254=τ251[τ253];var x;var τp0;var _;var e;var attr;var other;if((((x=τ254),true,(τ254 instanceof Array))&&(((τp0=τ254.length),true)&&((τp0===3)&&((_=τ254[0]),true,(e=τ254[1]),true,(attr=τ254[2]),true,(e>newbot)))))){τ250.push(x);}else{if(((other=τ254),true)){false;}else{throw ["Could not find a match",τ254];}}}return τ250;}();var τp0;var τp1;var spans;var remainder;if((((τp0=jumptill(newactive,newbot,top)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((spans=τp0[0]),true,(remainder=τp0[1]),true))))){undefined;}else{throw τ320(τ321(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/location.eg",3724,3742]}));}return [[span].concat(spans),remainder];}else{return false;}}};var process=function(start,active,rem){var τ255=[start,active,rem];var τp0;var _;var τp1;var τp2;var τp3;var τp4;var τp0;var start;var active;var τp1;var τp2;var τp0;var start;var active;var τp1;var τp2;var τp3;var next;var τp4;var target;var end;var attr;var rest;var τ256=false;var τ257=false;var τ258=false;var τ259=false;var τ260=false;if(((τ256=(τ255 instanceof Array))&&((τ257=((τp0=τ255.length),true))&&((τ258=(τp0===3))&&(((_=τ255[0]),true,(τp1=τ255[1]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===0)&&(((τp3=τ255[2]),(τp3 instanceof Array))&&(((τp4=τp3.length),true)&&(τp4===0)))))))))){return [];}else{if((τ258&&((τ259=((start=τ255[0]),true,(active=τ255[1]),true,(τp1=τ255[2]),(τp1 instanceof Array)))&&((τ260=((τp2=τp1.length),true))&&(τp2===0))))){var top=send(Math.max,function(){var τ261=[];var τ262=active;var τ263=τ262.length;for(var τ264=0;(τ264<τ263);(τ264++)){var τ265=τ262[τ264];var τp0;var _;var e;var _;var other;if(((τ265 instanceof Array)&&(((τp0=τ265.length),true)&&((τp0===3)&&((_=τ265[0]),true,(e=τ265[1]),true,(_=τ265[2]),true))))){τ261.push(e);}else{if(((other=τ265),true)){false;}else{throw ["Could not find a match",τ265];}}}return τ261;}());var bot=Math.min(start,top);var τp0;var τp1;var spans;var _;if((((τp0=jumptill(active,start,top)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((spans=τp0[0]),true,(_=τp0[1]),true))))){undefined;}else{throw τ320(τ321(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/location.eg",4035,4045]}));}return spans;}else{if((τ260&&((τp2>=1)&&(((τp3=τp1[0]),(next=τp3),true,(τp3 instanceof Array))&&(((τp4=τp3.length),true)&&((τp4===3)&&((target=τp3[0]),true,(end=τp3[1]),true,(attr=τp3[2]),true,(rest=τp1.slice(1)),true))))))){var τp0;var τp1;var spans;var newactive;if((((τp0=jumptill(active,start,target)),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((spans=τp0[0]),true,(newactive=τp0[1]),true))))){undefined;}else{throw τ320(τ321(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/location.eg",4165,4183]}));}return spans.concat(process(target,[next].concat(newactive),rest));}else{throw ["Could not find a match",τ255];}}}};var thespans=spans.sort(function(τ266,τ267){var τp0;var s1;var e1;var _;if(((τ266 instanceof Array)&&(((τp0=τ266.length),true)&&((τp0===3)&&((s1=τ266[0]),true,(e1=τ266[1]),true,(_=τ266[2]),true))))){undefined;}else{throw τ320(τ321(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}var τp0;var s2;var e2;var _;if(((τ267 instanceof Array)&&(((τp0=τ267.length),true)&&((τp0===3)&&((s2=τ267[0]),true,(e2=τ267[1]),true,(_=τ267[2]),true))))){undefined;}else{throw τ320(τ321(["match"]).create("The value failed to match"),({"location":["location",(void 0),(void 0),(void 0)]}));}if((s1===s2)){return (e1-e2);}else{return (s1-s2);}});return process(thespans[0][0],[],thespans);};var highlight_locations=function(){var τ268=Array.prototype.slice.call(arguments,0);var τp0;var locations;var context;if(((τ268 instanceof Array)&&(((τp0=τ268.length),true)&&(((τp0>=1)&&(τp0<=2))&&((locations=τ268[0]),true,(context=function(){if((1>=τp0)){return 0;}else{return τ268[1];}}()),true))))){var srcs=({});var τ269=locations;var τ270=τ269.length;for(var τ271=0;(τ271<τ270);(τ271++)){var τ272=τ269[τ271];var τp0;var loc;var cls;var other;if(((τ272 instanceof Array)&&(((τp0=τ272.length),true)&&((τp0===2)&&((loc=τ272[0]),true,(cls=τ272[1]),true))))){var key=String((loc.source&&loc.source.url));if((!send(srcs,key))){(srcs[key]=[]);}else{null;}send(srcs,key).push([loc,cls]);}else{if(((other=τ272),true)){false;}else{throw ["Could not find a match",τ272];}}}false;return Node(["+div"],function(){var τ273=[];var τ274=items(srcs);var τ275=τ274.length;for(var τ276=0;(τ276<τ275);(τ276++)){var τ277=τ274[τ276];var τp0;var _;var locs;var other;if(((τ277 instanceof Array)&&(((τp0=τ277.length),true)&&((τp0===2)&&((_=τ277[0]),true,(locs=τ277[1]),true))))){τ273.push(highlight_locations_same_source(locs,context));}else{if(((other=τ277),true)){false;}else{throw ["Could not find a match",τ277];}}}return τ273;}());}else{throw ["Could not find a match",τ268];}};var highlight_locations_same_source=function(){var τ278=Array.prototype.slice.call(arguments,0);var τp0;var locations;var context;if(((τ278 instanceof Array)&&(((τp0=τ278.length),true)&&(((τp0>=1)&&(τp0<=2))&&((locations=τ278[0]),true,(context=function(){if((1>=τp0)){return 0;}else{return τ278[1];}}()),true))))){var loc=merge_locations(function(){var τ279=[];var τ280=locations;var τ281=τ280.length;for(var τ282=0;(τ282<τ281);(τ282++)){var τ283=τ280[τ282];var τp0;var x;var cls;var other;if(((τ283 instanceof Array)&&(((τp0=τ283.length),true)&&((τp0===2)&&((x=τ283[0]),true,(cls=τ283[1]),true))))){τ279.push(x);}else{if(((other=τ283),true)){false;}else{throw ["Could not find a match",τ283];}}}return τ279;}());var src=loc.source;var τp0;var τp1;var l1;var l2;if((((τp0=loc.linerange()),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===2)&&((l1=τp0[0]),true,(l2=τp0[1]),true))))){undefined;}else{throw τ320(τ321(["match"]).create("The value failed to match"),({"location":["location","/home/olivier/git/earl-grey/src/location.eg",4958,4966]}));}var first=Math.max(1,(l1-context));var last=Math.min(src.nlines,(l2+context));return Node(["+div","location"],[Node(["+div","source"],[Node(["sourcefile"],(src.url||"???")),function(){var τ284=[];var τ285=locations;var τ286=τ285.length;for(var τ287=0;(τ287<τ286);(τ287++)){var τ288=τ285[τ287];var τp0;var loc;var cls;var other;if(((τ288 instanceof Array)&&(((τp0=τ288.length),true)&&((τp0===2)&&((loc=τ288[0]),true,(cls=τ288[1]),true))))){τ284.push(Node([cls,"sourcepos"],loc.ref()));}else{if(((other=τ288),true)){false;}else{throw ["Could not find a match",τ288];}}}return τ284;}()]),src.highlight_lines(first,last,function(){var τ289=[];var τ290=locations;var τ291=τ290.length;for(var τ292=0;(τ292<τ291);(τ292++)){var τ293=τ290[τ292];var τp0;var loc;var cls;var other;if(((τ293 instanceof Array)&&(((τp0=τ293.length),true)&&((τp0===2)&&((loc=τ293[0]),true,(cls=τ293[1]),true))))){τ289.push([loc.start,loc.end,[cls]]);}else{if(((other=τ293),true)){false;}else{throw ["Could not find a match",τ293];}}}return τ289;}())]);}else{throw ["Could not find a match",τ278];}};var merge_locations=function(τ294){var τ295=τ294;var τp0;var τp0;var loc;var τp0;var locs;var τ296=false;var τ297=false;if(((τ296=(τ295 instanceof Array))&&((τ297=((τp0=τ295.length),true))&&(τp0===0)))){return Location(null,0,0);}else{if((τ297&&((τp0===1)&&((loc=τ295[0]),true)))){return loc;}else{if((τ297&&((τp0>=0)&&((locs=τ295.slice(0)),true)))){var start=send(Math.min,function(){var τ298=[];var τ299=locs;var τ300=τ299.length;for(var τ301=0;(τ301<τ300);(τ301++)){var τ302=τ299[τ301];var loc;var other;if(((loc=τ302),true)){τ298.push(loc.start);}else{if(((other=τ302),true)){false;}else{throw ["Could not find a match",τ302];}}}return τ298;}());var end=send(Math.max,function(){var τ303=[];var τ304=locs;var τ305=τ304.length;for(var τ306=0;(τ306<τ305);(τ306++)){var τ307=τ304[τ306];var loc;var other;if(((loc=τ307),true)){τ303.push(loc.end);}else{if(((other=τ307),true)){false;}else{throw ["Could not find a match",τ307];}}}return τ303;}());return Location(locs[0].source,start,end);}else{throw ["Could not find a match",τ295];}}}};var __lt____lt____colon__=function(x,y){if((!x.location)){(x["location"]=function(){if(((!y)||τ200(Location)(y))){return y;}else{return y.location;}}());}else{null;}return x;};var __plus____plus____colon__=function(x,y){(x=function(){if(((!x)||τ200(Location)(x))){return x;}else{return x.location;}}());(y=function(){if(((!y)||τ200(Location)(y))){return y;}else{return y.location;}}());var τ309;try{(τ309=merge_locations([x,y]));}catch(τ308){(τ309=undefined);}return τ309;};var format_error=function(τ311){var e;var τ310;(e=τ311);true;(τ310=τ311);var τ312=τ310;var τp0;var τp1;var τp2;var args;var τp0;var τp1;var τp2;var url;var start;var end;var other;if((τ200(τ321(["syntax"]))(τ312)&&(((τp0=τ330(τ321(["syntax"]))(τ312)),τp0[0])&&(((τp1=τp0[1]),true,(τp2=τp1.length),true)&&((τp2===1)&&((args=τp1[0]),true)))))){var hls=["hl1","hl2","hl3","hl4"];var locs=function(){var τ313=[];var τ314=enumerate(items(args));var τ315=τ314.length;for(var τ316=0;(τ316<τ315);(τ316++)){var τ317=τ314[τ316];var τp0;var i;var τp1;var τp2;var key;var arg;var other;if(((τ317 instanceof Array)&&(((τp0=τ317.length),true)&&((τp0===2)&&(((i=τ317[0]),true,(τp1=τ317[1]),(τp1 instanceof Array))&&(((τp2=τp1.length),true)&&((τp2===2)&&((key=τp1[0]),true,(arg=τp1[1]),true,arg.location)))))))){τ313.push([arg.location,send(hls,(i%4))]);}else{if(((other=τ317),true)){false;}else{throw ["Could not find a match",τ317];}}}return τ313;}();return Node(["+div"],[Node(["+div"],[Node(["error_type"],e.name),Node(["error_message"],e.message)]),repr(args),highlight_locations(locs)]);}else{if((τ335(τ312,"location")&&(((τp0=τ312.location),(τp0 instanceof Array))&&(((τp1=τp0.length),true)&&((τp1===4)&&(((τp2=τp0[0]),(τp2==="location"))&&((url=τp0[1]),true,(start=τp0[2]),true,(end=τp0[3]),true))))))){var data=function(){var τ319;try{(τ319=fs.readFileSync(url,"utf8"));}catch(τ318){(τ319=null);}return τ319;}();if(data){var loc=Location(Source(data,url),start,end);return Node(["+div"],[Node(["+div"],[Node(["error_type"],e.name),Node(["error_message"],e.message)]),highlight_locations([[loc,"hl1"]])]);}else{return Node(["+div"],Node(["traceback"],(e.stack||e)));}}else{if(((other=τ312),true)){return Node(["traceback"],(e.stack||e));}else{throw ["Could not find a match",τ312];}}}};var display_error=function(e){return __lt____gt__(null,format_error(e));};(exports["Source"]=Source);(exports["Location"]=Location);(exports["highlight"]=highlight);(exports["highlight_locations"]=highlight_locations);(exports["merge_locations"]=merge_locations);(exports["<<:"]=__lt____lt____colon__);(exports["++:"]=__plus____plus____colon__);(exports["format_error"]=format_error);(exports["display_error"]=display_error);
