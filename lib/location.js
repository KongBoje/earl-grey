require("earlgrey-runtime");
var $7847=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});var accum$5826;var accum$5830;var accum$6190;var accum$6194;var $5614$5644;var binsearch$5645;var $5615$5646;var __lt____gt__$5647;var repr$5648;var fs$5649;var Source$5650;var Location$5651;var highlight$5652;var highlight_lines$5653;var clamp$5654;var morsel$5655;var highlight_locations$5656;var highlight_locations_same_source$5657;var merge_locations$5658;var __lt____lt____colon__$5659;var __plus____plus____colon__$5660;var format_error$5661;var display_error$5662;($5614$5644=require("./util"));(binsearch$5645=$5614$5644.binsearch);($5615$5646=require("./pp"));(__lt____gt__$5647=$5615$5646["<>"]);(repr$5648=$5615$5646.repr);(fs$5649=require("fs"));(Source$5650=(function(){var $index$5750;var $length$5744;var temp$5738;var curr$5719;var text$5705;var url$5706;var t0$5701;var $5692$5696;var it$0$5687;(it$0$5687=(function(){if((!getChecker(Source$5650)(this))){return Object.create(Source$5650.prototype);}else{return this;}})());($5692$5696=arguments);(t0$5701=$5692$5696.length);if(((t0$5701>=1)&&(t0$5701<=2))){(text$5705=$5692$5696[0]);(url$5706=(function(){if((1>=t0$5701)){return false;}else{return $5692$5696[1];}})());(it$0$5687["text"]=text$5705);(it$0$5687["url"]=url$5706);(it$0$5687["counts"]=[]);(curr$5719=0);(temp$5738=text$5705.split("\n"));($length$5744=temp$5738.length);($index$5750=0);$5720:for(;($index$5750<$length$5744);($index$5750++)){var line$5767;var m$5759;(m$5759=temp$5738[$index$5750]);(line$5767=m$5759);it$0$5687.counts.push(curr$5719);(curr$5719=(curr$5719+(line$5767.length+1)));}it$0$5687.counts.push(curr$5719);(it$0$5687["nlines"]=(it$0$5687.counts.length-1));}else{___match_error($5692$5696);}return it$0$5687;}));(Source$5650.prototype["linecol"]=(function(pos$5780){var line$5796;var col$5797;var it$0$5784;var self$5785;(it$0$5784=this);(self$5785=this);(line$5796=binsearch$5645(it$0$5784.counts,pos$5780));(col$5797=(pos$5780-$7847(it$0$5784.counts,(line$5796-1))));return [line$5796,col$5797];}));(Source$5650.prototype["highlight_lines"]=(function(l1$5808,l2$5809,spans$5810){var it$0$5814;var self$5815;(it$0$5814=this);(self$5815=this);return highlight_lines$5653(it$0$5814.text,it$0$5814.counts,[(l1$5808-1),(l2$5809-1)],spans$5810);}));__amp____colon__(Source$5650,__amp____colon__(((accum$5826=({})),((accum$5826["::name"]="Source"),accum$5826)),((accum$5830=({})),((accum$5830["::egclass"]=true),accum$5830))));Source$5650;(Location$5651=(function(source$5837,start$5838,end$5839){var it$0$5842;(it$0$5842=(function(){if((!getChecker(Location$5651)(this))){return Object.create(Location$5651.prototype);}else{return this;}})());(it$0$5842["source"]=(source$5837||Source$5650("",null)));(it$0$5842["start"]=start$5838);(it$0$5842["end"]=end$5839);return it$0$5842;}));(Location$5651.prototype["text"]=(function(){var it$0$5869;var self$5870;(it$0$5869=this);(self$5870=this);return it$0$5869.source.text.slice(it$0$5869.start,it$0$5869.end);}));(Location$5651.prototype["at_start"]=(function(){var it$0$5885;var self$5886;(it$0$5885=this);(self$5886=this);return Location$5651(it$0$5885.source,it$0$5885.start,it$0$5885.start);}));(Location$5651.prototype["at_end"]=(function(){var it$0$5901;var self$5902;(it$0$5901=this);(self$5902=this);return Location$5651(it$0$5901.source,it$0$5901.end,it$0$5901.end);}));(Location$5651.prototype["linerange"]=(function(){var l2$5973;var t0$5964;var t1$5965;var l1$5944;var $5928$5945;var t0$5938;var t1$5939;var t2$5940;var $5926$5933;var it$0$5917;var self$5918;(it$0$5917=this);(self$5918=this);($5926$5933=it$0$5917.linecol());if((($5926$5933 instanceof Array)&&(((t0$5938=$5926$5933.length)),((t0$5938===2)&&(((t1$5939=$5926$5933[0])),((t1$5939 instanceof Array)&&(((t2$5940=t1$5939.length)),(t2$5940===2)))))))){(l1$5944=t1$5939[0]);t1$5939[1];($5928$5945=$5926$5933[1]);if(($5928$5945===null)){return [l1$5944,l1$5944];}else{(t0$5964=$5928$5945);if(((t0$5964 instanceof Array)&&(((t1$5965=t0$5964.length)),(t1$5965===2)))){(l2$5973=t0$5964[0]);t0$5964[1];return [l1$5944,l2$5973];}else{___match_error($5928$5945,"/home/olivier/git/eg/src/location.eg",1080,1085);}}}else{___match_error($5926$5933);}}));(Location$5651.prototype["linecol"]=(function(){var start$6008;var end$6009;var it$0$5996;var self$5997;(it$0$5996=this);(self$5997=this);(start$6008=it$0$5996.source.linecol(it$0$5996.start));(end$6009=(function(){if((it$0$5996.start===it$0$5996.end)){return null;}else{return it$0$5996.source.linecol((it$0$5996.end-1));}})());return [start$6008,end$6009];}));(Location$5651.prototype["ref"]=(function(){var otherwise$6143;var $6123$6132;var $6119$6126;var l2$6095;var c2$6096;var t0$6084;var t1$6085;var t2$6086;var t3$6087;var l1$6052;var c1$6053;var $6034$6054;var t0$6044;var t1$6045;var t2$6046;var t3$6047;var t4$6048;var $6032$6039;var it$0$6023;var self$6024;(it$0$6023=this);(self$6024=this);($6032$6039=it$0$6023.linecol());if((($6032$6039 instanceof Array)&&(((t0$6044=$6032$6039.length)),((t0$6044===2)&&(((t1$6045=$6032$6039[0])),((t1$6045 instanceof Array)&&(((t2$6046=t1$6045.length)),((t2$6046===2)&&(((t3$6047=[true,String(t1$6045[0])])),(t3$6047[0]&&((l1$6052=t3$6047[1]),(((t4$6048=[true,String(t1$6045[1])])),t4$6048[0])))))))))))){(c1$6053=t4$6048[1]);($6034$6054=$6032$6039[1]);if(($6034$6054===null)){return ((l1$6052+":")+c1$6053);}else{(t0$6084=$6034$6054);if(((t0$6084 instanceof Array)&&(((t1$6085=t0$6084.length)),((t1$6085===2)&&(((t2$6086=[true,String(t0$6084[0])])),(t2$6086[0]&&((l2$6095=t2$6086[1]),(((t3$6087=[true,String(t0$6084[1])])),t3$6087[0])))))))){(c2$6096=t3$6087[1]);($6119$6126=null);$6119$6126;if(((l1$6052===l2$6095)&&(c1$6053===c2$6096))){return ((l1$6052+":")+c1$6053);}else{if((l1$6052===l2$6095)){return ((((l1$6052+":")+c1$6053)+"-")+c2$6096);}else{(otherwise$6143=$6119$6126);return ((((((l1$6052+":")+c1$6053)+"-")+l2$6095)+":")+c2$6096);}}}else{___match_error($6034$6054,"/home/olivier/git/eg/src/location.eg",1422,1427);}}}else{___match_error($6032$6039);}}));(Location$5651.prototype["highlight"]=(function(){var cls$6177;var context$6178;var t0$6173;var $6156$6168;var it$0$6158;var self$6159;(it$0$6158=this);(self$6159=this);($6156$6168=arguments);(t0$6173=$6156$6168.length);if(((t0$6173>=0)&&(t0$6173<=2))){(cls$6177=(function(){if((0>=t0$6173)){return "hl1";}else{return $6156$6168[0];}})());(context$6178=(function(){if((1>=t0$6173)){return 0;}else{return $6156$6168[1];}})());return highlight_locations$5656([[it$0$6158,cls$6177]],context$6178);}else{___match_error($6156$6168);}}));__amp____colon__(Location$5651,__amp____colon__(((accum$6190=({})),((accum$6190["::name"]="Location"),accum$6190)),((accum$6194=({})),((accum$6194["::egclass"]=true),accum$6194))));Location$5651;(highlight$5652=(function(){var $index$6246;var $length$6240;var temp$6234;var acc$6228;var text$6214;var spans$6215;var offset$6216;var t0$6210;var $6201$6205;($6201$6205=arguments);(t0$6210=$6201$6205.length);if(((t0$6210>=2)&&(t0$6210<=3))){(text$6214=$6201$6205[0]);(spans$6215=$6201$6205[1]);(offset$6216=(function(){if((2>=t0$6210)){return 0;}else{return $6201$6205[2];}})());return Node([],({}),(((acc$6228=[])),(((temp$6234=morsel$5655(spans$6215))),((($length$6240=temp$6234.length)),((($index$6246=0)),(function(){$6223:for(;($index$6246<$length$6240);($index$6246++)){var xstart$6283;var xend$6284;var start$6265;var end$6266;var attributes$6267;var t0$6260;var t1$6261;var m$6255;(m$6255=temp$6234[$index$6246]);(t0$6260=m$6255);if(((t0$6260 instanceof Array)&&(((t1$6261=t0$6260.length)),(t1$6261===3)))){(start$6265=t0$6260[0]);(end$6266=t0$6260[1]);(attributes$6267=t0$6260[2]);acc$6228.push((((xstart$6283=Math.max((start$6265-offset$6216),0))),((xend$6284=Math.min((end$6266-offset$6216),text$6214.length))),Node([("."+attributes$6267.slice(0,1))],({}),text$6214.slice(xstart$6283,xend$6284))));}else{___match_error(m$6255,"/home/olivier/git/eg/src/location.eg",1972,2262);}}})()))),acc$6228));}else{___match_error($6201$6205);}}));(highlight_lines$5653=(function(text$6302,linelocs$6303,$6299$6304,spans$6305){var t0$6310;var t1$6311;var $index$6347;var $length$6341;var temp$6335;var acc$6329;var l1$6307;var l2$6308;(t0$6310=$6299$6304);if(((t0$6310 instanceof Array)&&(((t1$6311=t0$6310.length)),(t1$6311===2)))){(l1$6307=t0$6310[0]);(l2$6308=t0$6310[1]);}else{___match_error($6299$6304);}return Node(["span"],({}),(((acc$6329=[])),(((temp$6335=range(l1$6307,l2$6308))),((($length$6341=temp$6335.length)),((($index$6347=0)),(function(){$6324:for(;($index$6347<$length$6341);($index$6347++)){var start$6370;var end$6371;var lineno$6364;var m$6356;(m$6356=temp$6335[$index$6347]);(lineno$6364=m$6356);acc$6329.push((((start$6370=$7847(linelocs$6303,lineno$6364))),((end$6371=$7847(linelocs$6303,(lineno$6364+1)))),Node(["span"],({}),[Node([".lineno"],({}),(lineno$6364+1)),Node([".source"],({}),highlight$5652(text$6302,[[start$6370,end$6371,[]]].concat(clamp$5654(spans$6305,start$6370,end$6371))))])));}})()))),acc$6329));}));(clamp$5654=(function(spans$6383,bot$6384,top$6385){var $index$6410;var $length$6404;var temp$6398;var acc$6392;(acc$6392=[]);(temp$6398=spans$6383);($length$6404=temp$6398.length);($index$6410=0);$6387:for(;($index$6410<$length$6404);($index$6410++)){var start$6429;var end$6430;var attr$6431;var t0$6424;var t1$6425;var m$6419;(m$6419=temp$6398[$index$6410]);(t0$6424=m$6419);if(((t0$6424 instanceof Array)&&(((t1$6425=t0$6424.length)),((t1$6425===3)&&((start$6429=t0$6424[0]),((end$6430=t0$6424[1]),((attr$6431=t0$6424[2]),((end$6430>=bot$6384)&&(start$6429<=top$6385))))))))){acc$6392.push([Math.max(start$6429,bot$6384),Math.min(end$6430,top$6385),attr$6431]);}else{false;}}return acc$6392;}));(morsel$5655=(function(spans$6453){var jump$6460;var jumptill$6461;var process_elements$6462;var thespans$6463;(jump$6460=(function(active$6468,bot$6469,top$6470){var $index$6506;var $length$6500;var temp$6494;var acc$6488;var $index$6559;var $length$6553;var temp$6547;var e$6475;var attributes$6476;(e$6475=$7847(Math.min,[top$6470].concat((((acc$6488=[])),(((temp$6494=active$6468)),((($length$6500=temp$6494.length)),((($index$6506=0)),(function(){$6483:for(;($index$6506<$length$6500);($index$6506++)){var x$6525;var t0$6520;var t1$6521;var m$6515;(m$6515=temp$6494[$index$6506]);(t0$6520=m$6515);if(((t0$6520 instanceof Array)&&(((t1$6521=t0$6520.length)),(t1$6521===3)))){t0$6520[0];(x$6525=t0$6520[1]);t0$6520[2];acc$6488.push(x$6525);}else{___match_error(m$6515,"/home/olivier/git/eg/src/location.eg",3595,3628);}}})()))),acc$6488))));(attributes$6476=[]);(temp$6547=active$6468);($length$6553=temp$6547.length);($index$6559=0);$6477:for(;($index$6559<$length$6553);($index$6559++)){var X$6578;var t0$6573;var t1$6574;var m$6568;(m$6568=temp$6547[$index$6559]);(t0$6573=m$6568);if(((t0$6573 instanceof Array)&&(((t1$6574=t0$6573.length)),(t1$6574===3)))){t0$6573[0];t0$6573[1];(X$6578=t0$6573[2]);(attributes$6476=attributes$6476.concat(X$6578));}else{___match_error(m$6568,"/home/olivier/git/eg/src/location.eg",3654,3695);}}return [e$6475,[bot$6469,e$6475,attributes$6476]];}));(jumptill$6461=(function(active$6597,bot$6598,top$6599){var t0$6611;var t1$6612;var $index$6650;var $length$6644;var temp$6638;var acc$6632;var t0$6690;var t1$6691;var newbot$6605;var span$6606;var newactive$6607;var spans$6608;var remainder$6609;if((bot$6598===top$6599)){return [[],active$6597];}else{(t0$6611=jump$6460(active$6597,bot$6598,top$6599));if(((t0$6611 instanceof Array)&&(((t1$6612=t0$6611.length)),(t1$6612===2)))){(newbot$6605=t0$6611[0]);(span$6606=t0$6611[1]);}else{___match_error(jump$6460(active$6597,bot$6598,top$6599),"/home/olivier/git/eg/src/location.eg",3931,3953);}(newactive$6607=(((acc$6632=[])),(((temp$6638=active$6597)),((($length$6644=temp$6638.length)),((($index$6650=0)),(function(){$6627:for(;($index$6650<$length$6644);($index$6650++)){var x$6669;var e$6670;var attr$6671;var t0$6664;var t1$6665;var m$6659;(m$6659=temp$6638[$index$6650]);(t0$6664=m$6659);(x$6669=t0$6664);if(((t0$6664 instanceof Array)&&(((t1$6665=t0$6664.length)),((t1$6665===3)&&(t0$6664[0],((e$6670=t0$6664[1]),((attr$6671=t0$6664[2]),(e$6670>newbot$6605)))))))){acc$6632.push(x$6669);}else{false;}}})()))),acc$6632));(t0$6690=jumptill$6461(newactive$6607,newbot$6605,top$6599));if(((t0$6690 instanceof Array)&&(((t1$6691=t0$6690.length)),(t1$6691===2)))){(spans$6608=t0$6690[0]);(remainder$6609=t0$6690[1]);}else{___match_error(jumptill$6461(newactive$6607,newbot$6605,top$6599),"/home/olivier/git/eg/src/location.eg",4080,4112);}return [[span$6606].concat(spans$6608),remainder$6609];}}));(process_elements$6462=(function(start$6709,active$6710,rem$6711){var $index$6816;var $length$6810;var temp$6804;var acc$6798;var t0$6855;var t1$6856;var top$6788;var bot$6789;var spans$6790;var t0$6908;var t1$6909;var spans$6905;var newactive$6906;var start$6871;var active$6872;var next$6873;var target$6874;var end$6875;var attr$6876;var rest$6877;var start$6768;var active$6769;var $6717$6733;var $6718$6734;var $6719$6735;var t0$6727;var t1$6728;var t2$6729;var t3$6730;var t4$6731;var $6713$6722;($6713$6722=[start$6709,active$6710,rem$6711]);if((($6717$6733=($6713$6722 instanceof Array))&&(((t0$6727=$6713$6722.length)),(($6719$6735=(t0$6727===3))&&($6713$6722[0],(((t1$6728=$6713$6722[1])),((t1$6728 instanceof Array)&&(((t2$6729=t1$6728.length)),((t2$6729===0)&&(((t3$6730=$6713$6722[2])),((t3$6730 instanceof Array)&&(((t4$6731=t3$6730.length)),(t4$6731===0))))))))))))){return [];}else{if(($6719$6735&&((start$6768=$6713$6722[0]),((active$6769=$6713$6722[1]),(((t1$6728=$6713$6722[2])),((t1$6728 instanceof Array)&&(((t2$6729=t1$6728.length)),(t2$6729===0)))))))){(top$6788=$7847(Math.max,(((acc$6798=[])),(((temp$6804=active$6769)),((($length$6810=temp$6804.length)),((($index$6816=0)),(function(){$6793:for(;($index$6816<$length$6810);($index$6816++)){var e$6835;var t0$6830;var t1$6831;var m$6825;(m$6825=temp$6804[$index$6816]);(t0$6830=m$6825);if(((t0$6830 instanceof Array)&&(((t1$6831=t0$6830.length)),(t1$6831===3)))){t0$6830[0];(e$6835=t0$6830[1]);t0$6830[2];acc$6798.push(e$6835);}else{___match_error(m$6825,"/home/olivier/git/eg/src/location.eg",4309,4337);}}})()))),acc$6798)));(bot$6789=Math.min(start$6768,top$6788));(t0$6855=jumptill$6461(active$6769,start$6768,top$6788));if(((t0$6855 instanceof Array)&&(((t1$6856=t0$6855.length)),(t1$6856===2)))){(spans$6790=t0$6855[0]);t0$6855[1];}else{___match_error(jumptill$6461(active$6769,start$6768,top$6788),"/home/olivier/git/eg/src/location.eg",4400,4428);}return spans$6790;}else{if(($6719$6735&&((start$6871=$6713$6722[0]),((active$6872=$6713$6722[1]),(((t1$6728=$6713$6722[2])),((t1$6728 instanceof Array)&&(((t2$6729=t1$6728.length)),((t2$6729>=1)&&(((t3$6730=t1$6728[0])),((next$6873=t3$6730),((t3$6730 instanceof Array)&&(((t4$6731=t3$6730.length)),(t4$6731===3))))))))))))){(target$6874=t3$6730[0]);(end$6875=t3$6730[1]);(attr$6876=t3$6730[2]);(rest$6877=Array.prototype.slice.call(t1$6728,1));(t0$6908=jumptill$6461(active$6872,start$6871,target$6874));if(((t0$6908 instanceof Array)&&(((t1$6909=t0$6908.length)),(t1$6909===2)))){(spans$6905=t0$6908[0]);(newactive$6906=t0$6908[1]);}else{___match_error(jumptill$6461(active$6872,start$6871,target$6874),"/home/olivier/git/eg/src/location.eg",4542,4573);}return spans$6905.concat(process_elements$6462(target$6874,[next$6873].concat(newactive$6906),rest$6877));}else{___match_error($6713$6722);}}}}));(thespans$6463=spans$6453.sort((function($6928$6933,$6930$6934){var t0$6941;var t1$6942;var t0$6956;var t1$6957;var s1$6936;var e1$6937;var s2$6938;var e2$6939;(t0$6941=$6928$6933);if(((t0$6941 instanceof Array)&&(((t1$6942=t0$6941.length)),(t1$6942===3)))){(s1$6936=t0$6941[0]);(e1$6937=t0$6941[1]);t0$6941[2];}else{___match_error($6928$6933);}(t0$6956=$6930$6934);if(((t0$6956 instanceof Array)&&(((t1$6957=t0$6956.length)),(t1$6957===3)))){(s2$6938=t0$6956[0]);(e2$6939=t0$6956[1]);t0$6956[2];}else{___match_error($6930$6934);}if((s1$6936===s2$6938)){return (e1$6937-e2$6939);}else{return (s1$6936-s2$6938);}})));return process_elements$6462(thespans$6463[0][0],[],thespans$6463);}));(highlight_locations$5656=(function(){var $index$7021;var $length$7015;var temp$7009;var $index$7089;var $length$7083;var temp$7077;var acc$7071;var srcs$6999;var locations$6989;var context$6990;var t0$6985;var $6976$6980;($6976$6980=arguments);(t0$6985=$6976$6980.length);if(((t0$6985>=1)&&(t0$6985<=2))){(locations$6989=$6976$6980[0]);(context$6990=(function(){if((1>=t0$6985)){return 0;}else{return $6976$6980[1];}})());(srcs$6999=({}));(temp$7009=locations$6989);($length$7015=temp$7009.length);($index$7021=0);$7000:for(;($index$7021<$length$7015);($index$7021++)){var key$7055;var loc$7040;var cls$7041;var t0$7035;var t1$7036;var m$7030;(m$7030=temp$7009[$index$7021]);(t0$7035=m$7030);if(((t0$7035 instanceof Array)&&(((t1$7036=t0$7035.length)),(t1$7036===2)))){(loc$7040=t0$7035[0]);(cls$7041=t0$7035[1]);(key$7055=String((loc$7040.source&&loc$7040.source.url)));if((!$7847(srcs$6999,key$7055))){(srcs$6999[key$7055]=[]);}$7847(srcs$6999,key$7055).push([loc$7040,cls$7041]);}else{___match_error(m$7030,"/home/olivier/git/eg/src/location.eg",4929,5098);}}return Node(["div"],({}),(((acc$7071=[])),(((temp$7077=items(srcs$6999))),((($length$7083=temp$7077.length)),((($index$7089=0)),(function(){$7066:for(;($index$7089<$length$7083);($index$7089++)){var locs$7108;var t0$7103;var t1$7104;var m$7098;(m$7098=temp$7077[$index$7089]);(t0$7103=m$7098);if(((t0$7103 instanceof Array)&&(((t1$7104=t0$7103.length)),(t1$7104===2)))){t0$7103[0];(locs$7108=t0$7103[1]);acc$7071.push(highlight_locations_same_source$5657(locs$7108,context$6990));}else{___match_error(m$7098,"/home/olivier/git/eg/src/location.eg",5110,5197);}}})()))),acc$7071));}else{___match_error($6976$6980);}}));(highlight_locations_same_source$5657=(function(){var $index$7188;var $length$7182;var temp$7176;var acc$7170;var t0$7228;var t1$7229;var $index$7271;var $length$7265;var temp$7259;var acc$7253;var $index$7329;var $length$7323;var temp$7317;var acc$7311;var loc$7157;var src$7158;var l1$7159;var l2$7160;var first$7161;var last$7162;var locations$7143;var context$7144;var t0$7139;var $7130$7134;($7130$7134=arguments);(t0$7139=$7130$7134.length);if(((t0$7139>=1)&&(t0$7139<=2))){(locations$7143=$7130$7134[0]);(context$7144=(function(){if((1>=t0$7139)){return 0;}else{return $7130$7134[1];}})());(loc$7157=merge_locations$5658((((acc$7170=[])),(((temp$7176=locations$7143)),((($length$7182=temp$7176.length)),((($index$7188=0)),(function(){$7165:for(;($index$7188<$length$7182);($index$7188++)){var x$7207;var cls$7208;var t0$7202;var t1$7203;var m$7197;(m$7197=temp$7176[$index$7188]);(t0$7202=m$7197);if(((t0$7202 instanceof Array)&&(((t1$7203=t0$7202.length)),(t1$7203===2)))){(x$7207=t0$7202[0]);(cls$7208=t0$7202[1]);acc$7170.push(x$7207);}else{___match_error(m$7197,"/home/olivier/git/eg/src/location.eg",5280,5308);}}})()))),acc$7170)));(src$7158=loc$7157.source);(t0$7228=loc$7157.linerange());if(((t0$7228 instanceof Array)&&(((t1$7229=t0$7228.length)),(t1$7229===2)))){(l1$7159=t0$7228[0]);(l2$7160=t0$7228[1]);}else{___match_error(loc$7157.linerange(),"/home/olivier/git/eg/src/location.eg",5344,5359);}(first$7161=Math.max(1,(l1$7159-context$7144)));(last$7162=Math.min(src$7158.nlines,(l2$7160+context$7144)));return Node(["div",".location"],({}),[Node(["div",".source"],({}),[Node([".sourcefile"],({}),(src$7158.url||"???")),(((acc$7253=[])),(((temp$7259=locations$7143)),((($length$7265=temp$7259.length)),((($index$7271=0)),(function(){$7248:for(;($index$7271<$length$7265);($index$7271++)){var loc$7290;var cls$7291;var t0$7285;var t1$7286;var m$7280;(m$7280=temp$7259[$index$7271]);(t0$7285=m$7280);if(((t0$7285 instanceof Array)&&(((t1$7286=t0$7285.length)),(t1$7286===2)))){(loc$7290=t0$7285[0]);(cls$7291=t0$7285[1]);acc$7253.push(Node([("."+cls$7291),".sourcepos"],({}),loc$7290.ref()));}else{___match_error(m$7280,"/home/olivier/git/eg/src/location.eg",5528,5674);}}})()))),acc$7253)]),src$7158.highlight_lines(first$7161,last$7162,(((acc$7311=[])),(((temp$7317=locations$7143)),((($length$7323=temp$7317.length)),((($index$7329=0)),(function(){$7306:for(;($index$7329<$length$7323);($index$7329++)){var loc$7348;var cls$7349;var t0$7343;var t1$7344;var m$7338;(m$7338=temp$7317[$index$7329]);(t0$7343=m$7338);if(((t0$7343 instanceof Array)&&(((t1$7344=t0$7343.length)),(t1$7344===2)))){(loc$7348=t0$7343[0]);(cls$7349=t0$7343[1]);acc$7311.push([loc$7348.start,loc$7348.end,[cls$7349]]);}else{___match_error(m$7338,"/home/olivier/git/eg/src/location.eg",5729,5785);}}})()))),acc$7311))]);}else{___match_error($7130$7134);}}));(merge_locations$5658=(function($7370$7373){var $index$7445;var $length$7439;var temp$7433;var acc$7427;var $index$7491;var $length$7485;var temp$7479;var acc$7473;var start$7418;var end$7419;var locs$7412;var loc$7407;var $7379$7394;var $7380$7395;var t0$7392;var $7375$7387;var ph$7381;(ph$7381=$7370$7373);($7375$7387=ph$7381);if((($7379$7394=($7375$7387 instanceof Array))&&(((t0$7392=$7375$7387.length)),(t0$7392===0)))){return Location$5651(null,0,0);}else{if(($7379$7394&&(t0$7392===1))){(loc$7407=$7375$7387[0]);return loc$7407;}else{if(($7379$7394&&(t0$7392>=0))){(locs$7412=Array.prototype.slice.call($7375$7387,0));(start$7418=$7847(Math.min,(((acc$7427=[])),(((temp$7433=locs$7412)),((($length$7439=temp$7433.length)),((($index$7445=0)),(function(){$7422:for(;($index$7445<$length$7439);($index$7445++)){var loc$7462;var m$7454;(m$7454=temp$7433[$index$7445]);(loc$7462=m$7454);acc$7427.push(loc$7462.start);}})()))),acc$7427)));(end$7419=$7847(Math.max,(((acc$7473=[])),(((temp$7479=locs$7412)),((($length$7485=temp$7479.length)),((($index$7491=0)),(function(){$7468:for(;($index$7491<$length$7485);($index$7491++)){var loc$7508;var m$7500;(m$7500=temp$7479[$index$7491]);(loc$7508=m$7500);acc$7473.push(loc$7508.end);}})()))),acc$7473)));return Location$5651(locs$7412[0].source,start$7418,end$7419);}else{___match_error($7375$7387);}}}}));(__lt____lt____colon__$5659=(function(x$7519,y$7520){if((!getChecker(Location$5651)(x$7519.location))){(x$7519["location"]=(function(){if(((!y$7520)||getChecker(Location$5651)(y$7520))){return y$7520;}else{return y$7520.location;}})());}return x$7519;}));(__plus____plus____colon__$5660=(function(x$7533,y$7534){var rval$7551;var x2$7539;var y2$7540;(x2$7539=(function(){if(((!x$7533)||getChecker(Location$5651)(x$7533))){return x$7533;}else{return x$7533.location;}})());(y2$7540=(function(){if(((!y$7534)||getChecker(Location$5651)(y$7534))){return y$7534;}else{return y$7534.location;}})());(rval$7551=false);try{(rval$7551=merge_locations$5658([x2$7539,y2$7540]));}catch(excv$7562){var e$7568;(e$7568=excv$7562);(rval$7551=(void 0));}return rval$7551;}));(format_error$5661=(function(){var $index$7684;var $length$7678;var temp$7672;var acc$7666;var hls$7654;var locs$7655;var rval$7766;var loc$7792;var data$7759;var other$7798;var url$7747;var start$7748;var end$7749;var loc$7737;var args$7634;var fmt_args$7624;var $7586$7619;var $7587$7620;var $7588$7621;var t0$7615;var t1$7616;var t2$7617;var e$7601;var context$7602;var $7581$7603;var t0$7596;var t1$7597;var $7579$7591;($7579$7591=arguments);(t0$7596=$7579$7591.length);if(((t0$7596>=1)&&(t0$7596<=2))){(t1$7597=$7579$7591[0]);(e$7601=t1$7597);($7581$7603=t1$7597);(context$7602=(function(){if((1>=t0$7596)){return 0;}else{return $7579$7591[1];}})());(fmt_args$7624=(function(e$7629){if((e$7629.args&&e$7629.args.length)){return Node([".error_args"],({}),repr$5648(e$7629.args));}else{return "";}}));(t0$7615=$7581$7603);if((getChecker(ErrorFactory(["syntax"]))(t0$7615)&&(___hasprop(t0$7615,"args")&&(((t1$7616=t0$7615.args)),((t1$7616 instanceof Array)&&(((t2$7617=t1$7616.length)),(t2$7617===1))))))){(args$7634=t1$7616[0]);(hls$7654=["hl1","hl2","hl3","hl4"]);(locs$7655=(((acc$7666=[])),(((temp$7672=enumerate(items(args$7634)))),((($length$7678=temp$7672.length)),((($index$7684=0)),(function(){$7661:for(;($index$7684<$length$7678);($index$7684++)){var i$7705;var key$7706;var arg$7707;var t0$7698;var t1$7699;var t2$7700;var t3$7701;var m$7693;(m$7693=temp$7672[$index$7684]);(t0$7698=m$7693);if(((t0$7698 instanceof Array)&&(((t1$7699=t0$7698.length)),((t1$7699===2)&&((i$7705=t0$7698[0]),(((t2$7700=t0$7698[1])),((t2$7700 instanceof Array)&&(((t3$7701=t2$7700.length)),((t3$7701===2)&&((key$7706=t2$7700[0]),((arg$7707=t2$7700[1]),(arg$7707&&arg$7707.location)))))))))))){acc$7666.push([arg$7707.location,$7847(hls$7654,(i$7705%4))]);}else{false;}}})()))),acc$7666));return Node(["div"],({}),[Node([".error"],({}),[Node([".error_type"],({}),e$7601.name),Node([".error_message"],({}),e$7601.message)]),Node([".error_args",".syntax"],({}),repr$5648(args$7634)),highlight_locations$5656(locs$7655,context$7602)]);}else{if((($7587$7620=___hasprop(t0$7615,"location"))&&(((t1$7616=t0$7615.location)),getChecker(Location$5651)(t1$7616)))){(loc$7737=t1$7616);return Node(["div"],({}),[Node([".error"],({}),[Node([".error_type"],({}),e$7601.name),Node([".error_message"],({}),e$7601.message)]),fmt_args$7624(e$7601),highlight_locations$5656([[loc$7737,"hl1"]],context$7602),Node([".traceback"],({}),(e$7601.stack||""))]);}else{if(($7587$7620&&((t1$7616 instanceof Array)&&(((t2$7617=t1$7616.length)),((t2$7617===4)&&(t1$7616[0]==="location")))))){(url$7747=t1$7616[1]);(start$7748=t1$7616[2]);(end$7749=t1$7616[3]);(data$7759=(((rval$7766=false)),((function(){try{(rval$7766=fs$5649.readFileSync(url$7747,"utf8"));}catch(excv$7777){var e$7783;(e$7783=excv$7777);(rval$7766=null);}})(),rval$7766)));if(data$7759){(loc$7792=Location$5651(Source$5650(data$7759,url$7747),start$7748,end$7749));return Node(["div"],({}),[Node([".error"],({}),[Node([".error_type"],({}),e$7601.name),Node([".error_message"],({}),e$7601.message)]),fmt_args$7624(e$7601),highlight_locations$5656([[loc$7792,"hl1"]],context$7602),Node([".traceback"],({}),(Node([],({}),e$7601.stack)||""))]);}else{return Node(["div"],({}),[Node([".error"],({}),[Node([".error_type"],({}),e$7601.name),Node([".error_message"],({}),e$7601.message)]),fmt_args$7624(e$7601),Node([".traceback"],({}),(Node([],({}),e$7601.stack)||e$7601))]);}}else{(other$7798=$7581$7603);return Node(["div"],({}),[Node([".error"],({}),[Node([".error_type"],({}),e$7601.name),Node([".error_message"],({}),e$7601.message)]),fmt_args$7624(e$7601),Node([".traceback"],({}),Node([],({}),e$7601.stack))]);}}}}else{___match_error($7579$7591);}}));(display_error$5662=(function(e$7807){return __lt____gt__$5647(null,format_error$5661(e$7807));}));(exports["Source"]=Source$5650);(exports["Location"]=Location$5651);(exports["highlight"]=highlight$5652);(exports["highlight_locations"]=highlight_locations$5656);(exports["merge_locations"]=merge_locations$5658);(exports["<<:"]=__lt____lt____colon__$5659);(exports["++:"]=__plus____plus____colon__$5660);(exports["format_error"]=format_error$5661);(exports["display_error"]=display_error$5662);
