var augment=function(dest,values){for(k in values){(dest[k]=send(values,k));}return dest;};var escape_html=function(s){var repl=({"&":"&amp;","<":"&lt;",">":"&gt;"});return s.replace(RegExp("[&<>]","g"),function(x){return send(repl,x);});};var quotify=function(s){return s.replace(RegExp("[\"\\\\]","g"),function(x){return ("\\"+x);});};var create_node=function(tag,id,classes,kv,τ550){var τp0;var contents;if((((τp0=projector(Array)(τ550)),τp0[0])&&((contents=τp0[1]),true))){false;}else{throw "a condition failed";}(classes=function(){var τ551=[];var τ552=classes;var τ553=τ552.length;for(var τ554=0;(τ554<τ553);(τ554++)){var τ555=τ552[τ554];var x;var other;if((checker(RegExp("(?:.+)",""))(τ555)&&((x=τ555),true))){τ551.push(x);}else{if(((other=τ555),true)){false;}else{throw ["Could not find a match",τ555];}}}return τ551;}());var accum=["<",tag];if(id){(accum=accum.concat(" id=\"",id,"\""));}else{false;}if(classes.length){(accum=accum.concat(" class=\"",classes.join(" "),"\""));}else{false;}if(kv){var τ556=[];var τ557=kv;var τ558=τ557.length;for(var τ559=0;(τ559<τ558);(τ559++)){var τ560=τ557[τ559];var τp0;var k;var v;var other;if(((τ560 instanceof Array)&&((τ560["#"]===undefined)&&(((τp0=τ560.length),true)&&((τp0===2)&&((k=τ560[0]),true,(v=τ560[1]),true)))))){τ556.push((accum=accum.concat([" ",k,"=\"",v,"\""])));}else{if(((other=τ560),true)){false;}else{throw ["Could not find a match",τ560];}}}τ556;}else{false;}var x=patch_array([">"],contents,["</",tag,">"]);return accum.concat(x).join("");};var patch_array=function(){var r=[];for(var i=0;(i<arguments.length);(i++)){(r=r.concat(arguments[i]));}return r;};var range=function(from,to){var rval=[];for(var i=from;(i<=to);(i++)){rval.push(i);}return rval;};var StructFactory=function(name){var make=function(){var r=Array.prototype.slice.call(arguments,0);(r["#"]=name);return r;};(make[":::project"]=function(value){if(((value instanceof Array)&&(value["#"]===name))){return [true,value];}else{if(true){return [true,make(value)];}else{return false;}}});(make["::check"]=function(value){if(((value instanceof Array)&&(value["#"]===name))){return true;}else{if(true){return false;}else{return false;}}});(make[":::deconstruct"]=function(value){if(((value instanceof Array)&&(value["#"]===name))){return [true,value.slice(0)];}else{if(true){return [false,false];}else{return false;}}});(make["___check"]=make["::check"]);(make["___project"]=make[":::project"]);(make["___deconstruct"]=make[":::deconstruct"]);return make;};var Struct=function(name){var r=Array.prototype.slice.call(arguments,1);(r["#"]=name);return r;};(Struct["::check"]=function(value){if((value instanceof Array)){return (value["#"]!==undefined);}else{if(true){return false;}else{return false;}}});(Struct[":::deconstruct"]=function(value){if(((value instanceof Array)&&(value["#"]!==undefined))){return [true,[value["#"]].concat(value.slice(0))];}else{if(true){return [false,null];}else{return false;}}});(Struct["___check"]=Struct["::check"]);(Struct["___deconstruct"]=Struct[":::deconstruct"]);var pr=function(x){var r=repr(x);var pre=(String.fromCharCode(27)+"[?0;7y+h <div class=\"ug\">");var post=("</div>"+String.fromCharCode(7));return console.log(((pre+r)+post));};var repr=function(τ562){var x;var τ561;(x=τ562);true;(τ561=τ562);var τ563=τ561;var τp0;var τp1;var τp2;var tag;var entries;var entries;var other;if((τ563===true)){return create_node("span",null,["special","true"],[],"true");}else{if((τ563===false)){return create_node("span",null,["special","false"],[],"false");}else{if((τ563===null)){return create_node("span",null,["special","nil"],[],"null");}else{if((τ563===(void 0))){return create_node("span",null,["special","nil"],[],"undefined");}else{if((typeof(τ563)==="number")){return create_node("span",null,["num"],[],String(x));}else{if((typeof(τ563)==="string")){return create_node("span",null,["str"],[],x);}else{if((checker(Struct)(τ563)&&(((τp0=deconstructor(Struct)(τ563)),τp0[0])&&(((τp1=τp0[1]),(τp1 instanceof Array))&&((τp1["#"]===undefined)&&(((τp2=τp1.length),true)&&((τp2>=1)&&((tag=τp1[0]),true,(entries=τp1.slice(1)),true)))))))){return create_node("span",null,["struct"],[],[create_node("span",null,["sym"],[],tag),create_node("span",null,["sequence"],[],entries.map(repr))]);}else{if((checker(Array)(τ563)&&((entries=τ563),true))){return create_node("span",null,["sequence"],[],entries.map(repr));}else{if(((other=τ563),true)){return create_node("span",null,["unknown"],[],other.toString());}else{throw ["Could not find a match",τ563];}}}}}}}}}};var send=function(obj,msg){var τ564=msg;var other;if(((typeof(τ564)==="string")||(typeof(τ564)==="number"))){return obj[msg];}else{if(((other=τ564),true)){return obj.___send(msg);}else{throw ["Could not find a match",τ564];}}};(Function.prototype["___send"]=function(args){return this.apply(this,args);});var checker=function(type){var τ565=type["::check"];var f;if((τ565===(void 0))){return function(value){return (value instanceof type);};}else{if(((f=τ565),true)){return function(value){return f.call(type,value);};}else{throw ["Could not find a match",τ565];}}};var projector=function(type){return function(value){var τ566=type[":::project"];var f;if((τ566===(void 0))){var τ567=type["::project"];var f;if((τ567===(void 0))){return [true,type(value)];}else{if(((f=τ567),true)){var τ569;try{(τ569=[true,f(value)]);}catch(τ568){(τ569=[false,null]);}return τ569;}else{throw ["Could not find a match",τ567];}}}else{if(((f=τ566),true)){return f.call(type,value);}else{throw ["Could not find a match",τ566];}}};};var deconstructor=function(type){return function(value){var τ570=type[":::deconstruct"];var f;if((τ570===(void 0))){var τ571=type["::deconstruct"];var f;if((τ571===(void 0))){if((value instanceof Array)){return [true,value];}else{if(true){return [false,null];}else{return false;}}}else{if(((f=τ571),true)){var τ573;try{(τ573=[true,f.call(this,value)]);}catch(τ572){(τ573=[false,null]);}return τ573;}else{throw ["Could not find a match",τ571];}}}else{if(((f=τ570),true)){return f.call(this,value);}else{throw ["Could not find a match",τ570];}}};};(Array[":::project"]=function(value){var τ574=value;if(checker(Array)(τ574)){return [true,value];}else{if(true){return [true,[value]];}else{throw ["Could not find a match",τ574];}}});(Array["___project"]=Array[":::project"]);(RegExp.prototype["::check"]=function(value){return value.match(this);});(RegExp.prototype[":::project"]=function(value){var τ575=value.match(this);var m;var m;if(((τ575===null)&&((m=τ575),true))){return [false,null];}else{if(((m=τ575),true)){return [true,m];}else{throw ["Could not find a match",τ575];}}});(RegExp.prototype["___check"]=RegExp.prototype["::check"]);(RegExp.prototype["___project"]=RegExp.prototype[":::project"]);
