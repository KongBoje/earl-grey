var send=function(obj,msg){var __t111=msg;var other;if(((typeof(__t111)==="string")||(typeof(__t111)==="number"))){return obj[msg];}else{if(((other=__t111),true)){return obj["::send"](msg);}else{throw ["Could not find a match",__t111];}}};(Function.prototype["::send"]=function(args){return this.apply(this,args);});var augment=function(dest,values){for(k in values){(dest[k]=send(values,k));}return dest;};var patch_array=function(){var r=[];for(var i=0;(i<arguments.length);(i++)){(r=r.concat(arguments[i]));}return r;};var range=function(from,to){var rval=[];for(var i=from;(i<=to);(i++)){rval.push(i);}return rval;};var StructFactory=function(name){var make=function(){var r=Array.prototype.slice.call(arguments,0);(r["#"]=name);return r;};(make[":::project"]=function(value){if(((value instanceof Array)&&(value["#"]===name))){return [true,value];}else{if(true){return [true,make(value)];}else{return false;}}});(make["::check"]=function(value){if(((value instanceof Array)&&(value["#"]===name))){return true;}else{if(true){return false;}else{return false;}}});(make[":::deconstruct"]=function(value){if(((value instanceof Array)&&(value["#"]===name))){return [true,value.slice(0)];}else{if(true){return [false,false];}else{return false;}}});return make;};var Struct=function(name){var r=Array.prototype.slice.call(arguments,1);(r["#"]=name);return r;};(Struct["::check"]=function(value){if((value instanceof Array)){return (value["#"]!==undefined);}else{if(true){return false;}else{return false;}}});(Struct[":::deconstruct"]=function(value){if(((value instanceof Array)&&(value["#"]!==undefined))){return [true,[value["#"]].concat(value.slice(0))];}else{if(true){return [false,null];}else{return false;}}});var pr_terminus=function(node){var r=HTML(node,"span");var pre=(String.fromCharCode(27)+"[?0;7y+h <div class=\"ug\">");var post=("</div>"+String.fromCharCode(7));return console.log(((pre+r)+post));};var pr=function(__t112,r){var __t113=__t112;var n;var x;if((___checker(Node)(__t113)&&((n=__t113),true))){return pr_terminus(n);}else{if(((x=__t113),true)){return pr_terminus((r||repr)(x));}else{throw ["Could not find a match",__t113];}}};var repr=function(__t115,__t116){var x;var __t114;(x=__t115);true;(__t114=__t115);var recur;var recur;if(((___checker(Function)(__t116)&&((recur=__t116),true))||((recur=repr),true))){(void 0);}else{throw "a condition failed";}var __t117=__t114;var __tp0;var __tp1;var __tp2;var tag;var entries;var entries;var other;if((__t117===true)){return Node(["special","true"],"true");}else{if((__t117===false)){return Node(["special","false"],"false");}else{if((__t117===null)){return Node(["special","nil"],"null");}else{if((__t117===(void 0))){return Node(["special","nil"],"undefined");}else{if((typeof(__t117)==="number")){return Node(["num"],String(x));}else{if((typeof(__t117)==="string")){return Node(["str"],x);}else{if((___checker(Struct)(__t117)&&(((__tp0=___deconstructor(Struct)(__t117)),__tp0[0])&&(((__tp1=__tp0[1]),true,(__tp2=__tp1.length),true)&&((__tp2>=1)&&((tag=__tp1[0]),true,(entries=__tp1.slice(1)),true)))))){return Node(["struct"],[Node(["sym"],tag),Node(["sequence"],function(){var __t118=[];var __t119=entries;var __t120=__t119.length;for(var __t121=0;(__t121<__t120);(__t121++)){var __t122=__t119[__t121];var x;var other;if(((x=__t122),true)){__t118.push(recur(x,repr));}else{if(((other=__t122),true)){false;}else{throw ["Could not find a match",__t122];}}}return __t118;}())]);}else{if((___checker(Array)(__t117)&&((entries=__t117),true))){return Node(["sequence"],function(){var __t123=[];var __t124=entries;var __t125=__t124.length;for(var __t126=0;(__t126<__t125);(__t126++)){var __t127=__t124[__t126];var x;var other;if(((x=__t127),true)){__t123.push(recur(x,repr));}else{if(((other=__t127),true)){false;}else{throw ["Could not find a match",__t127];}}}return __t123;}());}else{if(x["::repr"]){return x["::repr"](recur);}else{if((Object.getPrototypeOf(x)===Object.prototype)){return Node(["table"],function(){var __t128=[];var __t129=items(x);var __t130=__t129.length;for(var __t131=0;(__t131<__t130);(__t131++)){var __t132=__t129[__t131];var __tp0;var k;var v;var other;if(((__t132 instanceof Array)&&((__t132["#"]===undefined)&&(((__tp0=__t132.length),true)&&((__tp0===2)&&((k=__t132[0]),true,(v=__t132[1]),true)))))){__t128.push(Node(["pairing"],[recur(k,repr),recur(v,repr)]));}else{if(((other=__t132),true)){false;}else{throw ["Could not find a match",__t132];}}}return __t128;}());}else{if(((other=__t117),true)){return Node(["unknown"],other.toString());}else{throw ["Could not find a match",__t117];}}}}}}}}}}}};var ___checker=function(type){var __t133=type["::check"];var f;if((__t133===(void 0))){return function(value){return (value instanceof type);};}else{if(((f=__t133),true)){return function(value){return f.call(type,value);};}else{throw ["Could not find a match",__t133];}}};var checker=___checker;var ___projector=function(type){return function(value){var __t134=type[":::project"];var f;if((__t134===(void 0))){var __t135=type["::project"];var f;if((__t135===(void 0))){return [true,type(value)];}else{if(((f=__t135),true)){var __t137;try{(__t137=[true,f(value)]);}catch(__t136){(__t137=[false,null]);}return __t137;}else{throw ["Could not find a match",__t135];}}}else{if(((f=__t134),true)){return f.call(type,value);}else{throw ["Could not find a match",__t134];}}};};var projector=___projector;var ___deconstructor=function(type){return function(value){var __t138=type[":::deconstruct"];var f;if((__t138===(void 0))){var __t139=type["::deconstruct"];var f;if((__t139===(void 0))){if((value instanceof Array)){return [true,value];}else{if(true){return [false,null];}else{return false;}}}else{if(((f=__t139),true)){var __t141;try{(__t141=[true,f.call(type,value)]);}catch(__t140){(__t141=[false,null]);}return __t141;}else{throw ["Could not find a match",__t139];}}}else{if(((f=__t138),true)){return f.call(type,value);}else{throw ["Could not find a match",__t138];}}};};var deconstructor=___deconstructor;(Array[":::project"]=function(value){var __t142=value;var _;if(___checker(Array)(__t142)){return [true,value];}else{if(((_=__t142),true)){return [true,[value]];}else{throw ["Could not find a match",__t142];}}});(RegExp.prototype["::check"]=function(value){return value.match(this);});(RegExp.prototype[":::project"]=function(value){var __t143=value.match(this);var m;var m;if(((__t143===null)&&((m=__t143),true))){return [false,null];}else{if(((m=__t143),true)){return [true,m];}else{throw ["Could not find a match",__t143];}}});(RegExp.prototype[":::deconstruct"]=function(value){var __t144=value.match(this);var m;var m;if(((__t144===null)&&((m=__t144),true))){return [false,null];}else{if(((m=__t144),true)){return [true,m];}else{throw ["Could not find a match",__t144];}}});var Node=function(__t99,__t100){var __tp0;var classes;if((((__tp0=___projector(Array)(__t99)),__tp0[0])&&((classes=__tp0[1]),true))){(void 0);}else{throw "a condition failed";}var __tp0;var children;if((((__tp0=___projector(Array)(__t100)),__tp0[0])&&((children=__tp0[1]),true))){(void 0);}else{throw "a condition failed";}var __t98=function(){if((!___checker(Node)(this))){return Object.create(Node.prototype);}else{return this;}}();(__t98["classes"]=classes.sort());(__t98["children"]=children);return __t98;};augment(Node,({"::check":function(x){return ((x&&x.classes)&&x.children);},"::deconstruct":function(x){return [x.classes,x.children];}}));(Node.prototype["::check"]=function(n){var __t98=this;var __t101=__t98.classes;var __t102=__t101.length;for(var __t103=0;(__t103<__t102);(__t103++)){var __t104=__t101[__t103];var c;var other;if(((c=__t104),true,(n.classes.indexOf(c)===(-1)))){return false;}else{if(((other=__t104),true)){false;}else{throw ["Could not find a match",__t104];}}}false;return true;});Node;var escape_html=function(__t145){var __tp0;var s;if((((__tp0=[true,String(__t145)]),__tp0[0])&&((s=__tp0[1]),true))){(void 0);}else{throw "a condition failed";}var repl=({"&":"&amp;","<":"&lt;",">":"&gt;"});return s.replace(RegExp("[&<>]","g"),function(x){return send(repl,x);});};var quotify=function(__t146){var __tp0;var s;if((((__tp0=[true,String(__t146)]),__tp0[0])&&((s=__tp0[1]),true))){(void 0);}else{throw "a condition failed";}return s.replace(RegExp("[\"\\\\]","g"),function(x){return ("\\"+x);});};var HTML=function(__t147,default_tag){var __t148=__t147;var s;var children;var __tp0;var __tp1;var __tp2;var tags;var children;var other;if(((typeof(__t148)==="string")&&((s=__t148),true))){return escape_html(s);}else{if((___checker(Array)(__t148)&&((children=__t148),true))){return function(){var __t149=[];var __t150=children;var __t151=__t150.length;for(var __t152=0;(__t152<__t151);(__t152++)){var __t153=__t150[__t152];var child;var other;if(((child=__t153),true)){__t149.push(HTML(child,default_tag));}else{if(((other=__t153),true)){false;}else{throw ["Could not find a match",__t153];}}}return __t149;}().join("");}else{if((___checker(Node)(__t148)&&(((__tp0=___deconstructor(Node)(__t148)),__tp0[0])&&(((__tp1=__tp0[1]),true,(__tp2=__tp1.length),true)&&((__tp2===2)&&((tags=__tp1[0]),true,(children=__tp1[1]),true)))))){var tag=(default_tag||"span");var classes=[];var id=null;var kv=[];var sub=[];var __t154=tags;var __t155=__t154.length;for(var __t156=0;(__t156<__t155);(__t156++)){var __t158=__t154[__t156];var __tp0;var __tp1;var __tp2;var k;var v;var __tp0;var __tp1;var __tp2;var k;var __tp0;var __tp1;var __tp2;var _;var m;var __tp0;var __tp1;var __tp2;var _;var m;var s;var other;var __t159=false;var __t160=false;var __t161=false;if(((__t159=(__t158["#"]==="assoc"))&&((__t160=((__tp0=[true,__t158]),__tp0[0]))&&((__t161=((__tp1=__tp0[1]),true,(__tp2=__tp1.length),true))&&((__tp2===2)&&((k=__tp1[0]),true,(v=__tp1[1]),true)))))){kv.push([k,v]);}else{if((__t161&&((__tp2===1)&&((k=__tp1[0]),true)))){kv.push([k,undefined]);}else{if((___checker(RegExp("(?:^\\+((?:.*)))",""))(__t158)&&(((__tp0=___deconstructor(RegExp("(?:^\\+((?:.*)))",""))(__t158)),__tp0[0])&&(((__tp1=__tp0[1]),true,(__tp2=__tp1.length),true)&&((__tp2===2)&&((_=__tp1[0]),true,(m=__tp1[1]),true)))))){(tag=m);}else{if((___checker(RegExp("(?:^#((?:.*)))",""))(__t158)&&(((__tp0=___deconstructor(RegExp("(?:^#((?:.*)))",""))(__t158)),__tp0[0])&&(((__tp1=__tp0[1]),true,(__tp2=__tp1.length),true)&&((__tp2===2)&&((_=__tp1[0]),true,(m=__tp1[1]),true)))))){(id=m);}else{if(((typeof(__t158)==="string")&&((s=__t158),true))){classes.push(s);}else{if(((other=__t158),true)){false;}else{throw ["Could not find a match",__t158];}}}}}}}false;var accum=function(){if((tag==="raw")){return [];}else{return ["<",tag];}}();if(id){(accum=accum.concat(" id=\"",id,"\""));}else{false;}if(classes.length){(accum=accum.concat(" class=\"",quotify(classes.join(" ")),"\""));}else{false;}if(kv){var __t162=[];var __t163=kv;var __t164=__t163.length;for(var __t165=0;(__t165<__t164);(__t165++)){var __t166=__t163[__t165];var __tp0;var k;var v;var other;if(((__t166 instanceof Array)&&((__t166["#"]===undefined)&&(((__tp0=__t166.length),true)&&((__tp0===2)&&((k=__t166[0]),true,(v=__t166[1]),true)))))){__t162.push((accum=accum.concat(function(){if((v!==null)){return [" ",k,"=\"",quotify(v),"\""];}else{return [" ",k];}}())));}else{if(((other=__t166),true)){false;}else{throw ["Could not find a match",__t166];}}}__t162;}else{false;}(children=function(){var __t167=tag;var other;if((__t167==="raw")){var __t168=[];var __t169=children;var __t170=__t169.length;for(var __t171=0;(__t171<__t170);(__t171++)){var __t172=__t169[__t171];var s;var c;var other;if(((typeof(__t172)==="string")&&((s=__t172),true))){__t168.push(s);}else{if(((c=__t172),true)){__t168.push(HTML(c,default_tag));}else{if(((other=__t172),true)){false;}else{throw ["Could not find a match",__t172];}}}}return __t168;}else{if(((other=__t167),true)){var __t173=[];var __t174=children;var __t175=__t174.length;for(var __t176=0;(__t176<__t175);(__t176++)){var __t177=__t174[__t176];var c;var other;if(((c=__t177),true)){__t173.push(HTML(c,default_tag));}else{if(((other=__t177),true)){false;}else{throw ["Could not find a match",__t177];}}}return __t173;}else{throw ["Could not find a match",__t167];}}}());var __t157=tag;var other;if((__t157==="raw")){return accum.concat(children).join("");}else{if(((other=__t157),true)){var x=patch_array([">"],children,["</",tag,">"]);return accum.concat(x).join("");}else{throw ["Could not find a match",__t157];}}}else{if(((other=__t148),true)){return HTML([true,String(other)][1],default_tag);}else{throw ["Could not find a match",__t148];}}}}};var ErrorFactory=function(tags){var __t105=function(){if((!___checker(ErrorFactory)(this))){return Object.create(ErrorFactory.prototype);}else{return this;}}();(__t105["tags"]=tags);return __t105;};augment(ErrorFactory,[]);(ErrorFactory.prototype["create"]=function(){var __t106=Array.prototype.slice.call(arguments,0);var __tp0;var message;var args;if(((__t106 instanceof Array)&&((__t106["#"]===undefined)&&(((__tp0=__t106.length),true)&&((__tp0>=0)&&((message=function(){if((0>=__tp0)){return "";}else{return __t106[0];}}()),true,(args=__t106.slice(1)),true)))))){var __t105=this;var e=Error(message);(e["::tags"]=__t105.tags);(e["args"]=args);(e["name"]=["E"].concat(__t105.tags).join("."));return e;}else{throw ["Could not find a match",__t106];}});(ErrorFactory.prototype["::check"]=function(e){var __t105=this;if(((!e)||(!___checker(Error)(e)))){return false;}else{null;}var tags=(e["::tags"]||[]);var __t107=__t105.tags;var __t108=__t107.length;for(var __t109=0;(__t109<__t108);(__t109++)){var __t110=__t107[__t109];var tag;var other;if(((tag=__t110),true,(tags.indexOf(tag)===(-1)))){return false;}else{if(((other=__t110),true)){false;}else{throw ["Could not find a match",__t110];}}}false;return true;});(ErrorFactory.prototype["::deconstruct"]=function(e){var __t105=this;return e.args;});ErrorFactory;
var __t933=require("./helpers");var aslist=__t933.aslist;var js_op_table=({"___plus":"+","___minus":"-","___times":"*","___div":"/","___mod":"%","___binxor":"^","___binand":"&","___binor":"|","___binnot":"~","___and":"&&","___or":"||","___not":"!","___is":"===","___isnt":"!==","___eq":"===","___neq":"!==","___lt":"<","___gt":">","___lte":"<=","___gte":">=","___shl":"<<","___shr":">>","___shr2":">>>","___in":" in ","___instanceof":" instanceof ","___plusplus":"++","___minusminus":"--"});var translate=function(__t935,mode){var expr;var __t934;(expr=__t935);true;(__t934=__t935);var __t936=__t934;var __tp0;var __tp1;var s;var __tp0;var __tp1;var __tp0;var __tp1;var v;var __tp0;var __tp1;var __tp2;var __tp3;var __tp4;var __tp5;var __tp6;var __tp7;var __tp8;var f;var __tp0;var __tp1;var __tp2;var __tp3;var __tp4;var __tp5;var __tp6;var __tp7;var __tp8;var f;var msg;var __tp0;var __tp1;var f;var __tp2;var msg;var __tp3;var __tp4;var s;var __tp0;var __tp1;var f;var __tp2;var __tp3;var __tp4;var args;var __tp0;var __tp1;var f;var msg;var __tp0;var __tp1;var args;var __tp0;var __tp1;var args;var __tp0;var __tp1;var bindings;var body;var __tp0;var __tp1;var test;var pos;var neg;var __tp0;var __tp1;var binding;var __tp2;var __tp3;var __tp4;var __tp5;var __tp0;var __tp1;var binding;var value;var __tp0;var __tp1;var __tp2;var __tp3;var __tp4;var obj;var msg;var rhs;var __tp0;var __tp1;var lhs;var rhs;var __tp0;var __tp1;var args;var __tp0;var __tp1;var args;var __tp0;var __tp1;var value;var __tp0;var __tp1;var __tp0;var __tp1;var __tp0;var __tp1;var value;var __tp0;var __tp1;var value;var __tp0;var __tp1;var value;var __tp0;var __tp1;var test;var body;var __tp0;var __tp1;var x;var y;var z;var body;var __tp0;var __tp1;var x;var y;var body;var __tp0;var __tp1;var attempt;var __tp2;var __tp3;var __tp4;var __tp5;var __tp6;var __tp7;var __tp8;var __tp9;var v;var body;var __tp10;var __tp11;var __tp12;var other;var __t937=false;var __t938=false;var __t939=false;var __t940=false;var __t941=false;var __t942=false;var __t943=false;var __t944=false;var __t945=false;var __t946=false;if(((__t937=(__t936 instanceof Array))&&((__t938=(__t936["#"]===undefined))&&((__t939=((__tp0=__t936.length),true))&&((__tp0===2)&&(((__tp1=__t936[0]),(__tp1==="symbol"))&&((s=__t936[1]),true))))))){return translate.expr(translate.mangle(s),mode);}else{if((__t939&&((__tp0===1)&&((__tp1=__t936[0]),(__tp1==="void"))))){return translate.expr("null",mode);}else{if((__t939&&((__tp0===2)&&(((__tp1=__t936[0]),(__tp1==="value"))&&((v=__t936[1]),true))))){var r=function(){var __t947=v;var other;if((typeof(__t947)==="string")){var repl=({"\"":"\\\"","\n":"\\n","\\":"\\\\"});(v=v.replace(RegExp("((?:(?:\"|\\\\)|\n))","g"),function(m){return send(repl,m);}));return (("\""+v)+"\"");}else{if((__t947===(void 0))){return "(void 0)";}else{if(((((typeof(__t947)==="number")||(__t947===true))||(__t947===false))||(__t947===null))){return String(v);}else{if(((other=__t947),true)){pr(v);throw Error("Unknown value");return (("?!?["+v)+"]?!?");}else{throw ["Could not find a match",__t947];}}}}}();return translate.expr(r,mode);}else{if((__t939&&((__t940=(__tp0===3))&&((__t941=((__tp1=__t936[0]),(__tp1==="send")))&&((__t942=((__tp2=__t936[1]),(__tp2 instanceof Array)))&&((__t943=(__tp2["#"]===undefined))&&((__t944=((__tp3=__tp2.length),true))&&((__t945=(__tp3===2))&&((__t946=((__tp4=__tp2[0]),(__tp4==="symbol")))&&(((__tp5=__tp2[1]),(__tp5==="___node"))&&(((__tp6=__t936[2]),(__tp6 instanceof Array))&&((__tp6["#"]===undefined)&&(((__tp7=__tp6.length),true)&&((__tp7===2)&&(((__tp8=__tp6[0]),(__tp8==="value"))&&((f=__tp6[1]),true)))))))))))))))){return f;}else{if((__t946&&(((__tp5=__tp2[1]),(__tp5==="___js_fetch"))&&(((__tp6=__t936[2]),(__tp6 instanceof Array))&&((__tp6["#"]===undefined)&&(((__tp7=__tp6.length),true)&&((__tp7===3)&&(((__tp8=__tp6[0]),(__tp8==="array"))&&((f=__tp6[1]),true,(msg=__tp6[2]),true))))))))){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{if((__t941&&(((f=__t936[1]),true,(__tp2=__t936[2]),(msg=__tp2),true,(__tp2 instanceof Array))&&((__tp2["#"]===undefined)&&(((__tp3=__tp2.length),true)&&((__tp3===2)&&(((__tp4=__tp2[0]),(__tp4==="value"))&&((s=__tp2[1]),true)))))))){if(((typeof(s)==="string")&&s.match(RegExp("(?:^(?:[a-zA-Z_$]+)$)","")))){var trf=translate(f,"expr");var trmsg=translate(["symbol",s],"expr");return translate.expr(((trf+".")+trmsg),mode);}else{if(true){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{return false;}}}else{if((__t941&&(((f=__t936[1]),true,(__tp2=__t936[2]),(__tp2 instanceof Array))&&((__tp2["#"]===undefined)&&(((__tp3=__tp2.length),true)&&((__tp3>=1)&&(((__tp4=__tp2[0]),(__tp4==="array"))&&((args=__tp2.slice(1)),true)))))))){var op=function(){var __t948=f;var __tp0;var __tp1;var x;var _;if(((__t948 instanceof Array)&&((__t948["#"]===undefined)&&(((__tp0=__t948.length),true)&&((__tp0===2)&&(((__tp1=__t948[0]),(__tp1==="symbol"))&&((x=__t948[1]),true))))))){return send(js_op_table,x);}else{if(((_=__t948),true)){return null;}else{throw ["Could not find a match",__t948];}}}();if(op){return translate.expr(translate.op(op,args[0],args[1]),mode);}else{var trf=translate(f,"expr");var trargs=function(){var __t949=[];var __t950=args;var __t951=__t950.length;for(var __t952=0;(__t952<__t951);(__t952++)){var __t953=__t950[__t952];var x;var other;if(((x=__t953),true)){__t949.push(translate(x,"expr"));}else{if(((other=__t953),true)){false;}else{throw ["Could not find a match",__t953];}}}return __t949;}();return translate.expr((((trf+"(")+trargs.join(","))+")"),mode);}}else{if((__t941&&((f=__t936[1]),true,(msg=__t936[2]),true))){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((("send("+trf)+",")+trmsg)+")"),mode);}else{if((__t939&&((__t940=(__tp0>=1))&&(((__tp1=__t936[0]),(__tp1==="array"))&&((args=__t936.slice(1)),true))))){var r=function(){var f=function(x){return translate(x,"expr");};return (("["+args.map(f).join(","))+"]");}();return translate.expr(r,mode);}else{if((__t940&&(((__tp1=__t936[0]),(__tp1==="object"))&&((args=__t936.slice(1)),true)))){var r=function(){var f=function(__t954){var __tp0;var __tp1;var x;var y;if(((__t954 instanceof Array)&&((__t954["#"]===undefined)&&(((__tp0=__t954.length),true)&&((__tp0===3)&&(((__tp1=__t954[0]),(__tp1==="array"))&&((x=__t954[1]),true,(y=__t954[2]),true))))))){(void 0);}else{throw "a condition failed";}var a=translate(x,"expr");var b=translate(y,"expr");return ((a+":")+b);};return (("({"+args.map(f).join(","))+"})");}();return translate.expr(r,mode);}else{if((__t939&&((__tp0===3)&&(((__tp1=__t936[0]),(__tp1==="lambda"))&&((bindings=__t936[1]),true,(body=__t936[2]),true))))){var a=function(){var __t963=[];var __t964=bindings;var __t965=__t964.length;for(var __t966=0;(__t966<__t965);(__t966++)){var __t967=__t964[__t966];var x;var other;if(((x=__t967),true)){__t963.push(translate(x,"expr"));}else{if(((other=__t967),true)){false;}else{throw ["Could not find a match",__t967];}}}return __t963;}().join(",");var b=translate.body(body,"return");return translate.expr((((("function("+a)+"){")+b)+"}"),mode);}else{if((__t939&&((__tp0===4)&&(((__tp1=__t936[0]),(__tp1==="if"))&&((test=__t936[1]),true,(pos=__t936[2]),true,(neg=__t936[3]),true))))){var __t968=mode;var other;if((__t968==="expr")){return translate.body(expr,"expr");}else{if(((other=__t968),true)){var a=translate(test,"expr");var b=translate(pos,mode);var c=translate(neg,mode);return (((((("if("+a)+"){")+b)+"}else{")+c)+"}");}else{throw ["Could not find a match",__t968];}}}else{if((__t939&&((__t940=(__tp0===3))&&((__t941=((__tp1=__t936[0]),(__tp1==="declare")))&&(((binding=__t936[1]),true,(__tp2=__t936[2]),(__tp2 instanceof Array))&&((__tp2["#"]===undefined)&&(((__tp3=__tp2.length),true)&&((__tp3===2)&&(((__tp4=__tp2[0]),(__tp4==="value"))&&((__tp5=__tp2[1]),(__tp5===(void 0)))))))))))){var __t969=mode;var other;if(((__t969==="expr")||(__t969==="return"))){throw "Invalid in expr ctx";}else{if(((other=__t969),true)){var a=translate(binding,"expr");return (("var "+a)+";");}else{throw ["Could not find a match",__t969];}}}else{if((__t941&&((binding=__t936[1]),true,(value=__t936[2]),true))){var __t970=mode;var other;if(((__t970==="expr")||(__t970==="return"))){throw "Invalid in expr ctx";}else{if(((other=__t970),true)){var a=translate(binding,"expr");var b=translate(value,"expr");return (((("var "+a)+"=")+b)+";");}else{throw ["Could not find a match",__t970];}}}else{if((__t940&&((__t941=((__tp1=__t936[0]),(__tp1==="assign")))&&(((__tp2=__t936[1]),(__tp2 instanceof Array))&&((__tp2["#"]===undefined)&&(((__tp3=__tp2.length),true)&&((__tp3===3)&&(((__tp4=__tp2[0]),(__tp4==="send"))&&((obj=__tp2[1]),true,(msg=__tp2[2]),true,(rhs=__t936[2]),true))))))))){var a=translate(obj,"expr");var b=translate(msg,"expr");var c=translate(rhs,"expr");return translate.expr((((((("("+a)+"[")+b)+"]=")+c)+")"),mode);}else{if((__t941&&((lhs=__t936[1]),true,(rhs=__t936[2]),true))){var a=translate(lhs,"expr");var b=translate(rhs,"expr");return translate.expr((((("("+a)+"=")+b)+")"),mode);}else{if((__t939&&((__t940=(__tp0>=1))&&(((__tp1=__t936[0]),(__tp1==="multi"))&&((args=__t936.slice(1)),true))))){var isdecl=function(__t972){var __t973=__t972;var __tp0;var __tp1;var variable;var value;var other;if(((__t973 instanceof Array)&&((__t973["#"]===undefined)&&(((__tp0=__t973.length),true)&&((__tp0===3)&&(((__tp1=__t973[0]),(__tp1==="declare"))&&((variable=__t973[1]),true,(value=__t973[2]),true))))))){return true;}else{if(((other=__t973),true)){return false;}else{throw ["Could not find a match",__t973];}}};var __t971=null;var _;if((args.length===1)){return translate(args[0],mode);}else{if(((mode==="expr")&&(!args.some(isdecl)))){var xs=function(){var __t974=[];var __t975=args;var __t976=__t975.length;for(var __t977=0;(__t977<__t976);(__t977++)){var __t978=__t975[__t977];var x;var other;if(((x=__t978),true)){__t974.push(translate(x,"expr"));}else{if(((other=__t978),true)){false;}else{throw ["Could not find a match",__t978];}}}return __t974;}();return (("("+xs.join(","))+")");}else{if(((_=__t971),true)){return translate.body(expr,mode);}else{throw ["Could not find a match",__t971];}}}}else{if((__t940&&(((__tp1=__t936[0]),(__tp1==="splice"))&&((args=__t936.slice(1)),true)))){return translate(patch_array(["multi"],args),mode);}else{if((__t939&&((__tp0===2)&&(((__tp1=__t936[0]),(__tp1==="js_new"))&&((value=__t936[1]),true))))){return translate.expr((("(new "+translate(value,"expr"))+")"),mode);}else{if((__t939&&((__t940=(__tp0===1))&&((__tp1=__t936[0]),(__tp1==="js_break"))))){if((mode==="expr")){throw "Invalid break in ctx";}else{return "break;";}}else{if((__t940&&((__tp1=__t936[0]),(__tp1==="js_continue")))){if((mode==="expr")){throw "Invalid continue in ctx";}else{return "continue;";}}else{if((__t939&&((__t940=(__tp0===2))&&(((__tp1=__t936[0]),(__tp1==="js_return"))&&((value=__t936[1]),true))))){if((mode==="expr")){throw "Invalid return in ctx";}else{return (("return "+translate(value,"expr"))+";");}}else{if((__t940&&(((__tp1=__t936[0]),(__tp1==="js_delete"))&&((value=__t936[1]),true)))){if((mode==="expr")){throw "Invalid delete in ctx";}else{return (("delete "+translate(value,"expr"))+";");}}else{if((__t940&&(((__tp1=__t936[0]),(__tp1==="js_throw"))&&((value=__t936[1]),true)))){if((mode==="expr")){return (("function(){throw "+translate(value,"expr"))+";}()");}else{return (("throw "+translate(value,"expr"))+";");}}else{if((__t939&&((__tp0===3)&&(((__tp1=__t936[0]),(__tp1==="js_while"))&&((test=__t936[1]),true,(body=__t936[2]),true))))){var __t979=mode;var other;if((__t979==="expr")){return translate.body(expr,"expr");}else{if(((other=__t979),true)){var a=translate(test,"expr");var b=translate(body,"stmt");return (((("while("+a)+"){")+b)+"}");}else{throw ["Could not find a match",__t979];}}}else{if((__t939&&((__tp0===5)&&(((__tp1=__t936[0]),(__tp1==="js_for"))&&((x=__t936[1]),true,(y=__t936[2]),true,(z=__t936[3]),true,(body=__t936[4]),true))))){var __t980=mode;var other;if((__t980==="expr")){return translate.body(expr,"expr");}else{if(((other=__t980),true)){var a=translate(x,"stmt");var b=translate(y,"stmt");var c=translate(z,"expr");var d=translate(body,"stmt");return (((((("for("+a)+b)+c)+"){")+d)+"}");}else{throw ["Could not find a match",__t980];}}}else{if((__t939&&((__t940=(__tp0===4))&&(((__tp1=__t936[0]),(__tp1==="js_for_in"))&&((x=__t936[1]),true,(y=__t936[2]),true,(body=__t936[3]),true))))){var __t981=mode;var other;if((__t981==="expr")){return translate.body(expr,"expr");}else{if(((other=__t981),true)){var a=translate(x,"expr");var b=translate(y,"expr");var c=translate(body,"stmt");return (((((("for("+a)+" in ")+b)+"){")+c)+"}");}else{throw ["Could not find a match",__t981];}}}else{if((__t940&&(((__tp1=__t936[0]),(__tp1==="js_try"))&&(((attempt=__t936[1]),true,(__tp2=__t936[2]),(__tp2 instanceof Array))&&((__tp2["#"]===undefined)&&(((__tp3=__tp2.length),true)&&((__tp3===3)&&(((__tp4=__tp2[0]),(__tp4==="lambda"))&&(((__tp5=__tp2[1]),(__tp5 instanceof Array))&&((__tp5["#"]===undefined)&&(((__tp6=__tp5.length),true)&&((__tp6===1)&&(((__tp7=__tp5[0]),(__tp7 instanceof Array))&&((__tp7["#"]===undefined)&&(((__tp8=__tp7.length),true)&&((__tp8===2)&&(((__tp9=__tp7[0]),(__tp9==="symbol"))&&(((v=__tp7[1]),true,(body=__tp2[2]),true,(__tp10=__t936[3]),(__tp10 instanceof Array))&&((__tp10["#"]===undefined)&&(((__tp11=__tp10.length),true)&&((__tp11===1)&&((__tp12=__tp10[0]),(__tp12==="void"))))))))))))))))))))))){var __t982=mode;var other;if((__t982==="expr")){return translate.body(expr,"expr");}else{if(((other=__t982),true)){var a=translate(attempt,"stmt");var b=translate(body,"stmt");return (((((("try{"+a)+"}catch(")+v)+"){")+b)+"}");}else{throw ["Could not find a match",__t982];}}}else{if(((other=__t936),true)){throw other;}else{throw ["Could not find a match",__t936];}}}}}}}}}}}}}}}}}}}}}}}}}}}}}};(translate["mangle"]=function(name){var tr=({"+":"__plus__","-":"__minus__","*":"__asterisk__","/":"__slash__","%":"__percent__","^":"__caret__","#":"__hash__","&":"__amp__","|":"__pipe__","@":"__at__","!":"__bang__","?":"__qmark__","=":"__equal__","<":"__lt__",">":"__gt__","~":"__tilde__",".":"__dot__",":":"__colon__"});var r=[];for(var i=0;(i<name.length);(++i)){var c=send(name,i);r.push((send(tr,c)||c));}return r.join("");});(translate["body"]=function(b,mode){(orig=b);(b=aslist(b));var trst=function(stmt){return translate(stmt,"stmt");};var __t983=mode;var other;if((__t983==="expr")){var x=["send",["lambda",[],orig],["array"]];return translate(x,mode);}else{if((__t983==="return")){var stmts=b.slice(0,(-1));var ret=send(b,(b.length-1));return (stmts.map(trst).join("")+translate(ret,"return"));}else{if((__t983==="stmt")){return b.map(trst).join("");}else{if(((other=__t983),true)){throw "OopsH";}else{throw ["Could not find a match",__t983];}}}}});(translate["expr"]=function(x,__t984){var __t985=__t984;var other;if((__t985==="expr")){return x;}else{if((__t985==="stmt")){return (x+";");}else{if((__t985==="return")){return (("return "+x)+";");}else{if(((other=__t985),true)){throw "OopsI";}else{throw ["Could not find a match",__t985];}}}}});(translate["op"]=function(op,a,b){var e=function(){var __t986=[a,b];var __tp0;var __tp1;var __tp2;var __tp3;var _;var __tp0;var _;var __tp1;var __tp2;var __tp3;var _;var __t987=false;var __t988=false;var __t989=false;var __t990=false;if(((__t987=(__t986 instanceof Array))&&((__t988=(__t986["#"]===undefined))&&((__t989=((__tp0=__t986.length),true))&&((__t990=(__tp0===2))&&(((__tp1=__t986[0]),(__tp1 instanceof Array))&&((__tp1["#"]===undefined)&&(((__tp2=__tp1.length),true)&&((__tp2===1)&&(((__tp3=__tp1[0]),(__tp3==="void"))&&((_=__t986[1]),true))))))))))){return (op+translate(b,"expr"));}else{if((__t990&&(((_=__t986[0]),true,(__tp1=__t986[1]),(__tp1 instanceof Array))&&((__tp1["#"]===undefined)&&(((__tp2=__tp1.length),true)&&((__tp2===1)&&((__tp3=__tp1[0]),(__tp3==="void")))))))){return (translate(a,"expr")+op);}else{if(((_=__t986),true)){return ((translate(a,"expr")+op)+translate(b,"expr"));}else{throw ["Could not find a match",__t986];}}}}();return (("("+e)+")");});(exports["translate"]=translate);
