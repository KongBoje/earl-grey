var $40297=(function(type$40300){var f$40304;(f$40304=type$40300["::check"]);if((f$40304===(void 0))){return (function(value$40310){return (value$40310 instanceof type$40300);});}else{return (function(value$40314){return f$40304.call(type$40300,value$40314);});}});
var $40316=(function(dest$40319,values$40320){var k$40325;(k$40325=null);$40323:for(k$40325 in values$40320){if(values$40320.hasOwnProperty(k$40325)){(dest$40319[k$40325]=values$40320[k$40325]);}}return dest$40319;});
var $40333=(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}});
var $40334=(function($40336$40339){var ph$40345;(ph$40345=$40336$40339);var $40341$40351;($40341$40351=ph$40345);var bridge$40343$40356;var x$40360;(bridge$40343$40356=$40341$40351);if((((typeof(bridge$40343$40356)==="string")&&((x$40360=bridge$40343$40356),true))||((typeof(bridge$40343$40356)==="number")&&((x$40360=bridge$40343$40356),true)))){return ["value",x$40360];}else{var other$40371;(other$40371=$40341$40351);return other$40371["::serialize_ast"]();}});
var $40373=(function(obj$40376){var results$40381;(results$40381=[]);var k$40386;(k$40386=null);$40380:for(k$40386 in obj$40376){if(Object.prototype.hasOwnProperty.call(obj$40376,k$40386)){results$40381.push([k$40386,$40333(obj$40376,k$40386)]);}}return results$40381;});
var $40642=(function(arr$40645){var results$40651;var l$40652;(results$40651=[]);(l$40652=arr$40645.length);var i$40661;(i$40661=0);$40650:for(;(i$40661<l$40652);(i$40661++)){results$40651.push([i$40661,$40333(arr$40645,i$40661)]);}return results$40651;});
var $40409=(function(){var $40410$40416;($40410$40416=(function(tags$40421){var it$0$40424;(it$0$40424=(function(){if((!$40297($40410$40416)(this))){return Object.create($40410$40416.prototype);}else{return this;}})());(it$0$40424["tags"]=tags$40421);return it$0$40424;}));($40410$40416.prototype["create"]=(function(){var it$0$40444;var self$40445;(it$0$40444=this);(self$40445=this);var $40442$40454;($40442$40454=arguments);var t0$40459;var message$40463;var args$40464;(t0$40459=$40442$40454.length);if((t0$40459>=0)){(message$40463=(function(){if((0>=t0$40459)){return "";}else{return $40442$40454[0];}})());(args$40464=Array.prototype.slice.call($40442$40454,1));var e$40477;(e$40477=Error(message$40463));(e$40477["::tags"]=it$0$40444.tags);(e$40477["args"]=args$40464);var temp$40493;(temp$40493=$40642(args$40464));var $length$40499;($length$40499=temp$40493.length);var $index$40505;($index$40505=0);$40478:for(;($index$40505<$length$40499);($index$40505++)){var m$40514;(m$40514=temp$40493[$index$40505]);var t0$40519;var t1$40520;var i$40524;var arg$40525;(t0$40519=m$40514);if(((t0$40519 instanceof Array)&&(((t1$40520=t0$40519.length)),(t1$40520===2)))){(i$40524=t0$40519[0]);(arg$40525=t0$40519[1]);(e$40477[i$40524]=arg$40525);}else{$40390(m$40514);}}(e$40477["length"]=args$40464.length);(e$40477["name"]=["E"].concat(it$0$40444.tags).join("."));return e$40477;}else{$40390($40442$40454);}}));($40410$40416.prototype["::check"]=(function(e$40555){var it$0$40559;var self$40560;(it$0$40559=this);(self$40560=this);var tags$40570;if(((!e$40555)||(!$40297(Error)(e$40555)))){return false;}(tags$40570=(e$40555["::tags"]||[]));var temp$40581;(temp$40581=it$0$40559.tags);var $length$40587;($length$40587=temp$40581.length);var $index$40593;($index$40593=0);$40571:for(;($index$40593<$length$40587);($index$40593++)){var m$40602;(m$40602=temp$40581[$index$40593]);var tag$40610;(tag$40610=m$40602);if((tags$40570.indexOf(tag$40610)===-1)){return false;}else{false;}}return true;}));($40410$40416.prototype["::deconstruct"]=(function(e$40619){var it$0$40623;var self$40624;(it$0$40623=this);(self$40624=this);return e$40619.args;}));$40316($40410$40416,$40316((function(){var accum$40635;(accum$40635=({}));(accum$40635["::name"]="$40410");return accum$40635;})(),(function(){var accum$40639;(accum$40639=({}));(accum$40639["::egclass"]=true);return accum$40639;})()));return $40410$40416;})();
var $40390=(function(value$40393,url$40394,start$40395,end$40396){var err$40400;(err$40400=$40409(["match"]).create("Could not find a match for value",({"value":value$40393})));if(url$40394){(err$40400["location"]=["location",url$40394,start$40395,end$40396]);}throw err$40400;});
var send$39942;var __array_methods$39943;var __re_methods$39944;(send$39942=(function(obj$39957,$39954$39958){var ph$39964;var msg$39965;var t0$39967;(t0$39967=$39954$39958);(msg$39965=t0$39967);(ph$39964=t0$39967);var $39960$39976;($39960$39976=ph$39964);var bridge$39962$39981;(bridge$39962$39981=$39960$39976);if(((typeof(bridge$39962$39981)==="string")||(typeof(bridge$39962$39981)==="number"))){return obj$39957[msg$39965];}else{var other$39993;(other$39993=$39960$39976);return obj$39957["::send"](msg$39965);}}));(Array[":::project"]=(function($39999$40002){var ph$40007;var value$40008;var t0$40010;(t0$40010=$39999$40002);(value$40008=t0$40010);(ph$40007=t0$40010);var $40004$40019;($40004$40019=ph$40007);if($40297(Array)($40004$40019)){return [true,value$40008];}else{$40004$40019;return [true,[value$40008]];}}));(__array_methods$39943=$40316((function(){var accum$40040;(accum$40040=({}));(accum$40040["::check"]=(function(value$40045){if((value$40045 instanceof Array)){var i$40051;(i$40051=0);$40048:for(;(i$40051<this.length);(i$40051++)){if(($40333(this,i$40051)!==$40333(value$40045,i$40051))){return false;}}return true;}else{return false;}}));return accum$40040;})(),$40316((function(){var accum$40060;(accum$40060=({}));(accum$40060["::clone"]=(function(){return $40316(this.slice(0),this);}));return accum$40060;})(),$40316((function(){var accum$40067;(accum$40067=({}));(accum$40067[":::project"]=(function(value$40072){if((value$40072 instanceof Array)){var i$40078;(i$40078=0);$40075:for(;(i$40078<this.length);(i$40078++)){if(($40333(this,i$40078)!==$40333(value$40072,i$40078))){return [true,this.concat([value$40072])];}}return [true,value$40072];}else{return [true,this.concat([value$40072])];}}));return accum$40067;})(),(function(){var accum$40087;(accum$40087=({}));(accum$40087["::serialize_ast"]=(function(){return ["array"].concat(this.map($40334));}));return accum$40087;})()))));var temp$40097;(temp$40097=$40373(__array_methods$39943));var $length$40103;($length$40103=temp$40097.length);var $index$40109;($index$40109=0);$39945:for(;($index$40109<$length$40103);($index$40109++)){var m$40118;(m$40118=temp$40097[$index$40109]);var t0$40123;var t1$40124;var k$40128;var v$40129;(t0$40123=m$40118);if(((t0$40123 instanceof Array)&&(((t1$40124=t0$40123.length)),(t1$40124===2)))){(k$40128=t0$40123[0]);(v$40129=t0$40123[1]);if((!$40333(Array.prototype,k$40128))){Object.defineProperty(Array.prototype,k$40128,({"enumerable":false,"value":v$40129}));}}else{$40390(m$40118);}}(__re_methods$39944=$40316((function(){var accum$40149;(accum$40149=({}));(accum$40149["::check"]=(function($40153$40156){var ph$40161;(ph$40161=$40153$40156);var $40158$40167;($40158$40167=ph$40161);var value$40175;if((typeof($40158$40167)==="string")){(value$40175=$40158$40167);if(value$40175.match(this)){return true;}else{return false;}}else{var other$40180;(other$40180=$40158$40167);return false;}}));return accum$40149;})(),(function(){var accum$40183;(accum$40183=({}));(accum$40183[":::project"]=(function($40187$40190){var ph$40195;(ph$40195=$40187$40190);var $40192$40201;($40192$40201=ph$40195);var value$40209;if((typeof($40192$40201)==="string")){(value$40209=$40192$40201);var $40212$40217;($40212$40217=value$40209.match(this));var m$40225;if(($40212$40217===null)){(m$40225=$40212$40217);return [false,null];}else{var m$40230;(m$40230=$40212$40217);return [true,m$40230];}}else{var other$40234;(other$40234=$40192$40201);return [false,null];}}));return accum$40183;})()));var temp$40240;(temp$40240=$40373(__re_methods$39944));var $length$40246;($length$40246=temp$40240.length);var $index$40252;($index$40252=0);$39948:for(;($index$40252<$length$40246);($index$40252++)){var m$40261;(m$40261=temp$40240[$index$40252]);var t0$40266;var t1$40267;var k$40271;var v$40272;(t0$40266=m$40261);if(((t0$40266 instanceof Array)&&(((t1$40267=t0$40266.length)),(t1$40267===2)))){(k$40271=t0$40266[0]);(v$40272=t0$40266[1]);if((!$40333(RegExp.prototype,k$40271))){Object.defineProperty(RegExp.prototype,k$40271,({"enumerable":false,"value":v$40272}));}}else{$40390(m$40261);}}if((!Function.prototype["::send"])){Object.defineProperty(Function.prototype,"::send",$40316(({"enumerable":false}),(function(){var accum$40290;(accum$40290=({}));(accum$40290["value"]=(function(args$40295){return this.apply(this,args$40295);}));return accum$40290;})()));}
var $42785=(function(type$42788){return (function(value$42792){var f$42796;(f$42796=type$42788[":::project"]);if((f$42796===(void 0))){(f$42796=type$42788["::project"]);if((f$42796===(void 0))){return [true,type$42788(value$42792)];}else{var rval$42809;(rval$42809=false);try{(rval$42809=[true,f$42796(value$42792)]);}catch(excv$42820){var e$42826;(e$42826=excv$42820);(rval$42809=[false,null]);}return rval$42809;}}else{return f$42796.call(type$42788,value$42792);}});});
var $42832=(function($42834$42837,key$42838){var ph$42846;(ph$42846=$42834$42837);var $42840$42852;($42840$42852=ph$42846);var bridge$42842$42857;(bridge$42842$42857=$42840$42852);if(((bridge$42842$42857===null)||(bridge$42842$42857===(void 0)))){return false;}else{var x$42869;if((typeof($42840$42852)==="string")){(x$42869=$42840$42852);return (key$42838 in String.prototype);}else{var x$42874;if((typeof($42840$42852)==="number")){(x$42874=$42840$42852);return (key$42838 in Number.prototype);}else{var x$42879;(x$42879=$42840$42852);return (key$42838 in x$42879);}}}});var accum$42750;var accum$42754;var $40670$40689;var gensym$40690;var Body$40691;var $40671$40692;var __lt____gt__$40693;var js_op_table2$40694;var js_op_table$40695;var Translator$40696;var translate$40697;($40670$40689=require("./util"));(gensym$40690=$40670$40689.gensym);(Body$40691=$40670$40689.Body);($40671$40692=require("./pp"));(__lt____gt__$40693=$40671$40692["<>"]);(js_op_table2$40694=({"+":"+","-":"-","*":"*","/":"/","mod":"%","&.":"&","|.":"|","^.":"^","~":"~","and":"&&","or":"||","not":"!","==":"===","!=":"!==","===":"===","!==":"!==","<":"<",">":">","<=":"<=",">=":">=","<<":"<<",">>":">>",">>>":">>>","in":" in ","instanceof":" instanceof ","++":"++","--":"--"}));(js_op_table$40695=({"___plus":"+","___minus":"-","___times":"*","___div":"/","___mod":"%","___binxor":"^","___binand":"&","___binor":"|","___binnot":"~","___and":"&&","___or":"||","___not":"!","___is":"===","___isnt":"!==","___eq":"===","___neq":"!==","___lt":"<","___gt":">","___lte":"<=","___gte":">=","___shl":"<<","___shr":">>","___shr2":">>>","___in":" in ","___instanceof":" instanceof ","___plusplus":"++","___minusminus":"--"}));(Translator$40696=(function(){var prelude$40743;var t0$40739;var $40730$40734;var it$0$40725;(it$0$40725=(function(){if((!$40297(Translator$40696)(this))){return Object.create(Translator$40696.prototype);}else{return this;}})());($40730$40734=arguments);(t0$40739=$40730$40734.length);if(((t0$40739>=0)&&(t0$40739<=1))){(prelude$40743=(function(){if((0>=t0$40739)){return null;}else{return $40730$40734[0];}})());(it$0$40725["cache"]=({}));(it$0$40725["prepend"]=[]);if(prelude$40743){it$0$40725.prepend.push(it$0$40725.translate($40334(prelude$40743),"stmt"));}}else{$40390($40730$40734);}return it$0$40725;}));(Translator$40696.prototype["register_value"]=(function(v$40767,id$40768){var temp$40799;var name$40808;var $40781$40786;var it$0$40772;var self$40773;(it$0$40772=this);(self$40773=this);($40781$40786=$40333(it$0$40772.cache,id$40768));if(($40781$40786===(void 0))){(temp$40799=["symbol",gensym$40690()]);(it$0$40772.cache[id$40768]=temp$40799);it$0$40772.prepend.push(it$0$40772.translate(["declare",temp$40799,$40334(v$40767)],"stmt"));return temp$40799;}else{(name$40808=$40781$40786);return name$40808;}}));(Translator$40696.prototype["register_raw"]=(function(raw$40814,id$40815){var temp$40846;var name$40855;var $40828$40833;var it$0$40819;var self$40820;(it$0$40819=this);(self$40820=this);($40828$40833=$40333(it$0$40819.cache,id$40815));if(($40828$40833===(void 0))){(temp$40846=["symbol",gensym$40690()]);(it$0$40819.cache[id$40815]=temp$40846);it$0$40819.prepend.push(it$0$40819.translate(["declare",temp$40846,["raw",raw$40814]],"stmt"));return temp$40846;}else{(name$40855=$40828$40833);return name$40855;}}));(Translator$40696.prototype["dump_store"]=(function(){var rval$40876;var it$0$40864;var self$40865;(it$0$40864=this);(self$40865=this);(rval$40876=it$0$40864.prepend.join("\n"));(it$0$40864["prepend"]=[]);return rval$40876;}));(Translator$40696.prototype["mangle"]=(function(name$40887){var i$40914;var tr$40904;var r$40905;var it$0$40891;var self$40892;(it$0$40891=this);(self$40892=this);(tr$40904=({"+":"__plus__","-":"__minus__","*":"__asterisk__","/":"__slash__","%":"__percent__","^":"__caret__","#":"__hash__","&":"__amp__","|":"__pipe__","@":"__at__","!":"__bang__","?":"__qmark__","=":"__equal__","<":"__lt__",">":"__gt__","~":"__tilde__",".":"__dot__",":":"__colon__"}));(r$40905=[]);(i$40914=0);$40903:for(;(i$40914<name$40887.length);(++i$40914)){var c$40923;(c$40923=$40333(name$40887,i$40914));r$40905.push(($40333(tr$40904,c$40923)||c$40923));}return r$40905.join("");}));(Translator$40696.prototype["body"]=(function(orig$40931,mode$40932){var t0$40956;var t1$40957;var t2$40958;var x$40997;var stmts$41008;var ret$41009;var other$41022;var $40948$40985;var b$40953;var trst$40954;var it$0$40936;var self$40937;(it$0$40936=this);(self$40937=this);(t0$40956=$42785(Body$40691)(orig$40931));if((t0$40956[0]&&(((t1$40957=t0$40956[1])),(((t2$40958=t1$40957.length)),(t2$40958>=0))))){(b$40953=Array.prototype.slice.call(t1$40957,0));}else{$40390(orig$40931,"/home/olivier/git/earl-grey/src/translate-js.eg",3075,3079);}(trst$40954=(function(stmt$40980){return it$0$40936.translate(stmt$40980,"stmt");}));($40948$40985=mode$40932);if(($40948$40985==="expr")){(x$40997=["send",["lambda",[],orig$40931],["array"]]);return it$0$40936.translate(x$40997,mode$40932);}else{if(($40948$40985==="return")){(stmts$41008=b$40953.slice(0,-1));(ret$41009=$40333(b$40953,(b$40953.length-1)));return (stmts$41008.map(trst$40954).join("")+it$0$40936.translate(ret$41009,"return"));}else{if(($40948$40985==="stmt")){return b$40953.map(trst$40954).join("");}else{(other$41022=$40948$40985);throw $40409(["syntax","mode"]).create("Unknown mode",({"mode":mode$40932}));}}}}));(Translator$40696.prototype["expr"]=(function(x$41028,mode$41029){var other$41069;var $41042$41049;var it$0$41033;var self$41034;(it$0$41033=this);(self$41034=this);($41042$41049=mode$41029);if(($41042$41049==="expr")){return x$41028;}else{if(($41042$41049==="stmt")){return (x$41028+";");}else{if(($41042$41049==="return")){return (("return "+x$41028)+";");}else{(other$41069=$41042$41049);throw "OopsI";}}}}));(Translator$40696.prototype["op"]=(function(op$41075,a$41076,b$41077){var $41099$41113;var $41100$41114;var $41101$41115;var t0$41109;var t1$41110;var t2$41111;var $41095$41104;var e$41092;var it$0$41081;var self$41082;(it$0$41081=this);(self$41082=this);(e$41092=((($41095$41104=[a$41076,b$41077])),(function(){if((($41099$41113=($41095$41104 instanceof Array))&&(((t0$41109=$41095$41104.length)),(($41101$41115=(t0$41109===2))&&(((t1$41110=$41095$41104[0])),((t1$41110 instanceof Array)&&(((t2$41111=t1$41110.length)),((t2$41111===1)&&(t1$41110[0]==="void"))))))))){$41095$41104[1];return (op$41075+it$0$41081.translate(b$41077,"expr"));}else{if(($41101$41115&&($41095$41104[0],(((t1$41110=$41095$41104[1])),((t1$41110 instanceof Array)&&(((t2$41111=t1$41110.length)),((t2$41111===1)&&(t1$41110[0]==="void")))))))){return (it$0$41081.translate(a$41076,"expr")+op$41075);}else{$41095$41104;return ((it$0$41081.translate(a$41076,"expr")+op$41075)+it$0$41081.translate(b$41077,"expr"));}}})()));return (("("+e$41092)+")");}));(Translator$40696.prototype["translate"]=(function(expr$41158,mode$41159){var repl$41284;var it$0$41323;var it$0$41317;var it$0$41311;var it$0$41305;var bridge$41265$41342;var bridge$41264$41335;var other$41357;var id$41351;var bridge$41263$41275;var $41258$41270;var r$41255;var t0$41396;var t0$41403;var trf$41423;var trmsg$41424;var trf$41468;var trmsg$41469;var trf$41483;var trmsg$41484;var otherwise$41478;var $41450$41455;var x$41544;var x$41534;var $41517$41529;var $41518$41530;var $41519$41531;var t0$41527;var $41513$41522;var $index$41584;var $length$41578;var temp$41572;var acc$41566;var trf$41554;var trargs$41555;var op$41510;var code$41623;var code$41637;var t0$41615;var t1$41616;var trf$41644;var trmsg$41645;var codevar$41613;var f$41664;var r$41659;var f$41739;var f$41785;var v$41779;var all_strings$41681;var r$41682;var $index$41872;var $length$41866;var temp$41860;var acc$41854;var a$41839;var b$41840;var name$41832;var a$41936;var b$41937;var other$41931;var $41914$41919;var a$41974;var b$41975;var c$41976;var other$41968;var $41951$41956;var a$42029;var other$42025;var bridge$42004$42013;var $42002$42008;var a$42067;var b$42068;var other$42062;var bridge$42041$42050;var $42039$42045;var a$42096;var b$42097;var c$42098;var a$42117;var b$42118;var $index$42228;var $length$42222;var temp$42216;var acc$42210;var $index$42274;var $length$42268;var temp$42262;var acc$42256;var xs$42202;var $42140$42190;var $42136$42184;var isdecl$42141;var $index$42344;var $length$42338;var temp$42332;var acc$42326;var decls$42318;var f$42377;var r$42372;var other$42499;var $42482$42487;var a$42529;var b$42530;var other$42524;var $42507$42512;var a$42569;var b$42570;var c$42571;var d$42572;var other$42562;var $42545$42550;var a$42615;var b$42616;var c$42617;var other$42609;var $42592$42597;var t0$42661;var t0$42669;var a$42707;var b$42708;var other$42702;var $42685$42690;var other$42736;var t0$42723;var $42679$42718;var r$42682;var other$42745;var x$42740;var attempt$42629;var v$42630;var body$42631;var finally$42632;var x$42587;var y$42588;var body$42589;var x$42539;var y$42540;var z$42541;var body$42542;var test$42503;var body$42504;var label$42468;var body$42469;var value$42463;var value$42458;var value$42453;var label$42438;var label$42423;var value$42418;var args$42367;var vars$42312;var body$42313;var s$42307;var args$42302;var args$42131;var lhs$42110;var rhs$42111;var obj$42077;var msg$42078;var rhs$42079;var binding$42035;var value$42036;var binding$41988;var test$41946;var pos$41947;var neg$41948;var test$41898;var pos$41899;var bindings$41826;var body$41827;var args$41675;var args$41654;var f$41607;var msg$41608;var f$41493;var args$41494;var f$41433;var msg$41434;var s$41435;var f$41387;var msg$41388;var f$41362;var v$41250;var s$41236;var $41211$41230;var $41212$41231;var $41213$41232;var $41214$41233;var t0$41222;var t1$41223;var t2$41224;var t3$41225;var t4$41226;var bridge$41178$41227;var bridge$41208$41228;var $41172$41217;var it$0$41163;var self$41164;(it$0$41163=this);(self$41164=this);($41172$41217=expr$41158);if((($41211$41230=($41172$41217 instanceof Array))&&(((t0$41222=$41172$41217.length)),((t0$41222===2)&&($41172$41217[0]==="symbol"))))){(s$41236=$41172$41217[1]);return it$0$41163.expr(it$0$41163.mangle(s$41236),mode$41159);}else{if(($41211$41230&&((t0$41222===1)&&($41172$41217[0]==="void")))){return it$0$41163.expr("null",mode$41159);}else{if(($41211$41230&&((t0$41222===2)&&($41172$41217[0]==="value")))){(v$41250=$41172$41217[1]);(r$41255=((($41258$41270=v$41250)),(function(){if((typeof($41258$41270)==="string")){(repl$41284=({"\"":"\\\"","\n":"\\n","\\":"\\\\"}));(v$41250=v$41250.replace(RegExp("((?:(?:\"|\\\\)|\n))","g"),(function(m$41292){return $40333(repl$41284,m$41292);})));return (("\""+v$41250)+"\"");}else{if(($41258$41270===(void 0))){return "(void 0)";}else{if($40297(RegExp)($41258$41270)){(it$0$41305=String(v$41250));(it$0$41311=it$0$41305.slice(1,-1));(it$0$41317=it$0$41311.replace(RegExp("/","g"),"\\/"));(it$0$41323=it$0$41317.replace(RegExp("\\n","g"),"\\n"));return "/".concat(it$0$41323).concat("/");}else{(bridge$41263$41275=$41258$41270);if(((((bridge$41264$41335=bridge$41263$41275)),((((bridge$41265$41342=bridge$41264$41335)),((typeof(bridge$41265$41342)==="number")||(bridge$41265$41342===true)))||(bridge$41264$41335===false)))||(bridge$41263$41275===null))){return String(v$41250);}else{if(($42832($41258$41270,"::id")&&((id$41351=$41258$41270["::id"]),id$41351))){return it$0$41163.translate(it$0$41163.register_value(v$41250,id$41351),mode$41159);}else{(other$41357=$41258$41270);throw $40409(["cannot_serialize"]).create("Cannot serialize value",({"value":v$41250}));}}}}}})()));return it$0$41163.expr(r$41255,mode$41159);}else{if(($41211$41230&&(($41213$41232=(t0$41222===3))&&(($41214$41233=($41172$41217[0]==="send"))&&(((t1$41223=$41172$41217[1])),((t1$41223 instanceof Array)&&(((t2$41224=t1$41223.length)),((t2$41224===2)&&((t1$41223[0]==="variable")&&((t1$41223[1]==="___node")&&(((t3$41225=$41172$41217[2])),((t3$41225 instanceof Array)&&(((t4$41226=t3$41225.length)),((t4$41226===2)&&(t3$41225[0]==="value"))))))))))))))){(f$41362=t3$41225[1]);return f$41362;}else{if(($41214$41233&&(((bridge$41178$41227=$41172$41217[1])),((((bridge$41178$41227 instanceof Array)&&(((t0$41396=bridge$41178$41227.length)),((t0$41396===2)&&((bridge$41178$41227[0]==="symbol")&&(bridge$41178$41227[1]==="___js_fetch")))))||((bridge$41178$41227 instanceof Array)&&(((t0$41403=bridge$41178$41227.length)),((t0$41403===2)&&((bridge$41178$41227[0]==="variable")&&(bridge$41178$41227[1]==="___js_fetch"))))))&&(((t1$41223=$41172$41217[2])),((t1$41223 instanceof Array)&&(((t2$41224=t1$41223.length)),((t2$41224===3)&&(t1$41223[0]==="array"))))))))){(f$41387=t1$41223[1]);(msg$41388=t1$41223[2]);(trf$41423=it$0$41163.translate(f$41387,"expr"));(trmsg$41424=it$0$41163.translate(msg$41388,"expr"));return it$0$41163.expr((((trf$41423+"[")+trmsg$41424)+"]"),mode$41159);}else{if(($41214$41233&&((f$41433=$41172$41217[1]),(((t1$41223=$41172$41217[2])),((msg$41434=t1$41223),((t1$41223 instanceof Array)&&(((t2$41224=t1$41223.length)),((t2$41224===2)&&(t1$41223[0]==="value"))))))))){(s$41435=t1$41223[1]);($41450$41455=null);$41450$41455;if(((typeof(s$41435)==="string")&&s$41435.match(RegExp("(?:^(?:[a-zA-Z_$]+)$)","")))){(trf$41468=it$0$41163.translate(f$41433,"expr"));(trmsg$41469=it$0$41163.translate(["symbol",s$41435],"expr"));return it$0$41163.expr(((trf$41468+".")+trmsg$41469),mode$41159);}else{(otherwise$41478=$41450$41455);(trf$41483=it$0$41163.translate(f$41433,"expr"));(trmsg$41484=it$0$41163.translate(msg$41434,"expr"));return it$0$41163.expr((((trf$41483+"[")+trmsg$41484)+"]"),mode$41159);}}else{if(($41214$41233&&((f$41493=$41172$41217[1]),(((t1$41223=$41172$41217[2])),((t1$41223 instanceof Array)&&(((t2$41224=t1$41223.length)),((t2$41224>=1)&&(t1$41223[0]==="array")))))))){(args$41494=Array.prototype.slice.call(t1$41223,1));(op$41510=((($41513$41522=f$41493)),(function(){if((($41517$41529=($41513$41522 instanceof Array))&&(((t0$41527=$41513$41522.length)),(($41519$41531=(t0$41527===2))&&($41513$41522[0]==="symbol"))))){(x$41534=$41513$41522[1]);return $40333(js_op_table$40695,x$41534);}else{if(($41519$41531&&($41513$41522[0]==="variable"))){(x$41544=$41513$41522[1]);return $40333(js_op_table2$40694,x$41544);}else{$41513$41522;return null;}}})()));if(op$41510){return it$0$41163.expr(it$0$41163.op(op$41510,args$41494[0],args$41494[1]),mode$41159);}else{(trf$41554=it$0$41163.translate(f$41493,"expr"));(trargs$41555=(((acc$41566=[])),(((temp$41572=args$41494)),((($length$41578=temp$41572.length)),((($index$41584=0)),(function(){$41561:for(;($index$41584<$length$41578);($index$41584++)){var x$41601;var m$41593;(m$41593=temp$41572[$index$41584]);(x$41601=m$41593);acc$41566.push(it$0$41163.translate(x$41601,"expr"));}})()))),acc$41566));return it$0$41163.expr((((trf$41554+"(")+trargs$41555.join(","))+")"),mode$41159);}}else{if($41214$41233){(f$41607=$41172$41217[1]);(msg$41608=$41172$41217[2]);(t0$41615=(((code$41623="(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}})")),it$0$41163.register_raw(code$41623,"~send")));if(((t0$41615 instanceof Array)&&(((t1$41616=t0$41615.length)),((t1$41616===2)&&(t0$41615[0]==="symbol"))))){(codevar$41613=t0$41615[1]);}else{$40390((((code$41637="(function(o,m){if(typeof(m)==='string'||typeof(m)==='number'){return o[m];}else{return o['::send'](m);}})")),it$0$41163.register_raw(code$41637,"~send")),"/home/olivier/git/earl-grey/src/translate-js.eg",6702,6912);}(trf$41644=it$0$41163.translate(f$41607,"expr"));(trmsg$41645=it$0$41163.translate(msg$41608,"expr"));return it$0$41163.expr((((((codevar$41613+"(")+trf$41644)+",")+trmsg$41645)+")"),mode$41159);}else{if(($41211$41230&&(($41213$41232=(t0$41222>=1))&&($41172$41217[0]==="array")))){(args$41654=Array.prototype.slice.call($41172$41217,1));(r$41659=(((f$41664=(function(x$41669){return it$0$41163.translate(x$41669,"expr");}))),(("["+args$41654.map(f$41664).join(","))+"]")));return it$0$41163.expr(r$41659,mode$41159);}else{if(($41213$41232&&($41172$41217[0]==="object"))){(args$41675=Array.prototype.slice.call($41172$41217,1));(all_strings$41681=args$41675.every((function($41686$41689){var t0$41697;var t1$41698;var other$41732;var v$41722;var t0$41718;var $41691$41713;var ph$41694;var y$41695;(t0$41697=$41686$41689);if(((t0$41697 instanceof Array)&&(((t1$41698=t0$41697.length)),((t1$41698===3)&&(t0$41697[0]==="array"))))){(ph$41694=t0$41697[1]);(y$41695=t0$41697[2]);}else{$40390($41686$41689);}($41691$41713=ph$41694);if((($41691$41713 instanceof Array)&&(((t0$41718=$41691$41713.length)),((t0$41718===2)&&($41691$41713[0]==="value"))))){(v$41722=$41691$41713[1]);return true;}else{(other$41732=$41691$41713);return false;}})));(r$41682=(function(){if(all_strings$41681){(f$41739=(function($41743$41746){var t0$41751;var t1$41752;var a$41768;var b$41769;var x$41748;var y$41749;(t0$41751=$41743$41746);if(((t0$41751 instanceof Array)&&(((t1$41752=t0$41751.length)),((t1$41752===3)&&(t0$41751[0]==="array"))))){(x$41748=t0$41751[1]);(y$41749=t0$41751[2]);}else{$40390($41743$41746);}(a$41768=it$0$41163.translate(x$41748,"expr"));(b$41769=it$0$41163.translate(y$41749,"expr"));return ((a$41768+":")+b$41769);}));return (("({"+args$41675.map(f$41739).join(","))+"})");}else{(v$41779=gensym$40690());(f$41785=(function($41789$41792){var t0$41797;var t1$41798;var a$41814;var b$41815;var x$41794;var y$41795;(t0$41797=$41789$41792);if(((t0$41797 instanceof Array)&&(((t1$41798=t0$41797.length)),((t1$41798===3)&&(t0$41797[0]==="array"))))){(x$41794=t0$41797[1]);(y$41795=t0$41797[2]);}else{$40390($41789$41792);}(a$41814=it$0$41163.translate(x$41794,"expr"));(b$41815=it$0$41163.translate(y$41795,"expr"));return (((((v$41779+"[")+a$41814)+"]=")+b$41815)+";");}));return ((((((("(function(){"+"var ")+v$41779)+"={};")+args$41675.map(f$41785).join(""))+";return ")+v$41779)+";}())");}})());return it$0$41163.expr(r$41682,mode$41159);}else{if(($41211$41230&&((t0$41222===3)&&($41172$41217[0]==="lambda")))){(bindings$41826=$41172$41217[1]);(body$41827=$41172$41217[2]);(name$41832=(function(){if($40297(RegExp("^[$_a-zA-Z]*$",""))(expr$41158.name)){return (expr$41158.name+" ");}else{return "";}})());(a$41839=(((acc$41854=[])),(((temp$41860=bindings$41826)),((($length$41866=temp$41860.length)),((($index$41872=0)),(function(){$41849:for(;($index$41872<$length$41866);($index$41872++)){var x$41889;var m$41881;(m$41881=temp$41860[$index$41872]);(x$41889=m$41881);acc$41854.push(it$0$41163.translate(x$41889,"expr"));}})()))),acc$41854).join(","));(b$41840=it$0$41163.body(body$41827,"return"));return it$0$41163.expr((((((("(function"+name$41832)+"(")+a$41839)+"){")+b$41840)+"})"),mode$41159);}else{if(($41211$41230&&(($41213$41232=(t0$41222===4))&&(($41214$41233=($41172$41217[0]==="if"))&&((test$41898=$41172$41217[1]),((pos$41899=$41172$41217[2]),(((t1$41223=$41172$41217[3])),((t1$41223 instanceof Array)&&(((t2$41224=t1$41223.length)),((t2$41224===2)&&((t1$41223[0]==="value")&&(t1$41223[1]===(void 0))))))))))))){($41914$41919=mode$41159);if(($41914$41919==="expr")){return it$0$41163.body(expr$41158,"expr");}else{(other$41931=$41914$41919);(a$41936=it$0$41163.translate(test$41898,"expr"));(b$41937=it$0$41163.translate(pos$41899,mode$41159));return (((("if("+a$41936)+"){")+b$41937)+"}");}}else{if($41214$41233){(test$41946=$41172$41217[1]);(pos$41947=$41172$41217[2]);(neg$41948=$41172$41217[3]);($41951$41956=mode$41159);if(($41951$41956==="expr")){return it$0$41163.body(expr$41158,"expr");}else{(other$41968=$41951$41956);(a$41974=it$0$41163.translate(test$41946,"expr"));(b$41975=it$0$41163.translate(pos$41947,mode$41159));(c$41976=it$0$41163.translate(neg$41948,mode$41159));return (((((("if("+a$41974)+"){")+b$41975)+"}else{")+c$41976)+"}");}}else{if(($41211$41230&&(($41213$41232=(t0$41222===3))&&(($41214$41233=($41172$41217[0]==="declare"))&&((binding$41988=$41172$41217[1]),(((t1$41223=$41172$41217[2])),((t1$41223 instanceof Array)&&(((t2$41224=t1$41223.length)),((t2$41224===2)&&((t1$41223[0]==="value")&&(t1$41223[1]===(void 0)))))))))))){($42002$42008=mode$41159);(bridge$42004$42013=$42002$42008);if(((bridge$42004$42013==="expr")||(bridge$42004$42013==="return"))){throw "Invalid in expr ctx";}else{(other$42025=$42002$42008);(a$42029=it$0$41163.translate(binding$41988,"expr"));return (("var "+a$42029)+";");}}else{if($41214$41233){(binding$42035=$41172$41217[1]);(value$42036=$41172$41217[2]);($42039$42045=mode$41159);(bridge$42041$42050=$42039$42045);if(((bridge$42041$42050==="expr")||(bridge$42041$42050==="return"))){throw "Invalid in expr ctx";}else{(other$42062=$42039$42045);(a$42067=it$0$41163.translate(binding$42035,"expr"));(b$42068=it$0$41163.translate(value$42036,"expr"));return (((("var "+a$42067)+"=")+b$42068)+";");}}else{if(($41213$41232&&(($41214$41233=($41172$41217[0]==="assign"))&&(((t1$41223=$41172$41217[1])),((t1$41223 instanceof Array)&&(((t2$41224=t1$41223.length)),((t2$41224===3)&&(t1$41223[0]==="send")))))))){(obj$42077=t1$41223[1]);(msg$42078=t1$41223[2]);(rhs$42079=$41172$41217[2]);(a$42096=it$0$41163.translate(obj$42077,"expr"));(b$42097=it$0$41163.translate(msg$42078,"expr"));(c$42098=it$0$41163.translate(rhs$42079,"expr"));return it$0$41163.expr((((((("("+a$42096)+"[")+b$42097)+"]=")+c$42098)+")"),mode$41159);}else{if($41214$41233){(lhs$42110=$41172$41217[1]);(rhs$42111=$41172$41217[2]);(a$42117=it$0$41163.translate(lhs$42110,"expr"));(b$42118=it$0$41163.translate(rhs$42111,"expr"));return it$0$41163.expr((((("("+a$42117)+"=")+b$42118)+")"),mode$41159);}else{if(($41211$41230&&((t0$41222===1)&&($41172$41217[0]==="multi")))){return "";}else{if(($41211$41230&&(($41213$41232=(t0$41222>=1))&&($41172$41217[0]==="multi")))){(args$42131=Array.prototype.slice.call($41172$41217,1));(isdecl$42141=(function($42145$42148){var other$42179;var variable$42168;var value$42169;var t0$42164;var $42150$42159;var ph$42153;(ph$42153=$42145$42148);($42150$42159=ph$42153);if((($42150$42159 instanceof Array)&&(((t0$42164=$42150$42159.length)),((t0$42164===3)&&($42150$42159[0]==="declare"))))){(variable$42168=$42150$42159[1]);(value$42169=$42150$42159[2]);return true;}else{(other$42179=$42150$42159);return false;}}));($42136$42184=null);$42136$42184;if((args$42131.length===1)){return it$0$41163.translate(args$42131[0],mode$41159);}else{if(((mode$41159==="expr")&&(!args$42131.some(isdecl$42141)))){(xs$42202=(((acc$42210=[])),(((temp$42216=args$42131)),((($length$42222=temp$42216.length)),((($index$42228=0)),(function(){$42205:for(;($index$42228<$length$42222);($index$42228++)){var x$42245;var m$42237;(m$42237=temp$42216[$index$42228]);(x$42245=m$42237);acc$42210.push(it$0$41163.translate(x$42245,"expr"));}})()))),acc$42210));(xs$42202=(((acc$42256=[])),(((temp$42262=xs$42202)),((($length$42268=temp$42262.length)),((($index$42274=0)),(function(){$42251:for(;($index$42274<$length$42268);($index$42274++)){var x$42291;var m$42283;(m$42283=temp$42262[$index$42274]);(x$42291=m$42283);if((x$42291!=="")){acc$42256.push(x$42291);}else{false;}}})()))),acc$42256));return (("("+xs$42202.join(","))+")");}else{return it$0$41163.body(expr$41158,mode$41159);}}}else{if(($41213$41232&&($41172$41217[0]==="splice"))){(args$42302=Array.prototype.slice.call($41172$41217,1));return it$0$41163.translate(["multi"].concat(args$42302),mode$41159);}else{if(($41211$41230&&((t0$41222===2)&&($41172$41217[0]==="variable")))){(s$42307=$41172$41217[1]);return it$0$41163.expr(it$0$41163.mangle(s$42307),mode$41159);}else{if(($41211$41230&&((t0$41222===3)&&($41172$41217[0]==="scope")))){(vars$42312=$41172$41217[1]);(body$42313=$41172$41217[2]);(decls$42318=(((acc$42326=[])),(((temp$42332=vars$42312)),((($length$42338=temp$42332.length)),((($index$42344=0)),(function(){$42321:for(;($index$42344<$length$42338);($index$42344++)){var v$42361;var m$42353;(m$42353=temp$42332[$index$42344]);(v$42361=m$42353);acc$42326.push(["declare",v$42361,["value",(void 0)]]);}})()))),acc$42326));return it$0$41163.translate(["multi"].concat(decls$42318).concat([body$42313]),mode$41159);}else{if(($41211$41230&&((t0$41222>=1)&&($41172$41217[0]==="object2")))){(args$42367=Array.prototype.slice.call($41172$41217,1));(r$42372=(((f$42377=(function($42381$42384){var t0$42389;var t1$42390;var a$42406;var b$42407;var x$42386;var y$42387;(t0$42389=$42381$42384);if(((t0$42389 instanceof Array)&&(((t1$42390=t0$42389.length)),(t1$42390===2)))){(x$42386=t0$42389[0]);(y$42387=t0$42389[1]);}else{$40390($42381$42384);}(a$42406=it$0$41163.translate(x$42386,"expr"));(b$42407=it$0$41163.translate(y$42387,"expr"));return ((a$42406+":")+b$42407);}))),(("({"+args$42367.map(f$42377).join(","))+"})")));return it$0$41163.expr(r$42372,mode$41159);}else{if(($41211$41230&&((t0$41222===2)&&($41172$41217[0]==="js_new")))){(value$42418=$41172$41217[1]);return it$0$41163.expr((("(new "+it$0$41163.translate(value$42418,"expr"))+")"),mode$41159);}else{if(($41211$41230&&(($41213$41232=((t0$41222>=1)&&(t0$41222<=2)))&&(($41172$41217[0]==="js_break")&&(((t1$41223=(function(){if((1>=t0$41222)){return ["value",null];}else{return $41172$41217[1];}})())),((t1$41223 instanceof Array)&&(((t2$41224=t1$41223.length)),((t2$41224===2)&&(t1$41223[0]==="value"))))))))){(label$42423=t1$41223[1]);if((mode$41159==="expr")){throw "Invalid break in ctx";}else{return (("break"+(function(){if(label$42423){return (" "+label$42423);}else{return "";}})())+";");}}else{if(($41213$41232&&(($41172$41217[0]==="js_continue")&&(((t1$41223=(function(){if((1>=t0$41222)){return ["value",null];}else{return $41172$41217[1];}})())),((t1$41223 instanceof Array)&&(((t2$41224=t1$41223.length)),((t2$41224===2)&&(t1$41223[0]==="value")))))))){(label$42438=t1$41223[1]);if((mode$41159==="expr")){throw "Invalid continue in ctx";}else{return (("continue"+(function(){if(label$42438){return (" "+label$42438);}else{return "";}})())+";");}}else{if(($41211$41230&&(($41213$41232=(t0$41222===2))&&($41172$41217[0]==="js_return")))){(value$42453=$41172$41217[1]);if((mode$41159==="expr")){throw "Invalid return in ctx";}else{return (("return "+it$0$41163.translate(value$42453,"expr"))+";");}}else{if(($41213$41232&&($41172$41217[0]==="js_delete"))){(value$42458=$41172$41217[1]);if((mode$41159==="expr")){throw "Invalid delete in ctx";}else{return (("delete "+it$0$41163.translate(value$42458,"expr"))+";");}}else{if(($41213$41232&&($41172$41217[0]==="js_throw"))){(value$42463=$41172$41217[1]);if((mode$41159==="expr")){return (("function(){throw "+it$0$41163.translate(value$42463,"expr"))+";}()");}else{return (("throw "+it$0$41163.translate(value$42463,"expr"))+";");}}else{if(($41211$41230&&(($41213$41232=(t0$41222===3))&&(($41172$41217[0]==="js_label")&&(((t1$41223=$41172$41217[1])),((t1$41223 instanceof Array)&&(((t2$41224=t1$41223.length)),((t2$41224===2)&&(t1$41223[0]==="value"))))))))){(label$42468=t1$41223[1]);(body$42469=$41172$41217[2]);($42482$42487=mode$41159);if(($42482$42487==="expr")){return it$0$41163.body(expr$41158,"expr");}else{(other$42499=$42482$42487);return ((label$42468+":")+it$0$41163.translate(body$42469,other$42499));}}else{if(($41213$41232&&($41172$41217[0]==="js_while"))){(test$42503=$41172$41217[1]);(body$42504=$41172$41217[2]);($42507$42512=mode$41159);if(($42507$42512==="expr")){return it$0$41163.body(expr$41158,"expr");}else{(other$42524=$42507$42512);(a$42529=it$0$41163.translate(test$42503,"expr"));(b$42530=it$0$41163.translate(body$42504,"stmt"));return (((("while("+a$42529)+"){")+b$42530)+"}");}}else{if(($41211$41230&&((t0$41222===5)&&($41172$41217[0]==="js_for")))){(x$42539=$41172$41217[1]);(y$42540=$41172$41217[2]);(z$42541=$41172$41217[3]);(body$42542=$41172$41217[4]);($42545$42550=mode$41159);if(($42545$42550==="expr")){return it$0$41163.body(expr$41158,"expr");}else{(other$42562=$42545$42550);(a$42569=it$0$41163.translate(x$42539,"expr"));(b$42570=it$0$41163.translate(y$42540,"expr"));(c$42571=it$0$41163.translate(z$42541,"expr"));(d$42572=it$0$41163.translate(body$42542,"stmt"));return (((((((("for("+a$42569)+";")+b$42570)+";")+c$42571)+"){")+d$42572)+"}");}}else{if(($41211$41230&&(($41213$41232=(t0$41222===4))&&($41172$41217[0]==="js_for_in")))){(x$42587=$41172$41217[1]);(y$42588=$41172$41217[2]);(body$42589=$41172$41217[3]);($42592$42597=mode$41159);if(($42592$42597==="expr")){return it$0$41163.body(expr$41158,"expr");}else{(other$42609=$42592$42597);(a$42615=it$0$41163.translate(x$42587,"expr"));(b$42616=it$0$41163.translate(y$42588,"expr"));(c$42617=it$0$41163.translate(body$42589,"stmt"));return (((((("for("+a$42615)+" in ")+b$42616)+"){")+c$42617)+"}");}}else{if(($41213$41232&&(($41172$41217[0]==="js_try")&&((attempt$42629=$41172$41217[1]),(((t1$41223=$41172$41217[2])),((t1$41223 instanceof Array)&&(((t2$41224=t1$41223.length)),((t2$41224===3)&&((t1$41223[0]==="lambda")&&(((t3$41225=t1$41223[1])),((t3$41225 instanceof Array)&&(((t4$41226=t3$41225.length)),((t4$41226===1)&&(((bridge$41208$41228=t3$41225[0])),(((bridge$41208$41228 instanceof Array)&&(((t0$42661=bridge$41208$41228.length)),((t0$42661===2)&&((bridge$41208$41228[0]==="symbol")&&((v$42630=bridge$41208$41228[1]),true)))))||((bridge$41208$41228 instanceof Array)&&(((t0$42669=bridge$41208$41228.length)),((t0$42669===2)&&((bridge$41208$41228[0]==="variable")&&((v$42630=bridge$41208$41228[1]),true)))))))))))))))))))){(body$42631=t1$41223[2]);(finally$42632=$41172$41217[3]);(r$42682=((($42685$42690=mode$41159)),(function(){if(($42685$42690==="expr")){return it$0$41163.body(expr$41158,"expr");}else{(other$42702=$42685$42690);(a$42707=it$0$41163.translate(attempt$42629,"stmt"));(b$42708=it$0$41163.translate(body$42631,"stmt"));return (((((("try{"+a$42707)+"}catch(")+v$42630)+"){")+b$42708)+"}");}})()));($42679$42718=finally$42632);if((($42679$42718 instanceof Array)&&(((t0$42723=$42679$42718.length)),((t0$42723===1)&&($42679$42718[0]==="void"))))){return r$42682;}else{(other$42736=$42679$42718);return (((r$42682+"finally{")+it$0$41163.translate(other$42736,"stmt"))+"}");}}else{if(($41211$41230&&((t0$41222===2)&&($41172$41217[0]==="raw")))){(x$42740=$41172$41217[1]);return x$42740;}else{(other$42745=$41172$41217);throw other$42745;}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}));$40316(Translator$40696,$40316(((accum$42750=({})),((accum$42750["::name"]="Translator"),accum$42750)),((accum$42754=({})),((accum$42754["::egclass"]=true),accum$42754))));Translator$40696;(translate$40697=(function(expr$42761,mode$42762){var tr$42767;var t$42768;(tr$42767=Translator$40696());(t$42768=tr$42767.translate(expr$42761,mode$42762));return (tr$42767.dump_store()+t$42768);}));(exports["Translator"]=Translator$40696);(exports["translate"]=translate$40697);
