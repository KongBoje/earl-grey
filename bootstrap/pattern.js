
'use strict';require('earlgrey-runtime/6');let accum$0;let accum$1;let accum$2;let accum$3;let accum$4;let accum$5;let accum$6;let accum$7;let accum$8;let accum$9;let $targ$33;let $targ$34;let $0$0;let __lt____gt__$0;let $1$0;let __lt____lt____colon__$0;let util$0;let GenSym$0;let gensym$0;let classify$0;let classify_contiguous$0;let identity$0;let Body$0;let $3$0;let checker_db$0;let PatternInfo$0;let PatternCompiler$0;let PatternProcessor$0;let assemble_conditions$0;let assemble_pattern$0;let inject_below_uses$0;let checkall$0;let same_block$0;let parse_clauses$0;let opt_clauses$0;let weave_clauses$0;$0$0=require("./pp");__lt____gt__$0=getProperty($0$0,"<>","./pp");$1$0=require("./location");__lt____lt____colon__$0=getProperty($1$0,"<<:","./location");util$0=require("./util");GenSym$0=getProperty(util$0,"GenSym","util");gensym$0=getProperty(util$0,"gensym","util");classify$0=getProperty(util$0,"classify","util");classify_contiguous$0=getProperty(util$0,"classify_contiguous","util");identity$0=getProperty(util$0,"identity","util");Body$0=getProperty(util$0,"Body","util");$3$0=require("./expand");checker_db$0=getProperty($3$0,"checker_db","./expand");PatternInfo$0=(function PatternInfo(){let t0$0;let m$0$0;let $it$0;if((!getChecker(PatternInfo$0)(this))){$it$0=Object.create(PatternInfo$0.prototype);}else{$it$0=this;}m$0$0=arguments;t0$0=m$0$0.length;if(((t0$0>=0)&&(t0$0<=3))){($it$0["handlers"]=((0>=t0$0)?[]:m$0$0[0]));($it$0["vars"]=((1>=t0$0)?[]:m$0$0[1]));($it$0["arguments"]=((2>=t0$0)?[]:m$0$0[2]));undefined;}else{___match_error(m$0$0);}return $it$0;});__amp____colon__(((accum$0=({})),(accum$0["mergeAll"]=(function mergeAll(pinfos$0){let f$0;let rval$0;rval$0=PatternInfo$0();f$0=(function f(acc$0,pinfo$0){return acc$0.merge((pinfo$0.pinfo||pinfo$0));});return pinfos$0.reduce(f$0,rval$0);})),accum$0),__amp____colon__(((accum$1=({})),(accum$1["::name"]="PatternInfo"),accum$1),((accum$2=({})),(accum$2["::egclass"]=true),accum$2)));(PatternInfo$0.prototype["merge"]=(function merge(pinfo$1){let $it$1;let self$0;$it$1=this;self$0=this;($it$1["handlers"]=$it$1.handlers.concat(pinfo$1.handlers));($it$1["vars"]=$it$1.vars.concat(pinfo$1.vars));($it$1["arguments"]=$it$1.arguments.concat(pinfo$1.arguments));return $it$1;}));__amp____colon__(PatternInfo$0,__amp____colon__(((accum$3=({})),(accum$3["mergeAll"]=(function mergeAll(pinfos$1){let f$1;let rval$1;rval$1=PatternInfo$0();f$1=(function f(acc$1,pinfo$2){return acc$1.merge((pinfo$2.pinfo||pinfo$2));});return pinfos$1.reduce(f$1,rval$1);})),accum$3),__amp____colon__(((accum$4=({})),(accum$4["::name"]="PatternInfo"),accum$4),((accum$5=({})),(accum$5["::egclass"]=true),accum$5))));PatternCompiler$0=(function PatternCompiler(temp$0$0,temp$1$0,temp$2$0){let $it$2;if((!getChecker(PatternCompiler$0)(this))){$it$2=Object.create(PatternCompiler$0.prototype);}else{$it$2=this;}($it$2["pattern"]=temp$0$0);($it$2["info"]=temp$1$0);($it$2["opt"]=temp$2$0);return $it$2;});(PatternCompiler$0.prototype["compile"]=(function compile(){let tags$0;let $targ$0;let $targ$1;let $targ$2;let $targ$3;let $targ$4;let $targ$5;let $it$3;let self$1;$it$3=this;self$1=this;if($it$3.compiled){return $it$3.compiled;}tags$0=clone(($it$3.opt.tags||({})));(tags$0["group_id"]=(tags$0.group_id||gensym$0("group")));$targ$0=$it$3.expand($it$3.pattern,tags$0,true,$it$3.opt.indexable);($it$3["compiled"]=$targ$0);[];$targ$1=$it$3.info;($it$3.compiled.pinfo["info"]=$targ$1);[];$targ$2=$it$3.opt;($it$3.compiled.pinfo["opt"]=$targ$2);[];$targ$3=$it$3.compiled.pinfo.vars;($it$3["vars"]=$targ$3);[];$targ$4=$it$3.compiled.pinfo.handlers;($it$3["handlers"]=$targ$4);[];$targ$5=$it$3.compiled.pinfo.arguments;($it$3["arguments"]=$targ$5);[];return $it$3.compiled;}));(PatternCompiler$0.prototype["fork"]=(function fork(pattern$0){let pc$0;let $targ$6;let $targ$7;let $targ$8;let $targ$9;let $it$4;let self$2;$it$4=this;self$2=this;pc$0=PatternCompiler$0(null,$it$4.info,$it$4.opt);$targ$6=pattern$0;(pc$0["compiled"]=$targ$6);[];$targ$7=$it$4.vars;(pc$0["vars"]=$targ$7);[];$targ$8=$it$4.arguments;(pc$0["arguments"]=$targ$8);[];$targ$9=$it$4.handlers;(pc$0["handlers"]=$targ$9);[];__amp____colon__(pc$0,pattern$0.pinfo);return pc$0;}));(PatternCompiler$0.prototype["parse_specs"]=(function parse_specs(specs$0,tags$1){let m$2;let acc$2;let temp$3;let rest$0;let has_defaults$0;let curidx$0;let insidx$0;let setInsidx$0;let rval$2;let $targ$10;let $targ$11;let $it$5;let self$3;$it$5=this;self$3=this;rest$0=undefined;has_defaults$0=false;curidx$0=0;insidx$0=null;setInsidx$0=(function setInsidx(spec$0){let msg$0;let x$0;let m$1$0;if(equal(insidx$0,null)){m$1$0=curidx$0;if((m$1$0===null)){msg$0="Object patterns cannot be after rest/default arguments.";throw ErrorFactory(["syntax","pattern"]).create(msg$0,({"expr":spec$0}));}else{x$0=m$1$0;insidx$0=x$0;return insidx$0;}}});rval$2=classify$0("fw","bw","keys","defaults",((acc$2=[]),(temp$3=null),(m$2=null),(function(){$4:for(m$2 of $it$5.info.step_all(["pattern"],specs$0)){let v$1;let v$0;let variable$1;let value$0;let key$1;let subp$0;let key$0;let variable$0;let $$20252$0;let $$20253$0;let $$20254$0;let $$20255$0;let t0$2;let t1$0;let spec$1;let ph$0$0;let t0$1;t0$1=m$2;spec$1=t0$1;ph$0$0=t0$1;t0$2=ph$0$0;if((($$20253$0=Array.isArray(t0$2))&&((t1$0=t0$2.length),(($$20255$0=(t1$0===2))&&(t0$2[0]==="dynsplice"))))){variable$0=t0$2[1];curidx$0=null;rest$0=$it$5.expand(variable$0,tags$1);temp$3=["ignore"];}else{if(($$20255$0&&(t0$2[0]==="assoc"))){key$0=t0$2[1];setInsidx$0(spec$1);temp$3=["keys",[key$0,$it$5.expand(key$0,tags$1)]];}else{if(($$20253$0&&(($$20255$0=(t1$0===3))&&(t0$2[0]==="assoc")))){key$1=t0$2[1];subp$0=t0$2[2];setInsidx$0(spec$1);temp$3=["keys",[key$1,$it$5.expand(subp$0,tags$1)]];}else{if(($$20255$0&&(t0$2[0]==="default"))){variable$1=t0$2[1];value$0=t0$2[2];curidx$0=null;has_defaults$0=true;if(rest$0){throw ErrorFactory(["syntax","pattern"]).create("No default arguments after rest arg.");}else{temp$3=["defaults",[$it$5.expand(variable$1,tags$1),value$0]];}}else{v$0=ph$0$0;if(((rest$0===undefined)&&(!has_defaults$0))){curidx$0=(curidx$0+1);temp$3=["fw",$it$5.expand(v$0,tags$1)];}else{v$1=ph$0$0;curidx$0=null;temp$3=["bw",$it$5.expand(v$1,tags$1)];}}}}}acc$2.push(temp$3);}})(),acc$2));$targ$10=rest$0;(rval$2["rest"]=$targ$10);[];$targ$11=insidx$0;(rval$2["insertion_index"]=$targ$11);[];return rval$2;}));(PatternCompiler$0.prototype["expand"]=(function expand(){let x$1;let x$2;let p$0;let x$3;let x$4;let variable$2;let variable$3;let csubp$0;let csubp$1;let csubp$2;let csubp$3;let x$5;let fn$0;let $targ$12;let msg$1;let msg$2;let cx$0;let m$5;let acc$3;let temp$4;let cxs$0;let m$7;let acc$5;let temp$6;let m$8;let canon$0;let normalize$0;let pps$0;let m$10;let acc$6;let temp$7;let m$11;let acc$7;let temp$8;let m$12;let acc$8;let temp$9;let m$13;let acc$9;let temp$10;let patt$0;let keys$1;let fw$1;let bw$1;let defaults$1;let rest$2;let keys$0;let fw$0;let bw$0;let defaults$0;let rest$1;let $$20718$0;let t0$11;let t1$6;let t2$2;let t3$0;let t4$0;let t5$0;let m$9$0;let specs$1;let pinfos$2;let pinfo$3;let other$0;let mode$0;let subp$5;let args$1;let xs$1;let xs$0;let x$6;let f$3;let arg$0;let f$2;let args$0;let checker$0;let subp$4;let projector$0;let subp$3;let unconditional$0;let condition$0;let subp$2;let subp$1;let value$1;let v$3;let v$2;let handler$0;let $$20399$0;let $$20400$0;let $$20401$0;let $$20402$0;let t0$4;let bridge$$20383$0;let t1$1;let m$4$0;let $targ$13;let expr$0;let rval$3;let pattern$1;let tags$2;let toplevel$0;let checked$0;let t0$3;let m$3$0;let $it$6;let self$4;$it$6=this;self$4=this;m$3$0=arguments;t0$3=m$3$0.length;if(((t0$3>=2)&&(t0$3<=4))){pattern$1=m$3$0[0];tags$2=m$3$0[1];if((2>=t0$3)){toplevel$0=false;}else{toplevel$0=m$3$0[2];}if((3>=t0$3)){checked$0=false;}else{checked$0=m$3$0[3];}expr$0=$it$6.info.step(["pattern"],pattern$1);m$4$0=expr$0;if(((x$1=m$4$0),((x$1 instanceof Array)&&(x$1[0]==="void")))){rval$3=["ignore"];}else{if(((x$2=m$4$0),((x$2 instanceof Array)&&(x$2[0]==="ignore")))){rval$3=expr$0;}else{if((Array.isArray(m$4$0)&&((t0$4=m$4$0.length),((t0$4===2)&&(m$4$0[0]==="special"))))){handler$0=m$4$0[1];p$0=$it$6.expand(handler$0.expand($it$6.info),tags$2,toplevel$0,false);p$0.pinfo.handlers.push(handler$0);rval$3=p$0;}else{bridge$$20383$0=m$4$0;if((((x$3=bridge$$20383$0),((x$3 instanceof Array)&&(x$3[0]==="symbol")))||((x$4=bridge$$20383$0),((x$4 instanceof Array)&&(x$4[0]==="variable"))))){variable$2=__amp__(expr$0,tags$2);rval$3=__amp____colon__(["assign",variable$2],({"pinfo":PatternInfo$0([],[variable$2])}));}else{if((($$20399$0=Array.isArray(m$4$0))&&((t0$4=m$4$0.length),(($$20401$0=(t0$4===2))&&(($$20402$0=(m$4$0[0]==="value"))&&((v$2=m$4$0[1]),$it$6.opt.strings_as_variables)))))){variable$3=__lt____lt____colon__$0(__amp__(["symbol",v$2],tags$2),expr$0);rval$3=__amp____colon__(["assign",variable$3],({"pinfo":PatternInfo$0([],[variable$3])}));}else{if($$20402$0){v$3=m$4$0[1];rval$3=["check",checker_db$0(v$3),["ignore"]];}else{if(($$20399$0&&(($$20401$0=(t0$4===3))&&(m$4$0[0]==="replace")))){subp$1=m$4$0[1];value$1=m$4$0[2];csubp$0=$it$6.expand(subp$1,tags$2,toplevel$0,false);rval$3=__amp____colon__(["replace",csubp$0,value$1],({"pinfo":csubp$0.pinfo}));}else{if(($$20401$0&&(m$4$0[0]==="test"))){condition$0=m$4$0[1];subp$2=m$4$0[2];csubp$1=$it$6.expand(subp$2,tags$2,toplevel$0,false);rval$3=__amp____colon__(["test",condition$0,csubp$1],({"pinfo":csubp$1.pinfo}));}else{if(($$20399$0&&(((t0$4>=3)&&(t0$4<=4))&&(m$4$0[0]==="project")))){projector$0=m$4$0[1];subp$3=m$4$0[2];if((3>=t0$4)){unconditional$0=false;}else{unconditional$0=m$4$0[3];}csubp$2=$it$6.expand(subp$3,tags$2,toplevel$0,true);rval$3=__amp____colon__(["project",projector$0,csubp$2,unconditional$0],({"pinfo":csubp$2.pinfo}));}else{if(($$20399$0&&(($$20401$0=(t0$4===3))&&(m$4$0[0]==="check")))){checker$0=m$4$0[1];subp$4=m$4$0[2];csubp$3=$it$6.expand(subp$4,tags$2,toplevel$0,true);rval$3=__amp____colon__(["check",checker$0,csubp$3],({"pinfo":csubp$3.pinfo}));}else{if(($$20401$0&&(($$20402$0=(m$4$0[0]==="send"))&&((f$2=m$4$0[1]),(t1$1=m$4$0[2]),(x$5=t1$1),((x$5 instanceof Array)&&(x$5[0]==="data")))))){args$0=t1$1;if(toplevel$0){fn$0=$it$6.expand(f$2,tags$2,true,false);$targ$12=PatternInfo$0.mergeAll([fn$0.pinfo,PatternInfo$0([],[],[args$0])]);(fn$0["pinfo"]=$targ$12);[];rval$3=fn$0;}else{msg$1="Function arguments can only be declared as a top level pattern.";throw ErrorFactory(["syntax","pattern"]).create(msg$1,({"node":expr$0,"arg":args$0}));}}else{if($$20402$0){f$3=m$4$0[1];arg$0=m$4$0[2];rval$3=["assign",expr$0];}else{if((!$it$6.opt.allow_nested)){msg$2="Nested patterns are not allowed here.";throw ErrorFactory(["syntax","pattern"]).create(msg$2,({"node":expr$0}));}else{if((($$20399$0=Array.isArray(m$4$0))&&((t0$4=m$4$0.length),((t0$4===2)&&(m$4$0[0]==="neg"))))){x$6=m$4$0[1];cx$0=$it$6.expand(x$6,tags$2);rval$3=__amp____colon__(["neg",cx$0],({"pinfo":cx$0.pinfo}));}else{if(($$20399$0&&(($$20401$0=(t0$4>=1))&&(m$4$0[0]==="all")))){xs$0=Array.prototype.slice.call(m$4$0,1);acc$3=[];temp$4=null;m$5=null;$5:for(m$5 of xs$0){let x$7;x$7=m$5;temp$4=$it$6.expand(x$7,tags$2);acc$3.push(temp$4);}cxs$0=acc$3;rval$3=__amp____colon__(["all"].concat(cxs$0),({"pinfo":PatternInfo$0.mergeAll(cxs$0)}));}else{if(($$20401$0&&(m$4$0[0]==="any"))){xs$1=Array.prototype.slice.call(m$4$0,1);canon$0=(function canon(all$0){return all$0.sort().join(",");});normalize$0=(function normalize(vars$0){let m$6;let acc$4;let temp$5;return canon$0(((acc$4=[]),(temp$5=null),(m$6=null),(function(){$7:for(m$6 of vars$0){let v$4;let t0$5;let t1$2;t0$5=m$6;if((Array.isArray(t0$5)&&((t1$2=t0$5.length),((t1$2===2)&&(t0$5[0]==="symbol"))))){v$4=t0$5[1];temp$5=v$4;acc$4.push(temp$5);}else{___match_error(m$6);}}})(),acc$4));});acc$5=[];temp$6=null;m$7=null;$8:for(m$7 of xs$1){let x$8;x$8=m$7;temp$6=$it$6.expand(x$8,tags$2);acc$5.push(temp$6);}pps$0=acc$5;m$8=null;$6:for(m$8 of neighbours(pps$0)){let v1$0;let v2$0;let pp1$0;let pp2$0;let t0$6;let t1$3;t0$6=m$8;if((Array.isArray(t0$6)&&((t1$3=t0$6.length),(t1$3===2)))){pp1$0=t0$6[0];pp2$0=t0$6[1];v1$0=pp1$0.pinfo.vars;v2$0=pp2$0.pinfo.vars;if((normalize$0(v1$0)!==normalize$0(v2$0))){throw ErrorFactory(["syntax","pattern"]).create("Both branches of 'or' must contain the same variables",({"vars1":__lt____lt____colon__$0(v1$0.sort(),pp1$0),"vars2":__lt____lt____colon__$0(v2$0.sort(),pp2$0)}));}}else{___match_error(m$8);}}rval$3=__amp____colon__(["any"].concat(pps$0),({"pinfo":(pps$0[0]&&pps$0[0].pinfo)}));}else{if(($$20401$0&&(m$4$0[0]==="data"))){args$1=Array.prototype.slice.call(m$4$0,1);specs$1=$it$6.parse_specs(args$1,tags$2);pinfos$2=[];pinfos$2=pinfos$2.concat(((acc$6=[]),(temp$7=null),(m$10=null),(function(){$9:for(m$10 of specs$1.keys){let pinfo$4;let t0$7;let t1$4;let t2$0;t0$7=m$10;if((Array.isArray(t0$7)&&((t1$4=t0$7.length),((t1$4===2)&&(t0$7[0],(t2$0=t0$7[1]),___hasprop(t2$0,"pinfo")))))){pinfo$4=t2$0.pinfo;temp$7=pinfo$4;acc$6.push(temp$7);}else{___match_error(m$10);}}})(),acc$6));pinfos$2=pinfos$2.concat(((acc$7=[]),(temp$8=null),(m$11=null),(function(){$10:for(m$11 of specs$1.fw){let pinfo$5;let t0$8;t0$8=m$11;if(___hasprop(t0$8,"pinfo")){pinfo$5=t0$8.pinfo;temp$8=pinfo$5;acc$7.push(temp$8);}else{___match_error(m$11);}}})(),acc$7));pinfos$2=pinfos$2.concat(((acc$8=[]),(temp$9=null),(m$12=null),(function(){$11:for(m$12 of specs$1.bw){let pinfo$6;let t0$9;t0$9=m$12;if(___hasprop(t0$9,"pinfo")){pinfo$6=t0$9.pinfo;temp$9=pinfo$6;acc$8.push(temp$9);}else{___match_error(m$12);}}})(),acc$8));pinfos$2=pinfos$2.concat(((acc$9=[]),(temp$10=null),(m$13=null),(function(){$12:for(m$13 of specs$1.defaults){let pinfo$7;let t0$10;let t1$5;let t2$1;t0$10=m$13;if((Array.isArray(t0$10)&&((t1$5=t0$10.length),((t1$5===2)&&((t2$1=t0$10[0]),___hasprop(t2$1,"pinfo")))))){pinfo$7=t2$1.pinfo;t0$10[1];temp$10=pinfo$7;acc$9.push(temp$10);}else{___match_error(m$13);}}})(),acc$9));if(specs$1.rest){pinfos$2.push(specs$1.rest.pinfo);}pinfo$3=PatternInfo$0.mergeAll(pinfos$2);m$9$0=specs$1;if((($$20718$0=___hasprop(m$9$0,"keys"))&&((t0$11=m$9$0.keys),(Array.isArray(t0$11)&&((t1$6=t0$11.length),((t1$6===0)&&(___hasprop(m$9$0,"fw")&&((fw$0=m$9$0.fw),(___hasprop(m$9$0,"bw")&&((bw$0=m$9$0.bw),(___hasprop(m$9$0,"defaults")&&((defaults$0=m$9$0.defaults),___hasprop(m$9$0,"rest"))))))))))))){rest$1=m$9$0.rest;patt$0=__amp____colon__(__lt____lt____colon__$0(["array_pattern",fw$0,bw$0,defaults$0,rest$1],pattern$1),({"pinfo":pinfo$3}));if(checked$0){rval$3=patt$0;}else{rval$3=__amp____colon__(["check",checker_db$0.Array,patt$0],({"pinfo":pinfo$3}));}}else{if(($$20718$0&&((keys$0=m$9$0.keys),(___hasprop(m$9$0,"fw")&&((t0$11=m$9$0.fw),(Array.isArray(t0$11)&&((t1$6=t0$11.length),((t1$6===0)&&(___hasprop(m$9$0,"bw")&&((t2$2=m$9$0.bw),(Array.isArray(t2$2)&&((t3$0=t2$2.length),((t3$0===0)&&(___hasprop(m$9$0,"defaults")&&((t4$0=m$9$0.defaults),(Array.isArray(t4$0)&&((t5$0=t4$0.length),((t5$0===0)&&(___hasprop(m$9$0,"rest")&&(m$9$0.rest===(void 0))))))))))))))))))))){rval$3=__amp____colon__(["object_pattern"].concat(keys$0),({"pinfo":pinfo$3}));}else{if(($$20718$0&&((keys$1=m$9$0.keys),(___hasprop(m$9$0,"fw")&&((fw$1=m$9$0.fw),(___hasprop(m$9$0,"bw")&&((bw$1=m$9$0.bw),(___hasprop(m$9$0,"defaults")&&((defaults$1=m$9$0.defaults),___hasprop(m$9$0,"rest")))))))))){rest$2=m$9$0.rest;rval$3=__amp____colon__(["all",["array_pattern",fw$1,bw$1,defaults$1,rest$2],["object_pattern"].concat(keys$1)],({"pinfo":pinfo$3,"insertion_index":specs$1.insertion_index}));}else{rval$3=___match_error(m$9$0);}}}}else{if(($$20399$0&&((t0$4===3)&&(m$4$0[0]==="mode")))){mode$0=m$4$0[1];subp$5=m$4$0[2];rval$3=$it$6.expand(subp$5,__amp__(tags$2,({"declare_mode":mode$0})),toplevel$0,checked$0);}else{other$0=m$4$0;throw ErrorFactory(["syntax","pattern"]).create(("Illegal pattern: "+other$0),({"node":other$0}));}}}}}}}}}}}}}}}}}}if((!rval$3.pinfo)){$targ$13=PatternInfo$0();(rval$3["pinfo"]=$targ$13);[];}return ($it$6.opt.wrap_pattern||identity$0)(__lt____lt____colon__$0(rval$3,pattern$1),toplevel$0);}else{return ___match_error(m$3$0);}}));(PatternCompiler$0.prototype["shift_rhs"]=(function shift_rhs(temp$11$0,rhs$0){let t0$12;let projector$1;let subp$6;let t0$13;let t1$7;let pattern$2;let ph$1$0;let $it$7;let self$5;$it$7=this;self$5=this;t0$12=temp$11$0;pattern$2=t0$12;ph$1$0=t0$12;t0$13=ph$1$0;t1$7=t0$13.length;if(((t1$7===4)&&((t0$13[0]==="project")&&((projector$1=t0$13[1]),(subp$6=t0$13[2]),(t0$13[3]===true))))){return $it$7.shift_rhs(subp$6,["send",projector$1,["data",rhs$0]]);}else{return [pattern$2,rhs$0];}}));(PatternCompiler$0.prototype["process_for_rhs"]=(function process_for_rhs(rhs$1){let t0$14;let t0$15;let t1$8;let x$10;let x$11;let t0$17;let t0$18;let $targ$20;let t0$19;let t1$10;let $targ$21;let name$0;let t0$16;let t1$9;let bridge$$21020$0;let ph$2$0;let bridge$$21017$0;let m$14$0;let t0$20;let $targ$14;let real_rhs$0;let $targ$15;let cpattern$0;let target$0;let expr$1;let proc$0;let $targ$16;let $targ$17;let $targ$18;let $targ$19;let $it$8;let self$6;$it$8=this;self$6=this;if((!$it$8.compiled)){$it$8.compile();}if(((!$it$8.opt.allow_arguments)&&$it$8.arguments.length)){throw ErrorFactory(["syntax","pattern","arguments"]).create("Arguments cannot be declared in this pattern",({"args":$it$8.arguments[0],"rhs":rhs$1}));}if($it$8.arguments.length){$targ$14=inject_below_uses$0(rhs$1,(function(x$9){return util$0.construct($it$8.arguments.concat([x$9]),(function(args$2,rest$3){return ["send",["symbol","->"],["data",args$2,rest$3]];}));}));}else{$targ$14=rhs$1;}t0$14=getProjector(($it$8.opt.wrap_target||identity$0))($targ$14);if(t0$14[0]){real_rhs$0=t0$14[1];}else{___match_error($targ$14);}$targ$15=$it$8.shift_rhs($it$8.compiled,real_rhs$0);t0$15=$targ$15;if((Array.isArray(t0$15)&&((t1$8=t0$15.length),(t1$8===2)))){cpattern$0=t0$15[0];target$0=t0$15[1];}else{___match_error($targ$15);}[cpattern$0,target$0];__lt____lt____colon__$0(target$0,rhs$1);expr$1=null;m$14$0=target$0;bridge$$21017$0=m$14$0;if((((x$10=bridge$$21017$0),((x$10 instanceof Array)&&(x$10[0]==="symbol")))||((x$11=bridge$$21017$0),((x$11 instanceof Array)&&(x$11[0]==="variable"))))){undefined;}else{ph$2$0=cpattern$0;t0$16=ph$2$0;if((Array.isArray(t0$16)&&((t1$9=t0$16.length),((t1$9===2)&&((t0$16[0]==="assign")&&((bridge$$21020$0=t0$16[1]),((Array.isArray(bridge$$21020$0)&&((t0$17=bridge$$21020$0.length),((t0$17===2)&&((bridge$$21020$0[0]==="symbol")&&((name$0=bridge$$21020$0[1]),true)))))||(Array.isArray(bridge$$21020$0)&&((t0$18=bridge$$21020$0.length),((t0$18===2)&&((bridge$$21020$0[0]==="variable")&&((name$0=bridge$$21020$0[1]),true)))))))))))){$targ$20=name$0;(target$0["name"]=$targ$20);[];}else{$targ$21=[__lt____lt____colon__$0(["variable",$it$8.info.gensym("$targ")],target$0),target$0];t0$19=$targ$21;if((Array.isArray(t0$19)&&((t1$10=t0$19.length),(t1$10===2)))){target$0=t0$19[0];expr$1=t0$19[1];}else{___match_error($targ$21);}[target$0,expr$1];}}proc$0=PatternProcessor$0();proc$0.process(cpattern$0,target$0,$it$8.opt);$targ$16=proc$0;t0$20=$targ$16;if((___hasprop(t0$20,"temps")&&(($it$8["temps"]=t0$20.temps),___hasprop(t0$20,"parts")))){($it$8["parts"]=t0$20.parts);}else{___match_error($targ$16);}[];$targ$17=true;($it$8["processed"]=$targ$17);[];$targ$18=target$0;($it$8["target"]=$targ$18);[];$targ$19=expr$1;($it$8["expr"]=$targ$19);[];return [$it$8.temps,$it$8.parts];}));(PatternCompiler$0.prototype["extract_from_rhs"]=(function extract_from_rhs(rhs$2){let m$15;let acc$10;let temp$12;let succ$0;let fail$0;let assembly$0;let $it$9;let self$7;$it$9=this;self$7=this;if((!$it$9.processed)){$it$9.process_for_rhs(rhs$2);}succ$0=$it$9.opt.success($it$9.target);fail$0=$it$9.opt.failure($it$9.target);assembly$0=assemble_pattern$0($it$9.parts,succ$0,fail$0);return ["splice",(($it$9.expr===null)?["splice"]:["splice",["declare",$it$9.target],["assign",$it$9.target,$it$9.expr]])].concat($it$9.opt.declare($it$9.info,$it$9.vars)).concat([["multi"].concat(((acc$10=[]),(temp$12=null),(m$15=null),(function(){$13:for(m$15 of $it$9.temps){let t$0;t$0=m$15;temp$12=["declare",t$0];acc$10.push(temp$12);}})(),acc$10)).concat([assembly$0])]);}));(PatternCompiler$0.prototype["wrapBody"]=(function wrapBody(body$0){let m$16;let m$17;let x$12;let $it$10;let self$8;$it$10=this;self$8=this;m$16=null;$14:for(m$16 of enumerate($it$10.handlers)){let $targ$22;let i$0;let h$0;let t0$21;let t1$11;t0$21=m$16;if((Array.isArray(t0$21)&&((t1$11=t0$21.length),(t1$11===2)))){i$0=t0$21[0];h$0=t0$21[1];$targ$22=(h$0.wrapOrder+(i$0/1000000));(h$0["__ord"]=$targ$22);[];}else{___match_error(m$16);}}$it$10.handlers.sort((function(x$13,y$0){return (x$13.__ord<y$0.__ord);}));x$12=body$0;m$17=null;$15:for(m$17 of $it$10.handlers){let handler$1;handler$1=m$17;x$12=handler$1.wrap(x$12,$it$10.info,$it$10.opt);x$12;}return x$12;}));(PatternCompiler$0.prototype["wrapAssignment"]=(function wrapAssignment(expr$2){let m$18;let m$19;let x$14;let $it$11;let self$9;$it$11=this;self$9=this;m$18=null;$16:for(m$18 of enumerate($it$11.handlers)){let $targ$23;let i$1;let h$1;let t0$22;let t1$12;t0$22=m$18;if((Array.isArray(t0$22)&&((t1$12=t0$22.length),(t1$12===2)))){i$1=t0$22[0];h$1=t0$22[1];$targ$23=(h$1.wrapBodyOrder+(i$1/1000000));(h$1["__ord"]=$targ$23);[];}else{___match_error(m$18);}}$it$11.handlers.sort((function(x$15,y$1){return (x$15.__ord<y$1.__ord);}));x$14=expr$2;m$19=null;$17:for(m$19 of $it$11.handlers){let handler$2;handler$2=m$19;x$14=handler$2.wrapAssignment(x$14,$it$11.info,$it$11.opt);x$14;}return x$14;}));__amp____colon__(PatternCompiler$0,__amp____colon__(((accum$6=({})),(accum$6["::name"]="PatternCompiler"),accum$6),((accum$7=({})),(accum$7["::egclass"]=true),accum$7)));PatternProcessor$0=(function PatternProcessor(){let $targ$24;let $targ$25;let $targ$26;let $it$12;if((!getChecker(PatternProcessor$0)(this))){$it$12=Object.create(PatternProcessor$0.prototype);}else{$it$12=this;}$targ$24=[];($it$12["temps"]=$targ$24);[];$targ$25=[];($it$12["parts"]=$targ$25);[];$targ$26=GenSym$0("t");($it$12["gen"]=$targ$26);[];return $it$12;});(PatternProcessor$0.prototype["do"]=(function(part$0){let $it$13;let self$10;$it$13=this;self$10=this;return $it$13.parts.push(["do",part$0]);}));(PatternProcessor$0.prototype["check"]=(function check(){let part$1;let tags$3;let t0$23;let m$20$0;let $it$14;let self$11;$it$14=this;self$11=this;m$20$0=arguments;t0$23=m$20$0.length;if(((t0$23>=1)&&(t0$23<=2))){part$1=m$20$0[0];if((1>=t0$23)){tags$3=({});}else{tags$3=m$20$0[1];}return $it$14.parts.push(__amp__(["check",part$1],tags$3));}else{return ___match_error(m$20$0);}}));(PatternProcessor$0.prototype["temp"]=(function temp(){let x$17;let x$18;let $targ$27;let init$0;let bridge$$21441$0;let m$22$0;let x$16;let v$5;let t0$24;let m$21$0;let $it$15;let self$12;$it$15=this;self$12=this;m$21$0=arguments;t0$24=m$21$0.length;if(((t0$24>=1)&&(t0$24<=2))){x$16=m$21$0[0];if((1>=t0$24)){v$5=null;}else{v$5=m$21$0[1];}m$22$0=x$16;bridge$$21441$0=m$22$0;if(((((x$17=bridge$$21441$0),((x$17 instanceof Array)&&(x$17[0]==="variable")))||((x$18=bridge$$21441$0),((x$18 instanceof Array)&&(x$18[0]==="symbol"))))&&(___hasprop(m$22$0,"single_assignment")&&((m$22$0.single_assignment?true:false)&&(!v$5))))){return x$16;}else{init$0=m$22$0;v$5=(v$5||["symbol",$it$15.gen()]);$targ$27=true;(v$5["single_assignment"]=$targ$27);[];$it$15.temps.push(v$5);$it$15.do(["send",["symbol","="],["data",["send",["symbol","set"],v$5],init$0]]);return v$5;}}else{return ___match_error(m$21$0);}}));(PatternProcessor$0.prototype["process"]=(function process(pattern$3,rhs$3,fns$0){let x$19;let x$20;let t$1;let t$2;let t$3;let pp$0;let x$21;let m$24;let t$4;let m$25;let acc$11;let temp$13;let fn$1;let parts$0;let t$5;let m$26;let acc$12;let temp$14;let t$6;let otherwise$0;let m$27$0;let m$28;let m$30;let end$0;let pos$0;let m$31;let acc$13;let temp$15;let nfw$0;let nbw$0;let ndflt$0;let extract_length$0;let check_length$0;let lo$0;let hi$0;let t$7;let len$0;let fw$2;let bw$2;let dflt$0;let rest$5;let subp$11;let xs$3;let xs$2;let patt$1;let projector$2;let subp$10;let unconditional$1;let ph$3$0;let checker$2;let subp$9;let checker$1;let condition$1;let subp$8;let subp$7;let value$2;let sym$0;let $$21512$0;let $$21513$0;let $$21514$0;let $$21515$0;let t0$25;let t1$13;let m$23$0;let rval$4;let $it$16;let self$13;$it$16=this;self$13=this;m$23$0=pattern$3;if(((x$19=m$23$0),((x$19 instanceof Array)&&(x$19[0]==="ignore")))){rval$4=$it$16.do(rhs$3);}else{if((($$21512$0=Array.isArray(m$23$0))&&((t0$25=m$23$0.length),((t0$25===2)&&(m$23$0[0]==="assign"))))){sym$0=m$23$0[1];rval$4=$it$16.parts.push(fns$0.assign(sym$0,rhs$3));}else{if(($$21512$0&&(($$21514$0=(t0$25===3))&&(m$23$0[0]==="replace")))){subp$7=m$23$0[1];value$2=m$23$0[2];rval$4=$it$16.process(subp$7,value$2,fns$0);}else{if(($$21514$0&&(m$23$0[0]==="test"))){condition$1=m$23$0[1];subp$8=m$23$0[2];$it$16.process(subp$8,rhs$3,fns$0);rval$4=$it$16.check(condition$1,({"test":true}));}else{if(($$21514$0&&(($$21515$0=(m$23$0[0]==="check"))&&((checker$1=m$23$0[1]),(x$20=m$23$0[2]),((x$20 instanceof Array)&&(x$20[0]==="ignore")))))){rval$4=$it$16.check(["send",checker$1,["data",rhs$3]]);}else{if($$21515$0){checker$2=m$23$0[1];subp$9=m$23$0[2];t$1=$it$16.temp(rhs$3);$it$16.check(["send",checker$2,["data",t$1]]);rval$4=$it$16.process(subp$9,t$1,fns$0);}else{if(($$21512$0&&((t0$25===4)&&(m$23$0[0]==="project")))){projector$2=m$23$0[1];subp$10=m$23$0[2];t1$13=m$23$0[3];unconditional$1=t1$13;ph$3$0=t1$13;if((ph$3$0?true:false)){t$2=$it$16.temp(["send",projector$2,["data",rhs$3]]);rval$4=$it$16.process(subp$10,t$2,fns$0);}else{t$3=$it$16.temp(["send",projector$2,["data",rhs$3]]);$it$16.check(["send",t$3,["value",0]]);rval$4=$it$16.process(subp$10,["send",t$3,["value",1]],fns$0);}}else{if(($$21512$0&&((t0$25===2)&&(m$23$0[0]==="neg")))){patt$1=m$23$0[1];pp$0=PatternProcessor$0();pp$0.process(patt$1,rhs$3,fns$0);x$21=assemble_conditions$0(pp$0);rval$4=$it$16.check(["send",["symbol","not"],["data",["void"],x$21]]);}else{if(($$21512$0&&(($$21514$0=(t0$25>=1))&&(m$23$0[0]==="all")))){xs$2=Array.prototype.slice.call(m$23$0,1);t$4=$it$16.temp(rhs$3);m$24=null;$18:for(m$24 of xs$2){let x$22;x$22=m$24;$it$16.process(x$22,t$4,fns$0);}rval$4=null;}else{if(($$21514$0&&(m$23$0[0]==="any"))){xs$3=Array.prototype.slice.call(m$23$0,1);t$5=$it$16.temp(rhs$3,["symbol",gensym$0("bridge")]);rval$4=$it$16.check(((fn$1=(function fn(x$23,rest$4){return ["send",["symbol","or"],["data",x$23,rest$4]];})),(parts$0=((acc$11=[]),(temp$13=null),(m$25=null),(function(){$19:for(m$25 of xs$3){let pp$1;let x$24;x$24=m$25;pp$1=PatternProcessor$0();pp$1.process(x$24,t$5,fns$0);temp$13=assemble_conditions$0(pp$1);acc$11.push(temp$13);}})(),acc$11)),util$0.construct(parts$0,fn$1,["symbol","false"])));}else{if(($$21514$0&&(m$23$0[0]==="object_pattern"))){subp$11=Array.prototype.slice.call(m$23$0,1);t$6=$it$16.temp(rhs$3);acc$12=[];temp$14=null;m$26=null;$20:for(m$26 of subp$11){let k$0;let v$6;let t0$26;let t1$14;let t2$3;let t3$1;t0$26=m$26;if((Array.isArray(t0$26)&&((t1$14=t0$26.length),((t1$14===2)&&((t2$3=t0$26[0]),(Array.isArray(t2$3)&&((t3$1=t2$3.length),((t3$1===2)&&(t2$3[0]==="value"))))))))){k$0=t2$3[1];v$6=t0$26[1];$it$16.check(["send",["symbol","___hasprop"],["data",t$6,["value",k$0]]]);temp$14=$it$16.process(v$6,["send",t$6,["value",k$0]],fns$0);acc$12.push(temp$14);}else{___match_error(m$26);}}rval$4=acc$12;}else{if(($$21512$0&&((t0$25===5)&&(m$23$0[0]==="array_pattern")))){fw$2=m$23$0[1];bw$2=m$23$0[2];dflt$0=m$23$0[3];rest$5=m$23$0[4];nfw$0=fw$2.length;nbw$0=bw$2.length;ndflt$0=dflt$0.length;extract_length$0=true;check_length$0=true;lo$0=(nfw$0+nbw$0);hi$0=(lo$0+ndflt$0);t$7=$it$16.temp(rhs$3);len$0=$it$16.temp(["send",t$7,["send",["symbol","."],["data",["void"],["symbol","length"]]]]);$it$16.check(((m$27$0=rest$5),((m$27$0?true:false)?["send",["symbol",">="],["data",len$0,["value",lo$0]]]:((lo$0===hi$0)?["send",["symbol","==="],["data",len$0,["value",lo$0]]]:((otherwise$0=m$27$0),["send",["symbol","and"],["data",["send",["symbol",">="],["data",len$0,["value",lo$0]]],["send",["symbol","<="],["data",len$0,["value",hi$0]]]]])))));m$28=null;$21:for(m$28 of enumerate(fw$2)){let i$2;let m$29;let t0$27;let t1$15;t0$27=m$28;if((Array.isArray(t0$27)&&((t1$15=t0$27.length),(t1$15===2)))){i$2=t0$27[0];m$29=t0$27[1];$it$16.process(m$29,["send",t$7,["value",i$2]],fns$0);}else{___match_error(m$28);}}m$30=null;$22:for(m$30 of enumerate(dflt$0)){let idx$0;let i$3;let patt$2;let value$3;let t0$28;let t1$16;let t2$4;let t3$2;t0$28=m$30;if((Array.isArray(t0$28)&&((t1$16=t0$28.length),((t1$16===2)&&((i$3=t0$28[0]),(t2$4=t0$28[1]),(Array.isArray(t2$4)&&((t3$2=t2$4.length),(t3$2===2)))))))){patt$2=t2$4[0];value$3=t2$4[1];idx$0=(i$3+nfw$0);$it$16.process(patt$2,["send",["symbol","if"],["data",["send",["symbol",">="],["data",["value",(idx$0+nbw$0)],len$0]],value$3,["send",t$7,["value",idx$0]]]],fns$0);}else{___match_error(m$30);}}if((rest$5!==undefined)){pos$0=(nfw$0+ndflt$0);if((nbw$0>0)){end$0=[["value",(-nbw$0)]];}else{end$0=[];}$it$16.process(rest$5,["send",["send",["send",["send",["symbol","Array"],["send",["symbol","."],["data",["void"],["symbol","prototype"]]]],["send",["symbol","."],["data",["void"],["symbol","slice"]]]],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",t$7,["value",pos$0]].concat(end$0)],fns$0);}else{[];}acc$13=[];temp$15=null;m$31=null;$23:for(m$31 of enumerate(bw$2)){let i$4;let m$32;let t0$29;let t1$17;t0$29=m$31;if((Array.isArray(t0$29)&&((t1$17=t0$29.length),(t1$17===2)))){i$4=t0$29[0];m$32=t0$29[1];temp$15=$it$16.process(m$32,["send",["symbol","___js_fetch"],["data",t$7,["send",["symbol","-"],["data",len$0,["value",(nbw$0-i$4)]]]]],fns$0);acc$13.push(temp$15);}else{___match_error(m$31);}}rval$4=acc$13;}else{rval$4=___match_error(m$23$0);}}}}}}}}}}}}return rval$4;}));__amp____colon__(PatternProcessor$0,__amp____colon__(((accum$8=({})),(accum$8["::name"]="PatternProcessor"),accum$8),((accum$9=({})),(accum$9["::egclass"]=true),accum$9)));assemble_conditions$0=(function assemble_conditions(pp$2){let m$33;let acc$14;let temp$16;let decls$0;let construct$0;construct$0=(function construct(ph$4$0){let x$27;let rest$7;let x$26;let x$25;let rest$6;let $$21911$0;let $$21912$0;let t0$30;let t1$18;let t2$5;let t3$3;t0$30=ph$4$0;t1$18=t0$30.length;if((t1$18===0)){return ["value",true];}else{if(((t1$18>=1)&&((t2$5=t0$30[0]),(Array.isArray(t2$5)&&((t3$3=t2$5.length),((t3$3===2)&&(t2$5[0]==="do"))))))){x$25=t2$5[1];rest$6=Array.prototype.slice.call(t0$30,1);return ["multi",x$25,construct$0(rest$6)];}else{if(((t1$18===1)&&((t2$5=t0$30[0]),(Array.isArray(t2$5)&&((t3$3=t2$5.length),((t3$3===2)&&(t2$5[0]==="check"))))))){x$26=t2$5[1];return x$26;}else{if(((t1$18>=1)&&((t2$5=t0$30[0]),(Array.isArray(t2$5)&&((t3$3=t2$5.length),((t3$3===2)&&(t2$5[0]==="check"))))))){x$27=t2$5[1];rest$7=Array.prototype.slice.call(t0$30,1);return ["send",["symbol","and"],["data",x$27,construct$0(rest$7)]];}else{return ___match_error(ph$4$0);}}}}});if(pp$2.temps.length){acc$14=[];temp$16=null;m$33=null;$24:for(m$33 of pp$2.temps){let t$8;t$8=m$33;temp$16=["declare",t$8];acc$14.push(temp$16);}decls$0=acc$14;return ["multi"].concat(decls$0).concat([construct$0(pp$2.parts)]);}else{return construct$0(pp$2.parts);}});assemble_pattern$0=(function assemble_pattern(){let m$35;let m$36;let x$35;let test$0;let lead$0;let trail$0;let construct$1;let parts$1;let t$9;let f$4;let t0$31;let m$34$0;m$34$0=arguments;t0$31=m$34$0.length;if(((t0$31>=2)&&(t0$31<=3))){parts$1=m$34$0[0];t$9=m$34$0[1];if((2>=t0$31)){f$4=null;}else{f$4=m$34$0[2];}lead$0=[];m$35=null;$25:for(m$35 of parts$1.slice(0)){let x$29;let x$28;let $$22026$0;let $$22027$0;let $$22028$0;let $$22029$0;let t0$32;let t1$19;t0$32=m$35;if((($$22027$0=Array.isArray(t0$32))&&((t1$19=t0$32.length),(($$22029$0=(t1$19===2))&&(t0$32[0]==="do"))))){x$28=t0$32[1];lead$0.push(x$28);parts$1.shift();}else{if(($$22029$0&&(t0$32[0]==="check"))){x$29=t0$32[1];break $25;}else{___match_error(m$35);}}}trail$0=[];m$36=null;$26:for(m$36 of parts$1.slice(0).reverse()){let x$31;let x$30;let $$22033$0;let $$22034$0;let $$22035$0;let $$22036$0;let t0$33;let t1$20;t0$33=m$36;if((($$22034$0=Array.isArray(t0$33))&&((t1$20=t0$33.length),(($$22036$0=(t1$20===2))&&(t0$33[0]==="do"))))){x$30=t0$33[1];trail$0.unshift(x$30);parts$1.pop();}else{if(($$22036$0&&(t0$33[0]==="check"))){x$31=t0$33[1];break $26;}else{___match_error(m$36);}}}construct$1=(function construct(ph$5$0){let other$1;let x$34;let rest$9;let x$33;let x$32;let rest$8;let $$22099$0;let $$22100$0;let t0$34;let t1$21;let t2$6;let t3$4;t0$34=ph$5$0;t1$21=t0$34.length;if((t1$21===0)){return ["value",true];}else{if(((t1$21>=1)&&((t2$6=t0$34[0]),(Array.isArray(t2$6)&&((t3$4=t2$6.length),((t3$4===2)&&(t2$6[0]==="do"))))))){x$32=t2$6[1];rest$8=Array.prototype.slice.call(t0$34,1);return ["multi",x$32,construct$1(rest$8)];}else{if(((t1$21===1)&&((t2$6=t0$34[0]),(Array.isArray(t2$6)&&((t3$4=t2$6.length),((t3$4===2)&&(t2$6[0]==="check"))))))){x$33=t2$6[1];return x$33;}else{if(((t1$21>=1)&&((t2$6=t0$34[0]),(Array.isArray(t2$6)&&((t3$4=t2$6.length),((t3$4===2)&&(t2$6[0]==="check"))))))){x$34=t2$6[1];rest$9=Array.prototype.slice.call(t0$34,1);return ["send",["symbol","and"],["data",x$34,construct$1(rest$9)]];}else{other$1=ph$5$0;throw ErrorFactory(["oops"]).create("?!?",other$1);}}}}});if(parts$1.length){test$0=construct$1(parts$1);if(f$4){x$35=["send",["symbol","if"],["data",test$0,["multi"].concat(trail$0).concat([t$9]),f$4]];}else{x$35=["send",["symbol","if"],["data",test$0,["multi"].concat(trail$0).concat([t$9])]];}return ["multi"].concat(lead$0).concat([x$35]);}else{return ["multi"].concat(lead$0).concat(trail$0).concat([t$9]);}}else{return ___match_error(m$34$0);}});inject_below_uses$0=(function inject_below_uses(ph$6$0,fn$2){let other$2;let scope$0;let x$36;let t0$35;let t1$22;t0$35=ph$6$0;t1$22=t0$35.length;if(((t1$22===3)&&(t0$35[0]==="use"))){scope$0=t0$35[1];x$36=t0$35[2];return ["use",scope$0,inject_below_uses$0(x$36,fn$2)];}else{other$2=ph$6$0;return fn$2(other$2);}});checkall$0=["send","data","multi","assign","void","check","do"];same_block$0=(function same_block(ph$7$0,ban1$0,ban2$0){let m$37;let other$3;let type1$0;let args1$0;let type2$0;let args2$0;let m1$0;let m2$0;let v1$2;let v2$2;let s1$0;let s2$0;let v1$1;let v2$1;let $$22206$0;let $$22207$0;let $$22208$0;let $$22209$0;let $$22210$0;let $$22211$0;let $$22212$0;let t0$36;let t1$23;let t2$7;let t3$5;let t4$1;let t5$1;t0$36=ph$7$0;t1$23=t0$36.length;if((($$22208$0=(t1$23===2))&&((t2$7=t0$36[0]),(($$22210$0=Array.isArray(t2$7))&&((t3$5=t2$7.length),(($$22212$0=(t3$5===2))&&((t2$7[0]==="variable")&&((v1$1=t2$7[1]),(t4$1=t0$36[1]),(Array.isArray(t4$1)&&((t5$1=t4$1.length),((t5$1===2)&&(t4$1[0]==="variable")))))))))))){v2$1=t4$1[1];return (v1$1===v2$1);}else{if(($$22212$0&&((t2$7[0]==="symbol")&&((s1$0=t2$7[1]),(t4$1=t0$36[1]),(Array.isArray(t4$1)&&((t5$1=t4$1.length),((t5$1===2)&&(t4$1[0]==="symbol")))))))){s2$0=t4$1[1];return (((!send(ban1$0,s1$0))&&(!send(ban2$0,s2$0)))&&(s1$0===s2$0));}else{if(($$22212$0&&((t2$7[0]==="value")&&((v1$2=t2$7[1]),(t4$1=t0$36[1]),(Array.isArray(t4$1)&&((t5$1=t4$1.length),((t5$1===2)&&(t4$1[0]==="value")))))))){v2$2=t4$1[1];return (v1$2===v2$2);}else{if(($$22212$0&&((t2$7[0]==="macro")&&((m1$0=t2$7[1]),(t4$1=t0$36[1]),(Array.isArray(t4$1)&&((t5$1=t4$1.length),((t5$1===2)&&(t4$1[0]==="macro")))))))){m2$0=t4$1[1];return (m1$0===m2$0);}else{if((Array.isArray(t0$36)&&((t1$23=t0$36.length),((t1$23===2)&&((t2$7=t0$36[0]),(Array.isArray(t2$7)&&((t3$5=t2$7.length),((t3$5>=1)&&((type1$0=t2$7[0]),(args1$0=Array.prototype.slice.call(t2$7,1)),(t4$1=t0$36[1]),(Array.isArray(t4$1)&&((t5$1=t4$1.length),((t5$1>=1)&&((type2$0=t4$1[0]),(args2$0=Array.prototype.slice.call(t4$1,1)),(checkall$0.indexOf(type1$0)!==-1)))))))))))))){if(((type1$0===type2$0)&&(args1$0.length===args2$0.length))){m$37=null;$27:for(m$37 of zip(args1$0,args2$0)){let pair$0;pair$0=m$37;if((!same_block$0(pair$0,ban1$0,ban2$0))){return false;}}return true;}else{return false;}}else{other$3=ph$7$0;return false;}}}}}});parse_clauses$0=(function parse_clauses(info$0,target$1,stmts$0,opt$0){let m$38;let acc$15;let temp$17;let m$40;let acc$16;let temp$18;let m$41;let acc$17;let temp$19;let decls$1;let all_temps$0;let the_parts$0;let unique_temps$0;all_temps$0=[];acc$15=[];temp$17=null;m$38=null;$28:for(m$38 of info$0.step_all(["clause"],stmts$0)){let accum$10;let t0$38;let m$39;let pc$1;let $targ$28;let vars$1;let temps$0;let blocks$0;let vars2$0;let x$37;let other$5;let b$0;let pattern$4;let body$1;let $$22356$0;let t0$37;let t1$24;t0$37=m$38;if((Array.isArray(t0$37)&&((t1$24=t0$37.length),((t1$24===3)&&(t0$37[0]==="clause"))))){pattern$4=t0$37[1];body$1=t0$37[2];pc$1=PatternCompiler$0(pattern$4,info$0,__amp__(opt$0,__amp____colon__(({"allow_arguments":false,"allow_nested":true}),((accum$10=({})),(accum$10["assign"]=(function assign(v$7,value$4){return ["do",__lt____lt____colon__$0(["assign",v$7,value$4],v$7)];})),accum$10))));pc$1.process_for_rhs(target$1);$targ$28=pc$1;t0$38=$targ$28;if((___hasprop(t0$38,"vars")&&((vars$1=t0$38.vars),(___hasprop(t0$38,"temps")&&((temps$0=t0$38.temps),___hasprop(t0$38,"parts")))))){blocks$0=t0$38.parts;}else{___match_error($targ$28);}[vars$1,temps$0,blocks$0];all_temps$0=all_temps$0.concat(temps$0);vars2$0=({});m$39=null;$29:for(m$39 of vars$1){let $targ$29;let other$4;let xxx$0;let t0$39;let t1$25;t0$39=m$39;if((Array.isArray(t0$39)&&((t1$25=t0$39.length),((t1$25===2)&&(t0$39[0]==="symbol"))))){xxx$0=t0$39[1];$targ$29=true;(vars2$0[xxx$0]=$targ$29);[];}else{other$4=m$39;throw ErrorFactory(["syntax","unexpected"]).create("Huh",({"expr":other$4}));}}if(opt$0.wrap){pc$1.handlers.push(opt$0);}temp$17=["clause",vars$1,vars2$0,blocks$0,pc$1.wrapBody(body$1)];acc$15.push(temp$17);}else{if(((x$37=t0$37),((x$37 instanceof Array)&&(x$37[0]==="block")))){b$0=t0$37;temp$17=b$0;acc$15.push(temp$17);}else{other$5=m$38;throw ErrorFactory(["syntax","clause"]).create("Illegal clause",({"clause":other$5}));acc$15.push(temp$17);}}}the_parts$0=acc$15;if(opt$0.fallback){the_parts$0.push(["block",opt$0.fallback(target$1)]);}unique_temps$0=keys(util$0.mkset(((acc$16=[]),(temp$18=null),(m$40=null),(function(){$30:for(m$40 of all_temps$0){let t$10;let t0$40;let t1$26;t0$40=m$40;if((Array.isArray(t0$40)&&((t1$26=t0$40.length),((t1$26===2)&&(t0$40[0]==="symbol"))))){t$10=t0$40[1];temp$18=t$10;acc$16.push(temp$18);}else{___match_error(m$40);}}})(),acc$16)));acc$17=[];temp$19=null;m$41=null;$31:for(m$41 of unique_temps$0){let t$11;t$11=m$41;temp$19=["declare",__amp____colon__(["symbol",t$11],({"mutable":true}))];acc$17.push(temp$19);}decls$1=acc$17;return ["multi"].concat(decls$1).concat([weave_clauses$0(the_parts$0)]);});opt_clauses$0=(function opt_clauses(clauses$0){let m$42;let acc$18;let temp$20;let m$45;let acc$19;let temp$21;let m$46;let acc$20;let temp$22;let m$47;let acc$21;let temp$23;let shares$0;let max$0;let temps$1;let shared_last$0;let idx_last$0;let new_clauses$0;acc$18=[];temp$20=null;m$42=null;$32:for(m$42 of enumerate(clauses$0.slice(1))){let t0$42;let t1$28;let m$43;let $targ$30;let varsd0$0;let blocks0$0;let share$0;let idx$1;let i$5;let vars$2;let varsd$0;let blocks$1;let body$2;let t0$41;let t1$27;let t2$8;let t3$6;t0$41=m$42;if((Array.isArray(t0$41)&&((t1$27=t0$41.length),((t1$27===2)&&((i$5=t0$41[0]),(t2$8=t0$41[1]),(Array.isArray(t2$8)&&((t3$6=t2$8.length),((t3$6===5)&&(t2$8[0]==="clause"))))))))){vars$2=t2$8[1];varsd$0=t2$8[2];blocks$1=t2$8[3];body$2=t2$8[4];$targ$30=send(clauses$0,i$5);t0$42=$targ$30;if((Array.isArray(t0$42)&&((t1$28=t0$42.length),((t1$28===5)&&(t0$42[0]==="clause"))))){t0$42[1];varsd0$0=t0$42[2];blocks0$0=t0$42[3];t0$42[4];}else{___match_error($targ$30);}[varsd0$0,blocks0$0];share$0=0;idx$1=0;m$43=null;$33:for(m$43 of blocks$1){let x$38;let x$39;let other$6;let m$44$0;let b$1;b$1=m$43;if(same_block$0([send(blocks0$0,share$0),b$1],varsd0$0,varsd$0)){(share$0++);m$44$0=b$1;if(((x$38=m$44$0),((x$38 instanceof Array)&&(x$38[0]==="do")))){null;}else{if(((x$39=m$44$0),((x$39 instanceof Array)&&(x$39[0]==="check")))){idx$1=share$0;idx$1;}else{other$6=m$44$0;__lt____gt__$0(null,other$6);}}}else{break $33;}}temp$20=[share$0,idx$1];acc$18.push(temp$20);}else{___match_error(m$42);}}shares$0=acc$18;max$0=send(send(Math,"max", true),((acc$19=[]),(temp$21=null),(m$45=null),(function(){$34:for(m$45 of shares$0){let x$40;let t0$43;let t1$29;t0$43=m$45;if((Array.isArray(t0$43)&&((t1$29=t0$43.length),(t1$29===2)))){x$40=t0$43[0];t0$43[1];temp$21=x$40;acc$19.push(temp$21);}else{___match_error(m$45);}}})(),acc$19));shares$0.push([0,0]);acc$20=[];temp$22=null;m$46=null;$35:for(m$46 of range(1,max$0)){temp$22=["symbol",gensym$0()];acc$20.push(temp$22);}temps$1=acc$20;shared_last$0=0;idx_last$0=0;acc$21=[];temp$23=null;m$47=null;$36:for(m$47 of enumerate(clauses$0)){let t0$45;let t1$31;let m$48;let acc$22;let temp$24;let rest$10;let newblocks$0;let $targ$31;let share$1;let idx$2;let shared$0;let n_to_share$0;let to_share$0;let other$7;let i$6;let vars$3;let varsd$1;let blocks$2;let body$3;let t0$44;let t1$30;let t2$9;let t3$7;t0$44=m$47;if((Array.isArray(t0$44)&&((t1$30=t0$44.length),((t1$30===2)&&((i$6=t0$44[0]),(t2$9=t0$44[1]),(Array.isArray(t2$9)&&((t3$7=t2$9.length),((t3$7===5)&&(t2$9[0]==="clause"))))))))){vars$3=t2$9[1];varsd$1=t2$9[2];blocks$2=t2$9[3];body$3=t2$9[4];$targ$31=send(shares$0,i$6);t0$45=$targ$31;if((Array.isArray(t0$45)&&((t1$31=t0$45.length),(t1$31===2)))){share$1=t0$45[0];idx$2=t0$45[1];}else{___match_error($targ$31);}[share$1,idx$2];if(idx_last$0){shared$0=[["check",send(temps$1,(idx_last$0-1))]];}else{shared$0=[];}n_to_share$0=Math.max(shared_last$0,share$1);acc$22=[];temp$24=null;m$48=null;$37:for(m$48 of enumerate(blocks$2.slice(shared_last$0,n_to_share$0))){let j$1;let x$42;let j$0;let x$41;let $$22815$0;let $$22816$0;let $$22817$0;let $$22818$0;let t0$46;let t1$32;let t2$10;let t3$8;t0$46=m$48;if((($$22816$0=Array.isArray(t0$46))&&((t1$32=t0$46.length),(($$22818$0=(t1$32===2))&&((j$0=t0$46[0]),(t2$10=t0$46[1]),(Array.isArray(t2$10)&&((t3$8=t2$10.length),((t3$8===2)&&(t2$10[0]==="check"))))))))){x$41=t2$10[1];temp$24=["check",["assign",send(temps$1,(shared_last$0+j$0)),x$41]];acc$22.push(temp$24);}else{if(($$22818$0&&((j$1=t0$46[0]),(t2$10=t0$46[1]),(Array.isArray(t2$10)&&((t3$8=t2$10.length),((t3$8===2)&&(t2$10[0]==="do"))))))){x$42=t2$10[1];temp$24=["do",x$42];acc$22.push(temp$24);}else{___match_error(m$48);}}}to_share$0=acc$22;shared_last$0=share$1;idx_last$0=idx$2;rest$10=blocks$2.slice(n_to_share$0);newblocks$0=shared$0.concat(to_share$0).concat(rest$10);temp$23=["clause",vars$3,varsd$1,newblocks$0,body$3];acc$21.push(temp$23);}else{other$7=m$47;throw ErrorFactory(["oops"]).create("what",({"value":other$7}));acc$21.push(temp$23);}}new_clauses$0=acc$21;return [temps$1,new_clauses$0];});weave_clauses$0=(function weave_clauses(parts$2){let m$49;let m$52;let acc$24;let temp$27;let groups$0;let reassemble$0;let new_temps$0;let helper$0;groups$0=classify_contiguous$0(parts$2,(function(temp$25$0){let t0$47;let t1$33;let cls$0;t0$47=temp$25$0;if((Array.isArray(t0$47)&&((t1$33=t0$47.length),(t1$33>=1)))){cls$0=t0$47[0];Array.prototype.slice.call(t0$47,1);}else{___match_error(temp$25$0);}return cls$0;}));reassemble$0=[];new_temps$0=[];m$49=null;$38:for(m$49 of groups$0){let t0$49;let t1$35;let $targ$32;let ts$0;let new_clauses$1;let elems$1;let elems$0;let $$22925$0;let $$22926$0;let $$22927$0;let $$22928$0;let t0$48;let t1$34;t0$48=m$49;if((($$22926$0=Array.isArray(t0$48))&&((t1$34=t0$48.length),(($$22928$0=(t1$34>=1))&&(t0$48[0]==="clause"))))){elems$0=Array.prototype.slice.call(t0$48,1);$targ$32=opt_clauses$0(elems$0);t0$49=$targ$32;if((Array.isArray(t0$49)&&((t1$35=t0$49.length),(t1$35===2)))){ts$0=t0$49[0];new_clauses$1=t0$49[1];}else{___match_error($targ$32);}[ts$0,new_clauses$1];new_temps$0=new_temps$0.concat(ts$0);reassemble$0=reassemble$0.concat(new_clauses$1);}else{if(($$22928$0&&(t0$48[0]==="block"))){elems$1=Array.prototype.slice.call(t0$48,1);reassemble$0=reassemble$0.concat(elems$1);}else{___match_error(m$49);}}}helper$0=(function helper(ph$8$0){let m$50;let acc$23;let temp$26;let decls$2;let vars$4;let varsd$2;let blocks$3;let body$5;let rest$12;let body$4;let rest$11;let $$22998$0;let $$22999$0;let $$23000$0;let $$23001$0;let $$23002$0;let $$23003$0;let t0$50;let t1$36;let t2$11;let t3$9;let t4$2;let t5$2;let t6$0;t0$50=ph$8$0;t1$36=t0$50.length;if((t1$36===0)){return ["multi"];}else{if((($$23000$0=(t1$36>=1))&&((t2$11=t0$50[0]),(($$23002$0=Array.isArray(t2$11))&&((t3$9=t2$11.length),((t3$9===2)&&((t2$11[0]==="block")&&((t4$2=getProjector(Body$0)(t2$11[1])),(t4$2[0]&&((t5$2=t4$2[1]),(t6$0=t5$2.length),(t6$0>=0))))))))))){body$4=Array.prototype.slice.call(t5$2,0);rest$11=Array.prototype.slice.call(t0$50,1);return ["multi"].concat(body$4).concat([helper$0(rest$11)]);}else{if(($$23002$0&&((t3$9===5)&&(t2$11[0]==="clause")))){vars$4=t2$11[1];varsd$2=t2$11[2];blocks$3=t2$11[3];body$5=t2$11[4];rest$12=Array.prototype.slice.call(t0$50,1);acc$23=[];temp$26=null;m$50=null;$39:for(m$50 of vars$4){let bridge$$23081$0;let m$51$0;let v$8;v$8=m$50;m$51$0=v$8.declare_mode;if((m$51$0==="set")){temp$26=["splice"];}else{if((m$51$0==="let")){temp$26=["declare",__amp__(v$8,({"mutable":false}))];}else{if((m$51$0==="var")){temp$26=["declare",__amp__(v$8,({"mutable":true}))];}else{bridge$$23081$0=m$51$0;if(((bridge$$23081$0==="unqualified")||(bridge$$23081$0===(void 0)))){temp$26=["declare",__amp__(v$8,({"mutable":false}))];}else{temp$26=___match_error(m$51$0);}}}}acc$23.push(temp$26);}decls$2=acc$23;return ["tagscope","back",["multi"].concat(decls$2).concat([assemble_pattern$0(blocks$3,body$5,["use","back",helper$0(rest$12)])])];}else{return ___match_error(ph$8$0);}}}});return ["multi"].concat(((acc$24=[]),(temp$27=null),(m$52=null),(function(){$40:for(m$52 of new_temps$0){let t$12;t$12=m$52;temp$27=["declare",t$12];acc$24.push(temp$27);}})(),acc$24)).concat([helper$0(reassemble$0)]);});$targ$33=PatternCompiler$0;(exports["PatternCompiler"]=$targ$33);[];$targ$34=parse_clauses$0;(exports["parse_clauses"]=$targ$34);[];
//# sourceMappingURL=pattern.js.map

