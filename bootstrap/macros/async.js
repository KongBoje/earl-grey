
'use strict';require('earlgrey-runtime/6');let $targ$0;let $0$0;let expr_mac$0;let expr_mac2$0;let AssignmentHandler$0;$0$0=require("./helpers");expr_mac$0=getProperty($0$0,"expr_mac","./helpers");expr_mac2$0=getProperty($0$0,"expr_mac2","./helpers");AssignmentHandler$0=getProperty($0$0,"AssignmentHandler","./helpers");$targ$0=(function(mac$0){let t0$3;let t0$7;let t0$13;let t0$20;let $targ$1;let yield_mac$0;let $targ$2;let await_mac$0;let $targ$3;let gen_mac$0;let $targ$4;let async_mac$0;let exports$0;exports$0=({});$targ$1=(function(ph$0$0,temp$0$0,form$0,arg$0){let x$0;let subp$0;let w$0;let t0$0;let t0$1;let arg$2;let arg$1;let t0$2;let t1$0;let t2$0;let m$0$0;let otherwise$0;let bridge$$5447$0;if(((x$0=ph$0$0),((x$0 instanceof Array)&&(x$0[0]==="pattern")))){if(equal(arg$0,["void"])){subp$0=null;}else{subp$0=arg$0;}w$0=(function w(ph$1){return ["send",["symbol","yield"],ph$1];});return ["special",AssignmentHandler$0(subp$0,w$0)];}else{bridge$$5447$0=ph$0$0;if(((Array.isArray(bridge$$5447$0)&&((t0$0=bridge$$5447$0.length),((t0$0===2)&&((bridge$$5447$0[0]==="expr")&&(bridge$$5447$0[1]==="expr")))))||(Array.isArray(bridge$$5447$0)&&((t0$1=bridge$$5447$0.length),((t0$1===2)&&((bridge$$5447$0[0]==="expr")&&(bridge$$5447$0[1]==="head"))))))){m$0$0=arg$0;if((Array.isArray(m$0$0)&&((t0$2=m$0$0.length),((t0$2===3)&&((m$0$0[0]==="send")&&((t1$0=m$0$0[1]),(Array.isArray(t1$0)&&((t2$0=t1$0.length),((t2$0===2)&&((t1$0[0]==="symbol")&&(t1$0[1]==="all"))))))))))){arg$1=m$0$0[2];return ["js_yield",arg$1,["value",true]];}else{arg$2=m$0$0;return ["js_yield",arg$2,["value",false]];}}else{otherwise$0=ph$0$0;return ["nostep",form$0];}}});t0$3=getProjector(mac$0("yield"))($targ$1);if(t0$3[0]){yield_mac$0=t0$3[1];}else{___match_error($targ$1,"mac{\"yield\"}! yield_mac{match, _, form, arg}");}$targ$2=(function(ph$2$0,temp$1$0,form$1,arg$3){let x$1;let subp$1;let w$1;let t0$4;let t0$5;let arg$6;let arg$5;let arg$4;let $$5588$0;let $$5589$0;let $$5590$0;let $$5591$0;let $$5592$0;let $$5593$0;let $$5594$0;let $$5595$0;let $$5596$0;let t0$6;let t1$1;let t2$1;let m$1$0;let otherwise$1;let bridge$$5537$0;if(((x$1=ph$2$0),((x$1 instanceof Array)&&(x$1[0]==="pattern")))){if(equal(arg$3,["void"])){subp$1=null;}else{subp$1=arg$3;}w$1=(function w(ph$3){return ["send",["symbol","await"],ph$3];});return ["special",AssignmentHandler$0(subp$1,w$1)];}else{bridge$$5537$0=ph$2$0;if(((Array.isArray(bridge$$5537$0)&&((t0$4=bridge$$5537$0.length),((t0$4===2)&&((bridge$$5537$0[0]==="expr")&&(bridge$$5537$0[1]==="expr")))))||(Array.isArray(bridge$$5537$0)&&((t0$5=bridge$$5537$0.length),((t0$5===2)&&((bridge$$5537$0[0]==="expr")&&(bridge$$5537$0[1]==="head"))))))){m$1$0=arg$3;if((($$5588$0=Array.isArray(m$1$0))&&((t0$6=m$1$0.length),(($$5590$0=(t0$6===3))&&(($$5591$0=(m$1$0[0]==="send"))&&((t1$1=m$1$0[1]),(($$5593$0=Array.isArray(t1$1))&&((t2$1=t1$1.length),(($$5595$0=(t2$1===2))&&(($$5596$0=(t1$1[0]==="symbol"))&&(t1$1[1]==="all"))))))))))){arg$4=m$1$0[2];return ["js_yield",["send",["send",["symbol","Promise"],["send",["symbol","."],["data",["void"],["symbol","all"]]]],["data",arg$4]],["value",false]];}else{if(($$5596$0&&(t1$1[1]==="any"))){arg$5=m$1$0[2];return ["js_yield",["send",["send",["symbol","Promise"],["send",["symbol","."],["data",["void"],["symbol","race"]]]],["data",arg$5]],["value",false]];}else{arg$6=m$1$0;return ["js_yield",arg$6,["value",false]];}}}else{otherwise$1=ph$2$0;return ["nostep",form$1];}}});t0$7=getProjector(mac$0("await"))($targ$2);if(t0$7[0]){await_mac$0=t0$7[1];}else{___match_error($targ$2,"mac{\"await\"}! await_mac{match, _, form, arg}");}$targ$3=(function(ph$4$0,info$0,form$2,expr$0){let x$2;let mac$1;let t0$11;let t1$5;let t2$5;let t3$3;let t4$2;let t5$2;let t6$1;let t0$12;let t1$6;let t2$6;let t3$4;let t4$3;let arg$10;let pre$1;let body$3;let post$1;let arg$9;let body$2;let bridge$$5642$0;let t0$10;let t1$4;let t2$4;let t3$2;let t4$1;let t5$1;let t6$0;let t7$0;let ph$5$0;if(equal(expr$0,["void"])){return ["nostep",form$2];}else{if(((x$2=ph$4$0),((x$2 instanceof Array)&&(x$2[0]==="pattern")))){mac$1=(function mac(){let arg$8;let pre$0;let body$1;let post$0;let arg$7;let body$0;let env$0;let x$3;let $$5671$0;let $$5672$0;let $$5673$0;let $$5674$0;let $$5675$0;let $$5676$0;let $$5677$0;let $$5678$0;let $$5679$0;let t0$9;let t1$3;let t2$3;let t3$1;let t4$0;let t5$0;let e$0;let ph$7$0;let blah$0;let t0$8;let t1$2;let t2$2;let t3$0;let m$2$0;m$2$0=arguments;t0$8=m$2$0.length;if(((t0$8>=1)&&((blah$0=Array.prototype.slice.call(m$2$0,0,-1)),(t1$2=m$2$0[(t0$8-1)]),(Array.isArray(t1$2)&&((t2$2=t1$2.length),((t2$2===2)&&(t1$2[0]==="data"))))))){t3$0=t1$2[1];e$0=t3$0;ph$7$0=t3$0;t0$9=ph$7$0;t1$3=t0$9.length;if((($$5673$0=(t1$3===3))&&(t0$9[0]==="use"))){env$0=t0$9[1];x$3=t0$9[2];return ["use",env$0,mac$1.call(this,["data",x$3])];}else{if(($$5673$0&&(($$5674$0=(t0$9[0]==="send"))&&((t2$3=t0$9[1]),(($$5676$0=Array.isArray(t2$3))&&((t3$1=t2$3.length),(($$5678$0=(t3$1===2))&&(($$5679$0=(t2$3[0]==="symbol"))&&((t2$3[1]==="->")&&((t4$0=t0$9[2]),(Array.isArray(t4$0)&&((t5$0=t4$0.length),((t5$0===3)&&(t4$0[0]==="data")))))))))))))){arg$7=t4$0[1];body$0=t4$0[2];return ["send",["symbol","*->"],["data",arg$7,body$0]];}else{if(($$5679$0&&((t2$3[1]==="_lambda")&&((t4$0=t0$9[2]),(Array.isArray(t4$0)&&((t5$0=t4$0.length),((t5$0===6)&&(t4$0[0]==="data")))))))){arg$8=t4$0[1];pre$0=t4$0[2];body$1=t4$0[3];post$0=t4$0[4];t4$0[5];return ["send",["symbol","_lambda"],["data",arg$8,pre$0,body$1,post$0,["value",true]]];}else{throw ErrorFactory(["syntax","gen"]).create("gen must decorate a function",({"node":e$0}));}}}}else{return ___match_error(m$2$0,"{*blah, #data{match e}}");}});return ["project",["macro",mac$1],expr$0,true];}else{ph$5$0=expr$0;bridge$$5642$0=ph$5$0;if(((Array.isArray(bridge$$5642$0)&&((t0$11=bridge$$5642$0.length),((t0$11===2)&&((bridge$$5642$0[0]==="data")&&((t1$5=bridge$$5642$0[1]),(Array.isArray(t1$5)&&((t2$5=t1$5.length),((t2$5===3)&&((t1$5[0]==="send")&&((t3$3=t1$5[1]),(Array.isArray(t3$3)&&((t4$2=t3$3.length),((t4$2===2)&&((t3$3[0]==="symbol")&&((t3$3[1]==="->")&&((t5$2=t1$5[2]),(Array.isArray(t5$2)&&((t6$1=t5$2.length),((t6$1===3)&&((t5$2[0]==="data")&&((arg$9=t5$2[1]),(body$2=t5$2[2]),true)))))))))))))))))))))||(Array.isArray(bridge$$5642$0)&&((t0$12=bridge$$5642$0.length),((t0$12===3)&&((bridge$$5642$0[0]==="send")&&((t1$6=bridge$$5642$0[1]),(Array.isArray(t1$6)&&((t2$6=t1$6.length),((t2$6===2)&&((t1$6[0]==="symbol")&&((t1$6[1]==="->")&&((t3$4=bridge$$5642$0[2]),(Array.isArray(t3$4)&&((t4$3=t3$4.length),((t4$3===3)&&((t3$4[0]==="data")&&((arg$9=t3$4[1]),(body$2=t3$4[2]),true)))))))))))))))))){return ["send",["symbol","*->"],["data",arg$9,body$2]];}else{t0$10=ph$5$0;t1$4=t0$10.length;if(((t1$4===2)&&((t0$10[0]==="data")&&((t2$4=t0$10[1]),(Array.isArray(t2$4)&&((t3$2=t2$4.length),((t3$2===3)&&((t2$4[0]==="send")&&((t4$1=t2$4[1]),(Array.isArray(t4$1)&&((t5$1=t4$1.length),((t5$1===2)&&((t4$1[0]==="symbol")&&((t4$1[1]==="_lambda")&&((t6$0=t2$4[2]),(Array.isArray(t6$0)&&((t7$0=t6$0.length),((t7$0===6)&&(t6$0[0]==="data"))))))))))))))))))){arg$10=t6$0[1];pre$1=t6$0[2];body$3=t6$0[3];post$1=t6$0[4];t6$0[5];return ["send",["symbol","_lambda"],["data",arg$10,pre$1,body$3,post$1,["value",true]]];}else{throw ErrorFactory(["syntax","gen"]).create("gen must be applied on a function",({"expr":expr$0}));}}}}});t0$13=getProjector(mac$0("gen"))($targ$3);if(t0$13[0]){gen_mac$0=t0$13[1];}else{___match_error($targ$3,"mac{\"gen\"}! gen_mac{match, info, form, expr}");}$targ$4=(function(ph$8$0,info$1,form$3,expr$1){let x$4;let mac$2;let t0$17;let t1$10;let t2$10;let t3$8;let t4$6;let t5$5;let t6$3;let t0$18;let t1$11;let t2$11;let t3$9;let t4$7;let t0$19;let x$6;let arg$14;let pre$3;let body$7;let post$3;let arg$13;let body$6;let bridge$$5896$0;let t0$16;let t1$9;let t2$9;let t3$7;let t4$5;let t5$4;let t6$2;let t7$1;let bridge$$5899$0;let ph$9$0;if(equal(expr$1,["void"])){return ["nostep",form$3];}else{if(((x$4=ph$8$0),((x$4 instanceof Array)&&(x$4[0]==="pattern")))){mac$2=(function mac(){let arg$12;let pre$2;let body$5;let post$2;let arg$11;let body$4;let env$1;let x$5;let $$5926$0;let $$5927$0;let $$5928$0;let $$5929$0;let $$5930$0;let $$5931$0;let $$5932$0;let $$5933$0;let $$5934$0;let t0$15;let t1$8;let t2$8;let t3$6;let t4$4;let t5$3;let e$1;let ph$11$0;let blah$1;let t0$14;let t1$7;let t2$7;let t3$5;let m$3$0;m$3$0=arguments;t0$14=m$3$0.length;if(((t0$14>=1)&&((blah$1=Array.prototype.slice.call(m$3$0,0,-1)),(t1$7=m$3$0[(t0$14-1)]),(Array.isArray(t1$7)&&((t2$7=t1$7.length),((t2$7===2)&&(t1$7[0]==="data"))))))){t3$5=t1$7[1];e$1=t3$5;ph$11$0=t3$5;t0$15=ph$11$0;t1$8=t0$15.length;if((($$5928$0=(t1$8===3))&&(t0$15[0]==="use"))){env$1=t0$15[1];x$5=t0$15[2];return ["use",env$1,mac$2.call(this,["data",x$5])];}else{if(($$5928$0&&(($$5929$0=(t0$15[0]==="send"))&&((t2$8=t0$15[1]),(($$5931$0=Array.isArray(t2$8))&&((t3$6=t2$8.length),(($$5933$0=(t3$6===2))&&(($$5934$0=(t2$8[0]==="symbol"))&&((t2$8[1]==="->")&&((t4$4=t0$15[2]),(Array.isArray(t4$4)&&((t5$3=t4$4.length),((t5$3===3)&&(t4$4[0]==="data")))))))))))))){arg$11=t4$4[1];body$4=t4$4[2];return ["send",["symbol","->"],["data",arg$11,["send",["send",["symbol","spawn"],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",["symbol","this"],["send",["symbol","*->"],["data",["data"],body$4]]]]]];}else{if(($$5934$0&&((t2$8[1]==="_lambda")&&((t4$4=t0$15[2]),(Array.isArray(t4$4)&&((t5$3=t4$4.length),((t5$3===6)&&(t4$4[0]==="data")))))))){arg$12=t4$4[1];pre$2=t4$4[2];body$5=t4$4[3];post$2=t4$4[4];t4$4[5];return ["send",["symbol","_lambda"],["data",arg$12,pre$2,["send",["send",["symbol","spawn"],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",["symbol","this"],["send",["symbol","*->"],["data",["data"],body$5]]]],post$2,["value",false]]];}else{throw ErrorFactory(["syntax","async"]).create("async must decorate a function",({"node":e$1}));}}}}else{return ___match_error(m$3$0,"{*blah, #data{match e}}");}});return ["project",["macro",mac$2],expr$1,true];}else{ph$9$0=expr$1;bridge$$5896$0=ph$9$0;if(((Array.isArray(bridge$$5896$0)&&((t0$17=bridge$$5896$0.length),((t0$17===2)&&((bridge$$5896$0[0]==="data")&&((t1$10=bridge$$5896$0[1]),(Array.isArray(t1$10)&&((t2$10=t1$10.length),((t2$10===3)&&((t1$10[0]==="send")&&((t3$8=t1$10[1]),(Array.isArray(t3$8)&&((t4$6=t3$8.length),((t4$6===2)&&((t3$8[0]==="symbol")&&((t3$8[1]==="->")&&((t5$5=t1$10[2]),(Array.isArray(t5$5)&&((t6$3=t5$5.length),((t6$3===3)&&((t5$5[0]==="data")&&((arg$13=t5$5[1]),(body$6=t5$5[2]),true)))))))))))))))))))))||(Array.isArray(bridge$$5896$0)&&((t0$18=bridge$$5896$0.length),((t0$18===3)&&((bridge$$5896$0[0]==="send")&&((t1$11=bridge$$5896$0[1]),(Array.isArray(t1$11)&&((t2$11=t1$11.length),((t2$11===2)&&((t1$11[0]==="symbol")&&((t1$11[1]==="->")&&((t3$9=bridge$$5896$0[2]),(Array.isArray(t3$9)&&((t4$7=t3$9.length),((t4$7===3)&&((t3$9[0]==="data")&&((arg$13=t3$9[1]),(body$6=t3$9[2]),true)))))))))))))))))){return ["send",["symbol","->"],["data",arg$13,["send",["send",["symbol","spawn"],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",["symbol","this"],["send",["symbol","*->"],["data",["data"],body$6]]]]]];}else{t0$16=ph$9$0;t1$9=t0$16.length;if(((t1$9===2)&&((t0$16[0]==="data")&&((t2$9=t0$16[1]),(Array.isArray(t2$9)&&((t3$7=t2$9.length),((t3$7===3)&&((t2$9[0]==="send")&&((t4$5=t2$9[1]),(Array.isArray(t4$5)&&((t5$4=t4$5.length),((t5$4===2)&&((t4$5[0]==="symbol")&&((t4$5[1]==="_lambda")&&((t6$2=t2$9[2]),(Array.isArray(t6$2)&&((t7$1=t6$2.length),((t7$1===6)&&(t6$2[0]==="data"))))))))))))))))))){arg$14=t6$2[1];pre$3=t6$2[2];body$7=t6$2[3];post$3=t6$2[4];t6$2[5];return ["send",["symbol","_lambda"],["data",arg$14,pre$3,["send",["send",["symbol","spawn"],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",["symbol","this"],["send",["symbol","*->"],["data",["data"],body$7]]]],post$3,["value",false]]];}else{bridge$$5899$0=ph$9$0;if(((Array.isArray(bridge$$5899$0)&&((t0$19=bridge$$5899$0.length),((t0$19===2)&&((bridge$$5899$0[0]==="data")&&((x$6=bridge$$5899$0[1]),true)))))||((x$6=bridge$$5899$0),true))){return ["send",["send",["symbol","spawn"],["send",["symbol","."],["data",["void"],["symbol","call"]]]],["data",["symbol","this"],["send",["symbol","*->"],["data",["data"],["multi",["send",["symbol","try"],["data",["send",["symbol","await"],x$6]]],["send",["symbol","catch"],["data",["symbol","e"],["send",["send",["symbol","console"],["send",["symbol","."],["data",["void"],["symbol","error"]]]],["data",["send",["symbol","e"],["send",["symbol","."],["data",["void"],["symbol","stack"]]]]]]]]]]]]];}else{return ___match_error(ph$9$0,"`{^x}` or x");}}}}}});t0$20=getProjector(mac$0("async"))($targ$4);if(t0$20[0]){async_mac$0=t0$20[1];}else{___match_error($targ$4,"mac{\"async\"}! async_mac{match, info, form, expr}");}return exports$0;});(module["exports"]=$targ$0);(void 0);
//# sourceMappingURL=async.js.map

