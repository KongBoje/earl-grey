//# sourceMappingURL=/home/olivier/git/earl-grey/src/macros/macrodef.js.map
'use strict';require('earlgrey-runtime');let $targ$0;let $0$0;let Env$0;let topscope$0;let $1$0;let ctx_mac$0;let expr_mac2$0;$0$0=require("../expand");Env$0=$0$0.Env;topscope$0=$0$0.topscope;$1$0=require("./helpers");ctx_mac$0=$1$0.ctx_mac;expr_mac2$0=$1$0["expr_mac2"];$targ$0=(function(mac$0){let t0$1;let t0$3;let t0$7;let t0$9;let wrap_macro$0;let wrap_macro_func$0;let $targ$1;let macro_mac$0;let $targ$2;let cmacro_mac$0;let $targ$3;let macros_mac$0;let $targ$4;let oldmacro_mac$0;let exports$0;exports$0=({});wrap_macro$0=(function wrap_macro(info$0,mac$1){let mac2$0;mac2$0=(function mac2(c$0,s$0,f$0,e$0){let bindings$0;let env$0;let $targ$5;let r$0;bindings$0=info$0.env.list_bindings(info$0.scope);env$0=Env$0();$targ$5=bindings$0;(env$0.scopes[topscope$0.name]=$targ$5);[];r$0=mac$1.call(info$0,c$0,s$0,f$0,e$0);return env$0.mark(r$0);});return ["macro",mac2$0];});wrap_macro_func$0=(function wrap_macro_func(info$1,args$0,body$0){let it$0;it$0=info$1.env.mark(["symbol","@"]);return ["send",["symbol","_lambda"],["data",args$0,["send",["symbol","="],["data",it$0,["symbol","this"]]],body$0,["value",null]]];});$targ$1=(function(context$0,info$2,form$0,ph$0$0){let mac$2;let name$0;let sym$0;let arguments$1;let ast$0;let t0$0;let t1$0;let t2$0;let t3$0;let t4$0;let t5$0;t0$0=ph$0$0;t1$0=t0$0.length;if(((t1$0===3)&&((t0$0[0]==="data")&&((t2$0=t0$0[1]),((t2$0 instanceof Array)&&((t3$0=t2$0.length),((t3$0===3)&&((t2$0[0]==="send")&&((t4$0=t2$0[1]),(name$0=t4$0),((t4$0 instanceof Array)&&((t5$0=t4$0.length),((t5$0===2)&&(t4$0[0]==="symbol"))))))))))))){sym$0=t4$0[1];arguments$1=t2$0[2];ast$0=t0$0[2];mac$2=info$2.go(wrap_macro_func$0(info$2,arguments$1,ast$0),"parse","eval");return ["declare_raw",name$0,wrap_macro$0(info$2,expr_mac2$0(mac$2))];}else{return ___match_error(ph$0$0);}});t0$1=getProjector(mac$0("macro"))($targ$1);if(t0$1[0]){macro_mac$0=t0$1[1];}else{___match_error($targ$1);}$targ$2=(function(context$1,info$3,form$1,ph$1$0){let mac$3;let name$1;let sym$1;let arguments$2;let ast$1;let t0$2;let t1$1;let t2$1;let t3$1;let t4$1;let t5$1;t0$2=ph$1$0;t1$1=t0$2.length;if(((t1$1===3)&&((t0$2[0]==="data")&&((t2$1=t0$2[1]),((t2$1 instanceof Array)&&((t3$1=t2$1.length),((t3$1===3)&&((t2$1[0]==="send")&&((t4$1=t2$1[1]),(name$1=t4$1),((t4$1 instanceof Array)&&((t5$1=t4$1.length),((t5$1===2)&&(t4$1[0]==="symbol"))))))))))))){sym$1=t4$1[1];arguments$2=t2$1[2];ast$1=t0$2[2];mac$3=info$3.go(wrap_macro_func$0(info$3,arguments$2,ast$1),"parse","eval");return ["declare_raw",name$1,wrap_macro$0(info$3,ctx_mac$0(mac$3))];}else{return ___match_error(ph$1$0);}});t0$3=getProjector(mac$0("cmacro"))($targ$2);if(t0$3[0]){cmacro_mac$0=t0$3[1];}else{___match_error($targ$2);}$targ$3=(function(context$2,info$4,temp$0$0,temp$1$0){let t0$4;let t0$5;let t1$2;let m$0;let acc$0;let temp$2;let the_macros$0;let form$2;let env$1;let body$1;t0$4=temp$0$0;form$2=t0$4;if(___hasprop(t0$4,"env")){env$1=t0$4.env;}else{___match_error(temp$0$0);}t0$5=temp$1$0;if(((t0$5 instanceof Array)&&((t1$2=t0$5.length),((t1$2===2)&&(t0$5[0]==="data"))))){body$1=t0$5[1];}else{___match_error(temp$1$0);}the_macros$0=info$4.go(body$1,"parse","eval");return ["splice"].concat(((acc$0=[]),(temp$2=null),(m$0=null),(function(){$2:for(m$0 of items(the_macros$0)){let k$0;let v$0;let t0$6;let t1$3;t0$6=m$0;if(((t0$6 instanceof Array)&&((t1$3=t0$6.length),(t1$3===2)))){k$0=t0$6[0];v$0=t0$6[1];temp$2=["declare_raw",__amp____colon__(["symbol",k$0],({"env":env$1})),["macro",v$0]];acc$0.push(temp$2);}else{___match_error(m$0,"/home/olivier/git/earl-grey/src/macros/macrodef.eg",1138,1234);}}})(),acc$0));});t0$7=getProjector(mac$0("macros"))($targ$3);if(t0$7[0]){macros_mac$0=t0$7[1];}else{___match_error($targ$3);}$targ$4=(function(context$3,info$5,form$3,ph$2$0){let mac$4;let name$2;let sym$2;let arguments$3;let ast$2;let t0$8;let t1$4;let t2$2;let t3$2;let t4$2;let t5$2;t0$8=ph$2$0;t1$4=t0$8.length;if(((t1$4===3)&&((t0$8[0]==="data")&&((t2$2=t0$8[1]),((t2$2 instanceof Array)&&((t3$2=t2$2.length),((t3$2===3)&&((t2$2[0]==="send")&&((t4$2=t2$2[1]),(name$2=t4$2),((t4$2 instanceof Array)&&((t5$2=t4$2.length),((t5$2===2)&&(t4$2[0]==="symbol"))))))))))))){sym$2=t4$2[1];arguments$3=t2$2[2];ast$2=t0$8[2];mac$4=info$5.go(["send",["symbol","->"],["data",arguments$3,ast$2]],"parse","eval");return ["declare_raw",name$2,wrap_macro$0(info$5,mac$4)];}else{return ___match_error(ph$2$0);}});t0$9=getProjector(mac$0("oldmacro"))($targ$4);if(t0$9[0]){oldmacro_mac$0=t0$9[1];}else{___match_error($targ$4);}return exports$0;});(module["exports"]=$targ$0);[];
