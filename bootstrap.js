var ___lib=require("./lib");var special_ops=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",":":"IFX",".":"PFX"});var regexps=function(){var id=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))");var id_f=function(m,wsb,wsa,last_op){return ["ID","ID",m[0]];};var num=RegExp("(?:^((?:\\d+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:\\d+)))?))");var num_f=function(m,wsb,wsa,last_op){return ["ID","NUM",m[0]];};var str=RegExp("(?:^\"((?:(?:(?:\\\\\\\\|\\\\\")|[^\"])*))\")");var str_f=function(m,wsb,wsa,last_op){var repl=({"\\\"":"\"","\\\\":"\\","\\n":"\n"});var r=m[1].replace(RegExp("((?:(?:\\\\\"|\\\\\\\\)|\\\\n))","g"),function(m){return repl[m];});return ["ID","STR",r];};var op=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!#.:]+))");var op2=RegExp("(?:^[\\(\\[\\{\\}\\]\\),])");var op3=RegExp("(?:^(?:(?:(?:(?:(?:with|where)|and)|or)|in)|instanceof)\\b)");var op_f=function(m,wsb,wsa,last_op){var op=m[0];if((op in special_ops)){var fixity=special_ops[op];var width=function(){if((fixity=="IFX")){if((wsb||wsa)){return "wide";}else{return "short";}}else{if((fixity=="SFX")){if(wsb){return "wide";}else{return "short";}}else{if((fixity=="PFX")){if(wsa){return "wide";}else{return "short";}}else{return false;}}}}();return ["OP",fixity,width,op];}else{if((wsa&&wsb)){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "IFX";}else{return false;}}}(),"wide",op];}else{if(((!wsa)&&(!wsb))){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "IFX";}else{return false;}}}(),"short",op];}else{if(wsa){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "SFX";}else{return false;}}}(),"short",op];}else{if(wsb){return ["OP","PFX","short",op];}else{if(true){return ["OP","PFX","short",op];}else{return false;}}}}}}};var indent=RegExp("(?:^(?:(?:\n(?: *))+))");var indent_f=function(m,wsb,wsa,last_op){return ["OP","IFX","wide",","];};var cmnt=RegExp("(?:^;(?:[^\n]*))");var cmnt_f=function(m,wsb,wsa,last_op){return ["IGNORE"];};var unkn=RegExp("(?:^.)");var unkn_f=function(m,wsb,wsa,last_op){throw ("unknown character: "+m[0]);};return [[op3,op_f],[id,id_f],[num,num_f],[str,str_f],[op,op_f],[op2,op_f],[indent,indent_f],[cmnt,cmnt_f],[unkn,unkn_f]];}();var ws_re=RegExp("(?:(?: *)(?:(?:\n(?: *)\\\\(?: *))*))");var tokenize=function(text){var last_op=true;var results=[];var wsb=text.match(ws_re)[0].length;(text=text.slice(wsb));(pos=wsb);while(text){for(var i=0;(i<regexps.length);(++i)){var spec=regexps[i];var re=spec[0];var m=text.match(re);if(m){var fn=spec[1];var skip=m[0].length;(text=text.slice(skip));var wsa=text.match(ws_re)[0].length;var r=fn(m,(wsb>0),(wsa>0),last_op);var type=r[0];var result=r.slice(1);(result.location=[pos,(pos+skip)]);var _tmp0=undefined;var _tmp1=undefined;var _tmp2=undefined;if(((_tmp2=type),(_tmp2=="IGNORE"))){null;}else{if(((_tmp1=type),(_tmp1=="ID"))){if((!last_op)){var w=["IFX",function(){if((wsa||wsb)){return "wide";}else{return "short";}}(),"WHITE"];(w.location=[pos,pos]);results.push(w);}else{false;}results.push(result);(last_op=false);}else{if(((_tmp0=type),(_tmp0=="OP"))){if(last_op){var v=["VOID"];(v.location=[pos,pos]);results.push(v);}else{false;}var _tmp3=undefined;var _tmp4=undefined;var _tmp5=undefined;if(((_tmp5=result[0]),(_tmp5=="IFX"))){results.push(result);(last_op=true);}else{if(((_tmp4=result[0]),(_tmp4=="PFX"))){if((!last_op)){var w=["IFX",function(){if((wsa||wsb)){return "wide";}else{return "short";}}(),"WHITE"];(w.location=[pos,pos]);var v=["VOID"];(v.location=[pos,pos]);results.push(w);results.push(v);}else{false;}results.push(result);(last_op=true);}else{if(((_tmp3=result[0]),(_tmp3=="SFX"))){results.push(result);var v=["VOID"];(v.location=[(pos+skip),(pos+skip)]);results.push(v);(last_op=false);}else{throw "Could not find a match";}}}}else{throw "Could not find a match";}}}(text=text.slice(wsa));(wsb=wsa);(pos=((pos+skip)+wsa));break;}else{false;}}}if(last_op){var v=["VOID"];(v.location=[pos,pos]);results.push(v);}else{false;}return results;};var MAX=(1/0);var order_map=({"IFX":({"wide":({"default":[900,901],"WHITE":[1000,1001],",":[1,1],"with":[11,10],"where":[11,10],"->":[11,10],"=>":[11,10],"=":[11,10],":=":[11,10],"+":[300,301],"*":[400,401],"**":[501,500],":":[1001,2]}),"short":({"default":[1900,1901],"WHITE":[2000,2001],",":[1,1],":":[1001,2]})}),"PFX":({"wide":({"default":[MAX,900],".":[MAX,3000],"#":[MAX,3000],"(":[MAX,1],"[":[MAX,1],"{":[MAX,1]}),"short":({"default":[MAX,1900],".":[MAX,3000],"#":[MAX,3000],"(":[MAX,1],"[":[MAX,1],"{":[MAX,1]})}),"SFX":({"wide":({"default":[901,MAX],")":[1,MAX],"]":[1,MAX],"}":[1,MAX]}),"short":({"default":[1901,MAX],")":[1,MAX],"]":[1,MAX],"}":[1,MAX]})})});var DONE=(-1);var NONE=0;var LEFT=1;var RIGHT=2;var BOTH=3;var oparse=function(next,order,finalize){var between=finalize(next());var right_op=next();var stack=[];var left_op=null;var current=null;while(true){var o=function(){if(((!left_op)&&(!right_op))){return DONE;}else{if(true){return ((((!left_op)&&RIGHT)||((!right_op)&&LEFT))||order(left_op,right_op));}else{return false;}}}();var _tmp6=undefined;var _tmp7=undefined;var _tmp8=undefined;var _tmp9=undefined;var _tmp10=undefined;if(((_tmp10=o),(_tmp10==DONE))){return between;}else{if(((_tmp9=o),(_tmp9==LEFT))){current.push(between);(between=finalize(current));var v=stack.pop();(left_op=v[0]);(current=v[1]);}else{if(((_tmp8=o),(_tmp8==RIGHT))){stack.push([left_op,current]);(left_op=right_op);(current=[[right_op],between]);(between=finalize(next()));(right_op=next());}else{if(((_tmp7=o),(_tmp7==BOTH))){current[0].push(right_op);current.push(between);(left_op=right_op);(between=finalize(next()));(right_op=next());}else{if(((_tmp6=o),(_tmp6==NONE))){throw ((("Undefined priority between "+left_op)+" and ")+right_op);}else{throw "Could not find a match";}}}}}}};var consult=function(o){var map=order_map[o[0]][o[1]];return (map[o[2]]||map.default);};var order=function(o1,o2){var ord1=consult(o1)[1];var ord2=consult(o2)[0];if((ord1>ord2)){return LEFT;}else{if((ord1<ord2)){return RIGHT;}else{if((ord1==ord2)){return BOTH;}else{return false;}}}};var finalize=function(x){var _tmp11=undefined;var _tmp12=undefined;var ops=undefined;var args=undefined;var _tmp13=undefined;var _tmp14=undefined;var _tmp15=undefined;var _tmp16=undefined;var _tmp17=undefined;var _tmp18=undefined;var value=undefined;var _tmp19=undefined;var _tmp20=undefined;var _tmp21=undefined;var value=undefined;var _tmp22=undefined;var _tmp23=undefined;var _tmp24=undefined;var value=undefined;if((((_tmp22=x),(_tmp22 instanceof Array))&&(((_tmp23=_tmp22.length),(_tmp23==2))&&(((_tmp24=_tmp22[0]),(_tmp24=="ID"))&&((value=_tmp22[1]),true))))){return value;}else{if((((_tmp19=x),(_tmp19 instanceof Array))&&(((_tmp20=_tmp19.length),(_tmp20==2))&&(((_tmp21=_tmp19[0]),(_tmp21=="NUM"))&&((value=_tmp19[1]),true))))){return ["value",parseFloat(value)];}else{if((((_tmp16=x),(_tmp16 instanceof Array))&&(((_tmp17=_tmp16.length),(_tmp17==2))&&(((_tmp18=_tmp16[0]),(_tmp18=="STR"))&&((value=_tmp16[1]),true))))){return ["value",value];}else{if((((_tmp13=x),(_tmp13 instanceof Array))&&(((_tmp14=_tmp13.length),(_tmp14==1))&&((_tmp15=_tmp13[0]),(_tmp15=="VOID"))))){return null;}else{if((((_tmp11=x),(_tmp11 instanceof Array))&&(((_tmp12=_tmp11.length),(_tmp12>=1))&&((ops=_tmp11[0]),true,(args=_tmp11.slice(1)),true)))){var opcat=ops.map(function(o){return o[2];}).join("");var op=ops[0][2];var other=undefined;var _tmp25=undefined;var _tmp26=undefined;var _tmp27=undefined;var _tmp28=undefined;var _tmp29=undefined;var target=undefined;var body=undefined;var _tmp30=undefined;var _tmp31=undefined;var _tmp32=undefined;var _tmp33=undefined;var _tmp34=undefined;var f=undefined;var body=undefined;var _tmp35=undefined;var _tmp36=undefined;var _tmp37=undefined;var _tmp38=undefined;var _tmp39=undefined;var f=undefined;var arg=undefined;var body=undefined;if((((_tmp35=[opcat,args]),(_tmp35 instanceof Array))&&(((_tmp36=_tmp35.length),(_tmp36==2))&&(((_tmp37=_tmp35[0]),(_tmp37=="WHITE:"))&&(((_tmp38=_tmp35[1]),(_tmp38 instanceof Array))&&(((_tmp39=_tmp38.length),(_tmp39==3))&&((f=_tmp38[0]),true,(arg=_tmp38[1]),true,(body=_tmp38[2]),true))))))){return ["send",f,["data",["code",arg],["code",body]]];}else{if((((_tmp30=[opcat,args]),(_tmp30 instanceof Array))&&(((_tmp31=_tmp30.length),(_tmp31==2))&&(((_tmp32=_tmp30[0]),(_tmp32==":"))&&(((_tmp33=_tmp30[1]),(_tmp33 instanceof Array))&&(((_tmp34=_tmp33.length),(_tmp34==2))&&((f=_tmp33[0]),true,(body=_tmp33[1]),true))))))){return ["send",f,["data",["code",body]]];}else{if((((_tmp25=[opcat,args]),(_tmp25 instanceof Array))&&(((_tmp26=_tmp25.length),(_tmp26==2))&&(((_tmp27=_tmp25[0]),(_tmp27=="with"))&&(((_tmp28=_tmp25[1]),(_tmp28 instanceof Array))&&(((_tmp29=_tmp28.length),(_tmp29==2))&&((target=_tmp28[0]),true,(body=_tmp28[1]),true))))))){(body=function(){var other=undefined;var _tmp49=undefined;var _tmp50=undefined;var _tmp51=undefined;var rest=undefined;if((((_tmp49=body),(_tmp49 instanceof Array))&&(((_tmp50=_tmp49.length),(_tmp50>=1))&&(((_tmp51=_tmp49[0]),(_tmp51=="multi"))&&((rest=_tmp49.slice(1)),true))))){return rest;}else{if(((other=body),true)){return [body];}else{throw "Could not find a match";}}}());var other=undefined;var _tmp40=undefined;var _tmp41=undefined;var _tmp42=undefined;var args=undefined;var _tmp43=undefined;var _tmp44=undefined;var _tmp45=undefined;var f=undefined;var _tmp46=undefined;var _tmp47=undefined;var _tmp48=undefined;var args=undefined;if((((_tmp43=target),(_tmp43 instanceof Array))&&(((_tmp44=_tmp43.length),(_tmp44==3))&&(((_tmp45=_tmp43[0]),(_tmp45=="send"))&&(((f=_tmp43[1]),true,(_tmp46=_tmp43[2]),(_tmp46 instanceof Array))&&(((_tmp47=_tmp46.length),(_tmp47>=1))&&(((_tmp48=_tmp46[0]),(_tmp48=="data"))&&((args=_tmp46.slice(1)),true)))))))){return ["send",f,["data"].concat(args).concat(body)];}else{if((((_tmp40=target),(_tmp40 instanceof Array))&&(((_tmp41=_tmp40.length),(_tmp41>=1))&&(((_tmp42=_tmp40[0]),(_tmp42=="data"))&&((args=_tmp40.slice(1)),true))))){return target.concat(body);}else{if(((other=target),true)){return ["send",target,["data"].concat(body)];}else{throw "Could not find a match";}}}}else{if(((other=[opcat,args]),true)){if(((op=="[")||(op==","))){if((op=="[")){(args=args.slice(1,(-1)));}else{false;}(args=function(){var f=function(x){return (x!==null);};return args.filter(f);}());var other=undefined;var _tmp52=undefined;var _tmp53=undefined;var x=undefined;var _tmp54=undefined;var _tmp55=undefined;if((((_tmp54=args),(_tmp54 instanceof Array))&&((_tmp55=_tmp54.length),(_tmp55==0)))){throw "At least one expression must be enclosed in []";}else{if((((_tmp52=args),(_tmp52 instanceof Array))&&(((_tmp53=_tmp52.length),(_tmp53==1))&&((x=_tmp52[0]),true)))){return x;}else{if(((other=args),true)){return ["multi"].concat(args);}else{throw "Could not find a match";}}}}else{if((op=="{")){var f=function(x){return (x!==null);};return ["data"].concat(args.slice(1,(-1)).filter(f));}else{if((op=="WHITE")){return ["send"].concat(args);}else{if((((args.length==2)&&(args[0]===null))&&(args[1]===null))){return op;}else{if(true){return ["send",op,["data"].concat(args)];}else{return false;}}}}}}else{throw "Could not find a match";}}}}}else{throw "Could not find a match";}}}}}};var parse=function(text){var results=tokenize(text);var next=function(){return results.shift();};return oparse(next,order,finalize);};var Env=function(parent){var store=Object();var self=function(expr){return ["bind_env",self,expr];};(self.resolve=function(name){var attempt=store[name];if(attempt){return attempt;}else{if(true){return self.parent.resolve(name);}else{return false;}}});(self.register=function(name,value){return (store[name]=value);});(self.register_macro=function(name,m){return (store[name]=["macro",m]);});(self.fork=function(){return Env(self);});(self.parent=parent);(self.store=store);return self;};var js_contexts=({"js_for":["multi","multi","multi","multi"]});var expand=function(env,context,expr){(expr=expand.step(env,context,expr));var other=undefined;var _tmp56=undefined;var _tmp57=undefined;var _tmp58=undefined;var _tmp70=undefined;var _tmp59=undefined;var _tmp69=undefined;var _tmp60=undefined;var _tmp68=undefined;var _tmp61=undefined;var _tmp67=undefined;var _tmp62=undefined;var _tmp66=undefined;var _tmp63=undefined;var _tmp65=undefined;var _tmp64=undefined;var args=undefined;var _tmp71=undefined;var _tmp72=undefined;var _tmp73=undefined;var lhs=undefined;var rhs=undefined;var _tmp74=undefined;var _tmp75=undefined;var _tmp76=undefined;var binding=undefined;var value=undefined;var _tmp77=undefined;var _tmp78=undefined;var _tmp79=undefined;var bindings=undefined;var body=undefined;var _tmp80=undefined;var _tmp81=undefined;var _tmp82=undefined;var args=undefined;var _tmp83=undefined;var _tmp84=undefined;var _tmp85=undefined;var type=undefined;var _tmp86=undefined;var _tmp94=undefined;var _tmp87=undefined;var _tmp93=undefined;var _tmp88=undefined;var _tmp92=undefined;var _tmp89=undefined;var _tmp91=undefined;var _tmp90=undefined;var args=undefined;var _tmp95=undefined;var _tmp96=undefined;var _tmp97=undefined;var v=undefined;var _tmp98=undefined;var _tmp99=undefined;var _tmp100=undefined;var f=undefined;var arg=undefined;var _tmp101=undefined;var _tmp102=undefined;var _tmp103=undefined;if(((_tmp103=expr),(typeof(_tmp103)=="string"))){return expr;}else{if(((_tmp102=expr),(_tmp102===null))){return null;}else{if(((_tmp101=expr),(_tmp101===undefined))){throw "undefined? why?";}else{if((((_tmp98=expr),(_tmp98 instanceof Array))&&(((_tmp99=_tmp98.length),(_tmp99==3))&&(((_tmp100=_tmp98[0]),(_tmp100=="send"))&&((f=_tmp98[1]),true,(arg=_tmp98[2]),true))))){var f=expand(env,"head",expr[1]);var arg=expr[2];return ["send",f,expand(env,"tail",arg)];}else{if((((_tmp95=expr),(_tmp95 instanceof Array))&&(((_tmp96=_tmp95.length),(_tmp96==2))&&(((_tmp97=_tmp95[0]),(_tmp97=="value"))&&((v=_tmp95[1]),true))))){return expr;}else{if((((_tmp83=expr),(_tmp83 instanceof Array))&&(((_tmp84=_tmp83.length),(_tmp84>=1))&&(((_tmp85=_tmp83[0]),(type=_tmp85),true,(_tmp86=_tmp85),(((_tmp87=_tmp86),(((_tmp88=_tmp87),(((_tmp89=_tmp88),(((_tmp90=_tmp89),(_tmp90=="multi"))||((_tmp91=_tmp89),(_tmp91=="code"))))||((_tmp92=_tmp88),(_tmp92=="array"))))||((_tmp93=_tmp87),(_tmp93=="object"))))||((_tmp94=_tmp86),(_tmp94=="splice"))))&&((args=_tmp83.slice(1)),true))))){var arr=[];while((args.length>0)){var x=expand.step(env,type,args.shift());if(((x instanceof Array)&&(x[0]=="splice"))){(args=x.slice(1).concat(args));}else{if(true){arr.push(x);}else{false;}}}var f=function(x){return expand(env,type,x);};return [type].concat(arr.map(f));}else{if((((_tmp80=expr),(_tmp80 instanceof Array))&&(((_tmp81=_tmp80.length),(_tmp81>=1))&&(((_tmp82=_tmp80[0]),(_tmp82=="data"))&&((args=_tmp80.slice(1)),true))))){var is_obj=false;var obj=["object"];var arr=["array"];while((args.length>0)){var x=expand.step(env,type,args.shift());var other=undefined;var _tmp104=undefined;var _tmp105=undefined;var _tmp106=undefined;var exprs=undefined;var _tmp107=undefined;var _tmp108=undefined;var _tmp109=undefined;var k=undefined;var v=undefined;var _tmp110=undefined;var _tmp111=undefined;var _tmp112=undefined;if((((_tmp110=x),(_tmp110 instanceof Array))&&(((_tmp111=_tmp110.length),(_tmp111==1))&&((_tmp112=_tmp110[0]),(_tmp112=="assoc"))))){(is_obj=true);}else{if((((_tmp107=x),(_tmp107 instanceof Array))&&(((_tmp108=_tmp107.length),(_tmp108==3))&&(((_tmp109=_tmp107[0]),(_tmp109=="assoc"))&&((k=_tmp107[1]),true,(v=_tmp107[2]),true))))){(is_obj=true);obj.push(["array",k,v]);}else{if((((_tmp104=x),(_tmp104 instanceof Array))&&(((_tmp105=_tmp104.length),(_tmp105>=1))&&(((_tmp106=_tmp104[0]),(_tmp106=="splice"))&&((exprs=_tmp104.slice(1)),true))))){(args=exprs.concat(args));}else{if(((other=x),true)){arr.push(other);}else{throw "Could not find a match";}}}}}var r=function(){if(((arr.length>1)&&is_obj)){arr.push(obj);return arr;}else{if(is_obj){return obj;}else{if(true){return arr;}else{return false;}}}}();return expand(env,context,r);}else{if((((_tmp77=expr),(_tmp77 instanceof Array))&&(((_tmp78=_tmp77.length),(_tmp78==3))&&(((_tmp79=_tmp77[0]),(_tmp79=="lambda"))&&((bindings=_tmp77[1]),true,(body=_tmp77[2]),true))))){return ["lambda",bindings.map(function(x){return expand(env,"decl",x);}),expand(env,"multi",body)];}else{if((((_tmp74=expr),(_tmp74 instanceof Array))&&(((_tmp75=_tmp74.length),(_tmp75==3))&&(((_tmp76=_tmp74[0]),(_tmp76=="declare"))&&((binding=_tmp74[1]),true,(value=_tmp74[2]),true))))){return ["declare",expand(env,"decl",binding),expand(env,"multi",value)];}else{if((((_tmp71=expr),(_tmp71 instanceof Array))&&(((_tmp72=_tmp71.length),(_tmp72==3))&&(((_tmp73=_tmp71[0]),(_tmp73=="assign"))&&((lhs=_tmp71[1]),true,(rhs=_tmp71[2]),true))))){return ["assign",expand(env,"decl",lhs),expand(env,"multi",rhs)];}else{if((((_tmp56=expr),(_tmp56 instanceof Array))&&(((_tmp57=_tmp56.length),(_tmp57>=1))&&(((_tmp58=_tmp56[0]),(((_tmp59=_tmp58),(((_tmp60=_tmp59),(((_tmp61=_tmp60),(((_tmp62=_tmp61),(((_tmp63=_tmp62),(((_tmp64=_tmp63),(_tmp64=="js_while"))||((_tmp65=_tmp63),(_tmp65=="js_for"))))||((_tmp66=_tmp62),(_tmp66=="js_break"))))||((_tmp67=_tmp61),(_tmp67=="js_continue"))))||((_tmp68=_tmp60),(_tmp68=="js_return"))))||((_tmp69=_tmp59),(_tmp69=="js_throw"))))||((_tmp70=_tmp58),(_tmp70=="if"))))&&((args=_tmp56.slice(1)),true))))){var ctxs=(js_contexts[type]||[]);var f=function(x,i){return expand(env,(ctxs[i]||"expr"),x);};return [type].concat(args.map(f));}else{if(((other=expr),true)){throw ["Oops",type,context];}else{throw "Could not find a match";}}}}}}}}}}}}};(expand.step=function(env,context,expr){var other=undefined;var _tmp113=undefined;var _tmp114=undefined;var type=undefined;var args=undefined;var _tmp115=undefined;var _tmp116=undefined;var _tmp117=undefined;var f=undefined;var arg=undefined;var _tmp118=undefined;var _tmp119=undefined;var _tmp120=undefined;var m=undefined;var _tmp121=undefined;var _tmp122=undefined;var _tmp123=undefined;if(((_tmp123=expr),(typeof(_tmp123)=="string"))){var v=env.resolve(expr);var other=undefined;var _tmp124=undefined;var _tmp125=undefined;var _tmp126=undefined;var _tmp127=undefined;var _tmp128=undefined;var m=undefined;var _=undefined;var _tmp129=undefined;var _tmp130=undefined;var _tmp131=undefined;var _tmp132=undefined;var _tmp133=undefined;var m=undefined;var _tmp134=undefined;var _tmp135=undefined;var _tmp136=undefined;var _tmp137=undefined;var _=undefined;if((((_tmp135=[v,context]),(_tmp135 instanceof Array))&&(((_tmp136=_tmp135.length),(_tmp136==2))&&(((_tmp137=_tmp135[0]),(_tmp137===undefined))&&((_=_tmp135[1]),true))))){return expr;}else{if((((_tmp129=[v,context]),(_tmp129 instanceof Array))&&(((_tmp130=_tmp129.length),(_tmp130==2))&&(((_tmp131=_tmp129[0]),(_tmp131 instanceof Array))&&(((_tmp132=_tmp131.length),(_tmp132==2))&&(((_tmp133=_tmp131[0]),(_tmp133=="macro"))&&((m=_tmp131[1]),true,(_tmp134=_tmp129[1]),(_tmp134=="head")))))))){return v;}else{if((((_tmp124=[v,context]),(_tmp124 instanceof Array))&&(((_tmp125=_tmp124.length),(_tmp125==2))&&(((_tmp126=_tmp124[0]),(_tmp126 instanceof Array))&&(((_tmp127=_tmp126.length),(_tmp127==2))&&(((_tmp128=_tmp126[0]),(_tmp128=="macro"))&&((m=_tmp126[1]),true,(_=_tmp124[1]),true))))))){return expand.step(env,context,m(env,context,null));}else{if(((other=[v,context]),true)){return v;}else{throw "Could not find a match";}}}}}else{if(((_tmp122=expr),(_tmp122===null))){return null;}else{if(((_tmp121=expr),(_tmp121===undefined))){throw "undefined? why?";}else{if((((_tmp118=expr),(_tmp118 instanceof Array))&&(((_tmp119=_tmp118.length),(_tmp119==2))&&(((_tmp120=_tmp118[0]),(_tmp120=="macro"))&&((m=_tmp118[1]),true))))){if((context=="head")){return expr;}else{if(true){return expand.step(env,context,m(env,context,null));}else{return false;}}}else{if((((_tmp115=expr),(_tmp115 instanceof Array))&&(((_tmp116=_tmp115.length),(_tmp116==3))&&(((_tmp117=_tmp115[0]),(_tmp117=="send"))&&((f=_tmp115[1]),true,(arg=_tmp115[2]),true))))){(f=expand.step(env,"head",f));var other=undefined;var _tmp138=undefined;var _tmp139=undefined;var _tmp140=undefined;var m=undefined;if((((_tmp138=f),(_tmp138 instanceof Array))&&(((_tmp139=_tmp138.length),(_tmp139==2))&&(((_tmp140=_tmp138[0]),(_tmp140=="macro"))&&((m=_tmp138[1]),true))))){return expand.step(env,context,m(env,context,arg));}else{if(((other=f),true)){return expr;}else{throw "Could not find a match";}}}else{if((((_tmp113=expr),(_tmp113 instanceof Array))&&(((_tmp114=_tmp113.length),(_tmp114>=1))&&((type=_tmp113[0]),true,(args=_tmp113.slice(1)),true)))){return expr;}else{if(((other=expr),true)){throw ["Oops2",expr];}else{throw "Could not find a match";}}}}}}}});var aslist=function(expr){var other=undefined;var _tmp141=undefined;var _tmp142=undefined;var _tmp143=undefined;var args=undefined;var _tmp144=undefined;var _tmp145=undefined;if(((_tmp145=expr),(_tmp145===null))){return [null];}else{if(((_tmp144=expr),(_tmp144===undefined))){return [undefined];}else{if((((_tmp141=expr),(_tmp141 instanceof Array))&&(((_tmp142=_tmp141.length),(_tmp142>=1))&&(((_tmp143=_tmp141[0]),(_tmp143=="multi"))&&((args=_tmp141.slice(1)),true))))){return args;}else{if(((other=expr),true)){return [other];}else{throw "Could not find a match";}}}}};var nullenv=({"resolve":function(x){return undefined;}});var stdenv=Env(nullenv);stdenv.register("+","___plus");stdenv.register("-","___minus");stdenv.register("*","___times");stdenv.register("/","___div");stdenv.register("%","___mod");stdenv.register("^","___binxor");stdenv.register("&","___binand");stdenv.register("|","___binor");stdenv.register("~","___binnot");stdenv.register("&&","___and");stdenv.register("||","___or");stdenv.register("!","___not");stdenv.register("===","___is");stdenv.register("!==","___isnt");stdenv.register("!=","___neq");stdenv.register("<","___lt");stdenv.register(">","___gt");stdenv.register("<=","___lte");stdenv.register(">=","___gte");stdenv.register("in","___in");stdenv.register("instanceof","___instanceof");stdenv.register("++","___plusplus");stdenv.register("--","___minusminus");var make_checker=function(value){return function(env,context,expr){return ["send","___eq",["data",expr[1],value]];};};var make_exact_checker=function(value){return function(env,context,expr){return ["send","___is",["data",expr[1],value]];};};stdenv.register_macro("#",function(env,context,expr){var tag=["value",expr[2]];var f=function(env,context,expr){if((context=="pattern")){var f=function(env,context,expr){return ["send","___eq",["data",["send",expr[1],["value","#"]],tag]];};return ["check",["macro",f],expr];}else{if(true){var d=["data",tag].concat(expr.slice(1));return ["send",["send","___lib",["value","Struct"]],d];}else{return false;}}};return ["macro",f];});stdenv.register_macro("&&",function(env,context,expr){var other=undefined;var _tmp146=undefined;var _tmp147=undefined;var _=undefined;var _tmp148=undefined;var _tmp149=undefined;var _tmp150=undefined;var _tmp151=undefined;var _tmp152=undefined;var _tmp153=undefined;var _tmp154=undefined;var a=undefined;var b=undefined;if((((_tmp149=[context,expr]),(_tmp149 instanceof Array))&&(((_tmp150=_tmp149.length),(_tmp150==2))&&(((_tmp151=_tmp149[0]),(_tmp151=="pattern"))&&(((_tmp152=_tmp149[1]),(_tmp152 instanceof Array))&&(((_tmp153=_tmp152.length),(_tmp153==3))&&(((_tmp154=_tmp152[0]),(_tmp154=="data"))&&((a=_tmp152[1]),true,(b=_tmp152[2]),true)))))))){return ["all",a,b];}else{if((((_tmp146=[context,expr]),(_tmp146 instanceof Array))&&(((_tmp147=_tmp146.length),(_tmp147==2))&&((_=_tmp146[0]),true,(_tmp148=_tmp146[1]),(_tmp148===null))))){return "___and";}else{if(((other=[context,expr]),true)){return ["send","___and",expr];}else{throw "Could not find a match";}}}});stdenv.register_macro("||",function(env,context,expr){var other=undefined;var _tmp155=undefined;var _tmp156=undefined;var _=undefined;var _tmp157=undefined;var _tmp158=undefined;var _tmp159=undefined;var _tmp160=undefined;var _tmp161=undefined;var _tmp162=undefined;var _tmp163=undefined;var a=undefined;var b=undefined;if((((_tmp158=[context,expr]),(_tmp158 instanceof Array))&&(((_tmp159=_tmp158.length),(_tmp159==2))&&(((_tmp160=_tmp158[0]),(_tmp160=="pattern"))&&(((_tmp161=_tmp158[1]),(_tmp161 instanceof Array))&&(((_tmp162=_tmp161.length),(_tmp162==3))&&(((_tmp163=_tmp161[0]),(_tmp163=="data"))&&((a=_tmp161[1]),true,(b=_tmp161[2]),true)))))))){return ["any",a,b];}else{if((((_tmp155=[context,expr]),(_tmp155 instanceof Array))&&(((_tmp156=_tmp155.length),(_tmp156==2))&&((_=_tmp155[0]),true,(_tmp157=_tmp155[1]),(_tmp157===null))))){return "___or";}else{if(((other=[context,expr]),true)){return ["send","___or",expr];}else{throw "Could not find a match";}}}});stdenv.register_macro("==",function(env,context,expr){var other=undefined;var _tmp164=undefined;var _tmp165=undefined;var _=undefined;var _tmp166=undefined;var _tmp167=undefined;var _tmp168=undefined;var _tmp169=undefined;var _tmp170=undefined;var _tmp171=undefined;var _tmp172=undefined;var _tmp173=undefined;var val=undefined;if((((_tmp167=[context,expr]),(_tmp167 instanceof Array))&&(((_tmp168=_tmp167.length),(_tmp168==2))&&(((_tmp169=_tmp167[0]),(_tmp169=="pattern"))&&(((_tmp170=_tmp167[1]),(_tmp170 instanceof Array))&&(((_tmp171=_tmp170.length),(_tmp171==3))&&(((_tmp172=_tmp170[0]),(_tmp172=="data"))&&(((_tmp173=_tmp170[1]),(_tmp173===null))&&((val=_tmp170[2]),true))))))))){return ["check",["macro",make_checker(val)],null];}else{if((((_tmp164=[context,expr]),(_tmp164 instanceof Array))&&(((_tmp165=_tmp164.length),(_tmp165==2))&&((_=_tmp164[0]),true,(_tmp166=_tmp164[1]),(_tmp166===null))))){return "___eq";}else{if(((other=[context,expr]),true)){return ["send","___eq",expr];}else{throw "Could not find a match";}}}});stdenv.register_macro("*",function(env,context,expr){var other=undefined;var _tmp174=undefined;var _tmp175=undefined;var _=undefined;var _tmp176=undefined;var _tmp177=undefined;var _tmp178=undefined;var _tmp179=undefined;var _tmp180=undefined;var _tmp181=undefined;var _tmp182=undefined;var val=undefined;var _tmp183=undefined;if((((_tmp177=[context,expr]),(_tmp177 instanceof Array))&&(((_tmp178=_tmp177.length),(_tmp178==2))&&(((_tmp179=_tmp177[0]),(_tmp179=="pattern"))&&(((_tmp180=_tmp177[1]),(_tmp180 instanceof Array))&&(((_tmp181=_tmp180.length),(_tmp181==3))&&(((_tmp182=_tmp180[0]),(_tmp182=="data"))&&((val=_tmp180[1]),true,(_tmp183=_tmp180[2]),(_tmp183===null))))))))){return ["dynsplice",val];}else{if((((_tmp174=[context,expr]),(_tmp174 instanceof Array))&&(((_tmp175=_tmp174.length),(_tmp175==2))&&((_=_tmp174[0]),true,(_tmp176=_tmp174[1]),(_tmp176===null))))){return "___times";}else{if(((other=[context,expr]),true)){return ["send","___times",expr];}else{throw "Could not find a match";}}}});stdenv.register_macro(".",function(env,context,expr){var other=undefined;var _tmp184=undefined;var _tmp185=undefined;var _tmp186=undefined;var _tmp187=undefined;var _tmp188=undefined;var s=undefined;if((((_tmp184=expr),(_tmp184 instanceof Array))&&(((_tmp185=_tmp184.length),(_tmp185==3))&&(((_tmp186=_tmp184[0]),(_tmp186=="data"))&&(((_tmp187=_tmp184[1]),(_tmp187===null))&&(((_tmp188=_tmp184[2]),(typeof(_tmp188)=="string"))&&((s=_tmp188),true))))))){return ["value",s];}else{if(((other=expr),true)){throw ["invalid",expr];}else{throw "Could not find a match";}}});stdenv.register_macro("where",function(env,context,_tmp189){var _tmp190=undefined;var _tmp191=undefined;var _tmp192=undefined;var a=undefined;var b=undefined;if((((_tmp190=_tmp189),(_tmp190 instanceof Array))&&(((_tmp191=_tmp190.length),(_tmp191==3))&&(((_tmp192=_tmp190[0]),(_tmp192=="data"))&&((a=_tmp190[1]),true,(b=_tmp190[2]),true))))){false;}else{throw "a condition failed";}return ["send","let",["data",["code",b],["code",a]]];});stdenv.register_macro("let",function(env,context,_tmp193){var _tmp194=undefined;var _tmp195=undefined;var _tmp196=undefined;var _tmp197=undefined;var _tmp198=undefined;var _tmp199=undefined;var a=undefined;var _tmp200=undefined;var _tmp201=undefined;var _tmp202=undefined;var b=undefined;if((((_tmp194=_tmp193),(_tmp194 instanceof Array))&&(((_tmp195=_tmp194.length),(_tmp195==3))&&(((_tmp196=_tmp194[0]),(_tmp196=="data"))&&(((_tmp197=_tmp194[1]),(_tmp197 instanceof Array))&&(((_tmp198=_tmp197.length),(_tmp198==2))&&(((_tmp199=_tmp197[0]),(_tmp199=="code"))&&(((a=_tmp197[1]),true,(_tmp200=_tmp194[2]),(_tmp200 instanceof Array))&&(((_tmp201=_tmp200.length),(_tmp201==2))&&(((_tmp202=_tmp200[0]),(_tmp202=="code"))&&((b=_tmp200[1]),true))))))))))){false;}else{throw "a condition failed";}var bindings=aslist(a);var body=aslist(b);return ["multi"].concat(bindings).concat(body);});stdenv.register_macro("->",function(env,context,_tmp203){var _tmp204=undefined;var _tmp205=undefined;var _tmp206=undefined;var args=undefined;var stmts=undefined;if((((_tmp204=_tmp203),(_tmp204 instanceof Array))&&(((_tmp205=_tmp204.length),(_tmp205==3))&&(((_tmp206=_tmp204[0]),(_tmp206=="data"))&&((args=_tmp204[1]),true,(stmts=_tmp204[2]),true))))){false;}else{throw "a condition failed";}var body=["multi"];(args=args.slice(1).map(function(x){var other=undefined;var _tmp207=undefined;if(((_tmp207=x),(typeof(_tmp207)=="string"))){return x;}else{if(((other=x),true)){var t=gensym();body.push(["send","=",["data",x,t]]);return t;}else{throw "Could not find a match";}}}));body.push(stmts);return ["lambda",args,body];});stdenv.register_macro("=>",function(env,context,_tmp208){var _tmp209=undefined;var _tmp210=undefined;var _tmp211=undefined;var binding=undefined;var value=undefined;if((((_tmp209=_tmp208),(_tmp209 instanceof Array))&&(((_tmp210=_tmp209.length),(_tmp210==3))&&(((_tmp211=_tmp209[0]),(_tmp211=="data"))&&((binding=_tmp209[1]),true,(value=_tmp209[2]),true))))){false;}else{throw "a condition failed";}if((context=="data")){return ["assoc",binding,value];}else{if(true){throw (("Illegal context for '=>' ("+context)+")");}else{return false;}}});stdenv.register_macro("=",function(env,context,expr){var other=undefined;var _tmp212=undefined;var _tmp213=undefined;var _tmp214=undefined;var _tmp215=undefined;var _tmp216=undefined;var _tmp217=undefined;var binding=undefined;var value=undefined;var _tmp218=undefined;var _tmp219=undefined;var _tmp220=undefined;var _tmp221=undefined;var _tmp222=undefined;var _tmp223=undefined;var _tmp224=undefined;var _tmp225=undefined;var _tmp226=undefined;var f=undefined;var _tmp227=undefined;var _tmp228=undefined;var _tmp229=undefined;var args=undefined;var value=undefined;var _tmp230=undefined;var _tmp231=undefined;var _tmp232=undefined;var _tmp233=undefined;var _tmp234=undefined;var _tmp235=undefined;var _tmp236=undefined;var _tmp237=undefined;var _tmp238=undefined;var _tmp239=undefined;var lhs=undefined;var rhs=undefined;if((((_tmp234=[context,expr]),(_tmp234 instanceof Array))&&(((_tmp235=_tmp234.length),(_tmp235==2))&&(((_tmp236=_tmp234[0]),(_tmp236=="multi"))&&(((_tmp237=_tmp234[1]),(_tmp237 instanceof Array))&&(((_tmp238=_tmp237.length),(_tmp238==3))&&(((_tmp239=_tmp237[0]),(_tmp239=="data"))&&((lhs=_tmp237[1]),true,(rhs=_tmp237[2]),true)))))))){var p=parse_lhs(env,lhs,rhs);var vars=make_declarations(p[0]);var r=["splice"].concat(vars);var clauses=p[1];var mkif=function(x){return ["if",x,["value",false],["js_throw",["value","a condition failed"]]];};if((clauses.length==1)){var clause=clauses[0];var last=clause[(clause.length-1)];if((((last instanceof Array)&&(last[0]=="value"))&&(last[1]===true))){if(((vars.length==1)&&(clause.length==3))){(r=["declare"].concat(clause[1].slice(1)));}else{if(true){(r=r.concat(clause.slice(1,(-1))));}else{false;}}}else{if(true){r.push(mkif(clause));}else{false;}}}else{if(true){var ands=make_pattern_test(clauses);r.push(mkif(ands));}else{false;}}return r;}else{if((((_tmp230=[context,expr]),(_tmp230 instanceof Array))&&(((_tmp231=_tmp230.length),(_tmp231==2))&&(((_tmp232=_tmp230[0]),(_tmp232=="data"))&&((_tmp233=_tmp230[1]),(_tmp233===null)))))){return ["assoc"];}else{if((((_tmp218=[context,expr]),(_tmp218 instanceof Array))&&(((_tmp219=_tmp218.length),(_tmp219==2))&&(((_tmp220=_tmp218[0]),(_tmp220=="data"))&&(((_tmp221=_tmp218[1]),(_tmp221 instanceof Array))&&(((_tmp222=_tmp221.length),(_tmp222==3))&&(((_tmp223=_tmp221[0]),(_tmp223=="data"))&&(((_tmp224=_tmp221[1]),(_tmp224 instanceof Array))&&(((_tmp225=_tmp224.length),(_tmp225==3))&&(((_tmp226=_tmp224[0]),(_tmp226=="send"))&&(((f=_tmp224[1]),true,(_tmp227=_tmp224[2]),(_tmp227 instanceof Array))&&(((_tmp228=_tmp227.length),(_tmp228>=1))&&(((_tmp229=_tmp227[0]),(_tmp229=="data"))&&((args=_tmp227.slice(1)),true,(value=_tmp221[2]),true)))))))))))))){return ["assoc",["value",f],["lambda",args,value]];}else{if((((_tmp212=[context,expr]),(_tmp212 instanceof Array))&&(((_tmp213=_tmp212.length),(_tmp213==2))&&(((_tmp214=_tmp212[0]),(_tmp214=="data"))&&(((_tmp215=_tmp212[1]),(_tmp215 instanceof Array))&&(((_tmp216=_tmp215.length),(_tmp216==3))&&(((_tmp217=_tmp215[0]),(_tmp217=="data"))&&((binding=_tmp215[1]),true,(value=_tmp215[2]),true)))))))){return ["assoc",["value",binding],value];}else{if(((other=[context,expr]),true)){throw (("Illegal context for '=' ("+context)+")");}else{throw "Could not find a match";}}}}}});stdenv.register_macro(":=",function(env,context,_tmp240){var _tmp241=undefined;var _tmp242=undefined;var _tmp243=undefined;var a=undefined;var b=undefined;if((((_tmp241=_tmp240),(_tmp241 instanceof Array))&&(((_tmp242=_tmp241.length),(_tmp242==3))&&(((_tmp243=_tmp241[0]),(_tmp243=="data"))&&((a=_tmp241[1]),true,(b=_tmp241[2]),true))))){false;}else{throw "a condition failed";}return ["assign",a,b];});stdenv.register_macro("if",function(env,context,_tmp244){var _tmp245=undefined;var _tmp246=undefined;var _tmp247=undefined;var test=undefined;var a=undefined;var b=undefined;if((((_tmp245=_tmp244),(_tmp245 instanceof Array))&&(((_tmp246=_tmp245.length),(_tmp246==4))&&(((_tmp247=_tmp245[0]),(_tmp247=="data"))&&((test=_tmp245[1]),true,(a=_tmp245[2]),true,(b=_tmp245[3]),true))))){false;}else{throw "a condition failed";}return ["if",test,a,b];});stdenv.register_macro("cond",function(env,context,_tmp248){var _tmp249=undefined;var _tmp250=undefined;var _tmp251=undefined;var _tmp252=undefined;var _tmp253=undefined;var _tmp254=undefined;var clauses=undefined;if((((_tmp249=_tmp248),(_tmp249 instanceof Array))&&(((_tmp250=_tmp249.length),(_tmp250==2))&&(((_tmp251=_tmp249[0]),(_tmp251=="data"))&&(((_tmp252=_tmp249[1]),(_tmp252 instanceof Array))&&(((_tmp253=_tmp252.length),(_tmp253==2))&&(((_tmp254=_tmp252[0]),(_tmp254=="code"))&&((clauses=_tmp252[1]),true)))))))){false;}else{throw "a condition failed";}var handle=function(xs){if((xs.length==0)){return ["value",false];}else{if(true){var first=xs[0][2];var rest=xs.slice(1);return ["if",first[1],first[2],handle(rest)];}else{return false;}}};return handle(aslist(clauses));});stdenv.register_macro("while",function(env,context,_tmp255){var _tmp256=undefined;var _tmp257=undefined;var _tmp258=undefined;var _tmp259=undefined;var _tmp260=undefined;var _tmp261=undefined;var test=undefined;var _tmp262=undefined;var _tmp263=undefined;var _tmp264=undefined;var body=undefined;if((((_tmp256=_tmp255),(_tmp256 instanceof Array))&&(((_tmp257=_tmp256.length),(_tmp257==3))&&(((_tmp258=_tmp256[0]),(_tmp258=="data"))&&(((_tmp259=_tmp256[1]),(_tmp259 instanceof Array))&&(((_tmp260=_tmp259.length),(_tmp260==2))&&(((_tmp261=_tmp259[0]),(_tmp261=="code"))&&(((test=_tmp259[1]),true,(_tmp262=_tmp256[2]),(_tmp262 instanceof Array))&&(((_tmp263=_tmp262.length),(_tmp263==2))&&(((_tmp264=_tmp262[0]),(_tmp264=="code"))&&((body=_tmp262[1]),true))))))))))){false;}else{throw "a condition failed";}return ["js_while",test,body];});stdenv.register_macro("for",function(env,context,_tmp265){var _tmp266=undefined;var _tmp267=undefined;var _tmp268=undefined;var _tmp269=undefined;var _tmp270=undefined;var _tmp271=undefined;var _tmp272=undefined;var _tmp273=undefined;var _tmp274=undefined;var a=undefined;var b=undefined;var c=undefined;var _tmp275=undefined;var _tmp276=undefined;var _tmp277=undefined;var body=undefined;if((((_tmp266=_tmp265),(_tmp266 instanceof Array))&&(((_tmp267=_tmp266.length),(_tmp267==3))&&(((_tmp268=_tmp266[0]),(_tmp268=="data"))&&(((_tmp269=_tmp266[1]),(_tmp269 instanceof Array))&&(((_tmp270=_tmp269.length),(_tmp270==2))&&(((_tmp271=_tmp269[0]),(_tmp271=="code"))&&(((_tmp272=_tmp269[1]),(_tmp272 instanceof Array))&&(((_tmp273=_tmp272.length),(_tmp273==4))&&(((_tmp274=_tmp272[0]),(_tmp274=="multi"))&&(((a=_tmp272[1]),true,(b=_tmp272[2]),true,(c=_tmp272[3]),true,(_tmp275=_tmp266[2]),(_tmp275 instanceof Array))&&(((_tmp276=_tmp275.length),(_tmp276==2))&&(((_tmp277=_tmp275[0]),(_tmp277=="code"))&&((body=_tmp275[1]),true)))))))))))))){false;}else{throw "a condition failed";}return ["js_for",a,b,c,body];});stdenv.register_macro("return",function(env,context,expr){return ["js_return",expr];});stdenv.register_macro("throw",function(env,context,expr){return ["js_throw",expr];});stdenv.register_macro("break",function(env,context,expr){return ["js_break"];});stdenv.register_macro("continue",function(env,context,expr){return ["js_continue"];});var rx_wrap=function(x){return (("(?:"+x)+")");};var rx_quote=function(x){return x.replace(RegExp("([.?*+\\^$\\[\\]\\(\\)\\{\\}|\\\\])","g"),"\\$1");};var rx_quote2=function(x){return x.replace(RegExp("([\\[\\]\\(\\)\\{\\}\\^])","g"),"\\$1");};var rx_build=function(expr){var _tmp278=undefined;var _tmp279=undefined;var _tmp280=undefined;var args=undefined;var _tmp281=undefined;var _tmp282=undefined;var _tmp283=undefined;var args=undefined;var _tmp284=undefined;var _tmp285=undefined;var _tmp286=undefined;var _tmp287=undefined;var _tmp288=undefined;var _tmp289=undefined;var _tmp290=undefined;var _tmp291=undefined;var b=undefined;var _tmp292=undefined;var _tmp293=undefined;var _tmp294=undefined;var _tmp295=undefined;var _tmp296=undefined;var _tmp297=undefined;var _tmp298=undefined;var _tmp299=undefined;var b=undefined;var _tmp300=undefined;var _tmp301=undefined;var _tmp302=undefined;var _tmp303=undefined;var _tmp304=undefined;var _tmp305=undefined;var _tmp306=undefined;var a=undefined;var _tmp307=undefined;var _tmp308=undefined;var _tmp309=undefined;var _tmp310=undefined;var _tmp311=undefined;var _tmp312=undefined;var _tmp313=undefined;var _tmp314=undefined;var a=undefined;var _tmp315=undefined;var _tmp316=undefined;var _tmp317=undefined;var _tmp318=undefined;var _tmp319=undefined;var _tmp320=undefined;var _tmp321=undefined;var _tmp322=undefined;var a=undefined;var _tmp323=undefined;var _tmp324=undefined;var _tmp325=undefined;var _tmp326=undefined;var _tmp327=undefined;var _tmp328=undefined;var _tmp329=undefined;var _tmp330=undefined;var a=undefined;var b=undefined;var _tmp331=undefined;var _tmp332=undefined;var _tmp333=undefined;var x=undefined;var _tmp334=undefined;var _tmp335=undefined;var _tmp336=undefined;var _tmp337=undefined;var _tmp338=undefined;var _tmp339=undefined;var _tmp340=undefined;var _tmp341=undefined;var _tmp342=undefined;var _tmp343=undefined;var _tmp344=undefined;var _tmp345=undefined;var _tmp346=undefined;if(((_tmp346=expr),(_tmp346=="any"))){return ".";}else{if(((_tmp345=expr),(_tmp345=="start"))){return "^";}else{if(((_tmp344=expr),(_tmp344=="end"))){return "$";}else{if(((_tmp343=expr),(_tmp343=="alpha"))){return "\\a";}else{if(((_tmp342=expr),(_tmp342=="digit"))){return "\\d";}else{if(((_tmp341=expr),(_tmp341=="word"))){return "\\w";}else{if(((_tmp340=expr),(_tmp340=="space"))){return "\\s";}else{if(((_tmp339=expr),(_tmp339=="boundary"))){return "\\b";}else{if(((_tmp338=expr),(_tmp338=="a"))){return "\\a";}else{if(((_tmp337=expr),(_tmp337=="d"))){return "\\d";}else{if(((_tmp336=expr),(_tmp336=="w"))){return "\\w";}else{if(((_tmp335=expr),(_tmp335=="s"))){return "\\s";}else{if(((_tmp334=expr),(_tmp334=="b"))){return "\\b";}else{if((((_tmp331=expr),(_tmp331 instanceof Array))&&(((_tmp332=_tmp331.length),(_tmp332==2))&&(((_tmp333=_tmp331[0]),(_tmp333=="value"))&&((x=_tmp331[1]),true))))){return rx_quote(x);}else{if((((_tmp324=expr),(_tmp324 instanceof Array))&&(((_tmp325=_tmp324.length),(_tmp325==3))&&(((_tmp326=_tmp324[0]),(_tmp326=="send"))&&(((_tmp327=_tmp324[1]),(_tmp327=="||"))&&(((_tmp328=_tmp324[2]),(_tmp328 instanceof Array))&&(((_tmp329=_tmp328.length),(_tmp329==3))&&(((_tmp330=_tmp328[0]),(_tmp330=="data"))&&((a=_tmp328[1]),true,(b=_tmp328[2]),true))))))))){return rx_wrap(((rx_build(a)+"|")+rx_build(b)));}else{if((((_tmp316=expr),(_tmp316 instanceof Array))&&(((_tmp317=_tmp316.length),(_tmp317==3))&&(((_tmp318=_tmp316[0]),(_tmp318=="send"))&&(((_tmp319=_tmp316[1]),(_tmp319=="*"))&&(((_tmp320=_tmp316[2]),(_tmp320 instanceof Array))&&(((_tmp321=_tmp320.length),(_tmp321==3))&&(((_tmp322=_tmp320[0]),(_tmp322=="data"))&&((a=_tmp320[1]),true,(_tmp323=_tmp320[2]),(_tmp323===null)))))))))){return rx_wrap((rx_build(a)+"*"));}else{if((((_tmp308=expr),(_tmp308 instanceof Array))&&(((_tmp309=_tmp308.length),(_tmp309==3))&&(((_tmp310=_tmp308[0]),(_tmp310=="send"))&&(((_tmp311=_tmp308[1]),(_tmp311=="+"))&&(((_tmp312=_tmp308[2]),(_tmp312 instanceof Array))&&(((_tmp313=_tmp312.length),(_tmp313==3))&&(((_tmp314=_tmp312[0]),(_tmp314=="data"))&&((a=_tmp312[1]),true,(_tmp315=_tmp312[2]),(_tmp315===null)))))))))){return rx_wrap((rx_build(a)+"+"));}else{if((((_tmp300=expr),(_tmp300 instanceof Array))&&(((_tmp301=_tmp300.length),(_tmp301==3))&&(((_tmp302=_tmp300[0]),(_tmp302=="send"))&&(((_tmp303=_tmp300[1]),(_tmp303=="?"))&&(((_tmp304=_tmp300[2]),(_tmp304 instanceof Array))&&(((_tmp305=_tmp304.length),(_tmp305==3))&&(((_tmp306=_tmp304[0]),(_tmp306=="data"))&&((a=_tmp304[1]),true,(_tmp307=_tmp304[2]),(_tmp307===null)))))))))){return rx_wrap((rx_build(a)+"?"));}else{if((((_tmp292=expr),(_tmp292 instanceof Array))&&(((_tmp293=_tmp292.length),(_tmp293==3))&&(((_tmp294=_tmp292[0]),(_tmp294=="send"))&&(((_tmp295=_tmp292[1]),(_tmp295==">>"))&&(((_tmp296=_tmp292[2]),(_tmp296 instanceof Array))&&(((_tmp297=_tmp296.length),(_tmp297==3))&&(((_tmp298=_tmp296[0]),(_tmp298=="data"))&&(((_tmp299=_tmp296[1]),(_tmp299===null))&&((b=_tmp296[2]),true)))))))))){var x=rx_quote2(b[1]);return (("["+x)+"]");}else{if((((_tmp284=expr),(_tmp284 instanceof Array))&&(((_tmp285=_tmp284.length),(_tmp285==3))&&(((_tmp286=_tmp284[0]),(_tmp286=="send"))&&(((_tmp287=_tmp284[1]),(_tmp287==">>!"))&&(((_tmp288=_tmp284[2]),(_tmp288 instanceof Array))&&(((_tmp289=_tmp288.length),(_tmp289==3))&&(((_tmp290=_tmp288[0]),(_tmp290=="data"))&&(((_tmp291=_tmp288[1]),(_tmp291===null))&&((b=_tmp288[2]),true)))))))))){var x=rx_quote2(b[1]);return (("[^"+x)+"]");}else{if((((_tmp281=expr),(_tmp281 instanceof Array))&&(((_tmp282=_tmp281.length),(_tmp282>=1))&&(((_tmp283=_tmp281[0]),(_tmp283=="data"))&&((args=_tmp281.slice(1)),true))))){return (("("+args.map(rx_build).join(""))+")");}else{if((((_tmp278=expr),(_tmp278 instanceof Array))&&(((_tmp279=_tmp278.length),(_tmp279>=1))&&(((_tmp280=_tmp278[0]),(_tmp280=="multi"))&&((args=_tmp278.slice(1)),true))))){return (("(?:"+args.map(rx_build).join(""))+")");}else{throw "Could not find a match";}}}}}}}}}}}}}}}}}}}}}}};stdenv.register_macro("Rx",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)]]];});stdenv.register_macro("Rxg",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)],["value","g"]]];});stdenv.register_macro("?",function(env,context,_tmp347){var _tmp348=undefined;var _tmp349=undefined;var _tmp350=undefined;var expr=undefined;var _tmp351=undefined;if((((_tmp348=_tmp347),(_tmp348 instanceof Array))&&(((_tmp349=_tmp348.length),(_tmp349==3))&&(((_tmp350=_tmp348[0]),(_tmp350=="data"))&&((expr=_tmp348[1]),true,(_tmp351=_tmp348[2]),(_tmp351===null)))))){false;}else{throw "a condition failed";}var checker=function(){var other=undefined;var _tmp352=undefined;var _tmp353=undefined;var _tmp354=undefined;var _tmp355=undefined;var _tmp356=undefined;var _tmp357=undefined;var _tmp358=undefined;if(((_tmp358=expr),(_tmp358===null))){return ["send",expr,["value","__check__"]];}else{if(((_tmp357=expr),(_tmp357=="String"))){var f=function(env,context,_tmp359){var _tmp360=undefined;var _tmp361=undefined;var _tmp362=undefined;var expr=undefined;if((((_tmp360=_tmp359),(_tmp360 instanceof Array))&&(((_tmp361=_tmp360.length),(_tmp361==2))&&(((_tmp362=_tmp360[0]),(_tmp362=="data"))&&((expr=_tmp360[1]),true))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","string"]]];};return ["macro",f];}else{if(((_tmp356=expr),(_tmp356=="Number"))){var f=function(env,context,_tmp363){var _tmp364=undefined;var _tmp365=undefined;var _tmp366=undefined;var expr=undefined;if((((_tmp364=_tmp363),(_tmp364 instanceof Array))&&(((_tmp365=_tmp364.length),(_tmp365==2))&&(((_tmp366=_tmp364[0]),(_tmp366=="data"))&&((expr=_tmp364[1]),true))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","number"]]];};return ["macro",f];}else{if(((_tmp355=expr),(_tmp355=="true"))){return ["macro",make_exact_checker(["value",true])];}else{if(((_tmp354=expr),(_tmp354=="false"))){return ["macro",make_exact_checker(["value",false])];}else{if(((_tmp353=expr),(_tmp353=="null"))){return ["macro",make_exact_checker(["value",null])];}else{if(((_tmp352=expr),(_tmp352=="undefined"))){return ["macro",make_exact_checker(["value",undefined])];}else{if(((other=expr),true)){return ["send",expr,["value","__check__"]];}else{throw "Could not find a match";}}}}}}}}}();var mac=function(env,context,expr){var other=undefined;var _tmp367=undefined;if(((_tmp367=context),(_tmp367=="pattern"))){return ["check",checker,expr];}else{if(((other=context),true)){return ["send",checker,["data",expr]];}else{throw "Could not find a match";}}};return ["macro",mac];});var tempnum=0;var gensym=function(){var name=("_tmp"+tempnum);(tempnum=(tempnum+1));return name;};var parse_lhs=function(env,lhs,rhs){var vars=[];var clauses=[];var current=["multi"];var mktemp=function(){var t=gensym();vars.push(t);return t;};var newclause=function(){if((current.length>1)){clauses.push(current);}else{false;}return (current=["multi"]);};var helper=function(lhs,curr){return helper_noexpand(expand.step(env,"pattern",lhs),curr);};var helper_noexpand=function(lhs,curr){var _tmp368=undefined;var _tmp369=undefined;var _tmp370=undefined;var specs=undefined;var _tmp371=undefined;var _tmp372=undefined;var _tmp373=undefined;var fname=undefined;var spec=undefined;var _tmp374=undefined;var _tmp375=undefined;var _tmp376=undefined;var checker=undefined;var expr=undefined;var _tmp377=undefined;var _tmp378=undefined;var _tmp379=undefined;var xs=undefined;var _tmp380=undefined;var _tmp381=undefined;var _tmp382=undefined;var xs=undefined;var _tmp383=undefined;var _tmp384=undefined;var _tmp385=undefined;var v=undefined;var _tmp386=undefined;var _tmp387=undefined;if(((_tmp387=lhs),(_tmp387===null))){return false;}else{if(((_tmp386=lhs),(typeof(_tmp386)=="string"))){vars.push(lhs);current.push(["assign",lhs,curr]);return current.push(["value",true]);}else{if((((_tmp383=lhs),(_tmp383 instanceof Array))&&(((_tmp384=_tmp383.length),(_tmp384==2))&&(((_tmp385=_tmp383[0]),(_tmp385=="value"))&&((v=_tmp383[1]),true))))){var x=["check",["macro",make_checker(lhs)],null];return helper_noexpand(x,curr);}else{if((((_tmp380=lhs),(_tmp380 instanceof Array))&&(((_tmp381=_tmp380.length),(_tmp381>=1))&&(((_tmp382=_tmp380[0]),(_tmp382=="all"))&&((xs=_tmp380.slice(1)),true))))){var temp=mktemp();(current=current.concat([["assign",temp,curr]]));return xs.forEach(function(x){return helper(x,temp);});}else{if((((_tmp377=lhs),(_tmp377 instanceof Array))&&(((_tmp378=_tmp377.length),(_tmp378>=1))&&(((_tmp379=_tmp377[0]),(_tmp379=="any"))&&((xs=_tmp377.slice(1)),true))))){var normalize=function(vars){return vars.filter(function(x){return (x.slice(0,4)!=="_tmp");}).sort().join(",");};var temp=mktemp();(current=current.concat([["assign",temp,curr]]));var myvars=undefined;var clauses=[];xs.forEach(function(x){var p=parse_lhs(env,x,temp);if((myvars===undefined)){(myvars=p[0]);}else{if((normalize(p[0])!==normalize(myvars))){throw [["Must have the same set of variables in both branches!",myvars]];}else{if(true){(vars=vars.concat(p[0]));}else{false;}}}return clauses.push(make_pattern_test(p[1]));});current.push(make_or_pattern(clauses));(vars=vars.concat(myvars));return newclause();}else{if((((_tmp374=lhs),(_tmp374 instanceof Array))&&(((_tmp375=_tmp374.length),(_tmp375==3))&&(((_tmp376=_tmp374[0]),(_tmp376=="check"))&&((checker=_tmp374[1]),true,(expr=_tmp374[2]),true))))){var temp=mktemp();(current=current.concat([["assign",temp,curr],["send",checker,["data",temp]]]));newclause();return helper(expr,temp);}else{if((((_tmp371=lhs),(_tmp371 instanceof Array))&&(((_tmp372=_tmp371.length),(_tmp372==3))&&(((_tmp373=_tmp371[0]),(_tmp373=="send"))&&((fname=_tmp371[1]),true,(spec=_tmp371[2]),true))))){return helper(fname,["send","->",["data",spec,curr]]);}else{if((((_tmp368=lhs),(_tmp368 instanceof Array))&&(((_tmp369=_tmp368.length),(_tmp369>=1))&&(((_tmp370=_tmp368[0]),(_tmp370=="data"))&&((specs=_tmp368.slice(1)),true))))){var fw=0;var bw=0;var rest=undefined;var members=specs.map(function(x){var v=expand.step(env,"pattern",x);if(((v instanceof Array)&&(v[0]=="dynsplice"))){(rest=v[1]);}else{if((rest===undefined)){(fw=(fw+1));}else{if(true){(bw=(bw+1));}else{false;}}}return v;});var cmp=function(){if((rest===undefined)){return "___eq";}else{if(true){return "___gte";}else{return false;}}}();var temp=mktemp();var len=mktemp();(current=current.concat([["assign",temp,curr],["send","___instanceof",["data",temp,"Array"]]]));newclause();(current=current.concat([["assign",len,["send",temp,["value","length"]]],["send",cmp,["data",len,["value",(fw+bw)]]]]));newclause();for(var j=0;(j<fw);(++j)){helper_noexpand(members[j],["send",temp,["value",j]]);}if((rest!==undefined)){var slice=function(){if((bw>0)){return ["data",["value",fw],["value",(-bw)]];}else{if(true){return ["data",["value",fw]];}else{return false;}}}();helper_noexpand(members[fw][1],["send",["send",temp,["value","slice"]],slice]);}else{false;}for(var j=0;(j<bw);(++j)){helper_noexpand(members[((fw+j)+1)],["send",temp,["send","___minus",["data",len,["value",(bw-j)]]]]);}}else{throw "Could not find a match";}}}}}}}}};helper(lhs,rhs);if((current.length>1)){clauses.push(current);}else{false;}return [vars,clauses];};var make_declarations=function(vars){return vars.map(function(name){return ["declare",name,["value",undefined]];});};var make_pattern_test=function(clauses){var ands=clauses.pop();while((clauses.length>0)){(ands=["send","___and",["data",clauses.pop(),ands]]);}return ands;};var make_or_pattern=function(clauses){var ors=clauses.pop();while((clauses.length>0)){(ors=["send","___or",["data",clauses.pop(),ors]]);}return ors;};stdenv.register_macro("|>",function(env,context,_tmp388){var _tmp389=undefined;var _tmp390=undefined;var _tmp391=undefined;var to_match=undefined;var cl=undefined;if((((_tmp389=_tmp388),(_tmp389 instanceof Array))&&(((_tmp390=_tmp389.length),(_tmp390==3))&&(((_tmp391=_tmp389[0]),(_tmp391=="data"))&&((to_match=_tmp389[1]),true,(cl=_tmp389[2]),true))))){false;}else{throw "a condition failed";}var clauses=function(){var other=undefined;var _tmp392=undefined;var _tmp393=undefined;var _tmp394=undefined;var cls=undefined;if((((_tmp392=cl),(_tmp392 instanceof Array))&&(((_tmp393=_tmp392.length),(_tmp393>=1))&&(((_tmp394=_tmp392[0]),(_tmp394=="multi"))&&((cls=_tmp392.slice(1)),true))))){return cls;}else{if(((other=cl),true)){return [other];}else{throw "Could not find a match";}}}();var decls=["multi"];var r=["js_throw",["value","Could not find a match"]];while((clauses.length>0)){var _tmp395=undefined;var _tmp396=undefined;var _tmp397=undefined;var _tmp398=undefined;var _tmp399=undefined;var _tmp400=undefined;var _tmp401=undefined;var lhs=undefined;var body=undefined;if((((_tmp395=clauses.pop()),(_tmp395 instanceof Array))&&(((_tmp396=_tmp395.length),(_tmp396==3))&&(((_tmp397=_tmp395[0]),(_tmp397=="send"))&&(((_tmp398=_tmp395[1]),(_tmp398=="->"))&&(((_tmp399=_tmp395[2]),(_tmp399 instanceof Array))&&(((_tmp400=_tmp399.length),(_tmp400==3))&&(((_tmp401=_tmp399[0]),(_tmp401=="data"))&&((lhs=_tmp399[1]),true,(body=_tmp399[2]),true))))))))){false;}else{throw "a condition failed";}var p=parse_lhs(env,lhs,to_match);var test=make_pattern_test(p[1]);(r=["if",test,body,r]);(decls=decls.concat(make_declarations(p[0])));}decls.push(r);return decls;});var js_op_table=({"___plus":"+","___minus":"-","___times":"*","___div":"/","___mod":"%","___binxor":"^","___binand":"&","___binor":"|","___binnot":"~","___and":"&&","___or":"||","___not":"!","___is":"===","___isnt":"!==","___eq":"==","___neq":"!=","___lt":"<","___gt":">","___lte":"<=","___gte":">=","___in":" in ","___instanceof":" instanceof ","___plusplus":"++","___minusminus":"--"});var translate=function(expr,mode){var other=undefined;var _tmp402=undefined;var _tmp403=undefined;var _tmp404=undefined;var f=undefined;var msg=undefined;var _tmp405=undefined;var _tmp406=undefined;var _tmp407=undefined;var f=undefined;var _tmp408=undefined;var _tmp409=undefined;var _tmp410=undefined;var args=undefined;var _tmp411=undefined;var _tmp412=undefined;var _tmp413=undefined;var f=undefined;var _tmp414=undefined;var msg=undefined;var _tmp415=undefined;var _tmp416=undefined;var _tmp417=undefined;var s=undefined;var _tmp418=undefined;var _tmp419=undefined;var _tmp420=undefined;var args=undefined;var _tmp421=undefined;var _tmp422=undefined;var _tmp423=undefined;var args=undefined;var _tmp424=undefined;var _tmp425=undefined;var _tmp426=undefined;var value=undefined;var _tmp427=undefined;var _tmp428=undefined;var _tmp429=undefined;var value=undefined;var _tmp430=undefined;var _tmp431=undefined;var _tmp432=undefined;var _tmp433=undefined;var _tmp434=undefined;var _tmp435=undefined;var _tmp436=undefined;var _tmp437=undefined;var _tmp438=undefined;var args=undefined;var _tmp439=undefined;var _tmp440=undefined;var _tmp441=undefined;var args=undefined;var _tmp442=undefined;var _tmp443=undefined;var _tmp444=undefined;var lhs=undefined;var rhs=undefined;var _tmp445=undefined;var _tmp446=undefined;var _tmp447=undefined;var binding=undefined;var value=undefined;var _tmp448=undefined;var _tmp449=undefined;var _tmp450=undefined;var x=undefined;var y=undefined;var z=undefined;var body=undefined;var _tmp451=undefined;var _tmp452=undefined;var _tmp453=undefined;var test=undefined;var body=undefined;var _tmp454=undefined;var _tmp455=undefined;var _tmp456=undefined;var test=undefined;var pos=undefined;var neg=undefined;var _tmp457=undefined;var _tmp458=undefined;var _tmp459=undefined;var bindings=undefined;var body=undefined;var _tmp460=undefined;var _tmp461=undefined;var _tmp462=undefined;var v=undefined;var _tmp463=undefined;var _tmp464=undefined;if(((_tmp464=expr),(typeof(_tmp464)=="string"))){return translate.expr(translate.mangle(expr),mode);}else{if(((_tmp463=expr),(_tmp463===null))){return translate.expr("null",mode);}else{if((((_tmp460=expr),(_tmp460 instanceof Array))&&(((_tmp461=_tmp460.length),(_tmp461==2))&&(((_tmp462=_tmp460[0]),(_tmp462=="value"))&&((v=_tmp460[1]),true))))){var r=function(){var other=undefined;var _tmp465=undefined;var _tmp473=undefined;var _tmp466=undefined;var _tmp472=undefined;var _tmp467=undefined;var _tmp471=undefined;var _tmp468=undefined;var _tmp470=undefined;var _tmp469=undefined;var _tmp474=undefined;if(((_tmp474=v),(typeof(_tmp474)=="string"))){var repl=({"\"":"\\\"","\n":"\\n","\\":"\\\\"});(v=v.replace(RegExp("((?:(?:\"|\\\\)|\n))","g"),function(m){return repl[m];}));return (("\""+v)+"\"");}else{if(((_tmp465=v),(((_tmp466=_tmp465),(((_tmp467=_tmp466),(((_tmp468=_tmp467),(((_tmp469=_tmp468),(typeof(_tmp469)=="number"))||((_tmp470=_tmp468),(_tmp470===true))))||((_tmp471=_tmp467),(_tmp471===false))))||((_tmp472=_tmp466),(_tmp472===null))))||((_tmp473=_tmp465),(_tmp473===undefined))))){return String(v);}else{if(((other=v),true)){return (("?!?["+v)+"]?!?");}else{throw "Could not find a match";}}}}();return translate.expr(r,mode);}else{if((((_tmp457=expr),(_tmp457 instanceof Array))&&(((_tmp458=_tmp457.length),(_tmp458==3))&&(((_tmp459=_tmp457[0]),(_tmp459=="lambda"))&&((bindings=_tmp457[1]),true,(body=_tmp457[2]),true))))){var a=bindings.join(",");var b=translate.body(body,"return");return translate.expr((((("function("+a)+"){")+b)+"}"),mode);}else{if((((_tmp454=expr),(_tmp454 instanceof Array))&&(((_tmp455=_tmp454.length),(_tmp455==4))&&(((_tmp456=_tmp454[0]),(_tmp456=="if"))&&((test=_tmp454[1]),true,(pos=_tmp454[2]),true,(neg=_tmp454[3]),true))))){var other=undefined;var _tmp475=undefined;if(((_tmp475=mode),(_tmp475=="expr"))){return translate.body(expr,"expr");}else{if(((other=mode),true)){var a=translate(test,"expr");var b=translate(pos,mode);var c=translate(neg,mode);return (((((("if("+a)+"){")+b)+"}else{")+c)+"}");}else{throw "Could not find a match";}}}else{if((((_tmp451=expr),(_tmp451 instanceof Array))&&(((_tmp452=_tmp451.length),(_tmp452==3))&&(((_tmp453=_tmp451[0]),(_tmp453=="js_while"))&&((test=_tmp451[1]),true,(body=_tmp451[2]),true))))){var other=undefined;var _tmp476=undefined;if(((_tmp476=mode),(_tmp476=="expr"))){return translate.body(expr,"expr");}else{if(((other=mode),true)){var a=translate(test,"expr");var b=translate(body,"stmt");return (((("while("+a)+"){")+b)+"}");}else{throw "Could not find a match";}}}else{if((((_tmp448=expr),(_tmp448 instanceof Array))&&(((_tmp449=_tmp448.length),(_tmp449==5))&&(((_tmp450=_tmp448[0]),(_tmp450=="js_for"))&&((x=_tmp448[1]),true,(y=_tmp448[2]),true,(z=_tmp448[3]),true,(body=_tmp448[4]),true))))){var other=undefined;var _tmp477=undefined;if(((_tmp477=mode),(_tmp477=="expr"))){return translate.body(expr,"expr");}else{if(((other=mode),true)){var a=translate(x,"stmt");var b=translate(y,"stmt");var c=translate(z,"expr");var d=translate(body,"stmt");return (((((("for("+a)+b)+c)+"){")+d)+"}");}else{throw "Could not find a match";}}}else{if((((_tmp445=expr),(_tmp445 instanceof Array))&&(((_tmp446=_tmp445.length),(_tmp446==3))&&(((_tmp447=_tmp445[0]),(_tmp447=="declare"))&&((binding=_tmp445[1]),true,(value=_tmp445[2]),true))))){var other=undefined;var _tmp478=undefined;var _tmp480=undefined;var _tmp479=undefined;if(((_tmp478=mode),(((_tmp479=_tmp478),(_tmp479=="expr"))||((_tmp480=_tmp478),(_tmp480=="return"))))){throw "Invalid in expr ctx";}else{if(((other=mode),true)){var a=translate(binding,"expr");var b=translate(value,"expr");return (((("var "+a)+"=")+b)+";");}else{throw "Could not find a match";}}}else{if((((_tmp442=expr),(_tmp442 instanceof Array))&&(((_tmp443=_tmp442.length),(_tmp443==3))&&(((_tmp444=_tmp442[0]),(_tmp444=="assign"))&&((lhs=_tmp442[1]),true,(rhs=_tmp442[2]),true))))){var a=translate(lhs,"expr");var b=translate(rhs,"expr");return translate.expr((((("("+a)+"=")+b)+")"),mode);}else{if((((_tmp439=expr),(_tmp439 instanceof Array))&&(((_tmp440=_tmp439.length),(_tmp440>=1))&&(((_tmp441=_tmp439[0]),(_tmp441=="multi"))&&((args=_tmp439.slice(1)),true))))){var isdecl=function(x){return ((x instanceof Array)&&(x[0]=="declare"));};if((args.length==1)){return translate(args[0],mode);}else{if(((mode=="expr")&&(args.filter(isdecl).length==0))){var xs=args.map(function(x){return translate(x,"expr");});return (("("+xs.join(","))+")");}else{if(true){return translate.body(expr,mode);}else{return false;}}}}else{if((((_tmp436=expr),(_tmp436 instanceof Array))&&(((_tmp437=_tmp436.length),(_tmp437>=1))&&(((_tmp438=_tmp436[0]),(_tmp438=="splice"))&&((args=_tmp436.slice(1)),true))))){return translate(["multi"].concat(args),mode);}else{if((((_tmp433=expr),(_tmp433 instanceof Array))&&(((_tmp434=_tmp433.length),(_tmp434==1))&&((_tmp435=_tmp433[0]),(_tmp435=="js_break"))))){if((mode=="expr")){throw "Invalid break in ctx";}else{if(true){return "break;";}else{return false;}}}else{if((((_tmp430=expr),(_tmp430 instanceof Array))&&(((_tmp431=_tmp430.length),(_tmp431==1))&&((_tmp432=_tmp430[0]),(_tmp432=="js_continue"))))){if((mode=="expr")){throw "Invalid continue in ctx";}else{if(true){return "continue;";}else{return false;}}}else{if((((_tmp427=expr),(_tmp427 instanceof Array))&&(((_tmp428=_tmp427.length),(_tmp428==2))&&(((_tmp429=_tmp427[0]),(_tmp429=="js_return"))&&((value=_tmp427[1]),true))))){if((mode=="expr")){throw "Invalid return in ctx";}else{if(true){return (("return "+translate(value,"expr"))+";");}else{return false;}}}else{if((((_tmp424=expr),(_tmp424 instanceof Array))&&(((_tmp425=_tmp424.length),(_tmp425==2))&&(((_tmp426=_tmp424[0]),(_tmp426=="js_throw"))&&((value=_tmp424[1]),true))))){if(true){return (("throw "+translate(value,"expr"))+";");}else{return false;}}else{if((((_tmp421=expr),(_tmp421 instanceof Array))&&(((_tmp422=_tmp421.length),(_tmp422>=1))&&(((_tmp423=_tmp421[0]),(_tmp423=="array"))&&((args=_tmp421.slice(1)),true))))){var r=function(){var f=function(x){return translate(x,"expr");};return (("["+args.map(f).join(","))+"]");}();return translate.expr(r,mode);}else{if((((_tmp418=expr),(_tmp418 instanceof Array))&&(((_tmp419=_tmp418.length),(_tmp419>=1))&&(((_tmp420=_tmp418[0]),(_tmp420=="object"))&&((args=_tmp418.slice(1)),true))))){var r=function(){var f=function(x){var a=translate(x[1],"expr");var b=translate(x[2],"expr");return ((a+":")+b);};return (("({"+args.map(f).join(","))+"})");}();return translate.expr(r,mode);}else{if((((_tmp411=expr),(_tmp411 instanceof Array))&&(((_tmp412=_tmp411.length),(_tmp412==3))&&(((_tmp413=_tmp411[0]),(_tmp413=="send"))&&(((f=_tmp411[1]),true,(_tmp414=_tmp411[2]),(msg=_tmp414),true,(_tmp415=_tmp414),(_tmp415 instanceof Array))&&(((_tmp416=_tmp415.length),(_tmp416==2))&&(((_tmp417=_tmp415[0]),(_tmp417=="value"))&&((s=_tmp415[1]),true)))))))){if(((typeof(s)=="string")&&s.match(RegExp("(?:^(?:[a-zA-Z_$]+)$)")))){var trf=translate(f,"expr");var trmsg=translate(s,"expr");return translate.expr(((trf+".")+trmsg),mode);}else{if(true){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{return false;}}}else{if((((_tmp405=expr),(_tmp405 instanceof Array))&&(((_tmp406=_tmp405.length),(_tmp406==3))&&(((_tmp407=_tmp405[0]),(_tmp407=="send"))&&(((f=_tmp405[1]),true,(_tmp408=_tmp405[2]),(_tmp408 instanceof Array))&&(((_tmp409=_tmp408.length),(_tmp409>=1))&&(((_tmp410=_tmp408[0]),(_tmp410=="array"))&&((args=_tmp408.slice(1)),true)))))))){var op=((typeof(f)=="string")&&js_op_table[f]);if(op){return translate.expr(translate.op(op,args[0],args[1]),mode);}else{if(true){var trf=translate(f,"expr");var trargs=args.map(function(x){return translate(x,"expr");});return translate.expr((((trf+"(")+trargs.join(","))+")"),mode);}else{return false;}}}else{if((((_tmp402=expr),(_tmp402 instanceof Array))&&(((_tmp403=_tmp402.length),(_tmp403==3))&&(((_tmp404=_tmp402[0]),(_tmp404=="send"))&&((f=_tmp402[1]),true,(msg=_tmp402[2]),true))))){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{if(((other=expr),true)){throw other;}else{throw "Could not find a match";}}}}}}}}}}}}}}}}}}}}}};(translate.mangle=function(name){var tr=({"+":"__plus__","-":"__minus__","*":"__asterisk__","/":"__slash__","%":"__percent__","^":"__caret__","#":"__hash__","&":"__amp__","|":"__pipe__","@":"__at__","!":"__bang__","?":"__qmark__","=":"__equal__","<":"__lt__",">":"__gt__","~":"__tilde__"});var r=[];for(var i=0;(i<name.length);(++i)){var c=name[i];r.push((tr[c]||c));}return r.join("");});(translate.body=function(b,mode){(orig=b);(b=aslist(b));var trst=function(stmt){return translate(stmt,"stmt");};var _tmp481=undefined;var _tmp482=undefined;var _tmp483=undefined;if(((_tmp483=mode),(_tmp483=="expr"))){var x=["send",["lambda",[],orig],["array"]];return translate(x,mode);}else{if(((_tmp482=mode),(_tmp482=="return"))){var stmts=b.slice(0,(-1));var ret=b[(b.length-1)];return (stmts.map(trst).join("")+translate(ret,"return"));}else{if(((_tmp481=mode),(_tmp481=="stmt"))){return b.map(trst).join("");}else{throw "Could not find a match";}}}});(translate.expr=function(x,mode){var _tmp484=undefined;var _tmp485=undefined;var _tmp486=undefined;if(((_tmp486=mode),(_tmp486=="expr"))){return x;}else{if(((_tmp485=mode),(_tmp485=="stmt"))){return (x+";");}else{if(((_tmp484=mode),(_tmp484=="return"))){return (("return "+x)+";");}else{throw "Could not find a match";}}}});(translate.op=function(op,a,b){(e=function(){if((a===null)){return (op+translate(b,"expr"));}else{if((b===null)){return (translate(a,"expr")+op);}else{if(true){return ((translate(a,"expr")+op)+translate(b,"expr"));}else{return false;}}}}());return (("("+e)+")");});var fs=require("fs");var file=process.argv[2];var f=function(err,data){var p=parse(data);var ex=expand(stdenv,"top",["multi",p]);var prelude="var ___lib=require(\"./lib\");";return console.log((prelude+translate(ex,"stmt")));};fs.readFile(file,"utf8",f);
