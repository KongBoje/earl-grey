var ___lib=require("./lib");var special_ops=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",":":"IFX",".":"PFX"});var regexps=function(){var id=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))");var id_f=function(m,wsb,wsa,last_op){return ["ID","ID",m[0]];};var numr=RegExp("(?:^((?:\\d+))[rR]((?:[A-Za-z0-9_]+))(?:(?:\\.((?:[A-Za-z0-9_]+)))?))");var numr_f=function(m,wsb,wsa,last_op){var _tmp0;var _tmp1;var radix;var int;var frac;if((((_tmp0=m),(_tmp0 instanceof Array))&&(((_tmp1=_tmp0.length),(_tmp1==4))&&(_tmp0[0],true,(radix=_tmp0[1]),true,(int=_tmp0[2]),true,(frac=_tmp0[3]),true)))){false;}else{throw "a condition failed";}(value=parseInt(int.replace(RegExp("_","g"),""),radix));if(frac){(frac=frac.replace(RegExp("_","g"),""));(value=(value+(parseInt(frac,radix)/Math.pow(radix,frac.length))));}else{false;}return ["ID","NUM",value];};var num=RegExp("(?:^((?:[0-9_]+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:[0-9_]+)))?))");var num_f=function(m,wsb,wsa,last_op){return ["ID","NUM",parseFloat(m[0].replace(RegExp("_","g"),""))];};var str=RegExp("(?:^\"((?:(?:(?:\\\\\\\\|\\\\\")|[^\"])*))\")");var str_f=function(m,wsb,wsa,last_op){var repl=({"\\\"":"\"","\\\\":"\\","\\n":"\n"});var r=m[1].replace(RegExp("((?:(?:\\\\\"|\\\\\\\\)|\\\\n))","g"),function(m){return repl[m];});return ["ID","STR",r];};var op=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!#.:]+))");var op2=RegExp("(?:^[\\(\\[\\{\\}\\]\\),])");var op3=RegExp("(?:^(?:(?:(?:(?:(?:(?:(?:(?:with|where)|when)|and)|not)|or)|in)|instanceof)|mod)\\b)");var op4=RegExp("(?:^`((?:[A-Za-z0-9_]+))`)");var op_f=function(m,wsb,wsa,last_op){var op=(m[1]||m[0]);if((op in special_ops)){var fixity=special_ops[op];var width=function(){var _tmp2=fixity;var other;var _tmp3;var _tmp4;var _tmp5;if((((_tmp5=_tmp2),(_tmp5=="IFX"))&&(_tmp5,true))){if((wsb||wsa)){return "wide";}else{return "short";}}else{if((((_tmp4=_tmp2),(_tmp4=="SFX"))&&(_tmp4,true))){if(wsb){return "wide";}else{return "short";}}else{if((((_tmp3=_tmp2),(_tmp3=="PFX"))&&(_tmp3,true))){if(wsa){return "wide";}else{return "short";}}else{if(((other=_tmp2),true)){throw "OopsA";}else{throw ["Could not find a match",_tmp2];}}}}}();return ["OP",fixity,width,op];}else{if((wsa&&wsb)){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "IFX";}else{return false;}}}(),"wide",op];}else{if(((!wsa)&&(!wsb))){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "IFX";}else{return false;}}}(),"short",op];}else{if(wsa){if(last_op){return ["OP","PFX","wide",op];}else{if(true){return ["OP","SFX","short",op];}else{return false;}}}else{if(wsb){return ["OP","PFX","short",op];}else{if(true){return ["OP","PFX","short",op];}else{return false;}}}}}}};var indent=RegExp("(?:^(?:(?:\n((?: *)))+))");var indent_f=function(m,wsb,wsa,last_op){var ilen=m[1].length;return ["INDENT",ilen];};var cmnt=RegExp("(?:^;(?:[^\n]*))");var cmnt_f=function(m,wsb,wsa,last_op){return ["IGNORE"];};var unkn=RegExp("(?:^.)");var unkn_f=function(m,wsb,wsa,last_op){throw ("unknown character: "+m[0]);};return [[op3,op_f],[id,id_f],[numr,numr_f],[num,num_f],[str,str_f],[op,op_f],[op2,op_f],[op4,op_f],[indent,indent_f],[cmnt,cmnt_f],[unkn,unkn_f]];}();var ws_re=RegExp("(?:^(?: *)(?:(?:\n(?: *)\\\\(?: *))*))");var eol_re=RegExp("(?:^(?: *)(?:\n|$))");var indent_tracker=function(){var curr=false;var stack=[];var stacks=[stack];return function(token){var _tmp6=token;var other;var _tmp7;var _tmp8;var _tmp9;var fixity;var width;var _tmp10;var _tmp12;var _tmp11;var _tmp13;var _tmp14;var _tmp15;var fixity;var width;var _tmp16;var _tmp18;var _tmp17;var _tmp19;var _tmp20;var _tmp21;var stuff;var _tmp22;var _tmp23;var _tmp24;var new_indent;if((((_tmp22=_tmp6),(_tmp22 instanceof Array))&&(((_tmp23=_tmp22.length),(_tmp23==2))&&(((_tmp24=_tmp22[0]),(_tmp24=="INDENT"))&&(_tmp24,true,(new_indent=_tmp22[1]),true))))){if((curr===false)){(curr=new_indent);return [["OP","IFX","wide",","]];}else{if((new_indent>curr)){stack.push(curr);(curr=new_indent);return [["OP","PFX","wide","["]];}else{if((new_indent==curr)){return [["OP","IFX","wide",","]];}else{if((new_indent<curr)){var rval=[];while(((stack.length>0)&&(new_indent<curr))){(curr=stack.pop());rval.push(["OP","SFX","wide","]"]);}rval.push(["OP","IFX","wide",","]);return rval;}else{if(true){throw [curr,new_indent];}else{return false;}}}}}}else{if((((_tmp19=_tmp6),(_tmp19 instanceof Array))&&(((_tmp20=_tmp19.length),(_tmp20>=1))&&(((_tmp21=_tmp19[0]),(_tmp21=="ID"))&&(_tmp21,true,(stuff=_tmp19.slice(1)),true))))){return [token];}else{if((((_tmp13=_tmp6),(_tmp13 instanceof Array))&&(((_tmp14=_tmp13.length),(_tmp14==4))&&(((_tmp15=_tmp13[0]),(_tmp15=="OP"))&&(_tmp15,true,(fixity=_tmp13[1]),true,(width=_tmp13[2]),true,(_tmp16=_tmp13[3]),((((_tmp17=_tmp16),(_tmp17=="["))&&(_tmp17,true))||(((_tmp18=_tmp16),(_tmp18=="{"))&&(_tmp18,true)))))))){stack.push(curr);stacks.push(stack);(stack=[]);(curr=false);return [token];}else{if((((_tmp7=_tmp6),(_tmp7 instanceof Array))&&(((_tmp8=_tmp7.length),(_tmp8==4))&&(((_tmp9=_tmp7[0]),(_tmp9=="OP"))&&(_tmp9,true,(fixity=_tmp7[1]),true,(width=_tmp7[2]),true,(_tmp10=_tmp7[3]),((((_tmp11=_tmp10),(_tmp11=="]"))&&(_tmp11,true))||(((_tmp12=_tmp10),(_tmp12=="}"))&&(_tmp12,true)))))))){var rval=stack.map(function(x){return ["OP","SFX","short","]"];});(stack=stacks.pop());(curr=stack.pop());rval.push(token);return rval;}else{if(((other=_tmp6),true)){return [token];}else{throw ["Could not find a match",_tmp6];}}}}}};};var process_token=function(token,last_op,wsa,wsb,pos,endpos,accum){var _tmp25;var _tmp26;var type;var result;if((((_tmp25=token),(_tmp25 instanceof Array))&&(((_tmp26=_tmp25.length),(_tmp26>=1))&&((type=_tmp25[0]),true,(result=_tmp25.slice(1)),true)))){false;}else{throw "a condition failed";}var _tmp27=type;var other;var _tmp28;var _tmp29;var _tmp30;if((((_tmp30=_tmp27),(_tmp30=="IGNORE"))&&(_tmp30,true))){return last_op;}else{if((((_tmp29=_tmp27),(_tmp29=="ID"))&&(_tmp29,true))){if((!last_op)){var w=["IFX",function(){if(wsb){return "wide";}else{return "short";}}(),"WHITE"];(w.location=[pos,pos]);accum.push(w);}else{false;}accum.push(result);return false;}else{if((((_tmp28=_tmp27),(_tmp28=="OP"))&&(_tmp28,true))){if(last_op){var v=["VOID"];(v.location=[pos,pos]);accum.push(v);}else{false;}var _tmp31=result[0];var _tmp32;var _tmp33;var _tmp34;if((((_tmp34=_tmp31),(_tmp34=="IFX"))&&(_tmp34,true))){accum.push(result);return true;}else{if((((_tmp33=_tmp31),(_tmp33=="PFX"))&&(_tmp33,true))){if((!last_op)){var w=["IFX",function(){if(wsb){return "wide";}else{return "short";}}(),"WHITE"];(w.location=[pos,pos]);var v=["VOID"];(v.location=[pos,pos]);accum.push(w);accum.push(v);}else{false;}accum.push(result);return true;}else{if((((_tmp32=_tmp31),(_tmp32=="SFX"))&&(_tmp32,true))){accum.push(result);var v=["VOID"];(v.location=[endpos,endpos]);accum.push(v);return false;}else{throw ["Could not find a match",_tmp31];}}}}else{if(((other=_tmp27),true)){throw "OopsB";}else{throw ["Could not find a match",_tmp27];}}}}};var tokenize=function(text){var last_op=true;var results=[];var wsb=text.match(ws_re)[0].length;(text=text.slice(wsb));(pos=wsb);var indent=indent_tracker();while(text){for(var i=0;(i<regexps.length);(++i)){var _tmp35;var _tmp36;var re;var fn;if((((_tmp35=regexps[i]),(_tmp35 instanceof Array))&&(((_tmp36=_tmp35.length),(_tmp36==2))&&((re=_tmp35[0]),true,(fn=_tmp35[1]),true)))){false;}else{throw "a condition failed";}var m=text.match(re);if(m){var skip=m[0].length;var endpos=(pos+skip);(text=text.slice(skip));var wsa=text.match(ws_re)[0].length;var eol=(text.match(eol_re)&&true);var bwsb=(wsb>0);var bwsa=function(){if(eol){return bwsb;}else{return (wsa>0);}}();var token=fn(m,bwsb,bwsa,last_op);var tokens=indent(token);tokens.forEach(function(x){return (last_op=process_token(x,last_op,bwsa,bwsb,pos,endpos,results));});(text=text.slice(wsa));(wsb=wsa);(pos=(endpos+wsa));break;}else{false;}}}if(last_op){var v=["VOID"];(v.location=[pos,pos]);results.push(v);}else{false;}return results;};var MAX=(1/0);var order_map=({"IFX":({"wide":({",":[[15,1],[15,1]],"with":[[15,999],[15,10]],"where":[[15,11],[15,10]],"|>":[[15,11],[15,10]],"->":[[15,11],[15,10]],"=>":[[15,11],[15,10]],"=":[[15,11],[15,10]],":=":[[15,11],[15,10]],"+=":[[15,11],[15,10]],"-=":[[15,11],[15,10]],"*=":[[15,11],[15,10]],"/=":[[15,11],[15,10]],"<<=":[[15,11],[15,10]],">>=":[[15,11],[15,10]],">>>=":[[15,11],[15,10]],"when":[[15,100],[15,101]],"||":[[15,110],[15,111]],"&&":[[15,120],[15,121]],"or":[[15,110],[15,111]],"and":[[15,120],[15,121]],"not":[[15,130],[15,131]],"==":[[15,200],[15,201]],"!=":[[15,200],[15,201]],">=":[[15,200],[15,201]],"<=":[[15,200],[15,201]],">":[[15,200],[15,201]],"<":[[15,200],[15,201]],"^.":[[15,400],[15,401]],"|.":[[15,410],[15,411]],"&.":[[15,420],[15,421]],"<<":[[1,500],[1,501]],">>":[[1,500],[1,501]],">>>":[[1,500],[1,501]],"+":[[1,550],[1,551]],"-":[[1,550],[1,551]],"*":[[1,560],[1,561]],"/":[[1,560],[1,561]],"mod":[[1,560],[1,561]],"**":[[1,571],[1,570]],"default":[[8,900],[4,901]],"WHITE":[[15,1000],[15,1001]],":":[[15,1001],[15,2]]}),"short":({"default":[[15,1900],[15,1901]],"WHITE":[[15,2000],[15,2001]],",":[[15,1],[15,1]],":":[[15,1001],[15,2]]})}),"PFX":({"wide":({"default":[[15,MAX],[15,900]],"not":[[15,130],[15,131]],".":[[15,MAX],[15,3000]],"#":[[15,MAX],[15,3000]],"<>":[[15,MAX],[15,5]],"(":[[15,MAX],[15,1]],"[":[[15,MAX],[15,1]],"{":[[15,MAX],[15,1]]}),"short":({"default":[[15,MAX],[15,1900]],".":[[15,MAX],[15,3000]],"#":[[15,MAX],[15,3000]],"(":[[15,MAX],[15,1]],"[":[[15,MAX],[15,1]],"{":[[15,MAX],[15,1]]})}),"SFX":({"wide":({"default":[[15,901],[15,MAX]],")":[[15,1],[15,MAX]],"]":[[15,1],[15,MAX]],"}":[[15,1],[15,MAX]]}),"short":({"default":[[15,1901],[15,MAX]],")":[[15,1],[15,MAX]],"]":[[15,1],[15,MAX]],"}":[[15,1],[15,MAX]]})})});var DONE=(-1);var NONE=0;var LEFT=1;var RIGHT=2;var BOTH=3;var oparse=function(next,order,finalize){var between=finalize(next());var right_op=next();var stack=[];var left_op=null;var current=null;while(true){var o=function(){if(((!left_op)&&(!right_op))){return DONE;}else{if(true){return ((((!left_op)&&RIGHT)||((!right_op)&&LEFT))||order(left_op,right_op));}else{return false;}}}();var _tmp37=o;var other;var _tmp38;var _tmp39;var _tmp40;var _tmp41;var _tmp42;if((((_tmp42=_tmp37),(_tmp42==DONE))&&(_tmp42,true))){return between;}else{if((((_tmp41=_tmp37),(_tmp41==LEFT))&&(_tmp41,true))){current.push(between);(between=finalize(current));var v=stack.pop();(left_op=v[0]);(current=v[1]);}else{if((((_tmp40=_tmp37),(_tmp40==RIGHT))&&(_tmp40,true))){stack.push([left_op,current]);(left_op=right_op);(current=[[right_op],between]);(between=finalize(next()));(right_op=next());}else{if((((_tmp39=_tmp37),(_tmp39==BOTH))&&(_tmp39,true))){current[0].push(right_op);current.push(between);(left_op=right_op);(between=finalize(next()));(right_op=next());}else{if((((_tmp38=_tmp37),(_tmp38==NONE))&&(_tmp38,true))){throw ((("Undefined priority between "+left_op)+" and ")+right_op);}else{if(((other=_tmp37),true)){throw "OopsC";}else{throw ["Could not find a match",_tmp37];}}}}}}}};var consult=function(_tmp43){var _tmp44;var _tmp45;var fixity;var width;var op;if((((_tmp44=_tmp43),(_tmp44 instanceof Array))&&(((_tmp45=_tmp44.length),(_tmp45==3))&&((fixity=_tmp44[0]),true,(width=_tmp44[1]),true,(op=_tmp44[2]),true)))){false;}else{throw "a condition failed";}var map=order_map[fixity][width];return (map[op]||map.default);};var order=function(o1,o2){var _tmp46;var _tmp47;var code1;var ord1;if((((_tmp46=consult(o1)[1]),(_tmp46 instanceof Array))&&(((_tmp47=_tmp46.length),(_tmp47==2))&&((code1=_tmp46[0]),true,(ord1=_tmp46[1]),true)))){false;}else{throw "a condition failed";}var _tmp48;var _tmp49;var code2;var ord2;if((((_tmp48=consult(o2)[0]),(_tmp48 instanceof Array))&&(((_tmp49=_tmp48.length),(_tmp49==2))&&((code2=_tmp48[0]),true,(ord2=_tmp48[1]),true)))){false;}else{throw "a condition failed";}if(((code1&code2)==0)){throw ["Cannot mix",o1,o2];}else{if((ord1>ord2)){return LEFT;}else{if((ord1<ord2)){return RIGHT;}else{if((ord1==ord2)){return BOTH;}else{return false;}}}}};var finalize=function(x){var _tmp50=x;var other;var _tmp51;var _tmp52;var ops;var args;var _tmp53;var _tmp54;var _tmp55;var _tmp56;var _tmp57;var _tmp58;var value;var _tmp59;var _tmp60;var _tmp61;var value;var _tmp62;var _tmp63;var _tmp64;var value;if((((_tmp62=_tmp50),(_tmp62 instanceof Array))&&(((_tmp63=_tmp62.length),(_tmp63==2))&&(((_tmp64=_tmp62[0]),(_tmp64=="ID"))&&(_tmp64,true,(value=_tmp62[1]),true))))){return value;}else{if((((_tmp59=_tmp50),(_tmp59 instanceof Array))&&(((_tmp60=_tmp59.length),(_tmp60==2))&&(((_tmp61=_tmp59[0]),(_tmp61=="NUM"))&&(_tmp61,true,(value=_tmp59[1]),true))))){return ["value",value];}else{if((((_tmp56=_tmp50),(_tmp56 instanceof Array))&&(((_tmp57=_tmp56.length),(_tmp57==2))&&(((_tmp58=_tmp56[0]),(_tmp58=="STR"))&&(_tmp58,true,(value=_tmp56[1]),true))))){return ["value",value];}else{if((((_tmp53=_tmp50),(_tmp53 instanceof Array))&&(((_tmp54=_tmp53.length),(_tmp54==1))&&(((_tmp55=_tmp53[0]),(_tmp55=="VOID"))&&(_tmp55,true))))){return null;}else{if((((_tmp51=_tmp50),(_tmp51 instanceof Array))&&(((_tmp52=_tmp51.length),(_tmp52>=1))&&((ops=_tmp51[0]),true,(args=_tmp51.slice(1)),true)))){(ops=ops.map(function(o){return o[2];}));var op=ops[0];var _tmp65=[ops,args];var other;var _tmp66;var _tmp67;var _tmp68;var _tmp69;var _tmp70;var _tmp71;var a;var b;var _tmp72;var _tmp73;var _tmp74;var _tmp75;var _tmp76;var _tmp77;var _tmp78;var _tmp79;var _tmp80;var _tmp81;var _tmp82;var _tmp83;var _tmp84;var _tmp85;var _tmp86;var _tmp87;var _tmp88;var _tmp89;var _tmp90;var _tmp91;var _tmp92;var _tmp93;var _tmp94;var _tmp96;var _tmp95;var _tmp97;var _tmp98;var _tmp99;var _tmp100;var _tmp101;var _tmp102;var _tmp103;var target;var body;var _tmp104;var _tmp105;var _tmp106;var _tmp107;var _tmp108;var _tmp109;var _tmp110;var f;var body;var _tmp111;var _tmp112;var _tmp113;var _tmp114;var _tmp115;var _tmp116;var _tmp117;var _tmp118;var f;var arg;var body;if((((_tmp111=_tmp65),(_tmp111 instanceof Array))&&(((_tmp112=_tmp111.length),(_tmp112==2))&&(((_tmp113=_tmp111[0]),(_tmp113 instanceof Array))&&(((_tmp114=_tmp113.length),(_tmp114==2))&&(((_tmp115=_tmp113[0]),(_tmp115=="WHITE"))&&((_tmp115,true,(_tmp116=_tmp113[1]),(_tmp116==":"))&&((_tmp116,true,(_tmp117=_tmp111[1]),(_tmp117 instanceof Array))&&(((_tmp118=_tmp117.length),(_tmp118==3))&&((f=_tmp117[0]),true,(arg=_tmp117[1]),true,(body=_tmp117[2]),true)))))))))){return ["send",f,["data",["code",arg],["code",body]]];}else{if((((_tmp104=_tmp65),(_tmp104 instanceof Array))&&(((_tmp105=_tmp104.length),(_tmp105==2))&&(((_tmp106=_tmp104[0]),(_tmp106 instanceof Array))&&(((_tmp107=_tmp106.length),(_tmp107==1))&&(((_tmp108=_tmp106[0]),(_tmp108==":"))&&((_tmp108,true,(_tmp109=_tmp104[1]),(_tmp109 instanceof Array))&&(((_tmp110=_tmp109.length),(_tmp110==2))&&((f=_tmp109[0]),true,(body=_tmp109[1]),true))))))))){return ["send",f,["data",["code",body]]];}else{if((((_tmp97=_tmp65),(_tmp97 instanceof Array))&&(((_tmp98=_tmp97.length),(_tmp98==2))&&(((_tmp99=_tmp97[0]),(_tmp99 instanceof Array))&&(((_tmp100=_tmp99.length),(_tmp100==1))&&(((_tmp101=_tmp99[0]),(_tmp101=="with"))&&((_tmp101,true,(_tmp102=_tmp97[1]),(_tmp102 instanceof Array))&&(((_tmp103=_tmp102.length),(_tmp103==2))&&((target=_tmp102[0]),true,(body=_tmp102[1]),true))))))))){(body=function(){var _tmp130=body;var other;var _tmp131;var _tmp132;var _tmp133;var rest;if((((_tmp131=_tmp130),(_tmp131 instanceof Array))&&(((_tmp132=_tmp131.length),(_tmp132>=1))&&(((_tmp133=_tmp131[0]),(_tmp133=="multi"))&&(_tmp133,true,(rest=_tmp131.slice(1)),true))))){return rest;}else{if(((other=_tmp130),true)){return [body];}else{throw ["Could not find a match",_tmp130];}}}());var _tmp119=target;var other;var _tmp120;var _tmp121;var _tmp122;var args;var _tmp123;var _tmp124;var _tmp125;var f;var _tmp126;var _tmp127;var _tmp128;var args;var _tmp129;if((((_tmp129=_tmp119),(_tmp129===null))&&(_tmp129,true))){return ["data"].concat(body);}else{if((((_tmp123=_tmp119),(_tmp123 instanceof Array))&&(((_tmp124=_tmp123.length),(_tmp124==3))&&(((_tmp125=_tmp123[0]),(_tmp125=="send"))&&((_tmp125,true,(f=_tmp123[1]),true,(_tmp126=_tmp123[2]),(_tmp126 instanceof Array))&&(((_tmp127=_tmp126.length),(_tmp127>=1))&&(((_tmp128=_tmp126[0]),(_tmp128=="data"))&&(_tmp128,true,(args=_tmp126.slice(1)),true)))))))){return ["send",f,["data"].concat(args).concat(body)];}else{if((((_tmp120=_tmp119),(_tmp120 instanceof Array))&&(((_tmp121=_tmp120.length),(_tmp121>=1))&&(((_tmp122=_tmp120[0]),(_tmp122=="data"))&&(_tmp122,true,(args=_tmp120.slice(1)),true))))){return target.concat(body);}else{if(((other=_tmp119),true)){return ["send",target,["data"].concat(body)];}else{throw ["Could not find a match",_tmp119];}}}}}else{if((((_tmp90=_tmp65),(_tmp90 instanceof Array))&&(((_tmp91=_tmp90.length),(_tmp91==2))&&(((_tmp92=_tmp90[0]),(_tmp92 instanceof Array))&&(((_tmp93=_tmp92.length),(_tmp93>=1))&&(((_tmp94=_tmp92[0]),((((_tmp95=_tmp94),(_tmp95=="["))&&(_tmp95,true))||(((_tmp96=_tmp94),(_tmp96==","))&&(_tmp96,true))))&&(_tmp92.slice(1),true,_tmp90[1],true))))))){if((op=="[")){(args=args.slice(1,(-1)));}else{false;}(args=function(){var f=function(x){return (x!==null);};return args.filter(f);}());var result=function(){var _tmp134=args;var other;var _tmp135;var _tmp136;var x;var _tmp137;var _tmp138;if((((_tmp137=_tmp134),(_tmp137 instanceof Array))&&((_tmp138=_tmp137.length),(_tmp138==0)))){throw "At least one expression must be enclosed in []";}else{if((((_tmp135=_tmp134),(_tmp135 instanceof Array))&&(((_tmp136=_tmp135.length),(_tmp136==1))&&((x=_tmp135[0]),true)))){return x;}else{if(((other=_tmp134),true)){return ["multi"].concat(args);}else{throw ["Could not find a match",_tmp134];}}}}();return result;}else{if((((_tmp85=_tmp65),(_tmp85 instanceof Array))&&(((_tmp86=_tmp85.length),(_tmp86==2))&&(((_tmp87=_tmp85[0]),(_tmp87 instanceof Array))&&(((_tmp88=_tmp87.length),(_tmp88>=1))&&(((_tmp89=_tmp87[0]),(_tmp89=="{"))&&(_tmp89,true,_tmp87.slice(1),true,_tmp85[1],true))))))){var f=function(x){return (x!==null);};return ["data"].concat(args.slice(1,(-1)).filter(f));}else{if((((_tmp80=_tmp65),(_tmp80 instanceof Array))&&(((_tmp81=_tmp80.length),(_tmp81==2))&&(((_tmp82=_tmp80[0]),(_tmp82 instanceof Array))&&(((_tmp83=_tmp82.length),(_tmp83==1))&&(((_tmp84=_tmp82[0]),(_tmp84=="WHITE"))&&(_tmp84,true,_tmp80[1],true))))))){return ["send"].concat(args);}else{if((((_tmp72=_tmp65),(_tmp72 instanceof Array))&&(((_tmp73=_tmp72.length),(_tmp73==2))&&(((_tmp74=_tmp72[0]),(_tmp74 instanceof Array))&&(((_tmp75=_tmp74.length),(_tmp75==1))&&((_tmp74[0],true,(_tmp76=_tmp72[1]),(_tmp76 instanceof Array))&&(((_tmp77=_tmp76.length),(_tmp77==2))&&(((_tmp78=_tmp76[0]),(_tmp78===null))&&((_tmp78,true,(_tmp79=_tmp76[1]),(_tmp79===null))&&(_tmp79,true)))))))))){return op;}else{if((((_tmp66=_tmp65),(_tmp66 instanceof Array))&&(((_tmp67=_tmp66.length),(_tmp67==2))&&(((_tmp68=_tmp66[0]),(_tmp68 instanceof Array))&&(((_tmp69=_tmp68.length),(_tmp69==1))&&((_tmp68[0],true,(_tmp70=_tmp66[1]),(_tmp70 instanceof Array))&&(((_tmp71=_tmp70.length),(_tmp71==2))&&((a=_tmp70[0]),true,(b=_tmp70[1]),true)))))))){return ["send",op,["data",a,b]];}else{if(((other=_tmp65),true)){throw ["Unknown node",ops,args];}else{throw ["Could not find a match",_tmp65];}}}}}}}}}}else{if(((other=_tmp50),true)){throw "OopsE";}else{throw ["Could not find a match",_tmp50];}}}}}}};var parse=function(text){var results=tokenize(text);var next=function(){return results.shift();};return oparse(next,order,finalize);};var Env=function(parent){var store=Object();var self=function(expr){return ["bind_env",self,expr];};(self.resolve=function(name){var attempt=store[name];if(attempt){return attempt;}else{if(true){return self.parent.resolve(name);}else{return false;}}});(self.register=function(name,value){return (store[name]=value);});(self.register_macro=function(name,m){return (store[name]=["macro",m]);});(self.fork=function(){return Env(self);});(self.parent=parent);(self.store=store);return self;};var js_contexts=({"js_for":["multi","multi","multi","multi"]});var expand=function(env,context,expr){(expr=expand.step(env,context,expr));var _tmp139=expr;var other;var _tmp140;var _tmp141;var _tmp142;var type;var _tmp143;var _tmp155;var _tmp144;var _tmp154;var _tmp145;var _tmp153;var _tmp146;var _tmp152;var _tmp147;var _tmp151;var _tmp148;var _tmp150;var _tmp149;var args;var _tmp156;var _tmp157;var _tmp158;var lhs;var rhs;var _tmp159;var _tmp160;var _tmp161;var binding;var value;var _tmp162;var _tmp163;var _tmp164;var bindings;var body;var _tmp165;var _tmp166;var _tmp167;var args;var _tmp168;var _tmp169;var _tmp170;var type;var _tmp171;var _tmp179;var _tmp172;var _tmp178;var _tmp173;var _tmp177;var _tmp174;var _tmp176;var _tmp175;var args;var _tmp180;var _tmp181;var _tmp182;var v;var _tmp183;var _tmp184;var _tmp185;var f;var arg;var _tmp186;var _tmp187;var _tmp188;if((((_tmp188=_tmp139),(typeof(_tmp188)=="string"))&&(_tmp188,true))){return expr;}else{if((((_tmp187=_tmp139),(_tmp187===null))&&(_tmp187,true))){return null;}else{if((((_tmp186=_tmp139),(_tmp186===undefined))&&(_tmp186,true))){throw "undefined? why?";}else{if((((_tmp183=_tmp139),(_tmp183 instanceof Array))&&(((_tmp184=_tmp183.length),(_tmp184==3))&&(((_tmp185=_tmp183[0]),(_tmp185=="send"))&&(_tmp185,true,(f=_tmp183[1]),true,(arg=_tmp183[2]),true))))){(f=expand(env,"head",f));return ["send",f,expand(env,"tail",arg)];}else{if((((_tmp180=_tmp139),(_tmp180 instanceof Array))&&(((_tmp181=_tmp180.length),(_tmp181==2))&&(((_tmp182=_tmp180[0]),(_tmp182=="value"))&&(_tmp182,true,(v=_tmp180[1]),true))))){return expr;}else{if((((_tmp168=_tmp139),(_tmp168 instanceof Array))&&(((_tmp169=_tmp168.length),(_tmp169>=1))&&(((_tmp170=_tmp168[0]),(type=_tmp170),true,(_tmp171=_tmp170),(((_tmp172=_tmp171),(((_tmp173=_tmp172),(((_tmp174=_tmp173),((((_tmp175=_tmp174),(_tmp175=="multi"))&&(_tmp175,true))||(((_tmp176=_tmp174),(_tmp176=="code"))&&(_tmp176,true))))||(((_tmp177=_tmp173),(_tmp177=="array"))&&(_tmp177,true))))||(((_tmp178=_tmp172),(_tmp178=="object"))&&(_tmp178,true))))||(((_tmp179=_tmp171),(_tmp179=="splice"))&&(_tmp179,true))))&&((args=_tmp168.slice(1)),true))))){var arr=[];while((args.length>0)){var x=expand.step(env,type,args.shift());var _tmp189=x;var other;var _tmp190;var _tmp191;var _tmp192;var stmts;if((((_tmp190=_tmp189),(_tmp190 instanceof Array))&&(((_tmp191=_tmp190.length),(_tmp191>=1))&&(((_tmp192=_tmp190[0]),(_tmp192=="splice"))&&(_tmp192,true,(stmts=_tmp190.slice(1)),true))))){(args=stmts.concat(args));}else{if(((other=_tmp189),true)){arr.push(x);}else{throw ["Could not find a match",_tmp189];}}}var f=function(x){return expand(env,type,x);};return [type].concat(arr.map(f));}else{if((((_tmp165=_tmp139),(_tmp165 instanceof Array))&&(((_tmp166=_tmp165.length),(_tmp166>=1))&&(((_tmp167=_tmp165[0]),(_tmp167=="data"))&&(_tmp167,true,(args=_tmp165.slice(1)),true))))){var is_obj=false;var obj=["object"];var arr=["array"];while((args.length>0)){var x=expand.step(env,"data",args.shift());var _tmp193=x;var other;var _tmp194;var _tmp195;var _tmp196;var exprs;var _tmp197;var _tmp198;var _tmp199;var k;var v;var _tmp200;var _tmp201;var _tmp202;if((((_tmp200=_tmp193),(_tmp200 instanceof Array))&&(((_tmp201=_tmp200.length),(_tmp201==1))&&(((_tmp202=_tmp200[0]),(_tmp202=="assoc"))&&(_tmp202,true))))){(is_obj=true);}else{if((((_tmp197=_tmp193),(_tmp197 instanceof Array))&&(((_tmp198=_tmp197.length),(_tmp198==3))&&(((_tmp199=_tmp197[0]),(_tmp199=="assoc"))&&(_tmp199,true,(k=_tmp197[1]),true,(v=_tmp197[2]),true))))){(is_obj=true);obj.push(["array",k,v]);}else{if((((_tmp194=_tmp193),(_tmp194 instanceof Array))&&(((_tmp195=_tmp194.length),(_tmp195>=1))&&(((_tmp196=_tmp194[0]),(_tmp196=="splice"))&&(_tmp196,true,(exprs=_tmp194.slice(1)),true))))){(args=exprs.concat(args));}else{if(((other=_tmp193),true)){arr.push(other);}else{throw ["Could not find a match",_tmp193];}}}}}var r=function(){if(((arr.length>1)&&is_obj)){arr.push(obj);return arr;}else{if(is_obj){return obj;}else{if(true){return arr;}else{return false;}}}}();return expand(env,context,r);}else{if((((_tmp162=_tmp139),(_tmp162 instanceof Array))&&(((_tmp163=_tmp162.length),(_tmp163==3))&&(((_tmp164=_tmp162[0]),(_tmp164=="lambda"))&&(_tmp164,true,(bindings=_tmp162[1]),true,(body=_tmp162[2]),true))))){return ["lambda",bindings.map(function(x){return expand(env,"decl",x);}),expand(env,"multi",body)];}else{if((((_tmp159=_tmp139),(_tmp159 instanceof Array))&&(((_tmp160=_tmp159.length),(_tmp160==3))&&(((_tmp161=_tmp159[0]),(_tmp161=="declare"))&&(_tmp161,true,(binding=_tmp159[1]),true,(value=_tmp159[2]),true))))){return ["declare",expand(env,"decl",binding),expand(env,"multi",value)];}else{if((((_tmp156=_tmp139),(_tmp156 instanceof Array))&&(((_tmp157=_tmp156.length),(_tmp157==3))&&(((_tmp158=_tmp156[0]),(_tmp158=="assign"))&&(_tmp158,true,(lhs=_tmp156[1]),true,(rhs=_tmp156[2]),true))))){return ["assign",expand(env,"decl",lhs),expand(env,"multi",rhs)];}else{if((((_tmp140=_tmp139),(_tmp140 instanceof Array))&&(((_tmp141=_tmp140.length),(_tmp141>=1))&&(((_tmp142=_tmp140[0]),(type=_tmp142),true,(_tmp143=_tmp142),(((_tmp144=_tmp143),(((_tmp145=_tmp144),(((_tmp146=_tmp145),(((_tmp147=_tmp146),(((_tmp148=_tmp147),((((_tmp149=_tmp148),(_tmp149=="js_while"))&&(_tmp149,true))||(((_tmp150=_tmp148),(_tmp150=="js_for"))&&(_tmp150,true))))||(((_tmp151=_tmp147),(_tmp151=="js_break"))&&(_tmp151,true))))||(((_tmp152=_tmp146),(_tmp152=="js_continue"))&&(_tmp152,true))))||(((_tmp153=_tmp145),(_tmp153=="js_return"))&&(_tmp153,true))))||(((_tmp154=_tmp144),(_tmp154=="js_throw"))&&(_tmp154,true))))||(((_tmp155=_tmp143),(_tmp155=="if"))&&(_tmp155,true))))&&((args=_tmp140.slice(1)),true))))){var ctxs=(js_contexts[type]||[]);var f=function(x,i){return expand(env,(ctxs[i]||"expr"),x);};return [type].concat(args.map(f));}else{if(((other=_tmp139),true)){throw ["Oops",expr,context];}else{throw ["Could not find a match",_tmp139];}}}}}}}}}}}}};(expand.step=function(env,context,expr){var _tmp203=expr;var other;var _tmp204;var _tmp205;var type;var args;var _tmp206;var _tmp207;var _tmp208;var f;var arg;var _tmp209;var _tmp210;var _tmp211;var m;var _tmp212;var _tmp213;var _tmp214;if((((_tmp214=_tmp203),(typeof(_tmp214)=="string"))&&(_tmp214,true))){var v=env.resolve(expr);var _tmp215=[v,context];var other;var _tmp216;var _tmp217;var _tmp218;var _tmp219;var _tmp220;var m;var _tmp221;var _tmp222;var _tmp223;var _tmp224;var _tmp225;var m;var _tmp226;var _tmp227;var _tmp228;var _tmp229;if((((_tmp227=_tmp215),(_tmp227 instanceof Array))&&(((_tmp228=_tmp227.length),(_tmp228==2))&&(((_tmp229=_tmp227[0]),(_tmp229===undefined))&&(_tmp229,true,_tmp227[1],true))))){return expr;}else{if((((_tmp221=_tmp215),(_tmp221 instanceof Array))&&(((_tmp222=_tmp221.length),(_tmp222==2))&&(((_tmp223=_tmp221[0]),(_tmp223 instanceof Array))&&(((_tmp224=_tmp223.length),(_tmp224==2))&&(((_tmp225=_tmp223[0]),(_tmp225=="macro"))&&((_tmp225,true,(m=_tmp223[1]),true,(_tmp226=_tmp221[1]),(_tmp226=="head"))&&(_tmp226,true)))))))){return v;}else{if((((_tmp216=_tmp215),(_tmp216 instanceof Array))&&(((_tmp217=_tmp216.length),(_tmp217==2))&&(((_tmp218=_tmp216[0]),(_tmp218 instanceof Array))&&(((_tmp219=_tmp218.length),(_tmp219==2))&&(((_tmp220=_tmp218[0]),(_tmp220=="macro"))&&(_tmp220,true,(m=_tmp218[1]),true,_tmp216[1],true))))))){return expand.step(env,context,m(env,context,null));}else{if(((other=_tmp215),true)){return v;}else{throw ["Could not find a match",_tmp215];}}}}}else{if((((_tmp213=_tmp203),(_tmp213===null))&&(_tmp213,true))){return null;}else{if((((_tmp212=_tmp203),(_tmp212===undefined))&&(_tmp212,true))){throw "undefined? why?";}else{if((((_tmp209=_tmp203),(_tmp209 instanceof Array))&&(((_tmp210=_tmp209.length),(_tmp210==2))&&(((_tmp211=_tmp209[0]),(_tmp211=="macro"))&&(_tmp211,true,(m=_tmp209[1]),true))))){if((context=="head")){return expr;}else{if(true){return expand.step(env,context,m(env,context,null));}else{return false;}}}else{if((((_tmp206=_tmp203),(_tmp206 instanceof Array))&&(((_tmp207=_tmp206.length),(_tmp207==3))&&(((_tmp208=_tmp206[0]),(_tmp208=="send"))&&(_tmp208,true,(f=_tmp206[1]),true,(arg=_tmp206[2]),true))))){(f=expand.step(env,"head",f));var _tmp230=f;var other;var _tmp231;var _tmp232;var _tmp233;var m;if((((_tmp231=_tmp230),(_tmp231 instanceof Array))&&(((_tmp232=_tmp231.length),(_tmp232==2))&&(((_tmp233=_tmp231[0]),(_tmp233=="macro"))&&(_tmp233,true,(m=_tmp231[1]),true))))){return expand.step(env,context,m(env,context,arg));}else{if(((other=_tmp230),true)){return expr;}else{throw ["Could not find a match",_tmp230];}}}else{if((((_tmp204=_tmp203),(_tmp204 instanceof Array))&&(((_tmp205=_tmp204.length),(_tmp205>=1))&&((type=_tmp204[0]),true,(args=_tmp204.slice(1)),true)))){return expr;}else{if(((other=_tmp203),true)){throw ["Oops2",expr];}else{throw ["Could not find a match",_tmp203];}}}}}}}});var aslist=function(expr){var _tmp234=expr;var other;var _tmp235;var _tmp236;var _tmp237;var args;var _tmp238;var _tmp239;if((((_tmp239=_tmp234),(_tmp239===null))&&(_tmp239,true))){return [null];}else{if((((_tmp238=_tmp234),(_tmp238===undefined))&&(_tmp238,true))){return [undefined];}else{if((((_tmp235=_tmp234),(_tmp235 instanceof Array))&&(((_tmp236=_tmp235.length),(_tmp236>=1))&&(((_tmp237=_tmp235[0]),(_tmp237=="multi"))&&(_tmp237,true,(args=_tmp235.slice(1)),true))))){return args;}else{if(((other=_tmp234),true)){return [other];}else{throw ["Could not find a match",_tmp234];}}}}};var nullenv=({"resolve":function(x){return undefined;}});var stdenv=Env(nullenv);stdenv.register("+","___plus");stdenv.register("-","___minus");stdenv.register("*","___times");stdenv.register("/","___div");stdenv.register("%","___mod");stdenv.register("^","___binxor");stdenv.register("&","___binand");stdenv.register("|","___binor");stdenv.register("~","___binnot");stdenv.register("&&","___and");stdenv.register("||","___or");stdenv.register("!","___not");stdenv.register("and","___and");stdenv.register("or","___or");stdenv.register("not","___not");stdenv.register("===","___is");stdenv.register("!==","___isnt");stdenv.register("!=","___neq");stdenv.register("<","___lt");stdenv.register(">","___gt");stdenv.register("<=","___lte");stdenv.register(">=","___gte");stdenv.register("<<","___shl");stdenv.register(">>","___shr");stdenv.register(">>>","___shr2");stdenv.register("in","___in");stdenv.register("instanceof","___instanceof");stdenv.register("++","___plusplus");stdenv.register("--","___minusminus");stdenv.register_macro("**",function(env,context,_tmp240){var _tmp241;var _tmp242;var _tmp243;var a;var b;if((((_tmp241=_tmp240),(_tmp241 instanceof Array))&&(((_tmp242=_tmp241.length),(_tmp242==3))&&(((_tmp243=_tmp241[0]),(_tmp243=="data"))&&(_tmp243,true,(a=_tmp241[1]),true,(b=_tmp241[2]),true))))){false;}else{throw "a condition failed";}return ["send",["send","Math",["value","pow"]],["data",a,b]];});stdenv.register_macro("//",function(env,context,_tmp244){var _tmp245;var _tmp246;var _tmp247;var a;var b;if((((_tmp245=_tmp244),(_tmp245 instanceof Array))&&(((_tmp246=_tmp245.length),(_tmp246==3))&&(((_tmp247=_tmp245[0]),(_tmp247=="data"))&&(_tmp247,true,(a=_tmp245[1]),true,(b=_tmp245[2]),true))))){false;}else{throw "a condition failed";}var div=["send","___div",["data",a,b]];return ["send",["send","Math",["value","floor"]],["data",div]];});stdenv.register_macro("<>",function(env,context,_tmp248){var _tmp249;var _tmp250;var _tmp251;var _tmp252;var x;if((((_tmp249=_tmp248),(_tmp249 instanceof Array))&&(((_tmp250=_tmp249.length),(_tmp250==3))&&(((_tmp251=_tmp249[0]),(_tmp251=="data"))&&((_tmp251,true,(_tmp252=_tmp249[1]),(_tmp252===null))&&(_tmp252,true,(x=_tmp249[2]),true)))))){false;}else{throw "a condition failed";}return ["send",["send","___lib",["value","pr"]],["data",x]];});var make_checker=function(value,op){return function(env,context,expr){return ["send",op,["data",expr[1],value]];};};stdenv.register_macro("#",function(env,context,_tmp253){var _tmp254;var _tmp255;var _tmp256;var _tmp257;var tag;if((((_tmp254=_tmp253),(_tmp254 instanceof Array))&&(((_tmp255=_tmp254.length),(_tmp255==3))&&(((_tmp256=_tmp254[0]),(_tmp256=="data"))&&((_tmp256,true,(_tmp257=_tmp254[1]),(_tmp257===null))&&(_tmp257,true,(tag=_tmp254[2]),true)))))){false;}else{throw "a condition failed";}(tag=["value",tag]);var f=function(env,context,expr){if((context=="pattern")){var f=function(env,context,expr){return ["send","___eq",["data",["send",expr[1],["value","#"]],tag]];};return ["check",["macro",f],(expr||["ignore"])];}else{if(true){var d=["data",tag].concat(expr.slice(1));return ["send",["send","___lib",["value","Struct"]],d];}else{return false;}}};return ["macro",f];});stdenv.register_macro("when",function(env,context,_tmp258){var _tmp259;var _tmp260;var _tmp261;var pattern;var condition;if((((_tmp259=_tmp258),(_tmp259 instanceof Array))&&(((_tmp260=_tmp259.length),(_tmp260==3))&&(((_tmp261=_tmp259[0]),(_tmp261=="data"))&&(_tmp261,true,(pattern=_tmp259[1]),true,(condition=_tmp259[2]),true))))){false;}else{throw "a condition failed";}var _tmp262=pattern;var other;var _tmp263;if((((_tmp263=_tmp262),(_tmp263===null))&&(_tmp263,true))){return ___lib.Struct("test",condition,["ignore"]);}else{if(((other=_tmp262),true)){return ___lib.Struct("test",condition,pattern);}else{throw ["Could not find a match",_tmp262];}}});var andf=function(env,context,expr){var _tmp264=[context,expr];var other;var _tmp265;var _tmp266;var _tmp267;var _tmp268;var _tmp269;var _tmp270;var _tmp271;var _tmp272;var _tmp273;var a;var b;if((((_tmp268=_tmp264),(_tmp268 instanceof Array))&&(((_tmp269=_tmp268.length),(_tmp269==2))&&(((_tmp270=_tmp268[0]),(_tmp270=="pattern"))&&((_tmp270,true,(_tmp271=_tmp268[1]),(_tmp271 instanceof Array))&&(((_tmp272=_tmp271.length),(_tmp272==3))&&(((_tmp273=_tmp271[0]),(_tmp273=="data"))&&(_tmp273,true,(a=_tmp271[1]),true,(b=_tmp271[2]),true)))))))){return ["all",a,b];}else{if((((_tmp265=_tmp264),(_tmp265 instanceof Array))&&(((_tmp266=_tmp265.length),(_tmp266==2))&&((_tmp265[0],true,(_tmp267=_tmp265[1]),(_tmp267===null))&&(_tmp267,true))))){return "___and";}else{if(((other=_tmp264),true)){return ["send","___and",expr];}else{throw ["Could not find a match",_tmp264];}}}};stdenv.register_macro("&&",andf);stdenv.register_macro("and",andf);var orf=function(env,context,expr){var _tmp274=[context,expr];var other;var _tmp275;var _tmp276;var _tmp277;var _tmp278;var _tmp279;var _tmp280;var _tmp281;var _tmp282;var _tmp283;var a;var b;if((((_tmp278=_tmp274),(_tmp278 instanceof Array))&&(((_tmp279=_tmp278.length),(_tmp279==2))&&(((_tmp280=_tmp278[0]),(_tmp280=="pattern"))&&((_tmp280,true,(_tmp281=_tmp278[1]),(_tmp281 instanceof Array))&&(((_tmp282=_tmp281.length),(_tmp282==3))&&(((_tmp283=_tmp281[0]),(_tmp283=="data"))&&(_tmp283,true,(a=_tmp281[1]),true,(b=_tmp281[2]),true)))))))){return ["any",a,b];}else{if((((_tmp275=_tmp274),(_tmp275 instanceof Array))&&(((_tmp276=_tmp275.length),(_tmp276==2))&&((_tmp275[0],true,(_tmp277=_tmp275[1]),(_tmp277===null))&&(_tmp277,true))))){return "___or";}else{if(((other=_tmp274),true)){return ["send","___or",expr];}else{throw ["Could not find a match",_tmp274];}}}};stdenv.register_macro("||",orf);stdenv.register_macro("or",orf);var partial_pattern=function(operator){return function(env,context,expr){var _tmp284=[context,expr];var other;var _tmp285;var _tmp286;var _tmp287;var _tmp288;var _tmp289;var _tmp290;var _tmp291;var _tmp292;var _tmp293;var _tmp294;var val;if((((_tmp288=_tmp284),(_tmp288 instanceof Array))&&(((_tmp289=_tmp288.length),(_tmp289==2))&&(((_tmp290=_tmp288[0]),(_tmp290=="pattern"))&&((_tmp290,true,(_tmp291=_tmp288[1]),(_tmp291 instanceof Array))&&(((_tmp292=_tmp291.length),(_tmp292==3))&&(((_tmp293=_tmp291[0]),(_tmp293=="data"))&&((_tmp293,true,(_tmp294=_tmp291[1]),(_tmp294===null))&&(_tmp294,true,(val=_tmp291[2]),true))))))))){return ["check",["macro",make_checker(val,operator)],["ignore"]];}else{if((((_tmp285=_tmp284),(_tmp285 instanceof Array))&&(((_tmp286=_tmp285.length),(_tmp286==2))&&((_tmp285[0],true,(_tmp287=_tmp285[1]),(_tmp287===null))&&(_tmp287,true))))){return operator;}else{if(((other=_tmp284),true)){return ["send",operator,expr];}else{throw ["Could not find a match",_tmp284];}}}};};stdenv.register_macro("==",partial_pattern("___eq"));stdenv.register_macro("!=",partial_pattern("___neq"));stdenv.register_macro("<=",partial_pattern("___leq"));stdenv.register_macro(">=",partial_pattern("___geq"));stdenv.register_macro("<",partial_pattern("___lt"));stdenv.register_macro(">",partial_pattern("___gt"));stdenv.register_macro("*",function(env,context,expr){var _tmp295=[context,expr];var other;var _tmp296;var _tmp297;var _tmp298;var _tmp299;var _tmp300;var _tmp301;var _tmp302;var _tmp303;var _tmp304;var val;var _tmp305;if((((_tmp299=_tmp295),(_tmp299 instanceof Array))&&(((_tmp300=_tmp299.length),(_tmp300==2))&&(((_tmp301=_tmp299[0]),(_tmp301=="pattern"))&&((_tmp301,true,(_tmp302=_tmp299[1]),(_tmp302 instanceof Array))&&(((_tmp303=_tmp302.length),(_tmp303==3))&&(((_tmp304=_tmp302[0]),(_tmp304=="data"))&&((_tmp304,true,(val=_tmp302[1]),true,(_tmp305=_tmp302[2]),(_tmp305===null))&&(_tmp305,true))))))))){return ["dynsplice",val];}else{if((((_tmp296=_tmp295),(_tmp296 instanceof Array))&&(((_tmp297=_tmp296.length),(_tmp297==2))&&((_tmp296[0],true,(_tmp298=_tmp296[1]),(_tmp298===null))&&(_tmp298,true))))){return "___times";}else{if(((other=_tmp295),true)){return ["send","___times",expr];}else{throw ["Could not find a match",_tmp295];}}}});stdenv.register_macro(".",function(env,context,expr){var _tmp306=expr;var other;var _tmp307;var _tmp308;var _tmp309;var _tmp310;var _tmp311;var s;if((((_tmp307=_tmp306),(_tmp307 instanceof Array))&&(((_tmp308=_tmp307.length),(_tmp308==3))&&(((_tmp309=_tmp307[0]),(_tmp309=="data"))&&((_tmp309,true,(_tmp310=_tmp307[1]),(_tmp310===null))&&((_tmp310,true,(_tmp311=_tmp307[2]),(typeof(_tmp311)=="string"))&&((s=_tmp311),true))))))){return ["value",s];}else{if(((other=_tmp306),true)){throw ["invalid",expr];}else{throw ["Could not find a match",_tmp306];}}});stdenv.register_macro("where",function(env,context,_tmp312){var _tmp313;var _tmp314;var _tmp315;var a;var b;if((((_tmp313=_tmp312),(_tmp313 instanceof Array))&&(((_tmp314=_tmp313.length),(_tmp314==3))&&(((_tmp315=_tmp313[0]),(_tmp315=="data"))&&(_tmp315,true,(a=_tmp313[1]),true,(b=_tmp313[2]),true))))){false;}else{throw "a condition failed";}return ["send","let",["data",["code",b],["code",a]]];});stdenv.register_macro("let",function(env,context,_tmp316){var _tmp317;var _tmp318;var _tmp319;var _tmp320;var _tmp321;var _tmp322;var a;var _tmp323;var _tmp324;var _tmp325;var b;if((((_tmp317=_tmp316),(_tmp317 instanceof Array))&&(((_tmp318=_tmp317.length),(_tmp318==3))&&(((_tmp319=_tmp317[0]),(_tmp319=="data"))&&((_tmp319,true,(_tmp320=_tmp317[1]),(_tmp320 instanceof Array))&&(((_tmp321=_tmp320.length),(_tmp321==2))&&(((_tmp322=_tmp320[0]),(_tmp322=="code"))&&((_tmp322,true,(a=_tmp320[1]),true,(_tmp323=_tmp317[2]),(_tmp323 instanceof Array))&&(((_tmp324=_tmp323.length),(_tmp324==2))&&(((_tmp325=_tmp323[0]),(_tmp325=="code"))&&(_tmp325,true,(b=_tmp323[1]),true))))))))))){false;}else{throw "a condition failed";}var bindings=aslist(a);var body=aslist(b);return ["multi"].concat(bindings).concat(body);});stdenv.register_macro("->",function(env,context,_tmp326){var _tmp327;var _tmp328;var _tmp329;var args;var stmts;if((((_tmp327=_tmp326),(_tmp327 instanceof Array))&&(((_tmp328=_tmp327.length),(_tmp328==3))&&(((_tmp329=_tmp327[0]),(_tmp329=="data"))&&(_tmp329,true,(args=_tmp327[1]),true,(stmts=_tmp327[2]),true))))){false;}else{throw "a condition failed";}var body=["multi"];(args=args.slice(1).map(function(x){var _tmp330=x;var other;var _tmp331;if((((_tmp331=_tmp330),(typeof(_tmp331)=="string"))&&(_tmp331,true))){return x;}else{if(((other=_tmp330),true)){var t=gensym();body.push(["send","=",["data",x,t]]);return t;}else{throw ["Could not find a match",_tmp330];}}}));body.push(stmts);return ["lambda",args,body];});stdenv.register_macro("=>",function(env,context,_tmp332){var _tmp333;var _tmp334;var _tmp335;var binding;var value;if((((_tmp333=_tmp332),(_tmp333 instanceof Array))&&(((_tmp334=_tmp333.length),(_tmp334==3))&&(((_tmp335=_tmp333[0]),(_tmp335=="data"))&&(_tmp335,true,(binding=_tmp333[1]),true,(value=_tmp333[2]),true))))){false;}else{throw "a condition failed";}if((context=="data")){return ["assoc",binding,value];}else{if(true){throw (("Illegal context for '=>' ("+context)+")");}else{return false;}}});stdenv.register_macro("=",function(env,context,expr){var _tmp336=[context,expr];var other;var _tmp337;var _tmp338;var _tmp339;var _tmp340;var _tmp341;var _tmp342;var binding;var value;var _tmp343;var _tmp344;var _tmp345;var _tmp346;var _tmp347;var _tmp348;var _tmp349;var _tmp350;var _tmp351;var f;var _tmp352;var _tmp353;var _tmp354;var args;var value;var _tmp355;var _tmp356;var _tmp357;var _tmp358;var _tmp359;var _tmp360;var _tmp361;var _tmp362;var _tmp363;var _tmp364;var lhs;var rhs;if((((_tmp359=_tmp336),(_tmp359 instanceof Array))&&(((_tmp360=_tmp359.length),(_tmp360==2))&&(((_tmp361=_tmp359[0]),(_tmp361=="multi"))&&((_tmp361,true,(_tmp362=_tmp359[1]),(_tmp362 instanceof Array))&&(((_tmp363=_tmp362.length),(_tmp363==3))&&(((_tmp364=_tmp362[0]),(_tmp364=="data"))&&(_tmp364,true,(lhs=_tmp362[1]),true,(rhs=_tmp362[2]),true)))))))){var p=parse_lhs(env,lhs,rhs);var vars=make_declarations(p[0]);var r=["splice"].concat(vars);var clauses=p[1];var mkif=function(x){return ["if",x,["value",false],["js_throw",["value","a condition failed"]]];};if((clauses.length==1)){var clause=clauses[0];var last=clause[(clause.length-1)];var _tmp365=last;var other;var _tmp366;var _tmp367;var _tmp368;var _tmp369;if((((_tmp366=_tmp365),(_tmp366 instanceof Array))&&(((_tmp367=_tmp366.length),(_tmp367==2))&&(((_tmp368=_tmp366[0]),(_tmp368=="value"))&&((_tmp368,true,(_tmp369=_tmp366[1]),(_tmp369===true))&&(_tmp369,true)))))){if(((vars.length==1)&&(clause.length==3))){(r=["declare"].concat(clause[1].slice(1)));}else{if(true){(r=r.concat(clause.slice(1,(-1))));}else{false;}}}else{if(((other=_tmp365),true)){r.push(mkif(clause));}else{throw ["Could not find a match",_tmp365];}}}else{if(true){var ands=make_pattern_test(clauses);r.push(mkif(ands));}else{false;}}return r;}else{if((((_tmp355=_tmp336),(_tmp355 instanceof Array))&&(((_tmp356=_tmp355.length),(_tmp356==2))&&(((_tmp357=_tmp355[0]),(_tmp357=="data"))&&((_tmp357,true,(_tmp358=_tmp355[1]),(_tmp358===null))&&(_tmp358,true)))))){return ["assoc"];}else{if((((_tmp343=_tmp336),(_tmp343 instanceof Array))&&(((_tmp344=_tmp343.length),(_tmp344==2))&&(((_tmp345=_tmp343[0]),(_tmp345=="data"))&&((_tmp345,true,(_tmp346=_tmp343[1]),(_tmp346 instanceof Array))&&(((_tmp347=_tmp346.length),(_tmp347==3))&&(((_tmp348=_tmp346[0]),(_tmp348=="data"))&&((_tmp348,true,(_tmp349=_tmp346[1]),(_tmp349 instanceof Array))&&(((_tmp350=_tmp349.length),(_tmp350==3))&&(((_tmp351=_tmp349[0]),(_tmp351=="send"))&&((_tmp351,true,(f=_tmp349[1]),true,(_tmp352=_tmp349[2]),(_tmp352 instanceof Array))&&(((_tmp353=_tmp352.length),(_tmp353>=1))&&(((_tmp354=_tmp352[0]),(_tmp354=="data"))&&(_tmp354,true,(args=_tmp352.slice(1)),true,(value=_tmp346[2]),true)))))))))))))){return ["assoc",["value",f],["lambda",args,value]];}else{if((((_tmp337=_tmp336),(_tmp337 instanceof Array))&&(((_tmp338=_tmp337.length),(_tmp338==2))&&(((_tmp339=_tmp337[0]),(_tmp339=="data"))&&((_tmp339,true,(_tmp340=_tmp337[1]),(_tmp340 instanceof Array))&&(((_tmp341=_tmp340.length),(_tmp341==3))&&(((_tmp342=_tmp340[0]),(_tmp342=="data"))&&(_tmp342,true,(binding=_tmp340[1]),true,(value=_tmp340[2]),true)))))))){return ["assoc",["value",binding],value];}else{if(((other=_tmp336),true)){throw (("Illegal context for '=' ("+context)+")");}else{throw ["Could not find a match",_tmp336];}}}}}});var make_assigner=function(op){return function(env,context,_tmp370){var _tmp371;var _tmp372;var _tmp373;var a;var b;if((((_tmp371=_tmp370),(_tmp371 instanceof Array))&&(((_tmp372=_tmp371.length),(_tmp372==3))&&(((_tmp373=_tmp371[0]),(_tmp373=="data"))&&(_tmp373,true,(a=_tmp371[1]),true,(b=_tmp371[2]),true))))){false;}else{throw "a condition failed";}return ["assign",a,["send",op,["data",a,b]]];};};stdenv.register_macro(":=",function(env,context,_tmp374){var _tmp375;var _tmp376;var _tmp377;var a;var b;if((((_tmp375=_tmp374),(_tmp375 instanceof Array))&&(((_tmp376=_tmp375.length),(_tmp376==3))&&(((_tmp377=_tmp375[0]),(_tmp377=="data"))&&(_tmp377,true,(a=_tmp375[1]),true,(b=_tmp375[2]),true))))){false;}else{throw "a condition failed";}return ["assign",a,b];});stdenv.register_macro("+=",make_assigner("+"));stdenv.register_macro("-=",make_assigner("-"));stdenv.register_macro("*=",make_assigner("*"));stdenv.register_macro("/=",make_assigner("/"));stdenv.register_macro("<<=",make_assigner("<<"));stdenv.register_macro(">>=",make_assigner(">>"));stdenv.register_macro(">>>=",make_assigner(">>>"));stdenv.register_macro("if",function(env,context,_tmp378){var _tmp379;var _tmp380;var _tmp381;var test;var a;var b;if((((_tmp379=_tmp378),(_tmp379 instanceof Array))&&(((_tmp380=_tmp379.length),(_tmp380==4))&&(((_tmp381=_tmp379[0]),(_tmp381=="data"))&&(_tmp381,true,(test=_tmp379[1]),true,(a=_tmp379[2]),true,(b=_tmp379[3]),true))))){false;}else{throw "a condition failed";}return ["if",test,a,b];});stdenv.register_macro("cond",function(env,context,_tmp382){var _tmp383;var _tmp384;var _tmp385;var _tmp386;var _tmp387;var _tmp388;var clauses;if((((_tmp383=_tmp382),(_tmp383 instanceof Array))&&(((_tmp384=_tmp383.length),(_tmp384==2))&&(((_tmp385=_tmp383[0]),(_tmp385=="data"))&&((_tmp385,true,(_tmp386=_tmp383[1]),(_tmp386 instanceof Array))&&(((_tmp387=_tmp386.length),(_tmp387==2))&&(((_tmp388=_tmp386[0]),(_tmp388=="code"))&&(_tmp388,true,(clauses=_tmp386[1]),true)))))))){false;}else{throw "a condition failed";}var handle=function(xs){if((xs.length==0)){return ["value",false];}else{if(true){var first=xs[0][2];var rest=xs.slice(1);return ["if",first[1],first[2],handle(rest)];}else{return false;}}};return handle(aslist(clauses));});stdenv.register_macro("while",function(env,context,expr){var _tmp389;var _tmp390;var _tmp391;var _tmp392;var _tmp393;var _tmp394;var test;var _tmp395;var _tmp396;var _tmp397;var body;if((((_tmp389=expr),(_tmp389 instanceof Array))&&(((_tmp390=_tmp389.length),(_tmp390==3))&&(((_tmp391=_tmp389[0]),(_tmp391=="data"))&&((_tmp391,true,(_tmp392=_tmp389[1]),(_tmp392 instanceof Array))&&(((_tmp393=_tmp392.length),(_tmp393==2))&&(((_tmp394=_tmp392[0]),(_tmp394=="code"))&&((_tmp394,true,(test=_tmp392[1]),true,(_tmp395=_tmp389[2]),(_tmp395 instanceof Array))&&(((_tmp396=_tmp395.length),(_tmp396==2))&&(((_tmp397=_tmp395[0]),(_tmp397=="code"))&&(_tmp397,true,(body=_tmp395[1]),true))))))))))){false;}else{throw "a condition failed";}return ["js_while",test,body];});stdenv.register_macro("for",function(env,context,expr){var _tmp398;var _tmp399;var _tmp400;var _tmp401;var _tmp402;var _tmp403;var _tmp404;var _tmp405;var _tmp406;var a;var b;var c;var _tmp407;var _tmp408;var _tmp409;var body;if((((_tmp398=expr),(_tmp398 instanceof Array))&&(((_tmp399=_tmp398.length),(_tmp399==3))&&(((_tmp400=_tmp398[0]),(_tmp400=="data"))&&((_tmp400,true,(_tmp401=_tmp398[1]),(_tmp401 instanceof Array))&&(((_tmp402=_tmp401.length),(_tmp402==2))&&(((_tmp403=_tmp401[0]),(_tmp403=="code"))&&((_tmp403,true,(_tmp404=_tmp401[1]),(_tmp404 instanceof Array))&&(((_tmp405=_tmp404.length),(_tmp405==4))&&(((_tmp406=_tmp404[0]),(_tmp406=="multi"))&&((_tmp406,true,(a=_tmp404[1]),true,(b=_tmp404[2]),true,(c=_tmp404[3]),true,(_tmp407=_tmp398[2]),(_tmp407 instanceof Array))&&(((_tmp408=_tmp407.length),(_tmp408==2))&&(((_tmp409=_tmp407[0]),(_tmp409=="code"))&&(_tmp409,true,(body=_tmp407[1]),true)))))))))))))){false;}else{throw "a condition failed";}return ["js_for",a,b,c,body];});stdenv.register_macro("return",function(env,context,expr){return ["js_return",expr];});stdenv.register_macro("throw",function(env,context,expr){return ["js_throw",expr];});stdenv.register_macro("break",function(env,context,expr){return ["js_break"];});stdenv.register_macro("continue",function(env,context,expr){return ["js_continue"];});var rx_wrap=function(x){return (("(?:"+x)+")");};var rx_quote=function(x){return x.replace(RegExp("([.?*+\\^$\\[\\]\\(\\)\\{\\}|\\\\])","g"),"\\$1");};var rx_quote2=function(x){return x.replace(RegExp("([\\[\\]\\(\\)\\{\\}\\^])","g"),"\\$1");};var rx_build=function(expr){var _tmp410=expr;var otherA;var _tmp411;var _tmp412;var _tmp413;var args;var _tmp414;var _tmp415;var _tmp416;var args;var _tmp417;var _tmp418;var _tmp419;var _tmp420;var _tmp421;var _tmp422;var _tmp423;var _tmp424;var b;var _tmp425;var _tmp426;var _tmp427;var _tmp428;var _tmp429;var _tmp430;var _tmp431;var _tmp432;var b;var _tmp433;var _tmp434;var _tmp435;var _tmp436;var _tmp437;var _tmp438;var _tmp439;var a;var _tmp440;var _tmp441;var _tmp442;var _tmp443;var _tmp444;var _tmp445;var _tmp446;var _tmp447;var a;var _tmp448;var _tmp449;var _tmp450;var _tmp451;var _tmp452;var _tmp453;var _tmp454;var _tmp455;var a;var _tmp456;var _tmp457;var _tmp458;var _tmp459;var _tmp460;var _tmp461;var _tmp462;var _tmp463;var a;var b;var _tmp464;var _tmp465;var _tmp466;var _tmp467;var _tmp468;var _tmp469;var _tmp470;var a;var b;var _tmp471;var _tmp472;var _tmp473;var x;var _tmp474;var _tmp475;var _tmp476;var _tmp477;var _tmp478;var _tmp479;var _tmp480;var _tmp481;var _tmp482;var _tmp483;var _tmp484;var _tmp485;var _tmp486;if((((_tmp486=_tmp410),(_tmp486=="any"))&&(_tmp486,true))){return ".";}else{if((((_tmp485=_tmp410),(_tmp485=="start"))&&(_tmp485,true))){return "^";}else{if((((_tmp484=_tmp410),(_tmp484=="end"))&&(_tmp484,true))){return "$";}else{if((((_tmp483=_tmp410),(_tmp483=="alpha"))&&(_tmp483,true))){return "\\a";}else{if((((_tmp482=_tmp410),(_tmp482=="digit"))&&(_tmp482,true))){return "\\d";}else{if((((_tmp481=_tmp410),(_tmp481=="word"))&&(_tmp481,true))){return "\\w";}else{if((((_tmp480=_tmp410),(_tmp480=="space"))&&(_tmp480,true))){return "\\s";}else{if((((_tmp479=_tmp410),(_tmp479=="boundary"))&&(_tmp479,true))){return "\\b";}else{if((((_tmp478=_tmp410),(_tmp478=="a"))&&(_tmp478,true))){return "\\a";}else{if((((_tmp477=_tmp410),(_tmp477=="d"))&&(_tmp477,true))){return "\\d";}else{if((((_tmp476=_tmp410),(_tmp476=="w"))&&(_tmp476,true))){return "\\w";}else{if((((_tmp475=_tmp410),(_tmp475=="s"))&&(_tmp475,true))){return "\\s";}else{if((((_tmp474=_tmp410),(_tmp474=="b"))&&(_tmp474,true))){return "\\b";}else{if((((_tmp471=_tmp410),(_tmp471 instanceof Array))&&(((_tmp472=_tmp471.length),(_tmp472==2))&&(((_tmp473=_tmp471[0]),(_tmp473=="value"))&&(_tmp473,true,(x=_tmp471[1]),true))))){return rx_quote(x);}else{if((((_tmp464=_tmp410),(_tmp464 instanceof Array))&&(((_tmp465=_tmp464.length),(_tmp465==3))&&(((_tmp466=_tmp464[0]),(_tmp466=="send"))&&((_tmp466,true,(_tmp467=_tmp464[1]),(_tmp467=="||"))&&((_tmp467,true,(_tmp468=_tmp464[2]),(_tmp468 instanceof Array))&&(((_tmp469=_tmp468.length),(_tmp469==3))&&(((_tmp470=_tmp468[0]),(_tmp470=="data"))&&(_tmp470,true,(a=_tmp468[1]),true,(b=_tmp468[2]),true))))))))){return rx_wrap(((rx_build(a)+"|")+rx_build(b)));}else{if((((_tmp457=_tmp410),(_tmp457 instanceof Array))&&(((_tmp458=_tmp457.length),(_tmp458==3))&&(((_tmp459=_tmp457[0]),(_tmp459=="send"))&&((_tmp459,true,(_tmp460=_tmp457[1]),(_tmp460=="or"))&&((_tmp460,true,(_tmp461=_tmp457[2]),(_tmp461 instanceof Array))&&(((_tmp462=_tmp461.length),(_tmp462==3))&&(((_tmp463=_tmp461[0]),(_tmp463=="data"))&&(_tmp463,true,(a=_tmp461[1]),true,(b=_tmp461[2]),true))))))))){return rx_wrap(((rx_build(a)+"|")+rx_build(b)));}else{if((((_tmp449=_tmp410),(_tmp449 instanceof Array))&&(((_tmp450=_tmp449.length),(_tmp450==3))&&(((_tmp451=_tmp449[0]),(_tmp451=="send"))&&((_tmp451,true,(_tmp452=_tmp449[1]),(_tmp452=="*"))&&((_tmp452,true,(_tmp453=_tmp449[2]),(_tmp453 instanceof Array))&&(((_tmp454=_tmp453.length),(_tmp454==3))&&(((_tmp455=_tmp453[0]),(_tmp455=="data"))&&((_tmp455,true,(a=_tmp453[1]),true,(_tmp456=_tmp453[2]),(_tmp456===null))&&(_tmp456,true)))))))))){return rx_wrap((rx_build(a)+"*"));}else{if((((_tmp441=_tmp410),(_tmp441 instanceof Array))&&(((_tmp442=_tmp441.length),(_tmp442==3))&&(((_tmp443=_tmp441[0]),(_tmp443=="send"))&&((_tmp443,true,(_tmp444=_tmp441[1]),(_tmp444=="+"))&&((_tmp444,true,(_tmp445=_tmp441[2]),(_tmp445 instanceof Array))&&(((_tmp446=_tmp445.length),(_tmp446==3))&&(((_tmp447=_tmp445[0]),(_tmp447=="data"))&&((_tmp447,true,(a=_tmp445[1]),true,(_tmp448=_tmp445[2]),(_tmp448===null))&&(_tmp448,true)))))))))){return rx_wrap((rx_build(a)+"+"));}else{if((((_tmp433=_tmp410),(_tmp433 instanceof Array))&&(((_tmp434=_tmp433.length),(_tmp434==3))&&(((_tmp435=_tmp433[0]),(_tmp435=="send"))&&((_tmp435,true,(_tmp436=_tmp433[1]),(_tmp436=="?"))&&((_tmp436,true,(_tmp437=_tmp433[2]),(_tmp437 instanceof Array))&&(((_tmp438=_tmp437.length),(_tmp438==3))&&(((_tmp439=_tmp437[0]),(_tmp439=="data"))&&((_tmp439,true,(a=_tmp437[1]),true,(_tmp440=_tmp437[2]),(_tmp440===null))&&(_tmp440,true)))))))))){return rx_wrap((rx_build(a)+"?"));}else{if((((_tmp425=_tmp410),(_tmp425 instanceof Array))&&(((_tmp426=_tmp425.length),(_tmp426==3))&&(((_tmp427=_tmp425[0]),(_tmp427=="send"))&&((_tmp427,true,(_tmp428=_tmp425[1]),(_tmp428==">>"))&&((_tmp428,true,(_tmp429=_tmp425[2]),(_tmp429 instanceof Array))&&(((_tmp430=_tmp429.length),(_tmp430==3))&&(((_tmp431=_tmp429[0]),(_tmp431=="data"))&&((_tmp431,true,(_tmp432=_tmp429[1]),(_tmp432===null))&&(_tmp432,true,(b=_tmp429[2]),true)))))))))){var x=rx_quote2(b[1]);return (("["+x)+"]");}else{if((((_tmp417=_tmp410),(_tmp417 instanceof Array))&&(((_tmp418=_tmp417.length),(_tmp418==3))&&(((_tmp419=_tmp417[0]),(_tmp419=="send"))&&((_tmp419,true,(_tmp420=_tmp417[1]),(_tmp420==">>!"))&&((_tmp420,true,(_tmp421=_tmp417[2]),(_tmp421 instanceof Array))&&(((_tmp422=_tmp421.length),(_tmp422==3))&&(((_tmp423=_tmp421[0]),(_tmp423=="data"))&&((_tmp423,true,(_tmp424=_tmp421[1]),(_tmp424===null))&&(_tmp424,true,(b=_tmp421[2]),true)))))))))){var x=rx_quote2(b[1]);return (("[^"+x)+"]");}else{if((((_tmp414=_tmp410),(_tmp414 instanceof Array))&&(((_tmp415=_tmp414.length),(_tmp415>=1))&&(((_tmp416=_tmp414[0]),(_tmp416=="data"))&&(_tmp416,true,(args=_tmp414.slice(1)),true))))){return (("("+args.map(rx_build).join(""))+")");}else{if((((_tmp411=_tmp410),(_tmp411 instanceof Array))&&(((_tmp412=_tmp411.length),(_tmp412>=1))&&(((_tmp413=_tmp411[0]),(_tmp413=="multi"))&&(_tmp413,true,(args=_tmp411.slice(1)),true))))){return (("(?:"+args.map(rx_build).join(""))+")");}else{if(((otherA=_tmp410),true)){throw "OopsF";}else{throw ["Could not find a match",_tmp410];}}}}}}}}}}}}}}}}}}}}}}}}};stdenv.register_macro("Rx",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)]]];});stdenv.register_macro("Rxg",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)],["value","g"]]];});stdenv.register_macro("?",function(env,context,_tmp487){var _tmp488;var _tmp489;var _tmp490;var expr;var _tmp491;if((((_tmp488=_tmp487),(_tmp488 instanceof Array))&&(((_tmp489=_tmp488.length),(_tmp489==3))&&(((_tmp490=_tmp488[0]),(_tmp490=="data"))&&((_tmp490,true,(expr=_tmp488[1]),true,(_tmp491=_tmp488[2]),(_tmp491===null))&&(_tmp491,true)))))){false;}else{throw "a condition failed";}var checker=function(){var _tmp492=expr;var other;var _tmp493;var _tmp494;var _tmp495;var _tmp496;var _tmp497;var _tmp498;var _tmp499;if((((_tmp499=_tmp492),(_tmp499===null))&&(_tmp499,true))){return ["send",expr,["value","__check__"]];}else{if((((_tmp498=_tmp492),(_tmp498=="String"))&&(_tmp498,true))){var f=function(env,context,_tmp500){var _tmp501;var _tmp502;var _tmp503;var expr;if((((_tmp501=_tmp500),(_tmp501 instanceof Array))&&(((_tmp502=_tmp501.length),(_tmp502==2))&&(((_tmp503=_tmp501[0]),(_tmp503=="data"))&&(_tmp503,true,(expr=_tmp501[1]),true))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","string"]]];};return ["macro",f];}else{if((((_tmp497=_tmp492),(_tmp497=="Number"))&&(_tmp497,true))){var f=function(env,context,_tmp504){var _tmp505;var _tmp506;var _tmp507;var expr;if((((_tmp505=_tmp504),(_tmp505 instanceof Array))&&(((_tmp506=_tmp505.length),(_tmp506==2))&&(((_tmp507=_tmp505[0]),(_tmp507=="data"))&&(_tmp507,true,(expr=_tmp505[1]),true))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","number"]]];};return ["macro",f];}else{if((((_tmp496=_tmp492),(_tmp496=="true"))&&(_tmp496,true))){return ["macro",make_checker(["value",true],"___is")];}else{if((((_tmp495=_tmp492),(_tmp495=="false"))&&(_tmp495,true))){return ["macro",make_checker(["value",false],"___is")];}else{if((((_tmp494=_tmp492),(_tmp494=="null"))&&(_tmp494,true))){return ["macro",make_checker(["value",null],"___is")];}else{if((((_tmp493=_tmp492),(_tmp493=="undefined"))&&(_tmp493,true))){return ["macro",make_checker(["value",undefined],"___is")];}else{if(((other=_tmp492),true)){return ["send",expr,["value","__check__"]];}else{throw ["Could not find a match",_tmp492];}}}}}}}}}();var mac=function(env,context,expr){var _tmp508=context;var other;var _tmp509;if((((_tmp509=_tmp508),(_tmp509=="pattern"))&&(_tmp509,true))){return ["check",checker,(expr||["ignore"])];}else{if(((other=_tmp508),true)){return ["send",checker,["data",expr]];}else{throw ["Could not find a match",_tmp508];}}};return ["macro",mac];});var tempnum=0;var gensym=function(){var name=("_tmp"+tempnum);(tempnum=(tempnum+1));return name;};var parse_lhs=function(env,lhs,rhs){var vars=[];var clauses=[];var current=["multi"];var mktemp=function(){var t=gensym();vars.push(t);return t;};var newclause=function(){if((current.length>1)){clauses.push(current);}else{false;}return (current=["multi"]);};var helper=function(lhs,curr){return helper_noexpand(expand.step(env,"pattern",lhs),curr);};var helper_noexpand=function(lhs,curr){var _tmp510=lhs;var other;var _tmp511;var _tmp512;var _tmp513;var specs;var _tmp514;var _tmp515;var _tmp516;var fname;var spec;var _tmp517;var _tmp518;var _tmp519;var checker;var expr;var _tmp520;var _tmp521;var _tmp522;var xs;var _tmp523;var _tmp524;var _tmp525;var xs;var _tmp526;var _tmp527;var _tmp528;var v;var _tmp529;var _tmp530;var _tmp532;var _tmp533;var _tmp534;var _tmp531;var _tmp535;if((((_tmp535=_tmp510),(_tmp535===null))&&(_tmp535,true))){var x=["check",["macro",make_checker(["value",null],"___eq")],["ignore"]];return helper_noexpand(x,curr);}else{if(((_tmp530=_tmp510),((((_tmp531=_tmp530),(_tmp531=="_"))&&(_tmp531,true))||(((_tmp532=_tmp530),(_tmp532 instanceof Array))&&(((_tmp533=_tmp532.length),(_tmp533==1))&&(((_tmp534=_tmp532[0]),(_tmp534=="ignore"))&&(_tmp534,true))))))){current.push(curr);return current.push(["value",true]);}else{if((((_tmp529=_tmp510),(typeof(_tmp529)=="string"))&&(_tmp529,true))){vars.push(lhs);current.push(["assign",lhs,curr]);return current.push(["value",true]);}else{if((((_tmp526=_tmp510),(_tmp526 instanceof Array))&&(((_tmp527=_tmp526.length),(_tmp527==2))&&(((_tmp528=_tmp526[0]),(_tmp528=="value"))&&(_tmp528,true,(v=_tmp526[1]),true))))){var x=["check",["macro",make_checker(lhs,"___eq")],["ignore"]];return helper_noexpand(x,curr);}else{if((((_tmp523=_tmp510),(_tmp523 instanceof Array))&&(((_tmp524=_tmp523.length),(_tmp524>=1))&&(((_tmp525=_tmp523[0]),(_tmp525=="all"))&&(_tmp525,true,(xs=_tmp523.slice(1)),true))))){var temp=mktemp();(current=current.concat([["assign",temp,curr]]));return xs.forEach(function(x){return helper(x,temp);});}else{if((((_tmp520=_tmp510),(_tmp520 instanceof Array))&&(((_tmp521=_tmp520.length),(_tmp521>=1))&&(((_tmp522=_tmp520[0]),(_tmp522=="any"))&&(_tmp522,true,(xs=_tmp520.slice(1)),true))))){var normalize=function(vars){return vars.filter(function(x){return (x.slice(0,4)!=="_tmp");}).sort().join(",");};var temp=mktemp();(current=current.concat([["assign",temp,curr]]));var myvars=undefined;var clauses=[];xs.forEach(function(x){var p=parse_lhs(env,x,temp);if((myvars===undefined)){(myvars=p[0]);}else{if((normalize(p[0])!==normalize(myvars))){throw [["Must have the same set of variables in both branches!",myvars]];}else{if(true){(vars=vars.concat(p[0]));}else{false;}}}return clauses.push(make_pattern_test(p[1]));});current.push(make_or_pattern(clauses));(vars=vars.concat(myvars));return newclause();}else{if((((_tmp517=_tmp510),(_tmp517 instanceof Array))&&(((_tmp518=_tmp517.length),(_tmp518==3))&&(((_tmp519=_tmp517[0]),(_tmp519=="check"))&&(_tmp519,true,(checker=_tmp517[1]),true,(expr=_tmp517[2]),true))))){var temp=mktemp();(current=current.concat([["assign",temp,curr],["send",checker,["data",temp]]]));newclause();return helper(expr,temp);}else{if((((_tmp514=_tmp510),(_tmp514 instanceof Array))&&(((_tmp515=_tmp514.length),(_tmp515==3))&&(((_tmp516=_tmp514[0]),(_tmp516=="send"))&&(_tmp516,true,(fname=_tmp514[1]),true,(spec=_tmp514[2]),true))))){return helper(fname,["send","->",["data",spec,curr]]);}else{if((((_tmp511=_tmp510),(_tmp511 instanceof Array))&&(((_tmp512=_tmp511.length),(_tmp512>=1))&&(((_tmp513=_tmp511[0]),(_tmp513=="data"))&&(_tmp513,true,(specs=_tmp511.slice(1)),true))))){var fw=0;var bw=0;var rest=undefined;var members=specs.map(function(x){var v=expand.step(env,"pattern",x);var _tmp536=v;var other;var _tmp537;var _tmp538;var _tmp539;var variable;if((((_tmp537=_tmp536),(_tmp537 instanceof Array))&&(((_tmp538=_tmp537.length),(_tmp538==2))&&(((_tmp539=_tmp537[0]),(_tmp539=="dynsplice"))&&(_tmp539,true,(variable=_tmp537[1]),true))))){(rest=variable);}else{if(((other=_tmp536),true)){if((rest===undefined)){(fw=(fw+1));}else{if(true){(bw=(bw+1));}else{false;}}}else{throw ["Could not find a match",_tmp536];}}return v;});var cmp=function(){if((rest===undefined)){return "___eq";}else{if(true){return "___gte";}else{return false;}}}();var temp=mktemp();var len=mktemp();(current=current.concat([["assign",temp,curr],["send","___instanceof",["data",temp,"Array"]]]));newclause();(current=current.concat([["assign",len,["send",temp,["value","length"]]],["send",cmp,["data",len,["value",(fw+bw)]]]]));newclause();for(var j=0;(j<fw);(++j)){helper_noexpand(members[j],["send",temp,["value",j]]);}if((rest!==undefined)){var slice=function(){if((bw>0)){return ["data",["value",fw],["value",(-bw)]];}else{if(true){return ["data",["value",fw]];}else{return false;}}}();helper_noexpand(members[fw][1],["send",["send",temp,["value","slice"]],slice]);}else{false;}for(var j=0;(j<bw);(++j)){helper_noexpand(members[((fw+j)+1)],["send",temp,["send","___minus",["data",len,["value",(bw-j)]]]]);}}else{if(((other=_tmp510),true)){throw "OopsG";}else{throw ["Could not find a match",_tmp510];}}}}}}}}}}};helper(lhs,rhs);if((current.length>1)){clauses.push(current);}else{false;}return [vars,clauses];};var make_declarations=function(vars){return vars.map(function(name){return ["declare",name,["value",undefined]];});};var make_pattern_test=function(clauses){var ands=clauses.pop();while((clauses.length>0)){(ands=["send","___and",["data",clauses.pop(),ands]]);}return ands;};var make_or_pattern=function(clauses){var ors=clauses.pop();while((clauses.length>0)){(ors=["send","___or",["data",clauses.pop(),ors]]);}return ors;};stdenv.register_macro("|>",function(env,context,_tmp540){var _tmp541;var _tmp542;var _tmp543;var to_match;var cl;if((((_tmp541=_tmp540),(_tmp541 instanceof Array))&&(((_tmp542=_tmp541.length),(_tmp542==3))&&(((_tmp543=_tmp541[0]),(_tmp543=="data"))&&(_tmp543,true,(to_match=_tmp541[1]),true,(cl=_tmp541[2]),true))))){false;}else{throw "a condition failed";}var temp=gensym();var clauses=function(){var _tmp544=cl;var other;var _tmp545;var _tmp546;var _tmp547;var cls;if((((_tmp545=_tmp544),(_tmp545 instanceof Array))&&(((_tmp546=_tmp545.length),(_tmp546>=1))&&(((_tmp547=_tmp545[0]),(_tmp547=="multi"))&&(_tmp547,true,(cls=_tmp545.slice(1)),true))))){return cls;}else{if(((other=_tmp544),true)){return [other];}else{throw ["Could not find a match",_tmp544];}}}();var decls=["multi",["declare",temp,to_match]];var r=["js_throw",["data",["value","Could not find a match"],temp]];while((clauses.length>0)){var _tmp548;var _tmp549;var _tmp550;var _tmp551;var _tmp552;var _tmp553;var _tmp554;var lhs;var body;if((((_tmp548=clauses.pop()),(_tmp548 instanceof Array))&&(((_tmp549=_tmp548.length),(_tmp549==3))&&(((_tmp550=_tmp548[0]),(_tmp550=="send"))&&((_tmp550,true,(_tmp551=_tmp548[1]),(_tmp551=="->"))&&((_tmp551,true,(_tmp552=_tmp548[2]),(_tmp552 instanceof Array))&&(((_tmp553=_tmp552.length),(_tmp553==3))&&(((_tmp554=_tmp552[0]),(_tmp554=="data"))&&(_tmp554,true,(lhs=_tmp552[1]),true,(body=_tmp552[2]),true))))))))){false;}else{throw "a condition failed";}var p=parse_lhs(env,lhs,temp);var test=make_pattern_test(p[1]);(r=["if",test,body,r]);(decls=decls.concat(make_declarations(p[0])));}decls.push(r);return decls;});var js_op_table=({"___plus":"+","___minus":"-","___times":"*","___div":"/","___mod":"%","___binxor":"^","___binand":"&","___binor":"|","___binnot":"~","___and":"&&","___or":"||","___not":"!","___is":"===","___isnt":"!==","___eq":"==","___neq":"!=","___lt":"<","___gt":">","___lte":"<=","___gte":">=","___shl":"<<","___shr":">>","___shr2":">>>","___in":" in ","___instanceof":" instanceof ","___plusplus":"++","___minusminus":"--"});var translate=function(expr,mode){var _tmp555=expr;var other;var _tmp556;var _tmp557;var _tmp558;var f;var msg;var _tmp559;var _tmp560;var _tmp561;var f;var _tmp562;var _tmp563;var _tmp564;var args;var _tmp565;var _tmp566;var _tmp567;var f;var _tmp568;var msg;var _tmp569;var _tmp570;var _tmp571;var s;var _tmp572;var _tmp573;var _tmp574;var args;var _tmp575;var _tmp576;var _tmp577;var args;var _tmp578;var _tmp579;var _tmp580;var value;var _tmp581;var _tmp582;var _tmp583;var value;var _tmp584;var _tmp585;var _tmp586;var _tmp587;var _tmp588;var _tmp589;var _tmp590;var _tmp591;var _tmp592;var args;var _tmp593;var _tmp594;var _tmp595;var args;var _tmp596;var _tmp597;var _tmp598;var lhs;var rhs;var _tmp599;var _tmp600;var _tmp601;var binding;var value;var _tmp602;var _tmp603;var _tmp604;var binding;var _tmp605;var _tmp606;var _tmp607;var _tmp608;var _tmp609;var _tmp610;var _tmp611;var x;var y;var z;var body;var _tmp612;var _tmp613;var _tmp614;var test;var body;var _tmp615;var _tmp616;var _tmp617;var test;var pos;var neg;var _tmp618;var _tmp619;var _tmp620;var bindings;var body;var _tmp621;var _tmp622;var _tmp623;var v;var _tmp624;var _tmp625;if((((_tmp625=_tmp555),(typeof(_tmp625)=="string"))&&(_tmp625,true))){return translate.expr(translate.mangle(expr),mode);}else{if((((_tmp624=_tmp555),(_tmp624===null))&&(_tmp624,true))){return translate.expr("null",mode);}else{if((((_tmp621=_tmp555),(_tmp621 instanceof Array))&&(((_tmp622=_tmp621.length),(_tmp622==2))&&(((_tmp623=_tmp621[0]),(_tmp623=="value"))&&(_tmp623,true,(v=_tmp621[1]),true))))){var r=function(){var _tmp626=v;var other;var _tmp627;var _tmp635;var _tmp628;var _tmp634;var _tmp629;var _tmp633;var _tmp630;var _tmp632;var _tmp631;var _tmp636;if((((_tmp636=_tmp626),(typeof(_tmp636)=="string"))&&(_tmp636,true))){var repl=({"\"":"\\\"","\n":"\\n","\\":"\\\\"});(v=v.replace(RegExp("((?:(?:\"|\\\\)|\n))","g"),function(m){return repl[m];}));return (("\""+v)+"\"");}else{if(((_tmp627=_tmp626),(((_tmp628=_tmp627),(((_tmp629=_tmp628),(((_tmp630=_tmp629),((((_tmp631=_tmp630),(typeof(_tmp631)=="number"))&&(_tmp631,true))||(((_tmp632=_tmp630),(_tmp632===true))&&(_tmp632,true))))||(((_tmp633=_tmp629),(_tmp633===false))&&(_tmp633,true))))||(((_tmp634=_tmp628),(_tmp634===null))&&(_tmp634,true))))||(((_tmp635=_tmp627),(_tmp635===undefined))&&(_tmp635,true))))){return String(v);}else{if(((other=_tmp626),true)){return (("?!?["+v)+"]?!?");}else{throw ["Could not find a match",_tmp626];}}}}();return translate.expr(r,mode);}else{if((((_tmp618=_tmp555),(_tmp618 instanceof Array))&&(((_tmp619=_tmp618.length),(_tmp619==3))&&(((_tmp620=_tmp618[0]),(_tmp620=="lambda"))&&(_tmp620,true,(bindings=_tmp618[1]),true,(body=_tmp618[2]),true))))){var a=bindings.join(",");var b=translate.body(body,"return");return translate.expr((((("function("+a)+"){")+b)+"}"),mode);}else{if((((_tmp615=_tmp555),(_tmp615 instanceof Array))&&(((_tmp616=_tmp615.length),(_tmp616==4))&&(((_tmp617=_tmp615[0]),(_tmp617=="if"))&&(_tmp617,true,(test=_tmp615[1]),true,(pos=_tmp615[2]),true,(neg=_tmp615[3]),true))))){var _tmp637=mode;var other;var _tmp638;if((((_tmp638=_tmp637),(_tmp638=="expr"))&&(_tmp638,true))){return translate.body(expr,"expr");}else{if(((other=_tmp637),true)){var a=translate(test,"expr");var b=translate(pos,mode);var c=translate(neg,mode);return (((((("if("+a)+"){")+b)+"}else{")+c)+"}");}else{throw ["Could not find a match",_tmp637];}}}else{if((((_tmp612=_tmp555),(_tmp612 instanceof Array))&&(((_tmp613=_tmp612.length),(_tmp613==3))&&(((_tmp614=_tmp612[0]),(_tmp614=="js_while"))&&(_tmp614,true,(test=_tmp612[1]),true,(body=_tmp612[2]),true))))){var _tmp639=mode;var other;var _tmp640;if((((_tmp640=_tmp639),(_tmp640=="expr"))&&(_tmp640,true))){return translate.body(expr,"expr");}else{if(((other=_tmp639),true)){var a=translate(test,"expr");var b=translate(body,"stmt");return (((("while("+a)+"){")+b)+"}");}else{throw ["Could not find a match",_tmp639];}}}else{if((((_tmp609=_tmp555),(_tmp609 instanceof Array))&&(((_tmp610=_tmp609.length),(_tmp610==5))&&(((_tmp611=_tmp609[0]),(_tmp611=="js_for"))&&(_tmp611,true,(x=_tmp609[1]),true,(y=_tmp609[2]),true,(z=_tmp609[3]),true,(body=_tmp609[4]),true))))){var _tmp641=mode;var other;var _tmp642;if((((_tmp642=_tmp641),(_tmp642=="expr"))&&(_tmp642,true))){return translate.body(expr,"expr");}else{if(((other=_tmp641),true)){var a=translate(x,"stmt");var b=translate(y,"stmt");var c=translate(z,"expr");var d=translate(body,"stmt");return (((((("for("+a)+b)+c)+"){")+d)+"}");}else{throw ["Could not find a match",_tmp641];}}}else{if((((_tmp602=_tmp555),(_tmp602 instanceof Array))&&(((_tmp603=_tmp602.length),(_tmp603==3))&&(((_tmp604=_tmp602[0]),(_tmp604=="declare"))&&((_tmp604,true,(binding=_tmp602[1]),true,(_tmp605=_tmp602[2]),(_tmp605 instanceof Array))&&(((_tmp606=_tmp605.length),(_tmp606==2))&&(((_tmp607=_tmp605[0]),(_tmp607=="value"))&&((_tmp607,true,(_tmp608=_tmp605[1]),(_tmp608===undefined))&&(_tmp608,true))))))))){var _tmp643=mode;var other;var _tmp644;var _tmp646;var _tmp645;if(((_tmp644=_tmp643),((((_tmp645=_tmp644),(_tmp645=="expr"))&&(_tmp645,true))||(((_tmp646=_tmp644),(_tmp646=="return"))&&(_tmp646,true))))){throw "Invalid in expr ctx";}else{if(((other=_tmp643),true)){var a=translate(binding,"expr");return (("var "+a)+";");}else{throw ["Could not find a match",_tmp643];}}}else{if((((_tmp599=_tmp555),(_tmp599 instanceof Array))&&(((_tmp600=_tmp599.length),(_tmp600==3))&&(((_tmp601=_tmp599[0]),(_tmp601=="declare"))&&(_tmp601,true,(binding=_tmp599[1]),true,(value=_tmp599[2]),true))))){var _tmp647=mode;var other;var _tmp648;var _tmp650;var _tmp649;if(((_tmp648=_tmp647),((((_tmp649=_tmp648),(_tmp649=="expr"))&&(_tmp649,true))||(((_tmp650=_tmp648),(_tmp650=="return"))&&(_tmp650,true))))){throw "Invalid in expr ctx";}else{if(((other=_tmp647),true)){var a=translate(binding,"expr");var b=translate(value,"expr");return (((("var "+a)+"=")+b)+";");}else{throw ["Could not find a match",_tmp647];}}}else{if((((_tmp596=_tmp555),(_tmp596 instanceof Array))&&(((_tmp597=_tmp596.length),(_tmp597==3))&&(((_tmp598=_tmp596[0]),(_tmp598=="assign"))&&(_tmp598,true,(lhs=_tmp596[1]),true,(rhs=_tmp596[2]),true))))){var a=translate(lhs,"expr");var b=translate(rhs,"expr");return translate.expr((((("("+a)+"=")+b)+")"),mode);}else{if((((_tmp593=_tmp555),(_tmp593 instanceof Array))&&(((_tmp594=_tmp593.length),(_tmp594>=1))&&(((_tmp595=_tmp593[0]),(_tmp595=="multi"))&&(_tmp595,true,(args=_tmp593.slice(1)),true))))){var isdecl=function(x){var _tmp651=x;var other;var _tmp652;var _tmp653;var _tmp654;var variable;var value;if((((_tmp652=_tmp651),(_tmp652 instanceof Array))&&(((_tmp653=_tmp652.length),(_tmp653==3))&&(((_tmp654=_tmp652[0]),(_tmp654=="declare"))&&(_tmp654,true,(variable=_tmp652[1]),true,(value=_tmp652[2]),true))))){return true;}else{if(((other=_tmp651),true)){return false;}else{throw ["Could not find a match",_tmp651];}}};if((args.length==1)){return translate(args[0],mode);}else{if(((mode=="expr")&&(!args.some(isdecl)))){var xs=args.map(function(x){return translate(x,"expr");});return (("("+xs.join(","))+")");}else{if(true){return translate.body(expr,mode);}else{return false;}}}}else{if((((_tmp590=_tmp555),(_tmp590 instanceof Array))&&(((_tmp591=_tmp590.length),(_tmp591>=1))&&(((_tmp592=_tmp590[0]),(_tmp592=="splice"))&&(_tmp592,true,(args=_tmp590.slice(1)),true))))){return translate(["multi"].concat(args),mode);}else{if((((_tmp587=_tmp555),(_tmp587 instanceof Array))&&(((_tmp588=_tmp587.length),(_tmp588==1))&&(((_tmp589=_tmp587[0]),(_tmp589=="js_break"))&&(_tmp589,true))))){if((mode=="expr")){throw "Invalid break in ctx";}else{if(true){return "break;";}else{return false;}}}else{if((((_tmp584=_tmp555),(_tmp584 instanceof Array))&&(((_tmp585=_tmp584.length),(_tmp585==1))&&(((_tmp586=_tmp584[0]),(_tmp586=="js_continue"))&&(_tmp586,true))))){if((mode=="expr")){throw "Invalid continue in ctx";}else{if(true){return "continue;";}else{return false;}}}else{if((((_tmp581=_tmp555),(_tmp581 instanceof Array))&&(((_tmp582=_tmp581.length),(_tmp582==2))&&(((_tmp583=_tmp581[0]),(_tmp583=="js_return"))&&(_tmp583,true,(value=_tmp581[1]),true))))){if((mode=="expr")){throw "Invalid return in ctx";}else{if(true){return (("return "+translate(value,"expr"))+";");}else{return false;}}}else{if((((_tmp578=_tmp555),(_tmp578 instanceof Array))&&(((_tmp579=_tmp578.length),(_tmp579==2))&&(((_tmp580=_tmp578[0]),(_tmp580=="js_throw"))&&(_tmp580,true,(value=_tmp578[1]),true))))){if(true){return (("throw "+translate(value,"expr"))+";");}else{return false;}}else{if((((_tmp575=_tmp555),(_tmp575 instanceof Array))&&(((_tmp576=_tmp575.length),(_tmp576>=1))&&(((_tmp577=_tmp575[0]),(_tmp577=="array"))&&(_tmp577,true,(args=_tmp575.slice(1)),true))))){var r=function(){var f=function(x){return translate(x,"expr");};return (("["+args.map(f).join(","))+"]");}();return translate.expr(r,mode);}else{if((((_tmp572=_tmp555),(_tmp572 instanceof Array))&&(((_tmp573=_tmp572.length),(_tmp573>=1))&&(((_tmp574=_tmp572[0]),(_tmp574=="object"))&&(_tmp574,true,(args=_tmp572.slice(1)),true))))){var r=function(){var f=function(x){var a=translate(x[1],"expr");var b=translate(x[2],"expr");return ((a+":")+b);};return (("({"+args.map(f).join(","))+"})");}();return translate.expr(r,mode);}else{if((((_tmp565=_tmp555),(_tmp565 instanceof Array))&&(((_tmp566=_tmp565.length),(_tmp566==3))&&(((_tmp567=_tmp565[0]),(_tmp567=="send"))&&((_tmp567,true,(f=_tmp565[1]),true,(_tmp568=_tmp565[2]),(msg=_tmp568),true,(_tmp569=_tmp568),(_tmp569 instanceof Array))&&(((_tmp570=_tmp569.length),(_tmp570==2))&&(((_tmp571=_tmp569[0]),(_tmp571=="value"))&&(_tmp571,true,(s=_tmp569[1]),true)))))))){if(((typeof(s)=="string")&&s.match(RegExp("(?:^(?:[a-zA-Z_$]+)$)")))){var trf=translate(f,"expr");var trmsg=translate(s,"expr");return translate.expr(((trf+".")+trmsg),mode);}else{if(true){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{return false;}}}else{if((((_tmp559=_tmp555),(_tmp559 instanceof Array))&&(((_tmp560=_tmp559.length),(_tmp560==3))&&(((_tmp561=_tmp559[0]),(_tmp561=="send"))&&((_tmp561,true,(f=_tmp559[1]),true,(_tmp562=_tmp559[2]),(_tmp562 instanceof Array))&&(((_tmp563=_tmp562.length),(_tmp563>=1))&&(((_tmp564=_tmp562[0]),(_tmp564=="array"))&&(_tmp564,true,(args=_tmp562.slice(1)),true)))))))){var op=((typeof(f)=="string")&&js_op_table[f]);if(op){return translate.expr(translate.op(op,args[0],args[1]),mode);}else{if(true){var trf=translate(f,"expr");var trargs=args.map(function(x){return translate(x,"expr");});return translate.expr((((trf+"(")+trargs.join(","))+")"),mode);}else{return false;}}}else{if((((_tmp556=_tmp555),(_tmp556 instanceof Array))&&(((_tmp557=_tmp556.length),(_tmp557==3))&&(((_tmp558=_tmp556[0]),(_tmp558=="send"))&&(_tmp558,true,(f=_tmp556[1]),true,(msg=_tmp556[2]),true))))){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{if(((other=_tmp555),true)){throw other;}else{throw ["Could not find a match",_tmp555];}}}}}}}}}}}}}}}}}}}}}}};(translate.mangle=function(name){var tr=({"+":"__plus__","-":"__minus__","*":"__asterisk__","/":"__slash__","%":"__percent__","^":"__caret__","#":"__hash__","&":"__amp__","|":"__pipe__","@":"__at__","!":"__bang__","?":"__qmark__","=":"__equal__","<":"__lt__",">":"__gt__","~":"__tilde__",".":"__dot__"});var r=[];for(var i=0;(i<name.length);(++i)){var c=name[i];r.push((tr[c]||c));}return r.join("");});(translate.body=function(b,mode){(orig=b);(b=aslist(b));var trst=function(stmt){return translate(stmt,"stmt");};var _tmp655=mode;var other;var _tmp656;var _tmp657;var _tmp658;if((((_tmp658=_tmp655),(_tmp658=="expr"))&&(_tmp658,true))){var x=["send",["lambda",[],orig],["array"]];return translate(x,mode);}else{if((((_tmp657=_tmp655),(_tmp657=="return"))&&(_tmp657,true))){var stmts=b.slice(0,(-1));var ret=b[(b.length-1)];return (stmts.map(trst).join("")+translate(ret,"return"));}else{if((((_tmp656=_tmp655),(_tmp656=="stmt"))&&(_tmp656,true))){return b.map(trst).join("");}else{if(((other=_tmp655),true)){throw "OopsH";}else{throw ["Could not find a match",_tmp655];}}}}});(translate.expr=function(x,mode){var _tmp659=mode;var other;var _tmp660;var _tmp661;var _tmp662;if((((_tmp662=_tmp659),(_tmp662=="expr"))&&(_tmp662,true))){return x;}else{if((((_tmp661=_tmp659),(_tmp661=="stmt"))&&(_tmp661,true))){return (x+";");}else{if((((_tmp660=_tmp659),(_tmp660=="return"))&&(_tmp660,true))){return (("return "+x)+";");}else{if(((other=_tmp659),true)){throw "OopsI";}else{throw ["Could not find a match",_tmp659];}}}}});(translate.op=function(op,a,b){(e=function(){if((a===null)){return (op+translate(b,"expr"));}else{if((b===null)){return (translate(a,"expr")+op);}else{if(true){return ((translate(a,"expr")+op)+translate(b,"expr"));}else{return false;}}}}());return (("("+e)+")");});var fs=require("fs");var file=process.argv[2];var f=function(err,data){var p=parse(data);var ex=expand(stdenv,"top",["multi",p]);var prelude="var ___lib=require(\"./lib\");";return console.log((prelude+translate(ex,"stmt")));};fs.readFile(file,"utf8",f);
