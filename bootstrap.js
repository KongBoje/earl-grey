var ___lib=require("./lib");var special_ops=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",":":"IFX",".":"PFX"});var regexps=function(){var id=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))");var id_f=function(m,wsb,wsa,last_op){return ["ID","ID",m[0]];};var numr=RegExp("(?:^((?:\\d+))[rR]((?:[A-Za-z0-9_]+))(?:(?:\\.((?:[A-Za-z0-9_]+)))?))");var numr_f=function(m,wsb,wsa,last_op){var τp0;var τp1;var radix;var int;var frac;if((((τp0=m),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===4)&&(τp0[0],true,(radix=τp0[1]),true,(int=τp0[2]),true,(frac=τp0[3]),true)))))){false;}else{throw "a condition failed";}(value=parseInt(int.replace(RegExp("_","g"),""),radix));if(frac){(frac=frac.replace(RegExp("_","g"),""));(value=(value+(parseInt(frac,radix)/Math.pow(radix,frac.length))));}else{false;}return ["ID","NUM",value];};var num=RegExp("(?:^((?:[0-9_]+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:[0-9_]+)))?))");var num_f=function(m,wsb,wsa,last_op){return ["ID","NUM",parseFloat(m[0].replace(RegExp("_","g"),""))];};var str=RegExp("(?:^\"((?:(?:(?:\\\\\\\\|\\\\\")|[^\"])*))\")");var str_f=function(m,wsb,wsa,last_op){var repl=({"\\\"":"\"","\\\\":"\\","\\n":"\n"});var r=m[1].replace(RegExp("((?:(?:\\\\\"|\\\\\\\\)|\\\\n))","g"),function(m){return ___lib.send(repl,m);});return ["ID","STR",r];};var op=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!#.:]+))");var op2=RegExp("(?:^[\\(\\[\\{\\}\\]\\),])");var op3=RegExp("(?:^(?:(?:(?:(?:(?:(?:(?:(?:with|where)|when)|and)|not)|or)|in)|instanceof)|mod)\\b)");var op4=RegExp("(?:^`((?:[A-Za-z0-9_]+))`)");var op_f=function(m,wsb,wsa,last_op){var op=(m[1]||m[0]);if((op in special_ops)){var fixity=___lib.send(special_ops,op);var width=function(){var τ0=fixity;var τp0;var τp0;var τp0;var other;if((((τp0=τ0),(τp0==="IFX"))&&(τp0,true))){if((wsb||wsa)){return "wide";}else{return "short";}}else{if((((τp0=τ0),(τp0==="SFX"))&&(τp0,true))){if(wsb){return "wide";}else{return "short";}}else{if((((τp0=τ0),(τp0==="PFX"))&&(τp0,true))){if(wsa){return "wide";}else{return "short";}}else{if(((other=τ0),true)){throw "OopsA";}else{throw ["Could not find a match",τ0];}}}}}();return ["OP",fixity,width,op];}else{if((wsa&&wsb)){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "IFX";}else{return false;}}}(),"wide",op];}else{if(((!wsa)&&(!wsb))){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "IFX";}else{return false;}}}(),"short",op];}else{if(wsa){if(last_op){return ["OP","PFX","wide",op];}else{if(true){return ["OP","SFX","short",op];}else{return false;}}}else{if(wsb){return ["OP","PFX","short",op];}else{if(true){return ["OP","PFX","short",op];}else{return false;}}}}}}};var indent=RegExp("(?:^(?:(?:\n((?: *)))+))");var indent_f=function(m,wsb,wsa,last_op){var ilen=m[1].length;return ["INDENT",ilen];};var cmnt=RegExp("(?:^;(?:[^\n]*))");var cmnt_f=function(m,wsb,wsa,last_op){return ["IGNORE"];};var unkn=RegExp("(?:^.)");var unkn_f=function(m,wsb,wsa,last_op){throw ("unknown character: "+m[0]);};return [[op3,op_f],[id,id_f],[numr,numr_f],[num,num_f],[str,str_f],[op,op_f],[op2,op_f],[op4,op_f],[indent,indent_f],[cmnt,cmnt_f],[unkn,unkn_f]];}();var ws_re=RegExp("(?:^(?: *)(?:(?:\n(?: *)\\\\(?: *))*))");var eol_re=RegExp("(?:^(?: *)(?:\n|$))");var indent_tracker=function(){var curr=false;var stack=[];var stacks=[stack];return function(token){var τ1=token;var τp0;var τp1;var τp2;var new_indent;var τp0;var τp1;var τp2;var stuff;var τp0;var τp1;var τp2;var fixity;var width;var τp3;var τ3;var τ2;var τp0;var τp1;var τp2;var fixity;var width;var τp3;var τ5;var τ4;var other;var τ6;var τ7;var τ8;var τ9;var τ10;if(((τ6=((τp0=τ1),(τp0 instanceof Array)))&&((τ7=(τp0["#"]===undefined))&&((τ8=((τp1=τp0.length),true))&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="INDENT"))&&(τp2,true,(new_indent=τp0[1]),true))))))){if((curr===false)){(curr=new_indent);return [["OP","IFX","wide",","]];}else{if((new_indent>curr)){stack.push(curr);(curr=new_indent);return [["OP","PFX","wide","["]];}else{if((new_indent===curr)){return [["OP","IFX","wide",","]];}else{if((new_indent<curr)){var rval=[];while(((stack.length>0)&&(new_indent<curr))){(curr=stack.pop());rval.push(["OP","SFX","wide","]"]);}rval.push(["OP","IFX","wide",","]);return rval;}else{if(true){throw [curr,new_indent];}else{return false;}}}}}}else{if((τ8&&((τp1>=1)&&(((τp2=τp0[0]),(τp2==="ID"))&&(τp2,true,(stuff=τp0.slice(1)),true))))){return [token];}else{if((τ8&&((τ9=(τp1===4))&&((τ10=((τp2=τp0[0]),(τp2==="OP")))&&(τp2,true,(fixity=τp0[1]),true,(width=τp0[2]),true,(τp3=τp0[3]),((((τ2=τp3),(τ2==="["))&&(τ2,true))||(((τ3=τp3),(τ3==="{"))&&(τ3,true)))))))){stack.push(curr);stacks.push(stack);(stack=[]);(curr=false);return [token];}else{if((τ10&&(τp2,true,(fixity=τp0[1]),true,(width=τp0[2]),true,(τp3=τp0[3]),((((τ4=τp3),(τ4==="]"))&&(τ4,true))||(((τ5=τp3),(τ5==="}"))&&(τ5,true)))))){var rval=stack.map(function(x){return ["OP","SFX","short","]"];});(stack=stacks.pop());(curr=stack.pop());rval.push(token);return rval;}else{if(((other=τ1),true)){return [token];}else{throw ["Could not find a match",τ1];}}}}}};};var process_token=function(token,last_op,wsa,wsb,pos,endpos,accum){var τp0;var τp1;var type;var result;if((((τp0=token),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1>=1)&&((type=τp0[0]),true,(result=τp0.slice(1)),true)))))){false;}else{throw "a condition failed";}var τ11=type;var τp0;var τp0;var τp0;var other;if((((τp0=τ11),(τp0==="IGNORE"))&&(τp0,true))){return last_op;}else{if((((τp0=τ11),(τp0==="ID"))&&(τp0,true))){if((!last_op)){var w=["IFX",function(){if(wsb){return "wide";}else{return "short";}}(),"WHITE"];(w["location"]=[pos,pos]);accum.push(w);}else{false;}accum.push(result);return false;}else{if((((τp0=τ11),(τp0==="OP"))&&(τp0,true))){if(last_op){var v=["VOID"];(v["location"]=[pos,pos]);accum.push(v);}else{false;}var τ12=result[0];var τp0;var τp0;var τp0;if((((τp0=τ12),(τp0==="IFX"))&&(τp0,true))){accum.push(result);return true;}else{if((((τp0=τ12),(τp0==="PFX"))&&(τp0,true))){if((!last_op)){var w=["IFX",function(){if(wsb){return "wide";}else{return "short";}}(),"WHITE"];(w["location"]=[pos,pos]);var v=["VOID"];(v["location"]=[pos,pos]);accum.push(w);accum.push(v);}else{false;}accum.push(result);return true;}else{if((((τp0=τ12),(τp0==="SFX"))&&(τp0,true))){accum.push(result);var v=["VOID"];(v["location"]=[endpos,endpos]);accum.push(v);return false;}else{throw ["Could not find a match",τ12];}}}}else{if(((other=τ11),true)){throw "OopsB";}else{throw ["Could not find a match",τ11];}}}}};var tokenize=function(text){var last_op=true;var results=[];var wsb=text.match(ws_re)[0].length;(text=text.slice(wsb));(pos=wsb);var indent=indent_tracker();while(text){for(var i=0;(i<regexps.length);(++i)){var τp0;var τp1;var re;var fn;if((((τp0=___lib.send(regexps,i)),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((re=τp0[0]),true,(fn=τp0[1]),true)))))){false;}else{throw "a condition failed";}var m=text.match(re);if(m){var skip=m[0].length;var endpos=(pos+skip);(text=text.slice(skip));var wsa=text.match(ws_re)[0].length;var eol=(text.match(eol_re)&&true);var bwsb=(wsb>0);var bwsa=function(){if(eol){return bwsb;}else{return (wsa>0);}}();var token=fn(m,bwsb,bwsa,last_op);var tokens=indent(token);tokens.forEach(function(x){return (last_op=process_token(x,last_op,bwsa,bwsb,pos,endpos,results));});(text=text.slice(wsa));(wsb=wsa);(pos=(endpos+wsa));break;}else{false;}}}if(last_op){var v=["VOID"];(v["location"]=[pos,pos]);results.push(v);}else{false;}return results;};var MAX=(1/0);var order_map=({"IFX":({"wide":({",":[[15,1],[15,1]],"with":[[15,999],[15,10]],"where":[[15,11],[15,10]],"|>":[[15,11],[15,10]],"->":[[15,11],[15,10]],"=>":[[15,11],[15,10]],"=":[[15,11],[15,10]],":=":[[15,11],[15,10]],"+=":[[15,11],[15,10]],"-=":[[15,11],[15,10]],"*=":[[15,11],[15,10]],"/=":[[15,11],[15,10]],"<<=":[[15,11],[15,10]],">>=":[[15,11],[15,10]],">>>=":[[15,11],[15,10]],"when":[[15,100],[15,101]],"||":[[15,110],[15,111]],"&&":[[15,120],[15,121]],"or":[[15,110],[15,111]],"and":[[15,120],[15,121]],"not":[[15,130],[15,131]],"==":[[15,200],[15,201]],"!=":[[15,200],[15,201]],">=":[[15,200],[15,201]],"<=":[[15,200],[15,201]],">":[[15,200],[15,201]],"<":[[15,200],[15,201]],"^.":[[15,400],[15,401]],"|.":[[15,410],[15,411]],"&.":[[15,420],[15,421]],"<<":[[1,500],[1,501]],">>":[[1,500],[1,501]],">>>":[[1,500],[1,501]],"+":[[1,550],[1,551]],"-":[[1,550],[1,551]],"*":[[1,560],[1,561]],"/":[[1,560],[1,561]],"mod":[[1,560],[1,561]],"**":[[1,571],[1,570]],"default":[[8,900],[4,901]],"WHITE":[[15,1000],[15,1001]],":":[[15,1001],[15,2]]}),"short":({"default":[[15,1900],[15,1901]],"WHITE":[[15,2000],[15,2001]],",":[[15,1],[15,1]],":":[[15,1001],[15,2]]})}),"PFX":({"wide":({"default":[[15,MAX],[15,900]],"not":[[15,130],[15,131]],".":[[15,MAX],[15,3000]],"#":[[15,MAX],[15,3000]],"<>":[[15,MAX],[15,5]],"(":[[15,MAX],[15,1]],"[":[[15,MAX],[15,1]],"{":[[15,MAX],[15,1]]}),"short":({"default":[[15,MAX],[15,1900]],".":[[15,MAX],[15,3000]],"#":[[15,MAX],[15,3000]],"(":[[15,MAX],[15,1]],"[":[[15,MAX],[15,1]],"{":[[15,MAX],[15,1]]})}),"SFX":({"wide":({"default":[[15,901],[15,MAX]],")":[[15,1],[15,MAX]],"]":[[15,1],[15,MAX]],"}":[[15,1],[15,MAX]]}),"short":({"default":[[15,1901],[15,MAX]],")":[[15,1],[15,MAX]],"]":[[15,1],[15,MAX]],"}":[[15,1],[15,MAX]]})})});var DONE=(-1);var NONE=0;var LEFT=1;var RIGHT=2;var BOTH=3;var oparse=function(next,order,finalize){var between=finalize(next());var right_op=next();var stack=[];var left_op=null;var current=null;while(true){var o=function(){if(((!left_op)&&(!right_op))){return DONE;}else{if(true){return ((((!left_op)&&RIGHT)||((!right_op)&&LEFT))||order(left_op,right_op));}else{return false;}}}();var τ13=o;var τp0;var τp0;var τp0;var τp0;var τp0;var other;if((((τp0=τ13),(τp0===DONE))&&(τp0,true))){return between;}else{if((((τp0=τ13),(τp0===LEFT))&&(τp0,true))){current.push(between);(between=finalize(current));var v=stack.pop();(left_op=v[0]);(current=v[1]);}else{if((((τp0=τ13),(τp0===RIGHT))&&(τp0,true))){stack.push([left_op,current]);(left_op=right_op);(current=[[right_op],between]);(between=finalize(next()));(right_op=next());}else{if((((τp0=τ13),(τp0===BOTH))&&(τp0,true))){current[0].push(right_op);current.push(between);(left_op=right_op);(between=finalize(next()));(right_op=next());}else{if((((τp0=τ13),(τp0===NONE))&&(τp0,true))){throw ((("Undefined priority between "+left_op)+" and ")+right_op);}else{if(((other=τ13),true)){throw "OopsC";}else{throw ["Could not find a match",τ13];}}}}}}}};var consult=function(τ14){var τp0;var τp1;var fixity;var width;var op;if((((τp0=τ14),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&((fixity=τp0[0]),true,(width=τp0[1]),true,(op=τp0[2]),true)))))){false;}else{throw "a condition failed";}var map=___lib.send(___lib.send(order_map,fixity),width);return (___lib.send(map,op)||map.default);};var order=function(o1,o2){var τp0;var τp1;var code1;var ord1;if((((τp0=consult(o1)[1]),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((code1=τp0[0]),true,(ord1=τp0[1]),true)))))){false;}else{throw "a condition failed";}var τp0;var τp1;var code2;var ord2;if((((τp0=consult(o2)[0]),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((code2=τp0[0]),true,(ord2=τp0[1]),true)))))){false;}else{throw "a condition failed";}if(((code1&code2)===0)){throw ["Cannot mix",o1,o2];}else{if((ord1>ord2)){return LEFT;}else{if((ord1<ord2)){return RIGHT;}else{if((ord1===ord2)){return BOTH;}else{return false;}}}}};var finalize=function(x){var τ15=x;var τp0;var τp1;var τp2;var value;var τp0;var τp1;var τp2;var value;var τp0;var τp1;var τp2;var value;var τp0;var τp1;var τp2;var τp0;var τp1;var ops;var args;var other;var τ16;var τ17;var τ18;var τ19;if(((τ16=((τp0=τ15),(τp0 instanceof Array)))&&((τ17=(τp0["#"]===undefined))&&((τ18=((τp1=τp0.length),true))&&((τ19=(τp1===2))&&(((τp2=τp0[0]),(τp2==="ID"))&&(τp2,true,(value=τp0[1]),true))))))){return value;}else{if((τ19&&(((τp2=τp0[0]),(τp2==="NUM"))&&(τp2,true,(value=τp0[1]),true)))){return ["value",value];}else{if((τ19&&(((τp2=τp0[0]),(τp2==="STR"))&&(τp2,true,(value=τp0[1]),true)))){return ["value",value];}else{if((τ18&&((τp1===1)&&(((τp2=τp0[0]),(τp2==="VOID"))&&(τp2,true))))){return null;}else{if((τ18&&((τp1>=1)&&((ops=τp0[0]),true,(args=τp0.slice(1)),true)))){(ops=ops.map(function(o){return o[2];}));var op=ops[0];var τ20=[ops,args];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var f;var arg;var body;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var f;var body;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var target;var body;var τp0;var τp1;var τp2;var τp3;var τp4;var τ22;var τ21;var τp0;var τp1;var τp2;var τp3;var τp4;var τp0;var τp1;var τp2;var τp3;var τp4;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var a;var b;var other;var τ23;var τ24;var τ25;var τ26;var τ27;var τ28;var τ29;var τ30;var τ31;var τ32;var τ33;var τ34;if(((τ23=((τp0=τ20),(τp0 instanceof Array)))&&((τ24=(τp0["#"]===undefined))&&((τ25=((τp1=τp0.length),true))&&((τ26=(τp1===2))&&((τ27=((τp2=τp0[0]),(τp2 instanceof Array)))&&((τ28=(τp2["#"]===undefined))&&((τ29=((τp3=τp2.length),true))&&((τp3===2)&&(((τp4=τp2[0]),(τp4==="WHITE"))&&((τp4,true,(τp5=τp2[1]),(τp5===":"))&&((τp5,true,(τp6=τp0[1]),(τp6 instanceof Array))&&((τp6["#"]===undefined)&&(((τp7=τp6.length),true)&&((τp7===3)&&((f=τp6[0]),true,(arg=τp6[1]),true,(body=τp6[2]),true)))))))))))))))){return ["send",f,["data",["code",arg],["code",body]]];}else{if((τ29&&((τ30=(τp3===1))&&(((τp4=τp2[0]),(τp4===":"))&&((τp4,true,(τp5=τp0[1]),(τp5 instanceof Array))&&((τp5["#"]===undefined)&&(((τp6=τp5.length),true)&&((τp6===2)&&((f=τp5[0]),true,(body=τp5[1]),true))))))))){return ["send",f,["data",["code",body]]];}else{if((τ30&&(((τp4=τp2[0]),(τp4==="with"))&&((τp4,true,(τp5=τp0[1]),(τp5 instanceof Array))&&((τp5["#"]===undefined)&&(((τp6=τp5.length),true)&&((τp6===2)&&((target=τp5[0]),true,(body=τp5[1]),true)))))))){(body=function(){var τ39=body;var τp0;var τp1;var τp2;var rest;var other;if((((τp0=τ39),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1>=1)&&(((τp2=τp0[0]),(τp2==="multi"))&&(τp2,true,(rest=τp0.slice(1)),true))))))){return rest;}else{if(((other=τ39),true)){return [body];}else{throw ["Could not find a match",τ39];}}}());var τ35=target;var τp0;var τp0;var τp1;var τp2;var f;var τp3;var τp4;var τp5;var args;var τp0;var τp1;var τp2;var args;var other;var τ36;var τ37;var τ38;if((((τp0=τ35),(τp0===null))&&(τp0,true))){return ["data"].concat(body);}else{if(((τ36=((τp0=τ35),(τp0 instanceof Array)))&&((τ37=(τp0["#"]===undefined))&&((τ38=((τp1=τp0.length),true))&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="send"))&&((τp2,true,(f=τp0[1]),true,(τp3=τp0[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4>=1)&&(((τp5=τp3[0]),(τp5==="data"))&&(τp5,true,(args=τp3.slice(1)),true)))))))))))){return ["send",f,["data"].concat(args).concat(body)];}else{if((τ38&&((τp1>=1)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(args=τp0.slice(1)),true))))){return target.concat(body);}else{if(((other=τ35),true)){return ["send",target,["data"].concat(body)];}else{throw ["Could not find a match",τ35];}}}}}else{if((τ29&&((τ30=(τp3>=1))&&(((τp4=τp2[0]),((((τ21=τp4),(τ21==="["))&&(τ21,true))||(((τ22=τp4),(τ22===","))&&(τ22,true))))&&(τp2.slice(1),true,τp0[1],true))))){if((op==="[")){(args=args.slice(1,(-1)));}else{false;}(args=function(){var f=function(x){return (x!==null);};return args.filter(f);}());var result=function(){var τ40=args;var τp0;var τp1;var τp0;var τp1;var x;var other;var τ41;var τ42;var τ43;if(((τ41=((τp0=τ40),(τp0 instanceof Array)))&&((τ42=(τp0["#"]===undefined))&&((τ43=((τp1=τp0.length),true))&&(τp1===0))))){throw "At least one expression must be enclosed in []";}else{if((τ43&&((τp1===1)&&((x=τp0[0]),true)))){return x;}else{if(((other=τ40),true)){return ["multi"].concat(args);}else{throw ["Could not find a match",τ40];}}}}();return result;}else{if((τ30&&(((τp4=τp2[0]),(τp4==="{"))&&(τp4,true,τp2.slice(1),true,τp0[1],true)))){var f=function(x){return (x!==null);};return ["data"].concat(args.slice(1,(-1)).filter(f));}else{if((τ29&&((τ30=(τp3===1))&&(((τp4=τp2[0]),(τp4==="WHITE"))&&(τp4,true,τp0[1],true))))){return ["send"].concat(args);}else{if((τ30&&((τ31=(τp2[0],true,(τp4=τp0[1]),(τp4 instanceof Array)))&&((τ32=(τp4["#"]===undefined))&&((τ33=((τp5=τp4.length),true))&&((τ34=(τp5===2))&&(((τp6=τp4[0]),(τp6===null))&&((τp6,true,(τp7=τp4[1]),(τp7===null))&&(τp7,true))))))))){return op;}else{if((τ34&&((a=τp4[0]),true,(b=τp4[1]),true))){return ["send",op,["data",a,b]];}else{if(((other=τ20),true)){throw ["Unknown node",ops,args];}else{throw ["Could not find a match",τ20];}}}}}}}}}}else{if(((other=τ15),true)){throw "OopsE";}else{throw ["Could not find a match",τ15];}}}}}}};var parse=function(text){var results=tokenize(text);var next=function(){return results.shift();};return oparse(next,order,finalize);};var Env=function(parent){var store=Object();var self=function(expr){return ["bind_env",self,expr];};(self["resolve"]=function(name){var attempt=___lib.send(store,name);if(attempt){return attempt;}else{if(true){return self.parent.resolve(name);}else{return false;}}});(self["register"]=function(name,value){return (store[name]=value);});(self["register_macro"]=function(name,m){return (store[name]=["macro",m]);});(self["fork"]=function(){return Env(self);});(self["parent"]=parent);(self["store"]=store);return self;};var js_contexts=({"js_for":["multi","multi","multi","multi"]});var expand=function(env,context,expr){(expr=expand.step(env,context,expr));var τ44=expr;var τp0;var τp0;var τp0;var τp0;var τp1;var τp2;var f;var arg;var τp0;var τp1;var τp2;var v;var τp0;var τp1;var τp2;var type;var τp3;var τ52;var τ45;var τ51;var τ46;var τ50;var τ47;var τ49;var τ48;var args;var τp0;var τp1;var τp2;var args;var τp0;var τp1;var τp2;var bindings;var body;var τp0;var τp1;var τp2;var binding;var value;var τp0;var τp1;var τp2;var lhs;var rhs;var τp0;var τp1;var τp2;var type;var τp3;var τ64;var τ53;var τ63;var τ54;var τ62;var τ55;var τ61;var τ56;var τ60;var τ57;var τ59;var τ58;var args;var τp0;var τp1;var τp2;var expr;var other;var τ65;var τ66;var τ67;var τ68;if((((τp0=τ44),(typeof(τp0)==="string"))&&(τp0,true))){return expr;}else{if((((τp0=τ44),(τp0===null))&&(τp0,true))){return null;}else{if((((τp0=τ44),(τp0===undefined))&&(τp0,true))){throw "undefined? why?";}else{if(((τ65=((τp0=τ44),(τp0 instanceof Array)))&&((τ66=(τp0["#"]===undefined))&&((τ67=((τp1=τp0.length),true))&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="send"))&&(τp2,true,(f=τp0[1]),true,(arg=τp0[2]),true))))))){(f=expand(env,"head",f));return ["send",f,expand(env,"tail",arg)];}else{if((τ67&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="value"))&&(τp2,true,(v=τp0[1]),true))))){return expr;}else{if((τ67&&((τ68=(τp1>=1))&&(((τp2=τp0[0]),(type=τp2),true,(τp3=τp2),(((τ45=τp3),(((τ46=τ45),(((τ47=τ46),((((τ48=τ47),(τ48==="multi"))&&(τ48,true))||(((τ49=τ47),(τ49==="code"))&&(τ49,true))))||(((τ50=τ46),(τ50==="array"))&&(τ50,true))))||(((τ51=τ45),(τ51==="object"))&&(τ51,true))))||(((τ52=τp3),(τ52==="splice"))&&(τ52,true))))&&((args=τp0.slice(1)),true))))){var arr=[];while((args.length>0)){var x=expand.step(env,type,args.shift());var τ69=x;var τp0;var τp1;var τp2;var stmts;var other;if((((τp0=τ69),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1>=1)&&(((τp2=τp0[0]),(τp2==="splice"))&&(τp2,true,(stmts=τp0.slice(1)),true))))))){(args=stmts.concat(args));}else{if(((other=τ69),true)){arr.push(x);}else{throw ["Could not find a match",τ69];}}}var f=function(x){return expand(env,type,x);};return [type].concat(arr.map(f));}else{if((τ68&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(args=τp0.slice(1)),true)))){var is_obj=false;var obj=["object"];var arr=["array"];var parts=[];var newpart=function(){var τ70=arr;var τp0;var τp1;var τp2;var other;if((((τp0=τ70),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===1)&&(((τp2=τp0[0]),(τp2==="array"))&&(τp2,true))))))){return false;}else{if(((other=τ70),true)){parts.push(arr);return (arr=["array"]);}else{throw ["Could not find a match",τ70];}}};while((args.length>0)){var x=expand.step(env,type,args.shift());var τ71=x;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var k;var v;var τp0;var τp1;var τp2;var exprs;var τp0;var τp1;var τp2;var expr;var other;var τ72;var τ73;var τ74;if(((τ72=((τp0=τ71),(τp0 instanceof Array)))&&((τ73=(τp0["#"]===undefined))&&((τ74=((τp1=τp0.length),true))&&((τp1===1)&&(((τp2=τp0[0]),(τp2==="assoc"))&&(τp2,true))))))){(is_obj=true);}else{if((τ74&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="assoc"))&&(τp2,true,(k=τp0[1]),true,(v=τp0[2]),true))))){(is_obj=true);obj.push(["array",k,v]);}else{if((τ74&&((τp1>=1)&&(((τp2=τp0[0]),(τp2==="splice"))&&(τp2,true,(exprs=τp0.slice(1)),true))))){(args=exprs.concat(args));}else{if((τ74&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="dynsplice"))&&(τp2,true,(expr=τp0[1]),true))))){newpart();parts.push(expr);}else{if(((other=τ71),true)){arr.push(other);}else{throw ["Could not find a match",τ71];}}}}}}newpart();var r=function(){var τ75=parts;var τp0;var τp1;var τp0;var τp1;var τp0;var τp1;var τp2;var arr;var τp3;var τp4;var τp5;var things;var other;var τ76;var τ77;var τ78;var τ79;if(((τ76=((τp0=τ75),(τp0 instanceof Array)))&&((τ77=(τp0["#"]===undefined))&&((τ78=((τp1=τp0.length),true))&&((τ79=(τp1===0))&&is_obj))))){return obj;}else{if(τ79){return ["array"];}else{if((τ78&&((τp1===1)&&(((τp2=τp0[0]),(arr=τp2),true,(τp3=τp2),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4>=1)&&(((τp5=τp3[0]),(τp5==="array"))&&(τp5,true,(things=τp3.slice(1)),true))))))))){if(is_obj){arr.push(obj);}else{false;}return arr;}else{if(((other=τ75),true)){if(is_obj){parts.push(["array",obj]);}else{false;}var patch=["send","___lib",["value","patch_array"]];return ["send",patch,["array"].concat(parts)];}else{throw ["Could not find a match",τ75];}}}}}();return expand(env,context,r);}else{if((τ67&&((τ68=(τp1===3))&&(((τp2=τp0[0]),(τp2==="lambda"))&&(τp2,true,(bindings=τp0[1]),true,(body=τp0[2]),true))))){return ["lambda",bindings.map(function(x){return expand(env,"decl",x);}),expand(env,"multi",body)];}else{if((τ68&&(((τp2=τp0[0]),(τp2==="declare"))&&(τp2,true,(binding=τp0[1]),true,(value=τp0[2]),true)))){return ["declare",expand(env,"decl",binding),expand(env,"multi",value)];}else{if((τ68&&(((τp2=τp0[0]),(τp2==="assign"))&&(τp2,true,(lhs=τp0[1]),true,(rhs=τp0[2]),true)))){return ["assign",expand(env,"decl",lhs),expand(env,"multi",rhs)];}else{if((τ67&&((τp1>=1)&&(((τp2=τp0[0]),(type=τp2),true,(τp3=τp2),(((τ53=τp3),(((τ54=τ53),(((τ55=τ54),(((τ56=τ55),(((τ57=τ56),((((τ58=τ57),(τ58==="js_while"))&&(τ58,true))||(((τ59=τ57),(τ59==="js_for"))&&(τ59,true))))||(((τ60=τ56),(τ60==="js_break"))&&(τ60,true))))||(((τ61=τ55),(τ61==="js_continue"))&&(τ61,true))))||(((τ62=τ54),(τ62==="js_return"))&&(τ62,true))))||(((τ63=τ53),(τ63==="js_throw"))&&(τ63,true))))||(((τ64=τp3),(τ64==="if"))&&(τ64,true))))&&((args=τp0.slice(1)),true))))){var ctxs=(___lib.send(js_contexts,type)||[]);var f=function(x,i){return expand(env,(___lib.send(ctxs,i)||"expr"),x);};return [type].concat(args.map(f));}else{if((τ67&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="done"))&&(τp2,true,(expr=τp0[1]),true))))){return expr;}else{if(((other=τ44),true)){throw ["Oops",expr,context];}else{throw ["Could not find a match",τ44];}}}}}}}}}}}}}};(expand["step"]=function(env,context,expr){var τ80=expr;var τp0;var τp0;var τp0;var τp0;var τp1;var τp2;var m;var τp0;var τp1;var τp2;var f;var arg;var τp0;var τp1;var type;var args;var other;var τ81;var τ82;var τ83;if((((τp0=τ80),(typeof(τp0)==="string"))&&(τp0,true))){var v=env.resolve(expr);var τ84=[v,context];var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var τp3;var τp4;var m;var τp5;var τp0;var τp1;var τp2;var τp3;var τp4;var m;var other;var τ85;var τ86;var τ87;var τ88;var τ89;var τ90;var τ91;var τ92;var τ93;if(((τ85=((τp0=τ84),(τp0 instanceof Array)))&&((τ86=(τp0["#"]===undefined))&&((τ87=((τp1=τp0.length),true))&&((τ88=(τp1===2))&&(((τp2=τp0[0]),(τp2===undefined))&&(τp2,true,τp0[1],true))))))){return expr;}else{if((τ88&&((τ89=((τp2=τp0[0]),(τp2 instanceof Array)))&&((τ90=(τp2["#"]===undefined))&&((τ91=((τp3=τp2.length),true))&&((τ92=(τp3===2))&&((τ93=((τp4=τp2[0]),(τp4==="macro")))&&((τp4,true,(m=τp2[1]),true,(τp5=τp0[1]),(τp5==="head"))&&(τp5,true))))))))){return v;}else{if((τ93&&(τp4,true,(m=τp2[1]),true,τp0[1],true))){return expand.step(env,context,m(env,context,null));}else{if(((other=τ84),true)){return v;}else{throw ["Could not find a match",τ84];}}}}}else{if((((τp0=τ80),(τp0===null))&&(τp0,true))){return null;}else{if((((τp0=τ80),(τp0===undefined))&&(τp0,true))){throw "undefined? why?";}else{if(((τ81=((τp0=τ80),(τp0 instanceof Array)))&&((τ82=(τp0["#"]===undefined))&&((τ83=((τp1=τp0.length),true))&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="macro"))&&(τp2,true,(m=τp0[1]),true))))))){if((context==="head")){return expr;}else{if(true){return expand.step(env,context,m(env,context,null));}else{return false;}}}else{if((τ83&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="send"))&&(τp2,true,(f=τp0[1]),true,(arg=τp0[2]),true))))){(f=expand.step(env,"head",f));var τ94=f;var τp0;var τp1;var τp2;var m;var other;if((((τp0=τ94),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="macro"))&&(τp2,true,(m=τp0[1]),true))))))){return expand.step(env,context,m(env,context,arg));}else{if(((other=τ94),true)){return expr;}else{throw ["Could not find a match",τ94];}}}else{if((τ83&&((τp1>=1)&&((type=τp0[0]),true,(args=τp0.slice(1)),true)))){return expr;}else{if(((other=τ80),true)){throw ["Oops2",expr];}else{throw ["Could not find a match",τ80];}}}}}}}});var aslist=function(expr){var τ95=expr;var τp0;var τp0;var τp0;var τp1;var τp2;var args;var other;if((((τp0=τ95),(τp0===null))&&(τp0,true))){return [null];}else{if((((τp0=τ95),(τp0===undefined))&&(τp0,true))){return [undefined];}else{if((((τp0=τ95),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1>=1)&&(((τp2=τp0[0]),(τp2==="multi"))&&(τp2,true,(args=τp0.slice(1)),true))))))){return args;}else{if(((other=τ95),true)){return [other];}else{throw ["Could not find a match",τ95];}}}}};var nullenv=({"resolve":function(x){return undefined;}});var stdenv=Env(nullenv);stdenv.register("+","___plus");stdenv.register("-","___minus");stdenv.register("*","___times");stdenv.register("/","___div");stdenv.register("%","___mod");stdenv.register("^","___binxor");stdenv.register("&","___binand");stdenv.register("|","___binor");stdenv.register("~","___binnot");stdenv.register("&&","___and");stdenv.register("||","___or");stdenv.register("and","___and");stdenv.register("or","___or");stdenv.register("not","___not");stdenv.register("===","___is");stdenv.register("!==","___isnt");stdenv.register("!=","___neq");stdenv.register("<","___lt");stdenv.register(">","___gt");stdenv.register("<=","___lte");stdenv.register(">=","___gte");stdenv.register("<<","___shl");stdenv.register(">>","___shr");stdenv.register(">>>","___shr2");stdenv.register("in","___in");stdenv.register("instanceof","___instanceof");stdenv.register("++","___plusplus");stdenv.register("--","___minusminus");stdenv.register("Struct",["send","___lib",["value","Struct"]]);var make_checker=function(value,op){return function(env,context,expr){return ["send",op,["data",expr[1],value]];};};stdenv.register_macro("**",function(env,context,τ96){var τp0;var τp1;var τp2;var a;var b;if((((τp0=τ96),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(a=τp0[1]),true,(b=τp0[2]),true))))))){false;}else{throw "a condition failed";}return ["send",["send","Math",["value","pow"]],["data",a,b]];});stdenv.register_macro("//",function(env,context,τ97){var τp0;var τp1;var τp2;var a;var b;if((((τp0=τ97),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(a=τp0[1]),true,(b=τp0[2]),true))))))){false;}else{throw "a condition failed";}var div=["send","___div",["data",a,b]];return ["send",["send","Math",["value","floor"]],["data",div]];});stdenv.register_macro("<>",function(env,context,τ98){var τp0;var τp1;var τp2;var τp3;var x;if((((τp0=τ98),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="data"))&&((τp2,true,(τp3=τp0[1]),(τp3===null))&&(τp3,true,(x=τp0[2]),true)))))))){false;}else{throw "a condition failed";}return ["send",["send","___lib",["value","pr"]],["data",x]];});stdenv.register_macro("#",function(env,context,τ99){var τp0;var τp1;var τp2;var τp3;var tag;if((((τp0=τ99),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="data"))&&((τp2,true,(τp3=τp0[1]),(τp3===null))&&(τp3,true,(tag=τp0[2]),true)))))))){false;}else{throw "a condition failed";}(tag=["value",tag]);var f=function(env,context,expr){if((context==="pattern")){var checker_mac=function(){var f=function(env,context,expr){return ["send","___eq",["data",["send",expr[1],["value","#"]],tag]];};return ["macro",f];}();var τ100=expr;var τp0;var τp1;var τp2;var subp;var other;if((((τp0=τ100),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1>=1)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(subp=τp0.slice(1)),true))))))){var deconstructor_mac=function(){var f=function(env,context,expr){return ["data",["value",true],expr[1]];};return ["macro",f];}();return ["check",checker_mac,["project",deconstructor_mac,["duck"].concat(subp)]];}else{if(((other=τ100),true)){return ["check",checker_mac,(expr||["ignore"])];}else{throw ["Could not find a match",τ100];}}}else{if(true){var τ101=expr;var τp0;var τp0;var τp1;var τp2;var args;var other;if((((τp0=τ101),(τp0===null))&&(τp0,true))){var d=["data",tag];return ["send",["send","___lib",["value","StructFactory"]],d];}else{if((((τp0=τ101),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1>=1)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(args=τp0.slice(1)),true))))))){var d=["data",tag].concat(args);return ["send",["send","___lib",["value","Struct"]],d];}else{if(((other=τ101),true)){var factory=function(){var d=["data",tag];return ["send",["send","___lib",["value","StructFactory"]],d];}();return ["send",factory,other];}else{throw ["Could not find a match",τ101];}}}}else{return false;}}};return ["macro",f];});stdenv.register_macro("when",function(env,context,τ102){var τp0;var τp1;var τp2;var pattern;var condition;if((((τp0=τ102),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(pattern=τp0[1]),true,(condition=τp0[2]),true))))))){false;}else{throw "a condition failed";}var τ103=pattern;var τp0;var other;if((((τp0=τ103),(τp0===null))&&(τp0,true))){return ["test",condition,["ignore"]];}else{if(((other=τ103),true)){return ["test",condition,pattern];}else{throw ["Could not find a match",τ103];}}});var andf=function(env,context,expr){var τ104=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var a;var b;var τp0;var τp1;var τp2;var other;var τ105;var τ106;var τ107;var τ108;if(((τ105=((τp0=τ104),(τp0 instanceof Array)))&&((τ106=(τp0["#"]===undefined))&&((τ107=((τp1=τp0.length),true))&&((τ108=(τp1===2))&&(((τp2=τp0[0]),(τp2==="pattern"))&&((τp2,true,(τp3=τp0[1]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(τp5,true,(a=τp3[1]),true,(b=τp3[2]),true)))))))))))){return ["all",a,b];}else{if((τ108&&((τp0[0],true,(τp2=τp0[1]),(τp2===null))&&(τp2,true)))){return "___and";}else{if(((other=τ104),true)){return ["send","___and",expr];}else{throw ["Could not find a match",τ104];}}}};stdenv.register_macro("&&",andf);stdenv.register_macro("and",andf);var orf=function(env,context,expr){var τ109=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var a;var b;var τp0;var τp1;var τp2;var other;var τ110;var τ111;var τ112;var τ113;if(((τ110=((τp0=τ109),(τp0 instanceof Array)))&&((τ111=(τp0["#"]===undefined))&&((τ112=((τp1=τp0.length),true))&&((τ113=(τp1===2))&&(((τp2=τp0[0]),(τp2==="pattern"))&&((τp2,true,(τp3=τp0[1]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(τp5,true,(a=τp3[1]),true,(b=τp3[2]),true)))))))))))){return ["any",a,b];}else{if((τ113&&((τp0[0],true,(τp2=τp0[1]),(τp2===null))&&(τp2,true)))){return "___or";}else{if(((other=τ109),true)){return ["send","___or",expr];}else{throw ["Could not find a match",τ109];}}}};stdenv.register_macro("||",orf);stdenv.register_macro("or",orf);var partial_pattern=function(operator){return function(env,context,expr){var τ114=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var val;var τp0;var τp1;var τp2;var other;var τ115;var τ116;var τ117;var τ118;if(((τ115=((τp0=τ114),(τp0 instanceof Array)))&&((τ116=(τp0["#"]===undefined))&&((τ117=((τp1=τp0.length),true))&&((τ118=(τp1===2))&&(((τp2=τp0[0]),(τp2==="pattern"))&&((τp2,true,(τp3=τp0[1]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&((τp5,true,(τp6=τp3[1]),(τp6===null))&&(τp6,true,(val=τp3[2]),true))))))))))))){return ["check",["macro",make_checker(val,operator)],["ignore"]];}else{if((τ118&&((τp0[0],true,(τp2=τp0[1]),(τp2===null))&&(τp2,true)))){return operator;}else{if(((other=τ114),true)){return ["send",operator,expr];}else{throw ["Could not find a match",τ114];}}}};};stdenv.register_macro("==",partial_pattern("___eq"));stdenv.register_macro("!=",partial_pattern("___neq"));stdenv.register_macro("<=",partial_pattern("___leq"));stdenv.register_macro(">=",partial_pattern("___geq"));stdenv.register_macro("<",partial_pattern("___lt"));stdenv.register_macro(">",partial_pattern("___gt"));stdenv.register_macro("*",function(env,context,expr){var τ119=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp0;var τp1;var τp2;var τ121;var τ120;var τp3;var τp4;var τp5;var val;var τp6;var τp0;var τp1;var τp2;var other;var τ122;var τ123;var τ124;var τ125;if(((τ122=((τp0=τ119),(τp0 instanceof Array)))&&((τ123=(τp0["#"]===undefined))&&((τ124=((τp1=τp0.length),true))&&((τ125=(τp1===2))&&(((τp2=τp0[0]),(τp2==="pattern"))&&((τp2,true,(τp3=τp0[1]),(τp3===null))&&(τp3,true)))))))){return ["dynsplice",["ignore"]];}else{if((τ125&&(((τp2=τp0[0]),((((τ120=τp2),(τ120==="pattern"))&&(τ120,true))||(((τ121=τp2),(τ121==="data"))&&(τ121,true))))&&(((τp3=τp0[1]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&((τp5,true,(val=τp3[1]),true,(τp6=τp3[2]),(τp6===null))&&(τp6,true)))))))))){return ["dynsplice",val];}else{if((τ125&&((τp0[0],true,(τp2=τp0[1]),(τp2===null))&&(τp2,true)))){return "___times";}else{if(((other=τ119),true)){return ["send","___times",expr];}else{throw ["Could not find a match",τ119];}}}}});stdenv.register_macro(".",function(env,context,expr){var τ126=expr;var τp0;var τp1;var τp2;var τp3;var τp4;var s;var other;if((((τp0=τ126),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="data"))&&((τp2,true,(τp3=τp0[1]),(τp3===null))&&((τp3,true,(τp4=τp0[2]),(typeof(τp4)==="string"))&&((s=τp4),true))))))))){return ["value",s];}else{if(((other=τ126),true)){throw ["invalid",expr];}else{throw ["Could not find a match",τ126];}}});stdenv.register_macro("where",function(env,context,τ127){var τp0;var τp1;var τp2;var a;var b;if((((τp0=τ127),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(a=τp0[1]),true,(b=τp0[2]),true))))))){false;}else{throw "a condition failed";}return ["send","let",["data",["code",b],["code",a]]];});stdenv.register_macro("let",function(env,context,τ128){var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var a;var τp6;var τp7;var τp8;var b;if((((τp0=τ128),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="data"))&&((τp2,true,(τp3=τp0[1]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===2)&&(((τp5=τp3[0]),(τp5==="code"))&&((τp5,true,(a=τp3[1]),true,(τp6=τp0[2]),(τp6 instanceof Array))&&((τp6["#"]===undefined)&&(((τp7=τp6.length),true)&&((τp7===2)&&(((τp8=τp6[0]),(τp8==="code"))&&(τp8,true,(b=τp6[1]),true))))))))))))))))){false;}else{throw "a condition failed";}var bindings=aslist(a);var body=aslist(b);return ["multi"].concat(bindings).concat(body);});stdenv.register_macro("->",function(env,context,τ129){var τp0;var τp1;var τp2;var args;var stmts;if((((τp0=τ129),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(args=τp0[1]),true,(stmts=τp0[2]),true))))))){false;}else{throw "a condition failed";}var body=["multi"];(args=args.slice(1).map(function(x){var τ130=x;var τp0;var other;if((((τp0=τ130),(typeof(τp0)==="string"))&&(τp0,true))){return x;}else{if(((other=τ130),true)){var t=gensym();body.push(["send","=",["data",x,t]]);return t;}else{throw ["Could not find a match",τ130];}}}));body.push(stmts);return ["lambda",args,body];});stdenv.register_macro("=>",function(env,context,τ131){var τp0;var τp1;var τp2;var binding;var value;if((((τp0=τ131),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(binding=τp0[1]),true,(value=τp0[2]),true))))))){false;}else{throw "a condition failed";}if((context==="data")){return ["assoc",binding,value];}else{if(true){throw (("Illegal context for '=>' ("+context)+")");}else{return false;}}});stdenv.register_macro("=",function(env,context,expr){var τ132=[context,expr];var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var lhs;var rhs;var τp0;var τp1;var τp2;var τp3;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var f;var τp9;var τp10;var τp11;var args;var value;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var binding;var value;var other;var τ133;var τ134;var τ135;var τ136;var τ137;var τ138;var τ139;var τ140;var τ141;var τ142;if(((τ133=((τp0=τ132),(τp0 instanceof Array)))&&((τ134=(τp0["#"]===undefined))&&((τ135=((τp1=τp0.length),true))&&((τ136=(τp1===2))&&(((τp2=τp0[0]),(τp2==="multi"))&&((τp2,true,(τp3=τp0[1]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="data"))&&(τp5,true,(lhs=τp3[1]),true,(rhs=τp3[2]),true)))))))))))){var p=parse_lhs(env,lhs,rhs);var vars=make_declarations(p[0]);var r=["splice"].concat(vars);var clauses=p[1];var mkif=function(x){return ["if",x,["value",false],["js_throw",["value","a condition failed"]]];};if((clauses.length===1)){var clause=clauses[0];var last=___lib.send(clause,(clause.length-1));var τ143=last;var τp0;var τp1;var τp2;var τp3;var other;if((((τp0=τ143),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="value"))&&((τp2,true,(τp3=τp0[1]),(τp3===true))&&(τp3,true)))))))){if(((vars.length===1)&&(clause.length===3))){(r=["declare"].concat(clause[1].slice(1)));}else{if(true){(r=r.concat(clause.slice(1,(-1))));}else{false;}}}else{if(((other=τ143),true)){r.push(mkif(clause));}else{throw ["Could not find a match",τ143];}}}else{if(true){var ands=make_pattern_test(clauses);r.push(mkif(ands));}else{false;}}return r;}else{if((τ136&&((τ137=((τp2=τp0[0]),(τp2==="data")))&&((τp2,true,(τp3=τp0[1]),(τp3===null))&&(τp3,true))))){return ["assoc"];}else{if((τ137&&((τ138=(τp2,true,(τp3=τp0[1]),(τp3 instanceof Array)))&&((τ139=(τp3["#"]===undefined))&&((τ140=((τp4=τp3.length),true))&&((τ141=(τp4===3))&&((τ142=((τp5=τp3[0]),(τp5==="data")))&&((τp5,true,(τp6=τp3[1]),(τp6 instanceof Array))&&((τp6["#"]===undefined)&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="send"))&&((τp8,true,(f=τp6[1]),true,(τp9=τp6[2]),(τp9 instanceof Array))&&((τp9["#"]===undefined)&&(((τp10=τp9.length),true)&&((τp10>=1)&&(((τp11=τp9[0]),(τp11==="data"))&&(τp11,true,(args=τp9.slice(1)),true,(value=τp3[2]),true)))))))))))))))))){return ["assoc",["value",f],["lambda",args,value]];}else{if((τ142&&(τp5,true,(binding=τp3[1]),true,(value=τp3[2]),true))){return ["assoc",["value",binding],value];}else{if(((other=τ132),true)){throw (("Illegal context for '=' ("+context)+")");}else{throw ["Could not find a match",τ132];}}}}}});var make_assigner=function(op){return function(env,context,τ144){var τp0;var τp1;var τp2;var a;var b;if((((τp0=τ144),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(a=τp0[1]),true,(b=τp0[2]),true))))))){false;}else{throw "a condition failed";}return ["assign",a,["send",op,["data",a,b]]];};};stdenv.register_macro(":=",function(env,context,τ145){var τp0;var τp1;var τp2;var a;var b;if((((τp0=τ145),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(a=τp0[1]),true,(b=τp0[2]),true))))))){false;}else{throw "a condition failed";}return ["assign",a,b];});stdenv.register_macro("+=",make_assigner("+"));stdenv.register_macro("-=",make_assigner("-"));stdenv.register_macro("*=",make_assigner("*"));stdenv.register_macro("/=",make_assigner("/"));stdenv.register_macro("<<=",make_assigner("<<"));stdenv.register_macro(">>=",make_assigner(">>"));stdenv.register_macro(">>>=",make_assigner(">>>"));stdenv.register_macro("if",function(env,context,τ146){var τp0;var τp1;var τp2;var test;var a;var b;if((((τp0=τ146),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===4)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(test=τp0[1]),true,(a=τp0[2]),true,(b=τp0[3]),true))))))){false;}else{throw "a condition failed";}return ["if",test,a,b];});stdenv.register_macro("cond",function(env,context,τ147){var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var clauses;if((((τp0=τ147),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="data"))&&((τp2,true,(τp3=τp0[1]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===2)&&(((τp5=τp3[0]),(τp5==="code"))&&(τp5,true,(clauses=τp3[1]),true)))))))))))){false;}else{throw "a condition failed";}var handle=function(xs){if((xs.length===0)){return ["value",false];}else{if(true){var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var test;var body;var rest;if((((τp0=xs),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1>=1)&&(((τp2=τp0[0]),(τp2 instanceof Array))&&((τp2["#"]===undefined)&&(((τp3=τp2.length),true)&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="send"))&&((τp4,true,(τp5=τp2[1]),(τp5==="=>"))&&((τp5,true,(τp6=τp2[2]),(τp6 instanceof Array))&&((τp6["#"]===undefined)&&(((τp7=τp6.length),true)&&((τp7===3)&&(((τp8=τp6[0]),(τp8==="data"))&&(τp8,true,(test=τp6[1]),true,(body=τp6[2]),true,(rest=τp0.slice(1)),true))))))))))))))))){false;}else{throw "a condition failed";}(test=function(){var τ148=test;var τp0;if((((τp0=τ148),(τp0==="else"))&&(τp0,true))){return ["value",true];}else{if((τ148,true)){return test;}else{throw ["Could not find a match",τ148];}}}());return ["if",test,body,handle(rest)];}else{return false;}}};return handle(aslist(clauses));});stdenv.register_macro("while",function(env,context,expr){var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var test;var τp6;var τp7;var τp8;var body;if((((τp0=expr),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="data"))&&((τp2,true,(τp3=τp0[1]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===2)&&(((τp5=τp3[0]),(τp5==="code"))&&((τp5,true,(test=τp3[1]),true,(τp6=τp0[2]),(τp6 instanceof Array))&&((τp6["#"]===undefined)&&(((τp7=τp6.length),true)&&((τp7===2)&&(((τp8=τp6[0]),(τp8==="code"))&&(τp8,true,(body=τp6[1]),true))))))))))))))))){false;}else{throw "a condition failed";}return ["js_while",test,body];});stdenv.register_macro("for",function(env,context,expr){var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var τp8;var a;var b;var c;var τp9;var τp10;var τp11;var body;if((((τp0=expr),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="data"))&&((τp2,true,(τp3=τp0[1]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===2)&&(((τp5=τp3[0]),(τp5==="code"))&&((τp5,true,(τp6=τp3[1]),(τp6 instanceof Array))&&((τp6["#"]===undefined)&&(((τp7=τp6.length),true)&&((τp7===4)&&(((τp8=τp6[0]),(τp8==="multi"))&&((τp8,true,(a=τp6[1]),true,(b=τp6[2]),true,(c=τp6[3]),true,(τp9=τp0[2]),(τp9 instanceof Array))&&((τp9["#"]===undefined)&&(((τp10=τp9.length),true)&&((τp10===2)&&(((τp11=τp9[0]),(τp11==="code"))&&(τp11,true,(body=τp9[1]),true)))))))))))))))))))))){false;}else{throw "a condition failed";}return ["js_for",a,b,c,body];});stdenv.register_macro("return",function(env,context,expr){return ["js_return",expr];});stdenv.register_macro("throw",function(env,context,expr){return ["js_throw",expr];});stdenv.register_macro("break",function(env,context,expr){return ["js_break"];});stdenv.register_macro("continue",function(env,context,expr){return ["js_continue"];});var rx_wrap=function(x){return (("(?:"+x)+")");};var rx_quote=function(x){return x.replace(RegExp("([.?*+\\^$\\[\\]\\(\\)\\{\\}|\\\\])","g"),"\\$1");};var rx_quote2=function(x){return x.replace(RegExp("([\\[\\]\\(\\)\\{\\}\\^])","g"),"\\$1");};var rx_build=function(expr){var τ149=expr;var τp0;var τp0;var τp0;var τp0;var τp0;var τp0;var τp0;var τp0;var τp0;var τp0;var τp0;var τp0;var τp0;var τp0;var τp1;var τp2;var x;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var a;var b;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var a;var b;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var a;var τp7;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var a;var τp7;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var a;var τp7;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var b;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var τp7;var b;var τp0;var τp1;var τp2;var args;var τp0;var τp1;var τp2;var args;var otherA;var τ150;var τ151;var τ152;var τ153;var τ154;if((((τp0=τ149),(τp0==="any"))&&(τp0,true))){return ".";}else{if((((τp0=τ149),(τp0==="start"))&&(τp0,true))){return "^";}else{if((((τp0=τ149),(τp0==="end"))&&(τp0,true))){return "$";}else{if((((τp0=τ149),(τp0==="alpha"))&&(τp0,true))){return "\\a";}else{if((((τp0=τ149),(τp0==="digit"))&&(τp0,true))){return "\\d";}else{if((((τp0=τ149),(τp0==="word"))&&(τp0,true))){return "\\w";}else{if((((τp0=τ149),(τp0==="space"))&&(τp0,true))){return "\\s";}else{if((((τp0=τ149),(τp0==="boundary"))&&(τp0,true))){return "\\b";}else{if((((τp0=τ149),(τp0==="a"))&&(τp0,true))){return "\\a";}else{if((((τp0=τ149),(τp0==="d"))&&(τp0,true))){return "\\d";}else{if((((τp0=τ149),(τp0==="w"))&&(τp0,true))){return "\\w";}else{if((((τp0=τ149),(τp0==="s"))&&(τp0,true))){return "\\s";}else{if((((τp0=τ149),(τp0==="b"))&&(τp0,true))){return "\\b";}else{if(((τ150=((τp0=τ149),(τp0 instanceof Array)))&&((τ151=(τp0["#"]===undefined))&&((τ152=((τp1=τp0.length),true))&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="value"))&&(τp2,true,(x=τp0[1]),true))))))){return rx_quote(x);}else{if((τ152&&((τ153=(τp1===3))&&((τ154=((τp2=τp0[0]),(τp2==="send")))&&((τp2,true,(τp3=τp0[1]),(τp3==="||"))&&((τp3,true,(τp4=τp0[2]),(τp4 instanceof Array))&&((τp4["#"]===undefined)&&(((τp5=τp4.length),true)&&((τp5===3)&&(((τp6=τp4[0]),(τp6==="data"))&&(τp6,true,(a=τp4[1]),true,(b=τp4[2]),true))))))))))){return rx_wrap(((rx_build(a)+"|")+rx_build(b)));}else{if((τ154&&((τp2,true,(τp3=τp0[1]),(τp3==="or"))&&((τp3,true,(τp4=τp0[2]),(τp4 instanceof Array))&&((τp4["#"]===undefined)&&(((τp5=τp4.length),true)&&((τp5===3)&&(((τp6=τp4[0]),(τp6==="data"))&&(τp6,true,(a=τp4[1]),true,(b=τp4[2]),true))))))))){return rx_wrap(((rx_build(a)+"|")+rx_build(b)));}else{if((τ154&&((τp2,true,(τp3=τp0[1]),(τp3==="*"))&&((τp3,true,(τp4=τp0[2]),(τp4 instanceof Array))&&((τp4["#"]===undefined)&&(((τp5=τp4.length),true)&&((τp5===3)&&(((τp6=τp4[0]),(τp6==="data"))&&((τp6,true,(a=τp4[1]),true,(τp7=τp4[2]),(τp7===null))&&(τp7,true)))))))))){return rx_wrap((rx_build(a)+"*"));}else{if((τ154&&((τp2,true,(τp3=τp0[1]),(τp3==="+"))&&((τp3,true,(τp4=τp0[2]),(τp4 instanceof Array))&&((τp4["#"]===undefined)&&(((τp5=τp4.length),true)&&((τp5===3)&&(((τp6=τp4[0]),(τp6==="data"))&&((τp6,true,(a=τp4[1]),true,(τp7=τp4[2]),(τp7===null))&&(τp7,true)))))))))){return rx_wrap((rx_build(a)+"+"));}else{if((τ154&&((τp2,true,(τp3=τp0[1]),(τp3==="?"))&&((τp3,true,(τp4=τp0[2]),(τp4 instanceof Array))&&((τp4["#"]===undefined)&&(((τp5=τp4.length),true)&&((τp5===3)&&(((τp6=τp4[0]),(τp6==="data"))&&((τp6,true,(a=τp4[1]),true,(τp7=τp4[2]),(τp7===null))&&(τp7,true)))))))))){return rx_wrap((rx_build(a)+"?"));}else{if((τ154&&((τp2,true,(τp3=τp0[1]),(τp3===">>"))&&((τp3,true,(τp4=τp0[2]),(τp4 instanceof Array))&&((τp4["#"]===undefined)&&(((τp5=τp4.length),true)&&((τp5===3)&&(((τp6=τp4[0]),(τp6==="data"))&&((τp6,true,(τp7=τp4[1]),(τp7===null))&&(τp7,true,(b=τp4[2]),true)))))))))){var x=rx_quote2(b[1]);return (("["+x)+"]");}else{if((τ154&&((τp2,true,(τp3=τp0[1]),(τp3===">>!"))&&((τp3,true,(τp4=τp0[2]),(τp4 instanceof Array))&&((τp4["#"]===undefined)&&(((τp5=τp4.length),true)&&((τp5===3)&&(((τp6=τp4[0]),(τp6==="data"))&&((τp6,true,(τp7=τp4[1]),(τp7===null))&&(τp7,true,(b=τp4[2]),true)))))))))){var x=rx_quote2(b[1]);return (("[^"+x)+"]");}else{if((τ152&&((τ153=(τp1>=1))&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(args=τp0.slice(1)),true))))){return (("("+args.map(rx_build).join(""))+")");}else{if((τ153&&(((τp2=τp0[0]),(τp2==="multi"))&&(τp2,true,(args=τp0.slice(1)),true)))){return (("(?:"+args.map(rx_build).join(""))+")");}else{if(((otherA=τ149),true)){throw "OopsF";}else{throw ["Could not find a match",τ149];}}}}}}}}}}}}}}}}}}}}}}}}};stdenv.register_macro("Rx",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)]]];});stdenv.register_macro("Rxg",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)],["value","g"]]];});stdenv.register_macro("?",function(env,context,τ155){var τp0;var τp1;var τp2;var expr;var τp3;if((((τp0=τ155),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="data"))&&((τp2,true,(expr=τp0[1]),true,(τp3=τp0[2]),(τp3===null))&&(τp3,true)))))))){false;}else{throw "a condition failed";}var orig_expr=expr;var checker=function(){var τ156=expr;var τp0;var τp0;var τp0;var τp0;var τp0;var τp0;var τp0;var other;if((((τp0=τ156),(τp0===null))&&(τp0,true))){throw "can't use ? on its own";}else{if((((τp0=τ156),(τp0==="String"))&&(τp0,true))){var f=function(env,context,τ157){var τp0;var τp1;var τp2;var expr;if((((τp0=τ157),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(expr=τp0[1]),true))))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","string"]]];};return ["macro",f];}else{if((((τp0=τ156),(τp0==="Number"))&&(τp0,true))){var f=function(env,context,τ158){var τp0;var τp1;var τp2;var expr;if((((τp0=τ158),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(expr=τp0[1]),true))))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","number"]]];};return ["macro",f];}else{if((((τp0=τ156),(τp0==="true"))&&(τp0,true))){return ["macro",make_checker(["value",true],"___is")];}else{if((((τp0=τ156),(τp0==="false"))&&(τp0,true))){return ["macro",make_checker(["value",false],"___is")];}else{if((((τp0=τ156),(τp0==="null"))&&(τp0,true))){return ["macro",make_checker(["value",null],"___is")];}else{if((((τp0=τ156),(τp0==="undefined"))&&(τp0,true))){return ["macro",make_checker(["value",undefined],"___is")];}else{if(((other=τ156),true)){return ["send",["send","___lib",["value","checker"]],["data",expr]];}else{throw ["Could not find a match",τ156];}}}}}}}}}();var mac=function(env,context,expr){var τ159=context;var τp0;var other;if((((τp0=τ159),(τp0==="pattern"))&&(τp0,true))){var τ160=expr;var τp0;var τp1;var τp2;var subp;var other;if((((τp0=τ160),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1>=1)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(subp=τp0.slice(1)),true))))))){var projector=["send",["send","___lib",["value","deconstructor"]],["data",orig_expr]];return ["check",checker,["project",projector,expr]];}else{if(((other=τ160),true)){return ["check",checker,(expr||["ignore"])];}else{throw ["Could not find a match",τ160];}}}else{if(((other=τ159),true)){return ["send",checker,["data",expr]];}else{throw ["Could not find a match",τ159];}}};return ["macro",mac];});stdenv.register_macro("!",function(env,context,τ161){var τp0;var τp1;var τp2;var expr;var τp3;if((((τp0=τ161),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="data"))&&((τp2,true,(expr=τp0[1]),true,(τp3=τp0[2]),(τp3===null))&&(τp3,true)))))))){false;}else{throw "a condition failed";}var projector=function(){var τ162=expr;var τp0;var τp0;var τp0;var other;if((((τp0=τ162),(τp0===null))&&(τp0,true))){throw "can't use ! on its own";}else{if((((τp0=τ162),(τp0==="String"))&&(τp0,true))){var f=function(env,context,τ163){var τp0;var τp1;var τp2;var expr;if((((τp0=τ163),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(expr=τp0[1]),true))))))){false;}else{throw "a condition failed";}return ["data",["value",true],["send","String",["data",expr]]];};return ["macro",f];}else{if((((τp0=τ162),(τp0==="Number"))&&(τp0,true))){var f=function(env,context,τ164){var τp0;var τp1;var τp2;var expr;if((((τp0=τ164),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(expr=τp0[1]),true))))))){false;}else{throw "a condition failed";}return ["data",["value",true],["send","parseFloat",["data",expr]]];};return ["macro",f];}else{if(((other=τ162),true)){return ["send",["send","___lib",["value","projector"]],["data",expr]];}else{throw ["Could not find a match",τ162];}}}}}();var mac=function(env,context,expr){var τ165=context;var τp0;var other;if((((τp0=τ165),(τp0==="pattern"))&&(τp0,true))){return ["project",projector,(expr||["ignore"])];}else{if(((other=τ165),true)){return ["send",projector,["data",expr]];}else{throw ["Could not find a match",τ165];}}};return ["macro",mac];});var gensym_factory=function(prefix){(prefix=("τ"+prefix));var id=0;return function(){var name=(prefix+String(id));(id=(id+1));return name;};};var gensym=gensym_factory("");var parse_lhs=function(env,lhs,rhs,gen){(gen=(gen||gensym_factory("p")));var vars=[];var clauses=[];var current=["multi"];var mktemp=function(){var t=gen();vars.push(t);return t;};var newclause=function(){if((current.length>1)){clauses.push(current);}else{false;}return (current=["multi"]);};var helper=function(lhs,curr){return helper_noexpand(expand.step(env,"pattern",lhs),curr);};var helper_noexpand=function(lhs,curr){var helper_data=function(temp,specs){var fw=0;var bw=0;var rest=undefined;var members=specs.map(function(x){var v=expand.step(env,"pattern",x);var τ175=v;var τp0;var τp1;var τp2;var variable;var other;if((((τp0=τ175),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="dynsplice"))&&(τp2,true,(variable=τp0[1]),true))))))){(rest=variable);}else{if(((other=τ175),true)){if((rest===undefined)){(fw=(fw+1));}else{if(true){(bw=(bw+1));}else{false;}}}else{throw ["Could not find a match",τ175];}}return v;});var cmp=function(){if((rest===undefined)){return "___eq";}else{if(true){return "___gte";}else{return false;}}}();var len=mktemp();(current=current.concat([["assign",len,["send",temp,["value","length"]]],["value",true]]));newclause();(current=current.concat([["send",cmp,["data",len,["value",(fw+bw)]]]]));newclause();for(var j=0;(j<fw);(++j)){helper_noexpand(___lib.send(members,j),["send",temp,["value",j]]);}if((rest!==undefined)){var slice=function(){if((bw>0)){return ["data",["value",fw],["value",(-bw)]];}else{if(true){return ["data",["value",fw]];}else{return false;}}}();helper_noexpand(___lib.send(members,fw)[1],["send",["send",temp,["value","slice"]],slice]);}else{false;}for(var j=0;(j<bw);(++j)){helper_noexpand(___lib.send(members,((fw+j)+1)),["send",temp,["send","___minus",["data",len,["value",(bw-j)]]]]);}};var τ166=lhs;var τp0;var τp0;var τ168;var τ169;var τ170;var τ167;var τp0;var τp0;var τp1;var τp2;var v;var τp0;var τp1;var τp2;var condition;var pattern;var τp0;var τp1;var τp2;var xs;var τp0;var τp1;var τp2;var xs;var τp0;var τp1;var τp2;var checker;var expr;var τp0;var τp1;var τp2;var projector;var expr;var τp0;var τp1;var τp2;var fname;var spec;var τp0;var τp1;var τp2;var specs;var τp0;var τp1;var τp2;var specs;var other;var τ171;var τ172;var τ173;var τ174;if((((τp0=τ166),(τp0===null))&&(τp0,true))){var x=["check",["macro",make_checker(["value",null],"___eq")],["ignore"]];return helper_noexpand(x,curr);}else{if(((τp0=τ166),((((τ167=τp0),(τ167==="_"))&&(τ167,true))||(((τ168=τp0),(τ168 instanceof Array))&&((τ168["#"]===undefined)&&(((τ169=τ168.length),true)&&((τ169===1)&&(((τ170=τ168[0]),(τ170==="ignore"))&&(τ170,true))))))))){current.push(curr);return current.push(["value",true]);}else{if((((τp0=τ166),(typeof(τp0)==="string"))&&(τp0,true))){vars.push(lhs);current.push(["assign",lhs,curr]);return current.push(["value",true]);}else{if(((τ171=((τp0=τ166),(τp0 instanceof Array)))&&((τ172=(τp0["#"]===undefined))&&((τ173=((τp1=τp0.length),true))&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="value"))&&(τp2,true,(v=τp0[1]),true))))))){var x=["check",["macro",make_checker(lhs,"___eq")],["ignore"]];return helper_noexpand(x,curr);}else{if((τ173&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="test"))&&(τp2,true,(condition=τp0[1]),true,(pattern=τp0[2]),true))))){helper(pattern,curr);current.push(condition);return newclause();}else{if((τ173&&((τ174=(τp1>=1))&&(((τp2=τp0[0]),(τp2==="all"))&&(τp2,true,(xs=τp0.slice(1)),true))))){var temp=mktemp();(current=current.concat([["assign",temp,curr]]));return xs.forEach(function(x){return helper(x,temp);});}else{if((τ174&&(((τp2=τp0[0]),(τp2==="any"))&&(τp2,true,(xs=τp0.slice(1)),true)))){var normalize=function(vars){return vars.filter(function(x){return (x[0]!=="τ");}).sort().join(",");};var temp=mktemp();(current=current.concat([["assign",temp,curr]]));var myvars=undefined;var clauses=[];xs.forEach(function(x){var p=parse_lhs(env,x,temp,gensym);if((myvars===undefined)){(myvars=p[0]);}else{if((normalize(p[0])!==normalize(myvars))){throw [["Must have the same set of variables in both branches!",(("["+String(myvars))+"]"),(("["+String(p[0]))+"]")]];}else{if(true){(vars=vars.concat(p[0]));}else{false;}}}return clauses.push(make_pattern_test(p[1]));});current.push(make_or_pattern(clauses));(vars=vars.concat(myvars));return newclause();}else{if((τ173&&((τ174=(τp1===3))&&(((τp2=τp0[0]),(τp2==="check"))&&(τp2,true,(checker=τp0[1]),true,(expr=τp0[2]),true))))){var temp=mktemp();(current=current.concat([["assign",temp,curr],["send",checker,["data",temp]]]));newclause();return helper(expr,temp);}else{if((τ174&&(((τp2=τp0[0]),(τp2==="project"))&&(τp2,true,(projector=τp0[1]),true,(expr=τp0[2]),true)))){var temp=mktemp();var temp2=mktemp();(current=current.concat([["assign",temp,curr],["assign",temp2,["send",projector,["data",temp]]],["send",temp2,["value",0]]]));newclause();return helper(expr,["send",temp2,["value",1]]);}else{if((τ174&&(((τp2=τp0[0]),(τp2==="send"))&&(τp2,true,(fname=τp0[1]),true,(spec=τp0[2]),true)))){return helper(fname,["send","->",["data",spec,curr]]);}else{if((τ173&&((τ174=(τp1>=1))&&(((τp2=τp0[0]),(τp2==="duck"))&&(τp2,true,(specs=τp0.slice(1)),true))))){var temp=mktemp();(current=current.concat([["assign",temp,curr],["value",true]]));return helper_data(temp,specs);}else{if((τ174&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(specs=τp0.slice(1)),true)))){var temp=mktemp();(current=current.concat([["assign",temp,curr],["send","___instanceof",["data",temp,"Array"]]]));newclause();(current=current.concat([["send","___is",["data",["send",temp,["value","#"]],["value",undefined]]]]));newclause();return helper_data(temp,specs);}else{if(((other=τ166),true)){throw "OopsG";}else{throw ["Could not find a match",τ166];}}}}}}}}}}}}}};helper(lhs,rhs);if((current.length>1)){clauses.push(current);}else{false;}return [vars,clauses];};var make_declarations=function(vars){return vars.map(function(name){return ["declare",name,["value",undefined]];});};var make_pattern_test=function(clauses){var ands=clauses.pop();while((clauses.length>0)){(ands=["send","___and",["data",clauses.pop(),ands]]);}return ands;};var make_or_pattern=function(clauses){var ors=clauses.pop();while((clauses.length>0)){(ors=["send","___or",["data",clauses.pop(),ors]]);}return ors;};var same=function(a,b){var τ176=[a,b];var τp0;var τp1;var τp2;var x;var τp3;var y;var τp0;var τp1;var τp2;var τp3;var τp4;var x;var τp5;var τp6;var τp7;var y;var τp0;var τp1;var τp2;var τp3;var τp4;var x;var τp5;var τp6;var τp7;var y;var τp0;var τp1;var τp2;var τp3;var τp4;var f;var x;var τp5;var τp6;var τp7;var g;var y;var τp0;var τp1;var τp2;var τp3;var τp4;var xs;var τp5;var τp6;var τp7;var ys;var τp0;var τp1;var τp2;var τp3;var kind1;var xs;var τp4;var τp5;var kind2;var ys;var other;var τ177;var τ178;var τ179;var τ180;var τ181;var τ182;var τ183;var τ184;if(((τ177=((τp0=τ176),(τp0 instanceof Array)))&&((τ178=(τp0["#"]===undefined))&&((τ179=((τp1=τp0.length),true))&&((τ180=(τp1===2))&&(((τp2=τp0[0]),(typeof(τp2)==="string"))&&(((x=τp2),true,(τp3=τp0[1]),(typeof(τp3)==="string"))&&((y=τp3),true)))))))){return (x===y);}else{if((τ180&&((τ181=((τp2=τp0[0]),(τp2 instanceof Array)))&&((τ182=(τp2["#"]===undefined))&&((τ183=((τp3=τp2.length),true))&&((τ184=(τp3===2))&&(((τp4=τp2[0]),(τp4==="value"))&&((τp4,true,(x=τp2[1]),true,(τp5=τp0[1]),(τp5 instanceof Array))&&((τp5["#"]===undefined)&&(((τp6=τp5.length),true)&&((τp6===2)&&(((τp7=τp5[0]),(τp7==="value"))&&(τp7,true,(y=τp5[1]),true))))))))))))){return (x===y);}else{if((τ184&&(((τp4=τp2[0]),(τp4==="macro"))&&((τp4,true,(x=τp2[1]),true,(τp5=τp0[1]),(τp5 instanceof Array))&&((τp5["#"]===undefined)&&(((τp6=τp5.length),true)&&((τp6===2)&&(((τp7=τp5[0]),(τp7==="macro"))&&(τp7,true,(y=τp5[1]),true))))))))){return (x===y);}else{if((τ183&&((τp3===3)&&(((τp4=τp2[0]),(τp4==="send"))&&((τp4,true,(f=τp2[1]),true,(x=τp2[2]),true,(τp5=τp0[1]),(τp5 instanceof Array))&&((τp5["#"]===undefined)&&(((τp6=τp5.length),true)&&((τp6===3)&&(((τp7=τp5[0]),(τp7==="send"))&&(τp7,true,(g=τp5[1]),true,(y=τp5[2]),true)))))))))){return (same(f,g)&&same(x,y));}else{if((τ183&&((τ184=(τp3>=1))&&(((τp4=τp2[0]),(τp4==="multi"))&&((τp4,true,(xs=τp2.slice(1)),true,(τp5=τp0[1]),(τp5 instanceof Array))&&((τp5["#"]===undefined)&&(((τp6=τp5.length),true)&&((τp6>=1)&&(((τp7=τp5[0]),(τp7==="multi"))&&(τp7,true,(ys=τp5.slice(1)),true)))))))))){return xs.every(function(x,i){return same(x,___lib.send(ys,i));});}else{if((τ184&&(((kind1=τp2[0]),true,(xs=τp2.slice(1)),true,(τp4=τp0[1]),(τp4 instanceof Array))&&((τp4["#"]===undefined)&&(((τp5=τp4.length),true)&&((τp5>=1)&&((kind2=τp4[0]),true,(ys=τp4.slice(1)),true))))))){var allequal=xs.every(function(x,i){return same(x,___lib.send(ys,i));});return ((kind1===kind2)&&allequal);}else{if(((other=τ176),true)){return false;}else{throw ["Could not find a match",τ176];}}}}}}}};stdenv.register_macro("|>",function(env,context,τ185){var τp0;var τp1;var τp2;var to_match;var cl;if((((τp0=τ185),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="data"))&&(τp2,true,(to_match=τp0[1]),true,(cl=τp0[2]),true))))))){false;}else{throw "a condition failed";}var temp=gensym();var clauses=function(){var τ186=cl;var τp0;var τp1;var τp2;var cls;var other;if((((τp0=τ186),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1>=1)&&(((τp2=τp0[0]),(τp2==="multi"))&&(τp2,true,(cls=τp0.slice(1)),true))))))){return cls;}else{if(((other=τ186),true)){return [other];}else{throw ["Could not find a match",τ186];}}}();var cached_conditions=[];var stmts=["multi",["declare",temp,to_match]];(clauses=clauses.map(function(clause){var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var lhs;var body;if((((τp0=clause),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="send"))&&((τp2,true,(τp3=τp0[1]),(τp3==="->"))&&((τp3,true,(τp4=τp0[2]),(τp4 instanceof Array))&&((τp4["#"]===undefined)&&(((τp5=τp4.length),true)&&((τp5===3)&&(((τp6=τp4[0]),(τp6==="data"))&&(τp6,true,(lhs=τp4[1]),true,(body=τp4[2]),true))))))))))))){false;}else{throw "a condition failed";}var τp0;var τp1;var decls;var conditions;if((((τp0=parse_lhs(env,lhs,temp)),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((decls=τp0[0]),true,(conditions=τp0[1]),true)))))){false;}else{throw "a condition failed";}(stmts=stmts.concat(make_declarations(decls)));var f=function(x){return ["done",expand(env,"expr",x)];};return [conditions.map(f),body];}));var shares=function(){var f=function(τ187,i){var τp0;var τp1;var conditions;var body;if((((τp0=τ187),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((conditions=τp0[0]),true,(body=τp0[1]),true)))))){false;}else{throw "a condition failed";}var res=0;var prev_conditions=___lib.send(clauses,i)[0];var nc=conditions.length;for(var j=0;((j<nc)&&same(___lib.send(conditions,j),___lib.send(prev_conditions,j)));(j++)){(res++);}return res;};return clauses.slice(1).map(f);}();var max=___lib.send(Math.max,shares);shares.push(0);var vars=[];for(var i=0;(i<max);(i++)){vars.push(gensym());}(stmts=stmts.concat(make_declarations(vars)));var shared_last=0;var new_clauses=clauses.map(function(τ188,i){var τp0;var τp1;var conditions;var body;if((((τp0=τ188),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((conditions=τp0[0]),true,(body=τp0[1]),true)))))){false;}else{throw "a condition failed";}var shared=function(){if(shared_last){return [___lib.send(vars,(shared_last-1))];}else{return [];}}();var n_to_share=Math.max(shared_last,___lib.send(shares,i));var to_share=conditions.slice(shared_last,n_to_share).map(function(x,j){return ["assign",___lib.send(vars,(shared_last+j)),x];});(shared_last=___lib.send(shares,i));var rest=conditions.slice(n_to_share);return [shared.concat(to_share).concat(rest),body];});(clauses=new_clauses);var r=["js_throw",["data",["value","Could not find a match"],temp]];while((clauses.length>0)){var τp0;var τp1;var conditions;var body;if((((τp0=clauses.pop()),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===2)&&((conditions=τp0[0]),true,(body=τp0[1]),true)))))){false;}else{throw "a condition failed";}var test=make_pattern_test(conditions);(r=["if",test,body,r]);}stmts.push(r);return stmts;});var js_op_table=({"___plus":"+","___minus":"-","___times":"*","___div":"/","___mod":"%","___binxor":"^","___binand":"&","___binor":"|","___binnot":"~","___and":"&&","___or":"||","___not":"!","___is":"===","___isnt":"!==","___eq":"===","___neq":"!==","___lt":"<","___gt":">","___lte":"<=","___gte":">=","___shl":"<<","___shr":">>","___shr2":">>>","___in":" in ","___instanceof":" instanceof ","___plusplus":"++","___minusminus":"--"});var translate=function(expr,mode){var τ189=expr;var τp0;var τp0;var τp0;var τp1;var τp2;var v;var τp0;var τp1;var τp2;var bindings;var body;var τp0;var τp1;var τp2;var test;var pos;var neg;var τp0;var τp1;var τp2;var test;var body;var τp0;var τp1;var τp2;var x;var y;var z;var body;var τp0;var τp1;var τp2;var binding;var τp3;var τp4;var τp5;var τp6;var τp0;var τp1;var τp2;var binding;var value;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var obj;var msg;var rhs;var τp0;var τp1;var τp2;var lhs;var rhs;var τp0;var τp1;var τp2;var args;var τp0;var τp1;var τp2;var args;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var τp0;var τp1;var τp2;var value;var τp0;var τp1;var τp2;var value;var τp0;var τp1;var τp2;var args;var τp0;var τp1;var τp2;var args;var τp0;var τp1;var τp2;var f;var τp3;var msg;var τp4;var τp5;var τp6;var s;var τp0;var τp1;var τp2;var τp3;var τp4;var τp5;var τp6;var f;var msg;var τp0;var τp1;var τp2;var f;var τp3;var τp4;var τp5;var args;var τp0;var τp1;var τp2;var f;var msg;var other;var τ190;var τ191;var τ192;var τ193;var τ194;if((((τp0=τ189),(typeof(τp0)==="string"))&&(τp0,true))){return translate.expr(translate.mangle(expr),mode);}else{if((((τp0=τ189),(τp0===null))&&(τp0,true))){return translate.expr("null",mode);}else{if(((τ190=((τp0=τ189),(τp0 instanceof Array)))&&((τ191=(τp0["#"]===undefined))&&((τ192=((τp1=τp0.length),true))&&((τp1===2)&&(((τp2=τp0[0]),(τp2==="value"))&&(τp2,true,(v=τp0[1]),true))))))){var r=function(){var τ195=v;var τp0;var τp0;var τ203;var τ196;var τ202;var τ197;var τ201;var τ198;var τ200;var τ199;var other;if((((τp0=τ195),(typeof(τp0)==="string"))&&(τp0,true))){var repl=({"\"":"\\\"","\n":"\\n","\\":"\\\\"});(v=v.replace(RegExp("((?:(?:\"|\\\\)|\n))","g"),function(m){return ___lib.send(repl,m);}));return (("\""+v)+"\"");}else{if(((τp0=τ195),(((τ196=τp0),(((τ197=τ196),(((τ198=τ197),((((τ199=τ198),(typeof(τ199)==="number"))&&(τ199,true))||(((τ200=τ198),(τ200===true))&&(τ200,true))))||(((τ201=τ197),(τ201===false))&&(τ201,true))))||(((τ202=τ196),(τ202===null))&&(τ202,true))))||(((τ203=τp0),(τ203===undefined))&&(τ203,true))))){return String(v);}else{if(((other=τ195),true)){return (("?!?["+v)+"]?!?");}else{throw ["Could not find a match",τ195];}}}}();return translate.expr(r,mode);}else{if((τ192&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="lambda"))&&(τp2,true,(bindings=τp0[1]),true,(body=τp0[2]),true))))){var a=bindings.join(",");var b=translate.body(body,"return");return translate.expr((((("function("+a)+"){")+b)+"}"),mode);}else{if((τ192&&((τp1===4)&&(((τp2=τp0[0]),(τp2==="if"))&&(τp2,true,(test=τp0[1]),true,(pos=τp0[2]),true,(neg=τp0[3]),true))))){var τ204=mode;var τp0;var other;if((((τp0=τ204),(τp0==="expr"))&&(τp0,true))){return translate.body(expr,"expr");}else{if(((other=τ204),true)){var a=translate(test,"expr");var b=translate(pos,mode);var c=translate(neg,mode);return (((((("if("+a)+"){")+b)+"}else{")+c)+"}");}else{throw ["Could not find a match",τ204];}}}else{if((τ192&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="js_while"))&&(τp2,true,(test=τp0[1]),true,(body=τp0[2]),true))))){var τ205=mode;var τp0;var other;if((((τp0=τ205),(τp0==="expr"))&&(τp0,true))){return translate.body(expr,"expr");}else{if(((other=τ205),true)){var a=translate(test,"expr");var b=translate(body,"stmt");return (((("while("+a)+"){")+b)+"}");}else{throw ["Could not find a match",τ205];}}}else{if((τ192&&((τp1===5)&&(((τp2=τp0[0]),(τp2==="js_for"))&&(τp2,true,(x=τp0[1]),true,(y=τp0[2]),true,(z=τp0[3]),true,(body=τp0[4]),true))))){var τ206=mode;var τp0;var other;if((((τp0=τ206),(τp0==="expr"))&&(τp0,true))){return translate.body(expr,"expr");}else{if(((other=τ206),true)){var a=translate(x,"stmt");var b=translate(y,"stmt");var c=translate(z,"expr");var d=translate(body,"stmt");return (((((("for("+a)+b)+c)+"){")+d)+"}");}else{throw ["Could not find a match",τ206];}}}else{if((τ192&&((τ193=(τp1===3))&&((τ194=((τp2=τp0[0]),(τp2==="declare")))&&((τp2,true,(binding=τp0[1]),true,(τp3=τp0[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===2)&&(((τp5=τp3[0]),(τp5==="value"))&&((τp5,true,(τp6=τp3[1]),(τp6===undefined))&&(τp6,true))))))))))){var τ207=mode;var τp0;var τ209;var τ208;var other;if(((τp0=τ207),((((τ208=τp0),(τ208==="expr"))&&(τ208,true))||(((τ209=τp0),(τ209==="return"))&&(τ209,true))))){throw "Invalid in expr ctx";}else{if(((other=τ207),true)){var a=translate(binding,"expr");return (("var "+a)+";");}else{throw ["Could not find a match",τ207];}}}else{if((τ194&&(τp2,true,(binding=τp0[1]),true,(value=τp0[2]),true))){var τ210=mode;var τp0;var τ212;var τ211;var other;if(((τp0=τ210),((((τ211=τp0),(τ211==="expr"))&&(τ211,true))||(((τ212=τp0),(τ212==="return"))&&(τ212,true))))){throw "Invalid in expr ctx";}else{if(((other=τ210),true)){var a=translate(binding,"expr");var b=translate(value,"expr");return (((("var "+a)+"=")+b)+";");}else{throw ["Could not find a match",τ210];}}}else{if((τ193&&((τ194=((τp2=τp0[0]),(τp2==="assign")))&&((τp2,true,(τp3=τp0[1]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4===3)&&(((τp5=τp3[0]),(τp5==="send"))&&(τp5,true,(obj=τp3[1]),true,(msg=τp3[2]),true,(rhs=τp0[2]),true))))))))){var a=translate(obj,"expr");var b=translate(msg,"expr");var c=translate(rhs,"expr");return translate.expr((((((("("+a)+"[")+b)+"]=")+c)+")"),mode);}else{if((τ194&&(τp2,true,(lhs=τp0[1]),true,(rhs=τp0[2]),true))){var a=translate(lhs,"expr");var b=translate(rhs,"expr");return translate.expr((((("("+a)+"=")+b)+")"),mode);}else{if((τ192&&((τ193=(τp1>=1))&&(((τp2=τp0[0]),(τp2==="multi"))&&(τp2,true,(args=τp0.slice(1)),true))))){var isdecl=function(x){var τ213=x;var τp0;var τp1;var τp2;var variable;var value;var other;if((((τp0=τ213),(τp0 instanceof Array))&&((τp0["#"]===undefined)&&(((τp1=τp0.length),true)&&((τp1===3)&&(((τp2=τp0[0]),(τp2==="declare"))&&(τp2,true,(variable=τp0[1]),true,(value=τp0[2]),true))))))){return true;}else{if(((other=τ213),true)){return false;}else{throw ["Could not find a match",τ213];}}};if((args.length===1)){return translate(args[0],mode);}else{if(((mode==="expr")&&(!args.some(isdecl)))){var xs=args.map(function(x){return translate(x,"expr");});return (("("+xs.join(","))+")");}else{if(true){return translate.body(expr,mode);}else{return false;}}}}else{if((τ193&&(((τp2=τp0[0]),(τp2==="splice"))&&(τp2,true,(args=τp0.slice(1)),true)))){return translate(["multi"].concat(args),mode);}else{if((τ192&&((τ193=(τp1===1))&&(((τp2=τp0[0]),(τp2==="js_break"))&&(τp2,true))))){if((mode==="expr")){throw "Invalid break in ctx";}else{if(true){return "break;";}else{return false;}}}else{if((τ193&&(((τp2=τp0[0]),(τp2==="js_continue"))&&(τp2,true)))){if((mode==="expr")){throw "Invalid continue in ctx";}else{if(true){return "continue;";}else{return false;}}}else{if((τ192&&((τ193=(τp1===2))&&(((τp2=τp0[0]),(τp2==="js_return"))&&(τp2,true,(value=τp0[1]),true))))){if((mode==="expr")){throw "Invalid return in ctx";}else{if(true){return (("return "+translate(value,"expr"))+";");}else{return false;}}}else{if((τ193&&(((τp2=τp0[0]),(τp2==="js_throw"))&&(τp2,true,(value=τp0[1]),true)))){if(true){return (("throw "+translate(value,"expr"))+";");}else{return false;}}else{if((τ192&&((τ193=(τp1>=1))&&(((τp2=τp0[0]),(τp2==="array"))&&(τp2,true,(args=τp0.slice(1)),true))))){var r=function(){var f=function(x){return translate(x,"expr");};return (("["+args.map(f).join(","))+"]");}();return translate.expr(r,mode);}else{if((τ193&&(((τp2=τp0[0]),(τp2==="object"))&&(τp2,true,(args=τp0.slice(1)),true)))){var r=function(){var f=function(x){var a=translate(x[1],"expr");var b=translate(x[2],"expr");return ((a+":")+b);};return (("({"+args.map(f).join(","))+"})");}();return translate.expr(r,mode);}else{if((τ192&&((τ193=(τp1===3))&&((τ194=((τp2=τp0[0]),(τp2==="send")))&&((τp2,true,(f=τp0[1]),true,(τp3=τp0[2]),(msg=τp3),true,(τp4=τp3),(τp4 instanceof Array))&&((τp4["#"]===undefined)&&(((τp5=τp4.length),true)&&((τp5===2)&&(((τp6=τp4[0]),(τp6==="value"))&&(τp6,true,(s=τp4[1]),true)))))))))){if(((typeof(s)==="string")&&s.match(RegExp("(?:^(?:[a-zA-Z_$]+)$)")))){var trf=translate(f,"expr");var trmsg=translate(s,"expr");return translate.expr(((trf+".")+trmsg),mode);}else{if(true){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{return false;}}}else{if((τ194&&((τp2,true,(τp3=τp0[1]),(τp3==="___js_fetch"))&&((τp3,true,(τp4=τp0[2]),(τp4 instanceof Array))&&((τp4["#"]===undefined)&&(((τp5=τp4.length),true)&&((τp5===3)&&(((τp6=τp4[0]),(τp6==="array"))&&(τp6,true,(f=τp4[1]),true,(msg=τp4[2]),true))))))))){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{if((τ194&&((τp2,true,(f=τp0[1]),true,(τp3=τp0[2]),(τp3 instanceof Array))&&((τp3["#"]===undefined)&&(((τp4=τp3.length),true)&&((τp4>=1)&&(((τp5=τp3[0]),(τp5==="array"))&&(τp5,true,(args=τp3.slice(1)),true)))))))){var op=((typeof(f)==="string")&&___lib.send(js_op_table,f));if(op){return translate.expr(translate.op(op,args[0],args[1]),mode);}else{if(true){var trf=translate(f,"expr");var trargs=args.map(function(x){return translate(x,"expr");});return translate.expr((((trf+"(")+trargs.join(","))+")"),mode);}else{return false;}}}else{if((τ194&&(τp2,true,(f=τp0[1]),true,(msg=τp0[2]),true))){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((("___lib.send("+trf)+",")+trmsg)+")"),mode);}else{if(((other=τ189),true)){throw other;}else{throw ["Could not find a match",τ189];}}}}}}}}}}}}}}}}}}}}}}}}};(translate["mangle"]=function(name){var tr=({"+":"__plus__","-":"__minus__","*":"__asterisk__","/":"__slash__","%":"__percent__","^":"__caret__","#":"__hash__","&":"__amp__","|":"__pipe__","@":"__at__","!":"__bang__","?":"__qmark__","=":"__equal__","<":"__lt__",">":"__gt__","~":"__tilde__",".":"__dot__"});var r=[];for(var i=0;(i<name.length);(++i)){var c=___lib.send(name,i);r.push((___lib.send(tr,c)||c));}return r.join("");});(translate["body"]=function(b,mode){(orig=b);(b=aslist(b));var trst=function(stmt){return translate(stmt,"stmt");};var τ214=mode;var τp0;var τp0;var τp0;var other;if((((τp0=τ214),(τp0==="expr"))&&(τp0,true))){var x=["send",["lambda",[],orig],["array"]];return translate(x,mode);}else{if((((τp0=τ214),(τp0==="return"))&&(τp0,true))){var stmts=b.slice(0,(-1));var ret=___lib.send(b,(b.length-1));return (stmts.map(trst).join("")+translate(ret,"return"));}else{if((((τp0=τ214),(τp0==="stmt"))&&(τp0,true))){return b.map(trst).join("");}else{if(((other=τ214),true)){throw "OopsH";}else{throw ["Could not find a match",τ214];}}}}});(translate["expr"]=function(x,mode){var τ215=mode;var τp0;var τp0;var τp0;var other;if((((τp0=τ215),(τp0==="expr"))&&(τp0,true))){return x;}else{if((((τp0=τ215),(τp0==="stmt"))&&(τp0,true))){return (x+";");}else{if((((τp0=τ215),(τp0==="return"))&&(τp0,true))){return (("return "+x)+";");}else{if(((other=τ215),true)){throw "OopsI";}else{throw ["Could not find a match",τ215];}}}}});(translate["op"]=function(op,a,b){(e=function(){if((a===null)){return (op+translate(b,"expr"));}else{if((b===null)){return (translate(a,"expr")+op);}else{if(true){return ((translate(a,"expr")+op)+translate(b,"expr"));}else{return false;}}}}());return (("("+e)+")");});var fs=require("fs");var file=process.argv[2];var f=function(err,data){var p=parse(data);var ex=expand(stdenv,"top",["multi",p]);var prelude="var ___lib=require(\"./lib\");";return console.log((prelude+translate(ex,"stmt")));};fs.readFile(file,"utf8",f);
