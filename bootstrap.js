var ___lib=require("./lib");var special_ops=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",":":"IFX",".":"PFX"});var regexps=function(){var id=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))");var id_f=function(m,wsb,wsa,last_op){return ["ID","ID",m[0]];};var num=RegExp("(?:^((?:\\d+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:\\d+)))?))");var num_f=function(m,wsb,wsa,last_op){return ["ID","NUM",m[0]];};var str=RegExp("(?:^\"((?:(?:(?:\\\\\\\\|\\\\\")|[^\"])*))\")");var str_f=function(m,wsb,wsa,last_op){var repl=({"\\\"":"\"","\\\\":"\\","\\n":"\n"});var r=m[1].replace(RegExp("((?:(?:\\\\\"|\\\\\\\\)|\\\\n))","g"),function(m){return repl[m];});return ["ID","STR",r];};var op=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!#.:]+))");var op2=RegExp("(?:^[\\(\\[\\{\\}\\]\\),])");var op3=RegExp("(?:^(?:(?:(?:(?:(?:with|where)|and)|or)|in)|instanceof)\\b)");var op_f=function(m,wsb,wsa,last_op){var op=m[0];if((op in special_ops)){var fixity=special_ops[op];var width=function(){var other;var _tmp0;var _tmp1;var _tmp2;if(((_tmp2=fixity),(_tmp2=="IFX"))){if((wsb||wsa)){return "wide";}else{return "short";}}else{if(((_tmp1=fixity),(_tmp1=="SFX"))){if(wsb){return "wide";}else{return "short";}}else{if(((_tmp0=fixity),(_tmp0=="PFX"))){if(wsa){return "wide";}else{return "short";}}else{if(((other=fixity),true)){throw "OopsA";}else{throw "Could not find a match";}}}}}();return ["OP",fixity,width,op];}else{if((wsa&&wsb)){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "IFX";}else{return false;}}}(),"wide",op];}else{if(((!wsa)&&(!wsb))){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "IFX";}else{return false;}}}(),"short",op];}else{if(wsa){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "SFX";}else{return false;}}}(),"short",op];}else{if(wsb){return ["OP","PFX","short",op];}else{if(true){return ["OP","PFX","short",op];}else{return false;}}}}}}};var indent=RegExp("(?:^(?:(?:\n((?: *)))+))");var indent_f=function(m,wsb,wsa,last_op){var ilen=m[1].length;return ["INDENT",ilen];};var cmnt=RegExp("(?:^;(?:[^\n]*))");var cmnt_f=function(m,wsb,wsa,last_op){return ["IGNORE"];};var unkn=RegExp("(?:^.)");var unkn_f=function(m,wsb,wsa,last_op){throw ("unknown character: "+m[0]);};return [[op3,op_f],[id,id_f],[num,num_f],[str,str_f],[op,op_f],[op2,op_f],[indent,indent_f],[cmnt,cmnt_f],[unkn,unkn_f]];}();var ws_re=RegExp("(?:(?: *)(?:(?:\n(?: *)\\\\(?: *))*))");var eol_re=RegExp("(?:^(?: *)(?:\n|$))");var indent_tracker=function(){var curr=false;var stack=[];var stacks=[stack];return function(token){var other;var _tmp3;var _tmp4;var _tmp5;var fixity;var width;var _tmp6;var _tmp8;var _tmp7;var _tmp9;var _tmp10;var _tmp11;var fixity;var width;var _tmp12;var _tmp14;var _tmp13;var _tmp15;var _tmp16;var _tmp17;var stuff;var _tmp18;var _tmp19;var _tmp20;var new_indent;if((((_tmp18=token),(_tmp18 instanceof Array))&&(((_tmp19=_tmp18.length),(_tmp19==2))&&(((_tmp20=_tmp18[0]),(_tmp20=="INDENT"))&&((new_indent=_tmp18[1]),true))))){if((curr===false)){(curr=new_indent);return [["OP","IFX","wide",","]];}else{if((new_indent>curr)){stack.push(curr);(curr=new_indent);return [["OP","PFX","wide","["]];}else{if((new_indent==curr)){return [["OP","IFX","wide",","]];}else{if((new_indent<curr)){var rval=[];while(((stack.length>0)&&(new_indent<curr))){(curr=stack.pop());rval.push(["OP","SFX","wide","]"]);}rval.push(["OP","IFX","wide",","]);return rval;}else{if(true){throw [curr,new_indent];}else{return false;}}}}}}else{if((((_tmp15=token),(_tmp15 instanceof Array))&&(((_tmp16=_tmp15.length),(_tmp16>=1))&&(((_tmp17=_tmp15[0]),(_tmp17=="ID"))&&((stuff=_tmp15.slice(1)),true))))){return [token];}else{if((((_tmp9=token),(_tmp9 instanceof Array))&&(((_tmp10=_tmp9.length),(_tmp10==4))&&(((_tmp11=_tmp9[0]),(_tmp11=="OP"))&&((fixity=_tmp9[1]),true,(width=_tmp9[2]),true,(_tmp12=_tmp9[3]),(((_tmp13=_tmp12),(_tmp13=="["))||((_tmp14=_tmp12),(_tmp14=="{")))))))){stack.push(curr);stacks.push(stack);(stack=[]);(curr=false);return [token];}else{if((((_tmp3=token),(_tmp3 instanceof Array))&&(((_tmp4=_tmp3.length),(_tmp4==4))&&(((_tmp5=_tmp3[0]),(_tmp5=="OP"))&&((fixity=_tmp3[1]),true,(width=_tmp3[2]),true,(_tmp6=_tmp3[3]),(((_tmp7=_tmp6),(_tmp7=="]"))||((_tmp8=_tmp6),(_tmp8=="}")))))))){var rval=stack.map(function(x){return ["OP","SFX","short","]"];});(stack=stacks.pop());(curr=stack.pop());rval.push(token);return rval;}else{if(((other=token),true)){return [token];}else{throw "Could not find a match";}}}}}};};var process_token=function(token,last_op,wsa,wsb,pos,endpos,accum){var _tmp21;var _tmp22;var type;var result;if((((_tmp21=token),(_tmp21 instanceof Array))&&(((_tmp22=_tmp21.length),(_tmp22>=1))&&((type=_tmp21[0]),true,(result=_tmp21.slice(1)),true)))){false;}else{throw "a condition failed";}var other;var _tmp23;var _tmp24;var _tmp25;if(((_tmp25=type),(_tmp25=="IGNORE"))){return last_op;}else{if(((_tmp24=type),(_tmp24=="ID"))){if((!last_op)){var w=["IFX",function(){if((wsa||wsb)){return "wide";}else{return "short";}}(),"WHITE"];(w.location=[pos,pos]);accum.push(w);}else{false;}accum.push(result);return false;}else{if(((_tmp23=type),(_tmp23=="OP"))){if(last_op){var v=["VOID"];(v.location=[pos,pos]);accum.push(v);}else{false;}var _tmp26;var _tmp27;var _tmp28;if(((_tmp28=result[0]),(_tmp28=="IFX"))){accum.push(result);return true;}else{if(((_tmp27=result[0]),(_tmp27=="PFX"))){if((!last_op)){var w=["IFX",function(){if((wsa||wsb)){return "wide";}else{return "short";}}(),"WHITE"];(w.location=[pos,pos]);var v=["VOID"];(v.location=[pos,pos]);accum.push(w);accum.push(v);}else{false;}accum.push(result);return true;}else{if(((_tmp26=result[0]),(_tmp26=="SFX"))){accum.push(result);var v=["VOID"];(v.location=[endpos,endpos]);accum.push(v);return false;}else{throw "Could not find a match";}}}}else{if(((other=type),true)){throw "OopsB";}else{throw "Could not find a match";}}}}};var tokenize=function(text){var last_op=true;var results=[];var wsb=text.match(ws_re)[0].length;(text=text.slice(wsb));(pos=wsb);var indent=indent_tracker();while(text){for(var i=0;(i<regexps.length);(++i)){var _tmp29;var _tmp30;var re;var fn;if((((_tmp29=regexps[i]),(_tmp29 instanceof Array))&&(((_tmp30=_tmp29.length),(_tmp30==2))&&((re=_tmp29[0]),true,(fn=_tmp29[1]),true)))){false;}else{throw "a condition failed";}var m=text.match(re);if(m){var skip=m[0].length;var endpos=(pos+skip);(text=text.slice(skip));var wsa=text.match(ws_re)[0].length;var eol=(text.match(eol_re)&&true);var token=fn(m,(wsb>0),function(){if(eol){return (wsb>0);}else{return (wsa>0);}}(),last_op);var tokens=indent(token);tokens.forEach(function(x){return (last_op=process_token(x,last_op,wsa,wsb,pos,endpos,results));});(text=text.slice(wsa));(wsb=wsa);(pos=(endpos+wsa));break;}else{false;}}}if(last_op){var v=["VOID"];(v.location=[pos,pos]);results.push(v);}else{false;}return results;};var MAX=(1/0);var order_map=({"IFX":({"wide":({"default":[900,901],"WHITE":[1000,1001],",":[5,5],"with":[11,10],"where":[11,10],"->":[11,10],"=>":[11,10],"=":[11,10],":=":[11,10],"+":[300,301],"*":[400,401],"**":[501,500],":":[1001,6]}),"short":({"default":[1900,1901],"WHITE":[2000,2001],",":[5,5],":":[1001,6]})}),"PFX":({"wide":({"default":[MAX,900],".":[MAX,3000],"#":[MAX,3000],"(":[MAX,5],"[":[MAX,5],"{":[MAX,5]}),"short":({"default":[MAX,1900],".":[MAX,3000],"#":[MAX,3000],"(":[MAX,5],"[":[MAX,5],"{":[MAX,5]})}),"SFX":({"wide":({"default":[901,MAX],")":[5,MAX],"]":[5,MAX],"}":[5,MAX]}),"short":({"default":[1901,MAX],")":[5,MAX],"]":[5,MAX],"}":[5,MAX]})})});var DONE=(-1);var NONE=0;var LEFT=1;var RIGHT=2;var BOTH=3;var oparse=function(next,order,finalize){var between=finalize(next());var right_op=next();var stack=[];var left_op=null;var current=null;while(true){var o=function(){if(((!left_op)&&(!right_op))){return DONE;}else{if(true){return ((((!left_op)&&RIGHT)||((!right_op)&&LEFT))||order(left_op,right_op));}else{return false;}}}();var other;var _tmp31;var _tmp32;var _tmp33;var _tmp34;var _tmp35;if(((_tmp35=o),(_tmp35==DONE))){return between;}else{if(((_tmp34=o),(_tmp34==LEFT))){current.push(between);(between=finalize(current));var v=stack.pop();(left_op=v[0]);(current=v[1]);}else{if(((_tmp33=o),(_tmp33==RIGHT))){stack.push([left_op,current]);(left_op=right_op);(current=[[right_op],between]);(between=finalize(next()));(right_op=next());}else{if(((_tmp32=o),(_tmp32==BOTH))){current[0].push(right_op);current.push(between);(left_op=right_op);(between=finalize(next()));(right_op=next());}else{if(((_tmp31=o),(_tmp31==NONE))){throw ((("Undefined priority between "+left_op)+" and ")+right_op);}else{if(((other=o),true)){throw "OopsC";}else{throw "Could not find a match";}}}}}}}};var consult=function(o){var other;var _tmp36;var _tmp37;var fixity;var width;var op;var _tmp38;var _tmp39;var fixity;var width;var _tmp40;var n;if((((_tmp38=o),(_tmp38 instanceof Array))&&(((_tmp39=_tmp38.length),(_tmp39==3))&&(((fixity=_tmp38[0]),true,(width=_tmp38[1]),true,(_tmp40=_tmp38[2]),(typeof(_tmp40)=="number"))&&((n=_tmp40),true))))){var p=(5-(1/(n+1)));return [p,p];}else{if((((_tmp36=o),(_tmp36 instanceof Array))&&(((_tmp37=_tmp36.length),(_tmp37==3))&&((fixity=_tmp36[0]),true,(width=_tmp36[1]),true,(op=_tmp36[2]),true)))){var map=order_map[fixity][width];return (map[op]||map.default);}else{if(((other=o),true)){throw "OopsD";}else{throw "Could not find a match";}}}};var order=function(o1,o2){var ord1=consult(o1)[1];var ord2=consult(o2)[0];if((ord1>ord2)){return LEFT;}else{if((ord1<ord2)){return RIGHT;}else{if((ord1==ord2)){return BOTH;}else{return false;}}}};var finalize=function(x){var other;var _tmp41;var _tmp42;var ops;var args;var _tmp43;var _tmp44;var _tmp45;var _tmp46;var _tmp47;var _tmp48;var value;var _tmp49;var _tmp50;var _tmp51;var value;var _tmp52;var _tmp53;var _tmp54;var value;if((((_tmp52=x),(_tmp52 instanceof Array))&&(((_tmp53=_tmp52.length),(_tmp53==2))&&(((_tmp54=_tmp52[0]),(_tmp54=="ID"))&&((value=_tmp52[1]),true))))){return value;}else{if((((_tmp49=x),(_tmp49 instanceof Array))&&(((_tmp50=_tmp49.length),(_tmp50==2))&&(((_tmp51=_tmp49[0]),(_tmp51=="NUM"))&&((value=_tmp49[1]),true))))){return ["value",parseFloat(value)];}else{if((((_tmp46=x),(_tmp46 instanceof Array))&&(((_tmp47=_tmp46.length),(_tmp47==2))&&(((_tmp48=_tmp46[0]),(_tmp48=="STR"))&&((value=_tmp46[1]),true))))){return ["value",value];}else{if((((_tmp43=x),(_tmp43 instanceof Array))&&(((_tmp44=_tmp43.length),(_tmp44==1))&&((_tmp45=_tmp43[0]),(_tmp45=="VOID"))))){return null;}else{if((((_tmp41=x),(_tmp41 instanceof Array))&&(((_tmp42=_tmp41.length),(_tmp42>=1))&&((ops=_tmp41[0]),true,(args=_tmp41.slice(1)),true)))){(ops=ops.map(function(o){return o[2];}));var op=ops[0];var other;var _tmp55;var _tmp56;var _tmp57;var _tmp58;var _tmp59;var _tmp60;var a;var b;var _tmp61;var _tmp62;var _tmp63;var _tmp64;var _tmp65;var _tmp66;var _tmp67;var _tmp68;var _tmp69;var _tmp70;var _tmp71;var _tmp72;var _tmp73;var _tmp74;var _tmp75;var _tmp76;var _tmp77;var _tmp78;var _tmp79;var _tmp80;var _tmp81;var _tmp82;var _tmp83;var _tmp85;var _tmp84;var _tmp86;var _tmp87;var _tmp88;var _tmp89;var _tmp90;var _tmp91;var _tmp92;var target;var body;var _tmp93;var _tmp94;var _tmp95;var _tmp96;var _tmp97;var _tmp98;var _tmp99;var f;var body;var _tmp100;var _tmp101;var _tmp102;var _tmp103;var _tmp104;var _tmp105;var _tmp106;var _tmp107;var f;var arg;var body;if((((_tmp100=[ops,args]),(_tmp100 instanceof Array))&&(((_tmp101=_tmp100.length),(_tmp101==2))&&(((_tmp102=_tmp100[0]),(_tmp102 instanceof Array))&&(((_tmp103=_tmp102.length),(_tmp103==2))&&(((_tmp104=_tmp102[0]),(_tmp104=="WHITE"))&&(((_tmp105=_tmp102[1]),(_tmp105==":"))&&(((_tmp106=_tmp100[1]),(_tmp106 instanceof Array))&&(((_tmp107=_tmp106.length),(_tmp107==3))&&((f=_tmp106[0]),true,(arg=_tmp106[1]),true,(body=_tmp106[2]),true)))))))))){return ["send",f,["data",["code",arg],["code",body]]];}else{if((((_tmp93=[ops,args]),(_tmp93 instanceof Array))&&(((_tmp94=_tmp93.length),(_tmp94==2))&&(((_tmp95=_tmp93[0]),(_tmp95 instanceof Array))&&(((_tmp96=_tmp95.length),(_tmp96==1))&&(((_tmp97=_tmp95[0]),(_tmp97==":"))&&(((_tmp98=_tmp93[1]),(_tmp98 instanceof Array))&&(((_tmp99=_tmp98.length),(_tmp99==2))&&((f=_tmp98[0]),true,(body=_tmp98[1]),true))))))))){return ["send",f,["data",["code",body]]];}else{if((((_tmp86=[ops,args]),(_tmp86 instanceof Array))&&(((_tmp87=_tmp86.length),(_tmp87==2))&&(((_tmp88=_tmp86[0]),(_tmp88 instanceof Array))&&(((_tmp89=_tmp88.length),(_tmp89==1))&&(((_tmp90=_tmp88[0]),(_tmp90=="with"))&&(((_tmp91=_tmp86[1]),(_tmp91 instanceof Array))&&(((_tmp92=_tmp91.length),(_tmp92==2))&&((target=_tmp91[0]),true,(body=_tmp91[1]),true))))))))){(body=function(){var other;var _tmp117;var _tmp118;var _tmp119;var rest;if((((_tmp117=body),(_tmp117 instanceof Array))&&(((_tmp118=_tmp117.length),(_tmp118>=1))&&(((_tmp119=_tmp117[0]),(_tmp119=="multi"))&&((rest=_tmp117.slice(1)),true))))){return rest;}else{if(((other=body),true)){return [body];}else{throw "Could not find a match";}}}());var other;var _tmp108;var _tmp109;var _tmp110;var args;var _tmp111;var _tmp112;var _tmp113;var f;var _tmp114;var _tmp115;var _tmp116;var args;if((((_tmp111=target),(_tmp111 instanceof Array))&&(((_tmp112=_tmp111.length),(_tmp112==3))&&(((_tmp113=_tmp111[0]),(_tmp113=="send"))&&(((f=_tmp111[1]),true,(_tmp114=_tmp111[2]),(_tmp114 instanceof Array))&&(((_tmp115=_tmp114.length),(_tmp115>=1))&&(((_tmp116=_tmp114[0]),(_tmp116=="data"))&&((args=_tmp114.slice(1)),true)))))))){return ["send",f,["data"].concat(args).concat(body)];}else{if((((_tmp108=target),(_tmp108 instanceof Array))&&(((_tmp109=_tmp108.length),(_tmp109>=1))&&(((_tmp110=_tmp108[0]),(_tmp110=="data"))&&((args=_tmp108.slice(1)),true))))){return target.concat(body);}else{if(((other=target),true)){return ["send",target,["data"].concat(body)];}else{throw "Could not find a match";}}}}else{if((((_tmp79=[ops,args]),(_tmp79 instanceof Array))&&(((_tmp80=_tmp79.length),(_tmp80==2))&&(((_tmp81=_tmp79[0]),(_tmp81 instanceof Array))&&(((_tmp82=_tmp81.length),(_tmp82>=1))&&((_tmp83=_tmp81[0]),(((_tmp84=_tmp83),(_tmp84=="["))||((_tmp85=_tmp83),(_tmp85==","))))))))){if((op=="[")){(args=args.slice(1,(-1)));}else{false;}(args=function(){var f=function(x){return (x!==null);};return args.filter(f);}());var result=function(){var other;var _tmp120;var _tmp121;var x;var _tmp122;var _tmp123;if((((_tmp122=args),(_tmp122 instanceof Array))&&((_tmp123=_tmp122.length),(_tmp123==0)))){throw "At least one expression must be enclosed in []";}else{if((((_tmp120=args),(_tmp120 instanceof Array))&&(((_tmp121=_tmp120.length),(_tmp121==1))&&((x=_tmp120[0]),true)))){return x;}else{if(((other=args),true)){return ["multi"].concat(args);}else{throw "Could not find a match";}}}}();return result;}else{if((((_tmp74=[ops,args]),(_tmp74 instanceof Array))&&(((_tmp75=_tmp74.length),(_tmp75==2))&&(((_tmp76=_tmp74[0]),(_tmp76 instanceof Array))&&(((_tmp77=_tmp76.length),(_tmp77>=1))&&((_tmp78=_tmp76[0]),(_tmp78=="{"))))))){var f=function(x){return (x!==null);};return ["data"].concat(args.slice(1,(-1)).filter(f));}else{if((((_tmp69=[ops,args]),(_tmp69 instanceof Array))&&(((_tmp70=_tmp69.length),(_tmp70==2))&&(((_tmp71=_tmp69[0]),(_tmp71 instanceof Array))&&(((_tmp72=_tmp71.length),(_tmp72==1))&&((_tmp73=_tmp71[0]),(_tmp73=="WHITE"))))))){return ["send"].concat(args);}else{if((((_tmp61=[ops,args]),(_tmp61 instanceof Array))&&(((_tmp62=_tmp61.length),(_tmp62==2))&&(((_tmp63=_tmp61[0]),(_tmp63 instanceof Array))&&(((_tmp64=_tmp63.length),(_tmp64==1))&&(((_tmp65=_tmp61[1]),(_tmp65 instanceof Array))&&(((_tmp66=_tmp65.length),(_tmp66==2))&&(((_tmp67=_tmp65[0]),(_tmp67===null))&&((_tmp68=_tmp65[1]),(_tmp68===null)))))))))){return op;}else{if((((_tmp55=[ops,args]),(_tmp55 instanceof Array))&&(((_tmp56=_tmp55.length),(_tmp56==2))&&(((_tmp57=_tmp55[0]),(_tmp57 instanceof Array))&&(((_tmp58=_tmp57.length),(_tmp58==1))&&(((_tmp59=_tmp55[1]),(_tmp59 instanceof Array))&&(((_tmp60=_tmp59.length),(_tmp60==2))&&((a=_tmp59[0]),true,(b=_tmp59[1]),true)))))))){return ["send",op,["data",a,b]];}else{if(((other=[ops,args]),true)){throw ["Unknown node",ops,args];}else{throw "Could not find a match";}}}}}}}}}}else{if(((other=x),true)){throw "OopsE";}else{throw "Could not find a match";}}}}}}};var parse=function(text){var results=tokenize(text);var next=function(){return results.shift();};return oparse(next,order,finalize);};var Env=function(parent){var store=Object();var self=function(expr){return ["bind_env",self,expr];};(self.resolve=function(name){var attempt=store[name];if(attempt){return attempt;}else{if(true){return self.parent.resolve(name);}else{return false;}}});(self.register=function(name,value){return (store[name]=value);});(self.register_macro=function(name,m){return (store[name]=["macro",m]);});(self.fork=function(){return Env(self);});(self.parent=parent);(self.store=store);return self;};var js_contexts=({"js_for":["multi","multi","multi","multi"]});var expand=function(env,context,expr){(expr=expand.step(env,context,expr));var other;var _tmp124;var _tmp125;var _tmp126;var _tmp138;var _tmp127;var _tmp137;var _tmp128;var _tmp136;var _tmp129;var _tmp135;var _tmp130;var _tmp134;var _tmp131;var _tmp133;var _tmp132;var args;var _tmp139;var _tmp140;var _tmp141;var lhs;var rhs;var _tmp142;var _tmp143;var _tmp144;var binding;var value;var _tmp145;var _tmp146;var _tmp147;var bindings;var body;var _tmp148;var _tmp149;var _tmp150;var args;var _tmp151;var _tmp152;var _tmp153;var type;var _tmp154;var _tmp162;var _tmp155;var _tmp161;var _tmp156;var _tmp160;var _tmp157;var _tmp159;var _tmp158;var args;var _tmp163;var _tmp164;var _tmp165;var v;var _tmp166;var _tmp167;var _tmp168;var f;var arg;var _tmp169;var _tmp170;var _tmp171;if(((_tmp171=expr),(typeof(_tmp171)=="string"))){return expr;}else{if(((_tmp170=expr),(_tmp170===null))){return null;}else{if(((_tmp169=expr),(_tmp169===undefined))){throw "undefined? why?";}else{if((((_tmp166=expr),(_tmp166 instanceof Array))&&(((_tmp167=_tmp166.length),(_tmp167==3))&&(((_tmp168=_tmp166[0]),(_tmp168=="send"))&&((f=_tmp166[1]),true,(arg=_tmp166[2]),true))))){var f=expand(env,"head",expr[1]);var arg=expr[2];return ["send",f,expand(env,"tail",arg)];}else{if((((_tmp163=expr),(_tmp163 instanceof Array))&&(((_tmp164=_tmp163.length),(_tmp164==2))&&(((_tmp165=_tmp163[0]),(_tmp165=="value"))&&((v=_tmp163[1]),true))))){return expr;}else{if((((_tmp151=expr),(_tmp151 instanceof Array))&&(((_tmp152=_tmp151.length),(_tmp152>=1))&&(((_tmp153=_tmp151[0]),(type=_tmp153),true,(_tmp154=_tmp153),(((_tmp155=_tmp154),(((_tmp156=_tmp155),(((_tmp157=_tmp156),(((_tmp158=_tmp157),(_tmp158=="multi"))||((_tmp159=_tmp157),(_tmp159=="code"))))||((_tmp160=_tmp156),(_tmp160=="array"))))||((_tmp161=_tmp155),(_tmp161=="object"))))||((_tmp162=_tmp154),(_tmp162=="splice"))))&&((args=_tmp151.slice(1)),true))))){var arr=[];while((args.length>0)){var x=expand.step(env,type,args.shift());if(((x instanceof Array)&&(x[0]=="splice"))){(args=x.slice(1).concat(args));}else{if(true){arr.push(x);}else{false;}}}var f=function(x){return expand(env,type,x);};return [type].concat(arr.map(f));}else{if((((_tmp148=expr),(_tmp148 instanceof Array))&&(((_tmp149=_tmp148.length),(_tmp149>=1))&&(((_tmp150=_tmp148[0]),(_tmp150=="data"))&&((args=_tmp148.slice(1)),true))))){var is_obj=false;var obj=["object"];var arr=["array"];while((args.length>0)){var x=expand.step(env,type,args.shift());var other;var _tmp172;var _tmp173;var _tmp174;var exprs;var _tmp175;var _tmp176;var _tmp177;var k;var v;var _tmp178;var _tmp179;var _tmp180;if((((_tmp178=x),(_tmp178 instanceof Array))&&(((_tmp179=_tmp178.length),(_tmp179==1))&&((_tmp180=_tmp178[0]),(_tmp180=="assoc"))))){(is_obj=true);}else{if((((_tmp175=x),(_tmp175 instanceof Array))&&(((_tmp176=_tmp175.length),(_tmp176==3))&&(((_tmp177=_tmp175[0]),(_tmp177=="assoc"))&&((k=_tmp175[1]),true,(v=_tmp175[2]),true))))){(is_obj=true);obj.push(["array",k,v]);}else{if((((_tmp172=x),(_tmp172 instanceof Array))&&(((_tmp173=_tmp172.length),(_tmp173>=1))&&(((_tmp174=_tmp172[0]),(_tmp174=="splice"))&&((exprs=_tmp172.slice(1)),true))))){(args=exprs.concat(args));}else{if(((other=x),true)){arr.push(other);}else{throw "Could not find a match";}}}}}var r=function(){if(((arr.length>1)&&is_obj)){arr.push(obj);return arr;}else{if(is_obj){return obj;}else{if(true){return arr;}else{return false;}}}}();return expand(env,context,r);}else{if((((_tmp145=expr),(_tmp145 instanceof Array))&&(((_tmp146=_tmp145.length),(_tmp146==3))&&(((_tmp147=_tmp145[0]),(_tmp147=="lambda"))&&((bindings=_tmp145[1]),true,(body=_tmp145[2]),true))))){return ["lambda",bindings.map(function(x){return expand(env,"decl",x);}),expand(env,"multi",body)];}else{if((((_tmp142=expr),(_tmp142 instanceof Array))&&(((_tmp143=_tmp142.length),(_tmp143==3))&&(((_tmp144=_tmp142[0]),(_tmp144=="declare"))&&((binding=_tmp142[1]),true,(value=_tmp142[2]),true))))){return ["declare",expand(env,"decl",binding),expand(env,"multi",value)];}else{if((((_tmp139=expr),(_tmp139 instanceof Array))&&(((_tmp140=_tmp139.length),(_tmp140==3))&&(((_tmp141=_tmp139[0]),(_tmp141=="assign"))&&((lhs=_tmp139[1]),true,(rhs=_tmp139[2]),true))))){return ["assign",expand(env,"decl",lhs),expand(env,"multi",rhs)];}else{if((((_tmp124=expr),(_tmp124 instanceof Array))&&(((_tmp125=_tmp124.length),(_tmp125>=1))&&(((_tmp126=_tmp124[0]),(((_tmp127=_tmp126),(((_tmp128=_tmp127),(((_tmp129=_tmp128),(((_tmp130=_tmp129),(((_tmp131=_tmp130),(((_tmp132=_tmp131),(_tmp132=="js_while"))||((_tmp133=_tmp131),(_tmp133=="js_for"))))||((_tmp134=_tmp130),(_tmp134=="js_break"))))||((_tmp135=_tmp129),(_tmp135=="js_continue"))))||((_tmp136=_tmp128),(_tmp136=="js_return"))))||((_tmp137=_tmp127),(_tmp137=="js_throw"))))||((_tmp138=_tmp126),(_tmp138=="if"))))&&((args=_tmp124.slice(1)),true))))){var ctxs=(js_contexts[type]||[]);var f=function(x,i){return expand(env,(ctxs[i]||"expr"),x);};return [type].concat(args.map(f));}else{if(((other=expr),true)){throw ["Oops",type,context];}else{throw "Could not find a match";}}}}}}}}}}}}};(expand.step=function(env,context,expr){var other;var _tmp181;var _tmp182;var type;var args;var _tmp183;var _tmp184;var _tmp185;var f;var arg;var _tmp186;var _tmp187;var _tmp188;var m;var _tmp189;var _tmp190;var _tmp191;if(((_tmp191=expr),(typeof(_tmp191)=="string"))){var v=env.resolve(expr);var other;var _tmp192;var _tmp193;var _tmp194;var _tmp195;var _tmp196;var m;var _tmp197;var _tmp198;var _tmp199;var _tmp200;var _tmp201;var m;var _tmp202;var _tmp203;var _tmp204;var _tmp205;if((((_tmp203=[v,context]),(_tmp203 instanceof Array))&&(((_tmp204=_tmp203.length),(_tmp204==2))&&((_tmp205=_tmp203[0]),(_tmp205===undefined))))){return expr;}else{if((((_tmp197=[v,context]),(_tmp197 instanceof Array))&&(((_tmp198=_tmp197.length),(_tmp198==2))&&(((_tmp199=_tmp197[0]),(_tmp199 instanceof Array))&&(((_tmp200=_tmp199.length),(_tmp200==2))&&(((_tmp201=_tmp199[0]),(_tmp201=="macro"))&&((m=_tmp199[1]),true,(_tmp202=_tmp197[1]),(_tmp202=="head")))))))){return v;}else{if((((_tmp192=[v,context]),(_tmp192 instanceof Array))&&(((_tmp193=_tmp192.length),(_tmp193==2))&&(((_tmp194=_tmp192[0]),(_tmp194 instanceof Array))&&(((_tmp195=_tmp194.length),(_tmp195==2))&&(((_tmp196=_tmp194[0]),(_tmp196=="macro"))&&((m=_tmp194[1]),true))))))){return expand.step(env,context,m(env,context,null));}else{if(((other=[v,context]),true)){return v;}else{throw "Could not find a match";}}}}}else{if(((_tmp190=expr),(_tmp190===null))){return null;}else{if(((_tmp189=expr),(_tmp189===undefined))){throw "undefined? why?";}else{if((((_tmp186=expr),(_tmp186 instanceof Array))&&(((_tmp187=_tmp186.length),(_tmp187==2))&&(((_tmp188=_tmp186[0]),(_tmp188=="macro"))&&((m=_tmp186[1]),true))))){if((context=="head")){return expr;}else{if(true){return expand.step(env,context,m(env,context,null));}else{return false;}}}else{if((((_tmp183=expr),(_tmp183 instanceof Array))&&(((_tmp184=_tmp183.length),(_tmp184==3))&&(((_tmp185=_tmp183[0]),(_tmp185=="send"))&&((f=_tmp183[1]),true,(arg=_tmp183[2]),true))))){(f=expand.step(env,"head",f));var other;var _tmp206;var _tmp207;var _tmp208;var m;if((((_tmp206=f),(_tmp206 instanceof Array))&&(((_tmp207=_tmp206.length),(_tmp207==2))&&(((_tmp208=_tmp206[0]),(_tmp208=="macro"))&&((m=_tmp206[1]),true))))){return expand.step(env,context,m(env,context,arg));}else{if(((other=f),true)){return expr;}else{throw "Could not find a match";}}}else{if((((_tmp181=expr),(_tmp181 instanceof Array))&&(((_tmp182=_tmp181.length),(_tmp182>=1))&&((type=_tmp181[0]),true,(args=_tmp181.slice(1)),true)))){return expr;}else{if(((other=expr),true)){throw ["Oops2",expr];}else{throw "Could not find a match";}}}}}}}});var aslist=function(expr){var other;var _tmp209;var _tmp210;var _tmp211;var args;var _tmp212;var _tmp213;if(((_tmp213=expr),(_tmp213===null))){return [null];}else{if(((_tmp212=expr),(_tmp212===undefined))){return [undefined];}else{if((((_tmp209=expr),(_tmp209 instanceof Array))&&(((_tmp210=_tmp209.length),(_tmp210>=1))&&(((_tmp211=_tmp209[0]),(_tmp211=="multi"))&&((args=_tmp209.slice(1)),true))))){return args;}else{if(((other=expr),true)){return [other];}else{throw "Could not find a match";}}}}};var nullenv=({"resolve":function(x){return undefined;}});var stdenv=Env(nullenv);stdenv.register("+","___plus");stdenv.register("-","___minus");stdenv.register("*","___times");stdenv.register("/","___div");stdenv.register("%","___mod");stdenv.register("^","___binxor");stdenv.register("&","___binand");stdenv.register("|","___binor");stdenv.register("~","___binnot");stdenv.register("&&","___and");stdenv.register("||","___or");stdenv.register("!","___not");stdenv.register("===","___is");stdenv.register("!==","___isnt");stdenv.register("!=","___neq");stdenv.register("<","___lt");stdenv.register(">","___gt");stdenv.register("<=","___lte");stdenv.register(">=","___gte");stdenv.register("in","___in");stdenv.register("instanceof","___instanceof");stdenv.register("++","___plusplus");stdenv.register("--","___minusminus");stdenv.register_macro("<>",function(env,context,_tmp214){var _tmp215;var _tmp216;var _tmp217;var _tmp218;var x;if((((_tmp215=_tmp214),(_tmp215 instanceof Array))&&(((_tmp216=_tmp215.length),(_tmp216==3))&&(((_tmp217=_tmp215[0]),(_tmp217=="data"))&&(((_tmp218=_tmp215[1]),(_tmp218===null))&&((x=_tmp215[2]),true)))))){false;}else{throw "a condition failed";}return ["send",["send","___lib",["value","pr"]],["data",x]];});var make_checker=function(value){return function(env,context,expr){return ["send","___eq",["data",expr[1],value]];};};var make_exact_checker=function(value){return function(env,context,expr){return ["send","___is",["data",expr[1],value]];};};stdenv.register_macro("#",function(env,context,expr){var tag=["value",expr[2]];var f=function(env,context,expr){if((context=="pattern")){var f=function(env,context,expr){return ["send","___eq",["data",["send",expr[1],["value","#"]],tag]];};return ["check",["macro",f],expr];}else{if(true){var d=["data",tag].concat(expr.slice(1));return ["send",["send","___lib",["value","Struct"]],d];}else{return false;}}};return ["macro",f];});stdenv.register_macro("&&",function(env,context,expr){var other;var _tmp219;var _tmp220;var _tmp221;var _tmp222;var _tmp223;var _tmp224;var _tmp225;var _tmp226;var _tmp227;var a;var b;if((((_tmp222=[context,expr]),(_tmp222 instanceof Array))&&(((_tmp223=_tmp222.length),(_tmp223==2))&&(((_tmp224=_tmp222[0]),(_tmp224=="pattern"))&&(((_tmp225=_tmp222[1]),(_tmp225 instanceof Array))&&(((_tmp226=_tmp225.length),(_tmp226==3))&&(((_tmp227=_tmp225[0]),(_tmp227=="data"))&&((a=_tmp225[1]),true,(b=_tmp225[2]),true)))))))){return ["all",a,b];}else{if((((_tmp219=[context,expr]),(_tmp219 instanceof Array))&&(((_tmp220=_tmp219.length),(_tmp220==2))&&((_tmp221=_tmp219[1]),(_tmp221===null))))){return "___and";}else{if(((other=[context,expr]),true)){return ["send","___and",expr];}else{throw "Could not find a match";}}}});stdenv.register_macro("||",function(env,context,expr){var other;var _tmp228;var _tmp229;var _tmp230;var _tmp231;var _tmp232;var _tmp233;var _tmp234;var _tmp235;var _tmp236;var a;var b;if((((_tmp231=[context,expr]),(_tmp231 instanceof Array))&&(((_tmp232=_tmp231.length),(_tmp232==2))&&(((_tmp233=_tmp231[0]),(_tmp233=="pattern"))&&(((_tmp234=_tmp231[1]),(_tmp234 instanceof Array))&&(((_tmp235=_tmp234.length),(_tmp235==3))&&(((_tmp236=_tmp234[0]),(_tmp236=="data"))&&((a=_tmp234[1]),true,(b=_tmp234[2]),true)))))))){return ["any",a,b];}else{if((((_tmp228=[context,expr]),(_tmp228 instanceof Array))&&(((_tmp229=_tmp228.length),(_tmp229==2))&&((_tmp230=_tmp228[1]),(_tmp230===null))))){return "___or";}else{if(((other=[context,expr]),true)){return ["send","___or",expr];}else{throw "Could not find a match";}}}});stdenv.register_macro("==",function(env,context,expr){var other;var _tmp237;var _tmp238;var _tmp239;var _tmp240;var _tmp241;var _tmp242;var _tmp243;var _tmp244;var _tmp245;var _tmp246;var val;if((((_tmp240=[context,expr]),(_tmp240 instanceof Array))&&(((_tmp241=_tmp240.length),(_tmp241==2))&&(((_tmp242=_tmp240[0]),(_tmp242=="pattern"))&&(((_tmp243=_tmp240[1]),(_tmp243 instanceof Array))&&(((_tmp244=_tmp243.length),(_tmp244==3))&&(((_tmp245=_tmp243[0]),(_tmp245=="data"))&&(((_tmp246=_tmp243[1]),(_tmp246===null))&&((val=_tmp243[2]),true))))))))){return ["check",["macro",make_checker(val)],null];}else{if((((_tmp237=[context,expr]),(_tmp237 instanceof Array))&&(((_tmp238=_tmp237.length),(_tmp238==2))&&((_tmp239=_tmp237[1]),(_tmp239===null))))){return "___eq";}else{if(((other=[context,expr]),true)){return ["send","___eq",expr];}else{throw "Could not find a match";}}}});stdenv.register_macro("*",function(env,context,expr){var other;var _tmp247;var _tmp248;var _tmp249;var _tmp250;var _tmp251;var _tmp252;var _tmp253;var _tmp254;var _tmp255;var val;var _tmp256;if((((_tmp250=[context,expr]),(_tmp250 instanceof Array))&&(((_tmp251=_tmp250.length),(_tmp251==2))&&(((_tmp252=_tmp250[0]),(_tmp252=="pattern"))&&(((_tmp253=_tmp250[1]),(_tmp253 instanceof Array))&&(((_tmp254=_tmp253.length),(_tmp254==3))&&(((_tmp255=_tmp253[0]),(_tmp255=="data"))&&((val=_tmp253[1]),true,(_tmp256=_tmp253[2]),(_tmp256===null))))))))){return ["dynsplice",val];}else{if((((_tmp247=[context,expr]),(_tmp247 instanceof Array))&&(((_tmp248=_tmp247.length),(_tmp248==2))&&((_tmp249=_tmp247[1]),(_tmp249===null))))){return "___times";}else{if(((other=[context,expr]),true)){return ["send","___times",expr];}else{throw "Could not find a match";}}}});stdenv.register_macro(".",function(env,context,expr){var other;var _tmp257;var _tmp258;var _tmp259;var _tmp260;var _tmp261;var s;if((((_tmp257=expr),(_tmp257 instanceof Array))&&(((_tmp258=_tmp257.length),(_tmp258==3))&&(((_tmp259=_tmp257[0]),(_tmp259=="data"))&&(((_tmp260=_tmp257[1]),(_tmp260===null))&&(((_tmp261=_tmp257[2]),(typeof(_tmp261)=="string"))&&((s=_tmp261),true))))))){return ["value",s];}else{if(((other=expr),true)){throw ["invalid",expr];}else{throw "Could not find a match";}}});stdenv.register_macro("where",function(env,context,_tmp262){var _tmp263;var _tmp264;var _tmp265;var a;var b;if((((_tmp263=_tmp262),(_tmp263 instanceof Array))&&(((_tmp264=_tmp263.length),(_tmp264==3))&&(((_tmp265=_tmp263[0]),(_tmp265=="data"))&&((a=_tmp263[1]),true,(b=_tmp263[2]),true))))){false;}else{throw "a condition failed";}return ["send","let",["data",["code",b],["code",a]]];});stdenv.register_macro("let",function(env,context,_tmp266){var _tmp267;var _tmp268;var _tmp269;var _tmp270;var _tmp271;var _tmp272;var a;var _tmp273;var _tmp274;var _tmp275;var b;if((((_tmp267=_tmp266),(_tmp267 instanceof Array))&&(((_tmp268=_tmp267.length),(_tmp268==3))&&(((_tmp269=_tmp267[0]),(_tmp269=="data"))&&(((_tmp270=_tmp267[1]),(_tmp270 instanceof Array))&&(((_tmp271=_tmp270.length),(_tmp271==2))&&(((_tmp272=_tmp270[0]),(_tmp272=="code"))&&(((a=_tmp270[1]),true,(_tmp273=_tmp267[2]),(_tmp273 instanceof Array))&&(((_tmp274=_tmp273.length),(_tmp274==2))&&(((_tmp275=_tmp273[0]),(_tmp275=="code"))&&((b=_tmp273[1]),true))))))))))){false;}else{throw "a condition failed";}var bindings=aslist(a);var body=aslist(b);return ["multi"].concat(bindings).concat(body);});stdenv.register_macro("->",function(env,context,_tmp276){var _tmp277;var _tmp278;var _tmp279;var args;var stmts;if((((_tmp277=_tmp276),(_tmp277 instanceof Array))&&(((_tmp278=_tmp277.length),(_tmp278==3))&&(((_tmp279=_tmp277[0]),(_tmp279=="data"))&&((args=_tmp277[1]),true,(stmts=_tmp277[2]),true))))){false;}else{throw "a condition failed";}var body=["multi"];(args=args.slice(1).map(function(x){var other;var _tmp280;if(((_tmp280=x),(typeof(_tmp280)=="string"))){return x;}else{if(((other=x),true)){var t=gensym();body.push(["send","=",["data",x,t]]);return t;}else{throw "Could not find a match";}}}));body.push(stmts);return ["lambda",args,body];});stdenv.register_macro("=>",function(env,context,_tmp281){var _tmp282;var _tmp283;var _tmp284;var binding;var value;if((((_tmp282=_tmp281),(_tmp282 instanceof Array))&&(((_tmp283=_tmp282.length),(_tmp283==3))&&(((_tmp284=_tmp282[0]),(_tmp284=="data"))&&((binding=_tmp282[1]),true,(value=_tmp282[2]),true))))){false;}else{throw "a condition failed";}if((context=="data")){return ["assoc",binding,value];}else{if(true){throw (("Illegal context for '=>' ("+context)+")");}else{return false;}}});stdenv.register_macro("=",function(env,context,expr){var other;var _tmp285;var _tmp286;var _tmp287;var _tmp288;var _tmp289;var _tmp290;var binding;var value;var _tmp291;var _tmp292;var _tmp293;var _tmp294;var _tmp295;var _tmp296;var _tmp297;var _tmp298;var _tmp299;var f;var _tmp300;var _tmp301;var _tmp302;var args;var value;var _tmp303;var _tmp304;var _tmp305;var _tmp306;var _tmp307;var _tmp308;var _tmp309;var _tmp310;var _tmp311;var _tmp312;var lhs;var rhs;if((((_tmp307=[context,expr]),(_tmp307 instanceof Array))&&(((_tmp308=_tmp307.length),(_tmp308==2))&&(((_tmp309=_tmp307[0]),(_tmp309=="multi"))&&(((_tmp310=_tmp307[1]),(_tmp310 instanceof Array))&&(((_tmp311=_tmp310.length),(_tmp311==3))&&(((_tmp312=_tmp310[0]),(_tmp312=="data"))&&((lhs=_tmp310[1]),true,(rhs=_tmp310[2]),true)))))))){var p=parse_lhs(env,lhs,rhs);var vars=make_declarations(p[0]);var r=["splice"].concat(vars);var clauses=p[1];var mkif=function(x){return ["if",x,["value",false],["js_throw",["value","a condition failed"]]];};if((clauses.length==1)){var clause=clauses[0];var last=clause[(clause.length-1)];if((((last instanceof Array)&&(last[0]=="value"))&&(last[1]===true))){if(((vars.length==1)&&(clause.length==3))){(r=["declare"].concat(clause[1].slice(1)));}else{if(true){(r=r.concat(clause.slice(1,(-1))));}else{false;}}}else{if(true){r.push(mkif(clause));}else{false;}}}else{if(true){var ands=make_pattern_test(clauses);r.push(mkif(ands));}else{false;}}return r;}else{if((((_tmp303=[context,expr]),(_tmp303 instanceof Array))&&(((_tmp304=_tmp303.length),(_tmp304==2))&&(((_tmp305=_tmp303[0]),(_tmp305=="data"))&&((_tmp306=_tmp303[1]),(_tmp306===null)))))){return ["assoc"];}else{if((((_tmp291=[context,expr]),(_tmp291 instanceof Array))&&(((_tmp292=_tmp291.length),(_tmp292==2))&&(((_tmp293=_tmp291[0]),(_tmp293=="data"))&&(((_tmp294=_tmp291[1]),(_tmp294 instanceof Array))&&(((_tmp295=_tmp294.length),(_tmp295==3))&&(((_tmp296=_tmp294[0]),(_tmp296=="data"))&&(((_tmp297=_tmp294[1]),(_tmp297 instanceof Array))&&(((_tmp298=_tmp297.length),(_tmp298==3))&&(((_tmp299=_tmp297[0]),(_tmp299=="send"))&&(((f=_tmp297[1]),true,(_tmp300=_tmp297[2]),(_tmp300 instanceof Array))&&(((_tmp301=_tmp300.length),(_tmp301>=1))&&(((_tmp302=_tmp300[0]),(_tmp302=="data"))&&((args=_tmp300.slice(1)),true,(value=_tmp294[2]),true)))))))))))))){return ["assoc",["value",f],["lambda",args,value]];}else{if((((_tmp285=[context,expr]),(_tmp285 instanceof Array))&&(((_tmp286=_tmp285.length),(_tmp286==2))&&(((_tmp287=_tmp285[0]),(_tmp287=="data"))&&(((_tmp288=_tmp285[1]),(_tmp288 instanceof Array))&&(((_tmp289=_tmp288.length),(_tmp289==3))&&(((_tmp290=_tmp288[0]),(_tmp290=="data"))&&((binding=_tmp288[1]),true,(value=_tmp288[2]),true)))))))){return ["assoc",["value",binding],value];}else{if(((other=[context,expr]),true)){throw (("Illegal context for '=' ("+context)+")");}else{throw "Could not find a match";}}}}}});stdenv.register_macro(":=",function(env,context,_tmp313){var _tmp314;var _tmp315;var _tmp316;var a;var b;if((((_tmp314=_tmp313),(_tmp314 instanceof Array))&&(((_tmp315=_tmp314.length),(_tmp315==3))&&(((_tmp316=_tmp314[0]),(_tmp316=="data"))&&((a=_tmp314[1]),true,(b=_tmp314[2]),true))))){false;}else{throw "a condition failed";}return ["assign",a,b];});stdenv.register_macro("if",function(env,context,_tmp317){var _tmp318;var _tmp319;var _tmp320;var test;var a;var b;if((((_tmp318=_tmp317),(_tmp318 instanceof Array))&&(((_tmp319=_tmp318.length),(_tmp319==4))&&(((_tmp320=_tmp318[0]),(_tmp320=="data"))&&((test=_tmp318[1]),true,(a=_tmp318[2]),true,(b=_tmp318[3]),true))))){false;}else{throw "a condition failed";}return ["if",test,a,b];});stdenv.register_macro("cond",function(env,context,_tmp321){var _tmp322;var _tmp323;var _tmp324;var _tmp325;var _tmp326;var _tmp327;var clauses;if((((_tmp322=_tmp321),(_tmp322 instanceof Array))&&(((_tmp323=_tmp322.length),(_tmp323==2))&&(((_tmp324=_tmp322[0]),(_tmp324=="data"))&&(((_tmp325=_tmp322[1]),(_tmp325 instanceof Array))&&(((_tmp326=_tmp325.length),(_tmp326==2))&&(((_tmp327=_tmp325[0]),(_tmp327=="code"))&&((clauses=_tmp325[1]),true)))))))){false;}else{throw "a condition failed";}var handle=function(xs){if((xs.length==0)){return ["value",false];}else{if(true){var first=xs[0][2];var rest=xs.slice(1);return ["if",first[1],first[2],handle(rest)];}else{return false;}}};return handle(aslist(clauses));});stdenv.register_macro("while",function(env,context,expr){var _tmp328;var _tmp329;var _tmp330;var _tmp331;var _tmp332;var _tmp333;var test;var _tmp334;var _tmp335;var _tmp336;var body;if((((_tmp328=expr),(_tmp328 instanceof Array))&&(((_tmp329=_tmp328.length),(_tmp329==3))&&(((_tmp330=_tmp328[0]),(_tmp330=="data"))&&(((_tmp331=_tmp328[1]),(_tmp331 instanceof Array))&&(((_tmp332=_tmp331.length),(_tmp332==2))&&(((_tmp333=_tmp331[0]),(_tmp333=="code"))&&(((test=_tmp331[1]),true,(_tmp334=_tmp328[2]),(_tmp334 instanceof Array))&&(((_tmp335=_tmp334.length),(_tmp335==2))&&(((_tmp336=_tmp334[0]),(_tmp336=="code"))&&((body=_tmp334[1]),true))))))))))){false;}else{throw "a condition failed";}return ["js_while",test,body];});stdenv.register_macro("for",function(env,context,_tmp337){var _tmp338;var _tmp339;var _tmp340;var _tmp341;var _tmp342;var _tmp343;var _tmp344;var _tmp345;var _tmp346;var a;var b;var c;var _tmp347;var _tmp348;var _tmp349;var body;if((((_tmp338=_tmp337),(_tmp338 instanceof Array))&&(((_tmp339=_tmp338.length),(_tmp339==3))&&(((_tmp340=_tmp338[0]),(_tmp340=="data"))&&(((_tmp341=_tmp338[1]),(_tmp341 instanceof Array))&&(((_tmp342=_tmp341.length),(_tmp342==2))&&(((_tmp343=_tmp341[0]),(_tmp343=="code"))&&(((_tmp344=_tmp341[1]),(_tmp344 instanceof Array))&&(((_tmp345=_tmp344.length),(_tmp345==4))&&(((_tmp346=_tmp344[0]),(_tmp346=="multi"))&&(((a=_tmp344[1]),true,(b=_tmp344[2]),true,(c=_tmp344[3]),true,(_tmp347=_tmp338[2]),(_tmp347 instanceof Array))&&(((_tmp348=_tmp347.length),(_tmp348==2))&&(((_tmp349=_tmp347[0]),(_tmp349=="code"))&&((body=_tmp347[1]),true)))))))))))))){false;}else{throw "a condition failed";}return ["js_for",a,b,c,body];});stdenv.register_macro("return",function(env,context,expr){return ["js_return",expr];});stdenv.register_macro("throw",function(env,context,expr){return ["js_throw",expr];});stdenv.register_macro("break",function(env,context,expr){return ["js_break"];});stdenv.register_macro("continue",function(env,context,expr){return ["js_continue"];});var rx_wrap=function(x){return (("(?:"+x)+")");};var rx_quote=function(x){return x.replace(RegExp("([.?*+\\^$\\[\\]\\(\\)\\{\\}|\\\\])","g"),"\\$1");};var rx_quote2=function(x){return x.replace(RegExp("([\\[\\]\\(\\)\\{\\}\\^])","g"),"\\$1");};var rx_build=function(expr){var otherA;var _tmp350;var _tmp351;var _tmp352;var args;var _tmp353;var _tmp354;var _tmp355;var args;var _tmp356;var _tmp357;var _tmp358;var _tmp359;var _tmp360;var _tmp361;var _tmp362;var _tmp363;var b;var _tmp364;var _tmp365;var _tmp366;var _tmp367;var _tmp368;var _tmp369;var _tmp370;var _tmp371;var b;var _tmp372;var _tmp373;var _tmp374;var _tmp375;var _tmp376;var _tmp377;var _tmp378;var a;var _tmp379;var _tmp380;var _tmp381;var _tmp382;var _tmp383;var _tmp384;var _tmp385;var _tmp386;var a;var _tmp387;var _tmp388;var _tmp389;var _tmp390;var _tmp391;var _tmp392;var _tmp393;var _tmp394;var a;var _tmp395;var _tmp396;var _tmp397;var _tmp398;var _tmp399;var _tmp400;var _tmp401;var _tmp402;var a;var b;var _tmp403;var _tmp404;var _tmp405;var x;var _tmp406;var _tmp407;var _tmp408;var _tmp409;var _tmp410;var _tmp411;var _tmp412;var _tmp413;var _tmp414;var _tmp415;var _tmp416;var _tmp417;var _tmp418;if(((_tmp418=expr),(_tmp418=="any"))){return ".";}else{if(((_tmp417=expr),(_tmp417=="start"))){return "^";}else{if(((_tmp416=expr),(_tmp416=="end"))){return "$";}else{if(((_tmp415=expr),(_tmp415=="alpha"))){return "\\a";}else{if(((_tmp414=expr),(_tmp414=="digit"))){return "\\d";}else{if(((_tmp413=expr),(_tmp413=="word"))){return "\\w";}else{if(((_tmp412=expr),(_tmp412=="space"))){return "\\s";}else{if(((_tmp411=expr),(_tmp411=="boundary"))){return "\\b";}else{if(((_tmp410=expr),(_tmp410=="a"))){return "\\a";}else{if(((_tmp409=expr),(_tmp409=="d"))){return "\\d";}else{if(((_tmp408=expr),(_tmp408=="w"))){return "\\w";}else{if(((_tmp407=expr),(_tmp407=="s"))){return "\\s";}else{if(((_tmp406=expr),(_tmp406=="b"))){return "\\b";}else{if((((_tmp403=expr),(_tmp403 instanceof Array))&&(((_tmp404=_tmp403.length),(_tmp404==2))&&(((_tmp405=_tmp403[0]),(_tmp405=="value"))&&((x=_tmp403[1]),true))))){return rx_quote(x);}else{if((((_tmp396=expr),(_tmp396 instanceof Array))&&(((_tmp397=_tmp396.length),(_tmp397==3))&&(((_tmp398=_tmp396[0]),(_tmp398=="send"))&&(((_tmp399=_tmp396[1]),(_tmp399=="||"))&&(((_tmp400=_tmp396[2]),(_tmp400 instanceof Array))&&(((_tmp401=_tmp400.length),(_tmp401==3))&&(((_tmp402=_tmp400[0]),(_tmp402=="data"))&&((a=_tmp400[1]),true,(b=_tmp400[2]),true))))))))){return rx_wrap(((rx_build(a)+"|")+rx_build(b)));}else{if((((_tmp388=expr),(_tmp388 instanceof Array))&&(((_tmp389=_tmp388.length),(_tmp389==3))&&(((_tmp390=_tmp388[0]),(_tmp390=="send"))&&(((_tmp391=_tmp388[1]),(_tmp391=="*"))&&(((_tmp392=_tmp388[2]),(_tmp392 instanceof Array))&&(((_tmp393=_tmp392.length),(_tmp393==3))&&(((_tmp394=_tmp392[0]),(_tmp394=="data"))&&((a=_tmp392[1]),true,(_tmp395=_tmp392[2]),(_tmp395===null)))))))))){return rx_wrap((rx_build(a)+"*"));}else{if((((_tmp380=expr),(_tmp380 instanceof Array))&&(((_tmp381=_tmp380.length),(_tmp381==3))&&(((_tmp382=_tmp380[0]),(_tmp382=="send"))&&(((_tmp383=_tmp380[1]),(_tmp383=="+"))&&(((_tmp384=_tmp380[2]),(_tmp384 instanceof Array))&&(((_tmp385=_tmp384.length),(_tmp385==3))&&(((_tmp386=_tmp384[0]),(_tmp386=="data"))&&((a=_tmp384[1]),true,(_tmp387=_tmp384[2]),(_tmp387===null)))))))))){return rx_wrap((rx_build(a)+"+"));}else{if((((_tmp372=expr),(_tmp372 instanceof Array))&&(((_tmp373=_tmp372.length),(_tmp373==3))&&(((_tmp374=_tmp372[0]),(_tmp374=="send"))&&(((_tmp375=_tmp372[1]),(_tmp375=="?"))&&(((_tmp376=_tmp372[2]),(_tmp376 instanceof Array))&&(((_tmp377=_tmp376.length),(_tmp377==3))&&(((_tmp378=_tmp376[0]),(_tmp378=="data"))&&((a=_tmp376[1]),true,(_tmp379=_tmp376[2]),(_tmp379===null)))))))))){return rx_wrap((rx_build(a)+"?"));}else{if((((_tmp364=expr),(_tmp364 instanceof Array))&&(((_tmp365=_tmp364.length),(_tmp365==3))&&(((_tmp366=_tmp364[0]),(_tmp366=="send"))&&(((_tmp367=_tmp364[1]),(_tmp367==">>"))&&(((_tmp368=_tmp364[2]),(_tmp368 instanceof Array))&&(((_tmp369=_tmp368.length),(_tmp369==3))&&(((_tmp370=_tmp368[0]),(_tmp370=="data"))&&(((_tmp371=_tmp368[1]),(_tmp371===null))&&((b=_tmp368[2]),true)))))))))){var x=rx_quote2(b[1]);return (("["+x)+"]");}else{if((((_tmp356=expr),(_tmp356 instanceof Array))&&(((_tmp357=_tmp356.length),(_tmp357==3))&&(((_tmp358=_tmp356[0]),(_tmp358=="send"))&&(((_tmp359=_tmp356[1]),(_tmp359==">>!"))&&(((_tmp360=_tmp356[2]),(_tmp360 instanceof Array))&&(((_tmp361=_tmp360.length),(_tmp361==3))&&(((_tmp362=_tmp360[0]),(_tmp362=="data"))&&(((_tmp363=_tmp360[1]),(_tmp363===null))&&((b=_tmp360[2]),true)))))))))){var x=rx_quote2(b[1]);return (("[^"+x)+"]");}else{if((((_tmp353=expr),(_tmp353 instanceof Array))&&(((_tmp354=_tmp353.length),(_tmp354>=1))&&(((_tmp355=_tmp353[0]),(_tmp355=="data"))&&((args=_tmp353.slice(1)),true))))){return (("("+args.map(rx_build).join(""))+")");}else{if((((_tmp350=expr),(_tmp350 instanceof Array))&&(((_tmp351=_tmp350.length),(_tmp351>=1))&&(((_tmp352=_tmp350[0]),(_tmp352=="multi"))&&((args=_tmp350.slice(1)),true))))){return (("(?:"+args.map(rx_build).join(""))+")");}else{if(((otherA=expr),true)){throw "OopsF";}else{throw "Could not find a match";}}}}}}}}}}}}}}}}}}}}}}}};stdenv.register_macro("Rx",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)]]];});stdenv.register_macro("Rxg",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)],["value","g"]]];});stdenv.register_macro("?",function(env,context,_tmp419){var _tmp420;var _tmp421;var _tmp422;var expr;var _tmp423;if((((_tmp420=_tmp419),(_tmp420 instanceof Array))&&(((_tmp421=_tmp420.length),(_tmp421==3))&&(((_tmp422=_tmp420[0]),(_tmp422=="data"))&&((expr=_tmp420[1]),true,(_tmp423=_tmp420[2]),(_tmp423===null)))))){false;}else{throw "a condition failed";}var checker=function(){var other;var _tmp424;var _tmp425;var _tmp426;var _tmp427;var _tmp428;var _tmp429;var _tmp430;if(((_tmp430=expr),(_tmp430===null))){return ["send",expr,["value","__check__"]];}else{if(((_tmp429=expr),(_tmp429=="String"))){var f=function(env,context,_tmp431){var _tmp432;var _tmp433;var _tmp434;var expr;if((((_tmp432=_tmp431),(_tmp432 instanceof Array))&&(((_tmp433=_tmp432.length),(_tmp433==2))&&(((_tmp434=_tmp432[0]),(_tmp434=="data"))&&((expr=_tmp432[1]),true))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","string"]]];};return ["macro",f];}else{if(((_tmp428=expr),(_tmp428=="Number"))){var f=function(env,context,_tmp435){var _tmp436;var _tmp437;var _tmp438;var expr;if((((_tmp436=_tmp435),(_tmp436 instanceof Array))&&(((_tmp437=_tmp436.length),(_tmp437==2))&&(((_tmp438=_tmp436[0]),(_tmp438=="data"))&&((expr=_tmp436[1]),true))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","number"]]];};return ["macro",f];}else{if(((_tmp427=expr),(_tmp427=="true"))){return ["macro",make_exact_checker(["value",true])];}else{if(((_tmp426=expr),(_tmp426=="false"))){return ["macro",make_exact_checker(["value",false])];}else{if(((_tmp425=expr),(_tmp425=="null"))){return ["macro",make_exact_checker(["value",null])];}else{if(((_tmp424=expr),(_tmp424=="undefined"))){return ["macro",make_exact_checker(["value",undefined])];}else{if(((other=expr),true)){return ["send",expr,["value","__check__"]];}else{throw "Could not find a match";}}}}}}}}}();var mac=function(env,context,expr){var other;var _tmp439;if(((_tmp439=context),(_tmp439=="pattern"))){return ["check",checker,expr];}else{if(((other=context),true)){return ["send",checker,["data",expr]];}else{throw "Could not find a match";}}};return ["macro",mac];});var tempnum=0;var gensym=function(){var name=("_tmp"+tempnum);(tempnum=(tempnum+1));return name;};var parse_lhs=function(env,lhs,rhs){var vars=[];var clauses=[];var current=["multi"];var mktemp=function(){var t=gensym();vars.push(t);return t;};var newclause=function(){if((current.length>1)){clauses.push(current);}else{false;}return (current=["multi"]);};var helper=function(lhs,curr){return helper_noexpand(expand.step(env,"pattern",lhs),curr);};var helper_noexpand=function(lhs,curr){var other;var _tmp440;var _tmp441;var _tmp442;var specs;var _tmp443;var _tmp444;var _tmp445;var fname;var spec;var _tmp446;var _tmp447;var _tmp448;var checker;var expr;var _tmp449;var _tmp450;var _tmp451;var xs;var _tmp452;var _tmp453;var _tmp454;var xs;var _tmp455;var _tmp456;var _tmp457;var v;var _tmp458;var _tmp459;var _tmp461;var _tmp460;if(((_tmp459=lhs),(((_tmp460=_tmp459),(_tmp460===null))||((_tmp461=_tmp459),(_tmp461=="_"))))){return false;}else{if(((_tmp458=lhs),(typeof(_tmp458)=="string"))){vars.push(lhs);current.push(["assign",lhs,curr]);return current.push(["value",true]);}else{if((((_tmp455=lhs),(_tmp455 instanceof Array))&&(((_tmp456=_tmp455.length),(_tmp456==2))&&(((_tmp457=_tmp455[0]),(_tmp457=="value"))&&((v=_tmp455[1]),true))))){var x=["check",["macro",make_checker(lhs)],null];return helper_noexpand(x,curr);}else{if((((_tmp452=lhs),(_tmp452 instanceof Array))&&(((_tmp453=_tmp452.length),(_tmp453>=1))&&(((_tmp454=_tmp452[0]),(_tmp454=="all"))&&((xs=_tmp452.slice(1)),true))))){var temp=mktemp();(current=current.concat([["assign",temp,curr]]));return xs.forEach(function(x){return helper(x,temp);});}else{if((((_tmp449=lhs),(_tmp449 instanceof Array))&&(((_tmp450=_tmp449.length),(_tmp450>=1))&&(((_tmp451=_tmp449[0]),(_tmp451=="any"))&&((xs=_tmp449.slice(1)),true))))){var normalize=function(vars){return vars.filter(function(x){return (x.slice(0,4)!=="_tmp");}).sort().join(",");};var temp=mktemp();(current=current.concat([["assign",temp,curr]]));var myvars=undefined;var clauses=[];xs.forEach(function(x){var p=parse_lhs(env,x,temp);if((myvars===undefined)){(myvars=p[0]);}else{if((normalize(p[0])!==normalize(myvars))){throw [["Must have the same set of variables in both branches!",myvars]];}else{if(true){(vars=vars.concat(p[0]));}else{false;}}}return clauses.push(make_pattern_test(p[1]));});current.push(make_or_pattern(clauses));(vars=vars.concat(myvars));return newclause();}else{if((((_tmp446=lhs),(_tmp446 instanceof Array))&&(((_tmp447=_tmp446.length),(_tmp447==3))&&(((_tmp448=_tmp446[0]),(_tmp448=="check"))&&((checker=_tmp446[1]),true,(expr=_tmp446[2]),true))))){var temp=mktemp();(current=current.concat([["assign",temp,curr],["send",checker,["data",temp]]]));newclause();return helper(expr,temp);}else{if((((_tmp443=lhs),(_tmp443 instanceof Array))&&(((_tmp444=_tmp443.length),(_tmp444==3))&&(((_tmp445=_tmp443[0]),(_tmp445=="send"))&&((fname=_tmp443[1]),true,(spec=_tmp443[2]),true))))){return helper(fname,["send","->",["data",spec,curr]]);}else{if((((_tmp440=lhs),(_tmp440 instanceof Array))&&(((_tmp441=_tmp440.length),(_tmp441>=1))&&(((_tmp442=_tmp440[0]),(_tmp442=="data"))&&((specs=_tmp440.slice(1)),true))))){var fw=0;var bw=0;var rest=undefined;var members=specs.map(function(x){var v=expand.step(env,"pattern",x);if(((v instanceof Array)&&(v[0]=="dynsplice"))){(rest=v[1]);}else{if((rest===undefined)){(fw=(fw+1));}else{if(true){(bw=(bw+1));}else{false;}}}return v;});var cmp=function(){if((rest===undefined)){return "___eq";}else{if(true){return "___gte";}else{return false;}}}();var temp=mktemp();var len=mktemp();(current=current.concat([["assign",temp,curr],["send","___instanceof",["data",temp,"Array"]]]));newclause();(current=current.concat([["assign",len,["send",temp,["value","length"]]],["send",cmp,["data",len,["value",(fw+bw)]]]]));newclause();for(var j=0;(j<fw);(++j)){helper_noexpand(members[j],["send",temp,["value",j]]);}if((rest!==undefined)){var slice=function(){if((bw>0)){return ["data",["value",fw],["value",(-bw)]];}else{if(true){return ["data",["value",fw]];}else{return false;}}}();helper_noexpand(members[fw][1],["send",["send",temp,["value","slice"]],slice]);}else{false;}for(var j=0;(j<bw);(++j)){helper_noexpand(members[((fw+j)+1)],["send",temp,["send","___minus",["data",len,["value",(bw-j)]]]]);}}else{if(((other=lhs),true)){throw "OopsG";}else{throw "Could not find a match";}}}}}}}}}};helper(lhs,rhs);if((current.length>1)){clauses.push(current);}else{false;}return [vars,clauses];};var make_declarations=function(vars){return vars.map(function(name){return ["declare",name,["value",undefined]];});};var make_pattern_test=function(clauses){var ands=clauses.pop();while((clauses.length>0)){(ands=["send","___and",["data",clauses.pop(),ands]]);}return ands;};var make_or_pattern=function(clauses){var ors=clauses.pop();while((clauses.length>0)){(ors=["send","___or",["data",clauses.pop(),ors]]);}return ors;};stdenv.register_macro("|>",function(env,context,_tmp462){var _tmp463;var _tmp464;var _tmp465;var to_match;var cl;if((((_tmp463=_tmp462),(_tmp463 instanceof Array))&&(((_tmp464=_tmp463.length),(_tmp464==3))&&(((_tmp465=_tmp463[0]),(_tmp465=="data"))&&((to_match=_tmp463[1]),true,(cl=_tmp463[2]),true))))){false;}else{throw "a condition failed";}var clauses=function(){var other;var _tmp466;var _tmp467;var _tmp468;var cls;if((((_tmp466=cl),(_tmp466 instanceof Array))&&(((_tmp467=_tmp466.length),(_tmp467>=1))&&(((_tmp468=_tmp466[0]),(_tmp468=="multi"))&&((cls=_tmp466.slice(1)),true))))){return cls;}else{if(((other=cl),true)){return [other];}else{throw "Could not find a match";}}}();var decls=["multi"];var r=["js_throw",["value","Could not find a match"]];while((clauses.length>0)){var _tmp469;var _tmp470;var _tmp471;var _tmp472;var _tmp473;var _tmp474;var _tmp475;var lhs;var body;if((((_tmp469=clauses.pop()),(_tmp469 instanceof Array))&&(((_tmp470=_tmp469.length),(_tmp470==3))&&(((_tmp471=_tmp469[0]),(_tmp471=="send"))&&(((_tmp472=_tmp469[1]),(_tmp472=="->"))&&(((_tmp473=_tmp469[2]),(_tmp473 instanceof Array))&&(((_tmp474=_tmp473.length),(_tmp474==3))&&(((_tmp475=_tmp473[0]),(_tmp475=="data"))&&((lhs=_tmp473[1]),true,(body=_tmp473[2]),true))))))))){false;}else{throw "a condition failed";}var p=parse_lhs(env,lhs,to_match);var test=make_pattern_test(p[1]);(r=["if",test,body,r]);(decls=decls.concat(make_declarations(p[0])));}decls.push(r);return decls;});var js_op_table=({"___plus":"+","___minus":"-","___times":"*","___div":"/","___mod":"%","___binxor":"^","___binand":"&","___binor":"|","___binnot":"~","___and":"&&","___or":"||","___not":"!","___is":"===","___isnt":"!==","___eq":"==","___neq":"!=","___lt":"<","___gt":">","___lte":"<=","___gte":">=","___in":" in ","___instanceof":" instanceof ","___plusplus":"++","___minusminus":"--"});var translate=function(expr,mode){var other;var _tmp476;var _tmp477;var _tmp478;var f;var msg;var _tmp479;var _tmp480;var _tmp481;var f;var _tmp482;var _tmp483;var _tmp484;var args;var _tmp485;var _tmp486;var _tmp487;var f;var _tmp488;var msg;var _tmp489;var _tmp490;var _tmp491;var s;var _tmp492;var _tmp493;var _tmp494;var args;var _tmp495;var _tmp496;var _tmp497;var args;var _tmp498;var _tmp499;var _tmp500;var value;var _tmp501;var _tmp502;var _tmp503;var value;var _tmp504;var _tmp505;var _tmp506;var _tmp507;var _tmp508;var _tmp509;var _tmp510;var _tmp511;var _tmp512;var args;var _tmp513;var _tmp514;var _tmp515;var args;var _tmp516;var _tmp517;var _tmp518;var lhs;var rhs;var _tmp519;var _tmp520;var _tmp521;var binding;var value;var _tmp522;var _tmp523;var _tmp524;var binding;var _tmp525;var _tmp526;var _tmp527;var _tmp528;var _tmp529;var _tmp530;var _tmp531;var x;var y;var z;var body;var _tmp532;var _tmp533;var _tmp534;var test;var body;var _tmp535;var _tmp536;var _tmp537;var test;var pos;var neg;var _tmp538;var _tmp539;var _tmp540;var bindings;var body;var _tmp541;var _tmp542;var _tmp543;var v;var _tmp544;var _tmp545;if(((_tmp545=expr),(typeof(_tmp545)=="string"))){return translate.expr(translate.mangle(expr),mode);}else{if(((_tmp544=expr),(_tmp544===null))){return translate.expr("null",mode);}else{if((((_tmp541=expr),(_tmp541 instanceof Array))&&(((_tmp542=_tmp541.length),(_tmp542==2))&&(((_tmp543=_tmp541[0]),(_tmp543=="value"))&&((v=_tmp541[1]),true))))){var r=function(){var other;var _tmp546;var _tmp554;var _tmp547;var _tmp553;var _tmp548;var _tmp552;var _tmp549;var _tmp551;var _tmp550;var _tmp555;if(((_tmp555=v),(typeof(_tmp555)=="string"))){var repl=({"\"":"\\\"","\n":"\\n","\\":"\\\\"});(v=v.replace(RegExp("((?:(?:\"|\\\\)|\n))","g"),function(m){return repl[m];}));return (("\""+v)+"\"");}else{if(((_tmp546=v),(((_tmp547=_tmp546),(((_tmp548=_tmp547),(((_tmp549=_tmp548),(((_tmp550=_tmp549),(typeof(_tmp550)=="number"))||((_tmp551=_tmp549),(_tmp551===true))))||((_tmp552=_tmp548),(_tmp552===false))))||((_tmp553=_tmp547),(_tmp553===null))))||((_tmp554=_tmp546),(_tmp554===undefined))))){return String(v);}else{if(((other=v),true)){return (("?!?["+v)+"]?!?");}else{throw "Could not find a match";}}}}();return translate.expr(r,mode);}else{if((((_tmp538=expr),(_tmp538 instanceof Array))&&(((_tmp539=_tmp538.length),(_tmp539==3))&&(((_tmp540=_tmp538[0]),(_tmp540=="lambda"))&&((bindings=_tmp538[1]),true,(body=_tmp538[2]),true))))){var a=bindings.join(",");var b=translate.body(body,"return");return translate.expr((((("function("+a)+"){")+b)+"}"),mode);}else{if((((_tmp535=expr),(_tmp535 instanceof Array))&&(((_tmp536=_tmp535.length),(_tmp536==4))&&(((_tmp537=_tmp535[0]),(_tmp537=="if"))&&((test=_tmp535[1]),true,(pos=_tmp535[2]),true,(neg=_tmp535[3]),true))))){var other;var _tmp556;if(((_tmp556=mode),(_tmp556=="expr"))){return translate.body(expr,"expr");}else{if(((other=mode),true)){var a=translate(test,"expr");var b=translate(pos,mode);var c=translate(neg,mode);return (((((("if("+a)+"){")+b)+"}else{")+c)+"}");}else{throw "Could not find a match";}}}else{if((((_tmp532=expr),(_tmp532 instanceof Array))&&(((_tmp533=_tmp532.length),(_tmp533==3))&&(((_tmp534=_tmp532[0]),(_tmp534=="js_while"))&&((test=_tmp532[1]),true,(body=_tmp532[2]),true))))){var other;var _tmp557;if(((_tmp557=mode),(_tmp557=="expr"))){return translate.body(expr,"expr");}else{if(((other=mode),true)){var a=translate(test,"expr");var b=translate(body,"stmt");return (((("while("+a)+"){")+b)+"}");}else{throw "Could not find a match";}}}else{if((((_tmp529=expr),(_tmp529 instanceof Array))&&(((_tmp530=_tmp529.length),(_tmp530==5))&&(((_tmp531=_tmp529[0]),(_tmp531=="js_for"))&&((x=_tmp529[1]),true,(y=_tmp529[2]),true,(z=_tmp529[3]),true,(body=_tmp529[4]),true))))){var other;var _tmp558;if(((_tmp558=mode),(_tmp558=="expr"))){return translate.body(expr,"expr");}else{if(((other=mode),true)){var a=translate(x,"stmt");var b=translate(y,"stmt");var c=translate(z,"expr");var d=translate(body,"stmt");return (((((("for("+a)+b)+c)+"){")+d)+"}");}else{throw "Could not find a match";}}}else{if((((_tmp522=expr),(_tmp522 instanceof Array))&&(((_tmp523=_tmp522.length),(_tmp523==3))&&(((_tmp524=_tmp522[0]),(_tmp524=="declare"))&&(((binding=_tmp522[1]),true,(_tmp525=_tmp522[2]),(_tmp525 instanceof Array))&&(((_tmp526=_tmp525.length),(_tmp526==2))&&(((_tmp527=_tmp525[0]),(_tmp527=="value"))&&((_tmp528=_tmp525[1]),(_tmp528===undefined))))))))){var other;var _tmp559;var _tmp561;var _tmp560;if(((_tmp559=mode),(((_tmp560=_tmp559),(_tmp560=="expr"))||((_tmp561=_tmp559),(_tmp561=="return"))))){throw "Invalid in expr ctx";}else{if(((other=mode),true)){var a=translate(binding,"expr");return (("var "+a)+";");}else{throw "Could not find a match";}}}else{if((((_tmp519=expr),(_tmp519 instanceof Array))&&(((_tmp520=_tmp519.length),(_tmp520==3))&&(((_tmp521=_tmp519[0]),(_tmp521=="declare"))&&((binding=_tmp519[1]),true,(value=_tmp519[2]),true))))){var other;var _tmp562;var _tmp564;var _tmp563;if(((_tmp562=mode),(((_tmp563=_tmp562),(_tmp563=="expr"))||((_tmp564=_tmp562),(_tmp564=="return"))))){throw "Invalid in expr ctx";}else{if(((other=mode),true)){var a=translate(binding,"expr");var b=translate(value,"expr");return (((("var "+a)+"=")+b)+";");}else{throw "Could not find a match";}}}else{if((((_tmp516=expr),(_tmp516 instanceof Array))&&(((_tmp517=_tmp516.length),(_tmp517==3))&&(((_tmp518=_tmp516[0]),(_tmp518=="assign"))&&((lhs=_tmp516[1]),true,(rhs=_tmp516[2]),true))))){var a=translate(lhs,"expr");var b=translate(rhs,"expr");return translate.expr((((("("+a)+"=")+b)+")"),mode);}else{if((((_tmp513=expr),(_tmp513 instanceof Array))&&(((_tmp514=_tmp513.length),(_tmp514>=1))&&(((_tmp515=_tmp513[0]),(_tmp515=="multi"))&&((args=_tmp513.slice(1)),true))))){var isdecl=function(x){return ((x instanceof Array)&&(x[0]=="declare"));};if((args.length==1)){return translate(args[0],mode);}else{if(((mode=="expr")&&(!args.some(isdecl)))){var xs=args.map(function(x){return translate(x,"expr");});return (("("+xs.join(","))+")");}else{if(true){return translate.body(expr,mode);}else{return false;}}}}else{if((((_tmp510=expr),(_tmp510 instanceof Array))&&(((_tmp511=_tmp510.length),(_tmp511>=1))&&(((_tmp512=_tmp510[0]),(_tmp512=="splice"))&&((args=_tmp510.slice(1)),true))))){return translate(["multi"].concat(args),mode);}else{if((((_tmp507=expr),(_tmp507 instanceof Array))&&(((_tmp508=_tmp507.length),(_tmp508==1))&&((_tmp509=_tmp507[0]),(_tmp509=="js_break"))))){if((mode=="expr")){throw "Invalid break in ctx";}else{if(true){return "break;";}else{return false;}}}else{if((((_tmp504=expr),(_tmp504 instanceof Array))&&(((_tmp505=_tmp504.length),(_tmp505==1))&&((_tmp506=_tmp504[0]),(_tmp506=="js_continue"))))){if((mode=="expr")){throw "Invalid continue in ctx";}else{if(true){return "continue;";}else{return false;}}}else{if((((_tmp501=expr),(_tmp501 instanceof Array))&&(((_tmp502=_tmp501.length),(_tmp502==2))&&(((_tmp503=_tmp501[0]),(_tmp503=="js_return"))&&((value=_tmp501[1]),true))))){if((mode=="expr")){throw "Invalid return in ctx";}else{if(true){return (("return "+translate(value,"expr"))+";");}else{return false;}}}else{if((((_tmp498=expr),(_tmp498 instanceof Array))&&(((_tmp499=_tmp498.length),(_tmp499==2))&&(((_tmp500=_tmp498[0]),(_tmp500=="js_throw"))&&((value=_tmp498[1]),true))))){if(true){return (("throw "+translate(value,"expr"))+";");}else{return false;}}else{if((((_tmp495=expr),(_tmp495 instanceof Array))&&(((_tmp496=_tmp495.length),(_tmp496>=1))&&(((_tmp497=_tmp495[0]),(_tmp497=="array"))&&((args=_tmp495.slice(1)),true))))){var r=function(){var f=function(x){return translate(x,"expr");};return (("["+args.map(f).join(","))+"]");}();return translate.expr(r,mode);}else{if((((_tmp492=expr),(_tmp492 instanceof Array))&&(((_tmp493=_tmp492.length),(_tmp493>=1))&&(((_tmp494=_tmp492[0]),(_tmp494=="object"))&&((args=_tmp492.slice(1)),true))))){var r=function(){var f=function(x){var a=translate(x[1],"expr");var b=translate(x[2],"expr");return ((a+":")+b);};return (("({"+args.map(f).join(","))+"})");}();return translate.expr(r,mode);}else{if((((_tmp485=expr),(_tmp485 instanceof Array))&&(((_tmp486=_tmp485.length),(_tmp486==3))&&(((_tmp487=_tmp485[0]),(_tmp487=="send"))&&(((f=_tmp485[1]),true,(_tmp488=_tmp485[2]),(msg=_tmp488),true,(_tmp489=_tmp488),(_tmp489 instanceof Array))&&(((_tmp490=_tmp489.length),(_tmp490==2))&&(((_tmp491=_tmp489[0]),(_tmp491=="value"))&&((s=_tmp489[1]),true)))))))){if(((typeof(s)=="string")&&s.match(RegExp("(?:^(?:[a-zA-Z_$]+)$)")))){var trf=translate(f,"expr");var trmsg=translate(s,"expr");return translate.expr(((trf+".")+trmsg),mode);}else{if(true){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{return false;}}}else{if((((_tmp479=expr),(_tmp479 instanceof Array))&&(((_tmp480=_tmp479.length),(_tmp480==3))&&(((_tmp481=_tmp479[0]),(_tmp481=="send"))&&(((f=_tmp479[1]),true,(_tmp482=_tmp479[2]),(_tmp482 instanceof Array))&&(((_tmp483=_tmp482.length),(_tmp483>=1))&&(((_tmp484=_tmp482[0]),(_tmp484=="array"))&&((args=_tmp482.slice(1)),true)))))))){var op=((typeof(f)=="string")&&js_op_table[f]);if(op){return translate.expr(translate.op(op,args[0],args[1]),mode);}else{if(true){var trf=translate(f,"expr");var trargs=args.map(function(x){return translate(x,"expr");});return translate.expr((((trf+"(")+trargs.join(","))+")"),mode);}else{return false;}}}else{if((((_tmp476=expr),(_tmp476 instanceof Array))&&(((_tmp477=_tmp476.length),(_tmp477==3))&&(((_tmp478=_tmp476[0]),(_tmp478=="send"))&&((f=_tmp476[1]),true,(msg=_tmp476[2]),true))))){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{if(((other=expr),true)){throw other;}else{throw "Could not find a match";}}}}}}}}}}}}}}}}}}}}}}};(translate.mangle=function(name){var tr=({"+":"__plus__","-":"__minus__","*":"__asterisk__","/":"__slash__","%":"__percent__","^":"__caret__","#":"__hash__","&":"__amp__","|":"__pipe__","@":"__at__","!":"__bang__","?":"__qmark__","=":"__equal__","<":"__lt__",">":"__gt__","~":"__tilde__"});var r=[];for(var i=0;(i<name.length);(++i)){var c=name[i];r.push((tr[c]||c));}return r.join("");});(translate.body=function(b,mode){(orig=b);(b=aslist(b));var trst=function(stmt){return translate(stmt,"stmt");};var other;var _tmp565;var _tmp566;var _tmp567;if(((_tmp567=mode),(_tmp567=="expr"))){var x=["send",["lambda",[],orig],["array"]];return translate(x,mode);}else{if(((_tmp566=mode),(_tmp566=="return"))){var stmts=b.slice(0,(-1));var ret=b[(b.length-1)];return (stmts.map(trst).join("")+translate(ret,"return"));}else{if(((_tmp565=mode),(_tmp565=="stmt"))){return b.map(trst).join("");}else{if(((other=mode),true)){throw "OopsH";}else{throw "Could not find a match";}}}}});(translate.expr=function(x,mode){var other;var _tmp568;var _tmp569;var _tmp570;if(((_tmp570=mode),(_tmp570=="expr"))){return x;}else{if(((_tmp569=mode),(_tmp569=="stmt"))){return (x+";");}else{if(((_tmp568=mode),(_tmp568=="return"))){return (("return "+x)+";");}else{if(((other=mode),true)){throw "OopsI";}else{throw "Could not find a match";}}}}});(translate.op=function(op,a,b){(e=function(){if((a===null)){return (op+translate(b,"expr"));}else{if((b===null)){return (translate(a,"expr")+op);}else{if(true){return ((translate(a,"expr")+op)+translate(b,"expr"));}else{return false;}}}}());return (("("+e)+")");});var fs=require("fs");var file=process.argv[2];var f=function(err,data){var p=parse(data);var ex=expand(stdenv,"top",["multi",p]);var prelude="var ___lib=require(\"./lib\");";return console.log((prelude+translate(ex,"stmt")));};fs.readFile(file,"utf8",f);
