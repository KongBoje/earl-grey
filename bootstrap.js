var ___lib=require("./lib");var special_ops=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",":":"IFX",".":"PFX"});var regexps=function(){var id=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))");var id_f=function(m,wsb,wsa,last_op){return ["ID","ID",m[0]];};var numr=RegExp("(?:^((?:\\d+))[rR]((?:[A-Za-z0-9_]+))(?:(?:\\.((?:[A-Za-z0-9_]+)))?))");var numr_f=function(m,wsb,wsa,last_op){var _tmp0;var _tmp1;var radix;var int;var frac;if((((_tmp0=m),(_tmp0 instanceof Array))&&(((_tmp1=_tmp0.length),(_tmp1==4))&&((radix=_tmp0[1]),true,(int=_tmp0[2]),true,(frac=_tmp0[3]),true)))){false;}else{throw "a condition failed";}(value=parseInt(int.replace(RegExp("_","g"),""),radix));if(frac){(frac=frac.replace(RegExp("_","g"),""));(value=(value+(parseInt(frac,radix)/Math.pow(radix,frac.length))));}else{false;}return ["ID","NUM",value];};var num=RegExp("(?:^((?:[0-9_]+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:[0-9_]+)))?))");var num_f=function(m,wsb,wsa,last_op){return ["ID","NUM",parseFloat(m[0].replace(RegExp("_","g"),""))];};var str=RegExp("(?:^\"((?:(?:(?:\\\\\\\\|\\\\\")|[^\"])*))\")");var str_f=function(m,wsb,wsa,last_op){var repl=({"\\\"":"\"","\\\\":"\\","\\n":"\n"});var r=m[1].replace(RegExp("((?:(?:\\\\\"|\\\\\\\\)|\\\\n))","g"),function(m){return repl[m];});return ["ID","STR",r];};var op=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!#.:]+))");var op2=RegExp("(?:^[\\(\\[\\{\\}\\]\\),])");var op3=RegExp("(?:^(?:(?:(?:(?:(?:(?:(?:with|where)|and)|not)|or)|in)|instanceof)|mod)\\b)");var op4=RegExp("(?:^`((?:[A-Za-z0-9_]+))`)");var op_f=function(m,wsb,wsa,last_op){var op=(m[1]||m[0]);if((op in special_ops)){var fixity=special_ops[op];var width=function(){var other;var _tmp2;var _tmp3;var _tmp4;if(((_tmp4=fixity),(_tmp4=="IFX"))){if((wsb||wsa)){return "wide";}else{return "short";}}else{if(((_tmp3=fixity),(_tmp3=="SFX"))){if(wsb){return "wide";}else{return "short";}}else{if(((_tmp2=fixity),(_tmp2=="PFX"))){if(wsa){return "wide";}else{return "short";}}else{if(((other=fixity),true)){throw "OopsA";}else{throw "Could not find a match";}}}}}();return ["OP",fixity,width,op];}else{if((wsa&&wsb)){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "IFX";}else{return false;}}}(),"wide",op];}else{if(((!wsa)&&(!wsb))){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "IFX";}else{return false;}}}(),"short",op];}else{if(wsa){if(last_op){return ["OP","PFX","wide",op];}else{if(true){return ["OP","SFX","short",op];}else{return false;}}}else{if(wsb){return ["OP","PFX","short",op];}else{if(true){return ["OP","PFX","short",op];}else{return false;}}}}}}};var indent=RegExp("(?:^(?:(?:\n((?: *)))+))");var indent_f=function(m,wsb,wsa,last_op){var ilen=m[1].length;return ["INDENT",ilen];};var cmnt=RegExp("(?:^;(?:[^\n]*))");var cmnt_f=function(m,wsb,wsa,last_op){return ["IGNORE"];};var unkn=RegExp("(?:^.)");var unkn_f=function(m,wsb,wsa,last_op){throw ("unknown character: "+m[0]);};return [[op3,op_f],[id,id_f],[numr,numr_f],[num,num_f],[str,str_f],[op,op_f],[op2,op_f],[op4,op_f],[indent,indent_f],[cmnt,cmnt_f],[unkn,unkn_f]];}();var ws_re=RegExp("(?:^(?: *)(?:(?:\n(?: *)\\\\(?: *))*))");var eol_re=RegExp("(?:^(?: *)(?:\n|$))");var indent_tracker=function(){var curr=false;var stack=[];var stacks=[stack];return function(token){var other;var _tmp5;var _tmp6;var _tmp7;var fixity;var width;var _tmp8;var _tmp10;var _tmp9;var _tmp11;var _tmp12;var _tmp13;var fixity;var width;var _tmp14;var _tmp16;var _tmp15;var _tmp17;var _tmp18;var _tmp19;var stuff;var _tmp20;var _tmp21;var _tmp22;var new_indent;if((((_tmp20=token),(_tmp20 instanceof Array))&&(((_tmp21=_tmp20.length),(_tmp21==2))&&(((_tmp22=_tmp20[0]),(_tmp22=="INDENT"))&&((new_indent=_tmp20[1]),true))))){if((curr===false)){(curr=new_indent);return [["OP","IFX","wide",","]];}else{if((new_indent>curr)){stack.push(curr);(curr=new_indent);return [["OP","PFX","wide","["]];}else{if((new_indent==curr)){return [["OP","IFX","wide",","]];}else{if((new_indent<curr)){var rval=[];while(((stack.length>0)&&(new_indent<curr))){(curr=stack.pop());rval.push(["OP","SFX","wide","]"]);}rval.push(["OP","IFX","wide",","]);return rval;}else{if(true){throw [curr,new_indent];}else{return false;}}}}}}else{if((((_tmp17=token),(_tmp17 instanceof Array))&&(((_tmp18=_tmp17.length),(_tmp18>=1))&&(((_tmp19=_tmp17[0]),(_tmp19=="ID"))&&((stuff=_tmp17.slice(1)),true))))){return [token];}else{if((((_tmp11=token),(_tmp11 instanceof Array))&&(((_tmp12=_tmp11.length),(_tmp12==4))&&(((_tmp13=_tmp11[0]),(_tmp13=="OP"))&&((fixity=_tmp11[1]),true,(width=_tmp11[2]),true,(_tmp14=_tmp11[3]),(((_tmp15=_tmp14),(_tmp15=="["))||((_tmp16=_tmp14),(_tmp16=="{")))))))){stack.push(curr);stacks.push(stack);(stack=[]);(curr=false);return [token];}else{if((((_tmp5=token),(_tmp5 instanceof Array))&&(((_tmp6=_tmp5.length),(_tmp6==4))&&(((_tmp7=_tmp5[0]),(_tmp7=="OP"))&&((fixity=_tmp5[1]),true,(width=_tmp5[2]),true,(_tmp8=_tmp5[3]),(((_tmp9=_tmp8),(_tmp9=="]"))||((_tmp10=_tmp8),(_tmp10=="}")))))))){var rval=stack.map(function(x){return ["OP","SFX","short","]"];});(stack=stacks.pop());(curr=stack.pop());rval.push(token);return rval;}else{if(((other=token),true)){return [token];}else{throw "Could not find a match";}}}}}};};var process_token=function(token,last_op,wsa,wsb,pos,endpos,accum){var _tmp23;var _tmp24;var type;var result;if((((_tmp23=token),(_tmp23 instanceof Array))&&(((_tmp24=_tmp23.length),(_tmp24>=1))&&((type=_tmp23[0]),true,(result=_tmp23.slice(1)),true)))){false;}else{throw "a condition failed";}var other;var _tmp25;var _tmp26;var _tmp27;if(((_tmp27=type),(_tmp27=="IGNORE"))){return last_op;}else{if(((_tmp26=type),(_tmp26=="ID"))){if((!last_op)){var w=["IFX",function(){if(wsb){return "wide";}else{return "short";}}(),"WHITE"];(w.location=[pos,pos]);accum.push(w);}else{false;}accum.push(result);return false;}else{if(((_tmp25=type),(_tmp25=="OP"))){if(last_op){var v=["VOID"];(v.location=[pos,pos]);accum.push(v);}else{false;}var _tmp28;var _tmp29;var _tmp30;if(((_tmp30=result[0]),(_tmp30=="IFX"))){accum.push(result);return true;}else{if(((_tmp29=result[0]),(_tmp29=="PFX"))){if((!last_op)){var w=["IFX",function(){if(wsb){return "wide";}else{return "short";}}(),"WHITE"];(w.location=[pos,pos]);var v=["VOID"];(v.location=[pos,pos]);accum.push(w);accum.push(v);}else{false;}accum.push(result);return true;}else{if(((_tmp28=result[0]),(_tmp28=="SFX"))){accum.push(result);var v=["VOID"];(v.location=[endpos,endpos]);accum.push(v);return false;}else{throw "Could not find a match";}}}}else{if(((other=type),true)){throw "OopsB";}else{throw "Could not find a match";}}}}};var tokenize=function(text){var last_op=true;var results=[];var wsb=text.match(ws_re)[0].length;(text=text.slice(wsb));(pos=wsb);var indent=indent_tracker();while(text){for(var i=0;(i<regexps.length);(++i)){var _tmp31;var _tmp32;var re;var fn;if((((_tmp31=regexps[i]),(_tmp31 instanceof Array))&&(((_tmp32=_tmp31.length),(_tmp32==2))&&((re=_tmp31[0]),true,(fn=_tmp31[1]),true)))){false;}else{throw "a condition failed";}var m=text.match(re);if(m){var skip=m[0].length;var endpos=(pos+skip);(text=text.slice(skip));var wsa=text.match(ws_re)[0].length;var eol=(text.match(eol_re)&&true);var bwsb=(wsb>0);var bwsa=function(){if(eol){return bwsb;}else{return (wsa>0);}}();var token=fn(m,bwsb,bwsa,last_op);var tokens=indent(token);tokens.forEach(function(x){return (last_op=process_token(x,last_op,bwsa,bwsb,pos,endpos,results));});(text=text.slice(wsa));(wsb=wsa);(pos=(endpos+wsa));break;}else{false;}}}if(last_op){var v=["VOID"];(v.location=[pos,pos]);results.push(v);}else{false;}return results;};var MAX=(1/0);var order_map=({"IFX":({"wide":({",":[[15,1],[15,1]],"with":[[15,999],[15,10]],"where":[[15,11],[15,10]],"|>":[[15,11],[15,10]],"->":[[15,11],[15,10]],"=>":[[15,11],[15,10]],"=":[[15,11],[15,10]],":=":[[15,11],[15,10]],"+=":[[15,11],[15,10]],"-=":[[15,11],[15,10]],"*=":[[15,11],[15,10]],"/=":[[15,11],[15,10]],"<<=":[[15,11],[15,10]],">>=":[[15,11],[15,10]],">>>=":[[15,11],[15,10]],"||":[[15,100],[15,101]],"&&":[[15,110],[15,111]],"or":[[15,100],[15,101]],"and":[[15,110],[15,111]],"not":[[15,120],[15,121]],"==":[[15,200],[15,201]],"!=":[[15,200],[15,201]],">=":[[15,200],[15,201]],"<=":[[15,200],[15,201]],">":[[15,200],[15,201]],"<":[[15,200],[15,201]],"^.":[[15,400],[15,401]],"|.":[[15,410],[15,411]],"&.":[[15,420],[15,421]],"<<":[[1,500],[1,501]],">>":[[1,500],[1,501]],">>>":[[1,500],[1,501]],"+":[[1,550],[1,551]],"-":[[1,550],[1,551]],"*":[[1,560],[1,561]],"/":[[1,560],[1,561]],"mod":[[1,560],[1,561]],"**":[[1,571],[1,570]],"default":[[8,900],[4,901]],"WHITE":[[15,1000],[15,1001]],":":[[15,1001],[15,2]]}),"short":({"default":[[15,1900],[15,1901]],"WHITE":[[15,2000],[15,2001]],",":[[15,1],[15,1]],":":[[15,1001],[15,2]]})}),"PFX":({"wide":({"default":[[15,MAX],[15,900]],".":[[15,MAX],[15,3000]],"#":[[15,MAX],[15,3000]],"<>":[[15,MAX],[15,5]],"(":[[15,MAX],[15,1]],"[":[[15,MAX],[15,1]],"{":[[15,MAX],[15,1]]}),"short":({"default":[[15,MAX],[15,1900]],".":[[15,MAX],[15,3000]],"#":[[15,MAX],[15,3000]],"(":[[15,MAX],[15,1]],"[":[[15,MAX],[15,1]],"{":[[15,MAX],[15,1]]})}),"SFX":({"wide":({"default":[[15,901],[15,MAX]],")":[[15,1],[15,MAX]],"]":[[15,1],[15,MAX]],"}":[[15,1],[15,MAX]]}),"short":({"default":[[15,1901],[15,MAX]],")":[[15,1],[15,MAX]],"]":[[15,1],[15,MAX]],"}":[[15,1],[15,MAX]]})})});var DONE=(-1);var NONE=0;var LEFT=1;var RIGHT=2;var BOTH=3;var oparse=function(next,order,finalize){var between=finalize(next());var right_op=next();var stack=[];var left_op=null;var current=null;while(true){var o=function(){if(((!left_op)&&(!right_op))){return DONE;}else{if(true){return ((((!left_op)&&RIGHT)||((!right_op)&&LEFT))||order(left_op,right_op));}else{return false;}}}();var other;var _tmp33;var _tmp34;var _tmp35;var _tmp36;var _tmp37;if(((_tmp37=o),(_tmp37==DONE))){return between;}else{if(((_tmp36=o),(_tmp36==LEFT))){current.push(between);(between=finalize(current));var v=stack.pop();(left_op=v[0]);(current=v[1]);}else{if(((_tmp35=o),(_tmp35==RIGHT))){stack.push([left_op,current]);(left_op=right_op);(current=[[right_op],between]);(between=finalize(next()));(right_op=next());}else{if(((_tmp34=o),(_tmp34==BOTH))){current[0].push(right_op);current.push(between);(left_op=right_op);(between=finalize(next()));(right_op=next());}else{if(((_tmp33=o),(_tmp33==NONE))){throw ((("Undefined priority between "+left_op)+" and ")+right_op);}else{if(((other=o),true)){throw "OopsC";}else{throw "Could not find a match";}}}}}}}};var consult=function(_tmp38){var _tmp39;var _tmp40;var fixity;var width;var op;if((((_tmp39=_tmp38),(_tmp39 instanceof Array))&&(((_tmp40=_tmp39.length),(_tmp40==3))&&((fixity=_tmp39[0]),true,(width=_tmp39[1]),true,(op=_tmp39[2]),true)))){false;}else{throw "a condition failed";}var map=order_map[fixity][width];return (map[op]||map.default);};var order=function(o1,o2){var _tmp41;var _tmp42;var code1;var ord1;if((((_tmp41=consult(o1)[1]),(_tmp41 instanceof Array))&&(((_tmp42=_tmp41.length),(_tmp42==2))&&((code1=_tmp41[0]),true,(ord1=_tmp41[1]),true)))){false;}else{throw "a condition failed";}var _tmp43;var _tmp44;var code2;var ord2;if((((_tmp43=consult(o2)[0]),(_tmp43 instanceof Array))&&(((_tmp44=_tmp43.length),(_tmp44==2))&&((code2=_tmp43[0]),true,(ord2=_tmp43[1]),true)))){false;}else{throw "a condition failed";}if(((code1&code2)==0)){throw ["Cannot mix",o1,o2];}else{if((ord1>ord2)){return LEFT;}else{if((ord1<ord2)){return RIGHT;}else{if((ord1==ord2)){return BOTH;}else{return false;}}}}};var finalize=function(x){var other;var _tmp45;var _tmp46;var ops;var args;var _tmp47;var _tmp48;var _tmp49;var _tmp50;var _tmp51;var _tmp52;var value;var _tmp53;var _tmp54;var _tmp55;var value;var _tmp56;var _tmp57;var _tmp58;var value;if((((_tmp56=x),(_tmp56 instanceof Array))&&(((_tmp57=_tmp56.length),(_tmp57==2))&&(((_tmp58=_tmp56[0]),(_tmp58=="ID"))&&((value=_tmp56[1]),true))))){return value;}else{if((((_tmp53=x),(_tmp53 instanceof Array))&&(((_tmp54=_tmp53.length),(_tmp54==2))&&(((_tmp55=_tmp53[0]),(_tmp55=="NUM"))&&((value=_tmp53[1]),true))))){return ["value",value];}else{if((((_tmp50=x),(_tmp50 instanceof Array))&&(((_tmp51=_tmp50.length),(_tmp51==2))&&(((_tmp52=_tmp50[0]),(_tmp52=="STR"))&&((value=_tmp50[1]),true))))){return ["value",value];}else{if((((_tmp47=x),(_tmp47 instanceof Array))&&(((_tmp48=_tmp47.length),(_tmp48==1))&&((_tmp49=_tmp47[0]),(_tmp49=="VOID"))))){return null;}else{if((((_tmp45=x),(_tmp45 instanceof Array))&&(((_tmp46=_tmp45.length),(_tmp46>=1))&&((ops=_tmp45[0]),true,(args=_tmp45.slice(1)),true)))){(ops=ops.map(function(o){return o[2];}));var op=ops[0];var other;var _tmp59;var _tmp60;var _tmp61;var _tmp62;var _tmp63;var _tmp64;var a;var b;var _tmp65;var _tmp66;var _tmp67;var _tmp68;var _tmp69;var _tmp70;var _tmp71;var _tmp72;var _tmp73;var _tmp74;var _tmp75;var _tmp76;var _tmp77;var _tmp78;var _tmp79;var _tmp80;var _tmp81;var _tmp82;var _tmp83;var _tmp84;var _tmp85;var _tmp86;var _tmp87;var _tmp89;var _tmp88;var _tmp90;var _tmp91;var _tmp92;var _tmp93;var _tmp94;var _tmp95;var _tmp96;var target;var body;var _tmp97;var _tmp98;var _tmp99;var _tmp100;var _tmp101;var _tmp102;var _tmp103;var f;var body;var _tmp104;var _tmp105;var _tmp106;var _tmp107;var _tmp108;var _tmp109;var _tmp110;var _tmp111;var f;var arg;var body;if((((_tmp104=[ops,args]),(_tmp104 instanceof Array))&&(((_tmp105=_tmp104.length),(_tmp105==2))&&(((_tmp106=_tmp104[0]),(_tmp106 instanceof Array))&&(((_tmp107=_tmp106.length),(_tmp107==2))&&(((_tmp108=_tmp106[0]),(_tmp108=="WHITE"))&&(((_tmp109=_tmp106[1]),(_tmp109==":"))&&(((_tmp110=_tmp104[1]),(_tmp110 instanceof Array))&&(((_tmp111=_tmp110.length),(_tmp111==3))&&((f=_tmp110[0]),true,(arg=_tmp110[1]),true,(body=_tmp110[2]),true)))))))))){return ["send",f,["data",["code",arg],["code",body]]];}else{if((((_tmp97=[ops,args]),(_tmp97 instanceof Array))&&(((_tmp98=_tmp97.length),(_tmp98==2))&&(((_tmp99=_tmp97[0]),(_tmp99 instanceof Array))&&(((_tmp100=_tmp99.length),(_tmp100==1))&&(((_tmp101=_tmp99[0]),(_tmp101==":"))&&(((_tmp102=_tmp97[1]),(_tmp102 instanceof Array))&&(((_tmp103=_tmp102.length),(_tmp103==2))&&((f=_tmp102[0]),true,(body=_tmp102[1]),true))))))))){return ["send",f,["data",["code",body]]];}else{if((((_tmp90=[ops,args]),(_tmp90 instanceof Array))&&(((_tmp91=_tmp90.length),(_tmp91==2))&&(((_tmp92=_tmp90[0]),(_tmp92 instanceof Array))&&(((_tmp93=_tmp92.length),(_tmp93==1))&&(((_tmp94=_tmp92[0]),(_tmp94=="with"))&&(((_tmp95=_tmp90[1]),(_tmp95 instanceof Array))&&(((_tmp96=_tmp95.length),(_tmp96==2))&&((target=_tmp95[0]),true,(body=_tmp95[1]),true))))))))){(body=function(){var other;var _tmp122;var _tmp123;var _tmp124;var rest;if((((_tmp122=body),(_tmp122 instanceof Array))&&(((_tmp123=_tmp122.length),(_tmp123>=1))&&(((_tmp124=_tmp122[0]),(_tmp124=="multi"))&&((rest=_tmp122.slice(1)),true))))){return rest;}else{if(((other=body),true)){return [body];}else{throw "Could not find a match";}}}());var other;var _tmp112;var _tmp113;var _tmp114;var args;var _tmp115;var _tmp116;var _tmp117;var f;var _tmp118;var _tmp119;var _tmp120;var args;var _tmp121;if(((_tmp121=target),(_tmp121===null))){return ["data"].concat(body);}else{if((((_tmp115=target),(_tmp115 instanceof Array))&&(((_tmp116=_tmp115.length),(_tmp116==3))&&(((_tmp117=_tmp115[0]),(_tmp117=="send"))&&(((f=_tmp115[1]),true,(_tmp118=_tmp115[2]),(_tmp118 instanceof Array))&&(((_tmp119=_tmp118.length),(_tmp119>=1))&&(((_tmp120=_tmp118[0]),(_tmp120=="data"))&&((args=_tmp118.slice(1)),true)))))))){return ["send",f,["data"].concat(args).concat(body)];}else{if((((_tmp112=target),(_tmp112 instanceof Array))&&(((_tmp113=_tmp112.length),(_tmp113>=1))&&(((_tmp114=_tmp112[0]),(_tmp114=="data"))&&((args=_tmp112.slice(1)),true))))){return target.concat(body);}else{if(((other=target),true)){return ["send",target,["data"].concat(body)];}else{throw "Could not find a match";}}}}}else{if((((_tmp83=[ops,args]),(_tmp83 instanceof Array))&&(((_tmp84=_tmp83.length),(_tmp84==2))&&(((_tmp85=_tmp83[0]),(_tmp85 instanceof Array))&&(((_tmp86=_tmp85.length),(_tmp86>=1))&&((_tmp87=_tmp85[0]),(((_tmp88=_tmp87),(_tmp88=="["))||((_tmp89=_tmp87),(_tmp89==","))))))))){if((op=="[")){(args=args.slice(1,(-1)));}else{false;}(args=function(){var f=function(x){return (x!==null);};return args.filter(f);}());var result=function(){var other;var _tmp125;var _tmp126;var x;var _tmp127;var _tmp128;if((((_tmp127=args),(_tmp127 instanceof Array))&&((_tmp128=_tmp127.length),(_tmp128==0)))){throw "At least one expression must be enclosed in []";}else{if((((_tmp125=args),(_tmp125 instanceof Array))&&(((_tmp126=_tmp125.length),(_tmp126==1))&&((x=_tmp125[0]),true)))){return x;}else{if(((other=args),true)){return ["multi"].concat(args);}else{throw "Could not find a match";}}}}();return result;}else{if((((_tmp78=[ops,args]),(_tmp78 instanceof Array))&&(((_tmp79=_tmp78.length),(_tmp79==2))&&(((_tmp80=_tmp78[0]),(_tmp80 instanceof Array))&&(((_tmp81=_tmp80.length),(_tmp81>=1))&&((_tmp82=_tmp80[0]),(_tmp82=="{"))))))){var f=function(x){return (x!==null);};return ["data"].concat(args.slice(1,(-1)).filter(f));}else{if((((_tmp73=[ops,args]),(_tmp73 instanceof Array))&&(((_tmp74=_tmp73.length),(_tmp74==2))&&(((_tmp75=_tmp73[0]),(_tmp75 instanceof Array))&&(((_tmp76=_tmp75.length),(_tmp76==1))&&((_tmp77=_tmp75[0]),(_tmp77=="WHITE"))))))){return ["send"].concat(args);}else{if((((_tmp65=[ops,args]),(_tmp65 instanceof Array))&&(((_tmp66=_tmp65.length),(_tmp66==2))&&(((_tmp67=_tmp65[0]),(_tmp67 instanceof Array))&&(((_tmp68=_tmp67.length),(_tmp68==1))&&(((_tmp69=_tmp65[1]),(_tmp69 instanceof Array))&&(((_tmp70=_tmp69.length),(_tmp70==2))&&(((_tmp71=_tmp69[0]),(_tmp71===null))&&((_tmp72=_tmp69[1]),(_tmp72===null)))))))))){return op;}else{if((((_tmp59=[ops,args]),(_tmp59 instanceof Array))&&(((_tmp60=_tmp59.length),(_tmp60==2))&&(((_tmp61=_tmp59[0]),(_tmp61 instanceof Array))&&(((_tmp62=_tmp61.length),(_tmp62==1))&&(((_tmp63=_tmp59[1]),(_tmp63 instanceof Array))&&(((_tmp64=_tmp63.length),(_tmp64==2))&&((a=_tmp63[0]),true,(b=_tmp63[1]),true)))))))){return ["send",op,["data",a,b]];}else{if(((other=[ops,args]),true)){throw ["Unknown node",ops,args];}else{throw "Could not find a match";}}}}}}}}}}else{if(((other=x),true)){throw "OopsE";}else{throw "Could not find a match";}}}}}}};var parse=function(text){var results=tokenize(text);var next=function(){return results.shift();};return oparse(next,order,finalize);};var Env=function(parent){var store=Object();var self=function(expr){return ["bind_env",self,expr];};(self.resolve=function(name){var attempt=store[name];if(attempt){return attempt;}else{if(true){return self.parent.resolve(name);}else{return false;}}});(self.register=function(name,value){return (store[name]=value);});(self.register_macro=function(name,m){return (store[name]=["macro",m]);});(self.fork=function(){return Env(self);});(self.parent=parent);(self.store=store);return self;};var js_contexts=({"js_for":["multi","multi","multi","multi"]});var expand=function(env,context,expr){(expr=expand.step(env,context,expr));var other;var _tmp129;var _tmp130;var _tmp131;var _tmp143;var _tmp132;var _tmp142;var _tmp133;var _tmp141;var _tmp134;var _tmp140;var _tmp135;var _tmp139;var _tmp136;var _tmp138;var _tmp137;var args;var _tmp144;var _tmp145;var _tmp146;var lhs;var rhs;var _tmp147;var _tmp148;var _tmp149;var binding;var value;var _tmp150;var _tmp151;var _tmp152;var bindings;var body;var _tmp153;var _tmp154;var _tmp155;var args;var _tmp156;var _tmp157;var _tmp158;var type;var _tmp159;var _tmp167;var _tmp160;var _tmp166;var _tmp161;var _tmp165;var _tmp162;var _tmp164;var _tmp163;var args;var _tmp168;var _tmp169;var _tmp170;var v;var _tmp171;var _tmp172;var _tmp173;var f;var arg;var _tmp174;var _tmp175;var _tmp176;if(((_tmp176=expr),(typeof(_tmp176)=="string"))){return expr;}else{if(((_tmp175=expr),(_tmp175===null))){return null;}else{if(((_tmp174=expr),(_tmp174===undefined))){throw "undefined? why?";}else{if((((_tmp171=expr),(_tmp171 instanceof Array))&&(((_tmp172=_tmp171.length),(_tmp172==3))&&(((_tmp173=_tmp171[0]),(_tmp173=="send"))&&((f=_tmp171[1]),true,(arg=_tmp171[2]),true))))){(f=expand(env,"head",f));return ["send",f,expand(env,"tail",arg)];}else{if((((_tmp168=expr),(_tmp168 instanceof Array))&&(((_tmp169=_tmp168.length),(_tmp169==2))&&(((_tmp170=_tmp168[0]),(_tmp170=="value"))&&((v=_tmp168[1]),true))))){return expr;}else{if((((_tmp156=expr),(_tmp156 instanceof Array))&&(((_tmp157=_tmp156.length),(_tmp157>=1))&&(((_tmp158=_tmp156[0]),(type=_tmp158),true,(_tmp159=_tmp158),(((_tmp160=_tmp159),(((_tmp161=_tmp160),(((_tmp162=_tmp161),(((_tmp163=_tmp162),(_tmp163=="multi"))||((_tmp164=_tmp162),(_tmp164=="code"))))||((_tmp165=_tmp161),(_tmp165=="array"))))||((_tmp166=_tmp160),(_tmp166=="object"))))||((_tmp167=_tmp159),(_tmp167=="splice"))))&&((args=_tmp156.slice(1)),true))))){var arr=[];while((args.length>0)){var x=expand.step(env,type,args.shift());if(((x instanceof Array)&&(x[0]=="splice"))){(args=x.slice(1).concat(args));}else{if(true){arr.push(x);}else{false;}}}var f=function(x){return expand(env,type,x);};return [type].concat(arr.map(f));}else{if((((_tmp153=expr),(_tmp153 instanceof Array))&&(((_tmp154=_tmp153.length),(_tmp154>=1))&&(((_tmp155=_tmp153[0]),(_tmp155=="data"))&&((args=_tmp153.slice(1)),true))))){var is_obj=false;var obj=["object"];var arr=["array"];while((args.length>0)){var x=expand.step(env,type,args.shift());var other;var _tmp177;var _tmp178;var _tmp179;var exprs;var _tmp180;var _tmp181;var _tmp182;var k;var v;var _tmp183;var _tmp184;var _tmp185;if((((_tmp183=x),(_tmp183 instanceof Array))&&(((_tmp184=_tmp183.length),(_tmp184==1))&&((_tmp185=_tmp183[0]),(_tmp185=="assoc"))))){(is_obj=true);}else{if((((_tmp180=x),(_tmp180 instanceof Array))&&(((_tmp181=_tmp180.length),(_tmp181==3))&&(((_tmp182=_tmp180[0]),(_tmp182=="assoc"))&&((k=_tmp180[1]),true,(v=_tmp180[2]),true))))){(is_obj=true);obj.push(["array",k,v]);}else{if((((_tmp177=x),(_tmp177 instanceof Array))&&(((_tmp178=_tmp177.length),(_tmp178>=1))&&(((_tmp179=_tmp177[0]),(_tmp179=="splice"))&&((exprs=_tmp177.slice(1)),true))))){(args=exprs.concat(args));}else{if(((other=x),true)){arr.push(other);}else{throw "Could not find a match";}}}}}var r=function(){if(((arr.length>1)&&is_obj)){arr.push(obj);return arr;}else{if(is_obj){return obj;}else{if(true){return arr;}else{return false;}}}}();return expand(env,context,r);}else{if((((_tmp150=expr),(_tmp150 instanceof Array))&&(((_tmp151=_tmp150.length),(_tmp151==3))&&(((_tmp152=_tmp150[0]),(_tmp152=="lambda"))&&((bindings=_tmp150[1]),true,(body=_tmp150[2]),true))))){return ["lambda",bindings.map(function(x){return expand(env,"decl",x);}),expand(env,"multi",body)];}else{if((((_tmp147=expr),(_tmp147 instanceof Array))&&(((_tmp148=_tmp147.length),(_tmp148==3))&&(((_tmp149=_tmp147[0]),(_tmp149=="declare"))&&((binding=_tmp147[1]),true,(value=_tmp147[2]),true))))){return ["declare",expand(env,"decl",binding),expand(env,"multi",value)];}else{if((((_tmp144=expr),(_tmp144 instanceof Array))&&(((_tmp145=_tmp144.length),(_tmp145==3))&&(((_tmp146=_tmp144[0]),(_tmp146=="assign"))&&((lhs=_tmp144[1]),true,(rhs=_tmp144[2]),true))))){return ["assign",expand(env,"decl",lhs),expand(env,"multi",rhs)];}else{if((((_tmp129=expr),(_tmp129 instanceof Array))&&(((_tmp130=_tmp129.length),(_tmp130>=1))&&(((_tmp131=_tmp129[0]),(((_tmp132=_tmp131),(((_tmp133=_tmp132),(((_tmp134=_tmp133),(((_tmp135=_tmp134),(((_tmp136=_tmp135),(((_tmp137=_tmp136),(_tmp137=="js_while"))||((_tmp138=_tmp136),(_tmp138=="js_for"))))||((_tmp139=_tmp135),(_tmp139=="js_break"))))||((_tmp140=_tmp134),(_tmp140=="js_continue"))))||((_tmp141=_tmp133),(_tmp141=="js_return"))))||((_tmp142=_tmp132),(_tmp142=="js_throw"))))||((_tmp143=_tmp131),(_tmp143=="if"))))&&((args=_tmp129.slice(1)),true))))){var ctxs=(js_contexts[type]||[]);var f=function(x,i){return expand(env,(ctxs[i]||"expr"),x);};return [type].concat(args.map(f));}else{if(((other=expr),true)){throw ["Oops",type,context];}else{throw "Could not find a match";}}}}}}}}}}}}};(expand.step=function(env,context,expr){var other;var _tmp186;var _tmp187;var type;var args;var _tmp188;var _tmp189;var _tmp190;var f;var arg;var _tmp191;var _tmp192;var _tmp193;var m;var _tmp194;var _tmp195;var _tmp196;if(((_tmp196=expr),(typeof(_tmp196)=="string"))){var v=env.resolve(expr);var other;var _tmp197;var _tmp198;var _tmp199;var _tmp200;var _tmp201;var m;var _tmp202;var _tmp203;var _tmp204;var _tmp205;var _tmp206;var m;var _tmp207;var _tmp208;var _tmp209;var _tmp210;if((((_tmp208=[v,context]),(_tmp208 instanceof Array))&&(((_tmp209=_tmp208.length),(_tmp209==2))&&((_tmp210=_tmp208[0]),(_tmp210===undefined))))){return expr;}else{if((((_tmp202=[v,context]),(_tmp202 instanceof Array))&&(((_tmp203=_tmp202.length),(_tmp203==2))&&(((_tmp204=_tmp202[0]),(_tmp204 instanceof Array))&&(((_tmp205=_tmp204.length),(_tmp205==2))&&(((_tmp206=_tmp204[0]),(_tmp206=="macro"))&&((m=_tmp204[1]),true,(_tmp207=_tmp202[1]),(_tmp207=="head")))))))){return v;}else{if((((_tmp197=[v,context]),(_tmp197 instanceof Array))&&(((_tmp198=_tmp197.length),(_tmp198==2))&&(((_tmp199=_tmp197[0]),(_tmp199 instanceof Array))&&(((_tmp200=_tmp199.length),(_tmp200==2))&&(((_tmp201=_tmp199[0]),(_tmp201=="macro"))&&((m=_tmp199[1]),true))))))){return expand.step(env,context,m(env,context,null));}else{if(((other=[v,context]),true)){return v;}else{throw "Could not find a match";}}}}}else{if(((_tmp195=expr),(_tmp195===null))){return null;}else{if(((_tmp194=expr),(_tmp194===undefined))){throw "undefined? why?";}else{if((((_tmp191=expr),(_tmp191 instanceof Array))&&(((_tmp192=_tmp191.length),(_tmp192==2))&&(((_tmp193=_tmp191[0]),(_tmp193=="macro"))&&((m=_tmp191[1]),true))))){if((context=="head")){return expr;}else{if(true){return expand.step(env,context,m(env,context,null));}else{return false;}}}else{if((((_tmp188=expr),(_tmp188 instanceof Array))&&(((_tmp189=_tmp188.length),(_tmp189==3))&&(((_tmp190=_tmp188[0]),(_tmp190=="send"))&&((f=_tmp188[1]),true,(arg=_tmp188[2]),true))))){(f=expand.step(env,"head",f));var other;var _tmp211;var _tmp212;var _tmp213;var m;if((((_tmp211=f),(_tmp211 instanceof Array))&&(((_tmp212=_tmp211.length),(_tmp212==2))&&(((_tmp213=_tmp211[0]),(_tmp213=="macro"))&&((m=_tmp211[1]),true))))){return expand.step(env,context,m(env,context,arg));}else{if(((other=f),true)){return expr;}else{throw "Could not find a match";}}}else{if((((_tmp186=expr),(_tmp186 instanceof Array))&&(((_tmp187=_tmp186.length),(_tmp187>=1))&&((type=_tmp186[0]),true,(args=_tmp186.slice(1)),true)))){return expr;}else{if(((other=expr),true)){throw ["Oops2",expr];}else{throw "Could not find a match";}}}}}}}});var aslist=function(expr){var other;var _tmp214;var _tmp215;var _tmp216;var args;var _tmp217;var _tmp218;if(((_tmp218=expr),(_tmp218===null))){return [null];}else{if(((_tmp217=expr),(_tmp217===undefined))){return [undefined];}else{if((((_tmp214=expr),(_tmp214 instanceof Array))&&(((_tmp215=_tmp214.length),(_tmp215>=1))&&(((_tmp216=_tmp214[0]),(_tmp216=="multi"))&&((args=_tmp214.slice(1)),true))))){return args;}else{if(((other=expr),true)){return [other];}else{throw "Could not find a match";}}}}};var nullenv=({"resolve":function(x){return undefined;}});var stdenv=Env(nullenv);stdenv.register("+","___plus");stdenv.register("-","___minus");stdenv.register("*","___times");stdenv.register("/","___div");stdenv.register("%","___mod");stdenv.register("^","___binxor");stdenv.register("&","___binand");stdenv.register("|","___binor");stdenv.register("~","___binnot");stdenv.register("&&","___and");stdenv.register("||","___or");stdenv.register("!","___not");stdenv.register("and","___and");stdenv.register("or","___or");stdenv.register("not","___not");stdenv.register("===","___is");stdenv.register("!==","___isnt");stdenv.register("!=","___neq");stdenv.register("<","___lt");stdenv.register(">","___gt");stdenv.register("<=","___lte");stdenv.register(">=","___gte");stdenv.register("<<","___shl");stdenv.register(">>","___shr");stdenv.register(">>>","___shr2");stdenv.register("in","___in");stdenv.register("instanceof","___instanceof");stdenv.register("++","___plusplus");stdenv.register("--","___minusminus");stdenv.register_macro("**",function(env,context,_tmp219){var _tmp220;var _tmp221;var _tmp222;var a;var b;if((((_tmp220=_tmp219),(_tmp220 instanceof Array))&&(((_tmp221=_tmp220.length),(_tmp221==3))&&(((_tmp222=_tmp220[0]),(_tmp222=="data"))&&((a=_tmp220[1]),true,(b=_tmp220[2]),true))))){false;}else{throw "a condition failed";}return ["send",["send","Math",["value","pow"]],["data",a,b]];});stdenv.register_macro("//",function(env,context,_tmp223){var _tmp224;var _tmp225;var _tmp226;var a;var b;if((((_tmp224=_tmp223),(_tmp224 instanceof Array))&&(((_tmp225=_tmp224.length),(_tmp225==3))&&(((_tmp226=_tmp224[0]),(_tmp226=="data"))&&((a=_tmp224[1]),true,(b=_tmp224[2]),true))))){false;}else{throw "a condition failed";}var div=["send","___div",["data",a,b]];return ["send",["send","Math",["value","floor"]],["data",div]];});stdenv.register_macro("<>",function(env,context,_tmp227){var _tmp228;var _tmp229;var _tmp230;var _tmp231;var x;if((((_tmp228=_tmp227),(_tmp228 instanceof Array))&&(((_tmp229=_tmp228.length),(_tmp229==3))&&(((_tmp230=_tmp228[0]),(_tmp230=="data"))&&(((_tmp231=_tmp228[1]),(_tmp231===null))&&((x=_tmp228[2]),true)))))){false;}else{throw "a condition failed";}return ["send",["send","___lib",["value","pr"]],["data",x]];});var make_checker=function(value,op){return function(env,context,expr){return ["send",op,["data",expr[1],value]];};};stdenv.register_macro("#",function(env,context,expr){var tag=["value",expr[2]];var f=function(env,context,expr){if((context=="pattern")){var f=function(env,context,expr){return ["send","___eq",["data",["send",expr[1],["value","#"]],tag]];};return ["check",["macro",f],expr];}else{if(true){var d=["data",tag].concat(expr.slice(1));return ["send",["send","___lib",["value","Struct"]],d];}else{return false;}}};return ["macro",f];});var andf=function(env,context,expr){var other;var _tmp232;var _tmp233;var _tmp234;var _tmp235;var _tmp236;var _tmp237;var _tmp238;var _tmp239;var _tmp240;var a;var b;if((((_tmp235=[context,expr]),(_tmp235 instanceof Array))&&(((_tmp236=_tmp235.length),(_tmp236==2))&&(((_tmp237=_tmp235[0]),(_tmp237=="pattern"))&&(((_tmp238=_tmp235[1]),(_tmp238 instanceof Array))&&(((_tmp239=_tmp238.length),(_tmp239==3))&&(((_tmp240=_tmp238[0]),(_tmp240=="data"))&&((a=_tmp238[1]),true,(b=_tmp238[2]),true)))))))){return ["all",a,b];}else{if((((_tmp232=[context,expr]),(_tmp232 instanceof Array))&&(((_tmp233=_tmp232.length),(_tmp233==2))&&((_tmp234=_tmp232[1]),(_tmp234===null))))){return "___and";}else{if(((other=[context,expr]),true)){return ["send","___and",expr];}else{throw "Could not find a match";}}}};stdenv.register_macro("&&",andf);stdenv.register_macro("and",andf);var orf=function(env,context,expr){var other;var _tmp241;var _tmp242;var _tmp243;var _tmp244;var _tmp245;var _tmp246;var _tmp247;var _tmp248;var _tmp249;var a;var b;if((((_tmp244=[context,expr]),(_tmp244 instanceof Array))&&(((_tmp245=_tmp244.length),(_tmp245==2))&&(((_tmp246=_tmp244[0]),(_tmp246=="pattern"))&&(((_tmp247=_tmp244[1]),(_tmp247 instanceof Array))&&(((_tmp248=_tmp247.length),(_tmp248==3))&&(((_tmp249=_tmp247[0]),(_tmp249=="data"))&&((a=_tmp247[1]),true,(b=_tmp247[2]),true)))))))){return ["any",a,b];}else{if((((_tmp241=[context,expr]),(_tmp241 instanceof Array))&&(((_tmp242=_tmp241.length),(_tmp242==2))&&((_tmp243=_tmp241[1]),(_tmp243===null))))){return "___or";}else{if(((other=[context,expr]),true)){return ["send","___or",expr];}else{throw "Could not find a match";}}}};stdenv.register_macro("||",orf);stdenv.register_macro("or",orf);var partial_pattern=function(operator){return function(env,context,expr){var other;var _tmp250;var _tmp251;var _tmp252;var _tmp253;var _tmp254;var _tmp255;var _tmp256;var _tmp257;var _tmp258;var _tmp259;var val;if((((_tmp253=[context,expr]),(_tmp253 instanceof Array))&&(((_tmp254=_tmp253.length),(_tmp254==2))&&(((_tmp255=_tmp253[0]),(_tmp255=="pattern"))&&(((_tmp256=_tmp253[1]),(_tmp256 instanceof Array))&&(((_tmp257=_tmp256.length),(_tmp257==3))&&(((_tmp258=_tmp256[0]),(_tmp258=="data"))&&(((_tmp259=_tmp256[1]),(_tmp259===null))&&((val=_tmp256[2]),true))))))))){return ["check",["macro",make_checker(val,operator)],null];}else{if((((_tmp250=[context,expr]),(_tmp250 instanceof Array))&&(((_tmp251=_tmp250.length),(_tmp251==2))&&((_tmp252=_tmp250[1]),(_tmp252===null))))){return operator;}else{if(((other=[context,expr]),true)){return ["send",operator,expr];}else{throw "Could not find a match";}}}};};stdenv.register_macro("==",partial_pattern("___eq"));stdenv.register_macro("!=",partial_pattern("___neq"));stdenv.register_macro("<=",partial_pattern("___leq"));stdenv.register_macro(">=",partial_pattern("___geq"));stdenv.register_macro("<",partial_pattern("___lt"));stdenv.register_macro(">",partial_pattern("___gt"));stdenv.register_macro("*",function(env,context,expr){var other;var _tmp260;var _tmp261;var _tmp262;var _tmp263;var _tmp264;var _tmp265;var _tmp266;var _tmp267;var _tmp268;var val;var _tmp269;if((((_tmp263=[context,expr]),(_tmp263 instanceof Array))&&(((_tmp264=_tmp263.length),(_tmp264==2))&&(((_tmp265=_tmp263[0]),(_tmp265=="pattern"))&&(((_tmp266=_tmp263[1]),(_tmp266 instanceof Array))&&(((_tmp267=_tmp266.length),(_tmp267==3))&&(((_tmp268=_tmp266[0]),(_tmp268=="data"))&&((val=_tmp266[1]),true,(_tmp269=_tmp266[2]),(_tmp269===null))))))))){return ["dynsplice",val];}else{if((((_tmp260=[context,expr]),(_tmp260 instanceof Array))&&(((_tmp261=_tmp260.length),(_tmp261==2))&&((_tmp262=_tmp260[1]),(_tmp262===null))))){return "___times";}else{if(((other=[context,expr]),true)){return ["send","___times",expr];}else{throw "Could not find a match";}}}});stdenv.register_macro(".",function(env,context,expr){var other;var _tmp270;var _tmp271;var _tmp272;var _tmp273;var _tmp274;var s;if((((_tmp270=expr),(_tmp270 instanceof Array))&&(((_tmp271=_tmp270.length),(_tmp271==3))&&(((_tmp272=_tmp270[0]),(_tmp272=="data"))&&(((_tmp273=_tmp270[1]),(_tmp273===null))&&(((_tmp274=_tmp270[2]),(typeof(_tmp274)=="string"))&&((s=_tmp274),true))))))){return ["value",s];}else{if(((other=expr),true)){throw ["invalid",expr];}else{throw "Could not find a match";}}});stdenv.register_macro("where",function(env,context,_tmp275){var _tmp276;var _tmp277;var _tmp278;var a;var b;if((((_tmp276=_tmp275),(_tmp276 instanceof Array))&&(((_tmp277=_tmp276.length),(_tmp277==3))&&(((_tmp278=_tmp276[0]),(_tmp278=="data"))&&((a=_tmp276[1]),true,(b=_tmp276[2]),true))))){false;}else{throw "a condition failed";}return ["send","let",["data",["code",b],["code",a]]];});stdenv.register_macro("let",function(env,context,_tmp279){var _tmp280;var _tmp281;var _tmp282;var _tmp283;var _tmp284;var _tmp285;var a;var _tmp286;var _tmp287;var _tmp288;var b;if((((_tmp280=_tmp279),(_tmp280 instanceof Array))&&(((_tmp281=_tmp280.length),(_tmp281==3))&&(((_tmp282=_tmp280[0]),(_tmp282=="data"))&&(((_tmp283=_tmp280[1]),(_tmp283 instanceof Array))&&(((_tmp284=_tmp283.length),(_tmp284==2))&&(((_tmp285=_tmp283[0]),(_tmp285=="code"))&&(((a=_tmp283[1]),true,(_tmp286=_tmp280[2]),(_tmp286 instanceof Array))&&(((_tmp287=_tmp286.length),(_tmp287==2))&&(((_tmp288=_tmp286[0]),(_tmp288=="code"))&&((b=_tmp286[1]),true))))))))))){false;}else{throw "a condition failed";}var bindings=aslist(a);var body=aslist(b);return ["multi"].concat(bindings).concat(body);});stdenv.register_macro("->",function(env,context,_tmp289){var _tmp290;var _tmp291;var _tmp292;var args;var stmts;if((((_tmp290=_tmp289),(_tmp290 instanceof Array))&&(((_tmp291=_tmp290.length),(_tmp291==3))&&(((_tmp292=_tmp290[0]),(_tmp292=="data"))&&((args=_tmp290[1]),true,(stmts=_tmp290[2]),true))))){false;}else{throw "a condition failed";}var body=["multi"];(args=args.slice(1).map(function(x){var other;var _tmp293;if(((_tmp293=x),(typeof(_tmp293)=="string"))){return x;}else{if(((other=x),true)){var t=gensym();body.push(["send","=",["data",x,t]]);return t;}else{throw "Could not find a match";}}}));body.push(stmts);return ["lambda",args,body];});stdenv.register_macro("=>",function(env,context,_tmp294){var _tmp295;var _tmp296;var _tmp297;var binding;var value;if((((_tmp295=_tmp294),(_tmp295 instanceof Array))&&(((_tmp296=_tmp295.length),(_tmp296==3))&&(((_tmp297=_tmp295[0]),(_tmp297=="data"))&&((binding=_tmp295[1]),true,(value=_tmp295[2]),true))))){false;}else{throw "a condition failed";}if((context=="data")){return ["assoc",binding,value];}else{if(true){throw (("Illegal context for '=>' ("+context)+")");}else{return false;}}});stdenv.register_macro("=",function(env,context,expr){var other;var _tmp298;var _tmp299;var _tmp300;var _tmp301;var _tmp302;var _tmp303;var binding;var value;var _tmp304;var _tmp305;var _tmp306;var _tmp307;var _tmp308;var _tmp309;var _tmp310;var _tmp311;var _tmp312;var f;var _tmp313;var _tmp314;var _tmp315;var args;var value;var _tmp316;var _tmp317;var _tmp318;var _tmp319;var _tmp320;var _tmp321;var _tmp322;var _tmp323;var _tmp324;var _tmp325;var lhs;var rhs;if((((_tmp320=[context,expr]),(_tmp320 instanceof Array))&&(((_tmp321=_tmp320.length),(_tmp321==2))&&(((_tmp322=_tmp320[0]),(_tmp322=="multi"))&&(((_tmp323=_tmp320[1]),(_tmp323 instanceof Array))&&(((_tmp324=_tmp323.length),(_tmp324==3))&&(((_tmp325=_tmp323[0]),(_tmp325=="data"))&&((lhs=_tmp323[1]),true,(rhs=_tmp323[2]),true)))))))){var p=parse_lhs(env,lhs,rhs);var vars=make_declarations(p[0]);var r=["splice"].concat(vars);var clauses=p[1];var mkif=function(x){return ["if",x,["value",false],["js_throw",["value","a condition failed"]]];};if((clauses.length==1)){var clause=clauses[0];var last=clause[(clause.length-1)];if((((last instanceof Array)&&(last[0]=="value"))&&(last[1]===true))){if(((vars.length==1)&&(clause.length==3))){(r=["declare"].concat(clause[1].slice(1)));}else{if(true){(r=r.concat(clause.slice(1,(-1))));}else{false;}}}else{if(true){r.push(mkif(clause));}else{false;}}}else{if(true){var ands=make_pattern_test(clauses);r.push(mkif(ands));}else{false;}}return r;}else{if((((_tmp316=[context,expr]),(_tmp316 instanceof Array))&&(((_tmp317=_tmp316.length),(_tmp317==2))&&(((_tmp318=_tmp316[0]),(_tmp318=="data"))&&((_tmp319=_tmp316[1]),(_tmp319===null)))))){return ["assoc"];}else{if((((_tmp304=[context,expr]),(_tmp304 instanceof Array))&&(((_tmp305=_tmp304.length),(_tmp305==2))&&(((_tmp306=_tmp304[0]),(_tmp306=="data"))&&(((_tmp307=_tmp304[1]),(_tmp307 instanceof Array))&&(((_tmp308=_tmp307.length),(_tmp308==3))&&(((_tmp309=_tmp307[0]),(_tmp309=="data"))&&(((_tmp310=_tmp307[1]),(_tmp310 instanceof Array))&&(((_tmp311=_tmp310.length),(_tmp311==3))&&(((_tmp312=_tmp310[0]),(_tmp312=="send"))&&(((f=_tmp310[1]),true,(_tmp313=_tmp310[2]),(_tmp313 instanceof Array))&&(((_tmp314=_tmp313.length),(_tmp314>=1))&&(((_tmp315=_tmp313[0]),(_tmp315=="data"))&&((args=_tmp313.slice(1)),true,(value=_tmp307[2]),true)))))))))))))){return ["assoc",["value",f],["lambda",args,value]];}else{if((((_tmp298=[context,expr]),(_tmp298 instanceof Array))&&(((_tmp299=_tmp298.length),(_tmp299==2))&&(((_tmp300=_tmp298[0]),(_tmp300=="data"))&&(((_tmp301=_tmp298[1]),(_tmp301 instanceof Array))&&(((_tmp302=_tmp301.length),(_tmp302==3))&&(((_tmp303=_tmp301[0]),(_tmp303=="data"))&&((binding=_tmp301[1]),true,(value=_tmp301[2]),true)))))))){return ["assoc",["value",binding],value];}else{if(((other=[context,expr]),true)){throw (("Illegal context for '=' ("+context)+")");}else{throw "Could not find a match";}}}}}});var make_assigner=function(op){return function(env,context,_tmp326){var _tmp327;var _tmp328;var _tmp329;var a;var b;if((((_tmp327=_tmp326),(_tmp327 instanceof Array))&&(((_tmp328=_tmp327.length),(_tmp328==3))&&(((_tmp329=_tmp327[0]),(_tmp329=="data"))&&((a=_tmp327[1]),true,(b=_tmp327[2]),true))))){false;}else{throw "a condition failed";}return ["assign",a,["send",op,["data",a,b]]];};};stdenv.register_macro(":=",function(env,context,_tmp330){var _tmp331;var _tmp332;var _tmp333;var a;var b;if((((_tmp331=_tmp330),(_tmp331 instanceof Array))&&(((_tmp332=_tmp331.length),(_tmp332==3))&&(((_tmp333=_tmp331[0]),(_tmp333=="data"))&&((a=_tmp331[1]),true,(b=_tmp331[2]),true))))){false;}else{throw "a condition failed";}return ["assign",a,b];});stdenv.register_macro("+=",make_assigner("+"));stdenv.register_macro("-=",make_assigner("-"));stdenv.register_macro("*=",make_assigner("*"));stdenv.register_macro("/=",make_assigner("/"));stdenv.register_macro("<<=",make_assigner("<<"));stdenv.register_macro(">>=",make_assigner(">>"));stdenv.register_macro(">>>=",make_assigner(">>>"));stdenv.register_macro("if",function(env,context,_tmp334){var _tmp335;var _tmp336;var _tmp337;var test;var a;var b;if((((_tmp335=_tmp334),(_tmp335 instanceof Array))&&(((_tmp336=_tmp335.length),(_tmp336==4))&&(((_tmp337=_tmp335[0]),(_tmp337=="data"))&&((test=_tmp335[1]),true,(a=_tmp335[2]),true,(b=_tmp335[3]),true))))){false;}else{throw "a condition failed";}return ["if",test,a,b];});stdenv.register_macro("cond",function(env,context,_tmp338){var _tmp339;var _tmp340;var _tmp341;var _tmp342;var _tmp343;var _tmp344;var clauses;if((((_tmp339=_tmp338),(_tmp339 instanceof Array))&&(((_tmp340=_tmp339.length),(_tmp340==2))&&(((_tmp341=_tmp339[0]),(_tmp341=="data"))&&(((_tmp342=_tmp339[1]),(_tmp342 instanceof Array))&&(((_tmp343=_tmp342.length),(_tmp343==2))&&(((_tmp344=_tmp342[0]),(_tmp344=="code"))&&((clauses=_tmp342[1]),true)))))))){false;}else{throw "a condition failed";}var handle=function(xs){if((xs.length==0)){return ["value",false];}else{if(true){var first=xs[0][2];var rest=xs.slice(1);return ["if",first[1],first[2],handle(rest)];}else{return false;}}};return handle(aslist(clauses));});stdenv.register_macro("while",function(env,context,expr){var _tmp345;var _tmp346;var _tmp347;var _tmp348;var _tmp349;var _tmp350;var test;var _tmp351;var _tmp352;var _tmp353;var body;if((((_tmp345=expr),(_tmp345 instanceof Array))&&(((_tmp346=_tmp345.length),(_tmp346==3))&&(((_tmp347=_tmp345[0]),(_tmp347=="data"))&&(((_tmp348=_tmp345[1]),(_tmp348 instanceof Array))&&(((_tmp349=_tmp348.length),(_tmp349==2))&&(((_tmp350=_tmp348[0]),(_tmp350=="code"))&&(((test=_tmp348[1]),true,(_tmp351=_tmp345[2]),(_tmp351 instanceof Array))&&(((_tmp352=_tmp351.length),(_tmp352==2))&&(((_tmp353=_tmp351[0]),(_tmp353=="code"))&&((body=_tmp351[1]),true))))))))))){false;}else{throw "a condition failed";}return ["js_while",test,body];});stdenv.register_macro("for",function(env,context,expr){var _tmp354;var _tmp355;var _tmp356;var _tmp357;var _tmp358;var _tmp359;var _tmp360;var _tmp361;var _tmp362;var a;var b;var c;var _tmp363;var _tmp364;var _tmp365;var body;if((((_tmp354=expr),(_tmp354 instanceof Array))&&(((_tmp355=_tmp354.length),(_tmp355==3))&&(((_tmp356=_tmp354[0]),(_tmp356=="data"))&&(((_tmp357=_tmp354[1]),(_tmp357 instanceof Array))&&(((_tmp358=_tmp357.length),(_tmp358==2))&&(((_tmp359=_tmp357[0]),(_tmp359=="code"))&&(((_tmp360=_tmp357[1]),(_tmp360 instanceof Array))&&(((_tmp361=_tmp360.length),(_tmp361==4))&&(((_tmp362=_tmp360[0]),(_tmp362=="multi"))&&(((a=_tmp360[1]),true,(b=_tmp360[2]),true,(c=_tmp360[3]),true,(_tmp363=_tmp354[2]),(_tmp363 instanceof Array))&&(((_tmp364=_tmp363.length),(_tmp364==2))&&(((_tmp365=_tmp363[0]),(_tmp365=="code"))&&((body=_tmp363[1]),true)))))))))))))){false;}else{throw "a condition failed";}return ["js_for",a,b,c,body];});stdenv.register_macro("return",function(env,context,expr){return ["js_return",expr];});stdenv.register_macro("throw",function(env,context,expr){return ["js_throw",expr];});stdenv.register_macro("break",function(env,context,expr){return ["js_break"];});stdenv.register_macro("continue",function(env,context,expr){return ["js_continue"];});var rx_wrap=function(x){return (("(?:"+x)+")");};var rx_quote=function(x){return x.replace(RegExp("([.?*+\\^$\\[\\]\\(\\)\\{\\}|\\\\])","g"),"\\$1");};var rx_quote2=function(x){return x.replace(RegExp("([\\[\\]\\(\\)\\{\\}\\^])","g"),"\\$1");};var rx_build=function(expr){var otherA;var _tmp366;var _tmp367;var _tmp368;var args;var _tmp369;var _tmp370;var _tmp371;var args;var _tmp372;var _tmp373;var _tmp374;var _tmp375;var _tmp376;var _tmp377;var _tmp378;var _tmp379;var b;var _tmp380;var _tmp381;var _tmp382;var _tmp383;var _tmp384;var _tmp385;var _tmp386;var _tmp387;var b;var _tmp388;var _tmp389;var _tmp390;var _tmp391;var _tmp392;var _tmp393;var _tmp394;var a;var _tmp395;var _tmp396;var _tmp397;var _tmp398;var _tmp399;var _tmp400;var _tmp401;var _tmp402;var a;var _tmp403;var _tmp404;var _tmp405;var _tmp406;var _tmp407;var _tmp408;var _tmp409;var _tmp410;var a;var _tmp411;var _tmp412;var _tmp413;var _tmp414;var _tmp415;var _tmp416;var _tmp417;var _tmp418;var a;var b;var _tmp419;var _tmp420;var _tmp421;var _tmp422;var _tmp423;var _tmp424;var _tmp425;var a;var b;var _tmp426;var _tmp427;var _tmp428;var x;var _tmp429;var _tmp430;var _tmp431;var _tmp432;var _tmp433;var _tmp434;var _tmp435;var _tmp436;var _tmp437;var _tmp438;var _tmp439;var _tmp440;var _tmp441;if(((_tmp441=expr),(_tmp441=="any"))){return ".";}else{if(((_tmp440=expr),(_tmp440=="start"))){return "^";}else{if(((_tmp439=expr),(_tmp439=="end"))){return "$";}else{if(((_tmp438=expr),(_tmp438=="alpha"))){return "\\a";}else{if(((_tmp437=expr),(_tmp437=="digit"))){return "\\d";}else{if(((_tmp436=expr),(_tmp436=="word"))){return "\\w";}else{if(((_tmp435=expr),(_tmp435=="space"))){return "\\s";}else{if(((_tmp434=expr),(_tmp434=="boundary"))){return "\\b";}else{if(((_tmp433=expr),(_tmp433=="a"))){return "\\a";}else{if(((_tmp432=expr),(_tmp432=="d"))){return "\\d";}else{if(((_tmp431=expr),(_tmp431=="w"))){return "\\w";}else{if(((_tmp430=expr),(_tmp430=="s"))){return "\\s";}else{if(((_tmp429=expr),(_tmp429=="b"))){return "\\b";}else{if((((_tmp426=expr),(_tmp426 instanceof Array))&&(((_tmp427=_tmp426.length),(_tmp427==2))&&(((_tmp428=_tmp426[0]),(_tmp428=="value"))&&((x=_tmp426[1]),true))))){return rx_quote(x);}else{if((((_tmp419=expr),(_tmp419 instanceof Array))&&(((_tmp420=_tmp419.length),(_tmp420==3))&&(((_tmp421=_tmp419[0]),(_tmp421=="send"))&&(((_tmp422=_tmp419[1]),(_tmp422=="||"))&&(((_tmp423=_tmp419[2]),(_tmp423 instanceof Array))&&(((_tmp424=_tmp423.length),(_tmp424==3))&&(((_tmp425=_tmp423[0]),(_tmp425=="data"))&&((a=_tmp423[1]),true,(b=_tmp423[2]),true))))))))){return rx_wrap(((rx_build(a)+"|")+rx_build(b)));}else{if((((_tmp412=expr),(_tmp412 instanceof Array))&&(((_tmp413=_tmp412.length),(_tmp413==3))&&(((_tmp414=_tmp412[0]),(_tmp414=="send"))&&(((_tmp415=_tmp412[1]),(_tmp415=="or"))&&(((_tmp416=_tmp412[2]),(_tmp416 instanceof Array))&&(((_tmp417=_tmp416.length),(_tmp417==3))&&(((_tmp418=_tmp416[0]),(_tmp418=="data"))&&((a=_tmp416[1]),true,(b=_tmp416[2]),true))))))))){return rx_wrap(((rx_build(a)+"|")+rx_build(b)));}else{if((((_tmp404=expr),(_tmp404 instanceof Array))&&(((_tmp405=_tmp404.length),(_tmp405==3))&&(((_tmp406=_tmp404[0]),(_tmp406=="send"))&&(((_tmp407=_tmp404[1]),(_tmp407=="*"))&&(((_tmp408=_tmp404[2]),(_tmp408 instanceof Array))&&(((_tmp409=_tmp408.length),(_tmp409==3))&&(((_tmp410=_tmp408[0]),(_tmp410=="data"))&&((a=_tmp408[1]),true,(_tmp411=_tmp408[2]),(_tmp411===null)))))))))){return rx_wrap((rx_build(a)+"*"));}else{if((((_tmp396=expr),(_tmp396 instanceof Array))&&(((_tmp397=_tmp396.length),(_tmp397==3))&&(((_tmp398=_tmp396[0]),(_tmp398=="send"))&&(((_tmp399=_tmp396[1]),(_tmp399=="+"))&&(((_tmp400=_tmp396[2]),(_tmp400 instanceof Array))&&(((_tmp401=_tmp400.length),(_tmp401==3))&&(((_tmp402=_tmp400[0]),(_tmp402=="data"))&&((a=_tmp400[1]),true,(_tmp403=_tmp400[2]),(_tmp403===null)))))))))){return rx_wrap((rx_build(a)+"+"));}else{if((((_tmp388=expr),(_tmp388 instanceof Array))&&(((_tmp389=_tmp388.length),(_tmp389==3))&&(((_tmp390=_tmp388[0]),(_tmp390=="send"))&&(((_tmp391=_tmp388[1]),(_tmp391=="?"))&&(((_tmp392=_tmp388[2]),(_tmp392 instanceof Array))&&(((_tmp393=_tmp392.length),(_tmp393==3))&&(((_tmp394=_tmp392[0]),(_tmp394=="data"))&&((a=_tmp392[1]),true,(_tmp395=_tmp392[2]),(_tmp395===null)))))))))){return rx_wrap((rx_build(a)+"?"));}else{if((((_tmp380=expr),(_tmp380 instanceof Array))&&(((_tmp381=_tmp380.length),(_tmp381==3))&&(((_tmp382=_tmp380[0]),(_tmp382=="send"))&&(((_tmp383=_tmp380[1]),(_tmp383==">>"))&&(((_tmp384=_tmp380[2]),(_tmp384 instanceof Array))&&(((_tmp385=_tmp384.length),(_tmp385==3))&&(((_tmp386=_tmp384[0]),(_tmp386=="data"))&&(((_tmp387=_tmp384[1]),(_tmp387===null))&&((b=_tmp384[2]),true)))))))))){var x=rx_quote2(b[1]);return (("["+x)+"]");}else{if((((_tmp372=expr),(_tmp372 instanceof Array))&&(((_tmp373=_tmp372.length),(_tmp373==3))&&(((_tmp374=_tmp372[0]),(_tmp374=="send"))&&(((_tmp375=_tmp372[1]),(_tmp375==">>!"))&&(((_tmp376=_tmp372[2]),(_tmp376 instanceof Array))&&(((_tmp377=_tmp376.length),(_tmp377==3))&&(((_tmp378=_tmp376[0]),(_tmp378=="data"))&&(((_tmp379=_tmp376[1]),(_tmp379===null))&&((b=_tmp376[2]),true)))))))))){var x=rx_quote2(b[1]);return (("[^"+x)+"]");}else{if((((_tmp369=expr),(_tmp369 instanceof Array))&&(((_tmp370=_tmp369.length),(_tmp370>=1))&&(((_tmp371=_tmp369[0]),(_tmp371=="data"))&&((args=_tmp369.slice(1)),true))))){return (("("+args.map(rx_build).join(""))+")");}else{if((((_tmp366=expr),(_tmp366 instanceof Array))&&(((_tmp367=_tmp366.length),(_tmp367>=1))&&(((_tmp368=_tmp366[0]),(_tmp368=="multi"))&&((args=_tmp366.slice(1)),true))))){return (("(?:"+args.map(rx_build).join(""))+")");}else{if(((otherA=expr),true)){throw "OopsF";}else{throw "Could not find a match";}}}}}}}}}}}}}}}}}}}}}}}}};stdenv.register_macro("Rx",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)]]];});stdenv.register_macro("Rxg",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)],["value","g"]]];});stdenv.register_macro("?",function(env,context,_tmp442){var _tmp443;var _tmp444;var _tmp445;var expr;var _tmp446;if((((_tmp443=_tmp442),(_tmp443 instanceof Array))&&(((_tmp444=_tmp443.length),(_tmp444==3))&&(((_tmp445=_tmp443[0]),(_tmp445=="data"))&&((expr=_tmp443[1]),true,(_tmp446=_tmp443[2]),(_tmp446===null)))))){false;}else{throw "a condition failed";}var checker=function(){var other;var _tmp447;var _tmp448;var _tmp449;var _tmp450;var _tmp451;var _tmp452;var _tmp453;if(((_tmp453=expr),(_tmp453===null))){return ["send",expr,["value","__check__"]];}else{if(((_tmp452=expr),(_tmp452=="String"))){var f=function(env,context,_tmp454){var _tmp455;var _tmp456;var _tmp457;var expr;if((((_tmp455=_tmp454),(_tmp455 instanceof Array))&&(((_tmp456=_tmp455.length),(_tmp456==2))&&(((_tmp457=_tmp455[0]),(_tmp457=="data"))&&((expr=_tmp455[1]),true))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","string"]]];};return ["macro",f];}else{if(((_tmp451=expr),(_tmp451=="Number"))){var f=function(env,context,_tmp458){var _tmp459;var _tmp460;var _tmp461;var expr;if((((_tmp459=_tmp458),(_tmp459 instanceof Array))&&(((_tmp460=_tmp459.length),(_tmp460==2))&&(((_tmp461=_tmp459[0]),(_tmp461=="data"))&&((expr=_tmp459[1]),true))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","number"]]];};return ["macro",f];}else{if(((_tmp450=expr),(_tmp450=="true"))){return ["macro",make_checker(["value",true],"___is")];}else{if(((_tmp449=expr),(_tmp449=="false"))){return ["macro",make_checker(["value",false],"___is")];}else{if(((_tmp448=expr),(_tmp448=="null"))){return ["macro",make_checker(["value",null],"___is")];}else{if(((_tmp447=expr),(_tmp447=="undefined"))){return ["macro",make_checker(["value",undefined],"___is")];}else{if(((other=expr),true)){return ["send",expr,["value","__check__"]];}else{throw "Could not find a match";}}}}}}}}}();var mac=function(env,context,expr){var other;var _tmp462;if(((_tmp462=context),(_tmp462=="pattern"))){return ["check",checker,expr];}else{if(((other=context),true)){return ["send",checker,["data",expr]];}else{throw "Could not find a match";}}};return ["macro",mac];});var tempnum=0;var gensym=function(){var name=("_tmp"+tempnum);(tempnum=(tempnum+1));return name;};var parse_lhs=function(env,lhs,rhs){var vars=[];var clauses=[];var current=["multi"];var mktemp=function(){var t=gensym();vars.push(t);return t;};var newclause=function(){if((current.length>1)){clauses.push(current);}else{false;}return (current=["multi"]);};var helper=function(lhs,curr){return helper_noexpand(expand.step(env,"pattern",lhs),curr);};var helper_noexpand=function(lhs,curr){var other;var _tmp463;var _tmp464;var _tmp465;var specs;var _tmp466;var _tmp467;var _tmp468;var fname;var spec;var _tmp469;var _tmp470;var _tmp471;var checker;var expr;var _tmp472;var _tmp473;var _tmp474;var xs;var _tmp475;var _tmp476;var _tmp477;var xs;var _tmp478;var _tmp479;var _tmp480;var v;var _tmp481;var _tmp482;var _tmp484;var _tmp483;if(((_tmp482=lhs),(((_tmp483=_tmp482),(_tmp483===null))||((_tmp484=_tmp482),(_tmp484=="_"))))){return false;}else{if(((_tmp481=lhs),(typeof(_tmp481)=="string"))){vars.push(lhs);current.push(["assign",lhs,curr]);return current.push(["value",true]);}else{if((((_tmp478=lhs),(_tmp478 instanceof Array))&&(((_tmp479=_tmp478.length),(_tmp479==2))&&(((_tmp480=_tmp478[0]),(_tmp480=="value"))&&((v=_tmp478[1]),true))))){var x=["check",["macro",make_checker(lhs,"___eq")],null];return helper_noexpand(x,curr);}else{if((((_tmp475=lhs),(_tmp475 instanceof Array))&&(((_tmp476=_tmp475.length),(_tmp476>=1))&&(((_tmp477=_tmp475[0]),(_tmp477=="all"))&&((xs=_tmp475.slice(1)),true))))){var temp=mktemp();(current=current.concat([["assign",temp,curr]]));return xs.forEach(function(x){return helper(x,temp);});}else{if((((_tmp472=lhs),(_tmp472 instanceof Array))&&(((_tmp473=_tmp472.length),(_tmp473>=1))&&(((_tmp474=_tmp472[0]),(_tmp474=="any"))&&((xs=_tmp472.slice(1)),true))))){var normalize=function(vars){return vars.filter(function(x){return (x.slice(0,4)!=="_tmp");}).sort().join(",");};var temp=mktemp();(current=current.concat([["assign",temp,curr]]));var myvars=undefined;var clauses=[];xs.forEach(function(x){var p=parse_lhs(env,x,temp);if((myvars===undefined)){(myvars=p[0]);}else{if((normalize(p[0])!==normalize(myvars))){throw [["Must have the same set of variables in both branches!",myvars]];}else{if(true){(vars=vars.concat(p[0]));}else{false;}}}return clauses.push(make_pattern_test(p[1]));});current.push(make_or_pattern(clauses));(vars=vars.concat(myvars));return newclause();}else{if((((_tmp469=lhs),(_tmp469 instanceof Array))&&(((_tmp470=_tmp469.length),(_tmp470==3))&&(((_tmp471=_tmp469[0]),(_tmp471=="check"))&&((checker=_tmp469[1]),true,(expr=_tmp469[2]),true))))){var temp=mktemp();(current=current.concat([["assign",temp,curr],["send",checker,["data",temp]]]));newclause();return helper(expr,temp);}else{if((((_tmp466=lhs),(_tmp466 instanceof Array))&&(((_tmp467=_tmp466.length),(_tmp467==3))&&(((_tmp468=_tmp466[0]),(_tmp468=="send"))&&((fname=_tmp466[1]),true,(spec=_tmp466[2]),true))))){return helper(fname,["send","->",["data",spec,curr]]);}else{if((((_tmp463=lhs),(_tmp463 instanceof Array))&&(((_tmp464=_tmp463.length),(_tmp464>=1))&&(((_tmp465=_tmp463[0]),(_tmp465=="data"))&&((specs=_tmp463.slice(1)),true))))){var fw=0;var bw=0;var rest=undefined;var members=specs.map(function(x){var v=expand.step(env,"pattern",x);if(((v instanceof Array)&&(v[0]=="dynsplice"))){(rest=v[1]);}else{if((rest===undefined)){(fw=(fw+1));}else{if(true){(bw=(bw+1));}else{false;}}}return v;});var cmp=function(){if((rest===undefined)){return "___eq";}else{if(true){return "___gte";}else{return false;}}}();var temp=mktemp();var len=mktemp();(current=current.concat([["assign",temp,curr],["send","___instanceof",["data",temp,"Array"]]]));newclause();(current=current.concat([["assign",len,["send",temp,["value","length"]]],["send",cmp,["data",len,["value",(fw+bw)]]]]));newclause();for(var j=0;(j<fw);(++j)){helper_noexpand(members[j],["send",temp,["value",j]]);}if((rest!==undefined)){var slice=function(){if((bw>0)){return ["data",["value",fw],["value",(-bw)]];}else{if(true){return ["data",["value",fw]];}else{return false;}}}();helper_noexpand(members[fw][1],["send",["send",temp,["value","slice"]],slice]);}else{false;}for(var j=0;(j<bw);(++j)){helper_noexpand(members[((fw+j)+1)],["send",temp,["send","___minus",["data",len,["value",(bw-j)]]]]);}}else{if(((other=lhs),true)){throw "OopsG";}else{throw "Could not find a match";}}}}}}}}}};helper(lhs,rhs);if((current.length>1)){clauses.push(current);}else{false;}return [vars,clauses];};var make_declarations=function(vars){return vars.map(function(name){return ["declare",name,["value",undefined]];});};var make_pattern_test=function(clauses){var ands=clauses.pop();while((clauses.length>0)){(ands=["send","___and",["data",clauses.pop(),ands]]);}return ands;};var make_or_pattern=function(clauses){var ors=clauses.pop();while((clauses.length>0)){(ors=["send","___or",["data",clauses.pop(),ors]]);}return ors;};stdenv.register_macro("|>",function(env,context,_tmp485){var _tmp486;var _tmp487;var _tmp488;var to_match;var cl;if((((_tmp486=_tmp485),(_tmp486 instanceof Array))&&(((_tmp487=_tmp486.length),(_tmp487==3))&&(((_tmp488=_tmp486[0]),(_tmp488=="data"))&&((to_match=_tmp486[1]),true,(cl=_tmp486[2]),true))))){false;}else{throw "a condition failed";}var clauses=function(){var other;var _tmp489;var _tmp490;var _tmp491;var cls;if((((_tmp489=cl),(_tmp489 instanceof Array))&&(((_tmp490=_tmp489.length),(_tmp490>=1))&&(((_tmp491=_tmp489[0]),(_tmp491=="multi"))&&((cls=_tmp489.slice(1)),true))))){return cls;}else{if(((other=cl),true)){return [other];}else{throw "Could not find a match";}}}();var decls=["multi"];var r=["js_throw",["value","Could not find a match"]];while((clauses.length>0)){var _tmp492;var _tmp493;var _tmp494;var _tmp495;var _tmp496;var _tmp497;var _tmp498;var lhs;var body;if((((_tmp492=clauses.pop()),(_tmp492 instanceof Array))&&(((_tmp493=_tmp492.length),(_tmp493==3))&&(((_tmp494=_tmp492[0]),(_tmp494=="send"))&&(((_tmp495=_tmp492[1]),(_tmp495=="->"))&&(((_tmp496=_tmp492[2]),(_tmp496 instanceof Array))&&(((_tmp497=_tmp496.length),(_tmp497==3))&&(((_tmp498=_tmp496[0]),(_tmp498=="data"))&&((lhs=_tmp496[1]),true,(body=_tmp496[2]),true))))))))){false;}else{throw "a condition failed";}var p=parse_lhs(env,lhs,to_match);var test=make_pattern_test(p[1]);(r=["if",test,body,r]);(decls=decls.concat(make_declarations(p[0])));}decls.push(r);return decls;});var js_op_table=({"___plus":"+","___minus":"-","___times":"*","___div":"/","___mod":"%","___binxor":"^","___binand":"&","___binor":"|","___binnot":"~","___and":"&&","___or":"||","___not":"!","___is":"===","___isnt":"!==","___eq":"==","___neq":"!=","___lt":"<","___gt":">","___lte":"<=","___gte":">=","___shl":"<<","___shr":">>","___shr2":">>>","___in":" in ","___instanceof":" instanceof ","___plusplus":"++","___minusminus":"--"});var translate=function(expr,mode){var other;var _tmp499;var _tmp500;var _tmp501;var f;var msg;var _tmp502;var _tmp503;var _tmp504;var f;var _tmp505;var _tmp506;var _tmp507;var args;var _tmp508;var _tmp509;var _tmp510;var f;var _tmp511;var msg;var _tmp512;var _tmp513;var _tmp514;var s;var _tmp515;var _tmp516;var _tmp517;var args;var _tmp518;var _tmp519;var _tmp520;var args;var _tmp521;var _tmp522;var _tmp523;var value;var _tmp524;var _tmp525;var _tmp526;var value;var _tmp527;var _tmp528;var _tmp529;var _tmp530;var _tmp531;var _tmp532;var _tmp533;var _tmp534;var _tmp535;var args;var _tmp536;var _tmp537;var _tmp538;var args;var _tmp539;var _tmp540;var _tmp541;var lhs;var rhs;var _tmp542;var _tmp543;var _tmp544;var binding;var value;var _tmp545;var _tmp546;var _tmp547;var binding;var _tmp548;var _tmp549;var _tmp550;var _tmp551;var _tmp552;var _tmp553;var _tmp554;var x;var y;var z;var body;var _tmp555;var _tmp556;var _tmp557;var test;var body;var _tmp558;var _tmp559;var _tmp560;var test;var pos;var neg;var _tmp561;var _tmp562;var _tmp563;var bindings;var body;var _tmp564;var _tmp565;var _tmp566;var v;var _tmp567;var _tmp568;if(((_tmp568=expr),(typeof(_tmp568)=="string"))){return translate.expr(translate.mangle(expr),mode);}else{if(((_tmp567=expr),(_tmp567===null))){return translate.expr("null",mode);}else{if((((_tmp564=expr),(_tmp564 instanceof Array))&&(((_tmp565=_tmp564.length),(_tmp565==2))&&(((_tmp566=_tmp564[0]),(_tmp566=="value"))&&((v=_tmp564[1]),true))))){var r=function(){var other;var _tmp569;var _tmp577;var _tmp570;var _tmp576;var _tmp571;var _tmp575;var _tmp572;var _tmp574;var _tmp573;var _tmp578;if(((_tmp578=v),(typeof(_tmp578)=="string"))){var repl=({"\"":"\\\"","\n":"\\n","\\":"\\\\"});(v=v.replace(RegExp("((?:(?:\"|\\\\)|\n))","g"),function(m){return repl[m];}));return (("\""+v)+"\"");}else{if(((_tmp569=v),(((_tmp570=_tmp569),(((_tmp571=_tmp570),(((_tmp572=_tmp571),(((_tmp573=_tmp572),(typeof(_tmp573)=="number"))||((_tmp574=_tmp572),(_tmp574===true))))||((_tmp575=_tmp571),(_tmp575===false))))||((_tmp576=_tmp570),(_tmp576===null))))||((_tmp577=_tmp569),(_tmp577===undefined))))){return String(v);}else{if(((other=v),true)){return (("?!?["+v)+"]?!?");}else{throw "Could not find a match";}}}}();return translate.expr(r,mode);}else{if((((_tmp561=expr),(_tmp561 instanceof Array))&&(((_tmp562=_tmp561.length),(_tmp562==3))&&(((_tmp563=_tmp561[0]),(_tmp563=="lambda"))&&((bindings=_tmp561[1]),true,(body=_tmp561[2]),true))))){var a=bindings.join(",");var b=translate.body(body,"return");return translate.expr((((("function("+a)+"){")+b)+"}"),mode);}else{if((((_tmp558=expr),(_tmp558 instanceof Array))&&(((_tmp559=_tmp558.length),(_tmp559==4))&&(((_tmp560=_tmp558[0]),(_tmp560=="if"))&&((test=_tmp558[1]),true,(pos=_tmp558[2]),true,(neg=_tmp558[3]),true))))){var other;var _tmp579;if(((_tmp579=mode),(_tmp579=="expr"))){return translate.body(expr,"expr");}else{if(((other=mode),true)){var a=translate(test,"expr");var b=translate(pos,mode);var c=translate(neg,mode);return (((((("if("+a)+"){")+b)+"}else{")+c)+"}");}else{throw "Could not find a match";}}}else{if((((_tmp555=expr),(_tmp555 instanceof Array))&&(((_tmp556=_tmp555.length),(_tmp556==3))&&(((_tmp557=_tmp555[0]),(_tmp557=="js_while"))&&((test=_tmp555[1]),true,(body=_tmp555[2]),true))))){var other;var _tmp580;if(((_tmp580=mode),(_tmp580=="expr"))){return translate.body(expr,"expr");}else{if(((other=mode),true)){var a=translate(test,"expr");var b=translate(body,"stmt");return (((("while("+a)+"){")+b)+"}");}else{throw "Could not find a match";}}}else{if((((_tmp552=expr),(_tmp552 instanceof Array))&&(((_tmp553=_tmp552.length),(_tmp553==5))&&(((_tmp554=_tmp552[0]),(_tmp554=="js_for"))&&((x=_tmp552[1]),true,(y=_tmp552[2]),true,(z=_tmp552[3]),true,(body=_tmp552[4]),true))))){var other;var _tmp581;if(((_tmp581=mode),(_tmp581=="expr"))){return translate.body(expr,"expr");}else{if(((other=mode),true)){var a=translate(x,"stmt");var b=translate(y,"stmt");var c=translate(z,"expr");var d=translate(body,"stmt");return (((((("for("+a)+b)+c)+"){")+d)+"}");}else{throw "Could not find a match";}}}else{if((((_tmp545=expr),(_tmp545 instanceof Array))&&(((_tmp546=_tmp545.length),(_tmp546==3))&&(((_tmp547=_tmp545[0]),(_tmp547=="declare"))&&(((binding=_tmp545[1]),true,(_tmp548=_tmp545[2]),(_tmp548 instanceof Array))&&(((_tmp549=_tmp548.length),(_tmp549==2))&&(((_tmp550=_tmp548[0]),(_tmp550=="value"))&&((_tmp551=_tmp548[1]),(_tmp551===undefined))))))))){var other;var _tmp582;var _tmp584;var _tmp583;if(((_tmp582=mode),(((_tmp583=_tmp582),(_tmp583=="expr"))||((_tmp584=_tmp582),(_tmp584=="return"))))){throw "Invalid in expr ctx";}else{if(((other=mode),true)){var a=translate(binding,"expr");return (("var "+a)+";");}else{throw "Could not find a match";}}}else{if((((_tmp542=expr),(_tmp542 instanceof Array))&&(((_tmp543=_tmp542.length),(_tmp543==3))&&(((_tmp544=_tmp542[0]),(_tmp544=="declare"))&&((binding=_tmp542[1]),true,(value=_tmp542[2]),true))))){var other;var _tmp585;var _tmp587;var _tmp586;if(((_tmp585=mode),(((_tmp586=_tmp585),(_tmp586=="expr"))||((_tmp587=_tmp585),(_tmp587=="return"))))){throw "Invalid in expr ctx";}else{if(((other=mode),true)){var a=translate(binding,"expr");var b=translate(value,"expr");return (((("var "+a)+"=")+b)+";");}else{throw "Could not find a match";}}}else{if((((_tmp539=expr),(_tmp539 instanceof Array))&&(((_tmp540=_tmp539.length),(_tmp540==3))&&(((_tmp541=_tmp539[0]),(_tmp541=="assign"))&&((lhs=_tmp539[1]),true,(rhs=_tmp539[2]),true))))){var a=translate(lhs,"expr");var b=translate(rhs,"expr");return translate.expr((((("("+a)+"=")+b)+")"),mode);}else{if((((_tmp536=expr),(_tmp536 instanceof Array))&&(((_tmp537=_tmp536.length),(_tmp537>=1))&&(((_tmp538=_tmp536[0]),(_tmp538=="multi"))&&((args=_tmp536.slice(1)),true))))){var isdecl=function(x){return ((x instanceof Array)&&(x[0]=="declare"));};if((args.length==1)){return translate(args[0],mode);}else{if(((mode=="expr")&&(!args.some(isdecl)))){var xs=args.map(function(x){return translate(x,"expr");});return (("("+xs.join(","))+")");}else{if(true){return translate.body(expr,mode);}else{return false;}}}}else{if((((_tmp533=expr),(_tmp533 instanceof Array))&&(((_tmp534=_tmp533.length),(_tmp534>=1))&&(((_tmp535=_tmp533[0]),(_tmp535=="splice"))&&((args=_tmp533.slice(1)),true))))){return translate(["multi"].concat(args),mode);}else{if((((_tmp530=expr),(_tmp530 instanceof Array))&&(((_tmp531=_tmp530.length),(_tmp531==1))&&((_tmp532=_tmp530[0]),(_tmp532=="js_break"))))){if((mode=="expr")){throw "Invalid break in ctx";}else{if(true){return "break;";}else{return false;}}}else{if((((_tmp527=expr),(_tmp527 instanceof Array))&&(((_tmp528=_tmp527.length),(_tmp528==1))&&((_tmp529=_tmp527[0]),(_tmp529=="js_continue"))))){if((mode=="expr")){throw "Invalid continue in ctx";}else{if(true){return "continue;";}else{return false;}}}else{if((((_tmp524=expr),(_tmp524 instanceof Array))&&(((_tmp525=_tmp524.length),(_tmp525==2))&&(((_tmp526=_tmp524[0]),(_tmp526=="js_return"))&&((value=_tmp524[1]),true))))){if((mode=="expr")){throw "Invalid return in ctx";}else{if(true){return (("return "+translate(value,"expr"))+";");}else{return false;}}}else{if((((_tmp521=expr),(_tmp521 instanceof Array))&&(((_tmp522=_tmp521.length),(_tmp522==2))&&(((_tmp523=_tmp521[0]),(_tmp523=="js_throw"))&&((value=_tmp521[1]),true))))){if(true){return (("throw "+translate(value,"expr"))+";");}else{return false;}}else{if((((_tmp518=expr),(_tmp518 instanceof Array))&&(((_tmp519=_tmp518.length),(_tmp519>=1))&&(((_tmp520=_tmp518[0]),(_tmp520=="array"))&&((args=_tmp518.slice(1)),true))))){var r=function(){var f=function(x){return translate(x,"expr");};return (("["+args.map(f).join(","))+"]");}();return translate.expr(r,mode);}else{if((((_tmp515=expr),(_tmp515 instanceof Array))&&(((_tmp516=_tmp515.length),(_tmp516>=1))&&(((_tmp517=_tmp515[0]),(_tmp517=="object"))&&((args=_tmp515.slice(1)),true))))){var r=function(){var f=function(x){var a=translate(x[1],"expr");var b=translate(x[2],"expr");return ((a+":")+b);};return (("({"+args.map(f).join(","))+"})");}();return translate.expr(r,mode);}else{if((((_tmp508=expr),(_tmp508 instanceof Array))&&(((_tmp509=_tmp508.length),(_tmp509==3))&&(((_tmp510=_tmp508[0]),(_tmp510=="send"))&&(((f=_tmp508[1]),true,(_tmp511=_tmp508[2]),(msg=_tmp511),true,(_tmp512=_tmp511),(_tmp512 instanceof Array))&&(((_tmp513=_tmp512.length),(_tmp513==2))&&(((_tmp514=_tmp512[0]),(_tmp514=="value"))&&((s=_tmp512[1]),true)))))))){if(((typeof(s)=="string")&&s.match(RegExp("(?:^(?:[a-zA-Z_$]+)$)")))){var trf=translate(f,"expr");var trmsg=translate(s,"expr");return translate.expr(((trf+".")+trmsg),mode);}else{if(true){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{return false;}}}else{if((((_tmp502=expr),(_tmp502 instanceof Array))&&(((_tmp503=_tmp502.length),(_tmp503==3))&&(((_tmp504=_tmp502[0]),(_tmp504=="send"))&&(((f=_tmp502[1]),true,(_tmp505=_tmp502[2]),(_tmp505 instanceof Array))&&(((_tmp506=_tmp505.length),(_tmp506>=1))&&(((_tmp507=_tmp505[0]),(_tmp507=="array"))&&((args=_tmp505.slice(1)),true)))))))){var op=((typeof(f)=="string")&&js_op_table[f]);if(op){return translate.expr(translate.op(op,args[0],args[1]),mode);}else{if(true){var trf=translate(f,"expr");var trargs=args.map(function(x){return translate(x,"expr");});return translate.expr((((trf+"(")+trargs.join(","))+")"),mode);}else{return false;}}}else{if((((_tmp499=expr),(_tmp499 instanceof Array))&&(((_tmp500=_tmp499.length),(_tmp500==3))&&(((_tmp501=_tmp499[0]),(_tmp501=="send"))&&((f=_tmp499[1]),true,(msg=_tmp499[2]),true))))){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{if(((other=expr),true)){throw other;}else{throw "Could not find a match";}}}}}}}}}}}}}}}}}}}}}}};(translate.mangle=function(name){var tr=({"+":"__plus__","-":"__minus__","*":"__asterisk__","/":"__slash__","%":"__percent__","^":"__caret__","#":"__hash__","&":"__amp__","|":"__pipe__","@":"__at__","!":"__bang__","?":"__qmark__","=":"__equal__","<":"__lt__",">":"__gt__","~":"__tilde__",".":"__dot__"});var r=[];for(var i=0;(i<name.length);(++i)){var c=name[i];r.push((tr[c]||c));}return r.join("");});(translate.body=function(b,mode){(orig=b);(b=aslist(b));var trst=function(stmt){return translate(stmt,"stmt");};var other;var _tmp588;var _tmp589;var _tmp590;if(((_tmp590=mode),(_tmp590=="expr"))){var x=["send",["lambda",[],orig],["array"]];return translate(x,mode);}else{if(((_tmp589=mode),(_tmp589=="return"))){var stmts=b.slice(0,(-1));var ret=b[(b.length-1)];return (stmts.map(trst).join("")+translate(ret,"return"));}else{if(((_tmp588=mode),(_tmp588=="stmt"))){return b.map(trst).join("");}else{if(((other=mode),true)){throw "OopsH";}else{throw "Could not find a match";}}}}});(translate.expr=function(x,mode){var other;var _tmp591;var _tmp592;var _tmp593;if(((_tmp593=mode),(_tmp593=="expr"))){return x;}else{if(((_tmp592=mode),(_tmp592=="stmt"))){return (x+";");}else{if(((_tmp591=mode),(_tmp591=="return"))){return (("return "+x)+";");}else{if(((other=mode),true)){throw "OopsI";}else{throw "Could not find a match";}}}}});(translate.op=function(op,a,b){(e=function(){if((a===null)){return (op+translate(b,"expr"));}else{if((b===null)){return (translate(a,"expr")+op);}else{if(true){return ((translate(a,"expr")+op)+translate(b,"expr"));}else{return false;}}}}());return (("("+e)+")");});var fs=require("fs");var file=process.argv[2];var f=function(err,data){var p=parse(data);var ex=expand(stdenv,"top",["multi",p]);var prelude="var ___lib=require(\"./lib\");";return console.log((prelude+translate(ex,"stmt")));};fs.readFile(file,"utf8",f);
