var ___lib=require("./lib");var special_ops=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",":":"IFX",".":"PFX"});var regexps=function(){var id=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))");var id_f=function(m,wsb,wsa,last_op){return ["ID","ID",m[0]];};var num=RegExp("(?:^((?:\\d+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:\\d+)))?))");var num_f=function(m,wsb,wsa,last_op){return ["ID","NUM",m[0]];};var str=RegExp("(?:^\"((?:(?:(?:\\\\\\\\|\\\\\")|[^\"])*))\")");var str_f=function(m,wsb,wsa,last_op){var repl=({"\\\"":"\"","\\\\":"\\","\\n":"\n"});var r=m[1].replace(RegExp("((?:(?:\\\\\"|\\\\\\\\)|\\\\n))","g"),function(m){return repl[m];});return ["ID","STR",r];};var op=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!#.:]+))");var op2=RegExp("(?:^[\\(\\[\\{\\}\\]\\),])");var op3=RegExp("(?:^(?:(?:(?:(?:(?:with|where)|and)|or)|in)|instanceof)\\b)");var op_f=function(m,wsb,wsa,last_op){var op=m[0];if((op in special_ops)){var fixity=special_ops[op];var width=function(){if((fixity=="IFX")){if((wsb||wsa)){return "wide";}else{return "short";}}else{if((fixity=="SFX")){if(wsb){return "wide";}else{return "short";}}else{if((fixity=="PFX")){if(wsa){return "wide";}else{return "short";}}else{return false;}}}}();return ["OP",fixity,width,op];}else{if((wsa&&wsb)){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "IFX";}else{return false;}}}(),"wide",op];}else{if(((!wsa)&&(!wsb))){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "IFX";}else{return false;}}}(),"short",op];}else{if(wsa){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "SFX";}else{return false;}}}(),"short",op];}else{if(wsb){return ["OP","PFX","short",op];}else{if(true){return ["OP","PFX","short",op];}else{return false;}}}}}}};var indent=RegExp("(?:^(?:(?:\n(?: *))+))");var indent_f=function(m,wsb,wsa,last_op){return ["OP","IFX","wide",","];};var cmnt=RegExp("(?:^;(?:[^\n]*))");var cmnt_f=function(m,wsb,wsa,last_op){return ["IGNORE"];};var unkn=RegExp("(?:^.)");var unkn_f=function(m,wsb,wsa,last_op){throw ("unknown character: "+m[0]);};return [[op3,op_f],[id,id_f],[num,num_f],[str,str_f],[op,op_f],[op2,op_f],[indent,indent_f],[cmnt,cmnt_f],[unkn,unkn_f]];}();var ws_re=RegExp("(?:(?: *)(?:(?:\n(?: *)\\\\(?: *))*))");var tokenize=function(text){var last_op=true;var results=[];var wsb=text.match(ws_re)[0].length;(text=text.slice(wsb));(pos=wsb);while(text){for(var i=0;(i<regexps.length);(++i)){var spec=regexps[i];var re=spec[0];var m=text.match(re);if(m){var fn=spec[1];var skip=m[0].length;(text=text.slice(skip));var wsa=text.match(ws_re)[0].length;var r=fn(m,(wsb>0),(wsa>0),last_op);var type=r[0];var result=r.slice(1);(result.location=[pos,(pos+skip)]);if((type=="IGNORE")){null;}else{if((type=="ID")){if((!last_op)){var w=["IFX",function(){if((wsa||wsb)){return "wide";}else{return "short";}}(),"WHITE"];(w.location=[pos,pos]);results.push(w);}else{false;}results.push(result);(last_op=false);}else{if((type=="OP")){if(last_op){var v=["VOID"];(v.location=[pos,pos]);results.push(v);}else{false;}if((result[0]=="IFX")){results.push(result);(last_op=true);}else{if((result[0]=="PFX")){if((!last_op)){var w=["IFX",function(){if((wsa||wsb)){return "wide";}else{return "short";}}(),"WHITE"];(w.location=[pos,pos]);var v=["VOID"];(v.location=[pos,pos]);results.push(w);results.push(v);}else{false;}results.push(result);(last_op=true);}else{if((result[0]=="SFX")){results.push(result);var v=["VOID"];(v.location=[(pos+skip),(pos+skip)]);results.push(v);(last_op=false);}else{false;}}}}else{false;}}}(text=text.slice(wsa));(wsb=wsa);(pos=((pos+skip)+wsa));break;}else{false;}}}if(last_op){var v=["VOID"];(v.location=[pos,pos]);results.push(v);}else{false;}return results;};var MAX=(1/0);var order_map=({"IFX":({"wide":({"default":[900,901],"WHITE":[1000,1001],",":[1,1],"with":[11,10],"where":[11,10],"->":[11,10],"=>":[11,10],"=":[11,10],":=":[11,10],"+":[300,301],"*":[400,401],"**":[501,500],":":[1001,2]}),"short":({"default":[1900,1901],"WHITE":[2000,2001],",":[1,1],":":[1001,2]})}),"PFX":({"wide":({"default":[MAX,900],".":[MAX,3000],"#":[MAX,3000],"(":[MAX,1],"[":[MAX,1],"{":[MAX,1]}),"short":({"default":[MAX,1900],".":[MAX,3000],"#":[MAX,3000],"(":[MAX,1],"[":[MAX,1],"{":[MAX,1]})}),"SFX":({"wide":({"default":[901,MAX],")":[1,MAX],"]":[1,MAX],"}":[1,MAX]}),"short":({"default":[1901,MAX],")":[1,MAX],"]":[1,MAX],"}":[1,MAX]})})});var DONE=(-1);var NONE=0;var LEFT=1;var RIGHT=2;var BOTH=3;var oparse=function(next,order,finalize){var between=finalize(next());var right_op=next();var stack=[];var left_op=null;var current=null;while(true){var o=function(){if(((!left_op)&&(!right_op))){return DONE;}else{if(true){return ((((!left_op)&&RIGHT)||((!right_op)&&LEFT))||order(left_op,right_op));}else{return false;}}}();var _tmp0=undefined;var _tmp1=undefined;var _tmp2=undefined;var _tmp3=undefined;var _tmp4=undefined;if(((_tmp4=o),(_tmp4==DONE))){return between;}else{if(((_tmp3=o),(_tmp3==LEFT))){current.push(between);(between=finalize(current));var v=stack.pop();(left_op=v[0]);(current=v[1]);}else{if(((_tmp2=o),(_tmp2==RIGHT))){stack.push([left_op,current]);(left_op=right_op);(current=[[right_op],between]);(between=finalize(next()));(right_op=next());}else{if(((_tmp1=o),(_tmp1==BOTH))){current[0].push(right_op);current.push(between);(left_op=right_op);(between=finalize(next()));(right_op=next());}else{if(((_tmp0=o),(_tmp0==NONE))){throw ((("Undefined priority between "+left_op)+" and ")+right_op);}else{throw "Could not find a match";}}}}}}};var consult=function(o){var map=order_map[o[0]][o[1]];return (map[o[2]]||map.default);};var order=function(o1,o2){var ord1=consult(o1)[1];var ord2=consult(o2)[0];if((ord1>ord2)){return LEFT;}else{if((ord1<ord2)){return RIGHT;}else{if((ord1==ord2)){return BOTH;}else{return false;}}}};var finalize=function(x){var _tmp5=undefined;var _tmp6=undefined;var ops=undefined;var args=undefined;var _tmp7=undefined;var _tmp8=undefined;var _tmp9=undefined;var _tmp10=undefined;var _tmp11=undefined;var _tmp12=undefined;var value=undefined;var _tmp13=undefined;var _tmp14=undefined;var _tmp15=undefined;var value=undefined;var _tmp16=undefined;var _tmp17=undefined;var _tmp18=undefined;var value=undefined;if((((_tmp16=x),(_tmp16 instanceof Array))&&(((_tmp17=_tmp16.length),(_tmp17==2))&&(((_tmp18=_tmp16[0]),(_tmp18=="ID"))&&((value=_tmp16[1]),true))))){return value;}else{if((((_tmp13=x),(_tmp13 instanceof Array))&&(((_tmp14=_tmp13.length),(_tmp14==2))&&(((_tmp15=_tmp13[0]),(_tmp15=="NUM"))&&((value=_tmp13[1]),true))))){return ["value",parseFloat(value)];}else{if((((_tmp10=x),(_tmp10 instanceof Array))&&(((_tmp11=_tmp10.length),(_tmp11==2))&&(((_tmp12=_tmp10[0]),(_tmp12=="STR"))&&((value=_tmp10[1]),true))))){return ["value",value];}else{if((((_tmp7=x),(_tmp7 instanceof Array))&&(((_tmp8=_tmp7.length),(_tmp8==1))&&((_tmp9=_tmp7[0]),(_tmp9=="VOID"))))){return null;}else{if((((_tmp5=x),(_tmp5 instanceof Array))&&(((_tmp6=_tmp5.length),(_tmp6>=1))&&((ops=_tmp5[0]),true,(args=_tmp5.slice(1)),true)))){var opcat=ops.map(function(o){return o[2];}).join("");var op=ops[0][2];var other=undefined;var _tmp19=undefined;var _tmp20=undefined;var _tmp21=undefined;var _tmp22=undefined;var _tmp23=undefined;var target=undefined;var body=undefined;var _tmp24=undefined;var _tmp25=undefined;var _tmp26=undefined;var _tmp27=undefined;var _tmp28=undefined;var f=undefined;var body=undefined;var _tmp29=undefined;var _tmp30=undefined;var _tmp31=undefined;var _tmp32=undefined;var _tmp33=undefined;var f=undefined;var arg=undefined;var body=undefined;if((((_tmp29=[opcat,args]),(_tmp29 instanceof Array))&&(((_tmp30=_tmp29.length),(_tmp30==2))&&(((_tmp31=_tmp29[0]),(_tmp31=="WHITE:"))&&(((_tmp32=_tmp29[1]),(_tmp32 instanceof Array))&&(((_tmp33=_tmp32.length),(_tmp33==3))&&((f=_tmp32[0]),true,(arg=_tmp32[1]),true,(body=_tmp32[2]),true))))))){return ["send",f,["data",["code",arg],["code",body]]];}else{if((((_tmp24=[opcat,args]),(_tmp24 instanceof Array))&&(((_tmp25=_tmp24.length),(_tmp25==2))&&(((_tmp26=_tmp24[0]),(_tmp26==":"))&&(((_tmp27=_tmp24[1]),(_tmp27 instanceof Array))&&(((_tmp28=_tmp27.length),(_tmp28==2))&&((f=_tmp27[0]),true,(body=_tmp27[1]),true))))))){return ["send",f,["data",["code",body]]];}else{if((((_tmp19=[opcat,args]),(_tmp19 instanceof Array))&&(((_tmp20=_tmp19.length),(_tmp20==2))&&(((_tmp21=_tmp19[0]),(_tmp21=="with"))&&(((_tmp22=_tmp19[1]),(_tmp22 instanceof Array))&&(((_tmp23=_tmp22.length),(_tmp23==2))&&((target=_tmp22[0]),true,(body=_tmp22[1]),true))))))){(body=function(){var other=undefined;var _tmp43=undefined;var _tmp44=undefined;var _tmp45=undefined;var rest=undefined;if((((_tmp43=body),(_tmp43 instanceof Array))&&(((_tmp44=_tmp43.length),(_tmp44>=1))&&(((_tmp45=_tmp43[0]),(_tmp45=="multi"))&&((rest=_tmp43.slice(1)),true))))){return rest;}else{if(((other=body),true)){return [body];}else{throw "Could not find a match";}}}());var other=undefined;var _tmp34=undefined;var _tmp35=undefined;var _tmp36=undefined;var args=undefined;var _tmp37=undefined;var _tmp38=undefined;var _tmp39=undefined;var f=undefined;var _tmp40=undefined;var _tmp41=undefined;var _tmp42=undefined;var args=undefined;if((((_tmp37=target),(_tmp37 instanceof Array))&&(((_tmp38=_tmp37.length),(_tmp38==3))&&(((_tmp39=_tmp37[0]),(_tmp39=="send"))&&(((f=_tmp37[1]),true,(_tmp40=_tmp37[2]),(_tmp40 instanceof Array))&&(((_tmp41=_tmp40.length),(_tmp41>=1))&&(((_tmp42=_tmp40[0]),(_tmp42=="data"))&&((args=_tmp40.slice(1)),true)))))))){return ["send",f,["data"].concat(args).concat(body)];}else{if((((_tmp34=target),(_tmp34 instanceof Array))&&(((_tmp35=_tmp34.length),(_tmp35>=1))&&(((_tmp36=_tmp34[0]),(_tmp36=="data"))&&((args=_tmp34.slice(1)),true))))){return target.concat(body);}else{if(((other=target),true)){return ["send",target,["data"].concat(body)];}else{throw "Could not find a match";}}}}else{if(((other=[opcat,args]),true)){if(((op=="[")||(op==","))){if((op=="[")){(args=args.slice(1,(-1)));}else{false;}(args=function(){var f=function(x){return (x!==null);};return args.filter(f);}());var other=undefined;var _tmp46=undefined;var _tmp47=undefined;var x=undefined;var _tmp48=undefined;var _tmp49=undefined;if((((_tmp48=args),(_tmp48 instanceof Array))&&((_tmp49=_tmp48.length),(_tmp49==0)))){throw "At least one expression must be enclosed in []";}else{if((((_tmp46=args),(_tmp46 instanceof Array))&&(((_tmp47=_tmp46.length),(_tmp47==1))&&((x=_tmp46[0]),true)))){return x;}else{if(((other=args),true)){return ["multi"].concat(args);}else{throw "Could not find a match";}}}}else{if((op=="{")){var f=function(x){return (x!==null);};return ["data"].concat(args.slice(1,(-1)).filter(f));}else{if((op=="WHITE")){return ["send"].concat(args);}else{if((((args.length==2)&&(args[0]===null))&&(args[1]===null))){return op;}else{if(true){return ["send",op,["data"].concat(args)];}else{return false;}}}}}}else{throw "Could not find a match";}}}}}else{throw "Could not find a match";}}}}}};var parse=function(text){var results=tokenize(text);var next=function(){return results.shift();};return oparse(next,order,finalize);};var Env=function(parent){var store=Object();var self=function(expr){return ["bind_env",self,expr];};(self.resolve=function(name){var attempt=store[name];if(attempt){return attempt;}else{if(true){return self.parent.resolve(name);}else{return false;}}});(self.register=function(name,value){return (store[name]=value);});(self.register_macro=function(name,m){return (store[name]=["macro",m]);});(self.fork=function(){return Env(self);});(self.parent=parent);(self.store=store);return self;};var js_contexts=({"js_for":["multi","multi","multi","multi"]});var expand=function(env,context,expr){(expr=expand.step(env,context,expr));var other=undefined;var _tmp50=undefined;var _tmp51=undefined;var _tmp52=undefined;var _tmp64=undefined;var _tmp53=undefined;var _tmp63=undefined;var _tmp54=undefined;var _tmp62=undefined;var _tmp55=undefined;var _tmp61=undefined;var _tmp56=undefined;var _tmp60=undefined;var _tmp57=undefined;var _tmp59=undefined;var _tmp58=undefined;var args=undefined;var _tmp65=undefined;var _tmp66=undefined;var _tmp67=undefined;var lhs=undefined;var rhs=undefined;var _tmp68=undefined;var _tmp69=undefined;var _tmp70=undefined;var binding=undefined;var value=undefined;var _tmp71=undefined;var _tmp72=undefined;var _tmp73=undefined;var bindings=undefined;var body=undefined;var _tmp74=undefined;var _tmp75=undefined;var _tmp76=undefined;var args=undefined;var _tmp77=undefined;var _tmp78=undefined;var _tmp79=undefined;var type=undefined;var _tmp80=undefined;var _tmp88=undefined;var _tmp81=undefined;var _tmp87=undefined;var _tmp82=undefined;var _tmp86=undefined;var _tmp83=undefined;var _tmp85=undefined;var _tmp84=undefined;var args=undefined;var _tmp89=undefined;var _tmp90=undefined;var _tmp91=undefined;var v=undefined;var _tmp92=undefined;var _tmp93=undefined;var _tmp94=undefined;var f=undefined;var arg=undefined;var _tmp95=undefined;var _tmp96=undefined;var _tmp97=undefined;if(((_tmp97=expr),(typeof(_tmp97)=="string"))){return expr;}else{if(((_tmp96=expr),(_tmp96===null))){return null;}else{if(((_tmp95=expr),(_tmp95===undefined))){throw "undefined? why?";}else{if((((_tmp92=expr),(_tmp92 instanceof Array))&&(((_tmp93=_tmp92.length),(_tmp93==3))&&(((_tmp94=_tmp92[0]),(_tmp94=="send"))&&((f=_tmp92[1]),true,(arg=_tmp92[2]),true))))){var f=expand(env,"head",expr[1]);var arg=expr[2];return ["send",f,expand(env,"tail",arg)];}else{if((((_tmp89=expr),(_tmp89 instanceof Array))&&(((_tmp90=_tmp89.length),(_tmp90==2))&&(((_tmp91=_tmp89[0]),(_tmp91=="value"))&&((v=_tmp89[1]),true))))){return expr;}else{if((((_tmp77=expr),(_tmp77 instanceof Array))&&(((_tmp78=_tmp77.length),(_tmp78>=1))&&(((_tmp79=_tmp77[0]),(type=_tmp79),true,(_tmp80=_tmp79),(((_tmp81=_tmp80),(((_tmp82=_tmp81),(((_tmp83=_tmp82),(((_tmp84=_tmp83),(_tmp84=="multi"))||((_tmp85=_tmp83),(_tmp85=="code"))))||((_tmp86=_tmp82),(_tmp86=="array"))))||((_tmp87=_tmp81),(_tmp87=="object"))))||((_tmp88=_tmp80),(_tmp88=="splice"))))&&((args=_tmp77.slice(1)),true))))){var arr=[];while((args.length>0)){var x=expand.step(env,type,args.shift());if(((x instanceof Array)&&(x[0]=="splice"))){(args=x.slice(1).concat(args));}else{if(true){arr.push(x);}else{false;}}}var f=function(x){return expand(env,type,x);};return [type].concat(arr.map(f));}else{if((((_tmp74=expr),(_tmp74 instanceof Array))&&(((_tmp75=_tmp74.length),(_tmp75>=1))&&(((_tmp76=_tmp74[0]),(_tmp76=="data"))&&((args=_tmp74.slice(1)),true))))){var is_obj=false;var obj=["object"];var arr=["array"];while((args.length>0)){var x=expand.step(env,type,args.shift());var other=undefined;var _tmp98=undefined;var _tmp99=undefined;var _tmp100=undefined;var exprs=undefined;var _tmp101=undefined;var _tmp102=undefined;var _tmp103=undefined;var k=undefined;var v=undefined;var _tmp104=undefined;var _tmp105=undefined;var _tmp106=undefined;var _tmp107=undefined;if(((_tmp107=x),(_tmp107===null))){arr.push(null);}else{if((((_tmp104=x),(_tmp104 instanceof Array))&&(((_tmp105=_tmp104.length),(_tmp105==1))&&((_tmp106=_tmp104[0]),(_tmp106=="assoc"))))){(is_obj=true);}else{if((((_tmp101=x),(_tmp101 instanceof Array))&&(((_tmp102=_tmp101.length),(_tmp102==3))&&(((_tmp103=_tmp101[0]),(_tmp103=="assoc"))&&((k=_tmp101[1]),true,(v=_tmp101[2]),true))))){(is_obj=true);obj.push(["array",k,v]);}else{if((((_tmp98=x),(_tmp98 instanceof Array))&&(((_tmp99=_tmp98.length),(_tmp99>=1))&&(((_tmp100=_tmp98[0]),(_tmp100=="splice"))&&((exprs=_tmp98.slice(1)),true))))){(args=exprs.concat(args));}else{if(((other=x),true)){arr.push(other);}else{throw "Could not find a match";}}}}}}var r=function(){if(((arr.length>1)&&is_obj)){arr.push(obj);return arr;}else{if(is_obj){return obj;}else{if(true){return arr;}else{return false;}}}}();return expand(env,context,r);}else{if((((_tmp71=expr),(_tmp71 instanceof Array))&&(((_tmp72=_tmp71.length),(_tmp72==3))&&(((_tmp73=_tmp71[0]),(_tmp73=="lambda"))&&((bindings=_tmp71[1]),true,(body=_tmp71[2]),true))))){return ["lambda",bindings.map(function(x){return expand(env,"decl",x);}),expand(env,"multi",body)];}else{if((((_tmp68=expr),(_tmp68 instanceof Array))&&(((_tmp69=_tmp68.length),(_tmp69==3))&&(((_tmp70=_tmp68[0]),(_tmp70=="declare"))&&((binding=_tmp68[1]),true,(value=_tmp68[2]),true))))){return ["declare",expand(env,"decl",binding),expand(env,"multi",value)];}else{if((((_tmp65=expr),(_tmp65 instanceof Array))&&(((_tmp66=_tmp65.length),(_tmp66==3))&&(((_tmp67=_tmp65[0]),(_tmp67=="assign"))&&((lhs=_tmp65[1]),true,(rhs=_tmp65[2]),true))))){return ["assign",expand(env,"decl",lhs),expand(env,"multi",rhs)];}else{if((((_tmp50=expr),(_tmp50 instanceof Array))&&(((_tmp51=_tmp50.length),(_tmp51>=1))&&(((_tmp52=_tmp50[0]),(((_tmp53=_tmp52),(((_tmp54=_tmp53),(((_tmp55=_tmp54),(((_tmp56=_tmp55),(((_tmp57=_tmp56),(((_tmp58=_tmp57),(_tmp58=="js_while"))||((_tmp59=_tmp57),(_tmp59=="js_for"))))||((_tmp60=_tmp56),(_tmp60=="js_break"))))||((_tmp61=_tmp55),(_tmp61=="js_continue"))))||((_tmp62=_tmp54),(_tmp62=="js_return"))))||((_tmp63=_tmp53),(_tmp63=="js_throw"))))||((_tmp64=_tmp52),(_tmp64=="if"))))&&((args=_tmp50.slice(1)),true))))){var ctxs=(js_contexts[type]||[]);var f=function(x,i){return expand(env,(ctxs[i]||"expr"),x);};return [type].concat(args.map(f));}else{if(((other=expr),true)){throw ["Oops",type,context];}else{throw "Could not find a match";}}}}}}}}}}}}};(expand.step=function(env,context,expr){var other=undefined;var _tmp108=undefined;var _tmp109=undefined;var type=undefined;var args=undefined;var _tmp110=undefined;var _tmp111=undefined;var _tmp112=undefined;var f=undefined;var arg=undefined;var _tmp113=undefined;var _tmp114=undefined;var _tmp115=undefined;var m=undefined;var _tmp116=undefined;var _tmp117=undefined;var _tmp118=undefined;if(((_tmp118=expr),(typeof(_tmp118)=="string"))){var v=env.resolve(expr);var other=undefined;var _tmp119=undefined;var _tmp120=undefined;var _tmp121=undefined;var _tmp122=undefined;var _tmp123=undefined;var m=undefined;var _=undefined;var _tmp124=undefined;var _tmp125=undefined;var _tmp126=undefined;var _tmp127=undefined;var _tmp128=undefined;var m=undefined;var _tmp129=undefined;var _tmp130=undefined;var _tmp131=undefined;var _tmp132=undefined;var _=undefined;if((((_tmp130=[v,context]),(_tmp130 instanceof Array))&&(((_tmp131=_tmp130.length),(_tmp131==2))&&(((_tmp132=_tmp130[0]),(_tmp132===undefined))&&((_=_tmp130[1]),true))))){return expr;}else{if((((_tmp124=[v,context]),(_tmp124 instanceof Array))&&(((_tmp125=_tmp124.length),(_tmp125==2))&&(((_tmp126=_tmp124[0]),(_tmp126 instanceof Array))&&(((_tmp127=_tmp126.length),(_tmp127==2))&&(((_tmp128=_tmp126[0]),(_tmp128=="macro"))&&((m=_tmp126[1]),true,(_tmp129=_tmp124[1]),(_tmp129=="head")))))))){return v;}else{if((((_tmp119=[v,context]),(_tmp119 instanceof Array))&&(((_tmp120=_tmp119.length),(_tmp120==2))&&(((_tmp121=_tmp119[0]),(_tmp121 instanceof Array))&&(((_tmp122=_tmp121.length),(_tmp122==2))&&(((_tmp123=_tmp121[0]),(_tmp123=="macro"))&&((m=_tmp121[1]),true,(_=_tmp119[1]),true))))))){return expand.step(env,context,m(env,context,null));}else{if(((other=[v,context]),true)){return v;}else{throw "Could not find a match";}}}}}else{if(((_tmp117=expr),(_tmp117===null))){return null;}else{if(((_tmp116=expr),(_tmp116===undefined))){throw "undefined? why?";}else{if((((_tmp113=expr),(_tmp113 instanceof Array))&&(((_tmp114=_tmp113.length),(_tmp114==2))&&(((_tmp115=_tmp113[0]),(_tmp115=="macro"))&&((m=_tmp113[1]),true))))){if((context=="head")){return expr;}else{if(true){return expand.step(env,context,m(env,context,null));}else{return false;}}}else{if((((_tmp110=expr),(_tmp110 instanceof Array))&&(((_tmp111=_tmp110.length),(_tmp111==3))&&(((_tmp112=_tmp110[0]),(_tmp112=="send"))&&((f=_tmp110[1]),true,(arg=_tmp110[2]),true))))){(f=expand.step(env,"head",f));var other=undefined;var _tmp133=undefined;var _tmp134=undefined;var _tmp135=undefined;var m=undefined;if((((_tmp133=f),(_tmp133 instanceof Array))&&(((_tmp134=_tmp133.length),(_tmp134==2))&&(((_tmp135=_tmp133[0]),(_tmp135=="macro"))&&((m=_tmp133[1]),true))))){return expand.step(env,context,m(env,context,arg));}else{if(((other=f),true)){return expr;}else{throw "Could not find a match";}}}else{if((((_tmp108=expr),(_tmp108 instanceof Array))&&(((_tmp109=_tmp108.length),(_tmp109>=1))&&((type=_tmp108[0]),true,(args=_tmp108.slice(1)),true)))){return expr;}else{if(((other=expr),true)){throw ["Oops2",expr];}else{throw "Could not find a match";}}}}}}}});var aslist=function(expr){var other=undefined;var _tmp136=undefined;var _tmp137=undefined;var _tmp138=undefined;var args=undefined;var _tmp139=undefined;var _tmp140=undefined;if(((_tmp140=expr),(_tmp140===null))){return [null];}else{if(((_tmp139=expr),(_tmp139===undefined))){return [undefined];}else{if((((_tmp136=expr),(_tmp136 instanceof Array))&&(((_tmp137=_tmp136.length),(_tmp137>=1))&&(((_tmp138=_tmp136[0]),(_tmp138=="multi"))&&((args=_tmp136.slice(1)),true))))){return args;}else{if(((other=expr),true)){return [other];}else{throw "Could not find a match";}}}}};var nullenv=({"resolve":function(x){return undefined;}});var stdenv=Env(nullenv);stdenv.register("+","___plus");stdenv.register("-","___minus");stdenv.register("*","___times");stdenv.register("/","___div");stdenv.register("%","___mod");stdenv.register("^","___binxor");stdenv.register("&","___binand");stdenv.register("|","___binor");stdenv.register("~","___binnot");stdenv.register("&&","___and");stdenv.register("||","___or");stdenv.register("!","___not");stdenv.register("===","___is");stdenv.register("!==","___isnt");stdenv.register("!=","___neq");stdenv.register("<","___lt");stdenv.register(">","___gt");stdenv.register("<=","___lte");stdenv.register(">=","___gte");stdenv.register("in","___in");stdenv.register("instanceof","___instanceof");stdenv.register("++","___plusplus");stdenv.register("--","___minusminus");var make_checker=function(value){return function(env,context,expr){return ["send","___eq",["data",expr[1],value]];};};var make_exact_checker=function(value){return function(env,context,expr){return ["send","___is",["data",expr[1],value]];};};stdenv.register_macro("#",function(env,context,expr){var tag=["value",expr[2]];var f=function(env,context,expr){if((context=="pattern")){var f=function(env,context,expr){return ["send","___eq",["data",["send",expr[1],["value","#"]],tag]];};return ["check",["macro",f],expr];}else{if(true){var d=["data",tag].concat(expr.slice(1));return ["send",["send","___lib",["value","Struct"]],d];}else{return false;}}};return ["macro",f];});stdenv.register_macro("&&",function(env,context,expr){var other=undefined;var _tmp141=undefined;var _tmp142=undefined;var _=undefined;var _tmp143=undefined;var _tmp144=undefined;var _tmp145=undefined;var _tmp146=undefined;var _tmp147=undefined;var _tmp148=undefined;var _tmp149=undefined;var a=undefined;var b=undefined;if((((_tmp144=[context,expr]),(_tmp144 instanceof Array))&&(((_tmp145=_tmp144.length),(_tmp145==2))&&(((_tmp146=_tmp144[0]),(_tmp146=="pattern"))&&(((_tmp147=_tmp144[1]),(_tmp147 instanceof Array))&&(((_tmp148=_tmp147.length),(_tmp148==3))&&(((_tmp149=_tmp147[0]),(_tmp149=="data"))&&((a=_tmp147[1]),true,(b=_tmp147[2]),true)))))))){return ["all",a,b];}else{if((((_tmp141=[context,expr]),(_tmp141 instanceof Array))&&(((_tmp142=_tmp141.length),(_tmp142==2))&&((_=_tmp141[0]),true,(_tmp143=_tmp141[1]),(_tmp143===null))))){return "___and";}else{if(((other=[context,expr]),true)){return ["send","___and",expr];}else{throw "Could not find a match";}}}});stdenv.register_macro("||",function(env,context,expr){var other=undefined;var _tmp150=undefined;var _tmp151=undefined;var _=undefined;var _tmp152=undefined;var _tmp153=undefined;var _tmp154=undefined;var _tmp155=undefined;var _tmp156=undefined;var _tmp157=undefined;var _tmp158=undefined;var a=undefined;var b=undefined;if((((_tmp153=[context,expr]),(_tmp153 instanceof Array))&&(((_tmp154=_tmp153.length),(_tmp154==2))&&(((_tmp155=_tmp153[0]),(_tmp155=="pattern"))&&(((_tmp156=_tmp153[1]),(_tmp156 instanceof Array))&&(((_tmp157=_tmp156.length),(_tmp157==3))&&(((_tmp158=_tmp156[0]),(_tmp158=="data"))&&((a=_tmp156[1]),true,(b=_tmp156[2]),true)))))))){return ["any",a,b];}else{if((((_tmp150=[context,expr]),(_tmp150 instanceof Array))&&(((_tmp151=_tmp150.length),(_tmp151==2))&&((_=_tmp150[0]),true,(_tmp152=_tmp150[1]),(_tmp152===null))))){return "___or";}else{if(((other=[context,expr]),true)){return ["send","___or",expr];}else{throw "Could not find a match";}}}});stdenv.register_macro("==",function(env,context,expr){var other=undefined;var _tmp159=undefined;var _tmp160=undefined;var _=undefined;var _tmp161=undefined;var _tmp162=undefined;var _tmp163=undefined;var _tmp164=undefined;var _tmp165=undefined;var _tmp166=undefined;var _tmp167=undefined;var _tmp168=undefined;var val=undefined;if((((_tmp162=[context,expr]),(_tmp162 instanceof Array))&&(((_tmp163=_tmp162.length),(_tmp163==2))&&(((_tmp164=_tmp162[0]),(_tmp164=="pattern"))&&(((_tmp165=_tmp162[1]),(_tmp165 instanceof Array))&&(((_tmp166=_tmp165.length),(_tmp166==3))&&(((_tmp167=_tmp165[0]),(_tmp167=="data"))&&(((_tmp168=_tmp165[1]),(_tmp168===null))&&((val=_tmp165[2]),true))))))))){return ["check",["macro",make_checker(val)],null];}else{if((((_tmp159=[context,expr]),(_tmp159 instanceof Array))&&(((_tmp160=_tmp159.length),(_tmp160==2))&&((_=_tmp159[0]),true,(_tmp161=_tmp159[1]),(_tmp161===null))))){return "___eq";}else{if(((other=[context,expr]),true)){return ["send","___eq",expr];}else{throw "Could not find a match";}}}});stdenv.register_macro("*",function(env,context,expr){var other=undefined;var _tmp169=undefined;var _tmp170=undefined;var _=undefined;var _tmp171=undefined;var _tmp172=undefined;var _tmp173=undefined;var _tmp174=undefined;var _tmp175=undefined;var _tmp176=undefined;var _tmp177=undefined;var val=undefined;var _tmp178=undefined;if((((_tmp172=[context,expr]),(_tmp172 instanceof Array))&&(((_tmp173=_tmp172.length),(_tmp173==2))&&(((_tmp174=_tmp172[0]),(_tmp174=="pattern"))&&(((_tmp175=_tmp172[1]),(_tmp175 instanceof Array))&&(((_tmp176=_tmp175.length),(_tmp176==3))&&(((_tmp177=_tmp175[0]),(_tmp177=="data"))&&((val=_tmp175[1]),true,(_tmp178=_tmp175[2]),(_tmp178===null))))))))){return ["dynsplice",val];}else{if((((_tmp169=[context,expr]),(_tmp169 instanceof Array))&&(((_tmp170=_tmp169.length),(_tmp170==2))&&((_=_tmp169[0]),true,(_tmp171=_tmp169[1]),(_tmp171===null))))){return "___times";}else{if(((other=[context,expr]),true)){return ["send","___times",expr];}else{throw "Could not find a match";}}}});stdenv.register_macro(".",function(env,context,expr){var other=undefined;var _tmp179=undefined;var _tmp180=undefined;var _tmp181=undefined;var _tmp182=undefined;var _tmp183=undefined;var s=undefined;if((((_tmp179=expr),(_tmp179 instanceof Array))&&(((_tmp180=_tmp179.length),(_tmp180==3))&&(((_tmp181=_tmp179[0]),(_tmp181=="data"))&&(((_tmp182=_tmp179[1]),(_tmp182===null))&&(((_tmp183=_tmp179[2]),(typeof(_tmp183)=="string"))&&((s=_tmp183),true))))))){return ["value",s];}else{if(((other=expr),true)){throw ["invalid",expr];}else{throw "Could not find a match";}}});stdenv.register_macro("where",function(env,context,_tmp184){var _tmp185=undefined;var _tmp186=undefined;var _tmp187=undefined;var a=undefined;var b=undefined;if((((_tmp185=_tmp184),(_tmp185 instanceof Array))&&(((_tmp186=_tmp185.length),(_tmp186==3))&&(((_tmp187=_tmp185[0]),(_tmp187=="data"))&&((a=_tmp185[1]),true,(b=_tmp185[2]),true))))){false;}else{throw "a condition failed";}return ["send","let",["data",["code",b],["code",a]]];});stdenv.register_macro("let",function(env,context,_tmp188){var _tmp189=undefined;var _tmp190=undefined;var _tmp191=undefined;var _tmp192=undefined;var _tmp193=undefined;var _tmp194=undefined;var a=undefined;var _tmp195=undefined;var _tmp196=undefined;var _tmp197=undefined;var b=undefined;if((((_tmp189=_tmp188),(_tmp189 instanceof Array))&&(((_tmp190=_tmp189.length),(_tmp190==3))&&(((_tmp191=_tmp189[0]),(_tmp191=="data"))&&(((_tmp192=_tmp189[1]),(_tmp192 instanceof Array))&&(((_tmp193=_tmp192.length),(_tmp193==2))&&(((_tmp194=_tmp192[0]),(_tmp194=="code"))&&(((a=_tmp192[1]),true,(_tmp195=_tmp189[2]),(_tmp195 instanceof Array))&&(((_tmp196=_tmp195.length),(_tmp196==2))&&(((_tmp197=_tmp195[0]),(_tmp197=="code"))&&((b=_tmp195[1]),true))))))))))){false;}else{throw "a condition failed";}var bindings=aslist(a);var body=aslist(b);return ["multi"].concat(bindings).concat(body);});stdenv.register_macro("->",function(env,context,_tmp198){var _tmp199=undefined;var _tmp200=undefined;var _tmp201=undefined;var args=undefined;var stmts=undefined;if((((_tmp199=_tmp198),(_tmp199 instanceof Array))&&(((_tmp200=_tmp199.length),(_tmp200==3))&&(((_tmp201=_tmp199[0]),(_tmp201=="data"))&&((args=_tmp199[1]),true,(stmts=_tmp199[2]),true))))){false;}else{throw "a condition failed";}var body=["multi"];(args=args.slice(1).map(function(x){var other=undefined;var _tmp202=undefined;if(((_tmp202=x),(typeof(_tmp202)=="string"))){return x;}else{if(((other=x),true)){var t=gensym();body.push(["send","=",["data",x,t]]);return t;}else{throw "Could not find a match";}}}));body.push(stmts);return ["lambda",args,body];});stdenv.register_macro("=>",function(env,context,_tmp203){var _tmp204=undefined;var _tmp205=undefined;var _tmp206=undefined;var binding=undefined;var value=undefined;if((((_tmp204=_tmp203),(_tmp204 instanceof Array))&&(((_tmp205=_tmp204.length),(_tmp205==3))&&(((_tmp206=_tmp204[0]),(_tmp206=="data"))&&((binding=_tmp204[1]),true,(value=_tmp204[2]),true))))){false;}else{throw "a condition failed";}if((context=="data")){return ["assoc",binding,value];}else{if(true){throw (("Illegal context for '=>' ("+context)+")");}else{return false;}}});stdenv.register_macro("=",function(env,context,expr){var other=undefined;var _tmp207=undefined;var _tmp208=undefined;var _tmp209=undefined;var _tmp210=undefined;var _tmp211=undefined;var _tmp212=undefined;var binding=undefined;var value=undefined;var _tmp213=undefined;var _tmp214=undefined;var _tmp215=undefined;var _tmp216=undefined;var _tmp217=undefined;var _tmp218=undefined;var _tmp219=undefined;var _tmp220=undefined;var _tmp221=undefined;var f=undefined;var _tmp222=undefined;var _tmp223=undefined;var _tmp224=undefined;var args=undefined;var value=undefined;var _tmp225=undefined;var _tmp226=undefined;var _tmp227=undefined;var _tmp228=undefined;var _tmp229=undefined;var _tmp230=undefined;var _tmp231=undefined;var _tmp232=undefined;var _tmp233=undefined;var _tmp234=undefined;var lhs=undefined;var rhs=undefined;if((((_tmp229=[context,expr]),(_tmp229 instanceof Array))&&(((_tmp230=_tmp229.length),(_tmp230==2))&&(((_tmp231=_tmp229[0]),(_tmp231=="multi"))&&(((_tmp232=_tmp229[1]),(_tmp232 instanceof Array))&&(((_tmp233=_tmp232.length),(_tmp233==3))&&(((_tmp234=_tmp232[0]),(_tmp234=="data"))&&((lhs=_tmp232[1]),true,(rhs=_tmp232[2]),true)))))))){var p=parse_lhs(env,lhs,rhs);var vars=make_declarations(p[0]);var r=["splice"].concat(vars);var clauses=p[1];var mkif=function(x){return ["if",x,["value",false],["js_throw",["value","a condition failed"]]];};if((clauses.length==1)){var clause=clauses[0];var last=clause[(clause.length-1)];if((((last instanceof Array)&&(last[0]=="value"))&&(last[1]===true))){if(((vars.length==1)&&(clause.length==3))){(r=["declare"].concat(clause[1].slice(1)));}else{if(true){(r=r.concat(clause.slice(1,(-1))));}else{false;}}}else{if(true){r.push(mkif(clause));}else{false;}}}else{if(true){var ands=make_pattern_test(clauses);r.push(mkif(ands));}else{false;}}return r;}else{if((((_tmp225=[context,expr]),(_tmp225 instanceof Array))&&(((_tmp226=_tmp225.length),(_tmp226==2))&&(((_tmp227=_tmp225[0]),(_tmp227=="data"))&&((_tmp228=_tmp225[1]),(_tmp228===null)))))){return ["assoc"];}else{if((((_tmp213=[context,expr]),(_tmp213 instanceof Array))&&(((_tmp214=_tmp213.length),(_tmp214==2))&&(((_tmp215=_tmp213[0]),(_tmp215=="data"))&&(((_tmp216=_tmp213[1]),(_tmp216 instanceof Array))&&(((_tmp217=_tmp216.length),(_tmp217==3))&&(((_tmp218=_tmp216[0]),(_tmp218=="data"))&&(((_tmp219=_tmp216[1]),(_tmp219 instanceof Array))&&(((_tmp220=_tmp219.length),(_tmp220==3))&&(((_tmp221=_tmp219[0]),(_tmp221=="send"))&&(((f=_tmp219[1]),true,(_tmp222=_tmp219[2]),(_tmp222 instanceof Array))&&(((_tmp223=_tmp222.length),(_tmp223>=1))&&(((_tmp224=_tmp222[0]),(_tmp224=="data"))&&((args=_tmp222.slice(1)),true,(value=_tmp216[2]),true)))))))))))))){return ["assoc",["value",f],["lambda",args,value]];}else{if((((_tmp207=[context,expr]),(_tmp207 instanceof Array))&&(((_tmp208=_tmp207.length),(_tmp208==2))&&(((_tmp209=_tmp207[0]),(_tmp209=="data"))&&(((_tmp210=_tmp207[1]),(_tmp210 instanceof Array))&&(((_tmp211=_tmp210.length),(_tmp211==3))&&(((_tmp212=_tmp210[0]),(_tmp212=="data"))&&((binding=_tmp210[1]),true,(value=_tmp210[2]),true)))))))){return ["assoc",["value",binding],value];}else{if(((other=[context,expr]),true)){throw (("Illegal context for '=' ("+context)+")");}else{throw "Could not find a match";}}}}}});stdenv.register_macro(":=",function(env,context,_tmp235){var _tmp236=undefined;var _tmp237=undefined;var _tmp238=undefined;var a=undefined;var b=undefined;if((((_tmp236=_tmp235),(_tmp236 instanceof Array))&&(((_tmp237=_tmp236.length),(_tmp237==3))&&(((_tmp238=_tmp236[0]),(_tmp238=="data"))&&((a=_tmp236[1]),true,(b=_tmp236[2]),true))))){false;}else{throw "a condition failed";}return ["assign",a,b];});stdenv.register_macro("if",function(env,context,_tmp239){var _tmp240=undefined;var _tmp241=undefined;var _tmp242=undefined;var test=undefined;var a=undefined;var b=undefined;if((((_tmp240=_tmp239),(_tmp240 instanceof Array))&&(((_tmp241=_tmp240.length),(_tmp241==4))&&(((_tmp242=_tmp240[0]),(_tmp242=="data"))&&((test=_tmp240[1]),true,(a=_tmp240[2]),true,(b=_tmp240[3]),true))))){false;}else{throw "a condition failed";}return ["if",test,a,b];});stdenv.register_macro("cond",function(env,context,_tmp243){var _tmp244=undefined;var _tmp245=undefined;var _tmp246=undefined;var _tmp247=undefined;var _tmp248=undefined;var _tmp249=undefined;var clauses=undefined;if((((_tmp244=_tmp243),(_tmp244 instanceof Array))&&(((_tmp245=_tmp244.length),(_tmp245==2))&&(((_tmp246=_tmp244[0]),(_tmp246=="data"))&&(((_tmp247=_tmp244[1]),(_tmp247 instanceof Array))&&(((_tmp248=_tmp247.length),(_tmp248==2))&&(((_tmp249=_tmp247[0]),(_tmp249=="code"))&&((clauses=_tmp247[1]),true)))))))){false;}else{throw "a condition failed";}var handle=function(xs){if((xs.length==0)){return ["value",false];}else{if(true){var first=xs[0][2];var rest=xs.slice(1);return ["if",first[1],first[2],handle(rest)];}else{return false;}}};return handle(aslist(clauses));});stdenv.register_macro("while",function(env,context,_tmp250){var _tmp251=undefined;var _tmp252=undefined;var _tmp253=undefined;var _tmp254=undefined;var _tmp255=undefined;var _tmp256=undefined;var test=undefined;var _tmp257=undefined;var _tmp258=undefined;var _tmp259=undefined;var body=undefined;if((((_tmp251=_tmp250),(_tmp251 instanceof Array))&&(((_tmp252=_tmp251.length),(_tmp252==3))&&(((_tmp253=_tmp251[0]),(_tmp253=="data"))&&(((_tmp254=_tmp251[1]),(_tmp254 instanceof Array))&&(((_tmp255=_tmp254.length),(_tmp255==2))&&(((_tmp256=_tmp254[0]),(_tmp256=="code"))&&(((test=_tmp254[1]),true,(_tmp257=_tmp251[2]),(_tmp257 instanceof Array))&&(((_tmp258=_tmp257.length),(_tmp258==2))&&(((_tmp259=_tmp257[0]),(_tmp259=="code"))&&((body=_tmp257[1]),true))))))))))){false;}else{throw "a condition failed";}return ["js_while",test,body];});stdenv.register_macro("for",function(env,context,_tmp260){var _tmp261=undefined;var _tmp262=undefined;var _tmp263=undefined;var _tmp264=undefined;var _tmp265=undefined;var _tmp266=undefined;var _tmp267=undefined;var _tmp268=undefined;var _tmp269=undefined;var a=undefined;var b=undefined;var c=undefined;var _tmp270=undefined;var _tmp271=undefined;var _tmp272=undefined;var body=undefined;if((((_tmp261=_tmp260),(_tmp261 instanceof Array))&&(((_tmp262=_tmp261.length),(_tmp262==3))&&(((_tmp263=_tmp261[0]),(_tmp263=="data"))&&(((_tmp264=_tmp261[1]),(_tmp264 instanceof Array))&&(((_tmp265=_tmp264.length),(_tmp265==2))&&(((_tmp266=_tmp264[0]),(_tmp266=="code"))&&(((_tmp267=_tmp264[1]),(_tmp267 instanceof Array))&&(((_tmp268=_tmp267.length),(_tmp268==4))&&(((_tmp269=_tmp267[0]),(_tmp269=="multi"))&&(((a=_tmp267[1]),true,(b=_tmp267[2]),true,(c=_tmp267[3]),true,(_tmp270=_tmp261[2]),(_tmp270 instanceof Array))&&(((_tmp271=_tmp270.length),(_tmp271==2))&&(((_tmp272=_tmp270[0]),(_tmp272=="code"))&&((body=_tmp270[1]),true)))))))))))))){false;}else{throw "a condition failed";}return ["js_for",a,b,c,body];});stdenv.register_macro("return",function(env,context,expr){return ["js_return",expr];});stdenv.register_macro("throw",function(env,context,expr){return ["js_throw",expr];});stdenv.register_macro("break",function(env,context,expr){return ["js_break"];});stdenv.register_macro("continue",function(env,context,expr){return ["js_continue"];});var rx_wrap=function(x){return (("(?:"+x)+")");};var rx_quote=function(x){return x.replace(RegExp("([.?*+\\^$\\[\\]\\(\\)\\{\\}|\\\\])","g"),"\\$1");};var rx_quote2=function(x){return x.replace(RegExp("([\\[\\]\\(\\)\\{\\}\\^])","g"),"\\$1");};var rx_build=function(expr){var _tmp273=undefined;var _tmp274=undefined;var _tmp275=undefined;var args=undefined;var _tmp276=undefined;var _tmp277=undefined;var _tmp278=undefined;var args=undefined;var _tmp279=undefined;var _tmp280=undefined;var _tmp281=undefined;var _tmp282=undefined;var _tmp283=undefined;var _tmp284=undefined;var _tmp285=undefined;var _tmp286=undefined;var b=undefined;var _tmp287=undefined;var _tmp288=undefined;var _tmp289=undefined;var _tmp290=undefined;var _tmp291=undefined;var _tmp292=undefined;var _tmp293=undefined;var _tmp294=undefined;var b=undefined;var _tmp295=undefined;var _tmp296=undefined;var _tmp297=undefined;var _tmp298=undefined;var _tmp299=undefined;var _tmp300=undefined;var _tmp301=undefined;var a=undefined;var _tmp302=undefined;var _tmp303=undefined;var _tmp304=undefined;var _tmp305=undefined;var _tmp306=undefined;var _tmp307=undefined;var _tmp308=undefined;var _tmp309=undefined;var a=undefined;var _tmp310=undefined;var _tmp311=undefined;var _tmp312=undefined;var _tmp313=undefined;var _tmp314=undefined;var _tmp315=undefined;var _tmp316=undefined;var _tmp317=undefined;var a=undefined;var _tmp318=undefined;var _tmp319=undefined;var _tmp320=undefined;var _tmp321=undefined;var _tmp322=undefined;var _tmp323=undefined;var _tmp324=undefined;var _tmp325=undefined;var a=undefined;var b=undefined;var _tmp326=undefined;var _tmp327=undefined;var _tmp328=undefined;var x=undefined;var _tmp329=undefined;var _tmp330=undefined;var _tmp331=undefined;var _tmp332=undefined;var _tmp333=undefined;var _tmp334=undefined;var _tmp335=undefined;var _tmp336=undefined;var _tmp337=undefined;var _tmp338=undefined;var _tmp339=undefined;var _tmp340=undefined;var _tmp341=undefined;if(((_tmp341=expr),(_tmp341=="any"))){return ".";}else{if(((_tmp340=expr),(_tmp340=="start"))){return "^";}else{if(((_tmp339=expr),(_tmp339=="end"))){return "$";}else{if(((_tmp338=expr),(_tmp338=="alpha"))){return "\\a";}else{if(((_tmp337=expr),(_tmp337=="digit"))){return "\\d";}else{if(((_tmp336=expr),(_tmp336=="word"))){return "\\w";}else{if(((_tmp335=expr),(_tmp335=="space"))){return "\\s";}else{if(((_tmp334=expr),(_tmp334=="boundary"))){return "\\b";}else{if(((_tmp333=expr),(_tmp333=="a"))){return "\\a";}else{if(((_tmp332=expr),(_tmp332=="d"))){return "\\d";}else{if(((_tmp331=expr),(_tmp331=="w"))){return "\\w";}else{if(((_tmp330=expr),(_tmp330=="s"))){return "\\s";}else{if(((_tmp329=expr),(_tmp329=="b"))){return "\\b";}else{if((((_tmp326=expr),(_tmp326 instanceof Array))&&(((_tmp327=_tmp326.length),(_tmp327==2))&&(((_tmp328=_tmp326[0]),(_tmp328=="value"))&&((x=_tmp326[1]),true))))){return rx_quote(x);}else{if((((_tmp319=expr),(_tmp319 instanceof Array))&&(((_tmp320=_tmp319.length),(_tmp320==3))&&(((_tmp321=_tmp319[0]),(_tmp321=="send"))&&(((_tmp322=_tmp319[1]),(_tmp322=="||"))&&(((_tmp323=_tmp319[2]),(_tmp323 instanceof Array))&&(((_tmp324=_tmp323.length),(_tmp324==3))&&(((_tmp325=_tmp323[0]),(_tmp325=="data"))&&((a=_tmp323[1]),true,(b=_tmp323[2]),true))))))))){return rx_wrap(((rx_build(a)+"|")+rx_build(b)));}else{if((((_tmp311=expr),(_tmp311 instanceof Array))&&(((_tmp312=_tmp311.length),(_tmp312==3))&&(((_tmp313=_tmp311[0]),(_tmp313=="send"))&&(((_tmp314=_tmp311[1]),(_tmp314=="*"))&&(((_tmp315=_tmp311[2]),(_tmp315 instanceof Array))&&(((_tmp316=_tmp315.length),(_tmp316==3))&&(((_tmp317=_tmp315[0]),(_tmp317=="data"))&&((a=_tmp315[1]),true,(_tmp318=_tmp315[2]),(_tmp318===null)))))))))){return rx_wrap((rx_build(a)+"*"));}else{if((((_tmp303=expr),(_tmp303 instanceof Array))&&(((_tmp304=_tmp303.length),(_tmp304==3))&&(((_tmp305=_tmp303[0]),(_tmp305=="send"))&&(((_tmp306=_tmp303[1]),(_tmp306=="+"))&&(((_tmp307=_tmp303[2]),(_tmp307 instanceof Array))&&(((_tmp308=_tmp307.length),(_tmp308==3))&&(((_tmp309=_tmp307[0]),(_tmp309=="data"))&&((a=_tmp307[1]),true,(_tmp310=_tmp307[2]),(_tmp310===null)))))))))){return rx_wrap((rx_build(a)+"+"));}else{if((((_tmp295=expr),(_tmp295 instanceof Array))&&(((_tmp296=_tmp295.length),(_tmp296==3))&&(((_tmp297=_tmp295[0]),(_tmp297=="send"))&&(((_tmp298=_tmp295[1]),(_tmp298=="?"))&&(((_tmp299=_tmp295[2]),(_tmp299 instanceof Array))&&(((_tmp300=_tmp299.length),(_tmp300==3))&&(((_tmp301=_tmp299[0]),(_tmp301=="data"))&&((a=_tmp299[1]),true,(_tmp302=_tmp299[2]),(_tmp302===null)))))))))){return rx_wrap((rx_build(a)+"?"));}else{if((((_tmp287=expr),(_tmp287 instanceof Array))&&(((_tmp288=_tmp287.length),(_tmp288==3))&&(((_tmp289=_tmp287[0]),(_tmp289=="send"))&&(((_tmp290=_tmp287[1]),(_tmp290==">>"))&&(((_tmp291=_tmp287[2]),(_tmp291 instanceof Array))&&(((_tmp292=_tmp291.length),(_tmp292==3))&&(((_tmp293=_tmp291[0]),(_tmp293=="data"))&&(((_tmp294=_tmp291[1]),(_tmp294===null))&&((b=_tmp291[2]),true)))))))))){var x=rx_quote2(b[1]);return (("["+x)+"]");}else{if((((_tmp279=expr),(_tmp279 instanceof Array))&&(((_tmp280=_tmp279.length),(_tmp280==3))&&(((_tmp281=_tmp279[0]),(_tmp281=="send"))&&(((_tmp282=_tmp279[1]),(_tmp282==">>!"))&&(((_tmp283=_tmp279[2]),(_tmp283 instanceof Array))&&(((_tmp284=_tmp283.length),(_tmp284==3))&&(((_tmp285=_tmp283[0]),(_tmp285=="data"))&&(((_tmp286=_tmp283[1]),(_tmp286===null))&&((b=_tmp283[2]),true)))))))))){var x=rx_quote2(b[1]);return (("[^"+x)+"]");}else{if((((_tmp276=expr),(_tmp276 instanceof Array))&&(((_tmp277=_tmp276.length),(_tmp277>=1))&&(((_tmp278=_tmp276[0]),(_tmp278=="data"))&&((args=_tmp276.slice(1)),true))))){return (("("+args.map(rx_build).join(""))+")");}else{if((((_tmp273=expr),(_tmp273 instanceof Array))&&(((_tmp274=_tmp273.length),(_tmp274>=1))&&(((_tmp275=_tmp273[0]),(_tmp275=="multi"))&&((args=_tmp273.slice(1)),true))))){return (("(?:"+args.map(rx_build).join(""))+")");}else{throw "Could not find a match";}}}}}}}}}}}}}}}}}}}}}}};stdenv.register_macro("Rx",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)]]];});stdenv.register_macro("Rxg",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)],["value","g"]]];});stdenv.register_macro("?",function(env,context,_tmp342){var _tmp343=undefined;var _tmp344=undefined;var _tmp345=undefined;var expr=undefined;var _tmp346=undefined;if((((_tmp343=_tmp342),(_tmp343 instanceof Array))&&(((_tmp344=_tmp343.length),(_tmp344==3))&&(((_tmp345=_tmp343[0]),(_tmp345=="data"))&&((expr=_tmp343[1]),true,(_tmp346=_tmp343[2]),(_tmp346===null)))))){false;}else{throw "a condition failed";}var checker=function(){var other=undefined;var _tmp347=undefined;var _tmp348=undefined;var _tmp349=undefined;var _tmp350=undefined;var _tmp351=undefined;var _tmp352=undefined;var _tmp353=undefined;if(((_tmp353=expr),(_tmp353===null))){return ["send",expr,["value","__check__"]];}else{if(((_tmp352=expr),(_tmp352=="String"))){var f=function(env,context,_tmp354){var _tmp355=undefined;var _tmp356=undefined;var _tmp357=undefined;var expr=undefined;if((((_tmp355=_tmp354),(_tmp355 instanceof Array))&&(((_tmp356=_tmp355.length),(_tmp356==2))&&(((_tmp357=_tmp355[0]),(_tmp357=="data"))&&((expr=_tmp355[1]),true))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","string"]]];};return ["macro",f];}else{if(((_tmp351=expr),(_tmp351=="Number"))){var f=function(env,context,_tmp358){var _tmp359=undefined;var _tmp360=undefined;var _tmp361=undefined;var expr=undefined;if((((_tmp359=_tmp358),(_tmp359 instanceof Array))&&(((_tmp360=_tmp359.length),(_tmp360==2))&&(((_tmp361=_tmp359[0]),(_tmp361=="data"))&&((expr=_tmp359[1]),true))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","number"]]];};return ["macro",f];}else{if(((_tmp350=expr),(_tmp350=="true"))){return ["macro",make_exact_checker(["value",true])];}else{if(((_tmp349=expr),(_tmp349=="false"))){return ["macro",make_exact_checker(["value",false])];}else{if(((_tmp348=expr),(_tmp348=="null"))){return ["macro",make_exact_checker(["value",null])];}else{if(((_tmp347=expr),(_tmp347=="undefined"))){return ["macro",make_exact_checker(["value",undefined])];}else{if(((other=expr),true)){return ["send",expr,["value","__check__"]];}else{throw "Could not find a match";}}}}}}}}}();var mac=function(env,context,expr){var other=undefined;var _tmp362=undefined;if(((_tmp362=context),(_tmp362=="pattern"))){return ["check",checker,expr];}else{if(((other=context),true)){return ["send",checker,["data",expr]];}else{throw "Could not find a match";}}};return ["macro",mac];});var tempnum=0;var gensym=function(){var name=("_tmp"+tempnum);(tempnum=(tempnum+1));return name;};var parse_lhs=function(env,lhs,rhs){var vars=[];var clauses=[];var current=["multi"];var mktemp=function(){var t=gensym();vars.push(t);return t;};var newclause=function(){if((current.length>1)){clauses.push(current);}else{false;}return (current=["multi"]);};var helper=function(lhs,curr){return helper_noexpand(expand.step(env,"pattern",lhs),curr);};var helper_noexpand=function(lhs,curr){if((lhs===null)){return false;}else{if((typeof(lhs)=="string")){vars.push(lhs);current.push(["assign",lhs,curr]);return current.push(["value",true]);}else{if(((lhs instanceof Array)&&(lhs[0]=="value"))){var x=["check",["macro",make_checker(lhs)],null];return helper_noexpand(x,curr);}else{if(((lhs instanceof Array)&&(lhs[0]=="all"))){var temp=mktemp();(current=current.concat([["assign",temp,curr]]));return lhs.slice(1).forEach(function(x){return helper(x,temp);});}else{if(((lhs instanceof Array)&&(lhs[0]=="any"))){var normalize=function(vars){return vars.filter(function(x){return (x.slice(0,4)!=="_tmp");}).sort().join(",");};var temp=mktemp();(current=current.concat([["assign",temp,curr]]));var myvars=undefined;var clauses=[];lhs.slice(1).forEach(function(x){var p=parse_lhs(env,x,temp);if((myvars===undefined)){(myvars=p[0]);}else{if((normalize(p[0])!==normalize(myvars))){throw [["Must have the same set of variables in both branches!",myvars]];}else{if(true){(vars=vars.concat(p[0]));}else{false;}}}return clauses.push(make_pattern_test(p[1]));});current.push(make_or_pattern(clauses));(vars=vars.concat(myvars));return newclause();}else{if(((lhs instanceof Array)&&(lhs[0]=="check"))){var checker=lhs[1];var expr=lhs[2];var temp=mktemp();(current=current.concat([["assign",temp,curr],["send",checker,["data",temp]]]));newclause();return helper(expr,temp);}else{if(((lhs instanceof Array)&&(lhs[0]=="send"))){var fname=lhs[1];var spec=lhs[2];return helper(fname,["send","->",["data",spec,curr]]);}else{if(((lhs instanceof Array)&&(lhs[0]=="data"))){var fw=0;var bw=0;var rest=undefined;var members=lhs.slice(1).map(function(x){var v=expand.step(env,"pattern",x);if(((v instanceof Array)&&(v[0]=="dynsplice"))){(rest=v[1]);}else{if((rest===undefined)){(fw=(fw+1));}else{if(true){(bw=(bw+1));}else{false;}}}return v;});var cmp=function(){if((rest===undefined)){return "___eq";}else{if(true){return "___gte";}else{return false;}}}();var temp=mktemp();var len=mktemp();(current=current.concat([["assign",temp,curr],["send","___instanceof",["data",temp,"Array"]]]));newclause();(current=current.concat([["assign",len,["send",temp,["value","length"]]],["send",cmp,["data",len,["value",(fw+bw)]]]]));newclause();for(var j=0;(j<fw);(++j)){helper_noexpand(members[j],["send",temp,["value",j]]);}if((rest!==undefined)){var slice=function(){if((bw>0)){return ["data",["value",fw],["value",(-bw)]];}else{if(true){return ["data",["value",fw]];}else{return false;}}}();helper_noexpand(members[fw][1],["send",["send",temp,["value","slice"]],slice]);}else{false;}for(var j=0;(j<bw);(++j)){helper_noexpand(members[((fw+j)+1)],["send",temp,["send","___minus",["data",len,["value",(bw-j)]]]]);}}else{if(true){return console.log(["oops_lhs",lhs,curr]);}else{return false;}}}}}}}}}};helper(lhs,rhs);if((current.length>1)){clauses.push(current);}else{false;}return [vars,clauses];};var make_declarations=function(vars){return vars.map(function(name){return ["declare",name,["value",undefined]];});};var make_pattern_test=function(clauses){var ands=clauses.pop();while((clauses.length>0)){(ands=["send","___and",["data",clauses.pop(),ands]]);}return ands;};var make_or_pattern=function(clauses){var ors=clauses.pop();while((clauses.length>0)){(ors=["send","___or",["data",clauses.pop(),ors]]);}return ors;};stdenv.register_macro("|>",function(env,context,expr){var to_match=expr[1];var clauses=function(){if((expr[2][0]=="multi")){return expr[2].slice(1);}else{if(true){return [expr[2]];}else{return false;}}}();var decls=["multi"];var r=["js_throw",["value","Could not find a match"]];while((clauses.length>0)){var clause=clauses.pop();var lhs=clause[2][1];var body=clause[2][2];var p=parse_lhs(env,lhs,to_match);var test=make_pattern_test(p[1]);(r=["if",test,body,r]);(decls=decls.concat(make_declarations(p[0])));}decls.push(r);return decls;});var js_op_table=({"___plus":"+","___minus":"-","___times":"*","___div":"/","___mod":"%","___binxor":"^","___binand":"&","___binor":"|","___binnot":"~","___and":"&&","___or":"||","___not":"!","___is":"===","___isnt":"!==","___eq":"==","___neq":"!=","___lt":"<","___gt":">","___lte":"<=","___gte":">=","___in":" in ","___instanceof":" instanceof ","___plusplus":"++","___minusminus":"--"});var translate=function(expr,mode){if((typeof(expr)=="string")){return translate.expr(translate.mangle(expr),mode);}else{if((expr===null)){return translate.expr("null",mode);}else{if((expr instanceof Array)){var type=expr[0];var args=expr.slice(1);if((type=="value")){var v=args[0];var r=function(){if((typeof(v)=="string")){var repl=({"\"":"\\\"","\n":"\\n","\\":"\\\\"});(v=v.replace(RegExp("((?:(?:\"|\\\\)|\n))","g"),function(m){return repl[m];}));return (("\""+v)+"\"");}else{if((typeof(v)=="number")){return String(v);}else{if(((((v===true)||(v===false))||(v===null))||(v===undefined))){return String(v);}else{if(true){console.log(expr);return (("?!?["+v)+"]?!?");}else{return false;}}}}}();return translate.expr(r,mode);}else{if((type=="lambda")){var bindings=args[0];var body=args[1];var a=bindings.join(",");var b=translate.body(body,"return");return translate.expr((((("function("+a)+"){")+b)+"}"),mode);}else{if((type=="if")){if((mode=="expr")){return translate.body(expr,"expr");}else{if(true){var a=translate(args[0],"expr");var b=translate(args[1],mode);var c=translate(args[2],mode);return (((((("if("+a)+"){")+b)+"}else{")+c)+"}");}else{return false;}}}else{if((type=="js_while")){if((mode=="expr")){return translate.body(expr,"expr");}else{if(true){var a=translate(args[0],"expr");var b=translate(args[1],"stmt");return (((("while("+a)+"){")+b)+"}");}else{return false;}}}else{if((type=="js_for")){if((mode=="expr")){return translate.body(expr,"expr");}else{if(true){var a=translate(args[0],"stmt");var b=translate(args[1],"stmt");var c=translate(args[2],"expr");var d=translate(args[3],"stmt");return (((((("for("+a)+b)+c)+"){")+d)+"}");}else{return false;}}}else{if((type=="declare")){if(((mode=="expr")||(mode=="return"))){throw "Invalid in expr ctx";}else{if(true){var a=translate(args[0],"expr");var b=translate(args[1],"expr");return (((("var "+a)+"=")+b)+";");}else{return false;}}}else{if((type=="assign")){var a=translate(args[0],"expr");var b=translate(args[1],"expr");return translate.expr((((("("+a)+"=")+b)+")"),mode);}else{if((type=="multi")){var isdecl=function(x){return ((x instanceof Array)&&(x[0]=="declare"));};if((args.length==1)){return translate(args[0],mode);}else{if(((mode=="expr")&&(args.filter(isdecl).length==0))){var xs=args.map(function(x){return translate(x,"expr");});return (("("+xs.join(","))+")");}else{if(true){return translate.body(expr,mode);}else{return false;}}}}else{if((type=="splice")){return translate(["multi"].concat(args),mode);}else{if((type=="js_break")){if((mode=="expr")){throw "Invalid break in ctx";}else{if(true){return "break;";}else{return false;}}}else{if((type=="js_continue")){if((mode=="expr")){throw "Invalid continue in ctx";}else{if(true){return "continue;";}else{return false;}}}else{if((type=="js_return")){if((mode=="expr")){throw "Invalid return in ctx";}else{if(true){return (("return "+translate(args[0],"expr"))+";");}else{return false;}}}else{if((type=="js_throw")){if(true){return (("throw "+translate(args[0],"expr"))+";");}else{return false;}}else{if((type=="array")){var r=function(){var f=function(x){return translate(x,"expr");};return (("["+args.map(f).join(","))+"]");}();return translate.expr(r,mode);}else{if((type=="object")){var r=function(){var f=function(x){var a=translate(x[1],"expr");var b=translate(x[2],"expr");return ((a+":")+b);};return (("({"+args.map(f).join(","))+"})");}();return translate.expr(r,mode);}else{if((type=="send")){var f=args[0];var msg=args[1];if(((msg instanceof Array)&&(msg[0]=="value"))){var s=msg[1];if(((typeof(s)=="string")&&s.match(RegExp("(?:^(?:[a-zA-Z_$]+)$)")))){var trf=translate(f,"expr");var trmsg=translate(msg[1],"expr");return translate.expr(((trf+".")+trmsg),mode);}else{if(true){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{return false;}}}else{if(((msg instanceof Array)&&(msg[0]=="array"))){var op=((typeof(f)=="string")&&js_op_table[f]);if(op){return translate.expr(translate.op(op,msg[1],msg[2]),mode);}else{if(true){var trf=translate(f,"expr");var trargs=msg.slice(1).map(function(x){return translate(x,"expr");});return translate.expr((((trf+"(")+trargs.join(","))+")"),mode);}else{return false;}}}else{if(true){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{return false;}}}}else{return false;}}}}}}}}}}}}}}}}}else{return false;}}}};(translate.mangle=function(name){var tr=({"+":"__plus__","-":"__minus__","*":"__asterisk__","/":"__slash__","%":"__percent__","^":"__caret__","#":"__hash__","&":"__amp__","|":"__pipe__","@":"__at__","!":"__bang__","?":"__qmark__","=":"__equal__","<":"__lt__",">":"__gt__","~":"__tilde__"});var r=[];for(var i=0;(i<name.length);(++i)){var c=name[i];r.push((tr[c]||c));}return r.join("");});(translate.body=function(b,mode){(orig=b);(b=aslist(b));var trst=function(stmt){return translate(stmt,"stmt");};if((mode=="expr")){var x=["send",["lambda",[],orig],["array"]];return translate(x,mode);}else{if((mode=="return")){var stmts=b.slice(0,(-1));var ret=b[(b.length-1)];return (stmts.map(trst).join("")+translate(ret,"return"));}else{if((mode=="stmt")){return b.map(trst).join("");}else{return false;}}}});(translate.expr=function(x,mode){if((mode=="expr")){return x;}else{if((mode=="stmt")){return (x+";");}else{if((mode=="return")){return (("return "+x)+";");}else{return false;}}}});(translate.op=function(op,a,b){(e=function(){if((a===null)){return (op+translate(b,"expr"));}else{if((b===null)){return (translate(a,"expr")+op);}else{if(true){return ((translate(a,"expr")+op)+translate(b,"expr"));}else{return false;}}}}());return (("("+e)+")");});var fs=require("fs");var file=process.argv[2];var f=function(err,data){var p=parse(data);var ex=expand(stdenv,"top",["multi",p]);var prelude="var ___lib=require(\"./lib\");";return console.log((prelude+translate(ex,"stmt")));};fs.readFile(file,"utf8",f);
