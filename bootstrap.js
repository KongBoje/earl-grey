var ___lib=require("./lib");var special_ops=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",":":"IFX",".":"PFX"});var regexps=function(){var id=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))");var id_f=function(m,wsb,wsa,last_op){return ["ID","ID",m[0]];};var numr=RegExp("(?:^((?:\\d+))[rR]((?:[A-Za-z0-9_]+))(?:(?:\\.((?:[A-Za-z0-9_]+)))?))");var numr_f=function(m,wsb,wsa,last_op){var _tmp0;var _tmp1;var radix;var int;var frac;if((((_tmp0=m),(_tmp0 instanceof Array))&&(((_tmp1=_tmp0.length),(_tmp1==4))&&((radix=_tmp0[1]),true,(int=_tmp0[2]),true,(frac=_tmp0[3]),true)))){false;}else{throw "a condition failed";}(value=parseInt(int.replace(RegExp("_","g"),""),radix));if(frac){(frac=frac.replace(RegExp("_","g"),""));(value=(value+(parseInt(frac,radix)/Math.pow(radix,frac.length))));}else{false;}return ["ID","NUM",value];};var num=RegExp("(?:^((?:[0-9_]+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:[0-9_]+)))?))");var num_f=function(m,wsb,wsa,last_op){return ["ID","NUM",parseFloat(m[0].replace(RegExp("_","g"),""))];};var str=RegExp("(?:^\"((?:(?:(?:\\\\\\\\|\\\\\")|[^\"])*))\")");var str_f=function(m,wsb,wsa,last_op){var repl=({"\\\"":"\"","\\\\":"\\","\\n":"\n"});var r=m[1].replace(RegExp("((?:(?:\\\\\"|\\\\\\\\)|\\\\n))","g"),function(m){return repl[m];});return ["ID","STR",r];};var op=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!#.:]+))");var op2=RegExp("(?:^[\\(\\[\\{\\}\\]\\),])");var op3=RegExp("(?:^(?:(?:(?:(?:(?:with|where)|and)|or)|in)|instanceof)\\b)");var op_f=function(m,wsb,wsa,last_op){var op=m[0];if((op in special_ops)){var fixity=special_ops[op];var width=function(){var other;var _tmp2;var _tmp3;var _tmp4;if(((_tmp4=fixity),(_tmp4=="IFX"))){if((wsb||wsa)){return "wide";}else{return "short";}}else{if(((_tmp3=fixity),(_tmp3=="SFX"))){if(wsb){return "wide";}else{return "short";}}else{if(((_tmp2=fixity),(_tmp2=="PFX"))){if(wsa){return "wide";}else{return "short";}}else{if(((other=fixity),true)){throw "OopsA";}else{throw "Could not find a match";}}}}}();return ["OP",fixity,width,op];}else{if((wsa&&wsb)){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "IFX";}else{return false;}}}(),"wide",op];}else{if(((!wsa)&&(!wsb))){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "IFX";}else{return false;}}}(),"short",op];}else{if(wsa){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "SFX";}else{return false;}}}(),"short",op];}else{if(wsb){return ["OP","PFX","short",op];}else{if(true){return ["OP","PFX","short",op];}else{return false;}}}}}}};var indent=RegExp("(?:^(?:(?:\n((?: *)))+))");var indent_f=function(m,wsb,wsa,last_op){var ilen=m[1].length;return ["INDENT",ilen];};var cmnt=RegExp("(?:^;(?:[^\n]*))");var cmnt_f=function(m,wsb,wsa,last_op){return ["IGNORE"];};var unkn=RegExp("(?:^.)");var unkn_f=function(m,wsb,wsa,last_op){throw ("unknown character: "+m[0]);};return [[op3,op_f],[id,id_f],[numr,numr_f],[num,num_f],[str,str_f],[op,op_f],[op2,op_f],[indent,indent_f],[cmnt,cmnt_f],[unkn,unkn_f]];}();var ws_re=RegExp("(?:^(?: *)(?:(?:\n(?: *)\\\\(?: *))*))");var eol_re=RegExp("(?:^(?: *)(?:\n|$))");var indent_tracker=function(){var curr=false;var stack=[];var stacks=[stack];return function(token){var other;var _tmp5;var _tmp6;var _tmp7;var fixity;var width;var _tmp8;var _tmp10;var _tmp9;var _tmp11;var _tmp12;var _tmp13;var fixity;var width;var _tmp14;var _tmp16;var _tmp15;var _tmp17;var _tmp18;var _tmp19;var stuff;var _tmp20;var _tmp21;var _tmp22;var new_indent;if((((_tmp20=token),(_tmp20 instanceof Array))&&(((_tmp21=_tmp20.length),(_tmp21==2))&&(((_tmp22=_tmp20[0]),(_tmp22=="INDENT"))&&((new_indent=_tmp20[1]),true))))){if((curr===false)){(curr=new_indent);return [["OP","IFX","wide",","]];}else{if((new_indent>curr)){stack.push(curr);(curr=new_indent);return [["OP","PFX","wide","["]];}else{if((new_indent==curr)){return [["OP","IFX","wide",","]];}else{if((new_indent<curr)){var rval=[];while(((stack.length>0)&&(new_indent<curr))){(curr=stack.pop());rval.push(["OP","SFX","wide","]"]);}rval.push(["OP","IFX","wide",","]);return rval;}else{if(true){throw [curr,new_indent];}else{return false;}}}}}}else{if((((_tmp17=token),(_tmp17 instanceof Array))&&(((_tmp18=_tmp17.length),(_tmp18>=1))&&(((_tmp19=_tmp17[0]),(_tmp19=="ID"))&&((stuff=_tmp17.slice(1)),true))))){return [token];}else{if((((_tmp11=token),(_tmp11 instanceof Array))&&(((_tmp12=_tmp11.length),(_tmp12==4))&&(((_tmp13=_tmp11[0]),(_tmp13=="OP"))&&((fixity=_tmp11[1]),true,(width=_tmp11[2]),true,(_tmp14=_tmp11[3]),(((_tmp15=_tmp14),(_tmp15=="["))||((_tmp16=_tmp14),(_tmp16=="{")))))))){stack.push(curr);stacks.push(stack);(stack=[]);(curr=false);return [token];}else{if((((_tmp5=token),(_tmp5 instanceof Array))&&(((_tmp6=_tmp5.length),(_tmp6==4))&&(((_tmp7=_tmp5[0]),(_tmp7=="OP"))&&((fixity=_tmp5[1]),true,(width=_tmp5[2]),true,(_tmp8=_tmp5[3]),(((_tmp9=_tmp8),(_tmp9=="]"))||((_tmp10=_tmp8),(_tmp10=="}")))))))){var rval=stack.map(function(x){return ["OP","SFX","short","]"];});(stack=stacks.pop());(curr=stack.pop());rval.push(token);return rval;}else{if(((other=token),true)){return [token];}else{throw "Could not find a match";}}}}}};};var process_token=function(token,last_op,wsa,wsb,pos,endpos,accum){var _tmp23;var _tmp24;var type;var result;if((((_tmp23=token),(_tmp23 instanceof Array))&&(((_tmp24=_tmp23.length),(_tmp24>=1))&&((type=_tmp23[0]),true,(result=_tmp23.slice(1)),true)))){false;}else{throw "a condition failed";}var other;var _tmp25;var _tmp26;var _tmp27;if(((_tmp27=type),(_tmp27=="IGNORE"))){return last_op;}else{if(((_tmp26=type),(_tmp26=="ID"))){if((!last_op)){var w=["IFX",function(){if(wsb){return "wide";}else{return "short";}}(),"WHITE"];(w.location=[pos,pos]);accum.push(w);}else{false;}accum.push(result);return false;}else{if(((_tmp25=type),(_tmp25=="OP"))){if(last_op){var v=["VOID"];(v.location=[pos,pos]);accum.push(v);}else{false;}var _tmp28;var _tmp29;var _tmp30;if(((_tmp30=result[0]),(_tmp30=="IFX"))){accum.push(result);return true;}else{if(((_tmp29=result[0]),(_tmp29=="PFX"))){if((!last_op)){var w=["IFX",function(){if(wsb){return "wide";}else{return "short";}}(),"WHITE"];(w.location=[pos,pos]);var v=["VOID"];(v.location=[pos,pos]);accum.push(w);accum.push(v);}else{false;}accum.push(result);return true;}else{if(((_tmp28=result[0]),(_tmp28=="SFX"))){accum.push(result);var v=["VOID"];(v.location=[endpos,endpos]);accum.push(v);return false;}else{throw "Could not find a match";}}}}else{if(((other=type),true)){throw "OopsB";}else{throw "Could not find a match";}}}}};var tokenize=function(text){var last_op=true;var results=[];var wsb=text.match(ws_re)[0].length;(text=text.slice(wsb));(pos=wsb);var indent=indent_tracker();while(text){for(var i=0;(i<regexps.length);(++i)){var _tmp31;var _tmp32;var re;var fn;if((((_tmp31=regexps[i]),(_tmp31 instanceof Array))&&(((_tmp32=_tmp31.length),(_tmp32==2))&&((re=_tmp31[0]),true,(fn=_tmp31[1]),true)))){false;}else{throw "a condition failed";}var m=text.match(re);if(m){var skip=m[0].length;var endpos=(pos+skip);(text=text.slice(skip));var wsa=text.match(ws_re)[0].length;var eol=(text.match(eol_re)&&true);var bwsb=(wsb>0);var bwsa=function(){if(eol){return bwsb;}else{return (wsa>0);}}();var token=fn(m,bwsb,bwsa,last_op);var tokens=indent(token);tokens.forEach(function(x){return (last_op=process_token(x,last_op,bwsa,bwsb,pos,endpos,results));});(text=text.slice(wsa));(wsb=wsa);(pos=(endpos+wsa));break;}else{false;}}}if(last_op){var v=["VOID"];(v.location=[pos,pos]);results.push(v);}else{false;}return results;};var MAX=(1/0);var order_map=({"IFX":({"wide":({"default":[900,901],"WHITE":[1000,1001],",":[5,5],"with":[999,10],"where":[11,10],"|>":[11,10],"->":[11,10],"=>":[11,10],"=":[11,10],":=":[11,10],"+":[300,301],"*":[400,401],"**":[501,500],":":[1001,6]}),"short":({"default":[1900,1901],"WHITE":[2000,2001],",":[5,5],":":[1001,6]})}),"PFX":({"wide":({"default":[MAX,900],".":[MAX,3000],"#":[MAX,3000],"(":[MAX,5],"[":[MAX,5],"{":[MAX,5]}),"short":({"default":[MAX,1900],".":[MAX,3000],"#":[MAX,3000],"(":[MAX,5],"[":[MAX,5],"{":[MAX,5]})}),"SFX":({"wide":({"default":[901,MAX],")":[5,MAX],"]":[5,MAX],"}":[5,MAX]}),"short":({"default":[1901,MAX],")":[5,MAX],"]":[5,MAX],"}":[5,MAX]})})});var DONE=(-1);var NONE=0;var LEFT=1;var RIGHT=2;var BOTH=3;var oparse=function(next,order,finalize){var between=finalize(next());var right_op=next();var stack=[];var left_op=null;var current=null;while(true){var o=function(){if(((!left_op)&&(!right_op))){return DONE;}else{if(true){return ((((!left_op)&&RIGHT)||((!right_op)&&LEFT))||order(left_op,right_op));}else{return false;}}}();var other;var _tmp33;var _tmp34;var _tmp35;var _tmp36;var _tmp37;if(((_tmp37=o),(_tmp37==DONE))){return between;}else{if(((_tmp36=o),(_tmp36==LEFT))){current.push(between);(between=finalize(current));var v=stack.pop();(left_op=v[0]);(current=v[1]);}else{if(((_tmp35=o),(_tmp35==RIGHT))){stack.push([left_op,current]);(left_op=right_op);(current=[[right_op],between]);(between=finalize(next()));(right_op=next());}else{if(((_tmp34=o),(_tmp34==BOTH))){current[0].push(right_op);current.push(between);(left_op=right_op);(between=finalize(next()));(right_op=next());}else{if(((_tmp33=o),(_tmp33==NONE))){throw ((("Undefined priority between "+left_op)+" and ")+right_op);}else{if(((other=o),true)){throw "OopsC";}else{throw "Could not find a match";}}}}}}}};var consult=function(o){var other;var _tmp38;var _tmp39;var fixity;var width;var op;var _tmp40;var _tmp41;var fixity;var width;var _tmp42;var n;if((((_tmp40=o),(_tmp40 instanceof Array))&&(((_tmp41=_tmp40.length),(_tmp41==3))&&(((fixity=_tmp40[0]),true,(width=_tmp40[1]),true,(_tmp42=_tmp40[2]),(typeof(_tmp42)=="number"))&&((n=_tmp42),true))))){var p=(5-(1/(n+1)));return [p,p];}else{if((((_tmp38=o),(_tmp38 instanceof Array))&&(((_tmp39=_tmp38.length),(_tmp39==3))&&((fixity=_tmp38[0]),true,(width=_tmp38[1]),true,(op=_tmp38[2]),true)))){var map=order_map[fixity][width];return (map[op]||map.default);}else{if(((other=o),true)){throw "OopsD";}else{throw "Could not find a match";}}}};var order=function(o1,o2){var ord1=consult(o1)[1];var ord2=consult(o2)[0];if((ord1>ord2)){return LEFT;}else{if((ord1<ord2)){return RIGHT;}else{if((ord1==ord2)){return BOTH;}else{return false;}}}};var finalize=function(x){var other;var _tmp43;var _tmp44;var ops;var args;var _tmp45;var _tmp46;var _tmp47;var _tmp48;var _tmp49;var _tmp50;var value;var _tmp51;var _tmp52;var _tmp53;var value;var _tmp54;var _tmp55;var _tmp56;var value;if((((_tmp54=x),(_tmp54 instanceof Array))&&(((_tmp55=_tmp54.length),(_tmp55==2))&&(((_tmp56=_tmp54[0]),(_tmp56=="ID"))&&((value=_tmp54[1]),true))))){return value;}else{if((((_tmp51=x),(_tmp51 instanceof Array))&&(((_tmp52=_tmp51.length),(_tmp52==2))&&(((_tmp53=_tmp51[0]),(_tmp53=="NUM"))&&((value=_tmp51[1]),true))))){return ["value",value];}else{if((((_tmp48=x),(_tmp48 instanceof Array))&&(((_tmp49=_tmp48.length),(_tmp49==2))&&(((_tmp50=_tmp48[0]),(_tmp50=="STR"))&&((value=_tmp48[1]),true))))){return ["value",value];}else{if((((_tmp45=x),(_tmp45 instanceof Array))&&(((_tmp46=_tmp45.length),(_tmp46==1))&&((_tmp47=_tmp45[0]),(_tmp47=="VOID"))))){return null;}else{if((((_tmp43=x),(_tmp43 instanceof Array))&&(((_tmp44=_tmp43.length),(_tmp44>=1))&&((ops=_tmp43[0]),true,(args=_tmp43.slice(1)),true)))){(ops=ops.map(function(o){return o[2];}));var op=ops[0];var other;var _tmp57;var _tmp58;var _tmp59;var _tmp60;var _tmp61;var _tmp62;var a;var b;var _tmp63;var _tmp64;var _tmp65;var _tmp66;var _tmp67;var _tmp68;var _tmp69;var _tmp70;var _tmp71;var _tmp72;var _tmp73;var _tmp74;var _tmp75;var _tmp76;var _tmp77;var _tmp78;var _tmp79;var _tmp80;var _tmp81;var _tmp82;var _tmp83;var _tmp84;var _tmp85;var _tmp87;var _tmp86;var _tmp88;var _tmp89;var _tmp90;var _tmp91;var _tmp92;var _tmp93;var _tmp94;var target;var body;var _tmp95;var _tmp96;var _tmp97;var _tmp98;var _tmp99;var _tmp100;var _tmp101;var f;var body;var _tmp102;var _tmp103;var _tmp104;var _tmp105;var _tmp106;var _tmp107;var _tmp108;var _tmp109;var f;var arg;var body;if((((_tmp102=[ops,args]),(_tmp102 instanceof Array))&&(((_tmp103=_tmp102.length),(_tmp103==2))&&(((_tmp104=_tmp102[0]),(_tmp104 instanceof Array))&&(((_tmp105=_tmp104.length),(_tmp105==2))&&(((_tmp106=_tmp104[0]),(_tmp106=="WHITE"))&&(((_tmp107=_tmp104[1]),(_tmp107==":"))&&(((_tmp108=_tmp102[1]),(_tmp108 instanceof Array))&&(((_tmp109=_tmp108.length),(_tmp109==3))&&((f=_tmp108[0]),true,(arg=_tmp108[1]),true,(body=_tmp108[2]),true)))))))))){return ["send",f,["data",["code",arg],["code",body]]];}else{if((((_tmp95=[ops,args]),(_tmp95 instanceof Array))&&(((_tmp96=_tmp95.length),(_tmp96==2))&&(((_tmp97=_tmp95[0]),(_tmp97 instanceof Array))&&(((_tmp98=_tmp97.length),(_tmp98==1))&&(((_tmp99=_tmp97[0]),(_tmp99==":"))&&(((_tmp100=_tmp95[1]),(_tmp100 instanceof Array))&&(((_tmp101=_tmp100.length),(_tmp101==2))&&((f=_tmp100[0]),true,(body=_tmp100[1]),true))))))))){return ["send",f,["data",["code",body]]];}else{if((((_tmp88=[ops,args]),(_tmp88 instanceof Array))&&(((_tmp89=_tmp88.length),(_tmp89==2))&&(((_tmp90=_tmp88[0]),(_tmp90 instanceof Array))&&(((_tmp91=_tmp90.length),(_tmp91==1))&&(((_tmp92=_tmp90[0]),(_tmp92=="with"))&&(((_tmp93=_tmp88[1]),(_tmp93 instanceof Array))&&(((_tmp94=_tmp93.length),(_tmp94==2))&&((target=_tmp93[0]),true,(body=_tmp93[1]),true))))))))){(body=function(){var other;var _tmp120;var _tmp121;var _tmp122;var rest;if((((_tmp120=body),(_tmp120 instanceof Array))&&(((_tmp121=_tmp120.length),(_tmp121>=1))&&(((_tmp122=_tmp120[0]),(_tmp122=="multi"))&&((rest=_tmp120.slice(1)),true))))){return rest;}else{if(((other=body),true)){return [body];}else{throw "Could not find a match";}}}());var other;var _tmp110;var _tmp111;var _tmp112;var args;var _tmp113;var _tmp114;var _tmp115;var f;var _tmp116;var _tmp117;var _tmp118;var args;var _tmp119;if(((_tmp119=target),(_tmp119===null))){return ["data"].concat(body);}else{if((((_tmp113=target),(_tmp113 instanceof Array))&&(((_tmp114=_tmp113.length),(_tmp114==3))&&(((_tmp115=_tmp113[0]),(_tmp115=="send"))&&(((f=_tmp113[1]),true,(_tmp116=_tmp113[2]),(_tmp116 instanceof Array))&&(((_tmp117=_tmp116.length),(_tmp117>=1))&&(((_tmp118=_tmp116[0]),(_tmp118=="data"))&&((args=_tmp116.slice(1)),true)))))))){return ["send",f,["data"].concat(args).concat(body)];}else{if((((_tmp110=target),(_tmp110 instanceof Array))&&(((_tmp111=_tmp110.length),(_tmp111>=1))&&(((_tmp112=_tmp110[0]),(_tmp112=="data"))&&((args=_tmp110.slice(1)),true))))){return target.concat(body);}else{if(((other=target),true)){return ["send",target,["data"].concat(body)];}else{throw "Could not find a match";}}}}}else{if((((_tmp81=[ops,args]),(_tmp81 instanceof Array))&&(((_tmp82=_tmp81.length),(_tmp82==2))&&(((_tmp83=_tmp81[0]),(_tmp83 instanceof Array))&&(((_tmp84=_tmp83.length),(_tmp84>=1))&&((_tmp85=_tmp83[0]),(((_tmp86=_tmp85),(_tmp86=="["))||((_tmp87=_tmp85),(_tmp87==","))))))))){if((op=="[")){(args=args.slice(1,(-1)));}else{false;}(args=function(){var f=function(x){return (x!==null);};return args.filter(f);}());var result=function(){var other;var _tmp123;var _tmp124;var x;var _tmp125;var _tmp126;if((((_tmp125=args),(_tmp125 instanceof Array))&&((_tmp126=_tmp125.length),(_tmp126==0)))){throw "At least one expression must be enclosed in []";}else{if((((_tmp123=args),(_tmp123 instanceof Array))&&(((_tmp124=_tmp123.length),(_tmp124==1))&&((x=_tmp123[0]),true)))){return x;}else{if(((other=args),true)){return ["multi"].concat(args);}else{throw "Could not find a match";}}}}();return result;}else{if((((_tmp76=[ops,args]),(_tmp76 instanceof Array))&&(((_tmp77=_tmp76.length),(_tmp77==2))&&(((_tmp78=_tmp76[0]),(_tmp78 instanceof Array))&&(((_tmp79=_tmp78.length),(_tmp79>=1))&&((_tmp80=_tmp78[0]),(_tmp80=="{"))))))){var f=function(x){return (x!==null);};return ["data"].concat(args.slice(1,(-1)).filter(f));}else{if((((_tmp71=[ops,args]),(_tmp71 instanceof Array))&&(((_tmp72=_tmp71.length),(_tmp72==2))&&(((_tmp73=_tmp71[0]),(_tmp73 instanceof Array))&&(((_tmp74=_tmp73.length),(_tmp74==1))&&((_tmp75=_tmp73[0]),(_tmp75=="WHITE"))))))){return ["send"].concat(args);}else{if((((_tmp63=[ops,args]),(_tmp63 instanceof Array))&&(((_tmp64=_tmp63.length),(_tmp64==2))&&(((_tmp65=_tmp63[0]),(_tmp65 instanceof Array))&&(((_tmp66=_tmp65.length),(_tmp66==1))&&(((_tmp67=_tmp63[1]),(_tmp67 instanceof Array))&&(((_tmp68=_tmp67.length),(_tmp68==2))&&(((_tmp69=_tmp67[0]),(_tmp69===null))&&((_tmp70=_tmp67[1]),(_tmp70===null)))))))))){return op;}else{if((((_tmp57=[ops,args]),(_tmp57 instanceof Array))&&(((_tmp58=_tmp57.length),(_tmp58==2))&&(((_tmp59=_tmp57[0]),(_tmp59 instanceof Array))&&(((_tmp60=_tmp59.length),(_tmp60==1))&&(((_tmp61=_tmp57[1]),(_tmp61 instanceof Array))&&(((_tmp62=_tmp61.length),(_tmp62==2))&&((a=_tmp61[0]),true,(b=_tmp61[1]),true)))))))){return ["send",op,["data",a,b]];}else{if(((other=[ops,args]),true)){throw ["Unknown node",ops,args];}else{throw "Could not find a match";}}}}}}}}}}else{if(((other=x),true)){throw "OopsE";}else{throw "Could not find a match";}}}}}}};var parse=function(text){var results=tokenize(text);var next=function(){return results.shift();};return oparse(next,order,finalize);};var Env=function(parent){var store=Object();var self=function(expr){return ["bind_env",self,expr];};(self.resolve=function(name){var attempt=store[name];if(attempt){return attempt;}else{if(true){return self.parent.resolve(name);}else{return false;}}});(self.register=function(name,value){return (store[name]=value);});(self.register_macro=function(name,m){return (store[name]=["macro",m]);});(self.fork=function(){return Env(self);});(self.parent=parent);(self.store=store);return self;};var js_contexts=({"js_for":["multi","multi","multi","multi"]});var expand=function(env,context,expr){(expr=expand.step(env,context,expr));var other;var _tmp127;var _tmp128;var _tmp129;var _tmp141;var _tmp130;var _tmp140;var _tmp131;var _tmp139;var _tmp132;var _tmp138;var _tmp133;var _tmp137;var _tmp134;var _tmp136;var _tmp135;var args;var _tmp142;var _tmp143;var _tmp144;var lhs;var rhs;var _tmp145;var _tmp146;var _tmp147;var binding;var value;var _tmp148;var _tmp149;var _tmp150;var bindings;var body;var _tmp151;var _tmp152;var _tmp153;var args;var _tmp154;var _tmp155;var _tmp156;var type;var _tmp157;var _tmp165;var _tmp158;var _tmp164;var _tmp159;var _tmp163;var _tmp160;var _tmp162;var _tmp161;var args;var _tmp166;var _tmp167;var _tmp168;var v;var _tmp169;var _tmp170;var _tmp171;var f;var arg;var _tmp172;var _tmp173;var _tmp174;if(((_tmp174=expr),(typeof(_tmp174)=="string"))){return expr;}else{if(((_tmp173=expr),(_tmp173===null))){return null;}else{if(((_tmp172=expr),(_tmp172===undefined))){throw "undefined? why?";}else{if((((_tmp169=expr),(_tmp169 instanceof Array))&&(((_tmp170=_tmp169.length),(_tmp170==3))&&(((_tmp171=_tmp169[0]),(_tmp171=="send"))&&((f=_tmp169[1]),true,(arg=_tmp169[2]),true))))){(f=expand(env,"head",f));return ["send",f,expand(env,"tail",arg)];}else{if((((_tmp166=expr),(_tmp166 instanceof Array))&&(((_tmp167=_tmp166.length),(_tmp167==2))&&(((_tmp168=_tmp166[0]),(_tmp168=="value"))&&((v=_tmp166[1]),true))))){return expr;}else{if((((_tmp154=expr),(_tmp154 instanceof Array))&&(((_tmp155=_tmp154.length),(_tmp155>=1))&&(((_tmp156=_tmp154[0]),(type=_tmp156),true,(_tmp157=_tmp156),(((_tmp158=_tmp157),(((_tmp159=_tmp158),(((_tmp160=_tmp159),(((_tmp161=_tmp160),(_tmp161=="multi"))||((_tmp162=_tmp160),(_tmp162=="code"))))||((_tmp163=_tmp159),(_tmp163=="array"))))||((_tmp164=_tmp158),(_tmp164=="object"))))||((_tmp165=_tmp157),(_tmp165=="splice"))))&&((args=_tmp154.slice(1)),true))))){var arr=[];while((args.length>0)){var x=expand.step(env,type,args.shift());if(((x instanceof Array)&&(x[0]=="splice"))){(args=x.slice(1).concat(args));}else{if(true){arr.push(x);}else{false;}}}var f=function(x){return expand(env,type,x);};return [type].concat(arr.map(f));}else{if((((_tmp151=expr),(_tmp151 instanceof Array))&&(((_tmp152=_tmp151.length),(_tmp152>=1))&&(((_tmp153=_tmp151[0]),(_tmp153=="data"))&&((args=_tmp151.slice(1)),true))))){var is_obj=false;var obj=["object"];var arr=["array"];while((args.length>0)){var x=expand.step(env,type,args.shift());var other;var _tmp175;var _tmp176;var _tmp177;var exprs;var _tmp178;var _tmp179;var _tmp180;var k;var v;var _tmp181;var _tmp182;var _tmp183;if((((_tmp181=x),(_tmp181 instanceof Array))&&(((_tmp182=_tmp181.length),(_tmp182==1))&&((_tmp183=_tmp181[0]),(_tmp183=="assoc"))))){(is_obj=true);}else{if((((_tmp178=x),(_tmp178 instanceof Array))&&(((_tmp179=_tmp178.length),(_tmp179==3))&&(((_tmp180=_tmp178[0]),(_tmp180=="assoc"))&&((k=_tmp178[1]),true,(v=_tmp178[2]),true))))){(is_obj=true);obj.push(["array",k,v]);}else{if((((_tmp175=x),(_tmp175 instanceof Array))&&(((_tmp176=_tmp175.length),(_tmp176>=1))&&(((_tmp177=_tmp175[0]),(_tmp177=="splice"))&&((exprs=_tmp175.slice(1)),true))))){(args=exprs.concat(args));}else{if(((other=x),true)){arr.push(other);}else{throw "Could not find a match";}}}}}var r=function(){if(((arr.length>1)&&is_obj)){arr.push(obj);return arr;}else{if(is_obj){return obj;}else{if(true){return arr;}else{return false;}}}}();return expand(env,context,r);}else{if((((_tmp148=expr),(_tmp148 instanceof Array))&&(((_tmp149=_tmp148.length),(_tmp149==3))&&(((_tmp150=_tmp148[0]),(_tmp150=="lambda"))&&((bindings=_tmp148[1]),true,(body=_tmp148[2]),true))))){return ["lambda",bindings.map(function(x){return expand(env,"decl",x);}),expand(env,"multi",body)];}else{if((((_tmp145=expr),(_tmp145 instanceof Array))&&(((_tmp146=_tmp145.length),(_tmp146==3))&&(((_tmp147=_tmp145[0]),(_tmp147=="declare"))&&((binding=_tmp145[1]),true,(value=_tmp145[2]),true))))){return ["declare",expand(env,"decl",binding),expand(env,"multi",value)];}else{if((((_tmp142=expr),(_tmp142 instanceof Array))&&(((_tmp143=_tmp142.length),(_tmp143==3))&&(((_tmp144=_tmp142[0]),(_tmp144=="assign"))&&((lhs=_tmp142[1]),true,(rhs=_tmp142[2]),true))))){return ["assign",expand(env,"decl",lhs),expand(env,"multi",rhs)];}else{if((((_tmp127=expr),(_tmp127 instanceof Array))&&(((_tmp128=_tmp127.length),(_tmp128>=1))&&(((_tmp129=_tmp127[0]),(((_tmp130=_tmp129),(((_tmp131=_tmp130),(((_tmp132=_tmp131),(((_tmp133=_tmp132),(((_tmp134=_tmp133),(((_tmp135=_tmp134),(_tmp135=="js_while"))||((_tmp136=_tmp134),(_tmp136=="js_for"))))||((_tmp137=_tmp133),(_tmp137=="js_break"))))||((_tmp138=_tmp132),(_tmp138=="js_continue"))))||((_tmp139=_tmp131),(_tmp139=="js_return"))))||((_tmp140=_tmp130),(_tmp140=="js_throw"))))||((_tmp141=_tmp129),(_tmp141=="if"))))&&((args=_tmp127.slice(1)),true))))){var ctxs=(js_contexts[type]||[]);var f=function(x,i){return expand(env,(ctxs[i]||"expr"),x);};return [type].concat(args.map(f));}else{if(((other=expr),true)){throw ["Oops",type,context];}else{throw "Could not find a match";}}}}}}}}}}}}};(expand.step=function(env,context,expr){var other;var _tmp184;var _tmp185;var type;var args;var _tmp186;var _tmp187;var _tmp188;var f;var arg;var _tmp189;var _tmp190;var _tmp191;var m;var _tmp192;var _tmp193;var _tmp194;if(((_tmp194=expr),(typeof(_tmp194)=="string"))){var v=env.resolve(expr);var other;var _tmp195;var _tmp196;var _tmp197;var _tmp198;var _tmp199;var m;var _tmp200;var _tmp201;var _tmp202;var _tmp203;var _tmp204;var m;var _tmp205;var _tmp206;var _tmp207;var _tmp208;if((((_tmp206=[v,context]),(_tmp206 instanceof Array))&&(((_tmp207=_tmp206.length),(_tmp207==2))&&((_tmp208=_tmp206[0]),(_tmp208===undefined))))){return expr;}else{if((((_tmp200=[v,context]),(_tmp200 instanceof Array))&&(((_tmp201=_tmp200.length),(_tmp201==2))&&(((_tmp202=_tmp200[0]),(_tmp202 instanceof Array))&&(((_tmp203=_tmp202.length),(_tmp203==2))&&(((_tmp204=_tmp202[0]),(_tmp204=="macro"))&&((m=_tmp202[1]),true,(_tmp205=_tmp200[1]),(_tmp205=="head")))))))){return v;}else{if((((_tmp195=[v,context]),(_tmp195 instanceof Array))&&(((_tmp196=_tmp195.length),(_tmp196==2))&&(((_tmp197=_tmp195[0]),(_tmp197 instanceof Array))&&(((_tmp198=_tmp197.length),(_tmp198==2))&&(((_tmp199=_tmp197[0]),(_tmp199=="macro"))&&((m=_tmp197[1]),true))))))){return expand.step(env,context,m(env,context,null));}else{if(((other=[v,context]),true)){return v;}else{throw "Could not find a match";}}}}}else{if(((_tmp193=expr),(_tmp193===null))){return null;}else{if(((_tmp192=expr),(_tmp192===undefined))){throw "undefined? why?";}else{if((((_tmp189=expr),(_tmp189 instanceof Array))&&(((_tmp190=_tmp189.length),(_tmp190==2))&&(((_tmp191=_tmp189[0]),(_tmp191=="macro"))&&((m=_tmp189[1]),true))))){if((context=="head")){return expr;}else{if(true){return expand.step(env,context,m(env,context,null));}else{return false;}}}else{if((((_tmp186=expr),(_tmp186 instanceof Array))&&(((_tmp187=_tmp186.length),(_tmp187==3))&&(((_tmp188=_tmp186[0]),(_tmp188=="send"))&&((f=_tmp186[1]),true,(arg=_tmp186[2]),true))))){(f=expand.step(env,"head",f));var other;var _tmp209;var _tmp210;var _tmp211;var m;if((((_tmp209=f),(_tmp209 instanceof Array))&&(((_tmp210=_tmp209.length),(_tmp210==2))&&(((_tmp211=_tmp209[0]),(_tmp211=="macro"))&&((m=_tmp209[1]),true))))){return expand.step(env,context,m(env,context,arg));}else{if(((other=f),true)){return expr;}else{throw "Could not find a match";}}}else{if((((_tmp184=expr),(_tmp184 instanceof Array))&&(((_tmp185=_tmp184.length),(_tmp185>=1))&&((type=_tmp184[0]),true,(args=_tmp184.slice(1)),true)))){return expr;}else{if(((other=expr),true)){throw ["Oops2",expr];}else{throw "Could not find a match";}}}}}}}});var aslist=function(expr){var other;var _tmp212;var _tmp213;var _tmp214;var args;var _tmp215;var _tmp216;if(((_tmp216=expr),(_tmp216===null))){return [null];}else{if(((_tmp215=expr),(_tmp215===undefined))){return [undefined];}else{if((((_tmp212=expr),(_tmp212 instanceof Array))&&(((_tmp213=_tmp212.length),(_tmp213>=1))&&(((_tmp214=_tmp212[0]),(_tmp214=="multi"))&&((args=_tmp212.slice(1)),true))))){return args;}else{if(((other=expr),true)){return [other];}else{throw "Could not find a match";}}}}};var nullenv=({"resolve":function(x){return undefined;}});var stdenv=Env(nullenv);stdenv.register("+","___plus");stdenv.register("-","___minus");stdenv.register("*","___times");stdenv.register("/","___div");stdenv.register("%","___mod");stdenv.register("^","___binxor");stdenv.register("&","___binand");stdenv.register("|","___binor");stdenv.register("~","___binnot");stdenv.register("&&","___and");stdenv.register("||","___or");stdenv.register("!","___not");stdenv.register("===","___is");stdenv.register("!==","___isnt");stdenv.register("!=","___neq");stdenv.register("<","___lt");stdenv.register(">","___gt");stdenv.register("<=","___lte");stdenv.register(">=","___gte");stdenv.register("in","___in");stdenv.register("instanceof","___instanceof");stdenv.register("++","___plusplus");stdenv.register("--","___minusminus");stdenv.register_macro("<>",function(env,context,_tmp217){var _tmp218;var _tmp219;var _tmp220;var _tmp221;var x;if((((_tmp218=_tmp217),(_tmp218 instanceof Array))&&(((_tmp219=_tmp218.length),(_tmp219==3))&&(((_tmp220=_tmp218[0]),(_tmp220=="data"))&&(((_tmp221=_tmp218[1]),(_tmp221===null))&&((x=_tmp218[2]),true)))))){false;}else{throw "a condition failed";}return ["send",["send","___lib",["value","pr"]],["data",x]];});var make_checker=function(value,op){return function(env,context,expr){return ["send",op,["data",expr[1],value]];};};stdenv.register_macro("#",function(env,context,expr){var tag=["value",expr[2]];var f=function(env,context,expr){if((context=="pattern")){var f=function(env,context,expr){return ["send","___eq",["data",["send",expr[1],["value","#"]],tag]];};return ["check",["macro",f],expr];}else{if(true){var d=["data",tag].concat(expr.slice(1));return ["send",["send","___lib",["value","Struct"]],d];}else{return false;}}};return ["macro",f];});stdenv.register_macro("&&",function(env,context,expr){var other;var _tmp222;var _tmp223;var _tmp224;var _tmp225;var _tmp226;var _tmp227;var _tmp228;var _tmp229;var _tmp230;var a;var b;if((((_tmp225=[context,expr]),(_tmp225 instanceof Array))&&(((_tmp226=_tmp225.length),(_tmp226==2))&&(((_tmp227=_tmp225[0]),(_tmp227=="pattern"))&&(((_tmp228=_tmp225[1]),(_tmp228 instanceof Array))&&(((_tmp229=_tmp228.length),(_tmp229==3))&&(((_tmp230=_tmp228[0]),(_tmp230=="data"))&&((a=_tmp228[1]),true,(b=_tmp228[2]),true)))))))){return ["all",a,b];}else{if((((_tmp222=[context,expr]),(_tmp222 instanceof Array))&&(((_tmp223=_tmp222.length),(_tmp223==2))&&((_tmp224=_tmp222[1]),(_tmp224===null))))){return "___and";}else{if(((other=[context,expr]),true)){return ["send","___and",expr];}else{throw "Could not find a match";}}}});stdenv.register_macro("||",function(env,context,expr){var other;var _tmp231;var _tmp232;var _tmp233;var _tmp234;var _tmp235;var _tmp236;var _tmp237;var _tmp238;var _tmp239;var a;var b;if((((_tmp234=[context,expr]),(_tmp234 instanceof Array))&&(((_tmp235=_tmp234.length),(_tmp235==2))&&(((_tmp236=_tmp234[0]),(_tmp236=="pattern"))&&(((_tmp237=_tmp234[1]),(_tmp237 instanceof Array))&&(((_tmp238=_tmp237.length),(_tmp238==3))&&(((_tmp239=_tmp237[0]),(_tmp239=="data"))&&((a=_tmp237[1]),true,(b=_tmp237[2]),true)))))))){return ["any",a,b];}else{if((((_tmp231=[context,expr]),(_tmp231 instanceof Array))&&(((_tmp232=_tmp231.length),(_tmp232==2))&&((_tmp233=_tmp231[1]),(_tmp233===null))))){return "___or";}else{if(((other=[context,expr]),true)){return ["send","___or",expr];}else{throw "Could not find a match";}}}});var partial_pattern=function(operator){return function(env,context,expr){var other;var _tmp240;var _tmp241;var _tmp242;var _tmp243;var _tmp244;var _tmp245;var _tmp246;var _tmp247;var _tmp248;var _tmp249;var val;if((((_tmp243=[context,expr]),(_tmp243 instanceof Array))&&(((_tmp244=_tmp243.length),(_tmp244==2))&&(((_tmp245=_tmp243[0]),(_tmp245=="pattern"))&&(((_tmp246=_tmp243[1]),(_tmp246 instanceof Array))&&(((_tmp247=_tmp246.length),(_tmp247==3))&&(((_tmp248=_tmp246[0]),(_tmp248=="data"))&&(((_tmp249=_tmp246[1]),(_tmp249===null))&&((val=_tmp246[2]),true))))))))){return ["check",["macro",make_checker(val,operator)],null];}else{if((((_tmp240=[context,expr]),(_tmp240 instanceof Array))&&(((_tmp241=_tmp240.length),(_tmp241==2))&&((_tmp242=_tmp240[1]),(_tmp242===null))))){return operator;}else{if(((other=[context,expr]),true)){return ["send",operator,expr];}else{throw "Could not find a match";}}}};};stdenv.register_macro("==",partial_pattern("___eq"));stdenv.register_macro("!=",partial_pattern("___neq"));stdenv.register_macro("<=",partial_pattern("___leq"));stdenv.register_macro(">=",partial_pattern("___geq"));stdenv.register_macro("<",partial_pattern("___lt"));stdenv.register_macro(">",partial_pattern("___gt"));stdenv.register_macro("*",function(env,context,expr){var other;var _tmp250;var _tmp251;var _tmp252;var _tmp253;var _tmp254;var _tmp255;var _tmp256;var _tmp257;var _tmp258;var val;var _tmp259;if((((_tmp253=[context,expr]),(_tmp253 instanceof Array))&&(((_tmp254=_tmp253.length),(_tmp254==2))&&(((_tmp255=_tmp253[0]),(_tmp255=="pattern"))&&(((_tmp256=_tmp253[1]),(_tmp256 instanceof Array))&&(((_tmp257=_tmp256.length),(_tmp257==3))&&(((_tmp258=_tmp256[0]),(_tmp258=="data"))&&((val=_tmp256[1]),true,(_tmp259=_tmp256[2]),(_tmp259===null))))))))){return ["dynsplice",val];}else{if((((_tmp250=[context,expr]),(_tmp250 instanceof Array))&&(((_tmp251=_tmp250.length),(_tmp251==2))&&((_tmp252=_tmp250[1]),(_tmp252===null))))){return "___times";}else{if(((other=[context,expr]),true)){return ["send","___times",expr];}else{throw "Could not find a match";}}}});stdenv.register_macro(".",function(env,context,expr){var other;var _tmp260;var _tmp261;var _tmp262;var _tmp263;var _tmp264;var s;if((((_tmp260=expr),(_tmp260 instanceof Array))&&(((_tmp261=_tmp260.length),(_tmp261==3))&&(((_tmp262=_tmp260[0]),(_tmp262=="data"))&&(((_tmp263=_tmp260[1]),(_tmp263===null))&&(((_tmp264=_tmp260[2]),(typeof(_tmp264)=="string"))&&((s=_tmp264),true))))))){return ["value",s];}else{if(((other=expr),true)){throw ["invalid",expr];}else{throw "Could not find a match";}}});stdenv.register_macro("where",function(env,context,_tmp265){var _tmp266;var _tmp267;var _tmp268;var a;var b;if((((_tmp266=_tmp265),(_tmp266 instanceof Array))&&(((_tmp267=_tmp266.length),(_tmp267==3))&&(((_tmp268=_tmp266[0]),(_tmp268=="data"))&&((a=_tmp266[1]),true,(b=_tmp266[2]),true))))){false;}else{throw "a condition failed";}return ["send","let",["data",["code",b],["code",a]]];});stdenv.register_macro("let",function(env,context,_tmp269){var _tmp270;var _tmp271;var _tmp272;var _tmp273;var _tmp274;var _tmp275;var a;var _tmp276;var _tmp277;var _tmp278;var b;if((((_tmp270=_tmp269),(_tmp270 instanceof Array))&&(((_tmp271=_tmp270.length),(_tmp271==3))&&(((_tmp272=_tmp270[0]),(_tmp272=="data"))&&(((_tmp273=_tmp270[1]),(_tmp273 instanceof Array))&&(((_tmp274=_tmp273.length),(_tmp274==2))&&(((_tmp275=_tmp273[0]),(_tmp275=="code"))&&(((a=_tmp273[1]),true,(_tmp276=_tmp270[2]),(_tmp276 instanceof Array))&&(((_tmp277=_tmp276.length),(_tmp277==2))&&(((_tmp278=_tmp276[0]),(_tmp278=="code"))&&((b=_tmp276[1]),true))))))))))){false;}else{throw "a condition failed";}var bindings=aslist(a);var body=aslist(b);return ["multi"].concat(bindings).concat(body);});stdenv.register_macro("->",function(env,context,_tmp279){var _tmp280;var _tmp281;var _tmp282;var args;var stmts;if((((_tmp280=_tmp279),(_tmp280 instanceof Array))&&(((_tmp281=_tmp280.length),(_tmp281==3))&&(((_tmp282=_tmp280[0]),(_tmp282=="data"))&&((args=_tmp280[1]),true,(stmts=_tmp280[2]),true))))){false;}else{throw "a condition failed";}var body=["multi"];(args=args.slice(1).map(function(x){var other;var _tmp283;if(((_tmp283=x),(typeof(_tmp283)=="string"))){return x;}else{if(((other=x),true)){var t=gensym();body.push(["send","=",["data",x,t]]);return t;}else{throw "Could not find a match";}}}));body.push(stmts);return ["lambda",args,body];});stdenv.register_macro("=>",function(env,context,_tmp284){var _tmp285;var _tmp286;var _tmp287;var binding;var value;if((((_tmp285=_tmp284),(_tmp285 instanceof Array))&&(((_tmp286=_tmp285.length),(_tmp286==3))&&(((_tmp287=_tmp285[0]),(_tmp287=="data"))&&((binding=_tmp285[1]),true,(value=_tmp285[2]),true))))){false;}else{throw "a condition failed";}if((context=="data")){return ["assoc",binding,value];}else{if(true){throw (("Illegal context for '=>' ("+context)+")");}else{return false;}}});stdenv.register_macro("=",function(env,context,expr){var other;var _tmp288;var _tmp289;var _tmp290;var _tmp291;var _tmp292;var _tmp293;var binding;var value;var _tmp294;var _tmp295;var _tmp296;var _tmp297;var _tmp298;var _tmp299;var _tmp300;var _tmp301;var _tmp302;var f;var _tmp303;var _tmp304;var _tmp305;var args;var value;var _tmp306;var _tmp307;var _tmp308;var _tmp309;var _tmp310;var _tmp311;var _tmp312;var _tmp313;var _tmp314;var _tmp315;var lhs;var rhs;if((((_tmp310=[context,expr]),(_tmp310 instanceof Array))&&(((_tmp311=_tmp310.length),(_tmp311==2))&&(((_tmp312=_tmp310[0]),(_tmp312=="multi"))&&(((_tmp313=_tmp310[1]),(_tmp313 instanceof Array))&&(((_tmp314=_tmp313.length),(_tmp314==3))&&(((_tmp315=_tmp313[0]),(_tmp315=="data"))&&((lhs=_tmp313[1]),true,(rhs=_tmp313[2]),true)))))))){var p=parse_lhs(env,lhs,rhs);var vars=make_declarations(p[0]);var r=["splice"].concat(vars);var clauses=p[1];var mkif=function(x){return ["if",x,["value",false],["js_throw",["value","a condition failed"]]];};if((clauses.length==1)){var clause=clauses[0];var last=clause[(clause.length-1)];if((((last instanceof Array)&&(last[0]=="value"))&&(last[1]===true))){if(((vars.length==1)&&(clause.length==3))){(r=["declare"].concat(clause[1].slice(1)));}else{if(true){(r=r.concat(clause.slice(1,(-1))));}else{false;}}}else{if(true){r.push(mkif(clause));}else{false;}}}else{if(true){var ands=make_pattern_test(clauses);r.push(mkif(ands));}else{false;}}return r;}else{if((((_tmp306=[context,expr]),(_tmp306 instanceof Array))&&(((_tmp307=_tmp306.length),(_tmp307==2))&&(((_tmp308=_tmp306[0]),(_tmp308=="data"))&&((_tmp309=_tmp306[1]),(_tmp309===null)))))){return ["assoc"];}else{if((((_tmp294=[context,expr]),(_tmp294 instanceof Array))&&(((_tmp295=_tmp294.length),(_tmp295==2))&&(((_tmp296=_tmp294[0]),(_tmp296=="data"))&&(((_tmp297=_tmp294[1]),(_tmp297 instanceof Array))&&(((_tmp298=_tmp297.length),(_tmp298==3))&&(((_tmp299=_tmp297[0]),(_tmp299=="data"))&&(((_tmp300=_tmp297[1]),(_tmp300 instanceof Array))&&(((_tmp301=_tmp300.length),(_tmp301==3))&&(((_tmp302=_tmp300[0]),(_tmp302=="send"))&&(((f=_tmp300[1]),true,(_tmp303=_tmp300[2]),(_tmp303 instanceof Array))&&(((_tmp304=_tmp303.length),(_tmp304>=1))&&(((_tmp305=_tmp303[0]),(_tmp305=="data"))&&((args=_tmp303.slice(1)),true,(value=_tmp297[2]),true)))))))))))))){return ["assoc",["value",f],["lambda",args,value]];}else{if((((_tmp288=[context,expr]),(_tmp288 instanceof Array))&&(((_tmp289=_tmp288.length),(_tmp289==2))&&(((_tmp290=_tmp288[0]),(_tmp290=="data"))&&(((_tmp291=_tmp288[1]),(_tmp291 instanceof Array))&&(((_tmp292=_tmp291.length),(_tmp292==3))&&(((_tmp293=_tmp291[0]),(_tmp293=="data"))&&((binding=_tmp291[1]),true,(value=_tmp291[2]),true)))))))){return ["assoc",["value",binding],value];}else{if(((other=[context,expr]),true)){throw (("Illegal context for '=' ("+context)+")");}else{throw "Could not find a match";}}}}}});stdenv.register_macro(":=",function(env,context,_tmp316){var _tmp317;var _tmp318;var _tmp319;var a;var b;if((((_tmp317=_tmp316),(_tmp317 instanceof Array))&&(((_tmp318=_tmp317.length),(_tmp318==3))&&(((_tmp319=_tmp317[0]),(_tmp319=="data"))&&((a=_tmp317[1]),true,(b=_tmp317[2]),true))))){false;}else{throw "a condition failed";}return ["assign",a,b];});stdenv.register_macro("if",function(env,context,_tmp320){var _tmp321;var _tmp322;var _tmp323;var test;var a;var b;if((((_tmp321=_tmp320),(_tmp321 instanceof Array))&&(((_tmp322=_tmp321.length),(_tmp322==4))&&(((_tmp323=_tmp321[0]),(_tmp323=="data"))&&((test=_tmp321[1]),true,(a=_tmp321[2]),true,(b=_tmp321[3]),true))))){false;}else{throw "a condition failed";}return ["if",test,a,b];});stdenv.register_macro("cond",function(env,context,_tmp324){var _tmp325;var _tmp326;var _tmp327;var _tmp328;var _tmp329;var _tmp330;var clauses;if((((_tmp325=_tmp324),(_tmp325 instanceof Array))&&(((_tmp326=_tmp325.length),(_tmp326==2))&&(((_tmp327=_tmp325[0]),(_tmp327=="data"))&&(((_tmp328=_tmp325[1]),(_tmp328 instanceof Array))&&(((_tmp329=_tmp328.length),(_tmp329==2))&&(((_tmp330=_tmp328[0]),(_tmp330=="code"))&&((clauses=_tmp328[1]),true)))))))){false;}else{throw "a condition failed";}var handle=function(xs){if((xs.length==0)){return ["value",false];}else{if(true){var first=xs[0][2];var rest=xs.slice(1);return ["if",first[1],first[2],handle(rest)];}else{return false;}}};return handle(aslist(clauses));});stdenv.register_macro("while",function(env,context,expr){var _tmp331;var _tmp332;var _tmp333;var _tmp334;var _tmp335;var _tmp336;var test;var _tmp337;var _tmp338;var _tmp339;var body;if((((_tmp331=expr),(_tmp331 instanceof Array))&&(((_tmp332=_tmp331.length),(_tmp332==3))&&(((_tmp333=_tmp331[0]),(_tmp333=="data"))&&(((_tmp334=_tmp331[1]),(_tmp334 instanceof Array))&&(((_tmp335=_tmp334.length),(_tmp335==2))&&(((_tmp336=_tmp334[0]),(_tmp336=="code"))&&(((test=_tmp334[1]),true,(_tmp337=_tmp331[2]),(_tmp337 instanceof Array))&&(((_tmp338=_tmp337.length),(_tmp338==2))&&(((_tmp339=_tmp337[0]),(_tmp339=="code"))&&((body=_tmp337[1]),true))))))))))){false;}else{throw "a condition failed";}return ["js_while",test,body];});stdenv.register_macro("for",function(env,context,expr){var _tmp340;var _tmp341;var _tmp342;var _tmp343;var _tmp344;var _tmp345;var _tmp346;var _tmp347;var _tmp348;var a;var b;var c;var _tmp349;var _tmp350;var _tmp351;var body;if((((_tmp340=expr),(_tmp340 instanceof Array))&&(((_tmp341=_tmp340.length),(_tmp341==3))&&(((_tmp342=_tmp340[0]),(_tmp342=="data"))&&(((_tmp343=_tmp340[1]),(_tmp343 instanceof Array))&&(((_tmp344=_tmp343.length),(_tmp344==2))&&(((_tmp345=_tmp343[0]),(_tmp345=="code"))&&(((_tmp346=_tmp343[1]),(_tmp346 instanceof Array))&&(((_tmp347=_tmp346.length),(_tmp347==4))&&(((_tmp348=_tmp346[0]),(_tmp348=="multi"))&&(((a=_tmp346[1]),true,(b=_tmp346[2]),true,(c=_tmp346[3]),true,(_tmp349=_tmp340[2]),(_tmp349 instanceof Array))&&(((_tmp350=_tmp349.length),(_tmp350==2))&&(((_tmp351=_tmp349[0]),(_tmp351=="code"))&&((body=_tmp349[1]),true)))))))))))))){false;}else{throw "a condition failed";}return ["js_for",a,b,c,body];});stdenv.register_macro("return",function(env,context,expr){return ["js_return",expr];});stdenv.register_macro("throw",function(env,context,expr){return ["js_throw",expr];});stdenv.register_macro("break",function(env,context,expr){return ["js_break"];});stdenv.register_macro("continue",function(env,context,expr){return ["js_continue"];});var rx_wrap=function(x){return (("(?:"+x)+")");};var rx_quote=function(x){return x.replace(RegExp("([.?*+\\^$\\[\\]\\(\\)\\{\\}|\\\\])","g"),"\\$1");};var rx_quote2=function(x){return x.replace(RegExp("([\\[\\]\\(\\)\\{\\}\\^])","g"),"\\$1");};var rx_build=function(expr){var otherA;var _tmp352;var _tmp353;var _tmp354;var args;var _tmp355;var _tmp356;var _tmp357;var args;var _tmp358;var _tmp359;var _tmp360;var _tmp361;var _tmp362;var _tmp363;var _tmp364;var _tmp365;var b;var _tmp366;var _tmp367;var _tmp368;var _tmp369;var _tmp370;var _tmp371;var _tmp372;var _tmp373;var b;var _tmp374;var _tmp375;var _tmp376;var _tmp377;var _tmp378;var _tmp379;var _tmp380;var a;var _tmp381;var _tmp382;var _tmp383;var _tmp384;var _tmp385;var _tmp386;var _tmp387;var _tmp388;var a;var _tmp389;var _tmp390;var _tmp391;var _tmp392;var _tmp393;var _tmp394;var _tmp395;var _tmp396;var a;var _tmp397;var _tmp398;var _tmp399;var _tmp400;var _tmp401;var _tmp402;var _tmp403;var _tmp404;var a;var b;var _tmp405;var _tmp406;var _tmp407;var x;var _tmp408;var _tmp409;var _tmp410;var _tmp411;var _tmp412;var _tmp413;var _tmp414;var _tmp415;var _tmp416;var _tmp417;var _tmp418;var _tmp419;var _tmp420;if(((_tmp420=expr),(_tmp420=="any"))){return ".";}else{if(((_tmp419=expr),(_tmp419=="start"))){return "^";}else{if(((_tmp418=expr),(_tmp418=="end"))){return "$";}else{if(((_tmp417=expr),(_tmp417=="alpha"))){return "\\a";}else{if(((_tmp416=expr),(_tmp416=="digit"))){return "\\d";}else{if(((_tmp415=expr),(_tmp415=="word"))){return "\\w";}else{if(((_tmp414=expr),(_tmp414=="space"))){return "\\s";}else{if(((_tmp413=expr),(_tmp413=="boundary"))){return "\\b";}else{if(((_tmp412=expr),(_tmp412=="a"))){return "\\a";}else{if(((_tmp411=expr),(_tmp411=="d"))){return "\\d";}else{if(((_tmp410=expr),(_tmp410=="w"))){return "\\w";}else{if(((_tmp409=expr),(_tmp409=="s"))){return "\\s";}else{if(((_tmp408=expr),(_tmp408=="b"))){return "\\b";}else{if((((_tmp405=expr),(_tmp405 instanceof Array))&&(((_tmp406=_tmp405.length),(_tmp406==2))&&(((_tmp407=_tmp405[0]),(_tmp407=="value"))&&((x=_tmp405[1]),true))))){return rx_quote(x);}else{if((((_tmp398=expr),(_tmp398 instanceof Array))&&(((_tmp399=_tmp398.length),(_tmp399==3))&&(((_tmp400=_tmp398[0]),(_tmp400=="send"))&&(((_tmp401=_tmp398[1]),(_tmp401=="||"))&&(((_tmp402=_tmp398[2]),(_tmp402 instanceof Array))&&(((_tmp403=_tmp402.length),(_tmp403==3))&&(((_tmp404=_tmp402[0]),(_tmp404=="data"))&&((a=_tmp402[1]),true,(b=_tmp402[2]),true))))))))){return rx_wrap(((rx_build(a)+"|")+rx_build(b)));}else{if((((_tmp390=expr),(_tmp390 instanceof Array))&&(((_tmp391=_tmp390.length),(_tmp391==3))&&(((_tmp392=_tmp390[0]),(_tmp392=="send"))&&(((_tmp393=_tmp390[1]),(_tmp393=="*"))&&(((_tmp394=_tmp390[2]),(_tmp394 instanceof Array))&&(((_tmp395=_tmp394.length),(_tmp395==3))&&(((_tmp396=_tmp394[0]),(_tmp396=="data"))&&((a=_tmp394[1]),true,(_tmp397=_tmp394[2]),(_tmp397===null)))))))))){return rx_wrap((rx_build(a)+"*"));}else{if((((_tmp382=expr),(_tmp382 instanceof Array))&&(((_tmp383=_tmp382.length),(_tmp383==3))&&(((_tmp384=_tmp382[0]),(_tmp384=="send"))&&(((_tmp385=_tmp382[1]),(_tmp385=="+"))&&(((_tmp386=_tmp382[2]),(_tmp386 instanceof Array))&&(((_tmp387=_tmp386.length),(_tmp387==3))&&(((_tmp388=_tmp386[0]),(_tmp388=="data"))&&((a=_tmp386[1]),true,(_tmp389=_tmp386[2]),(_tmp389===null)))))))))){return rx_wrap((rx_build(a)+"+"));}else{if((((_tmp374=expr),(_tmp374 instanceof Array))&&(((_tmp375=_tmp374.length),(_tmp375==3))&&(((_tmp376=_tmp374[0]),(_tmp376=="send"))&&(((_tmp377=_tmp374[1]),(_tmp377=="?"))&&(((_tmp378=_tmp374[2]),(_tmp378 instanceof Array))&&(((_tmp379=_tmp378.length),(_tmp379==3))&&(((_tmp380=_tmp378[0]),(_tmp380=="data"))&&((a=_tmp378[1]),true,(_tmp381=_tmp378[2]),(_tmp381===null)))))))))){return rx_wrap((rx_build(a)+"?"));}else{if((((_tmp366=expr),(_tmp366 instanceof Array))&&(((_tmp367=_tmp366.length),(_tmp367==3))&&(((_tmp368=_tmp366[0]),(_tmp368=="send"))&&(((_tmp369=_tmp366[1]),(_tmp369==">>"))&&(((_tmp370=_tmp366[2]),(_tmp370 instanceof Array))&&(((_tmp371=_tmp370.length),(_tmp371==3))&&(((_tmp372=_tmp370[0]),(_tmp372=="data"))&&(((_tmp373=_tmp370[1]),(_tmp373===null))&&((b=_tmp370[2]),true)))))))))){var x=rx_quote2(b[1]);return (("["+x)+"]");}else{if((((_tmp358=expr),(_tmp358 instanceof Array))&&(((_tmp359=_tmp358.length),(_tmp359==3))&&(((_tmp360=_tmp358[0]),(_tmp360=="send"))&&(((_tmp361=_tmp358[1]),(_tmp361==">>!"))&&(((_tmp362=_tmp358[2]),(_tmp362 instanceof Array))&&(((_tmp363=_tmp362.length),(_tmp363==3))&&(((_tmp364=_tmp362[0]),(_tmp364=="data"))&&(((_tmp365=_tmp362[1]),(_tmp365===null))&&((b=_tmp362[2]),true)))))))))){var x=rx_quote2(b[1]);return (("[^"+x)+"]");}else{if((((_tmp355=expr),(_tmp355 instanceof Array))&&(((_tmp356=_tmp355.length),(_tmp356>=1))&&(((_tmp357=_tmp355[0]),(_tmp357=="data"))&&((args=_tmp355.slice(1)),true))))){return (("("+args.map(rx_build).join(""))+")");}else{if((((_tmp352=expr),(_tmp352 instanceof Array))&&(((_tmp353=_tmp352.length),(_tmp353>=1))&&(((_tmp354=_tmp352[0]),(_tmp354=="multi"))&&((args=_tmp352.slice(1)),true))))){return (("(?:"+args.map(rx_build).join(""))+")");}else{if(((otherA=expr),true)){throw "OopsF";}else{throw "Could not find a match";}}}}}}}}}}}}}}}}}}}}}}}};stdenv.register_macro("Rx",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)]]];});stdenv.register_macro("Rxg",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)],["value","g"]]];});stdenv.register_macro("?",function(env,context,_tmp421){var _tmp422;var _tmp423;var _tmp424;var expr;var _tmp425;if((((_tmp422=_tmp421),(_tmp422 instanceof Array))&&(((_tmp423=_tmp422.length),(_tmp423==3))&&(((_tmp424=_tmp422[0]),(_tmp424=="data"))&&((expr=_tmp422[1]),true,(_tmp425=_tmp422[2]),(_tmp425===null)))))){false;}else{throw "a condition failed";}var checker=function(){var other;var _tmp426;var _tmp427;var _tmp428;var _tmp429;var _tmp430;var _tmp431;var _tmp432;if(((_tmp432=expr),(_tmp432===null))){return ["send",expr,["value","__check__"]];}else{if(((_tmp431=expr),(_tmp431=="String"))){var f=function(env,context,_tmp433){var _tmp434;var _tmp435;var _tmp436;var expr;if((((_tmp434=_tmp433),(_tmp434 instanceof Array))&&(((_tmp435=_tmp434.length),(_tmp435==2))&&(((_tmp436=_tmp434[0]),(_tmp436=="data"))&&((expr=_tmp434[1]),true))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","string"]]];};return ["macro",f];}else{if(((_tmp430=expr),(_tmp430=="Number"))){var f=function(env,context,_tmp437){var _tmp438;var _tmp439;var _tmp440;var expr;if((((_tmp438=_tmp437),(_tmp438 instanceof Array))&&(((_tmp439=_tmp438.length),(_tmp439==2))&&(((_tmp440=_tmp438[0]),(_tmp440=="data"))&&((expr=_tmp438[1]),true))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","number"]]];};return ["macro",f];}else{if(((_tmp429=expr),(_tmp429=="true"))){return ["macro",make_checker(["value",true],"___is")];}else{if(((_tmp428=expr),(_tmp428=="false"))){return ["macro",make_checker(["value",false],"___is")];}else{if(((_tmp427=expr),(_tmp427=="null"))){return ["macro",make_checker(["value",null],"___is")];}else{if(((_tmp426=expr),(_tmp426=="undefined"))){return ["macro",make_checker(["value",undefined],"___is")];}else{if(((other=expr),true)){return ["send",expr,["value","__check__"]];}else{throw "Could not find a match";}}}}}}}}}();var mac=function(env,context,expr){var other;var _tmp441;if(((_tmp441=context),(_tmp441=="pattern"))){return ["check",checker,expr];}else{if(((other=context),true)){return ["send",checker,["data",expr]];}else{throw "Could not find a match";}}};return ["macro",mac];});var tempnum=0;var gensym=function(){var name=("_tmp"+tempnum);(tempnum=(tempnum+1));return name;};var parse_lhs=function(env,lhs,rhs){var vars=[];var clauses=[];var current=["multi"];var mktemp=function(){var t=gensym();vars.push(t);return t;};var newclause=function(){if((current.length>1)){clauses.push(current);}else{false;}return (current=["multi"]);};var helper=function(lhs,curr){return helper_noexpand(expand.step(env,"pattern",lhs),curr);};var helper_noexpand=function(lhs,curr){var other;var _tmp442;var _tmp443;var _tmp444;var specs;var _tmp445;var _tmp446;var _tmp447;var fname;var spec;var _tmp448;var _tmp449;var _tmp450;var checker;var expr;var _tmp451;var _tmp452;var _tmp453;var xs;var _tmp454;var _tmp455;var _tmp456;var xs;var _tmp457;var _tmp458;var _tmp459;var v;var _tmp460;var _tmp461;var _tmp463;var _tmp462;if(((_tmp461=lhs),(((_tmp462=_tmp461),(_tmp462===null))||((_tmp463=_tmp461),(_tmp463=="_"))))){return false;}else{if(((_tmp460=lhs),(typeof(_tmp460)=="string"))){vars.push(lhs);current.push(["assign",lhs,curr]);return current.push(["value",true]);}else{if((((_tmp457=lhs),(_tmp457 instanceof Array))&&(((_tmp458=_tmp457.length),(_tmp458==2))&&(((_tmp459=_tmp457[0]),(_tmp459=="value"))&&((v=_tmp457[1]),true))))){var x=["check",["macro",make_checker(lhs,"___eq")],null];return helper_noexpand(x,curr);}else{if((((_tmp454=lhs),(_tmp454 instanceof Array))&&(((_tmp455=_tmp454.length),(_tmp455>=1))&&(((_tmp456=_tmp454[0]),(_tmp456=="all"))&&((xs=_tmp454.slice(1)),true))))){var temp=mktemp();(current=current.concat([["assign",temp,curr]]));return xs.forEach(function(x){return helper(x,temp);});}else{if((((_tmp451=lhs),(_tmp451 instanceof Array))&&(((_tmp452=_tmp451.length),(_tmp452>=1))&&(((_tmp453=_tmp451[0]),(_tmp453=="any"))&&((xs=_tmp451.slice(1)),true))))){var normalize=function(vars){return vars.filter(function(x){return (x.slice(0,4)!=="_tmp");}).sort().join(",");};var temp=mktemp();(current=current.concat([["assign",temp,curr]]));var myvars=undefined;var clauses=[];xs.forEach(function(x){var p=parse_lhs(env,x,temp);if((myvars===undefined)){(myvars=p[0]);}else{if((normalize(p[0])!==normalize(myvars))){throw [["Must have the same set of variables in both branches!",myvars]];}else{if(true){(vars=vars.concat(p[0]));}else{false;}}}return clauses.push(make_pattern_test(p[1]));});current.push(make_or_pattern(clauses));(vars=vars.concat(myvars));return newclause();}else{if((((_tmp448=lhs),(_tmp448 instanceof Array))&&(((_tmp449=_tmp448.length),(_tmp449==3))&&(((_tmp450=_tmp448[0]),(_tmp450=="check"))&&((checker=_tmp448[1]),true,(expr=_tmp448[2]),true))))){var temp=mktemp();(current=current.concat([["assign",temp,curr],["send",checker,["data",temp]]]));newclause();return helper(expr,temp);}else{if((((_tmp445=lhs),(_tmp445 instanceof Array))&&(((_tmp446=_tmp445.length),(_tmp446==3))&&(((_tmp447=_tmp445[0]),(_tmp447=="send"))&&((fname=_tmp445[1]),true,(spec=_tmp445[2]),true))))){return helper(fname,["send","->",["data",spec,curr]]);}else{if((((_tmp442=lhs),(_tmp442 instanceof Array))&&(((_tmp443=_tmp442.length),(_tmp443>=1))&&(((_tmp444=_tmp442[0]),(_tmp444=="data"))&&((specs=_tmp442.slice(1)),true))))){var fw=0;var bw=0;var rest=undefined;var members=specs.map(function(x){var v=expand.step(env,"pattern",x);if(((v instanceof Array)&&(v[0]=="dynsplice"))){(rest=v[1]);}else{if((rest===undefined)){(fw=(fw+1));}else{if(true){(bw=(bw+1));}else{false;}}}return v;});var cmp=function(){if((rest===undefined)){return "___eq";}else{if(true){return "___gte";}else{return false;}}}();var temp=mktemp();var len=mktemp();(current=current.concat([["assign",temp,curr],["send","___instanceof",["data",temp,"Array"]]]));newclause();(current=current.concat([["assign",len,["send",temp,["value","length"]]],["send",cmp,["data",len,["value",(fw+bw)]]]]));newclause();for(var j=0;(j<fw);(++j)){helper_noexpand(members[j],["send",temp,["value",j]]);}if((rest!==undefined)){var slice=function(){if((bw>0)){return ["data",["value",fw],["value",(-bw)]];}else{if(true){return ["data",["value",fw]];}else{return false;}}}();helper_noexpand(members[fw][1],["send",["send",temp,["value","slice"]],slice]);}else{false;}for(var j=0;(j<bw);(++j)){helper_noexpand(members[((fw+j)+1)],["send",temp,["send","___minus",["data",len,["value",(bw-j)]]]]);}}else{if(((other=lhs),true)){throw "OopsG";}else{throw "Could not find a match";}}}}}}}}}};helper(lhs,rhs);if((current.length>1)){clauses.push(current);}else{false;}return [vars,clauses];};var make_declarations=function(vars){return vars.map(function(name){return ["declare",name,["value",undefined]];});};var make_pattern_test=function(clauses){var ands=clauses.pop();while((clauses.length>0)){(ands=["send","___and",["data",clauses.pop(),ands]]);}return ands;};var make_or_pattern=function(clauses){var ors=clauses.pop();while((clauses.length>0)){(ors=["send","___or",["data",clauses.pop(),ors]]);}return ors;};stdenv.register_macro("|>",function(env,context,_tmp464){var _tmp465;var _tmp466;var _tmp467;var to_match;var cl;if((((_tmp465=_tmp464),(_tmp465 instanceof Array))&&(((_tmp466=_tmp465.length),(_tmp466==3))&&(((_tmp467=_tmp465[0]),(_tmp467=="data"))&&((to_match=_tmp465[1]),true,(cl=_tmp465[2]),true))))){false;}else{throw "a condition failed";}var clauses=function(){var other;var _tmp468;var _tmp469;var _tmp470;var cls;if((((_tmp468=cl),(_tmp468 instanceof Array))&&(((_tmp469=_tmp468.length),(_tmp469>=1))&&(((_tmp470=_tmp468[0]),(_tmp470=="multi"))&&((cls=_tmp468.slice(1)),true))))){return cls;}else{if(((other=cl),true)){return [other];}else{throw "Could not find a match";}}}();var decls=["multi"];var r=["js_throw",["value","Could not find a match"]];while((clauses.length>0)){var _tmp471;var _tmp472;var _tmp473;var _tmp474;var _tmp475;var _tmp476;var _tmp477;var lhs;var body;if((((_tmp471=clauses.pop()),(_tmp471 instanceof Array))&&(((_tmp472=_tmp471.length),(_tmp472==3))&&(((_tmp473=_tmp471[0]),(_tmp473=="send"))&&(((_tmp474=_tmp471[1]),(_tmp474=="->"))&&(((_tmp475=_tmp471[2]),(_tmp475 instanceof Array))&&(((_tmp476=_tmp475.length),(_tmp476==3))&&(((_tmp477=_tmp475[0]),(_tmp477=="data"))&&((lhs=_tmp475[1]),true,(body=_tmp475[2]),true))))))))){false;}else{throw "a condition failed";}var p=parse_lhs(env,lhs,to_match);var test=make_pattern_test(p[1]);(r=["if",test,body,r]);(decls=decls.concat(make_declarations(p[0])));}decls.push(r);return decls;});var js_op_table=({"___plus":"+","___minus":"-","___times":"*","___div":"/","___mod":"%","___binxor":"^","___binand":"&","___binor":"|","___binnot":"~","___and":"&&","___or":"||","___not":"!","___is":"===","___isnt":"!==","___eq":"==","___neq":"!=","___lt":"<","___gt":">","___lte":"<=","___gte":">=","___in":" in ","___instanceof":" instanceof ","___plusplus":"++","___minusminus":"--"});var translate=function(expr,mode){var other;var _tmp478;var _tmp479;var _tmp480;var f;var msg;var _tmp481;var _tmp482;var _tmp483;var f;var _tmp484;var _tmp485;var _tmp486;var args;var _tmp487;var _tmp488;var _tmp489;var f;var _tmp490;var msg;var _tmp491;var _tmp492;var _tmp493;var s;var _tmp494;var _tmp495;var _tmp496;var args;var _tmp497;var _tmp498;var _tmp499;var args;var _tmp500;var _tmp501;var _tmp502;var value;var _tmp503;var _tmp504;var _tmp505;var value;var _tmp506;var _tmp507;var _tmp508;var _tmp509;var _tmp510;var _tmp511;var _tmp512;var _tmp513;var _tmp514;var args;var _tmp515;var _tmp516;var _tmp517;var args;var _tmp518;var _tmp519;var _tmp520;var lhs;var rhs;var _tmp521;var _tmp522;var _tmp523;var binding;var value;var _tmp524;var _tmp525;var _tmp526;var binding;var _tmp527;var _tmp528;var _tmp529;var _tmp530;var _tmp531;var _tmp532;var _tmp533;var x;var y;var z;var body;var _tmp534;var _tmp535;var _tmp536;var test;var body;var _tmp537;var _tmp538;var _tmp539;var test;var pos;var neg;var _tmp540;var _tmp541;var _tmp542;var bindings;var body;var _tmp543;var _tmp544;var _tmp545;var v;var _tmp546;var _tmp547;if(((_tmp547=expr),(typeof(_tmp547)=="string"))){return translate.expr(translate.mangle(expr),mode);}else{if(((_tmp546=expr),(_tmp546===null))){return translate.expr("null",mode);}else{if((((_tmp543=expr),(_tmp543 instanceof Array))&&(((_tmp544=_tmp543.length),(_tmp544==2))&&(((_tmp545=_tmp543[0]),(_tmp545=="value"))&&((v=_tmp543[1]),true))))){var r=function(){var other;var _tmp548;var _tmp556;var _tmp549;var _tmp555;var _tmp550;var _tmp554;var _tmp551;var _tmp553;var _tmp552;var _tmp557;if(((_tmp557=v),(typeof(_tmp557)=="string"))){var repl=({"\"":"\\\"","\n":"\\n","\\":"\\\\"});(v=v.replace(RegExp("((?:(?:\"|\\\\)|\n))","g"),function(m){return repl[m];}));return (("\""+v)+"\"");}else{if(((_tmp548=v),(((_tmp549=_tmp548),(((_tmp550=_tmp549),(((_tmp551=_tmp550),(((_tmp552=_tmp551),(typeof(_tmp552)=="number"))||((_tmp553=_tmp551),(_tmp553===true))))||((_tmp554=_tmp550),(_tmp554===false))))||((_tmp555=_tmp549),(_tmp555===null))))||((_tmp556=_tmp548),(_tmp556===undefined))))){return String(v);}else{if(((other=v),true)){return (("?!?["+v)+"]?!?");}else{throw "Could not find a match";}}}}();return translate.expr(r,mode);}else{if((((_tmp540=expr),(_tmp540 instanceof Array))&&(((_tmp541=_tmp540.length),(_tmp541==3))&&(((_tmp542=_tmp540[0]),(_tmp542=="lambda"))&&((bindings=_tmp540[1]),true,(body=_tmp540[2]),true))))){var a=bindings.join(",");var b=translate.body(body,"return");return translate.expr((((("function("+a)+"){")+b)+"}"),mode);}else{if((((_tmp537=expr),(_tmp537 instanceof Array))&&(((_tmp538=_tmp537.length),(_tmp538==4))&&(((_tmp539=_tmp537[0]),(_tmp539=="if"))&&((test=_tmp537[1]),true,(pos=_tmp537[2]),true,(neg=_tmp537[3]),true))))){var other;var _tmp558;if(((_tmp558=mode),(_tmp558=="expr"))){return translate.body(expr,"expr");}else{if(((other=mode),true)){var a=translate(test,"expr");var b=translate(pos,mode);var c=translate(neg,mode);return (((((("if("+a)+"){")+b)+"}else{")+c)+"}");}else{throw "Could not find a match";}}}else{if((((_tmp534=expr),(_tmp534 instanceof Array))&&(((_tmp535=_tmp534.length),(_tmp535==3))&&(((_tmp536=_tmp534[0]),(_tmp536=="js_while"))&&((test=_tmp534[1]),true,(body=_tmp534[2]),true))))){var other;var _tmp559;if(((_tmp559=mode),(_tmp559=="expr"))){return translate.body(expr,"expr");}else{if(((other=mode),true)){var a=translate(test,"expr");var b=translate(body,"stmt");return (((("while("+a)+"){")+b)+"}");}else{throw "Could not find a match";}}}else{if((((_tmp531=expr),(_tmp531 instanceof Array))&&(((_tmp532=_tmp531.length),(_tmp532==5))&&(((_tmp533=_tmp531[0]),(_tmp533=="js_for"))&&((x=_tmp531[1]),true,(y=_tmp531[2]),true,(z=_tmp531[3]),true,(body=_tmp531[4]),true))))){var other;var _tmp560;if(((_tmp560=mode),(_tmp560=="expr"))){return translate.body(expr,"expr");}else{if(((other=mode),true)){var a=translate(x,"stmt");var b=translate(y,"stmt");var c=translate(z,"expr");var d=translate(body,"stmt");return (((((("for("+a)+b)+c)+"){")+d)+"}");}else{throw "Could not find a match";}}}else{if((((_tmp524=expr),(_tmp524 instanceof Array))&&(((_tmp525=_tmp524.length),(_tmp525==3))&&(((_tmp526=_tmp524[0]),(_tmp526=="declare"))&&(((binding=_tmp524[1]),true,(_tmp527=_tmp524[2]),(_tmp527 instanceof Array))&&(((_tmp528=_tmp527.length),(_tmp528==2))&&(((_tmp529=_tmp527[0]),(_tmp529=="value"))&&((_tmp530=_tmp527[1]),(_tmp530===undefined))))))))){var other;var _tmp561;var _tmp563;var _tmp562;if(((_tmp561=mode),(((_tmp562=_tmp561),(_tmp562=="expr"))||((_tmp563=_tmp561),(_tmp563=="return"))))){throw "Invalid in expr ctx";}else{if(((other=mode),true)){var a=translate(binding,"expr");return (("var "+a)+";");}else{throw "Could not find a match";}}}else{if((((_tmp521=expr),(_tmp521 instanceof Array))&&(((_tmp522=_tmp521.length),(_tmp522==3))&&(((_tmp523=_tmp521[0]),(_tmp523=="declare"))&&((binding=_tmp521[1]),true,(value=_tmp521[2]),true))))){var other;var _tmp564;var _tmp566;var _tmp565;if(((_tmp564=mode),(((_tmp565=_tmp564),(_tmp565=="expr"))||((_tmp566=_tmp564),(_tmp566=="return"))))){throw "Invalid in expr ctx";}else{if(((other=mode),true)){var a=translate(binding,"expr");var b=translate(value,"expr");return (((("var "+a)+"=")+b)+";");}else{throw "Could not find a match";}}}else{if((((_tmp518=expr),(_tmp518 instanceof Array))&&(((_tmp519=_tmp518.length),(_tmp519==3))&&(((_tmp520=_tmp518[0]),(_tmp520=="assign"))&&((lhs=_tmp518[1]),true,(rhs=_tmp518[2]),true))))){var a=translate(lhs,"expr");var b=translate(rhs,"expr");return translate.expr((((("("+a)+"=")+b)+")"),mode);}else{if((((_tmp515=expr),(_tmp515 instanceof Array))&&(((_tmp516=_tmp515.length),(_tmp516>=1))&&(((_tmp517=_tmp515[0]),(_tmp517=="multi"))&&((args=_tmp515.slice(1)),true))))){var isdecl=function(x){return ((x instanceof Array)&&(x[0]=="declare"));};if((args.length==1)){return translate(args[0],mode);}else{if(((mode=="expr")&&(!args.some(isdecl)))){var xs=args.map(function(x){return translate(x,"expr");});return (("("+xs.join(","))+")");}else{if(true){return translate.body(expr,mode);}else{return false;}}}}else{if((((_tmp512=expr),(_tmp512 instanceof Array))&&(((_tmp513=_tmp512.length),(_tmp513>=1))&&(((_tmp514=_tmp512[0]),(_tmp514=="splice"))&&((args=_tmp512.slice(1)),true))))){return translate(["multi"].concat(args),mode);}else{if((((_tmp509=expr),(_tmp509 instanceof Array))&&(((_tmp510=_tmp509.length),(_tmp510==1))&&((_tmp511=_tmp509[0]),(_tmp511=="js_break"))))){if((mode=="expr")){throw "Invalid break in ctx";}else{if(true){return "break;";}else{return false;}}}else{if((((_tmp506=expr),(_tmp506 instanceof Array))&&(((_tmp507=_tmp506.length),(_tmp507==1))&&((_tmp508=_tmp506[0]),(_tmp508=="js_continue"))))){if((mode=="expr")){throw "Invalid continue in ctx";}else{if(true){return "continue;";}else{return false;}}}else{if((((_tmp503=expr),(_tmp503 instanceof Array))&&(((_tmp504=_tmp503.length),(_tmp504==2))&&(((_tmp505=_tmp503[0]),(_tmp505=="js_return"))&&((value=_tmp503[1]),true))))){if((mode=="expr")){throw "Invalid return in ctx";}else{if(true){return (("return "+translate(value,"expr"))+";");}else{return false;}}}else{if((((_tmp500=expr),(_tmp500 instanceof Array))&&(((_tmp501=_tmp500.length),(_tmp501==2))&&(((_tmp502=_tmp500[0]),(_tmp502=="js_throw"))&&((value=_tmp500[1]),true))))){if(true){return (("throw "+translate(value,"expr"))+";");}else{return false;}}else{if((((_tmp497=expr),(_tmp497 instanceof Array))&&(((_tmp498=_tmp497.length),(_tmp498>=1))&&(((_tmp499=_tmp497[0]),(_tmp499=="array"))&&((args=_tmp497.slice(1)),true))))){var r=function(){var f=function(x){return translate(x,"expr");};return (("["+args.map(f).join(","))+"]");}();return translate.expr(r,mode);}else{if((((_tmp494=expr),(_tmp494 instanceof Array))&&(((_tmp495=_tmp494.length),(_tmp495>=1))&&(((_tmp496=_tmp494[0]),(_tmp496=="object"))&&((args=_tmp494.slice(1)),true))))){var r=function(){var f=function(x){var a=translate(x[1],"expr");var b=translate(x[2],"expr");return ((a+":")+b);};return (("({"+args.map(f).join(","))+"})");}();return translate.expr(r,mode);}else{if((((_tmp487=expr),(_tmp487 instanceof Array))&&(((_tmp488=_tmp487.length),(_tmp488==3))&&(((_tmp489=_tmp487[0]),(_tmp489=="send"))&&(((f=_tmp487[1]),true,(_tmp490=_tmp487[2]),(msg=_tmp490),true,(_tmp491=_tmp490),(_tmp491 instanceof Array))&&(((_tmp492=_tmp491.length),(_tmp492==2))&&(((_tmp493=_tmp491[0]),(_tmp493=="value"))&&((s=_tmp491[1]),true)))))))){if(((typeof(s)=="string")&&s.match(RegExp("(?:^(?:[a-zA-Z_$]+)$)")))){var trf=translate(f,"expr");var trmsg=translate(s,"expr");return translate.expr(((trf+".")+trmsg),mode);}else{if(true){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{return false;}}}else{if((((_tmp481=expr),(_tmp481 instanceof Array))&&(((_tmp482=_tmp481.length),(_tmp482==3))&&(((_tmp483=_tmp481[0]),(_tmp483=="send"))&&(((f=_tmp481[1]),true,(_tmp484=_tmp481[2]),(_tmp484 instanceof Array))&&(((_tmp485=_tmp484.length),(_tmp485>=1))&&(((_tmp486=_tmp484[0]),(_tmp486=="array"))&&((args=_tmp484.slice(1)),true)))))))){var op=((typeof(f)=="string")&&js_op_table[f]);if(op){return translate.expr(translate.op(op,args[0],args[1]),mode);}else{if(true){var trf=translate(f,"expr");var trargs=args.map(function(x){return translate(x,"expr");});return translate.expr((((trf+"(")+trargs.join(","))+")"),mode);}else{return false;}}}else{if((((_tmp478=expr),(_tmp478 instanceof Array))&&(((_tmp479=_tmp478.length),(_tmp479==3))&&(((_tmp480=_tmp478[0]),(_tmp480=="send"))&&((f=_tmp478[1]),true,(msg=_tmp478[2]),true))))){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{if(((other=expr),true)){throw other;}else{throw "Could not find a match";}}}}}}}}}}}}}}}}}}}}}}};(translate.mangle=function(name){var tr=({"+":"__plus__","-":"__minus__","*":"__asterisk__","/":"__slash__","%":"__percent__","^":"__caret__","#":"__hash__","&":"__amp__","|":"__pipe__","@":"__at__","!":"__bang__","?":"__qmark__","=":"__equal__","<":"__lt__",">":"__gt__","~":"__tilde__"});var r=[];for(var i=0;(i<name.length);(++i)){var c=name[i];r.push((tr[c]||c));}return r.join("");});(translate.body=function(b,mode){(orig=b);(b=aslist(b));var trst=function(stmt){return translate(stmt,"stmt");};var other;var _tmp567;var _tmp568;var _tmp569;if(((_tmp569=mode),(_tmp569=="expr"))){var x=["send",["lambda",[],orig],["array"]];return translate(x,mode);}else{if(((_tmp568=mode),(_tmp568=="return"))){var stmts=b.slice(0,(-1));var ret=b[(b.length-1)];return (stmts.map(trst).join("")+translate(ret,"return"));}else{if(((_tmp567=mode),(_tmp567=="stmt"))){return b.map(trst).join("");}else{if(((other=mode),true)){throw "OopsH";}else{throw "Could not find a match";}}}}});(translate.expr=function(x,mode){var other;var _tmp570;var _tmp571;var _tmp572;if(((_tmp572=mode),(_tmp572=="expr"))){return x;}else{if(((_tmp571=mode),(_tmp571=="stmt"))){return (x+";");}else{if(((_tmp570=mode),(_tmp570=="return"))){return (("return "+x)+";");}else{if(((other=mode),true)){throw "OopsI";}else{throw "Could not find a match";}}}}});(translate.op=function(op,a,b){(e=function(){if((a===null)){return (op+translate(b,"expr"));}else{if((b===null)){return (translate(a,"expr")+op);}else{if(true){return ((translate(a,"expr")+op)+translate(b,"expr"));}else{return false;}}}}());return (("("+e)+")");});var fs=require("fs");var file=process.argv[2];var f=function(err,data){var p=parse(data);var ex=expand(stdenv,"top",["multi",p]);var prelude="var ___lib=require(\"./lib\");";return console.log((prelude+translate(ex,"stmt")));};fs.readFile(file,"utf8",f);
