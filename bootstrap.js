var ___lib=require("./lib");var special_ops=({"(":"PFX","[":"PFX","{":"PFX",")":"SFX","]":"SFX","}":"SFX",",":"IFX",":":"IFX",".":"PFX"});var regexps=function(){var id=RegExp("(?:^[a-zA-Z$_](?:[a-zA-Z$_0-9]*))");var id_f=function(m,wsb,wsa,last_op){return ["ID","ID",m[0]];};var numr=RegExp("(?:^((?:\\d+))[rR]((?:[A-Za-z0-9_]+))(?:(?:\\.((?:[A-Za-z0-9_]+)))?))");var numr_f=function(m,wsb,wsa,last_op){var _tmp0;var _tmp1;var radix;var int;var frac;if((((_tmp0=m),(_tmp0 instanceof Array))&&((_tmp0["#"]===undefined)&&(((_tmp1=_tmp0.length),(_tmp1===4))&&(_tmp0[0],true,(radix=_tmp0[1]),true,(int=_tmp0[2]),true,(frac=_tmp0[3]),true))))){false;}else{throw "a condition failed";}(value=parseInt(int.replace(RegExp("_","g"),""),radix));if(frac){(frac=frac.replace(RegExp("_","g"),""));(value=(value+(parseInt(frac,radix)/Math.pow(radix,frac.length))));}else{false;}return ["ID","NUM",value];};var num=RegExp("(?:^((?:[0-9_]+))(?:(?:\\.((?:\\d+)))?)(?:(?:[eE]((?:[+-]?)(?:[0-9_]+)))?))");var num_f=function(m,wsb,wsa,last_op){return ["ID","NUM",parseFloat(m[0].replace(RegExp("_","g"),""))];};var str=RegExp("(?:^\"((?:(?:(?:\\\\\\\\|\\\\\")|[^\"])*))\")");var str_f=function(m,wsb,wsa,last_op){var repl=({"\\\"":"\"","\\\\":"\\","\\n":"\n"});var r=m[1].replace(RegExp("((?:(?:\\\\\"|\\\\\\\\)|\\\\n))","g"),function(m){return ___lib.send(repl,m);});return ["ID","STR",r];};var op=RegExp("(?:^(?:[+\\-*/~\\^<>=%&|?!#.:]+))");var op2=RegExp("(?:^[\\(\\[\\{\\}\\]\\),])");var op3=RegExp("(?:^(?:(?:(?:(?:(?:(?:(?:(?:with|where)|when)|and)|not)|or)|in)|instanceof)|mod)\\b)");var op4=RegExp("(?:^`((?:[A-Za-z0-9_]+))`)");var op_f=function(m,wsb,wsa,last_op){var op=(m[1]||m[0]);if((op in special_ops)){var fixity=___lib.send(special_ops,op);var width=function(){var _tmp2=fixity;var other;var _tmp3;var _tmp4;var _tmp5;if((((_tmp5=_tmp2),(_tmp5==="IFX"))&&(_tmp5,true))){if((wsb||wsa)){return "wide";}else{return "short";}}else{if((((_tmp4=_tmp2),(_tmp4==="SFX"))&&(_tmp4,true))){if(wsb){return "wide";}else{return "short";}}else{if((((_tmp3=_tmp2),(_tmp3==="PFX"))&&(_tmp3,true))){if(wsa){return "wide";}else{return "short";}}else{if(((other=_tmp2),true)){throw "OopsA";}else{throw ["Could not find a match",_tmp2];}}}}}();return ["OP",fixity,width,op];}else{if((wsa&&wsb)){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "IFX";}else{return false;}}}(),"wide",op];}else{if(((!wsa)&&(!wsb))){return ["OP",function(){if(last_op){return "PFX";}else{if(true){return "IFX";}else{return false;}}}(),"short",op];}else{if(wsa){if(last_op){return ["OP","PFX","wide",op];}else{if(true){return ["OP","SFX","short",op];}else{return false;}}}else{if(wsb){return ["OP","PFX","short",op];}else{if(true){return ["OP","PFX","short",op];}else{return false;}}}}}}};var indent=RegExp("(?:^(?:(?:\n((?: *)))+))");var indent_f=function(m,wsb,wsa,last_op){var ilen=m[1].length;return ["INDENT",ilen];};var cmnt=RegExp("(?:^;(?:[^\n]*))");var cmnt_f=function(m,wsb,wsa,last_op){return ["IGNORE"];};var unkn=RegExp("(?:^.)");var unkn_f=function(m,wsb,wsa,last_op){throw ("unknown character: "+m[0]);};return [[op3,op_f],[id,id_f],[numr,numr_f],[num,num_f],[str,str_f],[op,op_f],[op2,op_f],[op4,op_f],[indent,indent_f],[cmnt,cmnt_f],[unkn,unkn_f]];}();var ws_re=RegExp("(?:^(?: *)(?:(?:\n(?: *)\\\\(?: *))*))");var eol_re=RegExp("(?:^(?: *)(?:\n|$))");var indent_tracker=function(){var curr=false;var stack=[];var stacks=[stack];return function(token){var _tmp6=token;var other;var _tmp7;var _tmp8;var _tmp9;var fixity;var width;var _tmp10;var _tmp12;var _tmp11;var _tmp13;var _tmp14;var _tmp15;var fixity;var width;var _tmp16;var _tmp18;var _tmp17;var _tmp19;var _tmp20;var _tmp21;var stuff;var _tmp22;var _tmp23;var _tmp24;var new_indent;if((((_tmp22=_tmp6),(_tmp22 instanceof Array))&&((_tmp22["#"]===undefined)&&(((_tmp23=_tmp22.length),(_tmp23===2))&&(((_tmp24=_tmp22[0]),(_tmp24==="INDENT"))&&(_tmp24,true,(new_indent=_tmp22[1]),true)))))){if((curr===false)){(curr=new_indent);return [["OP","IFX","wide",","]];}else{if((new_indent>curr)){stack.push(curr);(curr=new_indent);return [["OP","PFX","wide","["]];}else{if((new_indent===curr)){return [["OP","IFX","wide",","]];}else{if((new_indent<curr)){var rval=[];while(((stack.length>0)&&(new_indent<curr))){(curr=stack.pop());rval.push(["OP","SFX","wide","]"]);}rval.push(["OP","IFX","wide",","]);return rval;}else{if(true){throw [curr,new_indent];}else{return false;}}}}}}else{if((((_tmp19=_tmp6),(_tmp19 instanceof Array))&&((_tmp19["#"]===undefined)&&(((_tmp20=_tmp19.length),(_tmp20>=1))&&(((_tmp21=_tmp19[0]),(_tmp21==="ID"))&&(_tmp21,true,(stuff=_tmp19.slice(1)),true)))))){return [token];}else{if((((_tmp13=_tmp6),(_tmp13 instanceof Array))&&((_tmp13["#"]===undefined)&&(((_tmp14=_tmp13.length),(_tmp14===4))&&(((_tmp15=_tmp13[0]),(_tmp15==="OP"))&&(_tmp15,true,(fixity=_tmp13[1]),true,(width=_tmp13[2]),true,(_tmp16=_tmp13[3]),((((_tmp17=_tmp16),(_tmp17==="["))&&(_tmp17,true))||(((_tmp18=_tmp16),(_tmp18==="{"))&&(_tmp18,true))))))))){stack.push(curr);stacks.push(stack);(stack=[]);(curr=false);return [token];}else{if((((_tmp7=_tmp6),(_tmp7 instanceof Array))&&((_tmp7["#"]===undefined)&&(((_tmp8=_tmp7.length),(_tmp8===4))&&(((_tmp9=_tmp7[0]),(_tmp9==="OP"))&&(_tmp9,true,(fixity=_tmp7[1]),true,(width=_tmp7[2]),true,(_tmp10=_tmp7[3]),((((_tmp11=_tmp10),(_tmp11==="]"))&&(_tmp11,true))||(((_tmp12=_tmp10),(_tmp12==="}"))&&(_tmp12,true))))))))){var rval=stack.map(function(x){return ["OP","SFX","short","]"];});(stack=stacks.pop());(curr=stack.pop());rval.push(token);return rval;}else{if(((other=_tmp6),true)){return [token];}else{throw ["Could not find a match",_tmp6];}}}}}};};var process_token=function(token,last_op,wsa,wsb,pos,endpos,accum){var _tmp25;var _tmp26;var type;var result;if((((_tmp25=token),(_tmp25 instanceof Array))&&((_tmp25["#"]===undefined)&&(((_tmp26=_tmp25.length),(_tmp26>=1))&&((type=_tmp25[0]),true,(result=_tmp25.slice(1)),true))))){false;}else{throw "a condition failed";}var _tmp27=type;var other;var _tmp28;var _tmp29;var _tmp30;if((((_tmp30=_tmp27),(_tmp30==="IGNORE"))&&(_tmp30,true))){return last_op;}else{if((((_tmp29=_tmp27),(_tmp29==="ID"))&&(_tmp29,true))){if((!last_op)){var w=["IFX",function(){if(wsb){return "wide";}else{return "short";}}(),"WHITE"];(w["location"]=[pos,pos]);accum.push(w);}else{false;}accum.push(result);return false;}else{if((((_tmp28=_tmp27),(_tmp28==="OP"))&&(_tmp28,true))){if(last_op){var v=["VOID"];(v["location"]=[pos,pos]);accum.push(v);}else{false;}var _tmp31=result[0];var _tmp32;var _tmp33;var _tmp34;if((((_tmp34=_tmp31),(_tmp34==="IFX"))&&(_tmp34,true))){accum.push(result);return true;}else{if((((_tmp33=_tmp31),(_tmp33==="PFX"))&&(_tmp33,true))){if((!last_op)){var w=["IFX",function(){if(wsb){return "wide";}else{return "short";}}(),"WHITE"];(w["location"]=[pos,pos]);var v=["VOID"];(v["location"]=[pos,pos]);accum.push(w);accum.push(v);}else{false;}accum.push(result);return true;}else{if((((_tmp32=_tmp31),(_tmp32==="SFX"))&&(_tmp32,true))){accum.push(result);var v=["VOID"];(v["location"]=[endpos,endpos]);accum.push(v);return false;}else{throw ["Could not find a match",_tmp31];}}}}else{if(((other=_tmp27),true)){throw "OopsB";}else{throw ["Could not find a match",_tmp27];}}}}};var tokenize=function(text){var last_op=true;var results=[];var wsb=text.match(ws_re)[0].length;(text=text.slice(wsb));(pos=wsb);var indent=indent_tracker();while(text){for(var i=0;(i<regexps.length);(++i)){var _tmp35;var _tmp36;var re;var fn;if((((_tmp35=___lib.send(regexps,i)),(_tmp35 instanceof Array))&&((_tmp35["#"]===undefined)&&(((_tmp36=_tmp35.length),(_tmp36===2))&&((re=_tmp35[0]),true,(fn=_tmp35[1]),true))))){false;}else{throw "a condition failed";}var m=text.match(re);if(m){var skip=m[0].length;var endpos=(pos+skip);(text=text.slice(skip));var wsa=text.match(ws_re)[0].length;var eol=(text.match(eol_re)&&true);var bwsb=(wsb>0);var bwsa=function(){if(eol){return bwsb;}else{return (wsa>0);}}();var token=fn(m,bwsb,bwsa,last_op);var tokens=indent(token);tokens.forEach(function(x){return (last_op=process_token(x,last_op,bwsa,bwsb,pos,endpos,results));});(text=text.slice(wsa));(wsb=wsa);(pos=(endpos+wsa));break;}else{false;}}}if(last_op){var v=["VOID"];(v["location"]=[pos,pos]);results.push(v);}else{false;}return results;};var MAX=(1/0);var order_map=({"IFX":({"wide":({",":[[15,1],[15,1]],"with":[[15,999],[15,10]],"where":[[15,11],[15,10]],"|>":[[15,11],[15,10]],"->":[[15,11],[15,10]],"=>":[[15,11],[15,10]],"=":[[15,11],[15,10]],":=":[[15,11],[15,10]],"+=":[[15,11],[15,10]],"-=":[[15,11],[15,10]],"*=":[[15,11],[15,10]],"/=":[[15,11],[15,10]],"<<=":[[15,11],[15,10]],">>=":[[15,11],[15,10]],">>>=":[[15,11],[15,10]],"when":[[15,100],[15,101]],"||":[[15,110],[15,111]],"&&":[[15,120],[15,121]],"or":[[15,110],[15,111]],"and":[[15,120],[15,121]],"not":[[15,130],[15,131]],"==":[[15,200],[15,201]],"!=":[[15,200],[15,201]],">=":[[15,200],[15,201]],"<=":[[15,200],[15,201]],">":[[15,200],[15,201]],"<":[[15,200],[15,201]],"^.":[[15,400],[15,401]],"|.":[[15,410],[15,411]],"&.":[[15,420],[15,421]],"<<":[[1,500],[1,501]],">>":[[1,500],[1,501]],">>>":[[1,500],[1,501]],"+":[[1,550],[1,551]],"-":[[1,550],[1,551]],"*":[[1,560],[1,561]],"/":[[1,560],[1,561]],"mod":[[1,560],[1,561]],"**":[[1,571],[1,570]],"default":[[8,900],[4,901]],"WHITE":[[15,1000],[15,1001]],":":[[15,1001],[15,2]]}),"short":({"default":[[15,1900],[15,1901]],"WHITE":[[15,2000],[15,2001]],",":[[15,1],[15,1]],":":[[15,1001],[15,2]]})}),"PFX":({"wide":({"default":[[15,MAX],[15,900]],"not":[[15,130],[15,131]],".":[[15,MAX],[15,3000]],"#":[[15,MAX],[15,3000]],"<>":[[15,MAX],[15,5]],"(":[[15,MAX],[15,1]],"[":[[15,MAX],[15,1]],"{":[[15,MAX],[15,1]]}),"short":({"default":[[15,MAX],[15,1900]],".":[[15,MAX],[15,3000]],"#":[[15,MAX],[15,3000]],"(":[[15,MAX],[15,1]],"[":[[15,MAX],[15,1]],"{":[[15,MAX],[15,1]]})}),"SFX":({"wide":({"default":[[15,901],[15,MAX]],")":[[15,1],[15,MAX]],"]":[[15,1],[15,MAX]],"}":[[15,1],[15,MAX]]}),"short":({"default":[[15,1901],[15,MAX]],")":[[15,1],[15,MAX]],"]":[[15,1],[15,MAX]],"}":[[15,1],[15,MAX]]})})});var DONE=(-1);var NONE=0;var LEFT=1;var RIGHT=2;var BOTH=3;var oparse=function(next,order,finalize){var between=finalize(next());var right_op=next();var stack=[];var left_op=null;var current=null;while(true){var o=function(){if(((!left_op)&&(!right_op))){return DONE;}else{if(true){return ((((!left_op)&&RIGHT)||((!right_op)&&LEFT))||order(left_op,right_op));}else{return false;}}}();var _tmp37=o;var other;var _tmp38;var _tmp39;var _tmp40;var _tmp41;var _tmp42;if((((_tmp42=_tmp37),(_tmp42===DONE))&&(_tmp42,true))){return between;}else{if((((_tmp41=_tmp37),(_tmp41===LEFT))&&(_tmp41,true))){current.push(between);(between=finalize(current));var v=stack.pop();(left_op=v[0]);(current=v[1]);}else{if((((_tmp40=_tmp37),(_tmp40===RIGHT))&&(_tmp40,true))){stack.push([left_op,current]);(left_op=right_op);(current=[[right_op],between]);(between=finalize(next()));(right_op=next());}else{if((((_tmp39=_tmp37),(_tmp39===BOTH))&&(_tmp39,true))){current[0].push(right_op);current.push(between);(left_op=right_op);(between=finalize(next()));(right_op=next());}else{if((((_tmp38=_tmp37),(_tmp38===NONE))&&(_tmp38,true))){throw ((("Undefined priority between "+left_op)+" and ")+right_op);}else{if(((other=_tmp37),true)){throw "OopsC";}else{throw ["Could not find a match",_tmp37];}}}}}}}};var consult=function(_tmp43){var _tmp44;var _tmp45;var fixity;var width;var op;if((((_tmp44=_tmp43),(_tmp44 instanceof Array))&&((_tmp44["#"]===undefined)&&(((_tmp45=_tmp44.length),(_tmp45===3))&&((fixity=_tmp44[0]),true,(width=_tmp44[1]),true,(op=_tmp44[2]),true))))){false;}else{throw "a condition failed";}var map=___lib.send(___lib.send(order_map,fixity),width);return (___lib.send(map,op)||map.default);};var order=function(o1,o2){var _tmp46;var _tmp47;var code1;var ord1;if((((_tmp46=consult(o1)[1]),(_tmp46 instanceof Array))&&((_tmp46["#"]===undefined)&&(((_tmp47=_tmp46.length),(_tmp47===2))&&((code1=_tmp46[0]),true,(ord1=_tmp46[1]),true))))){false;}else{throw "a condition failed";}var _tmp48;var _tmp49;var code2;var ord2;if((((_tmp48=consult(o2)[0]),(_tmp48 instanceof Array))&&((_tmp48["#"]===undefined)&&(((_tmp49=_tmp48.length),(_tmp49===2))&&((code2=_tmp48[0]),true,(ord2=_tmp48[1]),true))))){false;}else{throw "a condition failed";}if(((code1&code2)===0)){throw ["Cannot mix",o1,o2];}else{if((ord1>ord2)){return LEFT;}else{if((ord1<ord2)){return RIGHT;}else{if((ord1===ord2)){return BOTH;}else{return false;}}}}};var finalize=function(x){var _tmp50=x;var other;var _tmp51;var _tmp52;var ops;var args;var _tmp53;var _tmp54;var _tmp55;var _tmp56;var _tmp57;var _tmp58;var value;var _tmp59;var _tmp60;var _tmp61;var value;var _tmp62;var _tmp63;var _tmp64;var value;if((((_tmp62=_tmp50),(_tmp62 instanceof Array))&&((_tmp62["#"]===undefined)&&(((_tmp63=_tmp62.length),(_tmp63===2))&&(((_tmp64=_tmp62[0]),(_tmp64==="ID"))&&(_tmp64,true,(value=_tmp62[1]),true)))))){return value;}else{if((((_tmp59=_tmp50),(_tmp59 instanceof Array))&&((_tmp59["#"]===undefined)&&(((_tmp60=_tmp59.length),(_tmp60===2))&&(((_tmp61=_tmp59[0]),(_tmp61==="NUM"))&&(_tmp61,true,(value=_tmp59[1]),true)))))){return ["value",value];}else{if((((_tmp56=_tmp50),(_tmp56 instanceof Array))&&((_tmp56["#"]===undefined)&&(((_tmp57=_tmp56.length),(_tmp57===2))&&(((_tmp58=_tmp56[0]),(_tmp58==="STR"))&&(_tmp58,true,(value=_tmp56[1]),true)))))){return ["value",value];}else{if((((_tmp53=_tmp50),(_tmp53 instanceof Array))&&((_tmp53["#"]===undefined)&&(((_tmp54=_tmp53.length),(_tmp54===1))&&(((_tmp55=_tmp53[0]),(_tmp55==="VOID"))&&(_tmp55,true)))))){return null;}else{if((((_tmp51=_tmp50),(_tmp51 instanceof Array))&&((_tmp51["#"]===undefined)&&(((_tmp52=_tmp51.length),(_tmp52>=1))&&((ops=_tmp51[0]),true,(args=_tmp51.slice(1)),true))))){(ops=ops.map(function(o){return o[2];}));var op=ops[0];var _tmp65=[ops,args];var other;var _tmp66;var _tmp67;var _tmp68;var _tmp69;var _tmp70;var _tmp71;var a;var b;var _tmp72;var _tmp73;var _tmp74;var _tmp75;var _tmp76;var _tmp77;var _tmp78;var _tmp79;var _tmp80;var _tmp81;var _tmp82;var _tmp83;var _tmp84;var _tmp85;var _tmp86;var _tmp87;var _tmp88;var _tmp89;var _tmp90;var _tmp91;var _tmp92;var _tmp93;var _tmp94;var _tmp96;var _tmp95;var _tmp97;var _tmp98;var _tmp99;var _tmp100;var _tmp101;var _tmp102;var _tmp103;var target;var body;var _tmp104;var _tmp105;var _tmp106;var _tmp107;var _tmp108;var _tmp109;var _tmp110;var f;var body;var _tmp111;var _tmp112;var _tmp113;var _tmp114;var _tmp115;var _tmp116;var _tmp117;var _tmp118;var f;var arg;var body;if((((_tmp111=_tmp65),(_tmp111 instanceof Array))&&((_tmp111["#"]===undefined)&&(((_tmp112=_tmp111.length),(_tmp112===2))&&(((_tmp113=_tmp111[0]),(_tmp113 instanceof Array))&&((_tmp113["#"]===undefined)&&(((_tmp114=_tmp113.length),(_tmp114===2))&&(((_tmp115=_tmp113[0]),(_tmp115==="WHITE"))&&((_tmp115,true,(_tmp116=_tmp113[1]),(_tmp116===":"))&&((_tmp116,true,(_tmp117=_tmp111[1]),(_tmp117 instanceof Array))&&((_tmp117["#"]===undefined)&&(((_tmp118=_tmp117.length),(_tmp118===3))&&((f=_tmp117[0]),true,(arg=_tmp117[1]),true,(body=_tmp117[2]),true))))))))))))){return ["send",f,["data",["code",arg],["code",body]]];}else{if((((_tmp104=_tmp65),(_tmp104 instanceof Array))&&((_tmp104["#"]===undefined)&&(((_tmp105=_tmp104.length),(_tmp105===2))&&(((_tmp106=_tmp104[0]),(_tmp106 instanceof Array))&&((_tmp106["#"]===undefined)&&(((_tmp107=_tmp106.length),(_tmp107===1))&&(((_tmp108=_tmp106[0]),(_tmp108===":"))&&((_tmp108,true,(_tmp109=_tmp104[1]),(_tmp109 instanceof Array))&&((_tmp109["#"]===undefined)&&(((_tmp110=_tmp109.length),(_tmp110===2))&&((f=_tmp109[0]),true,(body=_tmp109[1]),true)))))))))))){return ["send",f,["data",["code",body]]];}else{if((((_tmp97=_tmp65),(_tmp97 instanceof Array))&&((_tmp97["#"]===undefined)&&(((_tmp98=_tmp97.length),(_tmp98===2))&&(((_tmp99=_tmp97[0]),(_tmp99 instanceof Array))&&((_tmp99["#"]===undefined)&&(((_tmp100=_tmp99.length),(_tmp100===1))&&(((_tmp101=_tmp99[0]),(_tmp101==="with"))&&((_tmp101,true,(_tmp102=_tmp97[1]),(_tmp102 instanceof Array))&&((_tmp102["#"]===undefined)&&(((_tmp103=_tmp102.length),(_tmp103===2))&&((target=_tmp102[0]),true,(body=_tmp102[1]),true)))))))))))){(body=function(){var _tmp130=body;var other;var _tmp131;var _tmp132;var _tmp133;var rest;if((((_tmp131=_tmp130),(_tmp131 instanceof Array))&&((_tmp131["#"]===undefined)&&(((_tmp132=_tmp131.length),(_tmp132>=1))&&(((_tmp133=_tmp131[0]),(_tmp133==="multi"))&&(_tmp133,true,(rest=_tmp131.slice(1)),true)))))){return rest;}else{if(((other=_tmp130),true)){return [body];}else{throw ["Could not find a match",_tmp130];}}}());var _tmp119=target;var other;var _tmp120;var _tmp121;var _tmp122;var args;var _tmp123;var _tmp124;var _tmp125;var f;var _tmp126;var _tmp127;var _tmp128;var args;var _tmp129;if((((_tmp129=_tmp119),(_tmp129===null))&&(_tmp129,true))){return ["data"].concat(body);}else{if((((_tmp123=_tmp119),(_tmp123 instanceof Array))&&((_tmp123["#"]===undefined)&&(((_tmp124=_tmp123.length),(_tmp124===3))&&(((_tmp125=_tmp123[0]),(_tmp125==="send"))&&((_tmp125,true,(f=_tmp123[1]),true,(_tmp126=_tmp123[2]),(_tmp126 instanceof Array))&&((_tmp126["#"]===undefined)&&(((_tmp127=_tmp126.length),(_tmp127>=1))&&(((_tmp128=_tmp126[0]),(_tmp128==="data"))&&(_tmp128,true,(args=_tmp126.slice(1)),true)))))))))){return ["send",f,["data"].concat(args).concat(body)];}else{if((((_tmp120=_tmp119),(_tmp120 instanceof Array))&&((_tmp120["#"]===undefined)&&(((_tmp121=_tmp120.length),(_tmp121>=1))&&(((_tmp122=_tmp120[0]),(_tmp122==="data"))&&(_tmp122,true,(args=_tmp120.slice(1)),true)))))){return target.concat(body);}else{if(((other=_tmp119),true)){return ["send",target,["data"].concat(body)];}else{throw ["Could not find a match",_tmp119];}}}}}else{if((((_tmp90=_tmp65),(_tmp90 instanceof Array))&&((_tmp90["#"]===undefined)&&(((_tmp91=_tmp90.length),(_tmp91===2))&&(((_tmp92=_tmp90[0]),(_tmp92 instanceof Array))&&((_tmp92["#"]===undefined)&&(((_tmp93=_tmp92.length),(_tmp93>=1))&&(((_tmp94=_tmp92[0]),((((_tmp95=_tmp94),(_tmp95==="["))&&(_tmp95,true))||(((_tmp96=_tmp94),(_tmp96===","))&&(_tmp96,true))))&&(_tmp92.slice(1),true,_tmp90[1],true))))))))){if((op==="[")){(args=args.slice(1,(-1)));}else{false;}(args=function(){var f=function(x){return (x!==null);};return args.filter(f);}());var result=function(){var _tmp134=args;var other;var _tmp135;var _tmp136;var x;var _tmp137;var _tmp138;if((((_tmp137=_tmp134),(_tmp137 instanceof Array))&&((_tmp137["#"]===undefined)&&((_tmp138=_tmp137.length),(_tmp138===0))))){throw "At least one expression must be enclosed in []";}else{if((((_tmp135=_tmp134),(_tmp135 instanceof Array))&&((_tmp135["#"]===undefined)&&(((_tmp136=_tmp135.length),(_tmp136===1))&&((x=_tmp135[0]),true))))){return x;}else{if(((other=_tmp134),true)){return ["multi"].concat(args);}else{throw ["Could not find a match",_tmp134];}}}}();return result;}else{if((((_tmp85=_tmp65),(_tmp85 instanceof Array))&&((_tmp85["#"]===undefined)&&(((_tmp86=_tmp85.length),(_tmp86===2))&&(((_tmp87=_tmp85[0]),(_tmp87 instanceof Array))&&((_tmp87["#"]===undefined)&&(((_tmp88=_tmp87.length),(_tmp88>=1))&&(((_tmp89=_tmp87[0]),(_tmp89==="{"))&&(_tmp89,true,_tmp87.slice(1),true,_tmp85[1],true))))))))){var f=function(x){return (x!==null);};return ["data"].concat(args.slice(1,(-1)).filter(f));}else{if((((_tmp80=_tmp65),(_tmp80 instanceof Array))&&((_tmp80["#"]===undefined)&&(((_tmp81=_tmp80.length),(_tmp81===2))&&(((_tmp82=_tmp80[0]),(_tmp82 instanceof Array))&&((_tmp82["#"]===undefined)&&(((_tmp83=_tmp82.length),(_tmp83===1))&&(((_tmp84=_tmp82[0]),(_tmp84==="WHITE"))&&(_tmp84,true,_tmp80[1],true))))))))){return ["send"].concat(args);}else{if((((_tmp72=_tmp65),(_tmp72 instanceof Array))&&((_tmp72["#"]===undefined)&&(((_tmp73=_tmp72.length),(_tmp73===2))&&(((_tmp74=_tmp72[0]),(_tmp74 instanceof Array))&&((_tmp74["#"]===undefined)&&(((_tmp75=_tmp74.length),(_tmp75===1))&&((_tmp74[0],true,(_tmp76=_tmp72[1]),(_tmp76 instanceof Array))&&((_tmp76["#"]===undefined)&&(((_tmp77=_tmp76.length),(_tmp77===2))&&(((_tmp78=_tmp76[0]),(_tmp78===null))&&((_tmp78,true,(_tmp79=_tmp76[1]),(_tmp79===null))&&(_tmp79,true))))))))))))){return op;}else{if((((_tmp66=_tmp65),(_tmp66 instanceof Array))&&((_tmp66["#"]===undefined)&&(((_tmp67=_tmp66.length),(_tmp67===2))&&(((_tmp68=_tmp66[0]),(_tmp68 instanceof Array))&&((_tmp68["#"]===undefined)&&(((_tmp69=_tmp68.length),(_tmp69===1))&&((_tmp68[0],true,(_tmp70=_tmp66[1]),(_tmp70 instanceof Array))&&((_tmp70["#"]===undefined)&&(((_tmp71=_tmp70.length),(_tmp71===2))&&((a=_tmp70[0]),true,(b=_tmp70[1]),true))))))))))){return ["send",op,["data",a,b]];}else{if(((other=_tmp65),true)){throw ["Unknown node",ops,args];}else{throw ["Could not find a match",_tmp65];}}}}}}}}}}else{if(((other=_tmp50),true)){throw "OopsE";}else{throw ["Could not find a match",_tmp50];}}}}}}};var parse=function(text){var results=tokenize(text);var next=function(){return results.shift();};return oparse(next,order,finalize);};var Env=function(parent){var store=Object();var self=function(expr){return ["bind_env",self,expr];};(self["resolve"]=function(name){var attempt=___lib.send(store,name);if(attempt){return attempt;}else{if(true){return self.parent.resolve(name);}else{return false;}}});(self["register"]=function(name,value){return (store[name]=value);});(self["register_macro"]=function(name,m){return (store[name]=["macro",m]);});(self["fork"]=function(){return Env(self);});(self["parent"]=parent);(self["store"]=store);return self;};var js_contexts=({"js_for":["multi","multi","multi","multi"]});var expand=function(env,context,expr){(expr=expand.step(env,context,expr));var _tmp139=expr;var other;var _tmp140;var _tmp141;var _tmp142;var type;var _tmp143;var _tmp155;var _tmp144;var _tmp154;var _tmp145;var _tmp153;var _tmp146;var _tmp152;var _tmp147;var _tmp151;var _tmp148;var _tmp150;var _tmp149;var args;var _tmp156;var _tmp157;var _tmp158;var lhs;var rhs;var _tmp159;var _tmp160;var _tmp161;var binding;var value;var _tmp162;var _tmp163;var _tmp164;var bindings;var body;var _tmp165;var _tmp166;var _tmp167;var args;var _tmp168;var _tmp169;var _tmp170;var type;var _tmp171;var _tmp179;var _tmp172;var _tmp178;var _tmp173;var _tmp177;var _tmp174;var _tmp176;var _tmp175;var args;var _tmp180;var _tmp181;var _tmp182;var v;var _tmp183;var _tmp184;var _tmp185;var f;var arg;var _tmp186;var _tmp187;var _tmp188;if((((_tmp188=_tmp139),(typeof(_tmp188)==="string"))&&(_tmp188,true))){return expr;}else{if((((_tmp187=_tmp139),(_tmp187===null))&&(_tmp187,true))){return null;}else{if((((_tmp186=_tmp139),(_tmp186===undefined))&&(_tmp186,true))){throw "undefined? why?";}else{if((((_tmp183=_tmp139),(_tmp183 instanceof Array))&&((_tmp183["#"]===undefined)&&(((_tmp184=_tmp183.length),(_tmp184===3))&&(((_tmp185=_tmp183[0]),(_tmp185==="send"))&&(_tmp185,true,(f=_tmp183[1]),true,(arg=_tmp183[2]),true)))))){(f=expand(env,"head",f));return ["send",f,expand(env,"tail",arg)];}else{if((((_tmp180=_tmp139),(_tmp180 instanceof Array))&&((_tmp180["#"]===undefined)&&(((_tmp181=_tmp180.length),(_tmp181===2))&&(((_tmp182=_tmp180[0]),(_tmp182==="value"))&&(_tmp182,true,(v=_tmp180[1]),true)))))){return expr;}else{if((((_tmp168=_tmp139),(_tmp168 instanceof Array))&&((_tmp168["#"]===undefined)&&(((_tmp169=_tmp168.length),(_tmp169>=1))&&(((_tmp170=_tmp168[0]),(type=_tmp170),true,(_tmp171=_tmp170),(((_tmp172=_tmp171),(((_tmp173=_tmp172),(((_tmp174=_tmp173),((((_tmp175=_tmp174),(_tmp175==="multi"))&&(_tmp175,true))||(((_tmp176=_tmp174),(_tmp176==="code"))&&(_tmp176,true))))||(((_tmp177=_tmp173),(_tmp177==="array"))&&(_tmp177,true))))||(((_tmp178=_tmp172),(_tmp178==="object"))&&(_tmp178,true))))||(((_tmp179=_tmp171),(_tmp179==="splice"))&&(_tmp179,true))))&&((args=_tmp168.slice(1)),true)))))){var arr=[];while((args.length>0)){var x=expand.step(env,type,args.shift());var _tmp189=x;var other;var _tmp190;var _tmp191;var _tmp192;var stmts;if((((_tmp190=_tmp189),(_tmp190 instanceof Array))&&((_tmp190["#"]===undefined)&&(((_tmp191=_tmp190.length),(_tmp191>=1))&&(((_tmp192=_tmp190[0]),(_tmp192==="splice"))&&(_tmp192,true,(stmts=_tmp190.slice(1)),true)))))){(args=stmts.concat(args));}else{if(((other=_tmp189),true)){arr.push(x);}else{throw ["Could not find a match",_tmp189];}}}var f=function(x){return expand(env,type,x);};return [type].concat(arr.map(f));}else{if((((_tmp165=_tmp139),(_tmp165 instanceof Array))&&((_tmp165["#"]===undefined)&&(((_tmp166=_tmp165.length),(_tmp166>=1))&&(((_tmp167=_tmp165[0]),(_tmp167==="data"))&&(_tmp167,true,(args=_tmp165.slice(1)),true)))))){var is_obj=false;var obj=["object"];var arr=["array"];var parts=[];var newpart=function(){var _tmp193=arr;var other;var _tmp194;var _tmp195;var _tmp196;if((((_tmp194=_tmp193),(_tmp194 instanceof Array))&&((_tmp194["#"]===undefined)&&(((_tmp195=_tmp194.length),(_tmp195===1))&&(((_tmp196=_tmp194[0]),(_tmp196==="array"))&&(_tmp196,true)))))){return false;}else{if(((other=_tmp193),true)){parts.push(arr);return (arr=["array"]);}else{throw ["Could not find a match",_tmp193];}}};while((args.length>0)){var x=expand.step(env,type,args.shift());var _tmp197=x;var other;var _tmp198;var _tmp199;var _tmp200;var expr;var _tmp201;var _tmp202;var _tmp203;var exprs;var _tmp204;var _tmp205;var _tmp206;var k;var v;var _tmp207;var _tmp208;var _tmp209;if((((_tmp207=_tmp197),(_tmp207 instanceof Array))&&((_tmp207["#"]===undefined)&&(((_tmp208=_tmp207.length),(_tmp208===1))&&(((_tmp209=_tmp207[0]),(_tmp209==="assoc"))&&(_tmp209,true)))))){(is_obj=true);}else{if((((_tmp204=_tmp197),(_tmp204 instanceof Array))&&((_tmp204["#"]===undefined)&&(((_tmp205=_tmp204.length),(_tmp205===3))&&(((_tmp206=_tmp204[0]),(_tmp206==="assoc"))&&(_tmp206,true,(k=_tmp204[1]),true,(v=_tmp204[2]),true)))))){(is_obj=true);obj.push(["array",k,v]);}else{if((((_tmp201=_tmp197),(_tmp201 instanceof Array))&&((_tmp201["#"]===undefined)&&(((_tmp202=_tmp201.length),(_tmp202>=1))&&(((_tmp203=_tmp201[0]),(_tmp203==="splice"))&&(_tmp203,true,(exprs=_tmp201.slice(1)),true)))))){(args=exprs.concat(args));}else{if((((_tmp198=_tmp197),(_tmp198 instanceof Array))&&((_tmp198["#"]===undefined)&&(((_tmp199=_tmp198.length),(_tmp199===2))&&(((_tmp200=_tmp198[0]),(_tmp200==="dynsplice"))&&(_tmp200,true,(expr=_tmp198[1]),true)))))){newpart();parts.push(expr);}else{if(((other=_tmp197),true)){arr.push(other);}else{throw ["Could not find a match",_tmp197];}}}}}}newpart();var r=function(){var _tmp210=parts;var other;var _tmp211;var _tmp212;var _tmp213;var arr;var _tmp214;var _tmp215;var _tmp216;var things;var _tmp217;var _tmp218;var _tmp219;var _tmp220;if((((_tmp219=_tmp210),(_tmp219 instanceof Array))&&((_tmp219["#"]===undefined)&&(((_tmp220=_tmp219.length),(_tmp220===0))&&is_obj)))){return obj;}else{if((((_tmp217=_tmp210),(_tmp217 instanceof Array))&&((_tmp217["#"]===undefined)&&((_tmp218=_tmp217.length),(_tmp218===0))))){return ["array"];}else{if((((_tmp211=_tmp210),(_tmp211 instanceof Array))&&((_tmp211["#"]===undefined)&&(((_tmp212=_tmp211.length),(_tmp212===1))&&(((_tmp213=_tmp211[0]),(arr=_tmp213),true,(_tmp214=_tmp213),(_tmp214 instanceof Array))&&((_tmp214["#"]===undefined)&&(((_tmp215=_tmp214.length),(_tmp215>=1))&&(((_tmp216=_tmp214[0]),(_tmp216==="array"))&&(_tmp216,true,(things=_tmp214.slice(1)),true))))))))){if(is_obj){arr.push(obj);}else{false;}return arr;}else{if(((other=_tmp210),true)){if(is_obj){parts.push(["array",obj]);}else{false;}var patch=["send","___lib",["value","patch_array"]];return ["send",patch,["array"].concat(parts)];}else{throw ["Could not find a match",_tmp210];}}}}}();return expand(env,context,r);}else{if((((_tmp162=_tmp139),(_tmp162 instanceof Array))&&((_tmp162["#"]===undefined)&&(((_tmp163=_tmp162.length),(_tmp163===3))&&(((_tmp164=_tmp162[0]),(_tmp164==="lambda"))&&(_tmp164,true,(bindings=_tmp162[1]),true,(body=_tmp162[2]),true)))))){return ["lambda",bindings.map(function(x){return expand(env,"decl",x);}),expand(env,"multi",body)];}else{if((((_tmp159=_tmp139),(_tmp159 instanceof Array))&&((_tmp159["#"]===undefined)&&(((_tmp160=_tmp159.length),(_tmp160===3))&&(((_tmp161=_tmp159[0]),(_tmp161==="declare"))&&(_tmp161,true,(binding=_tmp159[1]),true,(value=_tmp159[2]),true)))))){return ["declare",expand(env,"decl",binding),expand(env,"multi",value)];}else{if((((_tmp156=_tmp139),(_tmp156 instanceof Array))&&((_tmp156["#"]===undefined)&&(((_tmp157=_tmp156.length),(_tmp157===3))&&(((_tmp158=_tmp156[0]),(_tmp158==="assign"))&&(_tmp158,true,(lhs=_tmp156[1]),true,(rhs=_tmp156[2]),true)))))){return ["assign",expand(env,"decl",lhs),expand(env,"multi",rhs)];}else{if((((_tmp140=_tmp139),(_tmp140 instanceof Array))&&((_tmp140["#"]===undefined)&&(((_tmp141=_tmp140.length),(_tmp141>=1))&&(((_tmp142=_tmp140[0]),(type=_tmp142),true,(_tmp143=_tmp142),(((_tmp144=_tmp143),(((_tmp145=_tmp144),(((_tmp146=_tmp145),(((_tmp147=_tmp146),(((_tmp148=_tmp147),((((_tmp149=_tmp148),(_tmp149==="js_while"))&&(_tmp149,true))||(((_tmp150=_tmp148),(_tmp150==="js_for"))&&(_tmp150,true))))||(((_tmp151=_tmp147),(_tmp151==="js_break"))&&(_tmp151,true))))||(((_tmp152=_tmp146),(_tmp152==="js_continue"))&&(_tmp152,true))))||(((_tmp153=_tmp145),(_tmp153==="js_return"))&&(_tmp153,true))))||(((_tmp154=_tmp144),(_tmp154==="js_throw"))&&(_tmp154,true))))||(((_tmp155=_tmp143),(_tmp155==="if"))&&(_tmp155,true))))&&((args=_tmp140.slice(1)),true)))))){var ctxs=(___lib.send(js_contexts,type)||[]);var f=function(x,i){return expand(env,(___lib.send(ctxs,i)||"expr"),x);};return [type].concat(args.map(f));}else{if(((other=_tmp139),true)){throw ["Oops",expr,context];}else{throw ["Could not find a match",_tmp139];}}}}}}}}}}}}};(expand["step"]=function(env,context,expr){var _tmp221=expr;var other;var _tmp222;var _tmp223;var type;var args;var _tmp224;var _tmp225;var _tmp226;var f;var arg;var _tmp227;var _tmp228;var _tmp229;var m;var _tmp230;var _tmp231;var _tmp232;if((((_tmp232=_tmp221),(typeof(_tmp232)==="string"))&&(_tmp232,true))){var v=env.resolve(expr);var _tmp233=[v,context];var other;var _tmp234;var _tmp235;var _tmp236;var _tmp237;var _tmp238;var m;var _tmp239;var _tmp240;var _tmp241;var _tmp242;var _tmp243;var m;var _tmp244;var _tmp245;var _tmp246;var _tmp247;if((((_tmp245=_tmp233),(_tmp245 instanceof Array))&&((_tmp245["#"]===undefined)&&(((_tmp246=_tmp245.length),(_tmp246===2))&&(((_tmp247=_tmp245[0]),(_tmp247===undefined))&&(_tmp247,true,_tmp245[1],true)))))){return expr;}else{if((((_tmp239=_tmp233),(_tmp239 instanceof Array))&&((_tmp239["#"]===undefined)&&(((_tmp240=_tmp239.length),(_tmp240===2))&&(((_tmp241=_tmp239[0]),(_tmp241 instanceof Array))&&((_tmp241["#"]===undefined)&&(((_tmp242=_tmp241.length),(_tmp242===2))&&(((_tmp243=_tmp241[0]),(_tmp243==="macro"))&&((_tmp243,true,(m=_tmp241[1]),true,(_tmp244=_tmp239[1]),(_tmp244==="head"))&&(_tmp244,true)))))))))){return v;}else{if((((_tmp234=_tmp233),(_tmp234 instanceof Array))&&((_tmp234["#"]===undefined)&&(((_tmp235=_tmp234.length),(_tmp235===2))&&(((_tmp236=_tmp234[0]),(_tmp236 instanceof Array))&&((_tmp236["#"]===undefined)&&(((_tmp237=_tmp236.length),(_tmp237===2))&&(((_tmp238=_tmp236[0]),(_tmp238==="macro"))&&(_tmp238,true,(m=_tmp236[1]),true,_tmp234[1],true))))))))){return expand.step(env,context,m(env,context,null));}else{if(((other=_tmp233),true)){return v;}else{throw ["Could not find a match",_tmp233];}}}}}else{if((((_tmp231=_tmp221),(_tmp231===null))&&(_tmp231,true))){return null;}else{if((((_tmp230=_tmp221),(_tmp230===undefined))&&(_tmp230,true))){throw "undefined? why?";}else{if((((_tmp227=_tmp221),(_tmp227 instanceof Array))&&((_tmp227["#"]===undefined)&&(((_tmp228=_tmp227.length),(_tmp228===2))&&(((_tmp229=_tmp227[0]),(_tmp229==="macro"))&&(_tmp229,true,(m=_tmp227[1]),true)))))){if((context==="head")){return expr;}else{if(true){return expand.step(env,context,m(env,context,null));}else{return false;}}}else{if((((_tmp224=_tmp221),(_tmp224 instanceof Array))&&((_tmp224["#"]===undefined)&&(((_tmp225=_tmp224.length),(_tmp225===3))&&(((_tmp226=_tmp224[0]),(_tmp226==="send"))&&(_tmp226,true,(f=_tmp224[1]),true,(arg=_tmp224[2]),true)))))){(f=expand.step(env,"head",f));var _tmp248=f;var other;var _tmp249;var _tmp250;var _tmp251;var m;if((((_tmp249=_tmp248),(_tmp249 instanceof Array))&&((_tmp249["#"]===undefined)&&(((_tmp250=_tmp249.length),(_tmp250===2))&&(((_tmp251=_tmp249[0]),(_tmp251==="macro"))&&(_tmp251,true,(m=_tmp249[1]),true)))))){return expand.step(env,context,m(env,context,arg));}else{if(((other=_tmp248),true)){return expr;}else{throw ["Could not find a match",_tmp248];}}}else{if((((_tmp222=_tmp221),(_tmp222 instanceof Array))&&((_tmp222["#"]===undefined)&&(((_tmp223=_tmp222.length),(_tmp223>=1))&&((type=_tmp222[0]),true,(args=_tmp222.slice(1)),true))))){return expr;}else{if(((other=_tmp221),true)){throw ["Oops2",expr];}else{throw ["Could not find a match",_tmp221];}}}}}}}});var aslist=function(expr){var _tmp252=expr;var other;var _tmp253;var _tmp254;var _tmp255;var args;var _tmp256;var _tmp257;if((((_tmp257=_tmp252),(_tmp257===null))&&(_tmp257,true))){return [null];}else{if((((_tmp256=_tmp252),(_tmp256===undefined))&&(_tmp256,true))){return [undefined];}else{if((((_tmp253=_tmp252),(_tmp253 instanceof Array))&&((_tmp253["#"]===undefined)&&(((_tmp254=_tmp253.length),(_tmp254>=1))&&(((_tmp255=_tmp253[0]),(_tmp255==="multi"))&&(_tmp255,true,(args=_tmp253.slice(1)),true)))))){return args;}else{if(((other=_tmp252),true)){return [other];}else{throw ["Could not find a match",_tmp252];}}}}};var nullenv=({"resolve":function(x){return undefined;}});var stdenv=Env(nullenv);stdenv.register("+","___plus");stdenv.register("-","___minus");stdenv.register("*","___times");stdenv.register("/","___div");stdenv.register("%","___mod");stdenv.register("^","___binxor");stdenv.register("&","___binand");stdenv.register("|","___binor");stdenv.register("~","___binnot");stdenv.register("&&","___and");stdenv.register("||","___or");stdenv.register("and","___and");stdenv.register("or","___or");stdenv.register("not","___not");stdenv.register("===","___is");stdenv.register("!==","___isnt");stdenv.register("!=","___neq");stdenv.register("<","___lt");stdenv.register(">","___gt");stdenv.register("<=","___lte");stdenv.register(">=","___gte");stdenv.register("<<","___shl");stdenv.register(">>","___shr");stdenv.register(">>>","___shr2");stdenv.register("in","___in");stdenv.register("instanceof","___instanceof");stdenv.register("++","___plusplus");stdenv.register("--","___minusminus");stdenv.register("Struct",["send","___lib",["value","Struct"]]);var make_checker=function(value,op){return function(env,context,expr){return ["send",op,["data",expr[1],value]];};};stdenv.register_macro("**",function(env,context,_tmp258){var _tmp259;var _tmp260;var _tmp261;var a;var b;if((((_tmp259=_tmp258),(_tmp259 instanceof Array))&&((_tmp259["#"]===undefined)&&(((_tmp260=_tmp259.length),(_tmp260===3))&&(((_tmp261=_tmp259[0]),(_tmp261==="data"))&&(_tmp261,true,(a=_tmp259[1]),true,(b=_tmp259[2]),true)))))){false;}else{throw "a condition failed";}return ["send",["send","Math",["value","pow"]],["data",a,b]];});stdenv.register_macro("//",function(env,context,_tmp262){var _tmp263;var _tmp264;var _tmp265;var a;var b;if((((_tmp263=_tmp262),(_tmp263 instanceof Array))&&((_tmp263["#"]===undefined)&&(((_tmp264=_tmp263.length),(_tmp264===3))&&(((_tmp265=_tmp263[0]),(_tmp265==="data"))&&(_tmp265,true,(a=_tmp263[1]),true,(b=_tmp263[2]),true)))))){false;}else{throw "a condition failed";}var div=["send","___div",["data",a,b]];return ["send",["send","Math",["value","floor"]],["data",div]];});stdenv.register_macro("<>",function(env,context,_tmp266){var _tmp267;var _tmp268;var _tmp269;var _tmp270;var x;if((((_tmp267=_tmp266),(_tmp267 instanceof Array))&&((_tmp267["#"]===undefined)&&(((_tmp268=_tmp267.length),(_tmp268===3))&&(((_tmp269=_tmp267[0]),(_tmp269==="data"))&&((_tmp269,true,(_tmp270=_tmp267[1]),(_tmp270===null))&&(_tmp270,true,(x=_tmp267[2]),true))))))){false;}else{throw "a condition failed";}return ["send",["send","___lib",["value","pr"]],["data",x]];});stdenv.register_macro("#",function(env,context,_tmp271){var _tmp272;var _tmp273;var _tmp274;var _tmp275;var tag;if((((_tmp272=_tmp271),(_tmp272 instanceof Array))&&((_tmp272["#"]===undefined)&&(((_tmp273=_tmp272.length),(_tmp273===3))&&(((_tmp274=_tmp272[0]),(_tmp274==="data"))&&((_tmp274,true,(_tmp275=_tmp272[1]),(_tmp275===null))&&(_tmp275,true,(tag=_tmp272[2]),true))))))){false;}else{throw "a condition failed";}(tag=["value",tag]);var f=function(env,context,expr){if((context==="pattern")){var checker_mac=function(){var f=function(env,context,expr){return ["send","___eq",["data",["send",expr[1],["value","#"]],tag]];};return ["macro",f];}();var _tmp276=expr;var other;var _tmp277;var _tmp278;var _tmp279;var subp;if((((_tmp277=_tmp276),(_tmp277 instanceof Array))&&((_tmp277["#"]===undefined)&&(((_tmp278=_tmp277.length),(_tmp278>=1))&&(((_tmp279=_tmp277[0]),(_tmp279==="data"))&&(_tmp279,true,(subp=_tmp277.slice(1)),true)))))){var deconstructor_mac=function(){var f=function(env,context,expr){return ["data",["value",true],["send",["send",expr[1],["value","slice"]],["data",["value",0]]]];};return ["macro",f];}();return ["check",checker_mac,["project",deconstructor_mac,expr]];}else{if(((other=_tmp276),true)){return ["check",checker_mac,(expr||["ignore"])];}else{throw ["Could not find a match",_tmp276];}}}else{if(true){var _tmp280=expr;var other;var _tmp281;var _tmp282;var _tmp283;var args;var _tmp284;if((((_tmp284=_tmp280),(_tmp284===null))&&(_tmp284,true))){var d=["data",tag];return ["send",["send","___lib",["value","StructFactory"]],d];}else{if((((_tmp281=_tmp280),(_tmp281 instanceof Array))&&((_tmp281["#"]===undefined)&&(((_tmp282=_tmp281.length),(_tmp282>=1))&&(((_tmp283=_tmp281[0]),(_tmp283==="data"))&&(_tmp283,true,(args=_tmp281.slice(1)),true)))))){var d=["data",tag].concat(args);return ["send",["send","___lib",["value","Struct"]],d];}else{if(((other=_tmp280),true)){var factory=function(){var d=["data",tag];return ["send",["send","___lib",["value","StructFactory"]],d];}();return ["send",factory,other];}else{throw ["Could not find a match",_tmp280];}}}}else{return false;}}};return ["macro",f];});stdenv.register_macro("when",function(env,context,_tmp285){var _tmp286;var _tmp287;var _tmp288;var pattern;var condition;if((((_tmp286=_tmp285),(_tmp286 instanceof Array))&&((_tmp286["#"]===undefined)&&(((_tmp287=_tmp286.length),(_tmp287===3))&&(((_tmp288=_tmp286[0]),(_tmp288==="data"))&&(_tmp288,true,(pattern=_tmp286[1]),true,(condition=_tmp286[2]),true)))))){false;}else{throw "a condition failed";}var _tmp289=pattern;var other;var _tmp290;if((((_tmp290=_tmp289),(_tmp290===null))&&(_tmp290,true))){return ["test",condition,["ignore"]];}else{if(((other=_tmp289),true)){return ["test",condition,pattern];}else{throw ["Could not find a match",_tmp289];}}});var andf=function(env,context,expr){var _tmp291=[context,expr];var other;var _tmp292;var _tmp293;var _tmp294;var _tmp295;var _tmp296;var _tmp297;var _tmp298;var _tmp299;var _tmp300;var a;var b;if((((_tmp295=_tmp291),(_tmp295 instanceof Array))&&((_tmp295["#"]===undefined)&&(((_tmp296=_tmp295.length),(_tmp296===2))&&(((_tmp297=_tmp295[0]),(_tmp297==="pattern"))&&((_tmp297,true,(_tmp298=_tmp295[1]),(_tmp298 instanceof Array))&&((_tmp298["#"]===undefined)&&(((_tmp299=_tmp298.length),(_tmp299===3))&&(((_tmp300=_tmp298[0]),(_tmp300==="data"))&&(_tmp300,true,(a=_tmp298[1]),true,(b=_tmp298[2]),true)))))))))){return ["all",a,b];}else{if((((_tmp292=_tmp291),(_tmp292 instanceof Array))&&((_tmp292["#"]===undefined)&&(((_tmp293=_tmp292.length),(_tmp293===2))&&((_tmp292[0],true,(_tmp294=_tmp292[1]),(_tmp294===null))&&(_tmp294,true)))))){return "___and";}else{if(((other=_tmp291),true)){return ["send","___and",expr];}else{throw ["Could not find a match",_tmp291];}}}};stdenv.register_macro("&&",andf);stdenv.register_macro("and",andf);var orf=function(env,context,expr){var _tmp301=[context,expr];var other;var _tmp302;var _tmp303;var _tmp304;var _tmp305;var _tmp306;var _tmp307;var _tmp308;var _tmp309;var _tmp310;var a;var b;if((((_tmp305=_tmp301),(_tmp305 instanceof Array))&&((_tmp305["#"]===undefined)&&(((_tmp306=_tmp305.length),(_tmp306===2))&&(((_tmp307=_tmp305[0]),(_tmp307==="pattern"))&&((_tmp307,true,(_tmp308=_tmp305[1]),(_tmp308 instanceof Array))&&((_tmp308["#"]===undefined)&&(((_tmp309=_tmp308.length),(_tmp309===3))&&(((_tmp310=_tmp308[0]),(_tmp310==="data"))&&(_tmp310,true,(a=_tmp308[1]),true,(b=_tmp308[2]),true)))))))))){return ["any",a,b];}else{if((((_tmp302=_tmp301),(_tmp302 instanceof Array))&&((_tmp302["#"]===undefined)&&(((_tmp303=_tmp302.length),(_tmp303===2))&&((_tmp302[0],true,(_tmp304=_tmp302[1]),(_tmp304===null))&&(_tmp304,true)))))){return "___or";}else{if(((other=_tmp301),true)){return ["send","___or",expr];}else{throw ["Could not find a match",_tmp301];}}}};stdenv.register_macro("||",orf);stdenv.register_macro("or",orf);var partial_pattern=function(operator){return function(env,context,expr){var _tmp311=[context,expr];var other;var _tmp312;var _tmp313;var _tmp314;var _tmp315;var _tmp316;var _tmp317;var _tmp318;var _tmp319;var _tmp320;var _tmp321;var val;if((((_tmp315=_tmp311),(_tmp315 instanceof Array))&&((_tmp315["#"]===undefined)&&(((_tmp316=_tmp315.length),(_tmp316===2))&&(((_tmp317=_tmp315[0]),(_tmp317==="pattern"))&&((_tmp317,true,(_tmp318=_tmp315[1]),(_tmp318 instanceof Array))&&((_tmp318["#"]===undefined)&&(((_tmp319=_tmp318.length),(_tmp319===3))&&(((_tmp320=_tmp318[0]),(_tmp320==="data"))&&((_tmp320,true,(_tmp321=_tmp318[1]),(_tmp321===null))&&(_tmp321,true,(val=_tmp318[2]),true))))))))))){return ["check",["macro",make_checker(val,operator)],["ignore"]];}else{if((((_tmp312=_tmp311),(_tmp312 instanceof Array))&&((_tmp312["#"]===undefined)&&(((_tmp313=_tmp312.length),(_tmp313===2))&&((_tmp312[0],true,(_tmp314=_tmp312[1]),(_tmp314===null))&&(_tmp314,true)))))){return operator;}else{if(((other=_tmp311),true)){return ["send",operator,expr];}else{throw ["Could not find a match",_tmp311];}}}};};stdenv.register_macro("==",partial_pattern("___eq"));stdenv.register_macro("!=",partial_pattern("___neq"));stdenv.register_macro("<=",partial_pattern("___leq"));stdenv.register_macro(">=",partial_pattern("___geq"));stdenv.register_macro("<",partial_pattern("___lt"));stdenv.register_macro(">",partial_pattern("___gt"));stdenv.register_macro("*",function(env,context,expr){var _tmp322=[context,expr];var other;var _tmp323;var _tmp324;var _tmp325;var _tmp326;var _tmp327;var _tmp328;var _tmp330;var _tmp329;var _tmp331;var _tmp332;var _tmp333;var val;var _tmp334;var _tmp335;var _tmp336;var _tmp337;var _tmp338;if((((_tmp335=_tmp322),(_tmp335 instanceof Array))&&((_tmp335["#"]===undefined)&&(((_tmp336=_tmp335.length),(_tmp336===2))&&(((_tmp337=_tmp335[0]),(_tmp337==="pattern"))&&((_tmp337,true,(_tmp338=_tmp335[1]),(_tmp338===null))&&(_tmp338,true))))))){return ["dynsplice",["ignore"]];}else{if((((_tmp326=_tmp322),(_tmp326 instanceof Array))&&((_tmp326["#"]===undefined)&&(((_tmp327=_tmp326.length),(_tmp327===2))&&(((_tmp328=_tmp326[0]),((((_tmp329=_tmp328),(_tmp329==="pattern"))&&(_tmp329,true))||(((_tmp330=_tmp328),(_tmp330==="data"))&&(_tmp330,true))))&&(((_tmp331=_tmp326[1]),(_tmp331 instanceof Array))&&((_tmp331["#"]===undefined)&&(((_tmp332=_tmp331.length),(_tmp332===3))&&(((_tmp333=_tmp331[0]),(_tmp333==="data"))&&((_tmp333,true,(val=_tmp331[1]),true,(_tmp334=_tmp331[2]),(_tmp334===null))&&(_tmp334,true))))))))))){return ["dynsplice",val];}else{if((((_tmp323=_tmp322),(_tmp323 instanceof Array))&&((_tmp323["#"]===undefined)&&(((_tmp324=_tmp323.length),(_tmp324===2))&&((_tmp323[0],true,(_tmp325=_tmp323[1]),(_tmp325===null))&&(_tmp325,true)))))){return "___times";}else{if(((other=_tmp322),true)){return ["send","___times",expr];}else{throw ["Could not find a match",_tmp322];}}}}});stdenv.register_macro(".",function(env,context,expr){var _tmp339=expr;var other;var _tmp340;var _tmp341;var _tmp342;var _tmp343;var _tmp344;var s;if((((_tmp340=_tmp339),(_tmp340 instanceof Array))&&((_tmp340["#"]===undefined)&&(((_tmp341=_tmp340.length),(_tmp341===3))&&(((_tmp342=_tmp340[0]),(_tmp342==="data"))&&((_tmp342,true,(_tmp343=_tmp340[1]),(_tmp343===null))&&((_tmp343,true,(_tmp344=_tmp340[2]),(typeof(_tmp344)==="string"))&&((s=_tmp344),true)))))))){return ["value",s];}else{if(((other=_tmp339),true)){throw ["invalid",expr];}else{throw ["Could not find a match",_tmp339];}}});stdenv.register_macro("where",function(env,context,_tmp345){var _tmp346;var _tmp347;var _tmp348;var a;var b;if((((_tmp346=_tmp345),(_tmp346 instanceof Array))&&((_tmp346["#"]===undefined)&&(((_tmp347=_tmp346.length),(_tmp347===3))&&(((_tmp348=_tmp346[0]),(_tmp348==="data"))&&(_tmp348,true,(a=_tmp346[1]),true,(b=_tmp346[2]),true)))))){false;}else{throw "a condition failed";}return ["send","let",["data",["code",b],["code",a]]];});stdenv.register_macro("let",function(env,context,_tmp349){var _tmp350;var _tmp351;var _tmp352;var _tmp353;var _tmp354;var _tmp355;var a;var _tmp356;var _tmp357;var _tmp358;var b;if((((_tmp350=_tmp349),(_tmp350 instanceof Array))&&((_tmp350["#"]===undefined)&&(((_tmp351=_tmp350.length),(_tmp351===3))&&(((_tmp352=_tmp350[0]),(_tmp352==="data"))&&((_tmp352,true,(_tmp353=_tmp350[1]),(_tmp353 instanceof Array))&&((_tmp353["#"]===undefined)&&(((_tmp354=_tmp353.length),(_tmp354===2))&&(((_tmp355=_tmp353[0]),(_tmp355==="code"))&&((_tmp355,true,(a=_tmp353[1]),true,(_tmp356=_tmp350[2]),(_tmp356 instanceof Array))&&((_tmp356["#"]===undefined)&&(((_tmp357=_tmp356.length),(_tmp357===2))&&(((_tmp358=_tmp356[0]),(_tmp358==="code"))&&(_tmp358,true,(b=_tmp356[1]),true)))))))))))))){false;}else{throw "a condition failed";}var bindings=aslist(a);var body=aslist(b);return ["multi"].concat(bindings).concat(body);});stdenv.register_macro("->",function(env,context,_tmp359){var _tmp360;var _tmp361;var _tmp362;var args;var stmts;if((((_tmp360=_tmp359),(_tmp360 instanceof Array))&&((_tmp360["#"]===undefined)&&(((_tmp361=_tmp360.length),(_tmp361===3))&&(((_tmp362=_tmp360[0]),(_tmp362==="data"))&&(_tmp362,true,(args=_tmp360[1]),true,(stmts=_tmp360[2]),true)))))){false;}else{throw "a condition failed";}var body=["multi"];(args=args.slice(1).map(function(x){var _tmp363=x;var other;var _tmp364;if((((_tmp364=_tmp363),(typeof(_tmp364)==="string"))&&(_tmp364,true))){return x;}else{if(((other=_tmp363),true)){var t=gensym();body.push(["send","=",["data",x,t]]);return t;}else{throw ["Could not find a match",_tmp363];}}}));body.push(stmts);return ["lambda",args,body];});stdenv.register_macro("=>",function(env,context,_tmp365){var _tmp366;var _tmp367;var _tmp368;var binding;var value;if((((_tmp366=_tmp365),(_tmp366 instanceof Array))&&((_tmp366["#"]===undefined)&&(((_tmp367=_tmp366.length),(_tmp367===3))&&(((_tmp368=_tmp366[0]),(_tmp368==="data"))&&(_tmp368,true,(binding=_tmp366[1]),true,(value=_tmp366[2]),true)))))){false;}else{throw "a condition failed";}if((context==="data")){return ["assoc",binding,value];}else{if(true){throw (("Illegal context for '=>' ("+context)+")");}else{return false;}}});stdenv.register_macro("=",function(env,context,expr){var _tmp369=[context,expr];var other;var _tmp370;var _tmp371;var _tmp372;var _tmp373;var _tmp374;var _tmp375;var binding;var value;var _tmp376;var _tmp377;var _tmp378;var _tmp379;var _tmp380;var _tmp381;var _tmp382;var _tmp383;var _tmp384;var f;var _tmp385;var _tmp386;var _tmp387;var args;var value;var _tmp388;var _tmp389;var _tmp390;var _tmp391;var _tmp392;var _tmp393;var _tmp394;var _tmp395;var _tmp396;var _tmp397;var lhs;var rhs;if((((_tmp392=_tmp369),(_tmp392 instanceof Array))&&((_tmp392["#"]===undefined)&&(((_tmp393=_tmp392.length),(_tmp393===2))&&(((_tmp394=_tmp392[0]),(_tmp394==="multi"))&&((_tmp394,true,(_tmp395=_tmp392[1]),(_tmp395 instanceof Array))&&((_tmp395["#"]===undefined)&&(((_tmp396=_tmp395.length),(_tmp396===3))&&(((_tmp397=_tmp395[0]),(_tmp397==="data"))&&(_tmp397,true,(lhs=_tmp395[1]),true,(rhs=_tmp395[2]),true)))))))))){var p=parse_lhs(env,lhs,rhs);var vars=make_declarations(p[0]);var r=["splice"].concat(vars);var clauses=p[1];var mkif=function(x){return ["if",x,["value",false],["js_throw",["value","a condition failed"]]];};if((clauses.length===1)){var clause=clauses[0];var last=___lib.send(clause,(clause.length-1));var _tmp398=last;var other;var _tmp399;var _tmp400;var _tmp401;var _tmp402;if((((_tmp399=_tmp398),(_tmp399 instanceof Array))&&((_tmp399["#"]===undefined)&&(((_tmp400=_tmp399.length),(_tmp400===2))&&(((_tmp401=_tmp399[0]),(_tmp401==="value"))&&((_tmp401,true,(_tmp402=_tmp399[1]),(_tmp402===true))&&(_tmp402,true))))))){if(((vars.length===1)&&(clause.length===3))){(r=["declare"].concat(clause[1].slice(1)));}else{if(true){(r=r.concat(clause.slice(1,(-1))));}else{false;}}}else{if(((other=_tmp398),true)){r.push(mkif(clause));}else{throw ["Could not find a match",_tmp398];}}}else{if(true){var ands=make_pattern_test(clauses);r.push(mkif(ands));}else{false;}}return r;}else{if((((_tmp388=_tmp369),(_tmp388 instanceof Array))&&((_tmp388["#"]===undefined)&&(((_tmp389=_tmp388.length),(_tmp389===2))&&(((_tmp390=_tmp388[0]),(_tmp390==="data"))&&((_tmp390,true,(_tmp391=_tmp388[1]),(_tmp391===null))&&(_tmp391,true))))))){return ["assoc"];}else{if((((_tmp376=_tmp369),(_tmp376 instanceof Array))&&((_tmp376["#"]===undefined)&&(((_tmp377=_tmp376.length),(_tmp377===2))&&(((_tmp378=_tmp376[0]),(_tmp378==="data"))&&((_tmp378,true,(_tmp379=_tmp376[1]),(_tmp379 instanceof Array))&&((_tmp379["#"]===undefined)&&(((_tmp380=_tmp379.length),(_tmp380===3))&&(((_tmp381=_tmp379[0]),(_tmp381==="data"))&&((_tmp381,true,(_tmp382=_tmp379[1]),(_tmp382 instanceof Array))&&((_tmp382["#"]===undefined)&&(((_tmp383=_tmp382.length),(_tmp383===3))&&(((_tmp384=_tmp382[0]),(_tmp384==="send"))&&((_tmp384,true,(f=_tmp382[1]),true,(_tmp385=_tmp382[2]),(_tmp385 instanceof Array))&&((_tmp385["#"]===undefined)&&(((_tmp386=_tmp385.length),(_tmp386>=1))&&(((_tmp387=_tmp385[0]),(_tmp387==="data"))&&(_tmp387,true,(args=_tmp385.slice(1)),true,(value=_tmp379[2]),true)))))))))))))))))){return ["assoc",["value",f],["lambda",args,value]];}else{if((((_tmp370=_tmp369),(_tmp370 instanceof Array))&&((_tmp370["#"]===undefined)&&(((_tmp371=_tmp370.length),(_tmp371===2))&&(((_tmp372=_tmp370[0]),(_tmp372==="data"))&&((_tmp372,true,(_tmp373=_tmp370[1]),(_tmp373 instanceof Array))&&((_tmp373["#"]===undefined)&&(((_tmp374=_tmp373.length),(_tmp374===3))&&(((_tmp375=_tmp373[0]),(_tmp375==="data"))&&(_tmp375,true,(binding=_tmp373[1]),true,(value=_tmp373[2]),true)))))))))){return ["assoc",["value",binding],value];}else{if(((other=_tmp369),true)){throw (("Illegal context for '=' ("+context)+")");}else{throw ["Could not find a match",_tmp369];}}}}}});var make_assigner=function(op){return function(env,context,_tmp403){var _tmp404;var _tmp405;var _tmp406;var a;var b;if((((_tmp404=_tmp403),(_tmp404 instanceof Array))&&((_tmp404["#"]===undefined)&&(((_tmp405=_tmp404.length),(_tmp405===3))&&(((_tmp406=_tmp404[0]),(_tmp406==="data"))&&(_tmp406,true,(a=_tmp404[1]),true,(b=_tmp404[2]),true)))))){false;}else{throw "a condition failed";}return ["assign",a,["send",op,["data",a,b]]];};};stdenv.register_macro(":=",function(env,context,_tmp407){var _tmp408;var _tmp409;var _tmp410;var a;var b;if((((_tmp408=_tmp407),(_tmp408 instanceof Array))&&((_tmp408["#"]===undefined)&&(((_tmp409=_tmp408.length),(_tmp409===3))&&(((_tmp410=_tmp408[0]),(_tmp410==="data"))&&(_tmp410,true,(a=_tmp408[1]),true,(b=_tmp408[2]),true)))))){false;}else{throw "a condition failed";}return ["assign",a,b];});stdenv.register_macro("+=",make_assigner("+"));stdenv.register_macro("-=",make_assigner("-"));stdenv.register_macro("*=",make_assigner("*"));stdenv.register_macro("/=",make_assigner("/"));stdenv.register_macro("<<=",make_assigner("<<"));stdenv.register_macro(">>=",make_assigner(">>"));stdenv.register_macro(">>>=",make_assigner(">>>"));stdenv.register_macro("if",function(env,context,_tmp411){var _tmp412;var _tmp413;var _tmp414;var test;var a;var b;if((((_tmp412=_tmp411),(_tmp412 instanceof Array))&&((_tmp412["#"]===undefined)&&(((_tmp413=_tmp412.length),(_tmp413===4))&&(((_tmp414=_tmp412[0]),(_tmp414==="data"))&&(_tmp414,true,(test=_tmp412[1]),true,(a=_tmp412[2]),true,(b=_tmp412[3]),true)))))){false;}else{throw "a condition failed";}return ["if",test,a,b];});stdenv.register_macro("cond",function(env,context,_tmp415){var _tmp416;var _tmp417;var _tmp418;var _tmp419;var _tmp420;var _tmp421;var clauses;if((((_tmp416=_tmp415),(_tmp416 instanceof Array))&&((_tmp416["#"]===undefined)&&(((_tmp417=_tmp416.length),(_tmp417===2))&&(((_tmp418=_tmp416[0]),(_tmp418==="data"))&&((_tmp418,true,(_tmp419=_tmp416[1]),(_tmp419 instanceof Array))&&((_tmp419["#"]===undefined)&&(((_tmp420=_tmp419.length),(_tmp420===2))&&(((_tmp421=_tmp419[0]),(_tmp421==="code"))&&(_tmp421,true,(clauses=_tmp419[1]),true)))))))))){false;}else{throw "a condition failed";}var handle=function(xs){if((xs.length===0)){return ["value",false];}else{if(true){var _tmp422;var _tmp423;var _tmp424;var _tmp425;var _tmp426;var _tmp427;var _tmp428;var _tmp429;var _tmp430;var test;var body;var rest;if((((_tmp422=xs),(_tmp422 instanceof Array))&&((_tmp422["#"]===undefined)&&(((_tmp423=_tmp422.length),(_tmp423>=1))&&(((_tmp424=_tmp422[0]),(_tmp424 instanceof Array))&&((_tmp424["#"]===undefined)&&(((_tmp425=_tmp424.length),(_tmp425===3))&&(((_tmp426=_tmp424[0]),(_tmp426==="send"))&&((_tmp426,true,(_tmp427=_tmp424[1]),(_tmp427==="=>"))&&((_tmp427,true,(_tmp428=_tmp424[2]),(_tmp428 instanceof Array))&&((_tmp428["#"]===undefined)&&(((_tmp429=_tmp428.length),(_tmp429===3))&&(((_tmp430=_tmp428[0]),(_tmp430==="data"))&&(_tmp430,true,(test=_tmp428[1]),true,(body=_tmp428[2]),true,(rest=_tmp422.slice(1)),true)))))))))))))){false;}else{throw "a condition failed";}(test=function(){var _tmp431=test;var _tmp432;if((((_tmp432=_tmp431),(_tmp432==="else"))&&(_tmp432,true))){return ["value",true];}else{if((_tmp431,true)){return test;}else{throw ["Could not find a match",_tmp431];}}}());return ["if",test,body,handle(rest)];}else{return false;}}};return handle(aslist(clauses));});stdenv.register_macro("while",function(env,context,expr){var _tmp433;var _tmp434;var _tmp435;var _tmp436;var _tmp437;var _tmp438;var test;var _tmp439;var _tmp440;var _tmp441;var body;if((((_tmp433=expr),(_tmp433 instanceof Array))&&((_tmp433["#"]===undefined)&&(((_tmp434=_tmp433.length),(_tmp434===3))&&(((_tmp435=_tmp433[0]),(_tmp435==="data"))&&((_tmp435,true,(_tmp436=_tmp433[1]),(_tmp436 instanceof Array))&&((_tmp436["#"]===undefined)&&(((_tmp437=_tmp436.length),(_tmp437===2))&&(((_tmp438=_tmp436[0]),(_tmp438==="code"))&&((_tmp438,true,(test=_tmp436[1]),true,(_tmp439=_tmp433[2]),(_tmp439 instanceof Array))&&((_tmp439["#"]===undefined)&&(((_tmp440=_tmp439.length),(_tmp440===2))&&(((_tmp441=_tmp439[0]),(_tmp441==="code"))&&(_tmp441,true,(body=_tmp439[1]),true)))))))))))))){false;}else{throw "a condition failed";}return ["js_while",test,body];});stdenv.register_macro("for",function(env,context,expr){var _tmp442;var _tmp443;var _tmp444;var _tmp445;var _tmp446;var _tmp447;var _tmp448;var _tmp449;var _tmp450;var a;var b;var c;var _tmp451;var _tmp452;var _tmp453;var body;if((((_tmp442=expr),(_tmp442 instanceof Array))&&((_tmp442["#"]===undefined)&&(((_tmp443=_tmp442.length),(_tmp443===3))&&(((_tmp444=_tmp442[0]),(_tmp444==="data"))&&((_tmp444,true,(_tmp445=_tmp442[1]),(_tmp445 instanceof Array))&&((_tmp445["#"]===undefined)&&(((_tmp446=_tmp445.length),(_tmp446===2))&&(((_tmp447=_tmp445[0]),(_tmp447==="code"))&&((_tmp447,true,(_tmp448=_tmp445[1]),(_tmp448 instanceof Array))&&((_tmp448["#"]===undefined)&&(((_tmp449=_tmp448.length),(_tmp449===4))&&(((_tmp450=_tmp448[0]),(_tmp450==="multi"))&&((_tmp450,true,(a=_tmp448[1]),true,(b=_tmp448[2]),true,(c=_tmp448[3]),true,(_tmp451=_tmp442[2]),(_tmp451 instanceof Array))&&((_tmp451["#"]===undefined)&&(((_tmp452=_tmp451.length),(_tmp452===2))&&(((_tmp453=_tmp451[0]),(_tmp453==="code"))&&(_tmp453,true,(body=_tmp451[1]),true)))))))))))))))))){false;}else{throw "a condition failed";}return ["js_for",a,b,c,body];});stdenv.register_macro("return",function(env,context,expr){return ["js_return",expr];});stdenv.register_macro("throw",function(env,context,expr){return ["js_throw",expr];});stdenv.register_macro("break",function(env,context,expr){return ["js_break"];});stdenv.register_macro("continue",function(env,context,expr){return ["js_continue"];});var rx_wrap=function(x){return (("(?:"+x)+")");};var rx_quote=function(x){return x.replace(RegExp("([.?*+\\^$\\[\\]\\(\\)\\{\\}|\\\\])","g"),"\\$1");};var rx_quote2=function(x){return x.replace(RegExp("([\\[\\]\\(\\)\\{\\}\\^])","g"),"\\$1");};var rx_build=function(expr){var _tmp454=expr;var otherA;var _tmp455;var _tmp456;var _tmp457;var args;var _tmp458;var _tmp459;var _tmp460;var args;var _tmp461;var _tmp462;var _tmp463;var _tmp464;var _tmp465;var _tmp466;var _tmp467;var _tmp468;var b;var _tmp469;var _tmp470;var _tmp471;var _tmp472;var _tmp473;var _tmp474;var _tmp475;var _tmp476;var b;var _tmp477;var _tmp478;var _tmp479;var _tmp480;var _tmp481;var _tmp482;var _tmp483;var a;var _tmp484;var _tmp485;var _tmp486;var _tmp487;var _tmp488;var _tmp489;var _tmp490;var _tmp491;var a;var _tmp492;var _tmp493;var _tmp494;var _tmp495;var _tmp496;var _tmp497;var _tmp498;var _tmp499;var a;var _tmp500;var _tmp501;var _tmp502;var _tmp503;var _tmp504;var _tmp505;var _tmp506;var _tmp507;var a;var b;var _tmp508;var _tmp509;var _tmp510;var _tmp511;var _tmp512;var _tmp513;var _tmp514;var a;var b;var _tmp515;var _tmp516;var _tmp517;var x;var _tmp518;var _tmp519;var _tmp520;var _tmp521;var _tmp522;var _tmp523;var _tmp524;var _tmp525;var _tmp526;var _tmp527;var _tmp528;var _tmp529;var _tmp530;if((((_tmp530=_tmp454),(_tmp530==="any"))&&(_tmp530,true))){return ".";}else{if((((_tmp529=_tmp454),(_tmp529==="start"))&&(_tmp529,true))){return "^";}else{if((((_tmp528=_tmp454),(_tmp528==="end"))&&(_tmp528,true))){return "$";}else{if((((_tmp527=_tmp454),(_tmp527==="alpha"))&&(_tmp527,true))){return "\\a";}else{if((((_tmp526=_tmp454),(_tmp526==="digit"))&&(_tmp526,true))){return "\\d";}else{if((((_tmp525=_tmp454),(_tmp525==="word"))&&(_tmp525,true))){return "\\w";}else{if((((_tmp524=_tmp454),(_tmp524==="space"))&&(_tmp524,true))){return "\\s";}else{if((((_tmp523=_tmp454),(_tmp523==="boundary"))&&(_tmp523,true))){return "\\b";}else{if((((_tmp522=_tmp454),(_tmp522==="a"))&&(_tmp522,true))){return "\\a";}else{if((((_tmp521=_tmp454),(_tmp521==="d"))&&(_tmp521,true))){return "\\d";}else{if((((_tmp520=_tmp454),(_tmp520==="w"))&&(_tmp520,true))){return "\\w";}else{if((((_tmp519=_tmp454),(_tmp519==="s"))&&(_tmp519,true))){return "\\s";}else{if((((_tmp518=_tmp454),(_tmp518==="b"))&&(_tmp518,true))){return "\\b";}else{if((((_tmp515=_tmp454),(_tmp515 instanceof Array))&&((_tmp515["#"]===undefined)&&(((_tmp516=_tmp515.length),(_tmp516===2))&&(((_tmp517=_tmp515[0]),(_tmp517==="value"))&&(_tmp517,true,(x=_tmp515[1]),true)))))){return rx_quote(x);}else{if((((_tmp508=_tmp454),(_tmp508 instanceof Array))&&((_tmp508["#"]===undefined)&&(((_tmp509=_tmp508.length),(_tmp509===3))&&(((_tmp510=_tmp508[0]),(_tmp510==="send"))&&((_tmp510,true,(_tmp511=_tmp508[1]),(_tmp511==="||"))&&((_tmp511,true,(_tmp512=_tmp508[2]),(_tmp512 instanceof Array))&&((_tmp512["#"]===undefined)&&(((_tmp513=_tmp512.length),(_tmp513===3))&&(((_tmp514=_tmp512[0]),(_tmp514==="data"))&&(_tmp514,true,(a=_tmp512[1]),true,(b=_tmp512[2]),true))))))))))){return rx_wrap(((rx_build(a)+"|")+rx_build(b)));}else{if((((_tmp501=_tmp454),(_tmp501 instanceof Array))&&((_tmp501["#"]===undefined)&&(((_tmp502=_tmp501.length),(_tmp502===3))&&(((_tmp503=_tmp501[0]),(_tmp503==="send"))&&((_tmp503,true,(_tmp504=_tmp501[1]),(_tmp504==="or"))&&((_tmp504,true,(_tmp505=_tmp501[2]),(_tmp505 instanceof Array))&&((_tmp505["#"]===undefined)&&(((_tmp506=_tmp505.length),(_tmp506===3))&&(((_tmp507=_tmp505[0]),(_tmp507==="data"))&&(_tmp507,true,(a=_tmp505[1]),true,(b=_tmp505[2]),true))))))))))){return rx_wrap(((rx_build(a)+"|")+rx_build(b)));}else{if((((_tmp493=_tmp454),(_tmp493 instanceof Array))&&((_tmp493["#"]===undefined)&&(((_tmp494=_tmp493.length),(_tmp494===3))&&(((_tmp495=_tmp493[0]),(_tmp495==="send"))&&((_tmp495,true,(_tmp496=_tmp493[1]),(_tmp496==="*"))&&((_tmp496,true,(_tmp497=_tmp493[2]),(_tmp497 instanceof Array))&&((_tmp497["#"]===undefined)&&(((_tmp498=_tmp497.length),(_tmp498===3))&&(((_tmp499=_tmp497[0]),(_tmp499==="data"))&&((_tmp499,true,(a=_tmp497[1]),true,(_tmp500=_tmp497[2]),(_tmp500===null))&&(_tmp500,true)))))))))))){return rx_wrap((rx_build(a)+"*"));}else{if((((_tmp485=_tmp454),(_tmp485 instanceof Array))&&((_tmp485["#"]===undefined)&&(((_tmp486=_tmp485.length),(_tmp486===3))&&(((_tmp487=_tmp485[0]),(_tmp487==="send"))&&((_tmp487,true,(_tmp488=_tmp485[1]),(_tmp488==="+"))&&((_tmp488,true,(_tmp489=_tmp485[2]),(_tmp489 instanceof Array))&&((_tmp489["#"]===undefined)&&(((_tmp490=_tmp489.length),(_tmp490===3))&&(((_tmp491=_tmp489[0]),(_tmp491==="data"))&&((_tmp491,true,(a=_tmp489[1]),true,(_tmp492=_tmp489[2]),(_tmp492===null))&&(_tmp492,true)))))))))))){return rx_wrap((rx_build(a)+"+"));}else{if((((_tmp477=_tmp454),(_tmp477 instanceof Array))&&((_tmp477["#"]===undefined)&&(((_tmp478=_tmp477.length),(_tmp478===3))&&(((_tmp479=_tmp477[0]),(_tmp479==="send"))&&((_tmp479,true,(_tmp480=_tmp477[1]),(_tmp480==="?"))&&((_tmp480,true,(_tmp481=_tmp477[2]),(_tmp481 instanceof Array))&&((_tmp481["#"]===undefined)&&(((_tmp482=_tmp481.length),(_tmp482===3))&&(((_tmp483=_tmp481[0]),(_tmp483==="data"))&&((_tmp483,true,(a=_tmp481[1]),true,(_tmp484=_tmp481[2]),(_tmp484===null))&&(_tmp484,true)))))))))))){return rx_wrap((rx_build(a)+"?"));}else{if((((_tmp469=_tmp454),(_tmp469 instanceof Array))&&((_tmp469["#"]===undefined)&&(((_tmp470=_tmp469.length),(_tmp470===3))&&(((_tmp471=_tmp469[0]),(_tmp471==="send"))&&((_tmp471,true,(_tmp472=_tmp469[1]),(_tmp472===">>"))&&((_tmp472,true,(_tmp473=_tmp469[2]),(_tmp473 instanceof Array))&&((_tmp473["#"]===undefined)&&(((_tmp474=_tmp473.length),(_tmp474===3))&&(((_tmp475=_tmp473[0]),(_tmp475==="data"))&&((_tmp475,true,(_tmp476=_tmp473[1]),(_tmp476===null))&&(_tmp476,true,(b=_tmp473[2]),true)))))))))))){var x=rx_quote2(b[1]);return (("["+x)+"]");}else{if((((_tmp461=_tmp454),(_tmp461 instanceof Array))&&((_tmp461["#"]===undefined)&&(((_tmp462=_tmp461.length),(_tmp462===3))&&(((_tmp463=_tmp461[0]),(_tmp463==="send"))&&((_tmp463,true,(_tmp464=_tmp461[1]),(_tmp464===">>!"))&&((_tmp464,true,(_tmp465=_tmp461[2]),(_tmp465 instanceof Array))&&((_tmp465["#"]===undefined)&&(((_tmp466=_tmp465.length),(_tmp466===3))&&(((_tmp467=_tmp465[0]),(_tmp467==="data"))&&((_tmp467,true,(_tmp468=_tmp465[1]),(_tmp468===null))&&(_tmp468,true,(b=_tmp465[2]),true)))))))))))){var x=rx_quote2(b[1]);return (("[^"+x)+"]");}else{if((((_tmp458=_tmp454),(_tmp458 instanceof Array))&&((_tmp458["#"]===undefined)&&(((_tmp459=_tmp458.length),(_tmp459>=1))&&(((_tmp460=_tmp458[0]),(_tmp460==="data"))&&(_tmp460,true,(args=_tmp458.slice(1)),true)))))){return (("("+args.map(rx_build).join(""))+")");}else{if((((_tmp455=_tmp454),(_tmp455 instanceof Array))&&((_tmp455["#"]===undefined)&&(((_tmp456=_tmp455.length),(_tmp456>=1))&&(((_tmp457=_tmp455[0]),(_tmp457==="multi"))&&(_tmp457,true,(args=_tmp455.slice(1)),true)))))){return (("(?:"+args.map(rx_build).join(""))+")");}else{if(((otherA=_tmp454),true)){throw "OopsF";}else{throw ["Could not find a match",_tmp454];}}}}}}}}}}}}}}}}}}}}}}}}};stdenv.register_macro("Rx",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)]]];});stdenv.register_macro("Rxg",function(env,context,expr){return ["send","RegExp",["array",["value",rx_build(expr)],["value","g"]]];});stdenv.register_macro("?",function(env,context,_tmp531){var _tmp532;var _tmp533;var _tmp534;var expr;var _tmp535;if((((_tmp532=_tmp531),(_tmp532 instanceof Array))&&((_tmp532["#"]===undefined)&&(((_tmp533=_tmp532.length),(_tmp533===3))&&(((_tmp534=_tmp532[0]),(_tmp534==="data"))&&((_tmp534,true,(expr=_tmp532[1]),true,(_tmp535=_tmp532[2]),(_tmp535===null))&&(_tmp535,true))))))){false;}else{throw "a condition failed";}var orig_expr=expr;var checker=function(){var _tmp536=expr;var other;var _tmp537;var _tmp538;var _tmp539;var _tmp540;var _tmp541;var _tmp542;var _tmp543;if((((_tmp543=_tmp536),(_tmp543===null))&&(_tmp543,true))){throw "can't use ? on its own";}else{if((((_tmp542=_tmp536),(_tmp542==="String"))&&(_tmp542,true))){var f=function(env,context,_tmp544){var _tmp545;var _tmp546;var _tmp547;var expr;if((((_tmp545=_tmp544),(_tmp545 instanceof Array))&&((_tmp545["#"]===undefined)&&(((_tmp546=_tmp545.length),(_tmp546===2))&&(((_tmp547=_tmp545[0]),(_tmp547==="data"))&&(_tmp547,true,(expr=_tmp545[1]),true)))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","string"]]];};return ["macro",f];}else{if((((_tmp541=_tmp536),(_tmp541==="Number"))&&(_tmp541,true))){var f=function(env,context,_tmp548){var _tmp549;var _tmp550;var _tmp551;var expr;if((((_tmp549=_tmp548),(_tmp549 instanceof Array))&&((_tmp549["#"]===undefined)&&(((_tmp550=_tmp549.length),(_tmp550===2))&&(((_tmp551=_tmp549[0]),(_tmp551==="data"))&&(_tmp551,true,(expr=_tmp549[1]),true)))))){false;}else{throw "a condition failed";}return ["send","___eq",["data",["send","typeof",["data",expr]],["value","number"]]];};return ["macro",f];}else{if((((_tmp540=_tmp536),(_tmp540==="true"))&&(_tmp540,true))){return ["macro",make_checker(["value",true],"___is")];}else{if((((_tmp539=_tmp536),(_tmp539==="false"))&&(_tmp539,true))){return ["macro",make_checker(["value",false],"___is")];}else{if((((_tmp538=_tmp536),(_tmp538==="null"))&&(_tmp538,true))){return ["macro",make_checker(["value",null],"___is")];}else{if((((_tmp537=_tmp536),(_tmp537==="undefined"))&&(_tmp537,true))){return ["macro",make_checker(["value",undefined],"___is")];}else{if(((other=_tmp536),true)){return ["send",["send","___lib",["value","checker"]],["data",expr]];}else{throw ["Could not find a match",_tmp536];}}}}}}}}}();var mac=function(env,context,expr){var _tmp552=context;var other;var _tmp553;if((((_tmp553=_tmp552),(_tmp553==="pattern"))&&(_tmp553,true))){var _tmp554=expr;var other;var _tmp555;var _tmp556;var _tmp557;var subp;if((((_tmp555=_tmp554),(_tmp555 instanceof Array))&&((_tmp555["#"]===undefined)&&(((_tmp556=_tmp555.length),(_tmp556>=1))&&(((_tmp557=_tmp555[0]),(_tmp557==="data"))&&(_tmp557,true,(subp=_tmp555.slice(1)),true)))))){var projector=["send",["send","___lib",["value","deconstructor"]],["data",orig_expr]];return ["check",checker,["project",projector,expr]];}else{if(((other=_tmp554),true)){return ["check",checker,(expr||["ignore"])];}else{throw ["Could not find a match",_tmp554];}}}else{if(((other=_tmp552),true)){return ["send",checker,["data",expr]];}else{throw ["Could not find a match",_tmp552];}}};return ["macro",mac];});stdenv.register_macro("!",function(env,context,_tmp558){var _tmp559;var _tmp560;var _tmp561;var expr;var _tmp562;if((((_tmp559=_tmp558),(_tmp559 instanceof Array))&&((_tmp559["#"]===undefined)&&(((_tmp560=_tmp559.length),(_tmp560===3))&&(((_tmp561=_tmp559[0]),(_tmp561==="data"))&&((_tmp561,true,(expr=_tmp559[1]),true,(_tmp562=_tmp559[2]),(_tmp562===null))&&(_tmp562,true))))))){false;}else{throw "a condition failed";}var projector=function(){var _tmp563=expr;var other;var _tmp564;var _tmp565;var _tmp566;if((((_tmp566=_tmp563),(_tmp566===null))&&(_tmp566,true))){throw "can't use ! on its own";}else{if((((_tmp565=_tmp563),(_tmp565==="String"))&&(_tmp565,true))){var f=function(env,context,_tmp567){var _tmp568;var _tmp569;var _tmp570;var expr;if((((_tmp568=_tmp567),(_tmp568 instanceof Array))&&((_tmp568["#"]===undefined)&&(((_tmp569=_tmp568.length),(_tmp569===2))&&(((_tmp570=_tmp568[0]),(_tmp570==="data"))&&(_tmp570,true,(expr=_tmp568[1]),true)))))){false;}else{throw "a condition failed";}return ["data",["value",true],["send","String",["data",expr]]];};return ["macro",f];}else{if((((_tmp564=_tmp563),(_tmp564==="Number"))&&(_tmp564,true))){var f=function(env,context,_tmp571){var _tmp572;var _tmp573;var _tmp574;var expr;if((((_tmp572=_tmp571),(_tmp572 instanceof Array))&&((_tmp572["#"]===undefined)&&(((_tmp573=_tmp572.length),(_tmp573===2))&&(((_tmp574=_tmp572[0]),(_tmp574==="data"))&&(_tmp574,true,(expr=_tmp572[1]),true)))))){false;}else{throw "a condition failed";}return ["data",["value",true],["send","parseFloat",["data",expr]]];};return ["macro",f];}else{if(((other=_tmp563),true)){return ["send",["send","___lib",["value","projector"]],["data",expr]];}else{throw ["Could not find a match",_tmp563];}}}}}();var mac=function(env,context,expr){var _tmp575=context;var other;var _tmp576;if((((_tmp576=_tmp575),(_tmp576==="pattern"))&&(_tmp576,true))){return ["project",projector,(expr||["ignore"])];}else{if(((other=_tmp575),true)){return ["send",projector,["data",expr]];}else{throw ["Could not find a match",_tmp575];}}};return ["macro",mac];});var tempnum=0;var gensym=function(){var name=("_tmp"+tempnum);(tempnum=(tempnum+1));return name;};var parse_lhs=function(env,lhs,rhs){var vars=[];var clauses=[];var current=["multi"];var mktemp=function(){var t=gensym();vars.push(t);return t;};var newclause=function(){if((current.length>1)){clauses.push(current);}else{false;}return (current=["multi"]);};var helper=function(lhs,curr){return helper_noexpand(expand.step(env,"pattern",lhs),curr);};var helper_noexpand=function(lhs,curr){var _tmp577=lhs;var other;var _tmp578;var _tmp579;var _tmp580;var specs;var _tmp581;var _tmp582;var _tmp583;var fname;var spec;var _tmp584;var _tmp585;var _tmp586;var projector;var expr;var _tmp587;var _tmp588;var _tmp589;var checker;var expr;var _tmp590;var _tmp591;var _tmp592;var xs;var _tmp593;var _tmp594;var _tmp595;var xs;var _tmp596;var _tmp597;var _tmp598;var condition;var pattern;var _tmp599;var _tmp600;var _tmp601;var v;var _tmp602;var _tmp603;var _tmp605;var _tmp606;var _tmp607;var _tmp604;var _tmp608;if((((_tmp608=_tmp577),(_tmp608===null))&&(_tmp608,true))){var x=["check",["macro",make_checker(["value",null],"___eq")],["ignore"]];return helper_noexpand(x,curr);}else{if(((_tmp603=_tmp577),((((_tmp604=_tmp603),(_tmp604==="_"))&&(_tmp604,true))||(((_tmp605=_tmp603),(_tmp605 instanceof Array))&&((_tmp605["#"]===undefined)&&(((_tmp606=_tmp605.length),(_tmp606===1))&&(((_tmp607=_tmp605[0]),(_tmp607==="ignore"))&&(_tmp607,true)))))))){current.push(curr);return current.push(["value",true]);}else{if((((_tmp602=_tmp577),(typeof(_tmp602)==="string"))&&(_tmp602,true))){vars.push(lhs);current.push(["assign",lhs,curr]);return current.push(["value",true]);}else{if((((_tmp599=_tmp577),(_tmp599 instanceof Array))&&((_tmp599["#"]===undefined)&&(((_tmp600=_tmp599.length),(_tmp600===2))&&(((_tmp601=_tmp599[0]),(_tmp601==="value"))&&(_tmp601,true,(v=_tmp599[1]),true)))))){var x=["check",["macro",make_checker(lhs,"___eq")],["ignore"]];return helper_noexpand(x,curr);}else{if((((_tmp596=_tmp577),(_tmp596 instanceof Array))&&((_tmp596["#"]===undefined)&&(((_tmp597=_tmp596.length),(_tmp597===3))&&(((_tmp598=_tmp596[0]),(_tmp598==="test"))&&(_tmp598,true,(condition=_tmp596[1]),true,(pattern=_tmp596[2]),true)))))){helper(pattern,curr);current.push(condition);return newclause();}else{if((((_tmp593=_tmp577),(_tmp593 instanceof Array))&&((_tmp593["#"]===undefined)&&(((_tmp594=_tmp593.length),(_tmp594>=1))&&(((_tmp595=_tmp593[0]),(_tmp595==="all"))&&(_tmp595,true,(xs=_tmp593.slice(1)),true)))))){var temp=mktemp();(current=current.concat([["assign",temp,curr]]));return xs.forEach(function(x){return helper(x,temp);});}else{if((((_tmp590=_tmp577),(_tmp590 instanceof Array))&&((_tmp590["#"]===undefined)&&(((_tmp591=_tmp590.length),(_tmp591>=1))&&(((_tmp592=_tmp590[0]),(_tmp592==="any"))&&(_tmp592,true,(xs=_tmp590.slice(1)),true)))))){var normalize=function(vars){return vars.filter(function(x){return (x.slice(0,4)!=="_tmp");}).sort().join(",");};var temp=mktemp();(current=current.concat([["assign",temp,curr]]));var myvars=undefined;var clauses=[];xs.forEach(function(x){var p=parse_lhs(env,x,temp);if((myvars===undefined)){(myvars=p[0]);}else{if((normalize(p[0])!==normalize(myvars))){throw [["Must have the same set of variables in both branches!",myvars]];}else{if(true){(vars=vars.concat(p[0]));}else{false;}}}return clauses.push(make_pattern_test(p[1]));});current.push(make_or_pattern(clauses));(vars=vars.concat(myvars));return newclause();}else{if((((_tmp587=_tmp577),(_tmp587 instanceof Array))&&((_tmp587["#"]===undefined)&&(((_tmp588=_tmp587.length),(_tmp588===3))&&(((_tmp589=_tmp587[0]),(_tmp589==="check"))&&(_tmp589,true,(checker=_tmp587[1]),true,(expr=_tmp587[2]),true)))))){var temp=mktemp();(current=current.concat([["assign",temp,curr],["send",checker,["data",temp]]]));newclause();return helper(expr,temp);}else{if((((_tmp584=_tmp577),(_tmp584 instanceof Array))&&((_tmp584["#"]===undefined)&&(((_tmp585=_tmp584.length),(_tmp585===3))&&(((_tmp586=_tmp584[0]),(_tmp586==="project"))&&(_tmp586,true,(projector=_tmp584[1]),true,(expr=_tmp584[2]),true)))))){var temp=mktemp();var temp2=mktemp();(current=current.concat([["assign",temp,curr],["assign",temp2,["send",projector,["data",temp]]],["send",temp2,["value",0]]]));newclause();return helper(expr,["send",temp2,["value",1]]);}else{if((((_tmp581=_tmp577),(_tmp581 instanceof Array))&&((_tmp581["#"]===undefined)&&(((_tmp582=_tmp581.length),(_tmp582===3))&&(((_tmp583=_tmp581[0]),(_tmp583==="send"))&&(_tmp583,true,(fname=_tmp581[1]),true,(spec=_tmp581[2]),true)))))){return helper(fname,["send","->",["data",spec,curr]]);}else{if((((_tmp578=_tmp577),(_tmp578 instanceof Array))&&((_tmp578["#"]===undefined)&&(((_tmp579=_tmp578.length),(_tmp579>=1))&&(((_tmp580=_tmp578[0]),(_tmp580==="data"))&&(_tmp580,true,(specs=_tmp578.slice(1)),true)))))){var fw=0;var bw=0;var rest=undefined;var members=specs.map(function(x){var v=expand.step(env,"pattern",x);var _tmp609=v;var other;var _tmp610;var _tmp611;var _tmp612;var variable;if((((_tmp610=_tmp609),(_tmp610 instanceof Array))&&((_tmp610["#"]===undefined)&&(((_tmp611=_tmp610.length),(_tmp611===2))&&(((_tmp612=_tmp610[0]),(_tmp612==="dynsplice"))&&(_tmp612,true,(variable=_tmp610[1]),true)))))){(rest=variable);}else{if(((other=_tmp609),true)){if((rest===undefined)){(fw=(fw+1));}else{if(true){(bw=(bw+1));}else{false;}}}else{throw ["Could not find a match",_tmp609];}}return v;});var cmp=function(){if((rest===undefined)){return "___eq";}else{if(true){return "___gte";}else{return false;}}}();var temp=mktemp();var len=mktemp();(current=current.concat([["assign",temp,curr],["send","___instanceof",["data",temp,"Array"]]]));newclause();(current=current.concat([["send","___is",["data",["send",temp,["value","#"]],["value",undefined]]]]));newclause();(current=current.concat([["assign",len,["send",temp,["value","length"]]],["send",cmp,["data",len,["value",(fw+bw)]]]]));newclause();for(var j=0;(j<fw);(++j)){helper_noexpand(___lib.send(members,j),["send",temp,["value",j]]);}if((rest!==undefined)){var slice=function(){if((bw>0)){return ["data",["value",fw],["value",(-bw)]];}else{if(true){return ["data",["value",fw]];}else{return false;}}}();helper_noexpand(___lib.send(members,fw)[1],["send",["send",temp,["value","slice"]],slice]);}else{false;}for(var j=0;(j<bw);(++j)){helper_noexpand(___lib.send(members,((fw+j)+1)),["send",temp,["send","___minus",["data",len,["value",(bw-j)]]]]);}}else{if(((other=_tmp577),true)){throw "OopsG";}else{throw ["Could not find a match",_tmp577];}}}}}}}}}}}}};helper(lhs,rhs);if((current.length>1)){clauses.push(current);}else{false;}return [vars,clauses];};var make_declarations=function(vars){return vars.map(function(name){return ["declare",name,["value",undefined]];});};var make_pattern_test=function(clauses){var ands=clauses.pop();while((clauses.length>0)){(ands=["send","___and",["data",clauses.pop(),ands]]);}return ands;};var make_or_pattern=function(clauses){var ors=clauses.pop();while((clauses.length>0)){(ors=["send","___or",["data",clauses.pop(),ors]]);}return ors;};stdenv.register_macro("|>",function(env,context,_tmp613){var _tmp614;var _tmp615;var _tmp616;var to_match;var cl;if((((_tmp614=_tmp613),(_tmp614 instanceof Array))&&((_tmp614["#"]===undefined)&&(((_tmp615=_tmp614.length),(_tmp615===3))&&(((_tmp616=_tmp614[0]),(_tmp616==="data"))&&(_tmp616,true,(to_match=_tmp614[1]),true,(cl=_tmp614[2]),true)))))){false;}else{throw "a condition failed";}var temp=gensym();var clauses=function(){var _tmp617=cl;var other;var _tmp618;var _tmp619;var _tmp620;var cls;if((((_tmp618=_tmp617),(_tmp618 instanceof Array))&&((_tmp618["#"]===undefined)&&(((_tmp619=_tmp618.length),(_tmp619>=1))&&(((_tmp620=_tmp618[0]),(_tmp620==="multi"))&&(_tmp620,true,(cls=_tmp618.slice(1)),true)))))){return cls;}else{if(((other=_tmp617),true)){return [other];}else{throw ["Could not find a match",_tmp617];}}}();var decls=["multi",["declare",temp,to_match]];var r=["js_throw",["data",["value","Could not find a match"],temp]];while((clauses.length>0)){var _tmp621;var _tmp622;var _tmp623;var _tmp624;var _tmp625;var _tmp626;var _tmp627;var lhs;var body;if((((_tmp621=clauses.pop()),(_tmp621 instanceof Array))&&((_tmp621["#"]===undefined)&&(((_tmp622=_tmp621.length),(_tmp622===3))&&(((_tmp623=_tmp621[0]),(_tmp623==="send"))&&((_tmp623,true,(_tmp624=_tmp621[1]),(_tmp624==="->"))&&((_tmp624,true,(_tmp625=_tmp621[2]),(_tmp625 instanceof Array))&&((_tmp625["#"]===undefined)&&(((_tmp626=_tmp625.length),(_tmp626===3))&&(((_tmp627=_tmp625[0]),(_tmp627==="data"))&&(_tmp627,true,(lhs=_tmp625[1]),true,(body=_tmp625[2]),true))))))))))){false;}else{throw "a condition failed";}var p=parse_lhs(env,lhs,temp);var test=make_pattern_test(p[1]);(r=["if",test,body,r]);(decls=decls.concat(make_declarations(p[0])));}decls.push(r);return decls;});var js_op_table=({"___plus":"+","___minus":"-","___times":"*","___div":"/","___mod":"%","___binxor":"^","___binand":"&","___binor":"|","___binnot":"~","___and":"&&","___or":"||","___not":"!","___is":"===","___isnt":"!==","___eq":"===","___neq":"!==","___lt":"<","___gt":">","___lte":"<=","___gte":">=","___shl":"<<","___shr":">>","___shr2":">>>","___in":" in ","___instanceof":" instanceof ","___plusplus":"++","___minusminus":"--"});var translate=function(expr,mode){var _tmp628=expr;var other;var _tmp629;var _tmp630;var _tmp631;var f;var msg;var _tmp632;var _tmp633;var _tmp634;var f;var _tmp635;var _tmp636;var _tmp637;var args;var _tmp638;var _tmp639;var _tmp640;var _tmp641;var _tmp642;var _tmp643;var _tmp644;var f;var msg;var _tmp645;var _tmp646;var _tmp647;var f;var _tmp648;var msg;var _tmp649;var _tmp650;var _tmp651;var s;var _tmp652;var _tmp653;var _tmp654;var args;var _tmp655;var _tmp656;var _tmp657;var args;var _tmp658;var _tmp659;var _tmp660;var value;var _tmp661;var _tmp662;var _tmp663;var value;var _tmp664;var _tmp665;var _tmp666;var _tmp667;var _tmp668;var _tmp669;var _tmp670;var _tmp671;var _tmp672;var args;var _tmp673;var _tmp674;var _tmp675;var args;var _tmp676;var _tmp677;var _tmp678;var lhs;var rhs;var _tmp679;var _tmp680;var _tmp681;var _tmp682;var _tmp683;var _tmp684;var obj;var msg;var rhs;var _tmp685;var _tmp686;var _tmp687;var binding;var value;var _tmp688;var _tmp689;var _tmp690;var binding;var _tmp691;var _tmp692;var _tmp693;var _tmp694;var _tmp695;var _tmp696;var _tmp697;var x;var y;var z;var body;var _tmp698;var _tmp699;var _tmp700;var test;var body;var _tmp701;var _tmp702;var _tmp703;var test;var pos;var neg;var _tmp704;var _tmp705;var _tmp706;var bindings;var body;var _tmp707;var _tmp708;var _tmp709;var v;var _tmp710;var _tmp711;if((((_tmp711=_tmp628),(typeof(_tmp711)==="string"))&&(_tmp711,true))){return translate.expr(translate.mangle(expr),mode);}else{if((((_tmp710=_tmp628),(_tmp710===null))&&(_tmp710,true))){return translate.expr("null",mode);}else{if((((_tmp707=_tmp628),(_tmp707 instanceof Array))&&((_tmp707["#"]===undefined)&&(((_tmp708=_tmp707.length),(_tmp708===2))&&(((_tmp709=_tmp707[0]),(_tmp709==="value"))&&(_tmp709,true,(v=_tmp707[1]),true)))))){var r=function(){var _tmp712=v;var other;var _tmp713;var _tmp721;var _tmp714;var _tmp720;var _tmp715;var _tmp719;var _tmp716;var _tmp718;var _tmp717;var _tmp722;if((((_tmp722=_tmp712),(typeof(_tmp722)==="string"))&&(_tmp722,true))){var repl=({"\"":"\\\"","\n":"\\n","\\":"\\\\"});(v=v.replace(RegExp("((?:(?:\"|\\\\)|\n))","g"),function(m){return ___lib.send(repl,m);}));return (("\""+v)+"\"");}else{if(((_tmp713=_tmp712),(((_tmp714=_tmp713),(((_tmp715=_tmp714),(((_tmp716=_tmp715),((((_tmp717=_tmp716),(typeof(_tmp717)==="number"))&&(_tmp717,true))||(((_tmp718=_tmp716),(_tmp718===true))&&(_tmp718,true))))||(((_tmp719=_tmp715),(_tmp719===false))&&(_tmp719,true))))||(((_tmp720=_tmp714),(_tmp720===null))&&(_tmp720,true))))||(((_tmp721=_tmp713),(_tmp721===undefined))&&(_tmp721,true))))){return String(v);}else{if(((other=_tmp712),true)){return (("?!?["+v)+"]?!?");}else{throw ["Could not find a match",_tmp712];}}}}();return translate.expr(r,mode);}else{if((((_tmp704=_tmp628),(_tmp704 instanceof Array))&&((_tmp704["#"]===undefined)&&(((_tmp705=_tmp704.length),(_tmp705===3))&&(((_tmp706=_tmp704[0]),(_tmp706==="lambda"))&&(_tmp706,true,(bindings=_tmp704[1]),true,(body=_tmp704[2]),true)))))){var a=bindings.join(",");var b=translate.body(body,"return");return translate.expr((((("function("+a)+"){")+b)+"}"),mode);}else{if((((_tmp701=_tmp628),(_tmp701 instanceof Array))&&((_tmp701["#"]===undefined)&&(((_tmp702=_tmp701.length),(_tmp702===4))&&(((_tmp703=_tmp701[0]),(_tmp703==="if"))&&(_tmp703,true,(test=_tmp701[1]),true,(pos=_tmp701[2]),true,(neg=_tmp701[3]),true)))))){var _tmp723=mode;var other;var _tmp724;if((((_tmp724=_tmp723),(_tmp724==="expr"))&&(_tmp724,true))){return translate.body(expr,"expr");}else{if(((other=_tmp723),true)){var a=translate(test,"expr");var b=translate(pos,mode);var c=translate(neg,mode);return (((((("if("+a)+"){")+b)+"}else{")+c)+"}");}else{throw ["Could not find a match",_tmp723];}}}else{if((((_tmp698=_tmp628),(_tmp698 instanceof Array))&&((_tmp698["#"]===undefined)&&(((_tmp699=_tmp698.length),(_tmp699===3))&&(((_tmp700=_tmp698[0]),(_tmp700==="js_while"))&&(_tmp700,true,(test=_tmp698[1]),true,(body=_tmp698[2]),true)))))){var _tmp725=mode;var other;var _tmp726;if((((_tmp726=_tmp725),(_tmp726==="expr"))&&(_tmp726,true))){return translate.body(expr,"expr");}else{if(((other=_tmp725),true)){var a=translate(test,"expr");var b=translate(body,"stmt");return (((("while("+a)+"){")+b)+"}");}else{throw ["Could not find a match",_tmp725];}}}else{if((((_tmp695=_tmp628),(_tmp695 instanceof Array))&&((_tmp695["#"]===undefined)&&(((_tmp696=_tmp695.length),(_tmp696===5))&&(((_tmp697=_tmp695[0]),(_tmp697==="js_for"))&&(_tmp697,true,(x=_tmp695[1]),true,(y=_tmp695[2]),true,(z=_tmp695[3]),true,(body=_tmp695[4]),true)))))){var _tmp727=mode;var other;var _tmp728;if((((_tmp728=_tmp727),(_tmp728==="expr"))&&(_tmp728,true))){return translate.body(expr,"expr");}else{if(((other=_tmp727),true)){var a=translate(x,"stmt");var b=translate(y,"stmt");var c=translate(z,"expr");var d=translate(body,"stmt");return (((((("for("+a)+b)+c)+"){")+d)+"}");}else{throw ["Could not find a match",_tmp727];}}}else{if((((_tmp688=_tmp628),(_tmp688 instanceof Array))&&((_tmp688["#"]===undefined)&&(((_tmp689=_tmp688.length),(_tmp689===3))&&(((_tmp690=_tmp688[0]),(_tmp690==="declare"))&&((_tmp690,true,(binding=_tmp688[1]),true,(_tmp691=_tmp688[2]),(_tmp691 instanceof Array))&&((_tmp691["#"]===undefined)&&(((_tmp692=_tmp691.length),(_tmp692===2))&&(((_tmp693=_tmp691[0]),(_tmp693==="value"))&&((_tmp693,true,(_tmp694=_tmp691[1]),(_tmp694===undefined))&&(_tmp694,true))))))))))){var _tmp729=mode;var other;var _tmp730;var _tmp732;var _tmp731;if(((_tmp730=_tmp729),((((_tmp731=_tmp730),(_tmp731==="expr"))&&(_tmp731,true))||(((_tmp732=_tmp730),(_tmp732==="return"))&&(_tmp732,true))))){throw "Invalid in expr ctx";}else{if(((other=_tmp729),true)){var a=translate(binding,"expr");return (("var "+a)+";");}else{throw ["Could not find a match",_tmp729];}}}else{if((((_tmp685=_tmp628),(_tmp685 instanceof Array))&&((_tmp685["#"]===undefined)&&(((_tmp686=_tmp685.length),(_tmp686===3))&&(((_tmp687=_tmp685[0]),(_tmp687==="declare"))&&(_tmp687,true,(binding=_tmp685[1]),true,(value=_tmp685[2]),true)))))){var _tmp733=mode;var other;var _tmp734;var _tmp736;var _tmp735;if(((_tmp734=_tmp733),((((_tmp735=_tmp734),(_tmp735==="expr"))&&(_tmp735,true))||(((_tmp736=_tmp734),(_tmp736==="return"))&&(_tmp736,true))))){throw "Invalid in expr ctx";}else{if(((other=_tmp733),true)){var a=translate(binding,"expr");var b=translate(value,"expr");return (((("var "+a)+"=")+b)+";");}else{throw ["Could not find a match",_tmp733];}}}else{if((((_tmp679=_tmp628),(_tmp679 instanceof Array))&&((_tmp679["#"]===undefined)&&(((_tmp680=_tmp679.length),(_tmp680===3))&&(((_tmp681=_tmp679[0]),(_tmp681==="assign"))&&((_tmp681,true,(_tmp682=_tmp679[1]),(_tmp682 instanceof Array))&&((_tmp682["#"]===undefined)&&(((_tmp683=_tmp682.length),(_tmp683===3))&&(((_tmp684=_tmp682[0]),(_tmp684==="send"))&&(_tmp684,true,(obj=_tmp682[1]),true,(msg=_tmp682[2]),true,(rhs=_tmp679[2]),true)))))))))){var a=translate(obj,"expr");var b=translate(msg,"expr");var c=translate(rhs,"expr");return translate.expr((((((("("+a)+"[")+b)+"]=")+c)+")"),mode);}else{if((((_tmp676=_tmp628),(_tmp676 instanceof Array))&&((_tmp676["#"]===undefined)&&(((_tmp677=_tmp676.length),(_tmp677===3))&&(((_tmp678=_tmp676[0]),(_tmp678==="assign"))&&(_tmp678,true,(lhs=_tmp676[1]),true,(rhs=_tmp676[2]),true)))))){var a=translate(lhs,"expr");var b=translate(rhs,"expr");return translate.expr((((("("+a)+"=")+b)+")"),mode);}else{if((((_tmp673=_tmp628),(_tmp673 instanceof Array))&&((_tmp673["#"]===undefined)&&(((_tmp674=_tmp673.length),(_tmp674>=1))&&(((_tmp675=_tmp673[0]),(_tmp675==="multi"))&&(_tmp675,true,(args=_tmp673.slice(1)),true)))))){var isdecl=function(x){var _tmp737=x;var other;var _tmp738;var _tmp739;var _tmp740;var variable;var value;if((((_tmp738=_tmp737),(_tmp738 instanceof Array))&&((_tmp738["#"]===undefined)&&(((_tmp739=_tmp738.length),(_tmp739===3))&&(((_tmp740=_tmp738[0]),(_tmp740==="declare"))&&(_tmp740,true,(variable=_tmp738[1]),true,(value=_tmp738[2]),true)))))){return true;}else{if(((other=_tmp737),true)){return false;}else{throw ["Could not find a match",_tmp737];}}};if((args.length===1)){return translate(args[0],mode);}else{if(((mode==="expr")&&(!args.some(isdecl)))){var xs=args.map(function(x){return translate(x,"expr");});return (("("+xs.join(","))+")");}else{if(true){return translate.body(expr,mode);}else{return false;}}}}else{if((((_tmp670=_tmp628),(_tmp670 instanceof Array))&&((_tmp670["#"]===undefined)&&(((_tmp671=_tmp670.length),(_tmp671>=1))&&(((_tmp672=_tmp670[0]),(_tmp672==="splice"))&&(_tmp672,true,(args=_tmp670.slice(1)),true)))))){return translate(["multi"].concat(args),mode);}else{if((((_tmp667=_tmp628),(_tmp667 instanceof Array))&&((_tmp667["#"]===undefined)&&(((_tmp668=_tmp667.length),(_tmp668===1))&&(((_tmp669=_tmp667[0]),(_tmp669==="js_break"))&&(_tmp669,true)))))){if((mode==="expr")){throw "Invalid break in ctx";}else{if(true){return "break;";}else{return false;}}}else{if((((_tmp664=_tmp628),(_tmp664 instanceof Array))&&((_tmp664["#"]===undefined)&&(((_tmp665=_tmp664.length),(_tmp665===1))&&(((_tmp666=_tmp664[0]),(_tmp666==="js_continue"))&&(_tmp666,true)))))){if((mode==="expr")){throw "Invalid continue in ctx";}else{if(true){return "continue;";}else{return false;}}}else{if((((_tmp661=_tmp628),(_tmp661 instanceof Array))&&((_tmp661["#"]===undefined)&&(((_tmp662=_tmp661.length),(_tmp662===2))&&(((_tmp663=_tmp661[0]),(_tmp663==="js_return"))&&(_tmp663,true,(value=_tmp661[1]),true)))))){if((mode==="expr")){throw "Invalid return in ctx";}else{if(true){return (("return "+translate(value,"expr"))+";");}else{return false;}}}else{if((((_tmp658=_tmp628),(_tmp658 instanceof Array))&&((_tmp658["#"]===undefined)&&(((_tmp659=_tmp658.length),(_tmp659===2))&&(((_tmp660=_tmp658[0]),(_tmp660==="js_throw"))&&(_tmp660,true,(value=_tmp658[1]),true)))))){if(true){return (("throw "+translate(value,"expr"))+";");}else{return false;}}else{if((((_tmp655=_tmp628),(_tmp655 instanceof Array))&&((_tmp655["#"]===undefined)&&(((_tmp656=_tmp655.length),(_tmp656>=1))&&(((_tmp657=_tmp655[0]),(_tmp657==="array"))&&(_tmp657,true,(args=_tmp655.slice(1)),true)))))){var r=function(){var f=function(x){return translate(x,"expr");};return (("["+args.map(f).join(","))+"]");}();return translate.expr(r,mode);}else{if((((_tmp652=_tmp628),(_tmp652 instanceof Array))&&((_tmp652["#"]===undefined)&&(((_tmp653=_tmp652.length),(_tmp653>=1))&&(((_tmp654=_tmp652[0]),(_tmp654==="object"))&&(_tmp654,true,(args=_tmp652.slice(1)),true)))))){var r=function(){var f=function(x){var a=translate(x[1],"expr");var b=translate(x[2],"expr");return ((a+":")+b);};return (("({"+args.map(f).join(","))+"})");}();return translate.expr(r,mode);}else{if((((_tmp645=_tmp628),(_tmp645 instanceof Array))&&((_tmp645["#"]===undefined)&&(((_tmp646=_tmp645.length),(_tmp646===3))&&(((_tmp647=_tmp645[0]),(_tmp647==="send"))&&((_tmp647,true,(f=_tmp645[1]),true,(_tmp648=_tmp645[2]),(msg=_tmp648),true,(_tmp649=_tmp648),(_tmp649 instanceof Array))&&((_tmp649["#"]===undefined)&&(((_tmp650=_tmp649.length),(_tmp650===2))&&(((_tmp651=_tmp649[0]),(_tmp651==="value"))&&(_tmp651,true,(s=_tmp649[1]),true)))))))))){if(((typeof(s)==="string")&&s.match(RegExp("(?:^(?:[a-zA-Z_$]+)$)")))){var trf=translate(f,"expr");var trmsg=translate(s,"expr");return translate.expr(((trf+".")+trmsg),mode);}else{if(true){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{return false;}}}else{if((((_tmp638=_tmp628),(_tmp638 instanceof Array))&&((_tmp638["#"]===undefined)&&(((_tmp639=_tmp638.length),(_tmp639===3))&&(((_tmp640=_tmp638[0]),(_tmp640==="send"))&&((_tmp640,true,(_tmp641=_tmp638[1]),(_tmp641==="___js_fetch"))&&((_tmp641,true,(_tmp642=_tmp638[2]),(_tmp642 instanceof Array))&&((_tmp642["#"]===undefined)&&(((_tmp643=_tmp642.length),(_tmp643===3))&&(((_tmp644=_tmp642[0]),(_tmp644==="array"))&&(_tmp644,true,(f=_tmp642[1]),true,(msg=_tmp642[2]),true))))))))))){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((trf+"[")+trmsg)+"]"),mode);}else{if((((_tmp632=_tmp628),(_tmp632 instanceof Array))&&((_tmp632["#"]===undefined)&&(((_tmp633=_tmp632.length),(_tmp633===3))&&(((_tmp634=_tmp632[0]),(_tmp634==="send"))&&((_tmp634,true,(f=_tmp632[1]),true,(_tmp635=_tmp632[2]),(_tmp635 instanceof Array))&&((_tmp635["#"]===undefined)&&(((_tmp636=_tmp635.length),(_tmp636>=1))&&(((_tmp637=_tmp635[0]),(_tmp637==="array"))&&(_tmp637,true,(args=_tmp635.slice(1)),true)))))))))){var op=((typeof(f)==="string")&&___lib.send(js_op_table,f));if(op){return translate.expr(translate.op(op,args[0],args[1]),mode);}else{if(true){var trf=translate(f,"expr");var trargs=args.map(function(x){return translate(x,"expr");});return translate.expr((((trf+"(")+trargs.join(","))+")"),mode);}else{return false;}}}else{if((((_tmp629=_tmp628),(_tmp629 instanceof Array))&&((_tmp629["#"]===undefined)&&(((_tmp630=_tmp629.length),(_tmp630===3))&&(((_tmp631=_tmp629[0]),(_tmp631==="send"))&&(_tmp631,true,(f=_tmp629[1]),true,(msg=_tmp629[2]),true)))))){var trf=translate(f,"expr");var trmsg=translate(msg,"expr");return translate.expr((((("___lib.send("+trf)+",")+trmsg)+")"),mode);}else{if(((other=_tmp628),true)){throw other;}else{throw ["Could not find a match",_tmp628];}}}}}}}}}}}}}}}}}}}}}}}}};(translate["mangle"]=function(name){var tr=({"+":"__plus__","-":"__minus__","*":"__asterisk__","/":"__slash__","%":"__percent__","^":"__caret__","#":"__hash__","&":"__amp__","|":"__pipe__","@":"__at__","!":"__bang__","?":"__qmark__","=":"__equal__","<":"__lt__",">":"__gt__","~":"__tilde__",".":"__dot__"});var r=[];for(var i=0;(i<name.length);(++i)){var c=___lib.send(name,i);r.push((___lib.send(tr,c)||c));}return r.join("");});(translate["body"]=function(b,mode){(orig=b);(b=aslist(b));var trst=function(stmt){return translate(stmt,"stmt");};var _tmp741=mode;var other;var _tmp742;var _tmp743;var _tmp744;if((((_tmp744=_tmp741),(_tmp744==="expr"))&&(_tmp744,true))){var x=["send",["lambda",[],orig],["array"]];return translate(x,mode);}else{if((((_tmp743=_tmp741),(_tmp743==="return"))&&(_tmp743,true))){var stmts=b.slice(0,(-1));var ret=___lib.send(b,(b.length-1));return (stmts.map(trst).join("")+translate(ret,"return"));}else{if((((_tmp742=_tmp741),(_tmp742==="stmt"))&&(_tmp742,true))){return b.map(trst).join("");}else{if(((other=_tmp741),true)){throw "OopsH";}else{throw ["Could not find a match",_tmp741];}}}}});(translate["expr"]=function(x,mode){var _tmp745=mode;var other;var _tmp746;var _tmp747;var _tmp748;if((((_tmp748=_tmp745),(_tmp748==="expr"))&&(_tmp748,true))){return x;}else{if((((_tmp747=_tmp745),(_tmp747==="stmt"))&&(_tmp747,true))){return (x+";");}else{if((((_tmp746=_tmp745),(_tmp746==="return"))&&(_tmp746,true))){return (("return "+x)+";");}else{if(((other=_tmp745),true)){throw "OopsI";}else{throw ["Could not find a match",_tmp745];}}}}});(translate["op"]=function(op,a,b){(e=function(){if((a===null)){return (op+translate(b,"expr"));}else{if((b===null)){return (translate(a,"expr")+op);}else{if(true){return ((translate(a,"expr")+op)+translate(b,"expr"));}else{return false;}}}}());return (("("+e)+")");});var fs=require("fs");var file=process.argv[2];var f=function(err,data){var p=parse(data);var ex=expand(stdenv,"top",["multi",p]);var prelude="var ___lib=require(\"./lib\");";return console.log((prelude+translate(ex,"stmt")));};fs.readFile(file,"utf8",f);
